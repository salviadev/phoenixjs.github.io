var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=b,e=a.ipc,f=a.link,g=a.drag,h=a.utils,i=a.LayoutUtils,j=function(a,b,c){for(var d,e,f=a.target,g=null;f;){if(g=f.getAttribute("data-layout")){if(d=parseInt(f.getAttribute("data-level")||"1",10),e=c.getLayoutById(g),e&&i.canSelect(e,d)||(g=null),g)break}else if(g=f.getAttribute("data-render"))break;f=f==b?null:f.parentNode}return g},k=function(a){a.$idDesign=null,a.$idDrag=null,a.$idSelect=null,a.$idStep2=null,a.$idStep3=null},l=function(a,b,c,d,e){return e?(b.$items.splice(c,1),void("row"===b.$type&&(b.$items.length?delete b.$items[0].$colSize:(b.$type="block",b.$origin="row",k(b))))):void b.$items.splice(c,1)},m=function(a,b,c,d,e,f){if(!f)return c.$parentId=b.$id,void b.$items.splice(d,0,c);if("row"===b.$origin&&"row"!==b.$type&&(delete b.$origin,b.$type="row",k(b)),c.$parentId=b.$id,"row"==b.$type)switch("block"===c.$type&&"row"===c.$origin&&(c.$type="row",delete c.$origin),c.$type){case"block":delete c.$origin,delete c.$type,k(c);break;case"column":e||delete c.$colSize;break;default:var g={$items:[],$auto:!0};g.$items.push(c),c=g}else"column"==c.$type&&(delete c.$colSize,c.$type="block",k(c),c.$auto&&(c=c.$items[0]));b.$items.splice(d,0,c)},n=function(a,b){for(var c=a.target;c;){if(c.hasAttribute("data-remove"))return!0;c=c===b?null:c.parentNode}return!1},o=function(a,b){for(var c=a.target;c;){if(c.hasAttribute("data-layout-detail"))return!0;c=c===b?null:c.parentNode}return!1},p=function(a){return a.originalEvent?a.originalEvent:a},q=function(a,b){if(!a)return null;var c,d,e,f,g,h;a.map&&(c=!0,d=a.map,a.map=null,e=a.fields,a.fields=null),b&&(f=a.$items,f&&(a.$items=[]),g=a.$render,a.$render=null),a.$config&&a.$config.datasets&&(h=a.$config.data?a.$config.data.ds:null,h&&delete a.$config.data.ds);var j=$.extend(!0,{},a);return c&&(a.map=d,a.fields=e,delete j.fields,delete j.map),b&&(a.$items=f,a.$render=g),h&&(a.$config.data.ds=h),i.clearMeta(j,!b),b&&delete j.$items,j},r=function(a,b,d,e){for(var f=[],g=a.childNodes,h=0,i=g.length;i>h;h++){var j=g[h],k=c.offset(j),l={position:e?k.left+(k.width>>1):k.top+(k.height>>1),ignore:j==b&&!e||3==j.nodeType||j.hasAttribute("data-remove")||j.hasAttribute("data-ignore"),placeHolder:j==d};f.push(l)}return f},s=function(a,b){var c=0;if(a.length){for(var d=0,e=a.length;e>d;d++){var f=a[d];if(!f.ignore&&b<f.position)return d;c=d+1}return c}return c},t=function(a,b,c,d){for(var e=0,f=0,g=a.childNodes.length;g>f;f++){var h=a.childNodes[f];if(3!=h.nodeType){if(h==b)return e;h!=c&&(d&&!h.hasAttribute("data-layout")||(d||h.hasAttribute("data-render"))&&e++)}}return 0},u=function(a){var b=a.nextSibling,c=a.previousSibling,d=0,e=5;c&&(d=b?b.offsetLeft-e:c.offsetLeft+c.offsetWidth-2*e),a.style.left=parseInt(d+"",10)+"px"},v=function(a,b,d,e,f,g,h,i){i&&(h.horizontal?c.addClass(e,"drop-target-col"):(e.style.removeProperty&&(e.style.removeProperty("height"),e.style.removeProperty("left")),c.removeClass(e,"drop-target-col")));var j=function(a){e.parentNode&&D(e),f.$type&&!a&&("column"==f.$type&&1==g?c.addClass(e,"col"):c.removeClass(e,"col"))},k=!0;if(b.length||(j(!1),c.append(a,e),k=!1),k){for(var l=-1,m=0,n=b.length;n>m;m++){var o=b[m];if(o.placeHolder){if(l=m,m==d||m==d-1)return!1}else if(o.ignore){if(m==d&&n>m+1&&b[m+1].placeHolder)return!1;if(m==d-1&&m>0&&b[m-1].placeHolder)return!1}}if(0>l||d>=b.length)j(l>=0),c.append(a,e);else{var p=a.childNodes[d];j(l>=0),c.before(p,e)}}return h.horizontal&&u(e),!0},w=function(a,b,d){if(d){for(var e=0,f=a.childNodes.length;f>e;e++)b?c.addClass(a.childNodes[e],"bs-none-drag"):c.removeClass(a.childNodes[e],"bs-none-drag");b?(c.addClass(a,"drag-source"),2===d&&c.removeClass(a,"auto")):(c.removeClass(a,"drag-source"),2===d&&c.addClass(a,"auto"))}},x=function(a,b,d,e,f,g,h){if(d){var i="column"==h.$type;b&&D(b),b=y(null,d,e,f,i),c.addClass(b,"drop-target"),i?(a.isColumn=1,h.$auto&&(a.isColumn=2),w(a.firstChild,!0,a.isColumn),c.before(a,b),u(b)):(c.addClass(a,"bs-none"),c.before(a,b))}else b=y(b,!1,e,f,!1),c.before(a,b),c.addClass(a,"bs-none");return b},y=function(a,b,c,d,e){return a&&D(a),a=document.createElement("div"),a.className="container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"+(c?" bs-island bs-field":"")+(d?" bs-island bs-widget":"")+(e?" drop-target-col":""),a},z=function(a){var b=document.createElement("div");return b.className="bs-drag-image",document.body.appendChild(b),b},A=function(a,b){if(a){var d=c.find(a.get(0),b.$idSelect||b.$idDrag);b.selected?c.addClass(d,"selected"):c.removeClass(d,"selected")}},B=function(a,b,d,f){if(b){var g=c.find(a,b.$idSelect||b.$idDrag);if(a!=g)if(b.selected){var h=g.querySelector('div[data-remove="true"]');if(!h){var i=$('<div class="bs-rt-button" data-remove="true"><span class="'+c.iconClass("times-circle")+'"></span></div>').get(0),j=g.childNodes;j.length?c.before(j[0],i):c.append(g,i)}}else{var k=g.querySelector('div[data-remove="true"]');k&&c.remove(k)}}if(d){var l=q(b,!0);if(l&&delete l.$id,b&&b.$type){l.$type=b.$type,b.$items&&b.$items.length&&!b.$items[0].$bind||(l.onlyFields=!0);var m=f.getLayoutById(b.$parentId);m&&(l.parent=q(m,!0),l.parent.$type=m.$type)}e.emit("SelectedChanged",{type:b?b.$type?"layout":b.$config?"widget":"field":null,id:b?b.$id:null,data:l,control:f})}},C=function(a,b,c){c&&(a.off("click"),a.find('*[draggable="true"]').off("dragstart").add(a).off("dragend"),a.find('*[draggable="true"]').off("dragstart"),a.find(".drop-layouts-zone, .drop-fields-zone").add(a).off("dragover dragenter drop"))},D=function(a){c.remove(a)},E=function(a,b,d){if(d){var e,f,h,i,k,q,u=function(){setTimeout(function(){q=!1},0)},A=function(){q=!1,e&&(c.removeClass(e,"bs-none"),e.isColumn&&w(e.firstChild,!1,e.isColumn),e.isColumn=!1,e=null),i&&(D(i),i=null),f&&(c.remove(f),f=null),k=null,h=!1,g.setData(null)},B=function(e){var f=a.get(0);if(e){if(e.data===e.dst)return;var g,h,i,j,k=e.dst,n=e.data,o=c.find(f,n.$id),p=c.find(f,k.$idDesign),q=!1;if(n.$parentId===k.$id){if(i=e.dst,h=i.$items.indexOf(n),g=e.indexInParent,q=!0,g==h)return}else i=e.isNew?null:b.getLayoutById(n.$parentId),h=i?i.$items.indexOf(n):-1,g=e.indexInParent;if(h>=0&&l(b,i,h,q,e.isLayout),m(b,k,n,g,q,e.isLayout),e.isNew||e.isLayout)b.check(null);else{if(h>=0&&c.detach(o),g==k.$items.length-1?c.append(p,o):(j=c.find(f,k.$items[g+1].$id),c.before(j,o)),!k.$items[g].$bind){var r=[i];return k!==i&&r.push(k),C(a,b,d),E(a,b,d),void r.forEach(function(a){b._afterPropsChanged(a)})}b.check(null)}b.render()}};a.on("click",function(c){var d=j(c,a.get(0),b);return n(c,a.get(0))?void b.removeChild(d):o(c,a.get(0))?void b.authoringChild(d):void b.select(d)}),a.find('*[draggable="true"]').on("dragstart",function(d){d.stopPropagation();var i=!1,j=!0,k=!1,l=b.getLayoutById(this.getAttribute("data-layout"));if(l||(l=b.getFieldById(this.getAttribute("data-render")),k=null!=l.$config,i=!k,j=!1),!l)return d.preventDefault(),!1;l.selected&&b.select(null);var m=p(d).dataTransfer;m.effectAllowed="move",m.setData("Text","data"),j&&m.setDragImage&&(f=z(!0),m.setDragImage(f,0,0));var n=b.getLayoutById(l.$parentId);n&&n.$auto&&(l=n),g.setData({data:l,isLayout:j,isField:i,isWidget:k,isNew:!1}),e=c.find(a.get(0),l.$idDrag),h=!0}).add(a).on("dragend",function(a){return a.preventDefault(),a.stopPropagation(),A(),!1}),a.find(".drop-layouts-zone, .drop-fields-zone").add(a).on("dragover dragenter drop",function(a){var d=this,f=g.getData(),j=p(a),l=j.dataTransfer;if(a.stopPropagation(),q)return!0;if(!f||!f.isLayout&&!c.hasClass(d,"drop-fields-zone")||f.isLayout&&!c.hasClass(d,"drop-layouts-zone"))return l.effectAllowed="none",!0;if("drop"==a.type){a.preventDefault();var m=b.getLayoutById(d.getAttribute("data-layout")),n=d.getAttribute("data-level");return m?(f=g.getData(),f.dst=m,f.dstLevel=n,f.indexInParent=t(d,i,e,f.isLayout),g.setData(f),A(),B(f),!1):(A(),!1)}if(l.getData("Text"),h){if(!e)return;if(h=!1,!f.isNew)return q=!0,i=x(e,i,f.isLayout,f.isField,f.isWidget,b,f.data),u(),a.preventDefault(),!1}var o=b.getLayoutById(d.getAttribute("data-layout")),w=d.getAttribute("data-level");if(!i){if(!f.isNew)return!0;var z=b._canDropChild(f.data,o,w);if(!z)return l.effectAllowed="none",!0;k=r(d,e,i,z.horizontal);var C=s(k,z.horizontal?j.pageX:j.pageY);return i=y(i,f.isLayout,f.isField,f.isWidget,z.horizontal),v(d,k,C,i,o,w,z,f.isLayout),k=null,a.preventDefault(),!1}if("dragenter"==a.type&&(k=null),e==d)return l.effectAllowed="none",!0;var D=b._canDropChild(f.data,o,w);if(!D)return l.effectAllowed="none",!0;k||(k=r(d,e,i,D.horizontal));var E=s(k,D.horizontal?j.pageX:j.pageY);return v(d,k,E,i,o,w,D,f.isLayout)&&(k=null),a.preventDefault(),!1})}},F={_setDesignListeners:function(a){e.listen("onToolBoxDragend",function(){this.$element&&this.$element.trigger("dragend")},this),e.listen("onUpdateSelected",function(a){"layout"==a.type?this.updateLayout(a.id,a.data):this.updateField(a.id,a.data)},this),e.listen("onAuthoringModeChanged",function(a){this.setDesignMode(a)},this),e.listen("onSaveLayout",function(){if(this.saveHandler){var a=q(this.data,!1);this.saveHandler(a)}},this),e.listen("onNewLayout",function(a){if(this.createHandler){var b=q(this.data,!1);this.createHandler(a.name,b)}},this),e.listen("onLoadNestedLayouts",function(a){this.loadNestedHandler&&this.loadNestedHandler(a.data,a.after)},this),e.listen("onOpenLayout",function(a){this.openHandler&&this.openHandler(a.name)},this),e.listen("onRemoveLayout",function(){this.removeHandler&&this.removeHandler(this.data.name)},this),e.listen("onListLayout",function(a){this.listHandler&&this.listHandler(a)},this)},_afterCreate:function(){var a=this;a.options.form&&a.options.design&&h.nextTick(function(){e.emit("FormData",{schema:a.$schema,locale:a.$locale})})},authoringChild:function(a){var b=this,c=b.getLayoutById(a);if(c&&c.$ref)if(b.options.form){var d={name:c.$ref};c.$refProperty&&(d.path=c.$refProperty);var e=f.context();d.schema=e.$url.prototype?e.$url.prototype:b.data.name,d.locale=e.$url.locale?e.$url.locale:b.data.name,f.doFormAuthoring(d)}else f.doAuthoring(c.$ref,!0)},_removeEvents:function(){var a=this;a._removeAccordionEvents(),C(a.$element,a,!0),a._removeBaseEvents()},_addEvents:function(){var a=this;a._setAccordionEvents(),E(a.$element,a,a.options.design),a._addBaseEvents()},_onSelectedChanged:function(a,b,c){var d=this;B(a,b,c,d)},_showSelected:function(a,b){A(a,b)},_canDropChild:function(a,b,c){var d=this;if(b&&b.$type&&b.$ref)return null;if(a.$type)return c=parseInt(c||"1",10),b&&a?b==a?null:d.isChildOf(a,b)?null:"row"==b.$type?{horizontal:!0}:{horizontal:!1}:null;if(a.$bind||a.$config){var e=b.$items.length;if(!e)return{horizontal:!1};for(var f=a.$bind?"$bind":"$config";e--;)if(!b.$items[e][f])return null;return{horizontal:!1}}return null},toString:function(a){var b=q(a||this.data,!1);return JSON.stringify(b)}};$.extend(d.Layout.prototype,F),$.extend(d.Form.prototype,F)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=layout.control.design.js.map
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.ipc,e=b,f=a.dom,g=function(){function g(a){this.$element=null,this.form=null,this.$id=c.allocID(),this.options=a||{},this.selected=null,this._setListeners()}return g.prototype._sendLayout=function(a){var b=this;b.selected&&b.selected.id&&c.nextTick(function(){var c=b._model2layout(a);c&&d.emit("UpdateSelected",{type:"layout",id:b.selected.id,data:c})})},g.prototype._updateFields=function(a){var b=this;b.selected&&b.selected.id&&(b.selected.data&&b.selected.data.$config?b.selected.data.$config=JSON.parse(a.options):b.selected.data=JSON.parse(a.options),c.nextTick(function(){d.emit("UpdateSelected",b.selected)}))},g.prototype._hasData=function(){return this.selected&&this.selected.type},g.prototype._setListeners=function(){d.listen("onSelectedChanged",function(a){var b=this;b.selected=a;var c=b.$element.get(0);if(!b._hasData())return void f.addClass(c,"bs-none");f.removeClass(c,"bs-none");var d="layout"===b.selected.type;if(b.$element){var e=a.data;e&&e.$config&&(e=e.$config),b._setJson(e,d)}},this),d.listen("onAuthoringModeChanged",function(a){this.setDesignMode(a)},this)},g.prototype._model2layout=function(a){var b=this,c=!1,d=b.selected.data,e={},f=a.childrenFlow;"block"===f&&("column"===d.$type?f="column":"accordion-group"===d.$type&&(f="accordion-group"));var g=d.$origin||d.$type;f!==g&&(e.$type=f,c=!0);var g=d.$ref||d.$type;if((d.$ref||"")!==(a.subLayoutName||"")&&(e.$ref=a.subLayoutName,c=!0),(d.$refProperty||"")!==(a.subPathSchema||"")&&(e.$refProperty=a.subPathSchema,c=!0),a.$states.colSize.isHidden||("column"===f?(a.colSize!==d.$colSize&&(e.$colSize=a.colSize,c=!0),(a.customColSize||"")!==(d.$customColSize||"")&&(e.$customColSize=a.customColSize,c=!0)):d.parent&&d.parent.$auto&&(a.colSize!==d.parent.$colSize&&(e.parent=e.parent||{},e.parent.$colSize=a.colSize,c=!0),(a.customColSize||"")!==(d.parent.$customColSize||"")&&(e.parent=e.parent||{},e.parent.$customColSize=a.customColSize,c=!0))),a.$states.showTitle.isHidden?d.$title&&(c=!0):a.showTitle?d.$title?(!d.$title.value!==a.title&&(c=!0,e.$title=e.$title||{},e.$title.value=a.title),!d.$title.size!==a.titleSize&&(c=!0,e.$title=e.$title||{},e.$title.size=a.titleSize),!d.$title.style!==a.titleStyle&&(c=!0,e.$title=e.$title||{},e.$title.style=a.titleStyle)):(c=!0,e.$title={},e.$title.value=a.title,e.$title.size=a.titleSize,e.$title.style=a.titleStyle):d.$title&&(c=!0),!a.$states.formType.isHidden){var h=a.formType;d.$inline?"inline":d.$fieldsOptions&&d.$fieldsOptions.columns?"horizontal":"block";if(e.$fieldsOptions={},h!==g)switch(c=!0,h){case"block":e.$inline=!1,e.$fieldsOptions.columns=!1;break;case"horizontal":e.$inline=!1,e.$fieldsOptions.columns=!0,e.$fieldsOptions.labelCol=a.labelCol;break;case"inline":e.$inline=!0,e.$fieldsOptions.columns=!1}else"horizontal"===h&&e.$fieldsOptions.labelCol!==a.labelCol&&(e.$fieldsOptions.labelCol=a.labelCol,c=!0);e.$fieldsOptions.labelCol&&3==e.$fieldsOptions.labelCol&&delete e.$fieldsOptions.labelCol;var i=!(!d.$fieldsOptions||!d.$fieldsOptions.titleIsHidden);i!==a.titleIsHidden&&(e.$fieldsOptions.titleIsHidden=a.titleIsHidden,c=!0)}return c?e:null},g.prototype._schemaFields=function(){return{links:{apply:{title:"Apply"}},properties:{options:{type:"string",format:"json"}}}},g.prototype._field2FormData=function(a){return{options:JSON.stringify(a,null,2)}},g.prototype._layoutFields=function(){return{name:a.utils.allocID(),$type:"block",$items:[{$type:"block",$title:{value:"Properties"},$items:[{$bind:"options",options:{rows:5}}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},g.prototype._schemaLayout=function(){return{links:{apply:{title:"Apply"}},properties:{typeLayout:{type:"string"},showTitle:{title:"Show title",type:"boolean"},title:{type:"string",title:"Title"},titleSize:{type:"number",title:"Size","enum":[1,2,3,4,5,6],enumNames:["H1","H2","H3","H4","H5","H6"]},titleStyle:{type:"string",title:"Style"},childrenFlow:{type:"string",title:"Children disposition","enum":["block","row"],enumNames:["Vertical Flow","Table cell"],filters:{blockrow:["block","row"],onlyblock:["block"]}},subLayoutName:{type:"string",title:"Nested Layout Name"},subPathSchema:{type:"string",title:"Bind for nested layout"},colSize:{type:"number",title:"Size","enum":[1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["08.33%","16.67%","25.00%","33.33%","41.37%","50.00%","58.33%","66.67%","75.00%","83.33%","91.33%","100.00%"]},customSize:{type:"string",title:"Custom size"},formType:{title:"Form Type","enum":["block","horizontal","inline"],enumNames:["Vertical Form","Horizontal Form","Inline form"],type:"string"},labelCol:{title:"Label width (Bootstrap cols)","enum":[1,2,3,4,5,6,7,8,9,10,11,12],type:"number"},titleIsHidden:{title:"No titles",type:"boolean"}}}},g.prototype._layout2FormData=function(a){var b=this,c=a.$origin||a.$type,d="block",e="onlyblock",f=a,g=b.options.form&&("accordion-group"===c||"block"===c||"column"===c),h="accordion-group"===c||"block"===c||"column"===c,i=g&&!!a.$title;["column","block","row"].indexOf(c)>=0&&("row"===c&&(d="row"),a.parent&&(e="blockrow"));var j=!1;("column"===c||a.parent&&a.parent.$auto&&"column"===a.parent.$type)&&(j=!0,f="column"===c?a:a.parent);var k=b.options.form&&a.onlyFields&&!a.$ref,l=a.$inline?"inline":a.$fieldsOptions&&a.$fieldsOptions.columns?"horizontal":"block";return{showTitle:i,title:a.$title&&a.$title.value?a.$title.value:"",titleSize:a.$title&&a.$title.size?a.$title.size:4,titleStyle:a.$title&&a.$title.style?a.$title.style:"",childrenFlow:d,colSize:a.$colSize||0,customSize:a.$customColSize,formType:l,subLayoutName:a.$ref,subPathSchema:a.$refProperty,labelCol:a.$fieldsOptions&&a.$fieldsOptions.labelCol?a.$fieldsOptions.labelCol:3,titleIsHidden:!(!a.$fieldsOptions||!a.$fieldsOptions.titleIsHidden),$states:{showTitle:{isHidden:!g},title:{isHidden:!g||!i},titleSize:{isHidden:!g||!i},titleStyle:{isHidden:!g||!i},colSize:{isHidden:!j},customSize:{isHidden:!j},childrenFlow:{filter:e},formType:{isHidden:!k},labelCol:{isHidden:!k||"horizontal"!==l},titleIsHidden:{isHidden:!k},subLayoutName:{isHidden:!h},subPathSchema:{isHidden:!h||!b.options.form}},$links:{apply:{isDisabled:!0}}}},g.prototype._emptyContent=function(){var a=this;a.form&&(e.removeForm(a.form),a.form=null),f.empty(a.$element.get(0))},g.prototype._layoutEdit=function(){return{name:a.utils.allocID(),$type:"block",$items:[{$title:{value:"Title"},$bindState:"showTitle",$type:"block",$items:[{$bind:"showTitle"},{$bind:"title"},{$bind:"titleSize"},{$bind:"titleStyle"}]},{$type:"block",$title:{value:"Properties"},$items:[{$bind:"childrenFlow"},{$bind:"subLayoutName"},{$bind:"subPathSchema"},{$bind:"colSize"},{$bind:"customSize"}]},{$type:"block",$bindState:"formType",$title:{value:"Children (Fields)"},$items:[{$bind:"formType"},{$bind:"labelCol"},{$bind:"titleIsHidden"}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},g.prototype._setJson=function(a,c){var d=this;d._emptyContent(),c?b.OpenForm(d.$element,d._layoutEdit(),d._schemaLayout(),d._layout2FormData(a),{},function(a,b,c){var e=!1;if("propchange"===a.operation){switch(a.property){case"showTitle":b.$states.title.isHidden=!b.showTitle,b.$states.titleSize.isHidden=!b.showTitle,b.$states.titleStyle.isHidden=!b.showTitle,e=!0;break;case"formType":b.$states.labelCol.isHidden=b.$states.showTitle.isHidden||"horizontal"!==b.formType,e=!0;break;case"childrenFlow":case"colSize":if(!b.validate())return;d._sendLayout(b);break;case"subLayoutName":if(!b.validate())return;d._sendLayout(b);break;case"subPathSchema":if(!b.validate())return;b.subLayoutName?d._sendLayout(b):e=!0;break;default:e=!0}e&&(b.$links.apply.isDisabled=!1)}if("execute"===a.operation&&"$links.apply"===a.property){if(!b.validate())return;d._sendLayout(b)}},{},function(a){d.form=a}):b.OpenForm(d.$element,d._layoutFields(),d._schemaFields(),d._field2FormData(a),{},function(a,b,c){var e=!1;if("propchange"===a.operation){switch(a.property){default:e=!0}e&&(b.$links.apply.isDisabled=!1)}if("execute"===a.operation&&"$links.apply"===a.property){if(!b.validate())return;d._updateFields(b)}},{},function(a){d.form=a})},g.prototype.setDesignMode=function(a){this.options.design=a,this.$element&&(this.options.design&&this.selected?f.removeClass(this.$element.get(0),"bs-none"):f.addClass(this.$element.get(0),"bs-none"))},g.prototype.render=function(a){var b=this;return b.$element||(b.$element=$('<div id= "'+b.$id+'"></div>'),b.options.beforeAdd&&b.options.beforeAdd(b.$element)),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},g.prototype.destroy=function(){var a=this;a.form&&(a.form.destroy(),a.form=null),a.$element&&(a.$element=null),d.unlisten(a)},g}();b.PropertyEditor=g}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=propeditor.control.js.map
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.ipc,e=(a.drag,a.dom),f=b,g=a.locale,h=(a.ulocale,function(a,b){var c=['<nav class="navbar navbar-default" id="'+a+'">','  <div class="container-fluid">','    <div class="navbar-header">','      <a class="navbar-brand" href="#">',g.layouts.design.AuthoringMode,"      </a>","    </div>",'    <div class="collapse navbar-collapse">','     <form class="navbar-form navbar-left" role="search">','       <button type="button" class="btn btn-default'+(b.form?" bs-none":"")+'" id="'+a+'_new">','         <span class="'+e.iconClass("plus")+'" aria-hidden="false"></span> ',g.layouts.design.New,"       </button>",'       <button type="button" class="btn btn-default'+(b.form?" bs-none":"")+'" id="'+a+'_open">','         <span class="'+e.iconClass("file-o")+'" aria-hidden="false"></span> ',g.layouts.design.Open.title,"       </button>",'       <button type="button" class="btn btn-default'+(b.form?" bs-none":"")+'" id="'+a+'_remove">','         <span class="'+e.iconClass("times")+'" aria-hidden="false"></span> ',g.layouts.design.Delete,"       </button>",'       <button type="button" class="btn btn-default" id="'+a+'_save">','         <span class="'+e.iconClass("floppy")+'" aria-hidden="false"></span> ',g.layouts.design.Save,"       </button>",'       <div class="checkbox">',"         <label>",'           <input type="checkbox" id="'+a+'_preview"'+(b.design?"":' checked="true"')+"> ",g.layouts.design.Preview,"          </label>","       </div>","       </form>","    </div>","  </div>","</nav>"];return c.join("")}),i=function(){function b(a){this.$element=null,this.$id=c.allocID(),this.options=a||{}}return b.prototype._removeEvents=function(){var a=this;a.$element.off("click")},b.prototype._setEvents=function(){var a=this;a.$element.get(0);a.$element.on("click",function(b){var f=!1;switch(b.target.id){case a.$id+"_save":d.emit("SaveLayout",null),f=!0;break;case a.$id+"_open":a._openExisting(),f=!0;break;case a.$id+"_remove":f=!0,c.confirm("",g.layouts.design.ConfirmDelete,function(){d.emit("RemoveLayout",null)});break;case a.$id+"_preview":var h=e.query(a.$element.get(0),"#"+a.$id+"_preview");d.emit("AuthoringModeChanged",!h.checked);break;case a.$id+"_new":f=!0,c.prompt(g.layouts.design.PageName,"",function(a){return(a=a.trim())?a.indexOf(" ")>=0?void alert(g.layouts.design.InvalidPageName):void d.emit("NewLayout",{name:a}):void 0});break;default:f=!1}return f?(b.stopPropagation(),b.preventDefault(),!1):!0})},b.prototype._clearChildren=function(){},b.prototype._openExisting=function(){var a=this;d.emit("ListLayout",function(b){if(b&&b.files){for(var c=[],e=0;e<b.files.length;e++){var g=b.files[e];g!=f.Page().currentPage()&&c.push(g)}c.length&&a._openModal(c,function(a){d.emit("OpenLayout",{name:a})})}})},b.prototype._openModal=function(b,c){b.sort();var d={type:"object",properties:{page:{title:"Name",type:"string","enum":b}}},e={name:"open",$type:"block",$items:[{$bind:"page"}]},h={page:b[0]},i={title:g.layouts.design.Open.title,buttons:[{type:"default",title:g.layouts.design.Open.close,name:"cancel"},{type:"primary",title:g.layouts.design.Open.open,name:"ok"}]};f.OpenModalForm(i,e,d,h,a.locale,function(a,b,d,e){if("modal-action"===b.operation)switch(b.property){case"ok":var f=d.page;a.close(),c&&c(f);break;case"cancel":a.close()}})},b.prototype.render=function(a){var b=this;return b.$element||(b.$element=$(h(b.$id,b.options)),b._setEvents(),b.options.beforeAdd&&b.options.beforeAdd(b.$element)),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},b.prototype.destroy=function(){var a=this;a._clearChildren(),a.$element&&(a._removeEvents(),a.$element=null),d.unlisten(a)},b}();b.AuthoringToolBar=i}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=toolbar.authoring.control.js.map
var Phoenix;!function(a){var b;!function(b){function c(a,b){o(a,null,function(a,c,d){d&&h(a,c,b)})}function d(a,b){var c=[];return p(a,b,c),c.join("")}var e=a.utils,f=a.dom,g=a.locale,h=function(a,b,c){a.$id=a.$id||e.allocID(),b&&(a.$parentId=b.$id),a.$items&&(a.$contentId=a.$contentId||e.allocUuid()),c&&(c[a.$id]=a)},i=function(a,b,c,d){a.push('<div class="panel-group" id="accordion_expo" role="tablist" aria-multiselectable="true">')},j=function(a,b){a.push("</div>")},k=function(a,b,c,d){b.$typeItems=b.$typeItems||"layouts";var e,h;switch(b.$typeItems){case"layouts":h=b.$title||g.layouts.design.layouts,e="bars";break;case"widgets":h=b.$title||g.layouts.design.widgets,e="bars";break;case"actions":h=b.$title||g.layouts.design.actions,e="bars";break;default:h=b.$title||g.layouts.design.fields,e="bars"}a.push('<div class="panel panel-default" id="'+b.$id+'">'),a.push('<div class="panel-heading"  role="tab" id="'+b.$id+'_tab">'),a.push('<h3 class="panel-title">'),a.push('<a data-toggle="collapse" aria-expanded="'+(d?"true":"false")+'" draggable="false" data-parent="#accordion_expo" aria-controls="'+b.$id+'_content" href="#'+b.$id+'_content"><span class="'+f.iconClass("bars")+' bs-icon-space">'),a.push("</span>"),a.push(h),a.push("</a></h3></div>"),a.push('<div id="'+b.$id+'_content" class="panel-collapse collapse'+(d?" in":"")+'" role="tabpanel" aria-labelledby="'+b.$id+"_tab>"),a.push(' <ul class="list-group">')},l=function(a,b){a.push("</ul></div></div>")},m=function(a,b,c,d){a.push('<li draggable="true" class="list-group-item bs-cursor-p" data-toolbox="'+b.$id+'" id="'+b.$id+'">'),a.push('<span class="'+f.iconClass("file-o")+' bs-icon-space"></span>'),a.push(b.$title),a.push("</li>")},n=function(a,b){},o=function(a,b,c){a&&(c(a,b,!0),a.$items&&a.$items.forEach(function(b){o(b,a,c)}),c(a,b,!1))},p=function(a,b,c){var d=!0;o(a,b,function(a,b,e){var f=m,g=n;switch(a.$type){case"groups":f=i,g=j;break;case"group":e?k(c,a,b,d):l(c,a),g=null,f=null,d=!1;break;default:f=m,g=n}f&&g&&(e?f(c,a,b,!1):g(c,a))})};b.check=c,b.toHtml=d}(b=a.ToolBoxUtils||(a.ToolBoxUtils={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=toolbox.js.map
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,a.ipc),d=a.drag,e=a.dom,f=(a.ulocale,a.Observable.SchemaUtils),g=a.ToolBoxUtils,h=function(a,b){a.find('li[draggable="true"]').on("dragstart",function(a){a.stopPropagation();var c=b.getItemById($(this).attr("data-toolbox"));if(!c||!c.data)return a.preventDefault(),!1;var e=a.originalEvent?a.originalEvent.dataTransfer:a.dataTransfer;e.effectAllowed="move",e.setData("Text","Data");var f={isNew:!0,data:$.extend(!0,{},c.data.data),isLayout:!1,isField:!1,isWidget:!1};switch(c.data.$type){case"layout":f.isLayout=!0;break;case"field":f.isField=!0;break;case"widget":f.isWidget=!0}d.setData(f)}).on("dragend",function(a){return c.emit("ToolBoxDragend",null),d.setData(null),a.preventDefault(),a.stopPropagation(),!1})},i=function(a,b){a.find('li[draggable="true"]').off("dragstart dragend")},j=function(){function a(a,b){this.$element=null,this.map={},this.options=b||{},a=a||{},a.$type=a.$type||"groups",g.check(a,this.map),this.data=a,this._setListeners()}return a.prototype.updateFieldItems=function(a){var b=this,c=b.data.$items.find(function(a){return"fields"===a.$typeItems}),d=b.data.$items.find(function(a){return"actions"===a.$typeItems});if(c||(c={$type:"group",$typeItems:"fields",$items:[]},b.data.$items.push(c)),d||(d={$type:"group",$typeItems:"actions",$items:[]},b.data.$items.push(d)),c.$items=[],d.$items=[],a.forEach(function(a){var b={$type:"item",$title:a.$title,data:{$type:"field",data:{$bind:a.$bind,$widget:a.$widget,options:a.options}}};"field"===a.$type?c.$items.push(b):d.$items.push(b)}),b.map={},g.check(b.data,b.map),b.$element){i(b.$element,b);var f=e.find(b.$element.get(0),c.$id);if(f&&e.remove(f),f=e.find(b.$element.get(0),d.$id),f&&e.remove(f),c.$items.length){var j=$(g.toHtml(c,b.data)).get(0);e.append(b.$element.get(0),j)}if(d.$items.length){var k=$(g.toHtml(d,b.data)).get(0);e.append(b.$element.get(0),k)}h(b.$element,b)}},a.prototype.renderToolBox=function(a,b){return $(g.toHtml(a,b))},a.prototype.render=function(a){var b=this;return b.$element||(b.$element=b.renderToolBox(b.data,null),b.setDesignMode(b.options.design),h(b.$element,b)),a&&(b.options.beforeAdd&&b.options.beforeAdd(b.$element),b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},a.prototype._clearChildren=function(){},a.prototype._removeEvents=function(){var a=this;a.$element&&i(a.$element,a)},a.prototype.destroy=function(){var a=this;a._clearChildren(),a.$element&&(a._removeEvents(),a.$element=null),c.unlisten(a)},a.prototype.getItemById=function(a){if(!a)return null;var b=this;return b.map[a]},a.prototype._setListeners=function(){var a=this;c.listen("onAuthoringModeChanged",function(b){a.setDesignMode(b)},this),c.listen("onFormData",function(a){if(a.schema){var b=f.schema2Authoring(a.schema,a.locale);this.updateFieldItems(b)}},this)},a.prototype.setDesignMode=function(a){var b=this;b.options.design=a,b.$element&&(b.options.design?e.removeClass(b.$element.get(0),"bs-none"):e.addClass(b.$element.get(0),"bs-none"))},a}();b.ToolBox=j}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.design.min.js.map