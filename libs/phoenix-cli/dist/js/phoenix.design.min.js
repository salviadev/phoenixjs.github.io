var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=b,e=a.ipc,f=a.link,g=a.drag,h=a.utils,i=a.LayoutUtils,j=function(a,b,c){for(var d,e,f=a.target,g=null;f;){if(g=f.getAttribute("data-layout")){if(d=parseInt(f.getAttribute("data-level")||"1",10),e=c.getLayoutById(g),e&&i.canSelect(e,d)||(g=null),g)break}else if(g=f.getAttribute("data-render"))break;f=f===b?null:f.parentNode}return g},k=function(a){a.$idDesign=null,a.$idDrag=null,a.$idSelect=null,a.$idStep2=null,a.$idStep3=null},l=function(a,b,c,d,e){return e?(b.$items.splice(c,1),void(b.$type===i.LAYOUT_ROW?b.$items.length?delete b.$items[0].$colSize:(b.$type=i.LAYOUT_BLOCK,b.$origin=i.LAYOUT_ROW,k(b)):b.$type===i.LAYOUT_ACCORDION&&(b.$items.length||(b.$type=i.LAYOUT_BLOCK,delete b.$origin,k(b))))):void b.$items.splice(c,1)},m=function(a,b,c,d,e,f){if(!f)return c.$parentId=b.$id,void b.$items.splice(d,0,c);if(b.$origin===i.LAYOUT_ROW&&b.$type!==i.LAYOUT_ROW&&(delete b.$origin,b.$type=i.LAYOUT_ROW,k(b)),c.$parentId=b.$id,b.$type===i.LAYOUT_ROW)switch(c.$type===i.LAYOUT_BLOCK&&c.$origin===i.LAYOUT_ROW&&(c.$type=i.LAYOUT_ROW,delete c.$origin),c.$type){case i.LAYOUT_BLOCK:case i.LAYOUT_ACCORDION_GROUP:delete c.$origin,delete c.$type,k(c);break;case i.LAYOUT_COLUMN:e||(delete c.$colSize,delete c.$customColSize);break;default:var g={$items:[],$auto:!0};g.$items.push(c),c=g}else if(b.$type===i.LAYOUT_ACCORDION)switch(c.$type){case i.LAYOUT_ACCORDION_GROUP:break;case i.LAYOUT_BLOCK:c.$type=i.LAYOUT_ACCORDION_GROUP,k(c);break;case i.LAYOUT_COLUMN:delete c.$colSize,delete c.$customColSize,c.$type=i.LAYOUT_ACCORDION_GROUP,k(c);break;default:var g={$type:i.LAYOUT_ACCORDION_GROUP,$items:[],$auto:!0};g.$items.push(c),c=g}else switch(c.$type){case i.LAYOUT_COLUMN:case i.LAYOUT_ACCORDION_GROUP:delete c.$colSize,delete c.$customColSize,c.$type=i.LAYOUT_BLOCK,k(c),c.$auto&&(c=c.$items[0])}b.$items.splice(d,0,c)},n=function(a,b){for(var c=a.target;c;){if(c.hasAttribute("data-remove"))return!0;c=c===b?null:c.parentNode}return!1},o=function(a,b){for(var c=a.target;c;){if(c.hasAttribute("data-layout-detail"))return!0;c=c===b?null:c.parentNode}return!1},p=function(a){return a.originalEvent?a.originalEvent:a},q=function(a,b){if(!a)return null;var c,d,e,f,g,h;a.map&&(c=!0,d=a.map,a.map=null,e=a.fields,a.fields=null),b&&(f=a.$items,f&&(a.$items=[]),g=a.$render,a.$render=null),a.$config&&a.$config.datasets&&(h=a.$config.data?a.$config.data.ds:null,h&&delete a.$config.data.ds);var j=$.extend(!0,{},a);return c&&(a.map=d,a.fields=e,delete j.fields,delete j.map),b&&(a.$items=f,a.$render=g),h&&(a.$config.data.ds=h),i.clearMeta(j,!b),b&&delete j.$items,j},r=function(a,b,d,e){for(var f=[],g=a.childNodes,h=0,i=g.length;h<i;h++){var j=g[h],k=c.offset(j),l={position:e?k.left+(k.width>>1):k.top+(k.height>>1),ignore:j===b&&!e||3===j.nodeType||j.hasAttribute("data-remove")||j.hasAttribute("data-ignore"),placeHolder:j===d};f.push(l)}return f},s=function(a,b){var c=0;if(a.length){for(var d=0,e=a.length;d<e;d++){var f=a[d];if(!f.ignore&&b<f.position)return d;c=d+1}return c}return c},t=function(a,b,c,d){for(var e=0,f=0,g=a.childNodes.length;f<g;f++){var h=a.childNodes[f];if(3!==h.nodeType){if(h===b)return e;h!==c&&(d&&!h.hasAttribute("data-layout")||(d||h.hasAttribute("data-render"))&&e++)}}return 0},u=function(a){var b=a.nextSibling,c=a.previousSibling,d=0,e=5;c&&(d=b?b.offsetLeft-e:c.offsetLeft+c.offsetWidth-2*e),a.style.left=parseInt(d+"",10)+"px"},v=function(a,b,d,e,f,g,h,i){i&&(h.horizontal?c.addClass(e,"drop-target-col"):(e.style.removeProperty&&(e.style.removeProperty("height"),e.style.removeProperty("left")),c.removeClass(e,"drop-target-col")));var j=function(a){e.parentNode&&D(e),f.$type&&!a&&("column"===f.$type&&1===g?c.addClass(e,"col"):c.removeClass(e,"col"))},k=!0;if(b.length||(j(!1),c.append(a,e),k=!1),k){for(var l=-1,m=0,n=b.length;m<n;m++){var o=b[m];if(o.placeHolder){if(l=m,m===d||m===d-1)return!1}else if(o.ignore){if(m===d&&m+1<n&&b[m+1].placeHolder)return!1;if(m===d-1&&m>0&&b[m-1].placeHolder)return!1}}if(l<0||d>=b.length)j(l>=0),c.append(a,e);else{var p=a.childNodes[d];j(l>=0),c.before(p,e)}}return h.horizontal&&u(e),!0},w=function(a,b,d){if(d){for(var e=0,f=a.childNodes.length;e<f;e++)b?c.addClass(a.childNodes[e],"bs-none-drag"):c.removeClass(a.childNodes[e],"bs-none-drag");b?(c.addClass(a,"drag-source"),2===d&&c.removeClass(a,"auto")):(c.removeClass(a,"drag-source"),2===d&&c.addClass(a,"auto"))}},x=function(a,b,d,e,f,g,h){if(d){var j=h.$type===i.LAYOUT_COLUMN;b&&D(b),b=y(null,d,e,f,j),c.addClass(b,"drop-target"),j?(a.isColumn=1,h.$auto&&(a.isColumn=2),w(a.firstChild,!0,a.isColumn),c.before(a,b),u(b)):(c.addClass(a,"bs-none"),c.before(a,b))}else b=y(b,!1,e,f,!1),c.before(a,b),c.addClass(a,"bs-none");return b},y=function(a,b,c,d,e){return a&&D(a),a=document.createElement("div"),a.className="container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"+(c?" bs-island bs-field":"")+(d?" bs-island bs-widget":"")+(e?" drop-target-col":""),a},z=function(a){var b=document.createElement("div");return b.className="bs-drag-image",document.body.appendChild(b),b},A=function(a,b){if(a){var d=c.find(a.get(0),b.$idSelect||b.$idDrag);b.selected?c.addClass(d,"selected"):c.removeClass(d,"selected")}},B=function(a,b,d,f){if(b){var g=c.find(a,b.$idSelect||b.$idDrag);if(a!==g&&g)if(b.selected){var h=g.querySelector('div[data-remove="true"]');if(!h){var i=$('<div class="bs-rt-button" data-remove="true"><span class="'+c.iconClass("times-circle")+'"></span></div>').get(0),j=g.childNodes;j.length?c.before(j[0],i):c.append(g,i)}}else{var k=g.querySelector('div[data-remove="true"]');k&&c.remove(k)}}if(d){var l=q(b,!0);if(l&&delete l.$id,b&&b.$type){l.$type=b.$type,b.$items&&b.$items.length&&!b.$items[0].$bind||(l.onlyFields=!0);var m=f.getLayoutById(b.$parentId);m&&(l.parent=q(m,!0),l.parent.$type=m.$type)}e.emit("SelectedChanged",{type:b?b.$type?"layout":b.$config?"widget":"field":null,id:b?b.$id:null,data:l,control:f})}},C=function(a,b,c){c&&(a.off("click"),a.find('*[draggable="true"]').off("dragstart").add(a).off("dragend"),a.find('*[draggable="true"]').off("dragstart"),a.find(".drop-layouts-zone, .drop-fields-zone").add(a).off("dragover dragenter drop"))},D=function(a){c.remove(a)},E=function(a,b,d){if(d){var e,f,h,i,k,q,u=function(){setTimeout(function(){q=!1},0)},A=function(){q=!1,e&&(c.removeClass(e,"bs-none"),e.isColumn&&w(e.firstChild,!1,e.isColumn),e.isColumn=!1,e=null),i&&(D(i),i=null),f&&(c.remove(f),f=null),k=null,h=!1,g.setData(null)},B=function(e){var f=a.get(0);if(e){if(e.data===e.dst)return;var g,h,i,j,k=e.dst,n=e.data,o=c.find(f,n.$id),p=c.find(f,k.$idDesign),q=!1;if(n.$parentId===k.$id){if(i=e.dst,h=i.$items.indexOf(n),g=e.indexInParent,q=!0,g===h)return}else i=e.isNew?null:b.getLayoutById(n.$parentId),h=i?i.$items.indexOf(n):-1,g=e.indexInParent;if(h>=0&&l(b,i,h,q,e.isLayout),m(b,k,n,g,q,e.isLayout),e.isNew||e.isLayout)b.check(null);else{if(h>=0&&c.detach(o),g===k.$items.length-1?c.append(p,o):(j=c.find(f,k.$items[g+1].$id),c.before(j,o)),!k.$items[g].$bind){var r=[i];return k!==i&&r.push(k),C(a,b,d),E(a,b,d),void r.forEach(function(a){b._afterPropsChanged(a)})}b.check(null)}b.render()}};a.on("click",function(c){var d=j(c,a.get(0),b);return n(c,a.get(0))?void b.removeChild(d):o(c,a.get(0))?void b.authoringChild(d):void b.select(d)}),a.find('*[draggable="true"]').on("dragstart",function(d){d.stopPropagation();var i=!1,j=!0,k=!1,l=b.getLayoutById(this.getAttribute("data-layout"));if(l||(l=b.getFieldById(this.getAttribute("data-render")),k=null!=l.$config,i=!k,j=!1),!l)return d.preventDefault(),!1;l.selected&&b.select(null);var m=p(d).dataTransfer;m.effectAllowed="move",m.setData("Text","data"),j&&m.setDragImage&&(f=z(!0),m.setDragImage(f,0,0));var n=b.getLayoutById(l.$parentId);n&&n.$auto&&(l=n),g.setData({data:l,isLayout:j,isField:i,isWidget:k,isNew:!1}),e=c.find(a.get(0),l.$idDrag),h=!0}).add(a).on("dragend",function(a){return a.preventDefault(),a.stopPropagation(),A(),!1}),a.find(".drop-layouts-zone, .drop-fields-zone").add(a).on("dragover dragenter drop",function(a){var d=this,f=g.getData(),j=p(a),l=j.dataTransfer;if(a.stopPropagation(),q)return!0;if(!f||!f.isLayout&&!c.hasClass(d,"drop-fields-zone")||f.isLayout&&!c.hasClass(d,"drop-layouts-zone"))return l.effectAllowed="none",!0;if("drop"===a.type){a.preventDefault();var m=b.getLayoutById(d.getAttribute("data-layout")),n=d.getAttribute("data-level");return m?(f=g.getData(),f.dst=m,f.dstLevel=n,f.indexInParent=t(d,i,e,f.isLayout),g.setData(f),A(),B(f),!1):(A(),!1)}if(l.getData("Text"),h){if(!e)return;if(h=!1,!f.isNew)return q=!0,i=x(e,i,f.isLayout,f.isField,f.isWidget,b,f.data),u(),a.preventDefault(),!1}var o=b.getLayoutById(d.getAttribute("data-layout")),w=d.getAttribute("data-level");if(!i){if(!f.isNew)return!0;var z=b._canDropChild(f.data,o,w);if(!z)return l.effectAllowed="none",!0;k=r(d,e,i,z.horizontal);var C=s(k,z.horizontal?j.pageX:j.pageY);return i=y(i,f.isLayout,f.isField,f.isWidget,z.horizontal),v(d,k,C,i,o,w,z,f.isLayout),k=null,a.preventDefault(),!1}if("dragenter"===a.type&&(k=null),e===d)return l.effectAllowed="none",!0;var D=b._canDropChild(f.data,o,w);if(!D)return l.effectAllowed="none",!0;k||(k=r(d,e,i,D.horizontal));var E=s(k,D.horizontal?j.pageX:j.pageY);return v(d,k,E,i,o,w,D,f.isLayout)&&(k=null),a.preventDefault(),!1})}},F={_setDesignListeners:function(a){e.listen("onToolBoxDragend",function(){this.$element&&this.$element.trigger("dragend")},this),e.listen("onUpdateSelected",function(a){"layout"===a.type?this.updateLayout(a.id,a.data):this.updateField(a.id,a.data)},this),e.listen("onAuthoringModeChanged",function(a){this.setDesignMode(a)},this),e.listen("onSaveLayout",function(){if(this.saveHandler){var a=q(this.data,!1);this.saveHandler(a)}},this),e.listen("onNewLayout",function(a){if(this.createHandler){var b=q(this.data,!1);this.createHandler(a.name,b)}},this),e.listen("onLoadNestedLayouts",function(a){this.loadNestedHandler&&this.loadNestedHandler(a.data,a.after)},this),e.listen("onOpenLayout",function(a){this.openHandler&&this.openHandler(a.name)},this),e.listen("onRemoveLayout",function(){this.removeHandler&&this.removeHandler(this.data.name)},this),e.listen("onListLayout",function(a){this.listHandler&&this.listHandler(a)},this)},_afterCreate:function(){var a=this;a.options.form&&a.options.design&&h.nextTick(function(){e.emit("FormData",{schema:a.$schema,locale:a.$locale})})},authoringChild:function(a){var b=this,c=b.getLayoutById(a);if(c&&c.$ref)if(b.options.form){var d={name:c.$ref};c.$refProperty&&(d.path=c.$refProperty);var e=f.context();d.schema=e.$url.prototype?e.$url.prototype:b.data.name,d.locale=e.$url.locale?e.$url.locale:b.data.name,f.doFormAuthoring(d)}else f.doAuthoring(c.$ref,!0)},_removeEvents:function(){var a=this;C(a.$element,a,!0),a._removeBaseEvents()},_addEvents:function(){var a=this;E(a.$element,a,a.options.design),a._addBaseEvents()},_onSelectedChanged:function(a,b,c){var d=this;B(a,b,c,d)},_showSelected:function(a,b){A(a,b)},_canDropChild:function(a,b,c){var d=this;if(b&&b.$type&&b.$ref)return null;if(a.$type)return c=parseInt(c||"1",10),b&&a?b===a?null:d.isChildOf(a,b)?null:"row"===b.$type?{horizontal:!0}:{horizontal:!1}:null;if(a.$bind||a.$config){var e=b.$items.length;if(!e)return{horizontal:!1};for(var f=a.$bind?"$bind":"$config";e--;)if(!b.$items[e][f])return null;return{horizontal:!1}}return null},toString:function(a){var b=q(a||this.data,!1);return JSON.stringify(b)}};$.extend(d.Layout.prototype,F),$.extend(d.Form.prototype,F)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=layout.control.design.js.map
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.utils,e=c.ipc,f=c.ui,g=c.LayoutUtils,h=c.dom,i=function(){function a(a){this.$element=null,this.form=null,this.$id=d.allocID(),this.options=a||{},this.selected=null,this._setListeners()}return a.prototype._sendLayout=function(a){var b=this;b.selected&&b.selected.id&&d.nextTick(function(){var c=b._model2layout(a);c&&e.emit("UpdateSelected",{type:"layout",id:b.selected.id,data:c})})},a.prototype._updateFields=function(a){var b=this;b.selected&&b.selected.id&&(b.selected.data&&b.selected.data.$config?b.selected.data.$config=JSON.parse(a.options):b.selected.data=JSON.parse(a.options),d.nextTick(function(){e.emit("UpdateSelected",b.selected)}))},a.prototype._hasData=function(){return this.selected&&this.selected.type},a.prototype._setListeners=function(){e.listen("onSelectedChanged",function(a){var b=this;b.selected=a;var c=b.$element.get(0);if(!b._hasData())return void h.addClass(c,"bs-none");h.removeClass(c,"bs-none");var d="layout"===b.selected.type;if(b.$element){var e=a.data;e&&e.$config&&(e=e.$config),b._setJson(e,d)}},this),e.listen("onAuthoringModeChanged",function(a){this.setDesignMode(a)},this)},a.prototype._model2layout=function(a){var b=this,c=!1,d=b.selected.data,e={},f=a.childrenFlow;f===g.LAYOUT_BLOCK&&("column"===d.$type?f="column":d.$type===g.LAYOUT_ACCORDION_GROUP&&(f=g.LAYOUT_ACCORDION_GROUP));var h=f===g.LAYOUT_ACCORDION,i=f===g.LAYOUT_ACCORDION_GROUP,j=d.$origin||d.$type;f!==j&&(e.$type=f,c=!0);var j=d.$ref||d.$type;if(e.$ref=a.subLayoutName,c||(d.$ref||"")===(a.subLayoutName||"")||(c=!0),e.$refProperty=a.subPathSchema,c||(d.$refProperty||"")===(a.subPathSchema||"")||(c=!0),f===g.LAYOUT_BLOCK&&(e.$sticky=a.sticky,c||(d.$sticky||"")===(a.sticky||"")||(c=!0)),e.$refController=a.subController,c||(d.$refController||"")===(a.subController||"")||(c=!0),e.$style=a.style,c||(d.$style||"")===(a.style||"")||(c=!0),a.$states.colSize.isHidden||("column"===f?(a.colSize!==d.$colSize&&(e.$colSize=a.colSize,c=!0),(a.customColSize||"")!==(d.$customColSize||"")&&(e.$customColSize=a.customColSize,c=!0)):d.parent&&d.parent.$auto&&(a.colSize!==d.parent.$colSize&&(e.parent=e.parent||{},e.parent.$colSize=a.colSize,c=!0),(a.customColSize||"")!==(d.parent.$customColSize||"")&&(e.parent=e.parent||{},e.parent.$customColSize=a.customColSize,c=!0))),a.$states.showTitle.isHidden?d.$title&&(c=!0):a.showTitle?d.$title?(!d.$title.value!==a.title&&(c=!0,e.$title=e.$title||{},e.$title.value=a.title),i||(!d.$title.size!==a.titleSize&&(c=!0,e.$title=e.$title||{},e.$title.size=a.titleSize),!d.$title.style!==a.titleStyle&&(c=!0,e.$title=e.$title||{},e.$title.style=a.titleStyle))):(c=!0,e.$title={},e.$title.value=a.title,i||(e.$title.size=a.titleSize,e.$title.style=a.titleStyle)):d.$title&&(c=!0),h){var k=d.$widget,l=a.format===g.LAYOUT_ACCORDION?void 0:a.format;k!==l&&(c=!0),e.$widget=l}if(!a.$states.formType.isHidden){var m=a.formType,k=d.$inline?"inline":d.$fieldsOptions&&d.$fieldsOptions.columns?"horizontal":"block";if(e.$fieldsOptions={},m!==j)switch(c=!0,m){case g.LAYOUT_BLOCK:e.$inline=!1,e.$fieldsOptions.columns=!1;break;case"horizontal":e.$inline=!1,e.$fieldsOptions.columns=!0,e.$fieldsOptions.labelCol=a.labelCol;break;case"inline":e.$inline=!0,e.$fieldsOptions.columns=!1}else"horizontal"===m&&e.$fieldsOptions.labelCol!==a.labelCol&&(e.$fieldsOptions.labelCol=a.labelCol,c=!0);e.$fieldsOptions.labelCol&&3==e.$fieldsOptions.labelCol&&delete e.$fieldsOptions.labelCol;var n=!(!d.$fieldsOptions||!d.$fieldsOptions.titleIsHidden);n!==a.titleIsHidden&&(e.$fieldsOptions.titleIsHidden=a.titleIsHidden,c=!0)}return c?e:null},a.prototype._schemaFields=function(){return{links:{apply:{title:"Apply"}},properties:{options:{type:"string",format:"json"}}}},a.prototype._field2FormData=function(a){return{options:JSON.stringify(a,null,2)}},a.prototype._layoutFields=function(){return{name:d.allocID(),$type:g.LAYOUT_BLOCK,$items:[{$type:g.LAYOUT_BLOCK,$title:{value:"Properties"},$items:[{$bind:"options",options:{rows:5}}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},a.prototype._schemaLayout=function(){return{links:{apply:{title:"Apply"}},properties:{typeLayout:{type:"string"},showTitle:{title:"Show title",type:"boolean"},title:{type:"string",title:"Title"},titleSize:{type:"number",title:"Size",enum:[1,2,3,4,5,6],enumNames:["H1","H2","H3","H4","H5","H6"]},titleStyle:{type:"string",title:"Style"},childrenFlow:{type:"string",title:"Children disposition",enum:[g.LAYOUT_BLOCK,g.LAYOUT_ROW,g.LAYOUT_ACCORDION],enumNames:["Vertical Flow","Table cell","Accordion Group"],filters:{blockrow:[g.LAYOUT_BLOCK,"row"],onlyblock:[g.LAYOUT_BLOCK],accordion:[g.LAYOUT_ACCORDION]}},format:{type:"string",title:"Appearance",enum:[g.LAYOUT_ACCORDION,"tabs"],enumNames:["Accordion","Tabs"]},subLayoutName:{type:"string",title:"Nested Layout Name"},subPathSchema:{type:"string",title:"Bind for nested layout"},style:{type:"string",title:"Custom style"},subController:{type:"string",title:"Controller for nested form"},colSize:{type:"number",title:"Size",enum:[1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["08.33%","16.67%","25.00%","33.33%","41.37%","50.00%","58.33%","66.67%","75.00%","83.33%","91.33%","100.00%"]},customSize:{type:"string",title:"Custom size"},formType:{title:"Form Type",enum:[g.LAYOUT_BLOCK,"horizontal","inline"],enumNames:["Vertical Form","Horizontal Form","Inline form"],type:"string"},labelCol:{title:"Label width (Bootstrap cols)",enum:[1,2,3,4,5,6,7,8,9,10,11,12],type:"number"},sticky:{title:"Position",type:"string",enum:["","top","bottom"],enumNames:["Static","Sticky Top","Sticky Bottom"]},titleIsHidden:{title:"No titles",type:"boolean"}}}},a.prototype._layout2FormData=function(a){var b=this,c=a.$origin||a.$type,d=g.LAYOUT_BLOCK,e="onlyblock",f=a,h=c===g.LAYOUT_ACCORDION_GROUP,i=c===g.LAYOUT_ACCORDION,j=i?a.$widget||g.LAYOUT_ACCORDION:g.LAYOUT_ACCORDION,k=b.options.form&&(c===g.LAYOUT_BLOCK||"column"===c)||h,l=h||c===g.LAYOUT_BLOCK||"column"===c,m=k&&!!a.$title||h;h&&a.$title&&a.$title.size&&(a.$title.size=4),["column",g.LAYOUT_BLOCK,"row"].indexOf(c)>=0?("row"===c&&(d="row"),a.parent&&(e="blockrow")):c===g.LAYOUT_ACCORDION&&(e=g.LAYOUT_ACCORDION,d=g.LAYOUT_ACCORDION);var n=!1;("column"===c||a.parent&&a.parent.$auto&&"column"===a.parent.$type)&&(n=!0,f="column"===c?a:a.parent);var o=b.options.form&&a.onlyFields&&!a.$ref,p=a.$inline?"inline":a.$fieldsOptions&&a.$fieldsOptions.columns?"horizontal":g.LAYOUT_BLOCK;return{typeLayout:c,showTitle:m,title:a.$title&&a.$title.value?a.$title.value:"",titleSize:a.$title&&a.$title.size?a.$title.size:4,titleStyle:a.$title&&a.$title.style?a.$title.style:"",childrenFlow:d,colSize:a.$colSize||0,customSize:a.$customColSize,formType:p,format:j,subLayoutName:a.$ref,subPathSchema:a.$refProperty,subController:a.$refController,style:a.$style,labelCol:a.$fieldsOptions&&a.$fieldsOptions.labelCol?a.$fieldsOptions.labelCol:3,titleIsHidden:!(!a.$fieldsOptions||!a.$fieldsOptions.titleIsHidden),sticky:c===g.LAYOUT_BLOCK?a.$sticky||"":"",$states:{showTitle:{isHidden:!k,isDisabled:h},title:{isHidden:!k||!m},titleSize:{isHidden:!k||!m||h},titleStyle:{isHidden:!k||!m||h},colSize:{isHidden:!n},customSize:{isHidden:!n},childrenFlow:{filter:e},format:{isHidden:!i},formType:{isHidden:!o},labelCol:{isHidden:!o||"horizontal"!==p},titleIsHidden:{isHidden:!o},subLayoutName:{isHidden:!l},subPathSchema:{isHidden:!l||!b.options.form},subController:{isHidden:!l||!b.options.form},sticky:{isHidden:c!==g.LAYOUT_BLOCK}},$links:{apply:{isDisabled:!0}}}},a.prototype._emptyContent=function(){var a=this;a.form&&(f.removeForm(a.form),a.form=null),h.empty(a.$element.get(0))},a.prototype._layoutEdit=function(){return{name:d.allocID(),$type:g.LAYOUT_BLOCK,$items:[{$title:{value:"Title"},$bindState:"showTitle",$type:g.LAYOUT_BLOCK,$items:[{$bind:"showTitle"},{$bind:"title"},{$bind:"titleSize"},{$bind:"titleStyle"}]},{$type:g.LAYOUT_BLOCK,$title:{value:"Properties"},$items:[{$bind:"childrenFlow"},{$bind:"format"},{$bind:"sticky"},{$bind:"subLayoutName"},{$bind:"subPathSchema"},{$bind:"subController"},{$bind:"style"},{$bind:"colSize"},{$bind:"customSize"}]},{$type:g.LAYOUT_BLOCK,$bindState:"formType",$title:{value:"Children (Fields)"},$items:[{$bind:"formType"},{$bind:"labelCol"},{$bind:"titleIsHidden"}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},a.prototype._setJson=function(a,b){var c=this;c._emptyContent(),b?f.OpenForm(c.$element,c._layoutEdit(),c._schemaLayout(),c._layout2FormData(a),{},function(a,b,d){var e=!1;if("propchange"===a.operation){var f=b.typeLayout===g.LAYOUT_ACCORDION_GROUP;switch(a.property){case"showTitle":f||(b.$states.title.isHidden=!b.showTitle,b.$states.titleSize.isHidden=!b.showTitle,b.$states.titleStyle.isHidden=!b.showTitle,e=!0);break;case"formType":b.$states.labelCol.isHidden=b.$states.showTitle.isHidden||"horizontal"!==b.formType,e=!0;break;case"childrenFlow":case"colSize":if(!b.validate())return;c._sendLayout(b);break;case"subLayoutName":if(!b.validate())return;c._sendLayout(b);break;case"subPathSchema":if(!b.validate())return;b.subLayoutName?c._sendLayout(b):e=!0;break;default:e=!0}e&&(b.$links.apply.isDisabled=!1)}if("execute"===a.operation&&"$links.apply"===a.property){if(!b.validate())return;c._sendLayout(b)}},{},function(a){c.form=a}):f.OpenForm(c.$element,c._layoutFields(),c._schemaFields(),c._field2FormData(a),{},function(a,b,d){var e=!1;if("propchange"===a.operation){switch(a.property){default:e=!0}e&&(b.$links.apply.isDisabled=!1)}if("execute"===a.operation&&"$links.apply"===a.property){if(!b.validate())return;c._updateFields(b)}},{},function(a){c.form=a})},a.prototype.setDesignMode=function(a){this.options.design=a,this.$element&&(this.options.design&&this.selected?h.removeClass(this.$element.get(0),"bs-none"):h.addClass(this.$element.get(0),"bs-none"))},a.prototype.render=function(a){var b=this;return b.$element||(b.$element=$('<div id= "'+b.$id+'"></div>'),b.options.beforeAdd&&b.options.beforeAdd(b.$element)),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},a.prototype.destroy=function(){var a=this;a.form&&(a.form.destroy(),a.form=null),a.$element&&(a.$element=null),e.unlisten(a)},a}();b.PropertyEditor=i}(b=a.authpropedit||(a.authpropedit={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=propeditor.control.js.map
var Phoenix;!function(a){var b,c=a,d=c.utils,e=c.ipc,f=(c.drag,c.dom),g=c.ui,h=c.locale,i=c.pagecontrol;c.ulocale;!function(b){var j=function(a,b){var d=c.bootstrap4,e=[];return d?(e.push('<nav class="navbar navbar-dark bg-inverse" id="'+a+'">'),e.push('<a class="navbar-brand" href="#">'),e.push(h.layouts.design.AuthoringMode),e.push("</a>"),e.push('<form class="form-inline">')):(e.push('<nav class="navbar navbar-default" id="'+a+'">'),e.push('<div class="container-fluid">'),e.push('<div class="navbar-header">'),e.push('<a class="navbar-brand" href="#">'),e.push(h.layouts.design.AuthoringMode),e.push("</a>"),e.push("</div>"),e.push('<div class="collapse navbar-collapse">'),e.push('<form class="navbar-form navbar-left" role="search">')),e.push('<button type="button" class="btn btn-'+f.bootstrapStyles().secondary+(b.form?" bs-none":"")+'" id="'+a+'_new">'),e.push('<span class="'+f.iconClass("plus")+'" aria-hidden="false"></span> '),e.push(h.layouts.design.New),e.push("</button>&nbsp;"),e.push('<button type="button" class="btn btn-'+f.bootstrapStyles().secondary+(b.form?" bs-none":"")+'" id="'+a+'_open">'),e.push('<span class="'+f.iconClass("file-o")+'" aria-hidden="false"></span> '),e.push(h.layouts.design.Open.title),e.push("</button>&nbsp;"),e.push('<button type="button" class="btn btn-'+f.bootstrapStyles().secondary+(b.form?" bs-none":"")+'" id="'+a+'_remove">'),e.push('<span class="'+f.iconClass("times")+'" aria-hidden="false"></span> '),e.push(h.layouts.design.Delete),e.push("</button>&nbsp;"),e.push('<button type="button" class="btn btn-'+f.bootstrapStyles().secondary+'" id="'+a+'_save">'),e.push('<span class="'+f.iconClass("floppy")+'" aria-hidden="false"></span> '),e.push(h.layouts.design.Save),e.push("</button>&nbsp;"),d?(e.push('<label class="form-check-inline">'),e.push('<input class="form-check-input" type="checkbox" id="'+a+'_preview"'+(b.design?"":' checked="true"')+">&nbsp;&nbsp;"),e.push(h.layouts.design.Preview),e.push("</label>")):(e.push('<div class="checkbox">'),e.push("<label>"),e.push('<input type="checkbox" id="'+a+'_preview"'+(b.design?"":' checked="true"')+"> "),e.push(h.layouts.design.Preview),e.push("</label>"),e.push("</div>")),e.push("</form>"),d||e.push("</div>"),e.push("</nav>"),e.join("")},k=function(){function b(a){this.$element=null,this.$id=d.allocID(),this.options=a||{}}return b.prototype._removeEvents=function(){var a=this;a.$element.off("click")},b.prototype._setEvents=function(){var a=this;a.$element.get(0);a.$element.on("click",function(b){var c=!1;switch(b.target.id){case a.$id+"_save":e.emit("SaveLayout",null),c=!0;break;case a.$id+"_open":a._openExisting(),c=!0;break;case a.$id+"_remove":c=!0,d.confirm("",h.layouts.design.ConfirmDelete,function(){e.emit("RemoveLayout",null)});break;case a.$id+"_preview":var g=f.query(a.$element.get(0),"#"+a.$id+"_preview");e.emit("AuthoringModeChanged",!g.checked);break;case a.$id+"_new":c=!0,d.prompt(h.layouts.design.PageName,"",function(a){if(a=a.trim())return a.indexOf(" ")>=0?void alert(h.layouts.design.InvalidPageName):void e.emit("NewLayout",{name:a})});break;default:c=!1}return!c||(b.stopPropagation(),b.preventDefault(),!1)})},b.prototype._clearChildren=function(){},b.prototype._openExisting=function(){var a=this;e.emit("ListLayout",function(b){if(b&&b.files){for(var c=[],d=0;d<b.files.length;d++){var f=b.files[d];f!=i.Page().currentPage()&&c.push(f)}c.length&&a._openModal(c,function(a){e.emit("OpenLayout",{name:a})})}})},b.prototype._openModal=function(b,c){b.sort();var d={type:"object",properties:{page:{title:"Name",type:"string",enum:b}}},e={name:"open",$type:"block",$items:[{$bind:"page"}]},f={page:b[0]},i={title:h.layouts.design.Open.title,buttons:[{type:"default",title:h.layouts.design.Open.close,name:"cancel"},{type:"primary",title:h.layouts.design.Open.open,name:"ok"}]};g.OpenModalForm(i,e,d,f,a.locale,function(a,b,d,e){if("modal-action"===b.operation)switch(b.property){case"ok":var f=d.page;a.close(),c&&c(f);break;case"cancel":a.close()}})},b.prototype.render=function(a){var b=this;return b.$element||(b.$element=$(j(b.$id,b.options)),b._setEvents(),b.options.beforeAdd&&b.options.beforeAdd(b.$element)),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},b.prototype.destroy=function(){var a=this;a._clearChildren(),a.$element&&(a._removeEvents(),a.$element=null),e.unlisten(a)},b}();b.AuthoringToolBar=k}(b=a.authtoolbar||(a.authtoolbar={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=toolbar.authoring.control.js.map
var Phoenix;!function(a){var b;!function(b){function c(a,b){q(a,null,function(a,c,d){d&&j(a,c,b)})}function d(a,b){var c=[];return r(a,b,c),c.join("")}var e=a,f=e.utils,g=e.dom,h=e.build,i=e.locale,j=function(a,b,c){a.$id=a.$id||f.allocID(),b&&(a.$parentId=b.$id),a.$items&&(a.$contentId=a.$contentId||f.allocUuid()),c&&(c[a.$id]=a)},k=function(a,b,c,d){a.push('<div class="panel-group" id="accordion_expo" role="tablist" aria-multiselectable="true">')},l=function(a,b){a.push("</div>")},m=function(b,c,d,e){var f=a.bootstrap4;c.$typeItems=c.$typeItems||"layouts";var h,j;switch(c.$typeItems){case"layouts":j=c.$title||i.layouts.design.layouts,h="bars";break;case"widgets":j=c.$title||i.layouts.design.widgets,h="bars";break;case"actions":j=c.$title||i.layouts.design.actions,h="bars";break;default:j=c.$title||i.layouts.design.fields,h="bars"}b.push('<div class="'+(f?"card":"panel panel-default")+'" id="'+c.$id+'">'),b.push('<div class="'+(f?"card-header":"panel-heading")+'"  role="tab" id="'+c.$id+'_tab">'),f||b.push('<h3 class="panel-title">'),b.push('<a data-toggle="collapse" aria-expanded="'+(e?"true":"false")+'" draggable="false" data-parent="#accordion_expo" aria-controls="'+c.$id+'_tab" href="#'+c.$id+'_content"><span class="'+g.iconClass("bars")+'">'),b.push("</span>&nbsp;"),b.push(j),b.push("</a>"),f||b.push("</h3>"),b.push("</div>"),b.push('<div id="'+c.$id+'_content" class="panel-collapse collapse'+(e?" in":"")+'" role="tabpanel" aria-labelledby="'+c.$id+'_tab">'),b.push('<ul class="list-group">')},n=function(a,b){a.push("</ul></div></div>")},o=function(a,b,c,d){var e=["list-group-item bs-cursor-p"];if(b.data&&"widget"===b.data.$type&&"dev"!==h.authMode){var f=!0;"admin"===h.authMode?f=["admin","user"].indexOf(b.mode)<0:"user"===h.authMode&&(f="user"!==b.mode),f&&e.push("bs-none")}a.push('<li draggable="true" class="'+e.join(" ")+'" data-toolbox="'+b.$id+'" id="'+b.$id+'">'),a.push('<span class="'+g.iconClass("file-o")+'"></span>&nbsp;'),a.push(b.$title),a.push("</li>")},p=function(a,b){},q=function(a,b,c){a&&(c(a,b,!0),a.$items&&a.$items.forEach(function(b){q(b,a,c)}),c(a,b,!1))},r=function(a,b,c){var d=!0;q(a,b,function(a,b,e){var f=o,g=p;switch(a.$type){case"groups":f=k,g=l;break;case"group":e?m(c,a,b,d):n(c,a),g=null,f=null,d=!1;break;default:f=o,g=p}f&&g&&(e?f(c,a,b,!1):g(c,a))})};b.check=c,b.toHtml=d}(b=a.authtoolboxutils||(a.authtoolboxutils={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=toolbox.js.map
var Phoenix;!function(a){var b;!function(b){var c=a,d=(c.utils,c.dom),e=c.ipc,f=c.drag,g=(c.ulocale,c.Observable.SchemaUtils),h=c.authtoolboxutils,i=function(a,b){a.find('li[draggable="true"]').on("dragstart",function(a){a.stopPropagation();var c=b.getItemById($(this).attr("data-toolbox"));if(!c||!c.data)return a.preventDefault(),!1;var d=a.originalEvent?a.originalEvent.dataTransfer:a.dataTransfer;d.effectAllowed="move",d.setData("Text","Data");var e={isNew:!0,data:$.extend(!0,{},c.data.data),isLayout:!1,isField:!1,isWidget:!1};switch(c.data.$type){case"layout":e.isLayout=!0;break;case"field":e.isField=!0;break;case"widget":e.isWidget=!0}f.setData(e)}).on("dragend",function(a){return e.emit("ToolBoxDragend",null),f.setData(null),a.preventDefault(),a.stopPropagation(),!1})},j=function(a,b){a.find('li[draggable="true"]').off("dragstart dragend")},k=function(){function a(a,b){var c=this;c.$element=null,c.map={},c.options=b||{},a=a||{},a.$type=a.$type||"groups",h.check(a,c.map),c.data=a,c._setListeners()}return a.prototype.updateFieldItems=function(a){var b=this,c=b.data.$items.find(function(a){return"fields"===a.$typeItems}),e=b.data.$items.find(function(a){return"actions"===a.$typeItems});if(c||(c={$type:"group",$typeItems:"fields",$items:[]},b.data.$items.push(c)),e||(e={$type:"group",$typeItems:"actions",$items:[]},b.data.$items.push(e)),c.$items=[],e.$items=[],a.forEach(function(a){var b={$type:"item",$title:a.$title,data:{$type:"field",data:{$bind:a.$bind,$widget:a.$widget,options:a.options}}};"field"===a.$type?c.$items.push(b):e.$items.push(b)}),b.map={},h.check(b.data,b.map),b.$element){var f=b.$element.get(0);j(b.$element,b);var g=d.find(f,c.$id);if(g&&d.remove(g),g=d.find(f,e.$id),g&&d.remove(g),c.$items.length){var k=$(h.toHtml(c,b.data)).get(0);d.append(f,k)}if(e.$items.length){var l=$(h.toHtml(e,b.data)).get(0);d.append(f,l)}i(b.$element,b)}},a.prototype.renderToolBox=function(a,b){return $(h.toHtml(a,b))},a.prototype.render=function(a){var b=this;return b.$element||(b.$element=b.renderToolBox(b.data,null),i(b.$element,b)),a&&(b.options.beforeAdd&&b.options.beforeAdd(b.$element),b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},a.prototype._clearChildren=function(){},a.prototype._removeEvents=function(){var a=this;a.$element&&j(a.$element,a)},a.prototype.destroy=function(){var a=this;a._clearChildren(),a.$element&&(a._removeEvents(),a.$element=null),e.unlisten(a)},a.prototype.getItemById=function(a){if(!a)return null;var b=this;return b.map[a]},a.prototype._setListeners=function(){e.listen("onFormData",function(a){if(a.schema){var b=g.schema2Authoring(a.schema,a.schema,a.locale);this.updateFieldItems(b)}},this)},a}();b.ToolBox=k}(b=a.authtoolbox||(a.authtoolbox={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=toolbox.control.js.map
var Phoenix;!function(a){function b(a,b){var c=['<div class="container-fluid">'];return c.push('<div id="nav_{0}"></div>'),c.push('<div class="row design-table">'),c.push('<div style="width:100%">'),c.push('<div id="content"></div>'),c.push("</div>"),c.push('<div id="toolbox_parent_{0}" style="width:300px">'),c.push('<div id="toolbox_{0}"></div>'),c.push("</div>"),c.push("</div>"),c.push('<div id="editor_{0}"></div>'),c.push("</div>"),e.format(c.join(""),a)}var c,d=a,e=d.utils,f=d.ipc,g=d.dom;d.authtoolbar,d.authtoolbox,d.authpropedit;!function(c){var d=function(){function c(b,c){var d=this;d.options=b,d.id=e.allocID(),d._pe=new a.authpropedit.PropertyEditor(b),d._toolBar=new a.authtoolbar.AuthoringToolBar(b),d._toolBox=new a.authtoolbox.ToolBox(c,b),d._setListeners()}return c.prototype.render=function(a){var c=this;if(!c.$element){c.$element=$(b(c.id,c.options));var d=c.$element.get(0);c.options.beforeAdd&&c.options.beforeAdd(c.$element),c._pe.render($(g.find(d,"editor_"+c.id))),c._toolBar.render($(g.find(d,"nav_"+c.id))),c._toolBox.render($(g.find(d,"toolbox_"+c.id))),c.setDesignMode(c.options.design)}return a&&(c.options.replaceParent?a.replaceWith(c.$element):a.append(c.$element)),c.$element},c.prototype._setListeners=function(){var a=this;f.listen("onAuthoringModeChanged",function(b){a.setDesignMode(b)},this)},c.prototype.setDesignMode=function(a){var b=this;if(b.options.design=a,b.$element){var c=g.find(b.$element.get(0),"toolbox_parent_"+b.id);c&&(b.options.design?g.removeClass(c,"bs-none"):g.addClass(c,"bs-none"))}},c.prototype.destroy=function(){var a=this;a.$element&&(a.$element=null),a._pe&&(a._pe.destroy(),a._pe=null),a._pe&&(a._pe.destroy(),a._pe=null),f.unlisten(a)},c}();c.AuthoringEditor=d}(c=a.authoring||(a.authoring={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.design.min.js.map