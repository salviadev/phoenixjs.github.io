var Phoenix;!function(e){!function(t){var i=e.dom,n=t,o=e.ipc,a=e.link,s=e.drag,l=e.utils,r=e.layoutUtils,d=function(e,t,i){for(var n,o,a=e.target,s=null;a;){if(s=a.getAttribute("data-layout")){if(n=parseInt(a.getAttribute("data-level")||"1",10),(o=i.getLayoutById(s))&&r.canSelect(o,n)||(s=null),s)break}else if(s=a.getAttribute("data-render"))break;a=a===t?null:a.parentNode}return s},u=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},p=function(e,t,i,n,o){o?(t.$items.splice(i,1),t.$type===r.LAYOUT_ROW?t.$items.length?delete t.$items[0].$colSize:(t.$type=r.LAYOUT_BLOCK,t.$origin=r.LAYOUT_ROW,u(t)):t.$type===r.LAYOUT_ACCORDION&&(t.$items.length||(t.$type=r.LAYOUT_BLOCK,delete t.$origin,u(t)))):t.$items.splice(i,1)},c=function(e,t,i,n,o,a){if(!a)return i.$parentId=t.$id,void t.$items.splice(n,0,i);if(t.$origin===r.LAYOUT_ROW&&t.$type!==r.LAYOUT_ROW&&(delete t.$origin,t.$type=r.LAYOUT_ROW,u(t)),i.$parentId=t.$id,t.$type===r.LAYOUT_ROW)switch(i.$type===r.LAYOUT_BLOCK&&i.$origin===r.LAYOUT_ROW&&(i.$type=r.LAYOUT_ROW,delete i.$origin),i.$type){case r.LAYOUT_BLOCK:case r.LAYOUT_ACCORDION_GROUP:delete i.$origin,delete i.$type,u(i);break;case r.LAYOUT_COLUMN:o||(delete i.$colSize,delete i.$customColSize);break;default:(s={$items:[],$auto:!0}).$items.push(i),i=s}else if(t.$type===r.LAYOUT_ACCORDION)switch(i.$type){case r.LAYOUT_ACCORDION_GROUP:break;case r.LAYOUT_BLOCK:i.$type=r.LAYOUT_ACCORDION_GROUP,u(i);break;case r.LAYOUT_COLUMN:delete i.$colSize,delete i.$customColSize,i.$type=r.LAYOUT_ACCORDION_GROUP,u(i);break;default:var s={$type:r.LAYOUT_ACCORDION_GROUP,$items:[],$auto:!0};s.$items.push(i),i=s}else switch(i.$type){case r.LAYOUT_COLUMN:case r.LAYOUT_ACCORDION_GROUP:delete i.$colSize,delete i.$customColSize,i.$type=r.LAYOUT_BLOCK,u(i),i.$auto&&(i=i.$items[0])}t.$items.splice(n,0,i)},f=function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-remove"))return!0;i=i===t?null:i.parentNode}return!1},m=function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-layout-detail"))return!0;i=i===t?null:i.parentNode}return!1},y=function(e){return e.originalEvent?e.originalEvent:e},h=function(e,t){if(!e)return null;var i,n,o,a,s,l;e.map&&(i=!0,n=e.map,e.map=null,o=e.fields,e.fields=null),t&&((a=e.$items)&&(e.$items=[]),s=e.$render,e.$render=null),e.$config&&e.$config.datasets&&(l=e.$config.data?e.$config.data.ds:null)&&delete e.$config.data.ds;var d=$.extend(!0,{},e);return i&&(e.map=n,e.fields=o,delete d.fields,delete d.map),t&&(e.$items=a,e.$render=s),l&&(e.$config.data.ds=l),r.clearMeta(d,!t),t&&delete d.$items,d},g=function(e,t,n,o){for(var a=[],s=e.childNodes,l=0,r=s.length;l<r;l++){var d=s[l],u=i.offset(d),p={position:o?u.left+(u.width>>1):u.top+(u.height>>1),ignore:d===t&&!o||3===d.nodeType||d.hasAttribute("data-remove")||d.hasAttribute("data-ignore"),placeHolder:d===n};a.push(p)}return a},b=function(e,t){var i=0;if(e.length){for(var n=0,o=e.length;n<o;n++){var a=e[n];if(!a.ignore&&t<a.position)return n;i=n+1}return i}return i},v=function(e,t,i,n){for(var o=0,a=0,s=e.childNodes.length;a<s;a++){var l=e.childNodes[a];if(3!==l.nodeType){if(l===t)return o;l!==i&&(n&&!l.hasAttribute("data-layout")||(n||l.hasAttribute("data-render"))&&o++)}}return 0},O=function(e){var t=e.nextSibling,i=e.previousSibling,n=0;i&&(n=t?t.offsetLeft-5:i.offsetLeft+i.offsetWidth-10),e.style.left=parseInt(n+"",10)+"px"},C=function(e,t,n,o,a,s,l,r){r&&(l.horizontal?i.addClass(o,"drop-target-col"):(o.style.removeProperty&&(o.style.removeProperty("height"),o.style.removeProperty("left")),i.removeClass(o,"drop-target-col")));var d=function(e){o.parentNode&&w(o),a.$type&&!e&&("column"===a.$type&&1===s?i.addClass(o,"col"):i.removeClass(o,"col"))},u=!0;if(t.length||(d(!1),i.append(e,o),u=!1),u){for(var p=-1,c=0,f=t.length;c<f;c++){var $=t[c];if($.placeHolder){if(p=c,c===n||c===n-1)return!1}else if($.ignore){if(c===n&&c+1<f&&t[c+1].placeHolder)return!1;if(c===n-1&&c>0&&t[c-1].placeHolder)return!1}}if(p<0||n>=t.length)d(p>=0),i.append(e,o);else{var m=e.childNodes[n];d(p>=0),i.before(m,o)}}return l.horizontal&&O(o),!0},_=function(e,t,n){if(n){for(var o=0,a=e.childNodes.length;o<a;o++)t?i.addClass(e.childNodes[o],"bs-none-drag"):i.removeClass(e.childNodes[o],"bs-none-drag");t?(i.addClass(e,"drag-source"),2===n&&i.removeClass(e,"auto")):(i.removeClass(e,"drag-source"),2===n&&i.addClass(e,"auto"))}},L=function(e,t,n,o,a,s,l){if(n){var d=l.$type===r.LAYOUT_COLUMN;t&&w(t),t=A(null,n,o,a,d),i.addClass(t,"drop-target"),d?(e.isColumn=1,l.$auto&&(e.isColumn=2),_(e.firstChild,!0,e.isColumn),i.before(e,t),O(t)):(i.addClass(e,"bs-none"),i.before(e,t))}else t=A(t,!1,o,a,!1),i.before(e,t),i.addClass(e,"bs-none");return t},A=function(e,t,i,n,o){return e&&w(e),e=document.createElement("div"),e.className="container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"+(i?" bs-island bs-field":"")+(n?" bs-island bs-widget":"")+(o?" drop-target-col":""),e},T=function(e){var t=document.createElement("div");return t.className="bs-drag-image",document.body.appendChild(t),t},S=function(e,t){if(e){var n=i.find(e.get(0),t.$idSelect||t.$idDrag);t.selected?i.addClass(n,"selected"):i.removeClass(n,"selected")}},D=function(e,t,n,a){if(t){var s=i.find(e,t.$idSelect||t.$idDrag);if(e!==s&&s)if(t.selected){if(!s.querySelector('div[data-remove="true"]')){var l=$('<div class="bs-rt-button" data-remove="true"><span class="'+i.iconClass("times-circle")+'"></span></div>').get(0),r=s.childNodes;r.length?i.before(r[0],l):i.append(s,l)}}else{var d=s.querySelector('div[data-remove="true"]');d&&i.remove(d)}}if(n){var u=h(t,!0);if(u&&delete u.$id,t&&t.$type){u.$type=t.$type,t.$items&&t.$items.length&&!t.$items[0].$bind||(u.onlyFields=!0);var p=a.getLayoutById(t.$parentId);p&&(u.parent=h(p,!0),u.parent.$type=p.$type)}o.emit("SelectedChanged",{type:t?t.$type?"layout":t.$config?"widget":"field":null,id:t?t.$id:null,data:u,control:a})}},U=function(e,t,i){i&&(e.off("click"),e.find('*[draggable="true"]').off("dragstart").add(e).off("dragend"),e.find('*[draggable="true"]').off("dragstart"),e.find(".drop-layouts-zone, .drop-fields-zone").add(e).off("dragover dragenter drop"))},w=function(e){i.remove(e)},I=function(e,t,n){if(n){var o,a,l,r,u,$,h=function(){setTimeout(function(){$=!1},0)},O=function(){$=!1,o&&(i.removeClass(o,"bs-none"),o.isColumn&&_(o.firstChild,!1,o.isColumn),o.isColumn=!1,o=null),r&&(w(r),r=null),a&&(i.remove(a),a=null),u=null,l=!1,s.setData(null)},S=function(o){var a=e.get(0);if(o){if(o.data===o.dst)return;var s,l,r,d,u=o.dst,f=o.data,$=i.find(a,f.$id),m=i.find(a,u.$idDesign),y=!1;if(f.$parentId===u.$id){if(r=o.dst,l=r.$items.indexOf(f),s=o.indexInParent,y=!0,s===l)return}else l=(r=o.isNew?null:t.getLayoutById(f.$parentId))?r.$items.indexOf(f):-1,s=o.indexInParent;if(l>=0&&p(0,r,l,0,o.isLayout),c(0,u,f,s,y,o.isLayout),o.isNew||o.isLayout)t.check(null);else{if(l>=0&&i.detach($),s===u.$items.length-1?i.append(m,$):(d=i.find(a,u.$items[s+1].$id),i.before(d,$)),!u.$items[s].$bind){var h=[r];return u!==r&&h.push(u),U(e,0,n),I(e,t,n),void h.forEach(function(e){t._afterPropsChanged(e)})}t.check(null)}t.render()}};e.on("click",function(i){var n=d(i,e.get(0),t);f(i,e.get(0))?t.removeChild(n):m(i,e.get(0))?t.authoringChild(n):t.select(n)}),e.find('*[draggable="true"]').on("dragstart",function(n){n.stopPropagation();var r=!1,d=!0,u=!1,p=t.getLayoutById(this.getAttribute("data-layout"));if(p||(r=!(u=null!=(p=t.getFieldById(this.getAttribute("data-render"))).$config),d=!1),!p)return n.preventDefault(),!1;p.selected&&t.select(null);var c=y(n).dataTransfer;c.effectAllowed="move",c.setData("Text","data"),d&&c.setDragImage&&(a=T(),c.setDragImage(a,0,0));var f=t.getLayoutById(p.$parentId);f&&f.$auto&&(p=f),s.setData({data:p,isLayout:d,isField:r,isWidget:u,isNew:!1}),o=i.find(e.get(0),p.$idDrag),l=!0}).add(e).on("dragend",function(e){return e.preventDefault(),e.stopPropagation(),O(),!1}),e.find(".drop-layouts-zone, .drop-fields-zone").add(e).on("dragover dragenter drop",function(e){var n=this,a=s.getData(),d=y(e),p=d.dataTransfer;if(e.stopPropagation(),$)return!0;if(!a||!a.isLayout&&!i.hasClass(n,"drop-fields-zone")||a.isLayout&&!i.hasClass(n,"drop-layouts-zone"))return p.effectAllowed="none",!0;if("drop"===e.type){e.preventDefault();var c=t.getLayoutById(n.getAttribute("data-layout")),f=n.getAttribute("data-level");return c?(a=s.getData(),a.dst=c,a.dstLevel=f,a.indexInParent=v(n,r,o,a.isLayout),s.setData(a),O(),S(a),!1):(O(),!1)}if(p.getData("Text"),l){if(!o)return;if(l=!1,!a.isNew)return $=!0,r=L(o,r,a.isLayout,a.isField,a.isWidget,0,a.data),h(),e.preventDefault(),!1}var m=t.getLayoutById(n.getAttribute("data-layout")),_=n.getAttribute("data-level");if(!r){if(!a.isNew)return!0;var T=t._canDropChild(a.data,m,_);if(!T)return p.effectAllowed="none",!0;u=g(n,o,r,T.horizontal);var D=b(u,T.horizontal?d.pageX:d.pageY);return r=A(r,a.isLayout,a.isField,a.isWidget,T.horizontal),C(n,u,D,r,m,_,T,a.isLayout),u=null,e.preventDefault(),!1}if("dragenter"===e.type&&(u=null),o===n)return p.effectAllowed="none",!0;var U=t._canDropChild(a.data,m,_);if(!U)return p.effectAllowed="none",!0;u||(u=g(n,o,r,U.horizontal));var w=b(u,U.horizontal?d.pageX:d.pageY);return C(n,u,w,r,m,_,U,a.isLayout)&&(u=null),e.preventDefault(),!1})}},z={_setDesignListeners:function(e){o.listen("onToolBoxDragend",function(){this.$element&&this.$element.trigger("dragend")},this),o.listen("onUpdateSelected",function(e){"layout"===e.type?this.updateLayout(e.id,e.data):this.updateField(e.id,e.data)},this),o.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this),o.listen("onSaveLayout",function(){if(this.saveHandler){var e=h(this.data,!1);this.saveHandler(e)}},this),o.listen("onNewLayout",function(e){if(this.createHandler){var t=h(this.data,!1);this.createHandler(e.name,t)}},this),o.listen("onLoadNestedLayouts",function(e){this.loadNestedHandler&&this.loadNestedHandler(e.data,e.after)},this),o.listen("onOpenLayout",function(e){this.openHandler&&this.openHandler(e.name)},this),o.listen("onRemoveLayout",function(){this.removeHandler&&this.removeHandler()},this),o.listen("onListLayout",function(e){this.listHandler&&this.listHandler(e)},this)},_afterCreate:function(){var e=this;e.options.form&&e.options.design&&l.nextTick(function(){o.emit("FormData",{schema:e.$schema,locale:e.$locale})})},authoringChild:function(e){var t=this,i=t.getLayoutById(e);if(i&&i.$ref)if(t.options.form){var n={name:i.$ref};i.$refProperty&&(n.path=i.$refProperty);var o=a.context();n.schema=o.$url.prototype?o.$url.prototype:t.data.name,n.locale=o.$url.locale?o.$url.locale:t.data.name,a.doFormAuthoring(n)}else a.doAuthoring(i.$ref,!0)},_removeEvents:function(){var e=this;U(e.$element,0,!0),e._removeBaseEvents()},_addEvents:function(){var e=this;I(e.$element,e,e.options.design),e._addBaseEvents()},_onSelectedChanged:function(e,t,i){D(e,t,i,this)},_showSelected:function(e,t){S(e,t)},_canDropChild:function(e,t,i){var n=this;if(t&&t.$type&&t.$ref)return null;if(e.$type)return i=parseInt(i||"1",10),t&&e?t===e?null:n.isChildOf(e,t)?null:"row"===t.$type?{horizontal:!0}:{horizontal:!1}:null;if(e.$bind||e.$config){var o=t.$items.length;if(!o)return{horizontal:!1};for(var a=e.$bind?"$bind":"$config";o--;)if(!t.$items[o][a])return null;return{horizontal:!1}}return null},toString:function(e){var t=h(e||this.data,!1);return JSON.stringify(t)}};$.extend(n.Layout.prototype,z),$.extend(n.Form.prototype,z)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var i=e,n=i.utils,o=i.ipc,a=i.locale,s=i.ui,l=i.layoutUtils,r=i.dom,d=function(){function e(e){this.$element=null,this.form=null,this.$id=n.allocID(),this.options=e||{},this.selected=null,this._setListeners()}return e.prototype._sendLayout=function(e){var t=this;t.selected&&t.selected.id&&n.nextTick(function(){var i=t._model2layout(e);i&&o.emit("UpdateSelected",{type:"layout",id:t.selected.id,data:i})})},e.prototype._updateFields=function(e){var t=this;t.selected&&t.selected.id&&(t.selected.data&&t.selected.data.$config?t.selected.data.$config=JSON.parse(e.options):t.selected.data=JSON.parse(e.options),n.nextTick(function(){o.emit("UpdateSelected",t.selected)}))},e.prototype._hasData=function(){return this.selected&&this.selected.type},e.prototype._setListeners=function(){o.listen("onSelectedChanged",function(e){var t=this;t.selected=e;var i=t.$element.get(0);if(t._hasData()){r.removeClass(i,"bs-none");var n="layout"===t.selected.type;if(t.$element){var o=e.data;o&&o.$config&&(o=o.$config),t._setJson(o,n)}}else r.addClass(i,"bs-none")},this),o.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this)},e.prototype._model2layout=function(e){var t=!1,i=this.selected.data,n={},o=e.childrenFlow;o===l.LAYOUT_BLOCK&&("column"===i.$type?o="column":i.$type===l.LAYOUT_ACCORDION_GROUP&&(o=l.LAYOUT_ACCORDION_GROUP));var a=o===l.LAYOUT_ACCORDION,s=o===l.LAYOUT_ACCORDION_GROUP;o!==(r=i.$origin||i.$type)&&(n.$type=o,t=!0);var r=i.$ref||i.$type;n.$ref=e.subLayoutName,t||(i.$ref||"")===(e.subLayoutName||"")||(t=!0),n.$refProperty=e.subPathSchema,t||(i.$refProperty||"")===(e.subPathSchema||"")||(t=!0),n.$forceTable=e.forceTable,t||(i.$forceTable||!1)===(e.forceTable||!1)||(t=!0),n.$name=e.name,t||(i.$name||"")===(e.name||"")||(t=!0),o===l.LAYOUT_BLOCK&&(n.$sticky=e.sticky,t||(i.$sticky||"")===(e.sticky||"")||(t=!0)),n.$refController=e.subController,t||(i.$refController||"")===(e.subController||"")||(t=!0),n.$style=e.style,t||(i.$style||"")===(e.style||"")||(t=!0);var d=o===l.LAYOUT_ACCORDION&&"none"===e.format?e.bindPages:void 0;if(n.$bindPages=d,i.$bindPages!==d&&(t=!0),e.$states.colSize.isHidden||("column"===o?(e.colSize!==i.$colSize&&(n.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.$customColSize||"")&&(n.$customColSize=e.customColSize,t=!0)):i.parent&&i.parent.$auto&&(e.colSize!==i.parent.$colSize&&(n.parent=n.parent||{},n.parent.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.parent.$customColSize||"")&&(n.parent=n.parent||{},n.parent.$customColSize=e.customColSize,t=!0))),e.$states.showTitle.isHidden?i.$title&&(t=!0):e.showTitle?i.$title?(!i.$title.value!==e.title&&(t=!0,n.$title=n.$title||{},n.$title.value=e.title),s||(!i.$title.size!==e.titleSize&&(t=!0,n.$title=n.$title||{},n.$title.size=e.titleSize),!i.$title.style!==e.titleStyle&&(t=!0,n.$title=n.$title||{},n.$title.style=e.titleStyle))):(t=!0,n.$title={},n.$title.value=e.title,s||(n.$title.size=e.titleSize,n.$title.style=e.titleStyle)):i.$title&&(t=!0),a){var u=i.$widget,p=e.format===l.LAYOUT_ACCORDION?void 0:e.format;u!==p&&(t=!0),n.$widget=p}if(!e.$states.formType.isHidden){var c=e.formType,u=i.$inline?"inline":i.$fieldsOptions&&i.$fieldsOptions.columns?"horizontal":"block";if(n.$fieldsOptions={},c!==r)switch(t=!0,c){case l.LAYOUT_BLOCK:n.$inline=!1,n.$fieldsOptions.columns=!1;break;case"horizontal":n.$inline=!1,n.$fieldsOptions.columns=!0,n.$fieldsOptions.labelCol=e.labelCol;break;case"inline":n.$inline=!0,n.$fieldsOptions.columns=!1}else"horizontal"===c&&n.$fieldsOptions.labelCol!==e.labelCol&&(n.$fieldsOptions.labelCol=e.labelCol,t=!0);n.$fieldsOptions.labelCol&&3==n.$fieldsOptions.labelCol&&delete n.$fieldsOptions.labelCol,!(!i.$fieldsOptions||!i.$fieldsOptions.titleIsHidden)!==e.titleIsHidden&&(n.$fieldsOptions.titleIsHidden=e.titleIsHidden,t=!0)}return t?n:null},e.prototype._schemaFields=function(){return{links:{apply:{title:a.layouts.design.actionApply}},properties:{options:{type:"string",format:"json"}}}},e.prototype._field2FormData=function(e){return{options:JSON.stringify(e,null,2)}},e.prototype._layoutFields=function(){return{name:n.allocID(),$type:l.LAYOUT_BLOCK,$items:[{$type:l.LAYOUT_BLOCK,$title:{value:a.layouts.design.properties},$items:[{$bind:"options",options:{rows:5}}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._schemaLayout=function(){return{links:{apply:{title:a.layouts.design.actionApply}},properties:{typeLayout:{type:"string"},forceTable:{title:a.layouts.design.forceDisplayTable,type:"boolean"},name:{title:a.layouts.design.name,type:"string"},showTitle:{title:a.layouts.design.showTitle,type:"boolean"},title:{type:"string",title:a.layouts.design.Title},bindPages:{type:"string",title:a.layouts.design.bindPagesTitle},titleSize:{type:"number",title:"Size",enum:[1,2,3,4,5,6],enumNames:["H1","H2","H3","H4","H5","H6"]},titleStyle:{type:"string",title:"Style"},childrenFlow:{type:"string",title:a.layouts.design.childrenFlow,enum:[l.LAYOUT_BLOCK,l.LAYOUT_ROW,l.LAYOUT_ACCORDION],enumNames:[a.layouts.design.childrenFlowVertical,a.layouts.design.childrenTableCell,a.layouts.design.childrenAccordionGroup],filters:{blockrow:[l.LAYOUT_BLOCK,l.LAYOUT_ROW],onlyblock:[l.LAYOUT_BLOCK],accordion:[l.LAYOUT_ACCORDION]}},format:{type:"string",title:a.layouts.design.appearance,enum:[l.LAYOUT_ACCORDION,"tabs","none"],enumNames:[a.layouts.design.appearanceAccordion,a.layouts.design.appearanceTabs,a.layouts.design.appearanceWizard]},subLayoutName:{type:"string",title:a.layouts.design.nestedLayoutName},subPathSchema:{type:"string",title:a.layouts.design.nestedLayoutBind},subController:{type:"string",title:a.layouts.design.nestedFormController},style:{type:"string",title:a.layouts.design.customStyle},colSize:{type:"number",title:a.layouts.design.columnSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["08.33%","16.67%","25.00%","33.33%","41.37%","50.00%","58.33%","66.67%","75.00%","83.33%","91.33%","100.00%"]},customSize:{type:"string",title:a.layouts.design.customColumnSize},formType:{title:a.layouts.design.formType,enum:[l.LAYOUT_BLOCK,"horizontal","inline"],enumNames:[a.layouts.design.ftVertical,a.layouts.design.ftHorizontal,a.layouts.design.ftInline],type:"string"},labelCol:{title:a.layouts.design.labelSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],type:"number"},sticky:{title:a.layouts.design.blockPosition,type:"string",enum:["","top","bottom"],enumNames:[a.layouts.design.bpStatic,a.layouts.design.bpStickyTop,a.layouts.design.bpStickyBottom]},titleIsHidden:{title:a.layouts.design.noTitlesForFields,type:"boolean"}}}},e.prototype._layout2FormData=function(e){var t=this,i=e.$origin||e.$type,n=l.LAYOUT_BLOCK,o="onlyblock",a=i===l.LAYOUT_ACCORDION_GROUP,s=i===l.LAYOUT_ACCORDION,r=s?e.$widget||l.LAYOUT_ACCORDION:l.LAYOUT_ACCORDION,d=t.options.form&&(i===l.LAYOUT_BLOCK||"column"===i)||a,u=a||i===l.LAYOUT_BLOCK||"column"===i,p=d&&!!e.$title||a;a&&e.$title&&e.$title.size&&(e.$title.size=4),["column",l.LAYOUT_BLOCK,"row"].indexOf(i)>=0?("row"===i&&(n="row"),e.parent&&(o="blockrow")):i===l.LAYOUT_ACCORDION&&(o=l.LAYOUT_ACCORDION,n=l.LAYOUT_ACCORDION);var c=!1;("column"===i||e.parent&&e.parent.$auto&&"column"===e.parent.$type)&&(c=!0,"column"===i||e.parent);var f=t.options.form&&e.onlyFields&&!e.$ref,$=e.$inline?"inline":e.$fieldsOptions&&e.$fieldsOptions.columns?"horizontal":l.LAYOUT_BLOCK;return{typeLayout:i,showTitle:p,name:e.$name,title:e.$title&&e.$title.value?e.$title.value:"",titleSize:e.$title&&e.$title.size?e.$title.size:4,titleStyle:e.$title&&e.$title.style?e.$title.style:"",childrenFlow:n,bindPages:e.$bindPages,colSize:e.$colSize||0,customSize:e.$customColSize,formType:$,format:r,subLayoutName:e.$ref,subPathSchema:e.$refProperty,forceTable:e.$forceTable,subController:e.$refController,style:e.$style,labelCol:e.$fieldsOptions&&e.$fieldsOptions.labelCol?e.$fieldsOptions.labelCol:3,titleIsHidden:!(!e.$fieldsOptions||!e.$fieldsOptions.titleIsHidden),sticky:i===l.LAYOUT_BLOCK?e.$sticky||"":"",$states:{showTitle:{isHidden:!d,isDisabled:a},title:{isHidden:!d||!p},bindPages:{isHidden:!(i===l.LAYOUT_ACCORDION&&"none"===e.$widget)},titleSize:{isHidden:!d||!p||a},titleStyle:{isHidden:!d||!p||a},colSize:{isHidden:!c},customSize:{isHidden:!c},childrenFlow:{filter:o},format:{isHidden:!s},formType:{isHidden:!f},labelCol:{isHidden:!f||"horizontal"!==$},titleIsHidden:{isHidden:!f},subLayoutName:{isHidden:!u},forceTable:{isHidden:i!==l.LAYOUT_ROW},subPathSchema:{isHidden:!u||!t.options.form},subController:{isHidden:!u||!t.options.form},sticky:{isHidden:i!==l.LAYOUT_BLOCK}},$links:{apply:{isDisabled:!0}}}},e.prototype._emptyContent=function(){var e=this;e.form&&(s.removeForm(e.form),e.form=null),r.empty(e.$element.get(0))},e.prototype._layoutEdit=function(){return{name:n.allocID(),$type:l.LAYOUT_BLOCK,$items:[{$title:{value:"Title"},$bindState:"showTitle",$type:l.LAYOUT_BLOCK,$items:[{$bind:"showTitle"},{$bind:"title"},{$bind:"titleSize"},{$bind:"titleStyle"}]},{$type:l.LAYOUT_BLOCK,$title:{value:a.layouts.design.properties},$items:[{$bind:"name"},{$bind:"childrenFlow"},{$bind:"forceTable"},{$bind:"format"},{$bind:"sticky"},{$bind:"bindPages"},{$bind:"subLayoutName"},{$bind:"subPathSchema"},{$bind:"subController"},{$bind:"style"},{$bind:"colSize"},{$bind:"customSize"}]},{$type:l.LAYOUT_BLOCK,$bindState:"formType",$title:{value:a.layouts.design.fieldsTitle},$items:[{$bind:"formType"},{$bind:"labelCol"},{$bind:"titleIsHidden"}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._setJson=function(e,t){var i=this;i._emptyContent(),t?s.OpenForm(i.$element,i._layoutEdit(),i._schemaLayout(),i._layout2FormData(e),{},function(e,t,n){var o=!1;if("propchange"===e.operation){var a=t.typeLayout===l.LAYOUT_ACCORDION_GROUP;switch(e.property){case"showTitle":a||(t.$states.title.isHidden=!t.showTitle,t.$states.titleSize.isHidden=!t.showTitle,t.$states.titleStyle.isHidden=!t.showTitle,o=!0);break;case"formType":t.$states.labelCol.isHidden=t.$states.showTitle.isHidden||"horizontal"!==t.formType,o=!0;break;case"childrenFlow":case"colSize":case"subLayoutName":if(!t.validate())return;i._sendLayout(t);break;case"subPathSchema":if(!t.validate())return;t.subLayoutName?i._sendLayout(t):o=!0;break;case"forceTable":if(!t.validate())return;i._sendLayout(t);break;case"format":t.$states.bindPages.isHidden=!(t.typeLayout===l.LAYOUT_ACCORDION&&"none"===t.format);default:o=!0}o&&(t.$links.apply.isDisabled=!1)}if("execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;i._sendLayout(t)}},{},function(e){i.form=e}):s.OpenForm(i.$element,i._layoutFields(),i._schemaFields(),i._field2FormData(e),{},function(e,t,n){if("propchange"===e.operation&&(e.property,!0&&(t.$links.apply.isDisabled=!1)),"execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;i._updateFields(t)}},{},function(e){i.form=e})},e.prototype.setDesignMode=function(e){this.options.design=e,this.$element&&(this.options.design&&this.selected?r.removeClass(this.$element.get(0),"bs-none"):r.addClass(this.$element.get(0),"bs-none"))},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=$('<div id= "'+t.$id+'"></div>'),t.options.beforeAdd&&t.options.beforeAdd(t.$element)),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},e.prototype.destroy=function(){var e=this;e.form&&(e.form.destroy(),e.form=null),e.$element&&(e.$element=null),o.unlisten(e)},e}();t.PropertyEditor=d}(e.authpropedit||(e.authpropedit={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,i=t.utils,n=t.ipc,o=t.build,a=(t.drag,t.dom),s=t.ui,l=t.locale,r=t.pagecontrol;t.ulocale;!function(d){var u=function(e,i){var n=t.bootstrap4,s=[];return n?(s.push('<div class="bs-island" id="'+e+'">'),s.push('<form class="form-inline">')):(s.push('<nav class="navbar navbar-default" id="'+e+'">'),s.push('<div class="container-fluid">'),s.push('<div class="navbar-header">'),s.push('<a class="navbar-brand" href="#">'),s.push(l.layouts.design.AuthoringMode),s.push("</a>"),s.push("</div>"),s.push('<div class="collapse navbar-collapse">'),s.push('<form class="navbar-form navbar-left" role="search">')),s.push('<button type="button" class="mr-2 bs-button btn btn-'+a.bootstrapStyles(!0).secondary+(o.release||i.form?" bs-none":"")+'" id="'+e+'_new">'),s.push('<span class="'+a.iconClass("plus")+'" aria-hidden="false"></span> '),s.push(l.layouts.design.New),s.push("</button>&nbsp;"),s.push('<button type="button" class="mr-2 bs-button  btn btn-'+a.bootstrapStyles(!0).secondary+(o.release||i.form?" bs-none":"")+'" id="'+e+'_open">'),s.push('<span class="'+a.iconClass("file-o")+'" aria-hidden="false"></span> '),s.push(l.layouts.design.Open.title),s.push("</button>&nbsp;"),s.push('<button type="button" class="mr-2 bs-button btn btn-'+a.bootstrapStyles(!0).secondary+(i.form?" bs-none":"")+'" id="'+e+'_remove">'),s.push('<span class="'+a.iconClass("times")+'" aria-hidden="false"></span> '),o.release?s.push(l.layouts.design.DeletePreferences):s.push(l.layouts.design.Delete),s.push("</button>&nbsp;"),s.push('<button type="button" class="mr-2 bs-button btn btn-'+a.bootstrapStyles(!0).secondary+'" id="'+e+'_save">'),s.push('<span class="'+a.iconClass("floppy")+'" aria-hidden="false"></span> '),s.push(l.layouts.design.Save),s.push("</button>&nbsp;"),n?(s.push('<label class="form-check-inline">'),s.push('<input class="form-check-input" type="checkbox" id="'+e+'_preview"'+(i.design?"":' checked="true"')+">&nbsp;&nbsp;"),s.push(l.layouts.design.Preview),s.push("</label>")):(s.push('<div class="checkbox">'),s.push("<label>"),s.push('<input type="checkbox" id="'+e+'_preview"'+(i.design?"":' checked="true"')+"> "),s.push(l.layouts.design.Preview),s.push("</label>"),s.push("</div>")),s.push("</form>"),n||s.push("</div>"),n?s.push("<div>"):s.push("</nav>"),s.join("")},p=function(){function t(e){this.$element=null,this.$id=i.allocID(),this.options=e||{}}return t.prototype._removeEvents=function(){this.$element.off("click")},t.prototype._setEvents=function(){var e=this;e.$element.get(0);e.$element.on("click",function(t){var s=!1;switch(t.target.id){case e.$id+"_save":n.emit("SaveLayout",null),s=!0;break;case e.$id+"_open":e._openExisting(),s=!0;break;case e.$id+"_remove":s=!0,i.confirm("",o.release?l.layouts.design.ConfirmDeletePrefs:l.layouts.design.ConfirmDelete,function(){n.emit("RemoveLayout",null)});break;case e.$id+"_preview":var r=a.query(e.$element.get(0),"#"+e.$id+"_preview");n.emit("AuthoringModeChanged",!r.checked);break;case e.$id+"_new":s=!0,i.prompt(l.layouts.design.PageName,"",function(e){(e=e.trim())&&(e.indexOf(" ")>=0?alert(l.layouts.design.InvalidPageName):n.emit("NewLayout",{name:e}))});break;default:s=!1}return!s||(t.stopPropagation(),t.preventDefault(),!1)})},t.prototype._clearChildren=function(){},t.prototype._openExisting=function(){var e=this;n.emit("ListLayout",function(t){if(t&&t.files){for(var i=[],o=0;o<t.files.length;o++){var a=t.files[o];a!=r.Page().currentPage()&&i.push(a)}i.length&&e._openModal(i,function(e){n.emit("OpenLayout",{name:e})})}})},t.prototype._openModal=function(t,i){t.sort();var n={type:"object",properties:{page:{title:"Name",type:"string",enum:t}}},o={name:"open",$type:"block",$items:[{$bind:"page"}]},a={page:t[0]},r={title:l.layouts.design.Open.title,buttons:[{type:"default",title:l.layouts.design.Open.close,name:"cancel"},{type:"primary",title:l.layouts.design.Open.open,name:"ok"}]};s.OpenModalForm(r,o,n,a,e.locale,function(e,t,n,o){if("modal-action"===t.operation)switch(t.property){case"ok":var a=n.page;e.close(),i&&i(a);break;case"cancel":e.close()}})},t.prototype.render=function(e){var t=this;return t.$element||(t.$element=$(u(t.$id,t.options)),t._setEvents(),t.options.beforeAdd&&t.options.beforeAdd(t.$element)),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},t.prototype.destroy=function(){var e=this;e._clearChildren(),e.$element&&(e._removeEvents(),e.$element=null),n.unlisten(e)},t}();d.AuthoringToolBar=p}(e.authtoolbar||(e.authtoolbar={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var i=e,n=i.utils,o=i.dom,a=i.build,s=i.locale,l=function(e,t,i){e.$id=e.$id||n.allocID(),t&&(e.$parentId=t.$id),e.$items&&(e.$contentId=e.$contentId||n.allocUuid()),i&&(i[e.$id]=e)},r=function(e,t,i,n){e.push('<div class="panel-group" id="accordion_expo" role="tablist" aria-multiselectable="true">')},d=function(e,t){e.push("</div>")},u=function(t,i,n,a){var l=e.bootstrap4;i.$typeItems=i.$typeItems||"layouts";var r;switch(i.$typeItems){case"layouts":r=i.$title||s.layouts.design.layouts,"bars";break;case"widgets":r=i.$title||s.layouts.design.widgets,"bars";break;case"actions":r=i.$title||s.layouts.design.actions,"bars";break;default:r=i.$title||s.layouts.design.fields,"bars"}t.push('<div class="'+(l?"card":"panel panel-default")+'" id="'+i.$id+'">'),t.push('<div class="'+(l?"card-header":"panel-heading")+'"  role="tab" id="'+i.$id+'_tab">'),l||t.push('<h3 class="panel-title">'),t.push('<a data-toggle="collapse" aria-expanded="'+(a?"true":"false")+'" draggable="false" data-parent="#accordion_expo" aria-controls="'+i.$id+'_tab" href="#'+i.$id+'_content"><span class="'+o.iconClass("bars")+'">'),t.push("</span>&nbsp;"),t.push(r),t.push("</a>"),l||t.push("</h3>"),t.push("</div>"),t.push('<div id="'+i.$id+'_content" class="panel-collapse collapse'+(a?l?" show":" in":"")+'" role="tabpanel" aria-labelledby="'+i.$id+'_title">'),t.push('<ul class="list-group">')},p=function(e,t){e.push("</ul></div></div>")},c=function(e,t,i,n){var s=["list-group-item bs-cursor-p"];if(t.data&&"widget"===t.data.$type&&"dev"!==a.authMode){var l=!0;"admin"===a.authMode?l=["admin","user"].indexOf(t.mode)<0:"user"===a.authMode&&(l="user"!==t.mode),l&&s.push("bs-none")}e.push('<li draggable="true" class="'+s.join(" ")+'" data-toolbox="'+t.$id+'" id="'+t.$id+'">'),e.push('<span class="'+o.iconClass("file-o")+'"></span>&nbsp;'),e.push(t.$title),e.push("</li>")},f=function(e,t){},$=function(e,t,i){e&&(i(e,t,!0),e.$items&&e.$items.forEach(function(t){$(t,e,i)}),i(e,t,!1))},m=function(e,t,i){var n=!0;$(e,t,function(e,t,o){var a=c,s=f;switch(e.$type){case"groups":a=r,s=d;break;case"group":o?u(i,e,0,n):p(i),s=null,a=null,n=!1;break;default:a=c,s=f}a&&s&&(o?a(i,e,t,!1):s(i,e))})};t.check=function(e,t){$(e,null,function(e,i,n){n&&l(e,i,t)})},t.toHtml=function(e,t){var i=[];return m(e,t,i),i.join("")}}(e.authtoolboxutils||(e.authtoolboxutils={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var i=e,n=(i.utils,i.dom),o=i.ipc,a=i.drag,s=(i.ulocale,i.Observable.SchemaUtils),l=i.authtoolboxutils,r=function(e,t){e.find('li[draggable="true"]').on("dragstart",function(e){e.stopPropagation();var i=t.getItemById($(this).attr("data-toolbox"));if(!i||!i.data)return e.preventDefault(),!1;var n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer;n.effectAllowed="move",n.setData("Text","Data");var o={isNew:!0,data:$.extend(!0,{},i.data.data),isLayout:!1,isField:!1,isWidget:!1};switch(i.data.$type){case"layout":o.isLayout=!0;break;case"field":o.isField=!0;break;case"widget":o.isWidget=!0}a.setData(o)}).on("dragend",function(e){return o.emit("ToolBoxDragend",null),a.setData(null),e.preventDefault(),e.stopPropagation(),!1})},d=function(e,t){e.find('li[draggable="true"]').off("dragstart dragend")},u=function(){function e(e,t){var i=this;i.$element=null,i.map={},i.options=t||{},(e=e||{}).$type=e.$type||"groups",l.check(e,i.map),i.data=e,i._setListeners()}return e.prototype.updateFieldItems=function(e){var t=this,i=t.data.$items.find(function(e){return"fields"===e.$typeItems}),o=t.data.$items.find(function(e){return"actions"===e.$typeItems});if(i||(i={$type:"group",$typeItems:"fields",$items:[]},t.data.$items.push(i)),o||(o={$type:"group",$typeItems:"actions",$items:[]},t.data.$items.push(o)),i.$items=[],o.$items=[],e.forEach(function(e){var t={$type:"item",$title:e.$title,data:{$type:"field",data:{$bind:e.$bind,$widget:e.$widget,options:e.options}}};"field"===e.$type?i.$items.push(t):o.$items.push(t)}),t.map={},l.check(t.data,t.map),t.$element){var a=t.$element.get(0);d(t.$element);var s=n.find(a,i.$id);if(s&&n.remove(s),(s=n.find(a,o.$id))&&n.remove(s),i.$items.length){var u=$(l.toHtml(i,t.data)).get(0);n.append(a,u)}if(o.$items.length){var p=$(l.toHtml(o,t.data)).get(0);n.append(a,p)}r(t.$element,t)}},e.prototype.renderToolBox=function(e,t){return $(l.toHtml(e,t))},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=t.renderToolBox(t.data,null),r(t.$element,t)),e&&(t.options.beforeAdd&&t.options.beforeAdd(t.$element),t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},e.prototype._clearChildren=function(){},e.prototype._removeEvents=function(){var e=this;e.$element&&d(e.$element)},e.prototype.destroy=function(){var e=this;e._clearChildren(),e.$element&&(e._removeEvents(),e.$element=null),o.unlisten(e)},e.prototype.getItemById=function(e){return e?this.map[e]:null},e.prototype._setListeners=function(){o.listen("onFormData",function(e){if(e.schema){var t=s.schema2Authoring(e.schema,e.schema,e.locale);this.updateFieldItems(t)}},this)},e}();t.ToolBox=u}(e.authtoolbox||(e.authtoolbox={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){function t(e,t){var i=['<div class="container-fluid">'];return i.push('<div id="nav_{0}"></div>'),i.push('<div class="row design-table">'),i.push('<div style="width:100%">'),i.push('<div id="content"></div>'),i.push("</div>"),i.push('<div id="toolbox_parent_{0}" style="width:300px">'),i.push('<div id="toolbox_{0}" class="bs-scroll-container"></div>'),i.push("</div>"),i.push("</div>"),i.push('<div id="editor_{0}"></div>'),i.push("</div>"),n.format(i.join(""),e)}var i=e,n=i.utils,o=i.ipc,a=i.dom;i.authtoolbar,i.authtoolbox,i.authpropedit;!function(i){var s=function(){function i(t,i){var o=this;o.options=t,o.id=n.allocID(),o._pe=new e.authpropedit.PropertyEditor(t),o._toolBar=new e.authtoolbar.AuthoringToolBar(t),o._toolBox=new e.authtoolbox.ToolBox(i,t),o._setListeners()}return i.prototype.render=function(e){var i=this,n=!1;if(!i.$element){var o=e.get(0).parentNode,s=a.find(o,"toolbox_parent");if(s){n=!0,i.$element=$(o),s.id="toolbox_parent_"+i.id;var l=a.find(o,"editor");l&&(l.id="editor_"+i.id),(l=a.find(o,"nav"))&&(l.id="nav_"+i.id),(l=a.find(o,"toolbox"))&&(l.id="toolbox_"+i.id)}else i.$element=$(t(i.id,i.options));var r=i.$element.get(0);i.options.beforeAdd&&i.options.beforeAdd(i.$element);var d=a.find(r,"editor_"+i.id);d&&i._pe.render($(d)),(d=a.find(r,"nav_"+i.id))&&i._toolBar.render($(d)),(d=a.find(r,"toolbox_"+i.id))&&i._toolBox.render($(d)),i.setDesignMode(i.options.design)}return e&&!n&&(i.options.replaceParent?e.replaceWith(i.$element):e.append(i.$element)),i.$element},i.prototype._setListeners=function(){var e=this;o.listen("onAuthoringModeChanged",function(t){e.setDesignMode(t)},this)},i.prototype.setDesignMode=function(e){var t=this;if(t.options.design=e,t.$element){var i=a.find(t.$element.get(0),"toolbox_parent_"+t.id);i&&(t.options.design?a.removeClass(i,"bs-none"):a.addClass(i,"bs-none"))}},i.prototype.destroy=function(){var e=this;e.$element&&(e.$element=null),e._pe&&(e._pe.destroy(),e._pe=null),e._pe&&(e._pe.destroy(),e._pe=null),o.unlisten(e)},i}();i.AuthoringEditor=s}(e.authoring||(e.authoring={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.design.min.js.map