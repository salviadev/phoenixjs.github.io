var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Phoenix;!function(a){var b;!function(a){var b=function(){return window.Promise||(window.ES6Promise?window.ES6Promise.Promise:null)},c=function(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b},d=function(){return c(!1)+c(!0)+c(!0)+c(!1)},e=function(){return"I"+c(!1)+c(!1)+c(!1)+c(!1)},f=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return a[0].replace(/{(\d+)}/g,function(b,c){return c=parseInt(c,10),a[c+1]})},g=function(a,b){return a.replace(/{([^{]*)}/g,function(a,c){return b[c]||""})},h=function(a){return null===a},i=function(a){return void 0===a},j=function(a){return null===a||void 0===a},k=function(a,b){if(a)for(var c in a){var d=a[c];b[c];null!==d&&("object"!=typeof d||Array.isArray(d)?b[c]=d:(b[c]=b[c]||{},k(d,b[c])))}},l=function(a){Object.keys(a).forEach(function(b){a[b]=null})},m=function(a,b){for(var c=b.split("."),d=a,e=null,f=0,g=c.length;f<g;f++){if(e=d[c[f]],!e)return e;d=e}return e},n={scope:!1,destroy:!1,menu:!1,proxydata:!1},o=function(a){var b={};for(var c in a)b[c]=a[c];return b},p=function(a,b){if(!a&&b||!b&&a)return!1;if(a===b)return!0;if(!a&&!b)return!1;if(Array.isArray(a)){if(a.length!==b.length)return!1;for(var c=0,d=a.length;c<d;c++)if(!p(a[c],b[c]))return!1;return!0}if("object"==typeof a){if(typeof a!=typeof b)return!1;var e=Object.keys(a),f=Object.keys(b);if(e.length!==f.length)return!1;for(var g=0,h=e.length;g<h;g++)if(!p(a[e[g]],b[e[g]]))return!1;return!0}return!1},q=function(a,b,c){var d=Object.keys(a),e=Object.keys(b);d.forEach(function(d){var f=a[d],g=e.indexOf(d);if(g>=0){e.splice(g,1);var h=b[d];if(h===f)return;null===h?c[d]=null:null===f?c[d]=h:Array.isArray(f)?p(f,h)||(c[d]=h):"object"==typeof f?p(f,h)||(c[d]={},q(f,h,c[d])):c[d]=h}else
// removed
c[d]=null}),e.forEach(function(a){c[a]=b[a]})},r=function(a,b){return void 0!==b&&(n[a]=b),n[a]},s=function(a,b){n&&n[b]&&console.log(a)},t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},u=function(a){return(a||"").replace(/[&<>"'\/]/g,function(a){return t[a]})},v=function(){for(var a=document.getElementsByTagName("script"),b=a.length-1;b>=0;--b){var c=a[b].src.split("?")[0],d=c.split("/"),e=d.length,f=d[e-1].toLowerCase();if("phoenix.js"==f||"phoenix.min.js"==f||"core.js"==f&&"core"==d[e-2]){var g=e-1;return"core.js"==f&&g--,d.slice(0,g).join("/")}}throw"Invalid script Name"},w=function(a,b){if(a.indexOf(".")>=0){var c=b;return a.split(".").forEach(function(a){c&&(c=c[a])}),(c||"")+""}return void 0===b[a]?a:b[a]},x=function(a){return(a||"").indexOf("{{")>=0},y=function(a,b){return a.replace(/{{([^{]*)}}/g,function(a,c){return w(c,b)})},z=function(a,b){return a.replace(/\{\{([^{]*)\}\}/g,function(a,c){return b.push({name:c.split("|")[0].trim()}),""})},A=function(a,b){switch(a){case"uppercase":return b.toUpperCase();case"lowercase":return b.toLowerCase();case"firstChar":return b&&b.length?b[0]:""}return b},B=function(a,b,c){return a.replace(/\{\{([^{]*)\}\}/g,function(a,d){for(var e=d.split("|"),f=(e[0]||"").trim(),g=c?b[f]:w(f,b),h=1,i=e.length;h<i;h++)g=A((e[h]||"").trim(),g);return g})},C=function(a,b){var c=b||this;Object.defineProperty(c.props,a,{get:function(){return c.data[a]},set:function(b){b!=c.data[a]&&(c.data[a]=b,c._notifyChange(a))},enumerable:!0})},D=function(a,b){b.forEach(function(b){Object.getOwnPropertyNames(b.prototype).forEach(function(c){a.prototype[c]=b.prototype[c]})})},E=function(){return function(a){setTimeout(function(){a()},200)}},F=function(){var a;return a=window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}},G=function(a,b){return a=a||{},Object&&Object.assign?Object.assign(a,b):(Object.keys(b).forEach(function(c){a[c]=b[c]}),a)},H=function(a){var c=b();return c.resolve(a)};a.Promise=b(),a.allocUuid=d,a.allocID=e,a.format=f,a.merge=k,a.formatNames=g,a.extend=G,a.logModule=r,a.log=s,a.equals=p,a.copy=o,a.deltaPatch=function(a,b){var c={};return q(a,b,c),Object.keys(c).length?c:null},a.isNull=h,a.isUndefined=i,a.isNullOrUndefined=j,a.escapeHtml=u,a.phoenixPath=v,a.parseExpression=y,a.hasExpression=x,a.parseVariable=w,a.defineProperty=C,a.applyMixins=D,a.nextTick=F(),a.focusDelay=E(),a.dataAsPromise=H,a.extractAngularVars=z,a.execAngularExpression=B,a.confirm=function(a,b,c,d){window.confirm(b)?c():d&&d()},a.alert=function(a,b,c){window.alert(b)},a.prompt=function(a,b,c){var d=window.prompt(a,b);c(d)},a.cleanUpObject=l,a.getValue=m}(b=a.utils||(a.utils={})),function(){var a=Array.prototype;a.find||(a.find=function(a,b){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var c,d=Object(this),e=d.length>>>0,b=arguments[1],f=0;f<e;f++)if(c=d[f],a.call(b,c,f,d))return c}),a.findIndex||(a.findIndex=function(a,b){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var c,d=Object(this),e=d.length>>>0,b=arguments[1],f=0;f<e;f++)if(c=d[f],a.call(b,c,f,d))return f;return-1})}()}(Phoenix||(Phoenix={}));
/// <reference path="./modules/utils.ts" />
var Phoenix;!function(a){var b,c=a,d=c.utils;!function(a){var b=function(a){var b=d.Promise;return new b(window.localStorage?function(b,c){var d=window.localStorage.getItem("preferences."+a);b(d?JSON.parse(d):null)}:function(a,b){a(null)})},c=function(a,b){var c=d.Promise;return new c(window.localStorage?function(c,d){b?window.localStorage.setItem("preferences."+a,JSON.stringify(b)):window.localStorage.setItem("preferences."+a,""),c()}:function(a,b){a()})};a.hashHandler=null,a.logoutHandler=null,a.forbiddenHandler=null,a.changePasswordHandler=null,a.checkLoggedInHandler=null,a.historyChangedHandler=null,a.formOpenHandler=null,a.preferenceLoadHandler=b,a.preferenceSaveHandler=c}(b=a.external||(a.external={}));var e;!function(a){var c,d=[],e=function(){d.pop(),b.historyChangedHandler&&b.historyChangedHandler()},f=function(a,c){if(c)return d=[a],void(b.historyChangedHandler&&b.historyChangedHandler());var e=d.length,f=e?d[e-1]:"";if(f!=a){var g=e>=2?d[e-2]:"";a==g?d.pop():d.push(a),b.historyChangedHandler&&b.historyChangedHandler()}},g=function(){return d.length>1};/* replaceHash */
if("replaceState"in window.history)c=function(a){"#"!==(""+a).charAt(0)&&(a="#"+a),window.location.hash!=a&&(e(),window.history.replaceState("","",a))};else{var h=window.location.hash;c=function(a){"#"!==(""+a).charAt(0)&&(a="#"+a),location.hash!==a&&(e(),location.hash!==h&&window.history.back(),window.location.hash=a)}}a.removeLast=e,a.add=f,a.hasBack=g,a.value=d,a.replaceHash=c}(e=a.history||(a.history={}));var f;!function(a){var b={},c=function(a,c,d){b[a]=b[a]||{},b[a][c]=d},d=function(a,c){return b[a]?b[a][c]:null};a.register=c,a.get=d}(f=a.render||(a.render={}));var g;!function(a){var b={},c=function(a,c){var d="on"+a,e=b[d];e&&e.forEach(function(a){var b=a.listener?a.handler.bind(a.listener):a.handler;b(c)})},d=function(a,c,d){b[a]=b[a]||[];var e=b[a];e.push({listener:d,handler:c})},e=function(a,c){function d(b){if(b)for(var c=b.length;c--;){var d=b[c];d.listener==a&&b.splice(c,1)}}c?d(b[c]):Object.keys(b).forEach(function(a){d(b[a])})};a.emit=c,a.listen=d,a.unlisten=e}(g=a.ipc||(a.ipc={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(a){var b;!function(a){var b=function(){function a(){this._eventList=[]}return a.prototype.execute=function(a){this._eventList.push(a),this._execute()},a.prototype._execute=function(){var a=this;if(!a._inExec){a._inExec=!0;try{for(;;){if(!a._eventList.length)break;var b=a._eventList.shift();try{b()}catch(a){}}}finally{a._inExec=!1}}},a}();a.Serial=b;var c=function(){function a(a,b,c,d,e){var f=this;f.ondispose=e,f.promise=b,f.resolve=c,f.errorhandler=d,f.dataHandler=f.ondata.bind(f),a?f.timer=window.setTimeout(f._execute.bind(f),a):f._execute()}return a.prototype.ondata=function(a){var b=this,c=b.resolve;b.destroy(),c&&c(a)},a.prototype.onerror=function(a){var b=this,c=b.errorhandler;b.destroy(),c&&c(a)},a.prototype._execute=function(){var a=this;a.promise&&a.promise.then?a.promise.then(a.dataHandler,a.onerror.bind(a)):a.promise&&"function"==typeof a.promise?a.dataHandler(a.promise()):a.dataHandler(a.promise)},a.prototype._cleaTimeout=function(){var a=this;a.timer&&(window.clearTimeout(a.timer),a.timer=0)},a.prototype.destroy=function(){var a=this;a.resolve=null,a.errorhandler=null,a._cleaTimeout(),a.promise=null;var b=a.ondispose;a.ondispose=null,b&&b(a)},a}(),d=function(){function a(a){this.defaultDelay=0;var b=this;b.defaultDelay=a,b._error=b._errorHandler.bind(b),b._dispose=b._onEventDisposed.bind(b)}return a.prototype._errorHandler=function(a){var b=this;b.onError&&b.onError(a)},a.prototype.clear=function(){var a=this;a.currentEvent&&(a.currentEvent.destroy(),a.currentEvent=null)},a.prototype._onEventDisposed=function(a){var b=this;b.currentEvent=null},a.prototype.push=function(a,b,d){var e=this;e.clear();var f=d?0:e.defaultDelay;e.currentEvent=new c(f,a,b,e._error,e._dispose)},a.prototype.destroy=function(){var a=this;a.clear()},a}();a.SingleEventBus=d,a.GlbSerial=new b}(b=a.serial||(a.serial={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(a){a.locale={}}(Phoenix||(Phoenix={}));var Phoenix;!function(a){var b;!function(a){var b={},c=function(a,c){for(var d=a.split("."),e=b,f=0,g=d.length-1;f<g;f++){var h=d[f];e[h]=e[h]||{},e=e[h]}e[d[d.length-1]]=c},d=function(a){for(var c=a.split("."),d=b,e=null,f=0,g=c.length;f<g;f++){if(e=d[c[f]],!e)return e;d=e}return e};a.register=c,a.get=d}(b=a.customData||(a.customData={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(a){function b(){f(a.$mem)}function c(a,b){var c=null;try{c=JSON.parse(window.sessionStorage.getItem("preferences"))}catch(a){}if(void 0===b)return c?c[a]:void 0;c=c||{},c[a]=b;try{window.sessionStorage.setItem("preferences",JSON.stringify(c))}catch(a){}}function d(a,b){var c=null;try{c=JSON.parse(window.localStorage.getItem("preferences"))}catch(a){}if(void 0===b)return c?c[a]:void 0;c=c||{},c[a]=b;try{window.localStorage.setItem("preferences",JSON.stringify(c))}catch(a){}}a.device={phone:!1,tablet:!1,deviceType:""};var e=function(){try{if(window.sessionStorage)return JSON.parse(window.sessionStorage.getItem("$mem"))||{}}catch(a){return{}}},f=function(a){a=a||{};try{window.sessionStorage&&window.sessionStorage.setItem("$mem",JSON.stringify(a))}catch(a){}};a.$mem=e(),a.save$mem=b,a.sessionPreferences=c,a.preferences=d,a.build={version:"0.1.0.0",release:!1,authMode:"dev"}}(Phoenix||(Phoenix={}));
/// <reference path="./globals.ts" />
var Phoenix;!function(a){var b;a.build;!function(a){var b={},c={setItem:function(a,c){b[a]=c},getItem:function(a){return b[a]}},d=[],e=function(){var a=null;try{
//db = (_build.release ? window.sessionStorage : window.localStorage);
a=window.localStorage}catch(b){a=null}return a||(a=c),a},f=function(a,b){b||(a.basic="Basic "+window.btoa((a.login||"")+":"+(a.password||""))),e().setItem("authentication",JSON.stringify(a))},g=function(){try{return JSON.parse(e().getItem("authentication"))}catch(a){return null}},h=function(a){d.push(a)},i=function(){e().setItem("authentication","null"),d.forEach(function(a){a()})};a.db=e,a.save=f,a.load=g,a.clear=i,a.registerAfterLogout=h}(b=a.authentication||(a.authentication={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(a){var b;!function(a){function b(b,c){return b=b||a.name,void 0==c?i("application_"+b):h("application_"+b,c)}function c(b,c,d){if(a.name=b,a.title=c,d&&d.homes&&d.homes[b]&&(a.homeName=d.homes[b]),a.configuration=d,angular){var e=d?d.angularModules||[]:[];Array.isArray(e)||"object"!=typeof e||(e=e[b]||[]),a.angularApplication=angular.module(b,e)}}function d(){return a.configuration&&a.configuration.portailName?a.configuration.portailName:"portail"}function e(){return a.name===d()}function f(c,d){var e=b(a.name);return!(!e||!e.customizable)&&(d.indexOf(".json")<0&&(d+=".json"),e.customizable.indexOf([c,a.name,d].join("/"))>=0)}var g={},h=function(a,b){return g[a]=b,b},i=function(a){return g[a]};a.core="phoenix",a.name="",a.support="",a.homeName="home",a.title="",a.licences={},a.configuration=null,a.config=b,a.init=c,a.portailName=d,a.isPortail=e,a.isCustomizable=f}(b=a.application||(a.application={}))}(Phoenix||(Phoenix={}));
/// <reference path="./utils.ts" />
/// <reference path="./locale.ts" />
/// <reference path="./customdata.ts" />
/// <reference path="./authentication.ts" />
/// <reference path="./application.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.application,e=a.customData,f=a.authentication,g=a.locale,h={},i=function(a){var b=h["s"+a];return!(!b||b.disabled)&&(b.handlers.forEach(function(a){a()}),!0)},j=function(a,b){var c="s"+a,d=h[c]||{disabled:!1,handlers:[]};d.handlers.push(b),h[c]=d},k=function(a,b){var c=h["s"+a];c&&(c.disabled=!b)},l=function(a){return a&&"function"==typeof a},m=function(a){var b=null;if(a.responseText&&(b={responseText:a.responseText}),a.responseJSON)if(b=b||{},"object"==typeof a.responseJSON)b.json=a.responseJSON;else try{b.json=JSON.parse(a.responseJSON)}catch(a){}return b},n=function(a){var b={message:"",list:[]};a&&"object"!=typeof a&&(a={message:a}),a=a||{},b.status=a.status,a.message=a.message||g.errors.unknownError;var c;if(a.detail)if(a.detail.json&&a.detail.json.error){var d=a.detail.json.error,e=void 0;if(void 0!==d.details&&(e=d),c=d.message,d.innererror&&d.innererror.message&&"Json"===d.innererror.type&&(e=JSON.parse(d.innererror.message)),e)return b.message=e.message,e.details&&e.details.forEach(function(a){b.list.push({message:a.message,target:a.target})}),b}else c=a.detail.json&&a.detail.json.exceptionMessage?a.detail.json.exceptionMessage:a.detail.responseText;return b.message=c||a.message,b},o=function(a,b,d){!d&&l(b)&&(d=b,b=null);var f={type:"GET",url:a,dataType:"json",accept:"application/json"},h=null;b&&(h=b.$errors,delete b.$errors,Object.keys(f).forEach(function(a){b[a]=f[a]}),f=b);var j=c.Promise;return new j(function(a,c){$.ajax(f).done(function(b,c,e){d&&(b=d(b)),a(b)}).fail(function(d,f,j){if(b&&b.ignore&&b.ignore[""+d.status])return a({});if(h&&h[d.status+""]){var k=d.status+"";if("string"!=typeof h[k])return a(h[k]);var l=e.get(h[k]);l&&a(l())}if(i(d.status))return a({});d.status>=500&&g&&g.errors&&(f=g.errors.error500,j=null);var n=m(d);n&&(j=null),j&&"string"==typeof j&&(j={message:j}),j=j||{message:f,detail:n},j.status=d.status,j._ajax=!0,"error"===j.message&&j.detail&&j.detail.responseText&&(j.message=j.detail.responseText),c(j)})})},p=function(a,b,d,e){var f=c.Promise,h={type:a,contentType:"application/json",accept:"application/json",url:b,data:null};return e&&e.headers&&(h.headers=e.headers),d&&(h.data=JSON.stringify(d)),new f(function(a,b){$.ajax(h).done(function(b,c,d){a(b)}).fail(function(c,d,f){if(e&&e.ignore&&e.ignore[""+c.status])return a({});if(i(c.status))return a({});c.status>=500&&g&&g.errors&&(d=g.errors.error500,f=null);var h=m(c);h&&(f=null),f&&"string"==typeof f&&(f={message:f}),f=f||{message:d,detail:h},f.status=c.status,b(f)})})},q=function(a,b,c){return p("PUT",a,b,c)},r=function(a,b,c){return p("PATCH",a,b,c)},s=function(a,b,c){return p("POST",a,b,c)},t=function(a,b){return p("DELETE",a,null,b)},u={},v=function(){var a=d.config(d.name),b={headers:null};if(a&&a.odata&&a.odata.headers&&(b.headers=a.odata.headers),b.headers=b.headers||{},b.headers.Accept="application/json",a&&a.odata&&a.odata.authentication){var c=f.load();if(c)switch(a.odata.authentication){case"basic":b.headers.Authorization=c.basic;break;case"header-session":b.headers.Authorization="Bearer "+c.token}else delete b.headers.Authorization}return b},w=function(a,b,c,d){var e=u[a];if(e){if(e.loaded)return c(null);if(e.error)return c(e.error,null);
//status.loading == true
window.setTimeout(function(){w(a,b,c,d)},20)}else u[a]={loading:!0},d?d.execute(function(b){b?u[a]={error:b}:u[a]={loaded:!0},c(b)}):$.ajax({url:b,dataType:"script",cache:!0}).done(function(b,d,e){u[a]={loaded:!0},c(null)}).fail(function(b,d,e){var f=e||{message:d};u[a]={error:f},c(f)})},x=function(a){var b=c.Promise;return new b(function(b,c){$.ajax({url:a,dataType:"script",cache:!0}).done(function(a,c,d){b(!0)}).fail(function(a,b,d){c(d||{message:b})})})},y=function(a,b){var e=c.Promise,f=v(),h=d.config(d.name)||{},j=h.rest?h.rest.base||"":"";return a&&"/"===a.charAt(0)&&(j=""),j&&(a=j+"/"+a),new e(function(c,d){var e=function(a){var b=a.statusText;if(i(a.status))return c({});a.status>=500&&g&&g.errors&&(b=g.errors.error500);var e=null;// _parseError(xhr);
d({message:b,detail:e})},h=new XMLHttpRequest;h.open("POST",a,!0),h.responseType="arraybuffer",h.onload=function(){if(200===this.status||201===this.status){var a="",b=h.getResponseHeader("Content-Disposition");if(b&&b.indexOf("attachment")!==-1){var f=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,g=f.exec(b);null!=g&&g[1]&&(a=g[1].replace(/['"]/g,""))}var i=h.getResponseHeader("Content-Type");try{var j=new Blob([this.response],{type:i})}catch(a){return d(a)}if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(j,a),c({});else{var k=window.URL||window.webkitURL,l=k.createObjectURL(j);if(a){
// use HTML5 a[download] attribute to specify filename
var m=document.createElement("a");
// safari doesn't support this yet
"undefined"==typeof m.download?window.location.href=l:(m.href=l,m.download=a,document.body.appendChild(m),m.click(),document.body.removeChild(m))}else window.location.href=l;setTimeout(function(){k.revokeObjectURL(l),c({})},100)}}else e(this)},h.onerror=function(){e(h)},h.setRequestHeader("Content-type","application/json"),f&&f.headers&&Object.keys(f.headers).forEach(function(a){h.setRequestHeader(a,f.headers[a])}),h.send(JSON.stringify(b))})};b.extractAjaxErrors=n,b.get=o,b.getScript=x,b.getDefaultAjaxOptions=v,b.put=q,b.patch=r,b.post=s,b.remove=t,b.postAndDownload=y,b.loadScript=w,b.interceptError=j,b.activateInterceptError=k}(b=a.ajax||(a.ajax={}))}(Phoenix||(Phoenix={}));
/// <reference path="./ajax.ts" />
/// <reference path="./locale.ts" />
var Phoenix;!function(a){var b,c=a,d=c.locale,e=c.utils,f=c.ajax;!function(a){function b(b){var c=e.phoenixPath();b!=a.currentLang&&f.getScript(c+"/locale/phoenix_"+a.lang+".min.js").then(function(){a.currentLang=b}).catch(function(a){})}var c=[],g=function(a){c.push(a)},h=function(a,b){$.extend(!0,d,a),c.forEach(function(a){a(b)})},i=function(a,b){return b=b||{},a&&"{{"==a.substring(0,2)?a.replace(/{{(.*)}}/g,function(a,c){for(var d=c.split("."),e=b,f=0,g=d.length;f<g&&e;f++)e=e[d[f]];return void 0===e?"["+c+"]":e}):a},j=["en","fr"],k=function(a,b){return a=Math.round(Math.abs(a)),isNaN(a)?b:a},l=function(a,b){b=k(b,2);var c=Math.pow(10,b);return(Math.round(a*c)/c).toFixed(b)},m=function(a,b,c,d){if(null===a)return"";var e=k(b,0),f=a<0?"-":"",g=parseInt(l(Math.abs(a||0),e),10)+"",h=g.length>3?g.length%3:0;return f+(h?g.substr(0,h)+c:"")+g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+c)+(e?d+l(Math.abs(a),e).split(".")[1]:"")},n=function(a,b,c,d,e,f){return null===a?"":(f=f||"%v %s",f.replace("%s",e).replace("%v",m(a,b,c,d)))},o=function(a){if(a instanceof Date)return a;if(!a)return null;var b=Date.parse(a);return isNaN(b)?null:new Date(b)},p=function(a){return a?Date.UTC(parseInt(a.substr(0,4),10),parseInt(a.substr(5,2),10)-1,parseInt(a.substr(8,2),10),0,0,0):0},/**
        * @param {string} val
        * @param {number || null} len
        */
q=function(a,b){for(var c=a+"";c.length<b;)c="0"+a;return c},r=function(a,b){var c=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=a.getDate(),f=a.getDay(),g=a.getMonth(),h=a.getFullYear(),i={d:e,dd:q(e,2),ddd:d.date.weekdaysShort[f],dddd:d.date.weekdays[f],m:g+1,mm:q(g+1,2),mmm:d.date.monthsShort[g],mmmm:d.date.months[g],yy:(h+"").slice(2),yyyy:h};return b.replace(c,function(a){return a in i?i[a]:a.slice(1,a.length-1)})},/**
        * Date to ISO8601
        * @param {Date} value
        */
s=function(a){var b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();return q(b,4)+"-"+q(c,2)+"-"+q(d,2)},t=function(a){var b=d.date.dateShort.split("/");if(3!==b.length)return"";var c=a.split(d.date.daySep),e=[0,0,0];b.forEach(function(a,b){var d=0;"m"===a.charAt(0)?d=1:"y"===a.charAt(0)&&(d=2),e[d]=parseInt(c[b],10),2==d&&e[d]<100&&c[b].length<3&&(e[d]+=100*Math.round((new Date).getFullYear()/100))});var f=q(e[2],4)+"-"+q(e[1],2)+"-"+q(e[0],2),g=Date.parse(f);return isNaN(g)?"":f},u=function(a){if(!a)return"";var b=o(a);if(!b)return"";var c=d.date.dateShort;return"/"!=d.date.daySep&&(c=c.replace(/\//g,d.date.daySep)),r(b,c)},v=function(a){if(!a)return"";var b=o(a);if(!b)return"";var c=d.date.dateLong;return"/"!=d.date.daySep&&(c=c.replace(/\//g,d.date.daySep)),r(b,c)},w=function(a){if(!a)return"";var b=o(a);if(!b)return"";var c=d.date.monthYear;return"/"!=d.date.daySep&&(c=c.replace(/\//g,d.date.daySep)),r(b,c)},x=function(a){return parseFloat(a.toFixed(d.number.decimal))},y=function(a,b){return a=a||0,b?n(a,d.number.places,d.number.thousand,d.number.decimal,d.number.symbol,d.number.format):m(a,d.number.places,d.number.thousand,d.number.decimal)},z=function(a,b,c){if(null===a)return"";a=a||0;var e=c?"%v %s":"%v";return n(a,b,d.number.thousand,d.number.decimal,c,e)},A=function(a,b){if(!a||!b)return b;var c=[];if(Object.keys(a).forEach(function(b){var d=a[b];"date"!==d.type&&"money"!==d.type&&"decimal"!==d.type&&"number"!==d.type||c.push({name:b,type:d.type,symbol:d.symbol,longdate:d.longdate,decimals:d.decimals,useSymbol:void 0===d.useSymbol||d.useSymbol})}),!c.length)return b;var d=Array.isArray(b)?b:[b];return d.forEach(function(a){c.forEach(function(b){switch(b.type){case"date":a[b.name]=u(a[b.name]);break;case"money":a[b.name]=y(a[b.name],b.useSymbol);break;case"integer":a[b.name]=z(a[b.name],0,b.symbol);break;case"decimal":case"number":a[b.name]=z(a[b.name],b.decimals,b.symbol)}})}),b},B=function(a){var b=a||"",c=b.indexOf("T");return c>0&&(b=b.substr(0,c)),b},C=function(a){var b=a.replace(new RegExp(d.number.thousand,"g"),"");"."!=d.number.decimal&&(b=b.replace(new RegExp(d.number.decimal,"g"),"."));var c=parseFloat(b);return isNaN(c)&&(c=0),c},D=function(a){for(var b,c=[" ","/","-"],e=0;e<c.length&&(b=c[e],a.indexOf(b)==-1);e++);
// Get vals
var f=a.split(b);if(3!=f.length)return"";for(var e=0;e<3;e++)f[e]=parseInt(f[e],10);
// Format and return date
var g=0,h=0,i=0;switch(d.date.dateShort){case"dd/mm/yyyy":g=0,h=1,i=2;break;case"mm/dd/yyyy":g=1,h=0,i=2;break;case"yyyy/mm/dd":g=2,h=1,i=0}return f[i]<100&&(f[i]+=2e3),E(f,g,h,i)?(f[g]=q(f[g],2),f[h]=q(f[h],2),f[i]=q(f[i],4),f.join(d.date.daySep)):""},E=function(a,b,c,d){var e=a[b],f=a[c],g=a[d],h=new Date(g,f-1,e);return h.getFullYear()==g&&h.getMonth()+1==f&&h.getDate()==e};a.register=g,a.translate=h,a.tt=i,a.currentLang="en",a.defCountry="US",a.lang="fr",//(navigator.language || navigator.userLanguage || currentLang).split('-')[0];
a.country="FR",a.money=y,a.truncMoney=x,a.decimal=z,a.format=A,a.parseISODate=o,a.parseISODateAsUTC=p,a.isoDatePart=B,a.shortDate=u,a.longDate=v,a.monthYear=w,a.localeDate2ISO=t,a.date2ISO=s,a.string2Float=C,a.tryParseDate=D,a.localeTitle=function(b){return"object"==typeof b?b[a.currentLang]:b},a.loadLocale=b,j.indexOf(a.lang)<0&&(a.lang=a.currentLang),b(a.lang)}(b=a.ulocale||(a.ulocale={}));var g;!function(a){var c=function(a){a&&a.filter&&(a.filter("money",[function(){return function(a,c){var d=null===a?null:a?parseFloat(a):0;return b.money(d,c)}}]),a.filter("decimal",[function(){return function(a,c,d){var e=null===a?null:a?parseFloat(a):0;return b.decimal(e,c||0,d)}}]),a.filter("shortdate",[function(){return function(a){return b.shortDate(a)}}]),a.filter("longdate",[function(){return function(a){return b.longDate(a)}}]),a.filter("monthyear",[function(){return function(a){return b.monthYear(a)}}]))};a.registerFilters=c}(g=a.angularjs||(a.angularjs={}))}(Phoenix||(Phoenix={}));
/// <reference path="../modules/ulocale.ts" />
var Phoenix;!function(a){var b={layouts:{design:{Save:"Save",New:"New page",Open:{title:"Open page",open:"Open",close:"Close"},PageName:"Page Name",InvalidPageName:"Invalid page name",ConflictedPageName:"A page of that name exists, do you want to give another name ?",Delete:"Delete page",ConfirmDelete:"Are you sure you want to delete this page ?",Preview:"Preview",AuthoringMode:"Authoring",layouts:"Blocks",widgets:"Widgets",fields:"Fields",actions:"Actions"},NoData:"No data"},schema:{required:"{0} is required.",minNumber:"{0} must be at least {1}",maxNumber:"{0} cannot exceed {1}",minNumberExclusive:"{0} must be greater than {1}",maxNumberExclusive:"{0} must be less than {1}",uniqueColumn:"The column '{0}' must be unique.",uniqueColumns:"Duplicate value for columns '{0}' found.",passwordMismatch:"Password mismatch.",invalidEmail:"Invalid Email Address",minLength:"{0} must be at least {1} characters"},ui:{Close:"Close",Ok:"Ok",Yes:"Yes",No:"No",Warning:"Warning",Info:"Information",Disconnect:"Disconnect",Confirm:"Confirm",Validate:"Validate",Create:"create",password:{oldPassword:"Old Password",newPassword:"New Password",change:"Change password"},ApplyDetailChanges:"Apply",Selected:"Sel."},errors:{Title:"Oops! An unknown error has occurred.",SendMail:"Send",MailSubject:"Error in JS client",ErrorTitle:"Error:",ErrorUser:"User:",ErrorDate:"Date and time:",Browser:"Browser:",ErrorURI:"Address:",Stack:"Call stack:",Context:"Context:",error500:"Internal server error",unknownError:"An unknown error has occurred.",notAuthorized:"Forbidden"},listView:{search:{Search:"Search",Nodata:"Aucun résultat trouvé ..."}},pagination:{Next:"»",Previous:"«",First:"First",Last:"Last"},number:{decimal:".",thousand:" ",places:2,symbol:"$",format:"%s %v"},charts:{numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",rangeSelectorZoom:"Zoom",rangeSelectorFrom:"From",rangeSelectorTo:"To"},date:{weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateShort:"mm/dd/yyyy",dateLong:"d mmmm, yyyy",monthYear:"mmmm yyyy",daySep:"-",weekStart:0,today:"Today",clear:"Clear"}};a.ulocale.translate(b,"en")}(Phoenix||(Phoenix={}));var Phoenix;!function(a){a.bootstrap4=!1;var b;!function(b){var c={"times-circle":"remove-sign","times-circle-o":"remove-circle",times:"remove","chevron-left":"chevron-left","chevron-right":"chevron-right","arrow-left":"arrow-left","arrow-right":"arrow-right",backward:"backward",forward:"forward","file-o":"file",floppy:"floppy-save","power-off":"off",user:"user",pencil:"pencil",trash:"trash","check-square-o":"check","square-o":"unchecked","plus-circle":"plus-sign","minus-circle":"minus-sign",plus:"plus",minus:"minus",search:"search","chevron-down":"menu-down","ellipsis-v":"option-vertical",bars:"menu-hamburger","thumb-tack":"pushpin",calendar:"calendar","exclamation-circle":"exclamation-sign",cloud:"cloud","caret-up":"triangle-top","caret-down":"triangle-bottom",cog:"cog",lock:"lock","question-circle":"question-sign","info-circle":"info-sign",th:"list",building:"new-window"},d=null,e=function(){if(d)return d;var b=a.bootstrap4;return d={primary:"primary",secondary:b?"secondary":"default",default:b?"secondary":"default",important:"important",success:"success",info:"info",danger:"danger",warning:"warning",link:"link"}},f=function(a,b){if(a){var c=a.split(" ");c.forEach(function(a,c){a=a.trim(),a&&"$"===a.charAt(0)&&(a="bs-style-"+a.substring(1)),b.push(a)})}},g=function(a){a&&a.select()},h=function(a,b,c){var d=(a||"").split(" "),e=d.indexOf(c);return b?e<0&&d.push(c):e>=0&&d.splice(e,1),d.join(" ")},i=0,j=function(){return i||(i=parseFloat(getComputedStyle(document.documentElement).fontSize)),i},k=function(a){return Math.round(a*j())},l=function(b,d){void 0===d&&(d=!1);var e=a.bootstrap4?b:c[b]?c[b]:b;return d?(a.bootstrap4?"fa-":"glyphicon-")+e:(a.bootstrap4?"fa fa-":"glyphicon glyphicon-")+e},m=function(a,b){return b?b+" "+b+"-"+a:l(a)},n=function(){return a.bootstrap4?"fa":"glyphicon"},o=function(a){var b=document.createElement("span");return b.className=l(a,!1),b},p=function(a,b){return a?a.querySelectorAll(b):document.querySelectorAll(b)},q=function(a,b){return a?a.id==b?a:a.querySelector("#"+b):document.getElementById(b)},r=function(a,b){return a?a.querySelector(b):null},s=function(a,b){a.classList?a.classList.add(b):a.className=h(a.className,!0,b)},t=function(a,b){a.classList?a.classList.remove(b):a.className=h(a.className,!1,b)},u=function(a,b){return a.classList?a.classList.contains(b):(a.className||"").split(" ").indexOf(b)>=0},v=function(a){a.parentNode.removeChild(a)},w=function(a){return a.parentNode.removeChild(a),a},x=function(a){for(var b=a.childNodes.length-1;b>=0;b--)a.removeChild(a.childNodes[b])},y=function(a,b){a.appendChild(b)},z=function(a,b){a.parentNode.insertBefore(b,a)},A=function(){return{left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}},B=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},C=function(a,b){a.style.removeProperty?a.style.removeProperty(b):"border"===b?a.style[b]="none":a.style[b]=""},D=function(a){var b=document.documentElement.clientTop||document.body.clientTop||0,c=document.documentElement.clientLeft||document.body.clientLeft||0,d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,e=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;return a.top=Math.round(a.top+d-b),a.left=Math.round(a.left+e-c),a},E=function(a,b){if(b){var c=b.getBoundingClientRect(),d=a.getBoundingClientRect();return{left:Math.round(d.left-c.left),top:Math.round(d.top-c.top)}}var d=a.getBoundingClientRect();return D({left:d.left,top:d.top})},F=function(a,b,c,d,e){var f=new Array(b.length+1),g=e.firstDelta||0,h=e.lastDelta||0,i=e.delta||0,j=e.height||0,k=e.top||0;b.forEach(function(b,e){var h=q(a,b.htmlId),j=E(h,null);f[e]={info:b.info,zone:d,position:"before",vertical:c,point:{x:0,y:0},left:j.left+(c?0:0===e?g:i),top:k||j.top,width:Math.round(h.offsetWidth),height:Math.round(h.offsetHeight),htmlId:b.htmlId}});var l=null;if(f.forEach(function(a){var b=a.point;b.y=a.top+(a.height>>1),b.x=a.left+(a.width>>1),l=a}),l){var m=h-(0===f.length?g:i);l={position:"after",zone:d,info:l.info,vertical:l.vertical,point:{x:0,y:0},left:l.left+(c?0:m)+(c?0:l.width),top:l.top+(c?l.height:0),width:l.vertical?l.width:0,height:j||(l.vertical?0:l.height),htmlId:l.htmlId}}else{var n=E(a,null);l={info:{},position:"empty",zone:d,vertical:c,point:{x:0,y:0},left:n.left+(c?0:h),top:k||n.top,width:Math.round(a.offsetWidth),height:j||Math.round(a.offsetHeight),html:a.id}}return l.point.y=l.top+(l.height>>1),l.point.x=l.left+(l.width>>1),f[b.length]=l,f},G=function(a,b,c){var d,e,f=1e6;return c.forEach(function(c){var g,h=Math.abs(c.point.y-b);h<f?(f=h,e=Math.abs(c.point.x-a),d=c):h==f&&(g=Math.abs(c.point.x-a),g<e&&(e=g,d=c))}),d},H=function(a,b){if(void 0===b)return a.textContent;if(a.childNodes.length){for(var c=!1,d=0,e=a.childNodes.length;d<e;d++){var f=a.childNodes[d];if(3==f.nodeType){f.nodeValue=b,c=!0;break}}c||y(a,document.createTextNode(b))}else a.textContent=b},I=function(a,b,c,d){if(d=d||"bs-drag-color-info",a)if(a.vertical!==b)v(a),a=null;else{var e=a.firstChild.firstChild;u(e,d)||(v(a),a=null)}if(!a){var f=['<div class="bs-absolute">'];f.push('<div class="bs-absolute" style="left: 0px; top: 0px"><span class="'),b?f.push(l("arrow-left")):f.push(l("arrow-down")),d&&f.push(" "+d),f.push('"></span></div>');var g=[];f.push('<div class="bs-absolute" style="'),b?(g.push("right: 0px;"),g.push("bottom: 0px;"),f.push(g.join("")),f.push('"><span class="'),f.push(l("arrow-right"))):(g.push("left: 0px;"),g.push("bottom: 0px;"),f.push(g.join("")),f.push('"><span class="'),f.push(l("arrow-up"))),d&&f.push(" "+d),f.push('"></span></div>'),f.push("</div>"),a=$(f.join("")).get(0),a.vertical=b,y(document.body,a)}var h=a.style,i=a.firstElementChild,j=a.lastElementChild,k=Math.round(i.offsetWidth),m=Math.round(j.offsetHeight);return b?(h.height=m+"px",h.width=c.width+2*k+"px",h.left=c.left-k+"px",h.top=c.top-(m>>2)-4+"px"):(h.height=c.height+2*m+"px",h.top=c.top-m+"px",h.left=c.left-(k>>2)+"px"),h.zIndex="5002",a},J=function(a,b,c){for(var d=a;d;){if(!d.getAttribute)return null;var e=d.getAttribute(c);if(e)return d;d=d==b?null:d.parentNode}return null},K=function(a){var b=document.body.firstElementChild;b&&u(b,"bs-content")||(b=document.body);for(var c=b.className||"",d=a?"bs-body-theme-"+a:"",e=c.split(" "),f=!1,g=e.length;g--;){var h=e[g];if(0==h.indexOf("bs-body-theme-")){if(h==d)return!1;f=!0,e.splice(g,1)}}d&&(f=!0,e.push(d)),f&&(b.className=e.join(" "))},L=function(a,b){var c=a.parentNode;a=a.nextSibling,a?c.insertBefore(b,a):c.appendChild(b)},M=function(a,b,c){void 0===c&&(c=b),a.setSelectionRange(b,c)},N=function(a){return null!=a&&a===a.window?a:9===a.nodeType&&a.defaultView},O=function(a){var b;if(3!=a.nodeType&&(b=a.getBoundingClientRect(),b.width||b.height)){var c=a.ownerDocument,d=N(c),e=c.documentElement;return{top:b.top+d.pageYOffset-e.clientTop,left:b.left+d.pageXOffset-e.clientLeft,width:b.width,height:b.height,bottom:0,right:0}}return b||{top:0,left:0,width:0,height:0,bottom:0,right:0}},P=function(a,b,c){for(c=c.toUpperCase();b;){if(b.tagName===c)return b;if(b=b.parentNode,b==a)break}return null},Q=function(a,b,c){for(;b;){if(u(b,c))return b;if(b=b.parentNode,b==a)break}return null},R=function(a,b){for(var c=0,d=a.childNodes.length;c<d;c++)if(a.childNodes[c]==b)return c;return-1},S=function(a,b){for(;b;){if(b===a)return!0;b=b.parentNode}return!1},T=function(a,b,c){return void 0===c&&(c=void 0),void 0===c?a.getAttribute(b):void a.setAttribute(b,c)},U=function(){var a=!1,b=0;return function(){if(a)return b;var c,d=document.createElement("div");return d.style.cssText="overflow:scroll; overflow-x:hidden; zoom:1; clear:both",d.innerHTML="&nbsp;",document.body.appendChild(d),c=d.offsetWidth-d.scrollWidth,document.body.removeChild(d),a=!0,b=c,c}},V=null,W=0,X=function(){return null!=V},Y=function(a){a?(W++,V||(W=1,V=$('<div class="bs-cover"></div>').get(0),V.style.height=$(document).height()-1+"px",y(document.body,V))):(W--,W<=0&&(W=0),V&&0===W&&(v(V),V=null))},Z=function(){var a=!1,b=!1;return function(){return a?b:(b="ontouchend"in document,a=!0,b)}},_=function(a,b,c){var d=a+":",e=document.createElement("test"),f=e.style;return c?f.cssText=d+b:f.cssText=d+["-webkit-","-moz-","-ms-","-o-",""].join(b+";"+d)+b+";",f[a].indexOf(b)!==-1},aa=function(a){return parseInt(a,10)||0},ba=function(){$(window).trigger("global-phoenix-resize")},ca=null,da=function(){$(window).on("resize.phoenix",function(){ca&&clearTimeout(ca),ca=setTimeout(ba,50)})};b.readyHandlers=[da],b.finalizeHandlers=[],b.keys={VK_TAB:9,VK_UP:38,VK_DOWN:40,VK_INSERT:45,VK_DELETE:46,VK_LEFT:37,VK_RIGHT:39,VK_ENTER:13,VK_ESCAPE:27,VK_F1:112,VK_HOME:36,VK_END:35,VK_PGUP:33,VK_PGDOWN:34,VK_SPACE:32,VK_F2:113,VK_F3:114,VK_F4:115,VK_BACKSPACE:8,VK_F10:121},b.queryAll=p,b.find=q,b.query=r,b.addClass=s,b.removeClass=t,b.hasClass=u,b.icon=o,b.iconClass=l,b.customIconClass=m,b.iconPrefix=n,b.bodyTheme=K,b.offset=O,b.before=z,b.after=L,b.parentByTag=P,b.parentByClass=Q,b.indexOf=R,b.append=y,b.select=g,b.empty=x,b.remove=v,b.detach=w,b.attr=T,b.text=H,b.findByAttribute=J,b.isChildOf=S,b.parseStyle=f,b.ignoreKeys=[0,b.keys.VK_UP,b.keys.VK_DOWN,b.keys.VK_HOME,b.keys.VK_END,b.keys.VK_PGUP,b.keys.VK_PGDOWN,b.keys.VK_ENTER,b.keys.VK_ESCAPE,b.keys.VK_DELETE,b.keys.VK_BACKSPACE,b.keys.VK_INSERT],b.arrowKeys=[b.keys.VK_LEFT,b.keys.VK_RIGHT,b.keys.VK_UP,b.keys.VK_DOWN],b.processing=Y,b.inProcessing=X,b.scrollbar=U(),b.documentScroll=A,b.documentClientDim=B,b.touch=Z(),b.position=E,b.childrenPositions=F,b.findNearest=G,b.showMove=I,b.featureTest=_,b.getPx=aa,b.removeStype=C,b.rem2px=k,b.bootstrapStyles=e,b.selectRange=M}(b=a.dom||(a.dom={})),$(document).ready(function(){b.readyHandlers.length&&b.readyHandlers.forEach(function(a){a()})})}(Phoenix||(Phoenix={}));
/// <reference path="./utils.ts" />
/// <reference path="./dom.ts" />
/// <reference path="./globals.ts" />
/// <reference path="./authentication.ts" />
var Phoenix;!function(a){var b,c=a,d=c.utils,e=c.dom,f=c.customData,g=c.device,h=c.application,i=c.external,j=c.authentication,k=c.history;!function(a){var b=function(a){if(!a)return"";var b=[];return Object.keys(a).forEach(function(c){null!==a[c]&&b.push(c+"="+encodeURIComponent(a[c]||""))}),b.length>0?"?"+b.join("&"):""},l=function(a){var b={},c=a,d=a.indexOf("?");if(d>=0){var e=a.substring(d+1);if(c=a.substring(0,d),e){var f=e.split("&");f.forEach(function(a){if(a){var c=a.split("=");b[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}})}}return{path:c,search:b}},m=function(a,c){if(null==a)return l(window.location.href).search;var d=b(a);if(window.location.hash){var e=window.location.hash,f=e.indexOf("?");if(f>0&&(e=e.substring(0,f),e+=d),c)k.replaceHash(e);else if(window.location.hash!=e&&window.history)try{window.history.replaceState(void 0,void 0,e)}catch(a){window.location.hash=e}}else window.location.search!=d&&(window.location.search=d)},n=function(a){var b=a.$page;return g.phone&&a.$pageMobile?b=a.$pageMobile:g.tablet&&a.$pageTablet&&(b=a.$pageTablet),b},o=function(a){var b=null;try{b=JSON.parse(j.db().getItem("authentication"))}catch(a){}var d={$url:m(null,!1),$mem:c.$mem,$user:{name:b?b.name||b.nom||b.login:"",firstName:b?b.firstName||b.prenom||b.login:"",lastName:b?b.lastName||b.nom||"":""},$item:null,$cookie:null};if(a&&a.cookie){d.$cookie={};var e=document.cookie||"";e.split(";").forEach(function(a){var b=a.split("=");b[0]=b[0].replace(/^ /,""),d.$cookie[decodeURIComponent(b[0])]=decodeURIComponent(b[1])})}return d},p=function(a,b,c){if(a.$page){var e=n(a),f="#/"+e,g=[];if(b&&a.$search&&a.$search.length){var h=o();Object.keys(b).forEach(function(a){h[a]=b[a]}),a.$search.forEach(function(a){a&&a.left&&g.push(a.left+"="+encodeURIComponent(d.parseVariable(a.right,h)))})}return c&&Object.keys(c).forEach(function(a){g.push(a+"="+encodeURIComponent(c[a]))}),g.length&&(f=f+"?"+g.join("&")),f}return"#"},q={},r=function(a){var b=a.indexOf("://");if(b>0){var c=q[a.substring(0,b)];if(c)return c.protocol}return null},s=function(a,b,c,d){var e=q[a.protocol];e&&e.handler&&e.handler(a.value,b,c,d)},t=function(a,b){q[a]={protocol:a,handler:b}},u=function(a,b,c){for(var d=b.target;d&&d!=a;){var f=e.attr(d,"data-phoenix-href")||e.attr(d,"href");if(f){if("#"===f){c||(b.preventDefault(),b.stopPropagation());break}var g=r(f);if(g)return c||(b.preventDefault(),b.stopPropagation()),{protocol:g,value:f}}d=d.parentNode}return null},v=function(a,b,c,d){var e,f=location.pathname,g=f.split("/"),h="";g[g.length-1].indexOf(".html")>0&&(h=g.pop());var i=g.pop();h||""!=i||g.pop(),g.push(b),h&&g.push(h),e=g.join("/"),a&&"#"===(""+a).charAt(0)||(a="#"+a),e+=a,d?location.replace(e):location.href=e},w=function(a,b){a&&"#"===(""+a).charAt(0)||(a="#"+a),window.location.hash!=a&&(i.hashHandler?i.hashHandler(a,b):(k.removeLast(),b&&"replaceState"in window.history?window.history.replaceState(void 0,void 0,a):location.hash=a))},x=function(a){i.formOpenHandler&&i.formOpenHandler(a)},y=function(a){if(a.name&&a.schema){var b="/authoring/forms/"+a.name,c=[];a.schema!==a.name&&c.push("prototype="+encodeURIComponent(a.schema)),a.locale&&c.push("locale="+encodeURIComponent(a.locale)),a.path&&c.push("path="+encodeURIComponent(a.path));var d=window.location.href.lastIndexOf("?");d>0&&c.push(window.location.href.substr(d+1)),c.length&&(b=b+"?"+c.join("&")),window.location.hash="#"+b}},z=function(a,b){var c="/authoring",d="/authoring/forms/",e=window.location.hash;"#"==e.charAt(0)&&(e=e.substring(1)),b||0!==e.indexOf(c)?window.location.hash="#"+c+(a?"/"+a:e):0===e.indexOf(d)?window.history.back():window.location.hash="#"+e.substring(c.length)},A=function(a,b,c){var d=h.configuration&&h.configuration.application?h.configuration.application.modules:null;if(a.$page){var e=a.$module?a.$module:h.name;if(d&&d[e]&&h.licences){var g=h.licences[d[e]];if(g&&!g.hasLicence&&i.forbiddenHandler)return i.forbiddenHandler()}var j=p(a,b,c);if(a.$module&&a.$module!==h.name)return v(j,a.$module,h.name,a.$replace);w(j,a.$replace),a.$authoring&&z()}else if(a.$logout)i.logoutHandler&&i.logoutHandler();else if(a.$form)x(a.$form);else if(a.$action&&a.$action.name){var k=f.get(a.$action.name);k&&k(a.$action.params)}else if(a.$formAuthoring)y(a);else if(a.$authoring)z();else if(a.$back)window.history.back();else if(a.href){var l=document.createElement("a");l.href=a.href,a.target&&(l.target=a.target),document.body.appendChild(l),l.click(),document.body.removeChild(l)}};a.search=m,a.object2search=b,a.parseUrl=l,a.hashLink=p,a.pageName=n,a.isCustomLink=u,a.registerCustomProtocol=t,a.execCustomProtocol=s,a.isCustomProtocol=r,a.doAuthoring=z,a.doFormAuthoring=y,a.setHash=w,a.execLink=A,a.context=o}(b=a.link||(a.link={}))}(Phoenix||(Phoenix={}));
/// <reference path="./core.ts" />
/// <reference path="./modules/utils.ts" />
/// <reference path="./modules/links.ts" />
/// <reference path="./modules/globals.ts" />
var Phoenix;!function(a){var b=a,c=b.link,d=b.utils;c.registerCustomProtocol("page",function(a,d,e,f){d.$url||(d.$url=c.search(null,!1)),d.$mem||(d.$mem=b.$mem);var g=a.indexOf("://");if(!(g<=0)){var h,i=a.substring(g+3),j=c.parseUrl(i),k=j.path.split("/");j.search.$replace&&(h=!0,delete j.search.$replace);var l={$page:k[0],$search:[],$replace:h,$menu:null};k.length>1&&(l.$menu=k[1]),Object.keys(j.search).forEach(function(a){l.$search.push({left:a,right:j.search[a]})}),c.execLink(l,d,null)}}),c.registerCustomProtocol("link",function(a,b,e,f){var g=a.substring("link://".length),h=g.indexOf("/");if(h<=0&&(h=g.indexOf("?")),h>0){var i=c.parseUrl(g.substring(h));g=g.substring(0,h),i.search&&(f?d.extend(f,i.search):f=i.search)}e.links&&e.links[g]&&c.execLink(e.links[g],b,f)}),c.registerCustomProtocol("click",null)}(Phoenix||(Phoenix={}));
/// <reference path="./utils.ts" />
/// <reference path="./dom.ts" />
var Phoenix;!function(a){var b,c=a.dom;a.utils;!function(a){function b(a){return!!c.touch()||a.which<2}function d(a){a.stopPropagation(),a.preventDefault()}function e(a){var b,d=document.documentElement;if(c.touch()){var e=a.targetTouches||a.touches;e&&(b={x:e[0].pageX||e[0].clientX+(d.scrollLeft||document.body.scrollLeft),y:e[0].pageY||e[0].clientY+(d.scrollTop||document.body.scrollTop)})}return b||(b={x:a.pageX||a.clientX+(d.scrollLeft||document.body.scrollLeft),y:a.pageY||a.clientY+(d.scrollTop||document.body.scrollTop)}),b.x=Math.round(b.x),b.y=Math.round(b.y),b}var f=function(){function a(){}return a.prototype.disable=function(){this._isDisabled=!0},a.prototype.enable=function(){this._isDisabled=!1},a}();a.EventManager=f,a.mouseEvents=function(a){if(c.touch())switch(a){case"mousedown":return"touchstart";case"mouseup":return"touchend";case"mousemove":return"touchmove"}return a},a.isLeftButton=b,a.stopEvent=d,a.point=e,a.eventManager=new f}(b=a.events||(a.events={}))}(Phoenix||(Phoenix={}));
/// <reference path="./utils.ts" />
/// <reference path="./events.ts" />
/// <reference path="./dom.ts" />
var Phoenix;!function(a){var b,c=a.dom,d=a.utils,e=a.events;!function(a){var b=function(){function a(){}return a.prototype.initialize=function(){var a=this,b=$(document);a._mu=a.mouseUp.bind(a),a._md=a.mouseDownEmpty.bind(a),b.on(e.mouseEvents("mouseup"),a._mu),b.on(e.mouseEvents("mousedown"),a._md)},a.prototype.finalize=function(){var a=this,b=$(document);a._mu&&(b.off(e.mouseEvents("mouseup"),a._mu),a._mu=null),a._md&&(b.off(e.mouseEvents("mousedown"),a._mu),a._md=null),a._listeners=null,a._current=null},a.prototype.startMouseMove=function(){var a=this;a._mm||(a._mm=a.mouseMove.bind(a),$(document).on(e.mouseEvents("mousemove"),a._mm))},a.prototype.stopMouseMove=function(){var a=this;a._mm&&($(document).off(e.mouseEvents("mousemove"),a._mm),a._mm=null)},a.prototype._canExecuteEvent=function(a){return!!this._current},a.prototype.mouseUp=function(a){var b=this,c=b._current;return!c||(c.inDragging&&c.notifyDragEnd(!1,a),b.setCurrent(null),c.clear(),!1)},a.prototype.mouseDownEmpty=function(a){return!0},a.prototype.mouseMove=function(a){var b=this;if(b._canExecuteEvent(a)){var c=b._current;if(!c)return!0;if(!c.ready(a))return e.isLeftButton(a)||(b.setCurrent(null),c.clear()),!0;if(!e.isLeftButton(a))return b.cancelDrag(),!0;try{c.notifyDrag(a)}catch(a){b.cancelDrag()}return e.stopEvent(a),!0}},a.prototype.addDrag=function(a){var b=this,c=new f(a);return b._listeners=b._listeners||[],b._listeners.push(c),c},a.prototype.rmvDrag=function(a){var b=this;if(b._listeners){var c=b._listeners.indexOf(a);c>=0&&(b._listeners.splice(c,1),a.finalize())}},a.prototype.setCurrent=function(a){var b=this;return(!a||!b._current)&&(b._current=a,b._current||b.stopMouseMove(),!0)},a.prototype.cancelDrag=function(){var a=this,b=a._current;b&&(b.inDragging&&b.notifyDragEnd(!0,null),a.setCurrent(null),b.clear())},a.prototype.cover=function(a,b,e){var f=this;if(a){if(!f._coverId){f._coverId=d.allocID();var g=c.documentScroll(),h=c.documentClientDim();h.width+=g.left,h.height+=g.top,h.width=Math.round(Math.max(h.width,document.body.offsetWidth)),h.height=Math.round(Math.max(h.height,Math.round(document.body.offsetHeight)));var i=document.createElement("div");i.id=f._coverId,i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.backgroundColor="white",i.style.opacity="0.01",i.style.width=h.width+"px",i.style.height=h.height+"px",i.style.zIndex=(e||1e4)+"",i.style.cursor=b,c.append(document.body,i)}}else if(f._coverId){var j=c.find(document.body,f._coverId);f._coverId=null,j&&c.remove(j)}},a}();a.DragAndDropManager=b;var f=function(){function b(a){var b=this;b._elements=a,b._mdEvent=b.mousedown.bind(b),b.clear(),b._setEvents()}return b.prototype.clear=function(){var a=this,b=a.stopEvent;
//init
a.mouseMoveCount=0,a.minLeft=null,a.maxLeft=null,a.minTop=null,a.maxTop=null,a.currentLeft=0,a.currentTop=0,a.moveX=!1,a.moveY=!1,a.inDragging=!1,a.coverDocument=!0,a.cursor="default",a.startPoint=null,a.currentPoint=null,a.startOffset=null,a.stopEvent=!1,a.data={},a.floatElement=null,a.floatParent=null,
// restore
a.stopEvent=b},b.prototype._removeEvents=function(){var a=this;a._elements&&(a._elements.forEach(function(b){$(b).off(e.mouseEvents("mousedown"),a._mdEvent)}),a._elements=null)},b.prototype._setEvents=function(){var a=this;a._elements&&a._elements.forEach(function(b){$(b).on(e.mouseEvents("mousedown"),a._mdEvent)})},b.prototype.mousedown=function(b){var c=this;return c.mouseMoveCount=0,c.inDragging=!1,!e.isLeftButton(b)||(!c.canStartDrag(b)||(!a.dragManager.setCurrent(c)||(c.startPoint=e.point(b),a.dragManager.startMouseMove(),c.stopEvent&&e.stopEvent(b),!1)))},b.prototype.finalize=function(){var a=this;a._removeEvents(),d.cleanUpObject(a)},b.prototype.ready=function(a){var b=this;return b.mouseMoveCount++,2==b.mouseMoveCount&&b.notifyDragStart(a),b.inDragging},b.prototype.notifyDrag=function(a){var b=this;if(b.inDragging){b.currentPoint=e.point(a);var c=b.floatElement;if(c&&b.moveX){var d=b.startOffset.left+b.currentPoint.x-b.startPoint.x;null!==b.minLeft&&d<b.minLeft&&(d=b.minLeft),null!==b.maxLeft&&d>b.maxLeft&&(d=b.maxLeft),b.currentLeft=d,c.style.left=d+"px"}if(c&&b.moveY){var f=b.startOffset.top+b.currentPoint.y-b.startPoint.y;null!==b.minTop&&f<b.minTop&&(f=b.minTop),null!==b.maxTop&&f>b.maxTop&&(f=b.maxTop),b.currentTop=f,c.style.top=f+"px"}b.onDrag&&b.onDrag(a)}},b.prototype.notifyDragStart=function(b){var d=this;d.inDragging=!0,e.eventManager.disable(),d.coverDocument&&a.dragManager.cover(!0,d.cursor);try{d.onDragStart&&(d.onDragStart(b)||d.notifyDragEnd(!0,b),d.floatElement&&(d.startOffset=c.position(d.floatElement,d.floatParent)))}catch(a){}},b.prototype.canStartDrag=function(a){var b=this;return!b.canStartDragHandler||b.canStartDragHandler(a)},b.prototype.canDrop=function(b){var c=this;c.coverDocument&&a.dragManager.cover(!0,b?c.cursor:"no-drop")},b.prototype.notifyDragEnd=function(b,c){var f=this;f.inDragging=!1;var g=f.coverDocument;f.onDragEnd&&f.onDragEnd(b,c),d.nextTick(function(){e.eventManager.enable(),g&&a.dragManager.cover(!1)})},b}();a.DragElement=f,a.dragManager=new b,c.readyHandlers.push(function(){a.dragManager.initialize()}),c.finalizeHandlers.push(function(){a.dragManager.finalize()});var g,h=function(a){g=a},i=function(){return g};a.setData=h,a.getData=i}(b=a.drag||(a.drag={}))}(Phoenix||(Phoenix={}));
/// <reference path="./dom.ts" />
var Phoenix;!function(a){var b,c=a.dom;!function(a){a.topOffset=0,a.bottomOffset=0;var b=c.featureTest("position","sticky",!1),d=c.featureTest("position","fixed",!0),e={active:"bs-sticky-on",inactive:"bs-sticky-off",clone:"bs-sticky-dummy"},f=function(b,d,f){d?(c.addClass(b,e.active),"top"===f?b.style.top=a.topOffset+"px":"bottom"===f&&(b.style.bottom=a.bottomOffset+"px"),c.removeClass(b,e.inactive)):(c.addClass(b,e.inactive),c.removeClass(b,e.active),c.removeStype(b,"width"),c.removeStype(b,"top"),c.removeStype(b,"bottom"))},g=function(a,b){var d=a.element,e=($(d),c.find(d.parentNode,a.id+"_sticky_clone"));f(d,!1,b),e&&c.remove(e)},h=function(b){function d(){var b=o+h+a.topOffset;
// Initial Offset Top
// Container Bottom
return n<b&&b+m<=s+t}function g(){
// Initial Offset Top + Height
// Container Top
return n+(m||0)>o+q-i&&o+q-i>=s+(m||0)}var h,i,j=b.element,k=$(j),l=c.offset(j),m=k.outerHeight(),n=0,o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,p=c.hasClass(j,e.active),q=$(window).height(),r=k.parent(),s=r.offset().top,t=r.outerHeight(),u=c.find(r.get(0),b.id+"_sticky_clone");if(u){var v=c.offset(u);u.style.height=m+"px",n=v.width?v.top:l.top}else
// append a clone
n=l.top,u=document.createElement("div"),u.id=b.id+"_sticky_clone",u.className=e.clone,u.style.height=m+"px",c.after(j,u);var w={top:"top"===b.position,bottom:"bottom"===b.position};if(h=0,i=0,w.top&&d()||w.bottom&&g())if(p){var v=c.offset(u);j.style.width=v.width+"px"}else f(j,!0,b.position),j.style.width=l.width+"px";else p&&f(j,!1,b.position)},i=function(){function a(){this._map={},this._list=[],this._scroll=null,this._resize=null,this._refreshTimer=null,this._scrollTimer=null}return a.prototype.add=function(a){var c=this;!b&&d&&(c._map[a.id]=a,c._list.push(a))},a.prototype.remove=function(a){var b=this,c=b._map[a];if(void 0!==c){c.element&&g(c,c.position),c.element=null,delete b._map[a];var d=b._list.indexOf(c);d>=0&&b._list.splice(d,1)}},a.prototype.initialize=function(){var a=this;!b&&d&&(a._scroll=a._onscroll.bind(a),a._resize=a._onresize.bind(a),$(window).on("scroll.sticky",a._scroll),$(window).on("global-phoenix-resize",a._resize))},a.prototype._updateElements=function(a){var b=this;b._list.forEach(function(b){var d=b.element;a&&!c.hasClass(d,e.active)||d.offsetWidth&&h(b)})},a.prototype._onscroll=function(){var a=this;a._scrollTimer&&(window.clearTimeout(a._scrollTimer),a._scrollTimer=null),a._scrollTimer=window.setTimeout(function(){a._updateElements(!1)},20),a._updateElements(!1)},a.prototype._onresize=function(){var a=this;a._updateElements(!0)},a.prototype._refresh=function(a){var b=this;a&&b._updateElements(!1)},a.prototype.refresh=function(a){var b=this;b._refreshTimer&&(window.clearTimeout(b._refreshTimer),b._refreshTimer=null),b._refreshTimer=window.setTimeout(function(){b._refresh(a)},200)},a.prototype.finalize=function(){if(!b&&d){var a=this;a._refreshTimer&&(window.clearTimeout(a._refreshTimer),a._refreshTimer=null),a._scrollTimer&&(window.clearTimeout(a._scrollTimer),a._scrollTimer=null),$(window).off("scroll.sticky",a._scroll),$(window).off("global-phoenix-resize",a._resize),a._scroll=null,a._resize=null}},a}();a.StickyManager=i,c.readyHandlers.push(function(){a.stickyManager.initialize()}),c.finalizeHandlers.push(function(){a.stickyManager.finalize()}),a.stickyManager=new a.StickyManager,a.native=b||!d}(b=a.sticky||(a.sticky={}))}(Phoenix||(Phoenix={}));
/// <reference path="./modules/ajax.ts" />
/// <reference path="./modules/application.ts" />
/// <reference path="./modules/authentication.ts" />
/// <reference path="./modules/customdata.ts" />
/// <reference path="./modules/dom.ts" />
/// <reference path="./modules/drag.ts" />
/// <reference path="./modules/events.ts" />
/// <reference path="./modules/globals.ts" />
/// <reference path="./modules/links.ts" />
/// <reference path="./modules/locale.ts" />
/// <reference path="./modules/sticky.ts" />
/// <reference path="./modules/ulocale.ts" />
/// <reference path="./modules/utils.ts" />
/// <reference path="./core.ts" /> 
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b,c=a,d=c.application,e=c.ajax,f=c.ulocale;!function(a){var b={get:function(a,b,c){b&&f.lang&&(a=a+"_"+f.lang);var g=d.config(c);if(!g)throw"Application configuration not found.";return e.get(g.current.menus+"/"+a+".json",{cache:!0},null)}};a.menu=b}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b,c=a,d=c.ulocale,e=(c.utils,c.ajax),f=c.application;!function(a){var b={get:function(a,b,c){b&&d.lang&&(a=a+"_"+d.lang);var g=f.config(c);if(!g)throw"Application configuration not found.";return e.get(g.current.locales+"/"+a+".json",{cache:!0},function(b){return b&&(b.$name=a),b.$view&&(b.$view.$name=a),b})}};a.schema=b}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b,c=a,d=c.ajax,e=c.utils,f=c.link,g=c.application;!function(a){var b=function(a){return a},c={getRessources:function(a,c){var h=function(a){return c&&(a=c(a)),a},i=a.$url,j=g.config(g.name)||{};j.rest=j.rest||{};var k=j.rest.base||"";i&&"/"===i.charAt(0)&&(k=""),k&&(i=k+"/"+i);var l={};void 0===a.$module&&j.rest.$module&&(a.$module=j.rest.$module),a.$module?l.$module=a.$module:i=i.replace("{$module}/",""),j.rest.$context?l.$context=j.rest.$context:i=i.replace("{$context}/",""),i=e.formatNames(i,l);var m=d.getDefaultAjaxOptions(),n=a.$query;a.$list;switch(i+=f.object2search(n),i=b(i),a.$method){case"POST":return d.post(i,a.$data,m);case"PUT":return d.put(i,a.$data,m);case"PATCH":return d.patch(i,a.$data,m);case"DELETE":return d.remove(i,m);default:return d.get(i,m,function(a){return h(a)})}}};a.rest=c}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b,c=a,d=c.application,e=c.ajax,f=c.link;!function(a){var b={getRessources:function(a,b){var c=function(a){return b&&(a=b(a)),a},g=d.config(d.name);if(!g)throw"Application configuration not found.";var h=g.localData+"/"+a.$url,i=a.$query;return h+=f.object2search(i),e.get(h,{},function(a){return c(a)})}};a.local=b}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b,c=a,d=c.application,e=c.link,f=c.authentication,g=c.utils,h=c.ajax;!function(a){var b={},c=function(a){return a},i={v4:!0,transport:{doPost:h.post,doPut:h.put,doDelete:h.remove,doGet:function(a,b,c,d){return h.get(a,b,c)},doPatch:h.patch},afterLogout:function(){
//clear cache
b={}},addImageUrlToken:function(a){var b=d.config(d.name)||{};if(b.odata=b.odata||{},b&&b.odata&&b.odata.authentication){var c=f.load();if(c)switch(b.odata.authentication){case"header-session":a=a+"?token="+c.token}}return a},baseUrl:function(a){var b=d.config(d.name)||{};b.odata=b.odata||{};var c=b.odata.base||"/data",e={};return a=a||{},void 0===a.$module&&b.odata.$module&&(a.$module=b.odata.$module),a.$module?e.$module=a.$module:c=c.replace("{$module}/",""),b.odata.$context?e.$context=b.odata.$context:c=c.replace("{$context}/",""),g.formatNames(c,e)},urlResEntity:function(a,b){var c=i.baseUrl(a);if(!a.$entity)throw"Invalid odata entity.";if(b&&!a.$entityId)throw"Invalid odata entity id.";var d=c+"/"+a.$entity;return a.$entityId&&(d=d+"("+a.$entityId+")"),a.$propertyName&&(d=d+"/"+a.$propertyName),d},doDelete:function(a,b){var d=i.urlResEntity(a,!0),e=h.getDefaultAjaxOptions();return b&&(e.headers["If-Match"]=b),e.ignore={410:!0},d=c(d),i.transport.doDelete(d,e)},doPost:function(a,b){var d=h.getDefaultAjaxOptions(),e=i.urlResEntity(a,!1);return e=c(e),i.transport.doPost(e,b,d)},doPut:function(a,b,d,e){var f=i.urlResEntity(a,!0),g=h.getDefaultAjaxOptions();return g.headers=g.headers||{},d&&(g.headers["If-Match"]=d),e&&(g.headers.Prefer="return=representation"),f=c(f),i.transport.doPut(f,b,g)},doPatch:function(a,b,d,e){var f=i.urlResEntity(a,!0),g=h.getDefaultAjaxOptions();return g.headers=g.headers||{},d&&(g.headers["If-Match"]=d),e&&(g.headers.Prefer="return=representation"),f=c(f),i.transport.doPatch(f,b,g)},getRessources:function(f,j,k){var l=function(a){return j&&(a=j(a)),a},m=!1,n=f.$cache;delete f.$cache;var o=d.config(d.name)||{};o.odata=o.odata||{},void 0!=o.odata.v4&&(i.v4=o.odata.v4);var p=o.odata?o.odata.base||"/data":"/data",q={};void 0===f.$module&&o.odata.$module&&(f.$module=o.odata.$module),f.$module?q.$module=f.$module:p=p.replace("{$module}/",""),o.odata.$context?q.$context=o.odata.$context:p=p.replace("{$context}/",""),p=g.formatNames(p,q),delete f.$module;var r=f.$entity;f.$entityId&&(r=r+"("+f.$entityId+")",delete f.$entityId,m=!0),f.$propertyName&&(r=r+"/"+f.$propertyName,delete f.$propertyName,m=!0);var s=r;delete f.$entity,m||(i.v4?(f.$top&&!f.nocount&&(f.$count=!0),delete f.nocount):f.$inlinecount="allpages");var t=h.getDefaultAjaxOptions();return t.$errors=k,s=p+"/"+s+e.object2search(f),n&&b[r]&&b[r].uri==s?new g.Promise(function(a,c){var d=l(m?b[r].data:$.extend(!0,{},b[r].data));a(d)}):(s=c(s),a.odata.transport.doGet(s,t,function(a){var c={};return i.v4&&a&&delete a["@odata.context"],m?c=a:(c.documents=i.v4?a.value:a.d.results,c.dataCount=c.documents?c.documents.length:0,c.documents.forEach(function(a){delete a.__metadata}),c&&(c.pageSize=f.$top,c.skip=f.$skip||0,c.count=i.v4?a["@odata.count"]:a.d.__count,c.nodata=0==c.dataCount)),n&&(b[r]={uri:s,data:$.extend(!0,{},c)}),l(c)},{entity:r,params:f}))}};a.odata=i,f.registerAfterLogout(i.afterLogout)}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="./schema-provider.ts" />
/// <reference path="./rest-provider.ts" />
/// <reference path="./local-provider.ts" />
/// <reference path="./menu-provider.ts" />
/// <reference path="./odata-provider.ts" />
var Phoenix;!function(a){var b,c=a,d=c.link,e=c.utils,f=c.data,g=c.customData,h=c.application;!function(a){var b=function(a,b){if(a.$transform){var c=g.get("datasets.transform."+a.$transform);c&&(b=c(b))}return b},i=function(a,b,c){if(!a)return b;var d=g.get("datasets.transform."+a);return d?d($.extend(!0,{},b,c)):b},j=function(){var a={};return{register:function(b,c){a[b]=c},get:function(b){return a[b]}}},k=j(),l=function(a){return a=a||{},a.$type=a.$type||"basic",a.$triggers=a.$triggers||["$load"],a},m=function(a,b,c,d){if(null==a&&b)switch(b){case"number":a=void 0;break;case"integer":a=void 0;break;case"boolean":a=void 0;break;case"string":a="";break;default:a=null}if(Array.isArray(a))return d?a:JSON.stringify(a);if(c&&b&&("string"===b||"date"===b||"datetime"===b)){if(null==a)return null;"date"===b||"datetime"===b||(a="'"+a.replace(/'/g,"''")+"'")}return a},n=function(a,b){var c=b.indexOf("[");if(c<0)return null;if(a=0===c?a:a[b.substr(0,c)],!a)return null;var d=b.substr(c+1,b.length-c-2);if("*"==d||""==d)return a;var e=parseInt(d,10);return e<a.length?a[e]:null},o=function(a,b,c,d){var e,f=a,g=["$url","$context","$data","$item","$mem","$local"],h=typeof f;"object"===h&&f&&(e=a.type,f=a.value,h=typeof f);var i=!1;if("string"===h&&f&&"["===f.charAt(0)&&"]"===f.charAt(f.length-1)&&(i=!0,f=f.substr(1,f.length-2)),"string"===h&&f&&"$"===f.charAt(0)){for(var j=f.split("."),k=0,l=null;k<j.length;){var o=j[k];if(0==k){var p,q=o,r=o.indexOf("[");r>0&&(p=o.substr(r),q=o.substr(0,r));var s=g.indexOf(q);if(!(s>=0))return m(f,e,c,d);l=b[g[s]],p&&j.splice(k+1,0,p)}else{if(!l)break;l="]"==o.charAt(o.length-1)?n(l,o):Array.isArray(l)?l.map(function(a){return a[o]}):l[o]}k++}return i?[m(l,e,c,d)]:m(l,e,c,d)}return m(f,e,c,d)},p=function(a,b,c){for(var d=c.length;d--;)if(a[c[d]]!=b[c[d]])return!1;return!0},q=function(a,b){if(!a)return null;if("string"==typeof a)return o(a,b,!1,!0);var c={};return Object.keys(a).forEach(function(d){c[d]=o(a[d],b,!1,!0)}),c},r=function(a,b,d,e){return q(a,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:e})},s=function(a,b,d,e,f){if(a&&"object"==typeof a&&a.$op){var g={$op:a.$op,$nulls:a.$nulls,$left:null,$right:null};return null!=a.$left&&("object"!=typeof a.$left||!a.$left.$op&&null!==a.$left.$op?g.$left=o(a.$left,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:e},!1,!1):g.$left=s(a.$left,b,d,e,f)),null!=a.$right&&("object"!=typeof a.$right||!a.$right.$op&&null!==a.$right.$op?g.$right=o(a.$right,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:e},f,!1):g.$right=s(a.$right,b,d,e,f)),g}if(a&&"object"==typeof a&&null===a.$op&&null===a.$right&&a.$left){var g={$left:null,$op:null,$right:null};return null!=a.$left&&("object"==typeof a.$left&&a.$left.$op?g.$left=s(a.$left,b,d,e,f):g.$left=o(a.$left,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:e},!1,!1)),g}return o(a,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:e},f,!1)},t=function(a,b,d,e){return a&&"string"==typeof a&&(a=o(a,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:e},!1,!1)),s(a,b,d,e,!0)},u=function(a,b,c,d){return s(a,b,c,d,!1)},v=function(a,b){return"eq"===a.$op&&b[a.$left]==a.$right},w=function(a){if(a&&"object"==typeof a&&a.$op){var b=w(a.$left),c=w(a.$right);
//unary operators
if("not"===a.$op)return{value:"not ("+c.value+")",op:a.$op};if("in"===a.$op){var d=c.value.split(";"),e=[];return d.forEach(function(a){e.push(b.value+" eq "+a)}),{value:"("+e.join(" or ")+")",op:"in"}}if("$func"===a.$op)return{value:b.value+"("+c.value+")",op:a.$op};if("ignore"!==a.$nulls||null!=b.value&&null!=c.value){var f=b.value,g=c.value;return"and"===a.$op&&("or"===b.op&&(f="("+f+")"),"or"===c.op&&(g="("+g+")")),{value:f+" "+a.$op+" "+g,op:a.$op}}return"and"===a.$op||"or"===a.$op?null==c.value?{value:b.value,op:b.op}:{value:c.value,op:c.op}:{value:null,op:null}}if(a&&"object"==typeof a&&null===a.$op&&null===a.$right&&a.$left){var h=w(a.$left);return{value:h.value,op:null}}return{value:a,op:null}},x=function(a,b,c,d){var e=t(a,b,c,d);return w(e).value},y=function(a,b,d,f){var g={$url:null,$list:null,$query:null,$method:"GET"};return g.$method=(a.$method||"GET").toUpperCase(),g.$url=e.execAngularExpression(a.$url,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:f}),g.$list=a.$list,a.$query&&(g.$query={},Object.keys(a.$query).forEach(function(e){"$filter"===e&&a.$query.$filter?(g.$query.$filter=x(a.$query.$filter,b,d,f),g.$query.$filter||delete g.$query.$filter):g.$query[e]=o(a.$query[e],{$url:b,$context:d,$data:null,$mem:c.$mem,$local:f},!1,!1)})),"GET"!==a.$method&&"DELETE"!==a.$method&&(a.$data?g.$data=o(a.$data,{$url:b,$context:d,$data:null,$mem:c.$mem,$local:f},!1,!1):g.$data=d||{}),g},z=function(a){return void 0===a||null===a||""===a},A=function(a,b,d,f){if(!a)return null;var g={},h={$url:b,$context:d,$data:null,$mem:c.$mem,$local:f};if(Object.keys(a).forEach(function(c){if("$search"!==c)if("$entity"===c)g.$entity=o(a.$entity,h,!1,!1);else if("$entityId"===c){var e=!1,i=typeof a.$entityId;if("object"===i)if(a.$entityId.value&&a.$entityId.type){var j=o(a.$entityId,h,!1,!1);e=z(j),g[c]=j}else{var k=[];Object.keys(a.$entityId).forEach(function(b){var c=o(a.$entityId[b],h,!1,!1);e||(e=z(c)),k.push(b+"="+c)}),g[c]=k.join(", ")}else{var l=o(a[c],h,!1,!1);e=z(l),g[c]=l}e&&(g.$entityIdNull=!0)}else"aggregate"==c&&a.aggregate?g.aggregate=a.aggregate:"groupby"==c&&a.groupby?g.groupby=a.groupby:"having"==c&&a.having?g.having=a.having:"$filter"==c&&a.$filter?(g.$filter=x(a.$filter,b,d,f),g.$filter||delete g.$filter):a[c]&&(g[c]=o(a[c],h,!1,!1))}),a.$search&&d&&d.$searchText){var i,j=m(d.$searchText,"string",!0,!1),k=Array.isArray(a.$search)?a.$search:[a.$search];if(1===k.length)i=e.format("contains({0},{1})",a.$search.field,j);else{for(var l=["("],n=k.length,p=0;p<n;p++)l.push(e.format("contains({0},{1})",k[p].field,j)),p<n-1&&l.push(" or ");l.push(")"),i=l.join("")}g.$filter?g.$filter=g.$filter+" and "+i:g.$filter=i}return g},B=function(a){a=a||"";var b=d.context();return o(a,b,!1,!1)},C=function(a,d,f,h){var i,j=h&&h.getLocalContext?h.getLocalContext():null,k=a.$data;if(a.$params&&a.$params.dataProvider){var l=g.get(a.$params.dataProvider);l&&(f=l(f,h))}return!a.$main&&a.$output?(k=a.$data,i=q(a.$output,{$url:d,$context:f,$data:k,$mem:c.$mem,$local:j})):i=k,i=b(a,i),new e.Promise(function(a,b){a(i)})},D=function(a,b,c,d){var e=a.$params.name;return f.schema.get(e,a.$params.localization,void 0)},E=function(a,b,c,d){var e=a.$params.name;return f.menu.get(e,a.$params.localization,void 0)},F=function(a,d,g,j){var k=a.$method||"GET",l=j&&j.getLocalContext?j.getLocalContext():null,m=i(a.$beforeExecute,a.$params,g),n=A(m,d,g,l);if(k&&(k=o(k,g,!1,!1),k=k.toUpperCase()),n.$entityIdNull&&(delete n.$entityIdNull,"GET"===k&&a.$create)){var p=$.extend(!0,{},a.$create);return p.$create=!0,e.Promise.resolve(p)}if(k)switch(k){case"DELETE":return f.odata.doDelete(n,g.etag?g.etag:null);case"POST":return f.odata.doPost(n,g);case"PUT":var s=g["@odata.etag"];delete g["@odata.etag"];var t=null!=g["@odata.return"];return delete g["@odata.return"],f.odata.doPut(n,g,s,t);case"PATCH":var u=g["@odata.etag"];delete g["@odata.etag"];var v=null!=g["@odata.return"];return delete g["@odata.return"],f.odata.doPatch(n,g,u,v)}var w=r(a.$data,d,g,l),x=h.config(h.name)||{};return void 0===a.$cache&&(x.odata&&void 0!==x.odata.cache?x.odata.cache=x.odata.cache:(x.odata=x.odata||{},x.odata.cache=!0)),g&&(g.hasOwnProperty("$skip")&&g.$skip&&(n.$skip=g.$skip),g.hasOwnProperty("$top")&&g.$top&&(n.$top=g.$top)),f.odata.getRessources(n,function(e){e&&e.documents&&e.documents.length||!w||(e.documents=e.documents||[],e.documents.push(w)),g&&g.hasOwnProperty("$searchText")&&(e.searchText=g.$searchText);var f=e;return!a.$main&&a.$output&&(f=q(a.$output,{$url:d,$context:g,$data:e,$mem:c.$mem,$local:l})),f=b(a,f)},a.$errors)},G=function(a,d,e,g){var h=g&&g.getLocalContext?g.getLocalContext():null,i=y(a.$params,d,e,h);return f.local.getRessources(i,function(f){var g=f;return!a.$main&&a.$output&&(g=q(a.$output,{$url:d,$context:e,$data:f,$mem:c.$mem,$local:h})),g=b(a,g)})},H=function(a,d,e,g){var h=g&&g.getLocalContext?g.getLocalContext():null,j=i(a.$beforeExecute,a.$params,e),k=y(j,d,e,h);return a.$method&&(k.$method=a.$method),f.rest.getRessources(k,function(f){var g=f;return a.$output&&(g=q(a.$output,{$url:d,$context:e,$data:f,$mem:c.$mem,$local:h})),g=b(a,g)})},I=function(a){var b=[];return a.$emit&&(a.$emit.$loaded||a.$emit.$changed?(a.$emit.$loaded&&b.push(a.$emit.$loaded.$name),a.$emit.$changed&&b.push(a.$emit.$changed.$name)):b.push(a.$emit)),b};a.execData=function(a,b,c){var e=d.search(null,!1);if(!a)return null;switch(a.$type){case"basic":return C(a,e,b,c);case"odata":return F(a,e,b,c);case"rest":return H(a,e,b,c);case"local":return G(a,e,b,c);default:var f=k.get(a.$type);if(f)return f(a,e,b,c)}return null};var J=function(){function a(a){var b=this;b.config=l(a),a.$default&&(b.defaultDataset=!0),b.config.$autoselect&&(b.autoselect=!0),b._emitters=I(b.config),b.selectedIndex=-1}return a.prototype.execute=function(a,b){var c=this,e=d.search(null,!1);switch(c.config.$type){case"basic":return C(c.config,e,a,b);case"odata":return F(c.config,e,a,b);case"rest":return H(c.config,e,a,b);case"local":return G(c.config,e,a,b);case"menu":return E(c.config,e,a,b);case"widget-schema":return D(c.config,e,a,b);default:var f=k.get(c.config.$type);if(f)return f(c.config,e,a,b)}throw"Invalid dataset type"},a.prototype.enumTriggers=function(a,b){var c=this;c.config.$triggers&&c.config.$triggers.forEach(function(c){(a||"$load"!=c)&&b(c)})},a.prototype.enumEmitters=function(a){var b=this;b._emitters.forEach(a)},a.prototype.hasCustomEvents=function(){var a=this;if(a.config.$triggers){var b=a.config.$triggers;return b.length>1||"$load"!=b[0]}return!1},a.prototype.canExecute=function(a,b){var c=this;if(c.config.$condition){var d=o(c.config.$condition,b,!1,!0);if(!d||"false"===d)return!1}return c.config.$triggers.indexOf(a)>=0},a.prototype.data2Output=function(a,b){return q(a,b)},a.prototype.destroy=function(){e.log("Destroy Dataset","destroy")},a.prototype._findSelectedOData=function(a){var b=this;if(a.documents){var e=-1,f=null;if(b.config.$autoselect&&"object"==typeof b.config.$autoselect)for(var g={$url:d.search(null,!1),$mem:c.$mem},h=q(b.config.$autoselect,g),i=Object.keys(h),j=0,k=a.documents.length;j<k;j++){var l=a.documents[j];if(p(l,h,i)){f=l,e=j;break}}return f?{item:f,index:e}:a.documents.length?{item:a.documents[0],index:0}:{item:null,index:-1}}return{item:null,index:-1}},a.prototype._findSelected=function(a){var b=this;switch(b.config.$type){case"odata":case"rest":return b._findSelectedOData(a);default:return{item:a,index:0}}},a.prototype.doAutoSelect=function(a,b){var c=this;if(c.selectedIndex=-1,c.config.$autoselect){if(!a||a.nodata)return b(null);var d=c._findSelected(a);c.selectedIndex=d.index,b(d.item)}},a}();a.DataSet=J,a.registerDataProvider=k.register,a.compileFilterTree=u,a.acceptFilter=v,a.extractValue=B,a.execOutputData=function(a,b){if(a.$output){var c=d.context();c.$data=b[a.name],c.$context=b,b[a.name]=q(a.$output,c)}},a.test={output:q,parseTree:x}}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.dom,e=c.utils,
// Create page object used in template
f=(c.locale,function(a,b,c,d,e){return{number:a,text:b,icon:c,active:d,disabled:e}}),g=function(a,b,c){var d=[],e=1,g=b,h=c.maxSize&&c.maxSize<b;
// recompute if maxSize
h&&(c.rotate?(
// Current page is displayed in the middle of the visible ones
e=Math.max(a-Math.floor(c.maxSize/2),1),g=e+c.maxSize-1,
// Adjust if limit is exceeded
g>b&&(g=b,e=g-c.maxSize+1)):(
// Visible pages are paginated with maxSize
e=(Math.ceil(a/c.maxSize)-1)*c.maxSize+1,
// Adjust last page if limit is exceeded
g=Math.min(e+c.maxSize-1,b)));
// Add page number links
for(var i=e;i<=g;i++){var j=f(i,i,null,i===a,!1);d.push(j)}
// Add links to move between page sets
if(h&&!c.rotate){if(e>1){var k=f(e-1,"...",null,!1,!1);d.unshift(k)}if(g<b){var l=f(g+1,"...",null,!1,!1);d.push(l)}}var m;
//Add Previous
//Add First
//Add Next
//Add last
return c.directionLinks&&(m=f("prev",null,"chevron-left",!1,1==a),d.unshift(m)),c.boundaryLinks&&(m=f("first",null,"backward",!1,1==a),d.unshift(m)),c.directionLinks&&(m=f("next",null,"chevron-right",!1,a==b),d.push(m)),c.boundaryLinks&&(m=f("last",null,"forward",!1,a==b),d.push(m)),d},h=function(){function a(a){var b=this,c={boundaryLinks:!1,directionLinks:!0,rotate:!0,maxSize:4,size:"lg"};b._options=$.extend(c,a||{}),b.pages=[],b._updating=!1,b.visible=!1,b.props={},b.data={currentPage:-1,totalPages:0},b._defineProps()}return a.prototype._defineProps=function(){var a=this,b=e.defineProperty;b("currentPage",a),b("totalPages",a)},a.prototype._notifyChange=function(a){var b=this;switch(a){case"currentPage":b._changed=!0,b._updatePages();break;case"totalPages":b._changed=!0,b.data.currentPage>=0&&b._updatePages()}},a.prototype._renderPager=function(){var a=this,b=a.$element.get(0);if(a.visible){var c=document.createDocumentFragment(),e=$("<li><a href></a><li>").get(0),f=document.createElement("span");a.pages.forEach(function(a){var b=e.cloneNode(!0);if(a.icon){var g=f.cloneNode(!0);d.attr(g,"class",d.iconClass(a.icon)),d.attr(g,"page",a.number),d.append(b.firstChild,g)}a.text&&d.text(b.firstChild,a.text),d.attr(b,"page",a.number),d.attr(b.firstChild,"page",a.number),a.disabled&&d.addClass(b,"disabled"),a.active&&d.addClass(b,"active"),c.appendChild(b)}),a.$element.empty(),b.appendChild(c),d.removeClass(b,"bs-none")}else d.addClass(b,"bs-none")},a.prototype._updatePages=function(){var a=this;if(!a._updating){a.pages=g(a.data.currentPage,a.data.totalPages,a._options),a.visible=a.data.currentPage>0&&a.data.totalPages>1;var b=5;a._options.boundaryLinks||(b-=2),a._options.directionLinks||(b-=2),a.visible=a.pages.length>b,a.$element&&a._renderPager()}},a.prototype._setEvents=function(){var a=this;a.$element&&a.$element.on("click",function(b){var c=b.target,e=d.attr(c,"page");if(e){if(b.preventDefault(),b.stopPropagation(),d.hasClass(c,"disabled")||d.hasClass(c.parentNode,"disabled"))return;if(a._options.selectPage){var f=parseInt(e,10);a._options.selectPage(isNaN(f)?e:f)}}})},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype.updating=function(a){var b=this;b._updating=a,a?b._changed=!1:b._changed&&(b._changed=!1,b._updatePages())},a.prototype.render=function(a){var b=this;b.$element||(b.$element=$('<ul class="pagination'+("default"!=b._options.size?" pagination-"+b._options.size:"")+'"></ul>'),b._renderPager(),b._setEvents()),a&&(b._options.replaceParent?a.replaceWith(b.$element):a.append(b.$element))},a.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a._options=null},a}();b.Pager=h}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b;!function(b){function c(){return n||(n=new p),n}var d=a,e=d.history,f=d.utils,g=d.external,h=d.dom,i=d.link,j=d.locale,k=d.application,l=['<div role="alert" class="bs-error alert alert-danger alert-dismissible fade in">','<button aria-label="{0}" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>',"<h4 >{1}</h4>","<p>{2}</p>","<p>",'<a class="bs-button btn btn-default" href="{4}" role="button">{3}</a>',"</p>","</div>"],m=['<div class="bs-loader"></div>'],n=null,o=function(a){var b={emit:!1,listen:!0,triggers:[],emitters:[]};return Object.keys(a).forEach(function(c){if("view"!=c){var d=a[c];d.config.$emit&&d.enumEmitters(function(a){b.emit=!0,b.emitters.push(a)}),d.enumTriggers(!1,function(a){b.listen=!0,b.triggers.indexOf(a)<0&&b.triggers.push(a)})}}),b},p=function(){function a(){var a=this;a.children=[],a.data={$title:"",$menuleft:!1,$menutop:!1,$menuright:!1,$menubottom:!1,$hasBack:e.hasBack(),$user:{}},a.errors=[],a.props={},a.popup=null,a._defineProps(),a._setEvents(),g.historyChangedHandler=a._historyChanged.bind(a)}return a.prototype._defineProps=function(){var a=this,b=f.defineProperty;b("$title",a),b("$menuleft",a),b("$menutop",a),b("$menuright",a),b("$menubottom",a),b("$hasBack",a),b("$user",a)},a.prototype.currentPage=function(){var a=this,b=a.childByType("layout");return b?b.data.name||"":""},a.prototype.emittersFor=function(a){var b=this,c=[],d=a.length;return b.dataListeners&&b.dataListeners.forEach(function(b){if(!b.listener.disabled&&b.emit){for(var e=!1,f=0;f<d;f++)b.emitters.indexOf(a[f])>=0&&(e=!0);e&&c.push(b.listener)}}),c},a.prototype._historyChanged=function(){this.props.$hasBack=e.hasBack()},a.prototype._notifyChange=function(a){var b=this;b._notifyChildren(a,b.data[a])},a.prototype._notifyChildOnAdd=function(a,b){var c=this;if(a){if("layout"===b){var d=c.childByType("header");if(d&&d.setPage){var e=a.data.name||"";d.setPage(e,a)}}a.onPageChange&&Object.keys(c.props).forEach(function(b){a.onPageChange(b,c.props[b])})}},a.prototype._notifyChildren=function(a,b){var c=this;c.children.forEach(function(c){var d=c.child;d&&d.onPageChange&&d.onPageChange(a,b)})},a.prototype.registerDataListener=function(a,b){var c=this;if(c.dataListeners=c.dataListeners||[],a.datasets){var d=o(a.datasets);(d.emit||d.listen)&&c.dataListeners.push({listener:a,parent:b,triggers:d.triggers,listen:d.listen,emitters:d.emitters,emit:d.emit})}},a.prototype.removeDataListener=function(a){var b=this;if(b.dataListeners)for(var c=b.dataListeners.length;c--;){var d=b.dataListeners[c];d.listener==a&&b.dataListeners.splice(c,1)}},a.prototype.removeParentDataListener=function(a){var b=this;if(b.dataListeners)for(var c=b.dataListeners.length;c--;){var d=b.dataListeners[c];d.parent==a&&b.dataListeners.splice(c,1)}},a.prototype.emitDataEvent=function(a,b,c){var d=this;d.dataListeners&&d.dataListeners.forEach(function(d){c&&c.indexOf(d.listen)<0||d.listen&&d.triggers.indexOf(a)>=0&&d.listener&&d.listener.dataEvent&&(d.listener.ds_storeLastEvent&&d.listener.ds_storeLastEvent(a,b),d.listener.disabled||d.listener.dataEvent(a,b))})},a.prototype.childByType=function(a){for(var b=this,c=0,d=b.children.length;c<d;c++){var e=b.children[c];if(e.type===a)return e.child}return null},a.prototype.addChild=function(a,b){var c=this;c.children.push({child:b,type:a}),c._notifyChildOnAdd(b,a)},a.prototype.removeChild=function(a){for(var b=this,c=b.children.length;c--;){var d=b.children[c];if(d.child==a){b.children.splice(c,1);break}}},a.prototype.destroy=function(){var a=this;if(g.historyChangedHandler=null,a._hideErrors(!0),a._hideLoading(),a.children){for(var b=a.children.length;b--;){var c=a.children[b];a.removeDataListener(c.child)}a.children=null}a.dataListeners=null,a._removeEvents()},a.prototype._setEvents=function(){var a=this;$(document).on("mousedown touchstart",function(b){a._closePopup(b)}),window.onerror=function(b,c,d,e,f){!f&&c&&(f={filename:c,lineno:d||0,colno:e||0}),a.$error||(a.lastError={message:b,stack:f?f.stack:null,stackError:f&&f.stack?null:f},a._showErrors())}},a.prototype._hideErrors=function(a){var b=this;b.$error&&(b.$error.off("closed.bs.alert"),a&&b.$error.remove(),b.$error=null)},a.prototype._showErrors=function(){var a=this,b=h.find(null,"error_box");if(b&&!a.$error){var c=["mailto:"];c.push(k.support),c.push("?subject="+encodeURIComponent(k.title)),c.push("&body=");var d=i.context(),e=new Date;c.push(encodeURIComponent(j.errors.ErrorTitle+" ")),c.push(encodeURIComponent(a.lastError.message)),c.push(encodeURIComponent("\n\n"+j.errors.ErrorUser+" ")),c.push(encodeURIComponent(d.$user.name)),c.push(encodeURIComponent("\n\n"+j.errors.ErrorDate+" ")),c.push(encodeURIComponent(e.toLocaleString())),c.push(encodeURIComponent("\n\n"+j.errors.Browser+" ")),c.push(encodeURIComponent(navigator.userAgent)),c.push(encodeURIComponent("\n\n"+j.errors.ErrorURI+" ")),c.push(encodeURIComponent(window.location.href)),(a.lastError.stack||a.lastError.stackError)&&(c.push(encodeURIComponent("\n\n"+j.errors.Stack+"\n")),a.lastError.stack?c.push(encodeURIComponent(a.lastError.stack)):c.push(encodeURIComponent(JSON.stringify(a.lastError.stackError)))),c.push(encodeURIComponent("\n\n"+j.errors.Context+" ")),c.push(encodeURIComponent(JSON.stringify(d))),a.$error=$(f.format(l.join(""),j.ui.Close,j.errors.Title,a.lastError.message,j.errors.SendMail,c.join(""))),a.$error.on("closed.bs.alert",function(){a._hideErrors(!1)}),b.appendChild(a.$error.get(0))}},a.prototype._hideLoading=function(){var a=this;a.$loading&&(a.$loading.remove(),a.$loading=null)},a.prototype._showLoading=function(){var a=this,b=document.body;b&&(a.$loading||(a.$loading=$(m.join("")),b.appendChild(a.$loading.get(0))))},a.prototype.loading=function(a){var b=this;a?b._showLoading():b._hideLoading()},a.prototype._removeEvents=function(){$(document).off("mousedown touchstart")},a.prototype._closePopup=function(a){var b=this;b.popup&&(!a||b.popup.inPopup&&!b.popup.inPopup(a.originalEvent?a.originalEvent.target:a.target))&&(b.popup.hide&&b.popup.hide(a?a.originalEvent?a.originalEvent.target:a.target:null),b.popup=null)},a.prototype.setPopup=function(a){var b=this;b._closePopup(null),b.popup=a},a}();b.PageControl=p,b.Page=c}(b=a.pagecontrol||(a.pagecontrol={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
var Phoenix;!function(a){var b,c=a,d=c.utils,e=c.ulocale,f=c.locale,g=(c.ui,c.dom);!function(a){var b=function(a){if("close"===a.pattern){var b={close:!0,type:"default",name:"close",title:f.ui.Close};return $.extend({},b,a)}if("validate"===a.pattern){var c={close:!1,type:"success",name:"validate",title:f.ui.Validate};return $.extend({},c,a)}if("create"===a.pattern){var d={close:!1,type:"success",name:"create",title:f.ui.Create};return $.extend({},d,a)}return a},c=function(a,c,d){
//options name, type, icon, title, cancel
a=b(a),c.push('<button data-action="'+a.name+'" type="button"'),c.push(' class="bs-btn-inline pull-right bs-button btn btn-'+a.type||"default"),c.push('"'),a.close&&c.push(' data-dismiss="modal"'),c.push(">"),a.icon&&(c.push('<span class="'+g.iconClass(a.icon)+'"></span>'),a.title&&c.push("&nbsp;")),c.push(e.tt(a.title||"",d)),c.push("</button>")},h=function(a,b){var f=['<div class="modal fade" data-backdrop="static"  id="{0}" role="dialog" aria-labelledby="{0}_label">','\t<div class="modal-dialog'+(a.size?" modal-"+a.size:"")+'" role="document">','\t\t<div class="modal-content">','\t\t<div class="modal-header">','\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>','\t\t\t<h4 class="modal-title" id="{0}_label">{1}</h4>',"\t\t</div>",'\t\t<div class="modal-body" id="{0}_body">',"\t\t</div>",'\t\t<div class="modal-footer"  id="{0}_footer">'];return a.buttons&&a.buttons.forEach(function(a){c(a,f,b)}),f.push("\t\t</div>"),f.push("\t\t</div>"),f.push("\t</div>"),f.push("</div>"),d.format(f.join(""),a.id,e.tt(a.title,b))},i=function(){function a(a,b){this.options=a||{},this.$id=d.allocID(),this.$locale=b}return a.prototype._removeEvents=function(){var a=this;a.$element.off("click"),a.$element.off("hidden.bs.modal")},a.prototype._execAction=function(a){var b=this;b._clickHnd&&b._clickHnd(a)},a.prototype._addEvents=function(){var a=this;a.$element.on("hide.bs.modal",function(b){a._inProcessing&&(b.preventDefault(),b.stopPropagation())}),a.$element.on("hidden.bs.modal",function(b){a._clear()}),a.$element.on("click",function(b){if(a.$element)for(var c=b.target,e=a.$element.get(0);c;){var f=c.getAttribute("data-action");if(f)return d.focusDelay(function(){return a._execAction(f)});c=c==e?null:c.parentNode}})},a.prototype._clear=function(){var a=this;a.$element&&(a._removeEvents(),a.render&&a.render.destroy(),a.$element.remove(),a.$element=null),a.render=null},a.prototype.processing=function(a){var b=this;b._inProcessing=a,g.processing(a),b.render&&b.render.processing&&b.render.processing(a)},a.prototype.on=function(a){this._clickHnd=a},a.prototype.close=function(){var a=this;a.$element&&a.$element.modal("hide")},a.prototype.open=function(){var a=this,b={id:a.$id,title:a.options.title||"",buttons:a.options.buttons||[],size:0};a.options.size&&(b.size=a.options.size),a.$element||(a.$element=$(h(b,a.$locale)),a.render&&a.render.render($(g.find(a.$element.get(0),a.$id+"_body"))),g.append(document.body,a.$element.get(0)),a.$element.modal({}),a._addEvents())},a.prototype.destroy=function(){var a=this;a._clear()},a}();a.Modal=i}(b=a.modal||(a.modal={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../data/datasets.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.data,e=c.link,f=c.$mem,g=c.utils,h=function(a,b,c,d){if(b.config.$emit[d].$updateMem){var e=b.data2Output(b.config.$emit[d].$updateMem,{$item:c});f=$.extend(f,e)}if(b.config.$emit[d].$updateLocal){var g=a.getLocalContextHandler?a.getLocalContextHandler():null;if(g){var h=b.data2Output(b.config.$emit[d].$updateLocal,{$item:c});g=$.extend(g,h)}}},i=function(a,b,c,f,h,i,j,k){var l=function(a){return k?c?c[a]:null:c},m=a,n=[],o=[],p=f||{},q="$load"==b,r=-1,s=function(a,b,c){if(m&&m.datasets){var d=m.datasets[a];d&&(n.push(d.execute(c,m)),o.push(a),d.defaultDataset&&(r=b.length-1))}};i?i&&Array.isArray(i)?i.forEach(function(a){"object"==typeof a?a.name&&(n.push(d.execData(a,l(a.name),m)),o.push(a.name)):s(a,o,l(a))}):s(i,o,l(i)):m&&m.datasets&&Object.keys(m.datasets).forEach(function(a){var c=m.datasets[a],d=(e.search(null,!1),m.ds_context());c&&c.canExecute(b,d)&&s(a,o,l(a))}),n.length?(m&&m.loadingHandler&&m.loadingHandler(!0),g.Promise.all(n).then(function(a){var b=[];o.forEach(function(c,d){var e=a[d];if(d==r&&m&&m.noDataHandler&&m.noDataHandler(!e||e.nodata,null,!0),p[c]=e,m){var f=m.datasets&&m.datasets[c];if(q&&f&&f.$menu&&m.updateMenuHandler){var g=c.split("_");b.push({name:g[g.length-1],data:e})}if(f&&(m.ds_loaded(c,e),f.autoselect))return f.doAutoSelect(e,function(a){m.ds_select(c,a)})}}),m&&m.loadingHandler&&m.loadingHandler(!1),b.forEach(function(a){m.updateMenuHandler(a.name,a.data)}),h(!0),m&&m.watchersHandler&&m.watchersHandler(o),!q&&j&&m&&m.dataChangedHandler&&m.dataChangedHandler(o)}).catch(function(a){m&&m.loadingHandler&&m.loadingHandler(!1),m&&m.errorHandler&&m.errorHandler(a),h(!1,a),!q&&j&&m&&m.dataChangedHandler&&m.dataChangedHandler(o)})):h(!0)},j=function(){function a(){}return a.prototype.ds_init=function(a){var b=this,c=!1;if(b.props=b.props||{},b.props.data=b.props.data||{},b.props.data.ds={},a.datasets||a.$resources||a.$schema||a.$menus){b.datasets&&b.ds_destroy();var e=a.$resources||a.$schema;e&&(b.props.data.ds.view=null,b.datasets=b.datasets||{},b.datasets.view=new d.DataSet({$type:"widget-schema",$params:{name:e,localization:a.$localization}}),b.datasets.view.$schema=!0),a.$menus&&Object.keys(a.$menus).forEach(function(c){var e="$menu_"+c;b.props.data.ds[e]=null,b.datasets=b.datasets||{},b.datasets[e]=new d.DataSet({$type:"menu",$params:{name:a.$menus[c]+"-"+c}}),b.datasets[e].$menu=!0}),a.datasets&&Object.keys(a.datasets).forEach(function(e){b.props.data.ds[e]=null,b.datasets=b.datasets||{};var f=new d.DataSet(a.datasets[e]);b.datasets[e]=f,c||(c=f.hasCustomEvents()||f.config.$emit)})}return c},a.prototype.ds_storeLastEvent=function(a,b){var c=this;c._lastEvent={event:a,value:b}},a.prototype.ds_LastEvent=function(){var a=this;if(a._lastEvent){var b=a._lastEvent;return a._lastEvent=null,b}return null},a.prototype.ds_destroy=function(){g.log("Destroy Dataset Part","destroy");var a=this;a._lastEvent=null,a.datasets&&(Object.keys(a.datasets).forEach(function(b){var c=a.datasets[b];c.destroy()}),a.datasets=null)},a.prototype.ds_context=function(){var a=this,b={$url:e.search(null,!1),$mem:f,$local:a.getLocalContextHandler?a.getLocalContextHandler():null},c=a.props.data.ds;return c&&Object.keys(c).forEach(function(a){b[a]=c[a]}),b},a.prototype.ds_reemit=function(a,b){var c=this;if(c.datasets){var d=Object.keys(c.datasets);d.forEach(function(a){var b=c.props.data.ds[a],d=c.datasets[a];d.defaultDataset&&c.noDataHandler&&c.noDataHandler(!b||b.nodata,null,!0),c.ds_loaded(a,b),d.autoselect&&d.doAutoSelect(b,function(b){c.ds_select(a,b)})})}return b()},a.prototype.ds_select=function(a,b){var c=this;if(c.datasets&&c.datasets[a]){var d=c.datasets[a];d.config.$emit&&c.emitHandler&&(d.config.$emit.$changed&&h(c,d,b,"$changed"),c.emitHandler(d.config.$emit.$changed?d.config.$emit.$changed.$name:d.config.$emit,b))}},a.prototype.ds_loaded=function(a,b){var c=this;if(c.datasets&&c.datasets[a]){var d=c.datasets[a];d.config.$emit&&d.config.$emit.$loaded&&(h(c,d,b,"$loaded"),c.emitHandler(d.config.$emit.$loaded.$name,b))}},a.prototype.ds_exec=function(a,b,c,d,e,f){i(this,a,b,c,d,e,f)},a}();b.DatasetMethods=j,b.executeDatasets=function(a,b,c,d,e,f){var g={loadingHandler:d&&d.loading?d.loading:null,errorHandler:d&&d.error?d.error:null};i(g,"",b,c,e,a,!1,f)}}(b=a.DatasetPlugin||(a.DatasetPlugin={}))}(Phoenix||(Phoenix={}));
// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b;!function(b){
//Widget data
// {$config: {$title, $titleIsHidden, $border, $style, $height, data}}
var c=a,d=c.dom,e=c.utils,f=c.locale,g=c.ulocale,h=function(a,b,c){var e=["bs-island bs-widget"];return d.parseStyle(a.$style,e),a.$border&&e.push("border"),b.design&&e.push("design"),c&&e.push("selected"),e.join(" ")},i=function(a){if(!a)return"";var b=(a+"").indexOf("%")>0?a:parseInt(a,10)+"px";return"height:"+b+";"},j=function(a,b,c,d){a.push('<div class="'),a.push(h(b.$config,c,b.$selected)),a.push('"'),c.design&&a.push(' draggable="true"'),a.push(' data-render="'+b.$id+'"'),a.push(' id="'+b.$id+'"'),a.push(">"),k(a,b.$id,b.$config,d,!1),a.push('<div class="bs-widget-content bs-widget-content-id"');var e=i(b.$config.$height);e&&a.push(' style="'+e+'"'),a.push(">")},k=function(a,b,c,f,h){a.push('<div class="bs-widget-title'+(h?" bs-widget-content-inv-x":"")+(c.$titleIsHidden&&!h?" bs-none":"")+'" id="'+b+'_title">');var i=g.localeTitle(c.$title)||"";f&&(i=g.tt(c.$title||"",f)),a.push(e.escapeHtml(i+" ")),c.icons&&c.icons.length&&c.links&&c.icons.forEach(function(b){var e=c.links[b.link];e&&e.$icon&&(a.push('<a class="bs-widget-title-icon" data-phoenix-href="link://'+b.link+'">'),a.push('<span class="'+d.iconClass(e.$icon)+'"></span>'),a.push("</a>"))}),a.push("</div>")},l=function(a,b){a.push("</div></div>")},m=function(a,b,c,d,e,f){j(a,b,e,f),l(a,e)},n=function(a,b,c,d,e){var f=[];return m(f,a,c,d,b,e),f.join("")},o=function(){return $('<div class="bs-loader"></div>')},p=function(){return $('<div class="alert alert-danger" role="alert"><span class="'+d.iconClass("exclamation-circle")+'" aria-hidden="true"></span><span></span></div>')},q=function(){return $('<span class="bs-module-settings '+d.iconClass("cog")+'" ></span>')},r=function(){return $('<div class="alert alert-warning" role="alert"></div>')},s=function(a,b){var c=[],e=b!==!1;return b=b&&b!==!0||"cloud",c.push('<div class="bs-widget-content nodata">'),c.push('<div class="bs-no-data-inside">'),e&&c.push('<center class="nodata-image"><i class="'+d.iconClass(b)+' nodata-icon"></i></center>'),c.push('<center><h4 class="nodata-text">'),c.push(a?a:f.layouts.NoData),c.push("</h4></center>"),c.push("</div>"),c.push("</div>"),$(c.join(""))};b.toHtml=n,b.cssClass=h,b.heightText=i,b.loader=o,b.error=p,b.widgetTitle=k,b.settings=q,b.warning=r,b.noData=s}(b=a.WidgetUtils||(a.WidgetUtils={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="./module.ts" />
/// <reference path="./datasets-plugin.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.dom,e=c.utils,f=(c.locale,c.WidgetUtils),g=c.DatasetPlugin,h=c.link,i=c.render,j=function(){function a(a,b,c){var d=this;d.item=a||{},d.item.$id||(d.item.$id=e.allocID()),a.$config=a.$config||{},a.$config.data=a.$config.data||{},d.data=a.$config,d.props={},d.item.$render=d.props,d.props.data=a.$config.data,d.options=b||{},d.contentRender=null,d.links=a.$config.links,d._defineProps(),d.layout=c,d.$local={},
//datasets
d.loadingHandler=d.loading.bind(d),d.noDataHandler=d.noData.bind(d),d.errorHandler=d.error.bind(d),d.emitHandler=d.emit.bind(d),d.getLocalContextHandler=d.getLocalContext.bind(d),d.dataChangedHandler=d.dataChanged.bind(d),d.updateMenuHandler=null,d._watchers={},d.props.data.localContext&&$.extend(d.$local,d.props.data.localContext),d.ds_init(d.data)&&d._listen()}
//implements DatasetMethods
//Called by execdataset
/* Start datasets methods*/
/* End datasets methods*/
return a.prototype.ds_init=function(a){return!1},a.prototype.ds_storeLastEvent=function(a,b){},a.prototype.ds_LastEvent=function(){return null},a.prototype.ds_destroy=function(){},a.prototype.ds_context=function(){return null},a.prototype.ds_reemit=function(a,b){return null},a.prototype.ds_select=function(a,b){},a.prototype.ds_loaded=function(a,b){},a.prototype.ds_exec=function(a,b,c,d,e,f){},a.prototype._defineProps=function(){var a=this,b=e.defineProperty;b("$title",a),b("$border",a),b("$height",a),b("$titleIsHidden",a),b("$settings",a)},a.prototype._notifyChange=function(a){var b=this;switch(a){case"$title":b._updateTitle();break;case"$border":case"$titleIsHidden":b._updateCssClass();break;case"$height":b._updateHeight()}},a.prototype._listen=function(){var a=this;a.layout&&a.layout.registerDataListener(a)},a.prototype._unlisten=function(){var a=this;a.layout&&a.layout.removeDataListener(a)},a.prototype.on=function(a,b){var c=this;c.handlers=c.handlers||{},c.handlers[a]=b},a.prototype._exec=function(a){var b=this;b.handlers&&b.handlers[a]&&b.handlers[a]()},a.prototype._setEvents=function(){var a=this,b=a.$element.get(0);a.$element.on("click",function(c){a.$settings&&c.target===a.$settings.get(0)&&a._exec("settings");var d=h.isCustomLink(b,c);d&&h.execCustomProtocol(d,a.ds_context(),{links:a.links},null)})},a.prototype.executeLink=function(a,b){var c=this,d=h.isCustomProtocol(a);d&&h.execCustomProtocol({protocol:d,value:a},c.ds_context(),{links:c.links},b)},a.prototype._removeEvents=function(){var a=this;a.$element.off("click")},a.prototype.dataChanged=function(a){var b=this;b.onDSChanged&&b.onDSChanged(a),b.contentRender&&b.contentRender.dataChanged?b.contentRender.dataChanged():b.options.onDataChanged&&b.options.onDataChanged()},a.prototype.execDataSet=function(a,b,c,d,e){var f=this;d=d||f.props.data.ds,f.ds_exec(null,b,d,c||function(){},a,e)},a.prototype._loadData=function(a){var b=this;return b.datasets?void b.ds_exec("$load",null,b.props.data.ds,a,null,!0):a(!1)},a.prototype._updateTitle=function(){var a=this;if(a.$element){var b=d.find(a.$element.get(0),a.item.$id+"_title");b&&d.text(b,this.data.$title||"")}},a.prototype._cleanErrors=function(a){var b=this;b.$loader&&(b.$loader.remove(),b.$loader=null),a||(b.$settings&&d.addClass(b.$settings.get(0),"bs-none"),b.$noData&&(b.$noData.remove(),b.$noData=null),b.$error&&(b.$error.remove(),b.$error=null),b.$warning&&(b.$warning.remove(),b.$warning=null))},a.prototype.loading=function(a){var b=this;b._cleanErrors(!a);var c=b.$element?b.$element.get(0):null;c&&(a?(d.addClass(c,"loading"),b.$loader||(b.$loader=f.loader(),b.$element.append(b.$loader))):d.removeClass(c,"loading")),a||b.settings()},a.prototype._linksState=function(a){var b=this;if(b.$element){var c=b.$element.get(0),e=d.find(c,b.item.$id+"_title");if(e){var f=d.queryAll(e,".bs-widget-title-icon");[].forEach.call(f,function(b){a?d.removeClass(b,"bs-none"):d.addClass(b,"bs-none")})}}},a.prototype.noData=function(a,b,c){var e=this;if(!b&&e.props.data.$noDataMessage&&(b=e.props.data.$noDataMessage),this._cleanErrors(!1),e.$element){var g=e.$element.get(0),h=d.query(g,".bs-widget-content-id");if(h&&(a?d.addClass(h,"bs-none"):d.removeClass(h,"bs-none"),e._linksState(!a)),a){e.$noData=f.noData(b,c);var i=e._updateHeight(e.$noData);if(i){var j=d.query(e.$noData.get(0),".bs-no-data-inside");d.addClass(j,"centred")}var k=d.find(g,e.item.$id+"_title");k&&d.after(k,e.$noData.get(0))}}},a.prototype.getLocalContext=function(){return this.$local},a.prototype.settings=function(){var a=this,b=a.data.$settings&&!a.$error&&!a.$warning&&!a.$noData;if(a.$settings)return void(b?d.removeClass(a.$settings.get(0),"bs-none"):d.addClass(a.$settings.get(0),"bs-none"));if(b){a.$settings=f.settings();var c=d.find(a.$element.get(0),a.item.$id+"_title");c&&d.after(c,a.$settings.get(0))}},a.prototype.error=function(a){var b=a;a&&a.message&&(b=a.message);var c=this;this._cleanErrors(!1);var e=c.$element?c.$element.get(0):null;if(e){c.$error=f.error();var g=c.$error.get(0);d.text(g.lastChild," "+b);var h=d.find(e,c.item.$id+"_title");h&&d.after(h,g)}},a.prototype.warning=function(a){var b=this;this._cleanErrors(!1);var c=b.$element?b.$element.get(0):null;if(c){b.$warning=f.warning();var e=b.$warning.get(0);d.text(e,a);var g=d.find(c,b.item.$id+"_title");g&&d.after(g,e)}},a.prototype._updateHeight=function(a){var b=this;a=a||b.$element;var c=a?a.get(0):null;return c&&(c.style.cssText=f.heightText(b.props.$height)),!!b.props.$height},a.prototype._updateCssClass=function(){var a=this,b=a.$element?a.$element.get(0):null;b&&(b.className=f.cssClass(a.data,a.options))},a.prototype._internalRenderContent=function(a,b,c){var d=this,e=i.get(d.options.context,"widget.content.control."+d.data.$type);if(d.$element){if(e)d.contentRender=new e(d.props,{context:d.options.context,replaceParent:!1},this);else{var f=i.get(d.options.context,"widget.content");if(f){var g=[];f(g,d.data,d.options),a.append($(g.join("")))}}d.options.beforeAdd&&d.options.beforeAdd(a,c),d.contentRender&&d.contentRender.render(a),b&&d.$element.append(a)}},a.prototype.watchersHandler=function(a){var b=this;a&&a.forEach(function(a){var c=b._watchers[a];c&&c.forEach(function(c){c(b.props.data.ds[b.props.data.ds[a]])})})},a.prototype.render=function(a){var b=this;if(b.$loader=null,b.$error=null,!b.$element){b.layout.controls[b.item.$id]=this,b.$element=$(f.toHtml(b.item,b.options,null,null,null)),b._setEvents();var c=b.$element.get(0),e=d.query(c,".bs-widget-content-id");b._loadData(function(a){b._internalRenderContent($(e),!1,a),b.settings()}),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element))}},a.prototype.emit=function(a,b,c){var d=this;d.layout&&d.layout.emitDataEvent(a,b,c)},a.prototype.dataEvent=function(a,b){var c=this;c.ds_exec(a,b,c.props.data.ds,function(){},null,!0)},a.prototype.destroy=function(){e.log("Destroy Module","destroy");var a=this;a.contentRender&&(a.contentRender.destroy(),a.contentRender=null),a._unlisten(),a.ds_destroy(),a._cleanErrors(!1),a.item.$render=null,a.$settings&&(a.$settings=null),a.$element&&(a._removeEvents(),a.$element=null),a.layout=null,a.ondatasets=null},a.prototype.watch=function(a,b){var c=this;if(c._watchers){var d=c._watchers[a]=c._watchers[a]||[];d.push(b),c.props&&c.props.data.ds&&e.nextTick(function(){b(c.props.data.ds[a])})}},a.prototype.unwatch=function(a,b){var c=this;if(c._watchers){var d=c._watchers[a];if(d){var e=d.indexOf(b);e>=0&&d.splice(e,1)}}},a}();b.Widget=j,e.applyMixins(j,[g.DatasetMethods])}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="./datasets-plugin.ts" />
/// <reference path="./page.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.pagecontrol,e=c.utils,f=(c.ulocale,c.link),g=c.$mem,h=c.DatasetPlugin,i=c.dom,j=function(a,b,c,d,f){b.forEach(function(b){void 0===b.$level&&(b.$level=f),b.$id=e.allocID(),d&&(b.$parentId=d.$id),c.push(b),b.$items&&b.$items.length?(void 0===b.collapsed&&(b.collapsed=!!a.canExpandItems),j(a,b.$items,c,b,f+1)):b.collapsed=!1})},k=function(){function a(a,b){this._initOptions(b),this.init(a,b)}
//implements DatasetMethods
/* Start datasets methods*/
/* End datasets methods*/
return a.prototype.ds_init=function(a){return!1},a.prototype.ds_storeLastEvent=function(a,b){},a.prototype.ds_LastEvent=function(){return null},a.prototype.ds_destroy=function(){},a.prototype.ds_context=function(){return null},a.prototype.ds_reemit=function(a,b){return null},a.prototype.ds_select=function(a,b){},a.prototype.ds_loaded=function(a,b){},a.prototype.ds_exec=function(a,b,c,d,e,f){},a.prototype._initOptions=function(a){},a.prototype.emit=function(a,b,c){this.emitDataEvent(a,b,c)},a.prototype.init=function(a,b){e.log("Create Menu","menu");var c=this;
//datasets
c.loadingHandler=this.loading.bind(c),c.noDataHandler=null,c.errorHandler=null,c.emitHandler=this.emit.bind(c),c.getLocalContextHandler=null,c.dataChangedHandler=null,c.updateMenuHandler=null,c.$element=null,c.$items=null,c.options=b||{},c.options.typeMenu=c.options.type||"left",c.data={name:"none"},c.page=d.Page(),c.page.addChild("menu-"+c.options.typeMenu,c),c.setMenu(a)},a.prototype.loading=function(a){this.page.loading(a)},a.prototype.registerDataListener=function(a){var b=this;b.page&&b.page.registerDataListener(a,b)},a.prototype.removeDataListener=function(a){var b=this;b.page&&b.page.removeDataListener(a)},a.prototype.emitDataEvent=function(a,b,c){var d=this;d.page&&d.page.emitDataEvent(a,b,c)},a.prototype.onPageChange=function(a,b){var c=this;if("$user"===a&&c.items&&c.options.auth&&!c.options.autoClose){var d=c.page.props.$user&&c.page.props.$user.connected;if(d){var e=i.find(null,c.options.parentId);e?c.show($(e)):c._showContent()}else c.$content&&!d&&c._hideContent()}"$title"===a&&c._onPageChanged()},a.prototype.setMenu=function(a){e.log("Set Menu","menu");var b=this,c=null!=a;a=a||{name:"none"},a.$groups||(a.$groups=[{$items:a.$items}]),this.data.name!==a.name?(e.log("Menu create && execute datasets","menu"),b.data=a,b.items=null,b._map={},b._recreateDatasets(),b.ds_exec("$load",null,b.props.data.ds,function(){var a=!b.options.autoClose&&b.options.parentId&&c;if(a&&b.options.auth&&(a=b.page.props.$user&&b.page.props.$user.connected),b._prepareItems(),b.$content)if(b._removeContent(),c)if(a){var d=i.find(null,b.options.parentId);d&&(b.render(),b.show($(d)))}else b.render();else b._hideContent();else if(a){var e=i.find(null,b.options.parentId);e&&b.show($(e))}b.page.props["$menu"+b.options.typeMenu]=c&&b.options.autoClose},null,!0),b._onPageChanged()):(e.log("Menu reexecute datasets","menu"),b.ds_reemit(null,function(){b._onPageChanged(),b.page.props["$menu"+b.options.typeMenu]=c&&b.options.autoClose}))},a.prototype._onPageChanged=function(){},a.prototype._doCloseClick=function(){},a.prototype._menuShowed=function(){},a.prototype._executeLink=function(a,b){},a.prototype._setEvents=function(){var a=this,b=a.$content.get(0);a.$content.on("click",function(c){var d=f.isCustomLink(b,c);if(d&&"click"===d.protocol){var e=d.value.substring("click://".length);if("close"===e){if(a._doCloseClick)return a._doCloseClick()}else{if(0===e.indexOf("collapse/")){e=e.substring("collapse/".length);var g=e.split("/"),h=a.items[parseInt(g[0],10)];return void(h&&(a.colapse(h,!h.collapsed,!1),a.updateItemsAfterCollapse()))}var i=e.split("/");a._executeLink(a.items[parseInt(i[0],10)],i.length>1?i[1]:null)}}a.options.autoClose&&a.hide()})},a.prototype.updateItemsAfterCollapse=function(){},a.prototype.renderItems=function(a){return null},a.prototype._removeEvents=function(){var a=this;a.$content.off("click")},a.prototype._loadData=function(a){var b=this;return b.datasets?void b.ds_exec("$load",null,b.props.data.ds,a,null,!0):a(!1)},a.prototype._expandItem=function(a,b,c,d,f,g){var h={$title:"",$item:a,$index:g,$link:f};return h.$title=e.parseVariable(d,{$item:a,$url:b,$mem:c}),h},a.prototype._expandDatasetItems=function(a,b,c){var d=this,e=d.props.data.ds[a];if(e){var h=[],i=f.search(null,!1),j=g;if(e.documents){if(!e.documents.length)return null;e.documents.forEach(function(a,e){h.push(d._expandItem(a,i,j,b,c,e))})}else h.push(d._expandItem(e,i,j,b,c,-1));return h}return null},a.prototype.copyMenuItemData=function(a,b){},a.prototype.isVisible=function(a){var b=this;if(a.$parentId&&b.options.canExpandItems){for(var c=!0,d=a;d&&d.$parentId;)if(d=b._map[d.$parentId],d&&d.collapsed){c=!1;break}return c}return!0},a.prototype.colapseAll=function(a){var b=this;b.items.forEach(function(b){b.collapsed=a})},a.prototype.colapse=function(a,b,c){var d=this;a.collapsed=b,a.$items&&a.$items.forEach(function(a){a.collapsed=b,c&&a.$items&&d.colapse(a,b,!0)})},a.prototype._prepareItems=function(){var a=this;if(a.items=[],a.data.$groups){var b=!0;a.data.$groups.forEach(function(c,d){var g=null;if(0===d&&(c.$title=c.$title||String.fromCharCode(160)),c.$dataset){if(!c.$link)throw"Invalid link definition. (no link)";if(!c.$itemtitle)throw"Invalid link definition. (no itemtitle)";g=a._expandDatasetItems(c.$dataset,c.$itemtitle,c.$link)}else g=c.$items;if(g&&g.length){var h=[];if(j(a.options,c.$items,h,null,0),g=h,!b||c.$title||0===d||c.$dataset){var i={$id:e.allocID(),divider:!0,$title:null,$firstGroup:0===d,dataset:"",isHidden:!1,collapsed:!1};i.$title=c.$title,c.dataset&&(i.dataset=c.$dataset,b&&(i.isHidden=!0)),a._map[i.$id]=i,a.items.push(i),b=!1}}if(g){var k=c.$dataset?a.datasets[c.$dataset]:null;g.forEach(function(d,g){var h={$id:d.$id,$parentId:d.$parentId,$title:d.$title?e.parseExpression(d.$title,f.context()):null,$dataset:null,dataset:null,$index:0,$item:null,$link:null,$level:d.$level,selected:!1,collapsed:d.collapsed,$items:d.$items};c.dataset&&(h.dataset=c.$dataset),d.$link&&(h.$link=d.$link),k&&k.autoselect&&(h.selected=k.selectedIndex==g),a.copyMenuItemData(h,d),k&&(h.$dataset=c.$dataset,h.$index=d.$index,h.$item=d.$item),a._map[h.$id]=h,a.items.push(h),b=!1})}})}},a.prototype._removeContent=function(){this.$element&&(this.$element.remove(),this.$element=null)},a.prototype.renderContent=function(){return $("<aside></aside>")},a.prototype.show=function(a){var b=this;b.$content?b._showContent():(b.render(a),b._showContent()),b.options.autoClose&&b.page.setPopup(b)},a.prototype.hide=function(a){var b=this;b.$content&&b._hideContent(a)},a.prototype._hideContent=function(a){var b=this,c=b.$content.get(0);i.addClass(c,"bs-none")},a.prototype._showContent=function(){var a=this,b=a.$content.get(0);i.removeClass(b,"bs-none"),a._menuShowed()},a.prototype.render=function(a){var b=this,c=b.$content;if(
//
c||(c=b.renderContent()),b.$element||(b.$element=b.renderItems(c),c.append(this.$element)),a&&!b.$content){if(b.$content=c,b.options.replaceParent){var d=a.get(0);if(d&&d.id){var e=b.$content.get(0);e&&(e.id=d.id)}a.replaceWith(b.$content)}else a.append(b.$content);b._setEvents()}},a.prototype._recreateDatasets=function(){var a=this;a.ds_destroy(),a.removeDataListener(a),a.ds_init(a.data)&&a.registerDataListener(a)},a.prototype.destroy=function(){var a=this;e.log("Destroy Menu","destroy"),a.ds_destroy(),a.removeDataListener(a),a.$content&&(a._removeEvents(),this.$content=null),this.$element=null,a.page&&(a.page.removeChild(a),a.page=null)},a.prototype.inPopup=function(a){var b=this;if(!b.options.autoClose)return!0;if(!a)return!0;if(b.$content)for(var c=b.$content.get(0),d=a;d;){if(d==c)return!0;d=d.parentNode}return!1},a}();b.MenuBase=k,e.applyMixins(k,[h.DatasetMethods])}(b=a.menubase||(a.menubase={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="./datasets-plugin.ts" />
/// <reference path="./menu-base.ts" />
var Phoenix;!function(a){var b,c=a,d=c.link,e=(c.menubase,c.preferences),f=c.application,g=c.device,h=c.utils,i=c.dom;!function(b){var c=function(a){var b=["bs-menu-right-icon"];return a.collapsed?b.push(i.iconClass("plus-circle")):b.push(i.iconClass("minus-circle")),b.join(" ")},j=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype._initOptions=function(a){var b=f.configuration.header||{};a=a||{},a.typeMenu=a.typeMenu||"left",a.replaceParent=!0,a.canStayInPage=!g.phone&&!g.tablet,a.autoClose=!a.canStayInPage||e("menu_"+a.type+"_autoClose"),void 0===a.autoClose&&(a.autoClose=!0),a.auth=b.authLeftMenu,b["menu"+a.typeMenu]&&h.merge(b["menu"+a.typeMenu],a),a.styles=a.styles||{parent:"$upper",leaf:"$bg-gray-lighter"},a.canExpandItems=!0},b.prototype._hideContent=function(a){var b=this,c=b.$content.get(0);if(b.options.bodyId){var d=i.find(null,b.options.bodyId);d&&i.removeClass(d,"bs-pc-body-"+b.options.typeMenu)}i.removeClass(c,"bs-menu-opened"),i.addClass(c,"bs-menu-closed"),b.options.bodyId&&(!b.options.autoClose||a&&b.options.autoClose)&&h.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},b.prototype._showContent=function(){var a=this,b=a.$content.get(0),c=!1;if(a.options.bodyId&&!a.options.autoClose){c=!0;var d=i.find(null,a.options.bodyId);d&&i.addClass(d,"bs-pc-body-"+a.options.typeMenu)}i.removeClass(b,"bs-menu-closed"),i.addClass(b,"bs-menu-opened"),a.options.canStayInPage?i.addClass(b,"large"):i.addClass(b,"phone"),c&&h.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},b.prototype._switchAutoClose=function(){var a=this,b=!e("menu_"+a.options.type+"_autoClose");return e("menu_"+a.options.type+"_autoClose",b),a.options.autoClose=b,a.options.autoClose?a.page.setPopup(a):a.page.popup=null,a._updateCloseButton(a.$content)},b.prototype._doCloseClick=function(){var a=this;return a.options.canStayInPage?(a._switchAutoClose()?a.hide(!0):a._showContent(),void(a.page.props["$menu"+a.options.typeMenu]=a.options.autoClose)):void a.hide()},b.prototype.copyMenuItemData=function(a,b){a.$icon=b.$icon},b.prototype._updateCloseButton=function(a){var b=this,c=!1,d=a.get(0),e=i.query(d,".bs-menu-button");if(e)return b.options.canStayInPage?(i.removeClass(e,i.iconClass("times",!0)),b.options.autoClose?(i.removeClass(e,i.iconClass("times-circle-o",!0)),i.addClass(e,"small"),i.addClass(e,i.iconClass("thumb-tack",!0)),c=!0):(i.removeClass(e,i.iconClass("thumb-tack",!0)),i.removeClass(e,"small"),i.addClass(e,i.iconClass("times-circle-o",!0))),i.removeClass(e,"bs-none")):(i.removeClass(e,i.iconClass("thumb-tack",!0)),i.removeClass(e,i.iconClass("times-circle-o",!0)),i.addClass(e,i.iconClass("times",!0)),i.removeClass(e,"bs-none")),c},b.prototype.renderContent=function(){var a=this,b=a.options,c=$('<div class="bs-menu-wrap bs-menu-animate bs-menu-closed bs-menu-'+b.typeMenu+'-wrap"></div>'),d=a.page.childByType("header");if(d&&d.$element){var e=i.offset(d.$element.get(0));g.phone||g.tablet||(c.get(0).style.paddingTop=e.height+"px",c.get(0).style.zIndex="1000")}return c},b.prototype._changeSelected=function(a){var b=this;if(b.$element)for(var c=a;c;){var d=i.find(b.$element.get(0),c.$id);d&&(a.selected?i.addClass(d,"active"):i.removeClass(d,"active")),c=b._map[c.$parentId]}},b.prototype._selectDatasetItem=function(a,b){var c=this,d=null;c.items.forEach(function(e){e.$dataset===a&&(e===b?e.selected||(e.selected=!0,c._changeSelected(e)):e.selected&&(e.selected=!1,c._changeSelected(e),d=e))}),c._expandSelected(d)},b.prototype._expandSelected=function(a){for(var b=this,c=[],d={},e=a;e;)c.push(e),d[e.$id]=!0,e.collapsed=!1,e=b._map[e.$parentId];b.items.forEach(function(a){a.collapsed||d[a.$id]||(a.collapsed=!0)}),b.updateItemsAfterCollapse();var f=c.reverse().map(function(a){return a.$title});b.data&&b.data.$moduleTitle&&f.unshift(b.data.$moduleTitle);var g=b.page.childByType("header");g&&g.setLocation(f.join(" - "),!1)},b.prototype._canClick=function(a){return a.$link},b.prototype.render=function(b){a.prototype.render.call(this,b),this._onPageChanged()},b.prototype.renderItems=function(){var a=this,b=$('<ul class="bs-item-list"></ul>'),d=b.get(0),e=$('<li><a class="link"><span class="title"></span></a></li>').get(0),f=$('<li class="parent"><span class="title"></span></li>').get(0),g=($('<li class="parent"><span class="title"></span></li>').get(0),$('<li class="divider"><span class="title"></span></li>').get(0));if(a.items){var h=a.items.length;a.items.forEach(function(b,j){if(!b.isHidden){var k;if(b.divider)k=g.cloneNode(!0),i.text(k.firstChild,b.$title||String.fromCharCode(160));else{var l=a.options.canExpandItems&&b.$items&&b.$items.length,m=!1,n="";if(j<h-1){var o=a.items[j+1];m=(o.$level||0)>(b.$level||0)&&!o.$parentId}var p=!!b.$link;if(k=p||l?e.cloneNode(!0):f.cloneNode(!0),b.$items?(n="parent",i.addClass(k,"bs-menu-item-parent")):b.$parentId&&(n="leaf"),b.$level?(b.$parentId||i.addClass(k,"level"),i.addClass(k,"level-"+b.$level)):m&&i.addClass(k,"level"),n){var q=null;if(a.options.styles&&a.options.styles[n]&&(q=a.options.styles[n]),q){var r=[];i.parseStyle(q,r),r.length&&(k.className=k.className+" "+r.join(" "))}}var s=k.firstChild,t=p||l?s.firstChild:s;if(b.$title){var u=b.$icon?" "+b.$title:b.$title;i.text(t,u)}if(b.selected&&i.addClass(k,"active"),p&&(i.attr(s,"data-phoenix-href","click://"+j),a._canClick(b)||i.removeClass(s,"link")),a.options.canExpandItems){if(l){i.attr(k,"data-phoenix-href","click://collapse/"+j);var v=document.createElement("span");v.id=b.$id+"_collapse",v.className=c(b),i.append(k,v)}a.isVisible(b)||i.addClass(k,"bs-none")}if(b.$icon){var w=i.icon(b.$icon);i.addClass(w,"bs-icon-menu"),s.insertBefore(w,s.firstChild)}}if(b.$firstGroup){var x=document.createElement("span");x.className="bs-menu-button bs-menu-right-icon bs-none "+i.iconPrefix(),i.attr(x,"data-phoenix-href","click://close"),i.append(k,x)}k.id=b.$id,d.appendChild(k)}})}return a._updateCloseButton(b),b},b.prototype.updateItemsAfterCollapse=function(){var a=this;a.$element&&a.items&&a.options.canExpandItems&&a.items.forEach(function(b,d){if(!b.isHidden){var e=b.$items&&b.$items.length,f=a.isVisible(b),g=i.find(a.$element.get(0),b.$id);if(g){var h=!i.hasClass(g,"bs-none");if(f!==h&&(f?i.removeClass(g,"bs-none"):i.addClass(g,"bs-none")),e){var j=i.find(a.$element.get(0),b.$id+"_collapse");if(j){var k=c(b);j.className!==k&&(j.className=k)}}}}})},b.prototype._executeLink=function(a,b){var c,e=this,f=d.context();if(a.$dataset&&(c=e.datasets[a.$dataset],f.$item=a.$item),c&&a.$link&&a.$link.$datasetSelect)c.selectedIndex!=a.$index&&(c.selectedIndex=a.$index,e.ds_select(a.$dataset,a.$item),e._selectDatasetItem(a.$dataset,a));else if(a.$link)return d.execLink(a.$link,f,null)},b.prototype._onPageChanged=function(){var a=this;if(a.items){var b=a.page.currentPage(),c=null;a.items.forEach(function(e,g){if(e.$link&&e.$link.$page){var h=d.pageName(e.$link),i=h==b;i&&e.$link.$module&&(i=e.$link.$module===f.name),e.selected!==i&&(e.selected=i,e.selected||a._changeSelected(e)),i&&(c=e)}}),c&&(a._changeSelected(c),a._expandSelected(c))}},b}(a.menubase.MenuBase);b.Menu=j,b.Menuleft=j,b.Menuright=j}(b=a.menu||(a.menu={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/sticky.ts" />
/// <reference path="../core/modules/ajax.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../ui/page.control.ts" />
var Phoenix;!function(a){var b,c=a,d=c.pagecontrol,e=(c.external,c.ulocale),f=c.utils,g=c.locale,h=(c.ajax,c.dom),i=c.sticky,j=(c.ui,c.build),k=c.application,l=(c.render,c.link);!function(a){var b=function(a){var b=[],d=c.bootstrap4,e=["navbar-fixed-top no-y-margin no-x-margin"];return b.push('<div class="'+e.join(" ")+'">'),e=["bs-header-bar navbar  no-y-margin no-x-margin"],d?e.push("navbar-dark bg-inverse no-x-padding no-y-padding"):e.push("navbar-inverse"),b.push('<nav class="'+e.join(" ")+'">'),b.push('    <div class="container-fluid no-x-padding">'),b.push('        <div class="bs-title bs-title-nav-pos header_title"></div>'),b.push('        <ul class="nav navbar-nav no-x-margin no-y-margin bs-nav-button bs-left-nav header_left_buttons">'),b.push("        </ul>"),b.push('        <ul class="nav navbar-nav no-x-margin no-y-margin bs-nav-button bs-right-nav header_right_buttons">'),b.push("        </ul>"),b.push("    </div>"),b.push("</nav>"),a.showLocation&&b.push('<div class="bs-header-location"><span class="bs-location-buttons"></span><span class="bs-header-location-title">&nbsp;</span></div>'),b.push("</div>"),$(b.join(""))},m=function(a){return"logout"===a.$pattern&&(a.icon="lock",a.title=g.ui.Disconnect,a.link={$logout:!0},delete a.$pattern),a},n=function(a,b){var d=[],g=c.bootstrap4,i=g?"hidden-xs-down":"hidden-xs";a.id=f.allocID();var j=a.title;if(j&&"object"==typeof j&&(j=j[e.currentLang]),a.$location)d.push('<span id="{1}" class="bs-loc-link {2}" href="#" data-phoenix-href="click://{0}" ><span>');else{if(d.push('<li id="{1}">'),"logo"===a.$type)a.$location||d.push('<a tabindex="-1" class="'+i+" bs-nav-logo "+a.$className+'" href="#" data-phoenix-href="click://{0}"></a>');else{var k=[];a.iconStyle?h.parseStyle(a.iconStyle,k):k.push("bs-style-icon-lg"),a.title||a.expression?(d.push('<a class="bs-nav-link"'),d.push('  href="#" data-phoenix-href="click://{0}"'),d.push(">"),k.push("{2}"),d.push('<span class="'+k.join(" ")+'"></span>'),k=["bs-icon-header-title"],g&&k.push("dropdown-toggle"),d.push('<span class="'+k.join(" ")+'"><span class="'+i+'">{3}</span>'),g&&k.push("dropdown-toggle"),a.menu&&d.push(' <span class="caret"></span>'),d.push("</span>"),d.push("</a>"),a.menu&&a.menu.items&&(g?(d.push('<div class="dropdown-menu bs-right-menu">'),d.push("</div>")):(d.push('<ul class="dropdown-menu bs-right-menu">'),d.push("</ul>")))):(d.push('<a class="bs-nav-link" href="#"  data-phoenix-href="click://{0}">'),k.push("{2}"),d.push('<span class="'+k.join(" ")+'"></span>'),d.push("</a>"))}d.push("</li>")}return a.link&&a.link.$form&&(a.link.$form.alignElementId=a.id),$(f.format(d.join(""),b,a.id,h.customIconClass(a.$icon,a.$iconClass),j||a.expression||""))},o=function(a,b){var d=document.createDocumentFragment(),f=c.bootstrap4,g=$(f?'<a class="dropdown-item" href="#"></a>':'<li><a href="#"></a><li>').get(0);a.menu.items.forEach(function(b,c){b.$pattern&&(a.menu.items[c]=m(b),b=a.menu.items[c]);var i=g.cloneNode(!0),j=f?i:i.firstChild;if(h.attr(j,"data-phoenix-href","click://"+a.$index+"/"+c),b.icon){var k=document.createElement("span");k.className=h.iconClass(b.icon),h.append(j,k)}var l=b.title;"object"==typeof b.title&&(l=b.title[e.currentLang]),h.text(j," "+(l||"Error: title not defined")),h.append(d,i)}),h.append(b,d)},p=function(){function a(a,b){this._init(a,b)}return a.prototype.setLocation=function(a,b){var c=this;c.options.showLocation&&(c._locationTimeOut&&window.clearTimeout(c._locationTimeOut),c._locationTimeOut=window.setTimeout(function(){c._locationTimeOut=0,c._location!==a&&(c._location=a||"",c.$location&&h.text(c.$location.get(0).lastChild,c._location))},100))},a.prototype._init=function(a,b){var c=this;c.title="",c._ctx=l.context(),c._ignoreClick=!1,c.leftButtonsSpace=0,c.rightButtonsSpace=0,c.$location=null,c.$element=null,c.$buttons=[],c.options=b||{},c.page=d.Page(),c.title=k.title||"";var e=k.configuration,f=e&&e.header?e.header:{};if(void 0!==c.options.showOnDisconnected?c.options.showOnDisconnected=c.options.showOnDisconnected:c.options.showOnDisconnected=f.alwaysShow,void 0!==f.showLocation&&(c.options.showLocation=f.showLocation),void 0!==f.leftMenuButtonInLocation&&(c.options.leftMenuButtonInLocation=f.leftMenuButtonInLocation),void 0===c.options.backButton&&(c.options.backButton=!0),void 0===c.options.leftMenuButton&&(c.options.leftMenuButton=!0),void 0===c.options.topMenuButton&&(c.options.topMenuButton=!0),void 0===c.options.disconnectButton&&(c.options.disconnectButton=!0),f.logo){var g={$isHidden:!1,$type:"logo"},h="";"string"==typeof f.logo?h=f.logo:(h=f.logo.style,g.link=f.logo.link),g.$className=h,c.$buttons.push(g)}f.buttons&&f.buttons.before&&f.buttons.before.forEach(function(a){c.$buttons.push({$icon:a.icon,right:a.right,auth:a.auth,link:a.link,title:a.title})}),c.options.backButton&&c.$buttons.push({$icon:"chevron-left",$isHidden:!c.page.props.$hasBack&&!c.options._alwaysShowBack,$type:"back",link:{$back:!0}}),c.options.leftMenuButton&&c.$buttons.push({auth:f.authLeftMenu,$isHidden:!0,$icon:"bars",$type:"menuleft",$parent:c.options.leftMenuPlace,$location:c.options.showLocation&&c.options.leftMenuButtonInLocation}),c.options.disconnectButton&&(f.userMenu?c.$buttons.push({$icon:"user",iconStyle:"$icon-normal",right:!0,auth:!0,menu:$.extend(!0,{},f.userMenu),expression:f.userMenu.expression||"John Doe",$type:"user"}):c.$buttons.push({$icon:"power-off",right:!0,auth:!0,$type:"disconnect",link:{$logout:!0}})),c.$buttons.push({$icon:"pencil",right:!0,auth:!0,$isHidden:j.release,$type:"authoring",link:{$authoring:!0}}),j.release||c.$buttons.push({$icon:"cog",title:"Utils",right:!0,auth:!0,menu:{items:[{title:"Create a new form",icon:"building",link:{$action:{name:"phoenix.action.createform"}}},{title:"Modify form schema",icon:"pencil",link:{$action:{name:"phoenix.action.updschema"}}}]}}),c.options.rightMenuButton&&c.$buttons.push({auth:!0,$isHidden:!0,$icon:"ellipsis-v",$type:"menuright",$parent:c.options.rightMenuPlace}),c.options.topMenuButton&&c.$buttons.push({auth:!0,$isHidden:!0,$icon:"chevron-down",$type:"menutop",right:!0,$parent:c.options.topMenuPlace}),f.buttons&&f.buttons.after&&f.buttons.after.forEach(function(a){c.$buttons.push({$icon:a.icon,right:a.right,auth:a.auth,link:a.link,title:a.title})}),c.page.addChild("header",c),c.setData(a)},a.prototype._show=function(){var a=this,b=c.sessionPreferences("headerisHidden");return!a._ctx.$url.$inline&&!b||(b||c.sessionPreferences("headerisHidden",!0),!1)},a.prototype.setData=function(a){
//var that = this;
a=a||{}},a.prototype.buttonByType=function(a){for(var b=this,c=0,d=b.$buttons.length;c<d;c++){var e=b.$buttons[c];if(e.$type==a)return e}return null},a.prototype._createButtons=function(){var a=this;if(a.$element){var b=a.$element.get(0),c=h.query(b,".header_left_buttons"),d=h.query(b,".header_right_buttons"),e=a.$location?h.query(a.$location.get(0),".bs-location-buttons"):null;a.$buttons.forEach(function(a,b){a.$index=b;for(var f=n(a,b),g=a.$location?e:a.right?d:c,i=0,j=f.length;i<j;i++)h.append(g,f.get(i))})}},a.prototype._updateButtons=function(){var a=this,b=c.bootstrap4,d=12;if(//px
b&&(d=h.rem2px(.8571)),a.$element){var e=a.page.props.$user&&a.page.props.$user.connected,g=d,i=d,j=a.$element.get(0);a.$buttons.forEach(function(b){var c=h.find(j,b.id);if(b.$isHidden||!e&&b.auth)h.addClass(c,"bs-none");else{if("user"===b.$type){var d=f.execAngularExpression(b.expression,a.page.props.$user.credentials);if(d!==b.title){b.title=d;var k=h.query(c,".bs-icon-header-title");k&&h.text(k.firstChild,d)}}h.removeClass(c,"bs-none"),b.$location||(b.right?i+=h.offset(c).width:g+=h.offset(c).width)}}),a.leftButtonsSpace===g&&a.rightButtonsSpace===i||(a.leftButtonsSpace=g,a.rightButtonsSpace=i,a._updateTitleSpaceMargins())}},a.prototype._updateTitleSpaceMargins=function(){var a=this;if(a.$element){var b=a.$element.get(0),c=h.query(b,".header_title");c.style.marginLeft=a.leftButtonsSpace+"px",c.style.marginRight=a.rightButtonsSpace+"px"}},a.prototype.inPopup=function(a){var b=this;if(b._ob){var c=h.find(b.$element.get(0),b._ob.id);return h.isChildOf(c,a)}return!1},a.prototype.hide=function(a){var b=this;if(b._ob){var c=h.find(b.$element.get(0),b._ob.id);h.removeClass(c.lastChild,"bs-block"),b._ob=null}},a.prototype._openPopup=function(a){var b=this;b.page.setPopup(b),b._ob=a;var c=h.find(b.$element.get(0),a.id);h.addClass(c.lastChild,"bs-block")},a.prototype._executeLink=function(a,b){var c=this;if(a.menu){var d=h.find(c.$element.get(0),a.id);if(d&&d.lastChild&&(d.lastChild.childNodes.length||o(a,d.lastChild)),!(b>=0)){if(c._ob){if(c._ob===a)return void c.page.setPopup(null);c.page.setPopup(null)}if(d&&d.lastChild){var e=d.lastChild;e.style.minWidth=Math.max(h.offset(d).width,160)+"px"}return c._openPopup(a)}var f=a.menu.items[b];f.link&&l.execLink(f.link,l.context(),null),c.page.setPopup(null)}else if(a.link)return l.execLink(a.link,l.context(),null);if(["menuleft","menuright","menutop","menubottom"].indexOf(a.$type)>=0&&a.$parent&&c.page){var g=c.page.childByType("menu-"+a.$type.substring(4));g&&g.show($(h.find(null,a.$parent)))}},a.prototype._onresize=function(){var a=this;a.$element&&a._updateButtons()},a.prototype._setEvents=function(){var a=this,b=a.$element.get(0);a.$element.on("mousedown",function(c){var d=l.isCustomLink(b,c,!0);if(d&&"click"===d.protocol){var e=d.value.substring("click://".length).split("/"),f=(e.length>1?parseInt(e[1],10):-1,a.$buttons[parseInt(e[0],10)]);if(f&&["menuleft","menuright","menutop","menubottom"].indexOf(f.$type)>=0&&f.$parent&&a.page){var g=a.page.childByType("menu-"+f.$type.substring(4));a.page.popup===g&&(a._ignoreClick=!0)}}}),a.$element.on("click",function(c){var d=l.isCustomLink(b,c);if(a._ignoreClick)return void(a._ignoreClick=!1);if(d&&"click"===d.protocol){var e=d.value.substring("click://".length).split("/"),f=e.length>1?parseInt(e[1],10):-1,g=a.$buttons[parseInt(e[0],10)];if(a._executeLink(g,f),g&&"logo"===g.$type){var h=document.activeElement;h&&h.blur()}}}),$(window).on("resize.header",function(){clearTimeout(a._doResize),a._doResize=setTimeout(a._onresize.bind(a),100)})},a.prototype.setPage=function(a,b){var c=this;if(j.release){var d=k.isCustomizable("pages",a),e=c.buttonByType("authoring");e&&e.$isHidden!=!d&&(e.$isHidden=!d,c._updateButtons())}},a.prototype.onPageChange=function(a,b){var c,d=this;switch(a){case"$title":d.title=b||k.title||"",d._renderTitle();break;case"$hasBack":d.options._alwaysShowBack&&(b=!0),d.options.backButton&&(c=d.buttonByType("back"),c&&c.$isHidden!==!b&&(c.$isHidden=!b,d._updateButtons()));break;case"$user":d._auth(!1),d._updateButtons();break;case"$menuleft":d.options.leftMenuButton&&(c=d.buttonByType("menuleft"),c&&c.$isHidden==b&&(c.$isHidden=!b,d._updateButtons()));break;case"$menutop":d.options.topMenuButton&&(c=d.buttonByType("menutop"),c&&c.$isHidden==b&&(c.$isHidden=!b,d._updateButtons()))}},a.prototype._removeEvents=function(){var a=this;a.$element.off("mousedown"),a.$element.off("click"),$(window).off("resize.header")},a.prototype.renderButtons=function(){var a=this;a._createButtons(),a._updateButtons(),f.nextTick(function(){})},a.prototype._renderTitle=function(){var a=this;if(a.$element){var b=a.$element.get(0),c=h.query(b,".header_title");h.text(c,a.title||"")}},a.prototype._auth=function(a){var b=this;if(b.$parent&&b._show()){var c=b.$parent.get(0),d=b.$element.get(0),e=b.page.props.$user&&b.page.props.$user.connected,f=!1;if(e?(f=!0,h.removeClass(d,"bs-none")):b.options.showOnDisconnected?(f=!0,h.removeClass(d,"bs-none")):h.addClass(d,"bs-none"),!a){var g=h.offset(b.$element.get(0));i.topOffset=f?g.height:0,c.style.paddingTop=f?g.height+"px":"0px"}}},a.prototype.render=function(a){var c=this;if(c._show()&&a&&!this.$element){c.$element=b(c.options);var d=c.$element.get(0);c.options.showLocation&&(c.$location=$(d.lastChild));var e=k.configuration,g=e&&e.header?e.header:{},j=h.query(d,".header_title");g.uppercase&&h.addClass(j,"bs-transform-uppercase"),g.align&&h.addClass(j,"align-"+g.align),c._renderTitle(),c.renderButtons();var l=a.get(0);c.options.replaceParent&&(l=l.parentNode),c.$parent=$(l),c._auth(!0),c.options.replaceParent?a.replaceWith(c.$element):a.append(c.$element),c._setEvents();var m=h.offset(c.$element.get(0));i.topOffset=m.height,l.style.paddingTop=m.height+"px",f.nextTick(function(){c._onresize()})}},a.prototype.destroy=function(){var a=this;f.log("Header Destroy","destroy"),this.$parent=null,a.$element&&(a._removeEvents(),this.$element=null),a.page&&(a.page.removeChild(a),a.page=null)},a}();a.Header=p}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="./page.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.pagecontrol,e=c.dom,f=c.link,g=c.utils,h=c.application,i=c.ulocale,j=(c.locale,function(){function a(a,b){var c=this,e={justified:!1,pills:!1};c._page=d.Page(),c._options=$.extend(e,a||{}),c._tabs=b||[]}return a.prototype._renderTabs=function(){var a=this,b=a.$element.get(0),c=b.firstChild,d=document.createDocumentFragment(),j=$('<li><a href="#"></a><li>').get(0),k=a._page.currentPage();a._tabs.forEach(function(a,b){var c=j.cloneNode(!0),l=c.firstChild;e.text(l,i.localeTitle(a.$title));var m=!1;if(void 0!==a.enabled)if("string"==typeof a.enabled){var n=g.execAngularExpression(a.enabled,f.context());n&&"undefined"!==n&&"false"!==n||(m=!0)}else m=!a.enabled;if(m?e.addClass(c,"disabled"):e.attr(l,"data-phoenix-href","click://"+b),a.$page){var o=f.pageName(a),p=o==k;p&&a.$module&&(p=a.$module===h.name),p?a.active=!0:a.active=!1}a.active&&e.addClass(c,"active"),d.appendChild(c)}),e.empty(c),e.append(c,d)},a.prototype._setEvents=function(){var a=this;if(a.$element){var b=a.$element.get(0);a.$element.on("click",function(c){var d=f.isCustomLink(b,c);if(d&&"click"===d.protocol){var e=d.value.substring("click://".length),g=e.split("/"),h=f.context(),i=a._tabs[parseInt(g[0],0)];i&&i.$page&&!i.disabled&&f.execLink(i,h,null)}})}},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype.render=function(a){var b=this;b.$element||(b.$element=$('<div class="bs-widget-content-inv bs-tabs"><ul class="nav nav-tabs"><ul></div>'),b._renderTabs(),b._setEvents()),a&&(b._options.replaceParent?a.replaceWith(b.$element):a.append(b.$element))},a.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a._options=null,a._page=null},a}());b.Tabs=j}(b=a.tabs||(a.tabs={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/modules/sticky.ts" />
/// <reference path="../core/core.ts" />
var Phoenix;!function(a){var b;!function(b){b.LAYOUT_BLOCK="block",b.LAYOUT_ROW="row",b.LAYOUT_COLUMN="column",b.LAYOUT_HTML="html",b.LAYOUT_ACCORDION="accordion",b.LAYOUT_ACCORDION_GROUP="accordion-group";var c="No title",d=a,e=d.dom,f=d.utils,g=d.locale.layouts,h=d.ulocale,i=d.render,j=d.sticky,k=function(a){a.$items.length||(a.$type=b.LAYOUT_BLOCK,a.$origin=b.LAYOUT_ROW)},l=function(a,d,e,h){switch(a.$id||(a.$id=f.allocID()),d&&(a.$parentId=d.$id),a.$idDesign=a.$id,a.$idDrag=a.$id,a.$type=a.$type||b.LAYOUT_BLOCK,a.$items=a.$items||[],v(a)||(delete a.$inline,delete a.$fieldsOptions),e&&(e[a.$id]=a),h&&a.$name&&(h[a.$name]=a),a.$type!==b.LAYOUT_HTML||a.$html||(a.$html=g.Html),a.$type){case b.LAYOUT_ROW:k(a)}a.$origin&&a.$origin===a.$type&&delete a.$origin,a.$type!==b.LAYOUT_ACCORDION_GROUP&&a.$title&&a.$title.value===c&&delete a.$title},m=function(a){return a.$type!==b.LAYOUT_ACCORDION_GROUP||a.opened},n=function(a,b,c,d){a.$id||(a.$id=f.allocID()),b&&(a.$parentId=b.$id),a.$idDrag=a.$id,c&&(c[a.$id]=a),d&&a.$name&&(d[a.$name]=a)},o=function(a){k(a);var c=!1;if(a.$items.forEach(function(a){a.$type=b.LAYOUT_COLUMN,a.$colSize||(c=!0)}),c){var d=Math.max(1,Math.floor(12/a.$items.length)),e=a.$items.length-1,f=0;a.$items.forEach(function(a,b){b===e&&(d=12-f),a.$colSize=d,f+=d})}},p=function(a){a.$items.length||a.$items.push({$type:b.LAYOUT_ACCORDION_GROUP}),a.$items.forEach(function(a,d){a.$type=b.LAYOUT_ACCORDION_GROUP,a.$title=a.$title||{},a.$title.value=a.$title.value||c})},q=function(a){if(a.$type===b.LAYOUT_HTML)return!1;if(a.$items.length>0){var c=a.$items[0];if(!c.$items)return!1}return!0},/*
        _hasBorder = function(layout) {
        },
        */
r=function(a,c){return a.$type===b.LAYOUT_ACCORDION&&!a.$widget},s=function(a,c){var e=!0,f=d.bootstrap4;return a.$items.length?!(a.$type===b.LAYOUT_ACCORDION_GROUP&&!a.$widget&&!f)&&(a.$items.forEach(function(b){e&&(e=!r(b,a))}),e):e},t=function(a){if(a.$type&&!a.$items&&(a.$items=[]),a.$type===b.LAYOUT_ROW||a.$type===b.LAYOUT_ACCORDION||a.$type===b.LAYOUT_HTML)return!1;if(a.$items.length>0){var c=a.$items[0];if(c.$type||c.$items)return!1}return!0},u=function(a,b,c){var d=a.$style;!d&&a.$sticky&&(d="$white"),e.parseStyle(d,b),!c.design&&a.$isHidden&&b.push("bs-none")},v=function(a){return!a.$items||!a.$items.length||a.$items[0].$bind},w=function(a,c,e,f,g){var h,i,k=d.bootstrap4;switch(a.$type){case b.LAYOUT_BLOCK:i=!0,e.design&&a.selected&&f.push("selected"),h=q(a),h&&((e.design||s(a,c))&&(i=!1,c&&f.push("no-x-padding")),e.design&&(f.push("drop-layouts-zone"),a.$origin===b.LAYOUT_ROW&&f.push("row-color"))),t(a)&&(!a.$inline||!e.design&&a.$html||f.push("form-inline bs-inline-container"),e.design&&(f.push("drop-fields-zone"),h||(i=!1,c&&f.push("no-x-padding")))),i&&f.push("field-container"),c||(f.push("bs-root-container"),a.form||f.push("page")),e.design&&(f.push("design"),a.selected&&f.push("selected")),u(a,f,e),!e.design&&a.$sticky&&j&&j.native&&(f.push("bs-sticky"),"top"===a.$sticky?g.push("top:"+j.topOffset+"px;"):"bottom"===a.$sticky&&g.push("bottom:"+j.bottomOffset+"px;"));break;case b.LAYOUT_ACCORDION:1===e.step&&(f.push("panel-group bs-island"),e.design&&(f.push("design"),f.push("drop-layouts-zone"),a.selected&&f.push("selected")),u(a,f,e));break;case b.LAYOUT_ROW:1===e.step?(f.push("container-fluid"),e.design&&(f.push("design"),f.push("no-x-padding"),a.selected&&f.push("selected")),u(a,f,e)):2===e.step&&(f.push(b.LAYOUT_ROW),e.design&&(f.push("design-table"),f.push("row-color"),h=q(a),h&&f.push("drop-layouts-zone")));break;case b.LAYOUT_ACCORDION_GROUP:1===e.step?(f.push("panel panel-default"),e.design&&(f.push("design"),a.selected&&f.push("selected"))):2===e.step?(f.push("panel-collapse collapse"),a.opened&&f.push("in")):3===e.step&&(k&&f.push("panel-body"),h=q(a),h&&((e.design||s(a,c))&&(f.push("no-x-padding"),f.push("no-y-padding")),e.design&&f.push("drop-layouts-zone")),t(a)&&(!a.$inline||!e.design&&a.$html||f.push("form-inline bs-inline-container"),e.design&&(f.push("drop-fields-zone"),h||f.push("no-x-padding"))),u(a,f,e));break;case b.LAYOUT_COLUMN:1===e.step?(e.design?f.push("col-design col-xs-"+a.$colSize):a.$customColSize?f.push(a.$customColSize):f.push("col-"+(a.$colType||"sm")+"-"+a.$colSize),f.push("no-x-padding")):2===e.step&&(i=!0,f.push("container-fluid"),h=q(a),h&&((e.design||s(a,c))&&(i=!1,f.push("no-x-padding")),e.design&&!a.$auto&&f.push("drop-layouts-zone")),t(a)&&(!a.$inline||!e.design&&a.$html||f.push("form-inline bs-inline-container"),e.design&&(f.push("drop-fields-zone"),h||(f.push("no-x-padding"),i=!1))),i&&f.push("field-container"),e.design&&(f.push("design col"),a.$auto&&f.push("auto"),a.selected&&f.push("selected")),u(a,f,e));break;case b.LAYOUT_HTML:e.design&&(f.push("design"),a.selected&&f.push("selected")),u(a,f,e)}},x=function(a,c,d,f){var g,h=[],i=[];w(c,d,f,h,i),a.className=h.join(" "),i.length&&(a.style=i.join(" ")),c.$type===b.LAYOUT_ACCORDION_GROUP&&1===f.step?(g=e.find(a,c.$id+"_title"),g&&e.text(g,c.$title&&c.$title.value?c.$title.value:"")):c.$type===b.LAYOUT_HTML&&1===f.step&&(a.innerHTML=c.$html||"")},y=function(a,b,c,d){var e=[],f=[];w(b,c,d,e,f),e.length&&(a.push(' class="'),a.push(e.join(" ")),a.push('"')),f.length&&(a.push(' style="'),a.push(f.join(" ")),a.push('"'))},z=function(a,b,c){a.push(' id="'),a.push(c?c+"_"+b.$id:b.$id),a.push('"')},A=function(a,b,c){c&&(a.push(' data-level="'),a.push(b),a.push('"'))},B=function(a,b,c,d,e){if((e||d)&&(a.push(' data-layout="'),a.push(c.$id),a.push('"'),c.$idSelect=null),e||d&&b>1){var f=c["$idStep"+b];f&&(a.push(' id="'),a.push(f),a.push('"'))}},C=function(a,b,g,i){if(b.$title&&b.$title.value===c)return void delete b.$title;if(i&&b.$title){var j=b.$title.size||(d.bootstrap4?5:4);a.push("<h"+j);var k=["bs-block-title"];b.$title.$style&&e.parseStyle(b.$title.$style,k),a.push(' data-ignore="true" class="'+k.join(" ")+'">'),b.$title.value&&a.push(f.escapeHtml(h.tt(b.$title.value,g))),a.push("</h"+j+">")}},D=function(a,b,c,d,e,f,g,h){a.push("<div"),f&&a.push(' draggable="true"'),y(a,b,c,{design:f,step:1}),B(a,1,b,f),z(a,b),A(a,1,f),a.push(">"),C(a,b,e,g)},E=function(a,b,c,d,e,f){a.push("</div>")},F=function(a,b,c,d,g,h){a.push(f.format('<div id="{0}_settings" class="bs-cursor-p bs-layout-detail" data-layout-detail="true"><span class="'+e.iconClass("cog")+'"></span></div>',b.$id))},G=function(a,b,c,d,e,f,g){a.push("<div"),f&&a.push(' draggable="true"'),y(a,b,c,{design:f,step:1}),B(a,1,b,f),z(a,b),A(a,1,f),a.push(">"),b.$html&&a.push(b.$html)},H=function(a,b,c,d,e){a.push("</div>")},I=function(a,b,c,e,g,h,i,j){var k=d.bootstrap4;if(k){a.push('<li class="nav-item">');var l=["nav-link"];b.opened&&l.push("active"),a.push(f.format('<a class="'+l.join(" ")+'" href="#{0}" data-layout="{0}" aria-expanded="'+(b.opened?"true":"false")+'" role="tab" data-toggle="tab">',b.$id)),a.push(b.$title.value),a.push("</a></li>")}else a.push('<li role="presentation"'),b.opened&&a.push(' class="active"'),a.push(">"),a.push(f.format('<a href="#{0}" aria-controls="{0}"  data-layout="{0}" role="tab" data-toggle="tab">',b.$id)),a.push(b.$title.value),a.push("</a></li>")},J=function(a,b,c,d,e,f,g,h){if(p(b),f||!b.$widget)a.push('<div role="tablist" aria-multiselectable="true"'),f&&a.push(' draggable="true"'),y(a,b,c,{design:f,step:1}),B(a,1,b,f),z(a,b),A(a,1,f),a.push(' id="'+b.$id+'_parent"'),a.push(">");else{if("tabs"!==b.$widget)throw"Invalid accordion $widget.";
// design is allways false
a.push("<div"),f&&a.push(' draggable="true"'),y(a,b,c,{design:f,step:1}),B(a,1,b,f),z(a,b),A(a,1,f),a.push(">"),a.push('<ul class="nav nav-tabs bs-tabs" role="tablist">'),b.$items.forEach(function(c){return I(a,c,b,d,e,f,g,h)}),a.push("</ul>"),a.push('<div class="tab-content">')}},K=function(a,b,c,d,e,f){f||!b.$widget?a.push("</div>"):"tabs"===b.$widget&&(a.push("</div>"),//tab-content"
a.push("</div>"))},L=function(a,b,c,e,g,h,i,j){if(h||!c.$widget){var k=d.bootstrap4;a.push("<div"),y(a,b,c,{design:h,step:1}),B(a,1,b,h),z(a,b),A(a,1,h),
//_addId(html, layout);
b.$idStep2=b.$id+"_s2",b.$idStep3=b.$id+"_s3",b.$idDesign=b.$idStep3,h&&a.push(' draggable="true"'),a.push(">"),a.push('<div class="panel-heading" role="tab"'),z(a,b,"heading"),a.push(">"),k?a.push('<h5 class="panel-title">'):(a.push('<h4 class="panel-title bs-pointer collapsed" data-toggle="collapse" data-parent="#'+c.$id+'"'),b.opened?a.push(' aria-expanded="true"'):a.push(' aria-expanded="false"'),a.push(' data-target="#'+b.$idStep2+'" aria-controls="'+b.$idStep2+'"'),a.push(' id="'+b.$id+'_title">')),k&&(a.push("<a"),a.push(' data-toggle="collapse"'),a.push(' data-parent="#'+c.$id+'"'),a.push(' href="#'+b.$idStep2+'"'),a.push(' aria-controls="'+b.$idStep2+'"'),b.opened?a.push(' aria-expanded="true"'):a.push(' aria-expanded="false"'),a.push(">")),a.push(f.escapeHtml(b.$title?b.$title.value:"")),k?a.push("</a></h4>"):a.push("</h5>"),a.push("</div>"),a.push('<div role="tabpanel" aria-labelledby="heading_'+b.$id+'"'),y(a,b,c,{design:h,step:2}),B(a,2,b,h,!0),A(a,2,h),a.push(">"),a.push("<div"),y(a,b,c,{design:h,step:3}),B(a,3,b,h,!0),a.push(">")}else if("tabs"===c.$widget){var l=["tab-pane fade"];b.opened&&l.push("in active"),a.push('<div role="tabpanel"'),a.push('< class="'+l.join(" ")+'"'),b.$idDesign=b.$id,z(a,b),a.push(">")}},M=function(a,b,c,d,e,f){f||!c.$widget?a.push("</div></div></div>"):"tabs"===c.$widget&&a.push("</div>")},N=function(a,b,c,d,e,f,g,h){a.push("<div"),f&&a.push(' draggable="true"'),y(a,b,c,{design:f,step:1}),z(a,b),B(a,1,b,f),A(a,1,f),a.push(">"),b.$idStep2=b.$id+"_s2",b.$idDesign=b.$idStep2,a.push("<div"),y(a,b,c,{design:f,step:2}),B(a,2,b,f),A(a,2,f),a.push(">"),o(b)},O=function(a,b,c,d,e,f){a.push("</div></div>")},P=function(a,b,c,d,e,f,g,h){a.push("<div"),y(a,b,c,{design:f,step:1}),B(a,1,b,f),z(a,b),A(a,1,f),a.push(">"),a.push("<div"),y(a,b,c,{design:f,step:2}),f&&a.push(' draggable="true"'),b.$idDesign=b.$id+"_design",b.$idDrag=b.$id,b.$idStep2=b.$idDesign,B(a,2,b,f),A(a,2,f),b.$idSelect=b.$idDesign,a.push(">"),C(a,b,e,g)},Q=function(a,b,c,d,e,f){a.push("</div></div>")},R=function(a,b,c,d,e){if(a){if(d&&!a.$type&&!a.$items)return void c(a,b,!1,!0,e);c(a,b,!0,!0,e),e&&e.stop||(t(a)?a.$items&&a.$items.forEach(function(b){c(b,a,!1,!0,e)}):a.$items&&a.$items.forEach(function(b){R(b,a,c,!1,e)})),c(a,b,!0,!1,e)}},S=function(a,b,c,d,e){a.push('<div class="bs-island'+(e.design?" design":"")+(b.$config?" bs-widget":" bs-field")+(b.selected?' selected"':'"')),e.design&&a.push(' draggable="true"'),a.push(' data-render="'+b.$id+'"'),a.push(' id="'+b.$id+'"'),a.push("></div>")},T=function(a,b,c,d,e){a.push('<div id="'+b.$id+'"></div>')},U=function(a,c,d,e,g,h){var j=i.get(g.context,"widget")||T,k=i.get(g.context,"field")||S,l=a.form,n={html:d};R(a,null,function(a,d,i,n,o){if(i){var p=D,q=E;switch(a.$type){case b.LAYOUT_ROW:p=N,q=O;break;case b.LAYOUT_COLUMN:p=P,q=Q;break;case b.LAYOUT_ACCORDION:p=J,q=K;break;case b.LAYOUT_ACCORDION_GROUP:p=L,q=M;break;case b.LAYOUT_HTML:p=G,q=H}n?(a.$ref&&g.design&&(o.stop=!0),p(o.html,a,d,c,e,g.design,l,o.stop),o.stop&&F(o.html,a,d,c,e,g.design),m(a)||(a.oldHtml=o.html,o.html=[]),h&&h(a)):(m(a)||(a.$content=o.html,o.html=a.oldHtml,delete a.oldHtml),!g.design&&a.$html&&a.$items&&a.$items.length&&t(a)&&o.html.push(f.format(a.$html.replace(/id="/g,'id="{0}_'),a.$id)),q(o.html,a,d,c,e,g.design),a.$ref&&g.design&&(o.stop=!1))}else a.$config?j(o.html,a,d,c,g):k(o.html,a,d,c,g)},!0,n)},V=function(a,c){return!a.$auto&&(a.$type!==b.LAYOUT_COLUMN||1!==c)},W=function(a,b,c,d,e,f){R(a,b,function(a,b,g,h){h&&(g?l(a,b,c,e):n(a,b,d,f))},!0)},X=function(a,c){R(a,null,function(d,e,f,h){if(h)if(f){if(c&&delete d.$id,delete d.$render,delete d.$idDesign,delete d.$idDrag,delete d.$idSelect,delete d.$parentId,delete d.$idStep2,delete d.$idStep3,delete d.$content,delete d.selected,d.$type!==b.LAYOUT_BLOCK&&(delete d.$sticky,d.$type===b.LAYOUT_COLUMN?delete d.$type:a.$type===b.LAYOUT_HTML&&a.$html===g.Html&&delete a.$html),d.$inline===!1&&delete d.$inline,d.$fieldOptions){var i=!0;d.columns===!1?delete d.columns:i=!1,d.titleIsHidden===!1?delete d.titleIsHidden:i=!1,i&&0===Object.keys(d.$fieldOptions).length&&delete d.$fieldOptions}}else delete d.$render,c&&delete d.$id,delete d.$parentId,delete d.$idDrag,delete d.selected,d.$config&&(d.$config.data&&(delete d.$config.data.ds,Object.keys(d.$config.data).length||delete d.$config.data),(d.$config.$titleIsHidden||d.$config.$dontSaveTitle)&&delete d.$config.$title)},!0)},Y=function(a,b,c,d,e){R(a,null,function(a,f,g,h){h&&(g?(delete b[a.$id],delete d[a.$id]):(delete c[a.$id],delete e[a.$id]))},!0)},Z=function(a,c,d,e,f){a.$type===b.LAYOUT_ROW?(a.$items.forEach(function(a){a.$type=b.LAYOUT_COLUMN,delete a.$colSize}),o(a),a.$items.forEach(function(b){W(b,a,c,d,e,f)})):a.$type===b.LAYOUT_ACCORDION&&(p(a),a.$items.forEach(function(b){W(b,a,c,d,e,f)}))},$=function(a,b,c,d,e){var f=[];return U(a,b,f,c,d,e),f.join("")};b.check=W,b.layoutVisible=m,b.clearMeta=X,b.clearMaps=Y,b.afterRemoveChild=Z,b.canSelect=V,b.updateCssClass=x,b.toHtml=$}(b=a.LayoutUtils||(a.LayoutUtils={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/sticky.ts" />
/// <reference path="./module.ts" />
/// <reference path="./datasets-plugin.ts" />
/// <reference path="./page.control.ts" />
/// <reference path="./layout.ts" />
/// <reference path="./menu.ts" />
var Phoenix;!function(a){var b,c=a,d=c.pagecontrol,e=c.menu,f=c.dom,g=c.utils,h=(c.locale,c.WidgetUtils,c.link),i=c.render,j=c.ipc,k=c.sticky,l=c.LayoutUtils;!function(b){var c=function(a){for(var b=a.length;b--;)for(var c=a[b],d=Object.keys(c),e=d.length;e--;){var f=c[d[e]];if(f.selected)return f}return null},m=function(){function a(a,b,c,d,e,f){b=this.initOptions(b),this.$locale=null,this._init(a,b)}/* Start datasets methods */
/* End datasets methods */
//convert blocks to columns
return a.prototype._afterCreate=function(){},a.prototype.initOptions=function(a){return a},a.prototype._init=function(a,b){
//Layout
var c=this;c.$element=null,c.$content=null,c.options=b||{},c.options.context=c.options.context||"javascript",c.map={},c.mapFields={},c.namedMap={},c.namedMapFields={},a=a||{},l.check(a,null,c.map,c.mapFields,c.namedMap,c.namedMapFields),c.data=a,c.data.form=c.options.form,a.map=c.map,a.fields=c.mapFields,c.children={},//Is used only in javascript mode to cleanup children
c.controls={},// list of instanced modules or controls   
c.expressionTitle=!1;var e=c.options.form;e||(c.page=d.Page(),c.page.setPopup(null),c.page.addChild("layout",c),c.options.design||(c.expressionTitle=g.hasExpression(a.$title),c.page.props.$title=a.$title?g.parseExpression(a.$title,h.context()):null)),c._setDesignListeners(),c.pageLayoutInit()},a.prototype.pageLayoutInit=function(){},a.prototype.getSchema=function(a){return null},a.prototype.getLookupForSchema=function(a,b){return null},a.prototype._setDesignListeners=function(){},a.prototype._removeEvents=function(){var a=this;a._removeBaseEvents()},a.prototype._addEvents=function(){var a=this;a._addBaseEvents()},a.prototype._removeBaseEvents=function(){var a=this;a._removeAccordionEvents()},a.prototype._addBaseEvents=function(){var a=this;a._setAccordionEvents()},a.prototype._onSelectedChanged=function(a,b,c){},a.prototype._showSelected=function(a,b){},a.prototype._setAccordionEvents=function(){var a=this;a.$element.on("show.bs.collapse hide.bs.collapse show.bs.tab hide.bs.tab",function(b){var c=b.target;if(c&&c.hasAttribute("data-layout")){var d=c.getAttribute("data-layout"),e=a.getLayoutById(d);if(e){var f="show"===b.type;if(e.opened===f)return;if(f){var g=a.getLayoutById(e.$parentId);if(g)for(var h=0,i=g.$items.length;h<i;h++){var j=g.$items[h];if(j.opened){j.opened=!1,a._activateLayout(j,!1);break}}e.opened=f,e.$content?(a._renderLayoutContent(e),a._afterVisibilityChanged({domChanged:!1,layoutCreated:!0,resize:!1})):a._activateLayout(e,!0)}else a._activateLayout(e,!1)}}})},a.prototype._doDatasetEventAfterEnabled=function(a){},a.prototype._activateLayout=function(a,b){var c,d=this;b?(c=d._getVisibleChildren(a),c.forEach(function(a){a.disabled=!1,d._doDatasetEventAfterEnabled(a)})):(
// disable all childrens
c=d._getChildrenOf(a),c.forEach(function(a){a.disabled=!0})),d._afterVisibilityChanged({domChanged:!0,layoutCreated:!1,resize:!1})},a.prototype._removeAccordionEvents=function(){var a=this;a.$element.off("show.bs.collapse hide.bs.collapse")},a.prototype.toString=function(a){return null},a.prototype.emit=function(a,b,c){this.emitDataEvent(a,b,c)},a.prototype.openErrors=function(){var a=this;if(a.$element){var b=f.find(a.$element.get(0),a.data.$id+"_error");b&&b.firstChild&&f.removeClass(b.firstChild,"bs-none")}},a.prototype._renderLayout=function(a){var b=this;b.stickies=null;var c=$(l.toHtml(a,null,b.$locale,{design:b.options.design,context:b.options.context},function(a){b.options.design||k.native||!a.$sticky||(b.stickies=b.stickies||{},b.stickies[a.$id]=a)}));return b.afterRender(c),b._renderChildren(c),b.afterRenderChildren(c),c},a.prototype.afterRenderChildren=function(a){},a.prototype.isChildOf=function(a,b){for(var c=this,d=c.map[a];d;){if(d==b)return!0;d=c.map[d.$parentId]}return!1},a.prototype._isChildVisibleOf=function(a,b){for(var c=this,d=c.map[a];d;){if(!l.layoutVisible(d))return!1;if(d==b)return!0;d=c.map[d.$parentId]}return!1},a.prototype._getVisibleChildren=function(a){var b=this,c=[];return Object.keys(b.controls).forEach(function(d){var e=b.controls[d];b.controls[d].item&&b._isChildVisibleOf(b.controls[d].item.$parentId,a)&&c.push(e)}),c},a.prototype._getChildrenOf=function(a){var b=this,c=[];return Object.keys(b.controls).forEach(function(d){var e=b.controls[d];b.controls[d].item&&b.isChildOf(b.controls[d].item.$parentId,a)&&c.push(e)}),c},a.prototype._getEventListFor=function(a){
//var that = this;
var b=[];return a.forEach(function(a){a.datasets&&Object.keys(a.datasets).forEach(function(c){var d=a.datasets[c];d.enumTriggers&&d.enumTriggers(!1,function(a){b.indexOf(a)<0&&b.push(a)})})}),b},a.prototype._refreshDataSets=function(a){},a.prototype._renderLayoutContent=function(a){var b=this,c=f.find(b.$element.get(0),a.$idDesign);if(c){var d=$(c),e=$(a.$content.join("")),g=c.parentNode,h=c.nextSibling;d.detach(),d.append(e),delete a.$content,b.options.beforeAdd&&b.options.beforeAdd(d,!0),g.insertBefore(c,h),b._renderChildren(d);var i=b._getVisibleChildren(a);b._refreshDataSets(i),b.afterAddedInDom(),b.options.design&&(b._removeEvents(),b._addEvents())}},a.prototype._isVisible=function(a){for(var b=this;;){if(!a)return!0;var c=b.map[a];if(!c)return!0;if(!l.layoutVisible(c))return!1;a=c.$parentId}},a.prototype._renderChildren=function(a){var b=this,c=[],d=a.get(0),e=i.get(b.options.context,"widget.control"),g=i.get(b.options.context,"field.control"),h=[],j={},k=[];
// only on javascript mode
return(e||g)&&(Object.keys(b.mapFields).forEach(function(a){if(!b.children[a]){var i=b.mapFields[a];if(b._isVisible(i.$parentId)){var l=i.$config?e:g,m=l===g;if(m){var n=0===(i.$bind||"").indexOf("$$"),o=b.getSchema(i.$bind),p=void 0;o||n||console.log('Schema not found for field "'+i.$bind+'".'),i&&i.$lookup&&(p=b.getLookupForSchema(i.$bind,i.$lookup)),l=l?l(i,o,p):null}if(l){var q=void 0,r={context:b.options.context,design:b.options.design,replaceParent:!0,readOnly:i.$readOnly};m?(q=new l(i,r,b),q.isMeta()?h.push(q):i.$bind&&(j[i.$bind]=q)):q=new l(i,r,b);var s=void 0;if(b.options.design||!i.$htmlParent)s=f.find(d,i.$id);else if(s=f.find(d,i.$parentId+"_"+i.$htmlParent)){r.replaceParent=!1;var t=f.find(d,i.$id);t&&f.remove(t)}else s=f.find(d,i.$id);k.push({parent:s,control:q}),
//p.render($(hparent));
b.children[a]=q,b.controls[a]=q,q.resize&&(b.resizeList=b.resizeList||[],b.resizeList.push(q)),c.push(q)}}}}),h.forEach(function(a){var b=a.getCustomBind();if(b){var c=j[b];c&&a.setParentId(c.id)}}),k.forEach(function(a){a.control.render($(a.parent)),a.control.afterAddedInDom&&(b.afterRenderList=b.afterRenderList||[],b.afterRenderList.push(a.control))})),c},a.prototype._afterVisibilityChanged=function(a){var b=this;b._refreshCurrentResizeList(),b._refreshStickies(a.layoutCreated===!0)},a.prototype._refreshStickies=function(a){var b=this;if(b.stickies&&b.$element){var c={},d=!1;Object.keys(b.stickies).forEach(function(a){var e=b.stickies[a];b._isVisible(e.$parentId)&&(c[e.$id]=e,d=!0)});var e=[];b.activeStickies&&Object.keys(b.activeStickies).forEach(function(a){c[a]?delete c[a]:e.push(b.activeStickies[a])}),b.activeStickies=b.activeStickies||{},e.forEach(function(a){delete b.activeStickies[a.id],k.stickyManager.remove(a.id)}),Object.keys(c).forEach(function(a){var d=c[a];if(d.$type===l.LAYOUT_BLOCK){var e=f.find(b.$element.get(0),d.$id);e&&(b.activeStickies[d.$id]={id:d.$id,element:e,position:d.$sticky},k.stickyManager.add(b.activeStickies[d.$id]))}}),a&&k.stickyManager.refresh(!0)}},a.prototype._refreshCurrentResizeList=function(){var a=this;a.resizeList?a.currentResizeList?(a.currentResizeList=[],a.resizeList.forEach(function(b){a._isVisible(b.config.$parentId)&&a.currentResizeList.push(b)})):a.currentResizeList=a.resizeList.map(function(a){return a}):a.currentResizeList=null},a.prototype._clearSticks=function(){var a=this;a.stickies=null,a.activeStickies&&(Object.keys(a.activeStickies).forEach(function(a){k.stickyManager.remove(a)}),a.activeStickies=null)},a.prototype._clearChildren=function(){var a=this,b=a.children;a.children={},a.controls={},a._clearSticks(),a.resizeList=null,a.currentResizeList=null,a.afterRenderList=null,Object.keys(b).forEach(function(a){var c=b[a];c.destroy()})},a.prototype._refreshSelected=function(){var a=this;if(a.options.design){var b=c([a.map,a.mapFields]);a._onSelectedChanged(a.$element.get(0),b,!0)}},a.prototype.registerDataListener=function(a){var b=this;b.page&&b.page.registerDataListener(a,b)},a.prototype.removeDataListener=function(a){var b=this;b.page&&(a==b?b.page.removeParentDataListener(b):b.page.removeDataListener(a))},a.prototype.emitDataEvent=function(a,b,c){var d=this;d.page&&d.page.emitDataEvent(a,b,c)},a.prototype.afterRender=function(a){},a.prototype._internalRender=function(a,b){var c=this;return c.$element||(c.$element=c._renderLayout(c.data),c.options.beforeAdd&&c.options.beforeAdd(c.$element,b),c.$content.append(c.$element),c._afterVisibilityChanged({domChanged:!1,layoutCreated:!0,resize:!1}),c._addEvents(),c._refreshSelected(),a&&(c.options.form||f.bodyTheme(c.data.$theme),c.options.replaceParent?a.replaceWith(c.$content):a.append(c.$content),c.afterAddedInDom())),c.$content},a.prototype.afterAddedInDom=function(){},a.prototype._callInternalRender=function(a,b){var c=this;c._internalRender(a,b)},a.prototype.render=function(a){var b,c=this;return c.$content?c.$element&&(b=!0,c._clearChildren(),c._removeEvents(),c.options.beforeRemove&&c.options.beforeRemove(c.$element),c.$element.remove(),c.$element=null):c.$content=$("<div></div>"),c._callInternalRender(a,b),c.$content},a.prototype._destroyDataSets=function(){},a.prototype.destroy=function(){var a=this;g.log("Destroy Layout","destroy"),a._destroyDataSets(),j.unlisten(a),a.removeDataListener(a),a._clearChildren(),a.page&&(a.page.removeChild(a),a.page=null),a.$element&&(a._removeEvents(),a.$element=null),a.map=null,a.mapFields=null,a.namedMap=null,a.namedMapFields=null,l.clearMeta(a.data,!1)},a.prototype.check=function(a,b){var c=this,d=!1;a||(c.map={},c.mapFields={},c.namedMap={},c.namedMapFields={},b=null,a=c.data,d=!0),l.check(a,b,c.map,c.mapFields,c.namedMap,c.namedMapFields),d&&(a.fields=c.mapFields,a.map=c.map)},a.prototype._afterStructureChanged=function(a){var b=this;b.render()},a.prototype._afterPropsChanged=function(a){var b=this;if(this.$element){var c=this.$element.get(0);if(c){var d=f.find(c,a.$id),e=a.$id!=a.$idStep2?f.find(c,a.$idStep2):null,g=a.$idStep3?f.find(c,a.idStep3):null;d&&l.updateCssClass(d,a,b.getLayoutById(a.$parentId),{design:b.options.design,step:1}),e&&l.updateCssClass(e,a,b.getLayoutById(a.$parentId),{design:b.options.design,step:2}),g&&l.updateCssClass(g,a,b.getLayoutById(a.$parentId),{design:b.options.design,step:3}),a.selected&&b._refreshSelected()}}},a.prototype.removeChild=function(a){var b=this;if(a&&b.options.design){var c=b.map[a]||b.mapFields[a];if(c){var d=b.map[c.$parentId];if(d&&(!d.$auto||(c=d,d=b.map[c.$parentId]))){var e=d.$items.indexOf(c);d.$items.splice(e,1),l.clearMaps(c,this.map,this.mapFields,b.namedMap,b.namedMapFields),l.afterRemoveChild(d,b.map,b.mapFields,b.namedMap,b.namedMapFields),b._afterStructureChanged(d)}}}},a.prototype.setDesignMode=function(a){var b=this;b.options.design!=a&&(b.options.design=a,b.render())},a.prototype.getLayoutById=function(a){if(!a)return null;var b=this;return b.map[a]},a.prototype.getFieldById=function(a){if(!a)return null;var b=this;return b.mapFields[a]},a.prototype.select=function(a){var b=this,d=b.$element;if(b.options.design){var e=c([b.map,b.mapFields]);if(e&&(e.selected=!1,b._showSelected(d,e),b._onSelectedChanged(d.get(0),e,!1),e.$id==a))return void b._onSelectedChanged(d.get(0),null,!0);if(a){var f=b.map[a]?b.map[a]:b.mapFields[a];f&&(f.selected=!0,b._showSelected(d,f),b._onSelectedChanged(d.get(0),f,!0))}}},a.prototype.updateField=function(a,b){var c=this,d=c.mapFields[a];if(d)if(d.$render&&d.$config)Object.keys(b.$config).forEach(function(a){"form"!==a&&"data"!==a&&"datasets"!==a&&d.$render[a]!=b.$config[a]&&(d.$render[a]=b.$config[a])}),(d.$config.hasOwnProperty("form")||b.$config.hasOwnProperty("form"))&&(d.$config.form=b.$config.form),d.$config.datasets=b.$config.datasets,d.$config.data=b.$config.data,c._afterStructureChanged(null);else{if(g.equals(d,b))return;var e=Object.keys(b),f=Object.keys(d);e.forEach(function(a){d[a]=b[a]}),e.push("$id"),e.push("$parentId"),e.push("$idDrag"),f.forEach(function(a){e.indexOf(a)<0&&delete d[a]});var h=c.children[a];h&&(delete c.controls[a],delete c.children[a],h.destroy()),c._afterStructureChanged(null)}},a.prototype._cleanIds=function(a){a.$idDesign=null,a.$idDrag=null,a.$idSelect=null,a.$idStep2=null,a.$idStep3=null},a.prototype._blockToCols=function(a){var b=this;a.$items&&a.$items.forEach(function(c,d){var e=c.$origin||c.$type;if("block"===e||"column"===e)c.$type="column",b._cleanIds(a);else{({$items:[c],$auto:!0,$type:"column",$colSize:c.$colSize,$customColSize:c.$customColSize})}})},a.prototype._changeType=function(a,b){var c=this,d=c.map[a.$parentId],e=d&&d.$auto?c.map[d.$parentId]:null,f=a.$origin||a.$type;switch(f){case"block":"row"===b&&(a.$type=b,c._blockToCols(a),c._cleanIds(a),c.check(a,d));break;case"column":if("row"===b){var g={$items:a.$items,$type:b,selected:!1};a.$auto=!0,a.$type="column",a.$items=[g],a.selected&&(a.selected=!1,g.selected=!0),c._blockToCols(g),c._cleanIds(a),c.check(a,d)}break;case"row":if("block"===b){if(e){var h=e.$items.indexOf(d);e.$items[h]=a,a.$type=d.$type,a.$parentId=e.$id,"column"==d.$type&&(a.$colSize=d.$colSize,a.$customColSize=d.$customColSize),d=e}else a.$type=b;a.$origin&&delete a.$origin,a.$items&&a.$items.forEach(function(b,d){if(b.$type)if(b.$auto){var e=b.$items[0];e.$colSize=b.$colSize,e.$customColSize=b.$customColSize,e.$parentId=a,a.$items[d]=e,c._cleanIds(b)}else b.$type="block",c._cleanIds(b)}),c._cleanIds(a),c.check(a,d)}break;case l.LAYOUT_ACCORDION:}},a.prototype.updateIsHidden=function(a,b){var c=this;a.$isHidden!==b&&(a.$isHidden=b,c._afterPropsChanged(a))},a.prototype.updateLayout=function(a,b){var c=this,d=c.map[a],e=!1,f=!1,h=!1;if(d){if(delete b.onlyFields,b.$type){var i=d.$origin||d.$type;b.$type!==i&&(c._changeType(d,b.$type),delete b.$type,e=!0)}if(b.parent){var k=c.map[d.$parentId];c._disableRules=!0,Object.keys(b.parent).forEach(function(a){b.parent[a]!==k[a]&&(k[a]=b.parent[a],e=!0)}),c._disableRules=!1,delete b.parent}if(delete b.selected,c._disableRules=!0,d.$title&&!b.$title?(delete d.$title,e=!0):!d.$title&&b.$title?(delete d.$title,d.$title=b.$title,delete b.$title,e=!0):d.$title&&b.$title&&(Object.keys(b.$title).forEach(function(a){b.$title[a]!=d.$title[a]&&(d.$title[a]=b.$title[a],e=!0)}),delete b.$title),(d.$inline||!1)!==(b.$inline||!1)&&(d.$inline=b.$inline,f=!0,d.$items.length&&(e=!0),delete b.$inline),g.equals(d.$fieldsOptions,b.$fieldOptions)||(d.$fieldsOptions=b.$fieldOptions,f=!0,d.$items.length&&(e=!0)),delete b.$fieldOptions,(d.$refProperty||"")!==(b.$refProperty||"")&&(d.$refProperty=b.$refProperty,e=!0),(d.$refController||"")!==(b.$refController||"")&&(d.$refController=b.$refController,e=!0),(d.$sticky||"")!==(b.$sticky||"")&&(d.$sticky=b.$sticky,e=!0),(d.$ref||"")!==(b.$ref||"")&&(d.$ref=b.$ref,d.$ref?(delete d.name,delete d.form,delete d.$fieldsOptions,h=!0):(delete d.$refProperty,delete d.$refController,delete d.name,delete d.form),d.$items=[],e=!0),delete b.$ref,delete b.$refProperty,delete b.$refController,delete b.$sticky,(d.$widget||"")!==(b.$widget||"")&&(d.$widget=b.$widget,e=!0),delete b.$widget,Object.keys(b).forEach(function(a){b[a]!==d[a]&&(d[a]=b[a],f=!0)}),c._disableRules=!1,e){if(h)return j.emit("LoadNestedLayouts",{data:d,after:function(a){g.merge(a,d);var b=c.map[d.$parentId];c._cleanIds(d),c.check(d,b),c._afterStructureChanged(d)}});c._afterStructureChanged(d)}else f?c._afterPropsChanged(d):c._refreshSelected()}},a}();b.BaseLayout=m;var n=function(a){function b(){a.apply(this,arguments)}
//implements DatasetMethods
return __extends(b,a),b.prototype.ds_init=function(a){return!1},b.prototype.ds_storeLastEvent=function(a,b){},b.prototype.ds_LastEvent=function(){return null},b.prototype.ds_destroy=function(){},b.prototype.ds_context=function(){return null},b.prototype.ds_reemit=function(a,b){return null},b.prototype.ds_select=function(a,b){},b.prototype.ds_loaded=function(a,b){},b.prototype.ds_exec=function(a,b,c,d,e,f){},b.prototype.pageLayoutInit=function(){var a=this;
//datasets
a.loadingHandler=null,a.noDataHandler=null,a.errorHandler=null,a.emitHandler=null,a.getLocalContextHandler=null,a.dataChangedHandler=null,a.updateMenuHandler=this.updateMenu.bind(a),a._removeMenus(),a.ds_init&&a.ds_init(a.data)&&a.registerDataListener(a)},b.prototype._doDatasetEventAfterEnabled=function(a){if(a.ds_LastEvent&&a.dataEvent){var b=a.ds_LastEvent();b&&a.dataEvent(b.event,b.value)}},b.prototype._refreshDataSets=function(a){
//list --> list of new visible "datasets listeners"
var b=this;if(b.page){var c=b._getEventListFor(a);if(c.length){var d=b.page.emittersFor(c);
//reemit events
d.forEach(function(b){b.ds_reemit&&b.ds_reemit(a,function(){})})}}},b.prototype._callInternalRender=function(a,b){var c=this;c.datasets&&c.ds_exec?c.ds_exec("$load",null,c.props.data.ds,function(d,e){if(e)throw e.message;c._internalRender(a,b)},null,!0):c._internalRender(a,b)},b.prototype._destroyDataSets=function(){var a=this;a.ds_destroy&&a.ds_destroy()},b.prototype._removeMenus=function(){var a=this,b=["left","right","top","bottom"];
//var menus = [];
b.forEach(function(b){if(!a.data.$menus||!a.data.$menus[b]){var c=a.page.childByType("menu-"+b);c&&c.setMenu(null)}})},b.prototype.updateMenu=function(a,b){var c=this;g.log("From Layout Update Menu : "+(b?b.name:"null"),"menu");var d=c.page.childByType("menu-"+a);if(d)return void d.setMenu(b);var f=null;if("right"==a?f=e.Menuright:"left"==a&&(f=e.Menuleft),f){var h={type:a,bodyId:null,parentId:null},i=c.page.childByType("header");i&&(i.options.bodyId&&(h.bodyId=i.options.bodyId),i.options[h.type+"MenuPlace"]&&(h.parentId=i.options[h.type+"MenuPlace"])),d=new f(b,h)}},b}(m);b.PageLayout=n,g.applyMixins(n,[a.DatasetPlugin.DatasetMethods]);var o=function(a){function b(b,c,d,e,f,g){a.call(this,b,c,d,e,f,g)}return __extends(b,a),b}(n);b.Layout=o,b.LayoutClass=o}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../ui/page.control.ts" />
var Phoenix;!function(a){var b,c=a,d=(c.ulocale,c.utils,c.locale,c.pagecontrol),e=c.dom;c.ui;!function(a){function b(a,b){var d=new c(a,b);d.open()}a.SCREEN_CENTER="screencenter",a.SCREEN_TOP_CENTER="screentopcenter",a.BOTTOM_LEFT="bottom-left",a.BOTTOM_RIGHT="bottom-right";var c=function(){function b(a,b){var c=this;c._align=a,b=b||b,c._checkOptions(b),c._width=b.width,c._height=b.height,c._minWidth=b.minWidth,c._minHeight=b.minHeight,c._style=b.style,c._beforeClose=b.beforeClose,c._contentRender=b.contentRender,b.alignElement&&(c.$alignElement=$(b.alignElement)),c.$parent=$(b.parent),c._page=d.Page(),c._resize=c.resize.bind(c)}return b.prototype.resize=function(){var a=this;a._alignElement()},b.prototype.destroy=function(){var a=this;$(window).off("global-phoenix-resize"),a.$element=null,a.$parent=null,a.$alignElement=null,a._beforeClose=null,a._contentRender=null,a._page=null},b.prototype.inPopup=function(a){var b=this,c=b.$element.get(0);return!!e.isChildOf(c,a)},b.prototype._checkOptions=function(b){var c=this;if(b.parent=b.parent||document.body,b.alignElement||(b.parent=document.body,b.alignElement=null,c._align!==a.SCREEN_TOP_CENTER&&(c._align=a.SCREEN_CENTER)),c._align!==a.SCREEN_TOP_CENTER&&c._align!==a.SCREEN_CENTER&&!b.alignElement)throw"Align element is null";if(!b.contentRender)throw"Invalid content render"},b.prototype._alignXScreenCenter=function(){var a=this,b=a.$element.get(0),c=e.offset(b),d=e.offset(b.parentNode);b.style.left=Math.floor(Math.max((d.width-c.width)/2,0))+"px"},b.prototype._alignYScreenCenter=function(){var a=this,b=a.$element.get(0),c=e.offset(b),d=e.offset(b.parentNode);b.style.top=Math.floor(Math.max((d.height-c.height)/2,0))+"px"},b.prototype._alignTopScreen=function(){var a=this,b=a.$element.get(0);b.style.top="0px"},b.prototype._alignScreenTopCenter=function(){var a=this;a._alignXScreenCenter(),a._alignTopScreen()},b.prototype._alignScreenCenter=function(){var a=this;a._alignXScreenCenter(),a._alignYScreenCenter()},b.prototype._alignBottomLeft=function(){var a=this,b=a.$element.get(0),c=a.$alignElement.get(0),d=e.documentClientDim(),f=e.offset(b),g=e.offset(c);b.style.top=Math.max(0,Math.round(g.top+g.height)-1)+"px";var h=g.left;h+f.width>d.width&&(h=Math.max(0,d.width-f.width)),b.style.left=h+"px"},b.prototype._alignBottomRight=function(){var a=this,b=a.$element.get(0),c=a.$alignElement.get(0),d=e.documentClientDim(),f=e.offset(b),g=e.offset(c);b.style.top=Math.max(0,Math.round(g.top+g.height)-1)+"px";var h=Math.max(0,Math.round(d.width-g.left-g.width));h+f.width>d.width&&(h=Math.max(0,d.width-f.width)),b.style.right=h+"px"},b.prototype._alignElement=function(){var b=this;b._align===a.SCREEN_CENTER?b._alignScreenCenter():b._align===a.SCREEN_TOP_CENTER?b._alignScreenTopCenter():b._align===a.BOTTOM_LEFT?b._alignBottomLeft():b._align===a.BOTTOM_RIGHT&&b._alignBottomRight()},b.prototype._setHeightAndWidth=function(){var a=this,b=a.$element.get(0);a._width&&"auto"!==a._width&&(b.style.width=a._width),a._height&&"auto"!==a._height&&(b.style.height=a._height)},b.prototype.open=function(){var a=this,b=["bs-autoclose","bs-autoclose-hidden"];a._style=a._style||"modal-content",a._style&&e.parseStyle(a._style,b),a.$element=$('<div class="'+b.join(" ")+'"><div></div></div>');var c=a.$element.get(0),d=a.$parent.get(0);a._setHeightAndWidth(),e.append(d,c),a._contentRender($(c.firstChild),a,function(b){return b?(console.log(b),void a.destroy()):(a._alignElement(),e.removeClass(c,"bs-autoclose-hidden"),a._page.setPopup(a),void $(window).on("global-phoenix-resize",a._resize))})},b.prototype.hide=function(a){var b=this;b._beforeClose&&b._beforeClose();var c=b.$element.get(0);e.remove(c),b.$element=null,b.destroy()},b}();a.open=b}(b=a.autoclose||(a.autoclose={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/modules/locale.ts" />
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/ajax.ts" />
/// <reference path="../../core/modules/application.ts" />
/// <reference path="../../data/datasets.ts" />
/// <reference path="../datasets-plugin.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,d,e,f,g,h){g(d,a,b,f,e)&&Object.keys(a.properties).forEach(function(e){var i=a.properties[e];if(!i.$reference)if("object"===i.type){var j=d?d+"."+e:e;c(i,b,j,!1,f?f[e]:null,g,h)}else if("array"===i.type){var k=w(i.items,b);if("object"===k.type){var j=d?d+"."+e:e;c(k,b,j,!0,f?f[e]:null,g,h)}}})}function d(a,b,c,e){var f=Object.keys(c);f.forEach(function(f){var g=c[f],h=null;if(!(a&&(h=a.properties[f],h&&(h.$reference||h.$ux||h.ux)))&&(h||"$"!==f.charAt(0))){if(h)if("object"===h.type)null===g?e[f]=null:(e[f]={},d(h,b,g,e[f]));else{if("array"===h.type){var i=w(h.items,b);return null===g?void(e[f]=null):void("object"===i.type?void 0===g||(null===g?e[f]=null:(e[f]=new Array(g.length),g.forEach(function(a,c){var g={};e[f][c]=g,d(i,b,a,g)}))):e[f]=g.slice(0))}e[f]=g}else null===g?e[f]=null:Array.isArray(g)?(e[f]=new Array(g.length),g.forEach(function(a,c){if(null===a||void 0===a||"object"!=typeof a)e[f][c]=a;else{var g={};e[f][c]=g,d(null,b,a,g)}})):"object"==typeof g?(e[f]={},d(null,b,g,e[f])):e[f]=g}})}function e(a,b){if(!b.definitions)throw new Error("schema.definitions is null");var c=a,d=c.indexOf(h);if(d<0)throw new Error(m.format("Invalid $ref. ({0})",c));var e=c.substring(d+i);return b.definitions[e]}function f(a,b,c){var d=null;return a.allOf?(d=a.allOf,delete a.allOf):a.$ref&&b.indexOf(a.$ref)<0&&(d=[{$ref:a.$ref}],delete a.$ref),d&&d.forEach(function(d){var f=b.slice(0);if(d.$ref){var h=e(d.$ref,c);f.push(d.$ref),delete d.$ref,m.merge(h,d)}g(d,f,c),m.merge(d,a)}),d}function g(a,b,c){var d=b.slice(0),e=(f(a,d,c),null);a.properties?e=a:"array"===a.type&&a.items&&(e=a.items),e&&e.properties&&Object.keys(e.properties).forEach(function(a){var d=e.properties[a];(d.allOf||d.$ref)&&f(d,b,c),"array"===d.type&&d.items&&(d.items.allOf||d.items.$ref)&&f(d.items,b,c)})}var h="#/definitions/",i=h.length;b.INDEX_FIELD_NAME="$index",b.SELECTED_FIELD_NAME="$select",b.EXPANDED_FIELD_NAME="$expand";var j=a.ulocale,k=(a.application,a.ajax,a.dom),l=(a.link,a.data),m=a.utils,j=a.ulocale,n=a.locale,o=a.customData,p=a.locale.schema,q=a.DatasetPlugin,r=[b.INDEX_FIELD_NAME,b.SELECTED_FIELD_NAME,b.EXPANDED_FIELD_NAME],s=function(a){return r.indexOf(a)>=0},t=function(){var a={};return{register:function(b,c){a[b]=c},get:function(b){return a[b]}}},u=function(){var a={};return{register:function(b,c){a[b]=c},get:function(b){return a[b]}}},v=function(a){if(!a.features){a.features={};var b=void 0===a.capabilities?"filtrable,sortable":a.capabilities;b&&b.split(",").forEach(function(b){a.features[b]=!0})}},w=function(a,b){if(a.$ref){var c=a.$ref.substr(i),d=b.definitions?b.definitions[c]:null;if(!d)throw"Schema $ref not found : "+a.$ref;return d}return a},x=u(),y=t(),z={RATE_DECIMALS:2,RATE_MAXIMUM:1e3,RATE_SYMBOL:"%",expandSchema$Ref:function(a){return g(a,[],a)},_getDefault:function(a){return"@date"==a?j.date2ISO(new Date):a},checkLookup:function(a){return a?(a=$.extend({},a),a.data&&"odata"==a.data.$type||(a.pagination=!1,a.cache=!0),a.pagination!==!1&&(a.pagination=!0),a.pagination&&(a.cache=!1),a):null},schema2Authoring:function(a,b,d){var e=[];return c(a,b,"",!1,null,function(a,b,c,f,g){return!g&&(Object.keys(b.properties).forEach(function(f){var g=b.properties[f];if(z.inModel(g,c)&&!z.isCompositionRef(g,c))
//if (_sutils.isCompositionRef(ps) || _sutils.isCompositionList(ps)) return;
{var h=a?a+"."+f:f,i={$type:"field",$bind:h,$title:j.tt(g.title,d)||h,$widget:g.$widget,options:g.$widgetOptions};e.push(i)}}),b.links&&Object.keys(b.links).forEach(function(c){var f=b.links[c],g="$links."+c;g=a?a+"."+g:g;var h={$type:"action",$bind:g,$title:j.tt(f.title,d)||g,$widget:f.widget,options:f.$widgetOptions};e.push(h)}),!0)}),e},filtrableFields:function(a,b,d){var e=[];return c(a,b,"",!1,null,function(a,b,c,f,g){return!g&&(Object.keys(b.properties).forEach(function(f){var g=b.properties[f];if(z.inModel(g,c)&&!z.isCompositionRef(g,c)&&!z.isCompositionList(g,c,!0)){var h=a?a+"."+f:f;if(z.canFilter(g)){var i={name:h,schema:m.copy(g)};i.schema.title=j.tt(i.schema.title||"",d),e.push(i)}}}),!0)}),e},isFwField:s,
// copy only schema properties
copyModel:function(a,b,c){var e={};return c=c||a,d(a,c,b,e),e},columns:function(a,b,d){var e=[];return c(a,b,"",!1,null,function(a,b,c,f,g){return!g&&(Object.keys(b.properties).forEach(function(f){var g=b.properties[f];if(z.inModel(g,c)&&!z.isCompositionRef(g,c)&&!z.isCompositionList(g,c,!0)){var h=a?a+"."+f:f;if(z.canShowField(g)){var i={name:h,schema:m.copy(g)};i.schema.title=j.tt(i.schema.title||"",d),e.push(i)}}}),!0)}),e},allData:function(a){return!a.pagination},pkFields:function(a){return Array.isArray(a)?a:a.split(",").map(function(a){return a.trim()})},entityId:function(a){if("object"==typeof a){return Object.keys(a).map(function(b){var c=a[b];return"string"==typeof c?b+"='"+c+"'":b+"="+c}).join(",")}return"string"==typeof a?"'"+a+"'":a+""},extractPkValue:function(a,b){if(1==b.length)return a[b[0]];var c={};return b.forEach(function(b){c[b]=a[b]}),c},odataId:function(a,b){if(1==a.length)return b[a[0]];var c=[];return a.forEach(function(a){c.push(a+"="+encodeURIComponent(b[a]+""))}),c.join(",")},pk2Id:function(a,b){return 1===b.length?a:JSON.stringify(a)},id2Pk:function(a,b){return 1===b.length?a:JSON.parse(a)},equals:function(a,b,c){if(1===c.length)return a===b[c[0]];for(var d=0,e=c.length;d<e;d++){var f=c[d];if(a[f]!==b[f])return!1}return!0},extractBase:function(a){var b=a.split(".");return b.pop(),b.length?b.join(".")+".":""},parentPath:function(a){var b=a.split(".");return b.pop(),b.length?b.join("."):""},findByPk:function(a,b,c){if(c&&a)for(var d=0,e=c.length;d<e;d++){var f=c[d];if(z.equals(a,f,b))return f}return null},supportPagination:function(a){
//TODO
return!1},executeLookup:function(a,b,c){var d=l.execData(a.data,b,null);return c?void(d?d.then(c):c(null)):d},remoteSearch:function(a,b){return b.mapping?b.mapping[a]:a},lastSegment:function(a,b){var c=a.split("."),d=c.pop();return b&&b!=a&&(d=b.substring(c.join(".").length)),d},findFirst:function(a,b,c){if(!a||!c)return null;for(var d=a.toLocaleLowerCase(),e=d.length,f=0,g=c.length;f<g;f++){var h=c[f][b]||"";if(h.toLowerCase().substr(0,e)===d)return{item:c[f],index:f}}return null},_states:["$states","$links"],isMetaProp:function(a){return"$$"===a.substr(0,2)},isMeta:function(a){var b="$$meta-".length;return"$$meta-"===a.substr(0,"$$meta-".length)?{widget:a.substr(b)}:null},getLookup:function(a,b,c,d){var e=a.split(".");e.pop();for(var f=c,g=0,h=e.length;g<h&&f;g++){var i=e[g];f="array"==f.type&&z.arrayProps.indexOf(i)>=0?w(f.items,d):f.properties?f.properties[i]:null}return f&&f.lookups?z.checkLookup(f.lookups[b]):null},getSchema:function(a,c,d,e){if(!a)return c;for(var f=a.split("."),g=c,h=!1,i=0,j=f.length;i<j&&g;i++){var k=f[i];if("array"==g.type&&z.arrayProps.indexOf(k)>=0)
// $item, $new 
g=w(g.items,d);else if("$links"===k)g=g.links,h=!0;else if(h)h=!1,g=g[k];else if(g=g.properties?g.properties[k]:null,!g&&i===j-1){if(k===b.INDEX_FIELD_NAME)return{type:"integer",title:"#",capabilities:null};if(k===b.SELECTED_FIELD_NAME)return{type:"boolean",title:n.ui.Selected,capabilities:null};if(k===b.EXPANDED_FIELD_NAME)return{type:"integer",title:"",capabilities:null}}}return e&&g&&"array"===g.type&&g.items&&(g=w(g.items,d)),g},states:["isHidden","isDisabled","isReadOnly","isMandatory"],statesAndErrors:["isHidden","isDisabled","isReadOnly","isMandatory","errors","filter","symbol","decimals"],linksStates:["isHidden","isDisabled"],isLink:function(a){return a.split(".").indexOf("$links")>=0},_isMoney:function(a){return z.isNumber(a)&&"money"==a.format},_internalExtractEnums:function(a,b,c,d){if(a.name){if(d.indexOf(a.name)>=0)return;d.push(a.name)}var e=function(b,d){if(d=d||a,d.enums&&d.enums[b]){var e=d.enums[b].type||"default";c[e]=c[e]||{},c[e][b]=d.enums[b]}else{
//$enumref = "Satut.codif"
var f=b.split(".");2===f.length&&(c[f[1]]=c[f[1]]||{},c[f[1]][f[0]]={type:f[1]})}};a.lookups&&Object.keys(a.lookups).forEach(function(b){var c=a.lookups[b];"enum"===c.data.$type&&c.data.$enumref&&e(c.data.$enumref)}),Object.keys(a.properties).forEach(function(f){var g=a.properties[f];if(z.inModel(g,b))if(z.isCompositionRef(g,b))z._internalExtractEnums(g,b,c,d);else if(z.isCompositionList(g,b,!0))z._internalExtractEnums(w(g.items,b),b,c,d);else{var h=a;z.isSimpleList(g,b)&&(g=w(g.items,b),h=g),g.$enumref&&e(g.$enumref,h)}})},_extractEnums:function(a,b){return z._internalExtractEnums(a,a,b,[])},_fillEnums:function(a,b){z._internalFillEnums(a,a,b,[])},_internalFillEnums:function(a,b,c,d){if(a.name){if(d.indexOf(a.name)>=0)return;d.push(a.name)}a.lookups&&Object.keys(a.lookups).forEach(function(b){var d=a.lookups[b];if("enum"==d.data.$type&&d.data.$enumref){var e=d.data.$enumref.split("."),f=2===e.length?c[e[1]]:c[a.enums[d.data.$enumref].type||"default"],g=2===e.length?e[0]:d.data.$enumref;if(f){d.data.$value=[];var h=f[g];h.enum.forEach(function(a,b){var c={code:a,title:h.enumNames[b]};h.fields&&m.extend(c,h.fields[b]),d.data.$value.push(c)})}}}),Object.keys(a.properties).forEach(function(e){var f=a.properties[e];if(z.inModel(f,b))if(z.isCompositionRef(f,b))z._internalFillEnums(f,b,c,d);else if(z.isCompositionList(f,b,!0))z._internalFillEnums(w(f.items,b),b,c,d);else{var g=a;if(z.isSimpleList(f,b)&&(f=w(f.items,b),g=f),f.$enumref){var h=f.$enumref.split(".");if(g.enums&&g.enums[f.$enumref]||2===h.length){var i=2===h.length?c[h[1]]:c[g.enums[f.$enumref].type||"default"],j=2===h.length?h[0]:f.$enumref;if(i){var k=i[j];k&&(f.enum=k.enum,f.enumNames=k.enumNames,f.filters=k.filters)}}}}})},loadEnums:function(a){var b={};z._extractEnums(a,b);var c=Object.keys(b).map(function(a){var c=y.get(a);if(!c)throw"Invalid enum type: "+a;return c.promise(b[a],a)});return c.length?c:null},arrayProps:["$item","$new","$selected"],init:function(a,b,c,d){var e=d||{};return e.$states=e.$states||{},Object.keys(a.properties).forEach(function(d){var f=a.properties[d];if(z.inModel(f,b)){var g=z.isMetaProp(d),h=a.states?a.states[d]:null,i=e.$states[d]=e.$states[d]||{};if(g||h&&Object.keys(h).forEach(function(a){void 0===i[a]&&(i[a]=h[a])}),z.isCompositionRef(f,b))e[d]=z.init(f,b,c,e[d]||{});else if(z.isCompositionList(f,b,!1)||z.isSimpleList(f,b));else if(z.isList(f,b));else if(void 0===e[d])if(void 0!==f.default)e[d]=z._getDefault(f.default);else if(f.enum)e[d]=f.enum[0];else switch(f.type){case"number":case"integer":e[d]=0}}}),e},
//
isCompositionRef:function(a,b){return"object"===a.type&&!a.$reference},isRef:function(a,b){return"object"===a.type&&a.$reference},isList:function(a,b){return"array"===a.type&&a.$reference},isCompositionList:function(a,b,c){if("array"===a.type&&a.items){var d=w(a.items,b);return("object"===d.type||"array"===d.type)&&(!a.$reference||c&&a.$reference)}return!1},isSimpleList:function(a,b){if("array"===a.type&&a.items){var c=w(a.items,b);return("object"!==c.type||"array"===c.type)&&!a.$reference}return!1},inModel:function(a,b){return!z.isRef(a,b)},formatNumber:function(a,b){return"money"==a.format?j.money(b,!1):j.decimal(b,a.decimals||0,null)},_title:function(a,b){return b?j.tt(a,b):a},canSort:function(a){return!!a&&(!a.hidden&&(v(a),a.features.sortable))},canShowField:function(a){return!a.hidden},canFilter:function(a){return!!a&&(!a.hidden&&(v(a),a.features.filtrable))},checkNumber:function(a,b,c,d){var e=!0;return b.exclusiveMinimum?void 0!=b.minimum&&a<=b.minimum&&(d.push({message:m.format(p.minNumberExclusive,z._title(b.title,c),z.formatNumber(b,b.minimum))}),e=!1):void 0!=b.minimum&&a<b.minimum&&(d.push({message:m.format(p.minNumber,z._title(b.title,c),z.formatNumber(b,b.minimum))}),e=!1),b.exclusiveMaximum?void 0!=b.maximum&&a>=b.maximum&&(d.push({message:m.format(p.maxNumberExclusive,z._title(b.title,c),z.formatNumber(b,b.maximum))}),e=!1):void 0!=b.maximum&&a>b.maximum&&(d.push({message:m.format(p.maxNumber,z._title(b.title,c),z.formatNumber(b,b.maximum))}),e=!1),e},_validateEmail:function(a,b){var c=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return c.test(a)},_validateJson:function(a,b){try{JSON.parse(a)}catch(a){return b.ex=a,!1}return!0},checkString:function(a,b,c,d,e){var f=!0,g=a||"";if(c.minLength&&g.length<c.minLength&&(e.push({message:m.format(p.minLength,z._title(c.title,d),c.minLength)}),f=!1),b.isMandatory&&""===g&&(e.push({message:m.format(p.required,z._title(c.title,d))}),f=!1),c.format)if("email"===c.format)a&&!z._validateEmail(a,{})&&(e.push({message:p.invalidEmail}),f=!1);else if("json"===c.format){var h={};a&&!z._validateJson(a,h)&&(e.push({message:h.ex.message}),f=!1)}return f},validatePassword:function(a,b,c,d,e,f){var g=!0;return d.isHidden||d.isDisabled?g:(a!==b&&(f.push({message:p.passwordMismatch}),g=!1),g)},validateSchema:function(a,b,c,d,e){var f=!0;if(b){if(c&&(c.isHidden||c.isDisabled))return f;switch(b.type){case"number":case"integer":f=z.checkNumber(a,b,d,e);break;case"string":f=z.checkString(a,c,b,d,e)}return f}},loadEnumsPromise:function(a){var b=z.loadEnums(a);return b?m.Promise.all(b).then(function(b){var c={};return b.forEach(function(a){c[a.type]=a.enums}),z._fillEnums(a,c),a}):new m.Promise(function(b,c){b(a)})},loadSchemaRefs:function(a,b,c,d){if(!a)return d(null,null);try{z.expandSchema$Ref(a);var e=z.loadEnums(a),f=e?e:[],g=e?e.length:0,h=A.loadMainData(c);h&&f.push(h);var i=h?g+1:0;if(!f.length)return d(null,b);k.processing(!0),m.Promise.all(f).then(function(c){k.processing(!1);var e={};c.forEach(function(a,c){c<g?e[a.type]=a.enums:c<i&&$.extend(b,a)}),g&&z._fillEnums(a,e),d(null,b)}).catch(function(a){k.processing(!1),d(a,null)})}catch(a){d(a,null)}},stateProps:function(a){return a.enum&&a.filters?["filter"]:a.items&&a.items.enum&&a.items.filters?["filter"]:z.isNumber(a)?["symbol","decimals"]:null},isPassword:function(a){return"string"===a.type&&"password"===a.format},isDate:function(a){return"string"===a.type&&"date"===a.format},isDateTime:function(a){return"string"===a.type&&"date-time"===a.format},isBoolean:function(a){return"boolean"===a.type},isSelectField:function(a){return a===b.SELECTED_FIELD_NAME},isExpandField:function(a){return a===b.EXPANDED_FIELD_NAME},isNumber:function(a){return"number"===a.type||"integer"===a.type},isText:function(a){return"string"===a.type&&("json"===a.format||"memo"===a.format)},isMoney:function(a){return z.isNumber(a)&&"money"===a.format},text2Value:function(a,b,c){if(z.isNumber(b)){var d=c.decimals,e=j.string2Float(a);return e=parseFloat(e.toFixed(d))}return a},value2Text:function(a,b,c){return z.isNumber(b)?j.decimal(a,c.decimals,null):a||""},expand$Ref:function(a,b){return w(a,b)},removeExpand:function(a,b){if(!b)return a;var c=b+".$item.",d=a.lastIndexOf(c);return d<0?a:a.substr(d+c.length)},registerValidator:x.register,getValidator:x.get,registerEnumManager:y.register,getEnumManager:y.get},A={extractDatasets:function(a){if(a.datasets){var b=Object.keys(a.datasets);if(b.length)return b.map(function(b){var c=$.extend({},a.datasets[b],!0);return c.name=b,c})}return null},isQuery:function(a){return!("odata"!==a.$type||a.$method&&"GET"!==a.$method.toUpperCase()||a.$params.hasOwnProperty("$entityId"))},isCreateOrUpdate:function(a){return"odata"===a.$type&&a.$params.hasOwnProperty("$entityId")},extractMainDataSource:function(a){var b=null;if(a.datasets){var c=Object.keys(a.datasets);c.length&&(c.forEach(function(c){a.datasets[c].$main&&(b=$.extend({},a.datasets[c],!0),b.name=c)}),b||(b=$.extend({},a.datasets[c[0]],!0),b.name=c[0]))}return b},datasetsAsPromise:function(a,b){return new m.Promise(function(c,d){var e={};k.processing(!0);var f=null,g=[];a.forEach(function(a){a.$main&&(f=a)}),f||(f=a[0],f.$main=!0),f.children&&Object.keys(f.children).forEach(function(a){f.children[a].name=a,g.push(f.children[a])}),A.isCreateOrUpdate(f)&&(f.$create=f.$create||{}),q.executeDatasets(a,{},e,{},function(a,h){if(k.processing(!1),h)d(h);else{var i=e[f.name];if(g&&g.length){k.processing(!0);var j={};return q.executeDatasets(g,i,j,{},function(a,d){if(k.processing(!1),Object.keys(j).forEach(function(a){e[a]=j[a]}),l.execOutputData(f,e),b){var g=o.get("datasets.transform."+b);g&&g(e)}c(e[f.name])},!1)}if(l.execOutputData(f,e),b){var m=o.get("datasets.transform."+b);m&&m(e)}c(e[f.name])}})})},datasetAsPromise:function(a,b){return new m.Promise(function(c,d){var e={};a.name=a.name||"data",k.processing(!0),q.executeDatasets([a],b||{},e,{},function(b,f){k.processing(!1),f?d(f):c(e[a.name])})})},loadMainData:function(a){var b=A.extractDatasets(a);return b&&b.length?A.datasetsAsPromise(b,a.transform):m.Promise.resolve(null)},dsConfig:function(a,b,c){var d=b.$reference;if(a&&d){var e=Object.keys(a);if(1===e.length){var f=a[e[0]];return f.$main=!0,f.name=e[0],f}if("string"==typeof d){var g=a[d];return g.name=d,g}}return null}},B={_enums:{},promise:function(a,b){var c={};return Object.keys(a).forEach(function(b){var d=a[b];B._enums[b]||(B._enums[b]={enum:d.enum,enumNames:d.enumNames,filters:d.filters}),c[b]=B._enums[b]}),new m.Promise(function(a,d){a({type:b,enums:c})})}};z.registerEnumManager("default",B),b.SchemaUtils=z,b.DataUtils=A}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a.SchemaUtils,c=function(){function a(a,b,c){}return a.prototype.destroy=function(){var a=this;a._state&&(a._state=null),a.parent=null},a.prototype.state=function(){return this._state},a.prototype._init=function(a,b,c,d){var e=this;d=d||[],e._state=c||{},e.name=b,e.parent=a,d.forEach(function(a){void 0===e._state[a]&&(e._state[a]=!1),Object.defineProperty(e,a,{get:function(){return this._state[a]||!1},set:function(b){var c=this,d=c._state[a]||!1;if(d!==b){if(c._state[a]=b,"filter"===a&&c.parent){var f=c.parent.getValue(e.name),g=c.parent.getSchema(e.name);if(g&&g.enum&&g.filters){var h=b?g.filters[b]:g.enum;if(h){var i=h.indexOf(f);i<0&&c.parent.setValue(e.name,h.length?h[0]:null)}}}c.parent&&c.parent.notifyStateChanged&&c.parent.notifyStateChanged(e.name+"."+a,{})}},enumerable:!0})})},a}();a.BaseState=c;var d=function(a){function c(c,d,e){a.call(this,c,d,e);var f=c.getSchema("").properties[d],g=b.states;if(f){var h=b.stateProps(f);h&&h.length&&(g=h.concat(g))}this._init(c,d,e,g)}return __extends(c,a),c}(c);a.DataStates=d;var e=function(a){function c(c,d,e){a.call(this,c,d,e),this._init(c,"$links."+d,e,b.linksStates)}return __extends(c,a),c}(c);a.LinkStates=e}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b;!function(a){var b={errorChanged:function(a,b){if(a=a||[],b&&b.length){if(a.length!=b.length)return!0;for(var c=!1,d=0,e=a.length;d<e;d++){var f=a[d],g=b[d];if(f.code&&g.code){if(f.code!==g.code){c=!0;break}}else{if(!f.code||!g.code){c=!0;break}if(f.message!==g.message){c=!0;break}}}return c}if(a.length)return!0}},c=function(){function a(a,b,c,d){this._init(a,b,c,d)}return a.prototype.destroy=function(){var a=this;a._errors&&(a._errors=null),a.parent=null},a.prototype.errors=function(){return this._errors},a.prototype.clear=function(a){var b=this;return!!b._errors.length&&(b._errors.length=0,a&&b.notify(),!0)},a.prototype.hasErrors=function(){var a=this;return!(!a._errors||!a._errors.length)},a.prototype.addErrors=function(a,c){var d=this;d.nostore?d.parent&&d.parent.addErrors&&d.parent.addErrors(a,c):(c||b.errorChanged(d._errors,a))&&(d._errors=a||[],d.notify())},a.prototype.addError=function(a,b){var c=this;c.addErrors([{severity:"error",message:a}],b)},a.prototype.addSuccess=function(a,b){var c=this;c.addErrors([{severity:"success",message:a,timeout:2}],b)},a.prototype.addWarning=function(a,b){var c=this;c.addErrors([{severity:"warning",message:a,timeout:2}],b)},a.prototype.notify=function(){var a=this;a.parent&&a.parent.notifyStateChanged&&a.parent.notifyStateChanged(a.name+".errors",{})},a.prototype._init=function(a,b,c,d){var e=this;e._errors=c||[],e.name=b,e.parent=a,e.nostore=d},a}();a.Errors=c,a.errorsUtils=b}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="../datasets-plugin.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.dom,e=(b.SchemaUtils,b.DataUtils),f=a.DatasetPlugin,g=function(){function a(a,b){if("odata"!==a.$type)throw new Error("Only odata sources are supported.");var c=this;if(c._config=a||{},c._origFilter=c._config.$params.$filter,c._pageSize=0,c._model=b,c._currentPage=1,!c.isQuery())throw"Invalid Queryable DataSource";c._pageSize=c._config.$params.$top||0,c._orderby=c._config.$params.$orderby||""}return a.prototype.initPagination=function(a,b,c){var d=this;d._pageSize=a,d._totalCount=c,d._currentPage=b},a.prototype.initFromData=function(a){var b=this;b.isQuery()&&(b._pageSize=a.pageSize,b._currentPage=b._pageSize?Math.ceil(a.skip/b._pageSize)+1:0,b._totalCount=a.count,b._skip=a.skip)},Object.defineProperty(a.prototype,"filter",{get:function(){var a=this;return a._filter},set:function(a){var b=this;b._filter=a,b._filter&&b._filter.value?b._origFilter?b._config.$params.$filter={$left:b._origFilter,$op:"AND",$right:b._filter.value}:b._config.$params.$filter=b._filter.value:b._origFilter?b._config.$params.$filter=b._origFilter:b._config.$params.$filter=null,b.refresh(!0)},enumerable:!0,configurable:!0}),a.prototype.pageSize=function(){var a=this;return a.isQuery()?a._pageSize:0},a.prototype.orderBy=function(a){var b=this;return void 0===a?b._orderby:(a!==b._orderby&&(b._orderby=a,b.refresh(!0)),b._orderby)},a.prototype.refresh=function(a){var b=this;return new c.Promise(function(c,d){b.isQuery()?(a&&(b._currentPage=0),b._open().then(function(){b._model.notifyPaginationChanged(),b._model.notifySortingChanged(),c()})):c()})},a.prototype.currentPage=function(a){var b=this;if(void 0!=a){if(b.isQuery()){var c=Math.min(a,b.totalPages());b._currentPage!=c&&(b._currentPage=c,b._open().then(function(){b._model.notifyPaginationChanged()}))}return a}return b.isQuery()?b._currentPage:0},a.prototype.totalPages=function(){var a=this;return a.isQuery()?a._pageSize?Math.ceil(a._totalCount/a._pageSize):1:0},a.prototype.totalCount=function(){var a=this;return a.isQuery()?a._totalCount:0},a.prototype.destroy=function(){var a=this;a._config=null,a._model=null},a.prototype.isQuery=function(){return e.isQuery(this._config)},a.prototype.open=function(){return this._open()},a.prototype.remove=function(a,b){var e=this,g=e.isQuery();return g?new c.Promise(function(c,g){var h={name:"data",$type:e._config.$type,$method:"DELETE",$params:{$module:e._config.$params.$module,$entity:e._config.$params.$entity,$entityId:a}},i={};d.processing(!0),f.executeDatasets([h],{etag:b},i,{},function(a,b){d.processing(!1),b?e._model?(e._model.addAjaxException(b),g(null)):g(b):c(null)})}):null},a.prototype._open=function(){var a=this;return a._config.name="data",new c.Promise(function(b,c){d.processing(!0);var e=a.isQuery(),g={};e&&(
// update orderby
a._orderby&&a._config.$params.$orderby!==a._orderby&&(a._config.$params.$orderby=a._orderby),
// update pagination
a._pageSize>0?(a._config.$params.$top=a._pageSize,a._config.$params.$skip=Math.max(0,a._currentPage-1)*a._pageSize,0==a._config.$params.$skip&&delete a._config.$params.$skip):(delete a._config.$params.$top,delete a._config.$params.$skip)),f.executeDatasets([a._config],{},g,{},function(f,h){if(d.processing(!1),h)a._model?(a._model.addAjaxException(h),c(null)):c(h);else{var i=g.data;if(a.initFromData(i),e&&a._skip&&a._skip>=a._totalCount)return a._currentPage=0,a._open().then(function(a){b(a)});a._model&&(a.isQuery()?a._model.setModel(i.documents):a._model.setModel(i)),b(i)}})})},a.prototype.save=function(){var a=this;a.isQuery()||!a._model.validate()},a}();b.QueryableDataSource=g}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/ajax.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="./state.data.ts" />
/// <reference path="./errors.data.ts" />
/// <reference path="./queryable.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=c.SchemaUtils,e=c.DataUtils,f=a.utils,g=a.ajax,h=a.locale,i=a.ulocale,j=a.locale.schema,k=function(a,c){var e=a._rootParent._schema,f=a._schema.properties[c];d.inModel(f,e)&&(Object.defineProperty(a,c,{get:function(){var a=this,b=a._children[c];return b?b:a._model[c]},set:function(b){var e=this,f=e._model[c];if((f!==b||!e._initialized[c])&&(e._initialized[c]=!0,e._beforeChange(c,f,b))){e._model[c]=b;var g=e._schema.properties[c],h=a._rootParent._schema;d.isCompositionRef(g,h)?(e._setRefChild(c,f,b,{}),e._notifyChanged(c,f,b,"propchange",{},!0),e.notifyStateChanged(c,{})):d.isCompositionList(g,h,!1)?(e._setListChild(c,f,b,"propchange",{}),e._notifyChanged(c,f,b,"propchange",{},!0),e.notifyStateChanged(c,{})):d.isSimpleList(g,h)?(e._setSimpleListChild(c,f,b,"propchange",{}),e._notifyChanged(c,f,b,"propchange",{},!0),e.notifyStateChanged(c,{})):d.isList(g,h)?e[c].setModel(b):e._notifyChanged(c,f,b,"propchange",{},!0)}},enumerable:!0}),d.isCompositionList(f,e,!1)&&
// add expand 
Object.defineProperty(a,c+b.EXPANDED_FIELD_NAME,{get:function(){var a=this,b=a[c];return b&&b.length?b.$expand?2:1:0},set:function(a){var b=this,d=b[c];d&&(1===a?d.$expand=!1:2===a&&(d.$expand=!0))},enumerable:!0}))},l=function(a,b,e){var f=a._schema.properties[b],g=a._rootParent._schema;d.inModel(f,g)&&(d.isNumber(f)&&(d.isMoney(f)?(e=e||{},e.symbol||(e.symbol=f.symbol||h.number.symbol),e.decimals||(e.decimals=void 0!==f.decimals?f.decimals:h.number.places)):(e=e||{},void 0!==f.symbol&&(e=e||{},e.symbol=f.symbol),void 0!==f.decimals?e.decimals=f.decimals:e.decimals=0)),a.$states[b]=new c.DataStates(a,b,e))},m=function(a,b,e){var f=a._schema.properties[b],g=a._rootParent._schema;d.inModel(f,g)&&(a.$errors[b]=new c.Errors(a,b,e,d.isCompositionRef(f,g)))},n=function(a,b,d){a.$links[b]=new c.LinkStates(a,b,d)},o={setValue:function(a,b,c,d){c.setValue(a,b,d)},getValue:function(a,b,c){return b.getValue(a,c)},getState:function(a,b,c){return b.getState(a,c)},_resolveSegment:function(a,b,c,d,e,f){if("$item"!==a)return"$selected"===a?(f&&(c[a]=e),c[a]):"$new"===a?(f&&(c[a]=e),c[a]):c&&c[a]&&"function"==typeof c[a]?f?c[a](e):c[a]():(f&&(c[a]=e),c[a]);if(d){var g=d[b];if(g&&void 0!==g.$index)return f&&(c[g.$index]=e),c.get(g.$index)}}},p=function(){function a(a,b,c,e,f,g){var h=this;h._map={},h._expanded=!1,h._selectedUids=[],h._selectedPks=[],h.isNull=!1,h.isUndefined=!0,h._model=void 0,h._items=[],h._path=c,h._parent=b,h._locale=g,h._arrayParent=f,h._rootSchema=h._parent.getRootModel().getSchema(""),h._schema=a,h._schemaItems=d.expand$Ref(a.items,h._rootSchema),h.frozen=!1,h._setModel(e,!1),h._createCustomProps()}return Object.defineProperty(a.prototype,"$selected",{get:function(){return this._selected},set:function(a){var b=this;b._selected!==a&&(b._selected=a,b._parent&&(b._parent.notifyStateChanged(b._path+".$selected",{}),///????
b._parent._notifyChanged(b._path+".$selected",void 0,void 0,"propchange",{},!1)))},enumerable:!0,configurable:!0}),a.prototype.pushSelected=function(a,b){var c=this,e=a.$id,f=c._selectedUids.indexOf(e);if(f<0&&c._selectedUids.push(e),b&&c._schemaItems.primaryKey){var g=d.pkFields(c._schemaItems.primaryKey);e=d.pk2Id(d.extractPkValue(a,g),g),f=c._selectedPks.indexOf(e),f<0&&c._selectedPks.push(e)}c.$selected=a},a.prototype.model=function(a){return this._getModel(a)},a.prototype._getModel=function(a){var b=this;return a?b._model:b._model},a.prototype._initModelInParent=function(){var a=this;if(!a._model&&(a._model=[],a.isNull=!1,a.isUndefined=!1,a._parent)){var b=a._parent.model(!0);b[a._path]=[]}},a.prototype.removeSelected=function(a,b){var c=this,e=c._selectedUids.indexOf(a.$id);if(e===c.$selected&&(c.$selected=null),e>=0&&c._selectedUids.splice(e,1),b&&c._schemaItems.primaryKey){var f=d.pkFields(c._schemaItems.primaryKey),g=d.pk2Id(d.extractPkValue(a,f),f);e=c._selectedPks.indexOf(g),e>=0&&c._selectedPks.splice(e,1)}},a.prototype.notifyChangedProperty=function(a){var b=this;b._parent._notifyChanged(b._path,void 0,void 0,a,{},!1)},a.prototype.addAjaxException=function(a){var b=this;return b._parent.addAjaxException(a)},a.prototype.notifyPaginationChanged=function(){},a.prototype.notifyCountChanged=function(){this.notifyChangedProperty("count")},a.prototype.notifySortingChanged=function(){},a.prototype.isQueryable=function(){return this._queryable||!1},a.prototype.addErrors=function(a){var b=this,c=b._parent.$errors[b._path];c?c.addErrors(a):b._parent.addErrors(a)},a.prototype.addError=function(a){var b=this,c=[{severity:"error",message:a}];b.addErrors(c)},a.prototype._createCustomProps=function(){var a=this;Object.defineProperty(a,"length",{get:function(){return this._items.length},enumerable:!0})},a.prototype._destroyItems=function(){var a=this;a._selectedUids=[],a._items&&(a._model=void 0,a._items=[])},a.prototype.$orderby=function(a){return""},a.prototype.totalPages=function(){return 1},a.prototype.totalCount=function(){return this._items.length},a.prototype.length=function(){return this._items.length},a.prototype.destroy=function(){var a=this;a._parent=null,a._arrayParent=null,a._destroyItems(),a._selectedPks=null,a._model=null,a._schema=null,a._schemaItems=null,a._rootSchema=null},a.prototype._fillItems=function(){var a=this;a._model&&a._model.forEach(function(b,c){a._items.push(b)})},a.prototype._setModel=function(a,b){var c=this;c.isNull=null===a,c.isUndefined=void 0===a;var d=c.frozen;b&&(c.frozen=!0),
// remove && destroy items 
c._destroyItems(),c._model=a,c._fillItems(),c.frozen=d},a.prototype.setModel=function(a){var b=this;b._setModel(a,!0),b._parent._notifyChanged(b._path,void 0,void 0,"set",{},!1),b.notifyCountChanged(),b._parent.notifyStateChanged(b._path,{}),///????
b.afterSetModel()},a.prototype.afterSetModel=function(){var a=this;a.$selected=null},a.prototype.updateParams=function(a,b,c,d){var e=this;d=d||"$item";var f=e._items.indexOf(a);b=b?d+"."+b:d;var g=[];return a._getFullPath(g),c[g.join(".")]={$index:f,$value:a},b},a.prototype.indexOf=function(a){return this._items.indexOf(a)},a.prototype.find=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var d=a.split(","),e=d.length,f=0,g=this._items.length;f<g;f++){for(var h=!0,i=this._items[f],j=0;j<e;j++)if(b[j]!==i[d[j]]){h=!1;break}if(h)return i}return null},a.prototype._expandForEach=function(a,b,c,d){return this._items.forEach(function(e){a(e,d,c),d++;var f=e[b];f&&f.$expand&&(d=f._expandForEach(a,b,c+1,d))}),d},a.prototype.forEach=function(a,b){return b?void this._expandForEach(a,b,0,0):this._items.forEach(function(b,c){return a(b,c,0)})},a.prototype.get=function(a){return this._items[a]},Object.defineProperty(a.prototype,"$expand",{get:function(){return this._expanded},set:function(a){var c=this;if(c._expanded!==a){var d=c._parent[c._path+b.EXPANDED_FIELD_NAME];c._expanded=a;var e=c._parent[c._path+b.EXPANDED_FIELD_NAME];e!==d&&c._parent._notifyChanged(c._path+b.EXPANDED_FIELD_NAME,d,e,"propchange",{},!0)}},enumerable:!0,configurable:!0}),a}();b.DataListCore=p;var q=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype._fillItems=function(){var a=this,b=null;a._map={},a._selectedUids=[],a.$selected=null,a._selectedPks.length&&(b=d.pkFields(a._schemaItems.primaryKey)),a._model&&a._model.forEach(function(c,e){var f=new w(a._schemaItems,a._parent,a._path,c,a,!1,a._locale,null),g=!1;if(a._items.push(f),a._map[f.$id]=f,b){var h=d.pk2Id(d.extractPkValue(c,b),b);a._selectedPks.lastIndexOf(h)>=0?(f.internalSetSelected(!0,!1),g=!0):f.$select&&(g=!0)}else f.$select&&(g=!0);g&&a.pushSelected(f,!1)})},b.prototype._updateSelecting=function(a,b,c){var d=this;if(a)d._selectedUids.forEach(function(a){var b=d._map[a];b&&d.pushSelected(b,!0)});else if(d._selectedPks=[],d._selectedUids.length){var e=d._selectedUids.slice(0);c.length||c.push(e.pop()),e.forEach(function(a){var b=d._map[a];b&&(b.$select=!1)})}b&&d._items.forEach(function(d){var e=d[b];e&&e._updateSelecting(a,b,c)},null)},b.prototype.clearSelection=function(a){var b=this;b.enumSelectedItems(a,function(c){b.selectItem(!1,c,!1,a,!1)})},b.prototype.updateSelecting=function(a,b){this._updateSelecting(a,b,[])},b.prototype.enumSelectedItems=function(a,b){var c=this;c._enumSelected(a,function(a,c){c&&b(c)})},b.prototype._enumChildren=function(a,b){var c=this;a&&c._items.forEach(function(c){b(c);var d=c[a];d&&d._enumChildren(a,b)})},b.prototype._enumSelected=function(a,b){var c=this;if(a)c._enumSelected(null,b),c._items.forEach(function(c){var d=c[a];d&&d.$expand&&d._enumSelected(a,b)});else{var d=c._selectedUids.slice(0);if(!d.length)return;b(c,null),d.forEach(function(a){var d=c._map[a];d&&b(c,d)})}},b.prototype.selectItem=function(a,b,c,d,e){var f=this;if(b)if(a){if(!b.$select)if(c){if(b.$select=!0,d&&e){var g=b[d];g&&g._enumChildren(d,function(a){a.$select=!0})}}else{f._enumSelected(d,function(a,b){a&&!b?a._selectedUids=[]:b.internalSetSelected(!1,!0)}),b.internalSetSelected(!0,!0);var h=b._arrayParent;h&&h.pushSelected(b,!1)}}else if(b.$select)if(c){if(b.$select=!1,d&&e){var g=b[d];g&&g._enumChildren(d,function(a){a.$select=!1})}}else{b.internalSetSelected(!1,!0);var h=b._arrayParent;h&&f.removeSelected(b,!1)}},b.prototype.findById=function(a){return this._map[a]},b.prototype.indexOf=function(a){var b=this;return"object"!=typeof a&&(a=b.findById(a)),a?b._items.indexOf(a):null},b.prototype._beforeRemoveItem=function(a){var b=this;b.$selected===a&&(b.$selected=null)},b}(p);b.DataListBase=q;var r=function(a){function c(c,d,f,g,h,i,j,k,l,m){a.call(this,d,f,g,h,l,m);var n=this,o=n._parent.getRootModel(),p=e.dsConfig(o.datasets,d,!0);if(!p)throw'Invalid config! You must define a dataset in form for the property: "'+g+'".';n._main=p.$main,n._queryable=!0,n._query=new b.QueryableDataSource(p,n),n._query.initPagination(i,j,k),n._main&&o&&(o.onRefresh=function(a){var b=a&&a.resetPagination;return n.$refresh(b)})}return __extends(c,a),Object.defineProperty(c.prototype,"filter",{get:function(){return this._query.filter},set:function(a){this._query.filter=a,this.notifyChangedProperty("filter")},enumerable:!0,configurable:!0}),c.prototype.totalPages=function(){return this._query.totalPages()},c.prototype.totalCount=function(){return this._query.totalCount()},c.prototype.$refresh=function(a){return this._query.refresh(a)},c.prototype.$orderby=function(a){return this._query.orderBy(a)},c.prototype.notifyPaginationChanged=function(){this.notifyChangedProperty("pagination")},c.prototype.notifyFilterChanged=function(){this.notifyChangedProperty("filter")},c.prototype.notifySortingChanged=function(){this.notifyChangedProperty("sorting")},c.prototype.currentPage=function(a){return void 0!=a?this._query.currentPage(a):this._query.currentPage()},c.prototype._removeItem=function(a,b){var c=this;if(c._query){var d=c._query.remove(a,b);d.then&&d.then(function(){c.$refresh(!(c._items.length>1)).then(function(){})})}},c.prototype.remove=function(a){var b=this,c=a.model(!0),e=c?c["@odata.etag"]:null;if(b._schemaItems&&b._schemaItems.primaryKey){var g=d.odataId(d.pkFields(b._schemaItems.primaryKey),a);if(b._schemaItems.links&&b._schemaItems.links.$remove&&b._schemaItems.links.$remove.confirm){var h=b._schemaItems.links.$remove.confirm;b._locale&&(h=i.tt(h||"",b._locale)),f.confirm(null,h,function(){b._removeItem(g,e)})}else b._removeItem(g,e)}},c.prototype.destroy=function(){var b=this;if(b._query&&(b._query.destroy(),b._query=null),b._main){var c=b._parent.getRootModel();c&&(c.onRefresh=null)}a.prototype.destroy.call(this)},c}(q);b.QueryList=r;var s=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype._destroyItems=function(){a.prototype._destroyItems.call(this);var b=this;b._selectedPks=[]},b.prototype.find=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var d=a.split(","),e=d.length,f=0,g=this._items.length;f<g;f++){for(var h=!0,i=this._items[f],j=0;j<e;j++)if(b[j]!==i[d[j]]){h=!1;break}if(h)return i}return null},b}(q);b.CompositionList=s;var t=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype._destroyItems=function(){a.prototype._destroyItems.call(this);var b=this;b._selectedPks=[]},b}(p);b.SimpleCompositionList=t;var u=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.push=function(a){var b=this;b._initModelInParent(),b._model.push(a),b._items.push(a),b._parent._notifyChanged(b._path,void 0,a,"add",{$index:b._items.length-1,$value:a,$id:a},!1),b.notifyCountChanged()},b.prototype.splice=function(a,b,c){if(b>0)throw"Delete count is not supported.";var d=this;d._model&&(d._model.splice(a,b,c),d._items.splice(a,b,c),d._parent._notifyChanged(d._path,void 0,c,"add",{$index:a,$value:c,$id:c},!1),d.notifyCountChanged())},b.prototype.remove=function(a){var b=this,c=b._items.indexOf(a);c>=0&&(b._items.splice(c,1),b._model.splice(c,1),b._parent._notifyChanged(b._path,void 0,a,"remove",{$index:c,$value:a,$id:a},!1),b.notifyCountChanged())},b}(t);b.SimpleTypeList=u;var v=function(a){function b(b,c,d,e,f,g){a.call(this,b,c,d,e,f,g);var h=this;h._createNewItem(!1,!0)}return __extends(b,a),b.prototype._initNew=function(){var a=this,b=d.init(a._schemaItems,a._rootSchema,null,null);a._new=new w(a._schemaItems,a._parent,a._path+".$new",b,null,!0,a._locale,null),a._new._notifyChanged("",void 0,b,"propchange",{},!1),a._new.notifyStateChanged("",{})},b.prototype._createNewItem=function(a,b){var c=this;b&&Object.defineProperty(c,"$new",{get:function(){var a=this;return a._new||a._initNew(),a._new},set:function(a){var b=this;b._new||b._initNew(),b._new._setModel(a,!0),b._new._notifyChanged("",void 0,a,"propchange",{}),b._new.notifyStateChanged("",{})},enumerable:!0}),a&&!c._new&&c._initNew()},b.prototype.updateItem=function(a,b){var c=this;
// validate
if(!b.validate())return!1;
// clear errors 
b.$errors.$.addErrors([],!1);
// validate primary key
var e=b._getModel(!0);if(c._schemaItems.primaryKey){var g=d.pkFields(c._schemaItems.primaryKey),h=d.extractPkValue(e,g),i=(d.extractPkValue(a._getModel(!0),g),d.findByPk(h,g,c._items));if(i&&i!==a){
// Primary key violation
var k=g.length>1?j.uniqueColumns:j.uniqueColumn;return b.$errors.$.addErrors([{code:"duplicate_value",message:f.format(k,g.join(", "))}],!1),!1}}
// update Old object
return!0},b.prototype.addNew=function(){var a=this;if(a._new&&a._new.validate()){var b=a._new._getModel(!1);if(a._schemaItems.primaryKey){var c=d.pkFields(a._schemaItems.primaryKey),e=d.extractPkValue(b,c),g=d.findByPk(e,c,a._items);if(
// Primary key violation
a._parent.$errors[a._path].addErrors([],!1),g){var h=c.length>1?j.uniqueColumns:j.uniqueColumn;return void a._parent.$errors[a._path].addErrors([{code:"duplicate_value",message:f.format(h,c.join(", "))}],!1)}}else a._parent.$errors[a._path].addErrors([],!1);a._destroyNew(),a.push(b),a._createNewItem(!0,!1)}},b.prototype._destroyNew=function(){var a=this;a._new&&(a._new.destroy(),a._new=null)},b.prototype.destroy=function(){var b=this;b._destroyNew(),a.prototype.destroy.call(this)},b.prototype.push=function(a){var b=this;b._initModelInParent(),b.splice(-1,0,a)},b.prototype.splice=function(a,b,c){if(b>0)throw"Delete count is not supported.";var d=this,e=d.frozen;d.frozen=!0;var f=a<0;f?(d._initModelInParent(),d._model.push(c)):d._model.splice(a,b,c);var g=new w(d._schemaItems,d._parent,d._path,c,d,!1,d._locale,null);f?d._items.push(g):d._items.splice(a,b,g),d.frozen=e,d._map[g.$id]=g,g.$select&&d.pushSelected(g,!0),g._notifyChanged("",void 0,c,"add",{$index:f?d._items.length-1:a,$id:g.$id,$value:g},!1),g.notifyStateChanged("",{})},b.prototype.remove=function(a){var b,c=this,d=null,e=c.frozen;if(c._model){c.frozen=!0;var f=c._items.indexOf(a),g=a.$id;if(c._beforeRemoveItem(a),f>=0&&(d=a.model(),b=!0,c._items.splice(f,1),c._model.splice(f,1),c.removeSelected(a,!0),a.destroy()),c.frozen=e,delete c._map[g],b){var h=(c._path?c._path+".":"")+"$item";c._parent._notifyChanged(h,void 0,void 0,"remove",{$index:f,$value:d,$id:g},!1),c._parent.notifyStateChanged(h,{})}}},b}(s);b.DataList=v;var w=function(){function h(a,b,c,e,g,h,i,j,k){var l=this;l._rootParent=b?b._rootParent:l,l.$id=f.allocID(),l.$create=!1,l._initialized={},l._selected=!(!e||!e.$select),l._model={},l.datasets=j,l.transform=k,l.$states={},l.$errors={},l.$links={},l._path=c,l._locale=i,l._parent=b,l._schema=d.expand$Ref(a,l._rootParent._schema),l._parent||(l._validators=[{name:"schema",active:!0}]),l._arrayParent=g,l._children={},l._initFromSchema(a),l._parent&&!h||(l.frozen=!0),e&&e.$create&&(delete e.$create,l.$create=!0),l._setModel(e,!1),l.frozen=!1,l._parent||(l._notifyChanged("*",void 0,e,"propchange",{},!1),l.notifyStateChanged("*",{}))}
//validators
//TODO states for $index
return h.prototype.saveModel=function(){var a=this;a._origModel=d.copyModel(a._schema,a._model)},h.prototype.setModel=function(a){var b=this;b._destroyObject(b,"_children"),b._children={},b.frozen=!0,b._setModel(a,!1),b.frozen=!1,b._parent||(b._notifyChanged("*",void 0,a,"propchange",{},!1),b.notifyStateChanged("*",{}))},h.prototype.update=function(a){var b=this;if(a){var c=Object.keys(b._schema.properties),e=b._rootParent._schema;c.forEach(function(c){var f=b._schema.properties[c];if(d.inModel(f,e))if(d.isCompositionRef(f,e)){b[c]}else d.isCompositionList(f,e,!1)?b[c]=a[c]:d.isSimpleList(f,e)||(d.isList(f,e)?b[c]=a[c]:b[c]=a[c])})}},h.prototype.$refresh=function(a){var b=this;return b._parent?f.Promise.resolve():b.onRefresh?b.onRefresh(a):new f.Promise(function(a,c){e.loadMainData({datasets:b.datasets,transform:b.transform}).then(function(c){b.update(c),a()}).catch(function(a){b.addAjaxException(a),c()})})},h.prototype._validate=function(b){var c=this;if(!b||!b.length)return!0;var e=Object.keys(c._schema.properties),g=!1,h=c._rootParent._schema;return e.forEach(function(e){var i=c._schema.properties[e],k=!1;if(d.inModel(i,h)){var l=c.$states[i.$stateProperty||e];if(!l.isHidden&&!l.isDisabled){if(d.isCompositionRef(i,h)){var m=c[e];m?m._validate(b)||(g=!0):l.isMandatory&&(c.$errors[e].addErrors([{message:f.format(j.required,d._title(i.title,a.locale))}],!1),g=!0)}else if(d.isCompositionList(i,h,!1)){var n=c[e];n&&(n.forEach(function(a){a._validate(b)||(g=!0)}),k=!0)}else k=!0;k&&(c._execValidators(b,e,"validate",{},{base:c,state:l,schema:i,value:c[e]})||(g=!0))}}}),c._parent||c._execValidators(b,"","validate",{},{base:c,state:null,schema:c._schema,value:null})||(g=!0),!g},h.prototype.validate=function(){var a=this,b=a.getRootModel();return a._validate(b._validators)},Object.defineProperty(h.prototype,"$select",{get:function(){return this._selected},set:function(a){var b=this;b.internalSetSelected(a,!0)&&b._arrayParent&&(b._selected?b._arrayParent.pushSelected(b,!0):b._arrayParent.removeSelected(b,!0))},enumerable:!0,configurable:!0}),h.prototype.select=function(a,b,c,d,e){var f=this;return b?void(f._arrayParent&&f._arrayParent.selectItem(a,f,b,d,e)):void(d?c.selectItem(a,f,!1,d,e):f._arrayParent&&f._arrayParent.selectItem(a,f,!1,null,!1))},h.prototype.toggleExpand=function(a){var b=this,c=!1;if(!a)return c;var d=b[a];return d&&(d.$expand=!d.$expand,c=d.$expand),c},h.prototype.enumVisibleChildren=function(a,b,c,d){var e=this,f=e[a];f&&(f.$expand||c)&&f._items.forEach(function(c){d(c,b+1),c.enumVisibleChildren(a,b+1,!1,d)})},h.prototype.internalSetSelected=function(a,b){var c=this;return c._selected!==a&&(c._selected=a,b&&c._notifyChanged("$select",!c._selected,a,"propchange",{},!0),!0)},h.prototype.$index=function(a){var b=this;return b._arrayParent?Math.max(b._arrayParent.indexOf(b),0)+1:0},h.prototype.$save=function(){var a=this,b=a.getRootModel();if(b!==a)return f.Promise.reject(null);if(!a.validate())return f.Promise.reject(null);var c=e.extractMainDataSource(a);if(c&&e.isCreateOrUpdate(c)){var g=a.model(!1);if(a.$create)c.$method="POST",delete c.$params.$entityId;else{if(c.$method="PATCH",!a._schema.primaryKey)return a.addError("Primary key is missing. Check schema."),f.Promise.reject(null);var h=d.pkFields(a._schema.primaryKey),i=d.extractPkValue(g,h);c.$entityId=d.entityId(i);var j=f.deltaPatch(a._origModel,g);if(!j)return f.Promise.resolve(g);
// send delta
g=j}return new f.Promise(function(b,d){e.datasetAsPromise(c,g).then(function(a){b()}).catch(function(b){a.addAjaxException(b),d(null)})})}return f.Promise.reject(null)},h.prototype.getRootModel=function(){return this._rootParent},h.prototype.addValidator=function(a,b){var c=this.getRootModel();c._validators.push({name:a,active:b})},h.prototype.activateValidator=function(a,b){for(var c=this,d=c.getRootModel(),e=0,f=d._validators.length;e<f;e++){var g=d._validators[e];if(g.name===a){g.active=b;break}}},h.prototype.hasValidators=function(){var a=this,b=a.getRootModel();if(b._validators.length){if(1==b._validators.length)return b._validators[0].active;for(var c=0,d=b._validators.length;c<d;c++)if(b._validators[c].active)return!0}return!1},h.prototype.getParentOf=function(a,c){return this.getValue(b.SchemaUtils.parentPath(a),c)},h.prototype.setValue=function(a,b,c){for(var e=this,f=e,g=a.split("."),h=[],i=g.pop(),j=0,k=g.length;j<k&&f;j++){var l=g[j];h.push(l),f="$"==l.charAt(0)?o._resolveSegment(l,h.join("."),f,c):f[l]}f&&("$"!=i.charAt(0)||d.isMetaProp(i)?f[i]=b:(h.push(i),o._resolveSegment(i,h.join("."),f,c,b,!0)))},h.prototype._getModel=function(a){var b=this;if(a)return b._model;var c=b.getRootModel(),e=c?c._schema:b._schema;return d.copyModel(b._schema,b._model,e)},h.prototype.model=function(a){return this._getModel(a)},h.prototype.getRelativeValue=function(a){return this.getValue(a,{})},h.prototype.getRelativeState=function(a){return this.getState(a,{})},h.prototype.getValueInfo=function(a,b){var c=this;if(!a)return{value:c,parentIsNull:!1};for(var e=c,f=a.split("."),g=f.pop(),h=[],i=0,j=f.length;i<j&&e;i++){var k=f[i];h.push(k),e="$"===k.charAt(0)?o._resolveSegment(k,h.join("."),e,b):e[k]}return e?g&&"$"==g.charAt(0)&&!d.isMetaProp(g)?(h.push(g),{value:o._resolveSegment(g,h.join("."),e,b),parentIsNull:!1}):{value:g?e[g]:e,parentIsNull:!1}:{value:void 0,parentIsNull:!1}},h.prototype.getValue=function(a,b){return this.getValueInfo(a,b).value},h.prototype._getFullPath=function(a,b){var c=this;return c===b?a:(c._parent&&c._parent._getFullPath(a,null),c._path&&a.push(c._path),void(c._arrayParent&&a.push("$item")))},h.prototype.getSchema=function(a){var b=this;return d.getSchema(a,b._schema,b._rootParent._schema,!1)},h.prototype.getState=function(a,c){var e,f=this,g=a.split("."),h=g.pop(),i=h,j=f,k={},l=[],m=!1,n=g.length-1,p=d.isMetaProp(h);if(p){var q=d.getSchema(a,f._schema,f._rootParent._schema,!1);q&&q.$stateProperty&&(h=q.$stateProperty)}for(var r=0;r<=n;r++){var s=g[r],t=!1;if(l.push(s),d.arrayProps.indexOf(s)>=0)
//xxxxxxx
//TODO : params for $item
"$selected"===s?(j=j[s],t=!0):"$new"===s?(j=j[s],t=!0):"$item"===s?(j=o._resolveSegment(s,l.join("."),j,c),t=!0):j=j[s];else if(r===n&&"$links"===s){m=!0;break}if(t?e=null:j?(e=j.$states[s]?j.$states[s].state():null,j=j[s]):e=null,(!j||j.isNull||j.isUndefined)&&(k.isDisabled=!0),e&&e.isHidden&&(k.isHidden=!0),e&&e.isDisabled&&(k.isDisabled=!0),e&&e.isReadOnly&&(k.isReadOnly=!0),!j)break}var u={};if(!m){if(h===b.SELECTED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!1,isHidden:!1};if(h===b.INDEX_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1};if(h===b.EXPANDED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1}}if(j){var v="$states";m&&(v="$links");var w=j[v]?j[v][h]:null;w&&(u=w.state(),!m&&j.$errors&&(u.errors=j.$errors[i].errors()))}return $.extend({},u,k)},h.prototype._setModel=function(a,b){var c=this,e=c.frozen;b&&(c.frozen=!0),c.isNull=null===a,c.isUndefined=void 0===a,a=a||{},a.$states=a.$states||{},a.$links=a.$links||{},a.$errors=a.$errors||{};var f=Object.keys(c._schema.properties),g=c._rootParent._schema;f.forEach(function(b){var e=c._schema.properties[b];if(d.inModel(e,g)){var f=d.isMetaProp(b),h=a[b];if(h||!d.isCompositionList(e,g,!1)&&!d.isList(e,g)||(
//val = [];
a[b]=h),d.isList(e,g)?c._setQueryListChild(b,h,a.pageSize,a.pageSize?Math.round(a.skip/a.pageSize)+1:0,a.count):c[b]=h,!f){if(a.$states&&a.$states[b]){var i=a.$states[b];Object.keys(i).forEach(function(a){c.$states[b][a]=i[a]})}a.$states[b]=c.$states[b].state()}if(a.$errors&&a.$errors[b]){var j=a.$errors[b],k=[];j.forEach(function(a){k.push(a)}),c.$errors[b].addErrors(k)}a.$errors[b]=c.$errors[b].errors()}}),
//for each link set state
a.$links&&(f=Object.keys(c._schema.links||{}),f.forEach(function(b){var d=a.$links[b],e=c.$links[b];d&&Object.keys(d).forEach(function(a){e[a]=d[a]}),a.$links[b]=c.$links[b].state()})),c._model=a,c.frozen=e},h.prototype._setRefChild=function(a,b,c){var d=this,e=d.frozen;d.frozen=!0,d._children[a]?d._children[a]._setModel(c,!1):d._children[a]=new h(d._schema.properties[a],d,a,c,null,!1,d._locale,null),d.frozen=e},h.prototype._setListChild=function(a,b,c){var d=this,e=d.frozen;d.frozen=!0,d._children[a]?d._children[a]._setModel(c,!1):d._children[a]=new v(d._schema.properties[a],d,a,c,null,d._locale),d.frozen=e},h.prototype._setSimpleListChild=function(a,b,c){var d=this,e=d.frozen;d.frozen=!0,d._children[a]?d._children[a]._setModel(c,!1):d._children[a]=new u(d._schema.properties[a],d,a,c,null,d._locale),d.frozen=e},h.prototype._setQueryListChild=function(a,b,c,d,e){var f=this,g=f.frozen;f.frozen=!0,f._children[a]&&f._children[a].destroy(),f._children[a]=new r(f._schema,f._schema.properties[a],f,a,b,c,d,e,null,f._locale),f.frozen=g,f._notifyChanged(a,null,b,"propchange",{},!0),f.notifyStateChanged(a,{})},h.prototype._initFromSchema=function(b){var e=this;if(e._model){var f=b.states?$.extend(!0,{},b.states):null,g=b.links?$.extend(!0,{},b.links):null,h=b.errors?$.extend(!0,{},b.errors):null,i=!1,j=Object.keys(b.properties);j.forEach(function(c){if(!d.isMetaProp(c)){var e=b.properties[c];if("password"===e.format){if(!e.capabilities||!e.capabilities.noConfirming){var f="$$"+c;e.$meta=f;var g=b.properties[f];g||(g=$.extend(!0,{},e),g.title=a.locale.ui.Confirm,
// for this field use $stateProperty to get    
g.$stateProperty=c,b.properties[f]=g,i=!0)}}else"rate"===e.format&&(e.exclusiveMinimum=!0,e.exclusiveMaximum=!0,e.decimals=d.RATE_DECIMALS,e.maximum=d.RATE_MAXIMUM,e.minimum=-d.RATE_MAXIMUM,void 0===e.symbol&&(e.symbol=d.RATE_SYMBOL))}}),i&&(j=Object.keys(b.properties)),j.forEach(function(a){k(e,a),d.isMetaProp(a)||l(e,a,f?f[a]:null),m(e,a,h?h[a]:null)}),b.links&&Object.keys(b.links).forEach(function(a){n(e,a,g?g[a]:null)}),
// root error
e._parent||(e.$errors.$=new c.Errors(e,"$",[],!1))}},h.prototype.getParentModel=function(a){var b=a.split(".");return b.pop(),o.getValue(b.join("."),this)},h.prototype.addAjaxException=function(a){var b=this;if(b._parent)return b._parent.addAjaxException(a);var c=g.extractAjaxErrors(a),e=[],f=null;c.message&&(f={message:c.message,details:[]},e.push(f)),c.list&&c.list.length&&c.list.forEach(function(a){var c=!0;if(a.target){var g=b.getParentModel(a.target);if(g){var h=d.lastSegment(a.target,null);g.hasOwnProperty(h)&&(c=!1,g.$errors[h].addError(a.message))}}c&&(f?f.details.push({message:a.message}):e.push({message:a.message}))}),b.$errors.$.addErrors(e)},h.prototype.addError=function(a){var b=this,c=[{severity:"error",message:a}];b.addErrors(c)},h.prototype.addErrors=function(a){var b=this;b._arrayParent||(b._parent?b._parent.addErrors(a):b.$errors.$&&b.$errors.$.addErrors(a))},h.prototype._beforeChange=function(a,b,c){return!0},h.prototype.notifyStateChanged=function(a,b){var c=this;if(!(c.frozen||c._arrayParent&&c._arrayParent.frozen)){if(c._arrayParent){var d=a;a=c._arrayParent.updateParams(c,d,b,"$item");var e=c._arrayParent.findById(c.$id);e===c&&c._arrayParent.$selected===c&&(a=c._arrayParent.updateParams(c,d,b,"$selected"),c._parent&&c._parent.notifyStateChanged(a?c._path+"."+a:c._path,b))}c._parent?c._parent.notifyStateChanged(a?c._path+"."+a:c._path,b):(f.logModule("proxydata")&&f.log("State changed: "+c._extractPropName(a||"",b),"proxydata"),c.onstatechanged&&c.onstatechanged(a,b))}},h.prototype._extractPropName=function(a,b){return Object.keys(b).sort().reverse().forEach(function(c){var d=b[c];d&&void 0!==d.$index&&(a=a.replace(c,c+"["+d.$index+"]"))}),a},h.prototype._execValidators=function(a,b,c,e,f){var g=this,h=!1;if(b){if(!f){var i=g.getValueInfo(b,e);if(void 0===i.value&&i.parentIsNull)return!h}}else if("validate"!==c)return!h;var j=!0;return a.forEach(function(a){a.active&&(a.hnd||(a.hnd=d.getValidator(a.name)),a.hnd&&(f&&(f.add=!j),a.hnd(c,g,{name:b,params:e,locale:g._locale},f)||(h=!0),j=!1))}),!h},h.prototype._notifyChanged=function(a,b,c,d,e,g){var h=this;if(!(h.frozen||h._arrayParent&&h._arrayParent.frozen)){if(h._arrayParent){if("propchange"===d&&a){var i=h._arrayParent.findById(h.$id);if(i===h){var j=i.$id;e.$oid?j=e.$oid:e.$oid=i.$id,h._parent._notifyChanged(h._path,b,c,"upd",{$id:i.$id,property:a,$oid:j},g),h._arrayParent.$selected===h&&h._parent._notifyChanged(h._path+".$selected",b,c,"upd",{$id:i.$id,property:a,$oid:j},g)}}a=h._arrayParent.updateParams(h,a,e)}h._parent?h._parent._notifyChanged(a?h._path+"."+a:h._path,b,c,d,e,g):(f.logModule("proxydata")&&f.log("Changed: "+h._extractPropName(a||"",e)+", operation = "+d,"proxydata"),h.onchange&&h.onchange(a,b,c,d,e),g&&h._validators&&h.hasValidators()&&h._execValidators(h._validators,a,"propchanged",e))}},h.prototype._destroyObject=function(a,b){var c=a[b];c&&Object.keys(c).forEach(function(a){c[a].destroy(),delete c[a]})},h.prototype.destroy=function(){var a=this;a._parent=null,a._destroyObject(a,"_children"),a._destroyObject(a,"$states"),a._destroyObject(a,"$links"),a._destroyObject(a,"$errors"),a._arrayParent=null,a._model=null,a._schema=null,a.onRefresh=null,a.onchange=null,a.onstatechanged=null,a._rootParent=null},h}();b.Data=w,b.ObservableUtils=o}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/modules/locale.ts" />
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/utils.ts" />
/// <reference path="../../data/datasets.ts" />
/// <reference path="./proxy.data.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.data,a.utils,b.SchemaUtils),d=function(a,b,d,e){var f=!0,g="validate"===a;if("propchanged"===a||g){if(!d.name)return f;var h=c.lastSegment(d.name,null);if(c.arrayProps.indexOf(h)>=0)return f;var i=e?e.value:b.getValue(d.name,d.params),j=e?e.state:b.getState(d.name,d.params),k=e?e.schema:b.getSchema(d.name);if(j&&(j.isHidden||j.isDisabled))return f;var l=d.locale,m=[],n=e?e.base:b.getParentOf(d.name,d.params);if(c.validateSchema(i,k,j,l,m)||(f=!1),g&&c.isMetaProp(h)&&k&&"password"===k.format){var o=b.getValue(c.extractBase(d.name)+k.$stateProperty,d.params);k=b.getValue(c.extractBase(d.name)+k.$stateProperty,d.params),c.validatePassword(o,i,k,j,l,m)||(f=!1)}var p=!1;"validate"===a&&e&&(p=e.add),n.$errors[h]&&n.$errors[h].addErrors(m,p)}return f};c.registerValidator("schema",d)}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=function(){function a(){this._forms={},this._inAction=!1}return a.prototype.setInAction=function(a){this._inAction=a},a.prototype.isInAction=function(){return this._inAction},a.prototype.broadcast=function(a,b){var d=this;c.nextTick(function(){Object.keys(d._forms).forEach(function(c){var e=d._forms[c];e&&e.execAction(a,b)})})},a.prototype.add=function(a){a&&a.data&&a.data.name&&(this._forms[a.data.name]=a)},a.prototype.remove=function(a){a&&a.data&&a.data.name&&(this._forms[a.data.name]=null)},a.prototype.formByName=function(a){return this._forms[a]},a}();b.FormManager=d;var e=function(){var a;return function(){return a||(a=new d),a}};b.formManager=e()}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="../../ui/layout.control.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="./proxy.data.ts" />
/// <reference path="./formmanager.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a){if(a){var b=null;a.$element&&(b=a.$element.get(0)),a.destroy(),b&&i.remove(b)}}var d=a,e=d.ui,f=d.utils,g=d.build,h=d.link,i=d.dom,j=d.customData,k=d.preferences,l=d.Observable.SchemaUtils,m=d.Observable.ObservableUtils,n=(d.ulocale,function(b){function c(a,c,d,f,h,i){b.call(this,a,c,d,f,h,i),this._event2Layout=function(a){var b=this;if(!b.$element)return null;for(var c=b.$element.get(0),d=a.target;d;){var e=d.getAttribute("data-render");if(e){var f=b.getLayoutById(e);if(f)return f}d=d===c?null:d.parentNode}return null};var j=this;c.module&&(j.module=c.module,delete c.module),a.data&&(j.formData=$.extend(!0,{},a.data)),j.formManager=e.formManager(),j.formManager.add(j),j.$schema=f||{},j.$rootSchema=j.$schema,c.path&&(j.$schema=l.getSchema(c.path,j.$schema,j.$rootSchema,!0)),j.$locale=h,c&&c.preferenceName&&(j._settingsName=c.preferenceName,j._settings=i),c&&c.storageName&&(j._settingsName=c.storageName,j._localSettings=!0),j.setData(d),j.$model.onchange=j._modelChanged.bind(j),j.$model.onstatechanged=j._stateChanged.bind(j),j.$bind={},Object.keys(j.map).forEach(function(a){var b=j.map[a];b.$bindState&&(j.$bind[b.$bindState]=j.$bind[b.$bindState]||[],j.$bind[b.$bindState].push(a))}),Object.keys(j.$bind).forEach(function(a){var b=j.$model.getState(a,{});if(b&&b.isHidden){var c=j.$bind[a];c.forEach(function(a){j.map[a].$isHidden=!0})}j.registerListenerFor(a,j,"layout-state")}),j.registerListenerFor("$",j),j.loadPrefs(),c&&c.validators&&c.validators.forEach(function(a){j.$model.addValidator(a,!0)}),j.options.design||!j.options.externalSchema||!j.options.externalLayout||g.release||c.autoClose||(j.options.authoringIndicator=!0,j.options.verticalSpacing=!0),j._afterCreate()}
//todo: remove use that._preferences 
return __extends(c,b),c.prototype._isInDelayedAction=function(){return this.formManager?this.formManager.isInAction():this._internalDelayedAction},c.prototype._setInDelayedAction=function(a){this.formManager?this.formManager.setInAction(a):this._internalDelayedAction=a},c.prototype.initOptions=function(a){return a=a||{},a.form=!0,a},c.prototype.setData=function(b){var c=this;c.$data=l.init(c.$schema,c.$schema,null,b||{}),c.options.beforeSetModel&&c.options.beforeSetModel(c.$data,c),c.$model?c.$model.setModel(c.$data):c.$model=new a.Observable.Data(c.$schema,null,"",c.$data,null,!1,c.$locale,c.data.datasets,c.data.transform),c.$model.saveModel(),c.options.afterModelCreated&&c.options.afterModelCreated(c.$model,c)},c.prototype.processing=function(a){var b=this;b._inProcessing=a},c.prototype._findControlByField=function(a){var b=this,c=[];return Object.keys(b.controls).forEach(function(d){var e=b.controls[d];e&&e.$bind===a&&c.push(e)}),c.length?c:null},c.prototype.loadPrefs=function(){var a=this;a._localSettings&&a._settingsName&&(a._settings=k(a._settingsName))},c.prototype.supportSettings=function(){return!!this._settingsName},c.prototype.getFieldSettings=function(a){var b=this;return b._settings?b._settings[a]:null},c.prototype.setFieldSettings=function(a,b){var c=this;c._settings=c._settings||{},c._settings[a]=b},c.prototype.savePrefs=function(b){var c=this;c._settingsName&&(c._localSettings?(c._settings=c._settings||{},k(c._settingsName,c._settings),b()):a.external.preferenceSaveHandler(c._settingsName,c._settings).then(function(){b()}))},c.prototype.sendMessage=function(a,b,c){var d,e=this,f=e._findControlByField(b);return f&&f.length&&f.forEach(function(b){b.sendMessage&&(d=b.sendMessage(a,c))}),d},c.prototype.afterSettings=function(a,b,c){var d=this;return d.options.settingsHandler?d.options.settingsHandler("after",a,b,c):c},c.prototype.beforeSettings=function(a,b){var c=this;return c.options.settingsHandler?c.options.settingsHandler("before",a,b):null},c.prototype._createError=function(){var a=this,b=["bs-form-error"];return a.options.verticalSpacing?b.push("bs-form-vertical-space"):(a.options.closeButtonHandler||a.options.authoringIndicator)&&b.push("bs-form-settings-space"),$('<div id="'+a.data.$id+'_error" class="'+b.join(" ")+'"><div>').get(0)},c.prototype._createErrorItem=function(a,b){var c="success"==a.severity?"success":"warning"==a.severity?"warning":"danger",d=b?"":"bs-none ",e=['<div data-error="true" class="'+d+" alert alert-"+c+' alert-dismissible fade in">'];return e.push('<button type="button" data-error-close="true" class="close" aria-label="Close">'),e.push('<span data-error-close="true" aria-hidden="true">&times;</span>'),e.push("</button>"),e.push(f.escapeHtml(a.message)),a.details&&a.details.length&&a.details.forEach(function(a){a.message&&e.push('<p class="bs-error-detail-item">'+f.escapeHtml(a.message)+"</p>")}),e.push("</div>"),$(e.join("")).get(0)},c.prototype.clearErrors=function(){var a=this;if(a.$element){var b=i.find(a.$element.get(0),a.data.$id+"_error");b&&i.empty(b)}},c.prototype.showErrorItem=function(a,b){var c=this;if(c.$element){var d=i.find(c.$element.get(0),c.data.$id+"_error");d&&(b&&i.empty(d),i.append(d,c._createErrorItem(a,b)))}},c.prototype.afterRenderChildren=function(a){
//setup tooltip
var b=a.find("[data-phoenix-tooltip]");b.tooltip&&b.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},c.prototype._loadNestedControllers=function(){var a=this;a._nestedControllers=[],Object.keys(a.map).forEach(function(b){var c=a.map[b];if(c.$refController){var d={$refProperty:c.$refProperty,handler:null,beforeSetModel:null},e=j.get(c.$refController);if(!e)throw f.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',c.$refController);e.onModelChanged&&(d.handler=e.onModelChanged.bind(e)),e.beforeSetModel&&(d.beforeSetModel=e.beforeSetModel.bind(e)),a._nestedControllers.push(d)}})},c.prototype.hasNestedControllers=function(){var a=this;return a._nestedControllers||a._loadNestedControllers(),a._nestedControllers.length>0},c.prototype.modelCreated=function(a){var b=this;b._nestedControllers.forEach(function(b){if(b.beforeSetModel){var c=a,d=!1;b.$refProperty?(d=!0,c=f.getValue(a,b.$refProperty)):b.$refProperty||(d=!0),d&&c&&b.beforeSetModel(c)}})},c.prototype.modelChanged=function(a,b,c,d){var e=this;e._nestedControllers.forEach(function(e){if(e.handler){var g=a,h=b,i=!1;e.$refProperty&&0===g.property.index(e.$refProperty+".")?(i=!0,g=f.copy(a),g.property=g.property.substring(e.$refProperty.length+1),h=b.getValue(e.$refProperty,a.params)):e.$refProperty||(i=!0),i&&e.handler(g,h,c,d)}})},c.prototype.afterRender=function(a){var b=this,c=a.get(0),d=c.firstChild?c.firstChild:c;b.options.form&&!b.options.design&&i.before(d,b._createError());var e=function(a,c,d,e){var f=["<div "+c+'="true" class="bs-cursor-p bs-form-settings'+(d?" "+d:"")+(e?"  space-"+e:"")+'" id="'+b.data.$id+'_settings">'];return f.push("<span "+c+'="true" class="'+i.iconClass(a)+'"></span>'),f.push("</div>"),f.join("")},f=0;b.options.closeButtonHandler&&(i.append(c,$(e("times-circle-o","data-form-detail-close","red",f)).get(0)),f++),b.options.authoringIndicator&&(i.append(c,$(e("cog","data-form-settings",null,f)).get(0)),f++)},c.prototype.stateChanged=function(a,b){var c=this;if("layout-state"===b.targetId){if("isHidden"===a&&b.property){var d=c.$model.getState(b.property,{}),e=c.$bind[b.property];e&&e.forEach(function(a){var b=c.map[a];b&&c.updateIsHidden(b,d.isHidden)})}}else if(c.$model.$errors&&c.$model.$errors.$){var f=c.$model.$errors.$;if(f.hasErrors())for(var g=f.errors(),h=0,i=g.length;h<i;h++){var j=g[h];c.showErrorItem(j,0==h)}else c.clearErrors();f.clear(!1)}},c.prototype.getSchema=function(a){var b=this;return l.getSchema(a,b.$schema,b.$rootSchema,!1)},c.prototype.getLookupForSchema=function(a,b){var c=this;return l.getLookup(a,b,c.$schema,c.$rootSchema)},c.prototype.registerListenerFor=function(a,b,c){var d=this,e=a;d._listenerChanged=!0,d._listeners=d._listeners||{},d._listeners[e]=d._listeners[e]||[],d._listeners[e].push({target:b,id:c||""})},c.prototype.unRegisterListenerFor=function(a,b){var c=this,d=a;if(c._listeners&&c._listeners[d]){var e=c._listeners[d].findIndex(function(a){return a.target===b});e>=0&&(c._listeners[d].splice(e,1),c._listenerChanged=!0)}},c.prototype.setValue=function(a,b){m.setValue(a,b,this.$model)},c.prototype.getValue=function(a){return m.getValue(a,this.$model)},c.prototype.getParentModel=function(a){var b=a.split(".");return b.pop(),m.getValue(b.join("."),this.$model)},c.prototype.getState=function(a){var b=this,c=m.getState(a,this.$model);return b.options.design&&(c.isHidden=!1,c.isDisabled=!1),c},c.prototype._enumListener=function(a,b){var c=this;c._listeners[a].forEach(function(a){b(a)})},c.prototype._rebuildListeners=function(){var a=this;a._listenerChanged&&(a._listenersByName=Object.keys(a._listeners),a._listenerChanged=!1)},c.prototype._match=function(a,b){var c=this,d=a.join("."),e=d+".";c._listenersByName&&c._listenersByName.forEach(function(a){a==d?b(a,!0,!1,!1):"*"!==a&&0!=a.indexOf(e)||b(a,!1,!0,!1)})},c.prototype.execAction=function(a,b,c){this._modelChanged(a,null,null,"execute",c,b)},c.prototype.broadcast=function(a,b){this.formManager.broadcast(a,b)},c.prototype._modelChanged=function(a,b,c,d,e,f){var g=this,h=a.split(".");g._rebuildListeners(),
//update controls
e=e||{},"execute"!==d&&g._match(h,function(f,h,i,j){e.propName=f,h?g._enumListener(f,function(f){f.target.changed&&(e.targetId=f.id,f.target.changed(a,b,c,d,e))}):i&&g._enumListener(f,function(c){c.target.changed&&(e.targetId=c.id,c.target.changed(a,b,g.getValue(f),d,e))})}),g.afterchanged(a,d,e,f)},c.prototype.afterchanged=function(a,b,c,d){var e=this;if(e.onaction){if(e.inAction)return;e.inAction=!0;try{e.onaction({property:a,operation:b,params:c,actionParams:d},e.$model,e)}finally{e.inAction=!1}}},c.prototype.on=function(a){this.onaction=a},c.prototype._stateChanged=function(a){var b,c,d=this,e=a.split(".");l.statesAndErrors.indexOf(e[e.length-1])>=0&&(b=e.pop(),c=e.join(".")),d._rebuildListeners(),d._match(e,function(a,e,f,g){e?d._enumListener(a,function(a){a.target.stateChanged&&a.target.stateChanged(b,{targetId:a.id,property:c})}):f&&d._enumListener(a,function(a){a.target.stateChanged&&a.target.stateChanged(null,{targetId:a.id,property:c})})})},c.prototype.destroy=function(){var a=this;a.$data=null,a.$schema=null,a.$bind=null,a.module=null,a._listeners={},a._listenersByName=[],a._loadNestedControllers=null,a.$model&&(a.$model.onchange=null,a.$model.onstatechanged=null,a.$model.destroy(),a.$model=null),a.formManager&&(a.formManager.remove(a),a.formManager=null),b.prototype.destroy.call(this)},c.prototype._idComponent=function(a){var b=this;if(!b.$element)return null;for(var c,d=a,e=b.$element.get(0);d;){if(!d.getAttribute)return null;if(c=d.getAttribute("data-render")){if(b.controls[c])break;c=null}d=d==e?null:d.parentNode}return c?c:null},c.prototype._event2FieldByElement=function(a){var b=this,c=b._idComponent(a);return c?b.controls[c]:null},c.prototype._event2Field=function(a){var b=this;return b._event2FieldByElement(a.target)},c.prototype._removeBaseEvents=function(){var a=this,c=a.$element;c.off("focusin"),c.off("focusout"),c.off("click"),c.off("keydown"),c.off("keypress"),c.off("mousedown"),c.off("paste"),$(window).off("global-phoenix-resize"),b.prototype._removeBaseEvents.call(this)},c.prototype._freeze=function(a){return a.preventDefault(),a.stopPropagation(),!1},c.prototype._addBaseEvents=function(){var a=this;a.$element.on("focusin",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);if(c&&c.focusIn){if(c.focused)return;c.focused=!0,c.focusIn(b)}}),a.$element.on("focusout",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);if(c&&c.focusOut){var d={target:b.target};c.focusTimer&&(window.clearTimeout(c.focusTimer),c.focusTimer=0),a._setInDelayedAction(!0),c.focusTimer=f.focusDelay(function(){if(a._setInDelayedAction(!1),!c.destroyed){c.focusTimer=0;var b=window.document.activeElement;if(b){var e=a._event2FieldByElement(b);e!==c&&(c.focusOut(d),c.focused=!1)}else c.focusOut(d),c.focused=!1}})}}),a.$element.on("click",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);if(c&&c.click){if(c.stopProppagation&&c.stopProppagation(b),c.focusClick)return;if(!a._isInDelayedAction()||c.focused&&c.targetInControl(b.target))return c.click(b);a._setInDelayedAction(!0),c.focusClick=f.focusDelay(function(){a._setInDelayedAction(!1),c.destroyed||(c.focusClick=0,c.click(b))})}else if(!c){var d=b.target;if(d){var e=d.getAttribute("data-error-close");if(e){var g=i.findByAttribute(b.target,a.$element.get(0),"data-error");return g&&i.remove(g),a.openErrors(),a._freeze(b)}if(d.getAttribute("data-form-detail-close"))return a.options.closeButtonHandler&&a.options.closeButtonHandler(),a._freeze(b);if(d.getAttribute("data-form-settings"))return a.options.authoringIndicator&&h.execLink({$formAuthoring:!0,path:a.options.path,name:a.options.externalLayout,schema:a.options.externalSchema,locale:a.options.externalLocale},{},null),a._freeze(b)}}var j=a._event2Layout(b);j&&j.$actionName&&a.execAction(j.$actionName)}),a.$element.on("keypress",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);c&&c.keypress&&c.keypress(b)}),a.$element.on("keydown",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);c&&c.keydown&&c.keydown(b)}),a.$element.on("paste",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);c&&c.paste&&c.paste(b)}),a.$element.on("keyup",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);c&&c.keyup&&c.keyup(b)}),a.$element.on("mousedown",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);return!c||!c.mousedown||c.mousedown(b)}),$(window).on("global-phoenix-resize",function(b){return a.currentResizeList&&a.currentResizeList.forEach(function(a){a.resize()}),!0}),b.prototype._addBaseEvents.call(this)},c.prototype.afterAddedInDom=function(){b.prototype.afterAddedInDom.call(this);var a=this;a.currentResizeList&&a.currentResizeList.forEach(function(a){a.resize()}),a.afterRenderList&&(a.afterRenderList.forEach(function(a){a.afterAddedInDom()}),a.afterRenderList=[])},c}(b.BaseLayout));b.Form=n,b.FormClass=n,b.removeForm=c,b.OpenForm=null}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/ajax.ts" />
/// <reference path="../../core/modules/application.ts" />
/// <reference path="../modal.control.ts" />
/// <reference path="../autoclose.control.ts" />
/// <reference path="./form.control.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b,c=a,d=c.ajax,e=c.dom,f=c.utils,g=c.autoclose,h=(c.modal,c.application),i=c.Observable.SchemaUtils,j=c.external,k=c.customData;!function(b){function l(a){return a.split(".").map(function(a){return a.charAt(0).toUpperCase()+a.slice(1)}).join("").split("-").map(function(a){return a.charAt(0).toUpperCase()+a.slice(1)}).join("")}var m=function(a){function c(c,d,e,f,g,h){a.call(this,c,g);var i=this,j=c.opts?c.opts:{};c.validators&&(j.validators=c.validators,delete c.validators),i.render=new b.Form(d,j,f,e,g,h),i.render.$locale=g}return __extends(c,a),c.prototype.on=function(a){var b=this,c=function(c,d,e){return a(b,c,d,e)};b._clickHnd=function(a){b.render.afterchanged(a,"modal-action",{})},b.render.on(c)},c.prototype.onNatural=function(a){var b=this,c=function(c,d,e){return a(c,d,e,b)};b._clickHnd=function(a){b.render.afterchanged(a,"modal-action",{})},b.render.on(c)},c}(a.modal.Modal);b.ModalForm=m;var n=function(a,b,c){i.loadSchemaRefs(b.schema,b.data,b.layout,function(e,g){if(e)return console.log(e),e=e._ajax?d.extractAjaxErrors(e):e,a&&a.module&&a.module.error?a.module.error(e):void f.alert("",e.message,function(){});var h=new m(a,b.layout,b.schema,g,b.locale,b.preferences);h.open(),c&&(a.natural?h.onNatural(c):h.on(c))})},o=function(a,b){return a&&h.name?h.name+"_form_"+a:""},p=function(a,b,c,e,g,i){var k=0,l=-1,m=-1,n=[],p={locale:e},q=-1,r=-1,s=h.config(h.name);g=g||{},e&&e.$name&&(g.externalLocale=e.$name),c&&c.then?(n.push(c),q=0,k++):p.data=$.extend(!0,{},c);var t;"object"==typeof a?(p.layout=$.extend(!0,{},a),t=p.layout.name):(l=k,k++,g.externalLayout=a,t=a,n.push(d.get(s.current.forms+"/"+a+".json"))),"object"==typeof b?p.schema=$.extend(!0,{},b):(m=k,k++,g.externalSchema=b,n.push(d.get(s.current.prototypes+"/"+b+".json")));var u=o(t,s);u&&j.preferenceLoadHandler&&(r=k,k++,g.preferenceName=u,n.push(j.preferenceLoadHandler(u))),n.length?f.Promise.all(n).then(function(a){l>=0&&(p.layout=a[l]),m>=0&&(p.schema=a[m]),q>=0&&(p.data=a[q]),r>=0&&(p.preferences=a[r]),i(null,g,p)}).catch(function(a){i(a,null,null)}):i(null,g,p)},q=function(a,b,c,e,g,h){p(b,c,e,g,null,function(b,c,e){return b?(console.log(b),b=b._ajax?d.extractAjaxErrors(b):b,a&&a.module&&a.module.error?a.module.error(b):void f.alert("",b.message,function(){})):(a=a||{},a.opts=c,void n(a,e,h))})},r=function(a,b){b.isFormController?a.beforeSetModel=b.beforeSetModel?b.beforeSetModel.bind(b):null:a.beforeSetModel=b.initObjectState?b.initObjectState.bind(b):null,a.beforeModelCreated=b.initModel?b.initModel.bind(b):null,a.onSettings=b.onSettings?b.onSettings.bind(b):null,a.storageName=b.storageName,a.validators=b.validators},s=function(a,b){if(!a.controller)throw"Controller name is empty.";var c=k.get(a.controller);if(!c)throw f.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',a.controller);var d={};r(d,c);var e=a.options;e.opts=d,e.natural=!0;var g=null;c.isFormController?g=c.modelChanged.bind(c):c.onModelChanged&&(g=c.onModelChanged.bind(c)),q(e,a.name,a.meta,b,null,g)},t=function(a,b){if(!a.controller)throw"Controller name is empty.";var c=k.get(a.controller);if(!c)throw f.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',a.controller);var d={};r(d,c);var e=a.options;e=d,e.natural=!0;var g=null;c.isFormController?g=c.modelChanged.bind(c):c.onModelChanged&&(g=c.onModelChanged.bind(c)),e.autoClose=a.autoClose,w(null,a.name,a.meta,b,null,g,e,null)},u=function(a,c,d,f){if(f&&f.autoClose){var h=f.autoClose,i={parent:h.parentId?e.find(null,h.parentId):null,alignElement:h.alignElementId?e.find(null,h.alignElementId):null,style:h.style,width:h.width,height:h.height,minWidth:h.minWidth,minHeight:h.minHeight,beforeClose:null,contentRender:function(a,e,g){try{var h=new b.Form(c.layout,f||{design:!1},c.data,c.schema,c.locale,c.preferences);h.$locale=c.locale,h.autoClose=!0,h.render(a),d&&h.on(d),g()}catch(a){g(a)}}};return g.open(h.align,i)}var j=new b.Form(c.layout,f||{design:!1},c.data,c.schema,c.locale,c.preferences);return j.$locale=c.locale,j.render(a),d&&j.on(d),j},v=function(a,b,c,e,g){i.loadSchemaRefs(b.schema,b.data,b.layout,function(h,i){if(h)return console.log(h),h=h._ajax?d.extractAjaxErrors(h):h,e&&e.module&&e.module.error?e.module.error(h):void f.alert("",h.message,function(){});b.data=i;var j=u(a,b,c,e);g&&g(j)})},w=function(a,b,c,e,g,h,i,j){p(b,c,e,g,i,function(b,c,e){return b?(console.log(b),b=b._ajax?d.extractAjaxErrors(b):b,i&&i.module&&i.module.error?i.module.error(b):void f.alert("",b.message,function(){})):void v(a,e,h,c,j)})},x=function(){function a(){}return a.prototype.isFormController=function(){return!0},a.prototype.data=function(){return null},a.prototype.beforeSetModel=function(a,b){b&&b.hasNestedControllers()&&b.modelCreated(a),this.initObjectState(a,b)},a.prototype.initObjectState=function(a,b){},a.prototype.modelChanged=function(a,b,c,d){c.hasNestedControllers()&&c.modelChanged(a,b,c,d),this.onModelChanged(a,b,c,d)},a.prototype.onModelChanged=function(a,b,c,d){var e=this,f=a.property,g=a;if(f){e.bindProperty&&0===f.indexOf(e.bindProperty)&&(f=f.substr(e.bindProperty.length),g.property=f);var h=f.indexOf("$links.");h>=0&&(f=f.replace(/\$links\./g,""));var i="on"+l(f);if(e[i])return e[i](g,b,c,d)}},a}();b.FormController=x,k.register("phoenix.empty.controller",{onModelChanged:function(a,b,c,d){}}),b.formController2Options=r,b.OpenModalForm=q,b.showModalForm=s,b.showAutoCloseForm=t,b.OpenForm=w,j.formOpenHandler=function(a){var b={name:a.name,meta:a.meta,controller:a.controller||"phoenix.empty.controller",options:a.options||{}};a.modal?s(b):(b.autoClose={align:c.autoclose.BOTTOM_LEFT,alignElementId:a.alignElementId,style:a.style,width:a.width,height:a.height,minWidth:a.minWidth,minHeight:a.minHeight},t(b))}}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../ui/layout.control.ts" />
/// <reference path="../schema.data.ts" />
var Phoenix;!function(a){var b,c=(a.render,a.ui,a.dom),d=a.utils,e=a.device,f=a.Observable,g=a.ulocale,h=a.locale,i=a.customData,j=f.SchemaUtils;!function(b){var f="datepicker",k=function(){var a=!1,b=!1;return function(){if(b)return a;if(b=!0,e.phone||e.tablet){var c=document.createElement("input");return c.setAttribute("type","date"),a="date"===c.type}return!1}},l=function(a){return"center"===a?"align-center":"right"===a?"align-end":""},m=function(){var a=!1,b=!1;return function(){if(b)return a;if(b=!0,e.phone||e.tablet){var c=document.createElement("input");return c.setAttribute("type","number"),a="number"===c.type}return!1}},n=function(a,b,c,d){var e=i.get("ui.html."+c);return e?{value:e(a,b,d),html:!0}:{value:b,html:!1}},o=function(a,b,d){var e=a.avanced.icons[b]||"none",f=a.avanced.iconClass||null,g=l(a.avanced.alignIcon||"center"),h=[];e&&h.push(f?c.customIconClass(e,f):c.iconClass(e));var i=a.tableOptions&&a.tableOptions.small?"small-table":"",j=["bs-image-cell",g];a.avanced._expandItem&&(j.push("bs-expand-parent"),h.push("bs-expand-child")),i&&j.push(i);var k=['<div class="'+j.join(" ")+'"'];return a.avanced._clickable&&k.push(' data-clickable="true"'),a.avanced._expandItem&&(a.level&&k.push(' style="margin-left:'+.5*a.level+'em;"'),h.push("bs-expand-space"),a.avanced._expandItemClass&&h.push(a.avanced._expandItemClass)),a.display||h.push("bs-image-size"),k.push('><span class="'+h.join(" ")+'"></span>'),a.avanced._expandItem&&a.display&&a.display.value&&(k.push('<span class="bs-expand-child">'),k.push(" "),k.push(a.display.value),k.push("</span>")),k.push("</div>"),{value:k.join(""),html:!0}},p={useDatePicker:function(){return!p.nativeDate()&&null!=$.fn.datepicker},nativeDate:k(),nativeNumber:m(),addErrorDiv:function(a){a.push('<div class="small text-danger bs-none" id="{0}_errors"></div>')},keyPressPassword:function(a,b,d){var e=a.which;return e!==c.keys.VK_SPACE||(a.preventDefault(),!1)},keyPressDate:function(a,b,c){return!0},keyPressCode:function(a,b,d){var e=a.keyCode;return e!==c.keys.VK_SPACE||(a.preventDefault(),!1)},keyPressNumber:function(a,b,d){var e="-0123456789,."+d.decimalSep,f=a.keyCode;if(!a.metaKey&&c.ignoreKeys.indexOf(f)<0){var g=String.fromCharCode(f);if(e.indexOf(g)<0)return a.preventDefault(),!1}return!0},doPasteDate:function(a,b,c){return!0},doPasteCode:function(a,b,c){return!0},doPasteNumber:function(a,b,c){return!0},doPastePassword:function(a,b,c){return!0},keyDownDate:function(a,b,c){return!0},keyDownCode:function(a,b,c){return!0},keyDownNumber:function(a,b,c){return!0},keyDownPassword:function(a,b,c){return!0},addContainerId:function(a,b){b&&a.push(' draggable="true"'),a.push(' data-render="{0}"'),a.push(' id="{0}"')},containerBaseClass:function(a,b,c){var d=[a,c.groupFieldClass||"bs-field-group","bs-island"];return c.inline&&d.push(c.inlineFieldClass||"bs-field-inline"),b&&d.push(" design"),d.join(" ")},align2Css:l,fieldWrapper:function(b,c,d,e,f){var g=a.bootstrap4;c.inline&&(c.columns=!1);var h=f&&f.formGroup?f.formGroup:"form-group",i=[p.containerBaseClass(h,d,c)],j=f&&f.tag?f.tag:"div";b.push("<"+j+' class="'),c.size&&i.push((g?"form-control":"form-group-")+c.size),c.columns&&(g||i.push("form-horizontal"),i.push("row")),c.styles&&i.push(c.styles),c.right&&i.push(" pull-right"),b.push(i.join(" ")),b.push('"'),p.addContainerId(b,d),b.push(">"),e(),b.push("</"+j+">")},fillSelect:function(a,b,d){if(b){var e=d.enumNames||d.enum,f=d.enum;c.empty(b);var g=document.createDocumentFragment();a.forEach(function(a){var b=f.indexOf(a),d=e[b]||a+"",h=document.createElement("option");c.attr(h,"value",a),h.textContent=d,c.append(g,h)}),c.append(b,g)}},datePickerSetValue:function(a,b){a[f]("update",g.parseISODate(b||"")||"")},datePickerInitialize:function(a,b,d){c.addClass(a.get(0),"date");var e=$.extend({language:g.currentLang,autoclose:!0},b||{});a[f](e),d&&a[f]().on("hide",d)},datePickerDestroy:function(a){a[f]("destroy")},text2value:function(a,b,c){if(j.isDate(b)){if(p.nativeDate())return a;var d=g.tryParseDate(a);return g.localeDate2ISO(d)}return j.isNumber(b)?j.text2Value(a+"",b,c):a},defaultOptions:{titleIsHidden:!1,placeHolder:!1,labelCol:3},displayValue:function(a,b,e,f,i,k){var l;if(f=f||{},d.isNullOrUndefined(a))return l={value:"",html:!1};if(f.isTotal&&j.isFwField(k))return l={value:"",html:!1};if(b.enum){var m=b.enum.indexOf(a),p=m>=0?b.enumNames?g.tt(b.enumNames[m],e):a:"";l=f.avanced&&f.avanced.transform?n(a,p,f.avanced.transform,i):f.avanced&&f.avanced.icons?o(f,a,p):{value:p,html:!1}}else switch(b.type){case"string":if(b.format)switch(b.format){case"date":var p=g.shortDate(a||"");l=f.avanced&&f.avanced.transform?n(a,p,f.avanced.transform,i):{value:p,html:!1}}l||(l=f.avanced&&f.avanced.transform?n(a,a,f.avanced.transform,i):f.avanced&&f.avanced.icons?o(f,a,a):{value:a,html:!1});break;case"number":var q=void 0;q=f.state?g.decimal(a||0,f.state.decimals||0,f.useSymbol?f.state.symbol||"":""):"money"===b.format?g.money(a||0,f.useSymbol):g.decimal(a||0,b.decimals||0,f.useSymbol?b.symbol:""),l=f.avanced&&f.avanced.transform?n(a,q,f.avanced.transform,i):f.avanced&&f.avanced.icons?o(f,a,a):{value:q,html:!1};break;case"integer":var r=g.decimal(a||0,0,"");l=f.avanced&&f.avanced.transform?n(a,r,f.avanced.transform,i):f.avanced&&f.avanced.icons?o(f,a,a):{value:r,html:!1};break;case"boolean":if(f.isTotal)return l={value:"",html:!1};if(f.avanced&&f.avanced.transform)l=n(a,a?h.ui.Yes:h.ui.No,f.avanced.transform,i);else if(f.html){var s=[];if(f.avanced&&f.avanced.editable||f.editable||f.check||f.avanced&&f.avanced.icons){var t="",u="bs-cursor-d";f.editable?(t="bs-bool-edit",u="bs-cursor-p"):t="bs-bool";var v=f.tableOptions&&f.tableOptions.small?" small-table":"",w=f.avanced?f.avanced.icons:null;w||(w={true:"check-square-o",false:"square-o"});var x=w[!!a+""],y=[t,u,"bs-image-size"];x&&y.push(c.iconClass(x)),s.push('<center class="bs-image-cell'+v+'"><span data-clickable="true" class="'+y.join(" ")+'"></span>&nbsp;</center>'),l={value:s.join(""),html:!0}}else l={value:a?h.ui.Yes:h.ui.No,html:!1}}else l={value:a?h.ui.Yes:h.ui.No,html:!1}}if(l||(l={value:a,html:!1}),f.html&&f.avanced&&f.avanced.$link){var z=['<a class="bs-cursor-p" data-phoenix-href="link://$link">'];z.push(l.value),z.push("</a>"),l.value=z.join(""),l.html=!0}return l},addTooltip:function(a,b,d){a.push('<span id="{0}_tooltip" data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title="'+b+'" class="'+c.iconClass("question-circle")+" bs-tooltip-icon"),d&&d.inline&&a.push(" bs-tooltip-icon-inline"),a.push('"></span>')}};if(p.useDatePicker()){var q=function(a){$.fn.datepicker.dates[a]={days:h.date.weekdays,daysShort:h.date.weekdaysShort,daysMin:h.date.weekdaysMin,months:h.date.months,monthsShort:h.date.monthsShort,today:h.date.today,clear:h.date.clear,format:h.date.dateShort.replace(/\//g,h.date.daySep),titleFormat:"MM yyyy",weekStart:h.date.weekStart}};q(g.currentLang),g.register(q)}b.utils=p}(b=a.uiutils||(a.uiutils={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../ui/layout.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="./uiutils.ts" />
/// <reference path="../form.control.ts" />
var Phoenix;!function(a){var b,c=(a.uiutils,a.Observable),d=a.dom,e=a.customData,f=c.SchemaUtils;!function(a){var b=function(a,b,c,d,f){c=c||!1,d=d||"",c&&(b="*"),f=f||{};var g=f.lookup||!1,h=f.format||"";f.readOnly?e.register("ui-controls-readonly-"+d+"-"+h,a):e.register("ui-controls-"+b+"-"+c+"-"+g+"-"+d+"-"+h,a)},c=function(a,b,c,d,f){b=b||!1,b&&(a="*"),c=c||"",d=d||"";var g=!(!f||!f.lookup),h=!(!f||!f.readOnly);if(h){var i=e.get("ui-controls-readonly-"+c+"-"+d);return!i&&d&&(i=e.get("ui-controls-readonly-"+c+"-")),i}var i=e.get("ui-controls-"+a+"-"+b+"-"+g+"-"+c+"-"+d);return!i&&d&&(i=e.get("ui-controls-"+a+"-"+b+"-"+g+"-"+c+"-")),i},g=function(){function a(a,b,c){var d=this;d.config=a,d.form=c,d.parent=d.form.getLayoutById(a.$parentId),d.$bind=a.$bind,a.$name&&(d.name=a.$name),d.$display=d.config.$display||d.$bind,a.$lookup&&(d.useDisplay=d.$display!==d.$bind,d.$lookup=d.form.getLookupForSchema(d.$bind,a.$lookup));var e=f.isMeta(d.$bind);e&&(d.$bind=d.getCustomBind()),d.$bind&&c.registerListenerFor(d.$bind,d),d.useDisplay&&c.registerListenerFor(d.$display,d),d._defineProps(),d.options=b||{},d.fieldOptions=a.options||{},d.renderOptions=d.fieldOptions,d.$schema=d.$bind?c.getSchema(d.$bind):{},d.$schema&&"array"===d.$schema.type&&(d.$schemaItems=f.expand$Ref(d.$schema.items,d.form.$rootSchema)),d.id=a.$id}return a.prototype.getSettingsName=function(a){var b=this,c=[b.$bind,a];return b.name&&c.push(b.name),c.join("_")},a.prototype.targetInControl=function(a){var b=this;if(b.$element){var c=b.$element.get(0);return d.isChildOf(c,a)}return!1},a.prototype.setParentId=function(a){},a.prototype.isMeta=function(){return!1},a.prototype.beforeSaveSettings=function(){return!1},a.prototype.savePreferences=function(a){var b=this;return b.form.supportSettings()?void(b.beforeSaveSettings()&&b.form.savePrefs(a)):a()},a.prototype.getCustomBind=function(){return""},a.prototype.setHidden=function(a){a&&(this.state.isHidden?d.addClass(a,"bs-none"):d.removeClass(a,"bs-none"))},a.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);a.state.value=a.form.getValue(a.$bind),Object.keys(b).forEach(function(c){a.state[c]=b[c]})},a.prototype._defineProps=function(){},a.prototype.render=function(a){},a.prototype.appendElement=function(a,b){var c=this;a&&(c.options.replaceParent?a.replaceWith(c.$element):a.append(c.$element))},a.prototype.setEvents=function(a){},a.prototype.removeEvents=function(){},a.prototype.customOptions=function(a){},a.prototype._initOptions=function(a){var b=this,c={};
// init default options from parent layout ($fieldsOptions)
b.parent&&b.parent.$fieldsOptions&&(b.parent.$fieldsOptions.columns&&(void 0===c.columns&&(c.columns=b.parent.$fieldsOptions.columns),void 0===c.labelCol&&b.parent.$fieldsOptions.labelCol&&(c.labelCol=b.parent.$fieldsOptions.labelCol)),b.parent.$fieldsOptions.titleIsHidden&&void 0===c.titleIsHidden&&(c.titleIsHidden=!0));var d=$.extend({},a,c,b.fieldOptions);return b.parent.$inline&&(d.inline=!0),b.customOptions(d),b.renderOptions=d,d},a.prototype.destroy=function(){var a=this;a.destroyed=!0,a.$schema=null,a.parent=null,a.$element||(a.removeEvents(),a.$element=null),a.$bind&&a.form.unRegisterListenerFor(a.$bind,a),a.useDisplay&&a.form.unRegisterListenerFor(a.$display,a)},a.prototype.showErrors=function(a,b){var c=this,e=b&&b.length,f=d.find(a,c.id+"_errors");f&&(e?(d.text(f,b[0].message),d.removeClass(f,"bs-none")):d.addClass(f,"bs-none"))},a}();a.AbsField=g,a.registerControl=b,a.getRegisteredControl=c}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b,c=a,d=c.utils,e=c.dom,f=(c.ulocale,c.ui),g=c.uiutils;!function(a){function b(a,b,c){b=$.extend({columns:!1},b),b.columns=!1;var e=[];return g.utils.fieldWrapper(e,b,c,function(){e.push('<div id="{0}_alert" class="alert alert-'+(b.type||"danger")+'" role="alert">'),e.push("</div>")}),d.format(e.join(""),a)}var c=function(a){function c(b,c,d){a.call(this,b,c,d),this._state()}return __extends(c,a),c.prototype._setDisabled=function(a,b){},c.prototype._setReadOnly=function(a,b){},c.prototype._setMandatory=function(a,b){},c.prototype._label=function(){var a=this;return a.$element?e.find(a.$element.get(0),a.id+"_alert"):null},c.prototype._state2UI=function(){var a=this,b=a._label(),c=a.$element?a.$element.get(0):null;b&&(e.text(b,a.state.value||""),a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c),a._setMandatory(b,c))},c.prototype.changed=function(a,b,c,d){var f=this,g=f._label();f.state.value!=c&&(f.state.value=c,g&&e.text(g,f.state.value||""))},c.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._label(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!==c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!==c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!==c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},c.prototype.render=function(a){var c=this,d=c._initOptions(g.utils.defaultOptions);return c.$element||(c.$element=$(b(c.id,d,c.options.design)),c._state2UI()),c.appendElement(a,d),c.$element},c}(a.AbsField);a.Alert=c,f.registerControl(c,"string",!1,"alert",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=a.dom,e=a.ui,f=(a.ulocale,a.uiutils);!function(b){function g(a,b,e){b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},b);var g=[];if(e)f.utils.fieldWrapper(g,b,e,function(){});else{var h=[];b.style&&d.parseStyle(b.style,h),g.push("<div"),h.length&&g.push(' class= "'+h.join(" ")+'"'),f.utils.addContainerId(g,e),g.push("/></div>")}return c.format(g.join(""),a)}var h=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype.click=function(a){},b.prototype._setDisabled=function(a){},b.prototype._setReadOnly=function(a){},b.prototype._setMandatory=function(a){},b.prototype._state2UI=function(){var a=this,b=a.$element?a.$element.get(0):null;b&&a.renderContent(b)},b.prototype.renderContent=function(a){var b=this,c="";void 0!=b.state.value&&(c=JSON.stringify(b.state.value.model(!0),null,2)),d.append(a,$("<pre>"+c+"</pre>").get(0))},b.prototype.changed=function(a,b,c,d){var e=this;e.state.value=e.form.getValue(e.$bind),e._state2UI()},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,c.setHidden(e)),d.isDisabled!==c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,c._setDisabled(e)),d.isReadOnly!==c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,c._setReadOnly(e)),d.isMandatory!==c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,c._setMandatory(e))},b.prototype.render=function(a){var b=this,c=b._initOptions(f.utils.defaultOptions);return b.$element||(b.$element=$(g(b.id,c,b.options.design)),b._state2UI(),b.setEvents(c)),b.appendElement(a,c),b.$element},b}(a.ui.AbsField);b.ComplexBase=h,e.registerControl(h,"object",!1,"objectjson",null),e.registerControl(h,"array",!1,"objectjson",null)}(b=a.formcomplex||(a.formcomplex={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core-refs.ts" />
/// <reference path="./complex.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.customData,e=(c.ulocale,c.formcomplex,c.ui),f=(c.utils,c.dom),g=(c.link,4),h=function(a){function b(){a.apply(this,arguments)}
// Create content
return __extends(b,a),b.prototype.customOptions=function(a){var b=this;if(!a.item||!a.item.render)throw'Item render is null. Use options: { item : {render: "my_item_render"}} ';if(b._render=d.get(a.item.render),!b._render)throw'Item render is registered. Use customData.register("'+a.item.render+'", controller);'},b.prototype.renderContent=function(a){var b=this,c=0;b._map={};var d=b.renderOptions&&b.renderOptions.layout&&"grid"===b.renderOptions.layout.type,e=document.createDocumentFragment();d&&(c=Math.max(Math.min(b.renderOptions.layout.columns||g,12),1));var h=null,i=b.state.value.model(!0);i&&i.forEach(function(a,g){var i,j=[];if(d){var k=g%c;if(0===k){h=$('<div class="row"></div>').get(0);for(var l=Math.floor(12/c),m=0;m<c;m++)f.append(h,$('<div class="col-sm-'+l+'"></div>').get(0));f.append(e,h)}i=h.childNodes[k]}else i=e,j.push("bs-inline-block");b.renderOptions.item.style&&f.parseStyle(b.renderOptions.item.style,j);var n=$('<div class="'+j.join(" ")+'"></div>').get(0);b._render.render(n,a,b._map),f.append(i,n)}),f.empty(a),d&&!f.hasClass(a,"container-fluid")&&f.addClass(a,"container-fluid"),f.append(a,e)},b.prototype.destroy=function(){var b=this;b._map=null,b._render=null,a.prototype.destroy.call(this)},b.prototype.setEvents=function(a){var b=this;b._render.setEvents&&b._render.setEvents(a)},b.prototype.removeEvents=function(){var a=this;a._render.removeEvents&&a._render.removeEvents()},b.prototype.click=function(a){var b=this;b._render.click&&b._render.click(b.$element.get(0),a,b._map)},b}(a.formcomplex.ComplexBase);b.ArrayControl=h,e.registerControl(h,"array",!1,"array-control",null)}(b=a.formarray||(a.formarray={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="./uiutils.ts" />
/// <reference path="../../../core/modules/locale.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.dom,e=a.uiutils,f=a.ulocale,g=a.Observable.SchemaUtils,h=function(a,b,c,d){c&&d.push(' draggable="true"'),d.push(' data-render="{0}"')},i=function(a,b){var c=d.icon(b?"caret-up":"caret-down");d.addClass(c,"bs-basictable-sort"),d.attr(c,"sort","true"),d.append(a.firstElementChild,c)},j=function(a){var b=a.lastElementChild?a.firstElementChild.lastElementChild:null;b&&"true"===d.attr(b,"sort")&&d.remove(b)},k=function(b,c,d,e){var f,g=[];return d._useColGrp?e?(f=a.dom.find(c,b+"_colgrp_frozen_header"),f&&g.push(f),f=a.dom.find(c,b+"_colgrp_frozen"),f&&g.push(f),d.total&&d.total.property&&(f=a.dom.find(c,b+"_colgrp_frozen_footer"),f&&g.push(f))):(f=a.dom.find(c,b+"_colgrp_header"),f&&g.push(f),f=a.dom.find(c,b+"_colgrp"),f&&g.push(f),d.total&&d.total.property&&(f=a.dom.find(c,b+"_colgrp_footer"),f&&g.push(f))):d.headerIsHidden||(f=e?a.dom.find(c,b+"_frozen_cols"):a.dom.find(c,b+"_cols"),f&&g.push(f)),g},l=function(a,b,c){b.forEach(function(b){for(var e=0,f=b.childNodes.length;e<f;e++){var g=b.childNodes[e],h=d.attr(g,"colid");if(h===a){g.style.width=c+"px";break}}})},m=function(a,b,c,e){if(a.sorting&&b&&b.childElementCount){var f=(e||"").split(" ");f.length||(f=[""]);for(var g=0,h=b.children.length;g<h;g++){var k=b.children[g],l=d.attr(k,"colId");f[0]===l?(j(k),i(k,1==f.length)):j(k)}}},n=function(a){if("number"==typeof a)return!0;if("string"==typeof a){var b=parseInt(a,10)+"";if(b===a.trim())return!0;if(b+"px"===a.trim())return!0}return!1},o=function(a){return"number"==typeof a?a+"px":parseInt(a,10)+""===a.trim()?a.trim()+"px":a},p=function(a){return g.isBoolean(a)?50:g.isDate(a)?110:g.isNumber(a)?110:150},q=function(a,b){var c=document.createElement("tr");c.className="bs-table-row-detail",c.id=a+"_detail";var e=document.createElement("td");return e.colSpan=b.childNodes.length,d.append(c,e),c},r=function(a,b,c){var e=document.createDocumentFragment();return a.forEach(function(a){var b=document.createElement("col");d.attr(b,"colid",a.$bind),a.options.width&&(b.style.width=o(a.options.width)),a.options.minWidth&&(b.style.minWidth=o(a.options.minWidth)),d.append(e,b)}),e},s=function(a,b,c,e,h,j,k){var l=document.createDocumentFragment(),m=(j||"").split(" ");return b.forEach(function(a,b){var e,k=document.createElement("th");d.attr(k,"colId",a.$bind),d.attr(k,"data-drag","move"),c._useColGrp||(a.options.width&&(k.style.width=o(a.options.width)),a.options.minWidth&&(k.style.minWidth=o(a.options.minWidth))),e&&(k.className=e.join(" "));var p=document.createElement("div");p.className="bs-column-header";var q=p;if(c.headerLines&&c.headerLines&&c.headerLines>1){var r=document.createElement("div");r.className="bs-header-rows-parent row-"+c.headerLines,q=document.createElement("div"),q.className="bs-header-rows",r.appendChild(q),p.appendChild(r)}if(d.append(q,document.createTextNode(f.tt((a.isLink?"":a.title)||String.fromCharCode(160),h))),c.allowColumnResize&&n(a.options.width)){var s=document.createElement("div");s.className="bs-col-resize",d.attr(s,"data-drag","resize"),d.attr(k,"colId",a.$bind),d.append(p,s)}d.append(k,p),c.sorting&&g.canSort(a.schema)&&(e=e||[],e.push("bs-cursor-p"),m&&m.length&&m[0]===a.$bind&&i(k,1===j.length)),e&&(k.className=e.join(" ")),d.append(l,k)}),l},t=function(a,b,c,e,f,g,h){var i=document.createDocumentFragment();return b&&b.forEach(function(b,j){d.append(i,u(a,j,b,c,e,f,g,h))}),i},/*
        *  row: {name: fieldName, schema: {}}
        */
u=function(a,b,c,f,g,h,i,j){var k=document.createElement("tr");return"middle"===h.align&&d.addClass(k,"bs-va-middle"),g.forEach(function(a,g){var i=document.createElement("td");if(0==g)d.append(i,document.createTextNode(c.schema.title||String.fromCharCode(160)));else{d.attr(i,"rowId",a.id),d.attr(i,"colId",c.name),i.rowIndex=b,i.colIndex=g-1;var l=f.get(g-1),m=e.utils.displayValue(l.getRelativeValue(c.name),c.schema,j,{html:!0,useSymbol:!0,editable:c.canEdit,check:c.check,avanced:null,tableOptions:h,state:null},l,c.name);if(m.html){var n=$(m.value);d.append(i,n.get(0))}else d.append(i,document.createTextNode(m.value))}d.append(k,i)}),k},v=function(a,b,c,e){if(c.selecting&&c.selecting.row){var f=[],g=d.find(e,a);g&&f.push(g),c.allowFrozenColumns&&(g=d.find(e,a+"_frozen"),g&&f.push(g)),f.forEach(function(a){b?d.addClass(a,"bs-row-selected"):d.removeClass(a,"bs-row-selected")})}},w=function(a,b,c,f,h,i,j,k,l,m,n){var p=document.createElement("tr");p.id=f.$id+(m?"_frozen":"");var q=["bs-table-row"];if("middle"===i.align&&q.push("bs-va-middle"),f.$select&&i.selecting&&i.selecting.row&&(i.noRowSelectedIndicator||q.push("bs-row-selected")),c&&q.push("bs-row-level-"+c),p.className=q.join(" "),!i._useStripedCss&&i.striped){var r=b%2===1;r||d.addClass(p,"even")}return h.forEach(function(a,h){var j=document.createElement("td"),l=!1;0===b&&i.headerIsHidden&&!i._useColGrp&&(a.options.width&&(j.style.width=o(a.options.width)),a.options.minWidth&&(j.style.minWidth=o(a.options.minWidth)));var m=[];a.options._expandItem&&m.push("bs-cursor-d");var q=a.options.align;if(a.schema){var r=g.isNumber(a.schema),s=g.isDate(a.schema)||g.isDateTime(a.schema);i._nowrap||!r&&!s||m.push("nowrap"),q||(r?q="right":s&&(q="center"))}q&&m.push(e.utils.align2Css(q)),m.length&&(j.className=m.join(" ")),d.attr(j,"colId",a.$bind);var t=f.getRelativeState(a.$bind);if(t.isHidden)l=!0;else if(a.isLink){if(!n){var u=void 0,v=void 0;if(a.options.button){var w="";u=document.createElement("button"),u.type="button",t.isDisabled&&(u.disabled=!0);var x="normal"===a.options.size?"":" btn-"+(i.size||"sm");if(u.className="bs-button btn btn-"+(a.options.type||"link")+x+(t.isDisabled?" disabled":""),a.options.icon&&(v=document.createElement("span"),v.className=d.iconClass(a.options.icon),d.append(u,v),w=" "),a.schema.title){var y=document.createTextNode(w+a.schema.title);d.append(u,y)}}else if(a.options.icon){u=document.createElement("center"),t.isDisabled&&d.addClass(u,"bs-disabled"),v=document.createElement("span");var z=["text-"+(a.options.type||"default")];z.push("bs-basictable-btn"),z.push(d.iconClass(a.options.icon)),v.className=z.join(" "),d.append(u,v)}else l=!0;u&&(u.$link=a.$bind,d.append(j,u))}}else{var A=j,B=a.options||{},C=(i.editing||g.isSelectField(a.$bind))&&!t.isDisabled&&!t.isReadOnly&&!t.isHidden;if(!t.isHidden){var D=null;B.display&&B.displaySchema&&(D=e.utils.displayValue(f.getRelativeValue(B.display),B.displaySchema,k,{tableOptions:i,avanced:B.displayOptions||{},state:f.getRelativeState(B.display)},f,B.display));var E=e.utils.displayValue(f.getRelativeValue(a.$bind),a.schema,k,{html:!0,useSymbol:!1,selectable:!t.isDisabled,editable:C,isTotal:n,check:i.editing,avanced:B,tableOptions:i,display:D,level:c,state:t},f,a.$bind);if(E.html){var F=$(E.value);d.append(A,F.get(0))}else""===E.value?l=!0:d.append(A,document.createTextNode(E.value))}}l&&d.append(j,document.createTextNode(String.fromCharCode(160))),d.append(p,j)}),p},x=function(a,b,c,e,f,g,h,i,j){var k=document.createDocumentFragment();return b&&b.forEach(function(b,l){var m=b.level||0;j&&j(b.value,l,m);var n=l%2===1;d.append(k,w(a,l,m,b.value,c,e,f,g,n,h,i))}),k},y=function(a,b,c,e,f,g,h,i,j){var k=document.createDocumentFragment();return b&&b.forEach(function(b,l,m){m=m||0,j&&j(b,l,m);var n=l%2===1;d.append(k,w(a,l,m,b,c,e,f,g,n,h,i))},e.expandingProperty),k},z=function(a,b){
// all columns have width defined (but not minWidth)
for(var c=!0,d=0,e=b.length;d<e;d++){var f=b[d];if(!f.options.width||f.options.minWidth){c=!1;break}}if(c=c&&"auto"!==a.width,!c){var g=a.scrolling&&a.scrolling.vertical;if(g)throw"To support scrolling vertical, all columns must have explicit widths but not explicit minWidth.";if(a.editing)throw"To support inline editing, all columns must have explicit widths but not explicit minWidth."}return c},A=function(a,b){var c=!!(a.allowFrozenColumns&&b&&b.length);return c},B=function(a,b,c,d){var e=a.scrolling&&a.scrolling.vertical,f=["table","bs-control"];
//adde
return(b||d)&&f.push("table-header"),!b&&!d&&a._useStripedCss&&a.striped&&f.push("table-striped"),a._useColGrp&&f.push("bs-fixed"),b||d||!a.editing&&!a.nowrap?b||d||!a.allowFrozenColumns||(f.push("nowrap"),a._nowrap=!0):(f.push("nowrap"),a._nowrap=!0),a.allowFrozenColumns&&!a.headerIsHidden&&(b?f.push("headernowrap"):e||f.push("headernowrap")),f.push("bs-theme"),a.border&&f.push("table-bordered"),a.small&&f.push("bs-style-small-table"),f},C=function(a,b,c,d){var e=[];return c?e:(a.width&&"auto"!==a.width&&e.push("min-width: "+o(a.width)),e)},D=function(a,b,c,d,e){var f=b.scrolling&&b.scrolling.vertical,g=B(b,c,d,e);a.push("<table"),g.length&&a.push(' class="'+g.join(" ")+'"'),a.push(' id="{0}_table'),d&&a.push("_frozen"),c&&a.push("_header"),e&&a.push("_footer"),a.push('"');var h=C(b,c,d,e);h.length&&a.push(' style="'+h.join(";")+'"'),a.push(">"),
//if (options.description) {
//    html.push("<caption>");
//    _uiutils.utils.addTooltip(html, options.description, options);
//    html.push("</caption>");
//}
b._useColGrp&&a.push('<colgroup id="{0}_colgrp'+(d?"_frozen":"")+(c?"_header":"")+(e?"_footer":"")+'"></colgroup>'),c?b.headerIsHidden||a.push('<thead><tr class="bs-va-middle" id="{0}'+(d?"_frozen":"")+'_cols"></tr></thead>'):f||(b.headerIsHidden||a.push('<thead><tr class="bs-va-middle" id="{0}'+(d?"_frozen":"")+'_cols"></tr></thead>'),b.total&&b.total.property&&a.push('<tfoot id="{0}'+(d?"_frozen":"")+'_totals"></tfoot>')),e&&b.total&&b.total.property&&a.push('<tfoot id="{0}'+(d?"_frozen":"")+'_totals"></tfoot>'),c||e||(a.push('<tbody id="{0}'),d&&a.push("_frozen"),a.push('_rows"></tbody>')),a.push("</table>")},E=function(a){var b=0;return a.forEach(function(a){b+=parseInt(a.options.width+"",10)}),b},F=function(a,b,c){var e=E(c),f=d.find(a,b+"_frozen_header_parent");f&&(f.style.width=e+"px"),f=d.find(a,b+"_frozen_header_sep"),f&&(e?d.removeClass(f,"empty"):d.addClass(f,"empty"))},G=function(a){var b=a.cloneNode(!0);if("th"===b.tagName.toLowerCase()){var c=a.parentElement,e=c.parentElement.parentElement,f=["<div>"];f.push('<table class="'),f.push(e.className),f.push('">'),f.push("<thead>"),f.push('<tr class="'),f.push(c.className),f.push('">'),f.push("</tr></thead><table>"),f.push("</div>");var g=$(f.join("")).get(0),h=g.firstChild.firstChild.firstChild;h.style.height=a.offsetHeight+"px",d.append(h,b),b=g}var i=d.position(a,null);return b.style.top=i.top+"px",b.style.left=i.left+"px",b.style.width=a.offsetWidth+"px",b.style.height=a.offsetHeight+"px",b.style.zIndex="5000",b.style.position="absolute",b},H=function(a,b,f,g,i,j,k){g=g||"",b._useColGrp=z(b,j),b._useStripedCss=!(b.rows&&b.rows.detail)&&b.striped,b=$.extend({right:!1,icon:null,type:"default",width:"auto",height:"auto",size:null,scrolling:{horizontal:!1}},b),
//create div container 
void 0!==b.title&&(g=b.title);var l=[],m=["bs-field-group bs-island"];l.push('<div id="{0}" '),l.push(' class="'),f&&m.push("design"),l.push(m.join(" ")),l.push('"'),h(a,b,f,l),l.push(">"),
//create header div
l.push('<div id="{0}_header"></div>'),m=["bs-basictable-group"];var n=b.scrolling&&b.scrolling.horizontal,o=b.scrolling&&b.scrolling.vertical;if((o||b.allowFrozenColumns)&&m.push("border"),n&&!o&&m.push("bs-scroll-x"),l.push('<div id="{0}_focus" class="'),l.push(m.join(" ")),l.push('"'),b.selecting&&(b.selecting.cell||b.selecting.row)&&l.push(' tabindex="0" '),l.push(">"),b.allowFrozenColumns){l.push('<div class="bs-table-cols">');var p=E(k);if(l.push('<div id="{0}_frozen_header_parent"  class="bs-table-frozen-cols" style="width:'+p+'px;">'),o&&!b.headerIsHidden&&(
// parent of frozen header table
l.push('<div id="{0}_table_frozen_header" class="bs-table-header">'),
// frozen header table 
D(l,b,!0,!0,!1),l.push("</div>")),
// parent of frozen table content
m=["bs-table-content-scroll frozen"],l.push('<div  class="'+m.join(" ")+'">'),m=["bs-table-content frozen"],l.push('<div id="{0}_frozen_scroll" class="'+m.join(" ")+'"'),o){var q=[];if(!b.height||"auto"===b.height)throw"To support scrolling vertical, the grid must have an explicit height.";q.push("height: "+parseInt(b.height+"",10)+"px"),q.length&&l.push(' style="'+q.join(";")+'"')}l.push(">"),l.push('<div  class="'+m.join(" ")+'">'),D(l,b,!1,!0,!1),o&&l.push('<div id="{0}_frozen_scroll_delta" class="bs-relative"></div>'),l.push("</div>"),l.push("</div>"),// {0}_frozen_scroll
l.push("</div>"),// 0}_frozen_header_parent
o&&b.total&&b.total.property&&(l.push('<div id="{0}_table_frozen_footer" class="bs-table-header">'),D(l,b,!1,!0,!0),l.push("</div>")),l.push("</div>"),// bs-table-frozen-cols
l.push('<div id="{0}_frozen_header_sep" class="bs-table-cols-sep'+(k.length?"":" empty")+'"></div>'),l.push('<div class="bs-table-free-cols">')}if(o&&!b.headerIsHidden&&(l.push('<div id="{0}_table_header" class="bs-table-header" style="padding-right:'),l.push(d.scrollbar()),l.push('px;">'),l.push('<div id="{0}_table_header_content" class="bs-table-header-content">'),D(l,b,!0,!1,!1),l.push("</div></div>")),
//create div table container
o&&l.push('<div class="bs-table-content-scroll">'),m=["bs-table-content"],o&&m.push("vscroll"),l.push('<div id="{0}_master_scroll" class="'+m.join(" ")+'"'),o){var q=[];if(!b.height||"auto"===b.height)throw"To support scrolling vertical, the grid must have an explicit height.";q.push("height: "+parseInt(b.height+"",10)+"px"),q.length&&l.push(' style="'+q.join(";")+'"')}
// create table
//bs-table-content-scroll
//bs-table-free-cols
return l.push(">"),D(l,b,!1,!1,!1),l.push("</div>"),o&&(l.push("</div>"),b.total&&b.total.property&&(l.push('<div id="{0}_table_footer" class="bs-table-header" style="padding-right:'),l.push(d.scrollbar()),l.push('px;">'),l.push('<div id="{0}_table_footer_content" class="bs-table-header-content">'),D(l,b,!1,!1,!0),l.push("</div>"),l.push("</div>"))),b.allowFrozenColumns&&(l.push("</div>"),l.push("</div>")),l.push("</div>"),l.push('<center id="{0}_pagination"></center>'),e.utils.addErrorDiv(l),l.push("</div>"),c.format(l.join(""),a)},I=function(a,b){var c=document.createElement("div");return c.className="bs-absolute bs-col-resize-indicator",c.style.top="0px",c.style.left=b.left+"px",d.append(a,c),c},J=function(a,b,c){var d=b.offsetHeight-(c?3:1);a.style.height=Math.floor(d)+"px"},K=function(a,b,d,e,f,g,h,i){var j=e.filter?h.schema.filters[e.filter]||[]:h.schema.enum,k=j.indexOf(d);k<0?(c.nextTick(function(){g.item.setValue(h.$bind,j[0])}),a.input.selectedIndex=0):a.input.selectedIndex=k},L=function(a,b,c,d,e,f,h,i){return h.schema.enum?K(a,b,c,d,e,f,h,i):(b=b||"",g.isNumber(h.schema)?void(a.input.value=i.nativeNumber?c:b):g.isDate(h.schema)?void(a.input.value=i.nativeDate?c:b):void(a.input.value=b))},M=function(a,b,f,g,h,i,j){var k=document.createElement("select");k.type="text";var l=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];k.className=l.join(" ");var m=f.filter?i.schema.filters[f.filter]||[]:i.schema.enum,n=m.indexOf(b);return e.utils.fillSelect(m,k,i.schema),J(k,g,!1),d.empty(g),d.addClass(g,"focused"),d.append(g,k),n<0?(c.nextTick(function(){h.item.setValue(i.$bind,m[0])}),k.selectedIndex=0):k.selectedIndex=n,{input:k,parent:k,td:g,isInputElement:!0,canSelect:!1,schema:i.schema}},N=function(a,b,c,h,i,j,k){var l=document.createElement("div");l.className="bs-inplace-parent bs-edit-border ";var m=l;k.after&&(m=document.createElement("div"),m.className="bs-input-group",l.appendChild(m));var n=g.isDate(j.schema)&&e.utils.useDatePicker(),o=document.createElement("input");o.type=k.type||"text";var p=["bs-inplace-edit bs-inplace-edit-size"];if(k.after&&p.push("bs-input-group-main"),o.className=p.join(" "),d.append(m,o),k.after){var q=document.createElement("span");q.tabIndex=-1,q.className="bs-input-group-addon bs-cursor-d add-on";var r=document.createElement("span");r.className=d.iconClass(k.after.icon),d.append(q,r),d.append(m,q)}return J(o,h,!0),d.empty(h),d.addClass(h,"focused"),d.append(h,l),g.isDate(j.schema)&&(n?(e.utils.datePickerInitialize($(l),{showOnFocus:!1},function(a){}),e.utils.datePickerSetValue($(l),b)):o.value=f.isoDatePart(b||"")),{input:o,parent:l,td:h,isInputElement:!0,canSelect:!0,schema:j.schema}},O=function(a){if(a.childNodes.length)for(var b=!1,c=0,e=a.childNodes.length;c<e;c++){var f=a.childNodes[c];d.hasClass(f,"bs-table-row")&&(b?d.removeClass(f,"even"):d.addClass(f,"even"),b=!b)}},P=function(a,b,c,h,i,j,k){if(j.schema.enum)return M(a,b,c,h,i,j,k);if(g.isBoolean(j.schema))return{input:null,parent:null,td:h,isInputElement:!1,canSelect:!1,schema:j.schema};if(k.after||k.before)return N(a,b,c,h,i,j,k);var l=document.createElement("input");l.type=k.type||"text";var m=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];return j.options.align&&m.push(e.utils.align2Css(j.options.align)),"text"===l.type&&j.schema.maxLength&&(l.maxLength=j.schema.maxLength),l.className=m.join(" "),J(l,h,!1),d.empty(h),d.addClass(h,"focused"),d.append(h,l),g.isDate(j.schema)?k.nativeDate?l.value=f.isoDatePart(b||""):l.value=f.shortDate(b||""):g.isNumber(j.schema)&&k.nativeNumber?l.value=b||0:l.value=a,{input:l,parent:l,td:h,isInputElement:!0,canSelect:!0,schema:j.schema,decimals:c.decimals}},Q={createCols:s,createColGroup:r,updSorting:m,gridContainer:H,createRows:y,createBulkRows:x,createRow:w,setRowsSelected:v,createGridRows:t,createInplaceEdit:P,updateInplaceEdit:L,createDetail:q,updateEvenOdd:O,ensureWidth:o,updateFrozenWidth:F,setColumnWidth:l,hasFrozenColumns:A,cloneForMove:G,isPixel:n,widthFromSchema:p,resizeDiv:I,getColumnsSizeParents:k};b.GridUtil=Q}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="../../../core/modules/drag.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../errors.data.ts" />
/// <reference path="../../pager.control.ts" />
/// <reference path="./basicgrid.ts" />
/// <reference path="./uiutils.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.dom,e=b,f=a.ulocale,g=a.uiutils,h=a.Observable,i=e.GridUtil,j=h.errorsUtils,k=a.link,l=a.locale,m=a.drag,n=a.events,o=h.SchemaUtils,p=20,q=2e3,r=function(a,b){return(b!==d.keys.VK_TAB||!a.shiftKey)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)},s=function(a){a=(a||"")+"",a=a.trim();var b=parseInt(a,10);return b+""===a||b+"px"===a||b+" px"===a};b.glbGridFilter=null,b.glbGridSettings=null;var t=function(t){function u(b,c,d){t.call(this,b,c,d),this._refreshGrid=function(){var a=this,b=a.renderOptions;a.removeEvents(),a._initCols(b),a._renderColumns(b),a._renderRows(!0,"",null),a._renderTotalRows(),a.setEvents(a.renderOptions),a.resize()};var e=this;if(void 0===e.fieldOptions.striped&&(e.fieldOptions.striped=!a.bootstrap4),e._view=[],e._viewMap={},e._ignoreNotifications=!1,d.supportSettings()&&(e._settingsName=e.getSettingsName("basicgrid"),e._settings=d.getFieldSettings(e._settingsName)),d.registerListenerFor(e.$bind+".$item",e),e._settings){var f=e.fieldOptions.columns||[],g=e._settings.columns||[],h={};f.forEach(function(a){h[a.$bind]=a}),g.forEach(function(a){var b=h[a.$bind];if(b){var c=a.options||{},d=b.options||{};c.width&&(d.width=c.width),c.frozen&&(d.frozen=c.frozen),c.display&&(d.display=c.display),a.options=d}}),e.fieldOptions.columns=g,e._settings.columns=null}e.fieldOptions&&e.fieldOptions.total&&e.fieldOptions.total.property&&(e._totalProperty=e.fieldOptions.total.property,d.registerListenerFor(e._totalProperty,e)),e._state(),
// load config 
e.checkOptions(e.fieldOptions),e._initOrigColumns(e.fieldOptions),e._initCols(e.fieldOptions),e._details=[]}return __extends(u,t),u.prototype._initOrigColumns=function(a){var b=this;b._originalCols={},a.columns=a.columns||[],a.columns.forEach(function(a){a.options=a.options||{},a.$bind===h.EXPANDED_FIELD_NAME&&a.options.display&&(b._originalCols[a.options.display]=$.extend(!0,{},a),b._originalCols[a.options.display].options._expandItem=!0)})},u.prototype.checkOptions=function(a){void 0===a.allowColumnMove&&(a.allowColumnMove=!0),a.align=a.align||"middle"},u.prototype.beforeSaveSettings=function(){var a=this;if(a._settingsName){a._settings={columns:[]};var b=a.renderOptions.columns||[];return b.forEach(function(b){var c={$bind:b.$bind,options:null},d={};b.canStartDragHandler&&(d.frozen=!0),b.options.width&&(d.width=b.options.width),b.options.display&&(d.display=b.options.display),b.options.frozen&&(d.frozen=b.options.frozen),b.options._expandItem&&(c.$bind=h.EXPANDED_FIELD_NAME),c.options=d,a._settings.columns.push(c)}),a.form.setFieldSettings(a._settingsName,a._settings),!0}return!1},u.prototype._inplaceEditValue2Model=function(a,b,c){var d=b.getState(c.$bind),e=o.text2Value(a,c.schema,d),f=b.getValue(c.$bind);return e!==f&&(b.setValue(c.$bind,e),!0)},u.prototype._inplaceEditAcceptKeys=function(a){var b=this;if(b.inplace.schema.enum){if(a===d.keys.VK_UP||a===d.keys.VK_DOWN)return!1}else if(o.isDate(b.inplace.schema)&&g.utils.useDatePicker()&&(a===d.keys.VK_UP||a===d.keys.VK_DOWN||a===d.keys.VK_LEFT||a===d.keys.VK_RIGHT))return!1;return!0},u.prototype._inplaceEditAddEvents=function(){var a=this;a.inplace.schema.enum&&$(a.inplace.input).on("change",function(b){var c=a.inplace.td,d=a._td2value(c),e=a._inplaceEditGetValue(d);a._inplaceEditValue2Model(e,d.item,d.col)||a._modifyCell(d.item,d.col.$bind,c)})},u.prototype._inplaceEditRemoveEvents=function(){var a=this;a.inplace.schema.enum?$(a.inplace.input).off("change"):o.isDate(a.inplace.schema)&&g.utils.useDatePicker()&&g.utils.datePickerDestroy($(a.inplace.parent))},u.prototype._inplaceEditGetValue=function(a){var b=this;if(!a.item)return null;var c=a.item.getState(a.col.$bind);if(b.inplace.schema.enum){var d=b.inplace.input.selectedIndex;return c.filter?b.inplace.schema.filters[c.filter][d]:b.inplace.schema.enum[d]}return g.utils.text2value(b.inplace.input.value,b.inplace.schema,c)},u.prototype._inpaceEditShow=function(a,b){var c=this,e=c._td2value(a),f=e.item.getValue(e.col.$bind),h=e.item.getState(e.col.$bind),j=o.value2Text(f,e.col.schema,h);a.tabIndex=-1;var k={nativeNumber:!1,nativeDate:!1,type:"text",after:null};o.isDate(e.col.schema)?(k.nativeDate=g.utils.nativeDate(),k.nativeDate?k.type="date":g.utils.useDatePicker()&&(k.after={icon:"calendar"})):o.isNumber(e.col.schema)&&(k.nativeNumber=g.utils.nativeNumber(),k.nativeNumber&&(k.type="number")),c.inplace=i.createInplaceEdit(j,f,h,a,e,e.col,k),c._inplaceEditAddEvents(),c.inplace.isInputElement?(c.inplace.input.tabIndex=0,c.inplace.input.focus(),c.inplace.canSelect&&d.select(c.inplace.input)):(
// focus on td ?
a.tabIndex=0,a.focus()),c._onFrozenFocusScroll(a,e.col)},u.prototype._inplaceEditRemove=function(a,b){var c=this;if(c.inplace&&!b){var e=c.inplace.td;a&&(e.tabIndex=0);var f=c._td2value(e);c._inplaceEditRemoveEvents(),c.inplace.parent&&d.remove(c.inplace.parent),d.removeClass(e,"focused");var g=!!c.inplace.input;if(g){var h=c._inplaceEditGetValue(f);if(c.inplace=null,!f.item)return;c._inplaceEditValue2Model(h+"",f.item,f.col)||c._modifyCell(f.item,f.col.$bind,e)}}c.inplace=null},u.prototype._inplaceEditModel2Control=function(a,b,c){var d=this,e=d._td2value(c),f=(d._inplaceEditGetValue(e),a.getValue(e.col.$bind)),h=a.getState(e.col.$bind),j=o.value2Text(f,e.col.schema,h),k={nativeNumber:g.utils.nativeNumber(),nativeDate:g.utils.nativeDate()};i.updateInplaceEdit(d.inplace,j,f,h,c,e,e.col,k)},u.prototype.removeEvents=function(){var a=this;a._scrollableMaster&&$(a._scrollableMaster).off("scroll"),
//if (that._scrollableFrozenContent  && (that.fieldOptions.editing || (that.fieldOptions.selecting && that.fieldOptions.selecting.cell)))
//    $(that._scrollableFrozenContent).off('scroll');
a._scrollableMaster=null,a._scrollableHeaderOfMaster=null,a._scrollableFooterOfMaster=null,a._drag&&(m.dragManager.rmvDrag(a._drag),a._drag=null)},u.prototype._onFrozenFocusScroll=function(a,b){var c=this;if(b&&b.options&&b.options.frozen){var d=c.renderOptions,e=i.hasFrozenColumns(d,c.frozenColumns);e&&d.scrolling&&d.scrolling.vertical&&(c._rsFrozenTimer&&(c._rsFrozenTimer.clearTimeout(),c._rsFrozenTimer=null),c.syncMasterScroll(null))}},u.prototype.setEvents=function(a){var b=this,c=a.scrolling&&a.scrolling.vertical;if(c){var e=b.$element.get(0);b._scrollableMaster=d.find(e,b.id+"_master_scroll"),b._scrollableHeaderOfMaster=d.find(e,b.id+"_table_header_content"),b._totalProperty&&(b._scrollableFooterOfMaster=d.find(e,b.id+"_table_footer_content"));var f=i.hasFrozenColumns(a,b.frozenColumns);b._scrollableFrozenContent=f?d.find(e,b.id+"_frozen_scroll"):null,b._deltaHScrollContent=f?d.find(e,b.id+"_frozen_scroll_delta"):null,b._scrollableMaster&&b._scrollableHeaderOfMaster&&$(b._scrollableMaster).on("scroll",b.syncHeaderAndFrozenScroll.bind(b))}if((a.allowColumnResize||a.allowColumnMove)&&!a.headerIsHidden){var g=m.dragManager.addDrag([b.$element.get(0)]);b._drag=g,g.canStartDragHandler=b._canStartDrag.bind(b),g.onDragStart=b._onDragStart.bind(b),g.onDrag=b._onDrag.bind(b),g.onDragEnd=b._onDragEnd.bind(b)}},u.prototype._getColsInfo=function(a,b){var d=[];return a.forEach(function(a,e){var f=b.childNodes[e];f.id||(f.id=c.allocID()),d.push({htmlId:f.id,info:a})}),d},u.prototype._canStartDrag=function(a){var b=this,e=a.target,f=d.attr(e,"data-drag"),g=d.parentByTag(b.$element.get(0),e,"th");if(g)return f||(f=d.attr(g,"data-drag")),!!f&&(g.id||(g.id=c.allocID()),b._drag.data.op=f,b._drag.data.cloneId=g.id,b._drag.data.column=d.attr(g,"colId"),!!b._drag.data.column&&b["_cdd"+f](a))},u.prototype._onDragStart=function(a){var b=this;return!!b._drag.data.op&&b["_sdd"+b._drag.data.op](a)},u.prototype._onDrag=function(a){var b=this;return!!b._drag.data.op&&b["_ddd"+b._drag.data.op](a)},u.prototype._onDragEnd=function(a,b){var c=this;return!!c._drag.data.op&&c["_edd"+c._drag.data.op](a,b)},u.prototype._cddresize=function(a){var b=this,c=b.renderOptions;if(!c.allowColumnResize)return!1;var d=b._drag;return d.coverDocument=!0,d.cursor="col-resize",d.moveX=!0,!0},u.prototype._sddresize=function(a){var b=this,c=b._drag;c.floatParent=b._gridParentFocus();var e=d.find(c.floatParent,b._drag.data.cloneId),f=d.position(e,c.floatParent);return c.floatElement=i.resizeDiv(c.floatParent,{left:Math.round(f.left+e.offsetWidth)}),c.minLeft=Math.round(f.left+p),c.maxLeft=Math.round(f.left+q),!0},u.prototype._dddresize=function(a){return!0},u.prototype._eddresize=function(a,b){var c=this,e=c._drag;if(e&&(e.floatElement&&(d.remove(e.floatElement),e.floatElement=null),!a)){var f=c._colByField(e.data.column),g=n.point(b),h=g.x-e.startPoint.x,i=d.find(e.floatParent,c._drag.data.cloneId),j=parseInt(f.options.width+"",10);if(i.offsetWidth-j>5){var k=j/i.offsetWidth;h=Math.round(k*h)}var l=Math.min(Math.max(p,j+h),q);c._updateColWidth(f,l),c.savePreferences(function(){})}},u.prototype._updateColWidth=function(a,b){var c=this,d=Math.max(parseInt(a.options.width||"0",10),q);if(d!==b){a.options.width=b;var e=a.options.frozen&&c.renderOptions.allowFrozenColumns,f=i.getColumnsSizeParents(c.id,c.$element.get(0),c.renderOptions,e);i.setColumnWidth(a.$bind,f,b),e&&i.updateFrozenWidth(c.$element.get(0),c.id,c.frozenColumns),c.resize()}},u.prototype._cddmove=function(a){var b=this,c=b.renderOptions;if(!c.allowColumnMove)return!1;var e=b.$element.get(0),f=b._drag,g=d.find(e,f.data.cloneId);f.coverDocument=!0,f.cursor="move",f.moveX=!0,f.moveY=!0,f.startOffset=d.position(g,null);var h,i,j={firstDelta:0,lastDelta:-10,delta:-4,top:f.startOffset.top,height:g.offsetHeight};if(c.allowFrozenColumns&&(h=d.find(e,b.id+"_frozen_cols"),h&&(i=d.childrenPositions(h,b._getColsInfo(b.frozenColumns,h),!1,"frozen",j))),j.lastDelta=0,h=d.find(e,b.id+"_cols")){var k=d.childrenPositions(h,b._getColsInfo(b.columns,h),!1,"free",j);i=i?i.concat(k):k}return f.data.childrenPositions=i,!0},u.prototype._sddmove=function(a){var b=this,c=b._drag,e=d.find(b.$element.get(0),c.data.cloneId);return c.floatElement=i.cloneForMove(e),d.append(document.body,c.floatElement),!0},u.prototype._eddmove=function(a,b){var c=this,e=c._drag;if(e&&(e.floatElement&&(d.remove(e.floatElement),e.floatElement=null),e.data.mdiv&&(d.remove(e.data.mdiv),e.data.mdiv=null),!a&&e.data.best&&e.data.column)){var f=e.data.best.info,g=c._mapCols[e.data.column];if("empty"===e.data.best.position)
//frozen --> free or free -> frozen
g.column.options.frozen=!g.column.options.frozen;else{if(f.$bind===g.column.$bind)return;var h=c._mapCols[f.$bind],i=g.column,j=h.column,k=g.tindex,l="after"===e.data.best.position?h.tindex+1:h.tindex,m=!1;if(!!i.options.frozen!=!!j.options.frozen&&(i.options.frozen=j.options.frozen,m=!0),k===l-1){if(!m)return}else
// remove src
c.renderOptions.columns.splice(k,1),k<l&&l--,
// insert at ni
c.renderOptions.columns.splice(l,0,i)}c.savePreferences(function(){c._refreshGrid()})}},u.prototype._dddmove=function(a){var b=this,c=b._drag,e=n.point(a),f=d.findNearest(e.x,e.y,c.data.childrenPositions);if(c.data.best!=f){var g={left:f.left,top:f.top,width:f.width,height:f.height};c.data.mdiv=d.showMove(c.data.mdiv,f.vertical,g,"frozen"===f.zone?"bs-drag-color-success":"bs-drag-color-info")}return c.data.best=f,!0},u.prototype.destroy=function(){var a=this;a._destroyDetails(),a.columns&&(a.columns.forEach(function(a){a.schema=null}),a.columns=null),a.frozenColumns&&(a.frozenColumns.forEach(function(a){a.schema=null}),a.frozenColumns=null),a.form.unRegisterListenerFor(a.$bind+".$item",a),a._totalProperty&&a.form.unRegisterListenerFor(a._totalProperty,a),a._inplaceEditRemove(!1,!0),a._pager&&(a._pager.destroy(),a._pager=null),a._toolBar&&(a._toolBar.destroy(),a._toolBar=null),a._details=null,a._mapCols=null,a._originalCols=null,a._settings=null,a._scroller=null,a._rsTimer=null,a._rsFrozenTimer=null,a._scrollableMaster=null,a._scrollableHeaderOfMaster=null,a._scrollableFooterOfMaster=null,a._scrollableFrozenContent=null,a._deltaHScrollContent=null,t.prototype.destroy.call(this)},u.prototype._moveToPage=function(a){var b=this;b.state.value.currentPage(a)},u.prototype._onselectPage=function(a){var b=this;switch(a){case"next":b._moveToPage(Math.min(b._pager.props.totalPages,b._pager.props.currentPage+1));break;case"prev":b._moveToPage(Math.max(0,b._pager.props.currentPage-1));break;case"first":b._moveToPage(1);break;case"last":b._moveToPage(b._pager.props.totalPages);break;default:b._moveToPage(a)}},u.prototype._onSelectToolElement=function(a){var c=this,d=a.name||a.id;if("filter"===a.type&&b.glbGridFilter)return b.glbGridFilter(c.getColumnsForFilter(),function(a){c.state.value.filterManager.filterComplex=a,c.state.value.filter=c.state.value.filterManager.constructeFilter()});if("filterexpress"===a.type)c.state.value.filterManager.filterExpress=a.value,c.state.value.filter=c.state.value.filterManager.constructeFilter();else{if("settings"===a.type&&b.glbGridSettings){var e=c.getColumnsForSettings();return e.options=a.toolData,b.glbGridSettings(e,function(a){c.setColumns(a)})}"multiselect"===a.type?c.toggleMultiselect():c.form.execAction(c.$bind+".$toolbar."+d,{toolElement:a,control:c})}},u.prototype.setColumns=function(a){var b=this;b.renderOptions.columns=a.map(function(a){var c=b._colByField(a.$bind);return c||(c=b._originalCols[a.$bind]),c&&(c.options._expandItem&&(a.$bind=h.EXPANDED_FIELD_NAME),a.options=c.options),a}),b.savePreferences(function(){b._refreshGrid()})},u.prototype._state=function(){t.prototype._state.call(this);var a=this,c=a.fieldOptions;if(a.state.value.isQueryable()){
// create pager
var d=$.extend({size:"default",selectPage:a._onselectPage.bind(a)},c.pager||{});a._pager=new e.Pager(d);var f=a._pager;f.props.totalPages=a.state.value.totalPages(),f.props.currentPage=a.state.value.currentPage()}var g=[];if(c.toolbar&&c.toolbar.items){var h=$.extend(!0,{},c.toolbar);h.items.forEach(function(d){if(d.name=d.name||d.type,d.lookup){var f=null,h=function(b,c){if(c=c||{},c.inited&&c.updated)f.firthPage();else if(b){d.value=d.value||{};var e={default:d.value.default,items:[],upd:!0};e.items=b||[],a._toolBar.setValue(d.name,e)}};f=new e.DsLookup(a.$schemaItems.lookups[d.lookup],{notify:h})}if("count"===d.type)d=$.extend({right:!0,value:a.state.value.totalCount()},d);else if("filter"===d.type)d=$.extend({value:a.state.value.filter||"",icon:"filter"},d),a.state.value.filterManager=a.state.value.filterManager||new b.FilterManager;else if("multiselect"===d.type){var i=!!(c.selecting&&c.selecting.row&&c.selecting.multiselect);d=$.extend(d,{style:"default",icon:"check",value:i})}else"filterexpress"===d.type&&(d=$.extend(d,{fields:a.getColumnsForFilterExpress(d.fields)}),a.state.value.filterManager=a.state.value.filterManager||new b.FilterManager);g.push(d)})}if(g.length){var i={selectToolElement:a._onSelectToolElement.bind(a)};a._toolBar=new e.ToolBar(g,i)}},u.prototype._destroyDetails=function(){
//Destroy all inline "forms" 
var a=this;if(a._details){var b=e.formManager();a._details.forEach(function(a){var c=b.formByName(a);c&&c.destroy()}),a._details=[]}},u.prototype._destroyDetailById=function(a){var b=this,c=b._details.indexOf(a);c>=0&&b._details.splice(c,1);var d=e.formManager().formByName(a);d&&d.destroy()},u.prototype._initCols=function(a){var b=this;b._mapCols={},a.columns&&a.columns.length||(a.columns=[{$bind:"$index"}]),b.columns=[],b.frozenColumns=[];var c=a.columns.findIndex(function(a){return o.isSelectField(a.$bind)}),d=a.selecting&&a.selecting.row&&a.selecting.multiselect;d?c<0&&a.columns.splice(0,0,{$bind:h.SELECTED_FIELD_NAME,options:{width:50,frozen:!0}}):c>=0&&a.columns.splice(c,1);var e=!!a.expandingProperty,g=a.scrolling&&a.scrolling.vertical||a.editing;a.columns.forEach(function(c,d){var h=$.extend({},c);return h.options=h.options||{},e&&o.isExpandField(c.$bind)&&(h.schema=o.getSchema(c.$bind,b.$schemaItems,b.form.$rootSchema,!1),h.$bind=a.expandingProperty+c.$bind,h.options.icons={1:a.expanding&&a.expanding.plus?a.expanding.plus:"plus",2:a.expanding&&a.expanding.minus?a.expanding.minus:"minus"},h.options.align=h.options.align||"left",h.options.alignIcon=h.options.alignIcon||"left",h.options._clickable=!0,h.options._expandItem=!0,a.expanding&&(a.expanding.style&&(h.options._expandItemClass=a.expanding.style),a.expanding.iconClass&&(h.options.iconClass=a.expanding.iconClass))),h.schema||(h.schema=o.getSchema(c.$bind,b.$schemaItems,b.form.$rootSchema,!1)),h.schema||h.schema?b._mapCols[h.$bind]?void console.log("Duplicate column name  : "+c.$bind):(h.title=f.tt(h.options.title||h.schema.title,b.form.$locale),h.options.display&&(h.options.displaySchema=o.getSchema(h.options.display,b.$schemaItems,b.form.$rootSchema,!1),!h.title&&h.options.displaySchema&&(h.title=f.tt(h.options.displaySchema.title,b.form.$locale))),o.isLink(c.$bind)&&(h.isLink=!0),g&&!h.options.width&&(h.options.width=i.widthFromSchema(h.schema)),h.options.frozen&&a.allowFrozenColumns?(h.options.width?s(h.options.width)||(h.options.width=50):h.options.width=i.widthFromSchema(h.schema),b.frozenColumns.push(h),void(b._mapCols[h.$bind]={column:h,index:b.frozenColumns.length-1,tindex:d})):(b.columns.push(h),void(b._mapCols[h.$bind]={column:h,index:b.columns.length-1,tindex:d}))):void console.log("Field (bind) not found : "+c.$bind)})},u.prototype._colByField=function(a){var b=this._mapCols[a];return b?b.column:null},u.prototype._totalChanged=function(a,b,c,d,e){var f=this;if(f.$element){if(f._ignoreNotifications)return!1;switch(d){case"set":case"propchange":a===e.propName&&f._renderTotalRows();break;case"upd":if(a===e.propName){var g=f.form.getValue(f._totalProperty),h=e&&e.$oid?g.findById(e.$oid):null;if(h){var i=e.property;f._modifyFooterCell(h,i)}}}}},u.prototype.changed=function(a,b,c,d,e){var f=this;if(f.$element){if(f._ignoreNotifications)return!1;var g=!1,h=!1,j=!1;if(f._totalProperty&&0===a.indexOf(f._totalProperty))return void(a===e.propName&&f._totalChanged(a,b,c,d,e));switch(d){case"count":if(a===e.propName){var k=f._toolBar;k&&k.setValue&&k.setValue("count",f.state.value.totalCount())}break;case"filter":if(a===e.propName){var k=f._toolBar;k&&k.setValue&&k.setValue("filter",f.state.value.filter.title||"")}break;case"pagination":if(a===e.propName){var l=f._pager;l&&(l.props.totalPages=f.state.value.totalPages(),l.props.currentPage=f.state.value.currentPage())}break;case"sorting":a===e.propName&&f._updateSorting();break;case"set":case"propchange":a===e.propName&&(f._renderRows(!0,"",null),h=!0,j=!0);break;case"add":f._createRow(e.$value),h=!0,g=!0;break;case"remove":f._removeRow(e.$id),g=!0;break;case"upd":if(a===e.propName){
//console.log('Grid update propName = ' + propName + ', params.property = ' + params.property + ', params.$oid = ' + params.$oid);
var m=e&&e.$oid?f._findById(e.$oid):null;if(m){var n=f.renderOptions,p=e.property;n.expandingProperty&&(p=o.removeExpand(p,n.expandingProperty)),f._modifyCell(m,p),o.isSelectField(p)&&(n.noRowSelectedIndicator||i.setRowsSelected(m.$id,m.$select,f.fieldOptions,f.$element.get(0)))}}}g&&f._updOddEven(),h&&f.resize(),j&&f._selectFirstCell("model")}},u.prototype._modifyTD=function(a,b,c){var e=this,f=e.renderOptions,h=e._colByField(b);if(h){var i=a.getState(b),j=h.options||{},k=(f.editing||o.isSelectField(b))&&!i.isDisabled&&!i.isReadOnly&&!i.isHidden;if(d.empty(c),!i.isHidden){var l=null,m=e._viewMap[a.$id],n=m?m.level||0:0;j.display&&j.displaySchema&&(l=g.utils.displayValue(a.getValue(j.display),j.displaySchema,e.form.$locale,{html:!0,tableOptions:f,avanced:j.displayOptions||{},state:a.getState(j.display)},a,j.display));var p=g.utils.displayValue(a.getValue(b),h.schema,e.form.$locale,{html:!0,useSymbol:!1,editable:k,selectable:!i.isDisabled,check:f.editing,avanced:j,tableOptions:f,display:l,level:n,state:i},a,b);if(p.html){var q=$(p.value);d.append(c,q.get(0))}else{var r=p.value;""===r&&(r=String.fromCharCode(160)),d.append(c,document.createTextNode(r))}}}},u.prototype._findTR=function(a,b){var c=this,e=c.renderOptions,f=a+(b.options.frozen&&e.allowFrozenColumns?"_frozen":"");return d.find(c.$element.get(0),f)},u.prototype._id2rowId=function(a){var b=a.indexOf("_frozen");return b>0&&(a=a.substring(0,b)),a},u.prototype._findtBody=function(a){var b=this,c=b.renderOptions,e=b.id+(a.options.frozen&&c.allowFrozenColumns?"_frozen_rows":"_rows");return d.find(b.$element.get(0),e)},u.prototype._modifyFooterCell=function(a,b){var c=this;if(c.$element){var d=c._colByField(b);if(d){var e=c._findTR(a.$id,d);e&&c._findCellAndModify(a,e,b)}}},u.prototype._findCellAndModify=function(a,b,c){for(var e=this,f=0,g=b.childNodes.length;f<g;f++){var h=b.childNodes[f],i=d.attr(h,"colid");if(i===c){if(e.inplace&&e.inplace.input&&e.inplace.td===h)return void e._inplaceEditModel2Control(a,c,h);e._modifyTD(a,c,h)}}},u.prototype._modifyCell=function(a,b,c){var d=this;if(d.$element){var e=d._colByField(b);if(e){if(c)return d.inplace&&d.inplace.input&&d.inplace.td===c?void d._inplaceEditModel2Control(a,b,c):d._modifyTD(a,b,c);var f=d._findTR(a.$id,e);f&&d._findCellAndModify(a,f,b)}}},u.prototype._rootElement=function(){return this.$element.get(0)},u.prototype._gridParentFocus=function(){var a=this;return d.find(a.$element.get(0),a.id+"_focus")},u.prototype._setErrors=function(a,b){var c=this,d=c.state.errors;c.showErrors(b,d)},u.prototype._setTableFocus=function(a){var b=this,c=d.find(b.$element.get(0),b.id+"_table");c&&(a?d.addClass(c,"focused"):d.removeClass(c,"focused")),c=d.find(b.$element.get(0),b.id+"_table_frozen"),c&&(a?d.addClass(c,"focused"):d.removeClass(c,"focused"))},u.prototype.focusIn=function(a){var b=this;if(b.$element)if(b._setTableFocus(!0),b.selectedCell){var c=b._cell(b.selectedCell,!0);if(c||(b.selectedCell=null,b._selectFirstCell("focusin"),b.selectedCell&&(c=b._cell(b.selectedCell,!0))),!c)return;var d=b.canEdit(b.selectedCell);d&&!b.inplace&&b._inpaceEditShow(c.td,!0)}else b._inplaceEditRemove(!1,!1)},u.prototype.focusOut=function(a){var b=this;b.$element&&(b._setTableFocus(!1),b._inplaceEditRemove(!0,!1))},u.prototype._doTab=function(a){var b=this;return a?b._moveRightSelectedCell():b._moveLeftSelectedCell()},u.prototype.keypress=function(a){var b=this;if(b.selectedCell&&b.inplace&&d.isChildOf(b.inplace.td,a.target)){var c=b._td2value(b.inplace.td);if(o.isNumber(b.inplace.schema)){if(g.utils.keyPressNumber(a,b.inplace.input,{decimalSep:l.number.decimal,thousandSep:l.number.thousand,places:b.inplace.decimals,schema:b.inplace.schema})===!1)return!1}else if(o.isDate(b.inplace.schema)){if(g.utils.keyPressDate(a,b.inplace.input,{sep:l.date.daySep,format:l.date.dateShort,schema:b.inplace.schema})===!1)return!1}else if(o.isBoolean(b.inplace.schema)){if(" "===String.fromCharCode(a.which)&&b.fieldOptions.editing){var e=c.item.getRelativeState(c.col.$bind);if(!e.isDisabled&&!e.isReadOnly){var f=c.item.getValue(c.col.$bind);c.item.setValue(c.col.$bind,!f)}}a.preventDefault()}}},u.prototype.keydown=function(a){var b=this,c=a.which||a.keyCode,e=!1;if(!r(a,c)){if(b.inplace&&d.isChildOf(b.inplace.td,a.target)){if(!b._inplaceEditAcceptKeys(c))return;if(o.isNumber(b.inplace.schema)){if(g.utils.keyDownNumber(a,b.inplace.input,{decimalSep:l.number.decimal,thousandSep:l.number.thousand,places:b.inplace.decimals,schema:b.inplace.schema})===!1)return}else if(o.isDate(b.inplace.schema)&&g.utils.keyDownDate(a,b.inplace.input,{sep:l.date.daySep,format:l.date.dateShort,schema:b.inplace.schema})===!1)return}if(b.fieldOptions.selecting&&b.fieldOptions.selecting.cell)switch(c){case d.keys.VK_TAB:e=b._doTab(!a.shiftKey);break;case d.keys.VK_UP:e=b._moveUpSelectedCell(1);break;case d.keys.VK_DOWN:e=b._moveDownSelectedCell(1)}e&&a.preventDefault()&&a.stopPropagation()}},u.prototype._tr2rowId=function(a,b){var c=a.id;if(b&&b.options.frozen){var d=c.indexOf("_frozen");d>0&&(c=c.substring(0,d))}return c},u.prototype._td2cell=function(a){var b=this,c=a.parentNode,e=(c.parentNode,b._colByField(d.attr(a,"colid")));if(!e)return null;var f=b._tr2rowId(c,e),g=b._findById(f);return g&&e?{row:f,col:d.attr(a,"colid")}:null},u.prototype._td2value=function(a){var b=this,c=a.parentNode,e=(c.parentNode,b._colByField(d.attr(a,"colid"))),f=b._tr2rowId(c,e),g=b._findById(f);return{item:g,col:e}},u.prototype.mousedown=function(a){var b=this,c=d.parentByTag(b.$element.get(0),a.target,"td");if(c){var e=b.renderOptions,f=b._td2cell(c);f&&(b._selectCell(f,a,!0)?a.preventDefault():e.selecting&&e.selecting.row&&!e.selecting.cell&&!e.selecting.multiselect&&b._selectRow(f.row))}return!0},u.prototype._addRows=function(a,b){var c=this;c._renderRows(!1,a.$id,b),c._updOddEven()},u.prototype._removeRows=function(a,b){var c=this;b.forEach(function(a){c._removeRow(a.value.$id)}),c._updOddEven()},u.prototype.click=function(a){var b=this,c=b.renderOptions,e=d.parentByTag(b.$element.get(0),a.target,"td");if(e){var f=b._td2cell(e);if(f){var g=b._findById(f.row),h=b._colByField(f.col);if(g){var i=a&&a.target&&a.target.$link||a.target.parentNode.$link;if(i){var j=g.getRelativeState(h.$bind);if(j.isDisabled||j.isHidden)return;h.schema.$widgetAction?b[h.schema.$widgetAction]&&b[h.schema.$widgetAction](g):b.form.execAction(b.$bind+".$item."+i,g)}else if(h)if(h.options._expandItem){if(d.attr(a.target,"data-clickable")||d.attr(a.target.parentNode,"data-clickable")){var l=g.getRelativeState(h.$bind);if(!l.isDisabled&&!l.isReadOnly){var m=g.toggleExpand(c.expandingProperty);
//TODO : move in modifyCell
b._ignoreNotifications=!0;try{var n=[],p=b._viewMap[g.$id];if(g.enumVisibleChildren(c.expandingProperty,p.level,!0,function(a,b){var c={level:b,value:a};n.push(c)}),!n.length)return;m?b._addRows(g,n):b._removeRows(g,n)}finally{b._ignoreNotifications=!1}}}}else if(h.options.$link){var q=d.findByAttribute(a.target,e,"data-phoenix-href");if(q){var l=g.getRelativeState(h.$bind);l.isDisabled||k.execLink(h.options.$link,{$item:g},null)}}else if(h.options.actionName){var l=g.getRelativeState("$links."+h.options.actionName);l&&!l.isDisabled&&b.form.execAction(b.$bind+".$item.$links."+h.options.actionName,g)}else if((o.isSelectField(h.$bind)||c.editing&&o.isBoolean(h.schema))&&d.attr(a.target,"data-clickable")){var l=g.getRelativeState(h.$bind);if(!l.isDisabled&&!l.isReadOnly&&!l.isHidden){var r=g.getValue(h.$bind);o.isSelectField(h.$bind)?g.select(!r,c.selecting&&c.selecting.row&&c.selecting.multiselect,b.state.value,c.expandingProperty,c.expanding&&c.expanding.selectChildren):g.setValue(h.$bind,!r)}}}}}else{var s=d.parentByTag(b.$element.get(0),a.target,"th");if(s){var t=d.attr(s,"colid");if(c.sorting&&t){var u=b._colByField(t);if(u&&o.canSort(u.schema)){var v=u.$bind,w=b.state.value.$orderby();w===u.$bind&&(v=u.$bind+" desc"),b.state.value.$orderby(v)}}}}},u.prototype._setDisabled=function(a,b){var c=this;a.disabled=c.state.isDisabled},u.prototype._showSelected=function(a,b,c,e){var f=this;if(!a)return null;var g=f._cell(a,!1);g&&g.td&&(b?(d.addClass(g.td,"bs-cell-selected"),f._inplaceEditRemove(!1,!1),c&&(f.focused||e)?f._inpaceEditShow(g.td,!1):(f.focused||e)&&(g.td.tabIndex=0,g.td.focus()),f._onFrozenFocusScroll(g.td,f._colByField(a.col))):(d.removeClass(g.td,"bs-cell-selected"),g.td.tabIndex=-1))},u.prototype.canSelect=function(a){var b=this,c=b.selectedCell;if(c&&c.col===a.col&&c.row===a.row)return!1;if(!b.fieldOptions.selecting||!b.fieldOptions.selecting.cell)return!1;var d=b._colByField(a.col);if(d){var e=b._findById(a.row);if(e){var f=e.getState(d.$bind);return!f.isDisabled&&!f.isHidden}}return!1},u.prototype.canEdit=function(a){var b=this;if(!b.fieldOptions.editing||!b.fieldOptions.selecting||!b.fieldOptions.selecting.cell)return!1;var c=b._colByField(a.col);if(c.options._expandItem)return!1;var d=b._findById(a.row),e=d.getState(c.$bind);return!e.isReadOnly&&!e.isDisabled&&!e.isHidden},u.prototype._selectRow=function(a){var b=this,c=b.renderOptions,d=c.selecting&&c.selecting.row&&c.selecting.multiselect,e=b._findById(a);e&&e.select(!0,d,b.state.value,c.expandingProperty)},u.prototype._selectCell=function(a,b,c){var d=this;if(!d.canSelect(a))return!1;var e=d.selectedCell,f=d.canEdit(a);d._showSelected(a,!0,f,c),d.selectedCell=a,e?d._showSelected(e,!1,!0,c):d._gridParentFocus().tabIndex=-1;var g=d.renderOptions;return g.selecting&&g.selecting.row&&!g.selecting.multiselect&&d._selectRow(a.row),!0},u.prototype._selectFirstCell=function(a){var b=this,c=b.fieldOptions;if(!c.selecting||!c.selecting.cell)return!1;var e=d.find(b.$element.get(0),b.id+"_rows");if(!e.childNodes.length)return!1;for(var f=null,g=b.frozenColumns.concat(b.columns),h=0,i=g.length;h<i;h++){var j=g[h];c.allowFrozenColumns&&j.options.frozen&&(e=d.find(b.$element.get(0),b.id+"_frozen_rows"));var k=e.firstChild,l=b._tr2rowId(k,j);if(f={col:j.$bind,row:l},b.canSelect(f))break;f=null}return!!f&&b._selectCell(f,null,!1)},u.prototype._cell=function(a,b){var c=this,e=c._mapCols[a.col],f=e.index,g=c._findTR(a.row,e.column);if(!g)return null;var h=g.childNodes[f],i={td:h,tr:g,rIndex:-1,cIndex:-1};return b&&(i.rIndex=d.indexOf(g.parentNode,g),i.cIndex=f),i},u.prototype._moveUpSelectedCell=function(a){var b=this;if(!b.selectedCell)return b._selectFirstCell("keydown");var c=b._colByField(b.selectedCell.col),d=b._cell(b.selectedCell,!0);if(!d)return b.selectedCell=null,b._selectFirstCell("keydown");var e=Math.max(d.rIndex-a,0);if(e!=d.rIndex){var f=b._findtBody(c),g=f.childNodes[e];return b._selectCell({row:b._id2rowId(g.id),col:b.selectedCell.col},null,!1)}return!1},u.prototype.resize=function(){var a=this;a._resize()},u.prototype._updateFrozenColumnsHeight=function(){var a=this,b=a.renderOptions;if(a._scrollableFrozenContent){if(!b.height||"auto"===b.height)return;var c=a._scrollableMaster.scrollWidth>a._scrollableMaster.clientWidth,e=void 0;e=c?d.scrollbar()+"px":"0px",a._deltaHScrollContent.style.height!==e&&(a._deltaHScrollContent.style.height=e,a._vscroll())}},u.prototype._resize=function(){var a=this,b=a.renderOptions,c=b.scrolling&&b.scrolling.vertical;if(c){var e=i.hasFrozenColumns(b,a.frozenColumns);if(e){var f=d.scrollbar();f&&a._updateFrozenColumnsHeight(),a._vscroll()}}},u.prototype.syncHeaderAndFrozenScroll=function(a){var b=this;b._scroller&&"master"!==b._scroller||(b._scroller="master",b._hscroll(),b._vscroll(),b._removeScroller())},u.prototype.syncMasterScroll=function(a){var b=this;b._scroller&&"frozen"!==b._scroller||(b._scroller="frozen",b._vsmcroll(),b._removeScroller())},u.prototype._removeScroller=function(){var a=this;return a.fieldOptions.editing?(a._rsTimer&&window.clearTimeout(a._rsTimer),void(a._rsTimer=window.setTimeout(function(){a._scroller=null,a._rsTimer=null},50))):void(a._scroller=null)},u.prototype._vscroll=function(){var a=this;if(a._scrollableFrozenContent){var b=a._scrollableMaster.scrollTop,c=a._scrollableFrozenContent.scrollTop;b!==c&&(a._scrollableFrozenContent.scrollTop=b)}},u.prototype._vsmcroll=function(){var a=this,b=a._scrollableMaster.scrollTop,c=a._scrollableFrozenContent.scrollTop;b!==c&&(a._scrollableMaster.scrollTop=c)},u.prototype._hscroll=function(){var a=this,b=a._scrollableMaster.scrollLeft,c=a._scrollableHeaderOfMaster.scrollLeft;if(b!==c&&(a._scrollableHeaderOfMaster.scrollLeft=b),a._scrollableFooterOfMaster){var d=a._scrollableFooterOfMaster.scrollLeft;b!==d&&(a._scrollableFooterOfMaster.scrollLeft=b)}},u.prototype._moveDownSelectedCell=function(a){var b=this;if(!b.selectedCell)return b._selectFirstCell("keydown");var c=b._cell(b.selectedCell,!0);if(!c)return b.selectedCell=null,b._selectFirstCell("keydown");var d=b._colByField(b.selectedCell.col),e=b._findtBody(d),f=Math.min(c.rIndex+a,e.childNodes.length-1);if(f!=c.rIndex){var g=e.childNodes[f];return b._selectCell({row:b._id2rowId(g.id),col:b.selectedCell.col},null,!1)}return!1},u.prototype._moveRightSelectedCell=function(){var a=this;if(!a.fieldOptions.selecting||!a.fieldOptions.selecting.cell)return!1;if(!a.selectedCell)return a._selectFirstCell("keydown");var b=a.frozenColumns.concat(a.columns).map(function(a){return a.$bind}),c=b.indexOf(a.selectedCell.col),d=a._findById(a.selectedCell.row);if(!d||c<0)return!1;for(var e=c+1,f=b.length;e<f;e++){var g=b[e],h={col:g,row:d.$id};if(a.canSelect(h))return a._selectCell(h,null,!1)}if(d=a._findNext(d.$id))for(var e=0,f=c;e<=f;e++){var g=b[e],h={col:g,row:d.$id};if(a.canSelect(h))return a._selectCell(h,null,!1)}return!1},u.prototype._moveLeftSelectedCell=function(){var a=this;if(!a.fieldOptions.selecting||!a.fieldOptions.selecting.cell)return!1;if(!a.selectedCell)return a._selectFirstCell("keydown");var b=a.frozenColumns.concat(a.columns).map(function(a){return a.$bind}),c=b.indexOf(a.selectedCell.col),d=a._findById(a.selectedCell.row);if(!d||c<0)return!1;for(var e=c-1;e>=0;e--){var f=b[e],g={col:f,row:d.$id};if(a.canSelect(g))return a._selectCell(g,null,!1)}if(d=a._findPrev(d.$id))for(var e=b.length-1;e>=c;e--){var f=b[e],g={col:f,row:d.$id};if(a.canSelect(g))return a._selectCell(g,null,!1)}return!1},u.prototype._state2UI=function(a){var b=this,c=b._rootElement(),e=b.$element?b.$element.get(0):null;if(c){if(b._setDisabled(c,e),b.setHidden(e),b._setErrors(c,e),a||b._selectFirstCell("model"),b._toolBar){var f=$(d.find(e,b.id+"_header"));b._toolBar.render(f)}if(b._pager){var g=$(d.find(e,b.id+"_pagination"));b._pager.render(g)}}},u.prototype.afterAddedInDom=function(){this._selectFirstCell("model")},u.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._rootElement(),f=c.$element?c.$element.get(0):null;a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),a&&"isDisabled"!==a||d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),a&&"errors"!==a||j.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(e,f))},u.prototype.stopProppagation=function(a){for(var b=this,c=a.target,d=b.$element.get(0);c;){if(c==d)return;c.href&&(a.preventDefault(),a.stopPropagation()),c=c.parentNode}},u.prototype._buildView=function(a,b,c,d,e){var f=this,g={level:c,value:a};d=d||f._view,e=e||f._viewMap,d.push(g),e[a.$id]=g},u.prototype._findById=function(a){var b=this;if(b._useView){var c=b._viewMap[a];return c?c.value:null}return b.state.value.findById(a)},u.prototype._findByIdEx=function(a){var b=this,c={index:-1,level:0,value:null};if(b._useView){var d=b._viewMap[a];d&&(c.index=b._view.indexOf(d),c.level=d.level,c.value=d.value)}else c.value=b.state.value.findById(a),c.value&&(c.index=b.state.value.indexOf(c.value));return c},u.prototype._findNext=function(a){var b=this;if(b._useView){var c=b._viewMap[a];if(c){var d=b._view.indexOf(c);if(b._view.length>d+1)return b._view[d+1].value}}else{var c=b.state.value.findById(a);if(c){var d=b.state.value.indexOf(c);if(b.state.value.length()>d+1)return b.state.value.get(d+1)}}return null},u.prototype._findPrev=function(a){var b=this;if(b._useView){var c=b._viewMap[a];if(c){var d=b._view.indexOf(c);if(d>0)return b._view[d-1].value}}else{var c=b.state.value.findById(a);if(c){var d=b.state.value.indexOf(c);if(d>0)return b.state.value.get(d-1)}}return null},u.prototype._renderTotalRows=function(){var a=this;if(a.$element){var b=a.renderOptions;if(a._totalProperty){var c=a.form.getValue(a._totalProperty),e=void 0,f=void 0;i.hasFrozenColumns(a.renderOptions,a.frozenColumns)&&(e=d.find(a.$element.get(0),a.id+"_frozen_totals"),e&&(f=i.createRows(a.id,c,a.frozenColumns,b,a.options.design,a.form.$locale,!0,!0,null),d.empty(e),d.append(e,f))),e=d.find(a.$element.get(0),a.id+"_totals"),f=i.createRows(a.id,c,a.columns,b,a.options.design,a.form.$locale,!1,!0,null),d.empty(e),d.append(e,f)}}},u.prototype._renderRows=function(a,b,c){var e=this;if(e.$element){var f=e.renderOptions,g=null;a&&(e._view=[],e._viewMap={},e._useView=!0,g=e._buildView.bind(e));var h=void 0,j=void 0;if(e._inplaceEditRemove(!1,!1),e._destroyDetails(),i.hasFrozenColumns(e.renderOptions,e.frozenColumns)&&(h=d.find(e.$element.get(0),e.id+"_frozen_rows")))if(a)j=i.createRows(e.id,e.state.value,e.frozenColumns,f,e.options.design,e.form.$locale,!0,!1,g),g=null,d.empty(h),d.append(h,j);else{j=i.createBulkRows(e.id,c,e.frozenColumns,f,e.options.design,e.form.$locale,!0,!1,g);var k=d.find(h,b+"_frozen");d.after(k,j)}if(h=d.find(e.$element.get(0),e.id+"_rows"),a)j=i.createRows(e.id,e.state.value,e.columns,f,e.options.design,e.form.$locale,!1,!1,g),d.empty(h),d.append(h,j);else{j=i.createBulkRows(e.id,c,e.columns,f,e.options.design,e.form.$locale,!1,!1,g);var k=d.find(h,b);d.after(k,j)}}if(!a){var l=e._viewMap[b],m=e._view.indexOf(l);e._view.splice(m,0,c),c.forEach(function(a){e._viewMap[a.value.$id]=a})}},u.prototype.editDetail=function(a){
//not compatible with rozenColumns
var b=this,c=a.$id;if(b.$element){var f=b.renderOptions,g=i.hasFrozenColumns(f,b.frozenColumns);if(g)return;var h=d.find(b.$element.get(0),b.id+"_rows"),j=d.find(h,c+"_detail");if(j)return;var k=d.find(h,c);if(k){j=i.createDetail(c,k);
// prepare layout
var m=b.renderOptions.rows;if(!m||!m.detail||!m.detail.layout)throw new Error('Grid options missing: "options.rows.detail.layout".');var n=m.detail.layout;"string"==typeof n&&b.renderOptions.layouts&&b.renderOptions.layouts[n]&&(n=b.renderOptions.layouts[n]),"object"==typeof n&&(n=$.extend(!0,{},n),n.name&&(n._name=n.name),n.name=c);
// prepare schema
var o=a.getSchema();"object"==typeof o&&(o.links=o.links||{},o.links.$updateChanges=o.links.$updateChanges||{title:l.ui.ApplyDetailChanges});var p={};m.detail.spacing&&(p.verticalSpacing=!0),p.closeButtonHandler=function(){b.closeDetail(c)},n._name&&(p.externalLayout=n._name,p.externalSchema=b.form.options.externalSchema,p.externalLocale=b.form.options.externalLocale),p.path=b.$bind,b._details.push(c),e.OpenForm($(j.firstChild),n,b.form.$schema,a.model(),b.form.$locale,function(d,e,f){switch(d.property){case"$links.$updateChanges":if(!b.state.value.updateItem(a,e))return;a.update(e.model()),b.closeDetail(c)}},p),d.after(k,j)}}},u.prototype.closeDetail=function(a){
//not compatible with rozenColumns
var b=this;if(b._destroyDetailById(a),b.$element){var c=d.find(b.$element.get(0),a+"_detail");c&&d.remove(c)}},u.prototype._removeRow=function(a){var b=this;if(b._destroyDetailById(a),b._viewMap){var c=b._viewMap[a];if(c){delete b._viewMap[a];var e=b._view.indexOf(c);e>=0&&b._view.splice(e,1)}}if(b.$element){var f=[],g=d.find(b.$element.get(0),a);g&&f.push({element:g,columns:b.columns}),i.hasFrozenColumns(b.renderOptions,b.frozenColumns)&&(g=d.find(b.$element.get(0),a+"_frozen"),g&&f.push({element:g,columns:b.frozenColumns})),f.forEach(function(c){var e=c.element.parentNode,f=d.find(e,a+"_detail");if(f&&d.remove(f),e.firstChild===c.element&&b.renderOptions.headerIsHidden&&!b.renderOptions._useColGrp&&e.childNodes.length>1){
//no header &&  not useColGrp ==> update cols width on first row
var g=e.childNodes[1];c.columns.forEach(function(a,b){var c=g.childNodes[b];a.options.width&&(c.style.width=i.ensureWidth(a.options.width)),a.options.minWidth&&(c.style.minWidth=i.ensureWidth(a.options.minWidth))})}d.remove(c.element)})}},u.prototype._updOddEven=function(){var a=this;if(!a.renderOptions._useStripedCss&&a.renderOptions.striped&&a.$element){var b=d.find(a.$element.get(0),a.id+"_rows");i.updateEvenOdd(b),b=d.find(a.$element.get(0),a.id+"_frozen_rows"),b&&i.updateEvenOdd(b)}},u.prototype._createRow=function(a){var b=this;if(b.$element){var c=0,e=b._viewMap[a.$id];e?e=b._viewMap[a.$id]:(
//TODO find level when expandingProperty is not null
e={level:0,value:a},b._view.push(e),b._view.push(a.$id),c=b._view.length-1,b._viewMap[a.$id]=e);var f=void 0,g=void 0,h=i.hasFrozenColumns(b.renderOptions,b.frozenColumns);h&&(f=d.find(b.$element.get(0),b.id+"_frozen_rows"),g=i.createRow(b.id,c,e.level,e.value,b.frozenColumns,b.renderOptions,b.options.design,b.form.$locale,f.childNodes.length%2===1,!0,!1),d.append(f,g)),f=d.find(b.$element.get(0),b.id+"_rows"),g=i.createRow(b.id,c,e.level,e.value,b.columns,b.renderOptions,b.options.design,b.form.$locale,f.childNodes.length%2===1,!1,!1),d.append(f,g)}},u.prototype.filtrableColumns=function(){var a=this,b=a.$schema,c=a.$schemaItems;return b&&"array"===b.type&&c&&"object"===c.type?o.filtrableFields(c,a.form.$rootSchema,a.form.$locale):[]},u.prototype._getColumnsFromSchema=function(){var a=this,b=a.$schema,c=a.$schemaItems;return b&&"array"===b.type&&c&&"object"===c.type?o.columns(c,a.form.$rootSchema,a.form.$locale):[]},u.prototype._getSelectedColumns=function(){var a=this,b={};return Object.keys(a._mapCols).forEach(function(c){var d=a._mapCols[c].column;d.options._expandItem&&d.options.display&&(c=d.options.display),b[c]=!0}),b},u.prototype._getGroupsFromSchema=function(){var a=this,b=a.$schema,c=a.$schemaItems;return b&&"array"===b.type&&c&&"object"===c.type&&c.groups?c.groups:{}},u.prototype.getColumnsForSettings=function(){var a=this;return{schemaGroups:a._getGroupsFromSchema(),schemaColumns:a._getColumnsFromSchema(),selectedColumns:a._getSelectedColumns(),locale:a.form.$locale}},u.prototype.getColumnsForFilter=function(){var a=this;return{schemaGroups:a._getGroupsFromSchema(),schemaColumns:a.filtrableColumns(),locale:a.form.$locale}},u.prototype.getColumnsForFilterExpress=function(a){var b,c=this;if(a&&Array.isArray(a)){var d=c._getColumnsFromSchema();b=[],a.forEach(function(a){d.every(function(c){return a!==c.name||(b.push(c),!1)})})}else b=c._getColumnsFromSchema();var e=[];return b.forEach(function(a){var b=a.schema,c={code:a.name,lib:b.title||b.name,type:b.type,selected:!0};b.enum&&(c.enum=b.enum),b.enumNames&&(c.enumNames=b.enumNames),e.push(c)}),e},u.prototype._updateSorting=function(){var a=this,b=a.renderOptions;if(b&&b.sorting&&!b.headerIsHidden){var c=d.find(a.$element.get(0),a.id+"_cols");c&&i.updSorting(b,c,a._colByField,a.state.value.$orderby()),c=d.find(a.$element.get(0),a.id+"_frozen_cols"),c&&i.updSorting(b,c,a._colByField,a.state.value.$orderby())}},u.prototype._renderColumns=function(a){var b=this;if(b._inplaceEditRemove(!1,!1),a._useColGrp){
// create free columns
var c=a.scrolling&&a.scrolling.vertical,e=c&&!a.headerIsHidden?d.find(b.$element.get(0),b.id+"_colgrp_header"):null;
// create frozen columns
if(e&&(d.empty(e),d.append(e,i.createColGroup(b.columns,a,!1))),e=d.find(b.$element.get(0),b.id+"_colgrp"),d.empty(e),d.append(e,i.createColGroup(b.columns,a,!1)),
// add total
a.total&&a.total.property&&(e=d.find(b.$element.get(0),b.id+"_colgrp_footer"),e&&(d.empty(e),d.append(e,i.createColGroup(b.columns,a,!0)))),i.hasFrozenColumns(a,b.frozenColumns)){var f=c&&!a.headerIsHidden?d.find(b.$element.get(0),b.id+"_colgrp_frozen_header"):null;f&&(d.empty(f),d.append(f,i.createColGroup(b.frozenColumns,a,!0))),f=d.find(b.$element.get(0),b.id+"_colgrp_frozen"),f&&(d.empty(f),d.append(f,i.createColGroup(b.frozenColumns,a,!0))),
// add total
a.total&&a.total.property&&(f=d.find(b.$element.get(0),b.id+"_colgrp_frozen_footer"),f&&(d.empty(f),d.append(f,i.createColGroup(b.frozenColumns,a,!0))))}}if(!a.headerIsHidden){var g=d.find(b.$element.get(0),b.id+"_cols");d.empty(g),d.append(g,i.createCols(b.id,b.columns,a,b.options.design,b.form.$locale,b.state.value.$orderby(),!1)),i.hasFrozenColumns(a,b.frozenColumns)&&(g=d.find(b.$element.get(0),b.id+"_frozen_cols"),g&&(d.empty(g),d.append(g,i.createCols(b.id,b.frozenColumns,a,b.options.design,b.form.$locale,b.state.value.$orderby(),!0))))}a.allowFrozenColumns&&i.updateFrozenWidth(b.$element.get(0),b.id,b.frozenColumns)},u.prototype.toggleMultiselect=function(){var a=this;if(a.$element){var b=a.renderOptions;b.selecting&&b.selecting.row&&(b.selecting.multiselect=!b.selecting.multiselect,a.state.value.updateSelecting(b.selecting.multiselect,b.expandingProperty),a.savePreferences(function(){a._refreshGrid()}))}},u.prototype.render=function(a){var b=this,c=b._initOptions(g.utils.defaultOptions);return b.$element||(b.$schema.description&&(c.description=f.tt(b.$schema.description,b.form.$locale)),b.$element=$(i.gridContainer(b.id,c,b.options.design,b.$schema.title,b.form.$locale,b.columns,b.frozenColumns)),b._renderColumns(c),b._renderRows(!0,"",null),b._renderTotalRows(),b._state2UI(!0),b.setEvents(c)),b.appendElement(a,c),b.$element},u}(b.AbsField);b.BasicGrid=t,e.registerControl(t,"array",!1,"",null),e.registerControl(t,"array",!1,"basicgrid",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=a.ui,e=a.dom,f=a.ulocale,g=a.uiutils;!function(b){function h(b,d,e,f){var h=a.bootstrap4;f=f||"",d=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},d);var i=[];return g.utils.fieldWrapper(i,d,e,function(){d.columns&&(i.push('<div class="no-x-padding '+(h?"offset-sm-":"col-sm-offset-")+d.labelCol+" col-sm-"+(12-d.labelCol)+'">'),i.push('<div class="checkbox">'));var a=!1;d.inline||d.columns||(a=!0,i.push('<div class="checkbox">')),i.push('<label id="{0}_check" class="'+(d.inline?h?"form-check-inline no-x-padding":"checkbox-inline":a?h?"form-control-label":"control-label":"checkbox")+'">'),i.push('<input type="checkbox" id="{0}_input">'),d.inline?h&&i.push("&nbsp;"):i.push("&nbsp;"),i.push(c.escapeHtml(f||"")),i.push("</label>"),d.inline||d.columns||i.push("</div>"),d.columns&&(i.push("</div>"),i.push("</div>"))}),c.format(i.join(""),b)}var i=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._input=function(){var a=this,b=a.$element.get(0);return e.find(b,a.id+"_input")},b.prototype._check=function(){var a=this,b=a.$element.get(0);return e.find(b,a.id+"_check")},b.prototype.click=function(a){var b=this,c=b._input(),d=c.checked||!1;a.target==c&&b.state.value!=d&&(b.state.value=d,b.form.setValue(b.$bind,d))},b.prototype._setDisabled=function(a,b){var c=this,d=c._check();c.state.isDisabled||c.state.isReadOnly?e.addClass(d,"disabled"):e.removeClass(d,"disabled"),a.disabled=c.state.isDisabled},b.prototype._setReadOnly=function(a,b){this._setDisabled(a,b)},b.prototype._setMandatory=function(a,b){},b.prototype._state2UI=function(){var a=this,b=a._input(),c=a.$element?a.$element.get(0):null;b&&(b.checked=a.state.value||!1,a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c))},b.prototype.changed=function(a,b,c,d){var e=this,f=e._input();e.state.value!=c&&(e.state.value=c,f.checked=e.state.value||!1)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._input(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},b.prototype.render=function(a){var b=this,c=b._initOptions(g.utils.defaultOptions);return b.$element||(b.$element=$(h(b.id,c,b.options.design,f.tt(b.$schema.title,b.form.$locale))),b._state2UI()),b.appendElement(a,c),b.$element},b}(a.ui.AbsField);b.Check=i,d.registerControl(i,"boolean",!1,"",null)}(b=a.formcheck||(a.formcheck={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../errors.data.ts" />
/// <reference path="./basicgrid.ts" />
/// <reference path="../modalform.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,b),d=a.dom,e=(a.ulocale,a.uiutils),f=a.Observable.errorsUtils,g=c.GridUtil,h=a.Observable.SchemaUtils,i=function(a){function b(b,c,d){a.call(this,b,c,d);var e=this,f=e.fieldOptions;e._initAllColumns(),d.registerListenerFor(e.$bind+".$item",e),e._state();var g=f.columns.header.fields||[];f.columns.header.fields=e.form.afterSettings(e.$bind,"columngrid",{columns:g}).columns;var h=e.form.getFieldSettings(e.$bind);h&&(e._settings=e.form.afterSettings(e.$bind,"columngrid",h)),e._initRows()}
// Create columns
return __extends(b,a),b.prototype.destroy=function(){var a=this;a.form.unRegisterListenerFor(a.$bind+".$item",a)},b.prototype._initSchemaRows=function(a){var b=this;b.rows=[],a.forEach(function(a,c){b.rows[c]={name:a.name,canEdit:a.canEdit,check:a.check,schema:h.getSchema(a.name,b.$schemaItems,b.form.$rootSchema,!1)||{}}})},b.prototype._colByName=function(a){for(var b=this,c=0,d=b.rows.length;c<d;c++){var e=b.rows[c];if(e.name===a)return e}return null},b.prototype.setSettings=function(a){var b=this;b._rrender()},b.prototype._initRows=function(){var a=this;if(!a.rows){var b=a.fieldOptions;b.columns||(b.columns={}),b.columns.header||(b.columns.header={}),b.columns.row||(b.columns.row={});var c=b.columns.header.fields||[];a._settings&&a._settings.columns&&a._settings.columns.length&&(c=a._settings.columns),a._initSchemaRows(c)}},b.prototype._initCols=function(a){var b=this;a.columns||(a.columns={}),a.columns.header||(a.columns.header={}),a.columns.row||(a.columns.row={});var c=$.extend({},a.columns.header),d=a.columns.row;c.options=c.options||{},d.options=d.options||{};var f,g=d.$bind;d.$bind?f=h.getSchema(d.$bind,b.$schemaItems,b.form.$rootSchema,!1):(g="$index",f={type:"integer"});var i=[];return i.push(c),b.state.value&&b.state.value.forEach(function(a){var c=e.utils.displayValue(a.getRelativeValue(g),f,b.form.$locale,{html:!1},a,g).value,h=$.extend({},d);h.title=c||"",h.id=a.$id,i.push(h)}),i},b.prototype._modifyRow=function(a,b,c,f,g,h,i){var j=this,k=d.find(j.$element.get(0),j.id+"_rows"),l=k.childNodes[c],m=l.childNodes[f],n=e.utils.displayValue(a,b,j.form.$locale,{html:!0,useSymbol:!1,editable:g.editable,check:g.check,tableOptions:j.config.options},h,i);if(d.empty(m),n.html){var o=$(n.value);d.append(m,o.get(0))}else d.append(m,document.createTextNode(n.value))},b.prototype.changed=function(a,b,c,d,e){var f=this;if("upd"===d){var g=e&&e.$id?f.state.value.findById(e.$id):null;g&&f.rows.forEach(function(a,b){a.name===e.property&&f._modifyRow(g.getValue(a.name),a.schema,b,f.state.value.indexOf(g)+1,{editable:a.canEdit,check:a.check},g,a.name)})}},b.prototype._grid=function(){return this.$element.get(0)},b.prototype._setErrors=function(a,b){var c=this,d=c.state.errors;c.showErrors(b,d)},b.prototype.click=function(a){var b=this,c=d.parentByTag(b.$element.get(0),a.target,"td");if(c){var e=d.attr(c,"colId");if(e){var f=b._colByName(e);if(f&&f.canEdit&&h.isBoolean(f.schema)&&d.attr(a.target,"data-clickable")){var g=d.attr(c,"rowId"),i=g?b.state.value.findById(g):null;if(i){var j=i.getValue(f.name);i.setValue(f.name,!j)}}}}},b.prototype._setDisabled=function(a,b){},b.prototype._state2UI=function(){var a=this,b=a._grid(),c=a.$element?a.$element.get(0):null;b&&(a._setDisabled(b,c),a.setHidden(c),a._setErrors(b,c))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._grid(),g=c.$element?c.$element.get(0):null;a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(g)),a&&"isDisabled"!==a||d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,g)),a&&"errors"!==a||f.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(e,g))},b.prototype._renderRows=function(){var a=this;if(a.$element){var b=d.find(a.$element.get(0),a.id+"_rows");d.empty(b),d.append(b,g.createGridRows(a.id,a.rows,a.state.value,a.columns,a.renderOptions,a.options.design,a.form.$locale))}},b.prototype._draw=function(a){var b=this;if(b.columns=b._initCols(b.fieldOptions),a._useColGrp){var c=d.find(b.$element.get(0),b.id+"_colgrp");d.empty(c),d.append(c,g.createColGroup(b.columns,a,!1))}if(!a.headerIsHidden){var e=d.find(b.$element.get(0),b.id+"_cols");d.empty(e),d.append(e,g.createCols(b.id,b.columns,a,b.options.design,b.form.$locale,"",!1))}b._renderRows(),b._state2UI()},b.prototype._rrender=function(){var a=this;a.$element&&a._draw(a.renderOptions)},b.prototype.render=function(a){var b=this,c=b._initOptions(e.utils.defaultOptions);if(!b.$element)return b.columns=b._initCols(b.fieldOptions),b.$element=$(g.gridContainer(b.id,c,b.options.design,b.$schema.title,b.form.$locale,b.columns,null)),b._draw(c),b.appendElement(a,c),b.$element},b.prototype._createRow=function(a){var b=this;if(b.$element){var c=d.find(b.$element.get(0),b.id+"_rows"),e=g.createRow(b.id,a,0,b.state.value.get(a),b.columns,b.renderOptions,b.options.design,b.form.$locale,a%2===1,!1,!1);c.childNodes.length>=a?d.append(c,e):d.before(c.childNodes[a],e)}},b.prototype._initAllColumns=function(){var a=this,b=a.fieldOptions;a._allColumns=[],a._allColumnsNames=[],b.columns||(b.columns={}),b.columns.header||(b.columns.header={});var c=b.columns.header.allFields;c.forEach(function(b){a._allColumns.push($.extend({},b)),a._allColumnsNames.push(b.name)})},b.prototype._selectedColumns=function(){var a=this,b=[],c=[];return a.rows.forEach(function(a){b.push(a.name)}),a._allColumns.forEach(function(d){var e=h.getSchema(d.name,a.$schemaItems,a.form.$rootSchema,!1);b.indexOf(d.name)>=0&&c.push({name:d.name,title:e.title})}),c},b.prototype._initDataSettings=function(){var a=this,b={$type:"block",$items:[{$type:"block",$items:[]},{$type:"block",$items:[{$bind:"columns",$widget:"basicgrid",options:{border:!0,align:"middle",small:!0,noRowSelectedIndicator:!0,headerIsHidden:!0,selecting:{row:!0,multiselect:!0},columns:[{$bind:"caption",options:{width:"100%"}}]}}]},{$type:"block",$items:[]}]},c={properties:{columns:{type:"array",items:{type:"object",properties:{name:{type:"string"},caption:{type:"string"}}}}}},d={columns:[]},e=[];return a.rows.forEach(function(a){e.push(a.name)}),a._allColumns.forEach(function(b){var c=h.getSchema(b.name,a.$schemaItems,a.form.$rootSchema,!1);d.columns.push({name:b.name,caption:c.title,$select:e.indexOf(b.name)>=0})}),{schema:c,data:d,layout:b}},b.prototype.sendMessage=function(a,b){var c=this;switch(a){case"column-list":c.openColumns(b);break;case"selected-cols":return c._selectedColumns()}},b.prototype.stopProppagation=function(a){a.preventDefault(),a.stopPropagation()},b.prototype.openColumns=function(a){var b=this,d=b._initDataSettings(),e={title:a.title||"Columns ...",buttons:[{type:"success",title:a.okTitle||"OK",name:"ok"}]};c.OpenModalForm(e,d.layout,d.schema,d.data,{},function(a,c,d,e){if("modal-action"===c.operation)switch(c.property){case"ok":var f={columns:[]};d.columns.forEach(function(a){if(a.$select){var c=b._allColumnsNames.indexOf(a.name);c>=0&&f.columns.push($.extend({},b._allColumns[c]))}}),b._settings=f,b.form.setFieldSettings(b.$bind,b._settings),b.form.savePrefs(function(){b._settings=b.form.afterSettings(b.$bind,"columngrid",f),b.rows=null,b._initRows(),a.close(),b._rrender()})}})},b}(b.AbsField);b.ColumnGrid=i,c.registerControl(i,"array",!1,"columngrid",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="../../page.control.ts" />
/// <reference path="../schema.data.ts" />
var Phoenix;!function(a){var b,c=a,d=c.pagecontrol,e=(c.ui,c.Observable.SchemaUtils),f=c.utils,g=c.dom;c.locale,c.ulocale,c.device;!function(a){var b=function(){function a(a,b,c){this.opened=!1;var f=this;f.page=d.Page(),f.opened=!1,f.currentList=null,f.$parent=a,f._checkOptions(c),f.options=c,f.$input=b,f.keys=e.pkFields(f.options.primaryKey)}return a.prototype.click=function(a){var b=this,d=c.bootstrap4,e=g.parentByTag(b.$element.get(0),a.target,d?"a":"li");if(e){var f=e.pk;if(f){var h=b._map(),i=b._selectByPk(f,h);i&&b._doSelect(i,!0)}}},a.prototype.inMenu=function(a){var b=this;return!(!a||!b.$element)&&g.isChildOf(b.$element.get(0),a)},a._itemHeight=function(){var a=this;if(!a.itemHeight){var b=c.bootstrap4,d=void 0;d=b?$('<div class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><a tabindex="-1" class="dropdown-item" href="#">A</a></div>').get(0):$('<ul class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><li tabindex="-1"><a tabindex="-1" href="#">A</a></li></ul>').get(0),document.body.appendChild(d);var e=d.firstChild;a.itemHeight=e.offsetHeight,a.deltaHeight=d.offsetHeight-a.itemHeight,document.body.removeChild(d)}return this.itemHeight},a.prototype._checkOptions=function(a){if(!a.primaryKey)throw new Error("Invalid options no primaryKey.");if(!a.search)throw new Error("Invalid options search field.");a.display=a.display||a.search,a.maxItems=a.maxItems||8},a.prototype._renderContent=function(){var a=this,b=c.bootstrap4;a.$element||(a.$element=b?$('<div class="dropdown-menu"></div>'):$('<ul class="dropdown-menu"></ul>'),a.$parent.get(0).appendChild(a.$element.get(0)))},a.prototype._renderElements=function(){var a=this,b=c.bootstrap4;if(a.$element||a._renderContent(),a.currentList){var d=document.createDocumentFragment(),h=a.$element.get(0);a.currentList.forEach(function(c){var h,i=e.pk2Id(e.extractPkValue(c,a.keys),a.keys);h=b?$('<a tabindex="-1" class="dropdown-item" href="#">'+f.escapeHtml(c[a.options.display])+"</a>").get(0):$('<li class="dropdown-item" tabindex="-1"><a tabindex="-1" href="#">'+f.escapeHtml(c[a.options.display])+"</a></li>").get(0),h.pk=i,g.append(d,h)}),g.empty(h),g.append(h,d)}},a.prototype._afterHide=function(a){var b=this;b.opened=!1,b.page&&b.page.setPopup(null),b.$input&&b.$input.get(0).focus()},a.prototype.hide=function(a){var b=this;if(b.opened&&b.$element){var c=b.$element.get(0);g.removeClass(c,"bs-block"),b.opened=!1,b.page&&b.page.setPopup(null)}},a.prototype._selectByListIndex=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e.listIndex===b)return e}return null},a.prototype._emptyHtmlList=function(){var a=this;a.$element&&g.empty(a.$element.get(0))},a.prototype._show=function(b){var c=this;if(c.$element){var d=c.$element.get(0);if(d.childNodes.length){var e=-1,f=c._map(),h=c._findSeleted(f);h&&(e=h.listIndex);var i=c.$parent.get(0).offsetWidth;if(d.style.minWidth=i+"px",d.style.maxHeight=c.options.maxItems*a._itemHeight()+a.deltaHeight+"px",d.style.overflowY="auto",g.addClass(d,"bs-block"),e!=b){if(h){var j=d.childNodes[h.index];g.removeClass(j,"active"),h.selected=!1}if(b>=0){h=c._selectByListIndex(f,b);var k=d.childNodes[h.index];g.addClass(k,"active"),h.selected=!0,c._isInView(k,d)||k.scrollIntoView(!0)}else d.scrollTop=0}c.page&&c.page.popup!=c&&c.page.setPopup(c),g.addClass(d,"bs-block"),c.opened=!0}else g.removeClass(d,"bs-block"),c._afterHide(!0)}},a.prototype.triggerBlurred=function(a){var b=this;b.hide(null)},a.prototype.show=function(a,b,c){var d=this;return a&&a.value&&a.value.length?void(d.currentList==a.value?d._show(b):(d.currentList=a.value,d._renderElements(),d._show(b))):(d.currentList=null,d.hide(null),void d._emptyHtmlList())},a.prototype._map=function(){for(var a=this,b=[],c=!1,d=a.$element.get(0),e=0,f=0,h=d.childNodes.length;f<h;f++){var i=d.childNodes[f];if(i.pk){var j=!c&&g.hasClass(i,"active");j&&(c=!0),b.push({id:i.pk,index:f,selected:j,listIndex:e}),e++}}return b},a.prototype._selectByPk=function(a,b){var c=this,d=null,e=c.$element.get(0);b=b||c._map();for(var f=0,h=b.length;f<h;f++){var i=b[f];if(i.id===a){if(d=i,i.selected)break;g.addClass(e.childNodes[i.index],"active"),i.selected=!0}else if(i.selected&&(g.removeClass(e.childNodes[i.index],"active"),i.selected=!1,d))break}return d},a.prototype._findSeleted=function(a){var b=this;a=a||b._map();for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e.selected)return e}return null},a.prototype._isInView=function(b,c){var d=this,e=b.offsetTop,f=b.offsetHeight,g=c.scrollTop,h=d.options.maxItems*a._itemHeight();return e>=g&&g+h>=e+f},a.prototype.move=function(b){var c=this;if(c.$element&&c.opened){var d=c._map(),e=c.$element.get(0),f=c._findSeleted(d),h=b>0,i=void 0;if(h){if(f){if(i=1e3===b?d.length-1:d.indexOf(f)+b,i>=d.length&&(i=d.length-1,d[i].selected))return}else i=0;if(i<d.length){f&&(g.removeClass(e.childNodes[f.index],"active"),f.selected=!1);var j=e.childNodes[d[i].index];g.addClass(j,"active"),d[i].selected=!0,i==d.length-1?e.scrollTop=j.offsetTop+a._itemHeight()+1:c._isInView(j,e)||j.scrollIntoView(!1),c._doSelect(d[i],!1)}}else{if(f){if(i=b===-1e3?0:d.indexOf(f)+b,i<0&&(i=0,d[i].selected))return}else i=d.length-1;if(i>=0){f&&(g.removeClass(e.childNodes[f.index],"active"),f.selected=!1);var j=e.childNodes[d[i].index];g.addClass(j,"active"),d[i].selected=!0,0==i?e.scrollTop=0:c._isInView(j,e)||j.scrollIntoView(!0),c._doSelect(d[i],!1)}}}},a.prototype.select=function(){var a=this;if(a.$element&&a.opened){var b=a._findSeleted();b&&a._doSelect(b,!0)}},a.prototype._doSelect=function(a,b){var c=this;b&&(c.options.onselect&&c.options.onselect(e.findByPk(e.id2Pk(a.id,c.keys),c.keys,c.currentList)),c.hide(null))},a.prototype.inPopup=function(a){var b=this;if(b.$element){var c=b.$element.get(0).parentNode;return g.isChildOf(c,a)}return!1},a.prototype.destroy=function(){var a=this;a.options=null,a.currentList=null,a.$input=null,a.$parent=null,a.$element=null},a.itemHeight=0,a.deltaHeight=0,a}();a.DropItems=b}(b=a.formdropitems||(a.formdropitems={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../errors.data.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=a.dom,e=a.locale,f=a.Observable.SchemaUtils,g=a.ulocale,h=a.ui,i=a.uiutils,j=a.Observable.errorsUtils;!function(b){var k=function(b,c,e,f){var g=a.bootstrap4;f=f||"input";var h="textarea"===f;if(h&&(c.before||c.after)&&(delete c.before,delete c.after),c.before||c.after){b.push('<div class="input-group"');var j=[];"money"!==c.$format&&"date"!==c.$format||void 0===c.maxWidth&&(c.maxWidth="16em"),c.minWidth&&j.push("min-width: "+c.minWidth+";"),c.maxWidth&&j.push("max-width: "+c.maxWidth+";"),j.length&&b.push('  style="'+j.join("")+'"'),b.push(">")}c.before&&(b.push('<span class="bs-grp-btn input-group-addon">'),c.before.icon?b.push('<span class="'+d.iconClass(c.before.icon)+'"></span>'):b.push(c.before.value),b.push("</span>"));var k=["form-control"];if(c.size&&g&&k.push(" form-control-"+c.size),c.inputClass&&k.push(c.inputClass),b.push("<"+f+' autocomplete="off" type="'+(c.type||"text")+'" class="'+k.join(" ")),b.push('" id="{0}_input"'),h&&b.push(' rows="'+c.rows||'3"'),!c.before&&!c.after){var j=[];c.maxWidth&&j.push("max-width: "+c.maxWidth+";"),c.minWidth&&j.push("min-width: "+c.minWidth+";"),j.length&&b.push('  style="'+j.join("")+'"')}if(c.maxLength&&b.push('  maxLength="'+c.maxLength+'"'),c.placeHolder){var l=c.placeHolder===!0?e:c.placeHolder;b.push('  placeholder="'+l+'"')}b.push(">"),c.after&&(b.push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-addon'),c.after.icon&&b.push(" bs-icon-input"),b.push('">'),c.after.icon?b.push('<span class="'+d.iconClass(c.after.icon)+'"></span>'):b.push(c.after.value),b.push("</span>")),(c.before||c.after)&&b.push("</div>"),h&&b.push("</"+f+">"),i.utils.addErrorDiv(b)},l=function(b,d,e,f,g){f=f||"",d=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},d);var h=[];return d.titleIsHidden&&(d.columns=!1),i.utils.fieldWrapper(h,d,e,function(){var b=a.bootstrap4;if(!d.titleIsHidden){h.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];d.columns&&(b?e.push("form-control-label"):e.push("checkbox-inline bs-cursor-d"),e.push("bs-lib-col col-sm-"+d.labelCol)),d.inline&&(b?e.push("form-check-inline bs-cursor-d no-x-padding"):e.push("checkbox-inline bs-cursor-d no-x-padding")),e.length&&h.push(' class="'+e.join(" ")+'"'),h.push(">"),h.push(c.escapeHtml(f||"")+(d.inline?"&nbsp;":"")),d.description&&i.utils.addTooltip(h,d.description,d),h.push("</label>")}d.columns&&h.push('<div class="no-x-padding col-sm-'+(12-d.labelCol)+'" id="{0}_colparent">'),k(h,d,f,g),d.columns&&h.push("</div>"),d.titleIsHidden&&d.description&&i.utils.addTooltip(h,d.description,d)}),c.format(h.join(""),b)},m=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._input=function(){var a=this,b=a.$element?a.$element.get(0):null;return b?d.find(b,a.id+"_input"):null},b.prototype._colParent=function(){var a=this,b=a.$element.get(0);return a.renderOptions.columns?d.find(b,a.id+"_colparent"):null},b.prototype._value2Text=function(){var a=this;a._input();return a._isDate()?i.utils.useDatePicker()?g.parseISODate(a.state.value||"")||"":i.utils.nativeDate()?a.state.value||"":g.shortDate(a.state.value||""):a.state.value||""},b.prototype._isPassword=function(){return f.isPassword(this.$schema)},b.prototype._isDate=function(){return f.isDate(this.$schema)},b.prototype._isMemo=function(){return f.isText(this.$schema)},b.prototype._isNumber=function(){return f.isNumber(this.$schema)},b.prototype._isMoney=function(){return f.isMoney(this.$schema)},b.prototype._setDisabled=function(a,b){a.disabled=this.state.isDisabled},b.prototype._setReadOnly=function(a,b){a.readOnly=this.state.isReadOnly},b.prototype._setErrors=function(a,b){var c=this,e=c.state.errors;e&&e.length?d.addClass(b,"has-error"):d.removeClass(b,"has-error"),c.showErrors(b,e)},b.prototype._setMandatory=function(a,b){var c=this,e=this.state.isMandatory;if(a.required=e,e?d.addClass(a,"bs-mandatory"):d.removeClass(a,"bs-mandatory"),c.renderOptions.placeHolder&&(a.placeholder=c.renderOptions.title+(e?" *":"")),!c.renderOptions.titleIsHidden){var f=d.find(b,c.id+"_label");f&&d.text(f,(c.renderOptions.title||"")+(e?" *":"")+(c.renderOptions.inline?String.fromCharCode(160):""))}},b.prototype._state2UI=function(){var a=this,b=a._input(),c=a.$element?a.$element.get(0):null;b&&(a._value2Input(b),a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c),a._setMandatory(b,c),a._setErrors(b,c),a._setSymbol(c))},b.prototype._setSymbol=function(a){var b=this;if(b._hasSymbol&&a){var c=d.find(a,b.id+"_after");c&&d.text(c,b.state.symbol)}},b.prototype._value2Input=function(a){var b=this;b._isDate()?i.utils.useDatePicker()?i.utils.datePickerSetValue(b.$element,b.state.value):i.utils.nativeDate()?a.value=g.isoDatePart(b.state.value||""):a.value=g.shortDate(b.state.value||""):b._isNumber()&&i.utils.nativeNumber()?a.value=b.state.value||0:a.value=b._value2Text()},b.prototype.changed=function(a,b,c,d){var e=this;if((!e.useDisplay||a!==e.$bind)&&e.$element){var f=e._input();if(c=e.form.getValue(e.$display),e.state.value!=c)e.state.value=c,e._value2Input(f);else{var g=f.value,h=e._value2Text();g!=h&&e._value2Input(f)}}},b.prototype.stateChanged=function(a,b){var c=this;if(!c.useDisplay||a!==c.$display){var d=c.form.getState(c.$bind),e=c._input(),f=c.$element?c.$element.get(0):null;a&&"symbol"!==a||d.symbol!==c.state.symbol&&(c.state.symbol=d.symbol,e&&c._setSymbol(f)),a&&"decimals"!==a||d.decimals!==c.state.decimals&&(c.state.decimals=d.decimals),a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),a&&"isDisabled"!==a||d.isDisabled!==c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),a&&"isReadOnly"!==a||d.isReadOnly!==c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),a&&"isMandatory"!==a||d.isMandatory!==c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f)),a&&"errors"!==a||j.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(e,f))}},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(a.ui.AbsField);b.BaseEdit=m;var n=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b.prototype.beforeAppend=function(){},b.prototype.mousedown=function(a){var b=this;if(b._doSelect=!1,b.$element&&!b.state.isDisabled){var c=window.document.activeElement;if(c!==a.target){var d=b._input();d===a.target&&(b._doSelect=!0)}return!0}},b.prototype.stopProppagation=function(a){var b=this;if(b._doSelect){var c=b._input();d.select(c)}},b.prototype.click=function(a){},b.prototype.internalRender=function(a){var b=this,c=b._initOptions(i.utils.defaultOptions);b.$element||(c.title=g.tt(b.$schema.title,b.form.$locale),c.placeHolder&&1!=c.placeHolder&&(c.title=g.tt(c.placeHolder,b.form.$locale)),c.maxLength=b.$schema.maxLength,b.$schema.description&&(c.description=g.tt(b.$schema.description,b.form.$locale)),b.$element=$(l(b.id,c,b.options.design,c.title,c.tagName)),b.beforeAppend(),b.setEvents(c),b._state2UI()),b.appendElement(a,c)},b.prototype.render=function(a){var b=this;b.internalRender(a)},b.prototype._text2value=function(a){var b=this;return i.utils.text2value(a,b.$schema,b.state)},b.prototype._value2Text=function(){var b=this;return b._isNumber()?f.value2Text(b.state.value,b.$schema,b.state):a.prototype._value2Text.call(this)},b.prototype.customOptions=function(a){var b=this;b._isDate()?b.customOptionsDate(a):b._isNumber()?b.customOptionsNumber(a,b.state.symbol):b._isPassword()?b.customOptionsPassword(a):b._isMemo()&&b.customOptionsMemo(a)},b.prototype.customOptionsMemo=function(a){a.tagName="textarea"},b.prototype.customOptionsPassword=function(a){a.type="password"},b.prototype.customOptionsDate=function(a){a.$format="date",i.utils.nativeDate()?a.type="date":(a.after={icon:"calendar"},a.date=!0)},b.prototype.customOptionsNumber=function(a,b){var c=this;a.inputClass="bs-edit-number",b&&(a.after={value:b},c._hasSymbol=!0),a.$format=c.$schema.format,i.utils.nativeNumber()&&(a.type="number")},b.prototype._removeEventsDate=function(){var a=this;a._isDate()&&a._setEventsDate()},b.prototype._setEventsDate=function(){var a=this;i.utils.useDatePicker()&&i.utils.datePickerInitialize(a.$element,{showOnFocus:!0},function(b){a.focusOut(null)})},b.prototype.setEvents=function(a){var b=this;b._isDate()&&b._setEventsDate()},b.prototype.removeEvents=function(){var a=this;a._isDate()&&a._removeEventsDate()},b.prototype.checkValue=function(a,b){b(a)},b.prototype.paste=function(a){var b=this,c=b._input();if(b.state.isReadOnly||b.state.isDisabled)return!0;if(b._isNumber()){if(i.utils.doPasteNumber(a,c,{decimalSep:e.number.decimal,thousandSep:e.number.thousand,places:b.state.decimals,schema:b.$schema})===!1)return!1}else if(b._isDate()){if(i.utils.doPasteDate(a,c,{sep:e.date.daySep,format:e.date.dateShort,schema:b.$schema})===!1)return!1}else if(b._isPassword()&&i.utils.doPastePassword(a,c,{schema:b.$schema})===!1)return!1;return!0},b.prototype._ignoreKeys=function(a,b){return a.which===d.keys.VK_TAB||a.which!==d.keys.VK_DELETE&&(!(!b&&a.which===d.keys.VK_BACKSPACE)&&(b?0===a.which||d.arrowKeys.indexOf(a.which)>=0:d.ignoreKeys.indexOf(a.which)>=0||d.arrowKeys.indexOf(a.which)>=0))},b.prototype.keypress=function(a){var b=this,c=b._input();if(b._ignoreKeys(a,!0))return!0;if(b._isNumber()){if(i.utils.keyPressNumber(a,c,{decimalSep:e.number.decimal,thousandSep:e.number.thousand,places:b.state.decimals,schema:b.$schema})===!1)return!1}else if(b._isDate()){if(i.utils.keyPressDate(a,c,{sep:e.date.daySep,format:e.date.dateShort,schema:b.$schema})===!1)return!1}else if(b._isPassword()&&i.utils.keyPressPassword(a,c,{schema:b.$schema})===!1)return!1;return!0},b.prototype.keydown=function(a){var b=this,c=b._input();if(b._ignoreKeys(a,!1))return!0;if(b.state.isReadOnly||b.state.isDisabled,b._isNumber()){if(i.utils.keyDownNumber(a,c,{decimalSep:e.number.decimal,thousandSep:e.number.thousand,places:b.state.decimals,schema:b.$schema})===!1)return!1}else if(b._isDate()){if(i.utils.keyDownDate(a,c,{sep:e.date.daySep,format:e.date.dateShort,schema:b.$schema})===!1)return!1}else if(b._isPassword()&&i.utils.keyDownPassword(a,c,{schema:b.$schema})===!1)return!1;return!0},b.prototype.equals=function(a){var b=this,c=b.state.value===a;return!c&&void 0===b.state.value&&"string"===b.$schema.type&&""===a||c},b.prototype.focusOut=function(a){var b=this,c=b._input(),d=b._text2value(c.value);b.equals(d)?b._isNumber()&&b._value2Input(c):b.checkValue(d,function(a){b.state.value!==a?(""===a&&"string"===b.$schema.type&&(a=void 0),b.state.value=a,b.form.setValue(b.$display,b.state.value)):b._value2Input(c)})},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(m);b.Edit=n,h.registerControl(n,"string",!1,"",null),h.registerControl(n,"number",!1,"",null),h.registerControl(n,"integer",!1,"",null)}(b=a.formedit||(a.formedit={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../errors.data.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=a.dom,e=a.ui,f=(a.locale,a.uiutils),g=(a.Observable.SchemaUtils,a.ulocale),h=a.Observable.errorsUtils;!function(b){var i=function(b,d,e,g){var h=a.bootstrap4;g=g||"",d=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},d);var i=[];return d.titleIsHidden&&(d.columns=!1),d.placeHolder=!1,f.utils.fieldWrapper(i,d,e,function(){if(!d.titleIsHidden){i.push('<label for="{0}_input" id="{0}_label"');var a=["bs-label"];d.columns&&(h?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("bs-lib-col col-sm-"+d.labelCol)),d.inline&&(h?a.push("form-check-inline"):a.push("checkbox-inline"),a.push("no-x-padding bs-cursor-d")),a.length&&i.push(' class="'+a.join(" ")+'"'),i.push(">"),i.push(c.escapeHtml(g||"")+(d.inline?"&nbsp;":"")),d.description&&f.utils.addTooltip(i,d.description,d),i.push("</label>")}d.columns&&i.push('<div class="no-x-padding col-sm-'+(12-d.labelCol)+'">'),i.push('<div class="bs-enum-list-wrap" id="{0}_input">'),i.push("</div>"),f.utils.addErrorDiv(i),d.columns&&i.push("</div>")}),c.format(i.join(""),b)},j=function(a,b,c,e){e=e||c;var f=document.createDocumentFragment(),g=$('<div tabindex="0" class="bs-enum-list-row"><div class="bs-enum-list-check"><a><center><span class="'+d.iconClass("square-o")+'"></span></center></a></div><div class="bs-enum-list-title"></div></div>').get(0);return c.forEach(function(c,h){var i=g.cloneNode(!0);b?(d.attr(i,"tabindex","-1"),d.removeClass(i,"bs-pointer"),d.addClass(i,"bs-cursor-disabled")):(d.attr(i,"tabindex","0"),d.addClass(i,"bs-pointer"),d.removeClass(i,"bs-cursor-disabled"));var j=i.firstChild.firstChild.firstChild.firstChild;j.className=a&&a.indexOf(c)>=0?d.iconClass("check-square-o"):d.iconClass("square-o");var k=i.lastChild;d.append(k,document.createTextNode(e[h])),d.append(f,i)}),f},k=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._setDisabled=function(a,b){for(var c=this,e=0,f=a.childNodes.length;e<f;e++){var g=a.childNodes[e];c.state.isDisabled?(d.attr(g,"tabindex","-1"),d.removeClass(g,"bs-pointer"),d.addClass(g,"bs-cursor-disabled")):(d.attr(g,"tabindex","0"),d.addClass(g,"bs-pointer"),d.removeClass(g,"bs-cursor-disabled"))}},b.prototype._setReadOnly=function(a,b){},b.prototype._setErrors=function(a,b){var c=this,d=c.state.errors;c.showErrors(b,d)},b.prototype._setMandatory=function(a,b){},b.prototype._input=function(){var a=this,b=a.$element.get(0);return d.find(b,a.id+"_input")},b.prototype._state2UI=function(a){var b=this,c=b._input(),d=b.$element?b.$element.get(0):null;c&&(a||b._setDisabled(c,d),a||b._setFilter(),b._setReadOnly(c,d),b.setHidden(d),b._setMandatory(c,d),b._setErrors(c,d))},b.prototype.mousedown=function(a){var b=this;if(b.$element&&!b.state.isDisabled&&!b.state.isReadOnly){var c=window.document.activeElement,e=d.parentByClass(b.$element.get(0),a.target,"bs-enum-list-row");if(e)return c!==e&&e.focus(),!0}},b.prototype._getEnumsNames=function(){var a=this;if(!a.$schemaItems.enumNames)return null;if(a.state.filter){var b=a.$schemaItems.filters[a.state.filter],c=[];return b.forEach(function(b){c.push(a.$schemaItems.enumNames[a.$schemaItems.enum.indexOf(b)])}),c}return a.$schemaItems.enumNames},b.prototype._getEnums=function(){var a=this;return a.state.filter?a.$schemaItems.filters[a.state.filter]:a.$schemaItems.enum},b.prototype._toggleEnumByIndex=function(a){var b=this,c=b._getEnums();if(a>=0&&a<c.length){var d=c[a],e=b.state.value.indexOf(d);e>=0?b.state.value.remove(d):b.state.value.push(d)}},b.prototype.keypress=function(a){var b=this;if(32==a.which){var c=d.parentByClass(b.$element.get(0),a.target,"bs-enum-list-row");if(!c)return;b._toggleEnumByIndex(d.indexOf(c.parentNode,c))}},b.prototype.click=function(a){var b=this;if(b.$element&&!b.state.isDisabled&&!b.state.isReadOnly){var c=d.parentByClass(b.$element.get(0),a.target,"bs-enum-list-row");c&&b._toggleEnumByIndex(d.indexOf(c.parentNode,c))}},b.prototype.changed=function(a,b,c,e,f){var g=this;if(g.$element){var h=g._input(),i=-1,k=g._getEnums(),l=g._getEnumsNames();switch(e){case"add":i=k.indexOf(f.$id),i>=0&&g._setItemValue(h.childNodes[i],!0);break;case"remove":i=k.indexOf(f.$id),i>=0&&g._setItemValue(h.childNodes[i],!1);break;case"propchange":d.empty(h);var m=j(g.state.value,g.state.isDisabled,k,l);d.empty(h),d.append(h,m)}}},b.prototype._setFilter=function(){var a=this,b=(a.state.filter,a._getEnums()),c=[];a.state.value.forEach(function(a){b.indexOf(a)>=0&&c.push(a)}),a.form.setValue(a.$bind,c)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null,f=e?c._input():null;a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(e)),a&&"isDisabled"!==a||d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(f,e)),a&&"isReadOnly"!==a||d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly),a&&"filter"!==a||d.filter!=c.state.filter&&(c.state.filter=d.filter,e&&c._setFilter()),a&&"isMandatory"!==a||d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory),a&&"errors"!==a||h.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(null,e))},b.prototype.render=function(a){var b=this,c=b._initOptions(f.utils.defaultOptions);if(!b.$element){b.$schema.description&&(c.description=g.tt(b.$schema.description,b.form.$locale)),b.$element=$(i(b.id,c,b.options.design,g.tt(b.$schema.title,b.form.$locale)));var e=j(b.state.value,b.state.isDisabled,b._getEnums(),b._getEnumsNames()),h=b._input();d.append(h,e),b._state2UI(!0)}return b.appendElement(a,c),b.$element},b.prototype._setItemValue=function(a,b){var c=a.firstChild.firstChild.firstChild.firstChild;c.className=b?d.iconClass("check-square-o"):d.iconClass("square-o")},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(a.ui.AbsField);e.registerControl(k,"array",!1,"enums-list",null)}(b||(b={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../ui/layout.control.ts" />
/// <reference path="../schema.data.ts" />
var Phoenix;!function(a){/************************
     *** General methods ***
     ************************/
function b(a,b,c){var d=a.substr(0,b),e=a.substr(c,a.length-c);return a=d+e}function c(a){return a.indexOf("-")!=-1}function d(a){for(var b="0.",c=0;c<a;c++)b+="0";return b}function e(a,b,c){var d=l(a,c,""),e="."==b?d:d.replace(b,".");l(e,"-","");return e}function f(a,b,c,d){a||(a="0"),a.indexOf(".")==-1&&(a+="."+g("",b));var e=h(a),f=i(e[0],d),j=e[1];return j.length>b&&(j=j.substr(0,b)),j.length<b&&(j=g(j,b)),f+c+j}function g(a,b){for(var c=a.length,d=0;d<b-c;d++)a+="0";return a}function h(a){var b=a.split(".");return""==b[0]&&(b[0]="0"),b}function i(a,b){
// Manage negative values
var c="";0==a.indexOf("-")&&(c="-",a=a.substr(1,a.length-1));
// Process
for(var d=0;d<a.length-1;d++){a[d];if("0"!=a[d])break}
// Particular case : val == ''
if(a=a.substr(d,a.length-d),""==a)return"0";if(a.length<=3)return c+a;for(var e=j(a),f="",d=0;d<e.length;d++)d%3==0&&d>0&&(f+=b),f+=e[d];return j(f+c)}function j(a){var b=a.split(""),c=b.reverse(),d=c.join("");return d}function k(a,b,c,d,g,h){var i=e(b,g,d),j=f(i,h,g,d);a.value=j,o(a,e(c,g,d).length,d)}function l(a,b,c){for(var d="",e=0;e<a.length;e++)d+=a[e]==b?c:a[e];return d}function m(a){return!(a.which<48||a.which>57)}function n(a,b,c,d,e,g,h,i){var j=parseFloat(a);if(c){if(j<b)return f(b.toString(),g,h,i)}else if(j<=b)return f(b.toString(),g,h,i);if(e){if(j>d)return f(d.toString(),g,h,i)}else if(j>=d)return f(d.toString(),g,h,i);return f(j.toString(),g,h,i)}function o(a,b,c){var d=a.value,e=0;if(0!=b){for(var f=0;f<d.length&&(d[f]!=c&&b--,0!=b);f++);e=f+1}q.selectRange(a,e)}var p=(a.ui,a.uiutils),q=a.dom,r=(a.ulocale,function(a,c,d){var f=parseFloat(e(a.originalEvent.clipboardData.getData("Text"),d.decimalSep,d.thousandSep)),g=f<0,h="";if(g&&(h="-",f=-f),isNaN(f))return a.preventDefault(),!0;var i=f.toString(),j=a.target.selectionStart,k=a.target.selectionEnd,l=k-j>0,m=l?b(c.value,j,k):c.value,p=m.substr(0,j),q=m.substr(j,m.length),r=e(p+f+q,d.decimalSep,d.thousandSep),s=n(h+r,d.schema.minimum,d.schema.exclusiveMinimum,d.schema.minimum,d.schema.exclusiveMinimum,d.places,d.decimalSep,d.thousandSep);c.value=s,o(c,e(p,d.decimalSep,d.thousandSep).length+i.length,d.thousandSep),a.preventDefault()}),s=function(a,g,h){
// Get selection
var i=a.target.selectionStart,j=a.target.selectionEnd,k=j-i>0,l=k?b(g.value,i,j):g.value,p=c(l),r="";p&&(l=l.substr(1,l.length-1),r="-",i!=-0&&(i--,j--));var s=l.substr(0,i),t=l.substr(i,l.length);
// Check if keypress is "," or "."
if(a.key===h.decimalSep||"."===a.key)return q.selectRange(g,l.indexOf(h.decimalSep)+1+r.length),a.preventDefault(),!0;
// Check if keypress is "-"
if("-"===a.key){if(0!=l.indexOf("-")){var u=e(l,h.decimalSep,h.thousandSep);if(u==d(h.places)||""==u){var v=f(u,h.places,h.decimalSep,h.thousandSep);g.value=v}else{var w=n("-"+e(l,h.decimalSep,h.thousandSep),h.schema.minimum,h.schema.exclusiveMinimum,h.schema.minimum,h.schema.exclusiveMinimum,h.places,h.decimalSep,h.thousandSep);g.value=w}}return q.selectRange(g,1),a.preventDefault(),!0}
// Check if keypress is number
if(!m(a))return a.preventDefault(),!1;
// Particular case : 0 added to start
if("0"===a.key&&0==i&&!k)return a.preventDefault(),!0;
// Process
var x=e(s+a.key+t,h.decimalSep,h.thousandSep),y=n(r+x,h.schema.minimum,h.schema.exclusiveMinimum,h.schema.minimum,h.schema.exclusiveMinimum,h.places,h.decimalSep,h.thousandSep);g.value=y;var z="0"==s?0:1;return o(g,e(s,h.decimalSep,h.thousandSep).length+z,h.thousandSep),a.preventDefault(),!0},t=function(a,c,d){
// Check if keypress is "delete"
if(a.which!=q.keys.VK_BACKSPACE&&a.which!=q.keys.VK_DELETE)return!0;var g=0;a.which==q.keys.VK_BACKSPACE&&(g=-1);
// Get selection
var h=a.target.selectionStart,i=a.target.selectionEnd,j=i-h>0,l=j?b(c.value,h,i):c.value,m=l.substr(0,h),n=l.substr(h,l.length);
// Reset selection
if(j)return k(c,l,m,d.thousandSep,d.decimalSep,d.places),a.preventDefault(),!0;
// Particular case : back delete left
if(a.which==q.keys.VK_BACKSPACE&&0==h)return a.preventDefault(),!0;
// Particular case : delete decimal separator
if(a.which==q.keys.VK_BACKSPACE){if(l[h+g]==d.decimalSep)return q.selectRange(c,h+g),a.preventDefault(),!0}else if(l[h+g]==d.decimalSep)return q.selectRange(c,h+g+1),a.preventDefault(),!0;
// Particular case : delete thousand separator
if(l[h+g]==d.thousandSep)return q.selectRange(c,h+1+2*g),a.preventDefault(),!0;
// New values
var p="";a.which==q.keys.VK_DELETE?p=e(m+n.substr(1,n.length-1),d.decimalSep,d.thousandSep):a.which==q.keys.VK_BACKSPACE&&(p=e(m.substr(0,m.length-1)+n,d.decimalSep,d.thousandSep));var r=f(p,d.places,d.decimalSep,d.thousandSep);c.value=r;
// Set caret position
var s=e(m,d.decimalSep,d.thousandSep).length+g;
// Particular cases : near decimal separator
return a.which==q.keys.VK_BACKSPACE&&0==p.indexOf(".")&&1==h&&(s=1),a.which==q.keys.VK_DELETE&&0==p.indexOf(".")&&0==h&&(s=1),o(c,s,d.thousandSep),a.preventDefault(),!0};/***********************
     ****** Variables *****
     **********************/
// Number
p.utils.doPasteNumber=r,p.utils.keyPressNumber=s,p.utils.keyDownNumber=t}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,a.dom),d=(a.ulocale,function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._item=function(a){var b=this,d=b.$element.get(0);return c.find(d,b.id+"_item_"+a)},b.prototype.click=function(a){var b=this,c=a.target;if(!b.state.isReadOnly&&c&&c.id){var d=b.id+"_item_";if(0===c.id.indexOf(d)){var e=parseInt(c.id.substring(d.length),10),f=b.$schema.enum[e];f!=b.state.value&&b.form.setValue(b.$bind,f)}}},b.prototype._setDisabled=function(a){if(a){var b=this;b._enumItems(function(a,c){a.disabled=b.state.isDisabled||b.state.isReadOnly})}},b.prototype._enumItems=function(a){var b=this;b.$schema.enum.forEach(function(c,d){var e=b._item(d);a(e,c)})},b.prototype._setMandatory=function(a){},b.prototype._state2UI=function(a){var b=this,c=b.$element?b.$element.get(0):null;if(c){var d=b.$schema.enum.indexOf(b.state.value);if(d>=0){var e=b._item(d);e&&a(e)}b._setDisabled(c),b.setHidden(c)}},b.prototype._getDefaultItem=function(){var a=this,b=a.$element?a.$element.get(0):null;if(b){var c=a.$schema.enum.indexOf(a.state.value);return c>=0?a._item(c):void 0}},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,c.setHidden(e)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,c._setDisabled(e)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,c._setDisabled(e)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,c._setMandatory(e))},b}(b.AbsField));b.Group=d}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./group.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=b,e=a.dom,f=a.ulocale,g=a.uiutils,h=function(b,d,f,h,i,j){h=h||"",d=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},d);var k=[];return g.utils.fieldWrapper(k,d,f,function(){var b=a.bootstrap4,f=!d.columns&&!d.inline;if(!d.titleIsHidden){k.push('<label for="{0}_input" id="{0}_label"');var g=["bs-label"];d.columns?(b?g.push("form-control-label"):g.push("checkbox-inline bs-cursor-d"),g.push("bs-lib-col col-sm-"+d.labelCol)):d.inline&&(b?g.push("form-check-inline"):g.push("checkbox-inline"),g.push("bs-cursor-d no-x-padding")),g.length&&k.push(' class="'+g.join(" ")+'"'),k.push(">"),k.push(c.escapeHtml(h||"")+(d.inline?"&nbsp;":"")),k.push("</label>")}d.columns&&k.push('<div class="no-x-padding col-sm-'+(12-d.labelCol)+'">'),f&&k.push("<div>");var l=["btn-group"];k.push('<div class="'+l.join(" ")+'">'),i.forEach(function(a,b){k.push('<button tabindex="-1" type="button" id="{0}_item_'+b+'" class="btn btn-'+e.bootstrapStyles().secondary+'"'),d.width&&k.push(' style="width:'+d.width+'"'),k.push(">"),k.push(c.escapeHtml(j[b]||"")),k.push("</button>")}),f&&k.push("</div>"),k.push("</div>")}),d.columns&&k.push("</div>"),c.format(k.join(""),b)},i=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._state2UI=function(){a.prototype._state2UI.call(this,function(a){e.addClass(a,"btn-primary"),e.removeClass(a,"btn-"+e.bootstrapStyles().secondary),a.tabIndex=0})},b.prototype.changed=function(b,c,d,f){var g=this;if(g.state.value!=d){if(g.state.value=d,!g.$element)return;a.prototype._enumItems.call(this,function(a,b){g.state.value===b?(a.tabIndex=0,g.focused&&a.focus(),e.addClass(a,"btn-"+e.bootstrapStyles().primary),e.removeClass(a,"btn-"+e.bootstrapStyles().secondary)):(e.addClass(a,"btn-"+e.bootstrapStyles().secondary),e.removeClass(a,"btn-"+e.bootstrapStyles().primary),a.tabIndex=-1)})}},b.prototype.keydown=function(a){var b=this,c=!1;if(!b.state.isReadOnly&&!(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)){var d=a.which||a.keyCode;switch(d){case e.keys.VK_LEFT:
//left
var f=b.$schema.enum.indexOf(b.state.value);if(f>0){var g=b.$schema.enum[f-1];b.form.setValue(b.$bind,g)}break;case e.keys.VK_RIGHT:
//right
var h=b.$schema.enum.indexOf(b.state.value);if(h>=0&&h<b.$schema.enum.length-1){var g=b.$schema.enum[h+1];b.form.setValue(b.$bind,g)}}c&&a.preventDefault()&&a.stopPropagation()}},b.prototype.render=function(a){var b=this,c=b._initOptions(g.utils.defaultOptions);if(!b.$element){var d=b.$schema.enumNames||b.$schema.enum;d=d.map(function(a){return f.tt(a,b.form.$locale)}),b.$element=$(h(b.id,c,b.options.design,f.tt(b.$schema.title,b.form.$locale),b.$schema.enum,d)),b._state2UI()}return b.appendElement(a,c),b.$element},b}(b.Group);b.BtnGroup=i,d.registerControl(i,"*",!0,"grpbtn",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=a.ui,e=a.dom,f=a.ulocale,g=a.uiutils;!function(b){function h(b,d,e,f){var h=a.bootstrap4;f=f||"",d=$.extend({columns:!1},d);var i=d.columns;d.columns=!1,i&&(d.styles="no-x-padding");var j=[],k={formGroup:"form-group"};return i&&!h&&(k.formGroup+=" form-horizontal"),g.utils.fieldWrapper(j,d,e,function(){j.push('<label id="{0}_label"');var a=["bs-label"];i&&(h?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("col-sm-12 bs-lib-col")),d.inline&&(h?a.push("form-check-inline"):a.push("checkbox-inline"),a.push("bs-cursor-d no-x-padding")),a.length&&j.push(' class="'+a.join(" ")+'"'),d.parentId&&j.push(' for="'+d.parentId+'_input"'),j.push(">"),j.push(c.escapeHtml(f||"")+(d.inline?"&nbsp;":"")),d.description&&g.utils.addTooltip(j,d.description,d),j.push("</label>")},k),c.format(j.join(""),b)}var i=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype.isMeta=function(){return!0},b.prototype.setParentId=function(a){this._parentId=a},b.prototype.getCustomBind=function(){var b=this;return b.config&&b.config.options&&b.config.options.$bind?b.config.options.$bind:a.prototype.getCustomBind.call(this)},b.prototype._setDisabled=function(a,b){},b.prototype._setReadOnly=function(a,b){},b.prototype._setMandatory=function(a,b){var c=this,d=this.state.isMandatory,f=c._label();f&&e.text(f,c.renderOptions.title+(d?" *":"")+(c.renderOptions.inline?String.fromCharCode(160):""))},b.prototype._label=function(){var a=this;return a.$element?e.find(a.$element.get(0),a.id+"_label"):null},b.prototype._state2UI=function(){var a=this,b=a._label(),c=a.$element?a.$element.get(0):null;b&&(a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c),a._setMandatory(b,c))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._label(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},b.prototype._title=function(){var a=this;return a.$schema&&a.$schema.title?a.$schema.title:a.config&&a.config.options&&a.config.options.title?a.config.options.title:""},b.prototype.render=function(a){var b=this,c=b._initOptions(g.utils.defaultOptions);return b.$element||(c.title=f.tt(b._title(),b.form.$locale),b.$schema.description&&(c.description=f.tt(b.$schema.description,b.form.$locale)),b._parentId&&(c.parentId=b._parentId),b.$element=$(h(b.id,c,b.options.design,c.title)),b._state2UI()),b.appendElement(a,c),b.$element},b}(a.ui.AbsField);b.Label=i,d.registerControl(i,"meta",!1,"label",null)}(b=a.formlabel||(a.formlabel={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../form.control.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=(a.ui,a.dom),e=a.uiutils,f=a.ulocale;!function(b){function g(a,b,f,g){g=g||"",b=$.extend({right:!1,icon:null,type:"default",size:null},b),void 0!==b.title&&(g=b.title);var h=[];if(!b.inline){var i=["bs-island","bs-field-group"];f&&i.push("design"),h.push('<div class="'+i.join(" ")+'"'),e.utils.addContainerId(h,f),h.push(">")}return h.push('<button type="button"'),h.push(' class="bs-button btn btn-'+d.bootstrapStyles()[b.type]),b.size&&h.push(" btn-"+b.size),b.inline?(h.push(" bs-btn-inline"),h.push(" bs-island"),b.right&&h.push(" pull-right"),f&&h.push(" design")):h.push(" btn-block"),b.style&&h.push(" "+b.style),h.push('"'),b.inline&&e.utils.addContainerId(h,f),h.push(">"),b.icon&&!b.iconRight&&h.push('<span class="'+d.iconClass(b.icon)+'"></span>'),b.titleIsHidden||(b.icon&&!b.iconRight&&h.push("&nbsp;"),h.push(g||""),b.icon&&b.iconRight&&h.push("&nbsp;")),b.icon&&b.iconRight&&h.push('<span class="'+d.iconClass(b.icon)+'"></span>'),h.push("</button>"),b.inline||h.push("</div>"),c.format(h.join(""),a)}var h=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._button=function(){var a=this;return a.renderOptions.inline?a.$element.get(0):a.$element.get(0).firstChild},b.prototype.click=function(a){var b=this;b.form.execAction(b.$bind)},b.prototype._setDisabled=function(a,b){var c=this;a.disabled=c.state.isDisabled,c.state.isDisabled?d.addClass(a,"disabled"):d.removeClass(a,"disabled")},b.prototype._state2UI=function(){var a=this,b=a._button(),c=a.$element?a.$element.get(0):null;b&&(a._setDisabled(b,c),a.setHidden(c))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._button(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f))},b.prototype.render=function(a){var b=this,c=b._initOptions(e.utils.defaultOptions);return b.$element||(b.$element=$(g(b.id,c,b.options.design,f.tt(b.$schema?b.$schema.title:b.$bind,b.form.$locale))),b._state2UI()),b.appendElement(a,c),b.$element},b}(a.ui.AbsField);b.Link=h}(b=a.formlink||(a.formlink={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="../../../data/datasets.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="./edit.control.ts" />
/// <reference path="./dropitems.control.ts" />
var Phoenix;!function(a){var b,c=(a.serial,a.ui),d=a.Observable.SchemaUtils,e=a.data,f=a.utils,g=a.dom;a.formedit,a.locale,a.ulocale,a.device;!function(b){var h={27:"esc",9:"tab",13:"enter",33:"pgUp",34:"pgDown",35:"end",36:"home",38:"up",40:"down",115:"f4"},i=function(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey},j={autoComplete:!1,maxItems:-1},k=function(a,b){if(""===a||null===a||void 0===a)return"";if(b&&b.data&&b.data.$value){for(var c=b.data.$value,d=0,e=c.length;d<e;d++){var f=c[d];if(f.code===a)return f.title}return a||""}return a||""},l=function(a,b,c){if(a.value&&(a=a.value),b){var d=[],f=e.compileFilterTree(b,null,c,null);return a.forEach(function(a){e.acceptFilter(f,a)&&d.push(a)}),d}return a},m=function(b){function c(c,d,e){b.call(this,c,d,e);var f=this;f.lookupOptions=j,f.eventBus=new a.serial.SingleEventBus(50),f.onselectItemHandler=f._onselectItem.bind(f),f.isEnum=f.$lookup&&f.$lookup.data&&"enum"===f.$lookup.data.$type}
//TEST
return __extends(c,b),c.prototype.customOptions=function(a){a.after={icon:"chevron-down"}},c.prototype._value2Text=function(){var a=this;return a.isEnum?k(a.state.value,a.$lookup):a.state.value||""},c.prototype._getSource=function(a){var b=this,c=b.form.getParentModel(b.$bind);
//options: {search: '', select: false,  find: false, findFirst: true}
//options: {search: '', select: false,  find: false, findFirst: true}
return b.$lookup.data&&b.$lookup.data.$type?"inline"===b.$lookup.data.$type||"enum"===b.$lookup.data.$type?f.dataAsPromise(l(b.$lookup.data.$value,b.$lookup.data&&b.$lookup.data.$params?b.$lookup.data.$params.$filter:null,c.model(!0))):d.allData(b.$lookup)&&b.$lookup.cache&&b.hasCachedData?f.dataAsPromise(b.cachedData):d.executeLookup(b.$lookup,b.form.getParentModel(b.$bind)):f.dataAsPromise(null)},c.prototype._filterResult=function(a,b){var c=this;if(a&&Array.isArray(a)?a={value:a}:a&&a.documents&&(a.value=a.documents,delete a.documents),d.allData(c.$lookup)){if(c.$lookup.cache&&!c.hasCachedData&&(c.hasCachedData=!0,c.cachedData=a),b.findFirst&&!b.search)return null;if(b.search&&a&&a.value&&b.findFirst){var e=d.findFirst(b.search,c.isEnum?"title":d.remoteSearch(d.lastSegment(c.$bind,c.$display),c.$lookup),a.value);return e?{value:[e.item]}:null}}return a},c.prototype._findselected=function(a,b){var c=this;if(b.search&&b.select&&a&&a.value){var e=d.findFirst(b.search,c.isEnum?"title":d.remoteSearch(d.lastSegment(c.$bind,c.$display),c.$lookup),a.value);if(e)return e.index}return-1},c.prototype._findValue=function(a,b){var c=this;a||""!==a||c.eventBus.push(null,function(a){b(null)},!0);var d={search:a,select:!1,findFirst:!0,find:!1};c.eventBus.push(c._getSource(d),function(a){a=c._filterResult(a,d),b(a&&a.value&&a.value.length?a.value[0]:null)},!0)},c.prototype._onselectItem=function(a){var b=this;b.eventBus.push(a,function(a){var c=Object.keys(b.$lookup.mapping),e=d.extractBase(b.$bind);c.forEach(function(c){b.form.setValue(e+c,a?a[b.$lookup.mapping[c]]||"":"")});var f=b._input();f.value!=b._value2Text()&&b._value2Input(f)},!0)},c.prototype._checkPopupMenu=function(){var b=this;if(!b.menu){var c=b._input(),e=b.$element;b.renderOptions.columns&&(e=$(b._colParent())),b.menu=new a.formdropitems.DropItems(e,c,{primaryKey:b.$lookup.primaryKey,search:b.isEnum?"title":d.remoteSearch(d.lastSegment(b.$bind,b.$display),b.$lookup),onselect:b.onselectItemHandler})}},c.prototype.mousedown=function(a){var c=this;return c.menu&&c.menu.opened&&c.menu.inMenu(a.target)?(a.stopPropagation(),!1):b.prototype.mousedown.call(this,a)},c.prototype.stopProppagation=function(a){var c=this;b.prototype.stopProppagation.call(this,a),c.menu&&c.menu.opened&&c.menu.inMenu(a.target)&&(a.preventDefault(),a.stopPropagation())},c.prototype.click=function(a){var b=this,c=b._input();if(g.isChildOf(c.parentNode.lastChild,a.target))if(d.supportPagination(b.$lookup));else if(b._checkPopupMenu(),b.menu.opened)this.eventBus.push(null,function(c){b.menu.hide(a.target)},!0);else{var e={search:c.value,select:!0,find:!1,findFirst:!1};b.eventBus.push(b._getSource(e),function(a){a=b._filterResult(a,e);var c=-1;e.select&&(c=b._findselected(a,e)),b.menu.show(a,c,!1)},!0)}else b.menu&&b.menu.opened&&b.menu.inMenu(a.target)&&b.menu.click(a)},c.prototype.beforeAppend=function(){},c.prototype._managePreventDefault=function(a,b){var c;switch(a){case"up":case"pgDown":case"pgUp":case"home":case"end":c=!i(b);break;case"down":b.ctrlKey?(c=!0,a="f4"):c=!i(b);break;default:c=!1}return c&&b.preventDefault()&&b.stopPropagation(),a},c.prototype._shouldTrigger=function(a,b){var c;switch(a){case"tab":c=!i(b);break;default:c=!0}return c},c.prototype.setEvents=function(a){var b=this;$(b._input()).on("input",function(){b.inputChanged()})},c.prototype.removeEvents=function(){var a=this;$(a._input()).off("input")},c.prototype.inputChanged=function(){var a=this,b=a._input();a.modified=b.value!=a._value2Text(),a.trigger("inputChanged",null)},c.prototype.checkValue=function(a,b){var c=this,d=c._input(),e=d.value!=c._value2Text();e?c._findValue(d.value,function(a){c._onselectItem(a)}):b(c.state.value)},c.prototype.keydown=function(a){var b=this,c=h[a.which||a.keyCode];return c=b._managePreventDefault(c,a),c&&b._shouldTrigger(c,a)&&b.trigger(c+"Keyed",a),!0},c.prototype.focusOut=function(a){var c=this;c.menu&&c.menu.opened&&this.eventBus.push(null,function(a){c.menu.hide(null)},!0),b.prototype.focusOut.call(this,a)},c.prototype.focusIn=function(a){this.trigger("focused")},c.prototype.trigger=function(a,b){var c=this,e=c._input();if(c.menu&&c.menu.opened)switch(a){case"escKeyed":c.eventBus.push(null,function(a){c.menu.hide(null)},!0);break;case"enterKeyed":c.eventBus.push(null,function(a){c.menu.select()},!0);break;case"upKeyed":c.eventBus.push(null,function(a){c.menu.move(-1)},!0);break;case"downKeyed":c.eventBus.push(null,function(a){c.menu.move(1)},!0);break;case"homeKeyed":c.eventBus.push(null,function(a){c.menu.move(-1e3)},!0);break;case"endKeyed":c.eventBus.push(null,function(a){c.menu.move(1e3)},!0);break;case"pgDownKeyed":c.eventBus.push(null,function(a){c.menu.move(7)},!0);break;case"pgUpKeyed":c.eventBus.push(null,function(a){c.menu.move(-7)},!0);break;case"inputChanged":var f={search:e.value,select:!0,find:!1,findFirst:!1};this.eventBus.push(c._getSource(f),function(a){if(c.menu&&c.menu.opened){f.search=e.value,a=c._filterResult(a,f);var b=-1;f.select&&(b=c._findselected(a,f)),c.menu.show(a,b,!0)}},!1)}else if("f4Keyed"==a)if(d.supportPagination(c.$lookup));else if(!c.menu||!c.menu.opened){c._checkPopupMenu();var f={search:e.value,select:!0,find:!1,findFirst:!1};c.eventBus.push(c._getSource(f),function(a){a=c._filterResult(a,f);var b=-1;f.select&&(b=c._findselected(a,f)),c.menu.show(a,b,!1)},!0)}},c.prototype.destroy=function(){var a=this;a.onselectItemHandler=null,a.cachedData=null,a.menu&&(a.menu.destroy(),a.menu=null),b.prototype.destroy.call(this)},c}(a.formedit.Edit);b.Lookup=m,c.registerControl(m,"string",!1,"",{lookup:!0}),c.registerControl(m,"number",!1,"",{lookup:!0})}(b=a.formlookup||(a.formlookup={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=a.ui,e=a.dom,f=(a.device,a.uiutils),g=a.Observable,h=a.data.odata,i=g.DataUtils,j=a.ulocale;!function(b){var g=function(b,d,g,h,i){var j=[];return h=h||"",f.utils.fieldWrapper(j,d,g,function(){var b=a.bootstrap4;if(!d.titleIsHidden){j.push('<label id="{0}_label"');var g=["bs-label"];d.columns&&(b?g.push("form-control-label"):g.push("checkbox-inline bs-cursor-d"),g.push("bs-lib-col col-sm-"+d.labelCol)),d.inline&&(b?g.push("form-check-inline"):g.push("checkbox-inline"),g.push("bs-cursor-d no-x-padding")),g.length&&j.push(' class="'+g.join(" ")+'"'),j.push(">"),j.push(c.escapeHtml(h||"")+(d.inline?"&nbsp;":"")),d.description&&f.utils.addTooltip(j,d.description,d),j.push("</label>")}d.columns&&j.push('<div class="no-x-padding col-sm-'+(12-d.labelCol)+'">'),d.inline?j.push('<span id="{0}_alt" class="bs-no-image">'):j.push('<div id="{0}_alt" class="bs-no-image">'),i&&j.push('<input id="{0}_upload" class="bs-hidden-file" accept="image/*" type="file" />');var k=["bs-none bs-relative"];d.inline||k.push(b?"img-fluid":"img-responsive"),j.push('<img id="{0}_img" class="'),j.push(k.join(" ")),j.push('"/>'),i&&j.push('<div id="{0}_remove" class="bs-rt-button bs-image-remove bs-none"><span class="'+e.iconClass("times-circle")+'"></span></div>'),d.inline?j.push("</span>"):j.push("</div>"),d.columns&&j.push("</div>")},null),c.format(j.join(""),b)},k=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._setDisabled=function(a){},b.prototype._setReadOnly=function(a){this._setDisabled(a)},b.prototype._setMandatory=function(a){},b.prototype._state2UI=function(){var a=this,b=a._img(),c=a.$element?a.$element.get(0):null;b&&(a._showValue(a.state.value),a._setDisabled(c),a._setReadOnly(c),a.setHidden(c))},b.prototype._showValue=function(a){},b.prototype.changed=function(a,b,c,d){var e=this;e._img();e.state.value!==c&&(e.state.value=c,e._showValue(e.state.value))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(e)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e))},b.prototype._img=function(){var a=this,b=a.$element.get(0),c=b?e.find(b,a.id+"_img"):null;return c},b.prototype._altimg=function(){var a=this,b=a.$element.get(0),c=b?e.find(b,a.id+"_alt"):null;return c},b.prototype.render=function(a){var b=this,c=b._initOptions(f.utils.defaultOptions);return b.$element||(c.title=j.tt(b.$schema.title,b.form.$locale),b.$element=$(g(b.id,c,b.options.design,c.title,b.editable)),b._state2UI(),b.setEvents(c)),b.appendElement(a,c),b.$element},b}(a.ui.AbsField),l=function(a){function b(b,c,d){a.call(this,b,c,d),this.editable=!0}return __extends(b,a),b.prototype._createImage=function(a){var b=this,c=a.target.files;// FileList object
if(c&&c.length){var d=c[0];if(!d.type.match("image.*"))return;var f=window.URL||window.webkitURL;if(f){var g={id:b.state.value?b.state.value.id:void 0,fileName:d.name,value:"",url:b.state.value?b.state.value.url:void 0,contentType:d.type};if("image/svg+xml"===d.type){var h=new FileReader;h.onload=function(a){g.value=h.result,b.form.setValue(b.$bind,g),e.processing(!1)},e.processing(!0),h.readAsDataURL(d)}else{var i=document.createElement("img"),j=document.createElement("canvas");e.processing(!0),i.src=f.createObjectURL(d),i.onload=function(){var a=1,c=i.width*i.height;c>12e5?a=2:c>24e5?a=4:c>4e6&&(a=8),j.width=i.width/a,j.height=i.height/a;var d=j.getContext("2d");d.drawImage(i,0,0,j.width,j.height),g.value=j.toDataURL(),b.form.setValue(b.$bind,g),e.processing(!1)}}}}},b.prototype._removeImage=function(){var a=this,b={id:a.state.value?a.state.value.id:void 0,value:""};a.form.setValue(a.$bind,b)},b.prototype.click=function(a){var b=this;if(!b.state.isDisabled&&!b.state.isReadOnly){var c=b.id+"_remove";if(a.target.id===c||a.target.parentNode.id===c)b._removeImage();else{var d=b._upload();d.click()}}},b.prototype._upload=function(){var a=this,b=a.$element.get(0),c=b?e.find(b,a.id+"_upload"):null;return c},b.prototype.setEvents=function(a){var b=this,c=b._upload();c&&$(c).on("change",function(a){b._createImage(a)})},b.prototype.removeEvents=function(){var a=this,b=a._upload();b&&$(b).off("change")},b.prototype._setDisabled=function(a){var b=this,c=b._upload();c.disabled=b.state.isDisabled||b.state.isReadOnly,b._showRemoveImage(b.state.value)},b.prototype._showRemoveImage=function(a){var b=this,c=!b.state.isHidden&&!b.state.isDisabled&&!b.state.isReadOnlyd;c&&(c=a&&(a.url||a.value));var d=b._rmv();d&&(c?e.removeClass(d,"bs-none"):e.addClass(d,"bs-none"))},b.prototype._rmv=function(){var a=this,b=a.$element.get(0),c=b?e.find(b,a.id+"_remove"):null;return c},b.prototype._showValue=function(a){var b=this,d=b._img(),f=b._altimg();if(d){var g=!1;if(a)if(void 0!==a.value)a.value?(d.src=a.value,g=!0):d.src="";else if(a.url){if(a.url.indexOf("{{baseUrl}}")>=0){var j=i.extractMainDataSource(b.form.$model);j||(j={$module:b.renderOptions.$module,$context:b.renderOptions.$context});var k=(h.baseUrl(j),c.execAngularExpression(a.url,{baseUrl:h.baseUrl(j)||""}));d.src=h.addImageUrlToken(c.escapeHtml(k))}else d.src="";g=!0}else d.src="";else d.src="";g?(e.removeClass(d,"bs-none"),e.removeClass(f,"bs-no-image")):(e.addClass(d,"bs-none"),e.addClass(f,"bs-no-image")),b._showRemoveImage(a)}},b}(k),m=function(a){function b(b,c,d){a.call(this,b,c,d),this.editable=!1}return __extends(b,a),b.prototype._showValue=function(a){var b=this,c=b._img(),d=b._altimg();if(c){var f=!1;a&&(c.src=a,f=!0),f?(e.removeClass(c,"bs-none"),e.removeClass(d,"bs-no-image")):(e.addClass(c,"bs-none"),e.addClass(d,"bs-no-image"))}},b}(k);d.registerControl(l,"string",!1,"",{format:"stream"}),d.registerControl(m,"string",!1,"imageurl",{})}(b=a.formpicture||(a.formpicture={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./group.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=b,e=(a.dom,a.ulocale),f=a.uiutils,g=function(b,d,e,g,h,i){g=g||"",d=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,horizontal:!1},d);var j=[],k=null;return f.utils.fieldWrapper(j,d,e,function(){var b=a.bootstrap4;if(!d.titleIsHidden){j.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];d.columns&&(b?e.push("form-control-label"):e.push("checkbox-inline bs-cursor-d"),e.push("bs-lib-col col-sm-"+d.labelCol)),d.inline&&(b?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&j.push(' class="'+e.join(" ")+'"'),j.push(">"),j.push(c.escapeHtml(g||"")+(d.inline?"&nbsp;":"")),d.description&&f.utils.addTooltip(j,d.description,d),j.push("</label>"),!d.inline&&d.horizontal&&j.push("<div></div>")}d.columns&&j.push('<div class="no-x-padding  col-sm-'+(12-d.labelCol)+'">');var k=d.inline||d.horizontal?[b?"form-check-inline no-x-padding":"radio-inline"]:[];h.forEach(function(a,b){d.inline||d.horizontal||j.push('<div id="{0}_radio" class="radio">'),j.push("<label"),k.length&&j.push(' class="'+k.join(" ")+'"'),j.push(">"),j.push('<input type="radio" name="{0}_input" id="{0}_item_'+b+'" value="'+a+'">'),j.push("&nbsp;"),j.push(c.escapeHtml(i[b]||"")),j.push("</label>"),d.inline||d.horizontal||j.push("</div>")}),d.columns&&j.push("</div>")},k),c.format(j.join(""),b)},h=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._state2UI=function(){a.prototype._state2UI.call(this,function(a){a.checked=!0})},b.prototype.changed=function(b,c,d,e){var f=this;if(f.state.value!=d){f.state.value=d;var g=f.$schema.enum.indexOf(f.state.value),h=a.prototype._item.call(this,g);h&&(h.checked=!0)}},b.prototype.render=function(a){var b=this,c=b._initOptions(f.utils.defaultOptions);if(!b.$element){var d=b.$schema.enumNames||b.$schema.enum;d=d.map(function(a){return e.tt(a,b.form.$locale)}),b.$schema.description&&(c.description=e.tt(b.$schema.description,b.form.$locale)),b.$element=$(g(b.id,c,b.options.design,e.tt(b.$schema.title,b.form.$locale),b.$schema.enum,d)),b.setEvents(c),b._state2UI()}return b.appendElement(a,c),b.$element},b}(b.Group);b.RadioGroup=h,d.registerControl(h,"*",!0,"radio",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,c,e,f){e=e||"",b=$.extend({titleIsHidden:!1},b);var g=[];return h.utils.fieldWrapper(g,b,c,function(){g.push('<div style="background-color: red;">'+e+"</div>")}),d.format(g.join(""),a)}var d=a.utils,e=b,f=a.dom,g=a.ulocale,h=a.uiutils,i=function(a){function b(b,c,e){a.call(this,b,c,e);var f=this;f._map=[],b.options&&b.options.$expression?(f.$expression=b.options.$expression,d.extractAngularVars(f.$expression,f._map)):(f.$expression=d.format("{0}: {{{1}}}",d.escapeHtml(g.tt(f.$schema.title,f.form.$locale)),f.$bind),f._map.push({name:f.$bind})),f._map.forEach(function(a){a.name!=f.$bind?(a.schema=e.getSchema(a.name),f.form.registerListenerFor(a.name,f)):a.schema=f.$schema}),this._state()}return __extends(b,a),b.prototype._state=function(){var a=this;a.state=a.state||{},a.state.values=a.state.values||{},a.state.fvalues=a.state.fvalues||{};var b=a.form.getState(a.$bind);a.state.isHidden=b.isHidden,a._refreshValues()},b.prototype._refreshValues=function(){var a=this;a._map.forEach(function(b){a.state.values[b.name]=a.form.getValue(b.name);var c=a.form.getState(b.name);a.state.fvalues[b.name]=h.utils.displayValue(a.state.values[b.name],b.schema,a.form.$locale,{html:!1,useSymbol:!0,state:c},a.state.values,b.name).value})},b.prototype._value2UI=function(){var a=this,b=a.$element?a.$element.get(0):null,c=d.execAngularExpression(a.$expression,a.state.fvalues,!0),e=$("<div>"+d.escapeHtml(c)+"</div>").get(0);for(f.empty(b);e.childNodes.length>0;)b.appendChild(e.childNodes[0])},b.prototype._findMap=function(a){for(var b=this,c=0,d=b._map.length;c<d;c++){var e=b._map[c];if(e.name===a)return e}return null},b.prototype.changed=function(a,b,c,d){var e=this;e._refreshValues(),e._value2UI()},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(e)),d.symbol!==c.state.symbol&&(d.symbol=c.state.symbol),d.decimals!==c.state.decimals&&(d.decimals=c.state.decimals)},b.prototype._state2UI=function(){var a=this,b=a.$element?a.$element.get(0):null;b&&(a.setHidden(b),a._value2UI())},b.prototype.render=function(a){var b=this,d=b._initOptions(h.utils.defaultOptions);return b.$element||(b.$element=$(c(b.id,d,b.options.design,g.tt(b.$schema.title,b.form.$locale),"")),b._state2UI()),b.appendElement(a,d),b.$element},b.prototype.destroy=function(){var b=this;b._map.forEach(function(a){a.name!=b.$bind&&b.form.unRegisterListenerFor(a.name,b)}),a.prototype.destroy.call(this)},b}(b.AbsField);b.ReadOnlyField=i,e.registerControl(i,"*",!1,"",{readOnly:!0})}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../errors.data.ts" />
/// <reference path="./edit.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=(a.formedit,a.uiutils),f=(a.dom,a.locale,a.Observable.SchemaUtils,a.ulocale),c=b,g=function(b,c,f,g,h,i){g=g||"",c=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},c);var j=[];return c.titleIsHidden&&(c.columns=!1),c.placeHolder=!1,e.utils.fieldWrapper(j,c,f,function(){var b=a.bootstrap4;if(!c.titleIsHidden){j.push('<label for="{0}_input" id="{0}_label"');var f=["bs-label"];c.columns&&(b?f.push("form-control-label"):f.push("checkbox-inline bs-cursor-d"),f.push("bs-lib-col col-sm-"+c.labelCol)),c.inline&&(b?f.push("form-check-inline"):f.push("checkbox-inline"),f.push("bs-cursor-d no-x-padding")),f.length&&j.push(' class="'+f.join(" ")+'"'),j.push(">"),j.push(d.escapeHtml(g||"")+(c.inline?"&nbsp;":"")),c.description&&e.utils.addTooltip(j,c.description,c),j.push("</label>")}c.columns&&j.push('<div class="no-x-padding col-sm-'+(12-c.labelCol)+'">'),j.push('<select class="form-control'),c.size&&b&&j.push(" form-control-"+c.size),j.push('" id="{0}_input"');var k=[];c.maxWidth&&k.push("max-width: "+c.maxWidth+";"),c.minWidth&&k.push("min-width: "+c.minWidth+";"),k.length&&j.push(' style="'+k.join("")+'"'),j.push(">"),h.forEach(function(a,b){j.push('<option value="'+a+'">'+i[b]+"</option>")}),j.push("</select>"),e.utils.addErrorDiv(j),c.columns&&j.push("</div>"),c.titleIsHidden&&c.description&&e.utils.addTooltip(j,c.description,c)}),d.format(j.join(""),b)},h=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b.prototype.fillSelect=function(a){var b=this;e.utils.fillSelect(a,b._input(),b.$schema)},b.prototype._state2UI=function(){var b=this,c=b._input();c&&b._setFilter(!0),a.prototype._state2UI.call(this)},b.prototype._setFilter=function(a){var b=this,c=b.state.filter;if(!a||c){var d=c?b.$schema.filters[c]||[]:b.$schema.enum;if(b.fillSelect(d),!a){var e=d.indexOf(b.state.value);if(e<0)b.form.setValue(b.$display,d.length?d[0]:null);else{var f=b._input();f&&b._value2Input(f)}}}},b.prototype.stateChanged=function(b,c){var d=this,e=d.form.getState(d.$bind);a.prototype.stateChanged.call(this,b,c),b&&"filter"!==b||d.state.filter!==e.filter&&(d.state.filter=e.filter,d._setFilter(!1))},b.prototype.render=function(a){var b=this,c=b._initOptions(e.utils.defaultOptions);if(!b.$element){var d=b.$schema.enumNames||b.$schema.enum;d=d.map(function(a){return f.tt(a+"",b.form.$locale)}),c.title=f.tt(b.$schema.title,b.form.$locale),b.$schema.description&&(c.description=f.tt(b.$schema.description,b.form.$locale));var h=b.state.filter,i=h?b.$schema.filters[h]||[]:b.$schema.enum;b.$element=$(g(b.id,c,b.options.design,c.title,i,d)),b._state2UI(),b.setEvents(c)}return b.appendElement(a,c),b.$element},b.prototype.removeEvents=function(){var a=this,b=a._input();$(b).off("change")},b.prototype._value2Input=function(a){var b=this;a.selectedIndex=b.state.filter?b.$schema.filters[b.state.filter].indexOf(b.state.value):b.$schema.enum.indexOf(b.state.value)},b.prototype.setEvents=function(a){var b=this,c=b._input();$(c).on("change",function(a){var c=b._input(),d=b.state.filter?b.$schema.filters[b.state.filter][c.selectedIndex]:b.$schema.enum[c.selectedIndex];b.state.value!==d&&(b.state.value=d,b.form.setValue(b.$display,b.state.value))})},b}(a.formedit.BaseEdit);b.Select=h,c.registerControl(h,"*",!0,"",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(b,c,e,g){g=g||"",c=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},c);var h=[];return i.utils.fieldWrapper(h,c,e,function(){var b=a.bootstrap4;if(!c.titleIsHidden){var e=["bs-label"];h.push('<label for="{0}_input" id="{0}_label"'),c.columns&&(b?e.push("form-control-label"):e.push("checkbox-inline"),e.push("bs-lib-col col-sm-"+c.labelCol)),c.inline&&(b?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&h.push(' class="'+e.join(" ")+'"'),h.push(">"),h.push(f.escapeHtml(g||"")+(c.inline?"&nbsp;":"")),c.description&&i.utils.addTooltip(h,c.description,c),h.push("</label>")}c.columns&&h.push('<div class="no-x-padding col-sm-'+(12-c.labelCol)+'" id="{0}_colparent">'),d(h,c,g),c.columns&&h.push("</div>"),c.titleIsHidden&&c.description&&i.utils.addTooltip(h,c.description,c)}),f.format(h.join(""),b)}function d(a,b,c){a.push('<input class="tgl tgl-light" id="{0}_input" type="checkbox">'),a.push('<label class="tgl-btn" for="{0}_input"></label>')}var e=b,f=a.utils,g=a.dom,h=a.ulocale,i=a.uiutils,j=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._check=function(){var a=this,b=a.$element.get(0);return g.find(b,a.id+"_input")},b.prototype.click=function(a){var b=this,c=b._check(),d=c.checked||!1;a.target==c&&b.state.value!=d&&(b.state.value=d,b.form.setValue(b.$bind,d))},b.prototype._setDisabled=function(a,b){var c=this,d=c._check();c.state.isDisabled||c.state.isReadOnly?g.addClass(d,"disabled"):g.removeClass(d,"disabled"),a.disabled=c.state.isDisabled},b.prototype._setReadOnly=function(a,b){this._setDisabled(a,b)},b.prototype._setMandatory=function(a,b){},b.prototype._state2UI=function(){var a=this,b=a._check(),c=a.$element?a.$element.get(0):null;b&&(b.checked=a.state.value||!1,a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c))},b.prototype.changed=function(a,b,c,d){var e=this,f=e._check();e.state.value!=c&&(e.state.value=c,f.checked=e.state.value||!1)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._check(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},b.prototype.render=function(a){var b=this,d=b._initOptions(i.utils.defaultOptions);return b.$element||(b.$schema.description&&(d.description=h.tt(b.$schema.description,b.form.$locale)),b.$element=$(c(b.id,d,b.options.design,h.tt(b.$schema.title,b.form.$locale))),b._state2UI()),b.appendElement(a,d),b.$element},b}(b.AbsField);b.Toggle=j,e.registerControl(j,"boolean",!1,"toggle",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="./controls/absfield.control.ts" />
/// <reference path="./controls/link.control.ts" />
var Phoenix;!function(a){var b,c=a.render,d=a.ui,e=a.formlink,f=(a.Observable,a.Observable.SchemaUtils);!function(a){var b=function(a,b,c){if(f.isLink(a.$bind))return e.Link;var g=f.isMeta(a.$bind);if(g)return d.getRegisteredControl("meta",!1,g.widget,"",{});if(!b)return null;var h;return a.$readOnly&&(h=h||{},h.readOnly=!0),c&&(h=h||{},h.lookup=!0),d.getRegisteredControl(b.type,!!b.enum,a.$widget,b.format,h)};c.register("javascript","field.control",b),c.register("angular","field.control",b)}(b||(b={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b=a,c=b.locale,d=b.ui,e=b.utils,f={type:"object",properties:{message:{type:"string"}}},g={name:"alert",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},h=function(a,b,e){a=a||c.ui.Info;var h={title:a,buttons:[{type:"primary",title:c.ui.Ok,name:"ok"}]},i={message:b};d.OpenModalForm(h,g,f,i,null,function(a,b,c,d){if("modal-action"===b.operation)switch(b.property){case"ok":a.close(),e&&e()}})};e.alert=function(a,b,c){h(a,b,c)}}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
/// <reference path="../ui/datasets-plugin.ts" />
var Phoenix;!function(a){var b=a,c=b.locale,d=(b.utils,b.external),e=b.application,f=b.DatasetPlugin,g=b.dom,h=b.ui,i={name:"form",$type:"block",$items:[{$bind:"oldPwd"},{$bind:"newPwd"},{$bind:"$$newPwd"}]},j=function(a){var b={type:"object",properties:{oldPwd:{title:c.ui.password.oldPassword,type:"string",format:"password",capabilities:{noConfirming:!0}},newPwd:{title:c.ui.password.newPassword,type:"string",format:"password",minLength:8}},states:{oldPwd:{isMandatory:!0},newPwd:{isMandatory:!0}}},d={title:c.ui.password.change,buttons:[{pattern:"validate"}]};h.OpenModalForm(d,i,b,{},{},function(b,c,d,h){switch(c.property){case"validate":if(!d.validate())return;var i={},j=e.configuration&&e.configuration.application&&e.configuration.application.authentication?e.configuration.application.authentication.changePasswordDs:null;if(!j)return void b.close();g.processing(!0);var k={oldPwd:d.oldPwd,newPwd:d.newPwd};j.name="data",f.executeDatasets([j],k,i,[],function(c,e){e?(d.addAjaxException(e),g.processing(!1)):(g.processing(!1),b.close(),a&&a())})}})};d.changePasswordHandler=j}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b=a,c=b.locale,d=b.ui,e=b.utils,f={type:"object",properties:{message:{type:"string"}}},g={name:"confirm",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},h=function(a,b,e,h){a=a||c.ui.Warning;var i={title:a,buttons:[{type:"default",title:c.ui.No,name:"no"},{type:"primary",title:c.ui.Yes,name:"yes"}]},j={message:b};d.OpenModalForm(i,g,f,j,null,function(a,b,c,d){if("modal-action"===b.operation)switch(b.property){case"yes":a.close(),e&&e();break;case"no":a.close(),h&&h()}})};a.confirmDlg=h,e.confirm=function(a,b,c,d){h(a,b,c,d)}}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=(c.dom,c.link),e=c.utils,f=(c.application,c.ulocale,c.locale,function(a){var b=c.bootstrap4,d=[],e=["bs-relative bs-image-mi-image"];e.push(b?"img-fluid":"img-responsive"),d.push('<div id="{0}" class="bs-image-mi bs-cursor-d">'),d.push('<div class="bs-image-mi-border"'),a.link&&d.push('href="click://navigate"'),d.push(">");var f=["max-width:"+a.maxWidth+"px;"];return d.push('<img id="{0}_img" class="'),d.push(e.join(" ")),d.push('" src="'+a.imageSrc+'"'),f.length&&d.push(' style="'+f.join("")+'"'),d.push(" />"),d.push('<span class="bs-image-mi-title">'+a.title+"</span>"),d.push("</div>"),d.push("</div>"),d.join("")}),g=function(){function a(a,b){var c=this;c.$id=e.allocID(),b.maxWidth=b.maxWidth||128,c._options=b}return a.prototype._setEvents=function(){var a=this;if(a.$element){var b=a.$element.get(0);a.$element.on("click",function(c){var e=d.isCustomLink(b,c);if(e&&"click"===e.protocol){var f=a._options.link,g=d.context();"string"==typeof f?a.module&&a.module.links&&a.module.links[f]?d.execLink(a.module.links[f],g,null):d.execLink({$page:f},g,null):f.$page&&d.execLink(f,g,null)}})}},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype.render=function(a){var b=this;b.$element||(b.$element=$(e.format(f(b._options),b.$id)),b._setEvents()),a&&(b._options.replaceParent?a.replaceWith(b.$element):a.append(b.$element))},a.prototype.destroy=function(){var a=this;a.module=null,a._removeEvents(),a.$element=null,a._options=null},a}();b.ImageMenuItem=g}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../data/odata-provider.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=c.data,e=c.utils,f=function(){function a(a,b,c,d,e,f,g){var h=this;h._enums={},h._entity=b,h._module=a,h._typeField=c,h._codeField=d,h._titleField=e,h._orderByField=f,h._fields=g}return a.prototype.promise=function(a,b){var c={},f=[],g=this,h=[];if(Object.keys(a).forEach(function(b){var d=a[b];if(g._enums[b])c[b]=g._enums[b];else{f.push({name:b,config:d});var e=g._typeField+" eq '"+b+"'";d.filter&&(e="("+e+" and "+d.filter+")"),h.push(e)}}),!f.length)return new e.Promise(function(a,d){a({type:b,enums:c})});var i={$top:1e3,nocount:!0,$entity:g._entity,$module:g._module,$filter:h.join(" or "),$orderby:g._typeField+","+g._orderByField};return d.odata.getRessources(i,function(a){return a.documents&&a.documents.forEach(function(a){var b=a[g._codeField],d=a[g._titleField],e=a[g._typeField];if(c[e]||(c[e]={enum:[],enumNames:[]},g._enums[e]=c[e]),g._fields){c[e].fields=c[e].fields||[];var f=[],h={};if(g._fields.forEach(function(b){a[b]&&f.push(a[b]),h[b]=a[b]}),c[e].fields.push(h),f.length){var i=f.join("$");c[e].filters=c[e].filters||{},c[e].filters[i]=c[e].filters[i]||[],c[e].filters[i].push(b)}}c[e].enum.push(b),c[e].enumNames.push(d)}),{type:b,enums:c}})},a}();b.OdataEnumManager=f}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b=a,c=b.locale,d=b.utils,e=b.ui,f={type:"object",properties:{value:{type:"string"}}},g={name:"prompt",$type:"block",$items:[{$bind:"value",options:{titleIsHidden:!0}}]},h=function(a,b,d){a=a||c.ui.Warning;var h={title:a,buttons:[{type:"primary",title:c.ui.Ok,name:"ok"}]},i={value:b||""};e.OpenModalForm(h,g,f,i,null,function(a,b,c,e){if("modal-action"===b.operation)switch(b.property){case"ok":var f=c.value;a.close(),d&&d(f)}})};d.prompt=function(a,b,c){h(a,b,c)}}(Phoenix||(Phoenix={}));
/// <reference path="../core/core-refs.ts" />
/// <reference path="../data/datasets.ts" />
/// <reference path="../ui/form/schema.data.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a,d=(c.ulocale,c.application),e=c.ajax,f=c.data,g=c.utils,h=c.Observable.SchemaUtils,i=c.dom,j={getRessources:function(a,b){var c=function(a){return b&&(a=b(a)),a},f=d.config(d.name);if(!f)throw"Application configuration not found.";var j=f.current.prototypes+"/"+a,k=e.get(j,{},function(a){return a});return new g.Promise(function(a,b){k.then(function(d){i.processing(!0),h.loadEnumsPromise(d).then(function(b){i.processing(!1),a(c(b))}).catch(function(a){i.processing(!1),b(a)})}).catch(function(a){b(a)})})}},k=function(a,b,c,d){return j.getRessources(a.$params.$url,function(a){return a})};f.registerDataProvider("form-meta",k)}(b=a.Data||(a.Data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(a){var b;!function(b){var c=(a.ulocale,a.utils),d=(a.ajax,a.dom),e=(a.link,function(){function a(a,b,c){var d=this;d._fieldList=a||[],d._oldFilter=[],d._cb=b||null,d._options=c||{},d._nodeMain=$("<div class='form-inline bs-filterexpress' id='"+d._options.id+"'></div>")}return Object.defineProperty(a.prototype,"fields",{get:function(){return this._fieldList},set:function(a){var b=this;b._fieldList=a&&Array.isArray(a)&&a.length?a:b._fieldList,b.renderFieldsList(),b.renderSelectedFields()},enumerable:!0,configurable:!0}),a.prototype._getFieldByCode=function(a){var b=this,c=null;return b._fieldList.forEach(function(b){b.code===a&&(c=b)}),c},a.prototype._getEditField=function(a){var b;switch(a.format){case h.FORMAT_INTEGER:b="<input type='number' class='form-control' aria-label='...'>";break;case h.FORMAT_STRING:b="<input type='text' class='form-control' aria-label='...'>";break;case h.FORMAT_ENUM:b="<select class='form-control'>",a.enum&&a.enum.forEach(function(c,d){var e=a.enumNames&&a.enumNames[d]?a.enumNames[d]:c;b+="<option value='"+c+"'>"+e+"</option>"}),b+="</select>"}return $(b)},a.prototype._getOpField=function(a){var b;switch(a.format){case h.FORMAT_INTEGER:b=h.OP_INTEGER;break;case h.FORMAT_STRING:b=h.OP_STRING;break;case h.FORMAT_ENUM:b=h.OP_ENUM;break;default:b=""}return b},a.prototype._checkFilter=function(a){return!a||""!=a.code&&""!=a.op},a.prototype.destroy=function(){
// Events
var a=this;a._nodeValidate.off("click"),a._nodeMain.off("blur"),
//supprimer les events du render focus, keyup, change
// Nodes
// Variables
a._fieldList=null,a._cb=null,
//that._selectedField = null;
a._nodeMain=null,a._nodeValidate=null,a._options=null},a.prototype.renderFieldsList=function(){},a.prototype.renderSelectedFields=function(){},a.prototype.validerFilter=function(){},a.prototype.setEvents=function(){var a=this;a._nodeValidate.click(function(){a.validerFilter()})},a}()),f=function(a){function b(b,c,e){a.call(this,b,c,e);var f=this,g=$("<div class='input-group'></div>"),i=$("<div class='input-group-btn'></div>"),j="<button type='button' ";j+="class='btn btn-default dropdown-toggle' data-toggle='dropdown' ",j+="aria-haspopup='true' aria-expanded='false'></button>";var k=$(j);f._nodeSelectButtonTxt=$("<span>"+h.FIELD_SELECT_TEXT_DEFAULT+" </span>");var l=$("<span class='caret'></span>");f._nodeSelectList=$("<ul class='dropdown-menu'></ul>"),
// Add editNode
f._nodeEdit=$("<input type='text' class='form-control' aria-label='...'>");
// Add validateNode
var m=$("<div class='input-group-btn'></div>");f._nodeValidate=$("<button class='btn btn-default' type='button'><span class='"+d.iconClass(h.VALIDATE_ICON_DEFAULT)+"'></span> "+h.VALIDATE_TEXT_DEFAULT+"</button>"),
// Append nodes to mainNode
f._nodeMain.append(g),g.append(i),g.append(f._nodeEdit),g.append(m),i.append(k),i.append(f._nodeSelectList),k.append(f._nodeSelectButtonTxt),k.append(l),m.append(f._nodeValidate),f.renderFieldsList(),f.renderSelectedFields(),f.setEvents()}return __extends(b,a),b.prototype.renderSelectedFields=function(){var a=this,b=null;if(a._fieldList.every(function(a){return!a.selected||(b=a,!1)}),!b&&a._fieldList&&a._fieldList.length&&(a._fieldList[0].selected=!0,b=a._fieldList[0]),b&&(a._nodeSelectButtonTxt.text(b.lib+" "),a._changeEditField(b)),
// Style changed
a._nodeSelectedLi&&a._nodeSelectedLi.removeClass("bs-row-selected"),b){var c=d.query(a._nodeSelectList.get(0),"li[data-value='"+b.code+"']");c&&(a._nodeSelectedLi=$(c),a._nodeSelectedLi.addClass("bs-row-selected"))}},b.prototype._changeEditField=function(a){var b=this;b._removeEvents();var c,e;e=b._getEditField(a).get(0),c=b._nodeEdit.get(0);var f=c.parentNode;f.replaceChild(e,c),b._nodeEdit=$(e),e.focus(),
// events 
a.enum?(d.addClass(b._nodeValidate.get(0),"bs-none"),b._nodeEdit.change(function(a){a.target===b._nodeEdit.get(0)&&b.validerFilter()}),b._nodeEdit.get(0).style.borderTopRightRadius="4px",b._nodeEdit.get(0).style.borderBottomRightRadius="4px"):(d.removeClass(b._nodeValidate.get(0),"bs-none"),
// touch enter event
b._nodeEdit.keyup(function(a){13==a.keyCode&&b.validerFilter()}),
// input focus event
b._nodeEdit.focus(function(a){b._nodeEdit.get(0).select()}))},b.prototype._removeEvents=function(){var a=this;a._nodeEdit.off("focus"),a._nodeEdit.off("keyup"),a._nodeEdit.off("change")},b.prototype.renderFieldsList=function(){var a=this;d.empty(a._nodeSelectList.get(0)),a._fieldList.forEach(function(b){a._nodeSelectList.append("<li class='bs-cursor-p' data-value='"+b.code+"'><a>"+b.lib+"</a></li>")})},b.prototype.setEvents=function(){var b=this;a.prototype.setEvents.call(this),
// Change field event
b._nodeSelectList.click(function(a){var c=d.findByAttribute(a.target,b._nodeSelectList.get(0),"data-value");if(c){var e=c.attributes["data-value"].value;if(e){var f=b._getFieldByCode(e);b._fieldList=b._fieldList.map(function(a){return a.selected=a.code==e,a}),f&&b.renderSelectedFields()}}});var c=!1;b._nodeMain.get(0).addEventListener("focusout",function(a){c=!0;var e=!1,f=a.relatedTarget;if(f){var g=f;do{if(!g)break;if(d.hasClass(g,"bs-filterexpress")){e=!0;break}g=g.parentNode}while(g&&!e)}if(!e&&a.target==b._nodeEdit.get(0)&&b._oldFilter&&b._oldFilter.length&&b._oldFilter[0].code){var h=b._getSelected();h&&h.code!==b._oldFilter[0].code&&(b._fieldList=b._fieldList.map(function(a){return a.selected=a.code==b._oldFilter[0].code,a}),b.renderSelectedFields()),b._nodeEdit.val(b._oldFilter[0].values[0])}},!0),b._nodeMain.get(0).addEventListener("blur",function(a){if(!c){var e=!1,f=a.relatedTarget||a.explicitOriginalTarget;if(f){var g=f;do{if(!g)break;if(d.hasClass(g,"bs-filterexpress")){e=!0;break}g=g.parentNode}while(g&&!e)}if(!e&&a.target==b._nodeEdit.get(0)&&b._oldFilter&&b._oldFilter.length&&b._oldFilter[0].code){var h=b._getSelected();h&&h.code!==b._oldFilter[0].code&&(b._fieldList=b._fieldList.map(function(a){return a.selected=a.code==b._oldFilter[0].code,a}),b.renderSelectedFields()),b._nodeEdit.val(b._oldFilter[0].values[0])}}},!0)},b.prototype.validerFilter=function(){var a=this;if(a._cb){var b=a._getSelected(),c=a._nodeEdit.val()?{code:b.code,op:a._getOpField(b),values:[a._nodeEdit.val()]}:null;c&&!a._checkFilter(c)&&(c=null),a._oldFilter.splice(0),c&&a._oldFilter.push(c),a._cb(c)}},b.prototype._getSelected=function(){var a=this,b=null;return a._fieldList.every(function(a){return!a.selected||(b=a,!1)}),b},b}(e),g=function(a){function b(b,c,e){a.call(this,b,c,e);var f=this;f.leftTools=$('<div class="input-group-btn"></div>'),f.rightTools=$('<div class="input-group-btn"></div>'),f._nodeValidate=$("<button class='btn btn-default' type='button'><span class='"+d.iconClass(h.VALIDATE_ICON_DEFAULT)+"'></span> "+h.VALIDATE_TEXT_DEFAULT+"</button>");var g=$('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span>&nbsp;<span class="sr-only">Toggle Dropdown</span></button>');f._nodeSelectList=$('<ul class="dropdown-menu dropdown-menu-left">'),f.rightTools.append(f._nodeValidate),f.leftTools.append(g),f.leftTools.append(f._nodeSelectList),f.renderFieldsList(),f.renderSelectedFields(),f.setEvents()}return __extends(b,a),b.prototype.renderSelectedFields=function(){var a=this;d.empty(a._nodeMain.get(0)),a._fieldList.forEach(function(b){b.selected&&a.addField(b)});var b,c;a._nodeMain.get(0).childNodes.length?(b=$(a._nodeMain.get(0).firstChild),c=$(a._nodeMain.get(0).lastChild)):(b=$('<div class="input-group"></div>'),c=b,a._nodeMain.append(b)),c.append(a.rightTools),$(b.get(0).firstChild).before(a.leftTools)},b.prototype.addField=function(a){var b=this;a.composant={label:$('<span class="input-group-addon" id="sizing-addon2">'+(a.lib||a.libelle||a.code)+"</span>"),value:b._getEditField(a)};var c=$('<div class="input-group"></div>');c.append(a.composant.label),c.append(a.composant.value),b._nodeMain.append(c),a.selected=!0},b.prototype.renderFieldsList=function(){var a=this;d.empty(a._nodeSelectList.get(0)),a._fieldList.forEach(function(b){a._nodeSelectList.append('<li class="bs-cursor-p" data-value="'+b.code+'"><a href="#" tabIndex="-1"><input type="checkbox" '+(b.selected?"checked":"")+" />&nbsp;"+(b.lib||b.libelle||b.code)+"</a></li>")})},b.prototype.setEvents=function(){var b=this;a.prototype.setEvents.call(this),b._nodeSelectList.on("click",function(a){var c=d.findByAttribute(a.target,b._nodeSelectList.get(0),"data-value");if(c){var e=$(c),f=e.attr("data-value");if(f){var g=e.find("input"),h=b._getFieldByCode(e.attr("data-value"));return h&&(h.selected?(setTimeout(function(){g.prop("checked",!1)},0),h.selected=!1):(setTimeout(function(){g.prop("checked",!0)},0),h.selected=!0),b.renderSelectedFields()),$(a.target).blur(),!1}}})},b.prototype.validerFilter=function(){var a=this;if(a._cb){var b=[];a._fieldList.forEach(function(c){if(c.selected){var d=c.composant.value.val();if(d){var e={code:c.code,op:a._getOpField(c),values:[d]};a._checkFilter(e)&&b.push(e)}}}),a._oldFilter.splice(0),a._oldFilter=b,a._cb(b.length?b:null)}},b}(e),h=function(){/*******************************
            ************ METHODS
            *******************************/
function a(a,b,d){var e=this;a=e._completeFieldList($.extend(!0,[],a)),e._cb=b;var h={id:c.allocID(),multiple:!1};e._options=$.extend(!0,h,d),e._options.multiple?e._render=new g(a,e._cb,e._options):e._render=new f(a,e._cb,e._options)}
// Called at instanciation of component
// Constants
// "Valider"
return Object.defineProperty(a.prototype,"fields",{get:function(){return this._render.fields},set:function(a){var b=this;b._render.fields=a&&Array.isArray(a)?b._completeFieldList($.extend(!0,[],a)):[]},enumerable:!0,configurable:!0}),a.prototype.destroy=function(){var a=this;
// Events
a._render.destroy(),d.find(this._nodeParent[0],a._options.id).remove(),a._render=null,a._cb=null,a._options=null},a.prototype.render=function(a){var b=this;b._nodeParent=a,a.append(b._render._nodeMain)},a.prototype._completeFieldList=function(a){return a.forEach(function(a){a.enum&&Array.isArray(a.enum)?(a.format="enum",a.enum.splice(0,0,""),a.enumNames&&a.enumNames.splice(0,0,"")):a.format="number"===a.type?"integer":a.type}),a},a.FIELD_SELECT_TEXT_DEFAULT="Choix du champ",a.VALIDATE_TEXT_DEFAULT="",a.VALIDATE_ICON_DEFAULT="search",a.FORMAT_STRING="string",a.FORMAT_INTEGER="integer",a.FORMAT_ENUM="enum",a.OP_STRING="like",a.OP_INTEGER="in",a.OP_ENUM="in",a}();b.FilterExpress=h}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/core/core.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.DatasetPlugin,d=a.dom,e=function(){function a(a,b){var c=this;c._init=!1,c._options=b||{},c._notify=b.notify,c._ds=a||{},c._ds.mapping=c._ds.mapping||{},c._ds.mapping.code=c._ds.mapping.code||"code",c._ds.mapping.libelle=c._ds.mapping.libelle||c._ds.mapping.lib||"lib";var d=a.data.$params||{};c._pageSize=d.$top||null,c.searchText=null,c._count=0,c._page=0,c._items=[],c._initData()}return a.prototype._initData=function(){var a=this,b={},e=a._ds.data||{},f={name:"dataset",$type:e.$type||"odata",$params:{$entity:e.$params.$entity,$module:e.$params.$module,$top:1}};d.processing(!0),c.executeDatasets([f],{},b,null,function(c,e){if(d.processing(!1),!e){a._init=!0;var f=b.dataset;a._count=f.count,a._notify(null,{inited:!0,updated:!0})}},!1)},Object.defineProperty(a.prototype,"items",{get:function(){return this._items},set:function(a){a&&(this._items=a,this._notifyChange("items"))},enumerable:!0,configurable:!0}),a.prototype._notifyChange=function(a){var b=this;switch(a){case"items":b._notify(b.items,{})}},a.prototype.getNbPages=function(){var a=this;return Math.ceil(a._count/a._pageSize)},a.prototype._getSkip=function(a){var b=this;return b._pageSize?a*b._pageSize:0},a.prototype._getPage=function(a,b){var e=this;if(e._init){var f=$.extend(!0,{},e._ds.data),g={};f.name="dataset",f.$params=f.$params||{},f.$params.$skip=e._getSkip(a),b=b||{},e.searchText&&(b.$searchText=e.searchText),d.processing(!0),c.executeDatasets([f],b,g,null,function(a,b){if(d.processing(!1),!b){var c=g.dataset;c&&e._count!=c.count&&(e._count=c.count,e._page=0,e._notify(null,{updated:!0})),c.documents&&(c.documents=c.documents.map(function(a){return{code:a[e._ds.mapping.code],libelle:a[e._ds.mapping.libelle]}}),e.items=c.documents)}},!1)}},a.prototype.currentPage=function(){return this._page},a.prototype.toPage=function(a){var b=this;a>=0&&a<b.getNbPages()&&(b._page=a,b._getPage(a))},a.prototype.nextPage=function(){var a=this,b=a._page+1;b<a.getNbPages()&&(a._page=b,a._getPage(b))},a.prototype.prevPage=function(){var a=this,b=a._page-1;b>=0&&(a._page=b,a._getPage(b))},a.prototype.firthPage=function(){var a=this;a._page=0,a._getPage(0)},a.prototype.lastPage=function(){var a=this,b=a.getNbPages()-1;a._page=b,a._getPage(b)},a.prototype.search=function(a){var b=this;b.searchText=a?a:null,b._ds.data.$params.$search&&b._getPage(0)},a.prototype.remove=function(){},a}();b.DsLookup=e}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/core/modules/locale.ts" />
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
/// <reference path="./filter-lookup.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.uiutils,f=a.ulocale,g=a.dom,h=a.Observable.SchemaUtils,i=function(){function a(){this.liste=[]}return a.prototype.add=function(a,b,c,d){var e=this,f={code:a,libelle:b||a,isBinary:c,options:d||{}};f.options.symbol=d.symbol||b||a,c&&(f.options.liaison=f.options.liaison||"et"),e.liste.push(f)},a.prototype.gets=function(){return this.liste},a.prototype.get=function(a){return this.liste.find(function(b){return b.code==a})},a.prototype.remove=function(a){var b=this.liste.findIndex(function(b){return b.code==a});b>=0&&this.liste.splice(b,1)},a}();b.ListeOperateurs=i;var j=function(){function a(){this.liste=[]}return a.prototype.add=function(a,b,c,d){var e=this;e.liste.push({code:a,libelle:b||a,type:c||"string",options:d||{}})},a.prototype.get=function(a){return this.liste.find(function(b){return b.code==a})},a.prototype.gets=function(){return this.liste},a.prototype.remove=function(a){var b=this.liste.findIndex(function(b){return b.code==a});b>=0&&this.liste.splice(b,1)},a}();b.ListeChamps=j;var k=function(){function a(a,b,c,d){var e=this;e.id=a,e.code=b,e.op=c,e.values=d||[]}return a.prototype.getValues=function(){return this.values.map(function(a){return a&&a.code?a.code:a})},a.prototype.getValueNames=function(){return this.values.map(function(a){return a&&a.lib?a.lib:a})},a}();b.Filter=k;var l=function(){function a(a){this.liste=[],this.filters=a,this.compteur=0}
//getCode(values) {
//    let id = -1;
//    this.liste.forEach(function (filter) {
//        let isOK = true;
//        if (Array.isArray(values)) {
//            values.forEach(function (v, indexV) {
//                if (filter.values[indexV] && v != filter.values[indexV]) {
//                    isOK = false;
//                    return false;
//                }
//            });
//        }
//        else if (filter.values[0] != values)
//            isOK = false;
//        if (isOK) {
//            code = filter.code;
//            return false;
//        }
//    });
//    return code;
//}
return a.prototype.add=function(a,b,c){var d=this,e=new k(d.compteur++,a,b,c);return d.liste.push(e),d.filters.push(e),e},a.prototype.add2=function(a,b,c){var d=this,e=new k(d.compteur++,a,b,c);return d.liste.push(e),e},a.prototype.set=function(a,b){var c,d=this,e=-1;if(d.liste.forEach(function(b,d){b.id==a&&(c=b,e=d)}),c&&(c.op=b.op,c.values=b.values||[]),e>=0&&e<d.filters.length){var f=d.filters.get(e);f&&(f.code=c.code,f.op=c.op,f.values=c.values)}return c},a.prototype.get=function(a){return this.liste.find(function(b){return b.id==a})},a.prototype.getByIndex=function(a){return this.liste[a]},a.prototype.gets=function(){return this.liste},a.prototype.getsByChamp=function(a){var b=[];return this.liste.forEach(function(c){c.code==a&&b.push(c)}),b},a.prototype.remove=function(a){var b=this,c=b.liste.findIndex(function(b){return b.id==a});c>=0&&(b.liste.splice(c,1),b.filters.remove(b.filters.get(c)))},a.prototype.removeAll=function(){var a=this;a.liste.splice(0),a.filters.forEach(function(b,c){a.filters.remove(a.filters.get(c))})},a.prototype.removeAllByChamp=function(a){var b=this;b.liste.forEach(function(c,d){c.code==a&&(b.liste.splice(d,1),b.filters.remove(b.filters.get(d)))})},a}();b.ListeFilters=l;var m=function(){function a(){this.liste=[]}return a.prototype.addType=function(a,b,c){this.liste.push({code:a,libelle:b||a,operateurs:c||[]})},a.prototype.addOperateur=function(a,b){this.liste.find(function(b){return b.code==a}).operateurs.push(b)},a.prototype.getOperateurs=function(a){return this.liste.find(function(b){return b.code==a}).operateurs},a}();b.ListeTypes=m;var n=function(){function a(a,b,c,d,e,f){this.listeChamps=a,this.listeFilters=b,this.listeOperateurs=c,this.filter=f,this.callBack=d,this.options=e||{},this.data={},this.init()}return a.prototype.init=function(){var a=this;a.model={type:"object",properties:{filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},selected:{type:"string"}}}}},links:{validate:{title:"Valider",isHidden:1!=a.options.btnValidate}}},a.layout={name:"form",$type:"block",$items:[{$type:"block",$items:[{$type:"block",$items:[{$bind:"filters",$widget:"tagview"}]},{$type:"block",$inline:!0,$items:[{$bind:"$links.validate",options:{type:"success",right:!0}}]}],$title:{value:"Filtres sélectionnés",size:5,style:""}}]},a.data.filters=a.listeFilters.gets().map(function(b){var c=a.listeOperateurs.get(b.op),d=a.listeChamps.get(b.code),e=d.libelle+" "+c.options.symbol+" ";return e+=c.isBinary?b.values[0]+" "+c.options.liaison+" "+b.values[1]:b.getValueNames().join(", "),{code:b.id,libelle:e,selected:!(!a.filter||a.filter.id!=b.id)}})},a.prototype.render=function(a){var b=this;a&&c.OpenForm($(a),b.layout,b.model,b.data,{},function(a,c,d){switch(a.property){case"upd":b.callBack("EDIT",{id:a.actionParams.code});break;case"remove":b.callBack("REMOVE",{id:a.actionParams.code});break;case"$links.validate":b.callBack("VALIDE",{})}})},a}(),o=function(){function a(a,b,c){this.valueModel=null;var d=this;d.type=a,d.op=b,d.options=$.extend(!0,{},c),d.valueModel=d.getInstance()}return a.prototype.getInstance=function(){var a=this,b=a.addDefaultOptions(a.options);return a.op.isBinary?new s(b):"vide"===a.op.code||"nvide"===a.op.code?new q(b):"enum"===a.type?new u(b):"lookup"===a.type?new v(b):"in"!==a.op.code&&"nin"!==a.op.code||"decimal"==a.type||"money"==a.type||"date"==a.type?new r(b):new t(b)},a.prototype.init=function(a){this.valueModel.init(a)},a.prototype.addDefaultOptions=function(a){var b=this;switch(b.type){case"integer":a.type="number";break;case"decimal":a.type="number",
// "symbol": "jours",
// "decimals": 0
a.decimals=a.decimals||5;break;case"money":a.type="number",a.format="money";break;case"date":a.type="string",a.format="date",a.title="Date";break;default:a.type=b.type||"string"}return a},a.prototype.getModel=function(){return this.valueModel?this.valueModel.getModel():null},a.prototype.getLayout=function(){return this.valueModel?this.valueModel.getLayout():null},a.prototype.getData=function(){return this.valueModel?this.valueModel.getData():null},a.prototype.getValues=function(){return this.valueModel?this.valueModel.getValues():null},a.prototype.setValues=function(a,b){return this.valueModel?this.valueModel.setValues(a,b):null},a.prototype.setValuesByFilter=function(a){this.valueModel&&this.valueModel.setValuesByFilter(a)},a}(),p=function(){function a(a){}return a.prototype.init=function(a){a&&a()},a.prototype.getModel=function(){return this.model},a.prototype.getLayout=function(){return this.layout},a.prototype.getData=function(){return this.data},a.prototype.getValues=function(){},a.prototype.setValues=function(a,b){},a.prototype.setValuesByFilter=function(a){},a}(),q=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.prototype.getValues=function(){return[""]},b}(p),r=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value:{title:c.options.title||"Valeur",type:c.options.type||"string"}},states:{value:{isMandatory:!0}}},c.options.format&&(c.model.properties.value.format=c.options.format),c.options.decimals&&(c.model.properties.value.decimals=c.options.decimals),c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:12}]},c.data={value:null}}return __extends(b,a),b.prototype.getValues=function(){return this.data.value?[this.data.value]:null},b.prototype.setValues=function(a){this.data.value=a.value},b.prototype.setValuesByFilter=function(a){this.data.value=a[0]},b}(p),s=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value1:{title:(b.title||"Valeur")+" 1",type:b.type||"string"},value2:{title:(b.title||"Valeur")+" 2",type:b.type||"string"}},states:{value1:{isMandatory:!0},value2:{isMandatory:!0}}},c.options.format&&(c.model.properties.value1.format=c.options.format,c.model.properties.value2.format=c.options.format),c.options.decimals&&(c.model.properties.value1.decimals=c.options.decimals,c.model.properties.value2.decimals=c.options.decimals),c.layout={name:"filter-value",$type:"block",$items:[{$type:"row",$items:[{$items:[{$bind:"value1",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6},{$items:[{$bind:"value2",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6}]}]},c.data={value1:null,value2:null}}return __extends(b,a),b.prototype.getValues=function(){var a=this;return a.data.value1&&a.data.value2?[a.data.value1,a.data.value2]:null},b.prototype.setValues=function(a){this.data.value1=a.value1,this.data.value2=a.value2},b.prototype.setValuesByFilter=function(a){this.data.value1=a[0],this.data.value2=a[1]},b}(p),t=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value:{title:"Valeur",type:"string"}},states:{value:{isMandatory:!0}}},c.options.format&&(c.model.properties.value.format=c.options.format),c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:'Une ou plusieurs valeurs (séparées par un ";" : val1;val2;...)'}}],$colSize:12}]},c.data={value:null}}return __extends(b,a),b.prototype.getValues=function(){var a=this;if(!a.data.value)return null;var b=a.data.value.split(";");return"number"==a.options.type&&(b=b.map(function(a){return parseInt(a,10)})),b},b.prototype.setValues=function(a){var b=this;if(a.value){var c=a.value.split(";");c=c.map(function(a){return a.replace(/\"/g,"")});var d=[];c.forEach(function(a){"number"==b.options.type?new RegExp("^[0-9]+$").test(a)&&d.push(a):d.push(a)}),b.data.value=d.join(";")}},b.prototype.setValuesByFilter=function(a){this.data.value=a.join(";")},b}(p),u=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.options.enumName=c.options.enumName||c.options.champName,c.model={type:"object",properties:{value:{title:"List",type:"array",items:{type:"string",enums:{},$enumref:"list"}}},states:{value:{isMandatory:!0}}},c.model.properties.value.items.enums[c.options.enumName]={type:"default",enum:[],enumNames:[]},c.model.properties.value.items.$enumref=c.options.enumName,c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"enums-list",options:{titleIsHidden:!0}}],$colSize:12}]},c.options.enum&&c.options.enum.forEach(function(a){c.model.properties.value.items.enums[c.options.enumName].enum.push(a.code),c.model.properties.value.items.enums[c.options.enumName].enumNames.push(a.libelle||a.code)}),c.data={value:[]}}return __extends(b,a),b.prototype.getValues=function(){var a=this;return a.data.value&&a.data.value.length?a.data.value.map(function(b){var c=null;return a.options.enum.forEach(function(a,d){if(b==a.code)return c=a,!1}),{code:b,lib:c.libelle||c.lib||b}}):[]},b.prototype.setValues=function(a){this.data.value=a.value},b.prototype.setValuesByFilter=function(a){this.data.value=a.map(function(a){return a.code})},b}(p),v=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value:{title:"List",type:"array",ds:c.options.lookupSchema||null,items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}},states:{value:{isMandatory:!0}}},c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"lookup-list",options:{titleIsHidden:!0}}],$colSize:12}]},c.data={value:[]}}return __extends(b,a),b.prototype.getValues=function(){var a=this;return a.data.value&&a.data.value.length?a.data.value:[]},b.prototype.setValues=function(a){this.data.value=a.value},b.prototype.setValuesByFilter=function(a){this.data.value=a},b}(p),w=function(){function a(a,b,c,d,e,f,g){this.champ=a,this.filter=f,this.listeFilters=b,this.listeOperateurs=c,this.listeTypes=d,this.callBack=e,this.options=g||{},this.data={operateur:null,values:[]}}return a.prototype.renderOperateur=function(){var a=this,b={type:"object",properties:{champ:{title:"Filtre",type:"string"},operateur:{title:"Opérateur",type:"string",enum:[],enumNames:[]}},states:{champ:{isReadOnly:!0,isHidden:0==a.options.showLabel},operateur:{isHidden:0==a.options.showOperateur}}},d={name:"filter-operateur",$type:"block",$items:[{$type:"block",$items:[{$bind:"champ",$readOnly:!0,options:{$expression:"{{champ}}"}},{$bind:"operateur",options:{titleIsHidden:!0}}]}]},e=b.properties;b.states;
// Champ
a.data.champ=a.champ.libelle;
// Opérateurs
var f=a.champ.options.format||a.champ.type;if(e.operateur.enum=a.listeTypes.getOperateurs(f),e.operateur.enum.forEach(function(b){e.operateur.enumNames.push(a.listeOperateurs.get(b).libelle)}),a.filter?a.data.operateur=a.filter.op:a.data.operateur=e.operateur.enum[0],0!=a.options.showLabel||0!=a.options.showOperateur){var h=g.query(a.container,".operateur");if(h){var i=c.formManager().formByName("filter-operateur");c.removeForm(i),c.OpenForm($(h),d,b,a.data,{},function(b,c,d){switch(b.property){case"operateur":if("propchange"==b.operation){var e=a.listeOperateurs.get(c.model().operateur);a.data.operateur=c.model().operateur,a.renderValue(e)}}})}}},a.prototype.renderValue=function(a){var b=this,d=g.query(b.container,".value");if(d){var e=c.formManager().formByName("filter-value");c.removeForm(e);var f=b.champ.options||{};f.champName=b.champ.code,b.modelType=new o(b.champ.options.format||b.champ.type,a,f),b.modelType&&b.modelType.init(function(){var a=b.modelType.getModel(),e=b.modelType.getLayout();if(a&&e){var f=void 0;b.filter&&b.modelType.setValuesByFilter(b.filter.values),f=b.modelType.getData(),c.OpenForm($(d),e,a,f,{},function(a,c,d){switch(a.operation){case"propchange":b.modelType.setValues(c.model()),b.data.values=b.modelType.getValues();break;default:b.modelType.setValues(c.model()),b.data.values=b.modelType.getValues()}})}else b.data.values=b.modelType.getValues()})}},a.prototype.renderButton=function(){var a=this,b={type:"object",properties:{},links:{add:{title:"Ajouter"}}},d={name:"filter-link",$type:"block",$items:[{$inline:!0,$items:[{$bind:"$links.add",options:{type:"primary",icon:"plus",right:!0}}],$colSize:12}]},e=g.query(a.container,".link");if(e){var f=c.formManager().formByName("filter-link");c.removeForm(f),c.OpenForm($(e),d,b,a.data,{},function(b,d,e){switch(b.property){case"$links.add":var f=c.formManager(),g=f.formByName("filter-value");if(!d.validate()||g&&!g.$model.validate())return;d.model();a.data.values&&a.data.values.length&&a.callBack({code:a.champ.code,op:a.data.operateur,values:a.data.values})}})}},a.prototype.render=function(a){var b=this,c=["<div>",'<div class="operateur">',"</div>",'<div class="value">',"</div>",'<div class="link">',"</div>","</div>"];a&&(b.container=a,g.empty(a),g.append(a,$(c.join("")).get(0)),b.renderOperateur(),b.renderValue(b.listeOperateurs.get(b.data.operateur)),b.renderButton())},a}(),x=function(){function a(a,b,c,d,e,f){this.listeChamps=a,this.listeChampsArbre=b,this.listeFilters=c,this.listeOperateurs=d,this.listeTypes=e,this.options=f||{}}return a.prototype.createContainer=function(){var a=this,b=['<div class="row">','<div class="col-sm-5 champ-list">',"</div>",'<div class="col-sm-7 filter-edit">',"</div>","</div>",'<div class="row">','<div class="col-sm-12 filter-list">',"</div>","</div>"];a.container=document.createElement("div"),g.addClass(a.container,"filter-view"),a.container.innerHTML=b.join(""),a.champListView=g.query(a.container,".champ-list"),a.filterListView=g.query(a.container,".filter-list"),a.filterEditView=g.query(a.container,".filter-edit")},a.prototype.render=function(){var a=this;return a.createContainer(),a.listeChamps.gets().length&&(a.showChampList(),a.selecteChamp(a,a.listeChamps.gets()[0].code)),a.container},a.prototype.showChampList=function(){
// let that = this;
// let list = $('<div class="list-group"></div>').get(0);
// list.addEventListener("click", function (event) {
//     item = <HTMLLinkElement>event.target;
//     if (item["href"]) {
//         var href = _dom.attr(item, 'href');
//         if (href === '#') {
//             event.preventDefault();
//             event.stopPropagation();
//         }
//     }
//     let champCode = _dom.attr(item, "data-code");
//     if (champCode)
//         that.selecteChamp(that, champCode);
// }, false);
// let listHeightSize = 70 * (that.options.listSize || 7);
// let containerScroll = $('<div style="overflow-y:auto;max-height:' + listHeightSize + 'px;"></div>').get(0);
// _dom.append(containerScroll, list);
// _dom.append(that.champListView, containerScroll);
// let item = $('<a href="#" class="list-group-item"></a>').get(0);
// that.listeChamps && that.listeChamps.gets().forEach(function (champ, key) {
//     let itemClone = <HTMLLinkElement>item.cloneNode(true);
//     _dom.attr(itemClone, "data-code", champ.code);
//     _dom.text(itemClone, champ.libelle);
//     _dom.append(list, itemClone);
// });
var a=this;a._multiSelectList=new b.MultiSelectList(this.listeChampsArbre,{maxHeight:"auto"},function(b){b&&b.data.name&&a.selecteChamp(a,b.data.name)});var c=70*(a.options.listSize||7),d=$('<div style="border: 1px solid #dddddd; overflow:auto;max-height:'+c+'px;"></div>').get(0);a._multiSelectList.render(d),g.append(a.champListView,d)},a.prototype.selecteChamp=function(a,b){
// let oldItem = _dom.query(that.champListView, ".active");
// let newItem = _dom.query(that.champListView, 'a[data-code="' + codeChamp + '"]');
// if (oldItem)
//     _dom.removeClass(oldItem, "active");
// if (newItem)
//     _dom.addClass(newItem, "active");
a._multiSelectList.addItem(b),a.updateFilter(a,b);var c=a.listeFilters.getsByChamp(b),d=null;c&&c.length&&(d=c[0]),a.showFilterList(a,d)},a.prototype.showFilterList=function(a,b){var c=new n(a.listeChamps,a.listeFilters,a.listeOperateurs,function(b,c){if("EDIT"==b){var d=a.listeFilters.get(c.id);d&&a.selecteChamp(a,d.code)}else"REMOVE"==b?a.removeFilter(a,c.id):"VALIDE"==b&&a.valideFilters()},a.options,b);g.empty(a.filterListView),c.render(a.filterListView)},a.prototype.updateFilter=function(a,b){var c=a.listeChamps.get(b),d=a.listeFilters.getsByChamp(b),e=null;d&&d.length&&(e=d[0]);var f=new w(c,a.listeFilters,a.listeOperateurs,a.listeTypes,function(b){a.addFilter(a,b)},e,a.options);g.empty(a.filterEditView),f.render(a.filterEditView)},a.prototype.addFilter=function(a,b){var c,d=a.listeFilters.getsByChamp(b.code);c=!a.options.multiple&&d&&d.length?a.listeFilters.set(d[0].id,b):a.listeFilters.add(b.code,b.op,b.values),a.showFilterList(a,c)},a.prototype.removeFilter=function(a,b){var c=a.listeFilters.get(b).code;a.listeFilters.remove(b),a.selecteChamp(a,c)},a.prototype.valideFilters=function(){},a}(),y=function(a){function b(b,c,d,e,f,g,h){var i={btnValidate:!0};a.call(this,b,c,d,e,f,$.extend(!0,i,g)),this._callback=h}return __extends(b,a),b.prototype.createContainer=function(){var a=this,b=['<div class="row">','<div class="col-sm-12 filter-list">',"</div>","</div>",'<div class="row">','<div class="col-xs-12">','<h5 class="bs-block-title" data-ignore="true">'+(a.options.title||"Filtre")+"</h5>","</div>","</div>",'<div class="row">','<div class="col-sm-4 champ-list">',"</div>",'<div class="col-sm-8 filter-edit">',"</div>","</div>"];a.container=document.createElement("div"),g.addClass(a.container,"filter-view"),a.container.innerHTML=b.join(""),a.champListView=g.query(a.container,".champ-list"),a.filterListView=g.query(a.container,".filter-list"),a.filterEditView=g.query(a.container,".filter-edit")},b.prototype.valideFilters=function(){this._callback("VALIDE")},b}(x),z=function(a){function b(b,c,d){a.call(this,b,c,d);var e=this;d.registerListenerFor(e.$bind+".$item",e),this._state()}return __extends(b,a),b.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},b.prototype.click=function(a){var b=this,c=a.target;if("LI"==c.nodeName.toUpperCase()||"I"==c.nodeName.toUpperCase()){var d=c;"I"==c.nodeName.toUpperCase()&&(d=g.parentByTag(b.$element.get(0),c,"LI"));var e=-1;if(d&&(e=parseInt(g.attr(d,"data-id"),10)),e<0)return;d=null;var f=null;if(b.state.value.forEach(function(a,b){if(a.code==e)return f=a.model(),!1}),!f)return;var h=g.attr(c,"data-id");"REMOVE"==h?b.form.execAction("remove",f):b.form.execAction("upd",f)}},b.prototype._state2UI=function(){var a=this;a.createContainer(a.id),a.state.value&&a.state.value.forEach(function(b){a.addTag(b)})},b.prototype.destroy=function(){var b=this;b.form.unRegisterListenerFor(b.$bind+".$item",b),a.prototype.destroy.call(this)},b.prototype.changed=function(a,b,c,d,e){var f=this;"add"==d?f.addTag(c):"remove"==d&&f.removeTag(e.$value.code)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;e&&d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,c.setHidden(e))},b.prototype.addTag=function(a){var b=this,c=document.createElement("li");g.addClass(c,"item"),g.addClass(c,"boxed-tags-item"),g.addClass(c,"bs-cursor-p"),g.addClass(c,"btn-primary"),a.selected&&g.addClass(c,"focus"),g.attr(c,"data-id",a.code),
//item.innerHTML = tag.libelle + ' <i data-id="UPDATE" class="glyphicon glyphicon-pencil" ></i><i data-id="REMOVE" class="glyphicon glyphicon-remove" ></i>';
c.innerHTML=a.libelle+' <i data-id="REMOVE" class="glyphicon glyphicon-remove" ></i>',g.append(b.$element.get(0),c)},b.prototype.removeTag=function(a){var b=this,c=g.query(b.$element.get(0),'li[data-id="'+a+'"]');g.remove(c)},b.prototype.createContainer=function(a){var b=this;b.$element=$(d.format('<ul id="{0}" data-render="{0}" class="boxed-tags" draggable="true"></ul>',a))},b.prototype.render=function(a){var b=this,c=b._initOptions(e.utils.defaultOptions);return b.$element||(b.setEvents(null),b._state2UI()),b.appendElement(a,c),b.$element},b}(b.AbsField);c.registerControl(z,"array",!1,"tagview");var A=function(){function a(a){var b=this;b.options=a||{},b._elements=[],b._values=[]}return Object.defineProperty(a.prototype,"elements",{get:function(){return this._elements},set:function(a){a&&(this._elements=a,this._notifyChange("elements"))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"values",{get:function(){return this._values},set:function(a){a&&(this._values=a,this._notifyChange("values"))},enumerable:!0,configurable:!0}),a.prototype._notifyChange=function(a){var b=this;switch(a){case"elements":g.empty(b.$element.get(0)),b.renderElements(b.elements||[],b.values||[],b.options||{})}},a.prototype.findVal=function(a){var b=-1;return this.values.forEach(function(c,d){if(c==a)return b=d,!1}),b},a.prototype.render=function(a){var b=this;return b.$element||(b.$element=$('<div class="row bs-checkboxlist"></div>'),b.renderElements(b.elements,b.values,b.options),b.setEvents(null)),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},a.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a.options=null},a.prototype.removeVal=function(a){var b=this,c=b.findVal(a);c>=0&&b.values.splice(c,1)},a.prototype.addVal=function(a){this.values.push(a)},a.prototype.setEvents=function(a){var b=this;b.$element&&b.$element.on("click",function(a){if(!b.options.isDisabled&&!b.options.isReadOnly){var c=g.parentByClass(b.$element.get(0),a.target,"bs-checkboxlist-list");c&&b._toggleEnumByIndex(g.indexOf(c.parentNode,c))}})},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype.renderElements=function(a,b,c){var d=this,e=document.createDocumentFragment();if(a.length){c=c||{};
//let e: HTMLElement = $('<div tabindex="0" class="bs-checkboxlist-list checkbox-inline"><div class="bs-checkboxlist-list-check"><a><center><span class="' + _dom.iconClass('square-o') + '"></span></center></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);
var f=$('<div tabindex="0" class="bs-checkboxlist-list col-lg-6 col-xs-12 checkbox-inline"><div class="bs-checkboxlist-list-check"><a><span class="'+g.iconClass("square-o")+'"></span></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);a.forEach(function(a,d){var h=f.cloneNode(!0);c.disabled?(g.attr(h,"tabindex","-1"),g.removeClass(h,"bs-pointer"),g.addClass(h,"bs-cursor-disabled")):(g.attr(h,"tabindex","0"),g.addClass(h,"bs-pointer"),g.removeClass(h,"bs-cursor-disabled"));var i=h.firstChild.firstChild.firstChild;i.className=b&&b.indexOf(a.code)>=0?g.iconClass("check-square-o"):g.iconClass("square-o");var j=h.lastChild;g.append(j,document.createTextNode(a.libelle)),g.append(e,h)})}else{var h=$('<center><div class="bs-lv-nodata">Aucun résultat trouvé ...</div></center>').get(0);g.append(e,h)}g.append(d.$element.get(0),e)},a.prototype._inputs=function(){return this.$element.get(0)},a.prototype._setItemValue=function(a,b){var c=a.firstChild.firstChild.firstChild;c.className=b?g.iconClass("check-square-o"):g.iconClass("square-o")},a.prototype._toggleEnumByIndex=function(a){var b=this;if(a>=0&&a<b.elements.length){var c=b.elements[a],d=b.findVal(c.code),e=b._inputs();d>=0?(b._setItemValue(e.childNodes[a],!1),b.removeVal(c.code),b.options.onSelectItem&&b.options.onSelectItem("remove",{id:a,value:c,data:c})):(b._setItemValue(e.childNodes[a],!0),b.addVal(c.code),b.options.onSelectItem&&b.options.onSelectItem("add",{id:a,value:c,data:c}))}},a}();b.CheckBoxList=A;var B=function(a){function b(b,c,d){a.call(this,b,c,d);var e=this;d.registerListenerFor(e.$bind+".$item",e),this._state()}return __extends(b,a),b.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},b.prototype.click=function(a){},b.prototype._state2UI=function(){},b.prototype.destroy=function(){var b=this;b.form.unRegisterListenerFor(b.$bind+".$item",b),a.prototype.destroy.call(this)},b.prototype.changed=function(a,b,c,d,e){},b.prototype.stateChanged=function(a,b){},b.prototype._createContainer=function(a,b,c,e){var f=['<div id="{0}" data-render="{0}">','<label for="{0}_input" id="{0}_label" class="'+(c?"":"bs-none")+'">'+(c||"")+"</label>",'<div id="{0}_toolbar"></div>',"<br />",'<div id="{0}_list"></div>','<center id="{0}_paginer"></center>',"</div>"];return d.format(f.join(""),a)},b.prototype._onSelectToolElement=function(a){var b=this;"search"===a.name&&b._lookup.search(a.value)},b.prototype.createToolBar=function(a,b){var d=this;if(d.$element&&!d._toolbar){var e=[{name:"search",type:"search",right:!1}];b=$.extend({selectToolElement:d._onSelectToolElement.bind(d)}),d._toolbar=new c.ToolBar(e,b);var f=g.query(d.$element.get(0),"#"+a+"_toolbar");if(!f)return;d._toolbar.render($(f))}},b.prototype._onSelectPaginer=function(a){var b=this;switch(a){case"next":b._lookup.nextPage();break;case"prev":b._lookup.prevPage();break;case"first":b._lookup.firthPage();break;case"last":b._lookup.lastPage();break;default:b._lookup.toPage(a-1)}},b.prototype.createPaginer=function(a,b){var d=this;if(d.$element){if(!d._pager){b=$.extend({size:"default",boundaryLinks:!0,selectPage:d._onSelectPaginer.bind(d)},b),d._pager=new c.Pager(b);var e=g.query(d.$element.get(0),"#"+a+"_paginer");if(!e)return;d._pager.render($(e))}var f=d._pager;f.props.totalPages=d._lookup.getNbPages(),f.props.currentPage=d._lookup.currentPage()+1}},b.prototype._onSelectCheckBoxList=function(a,b){var c=this;"add"===a?c.state.value.push({code:b.value.code,lib:b.value.libelle}):"remove"===a&&c.state.value.remove(c.state.value.find("code",b.value.code))},b.prototype._getValues=function(){var a=this,b=$.extend(!0,{},a.state.value);return b._items=b._items.map(function(a){return a.code}),b._items},b.prototype.createList=function(a,b){var d=this;if(d.$element&&!d._list){d._list=new c.CheckBoxList({onSelectItem:d._onSelectCheckBoxList.bind(d)}),d._list.values=d._getValues();var e=g.query(d.$element.get(0),"#"+a+"_list");if(!e)return;d._list.render($(e))}},b.prototype.createLookup=function(a){var b=this;if(b.$schema.ds){var d=function(a,c){c=c||{},c.inited&&c.updated?b._lookup.firthPage():a&&(b.$schema.ds.data.$params.$search&&b.createToolBar(b.id,{}),b.createList(b.id,{}),b._list.elements=a,b.createPaginer(b.id,b.renderOptions.pager))};b._lookup=new c.DsLookup(b.$schema.ds,{notify:d})}},b.prototype.render=function(a){var b=this,c=b._initOptions(e.utils.defaultOptions);return b.$element||(b.setEvents(null),b.$element=$(b._createContainer(b.id,f.tt(b.$schema.title,b.form.$locale),b.options.design,c)),b.createLookup({}),b._state2UI()),b.appendElement(a,c),b.$element},b}(b.AbsField);c.registerControl(B,"array",!1,"lookup-list",null);var C=function(a){function b(b,c,e){a.call(this,b,c,e),this.renderInternal=function(a,b){var c=this;if(c.$element){var d;switch(b.renderModel){case"model2":d=new y(c.listeChamps,c.listeChampsArbre,c.listeFilters,c.listeOperateurs,c.listeTypes,b,function(a,b){"VALIDE"==a&&c.form.execAction("validate",{})});break;default:d=new x(c.listeChamps,c.listeChampsArbre,c.listeFilters,c.listeOperateurs,c.listeTypes,b)}g.append(c.$element.get(0),d.render())}},this.createContainer=function(a){return d.format('<div id="{0}" data-render="{0}" class="bs-filter"></div>',a)},this._state(),this._options=c||{},this.initData()}return __extends(b,a),b.prototype.initData=function(){var a=this;
// reporter sur un fichier json les labels
a.listeOperateurs=new i,a.listeOperateurs.add("in","égal à",!1,{symbol:"="}),a.listeOperateurs.add("nin","différent de",!1,{symbol:"!="}),a.listeOperateurs.add("gt","supérieur à",!1,{symbol:">"}),a.listeOperateurs.add("ge","supérieur ou égal à",!1,{symbol:">="}),a.listeOperateurs.add("lt","inférieur à",!1,{symbol:"<"}),a.listeOperateurs.add("le","inférieur ou égal à",!1,{symbol:"<="}),a.listeOperateurs.add("between","entre",!0,{symbol:"entre"}),a.listeOperateurs.add("nbetween","pas entre",!0,{symbol:"pas entre"}),a.listeOperateurs.add("like","contient",!1,{symbol:"contient"}),a.listeOperateurs.add("nlike","ne contient pas",!1,{symbol:"ne contient pas"}),a.listeOperateurs.add("vide","vide",!1,{symbol:"est vide"}),a.listeOperateurs.add("nvide","pas vide",!1,{symbol:"n'est pas vide"}),a.listeTypes=new m,a.listeTypes.addType("decimal","Décimal",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("money","Money",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("integer","Entier",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("date","Date",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("string","Chaîne de caractères",["in","nin","like","nlike","vide","nvide"]),a.listeTypes.addType("enum","Enum",["in","nin","vide","nvide"]),a.listeTypes.addType("lookup","Lookup",["in","nin","vide","nvide"]),a.listeTypes.addType("boolean","Booléen",["in","nin","vide","nvide"]),a._updateData()},b.prototype._updateData=function(){var a=this;a.listeChamps=new j;var b=a.state.value&&a.state.value.champs?a.state.value.champs:[];b.forEach(function(b){var c={};b.lookup?(c.lookupSchema=h.getLookup(a.$bind,b.lookup,a.$schema,a.form.$rootSchema),c.lookup=b.lookup,c.format="lookup"):b.enum&&b.enum.length?(c.enum=b.enum,c.enumName=b.enumName,c.format="enum"):"boolean"===b.type?(c.enum=[{code:"true",libelle:"Vrai"},{code:"false",libelle:"Faux"}],c.format="enum"):(c.decimals=b.decimals,c.format=b.format||null),a.listeChamps.add(b.code,b.libelle,b.type,c)});var c=a.state.value&&a.state.value.filters?a.state.value.filters:[];a.listeFilters=new l(c),c.forEach(function(b){var c=[];b.values.forEach(function(a){c.push(a)});var d=[];b.values2&&b.values2.forEach(function(a){d.push(a)}),a.listeFilters.add2(b.code,b.op,d.length?d:c)}),a.listeChampsArbre=a.state.value&&a.state.value.entree&&a.state.value.entree.length?a.state.value.model().entree:null,a.listeChampsArbre||(a.listeChampsArbre=a.listeChamps.gets().map(function(a){return{name:a.code,title:a.libelle}}))},b.prototype.refresh=function(){var a=this;a._updateData(),g.empty(a.$element.get(0)),a.renderInternal({data:a.state.value},a._options)},b.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},b.prototype.render=function(a){var b=this,c=b._initOptions(e.utils.defaultOptions);return b.$element||(b.$element=$(b.createContainer(b.id)),g.empty(b.$element.get(0)),c.id=b.id,c.title=b.$schema.title||"",c=$.extend(!0,c,b.renderOptions),b._options=c,b.renderInternal({data:b.state.value},c)),b.appendElement(a,c),b.$element},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(b.AbsField);b.ComposantFilter=C,c.registerControl(C,"object",!1,"filter")}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/core/core.ts" />
/// <reference path="../../js/ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a,c=function(a,b,c,d,e){e=e||{};var f={code:b,libelle:c,type:d,format:e.format||null,decimals:e.decimals,enum:e.enum,enumName:e.enumName,lookup:e.lookup};a.push(f)},d=function(a,b,d,e,f,g,h){var i={};i.decimals=f,i.enum=g,i.enumName=h,c(a,b,d,e,i)},e=function(a,b){if(!a||!b)return null;var c=function(a,b){for(var d=[],e=a.length%2!=0,f=e?a.length-1:a.length,g=0;g<f;g+=2)d.push({$left:a[g],$op:b,$right:a[g+1]});return e&&d.push(a[a.length-1]),d.length>=2&&(d=c(d,b)),d},d=function(b){function d(a,b,c,d){return{$left:{$left:a,$op:"ge",$right:{type:b,value:c}},$op:"and",$right:{$left:a,$op:"le",$right:{type:b,value:d}}}}function e(a,b,c){return{$left:"contains("+a+",'"+c+"')",$op:null,$right:null}}var f=a.find(function(a){return a.code==b.code}),g="in"==b.op?"eq":b.op;g="nin"==g?"ne":g;var h=b.values.map(function(a){return a.code?a.code:a});return"between"==g||"nbetween"==g?"between"==g?d(b.code,f.type,h[0],h[1]):{$op:"not",$right:d(b.code,f.type,h[0],h[1])}:(h=h.map(function(a){var c=null;switch(g){case"like":c=e(b.code,f.type,a);break;case"nlike":c={$op:"not",$right:e(b.code,f.type,a)};break;case"vide":c={$left:b.code,$op:"eq",$right:{type:"string",value:""}};break;case"nvide":c={$left:b.code,$op:"ne",$right:{type:"string",value:""}};break;default:c={$left:b.code,$op:g,$right:{type:f.type,value:a}}}return c}),c(h,"or")[0])},e=[];return b.forEach(function(a){e.push(d(a))}),c(e,"and")[0]},f=function(a,b){function c(a){var b;switch(a){case"in":b="=";break;case"nin":b="!=";break;case"like":b="contient";break;case"nlike":b="ne contient pas";break;case"vide":b="est";break;case"nvide":b="n'est pas";break;case"gt":b=">";break;case"ge":b=">=";break;case"lt":b="<";break;case"le":b="<=";break;case"between":b="entre";break;case"nbetween":b="pas entre";break;default:b=a}return b}var d=[];return a.forEach(function(a){b.forEach(function(b){if(a.code===b.code)return a.lib=b.libelle,!1});var e=(a.lib||a.code)+" "+c(a.op);e+="vide"===a.op||"nvide"===a.op?" vide":"between"===a.op||"nbetween"===a.op?" "+a.values[0]+" et "+a.values[1]:a.getValueNames?" "+a.getValueNames().join(","):" "+a.values.join(","),d.length&&d.push(" et "),d.push(e)}),d.join("")},g=function(a,c){c.forEach(function(c){var d=$.extend(!0,{},c.schema);switch(d.type){case"number":d.decimals>0?d.type="decimal":d.type="integer"}c.schema.enum&&(d.enum=c.schema.enum.map(function(a,b){return{code:a,libelle:c.schema.enumNames?c.schema.enumNames[b]:a}})),b.filter.addField2(a,c.name,d.title,d.type,{decimals:d.decimals,enum:d.enum,format:d.format})})};a.filterData={filter:{champs:[],filters:[],entree:[]}},b.glbGridFilter=function(c,d,e){if(c.schemaColumns.length){var g={name:"filtre",$type:"block",$items:[{$type:"block",$items:[{$bind:"filter",$widget:"filter",options:{renderModel:"model1"}}]}],form:!0},h={type:"object",properties:{filter:{type:"object",title:"Filtre",properties:{champs:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},type:{type:"string"},format:{type:"string"},decimals:{type:"number"},enumName:{type:"string"},enum:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"}}}},lookup:{type:"string"}}}},filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},op:{type:"string"},values:{type:"array",items:{type:"string"}},values2:{type:"array",items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}}}},entree:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}}}},definitions:{}};a.filterData.filter.champs.length&&a.filterData.filter.champs.splice(0),a.filter.transformPropsToFilterFormat(a.filterData.filter.champs,c.schemaColumns),a.filterData.filter.entree&&(a.filterData.filter.entree=a.multiSelectUtils.transformPropsToMultiselectFormat(c.schemaColumns,c.schemaGroups));var i={title:"Filtre",buttons:[{pattern:"validate"}]};b.OpenModalForm(i,g,h,a.filterData,e,function(c,e,g,h){switch(e.property){case"validate":if(!g.validate())return;a.filterData=g.model();var i=null;a.filterData.filter.filters.length&&(i=b.filter.format.toPhenix(a.filterData.filter.champs,a.filterData.filter.filters)),d&&d({value:i,title:f(a.filterData.filter.filters,a.filterData.filter.champs)}),c.close()}})}},a.filter={format:{toPhenix:e,toTitle:f},addField:d,addField2:c,transformPropsToFilterFormat:g};var h=function(){function a(){this.filterComplex=null,this.filterExpress=null}return a.prototype.constructeFilter=function(){var a=this;return a.filterComplex&&a.filterComplex.value&&a.filterExpress&&a.filterExpress.value?{title:a.filterComplex.title+" et "+a.filterExpress.title,value:{$left:a.filterComplex.value,$op:"AND",$right:a.filterExpress.value}}:a.filterComplex&&a.filterComplex.value?a.filterComplex:a.filterExpress&&a.filterExpress.value?a.filterExpress:{title:"",value:null}},a}();a.FilterManager=h}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/core/core.ts" />
/// <reference path="../../js/ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a;b.glbGridSettings=function(c,d,e){var f={name:"settings",$type:"block",$items:[{$type:"block",$items:[{$bind:"mselect",$widget:"multiselectlist",options:{multiSelect:!0}}]}],form:!0},g={type:"object",properties:{mselect:{type:"object",properties:{entree:{type:"array",items:{$ref:"#/definitions/elt"}},sortie:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"}}}}}}},definitions:{elt:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}};c.options=c.options||{};var h={mselect:{entree:a.multiSelectUtils.transformPropsToMultiselectFormat(c.schemaColumns,c.schemaGroups,c.options.columnsLimited),sortie:a.multiSelectUtils.transformSelectedColumnsToMultiSelectFormat(c.schemaColumns,c.selectedColumns,c.schemaGroups,c.options.columnsLimited)}},i={title:c.locale&&c.locale.settingsTitle?c.locale.settingsTitle:"Options",buttons:[{pattern:"validate"}]};b.OpenModalForm(i,f,g,h,e,function(b,c,e,f){switch(c.property){case"validate":if(!e.validate())return;var g=e.model().mselect.sortie;if(g<=0)return;var h=a.multiSelectUtils.transformMultiSelectColumnsToGridColumnsFormat(g);d&&d(h),b.close()}})};var c=function(a,b,c){function d(a,b,c){a.forEach(function(a){a.items=a.items||[],d(a.items,a.fields||[],c)}),b.forEach(function(b){c.every(function(a){return b.name!==a.name||(b.title=a.schema.title||a.name,!1)}),a.push(b)})}function e(a,b){function c(a,b){var d=null;return a.every(function(a){return a.name===b?(d=a,!1):!a.items||!(d=c(a.items,b))}),d}b.forEach(function(b){var d={name:b.name,title:b.schema.title||b.name},e=c(a,b.schema.group);e?(e.items=e.items||[],e.items.push(d)):a.push(d)})}var f=b&&b.items?b.items:[],g=b&&b.fields?b.fields:[],h=b&&b.items?$.extend(!0,[],f):[];return c?d(h,g,a):e(h,a),h},d=function(a){var b=[];return a.forEach(function(a){b.push({$bind:a.name,options:{}})}),b},e=function(a,b,c,d){function e(a,b){var c=null;return a.every(function(a){return a.name===b&&(c=a),!a.items&&!a.fields||c||(c=e(a.fields||a.items,b)),!c}),c}c=c&&c.items?c.items:[];var f=[];return Object.keys(b).forEach(function(g){var h=!d||!!e(c||[],g);h&&a.every(function(a){return a.name!==g||(b[g]&&f.push({name:g,title:a.schema.title||a.name}),!1)})}),f};a.multiSelectUtils={transformPropsToMultiselectFormat:c,transformMultiSelectColumnsToGridColumnsFormat:d,transformSelectedColumnsToMultiSelectFormat:e}}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/core/modules/locale.ts" />
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,a.ulocale,a.dom),d=(a.Observable.SchemaUtils,function(){function a(a,b,c){var d=this,e={mapping:{id:"name",lib:"title"},expandIcon:"plus-sign",collapseIcon:"minus-sign",checkedIcon:"check",uncheckedIcon:"unchecked",itemIcon:"",groupIcon:"",multiSelect:!1,showTags:!1,groupLink:!1,itemLink:!0,border:!1,maxHeight:"300px"};d._options=$.extend(!0,e,b),d._name=d._options.mapping.id,d._title=d._options.mapping.libelle||d._options.mapping.lib,d._data=a||[],d._callback=c||null,d._nodes=$.extend(!0,[],a),d._selectedItems=[],d._init()}return Object.defineProperty(a.prototype,"items",{get:function(){return this._data},set:function(a){var b=this;b._data=a||[],b._nodes=$.extend(!0,[],a),b._selectedItems=[],b._constructeNodes(b._nodes,b._options),b._renderItems(b._nodes)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(a){var b=this;b._selectedItems=$.extend(!0,[],a),b._selectedItems.forEach(function(a){b.addItem(a[b._name])})},enumerable:!0,configurable:!0}),a.prototype._init=function(){var a=this;a._constructeNodes(a._nodes,a._options)},a.prototype._getGroupNode=function(a,b){var c=this,d=null;return a.every(function(a){return a.items&&(d=a[c._name]===b?a:null,d||(d=c._getGroupNode(a.items,b))),!d}),d},a.prototype._getItemNode=function(a,b){var c=this,d=null;return a.every(function(a){return d=a.items||a[c._name]!==b?null:a,!d&&a.items&&(d=c._getItemNode(a.items,b)),!d}),d},a.prototype._getItem=function(a,b){var c=this,d=null;return a.every(function(a){return a[c._name]===b?(d=a,!1):!a.items||!(d=c._getItem(a.items,b))}),d},a.prototype._getSelectedItemIndex=function(a){var b=this,c=-1;return b._selectedItems.every(function(d,e){return d[b._name]!==a||(c=e,!1)}),c},a.prototype._itemsIsSelected=function(a){var b=this,c=!0;return a.every(function(a){var d=!1;return b._selectedItems.every(function(c){return c[b._name]!=a[b._name]||(d=!0,!1)}),!!d||(c=!1,!1)}),c},a.prototype._itemsIsUnselected=function(a){var b=this,c=!0;return a.every(function(a){return b._selectedItems.every(function(d){return d[b._name]!=a[b._name]||(c=!1,!1)}),!!c}),c},a.prototype._constructeNodes=function(a,b){function d(a,b,f,g,h){var i=$(e._template().item).get(0);e._options.border||c.addClass(i,"noborder"),a.forEach(function(a){if(a[e._name]){a.level=f||0,a.show=1==g,a.parent=b||null,a.component=i.cloneNode(),a.items&&(a.tagsSize=0,d(a.items,a,a.level+1,!1,h));for(var j=a.parent;j;)j.tagsSize++,j=j.parent;for(var k=1;k<=a.level;k++)c.append(a.component,$(e._template().indent).get(0));if(a.items){var l=e._createIcon(a.component,h.expandIcon,"icon-group bs-cursor-p");if(c.attr(l,"data-event","click"),c.attr(l,"data-action","expand"),h.multiSelect&&h.groupLink){var m=e._createIcon(a.component,h.uncheckedIcon,"icon-check bs-cursor-p");c.attr(m,"data-event","click"),c.attr(m,"data-action","uncheckG")}else h.groupLink&&(c.attr(a.component,"data-event","click"),c.attr(a.component,"data-action","selectitem"),c.addClass(a.component,"bs-cursor-p"));e._createIcon(a.component,h.groupIcon)}else{var l=e._createIcon(a.component);if(c.addClass(l,"icon-exist"),h.multiSelect&&h.itemLink){var m=e._createIcon(a.component,h.uncheckedIcon,"icon-check bs-cursor-p");c.attr(m,"data-event","click"),c.attr(m,"data-action","uncheck")}else h.itemLink&&(c.attr(a.component,"data-event","click"),c.attr(a.component,"data-action","selectitem"),c.addClass(a.component,"bs-cursor-p"));e._createIcon(a.component,h.itemIcon)}c.append(a.component,$("<span>"+(a[e._title]||a[e._name])+"</span>").get(0)),c.attr(a.component,"data-id",a[e._name])}})}var e=this;Array.isArray(a)&&a.length&&(d(a,null,0,!0,b),b.showTags&&e._addTags(e._nodes))},a.prototype._addTags=function(a){var b=this;a.forEach(function(a){if(a.items){var d=$(b._template().badge).get(0);c.append(d,document.createTextNode(""+a.tagsSize)),c.append(a.component,d),b._addTags(a.items)}})},a.prototype._template=function(){return{list:'<ul class="list-group bs-treeview"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge"></span>'}},a.prototype._createIcon=function(a,b,d){var e=this,f=$(e._template().icon).get(0);return b&&e._addIcon(f,b,d),c.append(a,f),f},a.prototype._addIcon=function(a,b,d){c.attr(a,"class","icon icon-exist "+c.iconClass(b)+(d?" "+d:""))},a.prototype._setEvents=function(){var a=this;a._container&&a._container.addEventListener("click",function(b){var d=b.target,e=null;if(e="click"===c.attr(d,"data-event")?d:c.parentByTag(a._container,d,"LI"),e&&"click"===c.attr(e,"data-event")){var f=c.parentByTag(a._container,e,"LI"),g=c.attr(f,"data-id"),h=c.attr(e,"data-action");"expand"===h?a._display(g,!0):"collapse"===h?a._display(g,!1):"selectitem"===h?a._select(g,a._callback):"check"===h&&a._options.multiSelect?a._checkF(g,!1,a._callback):"uncheck"===h&&a._options.multiSelect?a._checkF(g,!0,a._callback):"checkG"===h&&a._options.multiSelect?a._checkG(g,!1,a._callback,!0):"uncheckG"===h&&a._options.multiSelect&&a._checkG(g,!0,a._callback,!0)}})},a.prototype._display=function(a,b){var d=this,e=d._getGroupNode(d._nodes,a);if(e){var f=function(a,b){a.forEach(function(a){if(a.show=b,a.items){f(a.items,!1);var e=c.query(a.component,".icon-group");e&&(d._addIcon(e,d._options.expandIcon,"icon-group bs-cursor-p"),c.attr(e,"data-action","expand"))}})};f(e.items,b);var g=c.query(e.component,".icon-group");d._addIcon(g,b?d._options.collapseIcon:d._options.expandIcon,"icon-group bs-cursor-p"),c.attr(g,"data-action",b?"collapse":"expand"),d._renderItems(d._nodes)}},a.prototype._select=function(a,b){var d=this,e=c.query(d._container,".active");e&&c.removeClass(e,"active"),d._selectedItems.splice(0);var f=d._getItem(d._nodes,a);f&&(d._showItem(a),c.addClass(f.component,"active"),f=d._getItem(d._data,a),f&&(d._selectedItems.push(f),b&&b({action:"add",data:f})))},a.prototype._unSelect=function(a,b){var d=this,e=c.query(d._container,".active");e&&c.removeClass(e,"active");var f=d._getItem(d._selectedItems,a);f&&(d._selectedItems.splice(0),b&&b({action:"remove",data:f}))},a.prototype._checkF=function(a,b,c){var d=this;d._check(a,b,c);var e=d._getItem(d._nodes,a);if(e&&e.parent){var f=d._getItem(d._data,e.parent[d._name]);if(!f)return;b&&d._itemsIsSelected(f.items)?d._checkG(f[d._name],b,c,!1):!b&&d._itemsIsUnselected(f.items)&&d._checkG(f[d._name],b,c,!1)}},a.prototype._check=function(a,b,d){var e=this,f=e._getItem(e._data,a);if(f){var g=e._getItem(e._nodes,a).component,h=c.query(g,".icon-check");e._addIcon(h,b?e._options.checkedIcon:e._options.uncheckedIcon,"icon-check bs-cursor-p"),c.attr(h,"data-action",b?"check":"uncheck");var i=void 0,j=e._getSelectedItemIndex(a);b?j<0&&(e._selectedItems.push(f),i="add"):j>=0&&(e._selectedItems.splice(j,1),i="remove"),d&&i&&d({action:i,data:f})}},a.prototype._checkG=function(a,b,d,e){var f=this,g=f._getItem(f._data,a);if(g){var h=f._getItem(f._nodes,a).component,i=c.query(h,".icon-check");f._addIcon(i,b?f._options.checkedIcon:f._options.uncheckedIcon,"icon-check bs-cursor-p"),c.attr(i,"data-action",b?"checkG":"uncheckG"),e&&g.items.forEach(function(a){a.items?f._checkG(a.name,b,d,e):f._check(a.name,b,d)})}},a.prototype._showItem=function(a){function b(a,e){a.forEach(function(a){if(a.show=e,a.items){b(a.items,!1);var f=c.query(a.component,".icon-group");f&&(d._addIcon(f,d._options.expandIcon,"icon-group bs-cursor-p"),c.attr(f,"data-action","expand"))}})}var d=this,e=d._getItem(d._nodes,a);if(e){for(var f=e.parent;f;){b(f.items,!0);var g=c.query(f.component,".icon-group");d._addIcon(g,d._options.collapseIcon,"icon-group bs-cursor-p"),c.attr(g,"data-action","collapse"),f=f.parent}d._renderItems(d._nodes)}},a.prototype.addItem=function(a){var b=this;b._options.multiSelect?b._checkF(a,!0):b._select(a)},a.prototype.removeItem=function(a){var b=this;b._options.multiSelect?b._checkF(a,!1):b._unSelect(a)},a.prototype._renderItems=function(a){function b(a,d){a.forEach(function(a){a.show&&c.append(d,a.component),a.items&&b(a.items,d)})}var d=this;c.empty(d._container);var e=document.createDocumentFragment();b(a,e),c.append(d._container,e)},a.prototype.render=function(a){var b=this;return b._container||(b._container=$(b._template().list).get(0),b._container.style.maxHeight=b._options.maxHeight,b._options.border||c.addClass(b._container,"noborder"),b._renderItems(b._nodes),b._setEvents()),a&&c.append(a,b._container),b._container},a}());b.MultiSelectList=d}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=(a.ulocale,a.dom),e=a.drag,f=(a.uiutils,a.events),g=(a.Observable.SchemaUtils,function(){function b(a,b,c){var d=this,e={mapping:{id:"name",lib:"title"},removeIcon:"remove",border:!1};d._options=$.extend(!0,e,b),d._name=d._options.mapping.id,d._title=d._options.mapping.libelle||d._options.mapping.lib,d._data=a||[],d._callback=c||null,d._nodes=$.extend(!0,[],a),d._selectedItems=[],d._init()}return Object.defineProperty(b.prototype,"items",{get:function(){return this._data},set:function(a){var b=this;b._data=a||[],b._nodes=$.extend(!0,[],a),b._selectedItems=[],b._constructeNodes(b._nodes,b._options),b._renderItems()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(a){this._selectedItems=$.extend(!0,[],a)},enumerable:!0,configurable:!0}),b.prototype._init=function(){var a=this;a._constructeNodes(a._nodes,a._options)},b.prototype._constructeNodes=function(a,b){if(Array.isArray(a)&&a.length){var c=this,e=$(c._template().itemTag).get(0),f=$(c._template().icon).get(0);a.forEach(function(a){a[c._name]&&(a.component=e.cloneNode(),d.append(a.component,document.createTextNode(a[c._title]||a[c._name])),d.attr(a.component,"data-id",a[c._name]),d.append(a.component,f.cloneNode()),a.filter=!0)}),c._input=c._input||$(c._template().itemInput).get(0)}},b.prototype._getItem=function(a,b){var c=this,d=null;return a.every(function(a){return a[c._name]!==b||(d=a,!1)}),d},b.prototype._getItemIndex=function(a,b){var c=this,d=-1;return a.every(function(a,e){return a[c._name]!==b||(d=e,!1)}),d},b.prototype._addTag=function(a,b){var c=this,d=c._getItem(c._selectedItems,a);d||(d=c._getItem(c._data,a),d&&(c._selectedItems.push(d),c._getItem(c._nodes,a).filter=!1,c._renderItems(),b&&b({action:"add",data:d})))},b.prototype._removeTag=function(a,b){var c=this,d=c._getItemIndex(c._selectedItems,a);d>=0&&(c._selectedItems.splice(d,1),c._getItem(c._nodes,a).filter=!0,c._renderItems(),b&&b({action:"remove",data:c._getItem(c._data,a)}))},b.prototype._filterList=function(a){var b=this;a.toLowerCase(),b._nodes.forEach(function(c){c.filter=c[b._title].toLowerCase().indexOf(a)>=0&&null==b._getItem(b._selectedItems,c[b._name])});var c=[];b._nodes.forEach(function(a){a.filter&&c.push(a)}),b._menu.show({value:c},0,!0)},b.prototype._setEvents=function(a){var b=this;if(b._container&&(b._container.addEventListener("click",function(a){var c=a.target;if(c.href){var e=d.attr(c,"href");"#"===e&&(a.preventDefault(),a.stopPropagation())}if(c&&"click"===d.attr(c,"data-event")){var f=d.attr(c,"data-action");if("remove"===f){var g=d.parentByTag(b._container,c,"LI"),h=d.attr(g,"data-id");b._removeTag(h,b._callback)}}else b._menu&&b._menu.opened&&b._menu.inMenu(a.target)&&b._menu.click(a);var i=d.query(b._input,"input");i&&i.focus()}),b._container.addEventListener("keyup",function(a){13==a.keyCode&&b._menu&&b._menu.opened&&b._menu.select();var c=d.query(b._input,"input");c&&c.focus()})),b._input){var c=!0;b._input.addEventListener("keyup",function(a){var e=a.target;if(38==a.keyCode||40==a.keyCode);else if(8==a.keyCode){c?b._filterList(e.value):b._menu&&b._menu.opened&&b._menu.hide(e)}else if(13==a.keyCode&&e&&"keyup"===d.attr(e,"data-event")){var f=e;b._addTag(f.value,b._callback),f.value=""}else{b._filterList(e.value);var g=d.query(b._container,".bs-pillbox-item-tag.focus");g&&d.removeClass(g,"focus")}var h=d.query(b._input,"input");h&&h.focus()}),b._input.addEventListener("keydown",function(a){var e=a.target;if(40==a.keyCode&&b._menu&&b._menu.opened)b._menu.move(1);else if(38==a.keyCode&&b._menu&&b._menu.opened)b._menu.move(-1);else if(8==a.keyCode){var f=e;if(f.value.length<=0&&b._selectedItems.length&&"keyup"===d.attr(e,"data-event")){var g=b._selectedItems[b._selectedItems.length-1],h=b._getItem(b._nodes,g[b._name]);d.hasClass(h.component,"focus")?(d.removeClass(h.component,"focus"),b._removeTag(g[b._name],b._callback)):d.addClass(h.component,"focus"),c=!1}else c=!0}else 9!=a.keyCode&&27!=a.keyCode||b._menu&&b._menu.opened&&b._menu.hide(e);var i=d.query(b._input,"input");i&&i.focus()})}b._drag=e.dragManager.addDrag([b._container]),b._drag.canStartDragHandler=b._canStartDrag.bind(b),b._drag.onDragStart=b._onDragStart.bind(b),b._drag.onDrag=b._onDrag.bind(b),b._drag.onDragEnd=b._onDragEnd.bind(b)},b.prototype._template=function(){var a=this;return{list:'<ul class="bs-pillbox noborder"></ul>',itemTag:'<li class="bs-pillbox-item bs-pillbox-item-tag" data-drag="move"></li>',icon:'<span class="icon pull-right '+d.iconClass(a._options.removeIcon)+' icon-remove bs-cursor-p" data-event="click" data-action="remove"></span>',itemInput:'<li class="bs-pillbox-item bs-pillbox-item-edit"><input autocomplete="off" autofocus="true" placeholder="..." data-event="keyup" data-action="add,remove" /></li>'}},b.prototype.addItem=function(a){this._addTag(a)},b.prototype.removeItem=function(a){this._removeTag(a)},b.prototype._canStartDrag=function(a){var b=this,e=a.target,f=d.parentByTag(b._container,e,"LI");if(f){var g=d.attr(f,"data-drag");if(!g)return!1;f.id||(f.id=c.allocID());var h=b._drag;if(h.coverDocument=!0,h.data.op=g,h.data.cloneId=f.id,h.data.column=d.attr(f,"data-id"),!h.data.column)return!1;var i=d.find(b._container,h.data.cloneId);h.cursor="move",h.moveX=!0,h.moveY=!0,h.startOffset=d.position(i,null);var j={top:0,height:i.offsetHeight},k=[];return b.selectedItems.forEach(function(a){var e=d.query(b._container,"li[data-id='"+a[b._name]+"']");e&&(e.id||(e.id=c.allocID()),k.push({htmlId:e.id,info:a}))}),h.data.childrenPositions=d.childrenPositions(b._container,k,!1,"free",j),!0}},b.prototype._onDragStart=function(a){var b=this,c=b._drag;if(!c.data.op)return!1;var e=d.find(b._container,c.data.cloneId),f=e.cloneNode(!0),g=d.position(e,null);return f.style.top=g.top+"px",f.style.left=g.left+"px",f.style.width=e.offsetWidth+"px",f.style.height=e.offsetHeight+"px",f.style.zIndex="5000",f.style.position="absolute",f.style.cursor="move",c.floatElement=f,d.append(document.body,c.floatElement),!0},b.prototype._onDrag=function(a){var b=this,c=b._drag;if(!c.data.op)return!1;var e=f.point(a),g=d.findNearest(e.x,e.y,c.data.childrenPositions);if(c.data.best!=g){var h={left:g.left,top:g.top,width:g.width,height:g.height};c.data.mdiv=d.showMove(c.data.mdiv,g.vertical,h,"bs-drag-color-info")}return c.data.best=g,!0},b.prototype._onDragEnd=function(a,b){var c=this,e=c._drag;if(!e.data.op)return!1;if(e.floatElement&&(d.remove(e.floatElement),e.floatElement=null),e.data.mdiv&&(d.remove(e.data.mdiv),e.data.mdiv=null),!a){if(e.data.best&&e.data.column){var f=e.data.best.info;if("empty"===e.data.best.position||f[c._name]===e.data.column)return;var g=c._getItem(c._selectedItems,e.data.column),h=c._getItemIndex(c._selectedItems,e.data.column);c.selectedItems.splice(h,1);var i=c._getItemIndex(c._selectedItems,f[c._name]);i="after"===e.data.best.position?i+1:i,c.selectedItems.splice(i,0,g),c._callback&&c._callback({action:"drag",srcIndex:h,destIndex:i,data:g})}c._renderItems();var j=d.query(c._input,"input");j&&j.focus()}},b.prototype._onMenuSelectItemHandler=function(a){var b=this;if(a){b._addTag(a[b._name],b._callback);var c=d.query(b._input,"input");c&&(c.value="")}},b.prototype._includeDropDownMenu=function(){var b=this,c=d.query(b._input,"input");b._menu=new a.formdropitems.DropItems($(b._input),c,{primaryKey:b._name,search:b._title,onselect:b._onMenuSelectItemHandler.bind(b)})},b.prototype._renderItems=function(){function a(a,c){a.forEach(function(a){var e=b._getItem(b._nodes,a[b._name]);e.filter=!1,d.append(c,e.component)})}var b=this;d.empty(b._container);var c=document.createDocumentFragment();a(b._selectedItems,c),d.append(c,b._input),d.append(b._container,c)},b.prototype.render=function(a){var b=this;return b._container||(b._container=$(b._template().list).get(0),b._renderItems(),b._includeDropDownMenu(),b._setEvents(a)),a&&d.append(a,b._container),b._container},b.prototype.remove=function(){var a=this;a._menu=null,a._drag&&(e.dragManager.rmvDrag(a._drag),a._drag=null)},b}());b.PillBox=g}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
/// <reference path="./multiselect.ts" />
/// <reference path="./pillbox.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.uiutils,f=(a.ulocale,a.dom),e=a.uiutils,g=(a.Observable.SchemaUtils,function(a){function c(c,d,e){function f(a,b){var c=null;return a.forEach(function(a,d){return a[g._name]!==b||(c={id:d,data:a},!1)}),c}a.call(this,c,d,e);var g=this;g._state();var h={mapping:{id:"name",lib:"title"},groupLink:!0,itemLink:!0,multiSelect:!0,showTags:!1,pillBox:!0},i=g.state.value.model().entree||[];if(g._sortie=g.state.value.sortie||[],g._options=$.extend(!0,h,g.renderOptions),g._name=g._options.mapping.id,g._title=g._options.mapping.libelle||g._options.mapping.lib,Array.isArray(i)&&i.length&&(g.multiSelectList=new b.MultiSelectList(i,g._options,function(a){if("add"===a.action)g.pillBox&&g.pillBox.addItem(a.data[g._name]),g._sortie.push(a.data);else if("remove"===a.action){g.pillBox&&g.pillBox.removeItem(a.data[g._name]);var b=f(g._sortie,a.data[g._name]);b&&g._sortie.remove(b.data)}}),g.multiSelectList.selectedItems=g.state.value.model().sortie||[],g._options.pillBox)){var j=g._extractItems(i,g._options.groupLink);g.pillBox=new b.PillBox(j,g._options,function(a){if("add"===a.action)g.multiSelectList.addItem(a.data[g._name]),g._sortie.push(a.data);else if("remove"===a.action){g.multiSelectList.removeItem(a.data[g._name]);var b=f(g._sortie,a.data[g._name]);b&&g._sortie.remove(b.data)}else if("drag"===a.action){var c=f(g._sortie,a.data[g._name]);g._sortie.remove(c.data),g._sortie.splice(a.destIndex,0,a.data)}}),g.pillBox.selectedItems=g.state.value.model().sortie||[]}}return __extends(c,a),c.prototype._extractItems=function(a,b){function c(a,b,d){a.forEach(function(a){a.items?(d&&b.push(a),c(a.items,b,d)):b.push(a)})}var d=[];return c(a,d,b),d},c.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},c.prototype._state2UI=function(){},c.prototype.changed=function(a,b,c,d,e){var f=this;f._sortie=f.state.value.sortie||[];var g=f.state.value.model().entree||[],h=f.state.value.model().sortie||[];f.multiSelectList&&(f.multiSelectList.items=g,f.multiSelectList.selectedItems=h),f.pillBox&&(f.pillBox.items=g,f.pillBox.selectedItems=h)},c.prototype.stateChanged=function(a){},c.prototype._template=function(a){return d.format('<div id="{0}" data-render="{0}"><div id="{0}_pillbox"><h5 class="bs-block-title">Choix de colonnes</h5><div data-id="pillbox" style="overflow-y:auto;max-height:250px"></div></div><div id="{0}_multiselect"><h5 class="bs-block-title">Liste de champs</h5><div data-id="multiselect" style="overflow-y:auto;max-height:300px;border: 1px solid #dddddd;"></div></div></div>',a)},c.prototype.render=function(a){var b=this,c=b._initOptions(e.utils.defaultOptions);if(!b.$element){b.$element=$(b._template(b.id));var d=b.$element.get(0);if(!b._options.pillBox){var g=f.find(d,b.id+"_pillbox");g&&f.addClass(g,"bs-none")}if(b.pillBox){var h=f.query(d,'div[data-id="pillbox"]');b.pillBox.render(h)}if(b.multiSelectList){var i=f.query(d,'div[data-id="multiselect"]');b.multiSelectList.render(i)}}return b.appendElement(a,c),b.$element},c}(b.AbsField));b.ComposantMultiSelect=g,c.registerControl(g,"object",!1,"multiselectlist",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../js/core/core.ts" />
/// <reference path="../filter-express/filter-express.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=b,e=a.utils,f=(a.locale,a.uiutils),g=a.link,h=function(){function b(a,b){var c=this;c.config=a||{},c.options=b||{},c.data={value:a.value,options:a.options},c.props={},c._defineProps()}return b.prototype._defineProps=function(){var b=this,c=a.utils.defineProperty;c("value",b),c("options",b)},b.prototype._notifyChange=function(a){var b=this;switch(a){case"value":b.update();break;case"options":b.updateOptions()}},b.prototype.createElement=function(a,b,c){return'<div class="bs-toolbar-item">A</div>'},b.prototype._setEvents=function(){},b.prototype.update=function(){},b.prototype.updateOptions=function(){var a=this;a.options=$.extend(!0,a.options,a.data.options),a.updateRender()},b.prototype.updateRender=function(){},b.prototype.getValue=function(){},b.prototype.getOptions=function(){},b.prototype.after=function(){},b.prototype.render=function(a){var b=this;return b.$element||(b.$element=$(b.createElement(b.config.id,b.config,b.data.value)),b._setEvents()),a&&c.append(a.get(0),b.$element.get(0)),b.$element},b.prototype.destroy=function(){var a=this;a.$element=null,a.options=null,a.config=null},b}();b.ToolElement=h;var i=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.createElement=function(a,b,d){var e=["bs-button btn btn-default"];b.style&&e.push("btn-"+b.style),b.right&&e.push("pull-right");var f=['<div class="bs-toolbar-item '+(b.right?"pull-right":"")+'">','<button toolClick="'+a+'" type="button" class="'+e.join(" ")+'">',b.icon?'<span class="'+c.iconClass(b.icon)+'" toolClick="'+a+'" ></span>':"",b.title?"&nbsp;"+b.title:"","</button>","</div>"];return f.join("")},b}(h);b.ToolElementButton=i;var j=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.createElement=function(a,b,c){var d=["label label-default form-control-static bs-toolbar-item bs-toolbar-item-count"];b.right&&d.push("pull-right");var e=['<span tool="'+a+'" class="'+d.join(" ")+'">'+c+"</span>"];return e.join("")},b.prototype.update=function(){var a=this;a.$element&&c.text(a.$element.get(0),a.data.value)},b}(h);b.ToolElementCount=j;var k=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.createElement=function(a,b,d){var e=["bs-toolbar-item dropdown"];b.right&&e.push("pull-right");var f=[];
// action : {name, events}
b.actions&&b.actions.forEach(function(a){f.push('<li data-id="'+a.code+'"><a href="#" data-id="'+a.code+'">'+(a.lib||a.code)+"</a></li>")});var g=[];b.title||b.icon||g.push('<span class="'+c.iconClass("menu-hamburger")+'"></span> '),b.icon&&g.push('<span class="'+c.iconClass(b.icon)+'"></span> '),b.title&&g.push(" "+b.title+" ");var h=['<div tabindex="'+a+'" class="'+e.join(" ")+'">','<button class="btn btn-default dropdown-toogle" id="tooltip-dropdown-'+a+'" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',g.join(""),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-'+a+'" data-id="toolCommands">',f.join(""),"</ul>","</div>"];return h.join("")},b.prototype._setEvents=function(){var a=this,b=c.query(a.$element.get(0),"ul[data-id='toolCommands']");b&&b.addEventListener("click",function(b){var d=b.target,e=c.attr(d,"data-id");e&&a.options.callback&&a.options.callback({id:a.config.id,name:a.config.name,type:a.config.type,value:e,toolData:a.config}),a.after()},!1)},b.prototype.after=function(){var a=this;c.removeClass(a.$element.get(0),"open")},b}(h);b.ToolElementDropdownAction=k;var l=function(a){function b(b,c){a.call(this,b,c);b.value=b.value||{},
// Test
b.value.default=g.context().$url.idTra,
// Test
b.value.items=b.value.items||[]}return __extends(b,a),b.prototype.createElement=function(a,b,c){var d=["bs-toolbar-item"];b.right&&d.push("pull-right");var e=[];
// action : {name, events}
b.value.items&&b.value.items.forEach(function(a){e.push('<option value="'+a.code+'" '+(b.value.default==a.code?"selected":"")+">"+(a.lib||a.code)+"</option>")});var f=['<div tabindex="'+a+'" class="'+d.join(" ")+'">','<form class="form-horizontal">','<div class="input-group">','<span class="input-group-addon">',b.title||"","</span>",'<select class="form-control" data-id="toolSelect">',e.join(""),"</select>","</div>","</form>","</div>"];return f.join("")},b.prototype.update=function(){var a=this;if(a.$element){var b=document.createDocumentFragment();a.data.value.items&&a.data.value.items.forEach(function(d){c.append(b,$('<option value="'+d.code+'" '+(a.data.value.default==d.code?"selected":"")+">"+(d.lib||d.libelle||d.code)+"</option>").get(0))});var d=c.query(a.$element.get(0),"select[data-id='toolSelect']");c.empty(d),c.append(d,b)}},b.prototype._setEvents=function(){var a=this,b=c.query(a.$element.get(0),"select[data-id='toolSelect']");b&&b.addEventListener("change",function(b){var c=b.target,d=b.target.options[c.selectedIndex];a.options.callback&&a.options.callback({id:a.config.id,name:a.config.name,type:a.config.type,value:d.value,toolData:a.config})},!1)},b}(h);b.ToolElementSelect=l;var m=function(a){function b(b,c){a.call(this,b,c),this.data.value="",this.oldValue=""}return __extends(b,a),b.prototype.createElement=function(a,b,d){var e=[];b.right&&e.push("pull-right");var f=['<div tabindex="'+a+'" class="bs-toolbar-item input-group'+e.join(" ")+'">','<input toolKeyup="'+a+'" type="text" class="form-control" placeholder="'+(b.title||"Recherche")+'" />','<span class="input-group-btn">','<button toolClick="'+a+'" class="bs-button btn btn-default" type="button">','<span toolClick="'+a+'" class="'+c.iconClass(b.icon||"search")+'"> </span>',"</button>","</span>","</div>"];return f.join("")},b.prototype.update=function(){var a=this;if(a.$element){var b=c.query(a.$element.get(0),"input");b&&(b.value=a.data.value)}},b.prototype.getValue=function(){var a=this;return a.oldValue=a._getInputValue(),a.oldValue},b.prototype._getInputValue=function(){var a=this;if(a.$element){var b=c.query(a.$element.get(0),"input");return b?b.value:null}},b.prototype._setEvents=function(){var a=this;if(a.$element){var b=a.$element.get(0);if(b){var d=c.query(b,"input"),e=c.query(b,"button");d.addEventListener("focus",function(a){d.select()}),b.addEventListener("blur",function(b){var c=b.explicitOriginalTarget&&b.explicitOriginalTarget!=e&&null==b.relatedTarget;c=c||(null==b.relatedTarget||b.relatedTarget&&b.relatedTarget!=e)&&void 0==b.explicitOriginalTarget,b.target==d&&c&&(
//if (!that._getInputValue() && that.filtering){
a.data.value=" ",a.props.value=a.oldValue)},!0)}}},b}(h);b.ToolElementSearch=m;var n=function(a){function e(b,c){a.call(this,b,c);var d=this;d.data.value=b.fields,d.data.options=b.options,d._init()}return __extends(e,a),e.prototype._init=function(){var a=this,b=a.data.options||{};a.filterExpress=new d.FilterExpress(a.config.fields||[],function(b){if(a.options.callback){var c=b&&b.length?d.filter.format.toPhenix(a.config.fields,b):null,e="";c&&(e=a._format(a.config.fields,b)),a.options.callback({id:a.config.id,name:a.config.name,type:a.config.type,value:{title:e,value:c},toolData:a.config})}},b)},e.prototype.createElement=function(a,b,c){var d=[];return b.right&&d.push("pull-right"),'<div class="bs-toolbar-item '+d.join(" ")+'"></div>'},e.prototype.render=function(a){var b=this;return b.$element||(b.$element=$(b.createElement(b.config.id,b.config,b.data.value)),b.filterExpress&&b.filterExpress.render(b.$element)),a&&c.append(a.get(0),b.$element.get(0)),b.$element},e.prototype.updateRender=function(){var a=this;c.empty(a.$element.get(0)),a._init(),a.filterExpress&&a.filterExpress.render(a.$element)},e.prototype._format=function(a,c){return b.filter.format.toTitle(c,a)},e.prototype.update=function(){var a=this;a.$element&&(a.config.fields=a.data.value||a.config.fields||[],a.filterExpress.fields=a.data.value)},e}(h);b.ToolElementFilterExpress=n;var o=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.createElement=function(a,b,d){var e=["bs-button btn btn-default"],f=['<div class="bs-toolbar-item '+(b.right?"pull-right":"")+'">','<button toolClick="'+a+'" type="button" class="'+e.join(" ")+'">',b.icon?'<span toolClick="'+a+'" class="'+c.iconClass(b.icon)+'"></span>':"",b.title?"&nbsp;"+b.title:"","</button>",'<span class="bs-toolbar-item-filter form-control-static bs-cursor-h"></span>',"</div>"];return f.join("")},b.prototype.addTooltip=function(a){var b=this,d=$('<span data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title= "'+a+'"> '+a+" </span>"),e=c.query(b.$element.get(0),".bs-toolbar-item-filter");c.empty(e),c.append(e,d.get(0)),d.tooltip&&d.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left"></div></div>'})},b.prototype.update=function(){var a=this;a.$element&&a.addTooltip(a.data.value)},b.prototype.render=function(b){a.prototype.render.call(this,b);var c=this;c.addTooltip(c.data.value)},b}(h);b.ToolElementFilter=o;var p=function(){function a(a,b){var c=this;c.options=b||{},c.toolElements=a||{}}return a.prototype.getToolElement=function(a){var b=null;return this.toolElements.forEach(function(c,d){if(d==a||c.name===a)return b=c.$component,!1}),b},a.prototype.setValue=function(a,b){var c=this,d=c.getToolElement(a);d&&(d.props.value=b)},a.prototype.getValue=function(a){var b=this,c=b.getToolElement(a);if(c)return c.getValue()},a.prototype.setOptions=function(a,b){var c=this,d=c.getToolElement(a);d&&(d.props.options=b)},a.prototype.getOptions=function(a){var b=this,c=b.getToolElement(a);if(c)return c.getOptions()},a.prototype._setEvents=function(){function a(a,c){if(c>=0){var d=b.getToolElement(c);if(d&&b.options.selectToolElement){var e=d.getValue();d.after(),b.options.selectToolElement({id:d.config.id,type:d.config.type,name:d.config.name,value:e,toolData:d.config},a)}}}var b=this;b.$element&&b.$element.on("click",function(b){var d=c.attr(b.target,"toolClick");null!==d&&a("click",d)}).on("keyup",function(b){if(13==b.keyCode){var d=c.attr(b.target,"toolKeyup");a("keyup",d)}})},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype._renderToolElements=function(a){var b=this;if(a.length){b.$element.get(0);a.forEach(function(a,c){a.id=c;var d=a.type,e=$.extend(!0,{callback:b.options.selectToolElement},a.options||{});switch(d.toLowerCase()){case"count":a.$component=new j(a,e);break;case"filter":a.$component=new o(a,e);break;case"search":a.$component=new m(a,e);break;case"filterexpress":a.$component=new n(a,e);break;case"dropdownaction":a.$component=new k(a,e);break;case"select":a.$component=new l(a,e);break;default:a.style=a.style||a.type,a.$component=new i(a,e)}a.$component&&a.$component.render(b.$element)})}},a.prototype.render=function(a){var b=this;return b.$element||(b.$element=$('<div class="form-inline bs-toolbar"></div>'),b._renderToolElements(b.toolElements),b._setEvents()),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},a.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a.options=null},a}();b.ToolBar=p;var q=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype.getValue=function(a){return this._toolbar.getValue(a)},b.prototype.setValue=function(a,b){this._toolbar.setValue(a,b)},b.prototype.getOptions=function(a){return this._toolbar.getOptions(a)},b.prototype.setOptions=function(a,b){this._toolbar.setOptions(a,b)},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b.prototype.click=function(a){},b.prototype._createContainer=function(a){return e.format('<div id="{0}" data-render="{0}" class="bs-tile"></div>',a)},b.prototype._onSelectToolElement=function(a){var b=this,c=a.name||a.id;b.form.execAction(b.$bind+".$toolbar."+c,{toolElement:a,control:b})},b.prototype.render=function(a){var b=this,c=b._initOptions(f.utils.defaultOptions);if(!b.$element){b.$element=$(b._createContainer(b.id));var e=b.state.value._model.map(function(a){var b={type:a.type,name:a.name,title:a.title};return b=$.extend(!0,b,a.data,{options:a.options})}),g={selectToolElement:b._onSelectToolElement.bind(b)};b._toolbar=new d.ToolBar(e,g),b._toolbar.render(b.$element)}return b.appendElement(a,c),b.$element},b}(b.AbsField);b.ToolbarForm=q,d.registerControl(q,"array",!1,"toolbar")}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.min.js.map