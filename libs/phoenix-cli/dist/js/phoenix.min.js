var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Phoenix;!function(e){!function(e){var t=function(){return window.Promise||(window.ES6Promise?window.ES6Promise.Promise:null)},n=function(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t},o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[0].replace(/{(\d+)}/g,function(t,n){return n=parseInt(n,10),e[n+1]})},i=function(e,t){if(e)for(var n in e){var o=e[n];t[n];null===o||"object"!=typeof o||Array.isArray(o)?t[n]=o:(t[n]=t[n]||{},i(o,t[n]))}},r={scope:!1,destroy:!1,menu:!1,proxydata:!1},a=function(e,t){if(!e&&t||!t&&e)return!1;if(e===t)return!0;if(!e&&!t)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(!a(e[n],t[n]))return!1;return!0}if("object"==typeof e){if(typeof e!=typeof t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var s=0,l=i.length;s<l;s++)if(!a(e[i[s]],t[i[s]]))return!1;return!0}return!1},s=function(e,t,n){var o=Object.keys(e),i=Object.keys(t);o.forEach(function(o){var r=e[o],l=i.indexOf(o);if(l>=0){i.splice(l,1);var u=t[o];if(u===r)return;null===u?n[o]=null:null===r?n[o]=u:Array.isArray(r)?a(r,u)||(n[o]=u):"object"==typeof r?a(r,u)||(n[o]={},s(r,u,n[o])):n[o]=u}else n[o]=null}),i.forEach(function(e){n[e]=t[e]})},l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},u=!1,c=function(e,t,n){if(e.indexOf(".")>=0){var o=t;return e.split(".").forEach(function(e){o&&(o=o[e])}),(o||"")+""}return void 0===t[e]?n?e:"":t[e]},d=function(e,t){switch(e){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"firstChar":return t&&t.length?t[0]:""}return t};e.Promise=t(),e.allocUuid=function(){return n(!1)+n(!0)+n(!0)+n(!1)},e.allocID=function(){return"I"+n(!1)+n(!1)+n(!1)+n(!1)},e.format=o,e.merge=i,e.formatNames=function(e,t){return e.replace(/{([^{]*)}/g,function(e,n){return t[n]||""})},e.extend=function(e,t){return e=e||{},Object&&Object.assign?Object.assign(e,t):(Object.keys(t).forEach(function(n){e[n]=t[n]}),e)},e.logModule=function(e,t){return void 0!==t&&(r[e]=t),r[e]},e.log=function(e,t){r&&r[t]&&console.log(e)},e.equals=a,e.copy=function(e){var t={};for(var n in e)t[n]=e[n];return t},e.deltaPatch=function(e,t){var n={};return s(e,t,n),Object.keys(n).length?n:null},e.isNull=function(e){return null===e},e.isUndefined=function(e){return void 0===e},e.isNullOrUndefined=function(e){return null===e||void 0===e},e.logRule=function(e,t,n,i){if(u){e=(e||1)-1;var r=new Array(e).join("  ");"string"==typeof t?console.log(o('{0}{1}".',r,t)):console.log(o('{0} {4} Rule: "{1} - {2}", triggered by "{3}".',r,t.name,t.description,n,i))}},e.showRules=function(e){return void 0!==e&&(u=e),u},e.escapeHtml=function(e){return(e||"").replace(/[&<>"'\/]/g,function(e){return l[e]})},e.phoenixPath=function(){for(var e=document.getElementsByTagName("script"),t=e.length-1;t>=0;--t){var n=e[t].src.split("?")[0].split("/"),o=n.length,i=n[o-1].toLowerCase();if("phoenix.js"==i||"phoenix.min.js"==i||"core.js"==i&&"core"==n[o-2]){var r=o-1;return"core.js"==i&&r--,n.slice(0,r).join("/")}}throw"Invalid script Name"},e.parseExpression=function(e,t){return e.replace(/{{([^{]*)}}/g,function(e,n){return c(n,t,!1)})},e.hasExpression=function(e){return(e||"").indexOf("{{")>=0},e.parseVariable=function(e,t){return c(e,t,!0)},e.defineProperty=function(e,t){var n=t||this;Object.defineProperty(n.props,e,{get:function(){return n.data[e]},set:function(t){t!=n.data[e]&&(n.data[e]=t,n._notifyChange(e))},enumerable:!0})},e.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})},e.nextTick=window.setImmediate?function(e){setImmediate(function(){e()})}:function(e){setTimeout(function(){e()},0)},e.focusDelay=function(e){setTimeout(function(){e()},200)},e.dataAsPromise=function(e){return t().resolve(e)},e.extractAngularVars=function(e,t){return e.replace(/\{\{([^{]*)\}\}/g,function(e,n){return t.push({name:n.split("|")[0].trim()}),""}),t.length>0},e.execAngularExpression=function(e,t,n){return e.replace(/\{\{([^{]*)\}\}/g,function(e,o){for(var i=o.split("|"),r=(i[0]||"").trim(),a=n?t[r]:c(r,t,!1),s=1,l=i.length;s<l;s++)a=d((i[s]||"").trim(),a);return a})},e.confirm=function(e,t,n,o){window.confirm(t)?n():o&&o()},e.alert=function(e,t,n){window.alert(t)},e.prompt=function(e,t,n){n(window.prompt(e,t))},e.cleanUpObject=function(e){Object.keys(e).forEach(function(t){e[t]=null})},e.getValue=function(e,t){for(var n=t.split("."),o=e,i=null,r=0,a=n.length;r<a;r++){if(!(i=o[n[r]]))return i;o=i}return i}}(e.utils||(e.utils={})),function(){var e=Array.prototype;e.find||(e.find=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,o=Object(this),i=o.length>>>0,t=arguments[1],r=0;r<i;r++)if(n=o[r],e.call(t,n,r,o))return n}),e.findIndex||(e.findIndex=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,o=Object(this),i=o.length>>>0,t=arguments[1],r=0;r<i;r++)if(n=o[r],e.call(t,n,r,o))return r;return-1})}()}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t,n=e.utils;!function(e){e.hashHandler=null,e.logoutHandler=null,e.forbiddenHandler=null,e.changePasswordHandler=null,e.checkLoggedInHandler=null,e.historyChangedHandler=null,e.formOpenHandler=null,e.preferenceLoadHandler=function(e){var t=n.Promise;return new t(window.localStorage?function(t,n){var o=window.localStorage.getItem("preferences."+e);t(o?JSON.parse(o):null)}:function(e,t){e(null)})},e.preferenceSaveHandler=function(e,t){var o=n.Promise;return new o(window.localStorage?function(n,o){t?window.localStorage.setItem("preferences."+e,JSON.stringify(t)):window.localStorage.setItem("preferences."+e,""),n()}:function(e,t){e()})},e.ruleLoaderHandler=null,e.ruleViewer=null}(t=e.external||(e.external={}));!function(e){var n=[];e.removeLast=function(){n.pop(),t.historyChangedHandler&&t.historyChangedHandler()},e.add=function(e,o){if(o)return n=[e],void(t.historyChangedHandler&&t.historyChangedHandler());var i=n.length;(i?n[i-1]:"")!=e&&(e===(i>=2?n[i-2]:"")?n.pop():n.push(e),t.historyChangedHandler&&t.historyChangedHandler())},e.hasBack=function(){return n.length>1},e.value=n,e.locationPrefix="!"}(e.history||(e.history={}));!function(e){var t={};e.register=function(e,n,o){t[e]=t[e]||{},t[e][n]=o},e.get=function(e,n){return t[e]?t[e][n]:null}}(e.render||(e.render={}));!function(e){var t={};e.emit=function(e,n){var o=t["on"+e];o&&o.forEach(function(e){(e.listener?e.handler.bind(e.listener):e.handler)(n)})},e.listen=function(e,n,o){t[e]=t[e]||[],t[e].push({listener:o,handler:n})},e.unlisten=function(e,n){function o(t){if(t)for(var n=t.length;n--;)t[n].listener==e&&t.splice(n,1)}n?o(t[n]):Object.keys(t).forEach(function(e){o(t[e])})}}(e.ipc||(e.ipc={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(e){var t=function(){function e(){this._eventList=[]}return e.prototype.execute=function(e){this._eventList.push(e),this._execute()},e.prototype._execute=function(){var e=this;if(!e._inExec){e._inExec=!0;try{for(;;){if(!e._eventList.length)break;var t=e._eventList.shift();try{t()}catch(e){}}}finally{e._inExec=!1}}},e}();e.Serial=t;var n=function(){function e(e,t,n,o,i){var r=this;r.ondispose=i,r.promise=t,r.resolve=n,r.errorhandler=o,r.dataHandler=r.ondata.bind(r),e?r.timer=window.setTimeout(r._execute.bind(r),e):r._execute()}return e.prototype.ondata=function(e){var t=this,n=t.resolve;t.destroy(),n&&n(e)},e.prototype.onerror=function(e){var t=this,n=t.errorhandler;t.destroy(),n&&n(e)},e.prototype._execute=function(){var e=this;e.promise&&e.promise.then?e.promise.then(e.dataHandler,e.onerror.bind(e)):e.promise&&"function"==typeof e.promise?e.dataHandler(e.promise()):e.dataHandler(e.promise)},e.prototype._cleaTimeout=function(){var e=this;e.timer&&(window.clearTimeout(e.timer),e.timer=0)},e.prototype.destroy=function(){var e=this;e.resolve=null,e.errorhandler=null,e._cleaTimeout(),e.promise=null;var t=e.ondispose;e.ondispose=null,t&&t(e)},e}(),o=function(){function e(e){this.defaultDelay=0;var t=this;t.defaultDelay=e,t._error=t._errorHandler.bind(t),t._dispose=t._onEventDisposed.bind(t)}return e.prototype._errorHandler=function(e){var t=this;t.onError&&t.onError(e)},e.prototype.clear=function(){var e=this;e.currentEvent&&(e.currentEvent.destroy(),e.currentEvent=null)},e.prototype._onEventDisposed=function(e){this.currentEvent=null},e.prototype.push=function(e,t,o){var i=this;i.clear();var r=o?0:i.defaultDelay;i.currentEvent=new n(r,e,t,i._error,i._dispose)},e.prototype.destroy=function(){this.clear()},e}();e.SingleEventBus=o,e.GlbSerial=new t}(e.serial||(e.serial={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){e.locale={}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(e){var t={};e.register=function(e,n){for(var o=e.split("."),i=t,r=0,a=o.length-1;r<a;r++){var s=o[r];i[s]=i[s]||{},i=i[s]}i[o[o.length-1]]=n},e.unregister=function(e,n){for(var o=e.split("."),i=t,r=0,a=o.length-1;r<a;r++){var s=o[r];if(!i[s])return;i[s]=i[s]||{},i=i[s]}i[o[o.length-1]]=null},e.get=function(e){for(var n=e.split("."),o=t,i=null,r=0,a=n.length;r<a;r++){if(!(i=o[n[r]]))return i;o=i}return i}}(e.customData||(e.customData={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){e.device={phone:!1,tablet:!1,deviceType:""};var t=function(e){e=e||{};try{window.sessionStorage&&window.sessionStorage.setItem("$mem",JSON.stringify(e))}catch(e){}};e.$mem=function(){try{if(window.sessionStorage)return JSON.parse(window.sessionStorage.getItem("$mem"))||{}}catch(e){return{}}}(),e.save$mem=function(){t(e.$mem)},e.sessionPreferences=function(e,t){var n=null;try{n=JSON.parse(window.sessionStorage.getItem("preferences"))}catch(e){}if(void 0===t)return n?n[e]:void 0;(n=n||{})[e]=t;try{window.sessionStorage.setItem("preferences",JSON.stringify(n))}catch(e){}},e.preferences=function(e,t){var n=null;try{n=JSON.parse(window.localStorage.getItem("preferences"))}catch(e){}if(void 0===t)return n?n[e]:void 0;(n=n||{})[e]=t;try{window.localStorage.setItem("preferences",JSON.stringify(n))}catch(e){}},e.build={version:"0.1.0.0",release:!1,authMode:"dev"}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){e.build;!function(e){var t={},n={setItem:function(e,n){t[e]=n},getItem:function(e){return t[e]}},o=[],i=function(){var e=null;try{e=window.localStorage}catch(t){e=null}return e||(e=n),e};e.db=i,e.save=function(e,t){t||(e.basic="Basic "+window.btoa((e.login||"")+":"+(e.password||""))),i().setItem("authentication",JSON.stringify(e))},e.load=function(){try{return JSON.parse(i().getItem("authentication"))}catch(e){return null}},e.clear=function(){i().setItem("authentication","null"),o.forEach(function(e){e()})},e.registerAfterLogout=function(e){o.push(e)}}(e.authentication||(e.authentication={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(e){function t(t,n){return t=t||e.name,void 0==n?r("application_"+t):i("application_"+t,n)}function n(){return e.configuration&&e.configuration.portailName?e.configuration.portailName:"portail"}var o={},i=function(e,t){return o[e]=t,t},r=function(e){return o[e]};e.core="phoenix",e.name="",e.support="",e.homeName="home",e.title="",e.licences={},e.configuration=null,e.useJSONPatch=!1,e.config=t,e.init=function(t,n,o){if(e.name=t,e.title=n,o&&o.homes&&o.homes[t]&&(e.homeName=o.homes[t]),e.configuration=o,angular){var i=o?o.angularModules||[]:[];Array.isArray(i)||"object"!=typeof i||(i=i[t]||[]),e.angularApplication=angular.module(t,i)}},e.portailName=n,e.isPortail=function(){return e.name===n()},e.isCustomizable=function(n,o){var i=t(e.name);return!(!i||!i.customizable)&&(o.indexOf(".json")<0&&(o+=".json"),i.customizable.indexOf([n,e.name,o].join("/"))>=0)}}(e.application||(e.application={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=e.application,i=e.customData,r=e.authentication,a=e.locale,s={},l=function(e){var t=s["s"+e];return!(!t||t.disabled)&&(t.handlers.forEach(function(e){e()}),!0)},u=function(e){return e&&"function"==typeof e},c=function(e){var t=null;if(e.responseText&&(t={responseText:e.responseText}),e.responseJSON)if(t=t||{},"object"==typeof e.responseJSON)t.json=e.responseJSON;else try{t.json=JSON.parse(e.responseJSON)}catch(e){}return t},d=function(e,t,o,i){var r=n.Promise,s={type:e,contentType:"application/json",accept:"application/json",url:t,data:null};return i&&i.headers&&(s.headers=i.headers,s.headers.contentType&&(s.contentType=s.headers.contentType)),o&&s.contentType.indexOf("application/json")>=0?s.data=JSON.stringify(o):s.data=o,new r(function(e,t){$.ajax(s).done(function(t,n,o){e(t)}).fail(function(n,o,r){if(i&&i.ignore&&i.ignore[""+n.status])return e({});if(l(n.status))return e({});n.status>=500&&a&&a.errors&&(o=a.errors.error500,r=null);var s=c(n);s&&(r=null);var u=null;r&&(u="string"==typeof r?{message:r}:r),(u=u||{message:o,detail:s}).status=n.status,t(u)})})},p={},f=function(){var e=o.config(o.name),t={headers:null};if(e&&e.odata&&e.odata.headers&&(t.headers=e.odata.headers),t.headers=t.headers||{},t.headers.Accept="application/json",e&&e.odata&&e.odata.authentication){var n=r.load();if(n)switch(e.odata.authentication){case"basic":t.headers.Authorization=n.basic;break;case"header-session":t.headers.Authorization="Bearer "+n.token}else delete t.headers.Authorization}return t},m=function(e,t,n,o){var i=p[e];if(i){if(i.loaded)return n(null);if(i.error)return n(i.error,null);window.setTimeout(function(){m(e,t,n,o)},20)}else p[e]={loading:!0},o?o.execute(function(t){p[e]=t?{error:t}:{loaded:!0},n(t)}):$.ajax({url:t,dataType:"script",cache:!0}).done(function(t,o,i){p[e]={loaded:!0},n(null)}).fail(function(t,o,i){var r=i||{message:o};p[e]={error:r},n(r)})};t.extractAjaxErrors=function(e){var t={message:"",list:[]};e&&"object"!=typeof e&&(e={message:e}),e=e||{},t.status=e.status,e.message=e.message||a.errors.unknownError;var n;if(e.detail)if(e.detail.json&&e.detail.json.error){var o=e.detail.json.error,i=void 0;if(void 0!==o.details&&(i=o),n=o.message,o.innererror&&o.innererror.message&&"Json"===o.innererror.type&&(i=JSON.parse(o.innererror.message)),i)return t.message=i.message,i.details&&i.details.forEach(function(e){t.list.push({message:e.message,target:e.target})}),t}else n=e.detail.json&&e.detail.json.exceptionMessage?e.detail.json.exceptionMessage:e.detail.responseText;return t.message=n||e.message,t},t.get=function(e,t,o){!o&&u(t)&&(o=t,t=null);var r={type:"GET",url:e,dataType:"json",accept:"application/json"},s=null;return t&&(s=t.$errors,delete t.$errors,Object.keys(r).forEach(function(e){t[e]=r[e]}),r=t),new(0,n.Promise)(function(e,n){$.ajax(r).done(function(t,n,i){o&&(t=o(t)),e(t)}).fail(function(o,r,u){if(t&&t.ignore&&t.ignore[""+o.status])return e({});if(s&&s[o.status+""]){var d=o.status+"";if("string"!=typeof s[d])return e(s[d]);var p=i.get(s[d]);p&&e(p())}if(l(o.status))return e({});o.status>=500&&a&&a.errors&&(r=a.errors.error500,u=null);var f=c(o);f&&(u=null);var m=null;u&&(m="string"==typeof u?{message:u}:u),(m=m||{message:r,detail:f}).status=o.status,m._ajax=!0,"error"===m.message&&m.detail&&m.detail.responseText&&(m.message=m.detail.responseText),n(m)})})},t.getScript=function(e){return new(0,n.Promise)(function(t,n){$.ajax({url:e,dataType:"script",cache:!0}).done(function(e,n,o){t(!0)}).fail(function(e,t,o){n(o||{message:t})})})},t.getDefaultAjaxOptions=f,t.put=function(e,t,n){return d("PUT",e,t,n)},t.patch=function(e,t,n){return d("PATCH",e,t,n)},t.post=function(e,t,n){return d("POST",e,t,n)},t.remove=function(e,t){return d("DELETE",e,null,t)},t.postAndDownload=function(e,t){var i=n.Promise,r=f(),s=o.config(o.name)||{},u=s.rest?s.rest.base||"":"";return e&&"/"===e.charAt(0)&&(u=""),u&&(e=u+"/"+e),new i(function(n,o){var i=function(e){var t=e.statusText;if(l(e.status))return n({});e.status>=500&&a&&a.errors&&(t=a.errors.error500),o({message:t,detail:null})},s=new XMLHttpRequest;s.open("POST",e,!0),s.responseType="arraybuffer",s.onload=function(){var e=this;if(200===e.status||201===e.status){var t="",r=s.getResponseHeader("Content-Disposition");if(r&&-1!==r.indexOf("attachment")){var a=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(r);null!=a&&a[1]&&(t=a[1].replace(/['"]/g,""))}var l=s.getResponseHeader("Content-Type");try{var u=new Blob([e.response],{type:l})}catch(e){return o(e)}if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(u,t),n({});else{var c=window.URL||window.webkitURL,d=c.createObjectURL(u);if(t){var p=document.createElement("a");void 0===p.download?window.location.href=d:(p.href=d,p.download=t,document.body.appendChild(p),p.click(),document.body.removeChild(p))}else window.location.href=d;setTimeout(function(){c.revokeObjectURL(d),n({})},300)}}else i(e)},s.onerror=function(){i(s)},s.setRequestHeader("Content-type","application/json"),r&&r.headers&&Object.keys(r.headers).forEach(function(e){s.setRequestHeader(e,r.headers[e])}),s.send(JSON.stringify(t))})},t.addAuthToUrl=function(e){var t=o.config(o.name);if(t&&t.odata&&t.odata.authentication){var n=r.load();if(n)switch(t.odata.authentication){case"basic":break;case"header-session":var i="token="+encodeURIComponent(n.token);e+=i=e.indexOf("?")>0?"&"+i:"?"+i}}return e},t.loadScript=m,t.interceptError=function(e,t){var n="s"+e,o=s[n]||{disabled:!1,handlers:[]};o.handlers.push(t),s[n]=o},t.activateInterceptError=function(e,t){var n=s["s"+e];n&&(n.disabled=!t)}}(e.ajax||(e.ajax={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t,n=e,o=n.locale,i=n.utils,r=n.ajax;!function(t){function n(e){var n=i.phoenixPath();e!=t.currentLang&&r.getScript(n+"/locale/phoenix_"+t.lang+".min.js").then(function(){t.currentLang=e}).catch(function(e){})}var a=[],s=["en","fr"],l=function(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e},u=function(e,t){t=l(t,2);var n=Math.pow(10,t);return(Math.round(e*n)/n).toFixed(t)},c=function(e,t,n,o){if(null===e)return"";var i=l(t,0),r=e<0?"-":"",a=parseInt(u(Math.abs(e||0),i),10)+"",s=a.length>3?a.length%3:0;return r+(s?a.substr(0,s)+n:"")+a.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+n)+(i?o+u(Math.abs(e),i).split(".")[1]:"")},d=function(e,t,n,o,i,r){return null===e?"":(r=r||"%v %s").replace("%s",i).replace("%v",c(e,t,n,o))},p=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},f=function(e,t){for(var n=e+"";n.length<t;)n="0"+e;return n},m=function(e,t){var n=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTtA])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=e.getDate(),r=e.getDay(),a=e.getMonth(),s=e.getFullYear(),l=e.getHours(),u=e.getMinutes(),c={d:i,dd:f(i,2),ddd:o.date.weekdaysShort[r],dddd:o.date.weekdays[r],m:a+1,mm:f(a+1,2),mmm:o.date.monthsShort[a],mmmm:o.date.months[a],yy:(s+"").slice(2),yyyy:s,H:l+"",HH:f(l,2),h:(l>12?l-12:l)+"",hh:f(l>12?l-12:l,2),M:u+"",MM:f(u,2),A:l>12?"PM":"AM"};return t.replace(n,function(e){return e in c?c[e]:e.slice(1,e.length-1)})},h=function(e){var t=o.date.dateShort.split("/");if(3!==t.length)return"";var n=(e||"").split(o.date.daySep),i=[0,0,0],r="";t.forEach(function(e,t){var o=0;"m"===e.charAt(0)?o=1:"y"===e.charAt(0)&&(o=2);var a=n[t]||"";if(2===t){var s=a.indexOf(" ");s>0&&(r=a.substr(s+1).trim(),a=a.substr(0,s))}i[o]=parseInt(a,10),2==o&&i[o]<100&&a.length<3&&(i[o]+=100*Math.round((new Date).getFullYear()/100))});var a={d:i[0],m:i[1],y:i[2],H:0,M:0,S:0};if(r){var s=o.date.shortTime.split(" "),l=r.split(" "),u=!1;s.length<=2&&l.length===s.length&&(2===s.length&&(u="PM"===l[1]),(l=l[0].split(":")).length>=2&&(a.H=parseInt(l[0],10),a.M=parseInt(l[1],10),l.length>2&&(a.S=parseInt(l[2],10)),u&&a.H<12&&(a.H=a.H+12)))}return a},v=function(e){var t=h(e),n=f(t.y,4)+"-"+f(t.m,2)+"-"+f(t.d,2),o=Date.parse(n);if(isNaN(o))return"";var i=new Date(n);return i.setHours(t.H),i.setMinutes(t.M),i.setSeconds(t.S),i.setMilliseconds(0),i.toISOString()},g=function(e){if(!e)return"";var t=p(e);if(!t)return"";var n=o.date.dateShort;return"/"!==o.date.daySep&&(n=n.replace(/\//g,o.date.daySep)),m(t,n+" "+o.date.shortTime)},y=function(e){if(!e)return"";var t=p(e);if(!t)return"";var n=o.date.dateShort;return"/"!=o.date.daySep&&(n=n.replace(/\//g,o.date.daySep)),m(t,n)},_=function(e,t){return e=e||0,t?d(e,o.number.places,o.number.thousand,o.number.decimal,o.number.symbol,o.number.format):c(e,o.number.places,o.number.thousand,o.number.decimal)},b=function(e,t,n){if(null===e)return"";e=e||0;var i=n?"%v %s":"%v";return d(e,t,o.number.thousand,o.number.decimal,n,i)},x=function(e,t,n,o){var i=e[t],r=e[n],a=e[o],s=new Date(a,r-1,i);return s.getFullYear()==a&&s.getMonth()+1==r&&s.getDate()==i};t.register=function(e){a.push(e)},t.translate=function(e,t){$.extend(!0,o,e),a.forEach(function(e){e(t)})},t.tt=function(e,t){return t=t||{},e&&"{{"==e.substring(0,2)?e.replace(/{{(.*)}}/g,function(e,n){for(var o=n.split("."),i=t,r=0,a=o.length;r<a&&i;r++)i=i[o[r]];return void 0===i?"["+n+"]":i}):e},t.currentLang="en",t.defCountry="US",t.lang="fr",t.country="FR",t.money=_,t.truncMoney=function(e){return parseFloat(e.toFixed(o.number.decimal))},t.decimal=b,t.integer=function(e){return(e||0)+""},t.format=function(e,t){if(!e||!t)return t;var n=[];return Object.keys(e).forEach(function(t){var o=e[t];"date"!==o.type&&"money"!==o.type&&"decimal"!==o.type&&"number"!==o.type||n.push({name:t,type:o.type,symbol:o.symbol,longdate:o.longdate,decimals:o.decimals,useSymbol:void 0===o.useSymbol||o.useSymbol})}),n.length?((Array.isArray(t)?t:[t]).forEach(function(e){n.forEach(function(t){switch(t.type){case"date":e[t.name]=y(e[t.name]);break;case"money":e[t.name]=_(e[t.name],t.useSymbol);break;case"integer":e[t.name]=b(e[t.name],0,t.symbol);break;case"decimal":case"number":e[t.name]=b(e[t.name],t.decimals,t.symbol)}})}),t):t},t.parseISODate=p,t.parseISODateAsUTC=function(e){return e?Date.UTC(parseInt(e.substr(0,4),10),parseInt(e.substr(5,2),10)-1,parseInt(e.substr(8,2),10),0,0,0):0},t.parseISODateTime=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},t.isoDatePart=function(e){var t=e||"",n=t.indexOf("T");return n>0&&(t=t.substr(0,n)),t},t.shortDateTime=g,t.shortDate=y,t.longDate=function(e){if(!e)return"";var t=p(e);if(!t)return"";var n=o.date.dateLong;return"/"!=o.date.daySep&&(n=n.replace(/\//g,o.date.daySep)),m(t,n)},t.monthYear=function(e){if(!e)return"";var t=p(e);if(!t)return"";var n=o.date.monthYear;return"/"!=o.date.daySep&&(n=n.replace(/\//g,o.date.daySep)),m(t,n)},t.localeDate2ISO=function(e){var t=h(e),n=f(t.y,4)+"-"+f(t.m,2)+"-"+f(t.d,2),o=Date.parse(n);return isNaN(o)?"":n},t.localeDateTime2ISO=v,t.date2ISO=function(e){var t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate();return f(t,4)+"-"+f(n,2)+"-"+f(o,2)},t.string2Float=function(e){var t=e.replace(new RegExp(o.number.thousand,"g"),"");"."!=o.number.decimal&&(t=t.replace(new RegExp(o.number.decimal,"g"),"."));var n=parseFloat(t);return isNaN(n)&&(n=0),n},t.tryParseDate=function(t){var n=e.locale.date.daySep,i=t.split(n);if(3!==i.length)return"";for(var r=0;r<3;r++)i[r]=parseInt(i[r],10);var a=0,s=0,l=0;switch(o.date.dateShort){case"dd/mm/yyyy":a=0,s=1,l=2;break;case"mm/dd/yyyy":a=1,s=0,l=2;break;case"yyyy/mm/dd":a=2,s=1,l=0}return i[l]<100&&(i[l]+=2e3),x(i,a,s,l)?(i[a]=f(i[a],2),i[s]=f(i[s],2),i[l]=f(i[l],4),i.join(o.date.daySep)):""},t.tryParseDateTime=function(e){var t=v(e);return t?g(t):""},t.localeTitle=function(e){return"object"==typeof e?e[t.currentLang]:e},t.loadLocale=n,s.indexOf(t.lang)<0&&(t.lang=t.currentLang),n(t.lang)}(t=e.ulocale||(e.ulocale={}));!function(e){e.registerFilters=function(e){e&&e.filter&&(e.filter("money",[function(){return function(e,n){var o=null===e?null:e?parseFloat(e):0;return t.money(o,n)}}]),e.filter("decimal",[function(){return function(e,n,o){var i=null===e?null:e?parseFloat(e):0;return t.decimal(i,n||0,o)}}]),e.filter("shortdate",[function(){return function(e){return t.shortDate(e)}}]),e.filter("longdate",[function(){return function(e){return t.longDate(e)}}]),e.filter("monthyear",[function(){return function(e){return t.monthYear(e)}}]))}}(e.angularjs||(e.angularjs={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t={layouts:{design:{Save:"Save",New:"New page",Open:{title:"Open page",open:"Open",close:"Close"},PageName:"Page Name",InvalidPageName:"Invalid page name",ConflictedPageName:"A page of that name exists, do you want to give another name ?",Delete:"Delete page",DeletePreferences:"Delete preferences",ConfirmDelete:"Are you sure you want to delete this page ?",ConfirmDeletePrefs:"Are you sure you want to delete preferences for this page ?",Preview:"Preview",AuthoringMode:"Authoring",layouts:"Blocks",widgets:"Widgets",fields:"Fields",actions:"Actions",properties:"Properties",childrenFlow:"Children disposition",childrenFlowVertical:"Vertical Flow",childrenTableCell:"Table cell",childrenAccordionGroup:"Accordion Group",customStyle:"Custom style",nestedLayoutName:"Nested Layout Name",nestedLayoutBind:"Bind for nested layout",nestedFormController:"Controller for nested form",columnSize:"Size",customColumnSize:"Custom Size",appearance:"Appearance",appearanceAccordion:"Accordion",appearanceTabs:"Tabs",appearanceWizard:"None",showTitle:"Show title",bindPagesTitle:"Bind",name:"Name",forceDisplayTable:"Force display(Css) table",title:"Title",actionApply:"Apply",formType:"Form Type",ftVertical:"Vertical Form",ftHorizontal:"Horizontal Form",ftInline:"Inline form",labelSize:"Label width (Bootstrap cols)",blockPosition:"Position",bpStatic:"Static",bpStickyTop:"Sticky Top",bpStickyBottom:"Sticky Bottom",noTitlesForFields:"Don't show field's titles",fieldsTitle:"Children (Fields)"},defaultTitle:"No title",NoData:"No data"},schema:{required:"{0} is required.",minNumber:"{0} must be at least {1}",maxNumber:"{0} cannot exceed {1}",minNumberExclusive:"{0} must be greater than {1}",maxNumberExclusive:"{0} must be less than {1}",uniqueColumn:"The column '{0}' must be unique.",uniqueColumns:"Duplicate value for columns '{0}' found.",passwordMismatch:"Password mismatch.",invalidEmail:"Invalid Email Address",minLength:"{0} must be at least {1} characters"},ui:{Close:"Close",Ok:"Ok",Yes:"Yes",No:"No",false:"False",true:"True",Warning:"Warning",Info:"Information",Disconnect:"Disconnect",Confirm:"Confirm",Validate:"Validate",Create:"create",password:{oldPassword:"Old Password",newPassword:"New Password",change:"Change password"},ApplyDetailChanges:"Apply",Selected:"Sel.",Add:"Add",selectedFilters:"Selected filters",OpenNewTab:"Open link in new tab",Search:"Search",Actions:"Actions"},errors:{Title:"Oops! An unknown error has occurred.",SendMail:"Send",MailSubject:"Error in JS client",ErrorTitle:"Error:",ErrorUser:"User:",ErrorDate:"Date and time:",Browser:"Browser:",ErrorURI:"Address:",Stack:"Call stack:",Context:"Context:",error500:"Internal server error",unknownError:"An unknown error has occurred.",notAuthorized:"Forbidden"},listView:{search:{Search:"Search",Nodata:"Aucun résultat trouvé ..."}},pagination:{Next:"»",Previous:"«",First:"First",Last:"Last"},number:{decimal:".",thousand:" ",places:2,symbol:"$",format:"%s %v"},charts:{numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",rangeSelectorZoom:"Zoom",rangeSelectorFrom:"From",rangeSelectorTo:"To"},date:{weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateShort:"mm/dd/yyyy",dateLong:"d mmm, yyyy",monthYear:"mmmm yyyy",shortTime:"hh:MM A",daySep:"-",weekStart:0,today:"Today",clear:"Clear"},operators:{in:{symbol:"=",title:"equal",binary:!1},nin:{symbol:"!=",title:"not equal",binary:!1},gt:{symbol:">",title:"is greater than",binary:!1},ge:{symbol:">=",title:"is greater or equal than",binary:!1},lt:{symbol:"<",title:"is less than",binary:!1},le:{symbol:">",title:"is less or equal than",binary:!1},between:{symbol:"between",title:"between",binary:!0},nbetween:{symbol:"not between",title:"not between",binary:!0},like:{symbol:"contains",title:"contains",binary:!1},nlike:{symbol:"not contains",title:"not contains",binary:!1},empty:{symbol:"is null",title:"is null",binary:!1},nempty:{symbol:"is not null",title:"is not null",binary:!1}},types:{number:{title:"Number",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},decimal:{title:"Decimal",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},money:{title:"Money",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},integer:{title:"Integer",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},date:{title:"Date",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},time:{title:"Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},"date-time":{title:"Date Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},string:{title:"String",operators:["in","nin","like","nlike","empty","nempty"]},enum:{title:"Enum",operators:["in","nin","empty","nempty"]},lookup:{title:"Lookup",operators:["in","nin","empty","nempty"]},boolean:{title:"Boolean",operators:["in","nin","empty","nempty"]}}};e.ulocale.translate(t,"en")}(Phoenix||(Phoenix={}));var Phoenix;!function(e){e.bootstrap4=!0,e.fontawesome=!1;var t;!function(t){var n={"arrow-left":"arrow-back","arrow-right":"arrow-forward","arrow-down":"arrow-downward","arrow-up":"arrow-upward",backward:"fast-rewind",bars:"menu",bolt:"toys",filter:"filter-list",wrench:"build",building:"add-to-queue",calendar:"date-range","caret-up":"arrow-drop-up","caret-down":"arrow-drop-down","check-square-o":"check-box","chevron-down":"expand-more","chevron-left":"chevron-left","chevron-right":"chevron-right","clock-o":"schedule",cloud:"cloud",cog:"settings","ellipsis-v":"more-vert","exclamation-circle":"error",eye:"visibility",forward:"fast-forward","file-o":"folder",floppy:"done","info-circle":"info",lock:"lock",minus:"remove",remove:"clear","minus-circle":"remove-circle",pencil:"edit","power-off":"power-settings-new",plus:"add","plus-circle":"add-circle","question-circle":"info",search:"search","square-o":"check-box-outline-blank",th:"apps","thumb-tack":"turned-in",times:"close","times-circle":"cancel","times-circle-o":"highlight-off",trash:"delete",user:"account-box","window-minimize":"fullscreen-exit","window-maximize":"fullscreen"},o=null,i=null,r=function(e,t,n){var o=(e||"").split(" "),i=o.indexOf(n);return t?i<0&&o.push(n):i>=0&&o.splice(i,1),o.join(" ")},a=0,s=function(){return a||(a=parseFloat(getComputedStyle(document.documentElement).fontSize)),a},l=function(t,o){void 0===o&&(o=!1);var i=e.fontawesome?t:n[t]?n[t]:t;return o?(e.fontawesome?"fa-":"mdi-")+i:(e.fontawesome?"fa fa-":"mdi mdi-")+i},u=function(e,t){return e?e.querySelectorAll(t):document.querySelectorAll(t)},c=function(e,t){return e?e.id==t?e:e.querySelector("#"+t):document.getElementById(t)},d=function(e,t){e.classList?e.classList.remove(t):e.className=r(e.className,!1,t)},p=function(e,t){return e.classList?e.classList.contains(t):(e.className||"").split(" ").indexOf(t)>=0},f=function(e){e.parentNode.removeChild(e)},m=function(e,t){e.appendChild(t)},h=function(e){var t=document.documentElement.clientTop||document.body.clientTop||0,n=document.documentElement.clientLeft||document.body.clientLeft||0,o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,i=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;return e.top=Math.round(e.top+o-t),e.left=Math.round(e.left+i-n),e},v=function(e,t){if(t){var n=t.getBoundingClientRect(),o=e.getBoundingClientRect();return{left:Math.round(o.left-n.left),top:Math.round(o.top-n.top),width:Math.round(o.width),height:Math.round(o.height)}}o=e.getBoundingClientRect();return h({left:o.left,top:o.top,width:o.width,height:o.height})},g=function(e){return null!=e&&e===e.window?e:9===e.nodeType&&e.defaultView},y=function(e,t){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},_=function(e,t,n){if(void 0===n&&(n=void 0),void 0===n)return e.getAttribute(t);e.setAttribute(t,n)},b=null,x=0,C=function(){$(window).trigger("global-phoenix-resize")},k=null,w=function(e){for(var t=(document.cookie||"").split("; "),n=0,o=t.length;n<o;n++){var i=t[n].split("=");if(e==i[0]){var r=i[1]||"";return""==r?null:r}}return null};t.readyHandlers=[function(){$(window).on("resize.phoenix",function(){k&&clearTimeout(k),k=setTimeout(C,50)})}],t.finalizeHandlers=[],t.keys={VK_TAB:9,VK_UP:38,VK_DOWN:40,VK_INSERT:45,VK_DELETE:46,VK_LEFT:37,VK_RIGHT:39,VK_ENTER:13,VK_ESCAPE:27,VK_F1:112,VK_HOME:36,VK_END:35,VK_PGUP:33,VK_PGDOWN:34,VK_SPACE:32,VK_F2:113,VK_F3:114,VK_F4:115,VK_BACKSPACE:8,VK_F10:121},t.queryAll=u,t.find=c,t.query=function(e,t){return e?e.querySelector(t):window.document.querySelector(t)},t.addClass=function(e,t){e.classList?e.classList.add(t):e.className=r(e.className,!0,t)},t.removeClass=d,t.hasClass=p,t.icon=function(e){var t=document.createElement("span");return t.className=l(e,!1),t},t.iconClass=l,t.customIconClass=function(e,t){return t?t+" "+t+"-"+e:l(e)},t.iconPrefix=function(){return e.fontawesome?"fa":"glyphicon"},t.bodyTheme=function(e){var t=document.body.firstElementChild;t&&p(t,"bs-content")||(t=document.body);for(var n=t.className||"",o=e?"bs-body-theme-"+e:"",i=n.split(" "),r=!1,a=i.length;a--;){var s=i[a];if(0==s.indexOf("bs-body-theme-")){if(s==o)return!1;r=!0,i.splice(a,1)}}o&&(r=!0,i.push(o)),r&&(t.className=i.join(" "))},t.offset=function(e){var t;if(3!=e.nodeType&&((t=e.getBoundingClientRect()).width||t.height)){var n=e.ownerDocument,o=g(n),i=n.documentElement;return{top:t.top+o.pageYOffset-i.clientTop,left:t.left+o.pageXOffset-i.clientLeft,width:t.width,height:t.height,bottom:0,right:0}}return t||{top:0,left:0,width:0,height:0,bottom:0,right:0}},t.before=function(e,t){e.parentNode.insertBefore(t,e)},t.after=function(e,t){var n=e.parentNode;(e=e.nextSibling)?n.insertBefore(t,e):n.appendChild(t)},t.parentByTag=function(e,t,n){for(n=n.toUpperCase();t;){if(t.tagName===n)return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},t.parentByAttr=function(e,t,n){for(;t;){if(_(t,n))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},t.parentByClass=function(e,t,n){for(;t;){if(p(t,n))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},t.indexOf=function(e,t){for(var n=0,o=e.childNodes.length;n<o;n++)if(e.childNodes[n]==t)return n;return-1},t.append=m,t.prepend=function(e,t){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},t.select=function(e){e&&e.select()},t.empty=function(e){for(var t=e.childNodes.length-1;t>=0;t--)e.removeChild(e.childNodes[t])},t.remove=f,t.detach=function(e){return e.parentNode.removeChild(e),e},t.downloadFrame=function(){var e=c(document.body,"glb_down_frame");return e||((e=document.createElement("iframe")).style.cssText="position: absolute; top: -1000px; left -1000px; width: 0px; height: 0px;",e.frameBorder="0",e.scrolling="yes",e.id="glb_down_frame",e.src="about:blank",m(document.body,e)),e},t.attr=_,t.text=function(e,t){if(void 0===t)return e.textContent;if(e.childNodes.length){for(var n=!1,o=0,i=e.childNodes.length;o<i;o++){var r=e.childNodes[o];if(3==r.nodeType){r.nodeValue=t,n=!0;break}}n||m(e,document.createTextNode(t))}else e.textContent=t},t.findByAttribute=function(e,t,n){for(var o=e;o;){if(!o.getAttribute)return null;if(o.getAttribute(n))return o;o=o==t?null:o.parentNode}return null},t.isChildOf=y,t.parseStyle=function(e,t){e&&e.split(" ").forEach(function(e,n){(e=e.trim())&&"$"===e.charAt(0)&&(e="bs-style-"+e.substring(1)),t.push(e)})},t.ignoreKeys=[0,t.keys.VK_UP,t.keys.VK_DOWN,t.keys.VK_HOME,t.keys.VK_END,t.keys.VK_PGUP,t.keys.VK_PGDOWN,t.keys.VK_ENTER,t.keys.VK_ESCAPE,t.keys.VK_DELETE,t.keys.VK_BACKSPACE,t.keys.VK_INSERT],t.arrowKeys=[t.keys.VK_LEFT,t.keys.VK_RIGHT,t.keys.VK_UP,t.keys.VK_DOWN],t.processing=function(e,t){e?(x++,b||(x=1,(b=$('<div class="bs-cover'+(t?" bs-none":"")+'"></div>').get(0)).style.height=$(document).height()-1+"px",m(document.body,b),t&&setTimeout(function(){b&&d(b,"bs-none")},t))):(--x<=0&&(x=0),b&&0===x&&(f(b),b=null))},t.inProcessing=function(){return null!=b},t.inCover=function(e){return b&&y(b,e)},t.scrollbar=function(){var e=!1,t=0;return function(){if(e)return t;var n,o=document.createElement("div");return o.style.cssText="overflow:scroll; overflow-x:hidden; zoom:1; clear:both",o.innerHTML="&nbsp;",document.body.appendChild(o),n=o.offsetWidth-o.scrollWidth,document.body.removeChild(o),e=!0,t=n,n}}(),t.supportCssCalc=function(){var e=!1;return function(){var t=document.createElement("a");return t.style.cssText="width: calc(10px);",e=!!t.style.length}}(),t.documentScroll=function(){return{left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}},t.documentClientDim=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},t.documentViewSize=function(){return{height:Math.max(document.documentElement.clientHeight||document.body.clientHeight,window.innerHeight||0),width:Math.max(document.documentElement.clientWidth||document.body.clientWidth,window.innerWidth||0)}},t.touch=function(){var e=!1,t=!1;return function(){return e?t:(t="ontouchend"in document,e=!0,t)}}(),t.position=v,t.childrenPositions=function(e,t,n,o,i){var r=new Array(t.length+1),a=i.firstDelta||0,s=i.lastDelta||0,l=i.delta||0,u=i.height||0,d=i.top||0;t.forEach(function(t,i){var s=c(e,t.htmlId),u=v(s,null);r[i]={info:t.info,zone:o,position:"before",vertical:n,point:{x:0,y:0},left:u.left+(n?0:0===i?a:l),top:d||u.top,width:Math.round(s.offsetWidth),height:Math.round(s.offsetHeight),htmlId:t.htmlId}});var p=null;if(r.forEach(function(e){var t=e.point;t.y=e.top+(e.height>>1),t.x=e.left+(e.width>>1),p=e}),p){var f=s-(0===r.length?a:l);p={position:"after",zone:o,info:p.info,vertical:p.vertical,point:{x:0,y:0},left:p.left+(n?0:f)+(n?0:p.width),top:p.top+(n?p.height:0),width:p.vertical?p.width:0,height:u||(p.vertical?0:p.height),htmlId:p.htmlId}}else{var m=v(e,null);p={info:{},position:"empty",zone:o,vertical:n,point:{x:0,y:0},left:m.left+(n?0:s),top:d||m.top,width:Math.round(e.offsetWidth),height:u||Math.round(e.offsetHeight),html:e.id}}return p.point.y=p.top+(p.height>>1),p.point.x=p.left+(p.width>>1),r[t.length]=p,r},t.findNearest=function(e,t,n){var o,i,r=1e6;return n.forEach(function(n){var a,s=Math.abs(n.point.y-t);s<r?(r=s,i=Math.abs(n.point.x-e),o=n):s==r&&(a=Math.abs(n.point.x-e))<i&&(i=a,o=n)}),o},t.showMove=function(e,t,n,o){if(o=o||"bs-drag-color-info",e)if(e.vertical!==t)f(e),e=null;else{var i=e.firstChild.firstChild;p(i,o)||(f(e),e=null)}if(!e){var r=['<div class="bs-absolute">'];r.push('<div class="bs-absolute" style="left: 0px; top: 0px"><span class="'),t?r.push(l("arrow-left")):r.push(l("arrow-down")),o&&r.push(" "+o),r.push('"></span></div>');var a=[];r.push('<div class="bs-absolute" style="'),t?(a.push("right: 0px;"),a.push("bottom: 0px;"),r.push(a.join("")),r.push('"><span class="'),r.push(l("arrow-right"))):(a.push("left: 0px;"),a.push("bottom: 0px;"),r.push(a.join("")),r.push('"><span class="'),r.push(l("arrow-up"))),o&&r.push(" "+o),r.push('"></span></div>'),r.push("</div>"),(e=$(r.join("")).get(0)).vertical=t,m(document.body,e)}var s=e.style,u=e.firstElementChild,c=e.lastElementChild,d=Math.round(u.offsetWidth),h=Math.round(c.offsetHeight);return t?(s.height=h+"px",s.width=n.width+2*d+"px",s.left=n.left-d+"px",s.top=n.top-(h>>2)-4+"px"):(s.height=n.height+2*h+"px",s.top=n.top-h+"px",s.left=n.left-(d>>2)+"px"),s.zIndex="9002",e},t.featureTest=function(e,t,n){var o=e+":",i=document.createElement("test").style;return i.cssText=n?o+t:o+["-webkit-","-moz-","-ms-","-o-",""].join(t+";"+o)+t+";",-1!==i[e].indexOf(t)},t.getPx=function(e){return parseInt(e,10)||0},t.removeStype=function(e,t){e.style.removeProperty?e.style.removeProperty(t):e.style[t]="border"===t?"none":""},t.rem2px=function(e){return Math.round(e*s())},t.checkSize=function(e){return"number"==typeof e?e+"px":e},t.bootstrapStyles=function(t){if(t)return i||(n=e.bootstrap4,i={primary:n?"outline-primary":"primary",secondary:n?"outline-secondary":"default",default:n?"outline-secondary":"default",important:n?"outline-important":"important",success:n?"outline-success":"success",info:n?"outline-info":"info",danger:n?"outline-danger":"danger",warning:n?"outline-warning":"warning",link:n?"outline-link":"link",dark:n?"outline-dark":"default"});if(o)return o;var n=e.bootstrap4;return o={primary:"primary",secondary:n?"secondary":"default",default:n?"secondary":"default",important:"important",success:"success",info:"info",danger:"danger",warning:"warning",link:"link",dark:"default"}},t.selectRange=function(e,t,n){void 0===n&&(n=t),e.setSelectionRange(t,n)},t.childrenRectsbyAttribute=function(e,t){for(var n=u(e,"[data-"+t.attributeName+"]"),o=[],i=0,r=n.length;i<r;i++){var a=n[i],s=v(a,e);s.value=_(a,"data-"+t.attributeName),o.push(s)}return o},t.findAttrByPosition=function(e,t,n){for(var o=0;o<n.length;o++){var i=n[o];if(e>=i.left&&t>=i.top&&e<=i.left+i.width&&t<=i.top+t)return i}return null},t.setCookie=function(e,t,n,o){try{t||(o=new Date),document.cookie=e+"="+t+(null!=o?"; expires="+o.toUTCString():"")+(n?"; path="+n:"/")}catch(e){return!1}return w(e)==t},t.getCookie=w}(t=e.dom||(e.dom={})),$(document).ready(function(){t.readyHandlers.length&&t.readyHandlers.forEach(function(e){e()})})}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.utils,o=t.dom,i=t.customData,r=t.device,a=t.application,s=t.external,l=t.authentication,u=t.history;!function(c){var d=[],p=function(e){if(!e)return"";var t=[];return Object.keys(e).forEach(function(n){null!==e[n]&&t.push(n+"="+encodeURIComponent(e[n]||""))}),t.length>0?"?"+t.join("&"):""},f=function(e){var t={},n=e;"#"===n.charAt(0)&&(n=n.substr(1)),u.locationPrefix&&n.charAt(0)===u.locationPrefix&&(n=n.substr(1));var o=n.indexOf("?");if(o>=0){var i=n.substring(o+1);n=n.substring(0,o),i&&i.split("&").forEach(function(e){if(e){var n=e.split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}})}return{path:n,search:t}},m=function(e){for(var t=0,n=d.length;t<n;t++){var o=d[t];if(o.test(e))return o}return null},h=function(){return f(window.location.href).search},v=function(e){var t=e.$page;return r.phone&&e.$pageMobile?t=e.$pageMobile:r.tablet&&e.$pageTablet&&(t=e.$pageTablet),t},g=function(e){var n=null;try{n=JSON.parse(l.db().getItem("authentication"))}catch(e){}var o={$url:h(),$mem:t.$mem,$user:{name:n?n.name||n.nom||n.login:"",firstName:n?n.firstName||n.prenom||n.login:"",lastName:n?n.lastName||n.nom||"":""},$item:null,$cookie:null,$target:null};return e&&e.cookie&&(o.$cookie={},(document.cookie||"").split(";").forEach(function(e){var t=e.split("=");t[0]=t[0].replace(/^ /,""),o.$cookie[decodeURIComponent(t[0])]=decodeURIComponent(t[1])})),o},y=function(e,t,o){if(e.$page){var i=v(e),r="#"+u.locationPrefix+"/"+i,a=[];if(t&&e.$search&&e.$search.length){var s=g();Object.keys(t).forEach(function(e){s[e]=t[e]}),e.$search.forEach(function(e){e&&e.left&&a.push(e.left+"="+encodeURIComponent(n.parseVariable(e.right,s)))})}return o&&Object.keys(o).forEach(function(e){a.push(e+"="+encodeURIComponent(o[e]))}),a.length&&(r=r+"?"+a.join("&")),r}return"#"},_={},$=function(e){var t=e.indexOf("://");if(t>0){var n=_[e.substring(0,t)];if(n)return n.protocol}return null},b=function(e,t,n,o,i){var r,a=location.pathname.split("/"),s="";a[a.length-1].indexOf(".html")>0&&(s=a.pop());var l=a.pop();if(s||""!=l||a.pop(),a.push(t),s&&a.push(s),r=a.join("/"),e&&"#"===(""+e).charAt(0)||(e="#"+e),u.locationPrefix&&e.charAt(1)!==u.locationPrefix&&(e="#"+u.locationPrefix+e.substr(1)),r+=e,i){var c=document.createElement("a");return c.href=r,c.target="_blank",document.body.appendChild(c),c.click(),void document.body.removeChild(c)}o?location.replace(r):location.href=r},x=function(t){return"#"+(e.history.locationPrefix?e.history.locationPrefix:"")+t.path+p(t.search)},C=function(e,t,n,o){if(e&&"#"===(""+e).charAt(0)||(e="#"+e),u.locationPrefix&&e.charAt(1)!==u.locationPrefix&&(e=e="#"+u.locationPrefix+e.substring(1)),n){var i=document.createElement("a");return i.href=e,i.target="_blank",document.body.appendChild(i),i.click(),void document.body.removeChild(i)}window.location.hash!==e&&(s.hashHandler?s.hashHandler(e,t,o):(u.removeLast(),t&&"replaceState"in window.history?window.history.replaceState(void 0,void 0,e):location.hash=e))},k=function(e){s.formOpenHandler&&s.formOpenHandler(e)},w=function(e){if(e.name&&e.schema){var t="/authoring/forms/"+e.name,n=[];e.schema!==e.name&&n.push("prototype="+encodeURIComponent(e.schema)),e.locale&&n.push("locale="+encodeURIComponent(e.locale)),e.path&&n.push("path="+encodeURIComponent(e.path));var o=window.location.href.lastIndexOf("?");if(o>0){var i=[];window.location.href.substr(o+1).split("&").forEach(function(e){var t=e.split("=");["prototype","path","locale"].indexOf(t[0])<0&&i.push(e)}),n.push(i.join("&"))}n.length&&(t=t+"?"+n.join("&")),window.location.hash="#"+u.locationPrefix+t}},E=function(e,t){var n="/authoring",o=window.location.hash;"#"===o.charAt(0)&&(o=o.substring(1)),u.locationPrefix&&o.charAt(0)===u.locationPrefix&&(o=o.substring(1)),t||0!==o.indexOf(n)?window.location.hash="#"+u.locationPrefix+n+(e?"/"+e:o):0===o.indexOf("/authoring/forms/")?window.history.back():window.location.hash="#"+u.locationPrefix+o.substring(n.length)};c.search=h,c.object2search=p,c.parseUrl=f,c.hashLink=y,c.pageName=v,c.isCustomLink=function(e,t,n){for(var i=t.target;i&&i!=e;){var r=o.attr(i,"data-phoenix-href")||o.attr(i,"href");if(r){if("#"===r){n||(t.preventDefault(),t.stopPropagation());break}var a=$(r);if(a)return n||(t.preventDefault(),t.stopPropagation()),{protocol:a,value:r}}i=i.parentNode}return null},c.registerLinkExecutor=function(e){d.push(e)},c.getLinkExecutor=m,c.registerCustomProtocol=function(e,t){_[e]={protocol:e,handler:t}},c.execCustomProtocol=function(e,t,n,o){var i=_[e.protocol];i&&i.handler&&i.handler(e.value,t,n,o)},c.isCustomProtocol=$,c.doAuthoring=E,c.doFormAuthoring=w,c.execLink=function(e,t,n){var o=a.configuration&&a.configuration.application?a.configuration.application.modules:null;if(e.$page){var r=e.$module?e.$module:a.name;if(o&&o[r]&&a.licences){var l=a.licences[o[r]];if(l&&!l.hasLicence&&s.forbiddenHandler)return s.forbiddenHandler()}var u=y(e,t,n),c=t&&"blank"===t.$target;if(e.$module&&e.$module!==a.name)return b(u,e.$module,a.name,e.$replace,c);C(u,e.$replace,c,!1),e.$authoring&&E()}else if(e.$logout)s.logoutHandler&&s.logoutHandler();else if(e.$form)k(e.$form);else if(e.$action&&e.$action.name){var d=i.get(e.$action.name);d&&d(e.$action.params)}else if(e.$formAuthoring)w(e);else if(e.$authoring)E();else if(e.$back)window.history.back();else if(e.href){var p=document.createElement("a");p.href=e.href,e.target&&(p.target=e.target),document.body.appendChild(p),p.click(),document.body.removeChild(p)}else{var f=m(e);f&&f.hnd(e)}},c.context=g,c.changeSearch=function(e){var t=f(window.location.hash);n.merge(e,t.search);var o=x(t);C(o,!0,!1,!0)}}(e.link||(e.link={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.link,o=t.utils;n.registerCustomProtocol("page",function(e,o,i,r){o.$url||(o.$url=n.search()),o.$mem||(o.$mem=t.$mem);var a=e.indexOf("://");if(!(a<=0)){var s,l=e.substring(a+3),u=n.parseUrl(l),c=u.path.split("/");u.search.$replace&&(s=!0,delete u.search.$replace);var d={$page:c[0],$search:[],$replace:s,$menu:null};c.length>1&&(d.$menu=c[1]),Object.keys(u.search).forEach(function(e){d.$search.push({left:e,right:u.search[e]})}),n.execLink(d,o,null)}}),n.registerCustomProtocol("link",function(e,t,i,r){var a=e.substring("link://".length),s=a.indexOf("/");if(s<=0&&(s=a.indexOf("?")),s>0){var l=n.parseUrl(a.substring(s));a=a.substring(0,s),l.search&&(r?o.extend(r,l.search):r=l.search)}i.links&&i.links[a]&&n.execLink(i.links[a],t,r)}),n.registerCustomProtocol("click",null)}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.dom;e.utils;!function(e){var n=function(){function e(){}return e.prototype.disable=function(){this._isDisabled=!0},e.prototype.enable=function(){this._isDisabled=!1},e}();e.EventManager=n,e.mouseEvents=function(e){if(t.touch())switch(e){case"mousedown":return"touchstart";case"mouseup":return"touchend";case"mousemove":return"touchmove"}return e},e.isLeftButton=function(e){return!!t.touch()||e.which<2},e.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},e.point=function(e){var n,o=document.documentElement;if(t.touch()){var i=e.targetTouches||e.touches;i&&(n={x:i[0].pageX||i[0].clientX+(o.scrollLeft||document.body.scrollLeft),y:i[0].pageY||i[0].clientY+(o.scrollTop||document.body.scrollTop)})}return n||(n={x:e.pageX||e.clientX+(o.scrollLeft||document.body.scrollLeft),y:e.pageY||e.clientY+(o.scrollTop||document.body.scrollTop)}),n.x=Math.round(n.x),n.y=Math.round(n.y),n},e.eventManager=new n}(e.events||(e.events={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.dom,n=e.utils,o=e.events,i=e.customData;!function(e){var r=function(){function e(){}return e.prototype.initialize=function(){var e=this,t=$(document);e._mu=e.mouseUp.bind(e),e._md=e.mouseDownEmpty.bind(e),t.on(o.mouseEvents("mouseup"),e._mu),t.on(o.mouseEvents("mousedown"),e._md)},e.prototype.finalize=function(){var e=this,t=$(document);e._mu&&(t.off(o.mouseEvents("mouseup"),e._mu),e._mu=null),e._md&&(t.off(o.mouseEvents("mousedown"),e._mu),e._md=null),e._listeners=null,e._current=null},e.prototype.startMouseMove=function(){var e=this;e._mm||(e._mm=e.mouseMove.bind(e),$(document).on(o.mouseEvents("mousemove"),e._mm))},e.prototype.stopMouseMove=function(){var e=this;e._mm&&($(document).off(o.mouseEvents("mousemove"),e._mm),e._mm=null)},e.prototype._canExecuteEvent=function(e){return!!this._current},e.prototype.mouseUp=function(e){var t=this,n=t._current;return!n||(n.inDragging&&n.notifyDragEnd(!1,e),t.setCurrent(null),n.clear(),!1)},e.prototype.mouseDownEmpty=function(e){return!0},e.prototype.mouseMove=function(e){var t=this;if(t._canExecuteEvent(e)){var n=t._current;if(!n)return!0;if(!n.ready(e))return o.isLeftButton(e)||(t.setCurrent(null),n.clear()),!0;if(!o.isLeftButton(e))return t.cancelDrag(),!0;try{n.notifyDrag(e)}catch(e){t.cancelDrag()}return o.stopEvent(e),!0}},e.prototype.addDrag=function(e){var t=this,n=new a(e);return t._listeners=t._listeners||[],t._listeners.push(n),n},e.prototype.rmvDrag=function(e){var t=this;if(t._listeners){var n=t._listeners.indexOf(e);n>=0&&(t._listeners.splice(n,1),e.finalize())}},e.prototype.setCurrent=function(e){var t=this;return(!e||!t._current)&&(t._current=e,t._current||t.stopMouseMove(),!0)},e.prototype.cancelDrag=function(){var e=this,t=e._current;t&&(t.inDragging&&t.notifyDragEnd(!0,null),e.setCurrent(null),t.clear())},e.prototype.cover=function(e,o,i){var r=this;if(e)if(r._coverId)void 0!==o&&((u=t.find(document.body,r._coverId)).style.cursor=o);else{r._coverId=n.allocID();var a=t.documentScroll(),s=t.documentClientDim();s.width+=a.left,s.height+=a.top,s.width=Math.round(Math.max(s.width,document.body.offsetWidth)),s.height=Math.round(Math.max(s.height,Math.round(document.body.offsetHeight)));var l=document.createElement("div");l.id=r._coverId,l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.style.backgroundColor="white",l.style.opacity="0.01",l.style.width=s.width+"px",l.style.height=s.height+"px",l.style.zIndex=(i||1e4)+"",l.style.cursor=o,t.append(document.body,l)}else if(r._coverId){var u=t.find(document.body,r._coverId);r._coverId=null,u&&t.remove(u)}},e}();e.DragAndDropManager=r;var a=function(){function r(e){var t=this;t._elements=e,t._mdEvent=t.mousedown.bind(t),t.clear(),t._setEvents()}return r.prototype.clear=function(){var e=this,t=e.stopEvent;e.mouseMoveCount=0,e._lastDropTarget=null,e.minLeft=null,e.maxLeft=null,e.minTop=null,e.maxTop=null,e.currentLeft=0,e.currentTop=0,e.moveX=!1,e.moveY=!1,e.moveSourceName=null,e._targets=null,e.inDragging=!1,e.coverDocument=!0,e.cursor="default",e.startPoint=null,e.currentPoint=null,e.startOffset=null,e.stopEvent=!1,e.data={},e.floatElement=null,e.floatParent=null,e.stopEvent=t},r.prototype._removeEvents=function(){var e=this;e._elements&&(e._elements.forEach(function(t){$(t).off(o.mouseEvents("mousedown"),e._mdEvent)}),e._elements=null)},r.prototype._setEvents=function(){var e=this;e._elements&&e._elements.forEach(function(t){$(t).on(o.mouseEvents("mousedown"),e._mdEvent)})},r.prototype.mousedown=function(t){var n=this;return n.mouseMoveCount=0,n.inDragging=!1,!o.isLeftButton(t)||(!n.canStartDrag(t)||(!e.dragManager.setCurrent(n)||(n.startPoint=o.point(t),e.dragManager.startMouseMove(),n.stopEvent&&o.stopEvent(t),!1)))},r.prototype.finalize=function(){var e=this;e._removeEvents(),n.cleanUpObject(e)},r.prototype.ready=function(e){var t=this;return t.mouseMoveCount++,2==t.mouseMoveCount&&t.notifyDragStart(e),t.inDragging},r.prototype.notifyDrag=function(e){var n=this;if(n.inDragging){n.currentPoint=o.point(e);var i=n.floatElement;if(i&&n.moveX){var r=n.startOffset.left+n.currentPoint.x-n.startPoint.x;null!==n.minLeft&&r<n.minLeft&&(r=n.minLeft),null!==n.maxLeft&&r>n.maxLeft&&(r=n.maxLeft),n.currentLeft=r,i.style.left=r+"px"}if(i&&n.moveY){var a=n.startOffset.top+n.currentPoint.y-n.startPoint.y;null!==n.minTop&&a<n.minTop&&(a=n.minTop),null!==n.maxTop&&a>n.maxTop&&(a=n.maxTop),n.currentTop=a,i.style.top=a+"px"}if(n.onDrag&&n.onDrag(e),i&&n._targets){var s=t.position(i,null),l=t.findAttrByPosition(s.left,s.top,n._targets);n.canDrop(!!l),n._lastDropTarget=l?{value:l.value,x:s.left-l.left,y:s.top-l.top}:null}}},r.prototype.notifyDragStart=function(n){var i=this;i.inDragging=!0,o.eventManager.disable(),i.coverDocument&&e.dragManager.cover(!0,i.cursor);try{var r=!0;i.onDragStart&&(i.onDragStart(n)||(i.notifyDragEnd(!0,n),r=!1),i.floatElement&&(i.startOffset=t.position(i.floatElement,i.floatParent))),r&&(i.moveX||i.moveY)&&i.moveSourceName&&(i._targets=t.childrenRectsbyAttribute(null,{attributeName:"drag-"+i.moveSourceName}))}catch(e){}},r.prototype.canStartDrag=function(e){var t=this;return!t.canStartDragHandler||t.canStartDragHandler(e)},r.prototype.canDrop=function(t){var n=this;n.coverDocument&&e.dragManager.cover(!0,t?n.cursor:"no-drop")},r.prototype.notifyDragEnd=function(t,r){var a=this;a.inDragging=!1;var s=a.coverDocument;if(a.onDragEnd&&a.onDragEnd(t,r),a._lastDropTarget&&!t){var l=i.get(a._lastDropTarget.value);l&&"object"==typeof l&&l.dragEnd&&l.dragEnd(r)}n.nextTick(function(){o.eventManager.enable(),s&&e.dragManager.cover(!1)})},r}();e.DragElement=a,e.dragManager=new r,t.readyHandlers.push(function(){e.dragManager.initialize()}),t.finalizeHandlers.push(function(){e.dragManager.finalize()});var s;e.setData=function(e){s=e},e.getData=function(){return s}}(e.drag||(e.drag={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.dom;!function(e){e.topOffset=0,e.bottomOffset=0;var n=t.featureTest("position","sticky",!1),o=t.featureTest("position","fixed",!0),i={active:"bs-sticky-on",inactive:"bs-sticky-off",clone:"bs-sticky-dummy"},r=function(n,o,r){o?(t.addClass(n,i.active),"top"===r?n.style.top=e.topOffset+"px":"bottom"===r&&(n.style.bottom=e.bottomOffset+"px"),t.removeClass(n,i.inactive)):(t.addClass(n,i.inactive),t.removeClass(n,i.active),t.removeStype(n,"width"),t.removeStype(n,"top"),t.removeStype(n,"bottom"))},a=function(e,n){var o=e.element,i=($(o),t.find(o.parentNode,e.id+"_sticky_clone"));r(o,!1,n),i&&t.remove(i)},s=function(n){var o,a,s=n.element,l=$(s),u=t.offset(s),c=l.outerHeight(),d=0,p=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,f=t.hasClass(s,i.active),m=$(window).height(),h=l.parent(),v=h.offset().top,g=h.outerHeight(),y=t.find(h.get(0),n.id+"_sticky_clone");if(y){b=t.offset(y);y.style.height=c+"px",d=b.width?b.top:u.top}else d=u.top,(y=document.createElement("div")).id=n.id+"_sticky_clone",y.className=i.clone,y.style.height=c+"px",t.after(s,y);var _={top:"top"===n.position,bottom:"bottom"===n.position};if(o=0,a=0,_.top&&function(){var t=p+o+e.topOffset;return d<t&&t+c<=v+g}()||_.bottom&&d+(c||0)>p+m-a&&p+m-a>=v+(c||0))if(f){var b=t.offset(y);s.style.width=b.width+"px"}else r(s,!0,n.position),s.style.width=u.width+"px";else f&&r(s,!1,n.position)},l=function(){function e(){this._map={},this._list=[],this._scroll=null,this._resize=null,this._refreshTimer=null,this._scrollTimer=null}return e.prototype.add=function(e){var t=this;!n&&o&&(t._map[e.id]=e,t._list.push(e))},e.prototype.remove=function(e){var t=this,n=t._map[e];if(void 0!==n){n.element&&a(n,n.position),n.element=null,delete t._map[e];var o=t._list.indexOf(n);o>=0&&t._list.splice(o,1)}},e.prototype.initialize=function(){var e=this;!n&&o&&(e._scroll=e._onscroll.bind(e),e._resize=e._onresize.bind(e),$(window).on("scroll.sticky",e._scroll),$(window).on("global-phoenix-resize",e._resize))},e.prototype._updateElements=function(e){this._list.forEach(function(n){var o=n.element;e&&!t.hasClass(o,i.active)||o.offsetWidth&&s(n)})},e.prototype._onscroll=function(){var e=this;e._scrollTimer&&(window.clearTimeout(e._scrollTimer),e._scrollTimer=null),e._scrollTimer=window.setTimeout(function(){e._updateElements(!1)},20),e._updateElements(!1)},e.prototype._onresize=function(){this._updateElements(!0)},e.prototype._refresh=function(e){var t=this;e&&t._updateElements(!1)},e.prototype.refresh=function(e){var t=this;t._refreshTimer&&(window.clearTimeout(t._refreshTimer),t._refreshTimer=null),t._refreshTimer=window.setTimeout(function(){t._refresh(e)},200)},e.prototype.finalize=function(){if(!n&&o){var e=this;e._refreshTimer&&(window.clearTimeout(e._refreshTimer),e._refreshTimer=null),e._scrollTimer&&(window.clearTimeout(e._scrollTimer),e._scrollTimer=null),$(window).off("scroll.sticky",e._scroll),$(window).off("global-phoenix-resize",e._resize),e._scroll=null,e._resize=null}},e}();e.StickyManager=l,t.readyHandlers.push(function(){e.stickyManager.initialize()}),t.finalizeHandlers.push(function(){e.stickyManager.finalize()}),e.stickyManager=new e.StickyManager,e.native=n||!o}(e.sticky||(e.sticky={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(e){e.compare=function(e,t,n){var o=[];return n=n||{},i(e,t,o,"",n),o};var t=function(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}return Object.keys(e)},n=function(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")},o=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},i=function(e,r,a,s,l){for(var u=l.useId,c=Array.isArray(r),d=t(r),p=t(e),f=!1,m=p.length-1;m>=0;m--){var h=e[y=p[m]],v=c&&u&&h.id?h.id+"":y;if(!r.hasOwnProperty(y)||void 0===r[y]&&void 0!==h&&!1===Array.isArray(r))a.push({op:"remove",path:s+"/"+n(v)}),f=!0;else{var g=r[y];"object"==typeof h&&null!=h&&"object"==typeof g&&null!=g?i(h,g,a,s+"/"+n(v),l):h!==g&&(!0,a.push({op:"replace",path:s+"/"+n(v),value:o(g)}))}}if(f||d.length!=p.length)for(m=0;m<d.length;m++){var y=d[m];e.hasOwnProperty(y)||void 0===r[y]||a.push({op:"add",path:s+"/"+(c&&u?"-":n(y)),value:o(r[y])})}}}(e.jsonpatch||(e.jsonpatch={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(e){e.OPERATORS={in:"in",nin:"nin",gt:"gt",ge:"ge",lt:"lt",le:"le",between:"between",nbetween:"nbetween",like:"like",nlike:"nlike",empty:"empty",nempty:"nempty"},e.TYPES={number:"number",decimal:"decimal",money:"money",integer:"integer",date:"date",time:"time","date-time":'"date-time',string:"string",enum:"enum",lookup:"lookup",boolean:"boolean"}}(e.filters||(e.filters={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.application,o=t.ajax,i=t.ulocale;!function(e){var t={get:function(e,t,r){t&&i.lang&&(e=e+"_"+i.lang);var a=n.config(r);if(!a)throw"Application configuration not found.";return o.get(a.current.menus+"/"+e+".json",{cache:!0},null)}};e.menu=t}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t,n=e,o=n.ulocale,i=(n.utils,n.ajax),r=n.application;!function(n){var a={get:function(e,t,n){t&&o.lang&&(e=e+"_"+o.lang);var a=r.config(n);if(!a)throw"Application configuration not found.";return i.get(a.current.locales+"/"+e+".json",{cache:!0},function(t){return t&&(t.$name=e),t.$view&&(t.$view.$name=e),t})}};(t=e.data||(e.data={})).schema=a}()}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.ajax,o=t.utils,i=e.dom,r=t.link,a=t.application;!function(e){var t=function(e,n){if(i.getCookie(e))return n();window.setTimeout(t.bind(window,e,n),500)},s=function(e){return e},l={get:function(e){return new o.Promise(function(t,n){var o={$url:e,$method:"GET"};l.getRessources(o,function(e){t(e)})})},put:function(e,t){return new o.Promise(function(n,o){var i={$url:e,$method:"PUT",$data:t};l.getRessources(i,function(e){n(e)})})},post:function(e,t){return new o.Promise(function(n,o){var i={$url:e,$data:t,$method:"POST"};l.getRessources(i,function(e){n(e)})})},remove:function(e){var t={$url:e,$method:"DELETE"};return l.getRessources(t,null)},getRessources:function(e,l){var u=l?function(e){return e=l(e)}:null,c=e.$url,d=!1,p=e.$download,f="";p&&(delete e.$download,e.$cookie&&(f=e.$cookie,delete e.$cookie,i.setCookie(f,"","/",null)));var m=a.config(a.name)||{};m.rest=m.rest||{};var h=m.rest.base||"";!c||"/"!==c.charAt(0)&&"."!==c.charAt(0)||(h=""),h?c=h+"/"+c:d=!0;var v={};void 0===e.$module&&m.rest.$module&&(e.$module=m.rest.$module),e.$module?v.$module=e.$module:c=c.replace("{$module}/",""),m.rest.$context?v.$context=m.rest.$context:c=c.replace("{$context}/",""),c=o.formatNames(c,v);var g=n.getDefaultAjaxOptions(),y=e.$query;e.$list;switch(c+=r.object2search(y),c=s(c),e.$method){case"POST":return u?new o.Promise(function(t,o){n.post(c,e.$data,g).then(function(e){e=u(e),t(e)}).catch(function(e){o(e)})}):n.post(c,e.$data,g);case"PUT":return n.put(c,e.$data,g);case"PATCH":return n.patch(c,e.$data,g);case"DELETE":return n.remove(c,g);default:if(p){var _=i.downloadFrame();return d&&(c=n.addAuthToUrl(c)),_.src=c,f?new o.Promise(function(e,n){t(f,e)}):o.Promise.resolve()}return n.get(c,g,function(e){return u?u(e):e})}}};e.rest=l}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.application,o=t.ajax,i=t.link;!function(e){var t={getRessources:function(e,t){var r=function(e){return t&&(e=t(e)),e},a=n.config(n.name);if(!a)throw"Application configuration not found.";var s=a.localData+"/"+e.$url,l=e.$query;return s+=i.object2search(l),o.get(s,{},function(e){return r(e)})}};e.local=t}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.application,o=t.link,i=t.authentication,r=t.utils,a=t.ajax;!function(t){var s={},l=function(e){return e},u=function(e){return 0!==e.indexOf("http")&&(e=window.location.origin+e),e},c={v4:!0,transport:{doPost:a.post,doPut:a.put,doDelete:a.remove,doGet:function(e,t,n,o){return a.get(e,t,n)},doPatch:a.patch},afterLogout:function(){s={}},addImageUrlToken:function(e){var t=n.config(n.name)||{};if(t.odata=t.odata||{},t&&t.odata&&t.odata.authentication){var o=i.load();if(o)switch(t.odata.authentication){case"header-session":e=e+"?token="+o.token}}return e},baseUrl:function(e){var t=n.config(n.name)||{};t.odata=t.odata||{};var o=t.odata.base||"/data",i={};return void 0===(e=e||{}).$module&&t.odata.$module&&(e.$module=t.odata.$module),e.$module?i.$module=e.$module:o=o.replace("{$module}/",""),t.odata.$context?i.$context=t.odata.$context:o=o.replace("{$context}/",""),r.formatNames(o,i)},urlResEntity:function(e,t){var n=c.baseUrl(e);if(!e.$entity)throw"Invalid odata entity.";if(t&&!e.$entityId)throw"Invalid odata entity id.";var o=n+"/"+e.$entity;return e.$entityId&&(o=o+"("+e.$entityId+")"),e.$propertyName&&(o=o+"/"+e.$propertyName),o},doDelete:function(e,t){var n=c.urlResEntity(e,!0),o=a.getDefaultAjaxOptions();return t&&(o.headers["If-Match"]=t),o.ignore={410:!0},n=l(n),c.transport.doDelete(n,o)},doPost:function(e,t){var n=a.getDefaultAjaxOptions(),o=c.urlResEntity(e,!1);return o=l(o),c.transport.doPost(o,t,n)},doPut:function(e,t,n,o){var i=c.urlResEntity(e,!0),r=a.getDefaultAjaxOptions();return r.headers=r.headers||{},n&&(r.headers["If-Match"]=n),o&&(r.headers.Prefer="return=representation"),i=l(i),c.transport.doPut(i,t,r)},doPatch:function(t,n,o,i){var r=c.urlResEntity(t,!0),s=a.getDefaultAjaxOptions();return s.headers=s.headers||{},e.application.useJSONPatch&&(s.headers["Content-Type"]="application/json-patch+json"),o&&(s.headers["If-Match"]=o),i&&(s.headers.Prefer="return=representation"),r=l(r),c.transport.doPatch(r,n,s)},applyFilters:function(e,t,n,o,i,r){var a=[],s=e.length;if((t=(t||"")+"")&&n&&n.length){var l=n.length,u=t.toLowerCase();e.forEach(function(e){for(var t=!1,o=0;o<l;o++)if(((e[n[o]]||"")+"").toLowerCase().indexOf(u)>=0){t=!0;break}t&&a.push(e)}),s=a.length}else a=e;o=o||0;var c=i||a.length;if(r){var d=r.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 2===t.length?{field:t[0],asc:"asc"===t[1]}:{field:e,asc:!0}});a.sort(function(e,t){for(var n=0;n<d.length;n++){var o=d[n],i=e[o.field],r=t[o.field];if(i!==r){var a=i>r?1:-1;return o.asc||(a*=-1),a}}return 0})}var p=a.slice(o,o+c);return{documents:p,count:s,dataCount:p.length,skip:o,pageSize:i,nodata:0===p.length,search:t,orderBy:r}},getRessources:function(e,i,d){var p=function(e){return i&&(e=i(e)),e},f=!1,m=e.$cache;delete e.$cache;var h=n.config(n.name)||{};h.odata=h.odata||{},void 0!=h.odata.v4&&(c.v4=h.odata.v4);var v=h.odata?h.odata.base||"/data":"/data",g={};void 0===e.$module&&h.odata.$module&&(e.$module=h.odata.$module),e.$module?g.$module=e.$module:v=v.replace("{$module}/",""),h.odata.$context?g.$context=h.odata.$context:v=v.replace("{$context}/",""),v=r.formatNames(v,g),delete e.$module;var y=e.$entity;e.$entityId&&(y=y+"("+e.$entityId+")",delete e.$entityId,f=!0),e.$propertyName&&(y=y+"/"+e.$propertyName,delete e.$propertyName,f=!0);var _=y;delete e.$entity;var b="",x=[],C=e.$skip||0,k=e.$top,w=e.$orderby;e.$searchByFieldsValue&&(b=e.$searchByFieldsValue,x=e.$searchByFieldsFields,delete e.$searchByFieldsValue,delete e.$searchByFieldsFields),f||(c.v4?(e.$top&&!e.nocount&&(e.$count=!0),delete e.nocount):e.$inlinecount="allpages");var E=e.$allData;E&&(delete e.$skip,delete e.$top,delete e.$allData,delete e.$orderby);var P=a.getDefaultAjaxOptions();return P.$errors=d,_=v+"/"+_+o.object2search(e),m&&s[y]&&s[y].uri===_?new r.Promise(function(e,t){e(p(f?s[y].data:$.extend(!0,{},s[y].data)))}):(_=l(_),t.odata.transport.doGet(_,P,function(e){var t={};if(c.v4&&e&&delete e["@odata.context"],f)t=e;else{if(t.documents=c.v4?e.value:e.d.results,E&&(t._origData=[]),t.documents.forEach(function(e){delete e.__metadata,E&&t._origData.push($.extend(!0,{},e))}),E){var n=c.applyFilters(t.documents,b,x,C,k,w);t.documents=n.documents,t.count=n.count}else t.count=c.v4?e["@odata.count"]:e.d.__count;t.dataCount=t.documents.length,t.pageSize=k,t.skip=C,t.nodata=0==t.dataCount,t.uri=u(_),t.search=b,t.orderBy=w}return m&&(s[y]={uri:_,data:$.extend(!0,{},t)}),p(t)},{entity:y,params:e}))}};t.odata=c,i.registerAfterLogout(c.afterLogout)}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.link,o=t.utils,i=t.data,r=t.customData,a=t.application;!function(e){var s=function(e,t){if(e.$transform){var n=r.get("datasets.transform."+e.$transform);n&&(t=n(t))}return t},l=function(e,t,n){if(!e)return t;var o=r.get("datasets.transform."+e);return o?o($.extend(!0,{},t,n)):t},u=function(){var e={};return{register:function(t,n){e[t]=n},get:function(t){return e[t]}}}(),c=function(e){return e=e||{},e.$type=e.$type||"basic",e.$triggers=e.$triggers||["$load"],e},d=function(e,t,n,o){if(null==e&&t)switch(t){case"number":case"integer":case"boolean":e=void 0;break;case"string":e="";break;default:e=null}if(Array.isArray(e))return o?e:JSON.stringify(e);if(n&&t&&("string"===t||"date"===t||"date-time"===t)){if(null==e)return null;"date"===t||"date-time"===t||(e="'"+e.replace(/'/g,"''")+"'")}return e},p=function(e,t){var n=t.indexOf("[");if(n<0)return null;if(!(e=0===n?e:e[t.substr(0,n)]))return null;var o=t.substr(n+1,t.length-n-2);if("*"==o||""==o)return e;var i=parseInt(o,10);return i<e.length?e[i]:null},f=function(e,t,n,o){return m(e,t,n,!0)},m=function(e,t,n,o){var i,r=e,a=["$url","$context","$data","$item","$mem","$local"],s=typeof r;if("object"===s&&r){if(i=e.type,r=e.value,"literal"===i)return r;s=typeof r}var l=!1;if("string"===s&&r&&"["===r.charAt(0)&&"]"===r.charAt(r.length-1)&&(l=!0,r=r.substr(1,r.length-2)),"string"===s&&r&&"$"===r.charAt(0)){for(var u=r.split("."),c=0,f=null;c<u.length;){var m=u[c];if(0==c){var h,v=m,g=m.indexOf("[");g>0&&(h=m.substr(g),v=m.substr(0,g));var y=a.indexOf(v);if(!(y>=0))return i||(i=typeof r),d(r,i,n,o);f=t[a[y]],h&&u.splice(c+1,0,h)}else{if(!f)break;f="]"==m.charAt(m.length-1)?p(f,m):Array.isArray(f)?f.map(function(e){return e[m]}):f[m]}c++}return l?(i||(i=typeof f),[d(f,i,n,o)]):(i||(i=typeof f),d(f,i,n,o))}return i||(i=typeof r),d(r,i,n,o)},h=function(e,t,n){for(var o=n.length;o--;)if(e[n[o]]!=t[n[o]])return!1;return!0},v=function(e,t){if(!e)return null;if("string"==typeof e)return m(e,t,!1,!0);var n={};return Object.keys(e).forEach(function(o){"$data.documents"===e[o]?t.$data&&t.$data.documents&&(n[o]=t.$data.documents,void 0===n.pageSize&&(n.pageSize=t.$data.pageSize),void 0===n.skip&&(n.skip=t.$data.skip),void 0===n.count&&(n.count=t.$data.count),void 0===n.uri&&(n.uri=t.$data.uri)):n[o]=m(e[o],t,!1,!0)}),n},g=function(e,n,o,i){return v(e,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i})},y=function(e){return"and"!==e&&"or"!==e&&"$func"!==e&&("("!==e&&")"!==e&&"not"!==e)},_=function(e,n,o,i,r){if(e&&"object"==typeof e&&e.$op){u={$op:e.$op,$nulls:e.$nulls,$left:null,$right:null};if("$func"===e.$op&&e.$arguments){var a=!1;if(e.$arguments.forEach(function(r,s){var l=!0;"object"==typeof r&&(l="literal"!==r.type);var u=m(r,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},!0,!1);e.$arguments[s]=u,!l||"''"!==u&&null!==u&&void 0!==u||(a=!0)}),a)return u.$right=null,u.$left=null,u;e.$right=e.$arguments.join(", ")}else if("in"===e.$op&&e.$children){var s=r&&y(e.$op);if(Array.isArray(e.$children)||(e.$children=f(e.$children,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},s)),e.$children.length){var l=e.$children.map(function(e){return m(e,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},s,!1)});u.$right="("+l.join(",")+")",u.$left=e.$left,u.nativeIn=!0}return u}if(null!=e.$left&&("object"!=typeof e.$left||!e.$left.$op&&null!==e.$left.$op?u.$left=m(e.$left,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},!1,!1):u.$left=_(e.$left,n,o,i,r)),null!=e.$right)if("object"!=typeof e.$right||!e.$right.$op&&null!==e.$right.$op){c=r&&y(e.$op);u.$right=m(e.$right,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},c,!1)}else u.$right=_(e.$right,n,o,i,r);return u}if(e&&"object"==typeof e&&null===e.$op&&null===e.$right&&e.$left){var u={$left:null,$op:null,$right:null};return null!=e.$left&&("object"==typeof e.$left&&e.$left.$op?u.$left=_(e.$left,n,o,i,r):u.$left=m(e.$left,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},!1,!1)),u}var c=r&&y(e.$op);return m(e,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},c,!1)},b=function(e,n,o,i){return e&&"string"==typeof e?e=m(e,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:i},!1,!1):_(e,n,o,i,!0)},x=function(e){if(e&&"object"==typeof e&&e.$op){var t=x(e.$left),n=x(e.$right);if("ignore"===e.$nulls&&null==n.value)return"not"===e.op?{value:null,op:null}:{value:t.value,op:t.op};if("not"===e.$op)return{value:"not ("+n.value+")",op:e.$op};if("in"!==e.$op||e.nativeIn){if("$func"===e.$op)return{value:t.value+"("+n.value+")",op:e.$op};if("ignore"!==e.$nulls||null!=t.value&&null!=n.value){var o=t.value,i=n.value;if("and"===e.$op||"or"===e.$op){if(!o&&!i)return{value:null,op:null};if(!o)return{value:i,op:e.$op};if(!i)return{value:o,op:e.$op}}if("and"===e.$op)"or"===t.op&&(o="("+o+")"),"or"===n.op&&(i="("+i+")");else if(i&&"ignore"===e.$nulls&&"''"===i)return{value:null,op:null};return{value:o+" "+e.$op+" "+i,op:e.$op}}return"and"===e.$op||"or"===e.$op?null==n.value?{value:t.value,op:t.op}:{value:n.value,op:n.op}:{value:null,op:null}}var r=[];return(n.value||"").split(";").forEach(function(e){r.push(t.value+" eq "+e)}),{value:"("+r.join(" or ")+")",op:"in"}}return e&&"object"==typeof e&&null===e.$op&&null===e.$right&&e.$left?{value:x(e.$left).value,op:null}:{value:e,op:null}},C=function(e,t,n,o){var i=b(e,t,n,o);return x(i).value},k=function(e,n,i,r,a){var s={$url:null,$list:null,$query:null,$method:"GET"};s.$method=(e.$method||"GET").toUpperCase();var l,u;if(s.$data=e.$data?$.extend(!0,{},e.$data):null,a){if(!e.$entity)throw"Invalid sync dataset - $params.$entity";if(s.$transactionId=e.$transactionId||"id",!s.$transactionId)throw"Invalid sync dataset -$params.$transactionId";if(s.$viewId=e.$viewId||"viewId",!s.$viewId)throw"Invalid sync dataset -$params.$viewId";l=n[s.$transactionId],u=n[s.$viewId],s.$method=l&&u?"PATCH"===e.$method?"PATCH":"GET":"POST","POST"!==s.$method&&(s.$data=null)}s.$url=o.execAngularExpression(e.$url,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:r});var c=e.$query?$.extend(!0,{},e.$query):null;if(a){var d=s.$url.split("/");d.push(e.$entity),u&&l&&(d.push(u),(c=c||{}).id=l),s.$url=d.join("/")}return e.$download&&(s.$download=e.$download),e.$cookie&&(s.$cookie=e.$cookie),s.$list=e.$list,c&&(s.$query={},Object.keys(c).forEach(function(e){"$filter"===e&&c.$filter?(s.$query.$filter=C(c.$filter,n,i,r),s.$query.$filter||delete s.$query.$filter):s.$query[e]=m(c[e],{$url:n,$context:i,$data:null,$mem:t.$mem,$local:r},!1,!1)})),"GET"!==e.$method&&"DELETE"!==e.$method&&(s.$data?s.$data=m(s.$data,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:r},!1,!1):s.$data=i||{}),s},w=function(e){return void 0===e||null===e||""===e||"''"===e},E=function(e,n,i,r){if(!e)return null;var a={},s={$url:n,$context:i,$data:null,$mem:t.$mem,$local:r},l=e.$filter?$.extend(!0,{},e.$filter):null;if(e.$searchByFields&&e.$searchByFields.value&&e.$searchByFields.fields&&e.$searchByFields.fields.length){var u=null;e.$searchByFields.fields.forEach(function(t){var n={$left:"contains",$op:"$func",$right:t+", '"+e.$searchByFields.value.replace(/'/g,"''")+"'"};u=u?{$left:u,$op:"or",$right:n}:n}),e.$searchByFieldsValue=e.$searchByFields.value,e.$searchByFieldsFields=e.$searchByFields.fields,e.$allData||(l=l?{$left:l,$op:"and",$right:u}:u)}if(Object.keys(e).forEach(function(t){if("$search"!==t&&"$searchByFields"!==t)if("$entity"===t)a.$entity=m(e.$entity,s,!1,!1);else if("$entityId"===t){var n=!1;if("object"===typeof e.$entityId)if(e.$entityId.value&&e.$entityId.type){var o=m(e.$entityId,s,!0,!1);n=w(o),a[t]=o}else{var i=[];Object.keys(e.$entityId).forEach(function(t){var o=m(e.$entityId[t],s,!0,!1);n||(n=w(o)),i.push(t+"="+o)}),a[t]=i.join(", ")}else{var r=m(e[t],s,!0,!1);n=w(r),a[t]=r}n&&(a.$entityIdNull=!0)}else if("aggregate"==t&&e.aggregate)a.aggregate=e.aggregate;else if("groupby"==t&&e.groupby)a.groupby=e.groupby;else if("having"==t&&e.having)a.having=e.having;else{if("$filter"==t&&e.$filter)return;"$searchByFieldsFields"==t?a[t]=e[t]:e[t]&&(a[t]=m(e[t],s,!1,!1))}}),l&&(a.$filter=C(l,n,i,r),a.$filter||delete a.$filter),e.$search&&i&&i.$searchText){var c,p=d(i.$searchText,"string",!0,!1),f=Array.isArray(e.$search)?e.$search:[e.$search];if(1===f.length)c=o.format("contains({0},{1})",e.$search.field,p);else{for(var h=["("],v=f.length,g=0;g<v;g++)h.push(o.format("contains({0},{1})",f[g].field,p)),g<v-1&&h.push(" or ");h.push(")"),c=h.join("")}a.$filter?a.$filter=a.$filter+" and "+c:a.$filter=c}return a},P=function(e,n,i,a){var l,u=a&&a.getLocalContext?a.getLocalContext():null,c=e.$data;if(e.$params&&e.$params.dataProvider){var d=r.get(e.$params.dataProvider);d&&(i=d(i,a))}return!e.$main&&e.$output?(c=e.$data,l=v(e.$output,{$url:n,$context:i,$data:c,$mem:t.$mem,$local:u})):l=c,l=s(e,l),new o.Promise(function(e,t){e(l)})},O=function(e,t,n,o){var r=e.$params.name;return i.schema.get(r,e.$params.localization,void 0)},S=function(e,t,n,o){var r=e.$params.name;return i.menu.get(r,e.$params.localization,void 0)},I=function(e,n,r,u){var c=e.$method||"GET",d=u&&u.getLocalContext?u.getLocalContext():null,p=l(e.$beforeExecute,e.$params,r),f=E(p,n,r,d);if(c&&(c=(c=m(c,r,!1,!1)).toUpperCase()),f.$entityIdNull&&(delete f.$entityIdNull,"GET"===c&&e.$create)){var h=$.extend(!0,{},e.$create);return h.$create=!0,o.Promise.resolve(h)}if(c)switch(c){case"DELETE":return i.odata.doDelete(f,r.etag?r.etag:null);case"POST":return i.odata.doPost(f,r);case"PUT":var y=r["@odata.etag"];delete r["@odata.etag"];var _=null!=r["@odata.return"];return delete r["@odata.return"],i.odata.doPut(f,r,y,_);case"PATCH":var b=r["@odata.etag"];delete r["@odata.etag"];var x=null!=r["@odata.return"];return delete r["@odata.return"],i.odata.doPatch(f,r,b,x)}var C=g(e.$data,n,r,d),k=a.config(a.name)||{};return void 0===e.$cache&&(k.odata&&void 0!==k.odata.cache?k.odata.cache=k.odata.cache:(k.odata=k.odata||{},k.odata.cache=!0)),r&&(r.hasOwnProperty("$skip")&&r.$skip&&(f.$skip=r.$skip),r.hasOwnProperty("$top")&&r.$top&&(f.$top=r.$top)),i.odata.getRessources(f,function(o){o&&o.documents&&o.documents.length||!C||(o.documents=o.documents||[],o.documents.push(C)),r&&r.hasOwnProperty("$searchText")&&(o.searchText=r.$searchText);var i=o;return!e.$main&&e.$output&&(i=v(e.$output,{$url:n,$context:r,$data:o,$mem:t.$mem,$local:d})),i=s(e,i)},e.$errors)},D=function(e,n,o,r){var a=r&&r.getLocalContext?r.getLocalContext():null,l=k(e.$params,n,o,a,!1);return i.local.getRessources(l,function(i){var r=i;return!e.$main&&e.$output&&(r=v(e.$output,{$url:n,$context:o,$data:i,$mem:t.$mem,$local:a})),s(e,r)})},M=function(e,n,o,r){var a=r&&r.getLocalContext?r.getLocalContext():null,u=(l(e.$beforeExecute,e.$params,o),k(e.$params,n,o,a,!1));return e.$method&&(u.$method=e.$method),i.rest.getRessources(u,function(i){var r=i;return e.$output&&(r=v(e.$output,{$url:n,$context:o,$data:i,$mem:t.$mem,$local:a})),s(e,r)})},T=function(e,o,r,a){var u=a&&a.getLocalContext?a.getLocalContext():null,c=l(e.$beforeExecute,e.$params,r),d=k(c,o,r,u,!0),p=function(i){var a=i;if("GET"===d.$method&&(a.$transactionId=d.$query[d.$transactionId]),"POST"===d.$method){a=a.data;var l={};l[d.$transactionId]=i.id,l[d.$viewId]=a.id,a.$transactionId=i.id,n.changeSearch(l)}return e.$output&&(a=v(e.$output,{$url:o,$context:r,$data:i,$mem:t.$mem,$local:u})),s(e,a)};return"DELETE"!==d.$method&&"PUT"!==d.$method||(p=null),i.rest.getRessources(d,p)},L=function(e){var t=[];return e.$emit&&(e.$emit.$loaded||e.$emit.$changed?(e.$emit.$loaded&&t.push(e.$emit.$loaded.$name),e.$emit.$changed&&t.push(e.$emit.$changed.$name)):t.push(e.$emit)),t};e.execData=function(e,t,i){var r=n.search();if(!e)return null;if(e.$condition){var a=n.context();a.$context=t;var s=m(e.$condition,a,!1,!0);if(!s||"false"===s)return o.Promise.resolve(null)}switch(e.$type){case"basic":return P(e,r,t,i);case"odata":return I(e,r,t,i);case"sync":return T(e,r,t,i);case"rest":return M(e,r,t,i);case"local":return D(e,r,t,i);default:var l=u.get(e.$type);if(l)return l(e,r,t,i)}return null};var F=function(){function e(e){var t=this;t.config=c(e),e.$default&&(t.defaultDataset=!0),t.config.$autoselect&&(t.autoselect=!0),t._emitters=L(t.config),t.selectedIndex=-1}return e.prototype.execute=function(e,t){var o=this,i=n.search();switch(o.config.$type){case"basic":return P(o.config,i,e,t);case"odata":return I(o.config,i,e,t);case"rest":return M(o.config,i,e,t);case"local":return D(o.config,i,e,t);case"menu":return S(o.config);case"widget-schema":return O(o.config);default:var r=u.get(o.config.$type);if(r)return r(o.config,i,e,t)}throw"Invalid dataset type"},e.prototype.enumTriggers=function(e,t){var n=this;n.config.$triggers&&n.config.$triggers.forEach(function(n){(e||"$load"!=n)&&t(n)})},e.prototype.enumEmitters=function(e){this._emitters.forEach(e)},e.prototype.hasCustomEvents=function(){var e=this;if(e.config.$triggers){var t=e.config.$triggers;return t.length>1||"$load"!=t[0]}return!1},e.prototype.canExecute=function(e,t){var n=this;if(n.config.$condition){var o=m(n.config.$condition,t,!1,!0);if(!o||"false"===o)return!1}return n.config.$triggers.indexOf(e)>=0},e.prototype.data2Output=function(e,t){return v(e,t)},e.prototype.destroy=function(){o.log("Destroy Dataset","destroy")},e.prototype._findSelectedOData=function(e){var o=this;if(e.documents){var i=-1,r=null;if(o.config.$autoselect&&"object"==typeof o.config.$autoselect)for(var a={$url:n.search(),$mem:t.$mem},s=v(o.config.$autoselect,a),l=Object.keys(s),u=0,c=e.documents.length;u<c;u++){var d=e.documents[u];if(h(d,s,l)){r=d,i=u;break}}return r?{item:r,index:i}:e.documents.length?{item:e.documents[0],index:0}:{item:null,index:-1}}return{item:null,index:-1}},e.prototype._findSelected=function(e){var t=this;switch(t.config.$type){case"odata":case"rest":return t._findSelectedOData(e);default:return{item:e,index:0}}},e.prototype.doAutoSelect=function(e,t){var n=this;if(n.selectedIndex=-1,n.config.$autoselect){if(!e||e.nodata)return t(null);var o=n._findSelected(e);n.selectedIndex=o.index,t(o.item)}},e}();e.DataSet=F,e.replaceFilterVars=function(e,o){var i=n.context();return e&&"string"==typeof e?m(e,{$url:i.$url,$context:o,$data:null,$mem:t.$mem,$local:null},!1,!1):_(e,i.$url,o,null,!1)},e.registerDataProvider=u.register,e.compileFilterTree=function(e,t,n,o){return _(e,t,n,o,!1)},e.acceptFilter=function(e,t){return"eq"===e.$op&&t[e.$left]==e.$right},e.extractValue=function(e){e=e||"";var t=n.context();return m(e,t,!1,!1)},e.execOutputData=function(e,t){if(e.$output){var o=n.context();o.$data=t[e.name],o.$context=t,t[e.name]=v(e.$output,o)}},e.test={output:v,parseTree:C}}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.dom,i=n.utils,r=(n.locale,function(e,t,n,o,i){return{number:e,text:t,icon:n,active:o,disabled:i}}),a=function(e,t,n){var o=[],i=1,a=t,s=n.maxSize&&n.maxSize<t;s&&(n.rotate?(a=(i=Math.max(e-Math.floor(n.maxSize/2),1))+n.maxSize-1)>t&&(i=(a=t)-n.maxSize+1):(i=(Math.ceil(e/n.maxSize)-1)*n.maxSize+1,a=Math.min(i+n.maxSize-1,t)));for(var l=i;l<=a;l++){var u=r(l,l,null,l===e,!1);o.push(u)}if(s&&!n.rotate){if(i>1){var c=r(i-1,"...",null,!1,!1);o.unshift(c)}if(a<t){var d=r(a+1,"...",null,!1,!1);o.push(d)}}var p;return n.directionLinks&&(p=r("prev",null,"chevron-left",!1,1==e),o.unshift(p)),n.boundaryLinks&&(p=r("first",null,"backward",!1,1==e),o.unshift(p)),n.directionLinks&&(p=r("next",null,"chevron-right",!1,e==t),o.push(p)),n.boundaryLinks&&(p=r("last",null,"forward",!1,e==t),o.push(p)),o},s=function(){function t(e){var t=this,n={boundaryLinks:!1,directionLinks:!0,rotate:!0,maxSize:4,size:"lg"};t._options=$.extend(n,e||{}),t.pages=[],t._updating=!1,t.visible=!1,t.props={},t.data={currentPage:-1,totalPages:0},t._defineProps()}return t.prototype._defineProps=function(){var e=this,t=i.defineProperty;t("currentPage",e),t("totalPages",e)},t.prototype._notifyChange=function(e){var t=this;switch(e){case"currentPage":t._changed=!0,t._updatePages();break;case"totalPages":t._changed=!0,t.data.currentPage>=0&&t._updatePages()}},t.prototype._renderPager=function(){var t=this,n=t.$element.get(0);if(e.bootstrap4&&(n=n.lastChild),t.visible){var i=document.createDocumentFragment(),r=$(e.bootstrap4?'<li class="page-item"><a class="page-link bs-button" href></a><li>':"<li><a href></a><li>").get(0),a=document.createElement("span");t.pages.forEach(function(e){var t=r.cloneNode(!0);if(e.icon){var n=a.cloneNode(!0);o.attr(n,"class",o.iconClass(e.icon)),o.attr(n,"page",e.number),o.append(t.firstChild,n)}e.text&&o.text(t.firstChild,e.text),o.attr(t,"page",e.number),o.attr(t.firstChild,"page",e.number),e.disabled&&o.addClass(t,"disabled"),e.active&&o.addClass(t,"active"),i.appendChild(t)}),$(n).empty(),n.appendChild(i),o.removeClass(n,"bs-none")}else o.addClass(n,"bs-none")},t.prototype._updatePages=function(){var e=this;if(!e._updating){e.pages=a(e.data.currentPage,e.data.totalPages,e._options),e.visible=e.data.currentPage>0&&e.data.totalPages>1;var t=5;e._options.boundaryLinks||(t-=2),e._options.directionLinks||(t-=2),e.visible=e.pages.length>t,e.$element&&e._renderPager()}},t.prototype._setEvents=function(){var e=this;e.$element&&e.$element.on("click",function(t){var n=t.target,i=o.attr(n,"page");if(i){if(t.preventDefault(),t.stopPropagation(),o.hasClass(n,"disabled")||o.hasClass(n.parentNode,"disabled"))return;if(e._options.selectPage){var r=parseInt(i,10);e._options.selectPage(isNaN(r)?i:r)}}})},t.prototype._removeEvents=function(){var e=this;e.$element&&e.$element.off("click")},t.prototype.updating=function(e){var t=this;t._updating=e,e?t._changed=!1:t._changed&&(t._changed=!1,t._updatePages())},t.prototype.render=function(t){var n=this;n.$element||(n.$element=$((e.bootstrap4?'<nav><div class="bs-island"></div>':"")+'<ul class="no-y-margin d-inline-flex pagination'+("default"!=n._options.size?" pagination-"+n._options.size:"")+'"></ul>'+(e.bootstrap4?"</nav>":"")),n._renderPager(),n._setEvents()),t&&(n._options.replaceParent?t.replaceWith(n.$element):t.append(n.$element))},t.prototype.destroy=function(){var e=this;e._removeEvents(),e.$element=null,e._options=null},t}();t.Pager=s}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.history,i=n.utils,r=n.external,a=n.dom,s=n.link,l=n.locale,u=n.application,c=['<div role="alert" class="bs-error alert alert-danger alert-dismissible fade show">','<button aria-label="{0}" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>',"<h4 >{1}</h4>","<p>{2}</p>","<p>",'<a class="bs-button btn btn-'+a.bootstrapStyles(!1).secondary+'" href="{4}" role="button">{3}</a>',"</p>","</div>"],d=['<div class="bs-loader"></div>'],p=null,f=function(e){var t={emit:!1,listen:!0,triggers:[],emitters:[]};return Object.keys(e).forEach(function(n){if("view"!=n){var o=e[n];o.config.$emit&&o.enumEmitters(function(e){t.emit=!0,t.emitters.push(e)}),o.enumTriggers(!1,function(e){t.listen=!0,t.triggers.indexOf(e)<0&&t.triggers.push(e)})}}),t},m=function(){function e(){var e=this;e.children=[],e.data={$title:"",$menuleft:!1,$menutop:!1,$menuright:!1,$menubottom:!1,$hasBack:o.hasBack(),$user:{}},e.errors=[],e.props={},e.popup=null,e.contextMenu=null,e._defineProps(),e._setEvents(),r.historyChangedHandler=e._historyChanged.bind(e)}return e.prototype._defineProps=function(){var e=this,t=i.defineProperty;t("$title",e),t("$menuleft",e),t("$menutop",e),t("$menuright",e),t("$menubottom",e),t("$hasBack",e),t("$user",e)},e.prototype.currentPage=function(){var e=s.parseUrl(window.location.hash).path;return e&&"/"===e.charAt(0)&&(e=e.substr(1)),e},e.prototype.emittersFor=function(e){var t=this,n=[],o=e.length;return t.dataListeners&&t.dataListeners.forEach(function(t){if(!t.listener.disabled&&t.emit){for(var i=!1,r=0;r<o;r++)t.emitters.indexOf(e[r])>=0&&(i=!0);i&&n.push(t.listener)}}),n},e.prototype._historyChanged=function(){this.props.$hasBack=o.hasBack()},e.prototype._notifyChange=function(e){var t=this;t._notifyChildren(e,t.data[e])},e.prototype._notifyChildOnAdd=function(e,t){var n=this;if(e){if("layout"===t){var o=n.childByType("header");if(o&&o.setPage){var i=e.data.name||"";o.setPage(i,e)}}e.onPageChange&&Object.keys(n.props).forEach(function(t){e.onPageChange(t,n.props[t])})}},e.prototype._notifyChildren=function(e,t){this.children.forEach(function(n){var o=n.child;o&&o.onPageChange&&o.onPageChange(e,t)})},e.prototype.registerDataListener=function(e,t){var n=this;if(n.dataListeners=n.dataListeners||[],e.datasets){var o=f(e.datasets);(o.emit||o.listen)&&n.dataListeners.push({listener:e,parent:t,triggers:o.triggers,listen:o.listen,emitters:o.emitters,emit:o.emit})}},e.prototype.removeDataListener=function(e){var t=this;if(t.dataListeners)for(var n=t.dataListeners.length;n--;)t.dataListeners[n].listener==e&&t.dataListeners.splice(n,1)},e.prototype.removeParentDataListener=function(e){var t=this;if(t.dataListeners)for(var n=t.dataListeners.length;n--;)t.dataListeners[n].parent==e&&t.dataListeners.splice(n,1)},e.prototype.emitDataEvent=function(e,t,n){var o=this;o.dataListeners&&o.dataListeners.forEach(function(o){n&&n.indexOf(o.listen)<0||o.listen&&o.triggers.indexOf(e)>=0&&o.listener&&o.listener.dataEvent&&(o.listener.ds_storeLastEvent&&o.listener.ds_storeLastEvent(e,t),o.listener.disabled||o.listener.dataEvent(e,t))})},e.prototype.childByType=function(e){for(var t=this,n=0,o=t.children.length;n<o;n++){var i=t.children[n];if(i.type===e)return i.child}return null},e.prototype.addChild=function(e,t){var n=this;n.children.push({child:t,type:e}),n._notifyChildOnAdd(t,e)},e.prototype.removeChild=function(e){for(var t=this,n=t.children.length;n--;)if(t.children[n].child==e){t.children.splice(n,1);break}},e.prototype.destroy=function(){var e=this;if(r.historyChangedHandler=null,e._hideErrors(!0),e._hideLoading(),e.children){for(var t=e.children.length;t--;){var n=e.children[t];e.removeDataListener(n.child)}e.children=null}e.dataListeners=null,e._removeEvents()},e.prototype._setEvents=function(){var e=this;$(document).on("mousedown touchstart",function(t){a.inCover(t.target)||(e._inContextMenu(t)||e._closePopup(t),e._closeContextMenu(t))}),window.onerror=function(t,n,o,i,r){!r&&n&&(r={filename:n,lineno:o||0,colno:i||0}),e.$error||(e.lastError={message:t,stack:r?r.stack:null,stackError:r&&r.stack?null:r},e._showErrors())}},e.prototype._hideErrors=function(e){var t=this;t.$error&&(t.$error.off("closed.bs.alert"),e&&t.$error.remove(),t.$error=null)},e.prototype._showErrors=function(){var e=this,t=a.find(null,"error_box");if(t&&!e.$error){var n=["mailto:"];n.push(u.support),n.push("?subject="+encodeURIComponent(u.title)),n.push("&body=");var o=s.context(),r=new Date;n.push(encodeURIComponent(l.errors.ErrorTitle+" ")),n.push(encodeURIComponent(e.lastError.message)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorUser+" ")),n.push(encodeURIComponent(o.$user.name)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorDate+" ")),n.push(encodeURIComponent(r.toLocaleString())),n.push(encodeURIComponent("\n\n"+l.errors.Browser+" ")),n.push(encodeURIComponent(navigator.userAgent)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorURI+" ")),n.push(encodeURIComponent(window.location.href)),(e.lastError.stack||e.lastError.stackError)&&(n.push(encodeURIComponent("\n\n"+l.errors.Stack+"\n")),e.lastError.stack?n.push(encodeURIComponent(e.lastError.stack)):n.push(encodeURIComponent(JSON.stringify(e.lastError.stackError)))),n.push(encodeURIComponent("\n\n"+l.errors.Context+" ")),n.push(encodeURIComponent(JSON.stringify(o))),e.$error=$(i.format(c.join(""),l.ui.Close,l.errors.Title,e.lastError.message,l.errors.SendMail,n.join(""))),e.$error.on("closed.bs.alert",function(){e._hideErrors(!1)}),t.appendChild(e.$error.get(0))}},e.prototype._hideLoading=function(){var e=this;e.$loading&&(e.$loading.remove(),e.$loading=null)},e.prototype._showLoading=function(){var e=this,t=document.body;t&&(e.$loading||(e.$loading=$(d.join("")),t.appendChild(e.$loading.get(0))))},e.prototype.loading=function(e){var t=this;e?t._showLoading():t._hideLoading()},e.prototype._removeEvents=function(){$(document).off("mousedown touchstart")},e.prototype._closePopup=function(e){var t=this;!t.popup||t.popup.stayOnTop&&null!==e||(!e||t.popup.inPopup&&!t.popup.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(t.popup.hide&&t.popup.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),t.popup=null)},e.prototype._inContextMenu=function(e){var t=this;return!!(t.contextMenu&&e&&t.contextMenu.inPopup&&t.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))},e.prototype._closeContextMenu=function(e){var t=this;t.contextMenu&&(!e||t.contextMenu.inPopup&&!t.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(t.contextMenu.hide&&t.contextMenu.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),t.contextMenu=null)},e.prototype.setPopup=function(e){var t=this;t._closePopup(null),t.popup=e},e.prototype.setContextMenu=function(e){var t=this;t._closeContextMenu(null),t.contextMenu=e},e.prototype.activePage=function(){var e=this;return{$module:u.name,$page:e.currentPage()}},e}();t.PageControl=m,t.Page=function(){return p||(p=new m),p}}(e.pagecontrol||(e.pagecontrol={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.utils,o=(t.ulocale,t.locale,t.ui,t.link),i=t.pagecontrol,r=t.dom;!function(e){var a=function(e,o){var i=t.bootstrap4;i?e.push('<div class="dropdown-menu bs-block bs-conntext-menu">'):e.push('<ul class="dropdown-menu bs-block bs-conntext-menu">'),o.forEach(function(t){t.id=t.id||n.allocID(),i?t.separator?e.push('<div class="dropdown-divider bs-cursor-d"></div>'):(e.push('<a class="dropdown-item'+(t.disabled?" disabled":" bs-cursor-p")+'" data-phoenix-href="click://'+t.id+'">'),e.push(n.escapeHtml(t.title)),e.push("</a>")):t.separator?e.push('<li role="separator" class="divider bs-cursor-d"></li>'):(e.push("<li"+(t.disabled?' class="disabled"':' class="bs-cursor-p"')+'><a data-phoenix-href="click://'+t.id+'">'),e.push(n.escapeHtml(t.title)),e.push("</a></li>"))}),i?e.push("</div>"):e.push("</ul>")},s=function(){function e(e,t){var n=this;n._data=e,n._parent=t}return e.prototype.destroy=function(){var e=this;if(e.$element){e.$element.off("click");var t=e.$element.get(0);r.remove(t),e.$element=null}e._parent=null,e._data=null},e.prototype.open=function(e){var t=this,n=[];a(n,t._data),t.$element=$(n.join("")),t.$element.on("click",function(e){var n=o.isCustomLink(t.$element.get(0),e,!0);if(n&&"click"===n.protocol){var r=n.value.substring("click://".length),a=t._data.find(function(e){return e.id===r});a&&t._parent&&t._parent.contextMenu&&t._parent.contextMenu(a)}i.Page().setContextMenu(null)});var s=t.$element.get(0);s.style.left=e.pageX+"px",s.style.top=e.pageY+"px",r.append(document.body,t.$element.get(0))},e.prototype.hide=function(e){this.destroy()},e.prototype.inPopup=function(e){var t=this;return t.$element&&r.isChildOf(t.$element.get(0),e)},e}();e.openContextMenu=function(e,t,n){var o=new s(n,t);o.open(e),i.Page().setContextMenu(o)}}(e.contextmenu||(e.contextmenu={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.utils,o=t.ulocale,i=t.locale,r=(t.ui,t.dom);!function(t){var a=function(e){if("close"===e.pattern){var t={close:!0,type:"default",name:"close",title:i.ui.Close};return $.extend({},t,e)}if("validate"===e.pattern){var n={close:!1,type:"success",name:"validate",title:i.ui.Validate};return $.extend({},n,e)}if("create"===e.pattern){var o={close:!1,type:"success",name:"create",title:i.ui.Create};return $.extend({},o,e)}return e},s=function(e,t,n){e=a(e),t.push('<button data-action="'+e.name+'" type="button"'),t.push(' class="bs-btn-inline float-right bs-button btn btn-'+e.type||"default"),t.push('"'),e.close&&t.push(' data-dismiss="modal"'),t.push(">"),e.icon&&(t.push('<span class="'+r.iconClass(e.icon)+'"></span>'),e.title&&t.push("&nbsp;")),t.push(o.tt(e.title||"",n)),t.push("</button>")},l=function(t,i){var r=e.bootstrap4,a=['<div class="modal fade" data-backdrop="static"  id="{0}" role="dialog" aria-labelledby="{0}_label">','\t<div class="modal-dialog'+(t.size?" modal-"+t.size:"")+'" role="document">','\t\t<div class="modal-content">','\t\t<div class="modal-header">',r?'\t\t\t<h5 class="modal-title" id="{0}_label">{1}</h5>':"",'\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',r?"":'\t\t\t<h4 class="modal-title" id="{0}_label">{1}</h4>',"\t\t</div>",'\t\t<div class="modal-body" id="{0}_body">',"\t\t</div>",'\t\t<div class="modal-footer"  id="{0}_footer">'];return t.buttons&&t.buttons.forEach(function(e){s(e,a,i)}),a.push("\t\t</div>"),a.push("\t\t</div>"),a.push("\t</div>"),a.push("</div>"),n.format(a.join(""),t.id,o.tt(t.title,i))},u=function(){function e(e,t){this.options=e||{},this.$id=n.allocID(),this.$locale=t}return e.prototype._removeEvents=function(){var e=this;e.$element.off("click"),e.$element.off("hidden.bs.modal")},e.prototype._execAction=function(e){var t=this;t._clickHnd&&t._clickHnd(e)},e.prototype._addEvents=function(){var e=this;e.$element.on("hide.bs.modal",function(t){e._inProcessing&&(t.preventDefault(),t.stopPropagation())}),e.$element.on("hidden.bs.modal",function(t){e._clear()}),e.$element.on("click",function(t){if(e.$element)for(var o=t.target,i=e.$element.get(0);o;){var r=o.getAttribute("data-action");if(r)return n.focusDelay(function(){return e._execAction(r)});o=o==i?null:o.parentNode}})},e.prototype._clear=function(){var e=this;e.$element&&(e._removeEvents(),e.render&&e.render.destroy(),e.$element.remove(),e.$element=null),e.render=null},e.prototype.processing=function(e){var t=this;t._inProcessing=e,r.processing(e),t.render&&t.render.processing&&t.render.processing(e)},e.prototype.on=function(e){this._clickHnd=e},e.prototype.close=function(){var e=this;e.$element&&e.$element.modal("hide")},e.prototype.open=function(){var e=this,t={id:e.$id,title:e.options.title||"",buttons:e.options.buttons||[],size:0};e.options.size&&(t.size=e.options.size),e.$element||(e.$element=$(l(t,e.$locale)),e.render&&e.render.render($(r.find(e.$element.get(0),e.$id+"_body"))),r.append(document.body,e.$element.get(0)),e.$element.modal&&(e.$element.modal({}),e._addEvents()))},e.prototype.destroy=function(){this._clear()},e}();t.Modal=u}(e.modal||(e.modal={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.data,i=n.link,r=n.$mem,a=n.utils,s=function(e,t,n,o){if(t.config.$emit[o].$updateMem){var i=t.data2Output(t.config.$emit[o].$updateMem,{$item:n});r=$.extend(r,i)}if(t.config.$emit[o].$updateLocal){var a=e.getLocalContextHandler?e.getLocalContextHandler():null;if(a){var s=t.data2Output(t.config.$emit[o].$updateLocal,{$item:n});a=$.extend(a,s)}}},l=function(e,t,n,r,s,l,u,c){var d=function(e){return c?n?n[e]:null:n},p=e,f=[],m=[],h=r||{},v="$load"==t,g=-1,y=function(e,t,n){if(p&&p.datasets){var o=p.datasets[e];o&&(f.push(o.execute(n,p)),m.push(e),o.defaultDataset&&(g=t.length-1))}};l?l&&Array.isArray(l)?l.forEach(function(e){"object"==typeof e?e.name&&(f.push(o.execData(e,d(e.name),p)),m.push(e.name)):y(e,m,d(e))}):y(l,m,d(l)):p&&p.datasets&&Object.keys(p.datasets).forEach(function(e){var n=p.datasets[e],o=(i.search(),p.ds_context());n&&n.canExecute(t,o)&&y(e,m,d(e))}),f.length?(p&&p.loadingHandler&&p.loadingHandler(!0),a.Promise.all(f).then(function(e){var t=[];m.forEach(function(n,o){var i=e[o];if(o==g&&p&&p.noDataHandler&&p.noDataHandler(!i||i.nodata,null,!0),h[n]=i,p){var r=p.datasets&&p.datasets[n];if(v&&r&&r.$menu&&p.updateMenuHandler){var a=n.split("_");t.push({name:a[a.length-1],data:i})}if(r&&(p.ds_loaded(n,i),r.autoselect))return r.doAutoSelect(i,function(e){p.ds_select(n,e)})}}),p&&p.loadingHandler&&p.loadingHandler(!1),t.forEach(function(e){p.updateMenuHandler(e.name,e.data)}),s(!0),p&&p.watchersHandler&&p.watchersHandler(m),!v&&u&&p&&p.dataChangedHandler&&p.dataChangedHandler(m)}).catch(function(e){e&&console.log(e),p&&p.loadingHandler&&p.loadingHandler(!1),p&&p.errorHandler&&p.errorHandler(e),s(!1,e),!v&&u&&p&&p.dataChangedHandler&&p.dataChangedHandler(m)})):s(!0)},u=function(){function e(){}return e.prototype.ds_init=function(e){var t=this,n=!1;if(t.props=t.props||{},t.props.data=t.props.data||{},t.props.data.ds={},e.datasets||e.$resources||e.$schema||e.$menus){t.datasets&&t.ds_destroy();var i=e.$resources||e.$schema;i&&(t.props.data.ds.view=null,t.datasets=t.datasets||{},t.datasets.view=new o.DataSet({$type:"widget-schema",$params:{name:i,localization:e.$localization}}),t.datasets.view.$schema=!0),e.$menus&&Object.keys(e.$menus).forEach(function(n){var i="$menu_"+n;t.props.data.ds[i]=null,t.datasets=t.datasets||{},t.datasets[i]=new o.DataSet({$type:"menu",$params:{name:e.$menus[n]+"-"+n}}),t.datasets[i].$menu=!0}),e.datasets&&Object.keys(e.datasets).forEach(function(i){t.props.data.ds[i]=null,t.datasets=t.datasets||{};var r=new o.DataSet(e.datasets[i]);t.datasets[i]=r,n||(n=r.hasCustomEvents()||r.config.$emit)})}return n},e.prototype.ds_storeLastEvent=function(e,t){this._lastEvent={event:e,value:t}},e.prototype.ds_LastEvent=function(){var e=this;if(e._lastEvent){var t=e._lastEvent;return e._lastEvent=null,t}return null},e.prototype.ds_destroy=function(){a.log("Destroy Dataset Part","destroy");var e=this;e._lastEvent=null,e.datasets&&(Object.keys(e.datasets).forEach(function(t){e.datasets[t].destroy()}),e.datasets=null)},e.prototype.ds_context=function(){var e=this,t={$url:i.search(),$mem:r,$local:e.getLocalContextHandler?e.getLocalContextHandler():null},n=e.props.data.ds;return n&&Object.keys(n).forEach(function(e){t[e]=n[e]}),t},e.prototype.ds_reemit=function(e,t){var n=this;return n.datasets&&Object.keys(n.datasets).forEach(function(e){var t=n.props.data.ds[e],o=n.datasets[e];o.defaultDataset&&n.noDataHandler&&n.noDataHandler(!t||t.nodata,null,!0),n.ds_loaded(e,t),o.autoselect&&o.doAutoSelect(t,function(t){n.ds_select(e,t)})}),t()},e.prototype.ds_select=function(e,t){var n=this;if(n.datasets&&n.datasets[e]){var o=n.datasets[e];o.config.$emit&&n.emitHandler&&(o.config.$emit.$changed&&s(n,o,t,"$changed"),n.emitHandler(o.config.$emit.$changed?o.config.$emit.$changed.$name:o.config.$emit,t))}},e.prototype.ds_loaded=function(e,t){var n=this;if(n.datasets&&n.datasets[e]){var o=n.datasets[e];o.config.$emit&&o.config.$emit.$loaded&&(s(n,o,t,"$loaded"),n.emitHandler(o.config.$emit.$loaded.$name,t))}},e.prototype.ds_exec=function(e,t,n,o,i,r){l(this,e,t,n,o,i,r)},e}();t.DatasetMethods=u,t.executeDatasets=function(e,t,n,o,i,r){var a={loadingHandler:o&&o.loading?o.loading:null,errorHandler:o&&o.error?o.error:null};l(a,"",t,n,i,e,!1,r)}}(e.DatasetPlugin||(e.DatasetPlugin={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.dom,i=n.utils,r=n.locale,a=n.ulocale,s=function(e,t,n){var i=["bs-island bs-widget"];return o.parseStyle(e.$style,i),e.$border&&i.push("border"),t.design&&i.push("design"),n&&i.push("selected"),i.join(" ")},l=function(e){return e?"height:"+((e+"").indexOf("%")>0?e:parseInt(e,10)+"px")+";":""},u=function(e,t,n,o){e.push('<div class="'),e.push(s(t.$config,n,t.$selected)),e.push('"'),n.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push(">"),c(e,t.$id,t.$config,o,!1),e.push('<div class="bs-widget-content bs-widget-content-id"');var i=l(t.$config.$height);i&&e.push(' style="'+i+'"'),e.push(">")},c=function(e,t,n,r,s){e.push('<div class="bs-widget-title'+(s?" bs-widget-content-inv-x":"")+(n.$titleIsHidden&&!s?" bs-none":"")+'" id="'+t+'_title">');var l=a.localeTitle(n.$title)||"";r&&(l=a.tt(n.$title||"",r)),e.push(i.escapeHtml(l+" ")),n.icons&&n.icons.length&&n.links&&n.icons.forEach(function(t){var i=n.links[t.link];i&&i.$icon&&(e.push('<a class="bs-widget-title-icon" data-phoenix-href="link://'+t.link+'">'),e.push('<span class="'+o.iconClass(i.$icon)+'"></span>'),e.push("</a>"))}),e.push("</div>")},d=function(e,t){e.push("</div></div>")},p=function(e,t,n,o,i,r){u(e,t,i,r),d(e)};t.toHtml=function(e,t,n,o,i){var r=[];return p(r,e,0,0,t,i),r.join("")},t.cssClass=s,t.heightText=l,t.loader=function(){return $('<div class="bs-loader"></div>')},t.error=function(){return $('<div class="alert alert-danger" role="alert"><span class="'+o.iconClass("exclamation-circle")+'" aria-hidden="true"></span><span></span></div>')},t.widgetTitle=c,t.settings=function(){return $('<span class="bs-module-settings '+o.iconClass("cog")+'" ></span>')},t.warning=function(){return $('<div class="alert alert-warning" role="alert"></div>')},t.noData=function(e,t){var n=[],i=!1!==t;return t=t&&!0!==t||"cloud",n.push('<div class="bs-widget-content nodata">'),n.push('<div class="bs-no-data-inside">'),i&&n.push('<center class="nodata-image"><i class="'+o.iconClass(t)+' nodata-icon"></i></center>'),n.push('<center><h4 class="nodata-text">'),n.push(e||r.layouts.NoData),n.push("</h4></center>"),n.push("</div>"),n.push("</div>"),$(n.join(""))}}(e.WidgetUtils||(e.WidgetUtils={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.dom,i=n.utils,r=(n.locale,n.WidgetUtils),a=n.DatasetPlugin,s=n.link,l=n.render,u=function(){function e(e,t,n){var o=this;o.item=e||{},o.item.$id||(o.item.$id=i.allocID()),e.$config=e.$config||{},e.$config.data=e.$config.data||{},o.data=e.$config,o.props={},o.item.$render=o.props,o.props.data=e.$config.data,o.options=t||{},o.contentRender=null,o.links=e.$config.links,o._defineProps(),o.layout=n,o.$local={},o.loadingHandler=o.loading.bind(o),o.noDataHandler=o.noData.bind(o),o.errorHandler=o.error.bind(o),o.emitHandler=o.emit.bind(o),o.getLocalContextHandler=o.getLocalContext.bind(o),o.dataChangedHandler=o.dataChanged.bind(o),o.updateMenuHandler=null,o._watchers={},o.props.data.localContext&&$.extend(o.$local,o.props.data.localContext),o.ds_init(o.data)&&o._listen()}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,n,o,i,r){},e.prototype._defineProps=function(){var e=this,t=i.defineProperty;t("$title",e),t("$border",e),t("$height",e),t("$titleIsHidden",e),t("$settings",e)},e.prototype._notifyChange=function(e){var t=this;switch(e){case"$title":t._updateTitle();break;case"$border":case"$titleIsHidden":t._updateCssClass();break;case"$height":t._updateHeight()}},e.prototype._listen=function(){var e=this;e.layout&&e.layout.registerDataListener(e)},e.prototype._unlisten=function(){var e=this;e.layout&&e.layout.removeDataListener(e)},e.prototype.on=function(e,t){var n=this;n.handlers=n.handlers||{},n.handlers[e]=t},e.prototype._exec=function(e){var t=this;t.handlers&&t.handlers[e]&&t.handlers[e]()},e.prototype._setEvents=function(){var e=this,t=e.$element.get(0);e.$element.on("click",function(n){e.$settings&&n.target===e.$settings.get(0)&&e._exec("settings");var o=s.isCustomLink(t,n);o&&s.execCustomProtocol(o,e.ds_context(),{links:e.links},null)})},e.prototype.executeLink=function(e,t){var n=this,o=s.isCustomProtocol(e);o&&s.execCustomProtocol({protocol:o,value:e},n.ds_context(),{links:n.links},t)},e.prototype._removeEvents=function(){this.$element.off("click")},e.prototype.dataChanged=function(e){var t=this;t.onDSChanged&&t.onDSChanged(e),t.contentRender&&t.contentRender.dataChanged?t.contentRender.dataChanged():t.options.onDataChanged&&t.options.onDataChanged()},e.prototype.execDataSet=function(e,t,n,o,i){var r=this;o=o||r.props.data.ds,r.ds_exec(null,t,o,n||function(){},e,i)},e.prototype._loadData=function(e){var t=this;if(!t.datasets)return e(!1);t.ds_exec("$load",null,t.props.data.ds,e,null,!0)},e.prototype._updateTitle=function(){var e=this;if(e.$element){var t=o.find(e.$element.get(0),e.item.$id+"_title");t&&o.text(t,this.data.$title||"")}},e.prototype._cleanErrors=function(e){var t=this;t.$loader&&(t.$loader.remove(),t.$loader=null),e||(t.$settings&&o.addClass(t.$settings.get(0),"bs-none"),t.$noData&&(t.$noData.remove(),t.$noData=null),t.$error&&(t.$error.remove(),t.$error=null),t.$warning&&(t.$warning.remove(),t.$warning=null))},e.prototype.loading=function(e){var t=this;t._cleanErrors(!e);var n=t.$element?t.$element.get(0):null;n&&(e?(o.addClass(n,"loading"),t.$loader||(t.$loader=r.loader(),t.$element.append(t.$loader))):o.removeClass(n,"loading")),e||t.settings()},e.prototype._linksState=function(e){var t=this;if(t.$element){var n=t.$element.get(0),i=o.find(n,t.item.$id+"_title");if(i){var r=o.queryAll(i,".bs-widget-title-icon");[].forEach.call(r,function(t){e?o.removeClass(t,"bs-none"):o.addClass(t,"bs-none")})}}},e.prototype.noData=function(e,t,n){var i=this;if(!t&&i.props.data.$noDataMessage&&(t=i.props.data.$noDataMessage),this._cleanErrors(!1),i.$element){var a=i.$element.get(0),s=o.query(a,".bs-widget-content-id");if(s&&(e?o.addClass(s,"bs-none"):o.removeClass(s,"bs-none"),i._linksState(!e)),e){if(i.$noData=r.noData(t,n),i._updateHeight(i.$noData)){var l=o.query(i.$noData.get(0),".bs-no-data-inside");o.addClass(l,"centred")}var u=o.find(a,i.item.$id+"_title");u&&o.after(u,i.$noData.get(0))}}},e.prototype.getLocalContext=function(){return this.$local},e.prototype.settings=function(){var e=this,t=e.data.$settings&&!e.$error&&!e.$warning&&!e.$noData;if(e.$settings)t?o.removeClass(e.$settings.get(0),"bs-none"):o.addClass(e.$settings.get(0),"bs-none");else if(t){e.$settings=r.settings();var n=o.find(e.$element.get(0),e.item.$id+"_title");n&&o.after(n,e.$settings.get(0))}},e.prototype.error=function(e){var t=e;e&&e.message&&(t=e.message);var n=this;this._cleanErrors(!1);var i=n.$element?n.$element.get(0):null;if(i){n.$error=r.error();var a=n.$error.get(0);o.text(a.lastChild," "+t);var s=o.find(i,n.item.$id+"_title");s&&o.after(s,a)}},e.prototype.warning=function(e){var t=this;this._cleanErrors(!1);var n=t.$element?t.$element.get(0):null;if(n){t.$warning=r.warning();var i=t.$warning.get(0);o.text(i,e);var a=o.find(n,t.item.$id+"_title");a&&o.after(a,i)}},e.prototype._updateHeight=function(e){var t=this,n=(e=e||t.$element)?e.get(0):null;return n&&(n.style.cssText=r.heightText(t.props.$height)),!!t.props.$height},e.prototype._updateCssClass=function(){var e=this,t=e.$element?e.$element.get(0):null;t&&(t.className=r.cssClass(e.data,e.options))},e.prototype._internalRenderContent=function(e,t,n){var o=this,i=l.get(o.options.context,"widget.content.control."+o.data.$type);if(o.$element){if(i)o.contentRender=new i(o.props,{context:o.options.context,replaceParent:!1},this);else{var r=l.get(o.options.context,"widget.content");if(r){var a=[];r(a,o.data,o.options),e.append($(a.join("")))}}o.options.beforeAdd&&o.options.beforeAdd(e,n),o.contentRender&&o.contentRender.render(e),t&&o.$element.append(e)}},e.prototype.watchersHandler=function(e){var t=this;e&&e.forEach(function(e){var n=t._watchers[e];n&&n.forEach(function(n){n(t.props.data.ds[t.props.data.ds[e]])})})},e.prototype.render=function(e){var t=this;if(t.$loader=null,t.$error=null,!t.$element){t.layout.controls[t.item.$id]=this,t.$element=$(r.toHtml(t.item,t.options,null,null,null)),t._setEvents();var n=t.$element.get(0),i=o.query(n,".bs-widget-content-id");t._loadData(function(e){t._internalRenderContent($(i),!1,e),t.settings()}),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))}},e.prototype.emit=function(e,t,n){var o=this;o.layout&&o.layout.emitDataEvent(e,t,n)},e.prototype.dataEvent=function(e,t){var n=this;n.ds_exec(e,t,n.props.data.ds,function(){},null,!0)},e.prototype.destroy=function(){i.log("Destroy Module","destroy");var e=this;e.contentRender&&(e.contentRender.destroy(),e.contentRender=null),e._unlisten(),e.ds_destroy(),e._cleanErrors(!1),e.item.$render=null,e.$settings&&(e.$settings=null),e.$element&&(e._removeEvents(),e.$element=null),e.layout=null,e.ondatasets=null},e.prototype.watch=function(e,t){var n=this;n._watchers&&((n._watchers[e]=n._watchers[e]||[]).push(t),n.props&&n.props.data.ds&&i.nextTick(function(){t(n.props.data.ds[e])}))},e.prototype.unwatch=function(e,t){var n=this;if(n._watchers){var o=n._watchers[e];if(o){var i=o.indexOf(t);i>=0&&o.splice(i,1)}}},e}();t.Widget=u,i.applyMixins(u,[a.DatasetMethods])}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.pagecontrol,i=n.utils,r=(n.ulocale,n.link),a=n.$mem,s=n.DatasetPlugin,l=n.dom,u=function(e,t,n,o,r){t&&t.forEach(function(t){void 0===t.$level&&(t.$level=r),t.$id=i.allocID(),o&&(t.$parentId=o.$id),n.push(t),t.$items&&t.$items.length?(void 0===t.collapsed&&(t.collapsed=!!e.canExpandItems),u(e,t.$items,n,t,r+1)):t.collapsed=!1})},c=function(){function e(e,t){this._initOptions(t),this.init(e,t)}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,n,o,i,r){},e.prototype._initOptions=function(e){},e.prototype.emit=function(e,t,n){this.emitDataEvent(e,t,n)},e.prototype.init=function(e,t){i.log("Create Menu","menu");var n=this;n.loadingHandler=this.loading.bind(n),n.noDataHandler=null,n.errorHandler=null,n.emitHandler=this.emit.bind(n),n.getLocalContextHandler=null,n.dataChangedHandler=null,n.updateMenuHandler=null,n.$element=null,n.$items=null,n.options=t||{},n.options.typeMenu=n.options.type||"left",n.data={name:"none"},n.page=o.Page(),n.page.addChild("menu-"+n.options.typeMenu,n),n.setMenu(e)},e.prototype.loading=function(e){this.page.loading(e)},e.prototype.registerDataListener=function(e){var t=this;t.page&&t.page.registerDataListener(e,t)},e.prototype.removeDataListener=function(e){var t=this;t.page&&t.page.removeDataListener(e)},e.prototype.emitDataEvent=function(e,t,n){var o=this;o.page&&o.page.emitDataEvent(e,t,n)},e.prototype.onPageChange=function(e,t){var n=this;if("$user"===e&&n.items&&n.options.auth&&!n.options.autoClose){var o=n.page.props.$user&&n.page.props.$user.connected;if(o){var i=l.find(null,n.options.parentId);i?n.show($(i)):n._showContent()}else n.$content&&!o&&n._hideContent()}"$title"===e&&n._onPageChanged()},e.prototype.setMenu=function(e){i.log("Set Menu","menu");var t=this,n=null!=e;(e=e||{name:"none"}).$groups||(e.$groups=[{$items:e.$items}]),t.data.name!==e.name||void 0===e.name?(i.log("Menu create && execute datasets","menu"),t.data=e,t.items=null,t._map={},t._recreateDatasets(),t.ds_exec("$load",null,t.props.data.ds,function(){var e=!t.options.autoClose&&t.options.parentId&&n;if(e&&t.options.auth&&(e=t.page.props.$user&&t.page.props.$user.connected),t._prepareItems(),t.$content)if(t._removeContent(),n)if(e){var o=l.find(null,t.options.parentId);o&&(t.render(),t.show($(o)))}else t.render();else t._hideContent();else if(e){var i=l.find(null,t.options.parentId);i&&t.show($(i))}t.page.props["$menu"+t.options.typeMenu]=n&&t.options.autoClose},null,!0),t._onPageChanged()):(i.log("Menu reexecute datasets","menu"),t.ds_reemit(null,function(){t._onPageChanged(),t.page.props["$menu"+t.options.typeMenu]=n&&t.options.autoClose}))},e.prototype._onPageChanged=function(){},e.prototype._doCloseClick=function(){},e.prototype._menuShowed=function(){},e.prototype._executeLink=function(e,t){},e.prototype._executeContextMenu=function(e,t,n){return!1},e.prototype._setEvents=function(){var e=this,t=e.$content.get(0);e.$content.on("click",function(n){var o=r.isCustomLink(t,n,!0);if(o&&"click"===o.protocol){var i=o.value.substring("click://".length);if("close"===i){if(e._doCloseClick)return e._doCloseClick()}else{if(0===i.indexOf("collapse/")){var a=(i=i.substring("collapse/".length)).split("/"),s=e.items[parseInt(a[0],10)];return void(s&&(e.colapse(s,!s.collapsed,!1),e.updateItemsAfterCollapse()))}var l=i.split("/");e._executeLink(e.items[parseInt(l[0],10)],l.length>1?l[1]:null)}}e.options.autoClose&&e.hide()}),e.$content.contextmenu(function(n){if(e.options.noContextMenu)return n.preventDefault(),!1;var o=r.isCustomLink(t,n,!0);if(o&&"click"===o.protocol){var i=o.value.substring("click://".length);if("close"===i);else if(0===i.indexOf("collapse/"));else{var a=i.split("/");if(e._executeContextMenu(n,e.items[parseInt(a[0],10)],a.length>1?a[1]:null))return n.preventDefault(),!1}}})},e.prototype.updateItemsAfterCollapse=function(){},e.prototype.renderItems=function(e){return null},e.prototype._removeEvents=function(){var e=this;e.$content.off("click"),e.$content.off("contextmenu")},e.prototype._loadData=function(e){var t=this;if(!t.datasets)return e(!1);t.ds_exec("$load",null,t.props.data.ds,e,null,!0)},e.prototype._expandItem=function(e,t,n,o,r,a){var s={$title:"",$item:e,$index:a,$link:r};return s.$title=i.parseVariable(o,{$item:e,$url:t,$mem:n}),s},e.prototype._expandDatasetItems=function(e,t,n){var o=this,i=o.props.data.ds[e];if(i){var s=[],l=r.search(),u=a;if(i.documents){if(!i.documents.length)return null;i.documents.forEach(function(e,i){s.push(o._expandItem(e,l,u,t,n,i))})}else s.push(o._expandItem(i,l,u,t,n,-1));return s}return null},e.prototype.copyMenuItemData=function(e,t){},e.prototype.isVisible=function(e){var t=this;if(e.$parentId&&t.options.canExpandItems){for(var n=!0,o=e;o&&o.$parentId;)if((o=t._map[o.$parentId])&&o.collapsed){n=!1;break}return n}return!0},e.prototype.colapseAll=function(e){this.items.forEach(function(t){t.collapsed=e})},e.prototype.colapse=function(e,t,n){var o=this;e.collapsed=t,e.$items&&e.$items.forEach(function(e){e.collapsed=t,n&&e.$items&&o.colapse(e,t,!0)})},e.prototype._prepareItems=function(){var e=this;if(e.items=[],e.data.$groups){var t=!0;e.data.$groups.forEach(function(n,o){var a=null;if(0===o&&(n.$title=n.$title||String.fromCharCode(160)),n.$dataset){if(!n.$link)throw"Invalid link definition. (no link)";if(!n.$itemtitle)throw"Invalid link definition. (no itemtitle)";a=e._expandDatasetItems(n.$dataset,n.$itemtitle,n.$link)}else a=n.$items;if(a&&a.length){var s=[];if(u(e.options,a,s,null,0),a=s,!t||n.$title||0===o||n.$dataset){var l={$id:i.allocID(),divider:!0,$title:null,$firstGroup:0===o,dataset:"",isHidden:!1,collapsed:!1};l.$title=n.$title,n.dataset&&(l.dataset=n.$dataset,t&&(l.isHidden=!0)),e._map[l.$id]=l,e.items.push(l),t=!1}}if(a){var c=n.$dataset?e.datasets[n.$dataset]:null;a.forEach(function(o,a){var s={$id:o.$id,$parentId:o.$parentId,$title:o.$title?i.parseExpression(o.$title,r.context()):null,$dataset:null,dataset:null,$index:0,$item:null,$link:null,$level:o.$level,selected:!1,collapsed:o.collapsed,$items:o.$items};n.dataset&&(s.dataset=n.$dataset),o.$link&&(s.$link=o.$link),c&&c.autoselect&&(s.selected=c.selectedIndex==a),e.copyMenuItemData(s,o),c&&(s.$dataset=n.$dataset,s.$index=o.$index,s.$item=o.$item),e._map[s.$id]=s,e.items.push(s),t=!1})}})}},e.prototype._removeContent=function(){this.$element&&(this.$element.remove(),this.$element=null)},e.prototype.renderContent=function(){return $("<aside></aside>")},e.prototype.show=function(e){var t=this;if(!e&&t.options.parentId){var n=l.find(null,t.options.parentId);n&&(e=$(n))}t.$content?t._showContent():(t.render(e),t.options.autoClose?i.nextTick(function(){t._showContent()}):t._showContent()),t.options.autoClose&&t.page.setPopup(t)},e.prototype.hide=function(e){var t=this;t.$content&&t._hideContent(e)},e.prototype._hideContent=function(e){var t=this.$content.get(0);l.addClass(t,"bs-none")},e.prototype._showContent=function(){var e=this,t=e.$content.get(0);l.removeClass(t,"bs-none"),e._menuShowed()},e.prototype.render=function(e){var t=this,n=t.$content;if(n||(n=t.renderContent()),t.$element||(t.$element=t.renderItems(n),n.append(this.$element)),e&&!t.$content){if(t.$content=n,t.options.replaceParent){var o=e.get(0);if(o&&o.id){var i=t.$content.get(0);i&&(i.id=o.id)}e.replaceWith(t.$content)}else e.append(t.$content);t._setEvents()}},e.prototype._recreateDatasets=function(){var e=this;e.ds_destroy(),e.removeDataListener(e),e.ds_init(e.data)&&e.registerDataListener(e)},e.prototype.destroy=function(){var e=this;i.log("Destroy Menu","destroy"),e.ds_destroy(),e.removeDataListener(e),e.$content&&(e._removeEvents(),this.$content=null),this.$element=null,e.page&&(e.page.removeChild(e),e.page=null)},e.prototype.inPopup=function(e){var t=this;if(!t.options.autoClose)return!0;if(!e)return!0;if(t.$content)for(var n=t.$content.get(0),o=e;o;){if(o==n)return!0;o=o.parentNode}return!1},e}();t.MenuBase=c,i.applyMixins(c,[s.DatasetMethods])}(e.menubase||(e.menubase={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.link,o=(t.menubase,t.preferences),i=t.application,r=t.device,a=t.utils,s=t.locale,l=e.contextmenu,u=t.dom;!function(t){var c=function(e){var t=["bs-menu-right-icon normal"];return e.collapsed?t.push(u.iconClass("plus")):t.push(u.iconClass("minus")),t.join(" ")},d=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._initOptions=function(e){i.configuration=i.configuration||{};var t=i.configuration.header||{};(e=e||{}).typeMenu=e.typeMenu||"left",e.replaceParent=!0,e.canStayInPage=!!e.inline||!r.phone&&!r.tablet,e.autoClose=!e.inline&&(!e.canStayInPage||o("menu_"+e.type+"_autoClose")),void 0===e.autoClose&&(e.autoClose=!0),e.auth=void 0===t.authLeftMenu||t.authLeftMenu,t["menu"+e.typeMenu]&&a.merge(t["menu"+e.typeMenu],e),e.styles=e.styles||{root:"$upper",parent:"",leaf:""},e.canExpandItems=!0},t.prototype._hideContent=function(e){var t=this,n=t.$content.get(0);if(t.options.bodyId){var o=u.find(null,t.options.bodyId);o&&u.removeClass(o,"bs-pc-body-"+t.options.typeMenu)}u.removeClass(n,"bs-menu-opened"),u.addClass(n,"bs-menu-closed"),t.options.bodyId&&(!t.options.autoClose||e&&t.options.autoClose)&&a.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},t.prototype._showContent=function(){var e=this,t=e.$content.get(0),n=!1;if(e.options.bodyId&&!e.options.autoClose){n=!0;var o=u.find(null,e.options.bodyId);o&&u.addClass(o,"bs-pc-body-"+e.options.typeMenu)}u.removeClass(t,"bs-menu-closed"),u.addClass(t,"bs-menu-opened"),e.options.canStayInPage?u.addClass(t,"large"):u.addClass(t,"phone"),n&&a.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},t.prototype._switchAutoClose=function(){var e=this,t=!o("menu_"+e.options.type+"_autoClose");return o("menu_"+e.options.type+"_autoClose",t),e.options.autoClose=t,e.options.autoClose?e.page.setPopup(e):e.page.popup=null,e._updateCloseButton(e.$content)},t.prototype._doCloseClick=function(){var e=this;e.options.canStayInPage?(e._switchAutoClose()?e.hide(!0):e._showContent(),e.page.props["$menu"+e.options.typeMenu]=e.options.autoClose):e.hide()},t.prototype.copyMenuItemData=function(e,t){e.$icon=t.$icon},t.prototype._updateCloseButton=function(e){var t=this,n=!1,o=e.get(0),i=u.query(o,".bs-menu-button");if(i)return t.options.canStayInPage?(u.removeClass(i,u.iconClass("times",!0)),t.options.autoClose?(u.removeClass(i,u.iconClass("times-circle-o",!0)),u.addClass(i,"small"),u.addClass(i,u.iconClass("thumb-tack",!0)),n=!0):(u.removeClass(i,u.iconClass("thumb-tack",!0)),u.removeClass(i,"small"),u.addClass(i,u.iconClass("times-circle-o",!0))),u.removeClass(i,"bs-none")):(u.removeClass(i,u.iconClass("thumb-tack",!0)),u.removeClass(i,u.iconClass("times-circle-o",!0)),u.addClass(i,u.iconClass("times",!0)),u.removeClass(i,"bs-none")),n},t.prototype.renderContent=function(){var e=this,t=e.options,n=$('<div class="bs-menu-wrap bs-scrollbar bs-menu-closed bs-menu-'+t.typeMenu+'-wrap"></div>'),o=n.get(0);t.inline&&u.addClass(o,"parent");var i=e.page.childByType("header");if(i&&i.$element){var a=u.offset(i.$element.get(0));r.phone||r.tablet||(u.supportCssCalc()?(o.style.top=a.height+"px",o.style.height="calc(100% -  "+a.height+"px)"):o.style.paddingTop=a.height+"px",o.style.zIndex="1000")}return n},t.prototype._changeSelected=function(e){var t=this;if(t.$element){var n=e,o=u.find(t.$element.get(0),n.$id);o&&(e.selected?u.addClass(o,"active"):u.removeClass(o,"active"))}},t.prototype._selectDatasetItem=function(e,t){var n=this,o=null;n.items.forEach(function(i){i.$dataset===e&&(i===t?i.selected||(i.selected=!0,n._changeSelected(i)):i.selected&&(i.selected=!1,n._changeSelected(i),o=i))}),n._expandSelected(o)},t.prototype._expandSelected=function(e){for(var t=this,n=[],o={},i=e;i;)n.push(i),o[i.$id]=!0,i.collapsed=!1,i=t._map[i.$parentId];t.items.forEach(function(e){e.collapsed||o[e.$id]||(e.collapsed=!0)}),t.updateItemsAfterCollapse();var r=n.reverse().map(function(e){return e.$title});t.data&&t.data.$moduleTitle&&r.unshift(t.data.$moduleTitle);var a=t.page.childByType("header");a&&a.setLocation(r.join(" - "),!1)},t.prototype._canClick=function(e){return e.$link},t.prototype.render=function(t){e.prototype.render.call(this,t),this._onPageChanged()},t.prototype.renderItems=function(){var e=this,t=$('<ul class="bs-item-list"></ul>'),n=t.get(0),o=$('<li class="link"><a><span class="title"></span></a></li>').get(0),i=$('<li class="parent"><span class="title"></span></li>').get(0),r=($('<li class="parent"><span class="title"></span></li>').get(0),$('<li class="divider"><span class="title"></span></li>').get(0));if(e.items){var a=e.items.length;e.items.forEach(function(t,s){if(!t.isHidden){var l;if(t.divider)l=r.cloneNode(!0),u.text(l.firstChild,t.$title||String.fromCharCode(160));else{var d=e.options.canExpandItems&&t.$items&&t.$items.length,p=!1,f="";if(s<a-1){var m=e.items[s+1];p=(m.$level||0)>(t.$level||0)&&!m.$parentId}var h=!!t.$link;if(l=h||d?o.cloneNode(!0):i.cloneNode(!0),t.$items?(f=t.$parentId?"parent":"root",u.addClass(l,"bs-menu-item-parent")):t.$parentId&&(f="leaf"),t.$level?(t.$parentId||u.addClass(l,"level"),u.addClass(l,"level-"+t.$level)):p&&u.addClass(l,"level"),f){var v=null;if(e.options.styles&&e.options.styles[f]&&(v=e.options.styles[f]),v){var g=[];u.parseStyle(v,g),g.length&&(l.className=l.className+" "+g.join(" "))}}var y=l.firstChild,_=h||d?y.firstChild:y;if(t.$title){var $=t.$icon?" "+t.$title:t.$title;u.text(_,$)}if(t.selected&&u.addClass(l,"active"),h&&(u.attr(y,"data-phoenix-href","click://"+s),e._canClick(t)||u.removeClass(y,"link")),e.options.canExpandItems){if(d){u.attr(l,"data-phoenix-href","click://collapse/"+s);var b=document.createElement("span");b.id=t.$id+"_collapse",b.className=c(t),u.append(l,b)}e.isVisible(t)||(u.addClass(l,"closed"),l.style.height="0px")}if(t.$icon){var x=u.icon(t.$icon);u.addClass(x,"bs-icon-menu"),y.insertBefore(x,y.firstChild)}}if(t.$firstGroup&&!e.options.inline){var C=document.createElement("span");C.className="bs-menu-button bs-menu-right-icon bs-none "+u.iconPrefix(),u.attr(C,"data-phoenix-href","click://close"),u.append(l,C)}l.id=t.$id,n.appendChild(l)}})}return e._updateCloseButton(t),t},t.prototype.updateItemsAfterCollapse=function(){var e=this;e.$element&&e.items&&e.options.canExpandItems&&e.items.forEach(function(t,n){if(!t.isHidden){var o=t.$items&&t.$items.length,i=e.isVisible(t),r=u.find(e.$element.get(0),t.$id);if(r){if(i!==!u.hasClass(r,"closed"))if(i){var a=window.getComputedStyle(r,null).getPropertyValue("line-height");u.removeClass(r,"closed"),r.style.height=a}else u.addClass(r,"closed"),r.style.height="0px";if(o){var s=u.find(e.$element.get(0),t.$id+"_collapse");if(s){var l=c(t);s.className!==l&&(s.className=l)}}}}})},t.prototype._executeLink=function(e,t){var o,i=this,r=n.context();if(e.$dataset&&(o=i.datasets[e.$dataset],r.$item=e.$item),o&&e.$link&&e.$link.$datasetSelect)o.selectedIndex!=e.$index&&(o.selectedIndex=e.$index,i.ds_select(e.$dataset,e.$item),i._selectDatasetItem(e.$dataset,e));else if(e.$link)return n.execLink(e.$link,r,null)},t.prototype._executeContextMenu=function(e,t,n){var o=this;if(t.$link&&t.$link.$page){var i=[{link:$.extend(!0,{},t.$link),title:s.ui.OpenNewTab}];return l.openContextMenu(e,o,i),!0}return!1},t.prototype.contextMenu=function(e){if(e.link){var t=n.context();t.$target="blank",n.execLink(e.link,t,null)}},t.prototype._onPageChanged=function(){var e=this,t={page:e.page.currentPage(),module:i.name};e.selectItem(t)},t.prototype.selectItem=function(e){var t=this,o=e&&"object"==typeof e&&e.page;if(t.items){var i=null;t.items.forEach(function(r,a){if(r.$link){var s=!1;if(o&&r.$link.$page)(s=n.pageName(r.$link)===e.page)&&r.$link.$module&&(s=r.$link.$module===e.module);else{var l=n.getLinkExecutor(r.$link);l&&(s=l.equal(e,r.$link))}r.selected!==s&&(r.selected=s,r.selected||t._changeSelected(r)),s&&(i=r)}}),i&&(t._changeSelected(i),t._expandSelected(i))}},t}(e.menubase.MenuBase);t.Menu=d,t.Menuleft=d,t.Menuright=d}(e.menu||(e.menu={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.pagecontrol,i=(n.external,n.ulocale),r=n.utils,a=n.locale,s=(n.ajax,n.dom),l=n.sticky,u=(n.ui,n.build),c=n.application,d=(n.render,n.link),p=function(e){var t=[],o=n.bootstrap4,i=["no-y-margin no-x-margin"];return o?i.push("fixed-top"):i.push("navbar-fixed-top"),t.push('<div class="'+i.join(" ")+'">'),i=["bs-header-bar no-y-margin no-x-margin no-x-padding  no-y-padding"],o?i.push("bg-dark"):i.push("navbar navbar-inverse"),t.push('<nav class="'+i.join(" ")+'">'),t.push('    <div class="container-fluid no-x-padding">'),t.push('        <div class="bs-title bs-title-nav-pos header_title"></div>'),t.push('        <ul class="'+(o?"":"nav navbar-nav ")+'no-x-margin no-y-margin bs-nav-button bs-left-nav header_left_buttons">'),t.push("        </ul>"),t.push('        <ul class="'+(o?"":"nav navbar-nav ")+'no-x-margin no-y-margin bs-nav-button bs-right-nav header_right_buttons">'),t.push("        </ul>"),t.push("    </div>"),t.push("</nav>"),e.showLocation&&t.push('<div class="bs-header-location"><span class="bs-location-buttons"></span><span class="bs-header-location-title">&nbsp;</span></div>'),t.push("</div>"),$(t.join(""))},f=function(e){return"logout"===e.$pattern&&(e.icon="lock",e.title=a.ui.Disconnect,e.link={$logout:!0},delete e.$pattern),e},m=function(e,t){var o=[],a=n.bootstrap4,l=a?"d-none d-sm-inline-block":"hidden-xs";e.id=r.allocID();var u=e.title;if(u&&"object"==typeof u&&(u=u[i.currentLang]),e.$location)o.push('<span id="{1}" class="bs-loc-link bs-style-icon-lg {2}" href="#" data-phoenix-href="click://{0}"><span>');else{if(o.push('<li id="{1}">'),"logo"===e.$type)e.$location||o.push('<a tabindex="-1" class="'+l+" bs-nav-logo "+e.$className+'" href="#" data-phoenix-href="click://{0}"></a>');else{var c=[];e.iconStyle?s.parseStyle(e.iconStyle,c):c.push("bs-style-icon-lg"),e.title||e.expression?(o.push('<a class="bs-nav-link"'),o.push('  href="#" data-phoenix-href="click://{0}"'),o.push(">"),c.push("{2}"),o.push('<span class="'+c.join(" ")+'"></span>'),c=["bs-icon-header-title"],a&&c.push("dropdown-toggle"),o.push('<span class="'+c.join(" ")+'"><span class="'+l+'">{3}</span>'),a&&c.push("dropdown-toggle"),e.menu&&o.push(' <span class="caret"></span>'),o.push("</span>"),o.push("</a>"),e.menu&&e.menu.items&&(a?(o.push('<div class="dropdown-menu bs-right-menu">'),o.push("</div>")):(o.push('<ul class="dropdown-menu bs-right-menu">'),o.push("</ul>")))):(o.push('<a class="bs-nav-link" href="#" data-phoenix-href="click://{0}">'),c.push("{2}"),o.push('<span class="'+c.join(" ")+'"></span>'),o.push("</a>"))}o.push("</li>")}return e.link&&e.link.$form&&(e.link.$form.alignElementId=e.id),$(r.format(o.join(""),t,e.id,s.customIconClass(e.$icon,e.$iconClass),u||e.expression||""))},h=function(e,t){var o=document.createDocumentFragment(),r=n.bootstrap4,a=$(r?'<a class="dropdown-item" href="#"></a>':'<li><a href="#"></a><li>').get(0);e.menu.items.forEach(function(t,n){t.$pattern&&(e.menu.items[n]=f(t),t=e.menu.items[n]);var l=a.cloneNode(!0),u=r?l:l.firstChild;if(s.attr(u,"data-phoenix-href","click://"+e.$index+"/"+n),t.icon){var c=document.createElement("span");c.className=s.iconClass(t.icon),s.append(u,c)}var d=t.title;"object"==typeof t.title&&(d=t.title[i.currentLang]),s.text(u," "+(d||"Error: title not defined")),s.append(o,l)}),s.append(t,o)},v=function(){function e(e,t){this._init(e,t)}return e.prototype.setLocation=function(e,t){var n=this;n.options.showLocation&&(n._locationTimeOut&&window.clearTimeout(n._locationTimeOut),n._locationTimeOut=window.setTimeout(function(){n._locationTimeOut=0,n._location!==e&&(n._location=e||"",n.$location&&s.text(n.$location.get(0).lastChild,n._location))},100))},e.prototype._init=function(e,t){var n=this;n.title="",n._ctx=d.context(),n._ignoreClick=!1,n.leftButtonsSpace=0,n.rightButtonsSpace=0,n.$location=null,n.$element=null,n.$buttons=[],n.options=t||{},n.page=o.Page(),n.title=c.title||"";var i=c.configuration,r=i&&i.header?i.header:{};if(void 0!==n.options.showOnDisconnected?n.options.showOnDisconnected=n.options.showOnDisconnected:n.options.showOnDisconnected=r.alwaysShow,void 0!==r.showLocation&&(n.options.showLocation=r.showLocation),void 0!==r.leftMenuButtonInLocation&&(n.options.leftMenuButtonInLocation=r.leftMenuButtonInLocation),void 0===n.options.backButton&&(n.options.backButton=!0),void 0===n.options.leftMenuButton&&(n.options.leftMenuButton=!0),void 0===n.options.topMenuButton&&(n.options.topMenuButton=!0),void 0===n.options.disconnectButton&&(n.options.disconnectButton=!0),r.logo){var a={$isHidden:!1,$type:"logo"},s="";"string"==typeof r.logo?s=r.logo:(s=r.logo.style,a.link=r.logo.link),a.$className=s,n.$buttons.push(a)}r.buttons&&r.buttons.before&&r.buttons.before.forEach(function(e){n.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),n.options.backButton&&n.$buttons.push({$icon:"chevron-left",$isHidden:!n.page.props.$hasBack&&!n.options._alwaysShowBack,$type:"back",link:{$back:!0}}),n.options.leftMenuButton&&n.$buttons.push({auth:r.authLeftMenu,$isHidden:!0,$icon:"bars",$type:"menuleft",$parent:n.options.leftMenuPlace,$location:n.options.showLocation&&n.options.leftMenuButtonInLocation}),n.options.disconnectButton&&(r.userMenu?n.$buttons.push({$icon:"user",iconStyle:"$icon-normal",right:!0,auth:!0,menu:$.extend(!0,{},r.userMenu),expression:r.userMenu.expression||"John Doe",$type:"user"}):n.$buttons.push({$icon:"power-off",right:!0,auth:!0,$type:"disconnect",link:{$logout:!0}})),n.$buttons.push({$icon:"pencil",right:!0,auth:!0,$isHidden:u.release,$type:"authoring",link:{$authoring:!0}}),u.release||n.$buttons.push({$icon:"cog",title:"Utils",right:!0,auth:!0,menu:{items:[{title:"Create a new form",icon:"building",link:{$action:{name:"phoenix.action.createform"}}},{title:"Modify form schema",icon:"pencil",link:{$action:{name:"phoenix.action.updschema"}}}]}}),n.options.rightMenuButton&&n.$buttons.push({auth:!0,$isHidden:!0,$icon:"ellipsis-v",$type:"menuright",$parent:n.options.rightMenuPlace}),n.options.topMenuButton&&n.$buttons.push({auth:!0,$isHidden:!0,$icon:"chevron-down",$type:"menutop",right:!0,$parent:n.options.topMenuPlace}),r.buttons&&r.buttons.after&&r.buttons.after.forEach(function(e){n.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),n.page.addChild("header",n),n.setData(e)},e.prototype._show=function(){var e=this,t=n.sessionPreferences("headerisHidden");return!e._ctx.$url.$inline&&!t||(t||n.sessionPreferences("headerisHidden",!0),!1)},e.prototype.setData=function(e){e=e||{}},e.prototype.buttonByType=function(e){for(var t=this,n=0,o=t.$buttons.length;n<o;n++){var i=t.$buttons[n];if(i.$type==e)return i}return null},e.prototype._createButtons=function(){var e=this;if(e.$element){var t=e.$element.get(0),n=s.query(t,".header_left_buttons"),o=s.query(t,".header_right_buttons"),i=e.$location?s.query(e.$location.get(0),".bs-location-buttons"):null;e.$buttons.forEach(function(e,t){e.$index=t;for(var r=m(e,t),a=e.$location?i:e.right?o:n,l=0,u=r.length;l<u;l++)s.append(a,r.get(l))})}},e.prototype._updateButtons=function(){var e=this,t=12;if(n.bootstrap4&&(t=s.rem2px(.8571)),e.$element){var o=e.page.props.$user&&e.page.props.$user.connected,i=t,a=t,l=e.$element.get(0);e.$buttons.forEach(function(t){var n=s.find(l,t.id);if(t.$isHidden||!o&&t.auth)s.addClass(n,"bs-none");else{if("user"===t.$type){var u=r.execAngularExpression(t.expression,e.page.props.$user.credentials);if(u!==t.title){t.title=u;var c=s.query(n,".bs-icon-header-title");c&&s.text(c.firstChild,u)}}s.removeClass(n,"bs-none"),t.$location||(t.right?a+=s.offset(n).width:i+=s.offset(n).width)}}),e.leftButtonsSpace===i&&e.rightButtonsSpace===a||(e.leftButtonsSpace=i,e.rightButtonsSpace=a,e._updateTitleSpaceMargins())}},e.prototype._updateTitleSpaceMargins=function(){var e=this;if(e.$element){var t=e.$element.get(0),n=s.query(t,".header_title");n.style.marginLeft=e.leftButtonsSpace+"px",n.style.marginRight=e.rightButtonsSpace+"px"}},e.prototype.inPopup=function(e){var t=this;if(t._ob){var n=s.find(t.$element.get(0),t._ob.id);return s.isChildOf(n,e)}return!1},e.prototype.hide=function(e){var t=this;if(t._ob){var n=s.find(t.$element.get(0),t._ob.id);s.removeClass(n.lastChild,"bs-block"),t._ob=null}},e.prototype._openPopup=function(e){var t=this;t.page.setPopup(t),t._ob=e;var n=s.find(t.$element.get(0),e.id);s.addClass(n.lastChild,"bs-block")},e.prototype._executeLink=function(e,t){var n=this;if(e.menu){var o=s.find(n.$element.get(0),e.id);if(o&&o.lastChild&&(o.lastChild.childNodes.length||h(e,o.lastChild)),!(t>=0)){if(n._ob){if(n._ob===e)return void n.page.setPopup(null);n.page.setPopup(null)}return o&&o.lastChild&&(o.lastChild.style.minWidth=Math.max(s.offset(o).width,160)+"px"),n._openPopup(e)}var i=e.menu.items[t];i.link&&d.execLink(i.link,d.context(),null),n.page.setPopup(null)}else if(e.link)return e.link.$form&&(e.link.$form.opener=e.id),d.execLink(e.link,d.context(),null);if(["menuleft","menuright","menutop","menubottom"].indexOf(e.$type)>=0&&e.$parent&&n.page){var r=n.page.childByType("menu-"+e.$type.substring(4));r&&r.show($(s.find(null,e.$parent)))}},e.prototype._onresize=function(){var e=this;e.$element&&e._updateButtons()},e.prototype._setEvents=function(){var e=this,t=e.$element.get(0);e.$element.on("mousedown",function(n){var o=d.isCustomLink(t,n,!0);if(o&&"click"===o.protocol){var i=o.value.substring("click://".length).split("/"),r=(i.length>1&&parseInt(i[1],10),e.$buttons[parseInt(i[0],10)]);if(r)if(["menuleft","menuright","menutop","menubottom"].indexOf(r.$type)>=0){if(r.$parent&&e.page){var a=e.page.childByType("menu-"+r.$type.substring(4));e.page.popup===a&&(e._ignoreClick=!0)}}else r.link&&r.link.$form&&!r.link.$form.modal&&e.page.popup&&e.page.popup.opener&&e.page.popup.opener===r.id&&(e._ignoreClick=!0)}}),e.$element.on("click",function(n){var o=d.isCustomLink(t,n);if(e._ignoreClick)e._ignoreClick=!1;else if(o&&"click"===o.protocol){var i=o.value.substring("click://".length).split("/"),r=i.length>1?parseInt(i[1],10):-1,a=e.$buttons[parseInt(i[0],10)];if(e._executeLink(a,r),a&&"logo"===a.$type){var s=document.activeElement;s&&s.blur()}}}),$(window).on("resize.header",function(){clearTimeout(e._doResize),e._doResize=setTimeout(e._onresize.bind(e),100)})},e.prototype.setPage=function(e,t){var n=this;if(u.release){var o=c.isCustomizable("pages",e),i=n.buttonByType("authoring");i&&i.$isHidden!=!o&&(i.$isHidden=!o,n._updateButtons())}},e.prototype.onPageChange=function(e,t){var n,o=this;switch(e){case"$title":o.title=t||c.title||"",o._renderTitle();break;case"$hasBack":o.options._alwaysShowBack&&(t=!0),o.options.backButton&&(n=o.buttonByType("back"))&&n.$isHidden!==!t&&(n.$isHidden=!t,o._updateButtons());break;case"$user":o._auth(!1),o._updateButtons();break;case"$menuleft":o.options.leftMenuButton&&(n=o.buttonByType("menuleft"))&&n.$isHidden==t&&(n.$isHidden=!t,o._updateButtons());break;case"$menutop":o.options.topMenuButton&&(n=o.buttonByType("menutop"))&&n.$isHidden==t&&(n.$isHidden=!t,o._updateButtons())}},e.prototype._removeEvents=function(){var e=this;e.$element.off("mousedown"),e.$element.off("click"),$(window).off("resize.header")},e.prototype.renderButtons=function(){var e=this;e._createButtons(),e._updateButtons(),r.nextTick(function(){})},e.prototype._renderTitle=function(){var e=this;if(e.$element){var t=e.$element.get(0),n=s.query(t,".header_title");s.text(n,e.title||"")}},e.prototype._auth=function(e){var t=this;if(t.$parent&&t._show()){var n=t.$parent.get(0),o=t.$element.get(0),i=!1;if(t.page.props.$user&&t.page.props.$user.connected?(i=!0,s.removeClass(o,"bs-none")):t.options.showOnDisconnected?(i=!0,s.removeClass(o,"bs-none")):s.addClass(o,"bs-none"),!e){var r=s.offset(t.$element.get(0));l.topOffset=i?r.height:0,n.style.paddingTop=i?r.height+"px":"0px"}}},e.prototype.render=function(e){var t=this;if(t._show()&&e&&!this.$element){t.$element=p(t.options);var n=t.$element.get(0);t.options.showLocation&&(t.$location=$(n.lastChild));var o=c.configuration,i=o&&o.header?o.header:{},a=s.query(n,".header_title");i.uppercase&&s.addClass(a,"bs-transform-uppercase"),i.align&&s.addClass(a,"align-"+i.align),t._renderTitle(),t.renderButtons();var u=e.get(0);t.options.replaceParent&&(u=u.parentNode),t.$parent=$(u),t._auth(!0),t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element),t._setEvents();var d=s.offset(t.$element.get(0));l.topOffset=d.height,u.style.paddingTop=d.height+"px",r.nextTick(function(){t._onresize()})}},e.prototype.destroy=function(){var e=this;r.log("Header Destroy","destroy"),this.$parent=null,e.$element&&(e._removeEvents(),this.$element=null),e.page&&(e.page.removeChild(e),e.page=null)},e}();t.Header=v}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.pagecontrol,i=n.dom,r=n.link,a=n.utils,s=n.application,l=n.ulocale,u=(n.locale,function(){function t(e,t){var n=this,i={justified:!1,pills:!1};n._page=o.Page(),n._options=$.extend(i,e||{}),n._tabs=t||[]}return t.prototype._renderTabs=function(){var t=this,n=t.$element.get(0).firstChild,o=document.createDocumentFragment(),u=$('<li><a href="#"></a><li>').get(0),c=t._page.currentPage();t._tabs.forEach(function(t,n){var d=u.cloneNode(!0),p=d.firstChild;i.text(p,l.localeTitle(t.$title));var f=!1;if(void 0!==t.enabled)if("string"==typeof t.enabled){var m=a.execAngularExpression(t.enabled,r.context());m&&"undefined"!==m&&"false"!==m||(f=!0)}else f=!t.enabled;if(f?i.addClass(d,"disabled"):i.attr(p,"data-phoenix-href","click://"+n),t.$page){var h=r.pageName(t)==c;h&&t.$module&&(h=t.$module===s.name),t.active=!!h}t.active&&i.addClass(d,e.bootstrap4?"show active":"active"),o.appendChild(d)}),i.empty(n),i.append(n,o)},t.prototype._setEvents=function(){var e=this;if(e.$element){var t=e.$element.get(0);e.$element.on("click",function(n){var o=r.isCustomLink(t,n);if(o&&"click"===o.protocol){var i=o.value.substring("click://".length).split("/"),a=r.context(),s=e._tabs[parseInt(i[0],0)];s&&s.$page&&!s.disabled&&r.execLink(s,a,null)}})}},t.prototype._removeEvents=function(){var e=this;e.$element&&e.$element.off("click")},t.prototype.render=function(e){var t=this;t.$element||(t.$element=$('<div class="bs-widget-content-inv bs-tabs"><ul class="nav nav-tabs"><ul></div>'),t._renderTabs(),t._setEvents()),e&&(t._options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))},t.prototype.destroy=function(){var e=this;e._removeEvents(),e.$element=null,e._options=null,e._page=null},t}());t.Tabs=u}(e.tabs||(e.tabs={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){t.LAYOUT_BLOCK="block",t.LAYOUT_ROW="row",t.LAYOUT_COLUMN="column",t.LAYOUT_HTML="html",t.LAYOUT_ACCORDION="accordion",t.LAYOUT_ACCORDION_GROUP="accordion-group";var n=e,o=n.dom,i=n.utils,r=n.locale.layouts,a=n.ulocale,s=n.render,l=n.sticky,u=function(e,t){if(!(e=e||""))return"page"+t;if(0===e.indexOf("page")){var n=e.substring("page".length);if(parseInt(n,10)+""===n)return"page"+t}return e},c=function(e){e.$items.length||(e.$type=t.LAYOUT_BLOCK,e.$origin=t.LAYOUT_ROW)},d=function(e,n,o,a){if(e.$id||(e.$id=i.allocID()),n&&(e.$parentId=n.$id),e.$idDesign=e.$id,e.$idDrag=e.$id,e.$type=e.$type||t.LAYOUT_BLOCK,e.$items=e.$items||[],e.$title&&(e.$title.style||void 0==e.$title.style||delete e.$title.style),b(e)?e.$fieldsOptions&&!Object.keys(e.$fieldsOptions)&&delete e.$fieldsOptions:(delete e.$inline,delete e.$fieldsOptions),o&&(o[e.$id]=e),a&&e.$name){var s=a[e.$name];s?Array.isArray(s)?s.push(e):a[e.$name]=[a[e.$name],e]:a[e.$name]=e}switch(e.$type!==t.LAYOUT_HTML||e.$html||(e.$html=r.Html),e.$type){case t.LAYOUT_ROW:c(e);break;default:delete e.$forceTable}e.$origin&&e.$origin===e.$type&&delete e.$origin,e.$type!==t.LAYOUT_ACCORDION_GROUP&&e.$title&&e.$title.value===r.defaultTitle&&delete e.$title},p=function(e,t,n,o){e.$id||(e.$id=i.allocID()),t&&(e.$parentId=t.$id),e.$idDrag=e.$id,n&&(n[e.$id]=e),o&&e.$name&&(o[e.$name]=e)},f=function(e){c(e);var n=!1;if(e.$items.forEach(function(e){e.$type=t.LAYOUT_COLUMN,e.$colSize||(n=!0)}),n){var o=Math.max(1,Math.floor(12/e.$items.length)),i=e.$items.length-1,r=0;e.$items.forEach(function(e,t){t===i&&(o=12-r),e.$colSize=o,r+=o})}},m=function(e){e.$items.length||e.$items.push({$type:t.LAYOUT_ACCORDION_GROUP}),e.$items.forEach(function(e,n){e.$type=t.LAYOUT_ACCORDION_GROUP,e.$title=e.$title||{},e.$name=u(e.$name,n),e.$title.value=e.$title.value||r.defaultTitle})},h=function(e){return e.$type!==t.LAYOUT_HTML&&!(e.$items.length>0&&!e.$items[0].$items)},v=function(e,n){return e.$type===t.LAYOUT_ACCORDION&&!e.$widget},g=function(e,o){var i=!0,r=n.bootstrap4;return e.$items.length?!(e.$type===t.LAYOUT_ACCORDION_GROUP&&!e.$widget&&!r)&&(e.$items.forEach(function(e){i&&(i=!v(e))}),i):i},y=function(e){if(e.$type&&!e.$items&&(e.$items=[]),e.$type===t.LAYOUT_ROW||e.$type===t.LAYOUT_ACCORDION||e.$type===t.LAYOUT_HTML)return!1;if(e.$items.length>0){var n=e.$items[0];if(n.$type||n.$items)return!1}return!0},_=function(e){if(e.$items&&e.$items.length){var t=!0;return e.$items.forEach(function(e){t=t&&e&&e.options&&e.options.right}),t}return!1},$=function(e,t,n){var i=e.$style;!i&&e.$sticky&&(i="$white"),o.parseStyle(i,t),!n.design&&e.$isHidden&&t.push("bs-none")},b=function(e){return!e.$items||!e.$items.length||e.$items[0].$bind},x=function(o,i,r,a,s){var u,c,d=n.bootstrap4;switch(o.$type){case t.LAYOUT_BLOCK:c=!0,r.design&&o.selected&&a.push("selected"),(u=h(o))&&((r.design||g(o))&&(c=!1,i&&a.push("no-x-padding")),r.design&&(a.push("drop-layouts-zone"),o.$origin===t.LAYOUT_ROW&&a.push("row-color"))),y(o)&&(!o.$inline||!r.design&&o.$html||(e.bootstrap4&&_(o)?a.push("form-inline d-block bs-inline-container"):a.push("form-inline bs-inline-container")),r.design&&(a.push("drop-fields-zone"),u||(c=!1,i&&a.push("no-x-padding")))),c&&a.push("field-container"),i||(a.push("bs-root-container"),r.design&&a.push("bs-scroll-container"),o.form||a.push("page")),r.design&&(a.push("design"),o.selected&&a.push("selected")),$(o,a,r),!r.design&&o.$sticky&&l&&l.native&&(a.push("bs-sticky"),"top"===o.$sticky?s.push("top:"+l.topOffset+"px;"):"bottom"===o.$sticky&&s.push("bottom:"+l.bottomOffset+"px;"));break;case t.LAYOUT_ACCORDION:1===r.step&&(a.push("panel-group bs-island"),r.design&&(a.push("design"),a.push("drop-layouts-zone"),o.selected&&a.push("selected")),$(o,a,r));break;case t.LAYOUT_ROW:1===r.step?(a.push("container-fluid"),!r.design&&o.$forceTable&&a.push("no-x-padding"),r.design&&(a.push("design"),a.push("no-x-padding"),o.selected&&a.push("selected")),$(o,a,r)):2===r.step&&(a.push("row"),o.$forceTable&&a.push("bs-row-table"),r.design&&(a.push("design-table"),a.push("row-color"),(u=h(o))&&a.push("drop-layouts-zone")));break;case t.LAYOUT_ACCORDION_GROUP:1===r.step?(d?a.push("card"):a.push("panel panel-default"),r.design&&(a.push("design"),o.selected&&a.push("selected"))):2===r.step?d?(a.push("collapse"),o.opened&&a.push("show")):(a.push("panel-collapse collapse"),o.opened&&a.push("in")):3===r.step&&(d&&a.push("card-body"),(u=h(o))&&((r.design||g(o))&&(a.push("no-x-padding"),a.push("no-y-padding")),r.design&&a.push("drop-layouts-zone")),y(o)&&(!o.$inline||!r.design&&o.$html||(e.bootstrap4&&_(o)?a.push("form-inline d-block bs-inline-container"):a.push("form-inline bs-inline-container")),r.design&&(a.push("drop-fields-zone"),u||a.push("no-x-padding"))),$(o,a,r));break;case t.LAYOUT_COLUMN:1===r.step?(r.design?a.push("col-design col"+(d?"":"-xs")+"-"+o.$colSize):o.$customColSize?a.push(o.$customColSize):a.push("col-"+(o.$colType||"sm")+"-"+o.$colSize),a.push("no-x-padding")):2===r.step&&(c=!0,a.push("container-fluid"),(u=h(o))&&((r.design||g(o))&&(c=!1,a.push("no-x-padding")),r.design&&!o.$auto&&a.push("drop-layouts-zone")),y(o)&&(!o.$inline||!r.design&&o.$html||(e.bootstrap4&&_(o)?a.push("form-inline d-block bs-inline-container"):a.push("form-inline bs-inline-container")),r.design&&(a.push("drop-fields-zone"),u||(a.push("no-x-padding"),c=!1))),c&&a.push("field-container"),r.design&&(a.push("design col"),o.$auto&&a.push("auto"),o.selected&&a.push("selected")),$(o,a,r));break;case t.LAYOUT_HTML:r.design&&(a.push("design"),o.selected&&a.push("selected")),$(o,a,r)}},C=function(e,t,n,o){var i=[],r=[];x(t,n,o,i,r),i.length&&(e.push(' class="'),e.push(i.join(" ")),e.push('"')),r.length&&(e.push(' style="'),e.push(r.join(" ")),e.push('"'))},k=function(e,t,n){e.push(' id="'),e.push(n?n+"_"+t.$id:t.$id),e.push('"')},w=function(e,t,n){n&&(e.push(' data-level="'),e.push(t),e.push('"'))},E=function(e,t,n,o,i){if((i||o)&&(e.push(' data-layout="'),e.push(n.$id),e.push('"'),n.$idSelect=null),i||o&&t>1){var r=n["$idStep"+t];r&&(e.push(' id="'),e.push(r),e.push('"'))}},P=function(e,t,s,l,u){if(t.$title&&t.$title.value===r.defaultTitle)delete t.$title;else if(l&&t.$title&&!t.$title.isHidden){var c=t.$title.size||(n.bootstrap4?5:4);e.push("<h"+c);var d=["bs-block-title"];if(t.$title.$style&&o.parseStyle(t.$title.$style,d),e.push(' data-ignore="true" class="'+d.join(" ")+'" id="'+t.$id+'_title">'),t.$title.value){var p=a.tt(t.$title.value,s);t.$fields&&(p=i.execAngularExpression(p,u||{})),e.push(i.escapeHtml(p))}e.push("</h"+c+">")}},O=function(e,t,n,o,i,r,a,s){e.push("<div"),r&&e.push(' draggable="true"'),C(e,t,n,{design:r,step:1}),E(e,1,t,r),k(e,t),w(e,1,r),e.push(">"),P(e,t,i,a,o)},S=function(e,t,n,o,i,r){e.push("</div>")},I=function(e,t,n,r,a,s){e.push(i.format('<div id="{0}_settings" class="bs-cursor-p bs-layout-detail" data-layout-detail="true"><span class="'+o.iconClass("cog")+'"></span></div>',t.$id))},D=function(e,t,n,o,i,r,a){e.push("<div"),r&&e.push(' draggable="true"'),C(e,t,n,{design:r,step:1}),E(e,1,t,r),k(e,t),w(e,1,r),e.push(">"),t.$html&&e.push(t.$html)},M=function(e,t,n,o,i){e.push("</div>")},T=function(e,t,o,r,s,l,u,c,d){if(n.bootstrap4){e.push('<li class="nav-item">');var p=["nav-link"];t.opened&&p.push("active"),e.push(i.format('<a class="'+p.join(" ")+'" id="{0}_title" href="#{0}" data-layout="{0}" aria-expanded="'+(t.opened?"true":"false")+'" role="tab" data-toggle="tab">',t.$id));f=a.tt(t.$title.value,s);t.$fields&&(f=i.execAngularExpression(f,c||{})),e.push(i.escapeHtml(f)),e.push("</a></li>")}else{e.push('<li role="presentation"'),t.opened&&e.push(' class="active"'),e.push(">"),e.push(i.format('<a href="#{0}" id="{0}_title" aria-controls="{0}"  data-layout="{0}" role="tab" data-toggle="tab">',t.$id));var f=a.tt(t.$title.value,s);t.$fields&&(f=i.execAngularExpression(f,c||{})),e.push(i.escapeHtml(f)),e.push("</a></li>")}},L=function(t,n,o,i,r,a,s,l){if(m(n),a||!n.$widget)t.push('<div role="tablist"'),e.bootstrap4||t.push(' aria-multiselectable="true"'),a&&t.push(' draggable="true"'),C(t,n,o,{design:a,step:1}),E(t,1,n,a),k(t,n),w(t,1,a),t.push(' id="'+n.$id+'_parent"'),t.push(">");else{if("tabs"!==n.$widget&&"none"!==n.$widget)throw"Invalid accordion $widget.";var u="none"===n.$widget;t.push("<div"),C(t,n,o,{design:a,step:1}),E(t,1,n,a),k(t,n),w(t,1,a),t.push(">"),t.push('<ul class="nav nav-tabs bs-tabs'+(u?" bs-none":"")+'" role="tablist">'),n.$items.forEach(function(e){return T(t,e,0,0,r,0,0,i)}),t.push("</ul>"),t.push('<div class="tab-content">')}},F=function(e,t,n,o,i,r){r||!t.$widget?e.push("</div>"):"tabs"!==t.$widget&&"none"!==t.$widget||(e.push("</div>"),e.push("</div>"))},N=function(e,t,o,r,a,s,l,u){var c=n.bootstrap4;if(s||!o.$widget)e.push("<div"),C(e,t,o,{design:s,step:1}),E(e,1,t,s),k(e,t),w(e,1,s),t.$idStep2=t.$id+"_s2",t.$idStep3=t.$id+"_s3",t.$idDesign=t.$idStep3,s&&e.push(' draggable="true"'),e.push(">"),c?e.push('<div class="card-header" role="tab"'):e.push('<div class="panel-heading" role="tab"'),k(e,t,"heading"),e.push(">"),c?e.push('<h5 class="mb-0">'):(e.push('<h4 class="panel-title bs-pointer collapsed" data-toggle="collapse" data-parent="#'+o.$id+'"'),t.opened?e.push(' aria-expanded="true"'):e.push(' aria-expanded="false"'),e.push(' data-target="#'+t.$idStep2+'" aria-controls="'+t.$idStep2+'"'),e.push(' id="'+t.$id+'_title">')),c&&(e.push("<a"),e.push(' data-toggle="collapse"'),e.push(' href="#'+t.$idStep2+'"'),e.push(' aria-controls="'+t.$idStep2+'"'),t.opened?e.push(' aria-expanded="true"'):(e.push(' aria-expanded="false"'),e.push(' class="collapsed"')),e.push(">")),e.push(i.escapeHtml(t.$title?t.$title.value:"")),c?e.push("</a></h5>"):e.push("</h4>"),e.push("</div>"),e.push('<div role="tabpanel" aria-labelledby="heading_'+t.$id+'"'),c&&e.push(' data-parent="#'+o.$id+'"'),C(e,t,o,{design:s,step:2}),E(e,2,t,s,!0),w(e,2,s),e.push(">"),e.push("<div"),C(e,t,o,{design:s,step:3}),E(e,3,t,s,!0),e.push(">");else if("tabs"===o.$widget||"none"===o.$widget){var d=["tab-pane fade"];t.opened&&d.push("in "+(c?"show active":"active")),e.push('<div role="tabpanel"'),e.push(' class="'+d.join(" ")+'"'),t.$idDesign=t.$id,k(e,t),e.push(">")}},A=function(e,t,n,o,i,r){r||!n.$widget?e.push("</div></div></div>"):"tabs"!==n.$widget&&"none"!==n.$widget||e.push("</div>")},R=function(e,t,n,o,i,r,a,s){e.push("<div"),r&&e.push(' draggable="true"'),C(e,t,n,{design:r,step:1}),k(e,t),E(e,1,t,r),w(e,1,r),e.push(">"),t.$idStep2=t.$id+"_s2",t.$idDesign=t.$idStep2,e.push("<div"),C(e,t,n,{design:r,step:2}),E(e,2,t,r),w(e,2,r),e.push(">"),f(t)},j=function(e,t,n,o,i,r){e.push("</div></div>")},H=function(e,t,n,o,i,r,a,s){e.push("<div"),C(e,t,n,{design:r,step:1}),E(e,1,t,r),k(e,t),w(e,1,r),e.push(">"),e.push("<div"),C(e,t,n,{design:r,step:2}),r&&e.push(' draggable="true"'),t.$idDesign=t.$id+"_design",t.$idDrag=t.$id,t.$idStep2=t.$idDesign,E(e,2,t,r),w(e,2,r),t.$idSelect=t.$idDesign,e.push(">"),P(e,t,i,a,o)},B=function(e,t,n,o,i,r){e.push("</div></div>")},z=function(e,t,n,o,i){if(e){if(o&&!e.$type&&!e.$items)return void n(e,t,!1,!0,i);n(e,t,!0,!0,i),i&&i.stop||(y(e)?e.$items&&e.$items.forEach(function(t){n(t,e,!1,!0,i)}):e.$items&&e.$items.forEach(function(t){z(t,e,n,!1,i)})),n(e,t,!0,!1,i)}},V=function(e,t,n,o,i){e.push('<div class="bs-island'+(i.design?" design":"")+(t.$config?" bs-widget":" bs-field")+(t.selected?' selected"':'"')),i.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push("></div>")},U=function(e,t,n,o,i){e.push('<div id="'+t.$id+'"></div>')},K=function(e,n,o,r,a,l){var u=s.get(a.context,"widget")||U,c=s.get(a.context,"field")||V,d=e.form;z(e,null,function(e,o,s,p,f){if(s){var m=O,h=S;switch(e.$type){case t.LAYOUT_ROW:m=R,h=j;break;case t.LAYOUT_COLUMN:m=H,h=B;break;case t.LAYOUT_ACCORDION:m=L,h=F;break;case t.LAYOUT_ACCORDION_GROUP:m=N,h=A;break;case t.LAYOUT_HTML:m=D,h=M}p?(e.$ref&&a.design&&(f.stop=!0),m(f.html,e,o,n,r,a.design,d,f.stop),f.stop&&I(f.html,e,0,0,0,a.design),l&&l(e)):(!a.design&&e.$html&&e.$items&&e.$items.length&&y(e)&&f.html.push(i.format(e.$html.replace(/id="/g,'id="{0}_'),e.$id)),h(f.html,e,o,n,r,a.design),e.$ref&&a.design&&(f.stop=!1))}else e.$config?u(f.html,e,o,n,a):c(f.html,e,o,n,a)},!0,{html:o})},W=function(e,t,n,o,i,r){z(e,t,function(e,t,a,s){s&&(a?d(e,t,n,i):p(e,t,o,r))},!0)};t.check=W,t.layoutVisible=function(e){return e.$type!==t.LAYOUT_ACCORDION_GROUP||e.opened},t.clearMeta=function(e,n){z(e,null,function(o,i,a,s){s&&(a?(n&&delete o.$id,delete o.$fields,delete o.$render,delete o.$idDesign,delete o.$idDrag,delete o.$idSelect,delete o.$parentId,delete o.$idStep2,delete o.$idStep3,delete o.$content,delete o.selected,o.$type!==t.LAYOUT_BLOCK&&(delete o.$sticky,o.$type===t.LAYOUT_COLUMN?delete o.$type:e.$type===t.LAYOUT_HTML&&e.$html===r.Html&&delete e.$html),o.$type===t.LAYOUT_ROW&&!1!==e.$forceTable||delete e.$forceTable,o.$name||void 0===o.$name||delete o.$name,!1===o.$inline&&delete o.$inline,o.$fieldsOptions&&(!1===o.$fieldsOptions.columns&&delete o.$fieldsOptions.columns,!1===o.$fieldsOptions.titleIsHidden&&delete o.$fieldsOptions.titleIsHidden,0===Object.keys(o.$fieldsOptions).length&&delete o.$fieldsOptions),o.datasets&&0===Object.keys(o.datasets).length&&delete o.datasets):(delete o.$render,n&&delete o.$id,delete o.$parentId,delete o.$idDrag,delete o.selected,o.$config&&(o.$config.data&&(delete o.$config.data.ds,Object.keys(o.$config.data).length||delete o.$config.data),(o.$config.$titleIsHidden||o.$config.$dontSaveTitle)&&delete o.$config.$title)))},!0)},t.namesOfLayout=function(e){var t=[];return z(e,null,function(e,n,o,i,r){o&&i&&e.$name&&t.push({name:e.$name,title:e.$title&&e.$title.value?e.$title.value:e.$name})},!0),t},t.clearMaps=function(e,t,n,o,i){z(e,null,function(e,r,a,s){if(s)if(a){if(delete t[e.$id],e.$name){var l=o[e.$name];if(Array.isArray(l)){var u=l.indexOf(e);u>=0&&l.splice(u,1),l.length||delete o[e.$name]}else delete o[e.$name]}}else delete n[e.$id],e.$name&&delete i[e.$name]},!0)},t.afterRemoveChild=function(e,n,o,i,r){e.$type===t.LAYOUT_ROW?(e.$items.forEach(function(e){e.$type=t.LAYOUT_COLUMN,delete e.$colSize}),f(e),e.$items.forEach(function(t){W(t,e,n,o,i,r)})):e.$type===t.LAYOUT_ACCORDION&&(m(e),e.$items.forEach(function(t){W(t,e,n,o,i,r)}))},t.canSelect=function(e,n){return!e.$auto&&(e.$type!==t.LAYOUT_COLUMN||1!==n)},t.updateCssClass=function(e,n,i,r){var a,s=[],l=[];x(n,i,r,s,l),e.className=s.join(" "),l.length&&(e.style=l.join(" ")),n.$type===t.LAYOUT_ACCORDION_GROUP&&1===r.step?(a=o.find(e,n.$id+"_title"))&&o.text(a,n.$title&&n.$title.value?n.$title.value:""):n.$type===t.LAYOUT_HTML&&1===r.step&&(e.innerHTML=n.$html||"")},t.toHtml=function(e,t,n,o,i){var r=[];return K(e,t,r,n,o,i),r.join("")},t.updateLayoutTitle=function(e,t,n,r){if(t.$title.value){var s=a.tt(t.$title.value,r);t.$fields&&(s=i.execAngularExpression(s,n||{})),o.text(e,s)}},t.enumSubLayouts=function(e,t){z(e,null,function(e,n,o,i){i&&o&&t(e)},!1)}}(e.layoutUtils||(e.layoutUtils={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.pagecontrol,o=t.menu,i=t.dom,r=t.utils,a=(t.locale,t.WidgetUtils,t.link),s=t.render,l=t.ipc,u=t.sticky,c=t.layoutUtils;!function(t){var d=function(e){for(var t=e.length;t--;)for(var n=e[t],o=Object.keys(n),i=o.length;i--;){var r=n[o[i]];if(r.selected)return r}return null},p=function(){function e(e,t,n,o,i,r){t=this.initOptions(t),this.$locale=null,this._init(e,t)}return e.prototype._afterCreate=function(){},e.prototype.initOptions=function(e){return e},e.prototype._init=function(e,t){var o=this;o.$element=null,o.$content=null,o.options=t||{},o.options.context=o.options.context||"javascript",o.map={},o.mapFields={},o.namedMap={},o.namedMapFields={},e=e||{},c.check(e,null,o.map,o.mapFields,o.namedMap,o.namedMapFields),o.data=e,o.data.form=o.options.form,e.map=o.map,e.fields=o.mapFields,o.children={},o.controls={},o.expressionTitle=!1,o.options.form||(o.page=n.Page(),o.page.setPopup(null),o.page.addChild("layout",o),o.options.design||(o.expressionTitle=r.hasExpression(e.$title),o.page.props.$title=e.$title?r.parseExpression(e.$title,a.context()):null)),o._setDesignListeners(),o.pageLayoutInit()},e.prototype.pageLayoutInit=function(){},e.prototype.getSchema=function(e){return null},e.prototype.getLookupForSchema=function(e,t){return null},e.prototype._setDesignListeners=function(){},e.prototype._removeEvents=function(){this._removeBaseEvents()},e.prototype._addEvents=function(){this._addBaseEvents()},e.prototype._removeBaseEvents=function(){this._removeAccordionEvents()},e.prototype._addBaseEvents=function(){this._setAccordionEvents()},e.prototype._onSelectedChanged=function(e,t,n){},e.prototype._showSelected=function(e,t){},e.prototype._setAccordionEvents=function(){var e=this;e.$element.on("shown.bs.collapse hide.bs.collapse shown.bs.tab hide.bs.tab",function(t){var n=t.target;if(n&&n.hasAttribute("data-layout")){var o=n.getAttribute("data-layout"),i=e.getLayoutById(o);if(i){var r="shown"===t.type;if(i.opened===r)return;r?e._openTab(o):e._activateLayout(i,!1)}}})},e.prototype._activatePageLayout=function(e){var t=this,n=t.$element?i.find(t.$element.get(0),e.$id+"_title"):null;n&&$(n).tab("show")},e.prototype.activatePage=function(e){var t=this,n=t.getLayoutsByName(e);n&&n.forEach(function(e){return t._activatePageLayout(e)})},e.prototype._openTab=function(e){var t=this,n=t.getLayoutById(e);if(!n.opened){var o=t.getLayoutById(n.$parentId);if(o)for(var i=0,r=o.$items.length;i<r;i++){var a=o.$items[i];if(a.opened){a.opened=!1,t._activateLayout(a,!1);break}}n.opened=!0,t._updateLayoutContent(n),t._activateLayout(n,!0)}},e.prototype._doDatasetEventAfterEnabled=function(e){},e.prototype._activateLayout=function(e,t){var n=this;t?n._getVisibleChildren(e).forEach(function(e){e.disabled=!1,n._doDatasetEventAfterEnabled(e)}):n._getChildrenOf(e).forEach(function(e){e.disabled=!0}),n._afterVisibilityChanged({inDom:!0,resize:t})},e.prototype._removeAccordionEvents=function(){this.$element.off("show.bs.collapse hide.bs.collapse")},e.prototype.toString=function(e){return null},e.prototype.emit=function(e,t,n){this.emitDataEvent(e,t,n)},e.prototype.openErrors=function(){var e=this;if(e.$element){var t=i.find(e.$element.get(0),e.data.$id+"_error");t&&t.firstChild&&i.removeClass(t.firstChild,"bs-none")}},e.prototype._getFormLData=function(){return null},e.prototype._renderLayout=function(e){var t=this;t.stickies=null;var n=$(c.toHtml(e,t._getFormLData(),t.$locale,{design:t.options.design,context:t.options.context},function(e){t.options.design||u.native||!e.$sticky||(t.stickies=t.stickies||{},t.stickies[e.$id]=e)}));return t.$element=n,t.afterRender(n),t._renderChildren(n),t.afterRenderChildren(n),n},e.prototype.afterRenderChildren=function(e){},e.prototype.isChildOf=function(e,t){for(var n=this,o=n.map[e];o;){if(o==t)return!0;o=n.map[o.$parentId]}return!1},e.prototype._isChildVisibleOf=function(e,t){for(var n=this,o=n.map[e];o;){if(!c.layoutVisible(o))return!1;if(o==t)return!0;o=n.map[o.$parentId]}return!1},e.prototype._getVisibleChildren=function(e){var t=this,n=[];return Object.keys(t.controls).forEach(function(o){var i=t.controls[o];t.controls[o].item&&t._isChildVisibleOf(t.controls[o].item.$parentId,e)&&n.push(i)}),n},e.prototype._getChildrenOf=function(e){var t=this,n=[];return Object.keys(t.controls).forEach(function(o){var i=t.controls[o];t.controls[o].item&&t.isChildOf(t.controls[o].item.$parentId,e)&&n.push(i)}),n},e.prototype._getEventListFor=function(e){var t=[];return e.forEach(function(e){e.datasets&&Object.keys(e.datasets).forEach(function(n){var o=e.datasets[n];o.enumTriggers&&o.enumTriggers(!1,function(e){t.indexOf(e)<0&&t.push(e)})})}),t},e.prototype._refreshDataSets=function(e){},e.prototype._afterLayoutAdded=function(e){},e.prototype._updateLayoutContent=function(e){var t=this,n=i.find(t.$element.get(0),e.$idDesign),o=$(n);t._renderChildren(o),t.afterAddedInDom()},e.prototype._renderLayoutContent=function(e){var t=this,n=i.find(t.$element.get(0),e.$idDesign);if(n){var o=$(n),r=$(e.$content.join("")),a=n.parentNode,s=n.nextSibling;o.detach(),o.append(r),delete e.$content,t.options.beforeAdd&&t.options.beforeAdd(o,!0),a.insertBefore(n,s),t._afterLayoutAdded(e),t._renderChildren(o);var l=t._getVisibleChildren(e);t._refreshDataSets(l),t.afterAddedInDom(),t.options.design&&(t._removeEvents(),t._addEvents())}},e.prototype._isVisible=function(e){for(var t=this;;){if(!e)return!0;var n=t.map[e];if(!n)return!0;if(!c.layoutVisible(n))return!1;e=n.$parentId}},e.prototype._renderChildren=function(e){var t=this,n=[],o=e.get(0),a=s.get(t.options.context,"widget.control"),l=s.get(t.options.context,"field.control"),u=[],c={},d=[];return t._autofocus=null,(a||l)&&(Object.keys(t.mapFields).forEach(function(e){if(!t.children[e]){var s=t.mapFields[e];if(t._isVisible(s.$parentId)){var p=s.$config?a:l,f=p===l;if(f){var m=0===(s.$bind||"").indexOf("$$"),h=t.getSchema(s.$bind),v=void 0;h||m||console.log('Schema not found for field "'+s.$bind+'".'),s&&s.$lookup&&(v=t.getLookupForSchema(s.$bind,s.$lookup)),p=p?p(s,h,v):null}if(p){var g=void 0,y={context:t.options.context,design:t.options.design,replaceParent:!0,readOnly:s.$readOnly};f?((g=new p(s,y,t)).isMeta()?u.push(g):s.$bind&&(c[s.$bind]=g),s.options&&s.options.autofocus&&(t._autofocus=g)):g=new p(s,y,t);var _=void 0;if(t.options.design||!s.$htmlParent)_=i.find(o,s.$id);else if(_=i.find(o,s.$parentId+"_"+s.$htmlParent)){y.replaceParent=!1;var $=i.find(o,s.$id);$&&i.remove($)}else _=i.find(o,s.$id);d.push({parent:_,control:g}),t.children[e]=g,t.controls[e]=g,g.resize&&(t.resizeList=t.resizeList||[],t.resizeList.push(g)),n.push(g),f&&g.getChildren&&g.getChildren().forEach(function(e){d.push({parent:e.parent,control:e.control}),e.control.id=e.control.id||r.allocID(),t.children[e.control.id]=e.control,t.controls[e.control.id]=e.control,e.control.resize&&(t.resizeList=t.resizeList||[],t.resizeList.push(e.control))})}}}}),u.forEach(function(e){var t=e.getCustomBind();if(t){var n=c[t];n&&e.setParentId(n.id)}}),d.forEach(function(e){"string"==typeof e.parent&&(e.parent=i.find(o,e.parent)),e.control.render($(e.parent)),e.control.afterAddedInDom&&(t.afterRenderList=t.afterRenderList||[],t.afterRenderList.push(e.control))})),n},e.prototype.addControl=function(e,t,n){},e.prototype._afterVisibilityChanged=function(e){var t=this;t._refreshCurrentResizeList(),t._refreshStickies(e.resize)},e.prototype._refreshStickies=function(e){var t=this;if(t.stickies&&t.$element){var n={},o=!1;Object.keys(t.stickies).forEach(function(e){var i=t.stickies[e];t._isVisible(i.$parentId)&&(n[i.$id]=i,o=!0)});var r=[];t.activeStickies&&Object.keys(t.activeStickies).forEach(function(e){n[e]?delete n[e]:r.push(t.activeStickies[e])}),t.activeStickies=t.activeStickies||{},r.forEach(function(e){delete t.activeStickies[e.id],u.stickyManager.remove(e.id)}),Object.keys(n).forEach(function(e){var o=n[e];if(o.$type===c.LAYOUT_BLOCK){var r=i.find(t.$element.get(0),o.$id);r&&(t.activeStickies[o.$id]={id:o.$id,element:r,position:o.$sticky},u.stickyManager.add(t.activeStickies[o.$id]))}}),e&&u.stickyManager.refresh(!0)}},e.prototype._refreshCurrentResizeList=function(){var e=this;e.resizeList?e.currentResizeList?(e.currentResizeList=[],e.resizeList.forEach(function(t){e._isVisible(t.config.$parentId)&&e.currentResizeList.push(t)})):e.currentResizeList=e.resizeList.map(function(e){return e}):e.currentResizeList=null},e.prototype._clearSticks=function(){var e=this;e.stickies=null,e.activeStickies&&(Object.keys(e.activeStickies).forEach(function(e){u.stickyManager.remove(e)}),e.activeStickies=null)},e.prototype._clearChildren=function(){var e=this,t=e.children;e.children={},e.controls={},e._clearSticks(),e.resizeList=null,e.currentResizeList=null,e.afterRenderList=null,Object.keys(t).forEach(function(e){t[e].destroy()})},e.prototype._refreshSelected=function(){var e=this;if(e.options.design){var t=d([e.map,e.mapFields]);e._onSelectedChanged(e.$element.get(0),t,!0)}},e.prototype.registerDataListener=function(e){var t=this;t.page&&t.page.registerDataListener(e,t)},e.prototype.removeDataListener=function(e){var t=this;t.page&&(e==t?t.page.removeParentDataListener(t):t.page.removeDataListener(e))},e.prototype.emitDataEvent=function(e,t,n){var o=this;o.page&&o.page.emitDataEvent(e,t,n)},e.prototype.afterRender=function(e){},e.prototype._internalRender=function(e,t){var n=this;return n.$element||(n.$element=n._renderLayout(n.data),n.options.beforeAdd&&n.options.beforeAdd(n.$element,t),n.$content.append(n.$element),n._addEvents(),n._refreshSelected(),e&&(n.options.form||i.bodyTheme(n.data.$theme),n.options.replaceParent?e.replaceWith(n.$content):e.append(n.$content),n._afterVisibilityChanged({inDom:!1,resize:!0}),n.afterAddedInDom())),n.$content},e.prototype.afterAddedInDom=function(){var e=this,t=a.context();t.$url.$scroll&&e.scrollTo(t.$url.$scroll)},e.prototype._callInternalRender=function(e,t){this._internalRender(e,t)},e.prototype.render=function(e){var t,n=this;return n.$content?n.$element&&(t=!0,n._clearChildren(),n._removeEvents(),n.options.beforeRemove&&n.options.beforeRemove(n.$element),n.$element.remove(),n.$element=null):n.$content=$("<div></div>"),n._callInternalRender(e,t),n.$content},e.prototype._destroyDataSets=function(){},e.prototype.destroy=function(){var e=this;r.log("Destroy Layout","destroy"),e._destroyDataSets(),l.unlisten(e),e.removeDataListener(e),e._clearChildren(),e.page&&(e.page.removeChild(e),e.page=null),e.$element&&(e._removeEvents(),e.$element=null),e._autofocus=null,e.map=null,e.mapFields=null,e.namedMap=null,e.namedMapFields=null,e.autoClose=null,c.clearMeta(e.data,!1)},e.prototype.check=function(e,t){var n=this,o=!1;e||(n.map={},n.mapFields={},n.namedMap={},n.namedMapFields={},t=null,e=n.data,o=!0),c.check(e,t,n.map,n.mapFields,n.namedMap,n.namedMapFields),o&&(e.fields=n.mapFields,e.map=n.map)},e.prototype._afterStructureChanged=function(e){this.render()},e.prototype._afterPropsChanged=function(e){var t=this;if(this.$element){var n=this.$element.get(0);if(n){var o=i.find(n,e.$id),r=e.$id!=e.$idStep2?i.find(n,e.$idStep2):null,a=e.$idStep3?i.find(n,e.idStep3):null;o&&c.updateCssClass(o,e,t.getLayoutById(e.$parentId),{design:t.options.design,step:1}),r&&c.updateCssClass(r,e,t.getLayoutById(e.$parentId),{design:t.options.design,step:2}),a&&c.updateCssClass(a,e,t.getLayoutById(e.$parentId),{design:t.options.design,step:3}),e.selected&&t._refreshSelected()}}},e.prototype.removeChild=function(e){var t=this;if(e&&t.options.design){var n=t.map[e]||t.mapFields[e];if(n){var o=t.map[n.$parentId];if(o&&(!o.$auto||(n=o,o=t.map[n.$parentId]))){var i=o.$items.indexOf(n);o.$items.splice(i,1),c.clearMaps(n,this.map,this.mapFields,t.namedMap,t.namedMapFields),c.afterRemoveChild(o,t.map,t.mapFields,t.namedMap,t.namedMapFields),t._afterStructureChanged(o)}}}},e.prototype.setDesignMode=function(e){var t=this;t.options.design!=e&&(t.options.design=e,t.render())},e.prototype.getLayoutById=function(e){return e?this.map[e]:null},e.prototype.getLayoutElementByName=function(e){if(!e)return null;var t=this,n=t.namedMap[e];return n&&t.$element?i.find(t.$element.get(0),n.$id):null},e.prototype.getLayoutByName=function(e){if(!e)return null;var t=this.namedMap[e];return t&&Array.isArray(t)?t[0]:t},e.prototype.getLayoutsByName=function(e){if(!e)return null;var t=this.namedMap[e];return t?Array.isArray(t)?t:[t]:null},e.prototype.scrollTo=function(e){var t=this,n=t.getLayoutByName(e);if(n&&t.$element){var o=i.find(t.$element.get(0),n.$id);o&&o.scrollIntoView({behavior:"smooth",block:"start"})}},e.prototype.getNamedLayouts=function(){var e=this;return c.namesOfLayout(e.data)},e.prototype.getFieldById=function(e){return e?this.mapFields[e]:null},e.prototype.select=function(e){var t=this,n=t.$element;if(t.options.design){var o=d([t.map,t.mapFields]);if(o&&(o.selected=!1,t._showSelected(n,o),t._onSelectedChanged(n.get(0),o,!1),o.$id==e))t._onSelectedChanged(n.get(0),null,!0);else if(e){var i=t.map[e]?t.map[e]:t.mapFields[e];i&&(i.selected=!0,t._showSelected(n,i),t._onSelectedChanged(n.get(0),i,!0))}}},e.prototype.updateField=function(e,t){var n=this,o=n.mapFields[e];if(o)if(o.$render&&o.$config)Object.keys(t.$config).forEach(function(e){"form"!==e&&"data"!==e&&"datasets"!==e&&o.$render[e]!=t.$config[e]&&(o.$render[e]=t.$config[e])}),(o.$config.hasOwnProperty("form")||t.$config.hasOwnProperty("form"))&&(o.$config.form=t.$config.form),o.$config.datasets=t.$config.datasets,o.$config.data=t.$config.data,n._afterStructureChanged(null);else{if(r.equals(o,t))return;var i=Object.keys(t),a=Object.keys(o);i.forEach(function(e){o[e]=t[e]}),i.push("$id"),i.push("$parentId"),i.push("$idDrag"),a.forEach(function(e){i.indexOf(e)<0&&delete o[e]});var s=n.children[e];s&&(delete n.controls[e],delete n.children[e],s.destroy()),n._afterStructureChanged(null)}},e.prototype._cleanIds=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},e.prototype._blockToCols=function(e){var t=this;e.$items&&e.$items.forEach(function(n,o){var i=n.$origin||n.$type;if(i===c.LAYOUT_BLOCK||i===c.LAYOUT_COLUMN)n.$type=c.LAYOUT_COLUMN,t._cleanIds(e);else c.LAYOUT_COLUMN,n.$colSize,n.$customColSize})},e.prototype._changeType=function(e,t){var n=this,o=n.map[e.$parentId],i=o&&o.$auto?n.map[o.$parentId]:null;switch(e.$origin||e.$type){case c.LAYOUT_BLOCK:t===c.LAYOUT_ROW&&(e.$type=t,n._blockToCols(e),n._cleanIds(e),n.check(e,o));break;case c.LAYOUT_COLUMN:if(t===c.LAYOUT_ROW){var r={$items:e.$items,$type:t,selected:!1};e.$auto=!0,e.$type=c.LAYOUT_COLUMN,e.$items=[r],e.selected&&(e.selected=!1,r.selected=!0),n._blockToCols(r),n._cleanIds(e),n.check(e,o)}break;case c.LAYOUT_ROW:if(t===c.LAYOUT_BLOCK){if(i){var a=i.$items.indexOf(o);i.$items[a]=e,e.$type=o.$type,e.$parentId=i.$id,o.$type==c.LAYOUT_COLUMN&&(e.$colSize=o.$colSize,e.$customColSize=o.$customColSize),o=i}else e.$type=t;e.$origin&&delete e.$origin,e.$items&&e.$items.forEach(function(t,o){if(t.$type)if(t.$auto){var i=t.$items[0];i.$colSize=t.$colSize,i.$customColSize=t.$customColSize,i.$parentId=e,e.$items[o]=i,n._cleanIds(t)}else t.$type=c.LAYOUT_BLOCK,n._cleanIds(t)}),n._cleanIds(e),n.check(e,o)}break;case c.LAYOUT_ACCORDION:}},e.prototype.updateIsHidden=function(e,t){var n=this;e.$isHidden!==t&&(e.$isHidden=t,n._afterPropsChanged(e),t||n._activateLayout(e,!0))},e.prototype.updateLayout=function(e,t){var n=this,o=n.map[e],i=!1,a=!1,s=!1;if(o){if(delete t.onlyFields,t.$type){var u=o.$origin||o.$type;t.$type!==u&&(n._changeType(o,t.$type),delete t.$type,i=!0)}if(t.parent){var d=n.map[o.$parentId];n._disableRules=!0,Object.keys(t.parent).forEach(function(e){t.parent[e]!==d[e]&&(d[e]=t.parent[e],i=!0)}),n._disableRules=!1,delete t.parent}if(delete t.selected,n._disableRules=!0,o.$title&&!t.$title?(delete o.$title,i=!0):!o.$title&&t.$title?(delete o.$title,o.$title=t.$title,delete t.$title,i=!0):o.$title&&t.$title&&(Object.keys(t.$title).forEach(function(e){t.$title[e]!=o.$title[e]&&(o.$title[e]=t.$title[e],i=!0)}),delete t.$title),(o.$inline||!1)!==(t.$inline||!1)&&(o.$inline=t.$inline,a=!0,o.$items.length&&(i=!0),delete t.$inline),r.equals(o.$fieldsOptions,t.$fieldsOptions)||(o.$fieldsOptions=t.$fieldsOptions,a=!0,o.$items.length&&(i=!0)),delete t.$fieldsOptions,(o.$refProperty||"")!==(t.$refProperty||"")&&(o.$refProperty=t.$refProperty,i=!0),(o.$refController||"")!==(t.$refController||"")&&(o.$refController=t.$refController,i=!0),(o.$sticky||"")!==(t.$sticky||"")&&(o.$sticky=t.$sticky,i=!0),(o.$forceTable||!1)!==(t.$forceTable||!1)&&(o.$forceTable=t.$forceTable,o.$type===c.LAYOUT_ROW&&o.$forceTable||delete o.$forceTable,i=!0),(o.$ref||"")!==(t.$ref||"")&&(o.$ref=t.$ref,o.$ref?(delete o.name,delete o.form,delete o.$fieldsOptions,s=!0):(delete o.$refProperty,delete o.$refController,delete o.name,delete o.form),o.$items=[],i=!0),delete t.$ref,delete t.$refProperty,delete t.$refController,delete t.$sticky,delete t.$forceTable,(o.$widget||"")!==(t.$widget||"")&&(o.$widget=t.$widget,i=!0),delete t.$widget,(o.$bindPages||"")!==(t.$bindPages||"")&&(o.$bindPages=t.$bindPages,i=!0),delete t.$bindPages,Object.keys(t).forEach(function(e){t[e]!==o[e]&&(o[e]=t[e],a=!0)}),n._disableRules=!1,i){if(s)return l.emit("LoadNestedLayouts",{data:o,after:function(e){r.merge(e,o);var t=n.map[o.$parentId];n._cleanIds(o),n.check(o,t),n._afterStructureChanged(o)}});n._afterStructureChanged(o)}else a?n._afterPropsChanged(o):n._refreshSelected()}},e}();t.BaseLayout=p;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ds_init=function(e){return!1},t.prototype.ds_storeLastEvent=function(e,t){},t.prototype.ds_LastEvent=function(){return null},t.prototype.ds_destroy=function(){},t.prototype.ds_context=function(){return null},t.prototype.ds_reemit=function(e,t){return null},t.prototype.ds_select=function(e,t){},t.prototype.ds_loaded=function(e,t){},t.prototype.ds_exec=function(e,t,n,o,i,r){},t.prototype.pageLayoutInit=function(){var e=this;e.loadingHandler=null,e.noDataHandler=null,e.errorHandler=null,e.emitHandler=null,e.getLocalContextHandler=null,e.dataChangedHandler=null,e.updateMenuHandler=this.updateMenu.bind(e),e._removeMenus(),e.ds_init&&e.ds_init(e.data)&&e.registerDataListener(e)},t.prototype._doDatasetEventAfterEnabled=function(e){if(e.ds_LastEvent&&e.dataEvent){var t=e.ds_LastEvent();t&&e.dataEvent(t.event,t.value)}},t.prototype._refreshDataSets=function(e){var t=this;if(t.page){var n=t._getEventListFor(e);n.length&&t.page.emittersFor(n).forEach(function(t){t.ds_reemit&&t.ds_reemit(e,function(){})})}},t.prototype._callInternalRender=function(e,t){var n=this;n.datasets&&n.ds_exec?n.ds_exec("$load",null,n.props.data.ds,function(o,i){if(i)throw i.message;n._internalRender(e,t)},null,!0):n._internalRender(e,t)},t.prototype._destroyDataSets=function(){var e=this;e.ds_destroy&&e.ds_destroy()},t.prototype._removeMenus=function(){var e=this;["left","right","top","bottom"].forEach(function(t){if(!e.data.$menus||!e.data.$menus[t]){var n=e.page.childByType("menu-"+t);n&&n.setMenu(null)}})},t.prototype.updateMenu=function(e,t){var n=this;r.log("From Layout Update Menu : "+(t?t.name:"null"),"menu");var i=n.page.childByType("menu-"+e);if(i)i.setMenu(t);else{var a=null;if("right"==e?a=o.Menuright:"left"==e&&(a=o.Menuleft),a){var s={type:e,bodyId:null,parentId:null},l=n.page.childByType("header");l&&(l.options.bodyId&&(s.bodyId=l.options.bodyId),l.options[s.type+"MenuPlace"]&&(s.parentId=l.options[s.type+"MenuPlace"])),i=new a(t,s)}}},t}(p);t.PageLayout=f,r.applyMixins(f,[e.DatasetPlugin.DatasetMethods]);var m=function(e){function t(t,n,o,i,r,a){return e.call(this,t,n,o,i,r,a)||this}return __extends(t,e),t}(f);t.Layout=m,t.LayoutClass=m}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=(t.ulocale,t.utils),o=(t.locale,t.pagecontrol),i=t.dom;t.ui;!function(e){e.SCREEN_CENTER="screencenter",e.SCREEN_TOP_CENTER="screentopcenter",e.BOTTOM_LEFT="bottom-left",e.BOTTOM_RIGHT="bottom-right";var t=function(){function t(e,t){var i=this;i._align=e,i.id=n.allocID(),t=t||t,i._checkOptions(t),i._width=t.width,i._height=t.height,i._minWidth=t.minWidth,i._minHeight=t.minHeight,i._style=t.style,i._beforeClose=t.beforeClose,i._contentRender=t.contentRender,i._autocloseParents=t.parents||[],i.opener=t.opener,i.stayOnTop=t.stayOnTop,t.alignElement&&(i.$alignElement=$(t.alignElement)),i.$parent=$(t.parent),i._page=o.Page(),i._resize=i.resize.bind(i)}return t.prototype.resize=function(){var e=this;e._setMinWidthAndMinHeight(),e._alignElement()},t.prototype.destroy=function(){var e=this;$(window).off("global-phoenix-resize",e._resize),e._autocloseParents=null,e.$element=null,e.$parent=null,e.$alignElement=null,e._beforeClose=null,e._contentRender=null,e._page=null,e.renderControl&&(e.renderControl.destroy&&e.renderControl.destroy(),e.renderControl=null)},t.prototype.inPopup=function(e){for(var t=this,n=0,o=t._autocloseParents.length;n<o;n++){var r=t._autocloseParents[n],a=i.find(null,r);if(a&&i.isChildOf(a,e))return!0}return!1},t.prototype._checkOptions=function(t){var n=this;if(t.parent=t.parent||document.body,t.alignElement||(t.parent=document.body,t.alignElement=null,n._align!==e.SCREEN_TOP_CENTER&&(n._align=e.SCREEN_CENTER)),n._align!==e.SCREEN_TOP_CENTER&&n._align!==e.SCREEN_CENTER&&!t.alignElement)throw"Align element is null";if(!t.contentRender)throw"Invalid content render"},t.prototype._alignXScreenCenter=function(){var e=this.$element.get(0),t=i.offset(e),n=i.offset(e.parentNode);e.style.left=Math.floor(Math.max((n.width-t.width)/2,0))+"px"},t.prototype._alignYScreenCenter=function(){var e=this.$element.get(0),t=i.offset(e),n=i.offset(e.parentNode);e.style.top=Math.floor(Math.max((n.height-t.height)/2,0))+"px"},t.prototype._alignTopScreen=function(){this.$element.get(0).style.top="0px"},t.prototype._alignScreenTopCenter=function(){var e=this;e._alignXScreenCenter(),e._alignTopScreen()},t.prototype._alignScreenCenter=function(){var e=this;e._alignXScreenCenter(),e._alignYScreenCenter()},t.prototype._alignBottomLeft=function(){var e=this,t=e.$element.get(0),n=e.$alignElement.get(0),o=i.documentClientDim(),r=i.offset(t),a=i.offset(n),s=i.documentScroll(),l=i.documentViewSize(),u=Math.round(a.top+a.height)-1;u+r.height>s.top+l.height&&(u=s.top+l.height-r.height),t.style.top=Math.max(0,Math.round(Math.max(s.top,u)))+"px";var c=a.left;c+r.width>o.width&&(c=Math.max(0,o.width-r.width)),t.style.left=c+"px"},t.prototype._alignBottomRight=function(){var e=this,t=e.$element.get(0),n=e.$alignElement.get(0),o=i.documentClientDim(),r=i.offset(t),a=i.offset(n);t.style.top=Math.max(0,Math.round(a.top+a.height)-1)+"px";var s=Math.max(0,Math.round(o.width-a.left-a.width));s+r.width>o.width&&(s=Math.max(0,o.width-r.width)),t.style.right=s+"px"},t.prototype._alignElement=function(){var t=this;t._align===e.SCREEN_CENTER?t._alignScreenCenter():t._align===e.SCREEN_TOP_CENTER?t._alignScreenTopCenter():t._align===e.BOTTOM_LEFT?t._alignBottomLeft():t._align===e.BOTTOM_RIGHT&&t._alignBottomRight()},t.prototype._setMinWidthAndMinHeight=function(){var e=this,t=e.$element.get(0);e._minWidth&&"auto"!==e._minWidth&&(t.style.minWidth=i.checkSize(e._minWidth)),e._minHeight&&"auto"!==e._minHeight&&(t.style.minHeight=i.checkSize(e._minHeight))},t.prototype._setHeightAndWidth=function(){var e=this,t=e.$element.get(0);e._setMinWidthAndMinHeight(),e._width&&"auto"!==e._width&&(t.style.width=i.checkSize(e._width)),e._height&&"auto"!==e._height&&(t.style.height=i.checkSize(e._height))},t.prototype.open=function(){var e=this,t=["bs-autoclose","bs-autoclose-hidden"];e._style=e._style||"modal-content",e._style&&i.parseStyle(e._style,t),e.$element=$('<div id="'+e.id+'" class="'+t.join(" ")+'"><div></div></div>'),e._autocloseParents.push(e.id);var n=e.$element.get(0),o=e.$parent.get(0);e._setHeightAndWidth(),i.append(o,n),e._contentRender($(n.firstChild),e,function(t){if(t)return console.log(t),void e.destroy();e._alignElement(),i.removeClass(n,"bs-autoclose-hidden"),e._page.setPopup(e),$(window).on("global-phoenix-resize",e._resize)})},t.prototype.hide=function(e){var t=this;t._beforeClose&&t._beforeClose();var n=t.$element.get(0);i.remove(n),t.$element=null,t.destroy()},t}();e.open=function(e,n){new t(e,n).open()}}(e.autoclose||(e.autoclose={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){function n(e,t,o,i,r,a,s){a(o,e,t,r,i,s=s||{})&&Object.keys(e.properties).forEach(function(i){var l=e.properties[i];if(!l.$reference||s&&s.$references)if(!l.type&&l.$ref&&(l=b(l,t)),"object"===l.type)n(l,t,c=o?o+"."+i:i,!1,r?r[i]:null,a,s);else if("array"===l.type){var u=b(l.items,t);if("object"===u.type){var c=o?o+"."+i:i;s.currentRef=l.items.$ref,n(u,t,c,!0,r?r[i]:null,a,s)}}})}function o(e,t,n,i,r,a){Object.keys(n).forEach(function(s){var l=n[s],u=null;if(!e||r||!(u=e.properties[s])||!(u.$reference||u.$ux||u.ux))if(!u&&"$"===s.charAt(0)||"_"===s.charAt(0))a&&"$states"===s&&(i[s]=$.extend(!0,{},n));else{if(u)if(!u.type&&u.$ref&&(u=b(u,t)),"object"===u.type)null===l?i[s]=null:(i[s]={},o(u,t,l,i[s],r));else{if("array"===u.type){var c=b(u.items,t);return null===l?void(i[s]=null):void("object"===c.type?void 0===l||(null===l?i[s]=null:(i[s]=new Array(l.length),l.forEach(function(e,n){var a={};i[s][n]=a,o(c,t,e,a,r)}))):i[s]=l.slice(0))}i[s]=l}else null===l?i[s]=null:Array.isArray(l)?(i[s]=new Array(l.length),l.forEach(function(e,n){if(null===e||void 0===e||"object"!=typeof e)i[s][n]=e;else{var a={};i[s][n]=a,o(null,t,e,a,r)}})):"object"==typeof l?(i[s]={},o(null,t,l,i[s],r)):i[s]=l}})}function i(e,t){if(!t.definitions)throw new Error("schema.definitions is null");var n=e,o=n.indexOf(s);if(o<0)throw new Error(f.format("Invalid $ref. ({0})",n));var i=n.substring(o+l);return t.definitions[i]}function r(e,t,n){var o=null;return e.allOf?(o=e.allOf,delete e.allOf):e.$ref&&t.indexOf(e.$ref)<0&&(o=[{$ref:e.$ref}],e.ux&&(o[0].ux=!0),delete e.$ref),o&&o.forEach(function(o){var r=t.slice(0);if(o.$ref){var s=i(o.$ref,n);o.ux&&(s.properties&&Object.keys(s.properties).forEach(function(e){var t=s.properties[e];void 0===t.ux&&(t.ux=!0)}),s.links&&Object.keys(s.links).forEach(function(e){var t=s.links[e];void 0===t.ux&&(t.ux=!0)})),"array"!==o.type&&"array"!==s.type&&r.push(o.$ref),delete o.$ref,f.merge(s,o)}a(o,r,n),f.merge(o,e)}),o}function a(e,t,n){r(e,t.slice(0),n);var o=null;e.properties?o=e:"array"===e.type&&e.items&&(o=e.items),o&&o.properties&&Object.keys(o.properties).forEach(function(e){var i=o.properties[e];(i.allOf||i.$ref)&&r(i,t,n),"array"===i.type&&i.items&&(i.items.allOf||i.items.$ref)&&r(i.items,t,n)})}var s="#/definitions/",l=s.length;t.INDEX_FIELD_NAME="$index",t.SELECTED_FIELD_NAME="$select",t.EXPANDED_FIELD_NAME="$expand";var u=e.ulocale,c=e.external,d=(e.application,e.ajax,e.dom),p=(e.link,e.data),f=e.utils,u=e.ulocale,m=e.locale,h=e.customData,v=e.locale.schema,g=e.DatasetPlugin,y=[t.INDEX_FIELD_NAME,t.SELECTED_FIELD_NAME,t.EXPANDED_FIELD_NAME],_=function(e){if(!e.features){e.features={};var t=void 0===e.capabilities?"filtrable,sortable":e.capabilities;t&&t.split(",").forEach(function(t){e.features[t]=!0})}},b=function(e,t){if(e.$ref){var n=e.$ref.substr(l),o=t.definitions?t.definitions[n]:null;if(!o)throw"Schema $ref not found : "+e.$ref;return o}return e},x=function(){var e={};return{register:function(t,n){e[t]=n},get:function(t){return e[t]}}}(),C=function(){var e={};return{register:function(t,n){e[t]=n},get:function(t){return e[t]}}}(),k={RATE_DECIMALS:2,RATE_MAXIMUM:1e3,RATE_SYMBOL:"%",expandSchema$Ref:function(t){return t.definitions&&Object.keys(t.definitions).forEach(function(n){var o=t.definitions[n];if(o.allOf){var r=o.allOf;delete o.allOf,r.forEach(function(n){if(n.$ref){var r=$.extend(!0,{},i(n.$ref,t));delete n.$ref,n.ux&&(r.properties&&Object.keys(r.properties).forEach(function(e){var t=r.properties[e];void 0===t.ux&&(t.ux=!0)}),r.links&&Object.keys(r.links).forEach(function(e){var t=r.links[e];void 0===t.ux&&(t.ux=!0)})),f.merge(r,n)}e.utils.merge(n,o)})}}),a(t,[],t)},path2RulePath:function(e){var t=[];return e.split(".").forEach(function(e){"$"!==e.charAt(0)&&t.push(e)}),t.join(".")},_getDefault:function(e){return"@date"===e?u.date2ISO(new Date):e},checkLookup:function(e){return e?((e=$.extend({},e)).data&&"odata"==e.data.$type||(e.pagination=!1,e.cache=!0),!1!==e.pagination&&(e.pagination=!0),e.pagination&&(e.cache=!1),e):null},schema2Authoring:function(e,t,o){var i=[];return n(e,t,"",!1,null,function(e,t,n,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,n)&&!k.isCompositionRef(a,n)){var s=e?e+"."+r:r,l={$type:"field",$bind:s,$title:u.tt(a.title,o)||s,$widget:a.$widget,options:a.$widgetOptions};i.push(l)}}),t.links&&Object.keys(t.links).forEach(function(n){var r=t.links[n],a="$links."+n,s={$type:"action",$bind:a=e?e+"."+a:a,$title:u.tt(r.title,o)||a,$widget:r.widget,options:r.$widgetOptions};i.push(s)}),!0)}),i},extractClassNames:function(e,t){var o={},i={};return n(e,t,"",!1,null,function(e,t,n,r,a,s){if(s.currentRef){if(i[s.currentRef])return!1;i[s.currentRef]=!0}if(t.name){if(o[t.name])return!1;o[t.name]=!0}return!0},{$references:!0}),Object.keys(o).length?o:null},expandRules:function(e,t){var n={rulesbyClass:{},rulesById:{}};return e.forEach(function(e){e.ruleType&&(e.triggers=e.triggers.split(",").map(function(e){return e.trim()}),e.id=f.allocID(),n.rulesById[e.id]=e,e.entities&&e.entities.forEach(function(o){t[o.entity]&&e.triggers.forEach(function(t){var i=e.ruleType;if("$events.created"===t?i="created":"$events.loaded"===t?i="loaded":"$events.saving"===t&&(i="saving"),n.rulesbyClass[i]=n.rulesbyClass[i]||{},"created"===i||"loaded"===i||"saving"===i)n.rulesbyClass[i][o.entity]=n.rulesbyClass[i][o.entity]||[],n.rulesbyClass[i][o.entity].push(e.id);else{var r=n.rulesbyClass[i][o.entity]=n.rulesbyClass[i][o.entity]||{};r[t]=r[t]||[],r[t].push(e.id)}})}))}),n},filtrableFields:function(e,t,o){var i=[];return n(e,t,"",!1,null,function(e,t,n,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,n)&&!k.isCompositionRef(a,n)&&!k.isCompositionList(a,n,!0)){var s=e?e+"."+r:r;if(k.canFilter(a)){var l={name:s,schema:f.copy(a)};l.schema.title=u.tt(l.schema.title||"",o),i.push(l)}}}),!0)}),i},searchableFields:function(e,t,o){var i=[];return n(e,t,"",!1,null,function(e,t,n,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,n)&&!k.isCompositionRef(a,n)&&!k.isCompositionList(a,n,!0)){var s=e?e+"."+r:r;if(k.canSearch(a)){var l={name:s,schema:f.copy(a)};l.schema.title=u.tt(l.schema.title||"",o),i.push(l)}}}),!0)}),i},isFwField:function(e){return y.indexOf(e)>=0},copyModel:function(e,t,n,i,r){var a={};return n=n||e,o(e,n,t,a,i,r),a},columns:function(e,t,o){var i=[];return n(e,t,"",!1,null,function(e,t,n,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,n)&&!k.isCompositionRef(a,n)&&!k.isCompositionList(a,n,!0)){var s=e?e+"."+r:r;if(k.canShowField(a)){var l={name:s,schema:f.copy(a)};l.schema.title=u.tt(l.schema.title||"",o),i.push(l)}}}),!0)}),i},allData:function(e){return!e.pagination},pkFields:function(e){return Array.isArray(e)?e:e.split(",").map(function(e){return e.trim()})},entityId:function(e){if("object"==typeof e){return Object.keys(e).map(function(t){var n=e[t];return"string"==typeof n?t+"='"+n+"'":t+"="+n}).join(",")}return"string"==typeof e?"'"+e+"'":e},extractPkValue:function(e,t){if(1==t.length)return e[t[0]];var n={};return t.forEach(function(t){n[t]=e[t]}),n},odataId:function(e,t){if(1==e.length)return t[e[0]];var n=[];return e.forEach(function(e){n.push(e+"="+encodeURIComponent(t[e]+""))}),n.join(",")},pk2Id:function(e,t){return 1===t.length?e:JSON.stringify(e)},id2Pk:function(e,t){return 1===t.length?e:JSON.parse(e)},equals:function(e,t,n){if(1===n.length)return e===t[n[0]];for(var o=0,i=n.length;o<i;o++){var r=n[o];if(e[r]!==t[r])return!1}return!0},extractBase:function(e){var t=e.split(".");return t.pop(),t.length?t.join(".")+".":""},parentPath:function(e){var t=e.split(".");return t.pop(),t.length?t.join("."):""},findByPk:function(e,t,n){if(n&&e)for(var o=0,i=n.length;o<i;o++){var r=n[o];if(k.equals(e,r,t))return r}return null},supportPagination:function(e){return!(!e.data||"odata"!==e.data.$type)},executeLookup:function(e,t,n,o){var i=e.data;if(i.$params&&n.containerId&&(i.$params.containerId=n.containerId),i.$params&&n.viewId&&(i.$params.viewId=n.viewId),n.paginated&&(n.findFirst||n.find)){i=$.extend(!0,{},e.data),n.search=(n.search||"")+"";var r=i.$params.$allData,a={$left:"startswith",$op:"$func",$right:n.fieldName+", '"+n.search.replace(/'/g,"''")+"'"};if(r&&(a=null),a)if(i.$params.$filter){var s=i.$params.$filter;i.$params.$filter={$left:a,$op:"and",$right:s}}else i.$params.$filter=a;n.findFirst&&(r||(i.$params.$top=1),i.$params.nocount=!0)}var l=p.execData(i,t,null);if(!o)return l;l?l.then(o):o(null)},remoteSearch:function(e,t){return t.mapping?t.mapping[e]:e},lastSegment:function(e,t){var n=e.split("."),o=n.pop();return t&&t!==e&&(o=t.substring(n.join(".").length)),o},hasProperty:function(e,t,n){for(var o=t,i=0,r=e.split(".");i<r.length;i++){var a=r[i];if("$"!==a.charAt(0)){if(!o.properties)return!1;if(!(o=o.properties[a]))return!1;!o.type&&o.$ref&&(o=b(o,n)),"array"===o.type&&(o=b(o.items,n))}}return!0},findFirst:function(e,t,n){if(!e||!n)return null;for(var o=e.toLocaleLowerCase(),i=o.length,r=0,a=n.length;r<a;r++)if((n[r][t]||"").toLowerCase().substr(0,i)===o)return{item:n[r],index:r};return null},_states:["$states","$links"],isMetaProp:function(e){return"$$"===e.substr(0,2)},isMeta:function(e){var t="$$meta-".length;return"$$meta-"===e.substr(0,"$$meta-".length)?{widget:e.substr(t)}:null},getLookup:function(e,t,n,o){var i=e.split(".");i.pop();for(var r=n,a=0,s=i.length;a<s&&r;a++){var l=i[a];k.arrayProps.indexOf(l)>=0||((r=r.properties?r.properties[l]:null)&&!r.type&&r.$ref&&(r=b(r,o)),r&&"array"===r.type&&(r=b(r.items,o)))}return r&&r.lookups?k.checkLookup(r.lookups[t]):null},getSchema:function(e,n,o,i){if(!e)return n;for(var r=e.split("."),a=n,s=!1,l=0,u=r.length;l<u&&a;l++){var c=r[l];if(!a.type&&a.$ref&&(a=b(a,o)),"array"==a.type&&k.arrayProps.indexOf(c)>=0)a=b(a.items,o);else if("$links"===c)a=a.links,s=!0;else{if(s){s=!1,(a=a[c]).isLink=!0;break}if(!(a=a.properties?a.properties[c]:null)&&l===u-1){if(c===t.INDEX_FIELD_NAME)return{type:"integer",title:"#",capabilities:null};if(c===t.SELECTED_FIELD_NAME)return{type:"boolean",title:m.ui.Selected,capabilities:null};if(c===t.EXPANDED_FIELD_NAME)return{type:"integer",title:"",capabilities:null}}}}return i&&a&&"array"===a.type&&a.items&&(a=b(a.items,o)),a},states:["isHidden","isDisabled","isReadOnly","isMandatory","style"],statesAndErrors:["isHidden","isDisabled","isReadOnly","isMandatory","errors","filter","symbol","decimals","style","search"],linksStates:["isHidden","isDisabled"],isLink:function(e){return e.split(".").indexOf("$links")>=0},_isMoney:function(e){return k.isNumber(e)&&"money"==e.format},_internalExtractEnums:function(e,t,n,o){if(e.name){if(o.indexOf(e.name)>=0)return;o.push(e.name)}var i=function(t,o){if((o=o||e).enums&&o.enums[t]){var i=o.enums[t].type||"default";n[i]=n[i]||{},n[i][t]=o.enums[t]}else{var r=t.split(".");2===r.length&&(n[r[1]]=n[r[1]]||{},n[r[1]][r[0]]={type:r[1]})}};e.lookups&&Object.keys(e.lookups).forEach(function(t){var n=e.lookups[t];"enum"===n.data.$type&&n.data.$enumref&&i(n.data.$enumref)}),Object.keys(e.properties).forEach(function(r){var a=e.properties[r];if(!a.type&&a.$ref&&(a=b(a,t)),k.inModel(a,t))if(k.isCompositionRef(a,t))k._internalExtractEnums(a,t,n,o);else if(k.isCompositionList(a,t,!0)){if(a.items.$ref){if(o.indexOf(a.items.$ref)>=0)return;o.push(a.items.$ref)}k._internalExtractEnums(b(a.items,t),t,n,o)}else{var s=e;k.isSimpleList(a,t)&&(s=a=b(a.items,t)),a.$enumref&&i(a.$enumref,s)}})},_extractEnums:function(e,t){return k._internalExtractEnums(e,e,t,[])},_fillEnums:function(e,t){k._internalFillEnums(e,e,t,[])},_internalFillEnums:function(e,t,n,o){if(e.name){if(o.indexOf(e.name)>=0)return;o.push(e.name)}e.lookups&&Object.keys(e.lookups).forEach(function(t){var o=e.lookups[t];if("enum"==o.data.$type&&o.data.$enumref){var i=o.data.$enumref.split("."),r=2===i.length?n[i[1]]:n[e.enums[o.data.$enumref].type||"default"],a=2===i.length?i[0]:o.data.$enumref;if(r){o.data.$value=[];var s=r[a];s.enum.forEach(function(e,t){var n={code:e,title:s.enumNames[t]};s.fields&&f.extend(n,s.fields[t]),o.data.$value.push(n)})}}}),Object.keys(e.properties).forEach(function(i){var r=e.properties[i];if(r.$ref&&!r.type&&(r=b(r.items,t)),k.inModel(r,t))if(k.isCompositionRef(r,t))k._internalFillEnums(r,t,n,o);else if(k.isCompositionList(r,t,!0))k._internalFillEnums(b(r.items,t),t,n,o);else{var a=e;if(k.isSimpleList(r,t)&&(a=r=b(r.items,t)),r.$enumref){var s=r.$enumref.split(".");if(a.enums&&a.enums[r.$enumref]||2===s.length){var l=2===s.length?n[s[1]]:n[a.enums[r.$enumref].type||"default"],u=2===s.length?s[0]:r.$enumref;if(l){var c=l[u];c&&(r.enum=c.enum,r.enumNames=c.enumNames,r.filters=c.filters)}}}}})},loadEnums:function(e){var t={};k._extractEnums(e,t);var n=Object.keys(t).map(function(e){var n=C.get(e);if(!n)throw"Invalid enum type: "+e;return n.promise(t[e],e)});return n.length?n:null},arrayProps:["$item","$new","$selected"],init:function(e,t,n,o,i,r){var a=o||{};return a._schema_initialized?a:(a._schema_initialized=!0,a.$create=i,a.$states=a.$states||{},Object.keys(e.properties).forEach(function(o){var s=e.properties[o];if(!s.type&&s.$ref&&(s=b(s,t)),k.inModel(s,t)){var l=k.isMetaProp(o),u=e.states?e.states[o]:null,c=a.$states[o]=a.$states[o]||{};if(l||u&&Object.keys(u).forEach(function(e){void 0===c[e]&&(c[e]=u[e])}),k.isCompositionRef(s,t))a[o]=k.init(s,t,n,a[o]||{},i,{children:r.children,select:r.select});else if(k.isCompositionList(s,t,!1)){a[o]=a[o]||[];var d=r.select&&(!s.children||s.children!==r.children),p={children:s.children,select:r.select},f=b(s.items,t),m=null,h=a.$states?a.$states[o]:null,v=null;h&&h.selected&&(v=JSON.parse("["+h.selected+"]")),a[o].forEach(function(e,o){e.id&&v&&v.indexOf(e.id)>=0&&(e.$select=!0),d&&0===o&&void 0===e.$select&&(m=e),e.$select&&(m=null),k.init(f,t,n,e,i,p)}),m&&!s.syncSelected&&!1!==s.autoSelect&&(m.$select=!0),h&&delete h.selected}else if(k.isSimpleList(s,t));else if(k.isList(s,t));else if(i&&void 0===a[o])if(void 0!==s.default&&null!==s.default)a[o]=k._getDefault(s.default);else if(s.enum)a[o]=s.enum[0];else switch(s.type){case"number":case"integer":void 0!==s.default&&(a[o]=s.default)}}}),a)},isCompositionRef:function(e,t){return!e.type&&e.$ref&&(e=b(e,t)),"object"===e.type&&!e.$reference},isRef:function(e,t){return"object"===e.type&&e.$reference},isList:function(e,t){return!e.type&&e.$ref&&(e=b(e,t)),"array"===e.type&&e.$reference},isCompositionList:function(e,t,n){if(!e.type&&e.$ref&&(e=b(e,t)),"array"===e.type&&e.items){var o=b(e.items,t);return("object"===o.type||"array"===o.type)&&(!e.$reference||n&&e.$reference)}return!1},isSimpleList:function(e,t){if(!e.type&&e.$ref&&(e=b(e,t)),"array"===e.type&&e.items){var n=b(e.items,t);return("object"!==n.type||"array"===n.type)&&!e.$reference}return!1},inModel:function(e,t){return!k.isRef(e,t)},formatNumber:function(e,t){return"money"==e.format?u.money(t,!1):u.decimal(t,e.decimals||0,null)},_title:function(e,t){return t?u.tt(e,t):e},canSort:function(e){return!!e&&(!e.isLink&&(!e.hidden&&(_(e),e.features.sortable)))},canShowField:function(e){return!e.hidden},canFilter:function(e){return!!e&&(!e.hidden&&(_(e),e.features.filtrable))},canSearch:function(e){return!!e&&(!e.hidden&&(_(e),e.features.searchable))},checkNumber:function(e,t,n,o){var i=!0;return e=e||0,t.exclusiveMinimum?void 0!=t.minimum&&e<=t.minimum&&(o.push({message:f.format(v.minNumberExclusive,k._title(t.title,n),k.formatNumber(t,t.minimum))}),i=!1):void 0!=t.minimum&&e<t.minimum&&(o.push({message:f.format(v.minNumber,k._title(t.title,n),k.formatNumber(t,t.minimum))}),i=!1),t.exclusiveMaximum?void 0!=t.maximum&&e>=t.maximum&&(o.push({message:f.format(v.maxNumberExclusive,k._title(t.title,n),k.formatNumber(t,t.maximum))}),i=!1):void 0!=t.maximum&&e>t.maximum&&(o.push({message:f.format(v.maxNumber,k._title(t.title,n),k.formatNumber(t,t.maximum))}),i=!1),i},_validateEmail:function(e,t){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)},_validateJson:function(e,t){try{JSON.parse(e)}catch(e){return t.ex=e,!1}return!0},checkString:function(e,t,n,o,i){var r=!0,a=e||"";if(n.minLength&&a.length<n.minLength&&(i.push({message:f.format(v.minLength,k._title(n.title,o),n.minLength)}),r=!1),t.isMandatory&&""===a&&(i.push({message:f.format(v.required,k._title(n.title,o))}),r=!1),n.format)if("email"===n.format)e&&!k._validateEmail(e,{})&&(i.push({message:v.invalidEmail}),r=!1);else if("json"===n.format){var s={};e&&!k._validateJson(e,s)&&(i.push({message:s.ex.message}),r=!1)}return r},validatePassword:function(e,t,n,o,i,r){var a=!0;return o.isHidden||o.isDisabled?a:(e!==t&&(r.push({message:v.passwordMismatch}),a=!1),a)},validateSchema:function(e,t,n,o,i,r){var a=!0;if(t){if(n&&(n.isHidden||n.isDisabled))return a;switch(t.type){case"number":case"integer":a=k.checkNumber(e,t,o,i);break;case"string":a=k.checkString(e,n,t,o,i)}return a}},loadEnumsPromise:function(e){var t=k.loadEnums(e);return t?f.Promise.all(t).then(function(t){var n={};return t.forEach(function(e){n[e.type]=e.enums}),k._fillEnums(e,n),e}):new f.Promise(function(t,n){t(e)})},loadSchemaRefs:function(t,n,o,i){if(!t)return i(null,null);try{k.expandSchema$Ref(t);var r=-1,a=k.loadEnums(t),s=a||[],l=a?a.length:0,u=w.loadMainData({datasets:o.datasets,transform:o.transform,context:n},!0);u&&s.push(u);var p=u?l+1:0,m=k.extractClassNames(t,t);if(m&&t.loadRules&&e.external.ruleLoaderHandler&&(s.push(c.ruleLoaderHandler(Object.keys(m))),r=s.length-1),!s.length)return i(null,n);d.processing(!0),f.Promise.all(s).then(function(e){d.processing(!1);var o={},a=null;if(e.forEach(function(t,i){i<l?o[t.type]=t.enums:i<p&&$.extend(n,t),i===r&&(a=e[r])}),t.rules&&(a=a?a.concat(t.rules):t.rules),a&&a.length){var s=k.expandRules(a,m);t.rules=s.rulesbyClass,t.rulesMap=s.rulesById}else delete t.rules;l&&k._fillEnums(t,o),i(null,n)}).catch(function(e){d.processing(!1),i(e,null)})}catch(e){i(e,null)}},stateProps:function(e){return e.enum&&e.filters?["filter"]:e.items&&e.items.enum&&e.items.filters?["filter"]:k.isNumber(e)?["symbol","decimals"]:"array"===e.type&&e.items&&"object"===e.items.type&&!e.items.$reference?["orderBy","selected","filter","search"]:void 0},isPassword:function(e){return"string"===e.type&&"password"===e.format},isDate:function(e){return"string"===e.type&&"date"===e.format},isDateTime:function(e){return"string"===e.type&&"date-time"===e.format},isBoolean:function(e){return"boolean"===e.type},isSelectField:function(e){return e===t.SELECTED_FIELD_NAME},isExpandField:function(e){return e===t.EXPANDED_FIELD_NAME},isNumber:function(e){return"number"===e.type||"integer"===e.type},isText:function(e){return"string"===e.type&&("json"===e.format||"memo"===e.format)},isMoney:function(e){return k.isNumber(e)&&"money"===e.format},hasSymbol:function(e){return k.isNumber(e)&&("money"===e.format||"rate"===e.format||e.symbol)},text2Value:function(e,t,n){if(k.isNumber(t)){var o=n.decimals,i=u.string2Float(e);return i=parseFloat(i.toFixed(o))}return e},value2Text:function(e,t,n){return k.isNumber(t)?u.decimal(e,n.decimals,null):e||""},expand$Ref:function(e,t){return b(e,t)},parsePath:function(e,t,n){var o=t.substr(e.length+1),i=o.split("."),r=i.shift();if(!n)return e+"."+r;o=i.join(".");for(var a=[e,r],s=n+".$item.",l=s.length,u=n+".$selected.",c=s.length;;)if(o.substr(0,l)===s)a.push(n+".$item"),o=o.substr(l);else{if(o.substr(0,c)!==u)break;a.push(n+".$selected"),o=o.substr(c)}return o===n&&a.push(o),a.join(".")},registerValidator:x.register,getValidator:x.get,registerEnumManager:C.register,getEnumManager:C.get},w={extractDatasets:function(e,t){if(e.datasets){var n=Object.keys(e.datasets);if(n.length){var o=[];return n.forEach(function(n){var i=e.datasets[n];if(!t||!1!==i.$autoOpen){var r=$.extend({},i,!0);r.name=n,o.push(r)}}),o}}return null},isQuery:function(e){return!("odata"!==e.$type||e.$method&&"GET"!==e.$method.toUpperCase()||e.$params.hasOwnProperty("$entityId"))},isCreateOrUpdate:function(e){return"odata"===e.$type&&e.$params.hasOwnProperty("$entityId")},extractMainDataSource:function(e){var t=null;if(e.datasets){var n=Object.keys(e.datasets);n.length&&(n.forEach(function(n){e.datasets[n].$main&&((t=$.extend({},e.datasets[n],!0)).name=n)}),t||((t=$.extend({},e.datasets[n[0]],!0)).name=n[0]))}return t},datasetsAsPromise:function(e,t,n){return new f.Promise(function(o,i){var r={};d.processing(!0);var a=null,s=[];e.forEach(function(e){e.$main&&(a=e)}),a||((a=e[0]).$main=!0),a.children&&Object.keys(a.children).forEach(function(e){a.children[e].name=e,s.push(a.children[e])}),w.isCreateOrUpdate(a)&&(a.$create=a.$create||{}),g.executeDatasets(e,n||{},r,{},function(e,n){if(d.processing(!1),n)i(n);else{var l=$.extend({},r[a.name]||{});if(l.$datasets=r,s&&s.length){d.processing(!0);var u={};return g.executeDatasets(s,l,u,{},function(e,n){if(delete l.$datasets,l=void 0,d.processing(!1),Object.keys(u).forEach(function(e){r[e]=u[e]}),p.execOutputData(a,r),t){var i=h.get("datasets.transform."+t);i&&i(r)}o(r[a.name])},!1)}if(p.execOutputData(a,r),t){var c=h.get("datasets.transform."+t);c&&c(r)}o(r[a.name])}})})},datasetAsPromise:function(e,t){return new f.Promise(function(n,o){var i={};e.name=e.name||"data",d.processing(!0),g.executeDatasets([e],t||{},i,{},function(t,r){d.processing(!1),r?o(r):n(i[e.name])})})},loadMainData:function(e,t){var n=w.extractDatasets(e,t);return n&&n.length?w.datasetsAsPromise(n,e.transform,e.context):f.Promise.resolve(null)},dsConfig:function(e,t,n){var o=t.$reference;if(e&&o){var i=Object.keys(e);if(1===i.length){var r=e[i[0]];return r.$main=!0,r.name=i[0],r}if("string"==typeof o){var a=e[o];return a.name=o,a}}return null}},E={_enums:{},promise:function(e,t){var n={};return Object.keys(e).forEach(function(t){var o=e[t];E._enums[t]||(E._enums[t]={enum:o.enum,enumNames:o.enumNames,filters:o.filters}),n[t]=E._enums[t]}),new f.Promise(function(e,o){e({type:t,enums:n})})}};k.registerEnumManager("default",E),t.SchemaUtils=k,t.DataUtils=w}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(e){var t=e.SchemaUtils,n=function(){function e(e,t,n){}return e.prototype.destroy=function(){var e=this;e._state&&(e._state=null),e.parent=null},e.prototype.state=function(){return this._state},e.prototype._init=function(e,t,n,o){var i=this;o=o||[],i._state=n||{},i.name=t,i.parent=e,o.forEach(function(e){void 0===i._state[e]&&(i._state[e]=!1),Object.defineProperty(i,e,{get:function(){return this._state[e]||!1},set:function(t){var n=this;if((n._state[e]||!1)!==t){if(n._state[e]=t,"filter"===e&&n.parent){var o=n.parent.getValue(i.name),r=n.parent.getSchema(i.name);if(r&&r.enum&&r.filters){var a=t?r.filters[t]:r.enum;a&&a.indexOf(o)<0&&n.parent.setValue(i.name,a.length?a[0]:null)}}n.parent&&n.parent.notifyStateChanged&&n.parent.notifyStateChanged(i.name+"."+e,{})}},enumerable:!0})})},e}();e.BaseState=n;var o=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._init(t,n,o,null),i}return __extends(t,e),t.prototype._init=function(e,t,n,o){var i=this;i._state=n||{},i.name=t,i.parent=e},Object.defineProperty(t.prototype,"columns",{get:function(){var e=this;return e.parent[e.name].columns.join(",")},set:function(e){var t=this;t.parent[t.name].columns.join(",")!==(e=e||"")&&t.parent&&t.parent.notifyStateChanged&&t.parent.notifyStateChanged(t.name+".columns",{})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){var e=this;return e.parent[e.name].getSelectedItems().join(",")},set:function(e){var t=this,n=t.parent[t.name],o=n.getSelectedItems().join(",").split(",").sort(),i=(e||"").split(",").sort().join(",");o.join(",")!==i&&n.setSelectedItems(JSON.parse("["+i+"]"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orderBy",{get:function(){return this._orderBy},set:function(e){var t=this;t._orderBy!==e&&(t._orderBy=e,t.parent&&t.parent.notifyStateChanged&&t.parent.notifyStateChanged(t.name+".orderBy",{}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){var t=this;t._filter!==e&&(t._filter=e,t.parent&&t.parent.notifyStateChanged&&t.parent.notifyStateChanged(t.name+".filter",{}))},enumerable:!0,configurable:!0}),t}(n);e.ListStates=o;var i=function(e){function n(n,o,i){var r=e.call(this,n,o,i)||this,a=n.getSchema("").properties[o],s=t.states;if(a){var l=t.stateProps(a);l&&l.length&&(s=l.concat(s))}return r._init(n,o,i,s),r}return __extends(n,e),n}(n);e.DataStates=i;var r=function(e){function n(n,o,i){var r=e.call(this,n,o,i)||this,a=o;return a.indexOf(".$links")<0&&(a="$links."+o),r._init(n,a,i,t.linksStates),r}return __extends(n,e),n}(n);e.LinkStates=r}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils;!function(e){var n={errorChanged:function(e,t){if(e=e||[],t&&t.length){if(e.length!=t.length)return!0;for(var n=!1,o=0,i=e.length;o<i;o++){var r=e[o],a=t[o];if(r.code&&a.code){if(r.code!==a.code){n=!0;break}}else{if(!r.code||!a.code){n=!0;break}if(r.message!==a.message){n=!0;break}}}return n}if(e.length)return!0}},o=function(){function e(e,t,n){this._init(e,t,n),this.isArray=!0}return e.prototype.destroy=function(){var e=this;e._errors&&(e._errors=null),e.parent=null},e.prototype.errors=function(){return this._errors.slice()},Object.defineProperty(e.prototype,"length",{get:function(){return this._errors?this._errors.length:0},enumerable:!0,configurable:!0}),e.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!this._errors)return null;for(var o=e.split(","),i=o.length,r=0,a=this._errors.length;r<a;r++){for(var s=!0,l=this._errors[r],u=0;u<i;u++)if(t[u]!==l[o[u]]){s=!1;break}if(s)return l}return null},e.prototype.clear=function(e){var t=this;return!!t._errors.length&&(t._errors.length=0,e&&t.notify(),!0)},e.prototype.hasErrors=function(){var e=this;return!(!e._errors||!e._errors.length)},e.prototype.rmvError=function(e){var t=this;if(t._errors&&t._errors.length){var n=t._errors.findIndex(function(t){return"error"===t.severity&&t.message===e});n>=0&&(t._errors.splice(n,1),t.notify())}},e.prototype.rmvErrorById=function(e){var t=this;if(t._errors&&t._errors.length){var n=t._errors.findIndex(function(t){return t.id===e});n>=0&&(t._errors.splice(n,1),t.notify())}},e.prototype.addErrors=function(e){var n=this;n._errors=n._errors||[],e&&e.length&&(e.forEach(function(e){e.id=e.id||t.allocUuid()}),n._errors=n._errors.concat(e),n.notify())},e.prototype.push=function(e){this.addErrors([e])},e.prototype.remove=function(e){var t=this;if(t._errors){var n=t._errors.indexOf(e);n>=0&&(t._errors.splice(n,1),t.notify())}},e.prototype.addError=function(e,n){this.addErrors([{severity:"error",message:e,id:n||t.allocUuid()}])},e.prototype.addSuccess=function(e,n){this.addErrors([{severity:"success",message:e,timeout:2,id:n||t.allocUuid()}])},e.prototype.addWarning=function(e,n){this.addErrors([{severity:"warning",message:e,timeout:2,id:n||t.allocUuid()}])},e.prototype.notify=function(){var e=this;e.parent&&e.parent.notifyStateChanged&&e.parent.notifyStateChanged(e.name+".errors",{})},e.prototype._init=function(e,t,n){var o=this;o._errors=n||[],o.name=t,o.parent=e},e}();e.Errors=o,e.errorsUtils=n}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=e.dom,i=e.data.odata,r=(t.SchemaUtils,t.DataUtils),a=e.DatasetPlugin,s=function(){function t(e,t){if("odata"!==e.$type)throw new Error("Only odata sources are supported.");var n=this;if(n._config=e||{},n._origFilter=n._config.$params.$filter,n._config.$params.$searchByFields&&(n._search=n._config.$params.$searchByFields.value,n._searchFields=n._config.$params.$searchByFields.fields),n._pageSize=0,n._model=t,n._currentPage=1,!n.isQuery())throw"Invalid Queryable DataSource";n._pageSize=n._config.$params.$top||0,n._orderby=n._config.$params.$orderby||""}return t.prototype.initPagination=function(e,t,n){var o=this;o._pageSize=e,o._totalCount=n,o._currentPage=t},t.prototype.initFromData=function(e){var t=this;if(t.isQuery()&&(t._pageSize=e.pageSize,t._currentPage=t._pageSize?Math.ceil(e.skip/t._pageSize)+1:0,t._totalCount=e.count,t._skip=e.skip,e.uri)){var n=t._model.parent;n.hasOwnProperty("uri")&&(n.uri=e.uri),n.hasOwnProperty("search")&&(n.search=e.search)}},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){var t=this;t._filter=e,t._filter&&t._filter.value?t._origFilter?t._config.$params.$filter={$left:t._origFilter,$op:"AND",$right:t._filter.value}:t._config.$params.$filter=t._filter.value:t._origFilter?t._config.$params.$filter=t._origFilter:t._config.$params.$filter=null,t.refresh(!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"search",{get:function(){return this._search},set:function(e){var t=this;e!==t._search&&(t._search=e,t._config.$params.$searchByFields={fields:t._searchFields,value:e},t._searchFields&&t.refresh(!0,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchFields",{get:function(){return this._searchFields},set:function(e){var t=this;if(e.join("$$$")!==t._searchFields.join("$$$")){var n=!!t._search;t._search="",t._searchFields=e,t._config.$params.$searchByFields={fields:t._searchFields,value:e},n&&t.refresh(!0,!1)}},enumerable:!0,configurable:!0}),t.prototype.pageSize=function(){var e=this;return e.isQuery()?e._pageSize:0},t.prototype.orderBy=function(e){var t=this;return void 0===e?t._orderby:(e!==t._orderby&&(t._orderby=e,t.refresh(!0,!1)),t._orderby)},t.prototype.refresh=function(e,t){var o=this;return new n.Promise(function(n,i){o.isQuery()?(e&&(o._currentPage=0),o._open(t).then(function(){o._model.notifyPaginationChanged(),o._model.notifySortingChanged(),n()})):n()})},t.prototype.currentPage=function(e){var t=this;if(void 0!=e){if(t.isQuery()){var n=Math.min(e,t.totalPages());t._currentPage!=n&&(t._currentPage=n,t._open(!1).then(function(){t._model.notifyPaginationChanged()}))}return e}return t.isQuery()?t._currentPage:0},t.prototype.totalPages=function(){var e=this;return e.isQuery()?e._pageSize?Math.ceil(e._totalCount/e._pageSize):1:0},t.prototype.totalCount=function(){var e=this;return e.isQuery()?e._totalCount:0},t.prototype.destroy=function(){var e=this;e._config=null,e._model=null},t.prototype.isQuery=function(){return r.isQuery(this._config)},t.prototype.open=function(){return this._open(!0)},t.prototype.remove=function(e,t){var i=this;return i.isQuery()?new n.Promise(function(n,r){var s={name:"data",$type:i._config.$type,$method:"DELETE",$params:{$module:i._config.$params.$module,$entity:i._config.$params.$entity,$entityId:e}},l={};o.processing(!0),a.executeDatasets([s],{etag:t},l,{},function(e,t){o.processing(!1),t?i._model?(i._model.addAjaxException(t),r(null)):r(t):n(null)})}):null},t.prototype._applyFilters=function(){var e=this,t=e._model.allData;return i.applyFilters(t,e._search,e._searchFields,e._skip,e._pageSize,e._orderby)},t.prototype._open=function(t){var i=this;return i._config.name="data",new n.Promise(function(n,r){o.processing(!0);var s=i.isQuery(),l={};s&&(i._orderby&&i._config.$params.$orderby!==i._orderby&&(i._config.$params.$orderby=i._orderby),i._pageSize>0?(i._config.$params.$top=i._pageSize,i._config.$params.$skip=Math.max(0,i._currentPage-1)*i._pageSize,0==i._config.$params.$skip&&delete i._config.$params.$skip,i._skip=i._config.$params.$skip):(delete i._config.$params.$top,delete i._config.$params.$skip));var u=i._config;if(!t&&s&&i._config.$params.$allData&&i._model.allData){var c=i._applyFilters();return e.dom.processing(!1),i.initFromData(c),i._model.setModel(c.documents),void n(c)}a.executeDatasets([u],i._model.parent.model(!0)||{},l,{},function(e,a){if(o.processing(!1),a)i._model?(i._model.addAjaxException(a),r(null)):r(a);else{var u=l.data;if(i.initFromData(u),s&&i._skip&&i._skip>=i._totalCount)return i._currentPage=0,i._open(t).then(function(e){n(e)});s&&i._config.$params.$allData&&(i._model.allData=u._allData),i._model&&(s?i._model.setModel(u.documents):i._model.setModel(u)),n(u)}})})},t.prototype.save=function(){var e=this;e.isQuery()||e._model.validate()},t}();t.QueryableDataSource=s}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.Observable,o=n.SchemaUtils,i=(n.DataUtils,e.locale,e.ulocale),r=e.utils,a={},s=function(e,t){return(t=t||{}).isPropagation&&(e=e.replace(/sum\(\s*([^)]+?)\s*\)/g,function(e,t){var n=t.split(/\s*,\s*/);if(n&&1===n.length){var o=n[0].split("."),i=o.pop();return"sum("+o.join(".")+", '"+i+"')"}return e})),e},l=function(e,t,n,o){try{e.code||(e.code=new Function("o","ctx","window",s(e.expression,{isPropagation:!0})),e.conditionCode=e.condition?new Function("o","ctx","window","return "+s(e.condition,{isPropagation:!1})):null);var i=!0;if(e.conditionCode&&(i=e.conditionCode(t,n,null)),i){var a=t.getRootModel();r.logRule(a._callStack?a._callStack.length:0,e,o,t.className||""),e.code(t,n,null)}}catch(n){u(n,e,t.getRootModel())}},u=function(e,t,n){"string"==typeof e&&(e={message:e});var o=r.format("Rule '{0}'  {1}:",t.name,t.description||"");n.addError([o,e.message||""].join("\n"))},c=function(e){var t={today:i.date2ISO(new Date),now:function(){return(new Date).toISOString()},addHours:function(e,t){var n=i.parseISODateTime(e);if(null!==n)return n.setTime(n.getTime()+60*t*60*1e3),n.toISOString()},isTriggeredBy:function(e){return!1},sum:function(e,t){var n=0;return e&&e.forEach(function(e,o,i){n+=e[t]||0},""),n},safeDivide:function(e,t,n){return t=t||0,e=e||0,0===parseFloat(t.toFixed(8))?n||0:e/t},partition:function(e,t,n,o){var i=-1,r=-1,a=e=e||0,s=0;if(t.forEach(function(e,t,n){var a=e[o]||0;Math.abs(a)>i&&(i=Math.abs(a),r=t),s+=a}),0!==(s=parseFloat(s.toFixed(8)))&&r>=0&&(t.forEach(function(t,i,r){var l=t[o]||0;t[n]=e*l/s,a-=t[n]}),0!==(a=parseFloat(a.toFixed(8))))){var l=t.get(r);l[n]=(l[n]||0)+a}},utc:function(e){if(!e)return 0;var t=i.parseISODateTime(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},milliseconds2Hours:function(e){return e/36e5},date:function(e){return i.parseISODateTime(e)}};return Object.keys(a).forEach(function(e){t[e]||(t[e]=a[e])}),t},d=function(e,t){return e},p=function(e,t,n){return r.execAngularExpression(e,{o:n||{},ctx:t})};t.execInitRules=function(e){var t,n,o=e.getRootModel().getSchema("");if(e.$create?(t=o.rules&&o.rules.created?o.rules.created[e.className]:null,n="$events.created"):(t=o.rules&&o.rules.loaded?o.rules.loaded[e.className]:null,n="$events.loaded"),t){var i=c(e.getRootModel());t.forEach(function(t){return l(o.rulesMap[t],e,i,n)})}},t.execBeforeSaveRules=function(e){var t=e.getRootModel().getSchema(""),n=t.rules&&t.rules.saving?t.rules.saving[e.className]:null;if(n){var o=c(e.getRootModel());n.forEach(function(n){return l(t.rulesMap[n],e,o,"$events.saving")})}},t.execPropChangeRules=function(e,t,n,o){e.callStack=e.callStack||[];var i=d(t);e.callStack.push(i);try{if(e.$schema.rules&&(e.$schema.rules.validation&&o.validations||e.$schema.rules.propagation&&o.propagations)){var a=t.split("."),f=a.pop();if("$"===f.charAt(0))return;for(var m=[f],h=n.instance,v=h,g=c();h;)!function(){var t=o.propagations&&e.$schema.rules.propagation?e.$schema.rules.propagation[h.className]:null,n=m.join("."),i=t?t[n]:null;i&&i.forEach(function(t){return l(e.$schema.rulesMap[t],h,g,n)}),(i=(t=o.validations&&e.$schema.rules.validation?e.$schema.rules.validation[h.className]:null)?t[n]:null)&&i.forEach(function(t){var o=e.$schema.rulesMap[t];try{if(!o.code){var i="return ";o.expression.indexOf(i)>=0&&(i=""),o.code=new Function("o","ctx","window",i+s(o.expression,{isPropagation:!1})),o.conditionCode=o.condition?new Function("o","ctx","window","return "+s(o.condition,{isPropagation:!1})):null}var a=o.triggers.length>1,l=!0;o.conditionCode&&(l=o.conditionCode(h,g,null)),l&&r.logRule(e.callStack?e.callStack.length:0,o,n,h.className||""),!l||o.code(h,g,null)?a?e.rmvError(p(o.errorMsg,g,h)):v.$errors[f].rmvError(p(o.errorMsg,g,h)):a?e.addError(p(o.errorMsg,g,h)):v.$errors[f].addError(p(o.errorMsg,g,h))}catch(t){u(t,o,e)}});var c=a.pop();c&&"$"===c.charAt(0)&&(c=a.pop()),c&&m.unshift(c),h=h.parent}()}}finally{e.callStack.pop(),e.callStack.length||(e.callStack=null)}},t.execValidationRules=function(e,t){if(!e.className)return!1;var n=e.getRootModel();if(!n.$schema.rules||!n.$schema.rules.validation||!n.$schema.rules.validation[e.className])return!1;var i=Object.keys(n.$schema.rules.validation[e.className]),a=c(),l=!1;return i.forEach(function(i){if(t&&t.indexOf(i)<0)return!1;var c=n.$schema.rules.validation[e.className][i];c&&c.forEach(function(t){var c=n.$schema.rulesMap[t];try{if(!c.code){var d="return ";c.expression.indexOf(d)>=0&&(d=""),c.code=new Function("o","ctx","window",d+s(c.expression,{isPropagation:!1})),c.conditionCode=c.condition?new Function("o","ctx","window","return "+s(c.condition,{isPropagation:!1})):null}var f=!0;if(c.triggers.length&&c.triggers.forEach(function(t){0!==t.indexOf("$events.")&&f&&(f=o.hasProperty(t,e.$schema,n.$schema))}),!f)return;var m=c.triggers.length>1,h=!0;c.conditionCode&&(h=c.conditionCode(e,a,null)),h&&r.logRule(n.callStack?n.callStack.length:0,c,i,e.className||""),!h||c.code(e,a,null)?m?n.rmvError(p(c.errorMsg,a,e)):e.$errors[i].rmvError(p(c.errorMsg,a,e)):(l=!0,m?n.addError(p(c.errorMsg,a,e)):e.$errors[i].addError(p(c.errorMsg,a,e)))}catch(e){u(e,c,n)}})}),l},t.injectInContext=function(e,t){a[e]=t}}(e.rules||(e.rules={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.application,i=t,r=n.rules,a=i.SchemaUtils,s=i.DataUtils,l=e.utils,u=n.jsonpatch,r=n.rules,c=e.ajax,d=e.locale,p=e.ulocale,f=e.locale.schema,m=function(e,n){var o=e._rootParent._schema,i=e._schema.properties[n];a.inModel(i,o)&&(Object.defineProperty(e,n,{get:function(){var e=this,t=e._children[n];return t||e._model[n]},set:function(t){var o=this,i=o._model[n];if(i!==t||!o._initialized[n]){var r=o._schema.properties[n],s=o._beforeChange(o,n,r,i,t,!o._initialized[n]);if(t=s.value,o._initialized[n]=!0,s.continue){if(o.isRecursiveRule(n))return;o._model[n]=t;var l=e._rootParent._schema,u=o.$errors[n];u&&u.clear(!0),a.isCompositionRef(r,l)?(o._setRefChild(n,i,t,{}),o.notifyChanged(n,i,t,"propchange",{instance:o,checkChildren:!0},!0),o.notifyStateChanged(n,{checkChildren:!0})):a.isCompositionList(r,l,!1)?(o._setListChild(n,i,t,"propchange",{checkChildren:!0}),o.notifyChanged(n,i,t,"propchange",{instance:o},!0),o.notifyStateChanged(n,{checkChildren:!0})):a.isSimpleList(r,l)?(o._setSimpleListChild(n,i,t,"propchange",{}),o.notifyChanged(n,i,t,"propchange",{instance:o},!0),o.notifyStateChanged(n,{checkChildren:!0})):a.isList(r,l)?o[n].setModel(t):o.notifyChanged(n,i,t,"propchange",{instance:o},!0)}}},enumerable:!0}),a.isCompositionList(i,o,!1)&&Object.defineProperty(e,n+t.EXPANDED_FIELD_NAME,{get:function(){var e=this[n];return e&&e.length?e.$expand?2:1:0},set:function(e){var t=this[n];t&&(1===e?t.$expand=!1:2===e&&(t.$expand=!0))},enumerable:!0}))},h=function(e,t,n){var o=e._schema.properties[t],r=e._rootParent._schema;a.inModel(o,r)&&(a.isNumber(o)&&(a.isMoney(o)?((n=n||{}).symbol||(n.symbol=o.symbol||d.number.symbol),n.decimals||(n.decimals=void 0!==o.decimals?o.decimals:d.number.places)):(n=n||{},void 0!==o.symbol&&((n=n||{}).symbol=o.symbol),void 0!==o.decimals?n.decimals=o.decimals:n.decimals=0)),"array"===o.type?e.$states[t]=new i.ListStates(e,t,n):e.$states[t]=new i.DataStates(e,t,n))},v=function(e,t,n){var o=e.$schema.properties[t],r=e.root.$schema;a.inModel(o,r)&&!a.isCompositionRef(o,r)&&(e.$errors[t]=new i.Errors(e,t,n))},g=function(e,t,n){e.$links[t]=new i.LinkStates(e,t,n)},y={setValue:function(e,t,n,o){n.setValue(e,t,o)},getValue:function(e,t,n){return t.getValue(e,n)},getState:function(e,t,n){return t.getState(e,n)},_segment2Id:function(e){var t=parseInt(e,10);return t+""!==e&&(t=e),t},_resolveJSONPatchSegment:function(e,t,n){if(t.isArray){if("$links"===e)return{value:t.$links,useId:n};var o=y._segment2Id(e);return{value:t.find("id",o),useId:n}}return{value:t[e],useId:n}},getJSONPatchParent:function(e,t){var n=e.split("/");n.shift();var o={lastSegment:n.pop(),value:null,type:0};if(e.indexOf("$states")>=0)o.type=2;else if(e.indexOf("$errors")>=0)o.type=3;else if(e.indexOf("$links")>=0){o.type=1;var i=n.pop(),r=i.split(".");if(r.length>1){var a=r.shift();i=r.join(".");var s=n.pop();n.push(a),n.push(s)}n.push(i)}for(var l=t,u=!0;n.length;){var c=y._resolveJSONPatchSegment(n.shift(),l,u);if(u=c.useId,!(l=c.value))break}if(l){var d=l[o.lastSegment];d&&d.isArray&&(o.lastSegment="",l=d)}return o.value=l,o},_resolveSegment:function(e,t,n,o,i,r){return"$item"!==e?"$selected"===e?(r&&(n[e]=i),n[e]):"$new"===e?(r&&(n[e]=i),n[e]):n&&n[e]&&"function"==typeof n[e]?r?n[e](i):n[e]():(r&&(n[e]=i),n[e]):o?o[t]:void 0}},_=function(){function e(e,t,n,o,r,s,l,u){var c=this;if(c.isArray=!0,c._map={},c._expanded=!1,c.isQuery=l,c._selectedUids=[],c._selectedPks=[],c.isNull=!1,c.isUndefined=!0,c._model=void 0,c._items=[],c._path=n,c._parent=t,c._parentSelected=u,c._locale=s,c._arrayParent=r,c._rootSchema=c._parent.getRootModel().getSchema(""),c._schema=a.expand$Ref(e,c._rootSchema),c._schemaItems=a.expand$Ref(c._schema.items,c._rootSchema),c.frozen=!1,c.$links={},c._schema.links){var d=c._parent.model(!0);Object.keys(c._schema.links).forEach(function(e){var t=$.extend({},c._schema.links[e]),o=n+"."+e;d.$links=d.$links||{},d.$links[o]=$.extend(t,d.$links[o]||{}),c.$links[e]=new i.LinkStates(c.parent,n+".$links."+e,d.$links[o])})}c._setModel(o,!0)}return e.prototype.selecting=function(e,t){var n=this;if(n._schema.syncSelected)if(e)n._simulateSelecting=!0,n._savedSelectedUids=n._selectedUids.slice();else{var o=n._selectedPks.slice();n._selectedUids=[],n._selectedPks=[];var i={};n._savedSelectedUids.forEach(function(e){i[e]=!0});var r=null;n._schemaItems.primaryKey&&(r=a.pkFields(n._schemaItems.primaryKey),n.forEach(function(e){i[e.$id]?(e.internalSetSelected(!0),n._selectedUids.push(e.$id),r&&n._selectedPks.push(a.pk2Id(a.extractPkValue(e,r),r))):e.internalSetSelected(!1)},t),n._savedSelectedUids=null,n._simulateSelecting=!1,n._parent.execSyncAction(n.getJSONPatchPath()+".$selected",o.join(",")))}},Object.defineProperty(e.prototype,"simulateSelecting",{get:function(){return this._simulateSelecting},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$selected",{get:function(){var e=this;return e._parentSelected?e._parentSelected.$selected:this._selected},set:function(e){this._setSelected(e,!0)},enumerable:!0,configurable:!0}),e.prototype._setSelected=function(e,t){var n=this;if(n._parentSelected)n._parentSelected._setSelected(e,t);else if(n._selected!==e){var o=n._selected;n._selected=e,t&&n._parent&&!n.simulateSelecting&&(n._parent.notifyChanged(n._path+".$selected",o,n._selected,"propchange",{checkChildren:!0,instance:n._parent},!1),n._parent.notifyStateChanged(n._path+".$selected",{checkChildren:!0}))}},e.prototype.enumSelectedItems=function(e,t){},e.prototype.getJSONPatchPath=function(e){var t=this;return e=e?t.path+"."+e:t.path,t.parent.getJSONPatchPath(e)},e.prototype.getFullPath=function(){var e=this;return e.parent.getPropertyPath(e.path)},e.prototype._rmvSelected=function(e,t){var n=this;if(n._parentSelected)n._parentSelected._rmvSelected(e,t);else if(n._selected===e){var o=null,i=n._selected;n._schema&&n._schema.children&&n.enumSelectedItems(n._schema.children,function(e){o||(o=e)}),n._selected=o,t&&n._parent&&!n.simulateSelecting&&(n._parent.notifyChanged(n._path+".$selected",i,n._selected,"propchange",{checkChildren:!0,instance:n._parent},!1),n._parent.notifyStateChanged(n._path+".$selected",{checkChildren:!0}))}},e.prototype.pushSelected=function(e,t){var n=this,o=e.$id,i=n._selectedUids.indexOf(o);if(i<0&&n._selectedUids.push(o),n._schemaItems.primaryKey){var r=a.pkFields(n._schemaItems.primaryKey);o=a.pk2Id(a.extractPkValue(e,r),r),(i=n._selectedPks.indexOf(o))<0&&n._selectedPks.push(o)}n._setSelected(e,t)},e.prototype.model=function(e){return this._getModel(e)},e.prototype.schemaModel=function(){return this._model},e.prototype._getModel=function(e){var t=this;return t._model},e.prototype._initModelInParent=function(){var e=this;e._model||(e._model=[],e.isNull=!1,e.isUndefined=!1,e._parent&&(e._parent.model(!0)[e._path]=e._model))},e.prototype.removeSelected=function(e,t){var n=this,o=n._selectedUids.indexOf(e.$id);if(o>=0&&n._selectedUids.splice(o,1),n._schemaItems.primaryKey){var i=a.pkFields(n._schemaItems.primaryKey),r=a.pk2Id(a.extractPkValue(e,i),i);(o=n._selectedPks.indexOf(r))>=0&&n._selectedPks.splice(o,1)}n._rmvSelected(e,t)},e.prototype.notifyChangedProperty=function(e){var t=this;t._parent.notifyChanged(t._path,void 0,void 0,e,{instance:t._parent},!1)},e.prototype.addAjaxException=function(e){return this._parent.addAjaxException(e)},e.prototype.notifyPaginationChanged=function(){},e.prototype.notifyCountChanged=function(){this.notifyChangedProperty("count")},e.prototype.notifySortingChanged=function(){},e.prototype.isQueryable=function(){return this._queryable||!1},e.prototype.addErrors=function(e){var t=this,n=t._parent.$errors[t._path];n?n.addErrors(e):t._parent.addErrors(e)},e.prototype.addError=function(e){var t=this,n=[{severity:"error",message:e,id:l.allocUuid()}];t.addErrors(n)},e.prototype.rmvError=function(e){var t=this,n=t._parent.$errors[t._path];n?n.rmvError(e):t._parent.rmvError(e)},Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),e.prototype._destroyItems=function(){var e=this;e._selectedUids=[],e._items&&(e._model=void 0,e._items=[])},e.prototype.$orderby=function(e){return""},e.prototype.totalPages=function(){return 1},e.prototype.currentPage=function(e){return 0},e.prototype.totalCount=function(){return this._items.length},e.prototype.destroy=function(){var e=this;e._parent=null,e._arrayParent=null,e._parentSelected=null,e._destroyItems(),e.$links=null,e._selectedPks=null,e._model=null,e._schema=null,e._schemaItems=null,e._rootSchema=null},e.prototype._fillItems=function(){var e=this;e._model&&e._model.forEach(function(t,n){e._items.push(t)})},e.prototype._setModel=function(e,t){var n=this;n.isNull=null===e,n.isUndefined=void 0===e;var o=n.frozen;t&&(n.frozen=!0),n._destroyItems(),n._model=e,n._fillItems(),n.frozen=o},e.prototype.setModel=function(e){var t=this;t._setModel(e,!0),t._parent.notifyChanged(t._path,void 0,void 0,"propchange",{instance:t._parent,checkChildren:!0},!1),t.notifyCountChanged(),t._parent.notifyStateChanged(t._path,{checkChildren:!0}),t.afterSetModel()},e.prototype.afterSetModel=function(){this.$selected=null},e.prototype.indexOf=function(e){return this._items.indexOf(e)},e.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var o=e.split(","),i=o.length,r=0,a=this._items.length;r<a;r++){for(var s=!0,l=this._items[r],u=0;u<i;u++)if(t[u]!==l[o[u]]){s=!1;break}if(s)return l}return null},e.prototype._expandForEach=function(e,t,n,o,i){return this._items.forEach(function(r){e(r,o,n),o++;var a=l.getValue(r,t);a&&(a.$expand||i)&&(o=a._expandForEach(e,t,n+1,o,i))}),o},e.prototype.forEach=function(e,t,n){if(!t)return this._items.forEach(function(t,n){return e(t,n,0)});this._expandForEach(e,t,0,0,n)},e.prototype.get=function(e){return this._items[e]},Object.defineProperty(e.prototype,"$expand",{get:function(){return this._expanded},set:function(e){var n=this;if(n._expanded!==e){var o=n._parent[n._path+t.EXPANDED_FIELD_NAME];n._expanded=e;var i=n._parent[n._path+t.EXPANDED_FIELD_NAME];i!==o&&n._parent.notifyChanged(n._path+t.EXPANDED_FIELD_NAME,o,i,"propchange",{instance:n._parent},!0)}},enumerable:!0,configurable:!0}),e}();t.DataListCore=_;var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._fillItems=function(){var e=this,t=null;e._map={},e._selectedUids=[],e._selected&&(e.$selected=null),e._selectedPks.length&&(t=a.pkFields(e._schemaItems.primaryKey)),e._model&&e._model.forEach(function(n,o){e.isQuery&&n&&(n.$create=!1);var i=new P(e._schemaItems,e._parent,e._path,n,e,!1,e._locale,null),r=!1;if(e._items.push(i),e._map[i.$id]=i,t){var s=a.pk2Id(a.extractPkValue(n,t),t);e._selectedPks.lastIndexOf(s)>=0?(i.internalSetSelected(!0)&&(e.simulateSelecting||i.notifyChanged("$select",!1,!0,"propchange",{instance:i},!0)),r=!0):i.$select&&(r=!0)}else i.$select&&(r=!0);r&&e.pushSelected(i,!1)})},t.prototype._updateSelecting=function(e,t,n,o){var i=this;if(e)i._selectedUids.forEach(function(e){var t=i._map[e];t&&i.pushSelected(t,!0)});else if(i._selectedPks=[],i._selected=null,i._selectedUids.length){var r=i._selectedUids.slice(0);if(n.length||n.push(r.pop()),r.forEach(function(e){var t=i._map[e];t&&(t.$select=!1)}),n.length&&n[0]){var a=i._map[n[0]];n[0]=null,a&&i.pushSelected(a,!0)}}t&&i._items.forEach(function(o){var i=l.getValue(o,t);i&&i._updateSelecting(e,t,n,!1)},null)},t.prototype.clearSelection=function(e){var t=this;t.enumSelectedItems(e,function(n){t.selectItem(!1,n,!1,e,!1,!1)})},t.prototype.getSelectedItems=function(e){var t=this,n=[];if(t._schemaItems.primaryKey){var o=a.pkFields(t._schemaItems.primaryKey);t.enumSelectedItems(e,function(e){var t=a.pk2Id(a.extractPkValue(e,o),o);n.push(t)})}return n},t.prototype.setSelectedItems=function(e){var t=this;if(t._schemaItems.primaryKey){var n=a.pkFields(t._schemaItems.primaryKey);t.enumSelectedItems("",function(o){var i=a.pk2Id(a.extractPkValue(o,n),n),r=e.indexOf(i);r<0?t.selectItem(!1,o,!1,"",!1,!1):e.splice(r,1)}),e.forEach(function(e){var o=a.findByPk(e,n,t._items);o&&t.selectItem(!0,o,!0,"",!1,!1)})}},t.prototype.updateSelecting=function(e,t){this._updateSelecting(e,t,[],!0)},t.prototype.enumSelectedItems=function(e,t){this._enumSelected(e,function(e,n){n&&t(n)})},t.prototype._enumChildren=function(e,t){var n=this;e&&n._items.forEach(function(n){t(n);var o=n[e];o&&o._enumChildren(e,t)})},t.prototype._enumSelected=function(e,t){var n=this;if(e)n._enumSelected(null,t),n._items.forEach(function(n){var o=l.getValue(n,e);o&&o.length&&o._enumSelected(e,t)});else{var o=n._selectedUids.slice(0);if(!o.length)return;t(n,null),o.forEach(function(e){var o=n._map[e];o&&t(n,o)})}},t.prototype.selectItem=function(e,t,n,o,i,r){var a=this;if(t)if(e){if(!t.$select)if(n)t.$select=!0,o&&i&&(u=l.getValue(t,o))&&u._enumChildren(o,function(e){e.$select=!0});else{var s=[];a._enumSelected(o,function(e,t){e&&!t?(e._selectedUids=[],e._selectedPks=[]):t.internalSetSelected(!1)&&s.push({item:t,value:!1})}),t.internalSetSelected(!0)&&s.push({item:t,value:!0}),(d=t._arrayParent)&&d.pushSelected(t,!0),s.forEach(function(e){a.simulateSelecting||e.item.notifyChanged("$select",!e.value,e.value,"propchange",{instance:e.item},!0)})}}else if(t.$select)if(n){if(t.$select=!1,o&&i){var u=l.getValue(t,o);u&&u._enumChildren(o,function(e){e.$select=!1})}}else{var c=t.internalSetSelected(!1,!0),d=t._arrayParent;d&&a.removeSelected(t,!0),c&&(a.simulateSelecting||t.notifyChanged("$select",!0,!1,"propchange",{instance:t},!0))}},t.prototype.canDoNext=function(){var e=this,t=e.totalPages();return e.currentPage()<t},t.prototype.canDoPrev=function(){return this.currentPage()>1},t.prototype.moveSelected=function(e,t){var n=this,o=null;if(n.enumSelectedItems("",function(e){o||(o=e)}),o){var i=n._items.indexOf(o),r=Math.max(0,Math.min(i+e,n._items.length-1));if(t&&r!==i+e){if(e>0&&n.canDoNext())return void n.currentPage(n.currentPage()+1);if(e<0&&n.canDoPrev())return void n.currentPage(n.currentPage()-1)}var a=n._items[r];a!==o&&n.selectItem(!0,a,!1,"",!1,!0)}},t.prototype.sortByKey=function(e,t){var n=this;if(e&&e.length&&n._model&&n._model.length){var o={},i={};n._model.forEach(function(e,r){o[e[t]]=e,i[e[t]]=n._items[r]}),n._model.splice(0,n._model.length),n._items.splice(0,n._items.length),e.forEach(function(e,t){n._model.push(o[e]),n._items.push(i[e])}),n._parent.notifyChanged(n._path,void 0,void 0,"propchange",{instance:n._parent,checkChildren:!0},!1)}},t.prototype.findById=function(e){return this._map[e]},t.prototype.indexOf=function(e){var t=this;return"object"!=typeof e&&(e=t.findById(e)),e?t._items.indexOf(e):null},t.prototype.$orderby=function(e){var t=this,n=t.parent.$states[t.path];return void 0===e?n.orderBy:(n.orderBy=e,n.orderBy)},t.prototype.$filter=function(e){var t=this,n=t.parent.$states[t.path];return void 0===e?n.filter:(n.filter=e,n.filter)},t}(_);t.DataListBase=b;var x=function(e){function n(n,o,i,r,a,l,u,c,d,p,f){var m=e.call(this,o,i,r,a,p,f,!0,null)||this,h=m,v=h._parent.getRootModel(),g=s.dsConfig(v.datasets,o,!0);if(v.design&&(g={$type:"odata",$params:{$entity:"EntityIsMissing"},$autoOpen:!1}),!g)throw'Invalid config! You must define a dataset in form for the property: "'+r+'".';return h.allData=d,h._main=g.$main,h._queryable=!0,void 0===l&&(l=g.$params.$top||20),h._query=new t.QueryableDataSource(g,h),h._query.initPagination(l,u,c),h._main&&v&&(v.onRefresh=function(e){var t=e&&e.resetPagination;return h.$refresh(t)}),m}return __extends(n,e),Object.defineProperty(n.prototype,"filter",{get:function(){return this._query.filter},set:function(e){this._query.filter=e,this.notifyChangedProperty("filter")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"searchFields",{get:function(){return this._query.searchFields},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"searchField",{set:function(e){this._query.searchFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"search",{get:function(){return this._query.search},set:function(e){this._query.search=e},enumerable:!0,configurable:!0}),n.prototype.totalPages=function(){return this._query.totalPages()},n.prototype.totalCount=function(){return this._query.totalCount()},n.prototype.$refresh=function(e){return this._query.refresh(e,!0)},n.prototype.$orderby=function(e){return this._query.orderBy(e)},n.prototype.notifyPaginationChanged=function(){this.notifyChangedProperty("pagination")},n.prototype.notifyFilterChanged=function(){this.notifyChangedProperty("filter")},n.prototype.notifySortingChanged=function(){this.notifyChangedProperty("sorting")},n.prototype.currentPage=function(e){return void 0!=e?this._query.currentPage(e):this._query.currentPage()},n.prototype._removeItem=function(e,t){var n=this;if(n._query){var o=n._query.remove(e,t);o.then&&o.then(function(){n.$refresh(!(n._items.length>1)).then(function(){})})}},n.prototype.remove=function(e){var t=this,n=e.model(!0),o=(e.$select,n?n["@odata.etag"]:null);if(t._schemaItems&&t._schemaItems.primaryKey){var i=a.odataId(a.pkFields(t._schemaItems.primaryKey),e);if(t._schemaItems.links&&t._schemaItems.links.$remove&&t._schemaItems.links.$remove.confirm){var r=t._schemaItems.links.$remove.confirm;t._locale&&(r=p.tt(r||"",t._locale)),l.confirm(null,r,function(){t._removeItem(i,o)})}else t._removeItem(i,o)}},n.prototype.destroy=function(){var t=this;if(t.allData=null,t._query&&(t._query.destroy(),t._query=null),t._main){var n=t._parent.getRootModel();n&&(n.onRefresh=null)}e.prototype.destroy.call(this)},n}(b);t.QueryList=x;var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this),this._selectedPks=[]},t.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var o=e.split(","),i=o.length,r=0,a=this._items.length;r<a;r++){for(var s=!0,l=this._items[r],u=0;u<i;u++)if(t[u]!==l[o[u]]){s=!1;break}if(s)return l}return null},t}(b);t.CompositionList=C;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this),this._selectedPks=[]},t}(_);t.SimpleCompositionList=k;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.push=function(e){var t=this;t._initModelInParent(),t._model.push(e),t._items.push(e),t._parent.notifyChanged(t._path,void 0,e,"add",{$index:t._items.length-1,$value:e,$id:e,instance:t._parent},!1),t.notifyCountChanged()},t.prototype.splice=function(e,t,n){if(t>0)throw"Delete count is not supported.";var o=this;o._model&&(n.$create=!0,o._model.splice(e,t,n),o._items.splice(e,t,n),o._parent.notifyChanged(o._path,void 0,n,"add",{method:!0,change:!0,$index:e,$value:n,$id:n,instance:o._parent},!1),o.notifyCountChanged())},t.prototype.remove=function(e){var t=this,n=t._items.indexOf(e);n>=0&&(t._items.splice(n,1),t._model.splice(n,1),t._parent.notifyChanged(t._path,void 0,e,"remove",{method:!0,change:!0,$index:n,$value:e,$id:e,instance:t._parent},!1),t.notifyCountChanged())},t}(k);t.SimpleTypeList=w;var E=function(e){function t(t,n,o,i,r,a,s){var l=e.call(this,t,n,o,i,r,a,!1,s)||this;return l._createNewItem(!1,!0),l}return __extends(t,e),t.prototype._initNew=function(){var e=this,t={$create:!0};e._new=new P(e._schemaItems,e._parent,e._path+".$new",t,null,!0,e._locale,null),e._new.notifyChanged("",void 0,t,"propchange",{instance:e._new,checkChildren:!0},!1),e._new.notifyStateChanged("",{checkChildren:!0})},Object.defineProperty(t.prototype,"filter",{get:function(){var e=this.$filter();return e?JSON.parse(e):null},set:function(e){var t=this,n=e?JSON.stringify(e):"";n!==(t.$filter()||"")&&(t.parent.execSyncAction(t.getJSONPatchPath()+".$filter",n,n)||t.$filter(n))},enumerable:!0,configurable:!0}),t.prototype._createNewItem=function(e,t){var n=this;t&&Object.defineProperty(n,"$new",{get:function(){var e=this;return e._new||e._initNew(),e._new},set:function(e){var t=this;t._new||t._initNew(),t._new._setModel(e,!0),t._new.notifyChanged("",void 0,e,"propchange",{instance:t._new}),t._new.notifyStateChanged("",{checkChildren:!0})},enumerable:!0}),e&&!n._new&&n._initNew()},t.prototype.updateItem=function(e,t){var n=this;if(!t.validate())return!1;t.$errors.$.addErrors([],!1);var o=t._getModel(!0);if(n._schemaItems.primaryKey){var i=a.pkFields(n._schemaItems.primaryKey),r=a.extractPkValue(o,i),s=(a.extractPkValue(e._getModel(!0),i),a.findByPk(r,i,n._items));if(s&&s!==e){var u=i.length>1?f.uniqueColumns:f.uniqueColumn;return t.$errors.$.addErrors([{code:"duplicate_value",message:l.format(u,i.join(", "))}],!1),!1}}return!0},t.prototype.addNew=function(){var e=this;if(e._new&&e._new.validate()){var t=e._new._getModel(!1,!0);if(e._schemaItems.primaryKey){var n=a.pkFields(e._schemaItems.primaryKey),o=a.extractPkValue(t,n),i=a.findByPk(o,n,e._items);if(e._parent.$errors[e._path].addErrors([],!1),i){var r=n.length>1?f.uniqueColumns:f.uniqueColumn;return void e._parent.$errors[e._path].addErrors([{code:"duplicate_value",message:l.format(r,n.join(", "))}],!1)}}else e._parent.$errors[e._path].addErrors([],!1);e._destroyNew(),e.push(t),e._createNewItem(!0,!1)}},t.prototype._destroyNew=function(){var e=this;e._new&&(e._new.destroy(),e._new=null)},t.prototype.destroy=function(){this._destroyNew(),e.prototype.destroy.call(this)},t.prototype.push=function(e){var t=this;e.$create=!0,e.$select&&e.$create&&t.clearSelection(),t._initModelInParent(),t.splice(-1,0,e)},t.prototype.splice=function(e,t,n){if(t>0)throw"Delete count is not supported.";var o=this,i=o.frozen;o.frozen=!0;var r=e<0;r?(o._initModelInParent(),o._model.push(n)):o._model.splice(e,t,n);var a=new P(o._schemaItems,o._parent,o._path,n,o,!1,o._locale,null);r?o._items.push(a):o._items.splice(e,t,a),o.frozen=i,o._map[a.$id]=a,a.$select&&o.pushSelected(a,!0),o._parent.notifyChanged(o._path,void 0,n,"add",{method:!0,change:!0,$index:r?o._items.length-1:e,$id:a.$id,$value:a,source:o._parent.getPropertyPath(o._path),instance:o._parent},!1),a.notifyStateChanged("",{checkChildren:!0})},t.prototype.remove=function(e){var t,n=this,o=null,i=n.frozen;if(n._model){n.frozen=!0;var r=n._items.indexOf(e),a=e.$id;if(r>=0&&(o=e.model(),t=!0,n._items.splice(r,1),n._model.splice(r,1),i||(n.frozen=i),n.removeSelected(e,!1),n.frozen=!0,e.destroy()),n.frozen=i,delete n._map[a],t){n._parent.notifyChanged(n._path,void 0,e,"remove",{mmethod:!0,change:!0,$index:r,$value:o,$id:a,instance:n._parent},!1);var s=(n._path?n._path+".":"")+"$item";n._parent.notifyStateChanged(s,{})}}},t}(C);t.DataList=E;var P=function(){function n(e,t,n,o,i,s,u,c,d,p){var f=this;f._rootParent=t?t._rootParent:f;var m=[];if(t){var h=t.getPropertyPath();h&&m.push(h)}n&&m.push(n),i&&m.push("$item"),f._fullPath=m.join("."),f.design=p,f.$id=l.allocID(),f.$create=!1,f._initialized={},f._selected=!(!o||!o.$select),f._model={},f.datasets=c,f.transform=d,f.$states={},f.$errors={},f.$links={},f._path=n,f._locale=u,f._parent=t,f._schema=a.expand$Ref(e,f._rootParent._schema),f.className=f._schema.name,f._parent||(f._validators=[{name:"schema",active:!0}]),f._arrayParent=i,f._children={},f._initFromSchema(e),f._parent&&!s||(f.frozen=!0),f===f._rootParent&&(f._rootParent.$create=!!o&&(o.$create||!1)),f._setModel(o,!0),f.frozen=!1,f._parent||(f.notifyChanged("*",void 0,o,"propchange",{source:""},!1),f.notifyStateChanged("*",{checkChildren:!0})),r.execInitRules(f)}return Object.defineProperty(n.prototype,"fullPath",{get:function(){return this._fullPath},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"owner",{get:function(){var e=this;return e._arrayParent?e._arrayParent:e._parent},enumerable:!0,configurable:!0}),n.prototype.getJSONPatchPath=function(e){var t=this;return t.parent?t._arrayParent?t._arrayParent.getJSONPatchPath(t._model.id+(e?"."+e:"")):t.parent.getJSONPatchPath(e?e+"."+t._path:t._path):e},n.prototype.getPropertyPath=function(e,t){var n=this;if(void 0===e)return n._fullPath;var o=n._fullPath;if(t&&n._fullPath){for(var i=n._fullPath.split("."),r=i.length-1;r>0&&i[r-1]===t&&"$selected"===i[r];)i.pop(),i.pop(),r-=2;o=i.join(".")}return o?o+"."+e:e},n.prototype.saveModel=function(){var e=this;e._origModel=a.copyModel(e._schema,e._model)},Object.defineProperty(n.prototype,"$schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._rootParent},enumerable:!0,configurable:!0}),n.prototype.setModel=function(e){var t=this;t._destroyObject(t,"_children"),t._children={},t.frozen=!0,t._setModel(e,!1),t.frozen=!1,t._parent||(t.notifyChanged("*",void 0,e,"propchange",{sourve:""},!1),t.notifyStateChanged("*",{checkChildren:!0}))},n.prototype.update=function(e){var t=this;if(e){var n=Object.keys(t._schema.properties),o=t._rootParent._schema;n.forEach(function(n){var i=t._schema.properties[n];if(a.inModel(i,o))if(a.isCompositionRef(i,o))t[n];else a.isCompositionList(i,o,!1)?t[n]=e[n]:a.isSimpleList(i,o)?t[n]=e[n]:(a.isList(i,o),t[n]=e[n])})}},n.prototype.$refresh=function(e){var t=this;return t._parent?l.Promise.resolve():t.onRefresh?t.onRefresh(e):new l.Promise(function(e,n){s.loadMainData({datasets:t.datasets,transform:t.transform,context:t._parent.model(!0)},!1).then(function(n){t.update(n),e()}).catch(function(e){t.addAjaxException(e),n()})})},n.prototype.clearErrors=function(e){var t=this;if(t.$errors&&Object.keys(t.$errors).forEach(function(e){t.$errors[e].clear(!0)}),e){var n=t._rootParent.$schema;Object.keys(t._schema.properties).forEach(function(o){var i=t._schema.properties[o];if(a.inModel(i,n))if(a.isCompositionRef(i,n)){var r=t[o];r&&r.clearErrors(e)}else if(a.isCompositionList(i,n,!1)){var s=t[o];s&&s.forEach(function(t){t.clearErrors(e)})}})}},n.prototype._validate=function(t,n,o){var i=this;if(i.clearErrors(!1),!t||!t.length)return!0;var s=Object.keys(i._schema.properties),u=!1,c=i._rootParent._schema;return n&&r.execBeforeSaveRules(i),s.forEach(function(r){var s=i._schema.properties[r],d=!1;if(a.inModel(s,c)){var p=i.$states[s.$stateProperty||r];if(!p.isHidden&&!p.isDisabled){if(o&&o.indexOf(r)<0)return!1;if(a.isCompositionRef(s,c)){var m=i[r];m?m._validate(t,n)||(u=!0):p.isMandatory&&(i.$errors[r].addErrors([{message:l.format(f.required,a._title(s.title,e.locale))}],!1),u=!0)}else if(a.isCompositionList(s,c,!1)){var h=i[r];h&&(h.forEach(function(e){e._validate(t,n)||(u=!0)}),d=!0)}else d=!0;d&&(i._execValidators(t,r,"validate",{},{base:i,state:p,schema:s,value:i[r]})||(u=!0))}}}),r.execValidationRules(i,o)&&(u=!0),i._parent||i._execValidators(t,"","validate",{},{base:i,state:null,schema:i._schema,value:null})||(u=!0),!u},n.prototype.isRecursiveRule=function(e){var t=this,n=t.getRootModel();if(n.callStack){var o=t.getPropertyPath(e);return n.callStack.indexOf(o)>=0&&(l.logRule(n.callStack.length,"Recursive rule detected: property: "+o+" - last rule canceled.",o,""),!0)}},n.prototype.validate=function(e){var t=this,n=t.getRootModel();return t._validate(n._validators,e)},n.prototype.partialValidate=function(e){var t=this,n=t.getRootModel();return t._validate(n._validators,!1,e)},Object.defineProperty(n.prototype,"$select",{get:function(){return this._selected},set:function(e){var t=this;t.internalSetSelected(e)&&t._arrayParent&&(t._selected?t._arrayParent.pushSelected(t,!0):t._arrayParent.removeSelected(t,!0),t._arrayParent.simulateSelecting||t.notifyChanged("$select",!e,e,"propchange",{source:t.getPropertyPath("$select"),instance:t},!0))},enumerable:!0,configurable:!0}),n.prototype.select=function(e,t,n,o,i){var r=this;t?r._arrayParent&&r._arrayParent.selectItem(e,r,t,o,i,!0):o?n.selectItem(e,r,!1,o,i,!0):r._arrayParent&&r._arrayParent.selectItem(e,r,!1,null,!1,!0)},n.prototype.toggleExpand=function(e){var t=this,n=!1;if(!e)return n;var o=l.getValue(t,e);return o&&(o.$expand=!o.$expand,n=o.$expand),n},n.prototype.enumVisibleChildren=function(e,t,n,o){var i=this,r=l.getValue(i,e);r&&(r.$expand||n)&&r._items.forEach(function(n){o(n,t+1),n.enumVisibleChildren(e,t+1,!1,o)})},n.prototype.internalSetSelected=function(e){var t=this;return t._selected!==e&&(t._selected=e,!0)},Object.defineProperty(n.prototype,"$index",{get:function(){var e=this;return e._arrayParent?Math.max(e._arrayParent.indexOf(e),0)+1:0},enumerable:!0,configurable:!0}),n.prototype.getJsonPachDelta=function(e){var t=this,n=t.model(!1),o=u.compare(t._origModel,n,e);return o&&o.length?(t._origModel=n,o):null},n.prototype.applyJsonPachDelta=function(e){var t=this;if(e&&e.length){t._updating=!0;try{e.forEach(function(e){var n=y.getJSONPatchParent(e.path,t);if(1!==n.type){var o=n.value;if(o.isArray&&0===n.type)if("add"===e.op)o.push(e.value);else if("remove"===e.op){var i=o.find("id",y._segment2Id(n.lastSegment));i&&o.remove(i)}else"sort"===e.op&&o.sortByKey(e.value,"id");else if(3===n.type)if("$errors"===n.lastSegment)e.value?Object.keys(e.value).forEach(function(t){var n=o.$errors[t];n&&(n.clear("remove"===e.op),"remove"!==e.op&&n.addErrors(e.value[t]))}):o.clearErrors(!0);else if(o.isArray&&!n.lastSegment)"add"===e.op&&o.addErrors([e.value]);else{var r=o[n.lastSegment];r&&("remove"===e.op?r.clear(!0):r.addErrors(e.value))}else n.type,"remove"===e.op?o[n.lastSegment]=void 0:o[n.lastSegment]=e.value}else n.value&&(n.value[n.lastSegment]=e.value)})}finally{var n=t.model(!1);t._origModel=n,t._updating=!1}}},n.prototype.$save=function(){var e=this;if(e.getRootModel()!==e)return l.Promise.reject(null);if(!e.validate(!0))return l.Promise.reject(null);var t=s.extractMainDataSource(e);if(t&&s.isCreateOrUpdate(t)){var n=e.model(!1);if(e.$create)t.$method="POST",delete t.$params.$entityId;else{if(t.$method="PATCH",!e._schema.primaryKey)return e.addError("Primary key is missing. Check schema."),l.Promise.reject(null);var i=void 0;if(o.useJSONPatch){var r=a.pkFields(e._schema.primaryKey),c=a.extractPkValue(n,r);if(t.$params.$entityId=a.entityId(c),!(i=u.compare(e._origModel,n,{useId:!0}))||!i.length)return l.Promise.resolve(n)}else if(!(i=l.deltaPatch(e._origModel,n)))return l.Promise.resolve(n);n=i}return new l.Promise(function(o,i){s.datasetAsPromise(t,n).then(function(t){e.$create=!1,o()}).catch(function(t){e.addAjaxException(t),i(null)})})}return l.Promise.reject(null)},n.prototype.getRootModel=function(){return this._rootParent},n.prototype.addValidator=function(e,t){this.getRootModel()._validators.push({name:e,active:t})},n.prototype.activateValidator=function(e,t){for(var n=this.getRootModel(),o=0,i=n._validators.length;o<i;o++){var r=n._validators[o];if(r.name===e){r.active=t;break}}},n.prototype.hasValidators=function(){var e=this.getRootModel();if(e._validators.length){if(1==e._validators.length)return e._validators[0].active;for(var t=0,n=e._validators.length;t<n;t++)if(e._validators[t].active)return!0}return!1},n.prototype.getParentOf=function(e,n){return this.getValue(t.SchemaUtils.parentPath(e),n)},n.prototype.setValue=function(e,t,n){var o=this,i=e.split("."),r=n?i.lastIndexOf("$item"):-1,a=n?i.lastIndexOf("$selected"):-1;r>0?o=a>0&&a>r?n[i.slice(0,a+1).join(".")]:n[i.slice(0,r+1).join(".")]:a>0&&(o=n[i.slice(0,a+1).join(".")]);for(var s=Math.max(Math.max(r+1,a+1),0),l=i.length;s<l&&o;s++)s===l-1?o[i[s]]=t:o=o[i[s]]},n.prototype._getModel=function(e,t){var n=this;if(e)return n._model;var o=n.getRootModel(),i=o?o._schema:n._schema;return a.copyModel(n._schema,n._model,i,t)},n.prototype.schemaModel=function(e){var t=this,n=t.getRootModel(),o=n?n._schema:t._schema;return a.copyModel(t._schema,t._model,o,!0,e)},n.prototype.model=function(e){return this._getModel(e)},n.prototype.getRelativeValue=function(e){return this.getValue(e,{})},n.prototype.getRelativeState=function(e){return this.getState(e,{})},n.prototype.getValueInfo=function(e,t){var n=this;if(!e)return{value:n,parentIsNull:!1};var o=n,i=e.split("."),r=t?i.lastIndexOf("$item"):-1,a=t?i.lastIndexOf("$selected"):-1;r>0?o=a>0&&a>r?t[i.slice(0,a+1).join(".")]:t[i.slice(0,r+1).join(".")]:a>0&&(o=t[i.slice(0,a+1).join(".")]);for(var s=Math.max(Math.max(r+1,a+1),0),l=i.length;s<l&&o;s++)o=o[i[s]];return{value:o,parentIsNull:!1}},n.prototype.getValue=function(e,t){return this.getValueInfo(e,t).value},n.prototype.getSchema=function(e){var t=this;return a.getSchema(e,t._schema,t._rootParent._schema,!1)},n.prototype.getState=function(e,n){var o=this;if(!e)return{value:o,parentIsNull:!1};var i,r=o,s=e.split("."),l=s.pop(),u=l,c={},d=!1,p=s.length-1;if(a.isMetaProp(l)){var f=a.getSchema(e,o._schema,o._rootParent._schema,!1);f&&f.$stateProperty&&(l=f.$stateProperty)}var m=n?s.lastIndexOf("$item"):-1,h=n?s.lastIndexOf("$selected"):-1;m>0?r=h>0&&h>m?n[s.slice(0,h+1).join(".")]:n[s.slice(0,m+1).join(".")]:h>0&&(r=n[s.slice(0,h+1).join(".")]);for(var v=Math.max(Math.max(m+1,h+1),0),g=s.length;v<g;v++){var y=s[v];if(v===p&&"$links"===y){d=!0;break}if(r=r[y],i=r&&r.$states&&r.$states[y]?r.$states[y].state():null,(!r||r.isNull||r.isUndefined)&&(c.isDisabled=!0),i&&i.isHidden&&(c.isHidden=!0),i&&i.isDisabled&&(c.isDisabled=!0),i&&i.isReadOnly&&(c.isReadOnly=!0),!r)break}var _={};if(!d){if(l===t.SELECTED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!1,isHidden:!1};if(l===t.INDEX_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1};if(l===t.EXPANDED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1}}if(r){var b="$states";d&&(b="$links");var x=r[b]?r[b][l]:null;x&&(_=x.state(),!d&&r.$errors&&r.$errors[u]&&(_.errors=r.$errors[u].errors()))}return $.extend({},_,c)},n.prototype._setPropErrors=function(e,t){var n=this;if(t.$errors&&t.$errors[e]&&n.$errors[e]){var o=[];t.$errors[e].forEach(function(e){o.push(e)}),n.$errors[e].addErrors(o)}n.$errors[e]&&(t.$errors[e]=n.$errors[e].errors())},n.prototype._setModel=function(e,t){var n=this,o=n.frozen;t&&(n.frozen=!0),n.isNull=null===e,n.isUndefined=void 0===e;var i=void 0!==(e=e||{}).$create?e.$create:!!n._parent&&n._parent.$create;e&&(e=a.init(n._schema,n._rootParent._schema,null,e,i,{select:n._schema===n._rootParent._schema}),n.$create=e.$create,delete e.$create),e.$states=e.$states||{},e.$links=e.$links||{},e.$errors=e.$errors||{};var r=Object.keys(n._schema.properties),s=n._rootParent._schema;n._model.$links=e.$links,r.forEach(function(t){var o=n._schema.properties[t];if(a.inModel(o,s)){var i=a.isMetaProp(t),r=e[t];if(r||!a.isCompositionList(o,s,!1)&&!a.isList(o,s)||(e[t]=r),a.isList(o,s)?n._setQueryListChild(t,r,e.pageSize,e.pageSize?Math.round(e.skip/e.pageSize)+1:0,e.count,e._origData):n[t]=r,!i){if(e.$states&&e.$states[t]){var l=e.$states[t];Object.keys(l).forEach(function(e){n.$states[t][e]=l[e]})}e.$states[t]=n.$states[t].state()}n._setPropErrors(t,e)}}),n._setPropErrors("$",e),e.$links&&(r=Object.keys(n._schema.links||{})).forEach(function(t){var o=e.$links[t],i=n.$links[t];o&&Object.keys(o).forEach(function(e){i[e]=o[e]}),e.$links[t]=n.$links[t].state()}),n._model=e,n.frozen=o},n.prototype._setRefChild=function(e,t,o){var i=this,r=i.frozen;i.frozen=!0,i._children[e]?i._children[e]._setModel(o,!0):i._children[e]=new n(i._schema.properties[e],i,e,o,null,!0,i._locale,null),i.frozen=r},n.prototype._setListChild=function(e,t,n){var o=this,i=o.frozen;if(o.frozen=!0,o._children[e])o._children[e]._setModel(n,!0);else{var r=null;o._arrayParent&&o._arrayParent.schema.children===e&&(r=o._arrayParent),o._children[e]=new E(o._schema.properties[e],o,e,n,null,o._locale,r)}o.frozen=i},n.prototype._setSimpleListChild=function(e,t,n){var o=this,i=o.frozen;o.frozen=!0,o._children[e]?o._children[e]._setModel(n,!0):o._children[e]=new w(o._schema.properties[e],o,e,n,null,o._locale,!1,null),o.frozen=i},n.prototype._setQueryListChild=function(e,t,n,o,i,r){var a=this,s=a.frozen;a.frozen=!0,a._children[e]&&a._children[e].destroy(),a._children[e]=new x(a._schema,a._schema.properties[e],a,e,t,n,o,i,r,null,a._locale),a.frozen=s,a.notifyChanged(e,null,t,"propchange",{instance:a},!0),a.notifyStateChanged(e,{checkChildren:!0})},n.prototype._initFromSchema=function(t){var n=this;if(n._model){var o=t.states?$.extend(!0,{},t.states):null,r=t.links?$.extend(!0,{},t.links):null,s=t.errors?$.extend(!0,{},t.errors):null,l=!1,u=Object.keys(t.properties);u.forEach(function(n){if(!a.isMetaProp(n)){var o=t.properties[n];if("password"===o.format){if(!o.capabilities||!o.capabilities.noConfirming){var i="$$"+n;o.$meta=i;var r=t.properties[i];r||((r=$.extend(!0,{},o)).title=e.locale.ui.Confirm,r.$stateProperty=n,t.properties[i]=r,l=!0)}}else"rate"===o.format&&(o.exclusiveMinimum=!0,o.exclusiveMaximum=!0,void 0===o.decimals&&(o.decimals=a.RATE_DECIMALS),void 0===o.maximum&&(o.maximum=a.RATE_MAXIMUM),void 0===o.minimum&&(o.minimum=-a.RATE_MAXIMUM),void 0===o.symbol&&(o.symbol=a.RATE_SYMBOL))}}),l&&(u=Object.keys(t.properties)),u.forEach(function(e){m(n,e),a.isMetaProp(e)||h(n,e,o?o[e]:null),v(n,e,s?s[e]:null)}),t.links&&Object.keys(t.links).forEach(function(e){g(n,e,r?r[e]:null)}),n._parent&&!n._arrayParent||(n.$errors.$=new i.Errors(n,"$",[]))}},n.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),y.getValue(t.join("."),this)},n.prototype.addAjaxException=function(e){var t=this;if(t._parent)return t._parent.addAjaxException(e);var n=c.extractAjaxErrors(e),o=[],i=null;n.message&&(i={message:n.message,details:[]},o.push(i)),n.list&&n.list.length&&n.list.forEach(function(e){var n=!0;if(e.target){var r=t.getParentModel(e.target);if(r){var s=a.lastSegment(e.target,null);r.hasOwnProperty(s)&&(n=!1,r.$errors[s].addError(e.message))}}n&&(i?i.details.push({message:e.message}):o.push({message:e.message}))}),t.$errors.$.addErrors(o)},n.prototype.addError=function(e){var t=this,n=[{severity:"error",message:e,id:l.allocUuid()}];t.addErrors(n)},n.prototype.rmvError=function(e){var t=this;t.$errors.$?t.$errors.$.rmvError(e):t._parent&&t._parent.rmvError(e)},n.prototype.addErrors=function(e){var t=this;t.$errors.$?t.$errors.$.addErrors(e):t._parent&&t._parent.addErrors(e)},n.prototype._beforeChange=function(e,t,n,o,i,r){var s=this,l={continue:!0,value:i};return a.isNumber(n)&&!isNaN(i)&&null!==i&&void 0!==i&&s.$states[t]&&void 0!==s.$states[t].decimals&&(l.value=parseFloat(i.toFixed(s.$states[t].decimals)),r||o!==l.value||(l.continue=!1)),l.continue&&n.ux&&n.emitChanging&&(l.continue=e.notifyBeforeChanged(t,o,i,{})),l},n.prototype.notifyStateChanged=function(e,t){var n=this;n.frozen||n._arrayParent&&n._arrayParent.frozen||(n!==n._rootParent?(t.fromChildren=!0,n._getPaths(t).forEach(function(o,i){var r=o;e&&(r=r?r+"."+e:e),t.change=0===i,n._rootParent.notifyStateChanged(r,t)})):(t.fromChildren||(t.change=!0),l.logModule("proxydata")&&l.log("State changed: "+n._extractPropName(e||"",t),"proxydata"),n.onstatechanged&&n.onstatechanged(e,t)))},n.prototype._extractPropName=function(e,t){return Object.keys(t).sort().reverse().forEach(function(n){var o=t[n];o&&void 0!==o.$index&&(e=e.replace(n,n+"["+o.$index+"]"))}),e},n.prototype._execValidators=function(e,t,n,o,i){var r=this,s=!1;if(t){if(!i){var l=r.getValueInfo(t,o);if(void 0===l.value&&l.parentIsNull)return!s}}else if("validate"!==n)return!s;return e.forEach(function(e){e.active&&(e.hnd||(e.hnd=a.getValidator(e.name)),e.hnd&&(e.hnd(n,r,{name:t,params:o,locale:r._locale},i)||(s=!0)))}),!s},n.prototype.notifyBeforeChanged=function(e,t,n,o){var i=this;if(!(i.frozen||i._arrayParent&&i._arrayParent.frozen)){if(i===i._rootParent)return o.fromChildren||(o.change=!0),o.continue=!0,i.onchange&&o.change&&i.onchange(e,t,n,"beforeChange",o),o.continue;o.fromChildren=!0;var r=!0;i._getPaths(o).forEach(function(a,s){var l=a;e&&(l=l?l+"."+e:e),o.change=0===s,r=r&&i._rootParent.notifyBeforeChanged(l,t,n,o)})}},n.prototype._getSelectedParentArray=function(e){for(var t=this,n=t._arrayParent,o=t._arrayParent.path+".$item";;){if(!n.schema.children||n.schema.children!==n.path||!n.parent._arrayParent)break;o=(n=n.parent._arrayParent).path+".$item."+o}return e?{path:o,value:n}:n},n.prototype._getPaths=function(e){var t=this;if(t._arrayParent){var n=t._getSelectedParentArray(!0),o=n.value,i=o.parent._getPaths(e),r=null;return o.$selected===t&&(r=[],i.forEach(function(n,i){if(n.indexOf(".$selected.")>0||n.indexOf(".$item.")<0){var a=(n?n+".":"")+o.path+".$selected";r.push(a),e[a]=t}})),i.forEach(function(o,r){i[r]=(o?o+".":"")+n.path,e[i[r]]=t}),r?i.concat(r):i}if(!t.parent)return[""];var a=t.parent._getPaths(e);return a.forEach(function(e,n){a[n]=e?e+"."+t._path:t._path}),a},n.prototype.notifyChanged=function(e,t,n,o,i,a){var s=this;s.frozen||s._arrayParent&&s._arrayParent.frozen||(s!==s._rootParent?(i.fromChildren=!1,s._getPaths(i).forEach(function(r,l){var u=r;e&&(u=u?u+"."+e:e),i.change=0===l,s._rootParent.notifyChanged(u,t,n,o,i,a)})):(i.fromChildren||(i.change=!0),l.logModule("proxydata")&&l.log("Changed: "+s._extractPropName(e||"",i)+", operation = "+o,"proxydata"),s.onchange&&s.onchange(e,t,n,o,i),!s._updating&&a&&s._validators&&i.change&&s.hasValidators()&&s._execValidators(s._validators,e,"propchanged",i),!s._updating&&i.change&&(r.execPropChangeRules(s,e,i,{validations:!0,propagations:!0}),s.onsync&&s.onsync(null))))},n.prototype.execSyncAction=function(e,t,n){var o=this._rootParent;if(o.onsync&&(!n||!n.$nosync)){var i=o.syncAction(e,t);if(i)return o.onsync(i),!0}return!1},n.prototype.syncAction=function(e,t){var n=this,o=e.split(".");if("$sort"===o[o.length-1])return{op:"replace",path:"/"+o.join("/"),params:t};if("$filter"===o[o.length-1])return{op:t?"replace":"remove",path:"/"+o.join("/"),params:t};if("$selected"===o[o.length-1])return{op:"replace",path:"/"+o.join("/"),params:t,delayed:!0};var i=e.indexOf("$links.");if(i<0)return null;var r="";i>0&&(r=e.substr(0,i-1));var a=e.substr(i+"$links.".length),s=n.getSchema(r);if(s.links&&s.links[a]&&s.links[a].ux)return null;if(!r&&"save"===a&&!n.validate(!0))return null;s.links&&s.links[a]&&s.links[a].data&&(t=s.links[a].data);var l=r+".$links.after"+a.charAt(0).toUpperCase()+a.substring(1);return{path:"/"+o.join("/"),params:t,after:l}},n.prototype._destroyObject=function(e,t){var n=e[t];n&&Object.keys(n).forEach(function(e){n[e].destroy(),delete n[e]})},n.prototype.hasErrors=function(){var e=this,t=!1;if(t)return t;for(var n=Object.keys(e.$errors),o=0,i=n;o<i.length;o++){u=i[o];if(e.$errors[u].hasErrors()){t=!0;break}}n=Object.keys(e._schema.properties||{});for(var r=e._rootParent._schema,s=0,l=n;s<l.length;s++){var u=l[s],c=e._schema.properties[u];if(a.inModel(c,r)&&(a.isCompositionRef(c,r)?t=e[u].hasErrors():a.isCompositionList(c,r,!1)&&e[u].forEach(function(e){t||(t=e.hasErrors())}),t))break}return t},n.prototype.destroy=function(){var e=this;e._parent=null,e._destroyObject(e,"_children"),e._destroyObject(e,"$states"),e._destroyObject(e,"$links"),e._destroyObject(e,"$errors"),e._arrayParent=null,e._model=null,e._schema=null,e.onRefresh=null,e.onchange=null,e.onsync=null,e.onstatechanged=null,e._rootParent=null},n}();t.Data=P,t.ObservableUtils=y}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=e.Observable,i=(o.SchemaUtils,o.DataUtils,n.DatasetPlugin);e.locale,e.ulocale,e.utils;t.update=function(e,t,n,o,r){try{var a=e.getJsonPachDelta({useId:!0});if(t&&t.length&&(a=a||[],t.forEach(function(e){a.push({op:e.op||"add",path:e.path,value:e.params})})),!a){try{o(null)}finally{r()}return}var s=n.syncDataSet();s.name="patch",s.$params.$method="PATCH";var l={};i.executeDatasets([s],a,l,[],function(t,n){try{n?e.addAjaxException(n):o(l.patch)}finally{r()}})}catch(e){r()}}}(e.serversync||(e.serversync={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){e.data,e.utils;var n=t.SchemaUtils;n.registerValidator("schema",function(e,t,o,i){var r=!0,a="validate"===e;if("propchanged"===e||a){if(!o.name)return r;if(o.method)return!0;var s=n.lastSegment(o.name,null);if(n.arrayProps.indexOf(s)>=0)return r;var l=i?i.value:t.getValue(o.name,o.params),u=i?i.state:t.getState(o.name,o.params),c=i?i.schema:t.getSchema(o.name);if(u&&(u.isHidden||u.isDisabled))return r;var d=o.locale,p=[],f=[],m=i?i.base:t.getParentOf(o.name,o.params);if(n.validateSchema(l,c,u,d,p,f)||(r=!1),a&&n.isMetaProp(s)&&c&&"password"===c.format){var h=t.getValue(n.extractBase(o.name)+c.$stateProperty,o.params);c=t.getValue(n.extractBase(o.name)+c.$stateProperty,o.params),n.validatePassword(h,l,c,u,d,p)||(r=!1)}m.$errors&&m.$errors[s]&&m.$errors[s].addErrors(p)}return r})}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=function(){function e(){this._forms={},this._inAction=!1}return e.prototype.setInAction=function(e){this._inAction=e},e.prototype.isInAction=function(){return this._inAction},e.prototype.broadcast=function(e,t){var o=this;n.nextTick(function(){Object.keys(o._forms).forEach(function(n){var i=o._forms[n];i&&i.execAction(e,t)})})},e.prototype.add=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=e)},e.prototype.remove=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=null)},e.prototype.formByName=function(e){return this._forms[e]},e}();t.FormManager=o;t.formManager=function(){var e;return function(){return e||(e=new o),e}}()}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.ui,i=n.utils,r=n.build,a=n.link,s=n.dom,l=n.layoutUtils,u=n.customData,c=n.preferences,d=n.Observable.SchemaUtils,p=n.Observable.ObservableUtils,f=(n.ulocale,function(n){function f(t,s,u,c,p,f){var m=n.call(this,t,s,u,c,p,f)||this;m._event2Layout=function(e){var t=this;if(!t.$element)return null;for(var n=t.$element.get(0),o=e.target;o;){var i=o.getAttribute("data-render");if(i){var r=t.getLayoutById(i);if(r)return r}o=o===n?null:o.parentNode}return null};var h=m;u&&u.$transactionId&&(h._transactionId=u.$transactionId,h._viewId=u.id,delete u.$transactionId),h._resizeHnd=function(e){return h._resizeControls(),!0},a.context().$url.$showRules&&i.showRules(!0),s.module&&(h.module=s.module,delete s.module),t.data&&(h.formData=$.extend(!0,{},t.data)),h.formManager=o.formManager(),h.formManager.add(h),h.$schema=c||{},h.$rootSchema=h.$schema,s.path&&(h.$rootPath=s.path,h.$schema=d.getSchema(s.path,h.$schema,h.$rootSchema,!0)),s.checkFormLayout&&s.checkFormLayout(h),h.$locale=p,s&&s.preferenceName&&(h._settingsName=s.preferenceName,h._settings=f),s&&s.storageName&&(h._settingsName=s.storageName,h._localSettings=!0);var v=s&&s.jsonSync||null!==h.syncDataSet();return v&&(h.onsync=e.serversync.update),h.setData(u),h.$model.onchange=h._modelChanged.bind(h),v&&(h.$model.onsync=h._synModel.bind(h)),h.$model.onstatechanged=h._stateChanged.bind(h),h._bindStates={},h._bindTitles={},h._bindAccordion={},Object.keys(h.map).forEach(function(e){var t=h.map[e];if(t.$bindState&&(h._bindStates[t.$bindState]=h._bindStates[t.$bindState]||[],h._bindStates[t.$bindState].push(e)),t.$title&&t.$title.value&&!t.$title.isHidden){var n=[];i.extractAngularVars(t.$title.value,n)&&(n&&n.forEach(function(t){h._bindTitles[t.name]||(h._bindTitles[t.name]=[],h.registerListenerFor(t.name,h,"layout-titles")),h._bindTitles[t.name].push(e)}),t.$fields=!0)}t.$bindPages&&t.$type===l.LAYOUT_ACCORDION&&"none"===t.$widget&&(h._bindAccordion[t.$bindPages]||(h._bindAccordion[t.$bindPages]=[],h.registerListenerFor(t.$bindPages,h,"layout-accordion")),h._bindAccordion[t.$bindPages].push(e),h._activateTab(t))}),Object.keys(h._bindStates).forEach(function(e){var t=h.$model.getState(e,{});t&&t.isHidden&&h._bindStates[e].forEach(function(e){h.map[e].$isHidden=!0}),h.registerListenerFor(e,h,"layout-state")}),h.registerListenerFor("$",h),h.loadPrefs(),s&&s.validators&&s.validators.forEach(function(e){h.$model.addValidator(e,!0)}),h.options.design||!h.options.externalSchema||!h.options.externalLayout||r.release||s.autoClose||(h.options.authoringIndicator=!0,h.options.verticalSpacing=!0),h._afterCreate(),m}return __extends(f,n),f.prototype.addChildForm=function(e,t){var n=this;n._childrenForms=n._childrenForms||[],n._childrenForms.push({form:e,parentId:t}),e._parentForm=n},f.prototype.removeChildForm=function(e){var t=this;if(t._childrenForms)for(var n=t._childrenForms.length;n--;)if(t._childrenForms[n].form===e){t._childrenForms.splice(n,1);break}},f.prototype.closeInlineForms=function(e){var t=this,n=t.getLayoutByName(e);if(n&&t._childrenForms)for(var o=t._childrenForms.length;o--;){var i=t._childrenForms[o];i.parentId===n.$id&&(t._childrenForms.splice(o,1),i.form._parentForm=null,i.form.close())}},f.prototype.hasInlineForms=function(e){var t=this,n=t.getLayoutByName(e);if(n&&t._childrenForms)for(var o=t._childrenForms.length;o--;){var i=t._childrenForms[o];if(i.parentId===n.$id)return i.form}return null},f.prototype._isInDelayedAction=function(){return this.formManager?this.formManager.isInAction():this._internalDelayedAction},f.prototype._setInDelayedAction=function(e){this.formManager?this.formManager.setInAction(e):this._internalDelayedAction=e},f.prototype.initOptions=function(e){return e=e||{},e.form=!0,e},f.prototype.syncTransactionId=function(){return this._transactionId},f.prototype.syncViewId=function(){return this._viewId},f.prototype.syncDataSet=function(){var e=this,t=e.data.datasets?Object.keys(e.data.datasets):[];return 1===t.length&&"sync"===e.data.datasets[t[0]].$type?i.copy(e.data.datasets[t[0]]):null},f.prototype._getFormLData=function(){return this.$model},f.prototype._activateTab=function(e){var t=this.$model.getValue(e.$bindPages,{});if(t){var n=null,o=null;e.$items.forEach(function(e){e.opened&&(n=e),e.$name===t&&(o=e)}),o?(o.opened=!0,n&&n!==o&&(n.opened=!1)):!n&&e.$items.length&&(e.$items[0].opened=!0)}},f.prototype.setData=function(t){var n=this;t=t||{},n.$data=t,n.options.beforeSetModel&&n.options.beforeSetModel(n.$data,n),n.$model?n.$model.setModel(n.$data):n.$model=new e.Observable.Data(n.$schema,null,"",n.$data,null,!1,n.$locale,n.data.datasets,n.data.transform,n.options.design),n.$model.saveModel(),n.options.afterModelCreated&&n.options.afterModelCreated(n.$model,n)},f.prototype.processing=function(e){this._inProcessing=e,s.processing(e,100)},f.prototype.controlByField=function(e){return this._findControlByField(e)},f.prototype.controlByName=function(e,t){return this._findControlByName(e,t)},f.prototype._findControlByField=function(e){var t=this,n=[];return Object.keys(t.controls).forEach(function(o){var i=t.controls[o];i&&i.$bind===e&&n.push(i)}),n.length?n:null},f.prototype._findControlByName=function(e,t){var n=this,o=[];return Object.keys(n.controls).forEach(function(t){var i=n.controls[t];i&&i.name===e&&o.push(i)}),t&&!o.length&&n.namedMapFields[e]&&o.push(n.namedMapFields[e]),o.length?o:null},f.prototype.loadPrefs=function(){var e=this;e._localSettings&&e._settingsName&&(e._settings=c(e._settingsName))},f.prototype.supportSettings=function(){return!!this._settingsName},f.prototype.getFieldSettings=function(e){var t=this;return t._settings?t._settings[e]:null},f.prototype.setFieldSettings=function(e,t){var n=this;n._settings=n._settings||{},n._settings[e]=t},f.prototype.savePrefs=function(t){var n=this;n._settingsName&&(n._localSettings?(n._settings=n._settings||{},c(n._settingsName,n._settings),t()):e.external.preferenceSaveHandler(n._settingsName,n._settings).then(function(){t()}))},f.prototype.sendMessage=function(e,t,n){var o,i=this._findControlByField(t);return i&&i.length&&i.forEach(function(t){t.sendMessage&&(o=t.sendMessage(e,n))}),o},f.prototype.afterSettings=function(e,t,n){var o=this;return o.options.settingsHandler?o.options.settingsHandler("after",e,t,n):n},f.prototype.beforeSettings=function(e,t){var n=this;return n.options.settingsHandler?n.options.settingsHandler("before",e,t):null},f.prototype._createError=function(){var e=this,t=["bs-form-error"];return e.options.verticalSpacing?t.push("bs-form-vertical-space"):(e.options.closeButtonHandler||e.options.authoringIndicator)&&t.push("bs-form-settings-space"),$('<div id="'+e.data.$id+'_error" class="'+t.join(" ")+'"><div>').get(0)},f.prototype._createErrorItem=function(e,t){var n="success"==e.severity?"success":"warning"==e.severity?"warning":"danger",o=t?"":"bs-none ",r=[i.format('<div id="{0}_error" data-error="true" class="'+o+" alert alert-"+n+' alert-dismissible fade show">',e.id)];return r.push('<button type="button" data-error-close="true" class="close" aria-label="Close">'),r.push('<span data-error-close="true" aria-hidden="true">&times;</span>'),r.push("</button>"),r.push(i.escapeHtml(e.message)),e.details&&e.details.length&&e.details.forEach(function(e){e.message&&r.push('<p class="bs-error-detail-item">'+i.escapeHtml(e.message)+"</p>")}),r.push("</div>"),$(r.join("")).get(0)},f.prototype.clearErrors=function(){var e=this;if(e.$element){var t=s.find(e.$element.get(0),e.data.$id+"_error");t&&s.empty(t)}},f.prototype.showErrorItem=function(e,t){var n=this;if(n.$element){var o=s.find(n.$element.get(0),n.data.$id+"_error");o&&(t&&s.empty(o),s.append(o,n._createErrorItem(e,t)))}},f.prototype.afterRenderChildren=function(e){var t=e.find("[data-phoenix-tooltip]");t.tooltip&&t.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},f.prototype._loadNestedControllers=function(){var e=this;e._nestedControllers=[],Object.keys(e.map).forEach(function(t){var n=e.map[t];if(n.$refController){var o={$refProperty:n.$refProperty,handler:null,beforeSetModel:null},r=u.get(n.$refController);if(!r)throw i.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',n.$refController);r.onModelChanged&&(o.handler=r.onModelChanged.bind(r)),r.beforeSetModel&&(o.beforeSetModel=r.beforeSetModel.bind(r)),e._nestedControllers.push(o)}})},f.prototype.hasNestedControllers=function(){var e=this;return e._nestedControllers||e._loadNestedControllers(),e._nestedControllers.length>0},f.prototype.modelCreated=function(e){this._nestedControllers.forEach(function(t){if(t.beforeSetModel){var n=e,o=!1;t.$refProperty?(o=!0,n=i.getValue(e,t.$refProperty)):t.$refProperty||(o=!0),o&&n&&t.beforeSetModel(n)}})},f.prototype.modelChanged=function(e,t,n,o){this._nestedControllers.forEach(function(r){if(r.handler){var a=e,s=t,l=!1;r.$refProperty&&a.property&&0===a.property.indexOf(r.$refProperty+".")?(l=!0,(a=i.copy(e)).property=a.property.substring(r.$refProperty.length+1),s=t.getValue(r.$refProperty,e.params)):r.$refProperty||(l=!0),l&&r.handler(a,s,n,o)}})},f.prototype.afterRender=function(e){var t=this,n=e.get(0);t.autoClose&&(n.tabIndex=0);var o=n.firstChild?n.firstChild:n;t.options.form&&!t.options.design&&s.before(o,t._createError());var i=function(e,n,o,i){var r=["<div "+n+'="true" class="bs-cursor-p bs-form-settings'+(o?" "+o:"")+(i?"  space-"+i:"")+'" id="'+t.data.$id+'_settings">'];return r.push("<span "+n+'="true" class="'+s.iconClass(e)+'"></span>'),r.push("</div>"),r.join("")},r=0;if(t.options.closeButtonHandler){var a="times-circle-o",l="red";t.options.autoClose&&(a="remove",l="normal"),s.append(n,$(i(a,"data-form-detail-close",l,r)).get(0)),r++}t.options.authoringIndicator&&(s.append(n,$(i("cog","data-form-settings",null,r)).get(0)),r++),t._showErrors()},f.prototype._afterLayoutAdded=function(t){var n=this;l.enumSubLayouts(t,function(t){if(t.$fields&&t.$title&&t.$title.value){var o=n.$element.get(0),i=s.find(o,t.$id+"_title");i&&e.layoutUtils.updateLayoutTitle(i,t,n.$model,n.$locale)}})},f.prototype.changed=function(e,t,n,o,i){var r=this;if("layout-titles"===i.targetId){if(r._bindTitles[i.propName]&&r.$element){var a=r.$element.get(0);r._bindTitles[i.propName].forEach(function(e){var t=s.find(a,e+"_title");if(t){var n=r.getLayoutById(e);n&&n.$title&&n.$title.value&&l.updateLayoutTitle(t,n,r.$model,r.$locale)}})}}else"layout-accordion"===i.targetId&&r._bindAccordion[i.propName]&&r._bindAccordion[i.propName].forEach(function(e){r.getLayoutById(e).$items.forEach(function(e){e.$name!==n||e.opened||r._activatePageLayout(e)})})},f.prototype._showErrors=function(){var e=this,t=e.$model.$errors.$;if(t.hasErrors())for(var n=t.errors(),o=0,i=n.length;o<i;o++){var r=n[o];e.showErrorItem(r,0==o)}else e.clearErrors()},f.prototype.stateChanged=function(e,t){var n=this;if("layout-state"===t.targetId){if("isHidden"===e&&t.property){var o=n.$model.getState(t.property,{}),i=n._bindStates[t.property];i&&i.forEach(function(e){var t=n.map[e];t&&n.updateIsHidden(t,o.isHidden)})}}else"$"===t.property&&"errors"===e&&n._showErrors()},f.prototype.getSchema=function(e){var t=this;return d.getSchema(e,t.$schema,t.$rootSchema,!1)},f.prototype.getLookupForSchema=function(e,t){var n=this;return d.getLookup(e,t,n.$schema,n.$rootSchema)},f.prototype.registerListenerFor=function(e,t,n){var o=this,i=e;o._listenerChanged=!0,o._listeners=o._listeners||{},o._listeners[i]=o._listeners[i]||[],o._listeners[i].push({target:t,id:n||""})},f.prototype.unRegisterListenerFor=function(e,t){var n=this,o=e;if(n._listeners&&n._listeners[o]){var i=n._listeners[o].findIndex(function(e){return e.target===t});i>=0&&(n._listeners[o].splice(i,1),n._listenerChanged=!0)}},f.prototype.setValue=function(e,t){p.setValue(e,t,this.$model)},f.prototype.getValue=function(e){return p.getValue(e,this.$model)},f.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),p.getValue(t.join("."),this.$model)},f.prototype.getState=function(e){var t=this,n=p.getState(e,this.$model);return t.options.design&&(n.isHidden=!1,n.isDisabled=!1),n},f.prototype._enumListener=function(e,t){this._listeners[e].forEach(function(e){t(e)})},f.prototype._rebuildListeners=function(){var e=this;e._listenerChanged&&(e._listenersByName=Object.keys(e._listeners),e._listenerChanged=!1)},f.prototype._match=function(e,t,n){var o=this,i=e.join("."),r=i+".";o._listenersByName&&o._listenersByName.forEach(function(e){e===i?t(e,!0,!1,!1):"*"===i||0===i.indexOf(e+".")?t(e,!1,!0,!1):n.checkChildren&&0===e.indexOf(r)&&t(e,!1,!1,!0)})},f.prototype.openInlineForm=function(e){var n=this,o=n.getLayoutByName(e.where);o&&t.OpenInlineForm&&t.OpenInlineForm(o.$id,e.name,e.meta,e.controller,e.data,e.locale,function(e){n.addChildForm(e,o.$id)})},f.prototype.execAction=function(e,t,n){var o=this;o.$model.execSyncAction(e,t,n)||o._modelChanged(e,null,null,"execute",n,t)},f.prototype.close=function(){var e=this;e.$content&&(e.$content.empty(),s.remove(e.$content.get(0))),e.destroy()},f.prototype.broadcast=function(e,t){this.formManager.broadcast(e,t)},f.prototype.patch=function(e){var t=this;t._inSync=!0,t.processing(!0);try{e&&e.length&&t.$model.applyJsonPachDelta(e)}finally{t.processing(!1),t._inSync=!1}},f.prototype._sendData=function(){var e=this;e._inSync=!0,e.processing(!0);var t=null;e._actions&&e._actions.length&&(t=e._actions),e._actions=null,e.onsync(e.$model,t,e,function(t){t&&t.length&&e.$model.applyJsonPachDelta(t)},function(){e.processing(!1),e._inSync=!1,t&&t.forEach(function(t){t&&t.after&&e.execAction(t.after,{},{$nosync:!0})})})},f.prototype._synModel=function(e){var t=this;if(!t._inSync&&t.onsync)if(t._syncTimeOut&&clearTimeout(t._syncTimeOut),e){var n=e.delayed;delete e.delayed,t._actions=t._actions||[];var o=t._actions.findIndex(function(t){return t.path===e.path&&t.op===e.op});o>=0&&t._actions.splice(o,1),t._actions.push(e),n?setTimeout(function(){t._sendData()},10):t._sendData()}else setTimeout(function(){t._sendData()},10)},f.prototype._modelChanged=function(e,t,n,o,i,r){var a=this,s=e.split(".");a._rebuildListeners(),(i=i||{}).oldValue=t,i.newValue=n,"execute"!==o&&"beforeChange"!==o&&a._match(s,function(r,s,l,u){("propchange"===o||s)&&(i.propName=r,s?a._enumListener(r,function(r){r.target.changed&&(i.targetId=r.id,r.target.changed(e,t,n,o,i))}):l?a._enumListener(r,function(r){r.target.changed&&(i.targetId=r.id,r.target.changed(e,t,n,o,i))}):u&&a._enumListener(r,function(e){e.target.changed&&(i.targetId=e.id,e.target.changed(r,t,a.getValue(r),o,i))}))},i),a.afterchanged(e,o,i,r)},f.prototype.afterchanged=function(e,t,n,o){var i=this;if(i.onaction){if(i.inAction)return;i.inAction=!0;try{i.onaction({property:e,operation:t,params:n,actionParams:o},i.$model,i)}finally{i.inAction=!1}}},f.prototype.on=function(e){var t=this;t.onaction=e,t.onaction&&t.onaction({operation:"init"},t.$model,t)},f.prototype._stateChanged=function(e,t){var n,o,i=this,r=e.split(".");d.statesAndErrors.indexOf(r[r.length-1])>=0&&(n=r.pop(),o=r.join(".")),i._rebuildListeners(),i._match(r,function(e,r,a,s){r?i._enumListener(e,function(e){e.target.stateChanged&&e.target.stateChanged(n,{targetId:e.id,property:o})}):a?i._enumListener(e,function(e){e.target.stateChanged&&e.target.stateChanged(null,{targetId:e.id,property:o})}):s&&i._enumListener(e,function(e){e.target.stateChanged&&(t.targetId=e.id,e.target.stateChanged(null,{targetId:e.id,property:o}))})},t)},f.prototype.destroy=function(){var e=this;e.$data=null,e.$schema=null,e._bindStates=null,e._bindTitles=null,e._bindAccordion=null,e.module=null,e.onsync=null,e.onaction=null,e._listeners={},e._listenersByName=[],e._loadNestedControllers=null,e._parentForm&&e._parentForm.removeChildForm(e),e._childrenForms&&(e._childrenForms.slice().forEach(function(e){return e.form.destroy()}),e._childrenForms=null),e.$model&&(e.$model.onchange=null,e.$model.onstatechanged=null,e.$model.destroy(),e.$model=null),e.formManager&&(e.formManager.remove(e),e.formManager=null),n.prototype.destroy.call(this)},f.prototype._idComponent=function(e){var t=this;if(!t.$element)return null;for(var n,o=e,i=t.$element.get(0);o;){if(!o.getAttribute)return null;if(n=o.getAttribute("data-render")){if(t.controls[n])break;n=null}o=o===i?null:o.parentNode}return n||null},f.prototype._event2FieldByElement=function(e){var t=this,n=t._idComponent(e);return n?t.controls[n]:null},f.prototype._event2Field=function(e){return this._event2FieldByElement(e.target)},f.prototype._removeBaseEvents=function(){var e=this,t=e.$element;t.off("focusin"),t.off("focusout"),t.off("click"),t.off("dblclick"),t.off("keydown"),t.off("keyup"),t.off("keypress"),t.off("mousedown"),t.off("paste"),$(window).off("global-phoenix-resize",e._resizeHnd),n.prototype._removeBaseEvents.call(this)},f.prototype._freeze=function(e){return e.preventDefault(),e.stopPropagation(),!1},f.prototype._doKeyDown=function(e){return!0},f.prototype._doKeyPress=function(t){var n=this;if(n.autoClose){if(t.keyCode===s.keys.VK_ESCAPE||t.keyCode===s.keys.VK_F4)return n.autoClose.explicitClose=!0,e.pagecontrol.Page().setPopup(null),!1;t.keyCode===s.keys.VK_ENTER&&n.execAction("form-validate")}return!0},f.prototype._addBaseEvents=function(){var e=this;e.$element.on("focusin",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);if(n&&n.focusIn){if(n.focused)return;n.focused=!0,n.focusIn(t)}}),e.$element.on("focusout",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);if(n&&n.focusOut){var o={target:t.target};n.focusTimer&&(window.clearTimeout(n.focusTimer),n.focusTimer=0),e._setInDelayedAction(!0),n.focusTimer=i.focusDelay(function(){if(e._setInDelayedAction(!1),!n.destroyed){n.focusTimer=0;var t=window.document.activeElement;if(t){var i=e._event2FieldByElement(t);i!==n&&n.focusInControl(t)&&(i=n),i!==n&&(n.focusOut(o),n.focused=!1)}else n.focusOut(o),n.focused=!1}})}}),e.$element.on("dblclick",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);n&&n.dblclick&&n.dblclick(t)}),e.$element.on("click",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);if(n&&t.target.id===n.id+"_rules")return n.showRules(),void t.preventDefault();if(n&&n.click){if(n.stopProppagation&&n.stopProppagation(t),n.focusClick)return;if(!e._isInDelayedAction()||n.focused&&n.targetInControl(t.target))return n.click(t);e._setInDelayedAction(!0),n.focusClick=i.focusDelay(function(){e._setInDelayedAction(!1),n.destroyed||(n.focusClick=0,n.click(t))})}else if(!n){var o=t.target;if(o){if(o.getAttribute("data-error-close")){var r=s.findByAttribute(t.target,e.$element.get(0),"data-error");if(r)if(r.id){var l=r.id.substr(0,r.id.length-6);e.$model.$errors.$.rmvErrorById(l)}else s.remove(r),e.openErrors();return e._freeze(t)}if(o.getAttribute("data-form-detail-close"))return e.options.closeButtonHandler&&e.options.closeButtonHandler(),e._freeze(t);if(o.getAttribute("data-form-settings"))return e.options.authoringIndicator&&a.execLink({$formAuthoring:!0,path:e.options.path,name:e.options.externalLayout,schema:e.options.externalSchema,locale:e.options.externalLocale},{},null),e._freeze(t)}}var u=e._event2Layout(t);u&&u.$actionName&&e.execAction(u.$actionName)}),e.$element.on("keypress",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyDown(t)){var n=e._event2Field(t);n&&n.keypress&&n.keypress(t)}}),e.$element.on("keydown",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyPress(t)){var n=e._event2Field(t);n&&n.keydown&&n.keydown(t)}}),e.$element.on("keyup",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyDown(t)){var n=e._event2Field(t);n&&n.keyup&&n.keyup(t)}}),e.$element.on("paste",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);n&&n.paste&&n.paste(t)}),e.$element.on("keyup",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);n&&n.keyup&&n.keyup(t)}),e.$element.on("mousedown",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);return!n||!n.mousedown||n.mousedown(t)}),$(window).on("global-phoenix-resize",e._resizeHnd),n.prototype._addBaseEvents.call(this)},f.prototype._resizeControls=function(){var e=this;e.currentResizeList&&e.currentResizeList.forEach(function(e){e.resize()})},f.prototype._resizeAndAfterRender=function(){var e=this;e.afterRenderList&&(e.afterRenderList.forEach(function(e){e.afterAddedInDom()}),e.afterRenderList=[]),e._resizeControls()},f.prototype.afterAddedInDom=function(){n.prototype.afterAddedInDom.call(this);var e=this;e._resizeAndAfterRender(),e._autofocus&&e._autofocus.setFocus&&window.setTimeout(function(){e._autofocus.setFocus(),e._autofocus=null},200)},f.prototype._afterVisibilityChanged=function(e){n.prototype._afterVisibilityChanged.call(this,e);var t=this;e.inDom&&e.resize&&t._resizeAndAfterRender()},f}(t.BaseLayout));t.Form=f,t.FormClass=f,t.removeForm=function(e){if(e){var t=null;e.$element&&(t=e.$element.get(0)),e.destroy(),t&&s.remove(t)}},t.OpenForm=null,t.OpenInlineForm=null}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.ajax,o=t.dom,i=t.utils,r=t.autoclose,a=(t.modal,t.pagecontrol),s=t.application,l=t.Observable.SchemaUtils,u=t.external,c=t.customData;!function(t){function d(e){return"string"==typeof e?{message:e}:e}function p(e){return e.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("").split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("")}var f=function(e){function n(n,o,i,r,a,s){var l=e.call(this,n,a)||this,u=l,c=n.opts?n.opts:{};return n.validators&&(c.validators=n.validators,delete n.validators),u.render=new t.Form(o,c,r,i,a,s),u.render.$locale=a,l}return __extends(n,e),n.prototype.on=function(e){var t=this;t._clickHnd=function(e){t.render.afterchanged(e,"modal-action",{})},t.render.on(function(n,o,i){return e(t,n,o,i)})},n.prototype.onNatural=function(e){var t=this;t._clickHnd=function(e){t.render.afterchanged(e,"modal-action",{})},t.render.on(function(n,o,i){return e(n,o,i,t)})},n}(e.modal.Modal);t.ModalForm=f;var m=function(e,t,o){l.loadSchemaRefs(t.schema,t.data,t.layout,function(r,a){if(r)return console.log(r),r=d(r),r=r._ajax?n.extractAjaxErrors(r):r,e&&e.module&&e.module.error?e.module.error(r):void i.alert("",r.message,function(){});var s=new f(e,t.layout,t.schema,a,t.locale,t.preferences);s.open(),o&&(e.natural?s.onNatural(o):s.on(o))})},h=function(e,t){var n="";if(e&&s.name&&(n=s.name+"_form_"+e),n&&t&&t.current&&t.current.preferences){var o=t.current.preferences;o.excludedForms&&o.excludedForms.indexOf(n)>=0&&(n="")}return n},v=function(e,t,o,r,a,l){var c=0,d=-1,p=-1,f=[],m={locale:r},v=-1,g=-1,y=s.config(s.name);a=a||{},r&&r.$name&&(a.externalLocale=r.$name),o&&o.then?(f.push(o),v=0,c++):m.data=$.extend(!0,{},o);var _;"object"==typeof e?(m.layout=$.extend(!0,{},e),_=m.layout.name):(d=c,c++,a.externalLayout=e,_=e,f.push(n.get(y.current.forms+"/"+e+".json"))),"object"==typeof t?m.schema=$.extend(!0,{},t):(p=c,c++,a.externalSchema=t,f.push(n.get(y.current.prototypes+"/"+t+".json")));var b=h(_,y);b&&u.preferenceLoadHandler&&(g=c,c++,a.preferenceName=b,f.push(u.preferenceLoadHandler(b))),f.length?i.Promise.all(f).then(function(e){d>=0&&(m.layout=e[d]),p>=0&&(m.schema=e[p]),v>=0&&(m.data=e[v]),g>=0&&(m.preferences=e[g]),l(null,a,m)}).catch(function(e){l(e,null,null)}):l(null,a,m)},g=function(e,t,o,r,a,s){v(t,o,r,a,null,function(t,o,r){if(t)return console.log(t),t=d(t),t=t._ajax?n.extractAjaxErrors(t):t,e&&e.module&&e.module.error?e.module.error(t):void i.alert("",t.message,function(){});(e=e||{}).opts=o,m(e,r,s)})},y=function(e,t){t.isFormController?e.beforeSetModel=t.beforeSetModel?t.beforeSetModel.bind(t):null:e.beforeSetModel=t.initObjectState?t.initObjectState.bind(t):null,e.beforeModelCreated=t.initModel?t.initModel.bind(t):null,e.onSettings=t.onSettings?t.onSettings.bind(t):null,e.storageName=t.storageName,e.validators=t.validators,e.checkFormLayout=t.checkFormLayout},_=function(e,t){if(!e.controller)throw"Controller name is empty.";var n="string"==typeof e.controller?c.get(e.controller):e.controller;if(!n)throw i.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var o={};y(o,n);var r=e.options;r.opts=o,r.natural=!0;var a=null;n.isFormController?a=n.modelChanged.bind(n):n.onModelChanged&&(a=n.onModelChanged.bind(n)),g(r,e.name,e.meta,t,e.locale,a)},b=function(e,t,n){if(!e.controller)throw"Controller name is empty.";var r="string"==typeof e.controller?c.get(e.controller):e.controller;if(!r)throw i.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var a={};y(a,r);var s=e.options;s.opts=a,s.natural=!0;var l=null;if(r.isFormController?l=r.modelChanged.bind(r):r.onModelChanged&&(l=r.onModelChanged.bind(r)),!e.formParent)throw"No form parent.";var u=o.find(null,e.formParent);if(!u)throw"No form parent.";w($(u),e.name,e.meta,n,e.locale,l,s,t)},x=function(e,t,n){if(!e.controller)throw"Controller name is empty.";var o="string"==typeof e.controller?c.get(e.controller):e.controller;if(!o)throw i.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var r={};y(r,o);var a=e.options;(a=r).natural=!0;var s=null;o.isFormController?s=o.modelChanged.bind(o):o.onModelChanged&&(s=o.onModelChanged.bind(o)),a.autoClose=e.autoClose,w(null,e.name,e.meta,t,null,s,a,n)},C=function(e,n,i,s,l){if(s&&s.autoClose){var u=s.autoClose,c={parent:u.parentId?o.find(null,u.parentId):null,alignElement:u.alignElementId?o.find(null,u.alignElementId):null,style:u.style,parents:u.parents,opener:u.opener,width:u.width,height:u.height,minWidth:u.minWidth,minHeight:u.minHeight,stayOnTop:u.stayOnTop,beforeClose:u.beforeClose,contentRender:function(e,o,r){try{s=s||{design:!1},u.showCloseButton&&(s.closeButtonHandler=function(){a.Page().setPopup(null)});var c=new t.Form(n.layout,s,n.data,n.schema,n.locale,n.preferences);c.$locale=n.locale,c.autoClose=o,c.render(e),i&&c.on(i),o.renderControl=c,r(),l&&l(c)}catch(e){r(e)}}};r.open(u.align,c)}else{var d=new t.Form(n.layout,s||{design:!1},n.data,n.schema,n.locale,n.preferences);d.$locale=n.locale,d.render(e),i&&d.on(i),l&&l(d)}},k=function(e,t,o,r,a){l.loadSchemaRefs(t.schema,t.data,t.layout,function(s,l){if(s)return console.log(s),s=d(s),s=s._ajax?n.extractAjaxErrors(s):s,r&&r.module&&r.module.error?r.module.error(s):void i.alert("",s.message,function(){});t.data=l,C(e,t,o,r,a)})},w=function(e,t,o,r,a,s,l,u){v(t,o,r,a,l,function(t,o,r){if(t)return console.log(t),t=d(t),t=t._ajax?n.extractAjaxErrors(t):t,l&&l.module&&l.module.error?l.module.error(t):void i.alert("",t.message,function(){});k(e,r,s,o,u)})},E=function(){function e(){}return e.prototype.isFormController=function(){return!0},e.prototype.data=function(){return null},e.prototype.beforeSetModel=function(e,t){t&&t.hasNestedControllers()&&t.modelCreated(e),this.initObjectState(e,t)},e.prototype.initObjectState=function(e,t){},e.prototype.modelChanged=function(e,t,n,o){n.hasNestedControllers()&&n.modelChanged(e,t,n,o),this.onModelChanged(e,t,n,o)},e.prototype.onModelChanged=function(e,t,n,o){var i=this,r=e.property,a=e;if(r){i.bindProperty&&0===r.indexOf(i.bindProperty)&&(r=r.substr(i.bindProperty.length),a.property=r),r.indexOf("$links.")>=0&&(r=r.replace(/\$links\./g,""));var s="on"+p(r);if(i[s])return i[s](a,t,n,o)}},e}();t.FormController=E,c.register("phoenix.empty.controller",{onModelChanged:function(e,t,n,o){}}),t.loadSchema=function(e){if("object"==typeof e)return i.Promise.resolve($.extend(!0,{},e));var t=s.config(s.name);return n.get(t.current.prototypes+"/"+e+".json")},t.formController2Options=y,t.OpenModalForm=g,t.showModalForm=_,t.showAutoCloseForm=x,t.OpenForm=w,t.OpenInlineForm=function(e,t,n,o,r,a,s,l){var u={name:t,meta:n,controller:o,options:{},formParent:e,locale:a};l&&i.merge(l,u.options),b(u,s,r)},u.formOpenHandler=function(e){var t={name:e.name,meta:e.meta,controller:e.controller||"phoenix.empty.controller",options:e.options||{}};e.modal?_(t):(t.autoClose={align:r.BOTTOM_LEFT,opener:e.opener,alignElementId:e.alignElementId,style:e.style,parents:e.parents,width:e.width,height:e.height,minWidth:e.minWidth,minHeight:e.minHeight,showCloseButton:e.showCloseButton},x(t))}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){e.render,e.ui;var t=e.dom,n=e.utils,o=e.device,i=e.Observable,r=e.ulocale,a=e.locale,s=e.customData,l=i.SchemaUtils;!function(i){var u=function(e){return"center"===e?"align-center":"right"===e?"align-end":""},c=function(e,t,n,o){var i=s.get("ui.html."+n);return i?{value:i(e,t,o),html:!0}:{value:t,html:!1}},d=function(e,n,o){var i=e.avanced.icons[n]||"none",r=e.avanced.iconClass||null,a=u(e.avanced.alignIcon||"center"),s=[];i&&s.push(r?t.customIconClass(i,r):t.iconClass(i));var l=e.tableOptions&&e.tableOptions.small?"small-table":"",c=["bs-image-cell",a];e.avanced._expandItem&&(c.push("bs-expand-parent"),s.push("bs-expand-child")),l&&c.push(l);var d=['<div class="'+c.join(" ")+'"'];return e.avanced._clickable&&d.push(' data-clickable="true"'),e.avanced._expandItem&&(e.level&&d.push(' style="margin-left:'+.5*e.level+'em;"'),s.push("bs-expand-space"),e.avanced._expandItemClass&&s.push(e.avanced._expandItemClass)),e.display||s.push("bs-image-size"),d.push('><span class="'+s.join(" ")+'"></span>'),e.avanced._expandItem&&e.display&&e.display.value&&(d.push('<span class="bs-expand-child">'),d.push(" "),d.push(e.display.value),d.push("</span>")),d.push("</div>"),{value:d.join(""),html:!0}},p={useDatePicker:function(){return!p.nativeDate()&&null!=$.fn.datepicker},useDateTimePicker:function(){return null!=$.fn.datetimepicker},nativeDate:function(){var e=!1,t=!1;return function(){if(t)return e;if(t=!0,o.phone||o.tablet){var n=document.createElement("input");return n.setAttribute("type","date"),e="date"===n.type}return!1}}(),nativeNumber:function(){var e=!1,t=!1;return function(){if(t)return e;if(t=!0,o.phone||o.tablet){var n=document.createElement("input");return n.setAttribute("type","number"),e="number"===n.type}return!1}}(),addErrorDiv:function(t,n){e.bootstrap4?t.push('<div class="invalid-feedback bs-none'+(n?" no-y-margin":"")+'" id="{0}_errors"></div>'):t.push('<div class="small text-danger bs-none" id="{0}_errors"></div>')},keyPressPassword:function(e,n,o){return e.which!==t.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressDate:function(e,t,n){return!0},keyPressCode:function(e,n,o){return e.keyCode!==t.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressNumber:function(e,n,o){var i="-0123456789,."+o.decimalSep,r=e.keyCode;if(!e.metaKey&&t.ignoreKeys.indexOf(r)<0){var a=String.fromCharCode(r);if(i.indexOf(a)<0)return e.preventDefault(),!1}return!0},doPasteDate:function(e,t,n){return!0},doPasteCode:function(e,t,n){return!0},doPasteNumber:function(e,t,n){return!0},doPastePassword:function(e,t,n){return!0},keyDownDate:function(e,t,n){return!0},keyDownCode:function(e,t,n){return!0},keyDownNumber:function(e,t,n){return!0},keyDownPassword:function(e,t,n){return!0},addContainerId:function(e,t){t&&e.push(' draggable="true"'),e.push(' data-render="{0}"'),e.push(' id="{0}"')},containerBaseClass:function(e,t,n){var o=[e,n.groupFieldClass||"bs-field-group","bs-island"];return n.noVerticalMargins&&!t&&o.pop(),n.inline&&o.push(n.inlineFieldClass||"bs-field-inline"),t&&o.push(" design"),o.join(" ")},align2Css:u,fieldWrapper:function(t,n,o,i,r){var a=e.bootstrap4;n.inline&&(n.columns=!1);var s=r&&r.formGroup?r.formGroup:"form-group",l=[p.containerBaseClass(s,o,n)],u=r&&r.tag?r.tag:"div";t.push("<"+u+' class="'),n.size&&l.push((a?"form-control":"form-group-")+n.size),n.columns&&(a||l.push("form-horizontal"),l.push("row")),n.styles&&l.push(n.styles),n.right&&l.push(" float-right"),t.push(l.join(" ")),t.push('"'),p.addContainerId(t,o),t.push(">"),i(),t.push("</"+u+">")},fillSelect:function(e,n,o){if(n){var i=o.enumNames||o.enum,r=o.enum;t.empty(n);var a=document.createDocumentFragment();e.forEach(function(e){var n=r.indexOf(e),o=i[n]||e+"",s=document.createElement("option");t.attr(s,"value",e),s.textContent=o,t.append(a,s)}),t.append(n,a)}},datePickerSetValue:function(e,t){e.datepicker("update",r.parseISODate(t||"")||"")},datePickerInitialize:function(e,n,o){t.addClass(e.get(0),"date");var i=$.extend({language:r.currentLang,autoclose:!0},n||{});e.datepicker(i),o&&e.datepicker().on("hide",o)},datePickerDestroy:function(e){e.datepicker("destroy")},dateTimePickerSetValue:function(e,t){e.datetimepicker("date",r.parseISODate(t||"")||"")},dateTimePickerInitialize:function(e,n,o){t.addClass(e.get(0),"date");var i=$.extend({locale:r.currentLang,showClose:!0},n||{});e.datetimepicker(i),o&&e.datetimepicker().on("hide",o)},dateTimePickerDestroy:function(e){e.datetimepicker("destroy")},text2value:function(e,t,n){if(l.isDate(t)){if(p.nativeDate())return e;o=r.tryParseDate(e);return r.localeDate2ISO(o)}if(l.isDateTime(t)){var o=r.tryParseDateTime(e);return r.localeDateTime2ISO(o)}return l.isNumber(t)?l.text2Value(e+"",t,n):e},defaultOptions:{titleIsHidden:!1,placeHolder:!1,labelCol:3},displayValue:function(e,o,i,s,u,p){var f;if(s=s||{},n.isNullOrUndefined(e))return f={value:"",html:!1};if(s.isTotal&&l.isFwField(p))return f={value:"",html:!1};if(o.enum){var m=o.enum.indexOf(e),h=m>=0?o.enumNames?r.tt(o.enumNames[m],i):e:"";f=s.avanced&&s.avanced.transform?c(e,h,s.avanced.transform,u):s.avanced&&s.avanced.icons?d(s,e):{value:h,html:!1}}else switch(o.type){case"string":if(o.format)switch(o.format){case"date":h=r.shortDate(e||"");f=s.avanced&&s.avanced.transform?c(e,h,s.avanced.transform,u):{value:h,html:!1};break;case"date-time":var v=r.shortDateTime(e||"");f=s.avanced&&s.avanced.transform?c(e,v,s.avanced.transform,u):{value:v,html:!1}}f||(f=s.avanced&&s.avanced.transform?c(e,e,s.avanced.transform,u):s.avanced&&s.avanced.icons?d(s,e):{value:e,html:!1});break;case"number":var g=void 0;g=s.state?r.decimal(e||0,s.state.decimals||0,s.useSymbol?s.state.symbol||"":""):"money"===o.format?r.money(e||0,s.useSymbol):r.decimal(e||0,o.decimals||0,s.useSymbol?o.symbol:""),f=s.avanced&&s.avanced.transform?c(e,g,s.avanced.transform,u):s.avanced&&s.avanced.icons?d(s,e):{value:g,html:!1};break;case"integer":var y=r.integer(e);f=s.avanced&&s.avanced.transform?c(e,y,s.avanced.transform,u):s.avanced&&s.avanced.icons?d(s,e):{value:y,html:!1};break;case"boolean":if(s.isTotal)return f={value:"",html:!1};if(s.avanced&&s.avanced.transform)f=c(e,e?a.ui.Yes:a.ui.No,s.avanced.transform,u);else if(s.html){var _=[];if(s.avanced&&s.avanced.editable||s.editable||s.check||s.avanced&&s.avanced.icons){var $="",b="bs-cursor-d";s.editable?($="bs-bool-edit",b="bs-cursor-p"):$="bs-bool";var x=s.tableOptions&&s.tableOptions.small?" small-table":"",C=s.avanced?s.avanced.icons:null;C||(C={true:"check-square-o",false:"square-o"});var k=C[!!e+""],w=[$,b,"bs-image-size"];k&&w.push(t.iconClass(k)),_.push('<center class="bs-image-cell'+x+'"><span data-clickable="true" class="'+w.join(" ")+'"></span>&nbsp;</center>'),f={value:_.join(""),html:!0}}else f={value:e?a.ui.Yes:a.ui.No,html:!1}}else f={value:e?a.ui.Yes:a.ui.No,html:!1}}if(f||(f={value:e,html:!1}),s.html&&s.avanced&&s.avanced.$link){var E=['<a href="#" class="bs-cursor-p" data-phoenix-href="link://$link">'];E.push(f.value),E.push("</a>"),f.value=E.join(""),f.html=!0}return f},addTooltipAndRule:function(e,n){n.description&&(e.push('<span id="{0}_tooltip" data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title="'+n.description+'" class="'+t.iconClass("question-circle")+" bs-tooltip-icon"),e.push('"></span>')),n.rules&&(e.push('<span id="{0}_rules"  class="'+t.iconClass("bolt")+" bs-rules"),e.push('"></span>'))}};if(p.useDatePicker()){f=function(t){var n=$.fn.datepicker;e.bootstrap4&&(n.DPGlobal.template=n.DPGlobal.template.replace(/\"table-condensed\"/g,'"table-sm"')),n.dates[t]={days:a.date.weekdays,daysShort:a.date.weekdaysShort,daysMin:a.date.weekdaysMin,months:a.date.months,monthsShort:a.date.monthsShort,today:a.date.today,clear:a.date.clear,format:a.date.dateShort.replace(/\//g,a.date.daySep),titleFormat:"MM yyyy",weekStart:a.date.weekStart}};t.readyHandlers.push(function(){f(r.currentLang)}),r.register(f)}if(p.useDateTimePicker()){var f=function(t){var n=window.moment;n&&n.updateLocale(t,{months:a.date.months,monthsShort:a.date.monthsShort,weekdays:a.date.weekdays,weekdaysShort:a.date.weekdaysShort,weekdaysMin:a.date.weekdaysMin,longDateFormat:{LT:e.locale.date.shortTime.replace(/M/g,"m").replace(/S/g,"s"),L:a.date.dateShort.replace(/\//g,a.date.daySep).toUpperCase()},week:{dow:a.date.weekStart}})};t.readyHandlers.push(function(){f(r.currentLang)}),r.register(f)}i.utils=p}(e.uiutils||(e.uiutils={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils,n=(e.uiutils,e.Observable),o=e.dom,i=e.external,r=e.customData,a=n.SchemaUtils;!function(n){var s=function(){function n(e,t,n){var o=this;o._isBinded=!0,o.config=e,o.form=n,o.options=t||{},e.options=e.options||{},o.parent=o.form.getLayoutById(e.$parentId),o.$bind=e.$bind,"$none"===o.$bind&&(o._isBinded=!1,o._internalValue=e.options.value,o._internalState=e.options.state||{}),e.$name&&(o.name=e.$name),o.$display=o.config.$display||o.$bind,e.$lookup&&(o.useDisplay=o.$display!==o.$bind,o.$lookup=o.form.getLookupForSchema(o.$bind,e.$lookup)),a.isMeta(o.$bind)&&(o.$bind=o.getCustomBind()),o._isBinded&&o.$bind&&n.registerListenerFor(o.$bind,o),o._isBinded&&o.useDisplay&&n.registerListenerFor(o.$display,o),o._defineProps(),o.fieldOptions=e.options||{},o.renderOptions=o.fieldOptions,o.$schema=o._isBinded&&o.$bind?n.getSchema(o.$bind):{},o.$schema&&"array"===o.$schema.type&&(o.$schemaItems=a.expand$Ref(o.$schema.items,o.form.$rootSchema)),o.id=e.$id,o.title=o.fieldOptions.title?o.fieldOptions.title:o.$schema?o.$schema.title:o.$bind}return n.prototype.hide=function(e){var t=this;t._isBinded&&(t._internalState.isHidden=!0,t.stateChanged&&t.stateChanged("isHidden",{}))},n.prototype.setInternalValue=function(e,t){var n=this;if(!n._isBinded&&n._internalValue!==e){var o=n._internalValue;n._internalValue=e,n.changed&&n.changed("",o,e,"propchange"),n.fieldOptions.onChange&&n.fieldOptions.onChange()}},n.prototype.getInternalValue=function(){return this._internalValue},n.prototype.getSettingsName=function(e){var t=this,n=[t.$bind,e];return t.name&&n.push(t.name),n.join("_")},n.prototype.targetInControl=function(e){var t=this;if(t.$element){var n=t.$element.get(0);return o.isChildOf(n,e)}return!1},n.prototype.focusInControl=function(e){var t=this;if(t.$element){var n=t.$element.get(0);return o.isChildOf(n,e)}return!1},n.prototype.setParentId=function(e){},n.prototype.isMeta=function(){return!1},n.prototype.beforeSaveSettings=function(){return!1},n.prototype.savePreferences=function(e){var t=this;if(t._isBinded)return t.form.supportSettings()?void(t.beforeSaveSettings()&&t.form.savePrefs(e)):e()},n.prototype.getCustomBind=function(){return""},n.prototype.getBind=function(){var e=this,t=[];return e.$bind&&t.push(e.$bind),t},n.prototype.setHidden=function(e){e&&(this.state.isHidden?o.addClass(e,"bs-none"):o.removeClass(e,"bs-none"))},n.prototype._state=function(){var e=this;e.state=e.state||{};var t;e._isBinded?(t=e.form.getState(e.$bind),e.state.value=e.form.getValue(e.$bind)):(t=e._internalState,e.state.value=e._internalValue),Object.keys(t).forEach(function(n){e.state[n]=t[n]})},n.prototype._defineProps=function(){},n.prototype.render=function(e){},n.prototype.appendElement=function(e,t){var n=this;e&&(n.options.replaceParent?e.replaceWith(n.$element):e.append(n.$element))},n.prototype.setEvents=function(e){},n.prototype.removeEvents=function(){},n.prototype.customOptions=function(e){var n=this;if(n._isBinded&&t.showRules()){var o=n.form.$rootSchema,i=n.form.$schema;n.getBind().forEach(function(t){var n=a.getSchema(a.parentPath(t),i,o,!0),r=a.lastSegment(t,null);n&&n.name&&(i.rules&&i.rules.validation&&i.rules.validation[n.name]&&i.rules.validation[n.name][r]?e.rules=!0:i.rules&&i.rules.propagation&&i.rules.propagation[n.name]&&i.rules.propagation[n.name][r]&&(e.rules=!0))})}},n.prototype.showRules=function(){var e=this;if(e._isBinded){var t=e.form.$rootSchema,n=[],o=e.form.$schema;e.getBind().forEach(function(e){var i=a.getSchema(a.parentPath(e),o,t,!0),r=a.lastSegment(e,null);i&&i.name&&(o.rules&&o.rules.validation&&o.rules.validation[i.name]&&o.rules.validation[i.name][r]&&n.push(o.rulesMap[o.rules.validation[i.name][r]]),o.rules&&o.rules.propagation&&o.rules.propagation[i.name]&&o.rules.propagation[i.name][r]&&n.push(o.rulesMap[o.rules.propagation[i.name][r]]))}),i.ruleViewer&&i.ruleViewer(n)}},n.prototype._initOptions=function(e){var t=this,n={};t.parent&&t.parent.$fieldsOptions&&(t.parent.$fieldsOptions.columns&&(void 0===n.columns&&(n.columns=t.parent.$fieldsOptions.columns),void 0===n.labelCol&&t.parent.$fieldsOptions.labelCol&&(n.labelCol=t.parent.$fieldsOptions.labelCol)),t.parent.$fieldsOptions.titleIsHidden&&void 0===n.titleIsHidden&&(n.titleIsHidden=!0));var o=$.extend({},e,n,t.fieldOptions);return t.parent.$inline&&(o.inline=!0),t.customOptions(o),t.renderOptions=o,o},n.prototype.destroy=function(){var e=this;e.focusTimer&&(window.clearTimeout(e.focusTimer),e.focusTimer=0),e.destroyed=!0,e.$schema=null,e.parent=null,e.$element||(e.removeEvents(),e.$element=null),e._isBinded&&(e.$bind&&e.form.unRegisterListenerFor(e.$bind,e),e.useDisplay&&e.form.unRegisterListenerFor(e.$display,e))},n.prototype.showErrors=function(t,n){var i=this,r=n&&n.length,a=o.find(t,i.id+"_errors");if(a)if(r){var s=n[0].message;i.renderOptions.inline&&e.bootstrap4&&(s="  ("+s+")"),o.text(a,s),o.removeClass(a,"bs-none")}else o.addClass(a,"bs-none")},n}();n.AbsField=s,n.registerControl=function(e,t,n,o,i){n=n||!1,o=o||"",n&&(t="*");var a=(i=i||{}).lookup||!1,s=i.format||"";i.readOnly?r.register("ui-controls-readonly-"+o+"-"+s,e):r.register("ui-controls-"+t+"-"+n+"-"+a+"-"+o+"-"+s,e)},n.getRegisteredControl=function(e,t,n,o,i){(t=t||!1)&&(e="*"),n=n||"",o=o||"";var a=!(!i||!i.lookup);if(i&&i.readOnly)return!(s=r.get("ui-controls-readonly-"+n+"-"+o))&&o&&(s=r.get("ui-controls-readonly-"+n+"-")),s;var s=r.get("ui-controls-"+e+"-"+t+"-"+a+"-"+n+"-"+o);return!s&&o&&(s=r.get("ui-controls-"+e+"-"+t+"-"+a+"-"+n+"-")),s},n.filterManagerFactory=null}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.utils,o=t.dom,i=t.ui,r=t.uiutils;!function(e){function t(e,t,o){(t=$.extend({columns:!1},t)).columns=!1;var i=[];return r.utils.fieldWrapper(i,t,o,function(){i.push('<div id="{0}_alert" class="alert alert-'+(t.type||"danger")+'" role="alert">'),i.push("</div>")}),n.format(i.join(""),e)}var a=function(e){function n(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(n,e),n.prototype._setDisabled=function(e,t){},n.prototype._setReadOnly=function(e,t){},n.prototype._setMandatory=function(e,t){},n.prototype._label=function(){var e=this;return e.$element?o.find(e.$element.get(0),e.id+"_alert"):null},n.prototype._state2UI=function(){var e=this,t=e._label(),n=e.$element?e.$element.get(0):null;t&&(o.text(t,e.state.value||""),e._setDisabled(t,n),e._setReadOnly(t,n),e.setHidden(n),e._setMandatory(t,n))},n.prototype.changed=function(e,t,n,i){var r=this,a=r._label();r.state.value!=n&&(r.state.value=n,a&&o.text(a,r.state.value||""))},n.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n._label(),r=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(r)),o.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,r)),o.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,i&&n._setReadOnly(i,r)),o.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,i&&n._setMandatory(i,r))},n.prototype.render=function(e){var n=this,o=n._initOptions(r.utils.defaultOptions);return n.$element||(n.$element=$(t(n.id,o,n.options.design)),n._state2UI()),n.appendElement(e,o),n.$element},n}(e.AbsField);e.Alert=a,i.registerControl(a,"string",!1,"alert",null)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils,n=e.dom,o=e.ui,i=e.uiutils;!function(r){function a(e,o,r){o=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},o);var a=[];if(r)i.utils.fieldWrapper(a,o,r,function(){});else{var s=[];o.style&&n.parseStyle(o.style,s),a.push("<div"),s.length&&a.push(' class= "'+s.join(" ")+'"'),i.utils.addContainerId(a,r),a.push("/></div>")}return t.format(a.join(""),e)}var s=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype.click=function(e){},t.prototype._setDisabled=function(e){},t.prototype._setReadOnly=function(e){},t.prototype._setMandatory=function(e){},t.prototype._state2UI=function(){var e=this,t=e.$element?e.$element.get(0):null;t&&e.renderContent(t)},t.prototype.renderContent=function(e){var t=this,o="";void 0!=t.state.value&&(o=JSON.stringify(t.state.value.model(!0),null,2)),n.append(e,$("<pre>"+o+"</pre>").get(0))},t.prototype.changed=function(e,t,n,o){var i=this;i.state.value=i.form.getValue(i.$bind),i._state2UI()},t.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,n.setHidden(i)),o.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,n._setDisabled(i)),o.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,n._setReadOnly(i)),o.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,n._setMandatory(i))},t.prototype.render=function(e){var t=this,n=t._initOptions(i.utils.defaultOptions);return t.$element||(t.$element=$(a(t.id,n,t.options.design)),t._state2UI(),t.setEvents(n)),t.appendElement(e,n),t.$element},t}(e.ui.AbsField);r.ComplexBase=s,o.registerControl(s,"object",!1,"objectjson",null),o.registerControl(s,"array",!1,"objectjson",null)}(e.formcomplex||(e.formcomplex={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.customData,i=(n.formcomplex,n.ui),r=n.utils,a=n.dom,s=(n.link,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.customOptions=function(t){var n=this;if(e.prototype.customOptions.call(this,t),!t.item||!t.item.render)throw'Item render is null. Use options: { item : {render: "my_item_render"}} ';if(n._render=o.get(t.item.render),!n._render)throw"Item render isn't registered. Use customData.register(\""+t.item.render+'", controller);'},t.prototype._renderContentElement=function(e,t,n){void 0===n&&(n=!1);var o,i=this,r=[];if("scroll"===i._layout&&r.push(i._id+"_inScroll"),"grid"===i._layout||"column"===i._layout){var s=t%i._columns;if(0===s&&"grid"===i._layout||0===t&&"column"===i._layout){i._row=$('<div class="row"></div>').get(0);for(var l=Math.floor(12/i._columns),u=0;u<i._columns;u++)a.append(i._row,$('<div class="col-sm-'+l+'"></div>').get(0));a.append(i._cp,i._row)}o=i._row.childNodes[s]}else o=i._cp,r.push("bs-inline-block bs-va-top");i.renderOptions.item.style&&a.parseStyle(i.renderOptions.item.style,r);var c=$('<div class="'+r.join(" ")+'"></div>').get(0);n?i._parentItemAddedInDom=c:!e&&i._render.lastRender?i._render.lastRender(c,e,i._id):i._render.render(c,e,i._map,i.state.value.get(t)),a.append(o,c)},t.prototype.beforeRenderContent=function(){var e=this;e._render&&e._render.beforeRenderContent&&e._render.beforeRenderContent(e)},t.prototype.renderContent=function(e){var t=this;a.empty(e),t._parent=e,t._id=r.allocID(),t._map={},t._layout="inline",t.renderOptions&&t.renderOptions.layout&&(t._layout=t.renderOptions.layout.type),t._cp=document.createDocumentFragment(),"grid"!==t._layout&&"column"!==t._layout||(t._columns=Math.max(Math.min(t.renderOptions.layout.columns||4,12),1));var n=t.state.value.model(!0);if(t._localModel=n,t.beforeRenderContent(),n&&n.forEach(function(e,n){t._renderContentElement(e,n)}),t._render.lastRender&&t._renderContentElement(null,n&&n.length),t._renderContentElement(null,n&&n.length+1,!0),"grid"!==t._layout&&"column"!==t._layout||a.hasClass(e,"container-fluid")||a.addClass(e,"container-fluid"),"scroll"===t._layout){var o=$(r.format('<div id="{0}_overflow" class="array-control-overflow">',t._id)).get(0);a.append(o,$(r.format('<div id="{0}_left" class="{0}_move array-control-move array-control-goLeft"><span class="{1}"></span></div>',t._id,a.iconClass("chevron-left"))).get(0)),a.append(o,$(r.format('<div id="{0}_right" class="{0}_move array-control-move array-control-goRight"><span class="{1}"></span></div>',t._id,a.iconClass("chevron-right"))).get(0));var i=$(r.format('<div id="{0}_container"></div>',t._id)).get(0);a.append(o,i),a.append(i,t._cp),a.append(e,o)}else a.append(e,t._cp)},t.prototype.destroy=function(){var t=this;t._map=null,t._render=null,e.prototype.destroy.call(this)},t.prototype.setEvents=function(e){var t=this;t._render.setEvents&&t._render.setEvents(e)},t.prototype.removeEvents=function(){var e=this;e._render.removeEvents&&e._render.removeEvents()},t.prototype.click=function(e){var t=this;t._render.click&&t._render.click(t.$element.get(0),e,t._map,t.state.value,t.form)},t.prototype.afterAddedInDom=function(){var e=this;e._render.afterAddedInDomRender&&e._render.afterAddedInDomRender(e._parentItemAddedInDom,e._id)},t.prototype.resize=function(){var e=this,t=0,n=0,o=0;if("scroll"===e._layout){e._nOverflow=$(r.format("#{0}_overflow",e._id)),e._nCtrlLeft=$(r.format("#{0}_left",e._id)),e._nCtrlRight=$(r.format("#{0}_right",e._id)),e._nContainer=$(r.format("#{0}_container",e._id)),e._nInScroll=$(r.format(".{0}_inScroll",e._id)),e._nCtrls=$(r.format(".{0}_move",e._id)),e._nInScroll.each(function(){t+=$(this).outerWidth(),$(this).height()>n&&(n=$(this).height()),$(this).outerWidth()>o&&(o=$(this).outerWidth())}),t=Math.round(t),n=Math.round(n),e._nContainer.css("width",t+"px"),e._nContainer.css("height",n+10+"px");var i=e._nCtrls.height();e._nCtrls.css("padding-top",Math.round(n/2-i/2)),e._nCtrls.css("padding-bottom",Math.round(n/2-i/2));e._nCtrlLeft.css("padding-left",10),e._nCtrlLeft.css("padding-right",20),e._nCtrlRight.css("padding-left",20),e._nCtrlRight.css("padding-right",10),e._nCtrlRight.css("left",Math.round(e._nOverflow.outerWidth()-(30+e._nCtrls.width()+3))),e._setMoveCtrls(),e._moveDelta=0,e._nCtrlLeft.mouseenter(function(){e._moveDelta=-5,e._activeMove()}),e._nCtrlLeft.mouseleave(function(){e._moveDelta=0}),e._nCtrlRight.mouseenter(function(){e._moveDelta=5,e._activeMove()}),e._nCtrlRight.mouseleave(function(){e._moveDelta=0})}e._render.afterResize&&e._render.afterResize(e._id,e.state.value,e.form)},t.prototype.changed=function(t,n,o,i){e.prototype.changed.call(this,t,n,o,i);var r=this;setTimeout(function(){r.afterAddedInDom(),r.resize()},50)},t.prototype._activeMove=function(){var e=this;0==e._moveDelta?e._moving=!1:e._moving||(setTimeout(function(){e._move(e)},10),e._moving=!0)},t.prototype._setMoveCtrls=function(){var e=this,t=e._nOverflow.scrollLeft();e._nCtrlLeft.css("display","block"),e._nCtrlRight.css("display","block"),0==t&&e._nCtrlLeft.css("display","none"),t+e._nOverflow.outerWidth()+1>e._nContainer.outerWidth()&&e._nCtrlRight.css("display","none")},t.prototype._move=function(e){var t=e,n=t._nOverflow.scrollLeft();t._nOverflow.scrollLeft(n+t._moveDelta),t._moving=!1,t._activeMove(),t._setMoveCtrls()},t}(e.formcomplex.ComplexBase));t.ArrayControl=s,i.registerControl(s,"array",!1,"array-control",null)}(e.formarray||(e.formarray={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=e.dom,i=(e.ui,e.uiutils),r=e.ulocale,a=e.Observable.SchemaUtils,s=function(e,t,n,o){n&&o.push(' draggable="true"'),n&&o.push(' data-render="{0}"')},l=function(e,t){var n=o.icon(t?"caret-up":"caret-down");o.addClass(n,"bs-basictable-sort"),o.attr(n,"sort","true"),o.append(e.firstElementChild,n)},u=function(e){var t=e.lastElementChild?e.firstElementChild.lastElementChild:null;t&&"true"===o.attr(t,"sort")&&o.remove(t)},c=function(e){if("number"==typeof e)return!0;if("string"==typeof e){var t=parseInt(e,10)+"";if(t===e.trim())return!0;if(t+"px"===e.trim())return!0}return!1},d=function(e){return"number"==typeof e?e+"px":parseInt(e,10)+""===e.trim()?e.trim()+"px":e},p=function(e,t,n,r,a,s,l,u){var c=document.createElement("tr");return"middle"===s.align&&o.addClass(c,"bs-va-middle"),a.forEach(function(e,a){var l=document.createElement("td");if(0==a)o.append(l,document.createTextNode(n.schema.title||String.fromCharCode(160)));else{o.attr(l,"rowId",e.id),o.attr(l,"colId",n.name),l.rowIndex=t,l.colIndex=a-1;var d=r.get(a-1),p=i.utils.displayValue(d.getRelativeValue(n.name),n.schema,u,{html:!0,useSymbol:!0,editable:n.canEdit,check:n.check,avanced:null,tableOptions:s,state:null},d,n.name);if(p.html){var f=$(p.value);o.append(l,f.get(0))}else o.append(l,document.createTextNode(p.value))}o.append(c,l)}),c},f=function(t,n,r,s,l,u,c,p,f,m,h,v){var g=e.bootstrap4,y=document.createElement("tr");y.id=s.$id+(m?"_frozen":"");var _=["bs-table-row"];return"middle"===u.align&&_.push("bs-va-middle"),s.$select&&u.selecting&&u.selecting.row&&(u.noRowSelectedIndicator||_.push("bs-row-selected")),r&&_.push("bs-row-level-"+r),y.className=_.join(" "),!u._useStripedCss&&u.striped&&(n%2==1||o.addClass(y,"even")),l.forEach(function(e,t){var c=document.createElement("td");if(v)if(0===t)e=l.find(function(e){return e.$bind===v.columnField}),c.colSpan=v.colspan;else if(t<v.colspan)return;var f=!1;0===n&&u.headerIsHidden&&!u._useColGrp&&(e.options.width&&(c.style.width=d(e.options.width)),e.options.minWidth&&(c.style.minWidth=d(e.options.minWidth)));var m=[];e.options._expandItem&&m.push("bs-cursor-d");var _=s.getRelativeState(e.$bind);_.style&&o.parseStyle(_.style,m);var b=e.options.align;if(e.schema){var x=a.isNumber(e.schema),C=a.isDate(e.schema)||a.isDateTime(e.schema);u._nowrap||!x&&!C||m.push("nowrap"),b||(x?b="right":C&&(b="center"))}if(b&&m.push(i.utils.align2Css(b)),e.isLink&&!h&&e.options.button&&m.push("bs-td-button"),m.length&&(c.className=m.join(" ")),o.attr(c,"colId",e.$bind),_.isHidden)f=!0;else if(e.isLink){if(!h){var k=void 0,w=void 0;if(e.options.button){var E="";(k=document.createElement("button")).type="button",_.isDisabled&&(k.disabled=!0);var P=e.options.size||(g?"normal":"sm"),O="normal"===P?"":" btn-"+P,S=e.options.type||"link";if(g&&"default"===S&&(S=o.bootstrapStyles(!0).secondary),k.className="bs-button btn btn-"+S+O+(_.isDisabled?" disabled":""),e.options.icon&&((w=document.createElement("span")).className=o.iconClass(e.options.icon),o.append(k,w),E=" "),e.schema.title){var I=document.createTextNode(E+e.schema.title);o.append(k,I)}}else if(e.options.icon){k=document.createElement("center"),_.isDisabled&&o.addClass(k,"bs-disabled"),w=document.createElement("span");var D=["text-"+(e.options.type||"default")];D.push("bs-basictable-btn"),D.push(o.iconClass(e.options.icon)),w.className=D.join(" "),o.append(k,w)}else f=!0;k&&(k.$link=e.$bind,o.append(c,k))}}else{var M=c,T=e.options||{},L=(u.editing||a.isSelectField(e.$bind))&&!_.isDisabled&&!_.isReadOnly&&!_.isHidden;if(!_.isHidden){var F=null;T.display&&T.displaySchema&&(F=i.utils.displayValue(s.getRelativeValue(T.display),T.displaySchema,p,{tableOptions:u,avanced:T.displayOptions||{},state:s.getRelativeState(T.display)},s,T.display));var N=i.utils.displayValue(s.getRelativeValue(e.$bind),e.schema,p,{html:!0,useSymbol:!1,selectable:!_.isDisabled,editable:L,isTotal:h,check:u.editing,avanced:T,tableOptions:u,display:F,level:r,state:_},s,e.$bind);if(N.html){var A=$(N.value);o.append(M,A.get(0))}else""===N.value?f=!0:o.append(M,document.createTextNode(N.value))}}f&&o.append(c,document.createTextNode(String.fromCharCode(160))),o.append(y,c)}),y},m=function(e,t){for(var n=!0,o=0,i=t.length;o<i;o++){var r=t[o];if(!r.options.width||r.options.minWidth){n=!1;break}}if(!(n=n&&"auto"!==e.width)){if(e.scrolling&&e.scrolling.vertical)throw"To support scrolling vertical, all columns must have explicit widths but not explicit minWidth.";if(e.editing)throw"To support inline editing, all columns must have explicit widths but not explicit minWidth."}return n},h=function(e,t,n,o){var i=e.scrolling&&e.scrolling.vertical,r=["table","bs-control"];return(t||o)&&(r.push("table-header"),o&&e.total&&e.total.light&&r.push("light")),!t&&!o&&e._useStripedCss&&e.striped&&r.push("table-striped"),e._useColGrp&&r.push("bs-fixed"),t||o||!e.editing&&!e.nowrap?t||o||!e.allowFrozenColumns||(r.push("nowrap"),e._nowrap=!0):(r.push("nowrap"),e._nowrap=!0),e.allowFrozenColumns&&!e.headerIsHidden&&(t?r.push("headernowrap"):i||r.push("headernowrap")),r.push("bs-theme"),e.border&&r.push("table-bordered"),e.small&&r.push("bs-style-small-table"),r},v=function(e,t,n,o){var i=[];return n?i:(e.width&&"auto"!==e.width&&i.push("min-width: "+d(e.width)),i)},g=function(e,t,n,o,i){var r=t.scrolling&&t.scrolling.vertical,a=h(t,n,0,i);e.push("<table"),a.length&&e.push(' class="'+a.join(" ")+'"'),e.push(' id="{0}_table'),o&&e.push("_frozen"),n&&e.push("_header"),i&&e.push("_footer"),e.push('"');var s=v(t,0,o);s.length&&e.push(' style="'+s.join(";")+'"'),e.push(">"),t._useColGrp&&e.push('<colgroup id="{0}_colgrp'+(o?"_frozen":"")+(n?"_header":"")+(i?"_footer":"")+'"></colgroup>'),n?t.headerIsHidden||e.push('<thead><tr class="bs-va-middle" id="{0}'+(o?"_frozen":"")+'_cols"></tr></thead>'):r||(t.headerIsHidden||e.push('<thead><tr class="bs-va-middle" id="{0}'+(o?"_frozen":"")+'_cols"></tr></thead>'),t.total&&t.total.property&&e.push('<tfoot id="{0}'+(o?"_frozen":"")+'_totals"></tfoot>')),i&&t.total&&t.total.property&&e.push('<tfoot id="{0}'+(o?"_frozen":"")+'_totals"></tfoot>'),n||i||(e.push('<tbody id="{0}'),o&&e.push("_frozen"),e.push('_rows"></tbody>')),e.push("</table>")},y=function(e){var t=0;return e.forEach(function(e){t+=parseInt(e.options.width+"",10)}),t},_=function(t,n,i){var r=o.find(i,n+"_close_ms");t?(o.addClass(i,"minimized"),r&&(o.removeClass(r,e.dom.iconClass("window-minimize",!0)),o.addClass(r,e.dom.iconClass("window-maximize",!0)))):(o.removeClass(i,"minimized"),r&&(o.removeClass(r,e.dom.iconClass("window-maximize",!0)),o.addClass(r,e.dom.iconClass("window-minimize",!0))))},b=function(e,t,n){var o=t.offsetHeight-(n?3:1);e.style.height=Math.floor(o)+"px"},x=function(e,t,o,i,r,a,s,l){var u=i.filter?s.schema.filters[i.filter]||[]:s.schema.enum,c=u.indexOf(o);c<0?(n.nextTick(function(){a.item.setValue(s.$bind,u[0])}),e.input.selectedIndex=0):e.input.selectedIndex=c},C=function(e,t,r,a,s,l,u){var c=document.createElement("select");c.type="text";var d=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];c.className=d.join(" ");var p=r.filter?l.schema.filters[r.filter]||[]:l.schema.enum,f=p.indexOf(t);return i.utils.fillSelect(p,c,l.schema),b(c,a,!1),o.empty(a),o.addClass(a,"focused"),o.append(a,c),f<0?(n.nextTick(function(){s.item.setValue(l.$bind,p[0])}),c.selectedIndex=0):c.selectedIndex=f,{input:c,parent:c,td:a,combo:null,isInputElement:!0,canSelect:!1,schema:l.schema}},k=function(e,t,n,s,l,u,c){var d=document.createElement("div");d.className="bs-inplace-parent bs-edit-border ";var p=d;c.after&&((p=document.createElement("div")).className="bs-input-group",d.appendChild(p));var f=a.isDate(u.schema)&&i.utils.useDatePicker(),m=document.createElement("input");m.type=c.type||"text";var h=["bs-inplace-edit bs-inplace-edit-size"];if(c.after&&h.push("bs-input-group-main"),m.className=h.join(" "),o.append(p,m),c.after){var v=document.createElement("span");v.tabIndex=-1,v.className="bs-input-group-addon bs-cursor-d add-on";var g=document.createElement("span");g.className=o.iconClass(c.after.icon),o.append(v,g),o.append(p,v),c.id&&(v.id=c.id+"_after")}return b(m,s,!0),o.empty(s),o.addClass(s,"focused"),o.append(s,d),a.isDate(u.schema)?f?(i.utils.datePickerInitialize($(d),{showOnFocus:!1},function(e){}),i.utils.datePickerSetValue($(d),t)):m.value=r.isoDatePart(t||""):m.value=e,{input:m,parent:d,td:s,isInputElement:!0,canSelect:!0,schema:u.schema,combo:null}},w={createCols:function(e,t,n,s,u,p,f){var m=document.createDocumentFragment(),h=(p||"").split(" ");return t.forEach(function(e,t){var s,f=document.createElement("th");o.attr(f,"colId",e.$bind),o.attr(f,"data-drag","move"),n._useColGrp||(e.options.width&&(f.style.width=d(e.options.width)),e.options.minWidth&&(f.style.minWidth=d(e.options.minWidth))),s&&(f.className=s.join(" "));var v=document.createElement("div"),g=["bs-column-header"];n.header&&n.header.align&&g.push(n.header.align),v.className=g.join(" ");var y=v;if(n.headerLines&&(console.log("headerLines is obsolete. use instead header.rows"),n.header=n.header={},n.header.rows=n.headerLines),n.header&&n.header.rows&&n.header.rows>1){var _=document.createElement("div");g=["bs-header-rows-parent row-"+n.header.rows],_.className=g.join(" "),g=["bs-header-rows"],(y=document.createElement("div")).className=g.join(" "),_.appendChild(y),v.appendChild(_)}if(n.selecting&&n.selecting.multiselect&&n.selecting.selectAll&&a.isSelectField(e.$bind)){var b=i.utils.displayValue(!1,e.schema,u,{html:!0,selectable:!0,editable:!0,isTotal:!1,check:!0,avanced:e.options||{},tableOptions:n,state:{}},null,e.$bind);if(b.html){var x=$(b.value);o.append(y,x.get(0))}else o.append(y,document.createTextNode(b.value))}else o.append(y,document.createTextNode(r.tt((e.isLink?"":e.title)||String.fromCharCode(160),u)));if(n.allowColumnResize&&c(e.options.width)){var C=document.createElement("div");C.className="bs-col-resize",o.attr(C,"data-drag","resize"),o.attr(f,"colId",e.$bind),o.append(v,C)}if(o.append(f,v),n.sorting){var k=e.options.display?e.options.displaySchema:e.schema,w=e.options.display?e.options.display:e.$bind;k&&a.canSort(k)&&((s=s||[]).push("bs-cursor-p"),h&&h.length&&h[0]===w&&l(f,1===p.length))}s&&(f.className=s.join(" ")),o.append(m,f)}),m},createColGroup:function(e,t,n){var i=document.createDocumentFragment();return e.forEach(function(e){var t=document.createElement("col");o.attr(t,"colid",e.$bind),e.options.width&&(t.style.width=d(e.options.width)),e.options.minWidth&&(t.style.minWidth=d(e.options.minWidth)),o.append(i,t)}),i},updSorting:function(e,t,n,i){if(e.sorting&&t&&t.childElementCount){var r=(i||"").split(" ");r.length||(r=[""]);for(var a=0,s=t.children.length;a<s;a++){var c=t.children[a],d=o.attr(c,"colId"),p=n(d);d=p&&p.options&&p.options.display?p.options.display:d,r[0]===d?(u(c),l(c,1==r.length)):u(c)}}},gridContainer:function(e,t,r,a,l,u,c){a=a||"",t._useColGrp=m(t,u),t._useStripedCss=!(t.rows&&t.rows.detail)&&t.striped,void 0!==(t=$.extend({right:!1,icon:null,type:"default",width:"auto",height:"auto",size:null,scrolling:{horizontal:!1}},t)).title&&(a=t.title);var d=[],p=["bs-field-group bs-tab-font bs-island"];t.noVerticalMargins&&!t.design&&p.pop(),d.push('<div id="{0}" '),d.push(' class="'),r&&p.push("design"),d.push(p.join(" ")),d.push('"'),s(0,0,r,d),d.push(">"),d.push('<div id="{0}_header"></div>'),p=["bs-basictable-group"];var f=t.scrolling&&t.scrolling.horizontal,h=t.scrolling&&t.scrolling.vertical;if((h||t.allowFrozenColumns)&&p.push("border"),f&&!h&&p.push("bs-scroll-x"),d.push('<div id="{0}_focus" class="'),d.push(p.join(" ")),d.push('"'),r||d.push(' data-render="{0}"'),t.selecting&&(t.selecting.cell||t.selecting.row)&&d.push(' tabindex="0" '),d.push(">"),t.allowFrozenColumns){d.push('<div class="bs-table-cols">');var v=y(c);if(d.push('<div id="{0}_frozen_header_parent"  class="bs-table-frozen-cols" style="width:'+v+'px;">'),h&&!t.headerIsHidden&&(d.push('<div id="{0}_table_frozen_header" class="bs-table-header">'),g(d,t,!0,!0,!1),d.push("</div>")),p=["bs-table-content-scroll frozen"],d.push('<div  class="'+p.join(" ")+'">'),p=["bs-table-content frozen"],d.push('<div id="{0}_frozen_scroll" class="'+p.join(" ")+'"'),h){if(_=[],t.minHeight&&_.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)_.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";_.length&&d.push(' style="'+_.join(";")+'"')}d.push(">"),d.push('<div  class="'+p.join(" ")+'">'),g(d,t,!1,!0,!1),h&&d.push('<div id="{0}_frozen_scroll_delta" class="bs-relative"></div>'),d.push("</div>"),d.push("</div>"),d.push("</div>"),h&&t.total&&t.total.property&&(d.push('<div id="{0}_table_frozen_footer" class="bs-table-header'+(t.total.light?" light":"")+'">'),g(d,t,!1,!0,!0),d.push("</div>")),d.push("</div>"),d.push('<div id="{0}_frozen_header_sep" class="bs-table-cols-sep'+(c.length?"":" empty")+'"></div>'),d.push('<div class="bs-table-free-cols">')}if(h&&!t.headerIsHidden&&(d.push('<div id="{0}_table_header" class="bs-table-header" style="padding-right:'),d.push(o.scrollbar()),d.push('px;">'),d.push('<div id="{0}_table_header_content" class="bs-table-header-content">'),g(d,t,!0,!1,!1),d.push("</div></div>")),h&&d.push('<div class="bs-table-content-scroll">'),p=["bs-table-content"],h&&p.push("vscroll"),d.push('<div id="{0}_master_scroll" class="'+p.join(" ")+'"'),h){var _=[];if(t.minHeight&&_.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)_.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";_.length&&d.push(' style="'+_.join(";")+'"')}return d.push(">"),g(d,t,!1,!1,!1),d.push("</div>"),h&&(d.push("</div>"),t.total&&t.total.property&&(d.push('<div id="{0}_table_footer" class="bs-table-header'+(t.total.light?" light":"")+'" style="padding-right:'),d.push(o.scrollbar()),d.push('px;">'),d.push('<div id="{0}_table_footer_content" class="bs-table-header-content">'),g(d,t,!1,!1,!0),d.push("</div>"),d.push("</div>"))),t.allowFrozenColumns&&(d.push("</div>"),d.push("</div>")),d.push("</div>"),d.push('<center id="{0}_pagination"></center>'),d.push('<div id="{0}_bottom"></div>'),i.utils.addErrorDiv(d),d.push("</div>"),n.format(d.join(""),e)},createRows:function(e,t,n,i,r,s,l,u,c,d){var p=null;if(d){for(var m=0,h=0;h<n.length;h++){var v=n[h];if(a.isNumber(v.schema))break;m++}m>1&&(p={colspan:m,columnField:d})}var g=document.createDocumentFragment();return t&&t.forEach(function(e,t,r){r=r||0,c&&c(e,t,r),o.append(g,f(0,t,r,e,n,i,0,s,0,l,u,p))},i.expandingProperty),g},createBulkRows:function(e,t,n,i,r,a,s,l,u){var c=document.createDocumentFragment();return t&&t.forEach(function(e,t){var r=e.level||0;u&&u(e.value,t,r),o.append(c,f(0,t,r,e.value,n,i,0,a,0,s,l,null))}),c},createRow:f,setRowsSelected:function(e,t,n,i){if(n.selecting&&n.selecting.row){var r=[],a=o.find(i,e);a&&r.push(a),n.allowFrozenColumns&&(a=o.find(i,e+"_frozen"))&&r.push(a),r.forEach(function(e){t?o.addClass(e,"bs-row-selected"):o.removeClass(e,"bs-row-selected")})}},createGridRows:function(e,t,n,i,r,a,s){var l=document.createDocumentFragment();return t&&t.forEach(function(t,u){o.append(l,p(e,u,t,n,i,r,a,s))}),l},createInplaceEdit:function(e,t,n,s,l,u,c){if(u.schema.enum)return C(0,t,n,s,l,u);if(a.isBoolean(u.schema))return{input:null,parent:null,td:s,isInputElement:!1,canSelect:!1,schema:u.schema,combo:null};if(c.after||c.before)return k(e,t,0,s,0,u,c);var d=document.createElement("input");d.type=c.type||"text";var p=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];return u.options.align&&p.push(i.utils.align2Css(u.options.align)),"text"===d.type&&u.schema.maxLength&&(d.maxLength=u.schema.maxLength),d.className=p.join(" "),b(d,s,!1),o.empty(s),o.addClass(s,"focused"),o.append(s,d),a.isDate(u.schema)?c.nativeDate?d.value=r.isoDatePart(t||""):d.value=r.shortDate(t||""):a.isNumber(u.schema)&&c.nativeNumber?d.value=t||0:d.value=e,{input:d,parent:d,td:s,isInputElement:!0,canSelect:!0,schema:u.schema,decimals:n.decimals,combo:null}},updateInplaceEdit:function(e,t,n,o,i,r,s,l){if(s.schema.enum)return x(e,0,n,o,0,r,s);t=t||"",a.isNumber(s.schema)?e.input.value=l.nativeNumber?n:t:a.isDate(s.schema)?e.input.value=l.nativeDate?n:t:e.input.value=t},createDetail:function(e,t){var n=document.createElement("tr");n.className="bs-table-row-detail",n.id=e+"_detail";var i=document.createElement("td");return i.colSpan=t.childNodes.length,o.append(n,i),n},updateEvenOdd:function(e){if(e.childNodes.length)for(var t=!1,n=0,i=e.childNodes.length;n<i;n++){var r=e.childNodes[n];o.hasClass(r,"bs-table-row")&&(t?o.removeClass(r,"even"):o.addClass(r,"even"),t=!t)}},ensureWidth:d,updateFrozenWidth:function(e,t,n){var i=y(n),r=o.find(e,t+"_frozen_header_parent");r&&(r.style.width=i+"px"),(r=o.find(e,t+"_frozen_header_sep"))&&(i?o.removeClass(r,"empty"):o.addClass(r,"empty"))},setColumnWidth:function(e,t,n){t.forEach(function(t){for(var i=0,r=t.childNodes.length;i<r;i++){var a=t.childNodes[i];if(o.attr(a,"colid")===e){a.style.width=n+"px";break}}})},hasFrozenColumns:function(e,t){return!!(e.allowFrozenColumns&&t&&t.length)},cloneForMove:function(e){var t=e.cloneNode(!0);if("th"===t.tagName.toLowerCase()){var n=e.parentElement,i=n.parentElement.parentElement,r=["<div>"];r.push('<table class="'),r.push(i.className),r.push('">'),r.push("<thead>"),r.push('<tr class="'),r.push(n.className),r.push('">'),r.push("</tr></thead><table>"),r.push("</div>");var a=$(r.join("")).get(0),s=a.firstChild.firstChild.firstChild;s.style.height=e.offsetHeight+"px",o.append(s,t),t=a}var l=o.position(e,null);return t.style.top=l.top+"px",t.style.left=l.left+"px",t.style.width=e.offsetWidth+"px",t.style.height=e.offsetHeight+"px",t.style.zIndex="9000",t.style.position="absolute",t},isPixel:c,widthFromSchema:function(e){return a.isBoolean(e)?50:a.isDate(e)?110:a.isNumber(e)?110:150},resizeDiv:function(e,t){var n=document.createElement("div");return n.className="bs-absolute bs-col-resize-indicator",n.style.top="0px",n.style.left=t.left+"px",o.append(e,n),n},getColumnsSizeParents:function(t,n,o,i){var r,a=[];return o._useColGrp?i?((r=e.dom.find(n,t+"_colgrp_frozen_header"))&&a.push(r),(r=e.dom.find(n,t+"_colgrp_frozen"))&&a.push(r),o.total&&o.total.property&&(r=e.dom.find(n,t+"_colgrp_frozen_footer"))&&a.push(r)):((r=e.dom.find(n,t+"_colgrp_header"))&&a.push(r),(r=e.dom.find(n,t+"_colgrp"))&&a.push(r),o.total&&o.total.property&&(r=e.dom.find(n,t+"_colgrp_footer"))&&a.push(r)):o.headerIsHidden||(r=i?e.dom.find(n,t+"_frozen_cols"):e.dom.find(n,t+"_cols"))&&a.push(r),a},multiselectContainer:function(e,t){var i=['<div class="modal-content bs-table-selected-list" id="{0}_ms">'];i.push('<div class="bs-table-selected-list-header"><span id="{0}_close_ms" class="icon-close {1}"></span></div>'),i.push('<div class="bs-table-selected-list-content">'),i.push('<ul class="list-group"  id="{0}_ms_list">'),i.push("</ul>"),i.push("</div>"),i.push("</div>");var r=$(n.format(i.join(""),e,o.iconClass("window-minimize"))).get(0);return t||_(!0,e,r),r},createMultiselectItems:function(e,t,i,r){var a=o.find(t,e+"_ms_list"),s=i.rowMove.expression||"{{$id}}",l=$('<li class="list-group-item bs-list-item-button"></li>').get(0),u=$('<div class="bs-list-button"><span class="'+o.iconClass("times")+'"></span></div>').get(0),c=document.createDocumentFragment();for(r.forEach(function(e){var t=l.cloneNode();o.attr(t,"data-ms-unselect",e.$id),o.text(t,n.execAngularExpression(s,e.model(!0))),o.append(c,t),o.append(t,u.cloneNode(!0))});a.firstChild;)o.remove(a.firstChild);o.append(a,c)},isMultiselectMinimized:function(e){return o.hasClass(e,"minimized")},setMultiselectMinimized:_};t.GridUtil=w}(e.gridrender||(e.gridrender={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils,n=e.dom,o=e.ui,i=e.ulocale,r=e.uiutils,a=e.Observable,s=e.gridrender.GridUtil,l=a.errorsUtils,u=e.link,c=e.locale,d=e.drag,p=e.events,f=a.SchemaUtils;!function(m){m.toolBarFactory=null,m.toolBarRender=null;var h=function(e,t){return(t!==n.keys.VK_TAB||!e.shiftKey)&&(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)},v=function(e){e=(e=(e||"")+"").trim();var t=parseInt(e,10);return t+""===e||t+"px"===e||t+" px"===e};m.gridlookup=null,m.glbGridFilter=null,m.glbGridSettings=null,m.glbMongoFilter2Filter=null;var g=function(g){function y(e,t,n){var o=g.call(this,e,t,n)||this;o._refreshGrid=function(){var e=this,t=e.renderOptions;e.removeEvents(),e._initCols(t),e._renderColumns(t),e._renderRows(!0,"",null),e._renderTotalRows(),e.setEvents(e.renderOptions),e.resize()};var i=o;if(void 0===i.fieldOptions.striped&&(i.fieldOptions.striped=!0),i._view=[],i._viewMap={},i._ignoreNotifications=!1,n.supportSettings()&&(i._settingsName=i.getSettingsName("basicgrid"),i._settings=n.getFieldSettings(i._settingsName)),i._settings){var r=i.fieldOptions.columns||[],a=i._settings.columns||[],s={};r.forEach(function(e){s[e.$bind]=e}),a.forEach(function(e){var t=s[e.$bind];if(t){var n=e.options||{},o=t.options||{};n.width&&(o.width=n.width),n.frozen&&(o.frozen=n.frozen),n.display&&(o.display=n.display),e.options=o}}),i.fieldOptions.columns=a,i._settings.columns=null}return i.fieldOptions&&i.fieldOptions.total&&i.fieldOptions.total.property&&(i._totalProperty=i.fieldOptions.total.property,i._totalField=i.fieldOptions.total.field,n.registerListenerFor(i._totalProperty,i)),i._state(),i.checkOptions(i.fieldOptions),i._initOrigColumns(i.fieldOptions),i._initCols(i.fieldOptions),i._details=[],i._onselectItemHandler=i._onselectItem.bind(i),o}return __extends(y,g),y.prototype._initOrigColumns=function(e){var t=this;t._originalCols={},e.columns=e.columns||[],e.columns.forEach(function(e){e.options=e.options||{},e.$bind===a.EXPANDED_FIELD_NAME&&e.options.display&&(t._originalCols[e.options.display]=$.extend(!0,{},e),t._originalCols[e.options.display].options._expandItem=!0)})},y.prototype.checkOptions=function(e){void 0===e.allowColumnMove&&(e.allowColumnMove=!0),e.align=e.align||"middle"},y.prototype.beforeSaveSettings=function(){var e=this;return!!e._settingsName&&(e._settings={columns:[]},(e.renderOptions.columns||[]).forEach(function(t){var n={$bind:t.$bind,options:null},o={};t.canStartDragHandler&&(o.frozen=!0),t.options.width&&(o.width=t.options.width),t.options.display&&(o.display=t.options.display),t.options.frozen&&(o.frozen=t.options.frozen),t.options._expandItem&&(n.$bind=a.EXPANDED_FIELD_NAME),n.options=o,e._settings.columns.push(n)}),e.form.setFieldSettings(e._settingsName,e._settings),!0)},y.prototype._inplaceEditValue2Model=function(e,t,n){var o=t.getState(n.$bind),i=f.text2Value(e,n.schema,o);return i!==t.getValue(n.$bind)&&(t.setValue(n.$bind,i),!0)},y.prototype.setFocus=function(e){var t=this,o=t.form.getState(t.$bind);if(!o.isDisabled&&!o.isHidden)if(t.inplace&&t.inplace.input&&t.inplace.isInputElement)t.inplace.input.focus();else if(t.$element){var i=n.query(t.$element.get(0),'[tabindex="0"]');i&&i.focus()}},y.prototype._inplaceEditAcceptKeys=function(e){var t=this;if(t.inplace.schema.enum){if(e===n.keys.VK_UP||e===n.keys.VK_DOWN)return!1}else if(f.isDate(t.inplace.schema)&&r.utils.useDatePicker()&&(e===n.keys.VK_UP||e===n.keys.VK_DOWN||e===n.keys.VK_LEFT||e===n.keys.VK_RIGHT))return!1;return!0},y.prototype._inplaceEditAddEvents=function(){var e=this;e.inplace.schema.enum&&$(e.inplace.input).on("change",function(t){var n=e.inplace.td,o=e._td2value(n),i=e._inplaceEditGetValue(o);e._inplaceEditValue2Model(i,o.item,o.col)||e._modifyCell(o.item,o.col.$bind,n)})},y.prototype._inplaceEditRemoveEvents=function(){var e=this;e.inplace.schema.enum?$(e.inplace.input).off("change"):f.isDate(e.inplace.schema)&&r.utils.useDatePicker()&&r.utils.datePickerDestroy($(e.inplace.parent))},y.prototype._inplaceEditGetValue=function(e){var t=this;if(!e.item)return null;var n=e.item.getState(e.col.$bind);if(t.inplace.schema.enum){var o=t.inplace.input.selectedIndex;return n.filter?t.inplace.schema.filters[n.filter][o]:t.inplace.schema.enum[o]}return r.utils.text2value(t.inplace.input.value,t.inplace.schema,n)},y.prototype._inpaceEditShow=function(e,o){var i=this,a=i._td2value(e),l=a.item.getValue(a.col.$bind),u=a.item.getState(a.col.$bind),c=f.value2Text(l,a.col.schema,u);e.tabIndex=-1;var d={nativeNumber:!1,nativeDate:!1,type:"text",after:null,id:null};a.col.$lookup?(d.after={icon:"chevron-down"},d.id=e.id||t.allocID(),e.id=d.id):f.isDate(a.col.schema)?(d.nativeDate=r.utils.nativeDate(),d.nativeDate?d.type="date":r.utils.useDatePicker()&&(d.after={icon:"calendar"})):f.isNumber(a.col.schema)&&(d.nativeNumber=r.utils.nativeNumber(),d.nativeNumber&&(d.type="number")),i.inplace=s.createInplaceEdit(c,l,u,e,a,a.col,d),a.col.$lookup&&(i.inplace.id=d.id,i.inplace.col=a.col,i._createGridPopup()),i._inplaceEditAddEvents(),i.inplace.isInputElement?(i.inplace.input.tabIndex=0,i.inplace.input.focus(),i.inplace.canSelect&&n.select(i.inplace.input)):(e.tabIndex=0,e.focus()),i._onFrozenFocusScroll(e,a.col)},y.prototype._destroyInplaceEdit=function(){var e=this;e.inplace&&(e.inplace.combo&&(e.inplace.combo.destroy(),e.inplace.combo=null),e.inplace=null)},y.prototype._inplaceEditRemove=function(e,t){var o=this;if(o.inplace&&!t){var i=o.inplace.td;e&&(i.tabIndex=0);var r=o._td2value(i);if(o._inplaceEditRemoveEvents(),o.inplace.parent&&n.remove(o.inplace.parent),n.removeClass(i,"focused"),!!o.inplace.input){var a=o._inplaceEditGetValue(r);if(o._destroyInplaceEdit(),!r.item)return;if(r.col.$lookup){if(a!==(r.item.getValue(r.col.$bind)||"")+"")return o._findValue(a,r,function(e){o._setRemoteValue(r.col,r.item,e),o._modifyCell(r.item,r.col.$bind,i)});o._modifyCell(r.item,r.col.$bind,i)}else o._inplaceEditValue2Model(a+"",r.item,r.col)||o._modifyCell(r.item,r.col.$bind,i)}}o._destroyInplaceEdit()},y.prototype._inplaceEditModel2Control=function(e,t,n){var o=this,i=o._td2value(n),a=(o._inplaceEditGetValue(i),e.getValue(i.col.$bind)),l=e.getState(i.col.$bind),u=f.value2Text(a,i.col.schema,l),c={nativeNumber:r.utils.nativeNumber(),nativeDate:r.utils.nativeDate()};s.updateInplaceEdit(o.inplace,u,a,l,n,i,i.col,c)},y.prototype.removeEvents=function(){var e=this;e._scrollableMaster&&$(e._scrollableMaster).off("scroll"),e._scrollableMaster=null,e._scrollableHeaderOfMaster=null,e._scrollableFooterOfMaster=null,e._drag&&(d.dragManager.rmvDrag(e._drag),e._drag=null)},y.prototype._onFrozenFocusScroll=function(e,t){var n=this;if(t&&t.options&&t.options.frozen){var o=n.renderOptions;s.hasFrozenColumns(o,n.frozenColumns)&&o.scrolling&&o.scrolling.vertical&&(n._rsFrozenTimer&&(n._rsFrozenTimer.clearTimeout(),n._rsFrozenTimer=null),n.syncMasterScroll(null))}},y.prototype.setEvents=function(e){var t=this;if(e.scrolling&&e.scrolling.vertical){var o=t.$element.get(0);t._scrollableMaster=n.find(o,t.id+"_master_scroll"),t._scrollableHeaderOfMaster=n.find(o,t.id+"_table_header_content"),t._totalProperty&&(t._scrollableFooterOfMaster=n.find(o,t.id+"_table_footer_content"));var i=s.hasFrozenColumns(e,t.frozenColumns);t._scrollableFrozenContent=i?n.find(o,t.id+"_frozen_scroll"):null,t._deltaHScrollContent=i?n.find(o,t.id+"_frozen_scroll_delta"):null,t._scrollableMaster&&t._scrollableHeaderOfMaster&&$(t._scrollableMaster).on("scroll",t.syncHeaderAndFrozenScroll.bind(t))}if((e.allowColumnResize||e.allowColumnMove)&&!e.headerIsHidden||e.rowMove){var r=d.dragManager.addDrag([t.$element.get(0)]);t._drag=r,r.canStartDragHandler=t._canStartDrag.bind(t),r.onDragStart=t._onDragStart.bind(t),r.onDrag=t._onDrag.bind(t),r.onDragEnd=t._onDragEnd.bind(t)}},y.prototype._getColsInfo=function(e,n){var o=[];return e.forEach(function(e,i){var r=n.childNodes[i];r.id||(r.id=t.allocID()),o.push({htmlId:r.id,info:e})}),o},y.prototype._canStartDrag=function(e){var o=this,i=e.target,r=n.attr(i,"data-drag"),a=o.renderOptions,s=null;if(a.headerIsHidden||!a.allowColumnResize&&!a.allowColumnMove||(s=n.parentByTag(o.$element.get(0),i,"th")),s){var l=o.renderOptions;return!(l.headerIsHidden||!l.allowColumnResize&&!l.allowColumnMove)&&(r||(r=n.attr(s,"data-drag")),!!r&&(s.id||(s.id=t.allocID()),o._drag.data.op=r,o._drag.data.cloneId=s.id,o._drag.data.column=n.attr(s,"colId"),!!o._drag.data.column&&o["_cdd"+r](e)))}var u=a.rowMove?n.parentByTag(o.$element.get(0),e.target,"td"):null;if(u){var c=o._td2cell(u);if(c){o.renderOptions;if(o._findById(c.row))return o._drag.data.op="rowmove",o._drag.data.row=c.row,o._drag.coverDocument=!1,o._drag.cursor="default",o._drag.moveSourceName="rowmove",!0}}return!1},y.prototype._onDragStart=function(e){var t=this;return!!t._drag.data.op&&t["_sdd"+t._drag.data.op](e)},y.prototype._onDrag=function(e){var t=this;return!!t._drag.data.op&&t["_ddd"+t._drag.data.op](e)},y.prototype._onDragEnd=function(e,t){var n=this;return!!n._drag.data.op&&n["_edd"+n._drag.data.op](e,t)},y.prototype._cddresize=function(e){var t=this;if(!t.renderOptions.allowColumnResize)return!1;var n=t._drag;return n.coverDocument=!0,n.cursor="col-resize",n.moveX=!0,!0},y.prototype._sddresize=function(e){var t=this,o=t._drag;o.floatParent=t._gridParentFocus();var i=n.find(o.floatParent,t._drag.data.cloneId),r=n.position(i,o.floatParent);return o.floatElement=s.resizeDiv(o.floatParent,{left:Math.round(r.left+i.offsetWidth)}),o.minLeft=Math.round(r.left+20),o.maxLeft=Math.round(r.left+2e3),!0},y.prototype._dddresize=function(e){return!0},y.prototype._eddresize=function(e,t){var o=this,i=o._drag;if(i&&(i.floatElement&&(n.remove(i.floatElement),i.floatElement=null),!e)){var r=o._colByField(i.data.column),a=p.point(t).x-i.startPoint.x,s=n.find(i.floatParent,o._drag.data.cloneId),l=parseInt(r.options.width+"",10);if(s.offsetWidth-l>5){var u=l/s.offsetWidth;a=Math.round(u*a)}var c=Math.min(Math.max(20,l+a),2e3);o._updateColWidth(r,c),o.savePreferences(function(){})}},y.prototype._updateColWidth=function(e,t){var n=this;if(Math.max(parseInt(e.options.width||"0",10),2e3)!==t){e.options.width=t;var o=e.options.frozen&&n.renderOptions.allowFrozenColumns,i=s.getColumnsSizeParents(n.id,n.$element.get(0),n.renderOptions,o);s.setColumnWidth(e.$bind,i,t),o&&s.updateFrozenWidth(n.$element.get(0),n.id,n.frozenColumns),n.resize()}},y.prototype._cddmove=function(e){var t=this,o=t.renderOptions;if(!o.allowColumnMove)return!1;var i=t.$element.get(0),r=t._drag,a=n.find(i,r.data.cloneId);r.coverDocument=!0,r.cursor="move",r.moveX=!0,r.moveY=!0,r.startOffset=n.position(a,null);var s,l,u={firstDelta:0,lastDelta:-10,delta:-4,top:r.startOffset.top,height:a.offsetHeight};if(o.allowFrozenColumns&&(s=n.find(i,t.id+"_frozen_cols"))&&(l=n.childrenPositions(s,t._getColsInfo(t.frozenColumns,s),!1,"frozen",u)),u.lastDelta=0,s=n.find(i,t.id+"_cols")){var c=n.childrenPositions(s,t._getColsInfo(t.columns,s),!1,"free",u);l=l?l.concat(c):c}return r.data.childrenPositions=l,!0},y.prototype._cddrowmove=function(e){var t=this;if(!t.renderOptions.rowMove)return!1;t.$element.get(0),t._drag;return!0},y.prototype._sddrowmove=function(e){var o=this,i=o.renderOptions;if(!i.rowMove)return!1;if(i.rowMove.multiselect&&(!i.selecting||!i.selecting.row||!i.selecting.multiselect))return!1;var r=i.rowMove.expression||"{{$id}}",a=o._drag,l=o._findById(o._drag.data.row);if(i.rowMove.multiselect&&l.$select)return!1;var u=$('<div><span class="bs-row-in-drag">'+t.escapeHtml(t.execAngularExpression(r,l))+"</span></div>").get(0);return a.floatElement=s.cloneForMove(u),a.floatElement.style.left=e.pageX-5+"px",a.floatElement.style.top=e.pageY-5+"px",n.append(document.body,a.floatElement),a.moveX=!0,a.moveY=!0,a.data.item=l,i.rowMove.multiselect&&(a.data.multiSelTarget=o._openMultiselectSummary(null,!0)),!0},y.prototype._dddrowmove=function(e){return!0},y.prototype._eddrowmove=function(e,t){var o=this,i=o._drag;if(i&&(i.floatElement&&(n.remove(i.floatElement),i.floatElement=null),!e&&t&&i.data.multiSelTarget)){var r=p.point(t),a=n.position(i.data.multiSelTarget,null);if(r.x>a.left&&r.x<a.left+i.data.multiSelTarget.offsetWidth&&r.y>a.top&&r.y<a.top+i.data.multiSelTarget.offsetHeight){var s=o.renderOptions;if(o.state.value){var l=o.state.value;l.selecting(!0,s.expandingProperty);try{i.data.item.select(!0,s.selecting&&s.selecting.row&&s.selecting.multiselect,o.state.value,s.expandingProperty,s.expanding&&s.expanding.selectChildren)}finally{l.selecting(!1,s.expandingProperty)}}}}},y.prototype._sddmove=function(e){var t=this,o=t._drag,i=n.find(t.$element.get(0),o.data.cloneId);return o.floatElement=s.cloneForMove(i),n.append(document.body,o.floatElement),!0},y.prototype._eddmove=function(e,t){var o=this,i=o._drag;if(i&&(i.floatElement&&(n.remove(i.floatElement),i.floatElement=null),i.data.mdiv&&(n.remove(i.data.mdiv),i.data.mdiv=null),!e&&i.data.best&&i.data.column)){var r=i.data.best.info,a=o._mapCols[i.data.column];if("empty"===i.data.best.position)a.column.options.frozen=!a.column.options.frozen;else{if(r.$bind===a.column.$bind)return;var s=o._mapCols[r.$bind],l=a.column,u=s.column,c=a.tindex,d="after"===i.data.best.position?s.tindex+1:s.tindex,p=!1;if(!!l.options.frozen!=!!u.options.frozen&&(l.options.frozen=u.options.frozen,p=!0),c===d-1){if(!p)return}else o.renderOptions.columns.splice(c,1),c<d&&d--,o.renderOptions.columns.splice(d,0,l)}o.savePreferences(function(){o._refreshGrid()})}},y.prototype._dddmove=function(e){var t=this._drag,o=p.point(e),i=n.findNearest(o.x,o.y,t.data.childrenPositions);if(t.data.best!=i){var r={left:i.left,top:i.top,width:i.width,height:i.height};t.data.mdiv=n.showMove(t.data.mdiv,i.vertical,r,"frozen"===i.zone?"bs-drag-color-success":"bs-drag-color-info")}return t.data.best=i,!0},y.prototype.destroy=function(){var e=this;e._destroyDetails(),e.columns&&(e.columns.forEach(function(e){e.schema=null}),e.columns=null),e.frozenColumns&&(e.frozenColumns.forEach(function(e){e.schema=null}),e.frozenColumns=null),e._totalProperty&&e.form.unRegisterListenerFor(e._totalProperty,e),e._inplaceEditRemove(!1,!0),e._onselectItemHandler=null,e._eventBus&&(e._eventBus.destroy(),e._eventBus=null),e._pager&&(e._pager.destroy(),e._pager=null),e.toolBar&&(e.toolBar.destroy(),e.toolBar=null),e._details=null,e._mapCols=null,e._originalCols=null,e._settings=null,e._scroller=null,e._rsTimer=null,e._rsFrozenTimer=null,e._scrollableMaster=null,e._scrollableHeaderOfMaster=null,e._scrollableFooterOfMaster=null,e._scrollableFrozenContent=null,e._deltaHScrollContent=null,g.prototype.destroy.call(this)},y.prototype._moveToPage=function(e){var t=this;t.state.value&&t.state.value.currentPage(e)},y.prototype._onselectPage=function(e){var t=this;switch(e){case"next":t._moveToPage(Math.min(t._pager.props.totalPages,t._pager.props.currentPage+1));break;case"prev":t._moveToPage(Math.max(0,t._pager.props.currentPage-1));break;case"first":t._moveToPage(1);break;case"last":t._moveToPage(t._pager.props.totalPages);break;default:t._moveToPage(e)}},y.prototype.setColumns=function(e){var t=this;t.renderOptions.columns=e.map(function(e){var n=t._colByField(e.$bind);return n||(n=t._originalCols[e.$bind]),n&&(n.options._expandItem&&(e.$bind=a.EXPANDED_FIELD_NAME),e.options=n.options),e}),t.savePreferences(function(){t._refreshGrid()})},y.prototype._getMultiselectdItems=function(){var e=this,t=[],n=e.renderOptions,o=e.state.value;if(o)return o.enumSelectedItems(n.expandingProperty,function(e){t.push(e)}),t},y.prototype._updateMultiselectSummary=function(e){var t=this,n=t.renderOptions;n.rowMove&&n.rowMove.multiselect&&n.selecting&&n.selecting.row&&n.selecting.multiselect&&(t._timeOutSelected&&window.clearTimeout(t._timeOutSelected),t._timeOutSelected=window.setTimeout(function(){var e=t._getMultiselectdItems();e.length?t._openMultiselectSummary(e,!1):t._closeMultiselectSummary(!0,!1)},100))},y.prototype._openMultiselectSummary=function(e,t){var o=this,i=n.find(o.$element.get(0),o.id+"_ms");return i?(e||(e=o._getMultiselectdItems()),t&&s.isMultiselectMinimized(i)&&s.setMultiselectMinimized(!1,o.id,i),s.createMultiselectItems(o.id,i,o.renderOptions,e)):i=o._toggleMultiselectSummary(e,t),i},y.prototype._closeMultiselectSummary=function(e,t){var o=this,i=n.find(o.$element.get(0),o.id+"_ms");if(e)i&&o._toggleMultiselectSummary(null,!1);else if(t&&i){var r=!s.isMultiselectMinimized(i);s.setMultiselectMinimized(r,o.id,i)}},y.prototype._toggleMultiselectSummary=function(e,t){var o=this,i=n.find(o.$element.get(0),o.id+"_ms");if(i)return n.remove(i),null;e||(e=o._getMultiselectdItems()),i=s.multiselectContainer(o.id,t),s.createMultiselectItems(o.id,i,o.renderOptions,e);var r=n.find(o.$element.get(0),o.id+"_focus");return r&&n.append(r,i),i},y.prototype._renderToolbar=function(){var e=this;if(e.toolBar&&m.toolBarRender){var t=e.fieldOptions.toolbar||{},o=t.parentName&&!e.options.design?e.form.getLayoutElementByName(t.parentName):null,i=e.$element.get(0);o?(n.addClass(o,"bs-field-group"),n.removeClass(o,"no-x-padding")):o=n.find(i,e.id+"_header");var r=n.find(i,e.id+"_bottom");m.toolBarRender($(o),e.toolBar,$(r))}},y.prototype._createToolbar=function(){var e=this;m.toolBarFactory&&(e.toolBar=m.toolBarFactory(e))},y.prototype._state=function(){g.prototype._state.call(this);var e=this,t=e.fieldOptions;if(e.state.value){if(e.state.value.isQueryable()){var n=$.extend({size:"default",selectPage:e._onselectPage.bind(e)},t.pager||{});e._pager=new o.Pager(n);var i=e._pager;i.props.totalPages=e.state.value.totalPages(),i.props.currentPage=e.state.value.currentPage()}e._createToolbar()}},y.prototype._destroyDetails=function(){var e=this;if(e._details){var t=o.formManager();e._details.forEach(function(e){var n=t.formByName(e);n&&n.destroy()}),e._details=[]}},y.prototype._destroyDetailById=function(e){var t=this,n=t._details.indexOf(e);n>=0&&t._details.splice(n,1);var i=o.formManager().formByName(e);i&&i.destroy()},y.prototype._initCols=function(e){var t=this;t._mapCols={},e.columns&&e.columns.length||(e.columns=[{$bind:"$index"}]),t.columns=[],t.frozenColumns=[];var n=e.columns.findIndex(function(e){return f.isSelectField(e.$bind)});e.selecting&&e.selecting.row&&e.selecting.multiselect?n<0&&e.columns.splice(0,0,{$bind:a.SELECTED_FIELD_NAME,options:{width:50,frozen:!0}}):n>=0&&e.columns.splice(n,1);var o=!!e.expandingProperty,r=e.scrolling&&e.scrolling.vertical||e.editing;e.columns.forEach(function(n,a){var l=$.extend({},n);if(l.options=l.options||{},o&&f.isExpandField(n.$bind)&&(l.schema=f.getSchema(n.$bind,t.$schemaItems,t.form.$rootSchema,!1),l.$bind=e.expandingProperty+n.$bind,l.options.icons={1:e.expanding&&e.expanding.plus?e.expanding.plus:"plus",2:e.expanding&&e.expanding.minus?e.expanding.minus:"minus"},l.options.align=l.options.align||"left",l.options.alignIcon=l.options.alignIcon||"left",l.options._clickable=!0,l.options._expandItem=!0,e.expanding&&(e.expanding.style&&(l.options._expandItemClass=e.expanding.style),e.expanding.iconClass&&(l.options.iconClass=e.expanding.iconClass))),l.schema||(l.schema=f.getSchema(n.$bind,t.$schemaItems,t.form.$rootSchema,!1)),l.schema||l.schema)if(l.options.$lookup&&(l.$lookup=t.form.getLookupForSchema(t.$bind+"."+l.$bind,l.options.$lookup)),t._mapCols[l.$bind])console.log("Duplicate column name  : "+n.$bind);else{if(l.title=i.tt(l.options.title||l.schema.title,t.form.$locale),l.options.display&&(l.options.displaySchema=f.getSchema(l.options.display,t.$schemaItems,t.form.$rootSchema,!1),!l.title&&l.options.displaySchema&&(l.title=i.tt(l.options.displaySchema.title,t.form.$locale))),f.isLink(n.$bind)&&(l.isLink=!0),r&&!l.options.width&&(l.options.width=s.widthFromSchema(l.schema)),l.options.frozen&&e.allowFrozenColumns)return l.options.width?v(l.options.width)||(l.options.width=50):l.options.width=s.widthFromSchema(l.schema),t.frozenColumns.push(l),void(t._mapCols[l.$bind]={column:l,index:t.frozenColumns.length-1,tindex:a});t.columns.push(l),t._mapCols[l.$bind]={column:l,index:t.columns.length-1,tindex:a}}else console.log("Field (bind) not found : "+n.$bind)})},y.prototype._colByField=function(e){var t=this._mapCols[e];return t?t.column:null},y.prototype._totalChanged=function(e,t,n,o,i){var r=this;if(r.$element){if(r._ignoreNotifications)return!1;switch(o){case"propchange":if(e===r._totalProperty)r._renderTotalRows();else{r.form.getValue(r._totalProperty);var a=f.parsePath(r._totalProperty,e,""),s=i[a];if(s){var l=e.substr(a.length+1);r._modifyFooterCell(s,l)}}}}},y.prototype.changed=function(e,t,o,i,r){var a=this;if(a.$element){if(a._ignoreNotifications)return!1;if(!(e.substr(a.$bind.length).indexOf(".$selected")>=0)){var l=a.renderOptions.hideWhenNoRows;r.checkChildren&&"propchange"===i&&e===a.$bind&&(l=!0,!0,a.state.value=a.form.getValue(a.$bind));var u=!1,c=!1,d=!1;if(a._totalProperty){if(0===e.indexOf(a._totalProperty))return void a._totalChanged(e,t,o,i,r);r.checkChildren&&"propchange"===i&&e===a._totalProperty&&a._totalChanged(a._totalProperty,t,o,i,r)}switch(a.state.value||(i="none"),i){case"count":var p=a.toolBar;p&&p.setValue&&p.setValue("count",a.state.value.totalCount());break;case"filter":var m=a.toolBar;m&&m.setValue&&m.setValue("filter",a.state.value.filter.title||"");break;case"pagination":var h=a._pager;h&&(h.props.totalPages=a.state.value.totalPages(),h.props.currentPage=a.state.value.currentPage());break;case"sorting":a._updateSorting();break;case"propchange":if(e===a.$bind)a._renderRows(!0,"",null,!1),c=!0,d=!0,l=!0;else{var v=e,g=f.parsePath(a.$bind,v,a.renderOptions.expandingProperty),y=r[g];if(y){var _=e.substr(g.length+1);if(!_)return;a._modifyCell(y,_),f.isSelectField(_)&&(a.renderOptions.noRowSelectedIndicator||s.setRowsSelected(y.$id,y.$select,a.fieldOptions,a.$element.get(0)),a._updateMultiselectSummary(!1))}}break;case"add":a._createRow(r.$value),c=!0,u=!0,l=!0;break;case"remove":a.renderOptions.expandingProperty?(a._renderRows(!0,"",null,!1),c=!0):(a._removeRow(r.$id),u=!0),l=!0}l&&a._isHidden()!==n.hasClass(a.$element.get(0),"bs-none")&&(a.setHidden(a.$element.get(0)),c=!0),u&&a._updOddEven(),c&&a.resize(),d&&a._selectFirstCell("model",null)}}},y.prototype._modifyTD=function(e,t,o){var i=this,a=i.renderOptions,s=i._colByField(t);if(s){var l=e.getState(t),u=s.options||{},c=(a.editing||f.isSelectField(t))&&!l.isDisabled&&!l.isReadOnly&&!l.isHidden;if(n.empty(o),!l.isHidden){var d=null,p=i._viewMap[e.$id],m=p?p.level||0:0;u.display&&u.displaySchema&&(d=r.utils.displayValue(e.getValue(u.display),u.displaySchema,i.form.$locale,{html:!0,tableOptions:a,avanced:u.displayOptions||{},state:e.getState(u.display)},e,u.display));var h=r.utils.displayValue(e.getValue(t),s.schema,i.form.$locale,{html:!0,useSymbol:!1,editable:c,selectable:!l.isDisabled,check:a.editing,avanced:u,tableOptions:a,display:d,level:m,state:l},e,t);if(h.html){var v=$(h.value);n.append(o,v.get(0))}else{var g=h.value;""===g&&(g=String.fromCharCode(160)),n.append(o,document.createTextNode(g))}}}},y.prototype._findTR=function(e,t){var o=this,i=o.renderOptions,r=e+(t.options.frozen&&i.allowFrozenColumns?"_frozen":"");return n.find(o.$element.get(0),r)},y.prototype._id2rowId=function(e){var t=e.indexOf("_frozen");return t>0&&(e=e.substring(0,t)),e},y.prototype._findtBody=function(e){var t=this,o=t.renderOptions,i=t.id+(e.options.frozen&&o.allowFrozenColumns?"_frozen_rows":"_rows");return n.find(t.$element.get(0),i)},y.prototype._modifyFooterCell=function(e,t){var n=this;if(n.$element){var o=n._colByField(t);if(o){var i=n._findTR(e.$id,o);i&&n._findCellAndModify(e,i,t)}}},y.prototype._findCellAndModify=function(e,t,o){for(var i=this,r=0,a=t.childNodes.length;r<a;r++){var s=t.childNodes[r];if(n.attr(s,"colid")===o){if(i.inplace&&i.inplace.input&&i.inplace.td===s)return void i._inplaceEditModel2Control(e,o,s);i._modifyTD(e,o,s)}}},y.prototype._modifyCell=function(e,t,n){var o=this;if(o.$element){var i=o._colByField(t);if(i){if(n)return o.inplace&&o.inplace.input&&o.inplace.td===n?void o._inplaceEditModel2Control(e,t,n):o._modifyTD(e,t,n);var r=o._findTR(e.$id,i);r&&o._findCellAndModify(e,r,t)}}},y.prototype._rootElement=function(){return this.$element?this.$element.get(0):null},y.prototype._gridParentFocus=function(){var e=this;return e.$element?n.find(e.$element.get(0),e.id+"_focus"):null},y.prototype._setErrors=function(t,o){var i=this,r=i.state.errors;if(o&&e.bootstrap4){r&&r.length?n.addClass(o,"is-invalid"):n.removeClass(o,"is-invalid")}i.showErrors(o,r)},y.prototype._setTableFocus=function(e){var t=this,o=n.find(t.$element.get(0),t.id+"_table");o&&(e?n.addClass(o,"focused"):n.removeClass(o,"focused")),(o=n.find(t.$element.get(0),t.id+"_table_frozen"))&&(e?n.addClass(o,"focused"):n.removeClass(o,"focused"))},y.prototype.focusIn=function(e){var t=this;if(t.$element)if(t._setTableFocus(!0),t.selectedCell){var n=t._cell(t.selectedCell,!0);if(n||(t.selectedCell=null,t._selectFirstCell("focusin",null),t.selectedCell&&(n=t._cell(t.selectedCell,!0))),!n)return;t.canEdit(t.selectedCell)&&!t.inplace&&t._inpaceEditShow(n.td,!0)}else t._inplaceEditRemove(!1,!1)},y.prototype.focusOut=function(e){var t=this;t.$element&&(t._setTableFocus(!1),t._inplaceEditRemove(!0,!1))},y.prototype._doTab=function(e){var t=this;return e?t._moveRightSelectedCell():t._moveLeftSelectedCell()},y.prototype.keypress=function(e){var t=this,o=this._gridParentFocus();if(n.isChildOf(o,e.target)&&t.selectedCell&&t.inplace&&n.isChildOf(t.inplace.td,e.target)){var i=t._td2value(t.inplace.td);if(f.isNumber(t.inplace.schema)){if(!1===r.utils.keyPressNumber(e,t.inplace.input,{decimalSep:c.number.decimal,thousandSep:c.number.thousand,places:t.inplace.decimals,schema:t.inplace.schema}))return!1}else if(f.isDate(t.inplace.schema)){if(!1===r.utils.keyPressDate(e,t.inplace.input,{sep:c.date.daySep,format:c.date.dateShort,schema:t.inplace.schema}))return!1}else if(f.isBoolean(t.inplace.schema)){if(" "===String.fromCharCode(e.which)&&t.fieldOptions.editing){var a=i.item.getRelativeState(i.col.$bind);if(!a.isDisabled&&!a.isReadOnly){var s=i.item.getValue(i.col.$bind);i.item.setValue(i.col.$bind,!s)}}e.preventDefault()}}},y.prototype.keydown=function(e){var t=this,o=e.which||e.keyCode,i=this._gridParentFocus();if(n.isChildOf(i,e.target)){var a=!1;if(t.inplace&&n.isChildOf(t.inplace.td,e.target)){if(!t._inplaceEditAcceptKeys(o))return;if(t.inplace.combo&&(o===n.keys.VK_F4||o===n.keys.VK_DOWN&&e.ctrlKey))t._toggleGridLookup();else if(f.isNumber(t.inplace.schema)){if(!1===r.utils.keyDownNumber(e,t.inplace.input,{decimalSep:c.number.decimal,thousandSep:c.number.thousand,places:t.inplace.decimals,schema:t.inplace.schema}))return}else if(f.isDate(t.inplace.schema)&&!1===r.utils.keyDownDate(e,t.inplace.input,{sep:c.date.daySep,format:c.date.dateShort,schema:t.inplace.schema}))return}if(!h(e,o)){if(t.fieldOptions.selecting&&t.fieldOptions.selecting.cell)switch(o){case n.keys.VK_TAB:a=t._doTab(!e.shiftKey);break;case n.keys.VK_UP:a=t._moveUpSelectedCell(1);break;case n.keys.VK_DOWN:a=t._moveDownSelectedCell(1)}a&&e.preventDefault()&&e.stopPropagation()}}},y.prototype._toggleGridLookup=function(){var e=this;e.inplace&&e.inplace.combo&&(e.inplace.combo.opened?m.gridlookup.closeGridLookup(e.inplace,e._eventBus,"combo"):e._openGridLookup())},y.prototype._createGridPopup=function(){var t=this;t._eventBus||(t._eventBus=new e.serial.SingleEventBus(50));var n=t.inplace.input,o=t.$element.get(0);t.inplace.combo=m.gridlookup.checkGridPopup(t,t.inplace.col.$lookup,n,o)},y.prototype._searchText=function(){var e=this;if(e.inplace&&e.inplace.combo){var t=e.inplace.col,n=e._td2cell(e.inplace.td);if(n){var o=e._findById(n.row);if(o){var i=o.getValue(t.$bind,null)||"",r=e.inplace.input.value||"";if(r!==i)return r}}}return""},y.prototype._getSource=function(e,t){var n=this;return t.fieldName=e.col.$lookup.mapping[e.col.$bind],t.paginated=!0,t.containerId=n.form.syncTransactionId(),t.viewId=n.form.syncViewId(),f.executeLookup(e.col.$lookup,e.item,t)},y.prototype._findValue=function(e,t,n){var o=this;if(e||""!==e){var i={search:e,select:!1,findFirst:!0,find:!1,paginated:o.renderOptions.paginated};o._eventBus.push(o._getSource(t,i),function(e){e=o._filterResult(e,i,t.col.$lookup,t.col.$bindp,t.col.$display),n(e&&e.value&&e.value.length?e.value[0]:null)},!0)}else o._eventBus.push(null,function(e){n(null)},!0)},y.prototype._filterResult=function(e,t,n,o,i){if(e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(n.data&&n.data.$params&&n.data.$params.$allData){var r=f.findFirst(t.search,f.remoteSearch(f.lastSegment(o,o),n),e.documents);return r?{value:[r.item]}:null}e.value=e.documents,delete e.documents}return e},y.prototype._setRemoteValue=function(e,t,n){var o=Object.keys(e.$lookup.mapping),i=f.extractBase(e.$bind),r=[],a=!1;o.forEach(function(o){if(e.$lookup.mapping[o]){var s=t.getValue(i+o,null)||"",l=n?n[e.$lookup.mapping[o]]||"":"";""===l&&("number"==typeof s?l=0:"boolean"==typeof s&&(l=!1)),l!==s&&(t.setValue(i+o,l,null),a=!0)}else r.push(o)}),a&&r.forEach(function(n){t.setValue(i+n,e.$lookup.mapping[n])})},y.prototype._onselectItem=function(e){var t=this;if(t.inplace&&t.inplace.combo){var n=t.inplace.col,o=t._td2cell(t.inplace.td);if(o){var i=t._findById(o.row);i&&t._eventBus.push(e,function(e){t._setRemoteValue(n,i,e)},!0)}}},y.prototype._openGridLookup=function(){var e=this;e.inplace.combo.opened||m.gridlookup.openGridLookup(e.inplace,{lookup:e.inplace.col.$lookup,parentControl:e,formControl:e.form,display:e.inplace.col.$bind,bind:e.inplace.col.$bind,containerId:e.form.syncTransactionId(),viewId:e.form.syncViewId(),align:e.inplace.id,openerId:e.inplace.id+"_after",searchText:e._searchText(),onselect:e._onselectItemHandler,lookupColumns:e.inplace.col.options.lookupColumns?e.inplace.col.options.lookupColumns:void 0,propertyName:"combo"})},y.prototype.checkFocus=function(e){var n=this;t.nextTick(function(){var e=window.document.activeElement;e&&n.targetInControl(e)||(n.focusOut(null),n.focused=!1)})},y.prototype.focusInControl=function(e){var t=this,o=t._gridParentFocus(),i=n.isChildOf(o,e);return!i&&t.inplace&&t.inplace.combo&&t.inplace.combo.opened?t.inplace.combo.focusInCombo(e):i},y.prototype._tr2rowId=function(e,t){var n=e.id;if(t&&t.options.frozen){var o=n.indexOf("_frozen");o>0&&(n=n.substring(0,o))}return n},y.prototype._td2cell=function(e){var t=this,o=e.parentNode,i=(o.parentNode,t._colByField(n.attr(e,"colid")));if(!i)return null;var r=t._tr2rowId(o,i);return t._findById(r)&&i?{row:r,col:n.attr(e,"colid")}:null},y.prototype._td2value=function(e){var t=this,o=e.parentNode,i=(o.parentNode,t._colByField(n.attr(e,"colid"))),r=t._tr2rowId(o,i);return{item:t._findById(r),col:i}},y.prototype.mousedown=function(e){var t=this,o=this._gridParentFocus();if(!n.isChildOf(o,e.target))return!0;var i=n.parentByTag(t.$element.get(0),e.target,"td");if(i){var r=t.renderOptions,a=t._td2cell(i);a&&(t._selectCell(a,e,!0)?e.preventDefault():r.selecting&&r.selecting.row&&!r.selecting.cell&&!r.selecting.multiselect&&t._selectRow(a.row))}return!0},y.prototype._addRows=function(e,t){var n=this;n._renderRows(!1,e.$id,t,!1),n._updOddEven()},y.prototype._removeRows=function(e,t){var n=this;t.forEach(function(e){n._removeRow(e.value.$id)}),n._updOddEven()},y.prototype.dblclick=function(e){var t=this,o=t.renderOptions;if(o.doubleClick){var i=n.parentByTag(t.$element.get(0),e.target,"td");if(i){var r=t._td2cell(i);if(r){var a=t._findById(r.row);t.form.execAction(t.$bind+".$links."+o.doubleClick,a)}}}},y.prototype.click=function(e){var t=this;if(t.state.value){var o=t.renderOptions,i=n.parentByTag(t.$element.get(0),e.target,"td");if(i){var r=t._td2cell(i);if(r){var a=t._findById(r.row),s=t._colByField(r.col);if(a){var l=e&&e.target&&e.target.$link||e.target.parentNode.$link;if(l){var c=a.getRelativeState(s.$bind);if(c.isDisabled||c.isHidden)return;s.schema.$widgetAction?t[s.schema.$widgetAction]&&t[s.schema.$widgetAction](a):t.form.execAction(t.$bind+".$item."+l,a)}else if(s){if(t.inplace&&t.inplace.input&&t.inplace.td===i)return void(t.inplace.combo&&(e.target.id!==t.inplace.id+"_after"&&e.target.parentNode.id!==t.inplace.id+"_after"||t._toggleGridLookup()));if(s.options._expandItem){if((n.attr(e.target,"data-clickable")||n.attr(e.target.parentNode,"data-clickable"))&&!(v=a.getRelativeState(s.$bind)).isDisabled&&!v.isReadOnly){var d=a.toggleExpand(o.expandingProperty);t._ignoreNotifications=!0;try{var p=[],m=t._viewMap[a.$id];if(a.enumVisibleChildren(o.expandingProperty,m.level,!0,function(e,t){var n={level:t,value:e};p.push(n)}),!p.length)return;d?t._addRows(a,p):t._removeRows(a,p)}finally{t._ignoreNotifications=!1}}}else if(s.options.$link)n.findByAttribute(e.target,i,"data-phoenix-href")&&((v=a.getRelativeState(s.$bind)).isDisabled||u.execLink(s.options.$link,{$item:a},null));else if(s.options.actionName)(v=a.getRelativeState("$links."+s.options.actionName))&&!v.isDisabled&&t.form.execAction(t.$bind+".$item.$links."+s.options.actionName,a);else if(f.isSelectField(s.$bind)||o.editing&&f.isBoolean(s.schema)){if(n.attr(e.target,"data-clickable")&&!(v=a.getRelativeState(s.$bind)).isDisabled&&!v.isReadOnly&&!v.isHidden){var h=a.getValue(s.$bind);if(f.isSelectField(s.$bind)){(E=t.state.value).selecting(!0,o.expandingProperty);try{a.select(!h,o.selecting&&o.selecting.row&&o.selecting.multiselect,t.state.value,o.expandingProperty,o.expanding&&o.expanding.selectChildren)}finally{E.selecting(!1,o.expandingProperty)}}else a.setValue(s.$bind,!h)}}else if(o.selecting&&o.selecting.row&&!o.selecting.multiselect&&o.selecting.action){var v=a.getRelativeState("$links."+o.selecting.action);v&&!v.isDisabled&&t.form.execAction(t.$bind+".$item.$links."+o.selecting.action,a)}}}}}else{var g=n.parentByTag(t.$element.get(0),e.target,"th");if(g){var y=n.attr(g,"colid");if(y){var _=t._colByField(y),$=_.options.display?_.options.displaySchema:_.schema;if(!$||!_)return;if(f.isSelectField(_.$bind)&&o.selecting&&o.selecting.row&&o.selecting.multiselect&&o.selecting.selectAll){var b=n.parentByTag(t.$element.get(0),e.target,"center");if(b){var x=n.query(b,".bs-bool-edit");if(x){var C=n.iconClass("check-square-o",!0),k=n.iconClass("square-o",!0),w=n.hasClass(x,C);w?(n.removeClass(x,C),n.addClass(x,k)):(n.removeClass(x,k),n.addClass(x,C));var E=t.state.value;if(w){E.selecting(!0,o.expandingProperty);try{t._getMultiselectdItems().forEach(function(e){e.select(!1,o.selecting&&o.selecting.row&&o.selecting.multiselect,t.state.value,o.expandingProperty,!1)})}finally{E.selecting(!1,o.expandingProperty)}}else{E.selecting(!0,o.expandingProperty);try{E.forEach(function(e,n,i){e.select(!0,o.selecting&&o.selecting.row&&o.selecting.multiselect,t.state.value,o.expandingProperty,!1)},o.expandingProperty,!0)}finally{E.selecting(!1,o.expandingProperty)}}}}}else if(o.sorting&&f.canSort($)){var P=$.orderBy?$.orderBy:_.options.display?_.options.display:_.$bind,O=P;t.state.value.$orderby()===P&&(O=P.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 1===t.length?t.push("desc"):t[1]="desc"===t[1]?"asc":"desc",t.join(" ")}).join(",")),t.state.value.isQueryable()?t.state.value.$orderby(O):t.state.value&&t.form.execAction(t.state.value.getJSONPatchPath()+".$sort",O)}}}else if(e.target.id===t.id+"_close_ms")t._closeMultiselectSummary(!1,!0);else{var S=n.parentByAttr(t.$element.get(0),e.target,"data-ms-unselect");if(S){var I=n.attr(S,"data-ms-unselect");if(a=t._findById(I)){(E=t.state.value).selecting(!0,o.expandingProperty);try{a.select(!1,o.selecting&&o.selecting.row&&o.selecting.multiselect,t.state.value,o.expandingProperty,o.expanding&&o.expanding.selectChildren)}finally{E.selecting(!1,o.expandingProperty)}}}}}}},y.prototype._setDisabled=function(e,t){var n=this;e.disabled=n.state.isDisabled},y.prototype._showSelected=function(e,t,o,i){var r=this;if(!e)return null;var a=r._cell(e,!1);a&&a.td&&(t?(n.addClass(a.td,"bs-cell-selected"),r._inplaceEditRemove(!1,!1),o&&(r.focused||i)?r._inpaceEditShow(a.td,!1):(a.td.tabIndex=0,(r.focused||i)&&a.td.focus()),r._onFrozenFocusScroll(a.td,r._colByField(e.col))):(n.removeClass(a.td,"bs-cell-selected"),a.td.tabIndex=-1))},y.prototype.canSelect=function(e){var t=this,n=t.selectedCell;if(n&&n.col===e.col&&n.row===e.row)return!1;if(!t.fieldOptions.selecting||!t.fieldOptions.selecting.cell)return!1;var o=t._colByField(e.col);if(o){if(o.options&&!1===o.options.selecting)return!1;var i=t._findById(e.row);if(i){var r=i.getState(o.$bind);return!r.isDisabled&&!r.isHidden}}return!1},y.prototype.canEdit=function(e){var t=this;if(!t.fieldOptions.editing||!t.fieldOptions.selecting||!t.fieldOptions.selecting.cell)return!1;var n=t._colByField(e.col);if(n.options&&!1===n.options.editing)return!1;if(n.isLink)return!1;if(n.options._expandItem)return!1;var o=t._findById(e.row).getState(n.$bind);return!o.isReadOnly&&!o.isDisabled&&!o.isHidden},y.prototype._selectRow=function(e){var t=this,n=t.renderOptions;if(t.state.value){var o=n.selecting&&n.selecting.row&&n.selecting.multiselect,i=t._findById(e);if(i){var r=t.state.value;r.selecting(!0,n.expandingProperty);try{i.select(!0,o,t.state.value,n.expandingProperty)}finally{r.selecting(!1,n.expandingProperty)}}}},y.prototype._selectCell=function(e,t,n){var o=this;if(!o.canSelect(e)){if(n){var i=o.selectedCell;return(!i||i.row!==e.row)&&o._selectFirstCell("mouseDown",e.row)}return!1}var r=o.selectedCell,a=o.canEdit(e);a&&(o.selectedCell=e),o._showSelected(e,!0,a,n),o.selectedCell=e,r?o._showSelected(r,!1,!0,n):o._gridParentFocus().tabIndex=-1;var s=o.renderOptions;return s.selecting&&s.selecting.row&&!s.selecting.multiselect&&o._selectRow(e.row),!0},y.prototype._selectFirstCell=function(e,t){var o=this,i=o.fieldOptions;if(!i.selecting||!i.selecting.cell)return!1;var r=n.find(o.$element.get(0),o.id+"_rows");if(!r.childNodes.length)return!1;for(var a=null,s=o.frozenColumns.concat(o.columns),l=0,u=s.length;l<u;l++){var c=s[l],d=void 0;if(t)d=t;else{i.allowFrozenColumns&&c.options.frozen&&(r=n.find(o.$element.get(0),o.id+"_frozen_rows"));var p=r.firstChild;d=o._tr2rowId(p,c)}if(a={col:c.$bind,row:d},o.canSelect(a))break;a=null}return!!a&&o._selectCell(a,null,!1)},y.prototype._cell=function(e,t){var o=this,i=o._mapCols[e.col],r=i.index,a=o._findTR(e.row,i.column);if(!a)return null;var s={td:a.childNodes[r],tr:a,rIndex:-1,cIndex:-1};return t&&(s.rIndex=n.indexOf(a.parentNode,a),s.cIndex=r),s},y.prototype._moveUpSelectedCell=function(e){var t=this;if(!t.selectedCell)return t._selectFirstCell("keydown",null);var n=t._colByField(t.selectedCell.col),o=t._cell(t.selectedCell,!0);if(!o)return t.selectedCell=null,t._selectFirstCell("keydown",null);var i=Math.max(o.rIndex-e,0);if(i!=o.rIndex){var r=t._findtBody(n).childNodes[i];return t._selectCell({row:t._id2rowId(r.id),col:t.selectedCell.col},null,!1)}return!1},y.prototype.resize=function(){this._resize()},y.prototype._updateFrozenColumnsHeight=function(){var e=this,t=e.renderOptions;if(e._scrollableFrozenContent){if(!(t.height&&"auto"!==t.height||t.minHeight))return;var o=void 0;o=e._scrollableMaster.scrollWidth>e._scrollableMaster.clientWidth?n.scrollbar()+"px":"0px",e._deltaHScrollContent.style.height!==o&&(e._deltaHScrollContent.style.height=o,e._vscroll())}},y.prototype._resize=function(){var e=this,t=e.renderOptions;if(t.scrolling&&t.scrolling.vertical&&(e.$element||console.log("Invalid resize call"),e._scrollableMaster)){n.position(e._scrollableMaster,null);if(t.bottom){var o=n.documentViewSize();if(e._scrollableMaster){var i=n.position(e._scrollableMaster,null),r=(e.$element.get(0),Math.max(0,o.height-i.top-t.bottom));e._scrollableMaster.style.height=r+"px",e._scrollableFrozenContent&&(e._scrollableFrozenContent.style.height=r+"px")}}s.hasFrozenColumns(t,e.frozenColumns)&&(n.scrollbar()&&e._updateFrozenColumnsHeight(),e._vscroll())}},y.prototype.syncHeaderAndFrozenScroll=function(e){var t=this;t._scroller&&"master"!==t._scroller||(t._scroller="master",t._hscroll(),t._vscroll(),t._removeScroller())},y.prototype.syncMasterScroll=function(e){var t=this;t._scroller&&"frozen"!==t._scroller||(t._scroller="frozen",t._vsmcroll(),t._removeScroller())},y.prototype._removeScroller=function(){var e=this;e.fieldOptions.editing?(e._rsTimer&&window.clearTimeout(e._rsTimer),e._rsTimer=window.setTimeout(function(){e._scroller=null,e._rsTimer=null},50)):e._scroller=null},y.prototype._vscroll=function(){var e=this;if(e._scrollableFrozenContent){var t=e._scrollableMaster.scrollTop;t!==e._scrollableFrozenContent.scrollTop&&(e._scrollableFrozenContent.scrollTop=t)}},y.prototype._vsmcroll=function(){var e=this,t=e._scrollableMaster.scrollTop,n=e._scrollableFrozenContent.scrollTop;t!==n&&(e._scrollableMaster.scrollTop=n)},y.prototype._hscroll=function(){var e=this,t=e._scrollableMaster.scrollLeft;t!==e._scrollableHeaderOfMaster.scrollLeft&&(e._scrollableHeaderOfMaster.scrollLeft=t),e._scrollableFooterOfMaster&&t!==e._scrollableFooterOfMaster.scrollLeft&&(e._scrollableFooterOfMaster.scrollLeft=t)},y.prototype._moveDownSelectedCell=function(e){var t=this;if(!t.selectedCell)return t._selectFirstCell("keydown",null);var n=t._cell(t.selectedCell,!0);if(!n)return t.selectedCell=null,t._selectFirstCell("keydown",null);var o=t._colByField(t.selectedCell.col),i=t._findtBody(o),r=Math.min(n.rIndex+e,i.childNodes.length-1);if(r!=n.rIndex){var a=i.childNodes[r];return t._selectCell({row:t._id2rowId(a.id),col:t.selectedCell.col},null,!1)}return!1},y.prototype._moveRightSelectedCell=function(){var e=this;if(!e.fieldOptions.selecting||!e.fieldOptions.selecting.cell)return!1;if(!e.selectedCell)return e._selectFirstCell("keydown",null);var t=e.frozenColumns.concat(e.columns).map(function(e){return e.$bind}),n=t.indexOf(e.selectedCell.col),o=e._findById(e.selectedCell.row);if(!o||n<0)return!1;for(var i=n+1,r=t.length;i<r;i++){s={col:a=t[i],row:o.$id};if(e.canSelect(s))return e._selectCell(s,null,!1)}if(o=e._findNext(o.$id))for(var i=0,r=n;i<=r;i++){var a=t[i],s={col:a,row:o.$id};if(e.canSelect(s))return e._selectCell(s,null,!1)}return!1},y.prototype._moveLeftSelectedCell=function(){var e=this;if(!e.fieldOptions.selecting||!e.fieldOptions.selecting.cell)return!1;if(!e.selectedCell)return e._selectFirstCell("keydown",null);var t=e.frozenColumns.concat(e.columns).map(function(e){return e.$bind}),n=t.indexOf(e.selectedCell.col),o=e._findById(e.selectedCell.row);if(!o||n<0)return!1;for(i=n-1;i>=0;i--){a={col:r=t[i],row:o.$id};if(e.canSelect(a))return e._selectCell(a,null,!1)}if(o=e._findPrev(o.$id))for(var i=t.length-1;i>=n;i--){var r=t[i],a={col:r,row:o.$id};if(e.canSelect(a))return e._selectCell(a,null,!1)}return!1},y.prototype._state2UI=function(e){var t=this,o=t._rootElement(),i=t.$element?t.$element.get(0):null;if(o&&(t._setDisabled(o,i),t.setHidden(i),t._setErrors(o,i),e||t._selectFirstCell("model",null),t._renderToolbar(),t._pager)){var r=$(n.find(i,t.id+"_pagination"));t._pager.render(r)}},y.prototype.afterAddedInDom=function(){this._selectFirstCell("model",null)},y.prototype._isHidden=function(){var e=this;return e.state.isHidden||!e.state.value||e.renderOptions.hideWhenNoRows&&!e.state.value.length},y.prototype.setHidden=function(e){e&&(this._isHidden()?n.addClass(e,"bs-none"):n.removeClass(e,"bs-none"))},y.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n._rootElement(),r=n.$element?n.$element.get(0):null;e&&"isHidden"!==e||o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(r)),e&&"isDisabled"!==e||o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,r)),e&&"errors"!==e||l.errorChanged(n.state.errors,o.errors)&&(n.state.errors=o.errors,n._setErrors(i,r)),e&&"orderBy"!==e||n._updateSorting()},y.prototype.stopProppagation=function(e){var t=this,o=e.target,i=t.$element.get(0),r=this._gridParentFocus();if(n.isChildOf(r,e.target))for(;o;){if(o===i)return;o.href&&(e.preventDefault(),e.stopPropagation()),o=o.parentNode}},y.prototype._buildView=function(e,t,n,o,i){var r=this,a={level:n,value:e};o=o||r._view,i=i||r._viewMap,o.push(a),i[e.$id]=a},y.prototype._findById=function(e){var t=this;if(!t.state.value)return null;if(t._useView){var n=t._viewMap[e];return n?n.value:null}return t.state.value.findById(e)},y.prototype._findByIdEx=function(e){var t=this;if(!t.state.value)return null;var n={index:-1,level:0,value:null};if(t._useView){var o=t._viewMap[e];o&&(n.index=t._view.indexOf(o),n.level=o.level,n.value=o.value)}else n.value=t.state.value.findById(e),n.value&&(n.index=t.state.value.indexOf(n.value));return n},y.prototype._findNext=function(e){var t=this;if(!t.state.value)return null;if(t._useView){if(n=t._viewMap[e]){o=t._view.indexOf(n);if(t._view.length>o+1)return t._view[o+1].value}}else{var n=t.state.value.findById(e);if(n){var o=t.state.value.indexOf(n);if(t.state.value.length>o+1)return t.state.value.get(o+1)}}return null},y.prototype._findPrev=function(e){var t=this;if(!t.state.value)return null;if(t._useView){if((n=t._viewMap[e])&&(o=t._view.indexOf(n))>0)return t._view[o-1].value}else{var n=t.state.value.findById(e);if(n){var o=t.state.value.indexOf(n);if(o>0)return t.state.value.get(o-1)}}return null},y.prototype._renderTotalRows=function(){var e=this;if(e.$element){var t=e.renderOptions;if(e._totalProperty){var o=e.form.getValue(e._totalProperty),i=!!e._totalField,r=void 0,a=void 0;s.hasFrozenColumns(e.renderOptions,e.frozenColumns)&&(i=!1,(r=n.find(e.$element.get(0),e.id+"_frozen_totals"))&&(a=s.createRows(e.id,o,e.frozenColumns,t,e.options.design,e.form.$locale,!0,!0,null,null),n.empty(r),n.append(r,a))),r=n.find(e.$element.get(0),e.id+"_totals"),a=s.createRows(e.id,o,e.columns,t,e.options.design,e.form.$locale,!1,!0,null,i?e._totalField:null),n.empty(r),n.append(r,a)}}},y.prototype._renderRows=function(e,t,o,i){var r=this;if(r.$element){var a=r.renderOptions,l=null;e&&(r._view=[],r._viewMap={},r._useView=!0,l=r._buildView.bind(r));var u=void 0,c=void 0;if(r._inplaceEditRemove(!1,!1),r._destroyDetails(),s.hasFrozenColumns(r.renderOptions,r.frozenColumns)&&(u=n.find(r.$element.get(0),r.id+"_frozen_rows")))if(e)c=r.state.value?s.createRows(r.id,r.state.value,r.frozenColumns,a,r.options.design,r.form.$locale,!0,!1,l,null):null,l=null,n.empty(u),c&&n.append(u,c);else{c=s.createBulkRows(r.id,o,r.frozenColumns,a,r.options.design,r.form.$locale,!0,!1,l);d=n.find(u,t+"_frozen");n.after(d,c)}if(u=n.find(r.$element.get(0),r.id+"_rows"),e)c=r.state.value?s.createRows(r.id,r.state.value,r.columns,a,r.options.design,r.form.$locale,!1,!1,l,null):null,n.empty(u),c&&n.append(u,c);else{c=s.createBulkRows(r.id,o,r.columns,a,r.options.design,r.form.$locale,!1,!1,l);var d=n.find(u,t);n.after(d,c)}}if(!e){var p=r._viewMap[t],f=r._view.indexOf(p);r._view.splice(f,0,o),o.forEach(function(e){r._viewMap[e.value.$id]=e})}r._updateMultiselectSummary(i)},y.prototype.editDetail=function(e){var t=this,i=e.$id;if(t.$element){var r=t.renderOptions;if(s.hasFrozenColumns(r,t.frozenColumns))return;var a=n.find(t.$element.get(0),t.id+"_rows"),l=n.find(a,i+"_detail");if(l)return;var u=n.find(a,i);if(u){l=s.createDetail(i,u);var d=t.renderOptions.rows;if(!d||!d.detail||!d.detail.layout)throw new Error('Grid options missing: "options.rows.detail.layout".');var p=d.detail.layout;"string"==typeof p&&t.renderOptions.layouts&&t.renderOptions.layouts[p]&&(p=t.renderOptions.layouts[p]),"object"==typeof p&&((p=$.extend(!0,{},p)).name&&(p._name=p.name),p.name=i);var f=e.getSchema();"object"==typeof f&&(f.links=f.links||{},f.links.$updateChanges=f.links.$updateChanges||{title:c.ui.ApplyDetailChanges});var m={};d.detail.spacing&&(m.verticalSpacing=!0),m.closeButtonHandler=function(){t.closeDetail(i)},p._name&&(m.externalLayout=p._name,m.externalSchema=t.form.options.externalSchema,m.externalLocale=t.form.options.externalLocale),m.path=t.$bind,t._details.push(i),o.OpenForm($(l.firstChild),p,t.form.$schema,e.schemaModel(!0),t.form.$locale,function(n,o,r){if("init"===n.operation)t.form.execAction("$links.$beforeEdit",o,o);else switch(n.property){case"$links.$updateChanges":if(!t.state.value.updateItem(e,o))return;e.update(o.schemaModel(!1)),t.form.execAction("$links.$afterUpdateChanges",e,e),t.closeDetail(i)}},m),n.after(u,l)}}},y.prototype.closeDetail=function(e){var t=this;if(t._destroyDetailById(e),t.$element){var o=n.find(t.$element.get(0),e+"_detail");o&&n.remove(o)}},y.prototype._removeRow=function(e){var t=this;if(t._destroyDetailById(e),t._viewMap){var o=t._viewMap[e];if(o){delete t._viewMap[e];var i=t._view.indexOf(o);i>=0&&t._view.splice(i,1)}}if(t.$element){var r=[],a=n.find(t.$element.get(0),e);a&&r.push({element:a,columns:t.columns}),s.hasFrozenColumns(t.renderOptions,t.frozenColumns)&&(a=n.find(t.$element.get(0),e+"_frozen"))&&r.push({element:a,columns:t.frozenColumns}),r.forEach(function(o){var i=o.element.parentNode,r=n.find(i,e+"_detail");if(r&&n.remove(r),i.firstChild===o.element&&t.renderOptions.headerIsHidden&&!t.renderOptions._useColGrp&&i.childNodes.length>1){var a=i.childNodes[1];o.columns.forEach(function(e,t){var n=a.childNodes[t];e.options.width&&(n.style.width=s.ensureWidth(e.options.width)),e.options.minWidth&&(n.style.minWidth=s.ensureWidth(e.options.minWidth))})}n.remove(o.element)})}},y.prototype._updOddEven=function(){var e=this;if(!e.renderOptions._useStripedCss&&e.renderOptions.striped&&e.$element){var t=n.find(e.$element.get(0),e.id+"_rows");s.updateEvenOdd(t),(t=n.find(e.$element.get(0),e.id+"_frozen_rows"))&&s.updateEvenOdd(t)}},y.prototype._createRow=function(e){var t=this;if(t.$element){var o=0,i=t._viewMap[e.$id];i?i=t._viewMap[e.$id]:(i={level:0,value:e},t._view.push(i),t._view.push(e.$id),o=t._view.length-1,t._viewMap[e.$id]=i);var r=void 0,a=void 0;s.hasFrozenColumns(t.renderOptions,t.frozenColumns)&&(r=n.find(t.$element.get(0),t.id+"_frozen_rows"),a=s.createRow(t.id,o,i.level,i.value,t.frozenColumns,t.renderOptions,t.options.design,t.form.$locale,r.childNodes.length%2==1,!0,!1),n.append(r,a)),r=n.find(t.$element.get(0),t.id+"_rows"),a=s.createRow(t.id,o,i.level,i.value,t.columns,t.renderOptions,t.options.design,t.form.$locale,r.childNodes.length%2==1,!1,!1),n.append(r,a)}},y.prototype.filtrableColumns=function(){var e=this,t=e.$schema,n=e.$schemaItems;return t&&"array"===t.type&&n&&"object"===n.type?f.filtrableFields(n,e.form.$rootSchema,e.form.$locale):[]},y.prototype._getColumnsFromSchema=function(){var e=this,t=e.$schema,n=e.$schemaItems;return t&&"array"===t.type&&n&&"object"===n.type?f.columns(n,e.form.$rootSchema,e.form.$locale):[]},y.prototype._getSelectedColumns=function(){var e=this,t={};return Object.keys(e._mapCols).forEach(function(n){var o=e._mapCols[n].column;o.options._expandItem&&o.options.display&&(n=o.options.display),t[n]=!0}),t},y.prototype._getGroupsFromSchema=function(){var e=this,t=e.$schema,n=e.$schemaItems;return t&&"array"===t.type&&n&&"object"===n.type&&n.groups?n.groups:{}},y.prototype.getColumnsForSettings=function(){var e=this;return{schemaGroups:e._getGroupsFromSchema(),schemaColumns:e._getColumnsFromSchema(),selectedColumns:e._getSelectedColumns(),locale:e.form.$locale}},y.prototype.getColumnsForFilter=function(e){var t=this,n={schemaGroups:t._getGroupsFromSchema(),schemaColumns:t.filtrableColumns(),locale:t.form.$locale,mongoFilter:e,filters:void 0};return e&&m.glbMongoFilter2Filter&&(n.filters=m.glbMongoFilter2Filter(t.state.value.filter,t.filtrableColumns())),n},y.prototype.getColumnsForFilterExpress=function(e){var t,n=this;if(e&&Array.isArray(e)){var o=n._getColumnsFromSchema();t=[],e.forEach(function(e){o.every(function(n){return e!==n.name||(t.push(n),!1)})})}else t=n._getColumnsFromSchema();var i=[];return t.forEach(function(e){var t=e.schema,n={code:e.name,lib:t.title||t.name,type:t.type,selected:!0};t.enum&&(n.enum=t.enum),t.enumNames&&(n.enumNames=t.enumNames),i.push(n)}),i},y.prototype._updateSorting=function(){var e=this,t=e.renderOptions;if(e.$element&&t&&t.sorting&&!t.headerIsHidden){if(!e.state.value)return;var o=n.find(e.$element.get(0),e.id+"_cols");o&&s.updSorting(t,o,e._colByField.bind(e),e.state.value.$orderby()),(o=n.find(e.$element.get(0),e.id+"_frozen_cols"))&&s.updSorting(t,o,e._colByField.bind(e),e.state.value.$orderby())}},y.prototype._renderColumns=function(e){var t=this;if(t._inplaceEditRemove(!1,!1),e._useColGrp){var o=e.scrolling&&e.scrolling.vertical,i=o&&!e.headerIsHidden?n.find(t.$element.get(0),t.id+"_colgrp_header"):null;if(i&&(n.empty(i),n.append(i,s.createColGroup(t.columns,e,!1))),i=n.find(t.$element.get(0),t.id+"_colgrp"),n.empty(i),n.append(i,s.createColGroup(t.columns,e,!1)),e.total&&e.total.property&&(i=n.find(t.$element.get(0),t.id+"_colgrp_footer"))&&(n.empty(i),n.append(i,s.createColGroup(t.columns,e,!0))),s.hasFrozenColumns(e,t.frozenColumns)){var r=o&&!e.headerIsHidden?n.find(t.$element.get(0),t.id+"_colgrp_frozen_header"):null;r&&(n.empty(r),n.append(r,s.createColGroup(t.frozenColumns,e,!0))),(r=n.find(t.$element.get(0),t.id+"_colgrp_frozen"))&&(n.empty(r),n.append(r,s.createColGroup(t.frozenColumns,e,!0))),e.total&&e.total.property&&(r=n.find(t.$element.get(0),t.id+"_colgrp_frozen_footer"))&&(n.empty(r),n.append(r,s.createColGroup(t.frozenColumns,e,!0)))}}if(!e.headerIsHidden){var a=n.find(t.$element.get(0),t.id+"_cols");n.empty(a),n.append(a,s.createCols(t.id,t.columns,e,t.options.design,t.form.$locale,t.state.value?t.state.value.$orderby():null,!1)),s.hasFrozenColumns(e,t.frozenColumns)&&(a=n.find(t.$element.get(0),t.id+"_frozen_cols"))&&(n.empty(a),n.append(a,s.createCols(t.id,t.frozenColumns,e,t.options.design,t.form.$locale,t.state.value?t.state.value.$orderby():null,!0)))}e.allowFrozenColumns&&s.updateFrozenWidth(t.$element.get(0),t.id,t.frozenColumns)},y.prototype.toggleMultiselect=function(){var e=this;if(e.$element){var t=e.renderOptions;if(t.selecting&&t.selecting.row){if(t.selecting.multiselect=!t.selecting.multiselect,e.state.value){var n=e.state.value;n.selecting(!0,t.expandingProperty);try{e.state.value.updateSelecting(t.selecting.multiselect,t.expandingProperty)}finally{n.selecting(!1,t.expandingProperty)}}e.savePreferences(function(){e._refreshGrid()})}}},y.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.$schema.description&&(n.description=i.tt(t.$schema.description,t.form.$locale)),t.$element=$(s.gridContainer(t.id,n,t.options.design,t.$schema.title,t.form.$locale,t.columns,t.frozenColumns)),t._renderColumns(n),t._renderRows(!0,"",null,!0),t._renderTotalRows(),t._state2UI(!0),t.setEvents(n)),t.appendElement(e,n),t.$element},y}(e.ui.AbsField);m.BasicGrid=g,o.registerControl(g,"array",!1,"",null),o.registerControl(g,"array",!1,"basicgrid",null)}(e.formgrid||(e.formgrid={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils,n=e.ui,o=e.dom,i=e.ulocale,r=e.Observable.errorsUtils,a=e.uiutils;!function(s){function l(n,o,i,r){var s=e.bootstrap4;r=r||"",o=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},o);var l=[];return a.utils.fieldWrapper(l,o,i,function(){o.columns&&(l.push('<div class="no-x-padding '+(s?"ml-sm-auto":"col-sm-offset-"+o.labelCol)+" col-sm-"+(12-o.labelCol)+'">'),l.push('<div class="checkbox">'));var e=!1;o.inline||o.columns||(e=!0,l.push('<div class="checkbox">')),s?(l.push('<label id="{0}_check" class="custom-control custom-checkbox">'),l.push('<input type="checkbox" id="{0}_input" class="custom-control-input">'),l.push('<span class="custom-control-indicator" > </span>'),l.push('<span class="custom-control-description"> '),l.push(t.escapeHtml(r||"")),l.push("&nbsp;"),l.push("</span>"),a.utils.addErrorDiv(l,!1),l.push("</label>")):(l.push('<label id="{0}_check" class="'+(o.inline?s?"form-check-inline no-x-padding":"checkbox-inline":e?s?"form-control-label":"control-label":"checkbox")+'">'),l.push('<input type="checkbox" id="{0}_input">'),o.inline?s&&l.push("&nbsp;"):l.push("&nbsp;"),l.push(t.escapeHtml(r||"")),s&&a.utils.addErrorDiv(l,o.inline),l.push("</label>")),s||a.utils.addErrorDiv(l),o.inline||o.columns||l.push("</div>"),o.columns&&(l.push("</div>"),l.push("</div>"))}),t.format(l.join(""),n)}var u=function(t){function n(e,n,o){var i=t.call(this,e,n,o)||this;return i._state(),i}return __extends(n,t),n.prototype._input=function(){var e=this;if(!e.$element)return null;var t=e.$element.get(0);return o.find(t,e.id+"_input")},n.prototype._check=function(){var e=this;if(!e.$element)return null;var t=e.$element.get(0);return o.find(t,e.id+"_check")},n.prototype.click=function(e){var t=this,n=t._input(),o=n.checked||!1;e.target==n&&t.state.value!=o&&(t._isBinded?(t.state.value=o,t.form.setValue(t.$bind,o)):t.setInternalValue(o,!0))},n.prototype._setDisabled=function(e,t){var n=this,i=n._check();n.state.isDisabled||n.state.isReadOnly?o.addClass(i,"disabled"):o.removeClass(i,"disabled"),e.disabled=n.state.isDisabled},n.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},n.prototype._setMandatory=function(e,t){},n.prototype._setErrors=function(t){var n=this,i=n.state.errors;if(t&&e.bootstrap4){i&&i.length?o.addClass(t,"is-invalid"):o.removeClass(t,"is-invalid")}n.showErrors(t,i)},n.prototype._state2UI=function(){var e=this,t=e._input(),n=e.$element?e.$element.get(0):null;t&&(t.checked=e.state.value||!1,e._setDisabled(t,n),e._setReadOnly(t,n),e.setHidden(n),e._setErrors(n))},n.prototype.changed=function(e,t,n,o){var i=this,r=i._input();i.state.value!=n&&(i.state.value=n,r&&(r.checked=i.state.value||!1))},n.prototype.stateChanged=function(e,t){var n=this,o=n._isBinded?n.form.getState(n.$bind):n._internalState,i=n._input(),a=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(a)),o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,a)),o.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,i&&n._setReadOnly(i,a)),o.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,i&&n._setMandatory(i,a)),e&&"errors"!==e||r.errorChanged(n.state.errors,o.errors)&&(n.state.errors=o.errors,n._setErrors(a))},n.prototype.render=function(e){var t=this,n=t._initOptions(a.utils.defaultOptions);return t.$element||(t.$element=$(l(t.id,n,t.options.design,i.tt(t.$schema.title,t.form.$locale))),t._state2UI()),t.appendElement(e,n),t.$element},n}(e.ui.AbsField);s.Check=u,n.registerControl(u,"boolean",!1,"",null)}(e.formcheck||(e.formcheck={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){e.utils;var n=e.ui,o=e.dom,i=e.uiutils,r=e.Observable.errorsUtils,a=e.gridrender.GridUtil,s=e.Observable.SchemaUtils,l=function(t){function l(e,n,o){var i=t.call(this,e,n,o)||this,r=i,a=r.fieldOptions;r._initAllColumns(),r._state();var s=a.columns.header.fields||[];a.columns.header.fields=r.form.afterSettings(r.$bind,"columngrid",{columns:s}).columns;var l=r.form.getFieldSettings(r.$bind);return l&&(r._settings=r.form.afterSettings(r.$bind,"columngrid",l)),r._initRows(),i}return __extends(l,t),l.prototype._initSchemaRows=function(e){var t=this;t.rows=[],e.forEach(function(e,n){t.rows[n]={name:e.name,canEdit:e.canEdit,check:e.check,schema:s.getSchema(e.name,t.$schemaItems,t.form.$rootSchema,!1)||{}}})},l.prototype._colByName=function(e){for(var t=this,n=0,o=t.rows.length;n<o;n++){var i=t.rows[n];if(i.name===e)return i}return null},l.prototype.setSettings=function(e){this._rrender()},l.prototype._initRows=function(){var e=this;if(!e.rows){var t=e.fieldOptions;t.columns||(t.columns={}),t.columns.header||(t.columns.header={}),t.columns.row||(t.columns.row={});var n=t.columns.header.fields||[];e._settings&&e._settings.columns&&e._settings.columns.length&&(n=e._settings.columns),e._initSchemaRows(n)}},l.prototype._initCols=function(e){var t=this;e.columns||(e.columns={}),e.columns.header||(e.columns.header={}),e.columns.row||(e.columns.row={});var n=$.extend({},e.columns.header),o=e.columns.row;n.options=n.options||{},o.options=o.options||{};var r,a=o.$bind;o.$bind?r=s.getSchema(o.$bind,t.$schemaItems,t.form.$rootSchema,!1):(a="$index",r={type:"integer"});var l=[];return l.push(n),t.state.value&&t.state.value.forEach(function(e){var n=i.utils.displayValue(e.getRelativeValue(a),r,t.form.$locale,{html:!1},e,a).value,s=$.extend({},o);s.title=n||"",s.id=e.$id,l.push(s)}),l},l.prototype._modifyRow=function(e,t,n,r,a,s,l){var u=this,c=o.find(u.$element.get(0),u.id+"_rows").childNodes[n].childNodes[r],d=i.utils.displayValue(e,t,u.form.$locale,{html:!0,useSymbol:!1,editable:a.editable,check:a.check,tableOptions:u.config.options},s,l);if(o.empty(c),d.html){var p=$(d.value);o.append(c,p.get(0))}else o.append(c,document.createTextNode(d.value))},l.prototype.changed=function(e,t,n,o,i){var r=this;if("upd"===o){var a=i&&i.$id?r.state.value.findById(i.$id):null;a&&r.rows.forEach(function(e,t){e.name===i.property&&r._modifyRow(a.getValue(e.name),e.schema,t,r.state.value.indexOf(a)+1,{editable:e.canEdit,check:e.check},a,e.name)})}},l.prototype._grid=function(){return this.$element.get(0)},l.prototype._setErrors=function(t,n){var i=this,r=i.state.errors;if(n&&e.bootstrap4){r&&r.length?o.addClass(n,"is-invalid"):o.removeClass(n,"is-invalid")}i.showErrors(n,r)},l.prototype.click=function(e){var t=this,n=o.parentByTag(t.$element.get(0),e.target,"td");if(n){var i=o.attr(n,"colId");if(i){var r=t._colByName(i);if(r&&r.canEdit&&s.isBoolean(r.schema)&&o.attr(e.target,"data-clickable")){var a=o.attr(n,"rowId"),l=a?t.state.value.findById(a):null;if(l){var u=l.getValue(r.name);l.setValue(r.name,!u)}}}}},l.prototype._setDisabled=function(e,t){},l.prototype._state2UI=function(){var e=this,t=e._grid(),n=e.$element?e.$element.get(0):null;t&&(e._setDisabled(t,n),e.setHidden(n),e._setErrors(t,n))},l.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n._grid(),a=n.$element?n.$element.get(0):null;e&&"isHidden"!==e||o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(a)),e&&"isDisabled"!==e||o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,a)),e&&"errors"!==e||r.errorChanged(n.state.errors,o.errors)&&(n.state.errors=o.errors,n._setErrors(i,a))},l.prototype._renderRows=function(){var e=this;if(e.$element){var t=o.find(e.$element.get(0),e.id+"_rows");o.empty(t),o.append(t,a.createGridRows(e.id,e.rows,e.state.value,e.columns,e.renderOptions,e.options.design,e.form.$locale))}},l.prototype._draw=function(e){var t=this;if(t.columns=t._initCols(t.fieldOptions),e._useColGrp){var n=o.find(t.$element.get(0),t.id+"_colgrp");o.empty(n),o.append(n,a.createColGroup(t.columns,e,!1))}if(!e.headerIsHidden){var i=o.find(t.$element.get(0),t.id+"_cols");o.empty(i),o.append(i,a.createCols(t.id,t.columns,e,t.options.design,t.form.$locale,"",!1))}t._renderRows(),t._state2UI()},l.prototype._rrender=function(){var e=this;e.$element&&e._draw(e.renderOptions)},l.prototype.render=function(e){var t=this,n=t._initOptions(i.utils.defaultOptions);if(!t.$element)return t.columns=t._initCols(t.fieldOptions),t.$element=$(a.gridContainer(t.id,n,t.options.design,t.$schema.title,t.form.$locale,t.columns,null)),t._draw(n),t.appendElement(e,n),t.$element},l.prototype._createRow=function(e){var t=this;if(t.$element){var n=o.find(t.$element.get(0),t.id+"_rows"),i=a.createRow(t.id,e,0,t.state.value.get(e),t.columns,t.renderOptions,t.options.design,t.form.$locale,e%2==1,!1,!1);n.childNodes.length>=e?o.append(n,i):o.before(n.childNodes[e],i)}},l.prototype._initAllColumns=function(){var e=this,t=e.fieldOptions;e._allColumns=[],e._allColumnsNames=[],t.columns||(t.columns={}),t.columns.header||(t.columns.header={});t.columns.header.allFields.forEach(function(t){e._allColumns.push($.extend({},t)),e._allColumnsNames.push(t.name)})},l.prototype._selectedColumns=function(){var e=this,t=[],n=[];return e.rows.forEach(function(e){t.push(e.name)}),e._allColumns.forEach(function(o){var i=s.getSchema(o.name,e.$schemaItems,e.form.$rootSchema,!1);t.indexOf(o.name)>=0&&n.push({name:o.name,title:i.title})}),n},l.prototype._initDataSettings=function(){var e=this,t={$type:"block",$items:[{$type:"block",$items:[]},{$type:"block",$items:[{$bind:"columns",$widget:"basicgrid",options:{border:!0,align:"middle",small:!0,noRowSelectedIndicator:!0,headerIsHidden:!0,selecting:{row:!0,multiselect:!0},columns:[{$bind:"caption",options:{width:"100%"}}]}}]},{$type:"block",$items:[]}]},n={properties:{columns:{type:"array",items:{type:"object",properties:{name:{type:"string"},caption:{type:"string"}}}}}},o={columns:[]},i=[];return e.rows.forEach(function(e){i.push(e.name)}),e._allColumns.forEach(function(t){var n=s.getSchema(t.name,e.$schemaItems,e.form.$rootSchema,!1);o.columns.push({name:t.name,caption:n.title,$select:i.indexOf(t.name)>=0})}),{schema:n,data:o,layout:t}},l.prototype.sendMessage=function(e,t){var n=this;switch(e){case"column-list":n.openColumns(t);break;case"selected-cols":return n._selectedColumns()}},l.prototype.stopProppagation=function(e){e.preventDefault(),e.stopPropagation()},l.prototype.openColumns=function(e){var t=this,o=t._initDataSettings(),i={title:e.title||"Columns ...",buttons:[{type:"success",title:e.okTitle||"OK",name:"ok"}]};n.OpenModalForm(i,o.layout,o.schema,o.data,{},function(e,n,o,i){if("modal-action"===n.operation)switch(n.property){case"ok":var r={columns:[]};o.columns.forEach(function(e){if(e.$select){var n=t._allColumnsNames.indexOf(e.name);n>=0&&r.columns.push($.extend({},t._allColumns[n]))}}),t._settings=r,t.form.setFieldSettings(t.$bind,t._settings),t.form.savePrefs(function(){t._settings=t.form.afterSettings(t.$bind,"columngrid",r),t.rows=null,t._initRows(),e.close(),t._rrender()})}})},l}(e.ui.AbsField);n.registerControl(l,"array",!1,"columngrid",null)}(e.formcolumngrid||(e.formcolumngrid={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.pagecontrol,o=t.Observable.SchemaUtils,i=t.utils,r=t.dom;!function(e){var a=function(){function e(e,t,i){this.opened=!1;var r=this;r.page=n.Page(),r.opened=!1,r.currentList=null,r.$parent=e,r._checkOptions(i),r.options=i,r.$input=t,r.keys=o.pkFields(r.options.primaryKey)}return e.prototype.click=function(e){var n=this,o=t.bootstrap4,i=r.parentByTag(n.$element.get(0),e.target,o?"a":"li");if(i){var a=i.pk;if(a){var s=n._map(),l=n._selectByPk(a,s);l&&n._doSelect(l,!0)}}},e.prototype.inMenu=function(e){var t=this;return!(!e||!t.$element)&&r.isChildOf(t.$element.get(0),e)},e._itemHeight=function(){var e=this;if(!e.itemHeight){var n=void 0;n=t.bootstrap4?$('<div class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><a tabindex="-1" class="dropdown-item" href="#">A</a></div>').get(0):$('<ul class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><li tabindex="-1"><a tabindex="-1" href="#">A</a></li></ul>').get(0),document.body.appendChild(n);var o=n.firstChild;e.itemHeight=o.offsetHeight,e.deltaHeight=n.offsetHeight-e.itemHeight,document.body.removeChild(n)}return this.itemHeight},e.prototype._checkOptions=function(e){if(!e.primaryKey)throw new Error("Invalid options no primaryKey.");if(!e.search)throw new Error("Invalid options search field.");e.display=e.display||e.search,e.maxItems=e.maxItems||8},e.prototype._renderContent=function(){var e=this,n=t.bootstrap4;e.$element||(e.$element=n?$('<div class="dropdown-menu"></div>'):$('<ul class="dropdown-menu"></ul>'),e.$parent.get(0).appendChild(e.$element.get(0)))},e.prototype._renderElements=function(){var e=this,n=t.bootstrap4;if(e.$element||e._renderContent(),e.currentList){var a=document.createDocumentFragment(),s=e.$element.get(0);e.currentList.forEach(function(t){var s,l=o.pk2Id(o.extractPkValue(t,e.keys),e.keys);(s=n?$('<a tabindex="-1" class="dropdown-item" href="#">'+i.escapeHtml(t[e.options.display])+"</a>").get(0):$('<li class="dropdown-item" tabindex="-1"><a tabindex="-1" href="#">'+i.escapeHtml(t[e.options.display])+"</a></li>").get(0)).pk=l,r.append(a,s)}),r.empty(s),r.append(s,a)}},e.prototype._afterHide=function(e){var t=this;t.opened=!1,t.page&&t.page.setPopup(null),t.$input&&t.$input.get(0).focus()},e.prototype.hide=function(e){var t=this;if(t.opened&&t.$element){var n=t.$element.get(0);r.removeClass(n,"bs-block"),t.opened=!1,t.page&&t.page.setPopup(null)}},e.prototype._selectByListIndex=function(e,t){for(var n=0,o=e.length;n<o;n++){var i=e[n];if(i.listIndex===t)return i}return null},e.prototype._emptyHtmlList=function(){var e=this;e.$element&&r.empty(e.$element.get(0))},e.prototype._show=function(t){var n=this;if(n.$element){var o=n.$element.get(0);if(o.childNodes.length){var i=-1,a=n._map(),s=n._findSeleted(a);s&&(i=s.listIndex);var l=n.$parent.get(0).offsetWidth;if(o.style.minWidth=l+"px",o.style.maxHeight=n.options.maxItems*e._itemHeight()+e.deltaHeight+"px",o.style.overflowY="auto",r.addClass(o,"bs-block"),i!=t){if(s){var u=o.childNodes[s.index];r.removeClass(u,"active"),s.selected=!1}if(t>=0){s=n._selectByListIndex(a,t);var c=o.childNodes[s.index];r.addClass(c,"active"),s.selected=!0,n._isInView(c,o)||c.scrollIntoView(!0)}else o.scrollTop=0}n.page&&n.page.popup!=n&&n.page.setPopup(n),r.addClass(o,"bs-block"),n.opened=!0}else r.removeClass(o,"bs-block"),n._afterHide(!0)}},e.prototype.triggerBlurred=function(e){this.hide(null)},e.prototype.show=function(e,t,n){var o=this;if(!(e&&e.value&&e.value.length))return o.currentList=null,o.hide(null),void o._emptyHtmlList();o.currentList==e.value?o._show(t):(o.currentList=e.value,o._renderElements(),o._show(t))},e.prototype._map=function(){for(var e=[],t=!1,n=this.$element.get(0),o=0,i=0,a=n.childNodes.length;i<a;i++){var s=n.childNodes[i];if(s.pk){var l=!t&&r.hasClass(s,"active");l&&(t=!0),e.push({id:s.pk,index:i,selected:l,listIndex:o}),o++}}return e},e.prototype._selectByPk=function(e,t){for(var n=this,o=null,i=n.$element.get(0),a=0,s=(t=t||n._map()).length;a<s;a++){var l=t[a];if(l.id===e){if(o=l,l.selected)break;r.addClass(i.childNodes[l.index],"active"),l.selected=!0}else if(l.selected&&(r.removeClass(i.childNodes[l.index],"active"),l.selected=!1,o))break}return o},e.prototype._findSeleted=function(e){for(var t=this,n=0,o=(e=e||t._map()).length;n<o;n++){var i=e[n];if(i.selected)return i}return null},e.prototype._isInView=function(t,n){var o=this,i=t.offsetTop,r=t.offsetHeight,a=n.scrollTop,s=o.options.maxItems*e._itemHeight();return i>=a&&a+s>=i+r},e.prototype.move=function(t){var n=this;if(n.$element&&n.opened){var o=n._map(),i=n.$element.get(0),a=n._findSeleted(o),s=void 0;if(t>0){if(a){if((s=1e3===t?o.length-1:o.indexOf(a)+t)>=o.length&&(s=o.length-1,o[s].selected))return}else s=0;if(s<o.length){a&&(r.removeClass(i.childNodes[a.index],"active"),a.selected=!1);l=i.childNodes[o[s].index];r.addClass(l,"active"),o[s].selected=!0,s==o.length-1?i.scrollTop=l.offsetTop+e._itemHeight()+1:n._isInView(l,i)||l.scrollIntoView(!1),n._doSelect(o[s],!1)}}else{if(a){if((s=-1e3===t?0:o.indexOf(a)+t)<0&&(s=0,o[s].selected))return}else s=o.length-1;if(s>=0){a&&(r.removeClass(i.childNodes[a.index],"active"),a.selected=!1);var l=i.childNodes[o[s].index];r.addClass(l,"active"),o[s].selected=!0,0==s?i.scrollTop=0:n._isInView(l,i)||l.scrollIntoView(!0),n._doSelect(o[s],!1)}}}},e.prototype.select=function(){var e=this;if(e.$element&&e.opened){var t=e._findSeleted();t&&e._doSelect(t,!0)}},e.prototype._doSelect=function(e,t){var n=this;t&&(n.options.onselect&&n.options.onselect(o.findByPk(o.id2Pk(e.id,n.keys),n.keys,n.currentList)),n.hide(null))},e.prototype.inPopup=function(e){var t=this;if(t.$element){var n=t.$element.get(0).parentNode;return r.isChildOf(n,e)}return!1},e.prototype.destroy=function(){var e=this;e.options=null,e.currentList=null,e.$input=null,e.$parent=null,e.$element=null},e.itemHeight=0,e.deltaHeight=0,e}();e.DropItems=a}(e.formdropitems||(e.formdropitems={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=(n.serial,n.utils),i=n.dom,r=n.locale,a=n.Observable.SchemaUtils,s=n.ulocale,l=n.ui,u=n.uiutils,c=n.Observable.errorsUtils,d=function(e,t,o,r){var a=n.bootstrap4,s="textarea"===(r=r||"input");t.readOnly&&(r="div"),s&&(t.before||t.after)&&(delete t.before,delete t.after);var l="date-time"===t.$format,c="date"===t.$format;if(("money"===t.$format||c||l)&&void 0===t.maxWidth&&(t.maxWidth="16em"),t.before||t.after){e.push('<div class="input-group" id="{0}_group"');p=[];t.minWidth&&p.push("min-width: "+t.minWidth+";"),t.maxWidth&&p.push("max-width: "+t.maxWidth+";"),p.length&&e.push('  style="'+p.join("")+'"'),e.push(">")}t.before&&(e.push('<span class="bs-grp-btn input-group-addon">'),t.before.icon?e.push('<span class="'+i.iconClass(t.before.icon)+'"></span>'):e.push(t.before.value),e.push("</span>"));var d=["form-control"];if(t.size&&a&&d.push("form-control-"+t.size),t.inputClass&&d.push(t.inputClass),t.readOnly&&d.push("bs-read-only"),e.push("<"+r+' autocomplete="off"'+(t.readOnly?"":' type="'+(t.type||"text")+'"')+' class="'+d.join(" ")),e.push('" id="{0}_input"'),s&&e.push(' rows="'+(t.rows||3)+'"'),!t.before&&!t.after){var p=[];t.maxWidth&&p.push("max-width: "+t.maxWidth+";"),t.minWidth&&p.push("min-width: "+t.minWidth+";"),s&&t.noResize&&p.push("resize: none;"),p.length&&e.push('  style="'+p.join("")+'"')}if(t.maxLength&&e.push('  maxLength="'+t.maxLength+'"'),t.placeHolder){var f=!0===t.placeHolder?o:t.placeHolder;e.push('  placeholder="'+f+'"')}e.push(">"),t.after&&(e.push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-addon'),t.after.icon&&e.push(" bs-icon-input"),e.push('">'),t.after.icon?e.push('<span class="'+i.iconClass(t.after.icon)+'"></span>'):e.push(t.after.value),e.push("</span>")),(t.before||t.after)&&e.push("</div>"),(s||t.readOnly)&&e.push("</"+r+">"),u.utils.addErrorDiv(e)},p=function(e,t,i,r,a){r=r||"";var s=[];return(t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t)).titleIsHidden&&(t.columns=!1),t.readOnly&&(delete t.after,delete t.before),u.utils.fieldWrapper(s,t,i,function(){var e=n.bootstrap4;if(!t.titleIsHidden){s.push('<label for="{0}_input" id="{0}_label"');var i=["bs-label"];t.columns&&(e?i.push("col-form-label"):i.push("checkbox-inline bs-cursor-d"),i.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&i.push("text-left")),t.inline&&(e?i.push("form-check-inline bs-cursor-d no-x-padding"):i.push("checkbox-inline bs-cursor-d no-x-padding")),i.length&&s.push(' class="'+i.join(" ")+'"'),s.push(">"),s.push(o.escapeHtml(r||"")+(t.inline?"&nbsp;":"")),u.utils.addTooltipAndRule(s,t),s.push("</label>")}t.columns&&s.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'" id="{0}_colparent">'),d(s,t,r,a),t.columns&&s.push("</div>"),t.titleIsHidden&&t.inline&&u.utils.addTooltipAndRule(s,t)}),o.format(s.join(""),e)},f=function(t){function n(n,o,i){var r=t.call(this,n,o,i)||this,a=r;return a._search=n&&n.options&&n.options.search,a._search&&(a._searchEventBus=new e.serial.SingleEventBus(500)),a._state(),r}return __extends(n,t),n.prototype._input=function(){var e=this,t=e.$element?e.$element.get(0):null;return t?i.find(t,e.id+"_input"):null},n.prototype._colParent=function(){var e=this,t=e.$element.get(0);return e.renderOptions.columns?i.find(t,e.id+"_colparent"):null},n.prototype._value2Text=function(){var e=this;e._input();return e._isDate()?u.utils.useDatePicker()?s.parseISODate(e.state.value||"")||"":u.utils.nativeDate()?e.state.value||"":s.shortDate(e.state.value||""):e._isDateTime()?u.utils.useDateTimePicker()?s.parseISODateTime(e.state.value||"")||"":s.shortDateTime(e.state.value||""):e.state.value||""},n.prototype._isPassword=function(){return a.isPassword(this.$schema)},n.prototype._isDate=function(){return a.isDate(this.$schema)},n.prototype._isDateTime=function(){return a.isDateTime(this.$schema)},n.prototype._isMemo=function(){return a.isText(this.$schema)},n.prototype._isNumber=function(){return a.isNumber(this.$schema)},n.prototype.setFocus=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t.form.getState(t.$bind);if(!n.isDisabled&&!n.isHidden){var o=t._input();o&&o.focus()}}},n.prototype._isMoney=function(){return a.isMoney(this.$schema)},n.prototype._setDisabled=function(e,t){this.renderOptions.readOnly||(e.disabled=this.state.isDisabled)},n.prototype._setReadOnly=function(e,t){this.renderOptions.readOnly||(e.readOnly=this.state.isReadOnly)},n.prototype._setErrors=function(t,n){var o=this;if(!o.renderOptions.readOnly){var r=o.state.errors,a=e.bootstrap4?"is-invalid":"has-error";r&&r.length?(i.addClass(n,a),e.bootstrap4&&i.addClass(t,a)):(i.removeClass(n,a),e.bootstrap4&&i.removeClass(t,a)),o.showErrors(n,r)}},n.prototype._setMandatory=function(e,t){var n=this;if(!n.renderOptions.readOnly){var o=this.state.isMandatory;if(e.required=o,o?i.addClass(e,"bs-mandatory"):i.removeClass(e,"bs-mandatory"),n.renderOptions.placeHolder&&(e.placeholder=n.renderOptions.title+(o?" *":"")),!n.renderOptions.titleIsHidden){var r=i.find(t,n.id+"_label");r&&i.text(r,(n.renderOptions.title||"")+(o?" *":"")+(n.renderOptions.inline?String.fromCharCode(160):""))}}},n.prototype._state2UI=function(){var e=this,t=e._input(),n=e.$element?e.$element.get(0):null;t&&(e._value2Input(t),e._setDisabled(t,n),e._setReadOnly(t,n),e.setHidden(n),e._setMandatory(t,n),e._setErrors(t,n),e._setSymbol(n))},n.prototype._setSymbol=function(e){var t=this;if(!t.renderOptions.readOnly&&t._hasSymbol&&e){var n=i.find(e,t.id+"_after");n&&(t.state.symbol?i.text(n,t.state.symbol):i.text(n,String.fromCharCode(160)))}},n.prototype._value2Input=function(e){var t=this;t.renderOptions.readOnly?t._isDate()?i.text(e,s.shortDate(t.state.value||"")||String.fromCharCode(160)):t._isDateTime()?i.text(e,s.shortDateTime(t.state.value||"")||String.fromCharCode(160)):(t._isNumber(),i.text(e,t._value2Text()||String.fromCharCode(160))):t._isDate()?u.utils.useDatePicker()?u.utils.datePickerSetValue(t.$element,t.state.value):u.utils.nativeDate()?e.value=s.isoDatePart(t.state.value||""):e.value=s.shortDate(t.state.value||""):t._isDateTime()?u.utils.useDateTimePicker()?u.utils.dateTimePickerSetValue($(i.find(t.$element.get(0),t.id+"_group")),t.state.value):e.value=s.shortDateTime(t.state.value||""):t._isNumber()&&u.utils.nativeNumber()?e.value=t.state.value||0:e.value=t._value2Text()},n.prototype.changed=function(e,t,n,o){var i=this;if((!i.useDisplay||e!==i.$bind)&&i.$element){var r=i._input();n=i.form.getValue(i.$display),i.state.value!=n?(i.state.value=n,i._value2Input(r)):r.value!=i._value2Text()&&i._value2Input(r)}},n.prototype.stateChanged=function(e,t){var n=this;if(!n.useDisplay||e!==n.$display){var o=n.form.getState(n.$bind),i=n._input(),r=n.$element?n.$element.get(0):null;e&&"symbol"!==e||o.symbol!==n.state.symbol&&(n.state.symbol=o.symbol,i&&n._setSymbol(r)),e&&"decimals"!==e||o.decimals!==n.state.decimals&&(n.state.decimals=o.decimals),e&&"isHidden"!==e||o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(r)),e&&"isDisabled"!==e||o.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,r)),e&&"isReadOnly"!==e||o.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,i&&n._setReadOnly(i,r)),e&&"isMandatory"!==e||o.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,i&&n._setMandatory(i,r)),e&&"errors"!==e||c.errorChanged(n.state.errors,o.errors)&&(n.state.errors=o.errors,n._setErrors(i,r))}},n.prototype.destroy=function(){var e=this;e._searchEventBus&&(e._searchEventBus.destroy(),e._searchEventBus=null),t.prototype.destroy.call(this)},n}(e.ui.AbsField);t.BaseEdit=f;var m=function(e){function t(t,n,o){return e.call(this,t,n,o)||this}return __extends(t,e),t.prototype.beforeAppend=function(){},t.prototype.mousedown=function(e){var t=this;if(!t.renderOptions.readOnly&&(t._doSelect=!1,t.$element&&!t.state.isDisabled))return window.document.activeElement!==e.target&&t._input()===e.target&&(t._doSelect=!0),!0},t.prototype.stopProppagation=function(e){var t=this;if(!t.renderOptions.readOnly&&t._doSelect){var n=t._input();i.select(n)}},t.prototype.click=function(e){},t.prototype.internalRender=function(e){var t=this,n=t._initOptions(u.utils.defaultOptions);t.$element||(n.title=s.tt(t.$schema.title,t.form.$locale),n.placeHolder&&1!=n.placeHolder&&(n.title=s.tt(n.placeHolder,t.form.$locale)),n.maxLength=t.$schema.maxLength,t.$schema.description&&(n.description=s.tt(t.$schema.description,t.form.$locale)),t.$element=$(p(t.id,n,t.options.design,n.title,n.tagName)),t.beforeAppend(),t.setEvents(n),t._state2UI()),t.appendElement(e,n)},t.prototype.render=function(e){this.internalRender(e)},t.prototype._text2value=function(e){var t=this;return u.utils.text2value(e,t.$schema,t.state)},t.prototype._value2Text=function(){var t=this;return t._isNumber()?a.value2Text(t.state.value,t.$schema,t.state):e.prototype._value2Text.call(this)},t.prototype.customOptions=function(t){var n=this;e.prototype.customOptions.call(this,t),n._isDate()?n.customOptionsDate(t):n._isDateTime()?n.customOptionsDateTime(t):n._isNumber()?n.customOptionsNumber(t,n.state.symbol):n._isPassword()?n.customOptionsPassword(t):n._isMemo()&&n.customOptionsMemo(t)},t.prototype.customOptionsMemo=function(e){e.tagName="textarea"},t.prototype.customOptionsPassword=function(e){e.type="password"},t.prototype.customOptionsDate=function(e){e.$format="date",!u.utils.nativeDate()&&u.utils.useDatePicker()?(e.after={icon:"calendar"},e.date=!0):e.type="date"},t.prototype.customOptionsDateTime=function(e){e.$format="date-time",u.utils.useDateTimePicker()&&(e.after={icon:"calendar"},e.date=!0)},t.prototype.customOptionsNumber=function(e,t){var n=this;e.inputClass="bs-edit-number",(t||a.hasSymbol(n.$schema))&&(e.after={value:t},n._hasSymbol=!0),e.$format=n.$schema.format,u.utils.nativeNumber()&&(e.type="number")},t.prototype._removeEventsDate=function(){var e=this;u.utils.useDatePicker()&&u.utils.datePickerDestroy(e.$element)},t.prototype._setEventsDate=function(){var e=this;e.renderOptions.readOnly||u.utils.useDatePicker()&&u.utils.datePickerInitialize(e.$element,{showOnFocus:!0},function(t){e.focusOut(null)})},t.prototype._removeEventsDateTime=function(){var e=this;e.renderOptions.readOnly||u.utils.useDateTimePicker()&&u.utils.dateTimePickerDestroy($(i.find(e.$element.get(0),e.id+"_group")))},t.prototype._setEventsDateTime=function(){var e=this;e.renderOptions.readOnly||u.utils.useDateTimePicker()&&u.utils.dateTimePickerInitialize($(i.find(e.$element.get(0),e.id+"_group")),{},function(t){e.focusOut(null)})},t.prototype.setEvents=function(e){var t=this;t._isDate()?t._setEventsDate():t._isDateTime()&&t._setEventsDateTime()},t.prototype.removeEvents=function(){var e=this;e._isDate()?e._removeEventsDate():e._isDateTime()&&e._removeEventsDateTime()},t.prototype.checkValue=function(e,t){t(e)},t.prototype.paste=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t._input();if(t.state.isReadOnly||t.state.isDisabled)return!0;if(t._isNumber()&&!t.$lookup){if(!1===u.utils.doPasteNumber(e,n,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:t.$schema}))return!1}else if(t._isDate()){if(!1===u.utils.doPasteDate(e,n,{sep:r.date.daySep,format:r.date.dateShort,schema:t.$schema}))return!1}else if(t._isPassword()&&!1===u.utils.doPastePassword(e,n,{schema:t.$schema}))return!1;return!0}},t.prototype._ignoreKeys=function(e,t){return e.which===i.keys.VK_TAB||e.which!==i.keys.VK_DELETE&&(!(!t&&e.which===i.keys.VK_BACKSPACE)&&(t?0===e.which||i.arrowKeys.indexOf(e.which)>=0:i.ignoreKeys.indexOf(e.which)>=0||i.arrowKeys.indexOf(e.which)>=0))},t.prototype.keypress=function(e){var t=this;if(t.renderOptions.readOnly)return!0;if(t.state.isReadOnly||t.state.isDisabled)return!0;var n=t._input();if(t._ignoreKeys(e,!0))return!0;if(t._isNumber()&&!t.$lookup){if(!1===u.utils.keyPressNumber(e,n,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:t.$schema}))return!1}else if(t._isDate()){if(!1===u.utils.keyPressDate(e,n,{sep:r.date.daySep,format:r.date.dateShort,schema:t.$schema}))return!1}else if(t._isPassword()&&!1===u.utils.keyPressPassword(e,n,{schema:t.$schema}))return!1;return!0},t.prototype.keydown=function(e){var t=this;if(t.renderOptions.readOnly)return!0;if(t.state.isReadOnly||t.state.isDisabled)return!0;var n=t._input();if(t._ignoreKeys(e,!1))return!0;if(t._isNumber()&&!t.$lookup){if(!1===u.utils.keyDownNumber(e,n,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:t.$schema}))return!1}else if(t._isDate()){if(!1===u.utils.keyDownDate(e,n,{sep:r.date.daySep,format:r.date.dateShort,schema:t.$schema}))return!1}else if(t._isPassword()&&!1===u.utils.keyDownPassword(e,n,{schema:t.$schema}))return!1;return!0},t.prototype.equals=function(e){var t=this,n=t.state.value===e;return!n&&void 0===t.state.value&&"string"===t.$schema.type&&""===e||n},t.prototype.updateModel=function(){var e=this;e.form.setValue(e.$display,e.state.value)},t.prototype._internalSetValue=function(e,t){var n=this;n._searchEventBus?n._searchEventBus.push(null,function(t){n.state.value=e,n.updateModel()},t):(n.state.value=e,n.updateModel())},t.prototype._input2Model=function(e){var t=this,n=t._input(),o=t._text2value(n.value);t.equals(o)?(t._isNumber()||t._isDate()||t._isDateTime())&&t._value2Input(n):t.checkValue(o,function(o){t.state.value!==o?(""===o&&"string"===t.$schema.type&&(o=void 0),t._internalSetValue(o,e)):t._value2Input(n)})},t.prototype.focusOut=function(e){var t=this;t.renderOptions.readOnly||t._input2Model(!0)},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(f);t.Edit=m,l.registerControl(m,"string",!1,"",null),l.registerControl(m,"number",!1,"",null),l.registerControl(m,"integer",!1,"",null)}(e.formedit||(e.formedit={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t,n=e.utils,o=e.dom,i=e.ui,r=e.uiutils,a=(e.Observable.SchemaUtils,e.ulocale),s=e.Observable.errorsUtils;!function(t){var l=function(t,o,i,a){var s=e.bootstrap4;a=a||"";var l=[];return(o=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},o)).titleIsHidden&&(o.columns=!1),o.placeHolder=!1,r.utils.fieldWrapper(l,o,i,function(){if(!o.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];o.columns&&(s?e.push("col-form-label"):e.push("checkbox-inline bs-cursor-d"),e.push("bs-lib-col col-sm-"+o.labelCol),o.labelLeft&&e.push("text-left")),o.inline&&(s?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("no-x-padding bs-cursor-d")),e.length&&l.push(' class="'+e.join(" ")+'"'),l.push(">"),l.push(n.escapeHtml(a||"")+(o.inline?"&nbsp;":"")),r.utils.addTooltipAndRule(l,o),l.push("</label>")}o.columns&&l.push('<div class="no-x-padding col-sm-'+(12-o.labelCol)+'">'),l.push('<div class="bs-enum-list-wrap" id="{0}_input">'),l.push("</div>"),r.utils.addErrorDiv(l),o.columns&&l.push("</div>")}),n.format(l.join(""),t)},u=function(e,t,n,i){i=i||n;var r=document.createDocumentFragment(),a=$('<div tabindex="0" class="bs-enum-list-row"><div class="bs-enum-list-check"><a><center><span class="'+o.iconClass("square-o")+'"></span></center></a></div><div class="bs-enum-list-title"></div></div>').get(0);return n.forEach(function(n,s){var l=a.cloneNode(!0);t?(o.attr(l,"tabindex","-1"),o.removeClass(l,"bs-pointer"),o.addClass(l,"bs-cursor-disabled")):(o.attr(l,"tabindex","0"),o.addClass(l,"bs-pointer"),o.removeClass(l,"bs-cursor-disabled")),l.firstChild.firstChild.firstChild.firstChild.className=e&&e.indexOf(n)>=0?o.iconClass("check-square-o"):o.iconClass("square-o");var u=l.lastChild;o.append(u,document.createTextNode(i[s])),o.append(r,l)}),r},c=function(t){function n(e,n,o){var i=t.call(this,e,n,o)||this;return i._state(),i}return __extends(n,t),n.prototype._setDisabled=function(e,t){for(var n=this,i=0,r=e.childNodes.length;i<r;i++){var a=e.childNodes[i];n.state.isDisabled?(o.attr(a,"tabindex","-1"),o.removeClass(a,"bs-pointer"),o.addClass(a,"bs-cursor-disabled")):(o.attr(a,"tabindex","0"),o.addClass(a,"bs-pointer"),o.removeClass(a,"bs-cursor-disabled"))}},n.prototype._setReadOnly=function(e,t){},n.prototype._setErrors=function(t,n){var i=this,r=i.state.errors;if(n&&e.bootstrap4){r&&r.length?o.addClass(n,"is-invalid"):o.removeClass(n,"is-invalid")}i.showErrors(n,r)},n.prototype._setMandatory=function(e,t){},n.prototype._input=function(){var e=this,t=e.$element.get(0);return o.find(t,e.id+"_input")},n.prototype._state2UI=function(e){var t=this,n=t._input(),o=t.$element?t.$element.get(0):null;n&&(e||t._setDisabled(n,o),e||t._setFilter(),t._setReadOnly(n,o),t.setHidden(o),t._setMandatory(n,o),t._setErrors(n,o))},n.prototype.mousedown=function(e){var t=this;if(t.$element&&!t.state.isDisabled&&!t.state.isReadOnly){var n=window.document.activeElement,i=o.parentByClass(t.$element.get(0),e.target,"bs-enum-list-row");if(i)return n!==i&&i.focus(),!0}},n.prototype._getEnumsNames=function(){var e=this;if(!e.$schemaItems.enumNames)return null;if(e.state.filter){var t=[];return e.$schemaItems.filters[e.state.filter].forEach(function(n){t.push(e.$schemaItems.enumNames[e.$schemaItems.enum.indexOf(n)])}),t}return e.$schemaItems.enumNames},n.prototype._getEnums=function(){var e=this;return e.state.filter?e.$schemaItems.filters[e.state.filter]:e.$schemaItems.enum},n.prototype._toggleEnumByIndex=function(e){var t=this,n=t._getEnums();if(e>=0&&e<n.length){var o=n[e];t.state.value.indexOf(o)>=0?t.state.value.remove(o):t.state.value.push(o)}},n.prototype.keypress=function(e){var t=this;if(32==e.which){var n=o.parentByClass(t.$element.get(0),e.target,"bs-enum-list-row");if(!n)return;t._toggleEnumByIndex(o.indexOf(n.parentNode,n))}},n.prototype.click=function(e){var t=this;if(t.$element&&!t.state.isDisabled&&!t.state.isReadOnly){var n=o.parentByClass(t.$element.get(0),e.target,"bs-enum-list-row");n&&t._toggleEnumByIndex(o.indexOf(n.parentNode,n))}},n.prototype.changed=function(e,t,n,i,r){var a=this;if(a.$element){var s=a._input(),l=-1,c=a._getEnums(),d=a._getEnumsNames();switch(i){case"add":(l=c.indexOf(r.$id))>=0&&a._setItemValue(s.childNodes[l],!0);break;case"remove":(l=c.indexOf(r.$id))>=0&&a._setItemValue(s.childNodes[l],!1);break;case"propchange":o.empty(s),e===a.$bind&&(a.state.value=a.form.getValue(a.$bind));var p=u(a.state.value,a.state.isDisabled,c,d);o.empty(s),o.append(s,p)}}},n.prototype._setFilter=function(){var e=this,t=(e.state.filter,e._getEnums()),n=[];e.state.value.forEach(function(e){t.indexOf(e)>=0&&n.push(e)}),e.form.setValue(e.$bind,n)},n.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n.$element?n.$element.get(0):null,r=i?n._input():null;e&&"isHidden"!==e||o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(i)),e&&"isDisabled"!==e||o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(r,i)),e&&"isReadOnly"!==e||o.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly),e&&"filter"!==e||o.filter!=n.state.filter&&(n.state.filter=o.filter,i&&n._setFilter()),e&&"isMandatory"!==e||o.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=o.isMandatory),e&&"errors"!==e||s.errorChanged(n.state.errors,o.errors)&&(n.state.errors=o.errors,n._setErrors(null,i))},n.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);if(!t.$element){t.$schema.description&&(n.description=a.tt(t.$schema.description,t.form.$locale)),t.$element=$(l(t.id,n,t.options.design,a.tt(t.$schema.title,t.form.$locale)));var i=u(t.state.value,t.state.isDisabled,t._getEnums(),t._getEnumsNames()),s=t._input();o.append(s,i),t._state2UI(!0)}return t.appendElement(e,n),t.$element},n.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.firstChild.className=t?o.iconClass("check-square-o"):o.iconClass("square-o")},n.prototype.destroy=function(){t.prototype.destroy.call(this)},n}(e.ui.AbsField);i.registerControl(c,"array",!1,"enums-list",null)}(t||(t={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){function t(e,t,n){return e=e.substr(0,t)+e.substr(n,e.length-n)}function n(e){return-1!=e.indexOf("-")}function o(e){for(var t="0.",n=0;n<e;n++)t+="0";return t}function i(e,t,n){var o=d(e,n,""),i="."==t?o:o.replace(t,".");d(i,"-","");return i}function r(e,t,n,o){e||(e="0"),-1==e.indexOf(".")&&(e+="."+a("",t));var i=s(e),r=l(i[0],o),u=i[1];return u.length>t&&(u=u.substr(0,t)),u.length<t&&(u=a(u,t)),r+n+u}function a(e,t){for(var n=e.length,o=0;o<t-n;o++)e+="0";return e}function s(e){var t=e.split(".");return""==t[0]&&(t[0]="0"),t}function l(e,t){var n="";0==e.indexOf("-")&&(n="-",e=e.substr(1,e.length-1));for(r=0;r<e.length-1;r++){e[r];if("0"!=e[r])break}if(""==(e=e.substr(r,e.length-r)))return"0";if(e.length<=3)return n+e;for(var o=u(e),i="",r=0;r<o.length;r++)r%3==0&&r>0&&(i+=t),i+=o[r];return u(i+n)}function u(e){return e.split("").reverse().join("")}function c(e,t,n,o,a,s){var l=r(i(t,a,o),s,a,o);e.value=l,h(e,i(n,a,o).length,o)}function d(e,t,n){for(var o="",i=0;i<e.length;i++)e[i]==t?o+=n:o+=e[i];return o}function p(e){return!(e.which<48||e.which>57)}function f(e,t,n,o,i,a,s,l){var u=parseFloat(e);if(n){if(u<=t)return r(t.toString(),a,s,l)}else if(u<t)return r(t.toString(),a,s,l);if(i){if(u>=o)return r(o.toString(),a,s,l)}else if(u>o)return r(o.toString(),a,s,l);return r(u.toString(),a,s,l)}function m(e,t,n,o,i){var r=parseFloat(e);if(n){if(r<=t)return!1}else if(r<t)return!1;if(i){if(r>=o)return!1}else if(r>o)return!1;return!0}function h(e,t,n){var o=e.value,i=0;if(0!=t){for(var r=0;r<o.length&&(o[r]!=n&&t--,0!=t);r++);i=r+1}g.selectRange(e,i)}var v=e.uiutils,g=e.dom;v.utils.doPasteNumber=function(e,n,o){var a=parseFloat(i(e.originalEvent.clipboardData.getData("Text"),o.decimalSep,o.thousandSep)),s="";if(a<0&&(s="-",a=-a),isNaN(a))return e.preventDefault(),!0;var l=a.toString(),u=e.target.selectionStart,c=e.target.selectionEnd,d=c-u>0?t(n.value,u,c):n.value,p=d.substr(0,u),f=i(p+a+d.substr(u,d.length),o.decimalSep,o.thousandSep);if(!m(s+f,o.schema.minimum,o.schema.exclusiveMinimum,o.schema.maximum,o.schema.exclusiveMaximum))return e.preventDefault(),!1;n.value=r(s+f,o.places,o.decimalSep,o.thousandSep),h(n,i(p,o.decimalSep,o.thousandSep).length+l.length,o.thousandSep),e.preventDefault()},v.utils.keyPressNumber=function(e,a,s){var l=e.target.selectionStart,u=e.target.selectionEnd,c=u-l>0,d=c?t(a.value,l,u):a.value,f="";n(d)&&(d=d.substr(1,d.length-1),f="-",-0!=l&&(l--,u--));var v=d.substr(0,l),y=d.substr(l,d.length);if(e.key===s.decimalSep||"."===e.key)return g.selectRange(a,d.indexOf(s.decimalSep)+1+f.length),e.preventDefault(),!0;if("-"===e.key){if(0!=d.indexOf("-")){var _=i(d,s.decimalSep,s.thousandSep);if(_==o(s.places)||""==_){var $=r(_,s.places,s.decimalSep,s.thousandSep);a.value=$}else{if(!m("-"+_,s.schema.minimum,s.schema.exclusiveMinimum,s.schema.maximum,s.schema.exclusiveMaximum))return e.preventDefault(),!1;a.value=r("-"+_,s.places,s.decimalSep,s.thousandSep)}}return g.selectRange(a,1),e.preventDefault(),!0}if(!p(e))return e.preventDefault(),!1;if("0"===e.key&&0==l&&!c)return e.preventDefault(),!0;var b=i(v+e.key+y,s.decimalSep,s.thousandSep);if(!m(f+b,s.schema.minimum,s.schema.exclusiveMinimum,s.schema.maximum,s.schema.exclusiveMaximum))return e.preventDefault(),!1;a.value=r(f+b,s.places,s.decimalSep,s.thousandSep);var x="0"==v?0:1;return h(a,i(v,s.decimalSep,s.thousandSep).length+x,s.thousandSep),e.preventDefault(),!0},v.utils.keyDownNumber=function(e,n,o){if(e.which!=g.keys.VK_BACKSPACE&&e.which!=g.keys.VK_DELETE)return!0;var r=0;e.which==g.keys.VK_BACKSPACE&&(r=-1);var a=e.target.selectionStart,s=e.target.selectionEnd,l=s-a>0,u=l?t(n.value,a,s):n.value,d=u.substr(0,a),p=u.substr(a,u.length);if(l)return c(n,u,d,o.thousandSep,o.decimalSep,o.places),e.preventDefault(),!0;if(e.which==g.keys.VK_BACKSPACE&&0==a)return e.preventDefault(),!0;if(e.which==g.keys.VK_BACKSPACE){if(u[a+r]==o.decimalSep)return g.selectRange(n,a+r),e.preventDefault(),!0}else if(u[a+r]==o.decimalSep)return g.selectRange(n,a+r+1),e.preventDefault(),!0;if(u[a+r]==o.thousandSep)return g.selectRange(n,a+1+2*r),e.preventDefault(),!0;var m="";e.which==g.keys.VK_DELETE?m=i(d+p.substr(1,p.length-1),o.decimalSep,o.thousandSep):e.which==g.keys.VK_BACKSPACE&&(m=i(d.substr(0,d.length-1)+p,o.decimalSep,o.thousandSep));var v=f(m,o.schema.minimum,o.schema.exclusiveMinimum,o.schema.maximum,o.schema.exclusiveMaximum,o.places,o.decimalSep,o.thousandSep);n.value=v;var y=i(d,o.decimalSep,o.thousandSep).length+r;return e.which==g.keys.VK_BACKSPACE&&0==m.indexOf(".")&&1==a&&(y=1),e.which==g.keys.VK_DELETE&&0==m.indexOf(".")&&0==a&&(y=1),h(n,y,o.thousandSep),e.preventDefault(),!0}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.utils,o=t.ui,i=(t.dom,t.uiutils);!function(t){var r=function(e,t,o){var r=[];return i.utils.fieldWrapper(r,t,o,function(){r.push('<iframe src="'+t.src+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>')},null),n.format(r.join(""),e)},a=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i._msghandler=i._onmessage.bind(i),i}return __extends(t,e),t.prototype._setDisabled=function(e){},t.prototype._setReadOnly=function(e){this._setDisabled(e)},t.prototype._setMandatory=function(e){},t.prototype._onmessage=function(e){var t=this;e.data&&("string"==typeof e.data&&e.data.indexOf("[iFrameSizer]")>=0||t.fieldOptions&&t.fieldOptions.messages&&e.data.action&&t.fieldOptions.messages[e.data.action]&&t.form.execAction(t.fieldOptions.messages[e.data.action],e.data.action,e.data))},t.prototype._state2UI=function(){var e=this,t=e.$element?e.$element.get(0):null;t&&(e._iframe().src=e.state.value,e._setDisabled(t),e._setReadOnly(t),e.setHidden(t))},t.prototype.changed=function(e,t,n,o){var i=this,r=i._iframe();i.state.value!==n&&(i.state.value=n,r.src=i.state.value,i._applyIResize())},t.prototype._applyIResize=function(){var e=this;if(e.$element){var t=$(e._iframe());e.state.value&&t.iFrameResize&&t.iFrameResize({})}},t.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(i)),o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i)),o.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,i&&n._setReadOnly(i)),o.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,i&&n._setMandatory(i))},t.prototype._iframe=function(){var e=this.$element.get(0);return e?e.firstChild:null},t.prototype.setEvents=function(e){var t=this;window.addEventListener("message",t._msghandler)},t.prototype.removeEvents=function(){var e=this;window.removeEventListener("message",e._msghandler)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._msghandler=null},t.prototype.render=function(e){var t=this,n=t._initOptions(i.utils.defaultOptions);return t.$element||(t.$element=$(r(t.id,n,t.options.design)),t._state2UI(),t.setEvents(n),t._applyIResize()),t.appendElement(e,n),t.$element},t}(e.ui.AbsField);o.registerControl(a,"string",!1,"iframe",{})}(e.frame||(e.frame={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=(t.utils,t.dom),o=t.ui,i=t.autoclose,r=t.pagecontrol,a=t.Observable,s=t.data,l=t.formgrid,u=a.SchemaUtils,c=t.locale;!function(e){var t={name:"$lookup",form:!0,datasets:{list:{$main:!0,$type:"odata",$method:"GET",$params:{$entity:"Country",$module:"",$top:5,$orderby:"",$searchByFields:void 0,$allData:!1}}},$type:"block",$items:[{$type:"block",$items:[{$bind:"search",$widget:"search",options:{autofocus:!0,search:"documents"}}]},{$type:"block",$items:[{$bind:"documents",options:{border:!0,scrolling:{horizontal:!0},sorting:!0,selecting:{row:!0,action:"selectAndClose"},columns:[]}}]}]},a=function(){function e(e,t,n){}return e.prototype._modelChanged=function(e,t,n,o){var i=this;if("init"===e.operation)(a=t.documents).length&&a.selectItem(!0,t.documents.get(0),!1,"",!1,!1);else if("form-validate"===e.property){if(i._onselect){var r=null;(a=t.documents).enumSelectedItems("",function(e){r||(r=e)}),i._onselect(r?r.model():null)}n.autoClose.explicitClose=!0,i.hide()}else if("documents"===e.property){if("propchange"===e.operation){var a=t.documents;a.length&&a.selectItem(!0,t.documents.get(0),!1,"",!1,!1)}}else"documents.$item.$links.selectAndClose"===e.property&&(i._onselect&&i._onselect(e.actionParams.model()),n.autoClose.explicitClose=!0,i.hide())},e.prototype._checkFormLayout=function(e){var t=this;e.$schema.properties.search={title:c.ui.Search,type:"string"},e.$schema.properties.documents.$reference="list",t._lookupColumns||(t._lookupColumns=[],Object.keys(e.$schema.properties.documents.items.properties).forEach(function(n){var o=e.$schema.properties.documents.items.properties[n];o.title&&"object"!==o.type&&"array"!==o.type&&t._lookupColumns.push(n)})),e.$schema.properties.documents.items.links={selectAndClose:{}};var n=e.data.$items[1].$items[0].options.columns;t._lookupColumns.forEach(function(e){var o=e;"string"==typeof e&&(o={$bind:e}),o.$bind===t._searchField?n.splice(0,0,o):n.push(o)})},e.prototype._beforeClose=function(){var e=this;if(e._form){var t=e._form,n=e._parentControl,o=e._focusParams;e._form=null,n&&n.focused&&(t.autoClose&&t.autoClose.explicitClose?n.setFocus&&n.setFocus(o):n.checkFocus&&n.checkFocus(o))}},e.prototype._checkPopup=function(){},Object.defineProperty(e.prototype,"opened",{get:function(){return!!this._form},enumerable:!0,configurable:!0}),e.prototype.focusInCombo=function(e){var t=this;return!(!t._form||!t._form.autoClose)&&t._form.autoClose.inPopup(e)},e.prototype.show=function(e,r,a){var s=this;if(s._parentControl=r,s._focusParams=a.focusParams,s._lookup=a.lookup,s._lookupColumns=a.lookupColumns,s._onselect=a.onselect,!s._lookup.schema)throw"Invalid lookup definition. Foreign schema is missing.";var l=$.extend(!0,{},t);s._lookup.data&&s._lookup.data.$params&&s._lookup.data.$params.$allData&&(l.datasets.list.$params.$allData=!0);var c,d="string"==typeof s._lookup.schema?s._lookup.schema:$.extend(!0,{},s._lookup.schema),p=l.datasets.list;if(a.alignElementId){var f=n.find(null,a.alignElementId);f&&(c=f.offsetWidth),c=Math.max(c,300)}$.extend(p.$params,e.$params),p.$params.$orderby=a.display?s._lookup.mapping[a.display]:"",s._searchField=p.$params.$orderby;var m=a.display?s._lookup.mapping[a.display]:"";o.loadSchema(d).then(function(e){u.expandSchema$Ref(e);var t=u.searchableFields(e.properties.documents.items,e,null),n=[];m&&n.push(m),t.forEach(function(e){e.name!==m&&n.push(e.name)}),p.$params.$searchByFields={fields:n,value:a.search?a.search:""},o.showAutoCloseForm({name:l,meta:e,controller:{onModelChanged:s._modelChanged.bind(s),checkFormLayout:s._checkFormLayout.bind(s)},autoClose:{align:i.BOTTOM_LEFT,opener:a.openerId,parents:a.openerId?[a.openerId]:void 0,alignElementId:a.alignElementId,beforeClose:s._beforeClose.bind(s),minWidth:c,showCloseButton:!1},options:{}},null,function(e){s._form=e})})},e.prototype.hide=function(){var e=this;e._form&&r.Page().setPopup(null),e._parentControl=null,e._focusParams=null,e._lookup=null,e._onselect=null,e._lookupColumns=null},e.prototype.destroy=function(){this.hide()},e}();e.GridItems=a;var d={checkGridPopup:function(e,t,n,o){return new a($(o),n,{primaryKey:t.primaryKey})},closeGridLookup:function(e,t,n){e[n]&&e[n].opened&&t.push(null,function(t){e[n]&&e[n].opened&&e[n].hide()},!0)},openGridLookup:function(e,t){var n=$.extend(!0,{},t.lookup.data),o={alignElementId:t.align,openerId:t.openerId,lookup:t.lookup,lookupColumns:t.lookupColumns,display:t.display,onselect:t.onselect,search:t.searchText};n&&n.$params&&n.$params.$filter&&(n.$params.$filter=s.replaceFilterVars(n.$params.$filter,t.formControl.getParentModel(t.bind).model(!0))),t.containerId&&(n.$params.containerId=t.containerId),t.viewId&&(n.$params.viewId=t.viewId),e[t.propertyName].show(n,t.parentControl,o)}};e.utils={checkGridPopup:d.checkGridPopup,closeGridLookup:d.closeGridLookup,openGridLookup:d.openGridLookup},l.gridlookup=e.utils}(e.gridlookup||(e.gridlookup={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){e.utils;var n=e.Observable.errorsUtils,o=e.dom,i=(e.ulocale,function(t){function i(e,n,o){var i=t.call(this,e,n,o)||this;return i._state(),i}return __extends(i,t),i.prototype._item=function(e){var t=this;if(!t.$element)return null;var n=t.$element.get(0);return o.find(n,t.id+"_item_"+e)},i.prototype.click=function(e){var t=this,n=e.target;if(!t.state.isReadOnly){var i=n.id?n.id:n.parentNode.id;if(i){"#"===(o.attr(n,"data-phoenix-href")||o.attr(n,"href"))&&e.preventDefault();var r=t.id+"_item_";if(0===i.indexOf(r)){var a=parseInt(i.substring(r.length),10),s=t.$schema.enum[a],l=t.$schema.enum.indexOf(t.state.value);if(t.renderOptions.wizard&&l>=0&&a>=0&&a-l>0)return;s!==t.state.value&&t.form.setValue(t.$bind,s)}}}},i.prototype._setDisabled=function(e){if(e){var t=this;t._enumItems(function(e,n){e.disabled=t.state.isDisabled||t.state.isReadOnly})}},i.prototype._enumItems=function(e){var t=this;t.$schema.enum.forEach(function(n,o){var i=t._item(o);e(i,n)})},i.prototype._setMandatory=function(e){},i.prototype._state2UI=function(e){var t=this,n=t.$element?t.$element.get(0):null;if(n){var o=t.$schema.enum.indexOf(t.state.value);if(o>=0){var i=t._item(o);i&&e(i)}t._setDisabled(n),t.setHidden(n),t._setErrors(n)}},i.prototype._setErrors=function(t){var n=this,i=n.state.errors;if(t&&e.bootstrap4){i&&i.length?o.addClass(t,"is-invalid"):o.removeClass(t,"is-invalid")}n.showErrors(t,i)},i.prototype._getDefaultItem=function(){var e=this;if(e.$element?e.$element.get(0):null){var t=e.$schema.enum.indexOf(e.state.value);return t>=0?e._item(t):void 0}},i.prototype.stateChanged=function(e,t){var o=this,i=o.form.getState(o.$bind),r=o.$element?o.$element.get(0):null;i.isHidden!==o.state.isHidden&&(o.state.isHidden=i.isHidden,o.setHidden(r)),i.isDisabled!=o.state.isDisabled&&(o.state.isDisabled=i.isDisabled,o._setDisabled(r)),i.isReadOnly!=o.state.isReadOnly&&(o.state.isReadOnly=i.isReadOnly,o._setDisabled(r)),i.isMandatory!=o.state.isMandatory&&(o.state.isMandatory=i.isMandatory,o._setMandatory(r)),e&&"errors"!==e||n.errorChanged(o.state.errors,i.errors)&&(o.state.errors=i.errors,o._setErrors(r))},i}(t.AbsField));t.Group=i}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=t,i=e.dom,r=e.ulocale,a=e.uiutils,s=function(t,o,i,r,s,l){r=r||"",o=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},o);var u=[];return a.utils.fieldWrapper(u,o,i,function(){var t=e.bootstrap4,i=!o.columns&&!o.inline;if(!o.titleIsHidden){u.push('<label id="{0}_label" for="{0}_grp" ');var c=["bs-label"];o.columns?(t?c.push("col-form-label"):c.push("checkbox-inline bs-cursor-d"),c.push("bs-lib-col col-sm-"+o.labelCol),o.labelLeft&&c.push("text-left")):o.inline&&(t?c.push("form-check-inline"):c.push("checkbox-inline"),c.push("bs-cursor-d no-x-padding")),c.length&&u.push(' class="'+c.join(" ")+'"'),u.push(">"),u.push(n.escapeHtml(r||"")+(o.inline?"&nbsp;":"")),u.push("</label>")}a.utils.addErrorDiv(u),o.columns&&u.push('<div class="no-x-padding col-sm-'+(12-o.labelCol)+'">'),i&&u.push("<div>");var d=["no-y-margin d-inline-flex pagination"];u.push('<ul id="{0}_grp" tabindex="0" class="'+d.join(" ")+'">'),s.forEach(function(e,t){u.push('<li id="{0}_item_'+t+'" class="page-item">'),u.push('<a tabindex="-1" href="#" class="page-link bs-nowrap"'),o.width&&u.push(' style="width:'+o.width+'"'),u.push(">"),u.push(n.escapeHtml(l[t]||"")),u.push("</a>"),u.push("</li>")}),u.push("</div>"),i&&u.push("</div>")}),o.columns&&u.push("</div>"),n.format(u.join(""),t)},l=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype._state2UI=function(){var t=this.renderOptions.binary?"bactive":"active";e.prototype._state2UI.call(this,function(e){i.addClass(e,t)})},t.prototype.changed=function(t,n,o,r){var a=this,s=a.renderOptions.binary?"bactive":"active";if(a.state.value!=o){if(a.state.value=o,!a.$element)return;e.prototype._enumItems.call(this,function(e,t){a.state.value===t?i.addClass(e,s):i.removeClass(e,s)})}},t.prototype.mousedown=function(e){var t=this;t.options.design||e.preventDefault(),t.setFocus()},t.prototype.focusIn=function(e){},t.prototype.focusOut=function(e){},t.prototype.setFocus=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t.form.getState(t.$bind);n.isDisabled||n.isHidden||t.$element&&i.find(t.$element.get(0),t.id+"_grp").focus()}},t.prototype.keydown=function(e){var t=this;if(!t.state.isReadOnly&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.which||e.keyCode){case i.keys.VK_LEFT:var n=t.$schema.enum.indexOf(t.state.value);if(n>0){r=t.$schema.enum[n-1];t.form.setValue(t.$bind,r)}break;case i.keys.VK_RIGHT:var o=t.$schema.enum.indexOf(t.state.value);if(o>=0&&o<t.$schema.enum.length-1){var r=t.$schema.enum[o+1];t.form.setValue(t.$bind,r)}}},t.prototype.render=function(e){var t=this,n=t._initOptions(a.utils.defaultOptions);if(!t.$element){var o=t.$schema.enumNames||t.$schema.enum;o=o.map(function(e){return r.tt(e,t.form.$locale)}),t.$element=$(s(t.id,n,t.options.design,r.tt(t.$schema.title,t.form.$locale),t.$schema.enum,o)),t._state2UI()}return t.appendElement(e,n),t.$element},t}(t.Group);t.BtnGroup=l,o.registerControl(l,"*",!0,"grpbtn",null)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils,n=e.ui,o=e.dom,i=e.ulocale,r=e.uiutils;!function(a){function s(n,o,i,a){var s=e.bootstrap4;a=a||"";var l=(o=$.extend({columns:!1},o)).columns;o.columns=!1,l&&(o.styles="bs-field-group-labels");var u=[],c={formGroup:"form-group"};return l&&!s&&(c.formGroup+=" form-horizontal"),r.utils.fieldWrapper(u,o,i,function(){u.push('<label id="{0}_label"');var e=["bs-label"];l&&(s?e.push("col-form-label"):e.push("checkbox-inline bs-cursor-d"),e.push("col-sm-12 bs-lib-col"),o.labelLeft&&e.push("text-left")),o.inline&&(s?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&u.push(' class="'+e.join(" ")+'"'),o.parentId&&u.push(' for="'+o.parentId+'_input"'),u.push(">"),u.push(t.escapeHtml(a||"")+(o.inline?"&nbsp;":"")),r.utils.addTooltipAndRule(u,o),u.push("</label>")},c),t.format(u.join(""),n)}var l=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype.isMeta=function(){return!0},t.prototype.setParentId=function(e){this._parentId=e},t.prototype.getCustomBind=function(){var t=this;return t.config&&t.config.options&&t.config.options.$bind?t.config.options.$bind:e.prototype.getCustomBind.call(this)},t.prototype._setDisabled=function(e,t){},t.prototype._setReadOnly=function(e,t){},t.prototype._setMandatory=function(e,t){var n=this,i=this.state.isMandatory,r=n._label();r&&o.text(r,n.renderOptions.title+(i?" *":"")+(n.renderOptions.inline?String.fromCharCode(160):""))},t.prototype._label=function(){var e=this;return e.$element?o.find(e.$element.get(0),e.id+"_label"):null},t.prototype._state2UI=function(){var e=this,t=e._label(),n=e.$element?e.$element.get(0):null;t&&(e._setDisabled(t,n),e._setReadOnly(t,n),e.setHidden(n),e._setMandatory(t,n))},t.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n._label(),r=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(r)),o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,r)),o.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,i&&n._setReadOnly(i,r)),o.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,i&&n._setMandatory(i,r))},t.prototype._title=function(){var e=this;return e.$schema&&e.$schema.title?e.$schema.title:e.config&&e.config.options&&e.config.options.title?e.config.options.title:""},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(n.title=i.tt(t._title(),t.form.$locale),t.$schema.description&&(n.description=i.tt(t.$schema.description,t.form.$locale)),t._parentId&&(n.parentId=t._parentId),t.$element=$(s(t.id,n,t.options.design,n.title)),t._state2UI()),t.appendElement(e,n),t.$element},t}(e.ui.AbsField);a.Label=l,n.registerControl(l,"meta",!1,"label",null)}(e.formlabel||(e.formlabel={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils,n=(e.ui,e.dom),o=e.uiutils,i=e.ulocale;!function(r){function a(e,i,r,a){a=a||"",void 0!==(i=$.extend({right:!1,icon:null,type:"default",size:null},i)).title&&(a=i.title);var s=[];if(!i.inline){var l=["bs-island","bs-field-group"];r&&l.push("design"),s.push('<div class="'+l.join(" ")+'"'),o.utils.addContainerId(s,r),s.push(">")}return s.push('<button type="button"'),s.push(' class="bs-button btn btn-'+n.bootstrapStyles("secondary"===i.type||"default"===i.type)[i.type]),i.classButton&&s.push(" "+i.classButton.join("")),i.size&&s.push(" btn-"+i.size),i.inline?(s.push(" bs-btn-inline"),s.push(" bs-island"),i.right&&s.push(" float-right"),r&&s.push(" design")):s.push(" btn-block"),i.style&&s.push(" "+i.style),s.push('"'),i.inline&&o.utils.addContainerId(s,r),s.push(">"),i.icon&&!i.iconRight&&s.push('<span class="'+n.iconClass(i.icon)+'"></span>'),i.titleIsHidden||(i.icon&&!i.iconRight&&s.push("&nbsp;"),s.push(a||""),i.icon&&i.iconRight&&s.push("&nbsp;")),i.icon&&i.iconRight&&s.push('<span class="'+n.iconClass(i.icon)+'"></span>'),s.push("</button>"),i.inline||s.push("</div>"),t.format(s.join(""),e)}var s=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype._button=function(){var e=this;return e.$element?e.renderOptions.inline?e.$element.get(0):e.$element.get(0).firstChild:null},t.prototype.click=function(e){var t=this;t._isBinded?t.form.execAction(t.$bind):t.fieldOptions.onChange&&t.fieldOptions.onChange()},t.prototype._setDisabled=function(e,t){var o=this;e.disabled=o.state.isDisabled,o.state.isDisabled?n.addClass(e,"disabled"):n.removeClass(e,"disabled")},t.prototype._state2UI=function(){var e=this,t=e._button(),n=e.$element?e.$element.get(0):null;t&&(e._setDisabled(t,n),e.setHidden(n))},t.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n._button(),r=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(r)),o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,r))},t.prototype.render=function(e){var t=this,n=t._initOptions(o.utils.defaultOptions);return t.$element||(t.$element=$(a(t.id,n,t.options.design,i.tt(t.title,t.form.$locale))),t._state2UI()),t.appendElement(e,n),t.$element},t}(e.ui.AbsField);r.Link=s}(e.formlink||(e.formlink={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=(n.serial,n.ui),i=n.Observable.SchemaUtils,r=n.data,a=n.utils,s=e.gridlookup,l=n.dom,u=(n.formedit,n.locale,function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey}),c={autoComplete:!1,maxItems:-1},d=function(e,t){if(""===e||null===e||void 0===e)return"";if(t&&t.data&&t.data.$value){for(var n=t.data.$value,o=0,i=n.length;o<i;o++){var r=n[o];if(r.code===e)return r.title}return e||""}return e||""},p=function(e,t,n){if(e.value&&(e=e.value),t){var o=[],i=r.compileFilterTree(t,null,n,null);return e.forEach(function(e){r.acceptFilter(i,e)&&o.push(e)}),o}return e},f=function(t){function n(n,o,i){var r=t.call(this,n,o,i)||this,a=r;return a.lookupOptions=c,a.eventBus=new e.serial.SingleEventBus(50),a.onselectItemHandler=a._onselectItem.bind(a),a.isEnum=a.$lookup&&a.$lookup.data&&"enum"===a.$lookup.data.$type,r}return __extends(n,t),n.prototype.customOptions=function(e){var n=this;t.prototype.customOptions.call(this,e),e.after={icon:"chevron-down"},e.paginated=i.supportPagination(n.$lookup)},n.prototype._value2Text=function(){var e=this;return e.isEnum?d(e.state.value,e.$lookup):e.state.value||""},n.prototype._getSource=function(e){var t=this,n=t.form.getParentModel(t.$bind);return t.$lookup.data&&t.$lookup.data.$type?"inline"===t.$lookup.data.$type||"enum"===t.$lookup.data.$type?a.dataAsPromise(p(t.$lookup.data.$value,t.$lookup.data&&t.$lookup.data.$params?t.$lookup.data.$params.$filter:null,n.model(!0))):i.allData(t.$lookup)?t.$lookup.cache&&t.hasCachedData?a.dataAsPromise(t.cachedData):(e.containerId=t.form.syncTransactionId(),e.viewId=t.form.syncViewId(),i.executeLookup(t.$lookup,t.form.getParentModel(t.$bind),e)):(e.fieldName=t.$lookup.mapping[t.$display],e.paginated=!0,e.containerId=t.form.syncTransactionId(),e.viewId=t.form.syncViewId(),e.viewId=t.form.syncViewId(),i.executeLookup(t.$lookup,t.form.getParentModel(t.$bind),e)):a.dataAsPromise(null)},n.prototype._filterResult=function(e,t){var n=this;if(e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(n.$lookup.data&&n.$lookup.data.$params&&n.$lookup.data.$params.$allData)return(o=i.findFirst(t.search,i.remoteSearch(i.lastSegment(n.$bind,n.$display),n.$lookup),e.documents))?{value:[o.item]}:null;e.value=e.documents,delete e.documents}if(i.allData(n.$lookup)){if(n.$lookup.cache&&!n.hasCachedData&&(n.hasCachedData=!0,n.cachedData=e),t.findFirst&&!t.search)return null;if(t.search&&e&&e.value&&t.findFirst){var o=i.findFirst(t.search,n.isEnum?"title":i.remoteSearch(i.lastSegment(n.$bind,n.$display),n.$lookup),e.value);return o?{value:[o.item]}:null}}return e},n.prototype._findselected=function(e,t){var n=this;if(t.search&&t.select&&e&&e.value){var o=i.findFirst(t.search,n.isEnum?"title":i.remoteSearch(i.lastSegment(n.$bind,n.$display),n.$lookup),e.value);if(o)return o.index}return-1},n.prototype._findValue=function(e,t){var n=this;if(e||""!==e){var o={search:e,select:!1,findFirst:!0,find:!1,paginated:n.renderOptions.paginated};n.eventBus.push(n._getSource(o),function(e){e=n._filterResult(e,o),t(e&&e.value&&e.value.length?e.value[0]:null)},!0)}else n.eventBus.push(null,function(e){t(null)},!0)},n.prototype._onselectItem=function(e){var t=this;t.eventBus.push(e,function(e){var n=Object.keys(t.$lookup.mapping),o=i.extractBase(t.$bind),r=[],a=!1;n.forEach(function(n){if(t.$lookup.mapping[n]){var i=t.form.getValue(o+n)||"",s=e?e[t.$lookup.mapping[n]]||"":"";s!==i&&(t.form.setValue(o+n,s),a=!0)}else r.push(n)}),a&&r.forEach(function(e){t.form.setValue(o+e,t.$lookup.mapping[e])});var s=t._input();s.value!=t._value2Text()&&t._value2Input(s)},!0)},n.prototype._checkPopupMenu=function(){var t=this;if(!t.menu){var n=t._input(),o=t.$element;t.renderOptions.columns&&(o=$(t._colParent())),t.menu=new e.formdropitems.DropItems(o,n,{primaryKey:t.$lookup.primaryKey,search:t.isEnum?"title":i.remoteSearch(i.lastSegment(t.$bind,t.$display),t.$lookup),onselect:t.onselectItemHandler})}},n.prototype.mousedown=function(e){var n=this;return n.menu&&n.menu.opened&&n.menu.inMenu(e.target)?(e.stopPropagation(),!1):t.prototype.mousedown.call(this,e)},n.prototype.stopProppagation=function(e){var n=this;t.prototype.stopProppagation.call(this,e),n.menu&&n.menu.opened&&n.menu.inMenu(e.target)&&(e.preventDefault(),e.stopPropagation())},n.prototype.click=function(e){var t=this,n=t._input();l.isChildOf(n.parentNode.lastChild,e.target)?t.renderOptions.paginated?t._toggleGridLookup():t._toggleMenuLookup():t.menu&&t.menu.opened&&t.menu.inMenu(e.target)&&t.menu.click(e)},n.prototype.beforeAppend=function(){},n.prototype._searchText=function(){var e=this,t=e._input(),n=e._text2value(t.value);return e.equals(n)?"":n},n.prototype._managePreventDefault=function(e,t){var n;switch(e){case l.keys.VK_UP:case l.keys.VK_PGDOWN:case l.keys.VK_PGUP:case l.keys.VK_HOME:case l.keys.VK_END:n=!u(t);break;case l.keys.VK_DOWN:t.ctrlKey?(n=!0,e=l.keys.VK_F4):n=!u(t);break;default:n=!1}return n&&t.preventDefault()&&t.stopPropagation(),e},n.prototype._shouldTrigger=function(e,t){var n=!1;switch(e){case l.keys.VK_TAB:n=!u(t);break;default:n=!0}return n},n.prototype.setEvents=function(e){var t=this;$(t._input()).on("input",function(){t.inputChanged()})},n.prototype.removeEvents=function(){var e=this;$(e._input()).off("input")},n.prototype.inputChanged=function(){var e=this,t=e._input();e.modified=t.value!=e._value2Text(),e._triggerEvent("inputChanged",null)},n.prototype.checkValue=function(e,t){var n=this,o=n._input();o.value!=n._value2Text()?n._findValue(o.value,function(e){n._onselectItem(e)}):t(n.state.value)},n.prototype.keydown=function(e){var t=this,n=e.which||e.keyCode;return(n=t._managePreventDefault(n,e))&&t._shouldTrigger(n,e)&&t._triggerKey(n,e),!0},n.prototype.focusIn=function(e){},n.prototype.focusOut=function(e){var n=this;s.utils.closeGridLookup(n,n.eventBus,"gc"),n._closeMenuLookup(),t.prototype.focusOut.call(this,e)},n.prototype._triggerEvent=function(e,t){var n=this,o=n._input();if(n.menu&&n.menu.opened)switch(e){case"inputChanged":var i={search:o.value,select:!0,find:!1,findFirst:!1};this.eventBus.push(n._getSource(i),function(e){if(n.menu&&n.menu.opened){i.search=o.value,e=n._filterResult(e,i);var t=-1;i.select&&(t=n._findselected(e,i)),n.menu.show(e,t,!0)}},!1)}},n.prototype._checkGridPopup=function(){var e=this,t=e._input(),n=e.$element.get(0);e.renderOptions.columns&&(n=e._colParent()),e.gc=s.utils.checkGridPopup(e,e.$lookup,t,n)},n.prototype.focusInControl=function(e){var n=this,o=t.prototype.focusInControl.call(this,e);return!o&&n.gc&&n.gc.opened?n.gc.focusInCombo(e):o},n.prototype._openGridLookup=function(){var e=this;e.gc&&e.gc.opened||(e._checkGridPopup(),s.utils.openGridLookup(e,{lookup:e.$lookup,parentControl:e,formControl:e.form,display:e.$display,bind:e.$bind,containerId:e.form.syncTransactionId(),viewId:e.form.syncViewId(),align:e.id+"_group",openerId:e.id+"_after",searchText:e._searchText(),onselect:e.onselectItemHandler,lookupColumns:e.fieldOptions?e.fieldOptions.lookupColumns:void 0,propertyName:"gc"}))},n.prototype._toggleGridLookup=function(){var e=this;e.gc&&e.gc.opened?s.utils.closeGridLookup(e,e.eventBus,"gc"):e.gc&&e.gc.opened||e._openGridLookup()},n.prototype._closeMenuLookup=function(){var e=this;e.menu&&e.menu.opened&&e.eventBus.push(null,function(t){e.menu&&e.menu.opened&&e.menu.hide(null)},!0)},n.prototype._toggleMenuLookup=function(){var e=this,t=e._input();if(e.menu&&e.menu.opened)e.menu&&e.menu.opened&&e._closeMenuLookup();else{e._checkPopupMenu();var n={search:t.value,select:!0,find:!1,findFirst:!1};e.eventBus.push(e._getSource(n),function(t){t=e._filterResult(t,n);var o=-1;n.select&&(o=e._findselected(t,n)),e.menu.show(t,o,!1)},!0)}},n.prototype._triggerKey=function(e,t){var n=this;if(n.menu&&n.menu.opened)switch(e){case l.keys.VK_ESCAPE:n.eventBus.push(null,function(e){n._closeMenuLookup()},!0);break;case l.keys.VK_ENTER:n.eventBus.push(null,function(e){n.menu.select()},!0);break;case l.keys.VK_UP:n.eventBus.push(null,function(e){n.menu.move(-1)},!0);break;case l.keys.VK_DOWN:n.eventBus.push(null,function(e){n.menu.move(1)},!0);break;case l.keys.VK_HOME:n.eventBus.push(null,function(e){n.menu.move(-1e3)},!0);break;case l.keys.VK_END:n.eventBus.push(null,function(e){n.menu.move(1e3)},!0);break;case l.keys.VK_PGDOWN:n.eventBus.push(null,function(e){n.menu.move(7)},!0);break;case l.keys.VK_PGUP:n.eventBus.push(null,function(e){n.menu.move(-7)},!0)}e===l.keys.VK_F4&&(n.renderOptions.paginated?n._toggleGridLookup():n._toggleMenuLookup())},n.prototype.destroy=function(){var e=this;e.onselectItemHandler=null,e.cachedData=null,e.eventBus&&(e.eventBus.destroy(),e.eventBus=null),e.menu&&(e.menu.destroy(),e.menu=null),e.gc&&(e.gc.destroy(),e.gc=null),t.prototype.destroy.call(this)},n.prototype.checkFocus=function(e){var t=this;a.nextTick(function(){var e=window.document.activeElement;e&&t.targetInControl(e)||(t.focusOut(null),t.focused=!1)})},n}(e.formedit.Edit);t.Lookup=f,o.registerControl(f,"string",!1,"",{lookup:!0}),o.registerControl(f,"number",!1,"",{lookup:!0}),o.registerControl(f,"integer",!1,"",{lookup:!0})}(e.formlookup||(e.formlookup={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.utils,n=e.ui,o=e.dom,i=(e.device,e.uiutils),r=e.Observable,a=e.data.odata,s=r.DataUtils,l=e.ulocale;!function(r){var u=function(n,r,a,s,l){var u=[];return s=s||"",i.utils.fieldWrapper(u,r,a,function(){var n=e.bootstrap4;if(!r.titleIsHidden){u.push('<label id="{0}_label"');var a=["bs-label"];r.columns&&(n?a.push("col-form-label"):a.push("checkbox-inline bs-cursor-d"),a.push("bs-lib-col col-sm-"+r.labelCol),r.labelLeft&&a.push("text-left")),r.inline&&(n?a.push("form-check-inline"):a.push("checkbox-inline"),a.push("bs-cursor-d no-x-padding")),a.length&&u.push(' class="'+a.join(" ")+'"'),u.push(">"),u.push(t.escapeHtml(s||"")+(r.inline?"&nbsp;":"")),i.utils.addTooltipAndRule(u,r),u.push("</label>")}r.columns&&u.push('<div class="no-x-padding col-sm-'+(12-r.labelCol)+'">'),r.inline?u.push('<span id="{0}_alt" class="bs-no-image">'):u.push('<div id="{0}_alt" class="bs-no-image">'),l&&u.push('<input id="{0}_upload" class="bs-hidden-file" accept="image/*" type="file" />');var c=["bs-none bs-relative"];r.inline||c.push(n?"img-fluid":"img-responsive"),u.push('<img id="{0}_img" class="'),u.push(c.join(" ")),u.push('"/>'),l&&u.push('<div id="{0}_remove" class="bs-rt-button bs-image-remove bs-none"><span class="'+o.iconClass("times-circle")+'"></span></div>'),r.inline?u.push("</span>"):u.push("</div>"),r.columns&&u.push("</div>")},null),t.format(u.join(""),n)},c=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype._setDisabled=function(e){},t.prototype._setReadOnly=function(e){this._setDisabled(e)},t.prototype._setMandatory=function(e){},t.prototype._state2UI=function(){var e=this,t=e._img(),n=e.$element?e.$element.get(0):null;t&&(e._showValue(e.state.value),e._setDisabled(n),e._setReadOnly(n),e.setHidden(n))},t.prototype._showValue=function(e){},t.prototype.changed=function(e,t,n,o){var i=this;i._img();i.state.value!==n&&(i.state.value=n,i._showValue(i.state.value))},t.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(i)),o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i)),o.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,i&&n._setReadOnly(i)),o.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,i&&n._setMandatory(i))},t.prototype._img=function(){var e=this,t=e.$element.get(0);return t?o.find(t,e.id+"_img"):null},t.prototype._altimg=function(){var e=this,t=e.$element.get(0);return t?o.find(t,e.id+"_alt"):null},t.prototype.render=function(e){var t=this,n=t._initOptions(i.utils.defaultOptions);return t.$element||(n.title=l.tt(t.$schema.title,t.form.$locale),t.$element=$(u(t.id,n,t.options.design,n.title,t.editable)),t._state2UI(),t.setEvents(n)),t.appendElement(e,n),t.$element},t}(e.ui.AbsField),d=function(e){function n(t,n,o){var i=e.call(this,t,n,o)||this;return i.editable=!0,i}return __extends(n,e),n.prototype._createImage=function(e){var t=this,n=e.target.files;if(n&&n.length){var i=n[0];if(!i.type.match("image.*"))return;var r=window.URL||window.webkitURL;if(r){var a={id:t.state.value?t.state.value.id:void 0,fileName:i.name,value:"",url:t.state.value?t.state.value.url:void 0,contentType:i.type};if("image/svg+xml"===i.type){var s=new FileReader;s.onload=function(e){a.value=s.result,t.form.setValue(t.$bind,a),o.processing(!1)},o.processing(!0),s.readAsDataURL(i)}else{var l=document.createElement("img"),u=document.createElement("canvas");o.processing(!0),l.src=r.createObjectURL(i),l.onload=function(){var e=1,n=l.width*l.height;n>12e5?e=2:n>24e5?e=4:n>4e6&&(e=8),u.width=l.width/e,u.height=l.height/e,u.getContext("2d").drawImage(l,0,0,u.width,u.height),a.value=u.toDataURL(),t.form.setValue(t.$bind,a),o.processing(!1)}}}}},n.prototype._removeImage=function(){var e=this,t={id:e.state.value?e.state.value.id:void 0,value:""};e.form.setValue(e.$bind,t)},n.prototype.click=function(e){var t=this;if(!t.state.isDisabled&&!t.state.isReadOnly){var n=t.id+"_remove";e.target.id===n||e.target.parentNode.id===n?t._removeImage():t._upload().click()}},n.prototype._upload=function(){var e=this,t=e.$element.get(0);return t?o.find(t,e.id+"_upload"):null},n.prototype.setEvents=function(e){var t=this,n=t._upload();n&&$(n).on("change",function(e){t._createImage(e)})},n.prototype.removeEvents=function(){var e=this._upload();e&&$(e).off("change")},n.prototype._setDisabled=function(e){var t=this;t._upload().disabled=t.state.isDisabled||t.state.isReadOnly,t._showRemoveImage(t.state.value)},n.prototype._showRemoveImage=function(e){var t=this,n=!t.state.isHidden&&!t.state.isDisabled&&!t.state.isReadOnlyd;n&&(n=e&&(e.url||e.value));var i=t._rmv();i&&(n?o.removeClass(i,"bs-none"):o.addClass(i,"bs-none"))},n.prototype._rmv=function(){var e=this,t=e.$element.get(0);return t?o.find(t,e.id+"_remove"):null},n.prototype._showValue=function(e){var n=this,i=n._img(),r=n._altimg();if(i){var l=!1;if(e)if(void 0!==e.value)e.value?(i.src=e.value,l=!0):i.src="";else if(e.url){if(e.url.indexOf("{{baseUrl}}")>=0){var u=s.extractMainDataSource(n.form.$model);u||(u={$module:n.renderOptions.$module,$context:n.renderOptions.$context});a.baseUrl(u);var c=t.execAngularExpression(e.url,{baseUrl:a.baseUrl(u)||""});i.src=a.addImageUrlToken(c)}else i.src="";l=!0}else i.src="";else i.src="";l?(o.removeClass(i,"bs-none"),o.removeClass(r,"bs-no-image")):(o.addClass(i,"bs-none"),o.addClass(r,"bs-no-image")),n._showRemoveImage(e)}},n}(c),p=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i.editable=!1,i}return __extends(t,e),t.prototype._showValue=function(e){var t=this,n=t._img(),i=t._altimg();if(n){var r=!1;e&&(n.src=e,r=!0),r?(o.removeClass(n,"bs-none"),o.removeClass(i,"bs-no-image")):(o.addClass(n,"bs-none"),o.addClass(i,"bs-no-image"))}},t}(c);n.registerControl(d,"string",!1,"",{format:"stream"}),n.registerControl(p,"string",!1,"imageurl",{})}(e.formpicture||(e.formpicture={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=t,i=(e.dom,e.ulocale),r=e.uiutils,a=function(t,o,i,a,s,l){a=a||"",o=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,horizontal:!1},o);var u=[];return r.utils.fieldWrapper(u,o,i,function(){var t=e.bootstrap4;if(!o.titleIsHidden){u.push('<label for="{0}_input" id="{0}_label"');var i=["bs-label"];o.columns&&(t?i.push("col-form-label"):i.push("checkbox-inline bs-cursor-d"),i.push("bs-lib-col col-sm-"+o.labelCol),o.labelLeft&&i.push("text-left")),o.inline&&(t?i.push("form-check-inline"):i.push("checkbox-inline"),i.push("bs-cursor-d no-x-padding")),i.length&&u.push(' class="'+i.join(" ")+'"'),u.push(">"),u.push(n.escapeHtml(a||"")+(o.inline?"&nbsp;":"")),r.utils.addTooltipAndRule(u,o),u.push("</label>"),!o.inline&&o.horizontal&&u.push("<div></div>")}o.columns&&u.push('<div class="no-x-padding  col-sm-'+(12-o.labelCol)+'">');var c=o.inline||o.horizontal?[t?"form-check-inline no-x-padding":"radio-inline"]:[];s.forEach(function(e,t){o.inline||o.horizontal||u.push('<div id="{0}_radio" class="radio">'),u.push("<label"),c.length&&u.push(' class="'+c.join(" ")+'"'),u.push(">"),u.push('<input type="radio" name="{0}_input" id="{0}_item_'+t+'" value="'+e+'">'),u.push("&nbsp;"),u.push(n.escapeHtml(l[t]||"")),u.push("</label>"),o.inline||o.horizontal||u.push("</div>")}),r.utils.addErrorDiv(u),o.columns&&u.push("</div>")},null),n.format(u.join(""),t)},s=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype._state2UI=function(){e.prototype._state2UI.call(this,function(e){e.checked=!0})},t.prototype.changed=function(t,n,o,i){var r=this;if(r.state.value!=o){r.state.value=o;var a=r.$schema.enum.indexOf(r.state.value),s=e.prototype._item.call(this,a);s&&(s.checked=!0)}},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);if(!t.$element){var o=t.$schema.enumNames||t.$schema.enum;o=o.map(function(e){return i.tt(e,t.form.$locale)}),t.$schema.description&&(n.description=i.tt(t.$schema.description,t.form.$locale)),t.$element=$(a(t.id,n,t.options.design,i.tt(t.$schema.title,t.form.$locale),t.$schema.enum,o)),t.setEvents(n),t._state2UI()}return t.appendElement(e,n),t.$element},t}(t.Group);t.RadioGroup=s,o.registerControl(s,"*",!0,"radio",null)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){function n(t,n,i,r,a){r=r||"",n.styles=n.styles?n.styles:e.bootstrap4?"form-control-plaintext":"form-control-static",n=$.extend({titleIsHidden:!1},n);var l=[];return s.utils.fieldWrapper(l,n,i,function(){l.push('<div style="background-color: red;">'+r+"</div>")}),o.format(l.join(""),t)}var o=e.utils,i=t,r=e.dom,a=e.ulocale,s=e.uiutils,l=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this,s=r;return s._map=[],t.options&&t.options.$expression?(s.$expression=t.options.$expression,o.extractAngularVars(s.$expression,s._map)):(s.$expression=o.format("{0}: {{{1}}}",o.escapeHtml(a.tt(s.$schema.title,s.form.$locale)),s.$bind),s._map.push({name:s.$bind})),s._map.forEach(function(e){e.name!=s.$bind?(e.schema=i.getSchema(e.name),s.form.registerListenerFor(e.name,s)):e.schema=s.$schema}),r._state(),r}return __extends(t,e),t.prototype._state=function(){var e=this;e.state=e.state||{},e.state.values=e.state.values||{},e.state.fvalues=e.state.fvalues||{};var t=e.form.getState(e.$bind);e.state.isHidden=t.isHidden,e._refreshValues()},t.prototype._refreshValues=function(){var e=this;e._map.forEach(function(t){e.state.values[t.name]=e.form.getValue(t.name);var n=e.form.getState(t.name);e.state.fvalues[t.name]=s.utils.displayValue(e.state.values[t.name],t.schema,e.form.$locale,{html:!1,useSymbol:!0,state:n},e.state.values,t.name).value})},t.prototype._value2UI=function(){var e=this,t=e.$element?e.$element.get(0):null,n=o.execAngularExpression(e.$expression,e.state.fvalues,!0),i=$("<div>"+o.escapeHtml(n)+"</div>").get(0);for(r.empty(t);i.childNodes.length>0;)t.appendChild(i.childNodes[0])},t.prototype._findMap=function(e){for(var t=this,n=0,o=t._map.length;n<o;n++){var i=t._map[n];if(i.name===e)return i}return null},t.prototype.changed=function(e,t,n,o){var i=this;i._refreshValues(),i._value2UI()},t.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(i)),o.symbol!==n.state.symbol&&(o.symbol=n.state.symbol),o.decimals!==n.state.decimals&&(o.decimals=n.state.decimals)},t.prototype._state2UI=function(){var e=this,t=e.$element?e.$element.get(0):null;t&&(e.setHidden(t),e._value2UI())},t.prototype.render=function(e){var t=this,o=t._initOptions(s.utils.defaultOptions);return t.$element||(t.$element=$(n(t.id,o,t.options.design,a.tt(t.$schema.title,t.form.$locale))),t._state2UI()),t.appendElement(e,o),t.$element},t.prototype.destroy=function(){var t=this;t._map.forEach(function(e){e.name!=t.$bind&&t.form.unRegisterListenerFor(e.name,t)}),e.prototype.destroy.call(this)},t}(t.AbsField);t.ReadOnlyField=l,i.registerControl(l,"*",!1,"",{readOnly:!0})}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=(n.formedit,n.dom),i=(n.locale,n.ui),r=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this,r=i;return r._searchField=t.options.search,r._query=r.form.getValue(r._searchField),i}return __extends(t,e),t.prototype.updateModel=function(){var e=this;e._query.search=e.state.value},t.prototype.destroy=function(){this._query=null,e.prototype.destroy.call(this)},t.prototype.keyup=function(e){var t=this;t._input();return!!t._ignoreKeys(e,!0)||(t.state.isReadOnly||t.state.isDisabled,t.customKeyUp(e),!0)},t.prototype.customKeyUp=function(e){var t=this;t._incremental&&(window.clearTimeout(t._incremental),delete t._incremental),t._incremental=window.setTimeout(function(){delete t._incremental,t._input2Model(!1)},0)},t.prototype.changed=function(e,t,n,o){},t.prototype._ignoreKeys=function(t,n){var i=this;if(!n){if(t.which===o.keys.VK_UP)return i._query.moveSelected(-1,!0),!0;if(t.which===o.keys.VK_DOWN)return i._query.moveSelected(1,!0),!0}return e.prototype._ignoreKeys.call(this,t,n)},t}(e.formedit.Edit);t.Search=r,i.registerControl(r,"string",!1,"search",null)}(e.search||(e.search={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=t,o=e.utils,i=(e.formedit,e.uiutils),r=e.dom,a=(e.locale,e.Observable.SchemaUtils,e.ulocale),n=t,s=function(t,n,r,a,s,l){a=a||"";var u=[];return(n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},n)).titleIsHidden&&(n.columns=!1),n.placeHolder=!1,i.utils.fieldWrapper(u,n,r,function(){var t=e.bootstrap4;if(!n.titleIsHidden){u.push('<label for="{0}_input" id="{0}_label"');var r=["bs-label"];n.columns&&(t?r.push("col-form-label"):r.push("checkbox-inline bs-cursor-d"),r.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&r.push("text-left")),n.inline&&(t?r.push("form-check-inline"):r.push("checkbox-inline"),r.push("bs-cursor-d no-x-padding")),r.length&&u.push(' class="'+r.join(" ")+'"'),u.push(">"),u.push(o.escapeHtml(a||"")+(n.inline?"&nbsp;":"")),i.utils.addTooltipAndRule(u,n),u.push("</label>")}if(n.columns&&u.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),n.readOnly){u.push('<div class="form-control bs-read-only'),t&&n.size&&u.push(" form-control-"+n.size),u.push('" id="{0}_input"');c=[];n.maxWidth&&c.push("max-width: "+n.maxWidth+";"),n.minWidth&&c.push("min-width: "+n.minWidth+";"),c.length&&u.push(' style="'+c.join("")+'"'),u.push(">"),u.push("</div>")}else{u.push('<select class="form-control'),n.size&&t&&u.push(" form-control-"+n.size),u.push('" id="{0}_input"');var c=[];n.maxWidth&&c.push("max-width: "+n.maxWidth+";"),n.minWidth&&c.push("min-width: "+n.minWidth+";"),c.length&&u.push(' style="'+c.join("")+'"'),u.push(">"),s.forEach(function(e,t){u.push('<option value="'+e+'">'+l[t]+"</option>")}),u.push("</select>")}i.utils.addErrorDiv(u),n.columns&&u.push("</div>"),n.titleIsHidden&&i.utils.addTooltipAndRule(u,n)}),o.format(u.join(""),t)},l=function(e){function t(t,n,o){return e.call(this,t,n,o)||this}return __extends(t,e),t.prototype.fillSelect=function(e){var t=this;t.renderOptions.readOnly||i.utils.fillSelect(e,t._input(),t.$schema)},t.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype._setReadOnly=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype._state2UI=function(){var t=this;t._input()&&t._setFilter(!0),e.prototype._state2UI.call(this)},t.prototype._setFilter=function(e){var t=this,n=t.state.filter;if(!e||n){var o=n?t.$schema.filters[n]||[]:t.$schema.enum;if(t.fillSelect(o),!e)if(o.indexOf(t.state.value)<0)t.form.setValue(t.$display,o.length?o[0]:null);else{var i=t._input();i&&t._value2Input(i)}}},t.prototype.stateChanged=function(t,n){var o=this,i=o.form.getState(o.$bind);e.prototype.stateChanged.call(this,t,n),t&&"filter"!==t||o.state.filter!==i.filter&&(o.state.filter=i.filter,o._setFilter(!1))},t.prototype.render=function(e){var t=this,n=t._initOptions(i.utils.defaultOptions);if(!t.$element){var o=t.$schema.enumNames||t.$schema.enum;o=o.map(function(e){return a.tt(e+"",t.form.$locale)}),n.title=a.tt(t.$schema.title,t.form.$locale),t.$schema.description&&(n.description=a.tt(t.$schema.description,t.form.$locale));var r=t.state.filter,l=r?t.$schema.filters[r]||[]:t.$schema.enum;t.$element=$(s(t.id,n,t.options.design,n.title,l,o)),t._state2UI(),t.setEvents(n)}return t.appendElement(e,n),t.$element},t.prototype.removeEvents=function(){var e=this;if(!e.renderOptions.readOnly){var t=e._input();$(t).off("change")}},t.prototype._value2Input=function(e){var t=this;if(t.renderOptions.readOnly){var n=t.$schema.enumNames||t.$schema.enum;n=n.map(function(e){return a.tt(e+"",t.form.$locale)});var o=t.$schema.enum.indexOf(t.state.value);r.text(e,n[o]||String.fromCharCode(160))}else e.selectedIndex=t.state.filter?t.$schema.filters[t.state.filter].indexOf(t.state.value):t.$schema.enum.indexOf(t.state.value)},t.prototype.setEvents=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t._input();$(n).on("change",function(e){var n=t._input(),o=t.state.filter?t.$schema.filters[t.state.filter][n.selectedIndex]:t.$schema.enum[n.selectedIndex];t.state.value!==o&&(t.state.value=o,t.form.setValue(t.$display,t.state.value))})}},t}(e.formedit.BaseEdit);t.Select=l,n.registerControl(l,"*",!0,"",null)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=e.ui,i=e.dom,r=e.ulocale,a=e.uiutils,s=function(t,o,r,s,l,u){s=s||"",o=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},o);var c=[];return a.utils.fieldWrapper(c,o,r,function(){e.bootstrap4;var t=["btn-group"];c.push('<div class="'+t.join(" ")+'">'),l.forEach(function(e,t){c.push('<button tabindex="-1" type="button" id="{0}_item_'+t+'" class="btn btn-'+i.bootstrapStyles(!0).secondary+'"'),o.width&&c.push(' style="width:'+o.width+'"'),c.push(">"),c.push(n.escapeHtml(u[t]||"")),c.push("</button>")}),c.push("</div>")}),n.format(c.join(""),t)},l=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype._state2UI=function(){e.prototype._state2UI.call(this,function(e){i.addClass(e,"btn-primary"),i.removeClass(e,"btn-"+i.bootstrapStyles(!0).secondary),e.tabIndex=0})},t.prototype.changed=function(t,n,o,r){var a=this;if(a.state.value!=o){if(a.state.value=o,!a.$element)return;e.prototype._enumItems.call(this,function(e,t){a.state.value===t?(e.tabIndex=0,a.focused&&e.focus(),i.addClass(e,"btn-"+i.bootstrapStyles(!1).primary),i.removeClass(e,"btn-"+i.bootstrapStyles(!0).secondary)):(i.addClass(e,"btn-"+i.bootstrapStyles(!0).secondary),i.removeClass(e,"btn-"+i.bootstrapStyles(!1).primary),e.tabIndex=-1)})}},t.prototype.render=function(e){var t=this,n=t._initOptions(a.utils.defaultOptions);if(!t.$element){var o=t.$schema.enumNames||t.$schema.enum;o=o.map(function(e){return r.tt(e,t.form.$locale)}),t.$element=$(s(t.id,n,t.options.design,r.tt(t.$schema.title,t.form.$locale),t.$schema.enum,o)),t._state2UI()}return t.appendElement(e,n),t.$element},t}(e.ui.Group);t.WizardSteps=l,o.registerControl(l,"*",!0,"wizardctrl",null)}(e.wizardctrl||(e.wizardctrl={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){function n(t,n,i,a){a=a||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var s=[];return l.utils.fieldWrapper(s,n,i,function(){var t=e.bootstrap4;if(!n.titleIsHidden){var i=["bs-label"];s.push('<label for="{0}_input" id="{0}_label"'),n.columns&&(t?i.push("col-form-label"):i.push("checkbox-inline"),i.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&i.push("text-left")),n.inline&&(t?i.push("form-check-inline"):i.push("checkbox-inline"),i.push("bs-cursor-d no-x-padding")),i.length&&s.push(' class="'+i.join(" ")+'"'),s.push(">"),s.push(r.escapeHtml(a||"")+(n.inline?"&nbsp;":"")),l.utils.addTooltipAndRule(s,n),s.push("</label>")}n.columns&&s.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'" id="{0}_colparent">'),o(s,n,a),n.columns&&s.push("</div>"),n.titleIsHidden&&l.utils.addTooltipAndRule(s,n)}),r.format(s.join(""),t)}function o(e,t,n){var o=t.inline?"tgl-btn-inline":"";e.push('<input class="tgl tgl-light" id="{0}_input" type="checkbox">'),e.push(r.format('<label class="tgl-btn {0}" for="{1}_input"></label>',o,"{0}"))}var i=t,r=e.utils,a=e.dom,s=e.ulocale,l=e.uiutils,u=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype._check=function(){var e=this;if(!e.$element)return null;var t=e.$element.get(0);return a.find(t,e.id+"_input")},t.prototype.click=function(e){var t=this,n=t._check(),o=n.checked||!1;e.target==n&&t.state.value!=o&&(t._isBinded?(t.state.value=o,t.form.setValue(t.$bind,o)):t.setInternalValue(o,!0))},t.prototype._setDisabled=function(e,t){var n=this,o=n._check();n.state.isDisabled||n.state.isReadOnly?a.addClass(o,"disabled"):a.removeClass(o,"disabled"),e.disabled=n.state.isDisabled},t.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},t.prototype._setMandatory=function(e,t){},t.prototype._state2UI=function(){var e=this,t=e._check(),n=e.$element?e.$element.get(0):null;t&&(t.checked=e.state.value||!1,e._setDisabled(t,n),e._setReadOnly(t,n),e.setHidden(n))},t.prototype.changed=function(e,t,n,o){var i=this,r=i._check();i.state.value!=n&&(i.state.value=n,r.checked=i.state.value||!1)},t.prototype.stateChanged=function(e,t){var n=this,o=n._isBinded?n.form.getState(n.$bind):n._internalState,i=n._check(),r=n.$element?n.$element.get(0):null;o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,i&&n.setHidden(r)),o.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=o.isDisabled,i&&n._setDisabled(i,r)),o.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=o.isReadOnly,i&&n._setReadOnly(i,r)),o.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=o.isMandatory,i&&n._setMandatory(i,r))},t.prototype.render=function(e){var t=this,o=t._initOptions(l.utils.defaultOptions);return t.$element||(t.$schema.description&&(o.description=s.tt(t.$schema.description,t.form.$locale)),t.$element=$(n(t.id,o,t.options.design,s.tt(t.title,t.form.$locale))),t._state2UI()),t.appendElement(e,o),t.$element},t}(t.AbsField);t.Toggle=u,i.registerControl(u,"boolean",!1,"toggle",null)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.utils,o=t.ui,i=t.dom,r=t.uiutils;!function(t){var a=function(e,t,o,r,a,s){var l=['<div id="{0}_{1}" class="d-inline-block">','<div class="bs-step bs-cursor-p d-table align-middle bs-cursor-pointer">','<span data-step-code="{2}" class="bs-step-icon d-table-cell align-middle">','<span data-step-code="{2}" id="{0}_{1}_icon" class="bs-step-circle text-center d-inline-block'+("A"===a?" active "+i.iconClass("edit"):"V"===a?" validated "+i.iconClass("check"):"")+'">'+("N"===a?t:"")+"</span>","</span>",'<span data-step-code="{2}" id="{0}_{1}_title" class="bs-pointer-p bs-step-title d-table-cell align-middle text-nowrap">'+n.escapeHtml(r)+"</span>",'<span id="{0}_{1}_line" class="bs-step-line bs-cursor-d d-table-cell align-middle'+(s?" bs-none":"")+'"><span class="bs-step-line-content"></span></span>',"</div>","</div>"];return $(n.format(l.join(""),e,t,o)).get(0)},s=function(e,t){var o=[];return r.utils.fieldWrapper(o,{},t,function(){o.push('<div class="bs-step-root">'),o.push('<span data-action="prev" id="{0}_prev" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle invisible">'),o.push('<span data-action="prev" class="bs-step-arrow text-center d-inline-block '+i.iconClass("arrow-left")+'"></span>'),o.push("</span>"),o.push('<div class="bs-step-parent-parent" id="{0}_root"><div class="bs-step-parent invisible" id="{0}_parent"></div></div>'),o.push('<span data-action="next" id="{0}_next" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle invisible">'),o.push('<span data-action="next" class="bs-step-arrow text-center d-inline-block '+i.iconClass("arrow-right")+'"></span>'),o.push("</span>"),o.push("</div>")}),$(n.format(o.join(""),e)).get(0)},l=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i._init(),i}return __extends(t,e),t.prototype._createSteps=function(){var e=this,t=e.$element.get(0),n=i.find(t,e.id+"_parent"),o=e._steps.length-1;e._steps.forEach(function(t,i){n.appendChild(a(e.id,i+1,t.code,t.libelle,t.status,i&&i===o))})},t.prototype._measure=function(e){var t=this;t._measured=!0;var n=t.$element.get(0),o=i.find(n,t.id+"_parent");t._steps.length;t._hlineWidth=0,t._steps.forEach(function(e,n){var r=o.childNodes[n],a=i.position(r,o);e.width=a.width;var s=i.find(r,t.id+"_"+(n+1)+"_title");if(i.addClass(s,"bs-none"),a=i.position(r,o),e.widthNoCaption=a.width,i.removeClass(s,"bs-none"),0===n){var l=i.find(r,t.id+"_"+(n+1)+"_line");a=i.position(l,o),t._hlineWidth=a.width}}),t._resizeTo(e),i.removeClass(o,"invisible")},t.prototype._init=function(){var e=this;e._steps=[];for(var t=!1,n=0;n<e.$schema.enum.length;n++){var o="V";t?o="N":e.state.value===e.$schema.enum[n]&&(t=!0,o="A"),e._steps.push({code:e.$schema.enum[n],libelle:e.$schema.enumNames[n],status:o,width:0,widthNoCaption:0})}},t.prototype.click=function(e){var t,n=this,o=i.attr(e.target,"data-action");if("next"===o?(r=n.$schema.enum.indexOf(n.state.value))>=0&&r+1<n.$schema.enum.length&&(t=n.$schema.enum[r+1]):"prev"===o?(r=n.$schema.enum.indexOf(n.state.value))>0&&(t=n.$schema.enum[r-1]):t=i.attr(e.target,"data-step-code"),t){if(1===n.renderOptions.step){n.state.value;var r=n.$schema.enum.indexOf(n.state.value);if(r>=0){var a=n.$schema.enum.indexOf(t);a&&a>r&&(t=n.$schema.enum[r+1])}else t=n.state.value}n.form.setValue(n.$bind,t)}},t.prototype.changed=function(e,t,n,o){var r=this;r.state.value=n;var a=!1;if(r._steps&&r._steps.length)for(var s=0;s<r._steps.length;s++){var l=r._steps[s],u="V";if(a?u="N":r.state.value===l.code&&(a=!0,u="A"),l.status!==u){l.status=u;var c=i.find(r.$element.get(0),r.id+"_"+(s+1)+"_icon"),d=["bs-step-circle text-center d-inline-block"],p=!0;"A"===u?(p=!0,d.push(i.iconClass("edit")),d.push("active")):"V"===u?(p=!0,d.push(i.iconClass("check")),d.push("validated")):p=!1,c.className=d.join(" "),i.text(c,p?"":s+1+"")}}r.resize()},t.prototype._resizeTo=function(e){var t=this,n=t.$element.get(0),o=i.find(n,t.id+"_parent"),r=0,a=0,s=0,l=t._steps.length;t._steps.forEach(function(e,n){switch(r+=e.width,e.status){case"A":a+=e.width,s+=e.width;break;case"V":var o=t._steps[n+1];o&&"A"===o.status?a+=e.width:a+=e.widthNoCaption,s+=e.widthNoCaption;break;case"N":var i=t._steps[n-1];i&&"A"===i.status?a+=e.width:a+=e.widthNoCaption,s+=e.widthNoCaption}});var u=0,c=!1,d=!1,p=!1;if(r<=e?(c=!0,u=e-r):a<=e?(c=!0,d=!0,u=e-a):s<=e&&(c=!0,p=!0,u=e-s),c){for(var f=t._steps.length>1?t._steps.length-1:1,m=Math.floor(u/f)+t._hlineWidth,h=i.queryAll(o,".bs-step-line"),v=0,g=h.length;v<g;v++){var y=h[v];i.hasClass(y,"bs-none")||(y.style.width=m+"px")}t._steps.forEach(function(e,n){var r=o.childNodes[n],a=i.find(r,t.id+"_"+(n+1)+"_title");if(n&&n===l-1){var s=i.find(r,t.id+"_"+(n+1)+"_line");i.hasClass(s,"bs-none")||i.addClass(s,"bs-none")}if(d)switch(e.status){case"A":i.removeClass(a,"bs-none");break;case"V":var u=t._steps[n+1];u&&"A"===u.status?i.removeClass(a,"bs-none"):i.hasClass(a,"bs-none")||i.addClass(a,"bs-none");break;case"N":var c=t._steps[n-1];c&&"A"===c.status?i.removeClass(a,"bs-none"):i.hasClass(a,"bs-none")||i.addClass(a,"bs-none")}else p?"A"===e.status?i.removeClass(a,"bs-none"):i.hasClass(a,"bs-none")||i.addClass(a,"bs-none"):i.removeClass(a,"bs-none");i.removeClass(r,"bs-none")})}else t._steps.forEach(function(n,r){var a=o.childNodes[r],s=i.find(a,t.id+"_"+(r+1)+"_title");if("A"===n.status){var u=i.find(a,t.id+"_"+(r+1)+"_line");r===l-1&&i.removeClass(u,"bs-none"),u.style.width=Math.max(0,e-n.width+t._hlineWidth)+"px",i.removeClass(s,"bs-none"),i.removeClass(a,"bs-none")}else i.hasClass(a,"bs-none")||i.addClass(a,"bs-none")})},t.prototype.resize=function(){var e=this,t=e.$element.get(0),n=i.find(t,e.id+"_root"),o=(i.find(t,e.id+"_parent"),e.$schema.enum.indexOf(e.state.value)),r=o+1<e.$schema.enum.length,a=o>0,s=i.find(t,e.id+"_next"),l=i.find(t,e.id+"_prev");r?i.removeClass(s,"invisible"):i.hasClass(s,"invisible")||i.addClass(s,"invisible"),a?i.removeClass(l,"invisible"):i.hasClass(l,"invisible")||i.addClass(l,"invisible");var u=i.position(n,null).width;e._measured?e._resizeTo(u):window.setTimeout(function(){e._measure(u)},10)},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.$element=$(s(t.id,t.options.design)),t._createSteps()),t.appendElement(e,n),t.$element},t}(e.ui.AbsField);o.registerControl(l,"*",!0,"steppers")}(e.wizard||(e.wizard={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t,n=e.render,o=e.ui,i=e.formlink,r=e.Observable.SchemaUtils;!function(e){var t=function(e,t,n){if(r.isLink(e.$bind))return i.Link;var a=r.isMeta(e.$bind);if(a)return o.getRegisteredControl("meta",!1,a.widget,"",{});if(!t)return null;var s;return e.$readOnly&&((s=s||{}).readOnly=!0),n&&((s=s||{}).lookup=!0),o.getRegisteredControl(t.type,!!t.enum,e.$widget,t.format,s)};n.register("javascript","field.control",t),n.register("angular","field.control",t)}(t||(t={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.locale,o=t.ui,i={type:"object",properties:{message:{type:"string"}}},r={name:"alert",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},a=function(e,t,a){var s={title:e=e||n.ui.Info,buttons:[{type:"primary",title:n.ui.Ok,name:"ok"}]},l={message:t};o.OpenModalForm(s,r,i,l,null,function(e,t,n,o){if("modal-action"===t.operation)switch(t.property){case"ok":e.close(),a&&a()}})};t.utils.alert=function(e,t,n){a(e,t,n)}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.locale,o=t.external,i=t.application,r=t.DatasetPlugin,a=t.dom,s=t.ui,l={name:"form",$type:"block",$items:[{$bind:"oldPwd"},{$bind:"newPwd"},{$bind:"$$newPwd"}]};o.changePasswordHandler=function(e){var t={type:"object",properties:{oldPwd:{title:n.ui.password.oldPassword,type:"string",format:"password",capabilities:{noConfirming:!0}},newPwd:{title:n.ui.password.newPassword,type:"string",format:"password",minLength:8}},states:{oldPwd:{isMandatory:!0},newPwd:{isMandatory:!0}}},o={title:n.ui.password.change,buttons:[{pattern:"validate"}]};s.OpenModalForm(o,l,t,{},{},function(t,n,o,s){switch(n.property){case"validate":if(!o.validate())return;var l={},u=i.configuration&&i.configuration.application&&i.configuration.application.authentication?i.configuration.application.authentication.changePasswordDs:null;if(!u)return void t.close();a.processing(!0);var c={oldPwd:o.oldPwd,newPwd:o.newPwd};u.name="data",r.executeDatasets([u],c,l,[],function(n,i){i?(o.addAjaxException(i),a.processing(!1)):(a.processing(!1),t.close(),e&&e())})}})}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.locale,o=t.ui,i=t.utils,r={type:"object",properties:{message:{type:"string"}}},a={name:"confirm",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},s=function(e,t,i,s){var l={title:e=e||n.ui.Warning,buttons:[{type:"default",title:n.ui.No,name:"no"},{type:"primary",title:n.ui.Yes,name:"yes"}]},u={message:t};o.OpenModalForm(l,a,r,u,null,function(e,t,n,o){if("modal-action"===t.operation)switch(t.property){case"yes":e.close(),i&&i();break;case"no":e.close(),s&&s()}})};e.confirmDlg=s,i.confirm=function(e,t,n,o){s(e,t,n,o)}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=(n.dom,n.link),i=n.utils,r=(n.application,n.ulocale,n.locale,function(e){var t=n.bootstrap4,o=[],i=["bs-relative bs-image-mi-image"];i.push(t?"img-fluid":"img-responsive"),o.push('<div id="{0}" class="bs-image-mi bs-cursor-d">'),o.push('<div class="bs-image-mi-border"'),e.link&&o.push('href="click://navigate"'),o.push(">");var r=["max-width:"+e.maxWidth+"px;"];return o.push('<img id="{0}_img" class="'),o.push(i.join(" ")),o.push('" src="'+e.imageSrc+'"'),r.length&&o.push(' style="'+r.join("")+'"'),o.push(" />"),o.push('<span class="bs-image-mi-title">'+e.title+"</span>"),o.push("</div>"),o.push("</div>"),o.join("")}),a=function(){function e(e,t){var n=this;n.$id=i.allocID(),t.maxWidth=t.maxWidth||128,n._options=t}return e.prototype._setEvents=function(){var e=this;if(e.$element){if(e._options.authoring)return;var t=e.$element.get(0);e.$element.on("click",function(n){var i=o.isCustomLink(t,n);if(i&&"click"===i.protocol){var r=e._options.link,a=o.context();"string"==typeof r?e.module&&e.module.links&&e.module.links[r]?o.execLink(e.module.links[r],a,null):o.execLink({$page:r},a,null):r.$page&&o.execLink(r,a,null)}})}},e.prototype._removeEvents=function(){var e=this;e._options.authoring||e.$element&&e.$element.off("click")},e.prototype.render=function(e){var t=this;t.$element||(t.$element=$(i.format(r(t._options),t.$id)),t._setEvents()),e&&(t._options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))},e.prototype.destroy=function(){var e=this;e.module=null,e._removeEvents(),e.$element=null,e._options=null},e}();t.ImageMenuItem=a}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=n.data,i=n.utils,r=function(){function e(e,t,n,o,i,r,a){var s=this;s._enums={},s._entity=t,s._module=e,s._typeField=n,s._codeField=o,s._titleField=i,s._orderByField=r,s._fields=a}return e.prototype.promise=function(e,t){var n={},r=[],a=this,s=[];if(Object.keys(e).forEach(function(t){var o=e[t];if(a._enums[t])n[t]=a._enums[t];else{r.push({name:t,config:o});var i=a._typeField+" eq '"+t+"'";o.filter&&(i="("+i+" and "+o.filter+")"),s.push(i)}}),!r.length)return new i.Promise(function(e,o){e({type:t,enums:n})});var l={$top:1e3,nocount:!0,$entity:a._entity,$module:a._module,$filter:s.join(" or "),$orderby:a._typeField+","+a._orderByField};return o.odata.getRessources(l,function(e){return e.documents&&e.documents.forEach(function(e){var t=e[a._codeField],o=e[a._titleField],i=e[a._typeField];if(n[i]||(n[i]={enum:[],enumNames:[]},a._enums[i]=n[i]),a._fields){n[i].fields=n[i].fields||[];var r=[],s={};if(a._fields.forEach(function(t){e[t]&&r.push(e[t]),s[t]=e[t]}),n[i].fields.push(s),r.length){var l=r.join("$");n[i].filters=n[i].filters||{},n[i].filters[l]=n[i].filters[l]||[],n[i].filters[l].push(t)}}n[i].enum.push(t),n[i].enumNames.push(o)}),{type:t,enums:n}})},e}();t.OdataEnumManager=r}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,n=t.locale,o=t.utils,i=t.ui,r={type:"object",properties:{value:{type:"string"}}},a={name:"prompt",$type:"block",$items:[{$bind:"value",options:{titleIsHidden:!0}}]},s=function(e,t,o){var s={title:e=e||n.ui.Warning,buttons:[{type:"primary",title:n.ui.Ok,name:"ok"}]},l={value:t||""};i.OpenModalForm(s,a,r,l,null,function(e,t,n,i){if("modal-action"===t.operation)switch(t.property){case"ok":var r=n.value;e.close(),o&&o(r)}})};o.prompt=function(e,t,n){s(e,t,n)}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.application,n=e.external,o=e.ajax,i=e.utils;n.ruleLoaderHandler=function(e){var n=t.configuration;if(n&&n.rules&&n.rules.odataEntity){var r=n.rules.odataEntity+"?$filter="+encodeURIComponent("clientSide eq 'true'")+"&$expand="+encodeURIComponent("entities($filter=entity in ("+e.map(function(e){return"'"+e+"'"}).join(",")+"))"),a=o.getDefaultAjaxOptions();return o.get(r,a,function(e){return e.value})}return i.Promise.resolve([])}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.autoclose,n=e.external,o=e.ui;n.ruleViewer=function(e){var n={name:{name:"rule-list-viewer",form:!0,$type:"block",$items:[{$type:"block",$title:{value:"Rules",size:4},$items:[{$bind:"rules",$widget:"basicgrid",options:{border:!0,height:400,scrolling:{horizontal:!0,vertical:!0},columns:[{$bind:"ruleType",options:{width:70}},{$bind:"name",options:{width:100}},{$bind:"description",options:{width:150}},{$bind:"expression",options:{width:200}}]}}]}]},meta:{type:"object",properties:{rules:{type:"array",items:{type:"object",properties:{name:{type:"string",title:"Name"},description:{type:"string",title:"Description"},ruleType:{type:"string",title:"Type"},expression:{type:"string",title:"Expression"}}}}}},controller:{onModelChanged:function(){}},autoClose:{align:t.SCREEN_CENTER,minWidth:300,showCloseButton:!0},options:{}};o.showAutoCloseForm(n,{rules:e},null)}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=(n.ulocale,n.application),i=n.ajax,r=n.data,a=n.utils,s=n.Observable.SchemaUtils,l=n.dom,u={getRessources:function(e,t){var n=function(e){return t&&(e=t(e)),e},r=o.config(o.name);if(!r)throw"Application configuration not found.";var u=r.current.prototypes+"/"+e,c=i.get(u,{},function(e){return e});return new a.Promise(function(e,t){c.then(function(o){l.processing(!0),s.loadEnumsPromise(o).then(function(t){l.processing(!1),e(n(t))}).catch(function(e){l.processing(!1),t(e)})}).catch(function(e){t(e)})})}};r.registerDataProvider("form-meta",function(e,t,n,o){return u.getRessources(e.$params.$url,function(e){return e})})}(e.Data||(e.Data={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e,o=(n.dom,n.utils,n.locale,function(){function e(e){var t={src:"https://www.google.com"};this._options=$.extend(t,e||{})}return e.prototype._setEvents=function(){var e=this;if(e.$element){var t=e.$element;t.iFrameResize&&t.iFrameResize(e._options)}},e.prototype._removeEvents=function(){},e.prototype.render=function(e){var t=this;t.$element||(t.$element=$('<iframe src="'+t._options.src+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>'),t._setEvents()),e&&(t._options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))},e.prototype.destroy=function(){var e=this;e._removeEvents(),e.$element=null,e._options=null},e}());t.IFrame=o}(e.iframe||(e.iframe={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){e.ulocale;var n=e.utils,o=(e.ajax,e.dom),i=(e.link,function(){function e(e,t,n){var o=this;o._fieldList=e||[],o._oldFilter=[],o._cb=t||null,o._options=n||{},o._nodeMain=$("<div class='form-inline bs-filterexpress' id='"+o._options.id+"'></div>")}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._fieldList},set:function(e){var t=this;t._fieldList=e&&Array.isArray(e)&&e.length?e:t._fieldList,t.renderFieldsList(),t.renderSelectedFields()},enumerable:!0,configurable:!0}),e.prototype._getFieldByCode=function(e){var t=null;return this._fieldList.forEach(function(n){n.code===e&&(t=n)}),t},e.prototype._getEditField=function(e){var t;switch(e.format){case s.FORMAT_INTEGER:t="<input type='number' class='form-control' aria-label='...'>";break;case s.FORMAT_STRING:t="<input type='text' class='form-control' aria-label='...'>";break;case s.FORMAT_ENUM:t="<select class='form-control'>",e.enum&&e.enum.forEach(function(n,o){var i=e.enumNames&&e.enumNames[o]?e.enumNames[o]:n;t+="<option value='"+n+"'>"+i+"</option>"}),t+="</select>"}return $(t)},e.prototype._getOpField=function(e){var t;switch(e.format){case s.FORMAT_INTEGER:t=s.OP_INTEGER;break;case s.FORMAT_STRING:t=s.OP_STRING;break;case s.FORMAT_ENUM:t=s.OP_ENUM;break;default:t=""}return t},e.prototype._checkFilter=function(e){return!e||""!=e.code&&""!=e.op},e.prototype.destroy=function(){var e=this;e._nodeValidate.off("click"),e._nodeMain.off("blur"),e._fieldList=null,e._cb=null,e._nodeMain=null,e._nodeValidate=null,e._options=null},e.prototype.renderFieldsList=function(){},e.prototype.renderSelectedFields=function(){},e.prototype.validerFilter=function(){},e.prototype.setEvents=function(){var e=this;e._nodeValidate.click(function(){e.validerFilter()})},e}()),r=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this,a=r,l=$('<div class="input-group"></div>'),u=$('<div class="input-group-btn"></div>'),c='<button type="button" ';c+='class="bs-button btn btn-'+o.bootstrapStyles(!0).secondary+' dropdown-toggle" data-toggle="dropdown" ',c+='aria-haspopup="true" aria-expanded="false"></button>';var d=$(c);a._nodeSelectButtonTxt=$("<span>"+s.FIELD_SELECT_TEXT_DEFAULT+"</span>");var p=$('<span class="caret"></span>');a._nodeSelectList=$('<ul class="dropdown-menu"></ul>'),a._nodeEdit=$('<input type="text" class="form-control" aria-label="...">');var f=$("<div class='input-group-btn'></div>");return a._nodeValidate=$('<button class="bs-button btn btn-'+o.bootstrapStyles(!0).secondary+'" type="button"><span class="'+o.iconClass(s.VALIDATE_ICON_DEFAULT)+'"></span> '+s.VALIDATE_TEXT_DEFAULT+"</button>"),a._nodeMain.append(l),l.append(u),l.append(a._nodeEdit),l.append(f),u.append(d),u.append(a._nodeSelectList),d.append(a._nodeSelectButtonTxt),d.append(p),f.append(a._nodeValidate),a.renderFieldsList(),a.renderSelectedFields(),a.setEvents(),r}return __extends(t,e),t.prototype.renderSelectedFields=function(){var e=this,t=null;if(e._fieldList.every(function(e){return!e.selected||(t=e,!1)}),!t&&e._fieldList&&e._fieldList.length&&(e._fieldList[0].selected=!0,t=e._fieldList[0]),t&&(e._nodeSelectButtonTxt.text(t.lib+" "),e._changeEditField(t)),e._nodeSelectedLi&&e._nodeSelectedLi.removeClass("bs-row-selected"),t){var n=o.query(e._nodeSelectList.get(0),"li[data-value='"+t.code+"']");n&&(e._nodeSelectedLi=$(n),e._nodeSelectedLi.addClass("bs-row-selected"))}},t.prototype._changeEditField=function(e){var t=this;t._removeEvents();var n,i;i=t._getEditField(e).get(0),(n=t._nodeEdit.get(0)).parentNode.replaceChild(i,n),t._nodeEdit=$(i),i.focus(),e.enum?(o.addClass(t._nodeValidate.get(0),"bs-none"),t._nodeEdit.change(function(e){e.target===t._nodeEdit.get(0)&&t.validerFilter()}),t._nodeEdit.get(0).style.borderTopRightRadius="4px",t._nodeEdit.get(0).style.borderBottomRightRadius="4px"):(o.removeClass(t._nodeValidate.get(0),"bs-none"),t._nodeEdit.keyup(function(e){13==e.keyCode&&t.validerFilter()}),t._nodeEdit.focus(function(e){t._nodeEdit.get(0).select()}))},t.prototype._removeEvents=function(){var e=this;e._nodeEdit.off("focus"),e._nodeEdit.off("keyup"),e._nodeEdit.off("change")},t.prototype.renderFieldsList=function(){var e=this;o.empty(e._nodeSelectList.get(0)),e._fieldList.forEach(function(t){e._nodeSelectList.append("<li class='bs-cursor-p' data-value='"+t.code+"'><a>"+t.lib+"</a></li>")})},t.prototype.setEvents=function(){var t=this;e.prototype.setEvents.call(this),t._nodeSelectList.click(function(e){var n=o.findByAttribute(e.target,t._nodeSelectList.get(0),"data-value");if(n){var i=n.attributes["data-value"].value;if(i){var r=t._getFieldByCode(i);t._fieldList=t._fieldList.map(function(e){return e.selected=e.code==i,e}),r&&t.renderSelectedFields()}}});var n=!1;t._nodeMain.get(0).addEventListener("focusout",function(e){n=!0;var i=!1,r=e.relatedTarget;if(r){var a=r;do{if(!a)break;if(o.hasClass(a,"bs-filterexpress")){i=!0;break}a=a.parentNode}while(a&&!i)}if(!i&&e.target==t._nodeEdit.get(0)&&t._oldFilter&&t._oldFilter.length&&t._oldFilter[0].code){var s=t._getSelected();s&&s.code!==t._oldFilter[0].code&&(t._fieldList=t._fieldList.map(function(e){return e.selected=e.code==t._oldFilter[0].code,e}),t.renderSelectedFields()),t._nodeEdit.val(t._oldFilter[0].values[0])}},!0),t._nodeMain.get(0).addEventListener("blur",function(e){if(!n){var i=!1,r=e.relatedTarget||e.explicitOriginalTarget;if(r){var a=r;do{if(!a)break;if(o.hasClass(a,"bs-filterexpress")){i=!0;break}a=a.parentNode}while(a&&!i)}if(!i&&e.target==t._nodeEdit.get(0)&&t._oldFilter&&t._oldFilter.length&&t._oldFilter[0].code){var s=t._getSelected();s&&s.code!==t._oldFilter[0].code&&(t._fieldList=t._fieldList.map(function(e){return e.selected=e.code==t._oldFilter[0].code,e}),t.renderSelectedFields()),t._nodeEdit.val(t._oldFilter[0].values[0])}}},!0)},t.prototype.validerFilter=function(){var e=this;if(e._cb){var t=e._getSelected(),n=e._nodeEdit.val()?{code:t.code,op:e._getOpField(t),values:[e._nodeEdit.val()]}:null;n&&!e._checkFilter(n)&&(n=null),e._oldFilter.splice(0),n&&e._oldFilter.push(n),e._cb(n)}},t.prototype._getSelected=function(){var e=null;return this._fieldList.every(function(t){return!t.selected||(e=t,!1)}),e},t}(i),a=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this,a=r;a.leftTools=$('<div class="input-group-btn"></div>'),a.rightTools=$('<div class="input-group-btn"></div>'),a._nodeValidate=$("<button class='btn btn-default' type='button'><span class='"+o.iconClass(s.VALIDATE_ICON_DEFAULT)+"'></span> "+s.VALIDATE_TEXT_DEFAULT+"</button>");var l=$('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span>&nbsp;<span class="sr-only">Toggle Dropdown</span></button>');return a._nodeSelectList=$('<ul class="dropdown-menu dropdown-menu-left">'),a.rightTools.append(a._nodeValidate),a.leftTools.append(l),a.leftTools.append(a._nodeSelectList),a.renderFieldsList(),a.renderSelectedFields(),a.setEvents(),r}return __extends(t,e),t.prototype.renderSelectedFields=function(){var e=this;o.empty(e._nodeMain.get(0)),e._fieldList.forEach(function(t){t.selected&&e.addField(t)});var t,n;e._nodeMain.get(0).childNodes.length?(t=$(e._nodeMain.get(0).firstChild),n=$(e._nodeMain.get(0).lastChild)):(n=t=$('<div class="input-group"></div>'),e._nodeMain.append(t)),n.append(e.rightTools),$(t.get(0).firstChild).before(e.leftTools)},t.prototype.addField=function(e){var t=this;e.composant={label:$('<span class="input-group-addon" id="sizing-addon2">'+(e.lib||e.libelle||e.code)+"</span>"),value:t._getEditField(e)};var n=$('<div class="input-group"></div>');n.append(e.composant.label),n.append(e.composant.value),t._nodeMain.append(n),e.selected=!0},t.prototype.renderFieldsList=function(){var e=this;o.empty(e._nodeSelectList.get(0)),e._fieldList.forEach(function(t){e._nodeSelectList.append('<li class="bs-cursor-p" data-value="'+t.code+'"><a href="#" tabIndex="-1"><input type="checkbox" '+(t.selected?"checked":"")+" />&nbsp;"+(t.lib||t.libelle||t.code)+"</a></li>")})},t.prototype.setEvents=function(){var t=this;e.prototype.setEvents.call(this),t._nodeSelectList.on("click",function(e){var n=o.findByAttribute(e.target,t._nodeSelectList.get(0),"data-value");if(n){var i=$(n);if(i.attr("data-value")){var r=i.find("input"),a=t._getFieldByCode(i.attr("data-value"));return a&&(a.selected?(setTimeout(function(){r.prop("checked",!1)},0),a.selected=!1):(setTimeout(function(){r.prop("checked",!0)},0),a.selected=!0),t.renderSelectedFields()),$(e.target).blur(),!1}}})},t.prototype.validerFilter=function(){var e=this;if(e._cb){var t=[];e._fieldList.forEach(function(n){if(n.selected){var o=n.composant.value.val();if(o){var i={code:n.code,op:e._getOpField(n),values:[o]};e._checkFilter(i)&&t.push(i)}}}),e._oldFilter.splice(0),e._oldFilter=t,e._cb(t.length?t:null)}},t}(i),s=function(){function e(e,t,o){var i=this;e=i._completeFieldList($.extend(!0,[],e)),i._cb=t;var s={id:n.allocID(),multiple:!1};i._options=$.extend(!0,s,o),i._options.multiple?i._render=new a(e,i._cb,i._options):i._render=new r(e,i._cb,i._options)}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._render.fields},set:function(e){var t=this;t._render.fields=e&&Array.isArray(e)?t._completeFieldList($.extend(!0,[],e)):[]},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){var e=this;e._render.destroy(),o.find(this._nodeParent[0],e._options.id).remove(),e._render=null,e._cb=null,e._options=null},e.prototype.render=function(e){var t=this;t._nodeParent=e,e.append(t._render._nodeMain)},e.prototype._completeFieldList=function(e){return e.forEach(function(e){e.enum&&Array.isArray(e.enum)?(e.format="enum",e.enum.splice(0,0,""),e.enumNames&&e.enumNames.splice(0,0,"")):e.format="number"===e.type?"integer":e.type}),e},e.FIELD_SELECT_TEXT_DEFAULT="Choix du champ",e.VALIDATE_TEXT_DEFAULT="",e.VALIDATE_ICON_DEFAULT="search",e.FORMAT_STRING="string",e.FORMAT_INTEGER="integer",e.FORMAT_ENUM="enum",e.OP_STRING="like",e.OP_INTEGER="in",e.OP_ENUM="in",e}();t.FilterExpress=s}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.DatasetPlugin,o=e.dom,i=function(){function e(e,t){var n=this;n._init=!1,n._options=t||{},n._notify=t.notify,n._ds=e||{},n._ds.mapping=n._ds.mapping||{},n._ds.mapping.code=n._ds.mapping.code||"code",n._ds.mapping.libelle=n._ds.mapping.libelle||n._ds.mapping.lib||"lib";var o=e.data.$params||{};n._pageSize=o.$top||null,n.searchText=null,n._count=0,n._page=0,n._items=[],n._initData()}return e.prototype._initData=function(){var e=this,t={},i=e._ds.data||{},r={name:"dataset",$type:i.$type||"odata",$params:{$entity:i.$params.$entity,$module:i.$params.$module,$top:1}};o.processing(!0),n.executeDatasets([r],{},t,null,function(n,i){if(o.processing(!1),!i){e._init=!0;var r=t.dataset;e._count=r.count,e._notify(null,{inited:!0,updated:!0})}},!1)},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){e&&(this._items=e,this._notifyChange("items"))},enumerable:!0,configurable:!0}),e.prototype._notifyChange=function(e){var t=this;switch(e){case"items":t._notify(t.items,{})}},e.prototype.getNbPages=function(){var e=this;return Math.ceil(e._count/e._pageSize)},e.prototype._getSkip=function(e){var t=this;return t._pageSize?e*t._pageSize:0},e.prototype._getPage=function(e,t){var i=this;if(i._init){var r=$.extend(!0,{},i._ds.data),a={};r.name="dataset",r.$params=r.$params||{},r.$params.$skip=i._getSkip(e),t=t||{},i.searchText&&(t.$searchText=i.searchText),o.processing(!0),n.executeDatasets([r],t,a,null,function(e,t){if(o.processing(!1),!t){var n=a.dataset;n&&i._count!=n.count&&(i._count=n.count,i._page=0,i._notify(null,{updated:!0})),n.documents&&(n.documents=n.documents.map(function(e){return{code:e[i._ds.mapping.code],libelle:e[i._ds.mapping.libelle]||e[i._ds.mapping.code]}}),i.items=n.documents)}},!1)}},e.prototype.currentPage=function(){return this._page},e.prototype.toPage=function(e){var t=this;e>=0&&e<t.getNbPages()&&(t._page=e,t._getPage(e))},e.prototype.nextPage=function(){var e=this,t=e._page+1;t<e.getNbPages()&&(e._page=t,e._getPage(t))},e.prototype.prevPage=function(){var e=this,t=e._page-1;t>=0&&(e._page=t,e._getPage(t))},e.prototype.firthPage=function(){var e=this;e._page=0,e._getPage(0)},e.prototype.lastPage=function(){var e=this,t=e.getNbPages()-1;e._page=t,e._getPage(t)},e.prototype.search=function(e){var t=this;t.searchText=e||null,t._ds.data.$params.$search&&t._getPage(0)},e.prototype.remove=function(){},e}();t.DsLookup=i}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=t,o=e.utils,i=e.filters,r=e.uiutils,a=e.locale,s=e.ulocale,l=e.dom,u=e.Observable.SchemaUtils,c=i.OPERATORS,d=i.TYPES,p=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,n,o){var i=this,r={code:e,libelle:t||e,isBinary:n,options:o||{}};r.options.symbol=o.symbol||t||e,n&&(r.options.liaison=r.options.liaison||"et"),i.liste.push(r)},e.prototype.gets=function(){return this.liste},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.code==e});t>=0&&this.liste.splice(t,1)},e}();t.ListeOperateurs=p;var f=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,n,o){this.liste.push({code:e,libelle:t||e,type:n||"string",options:o||{}})},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.gets=function(){return this.liste},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.code==e});t>=0&&this.liste.splice(t,1)},e}();t.ListeChamps=f;var m=function(){function e(e,t,n,o){var i=this;i.id=e,i.code=t,i.op=n,i.values=o||[]}return e.prototype.getValues=function(){return this.values.map(function(e){return e&&e.code?e.code:e})},e.prototype.getValueNames=function(){return this.values.map(function(e){return e&&e.lib?e.lib:e})},e}();t.Filter=m;var h=function(){function e(e){this.liste=[],this.filters=e,this.compteur=0}return e.prototype.add=function(e,t,n){var o=this,i=new m(o.compteur++,e,t,n);return o.liste.push(i),o.filters.push(i),i},e.prototype.add2=function(e,t,n){var o=this,i=new m(o.compteur++,e,t,n);return o.liste.push(i),i},e.prototype.set=function(e,t){var n,o=this,i=-1;if(o.liste.forEach(function(t,o){t.id==e&&(n=t,i=o)}),n&&(n.op=t.op,n.values=t.values||[]),i>=0&&i<o.filters.length){var r=o.filters.get(i);r&&(r.code=n.code,r.op=n.op,r.values=n.values)}return n},e.prototype.get=function(e){return this.liste.find(function(t){return t.id==e})},e.prototype.getByIndex=function(e){return this.liste[e]},e.prototype.gets=function(){return this.liste},e.prototype.getsByChamp=function(e){var t=[];return this.liste.forEach(function(n){n.code==e&&t.push(n)}),t},e.prototype.remove=function(e){var t=this,n=t.liste.findIndex(function(t){return t.id==e});n>=0&&(t.liste.splice(n,1),t.filters.remove(t.filters.get(n)))},e.prototype.removeAll=function(){var e=this;e.liste.splice(0),e.filters.forEach(function(t,n){e.filters.remove(e.filters.get(n))})},e.prototype.removeAllByChamp=function(e){var t=this;t.liste.forEach(function(n,o){n.code==e&&(t.liste.splice(o,1),t.filters.remove(t.filters.get(o)))})},e}();t.ListeFilters=h;var v=function(){function e(){this.liste=[]}return e.prototype.addType=function(e,t,n){this.liste.push({code:e,libelle:t||e,operateurs:n||[]})},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.addOperateur=function(e,t){this.liste.find(function(t){return t.code==e}).operateurs.push(t)},e.prototype.getOperateurs=function(e){return this.liste.find(function(t){return t.code==e}).operateurs},e}();t.ListeTypes=v;var g=function(){function e(e,t,n,o,i,r){this.listeChamps=e,this.listeFilters=t,this.listeOperateurs=n,this.filter=r,this.callBack=o,this.options=i||{},this.data={},this.init()}return e.prototype.init=function(){var e=this;e.model={type:"object",properties:{filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},selected:{type:"string"}}}}},links:{validate:{title:a.ui.Validate,isHidden:1!=e.options.btnValidate}}},e.layout={name:"form",$type:"block",$items:[{$type:"block",$items:[{$type:"block",$items:[{$bind:"filters",$widget:"tagview"}]},{$type:"block",$inline:!0,$items:[{$bind:"$links.validate",options:{type:"success",right:!0}}]}],$title:{value:a.ui.selectedFilters,size:5,style:""}}]},e.data.filters=e.listeFilters.gets().map(function(t){var n=e.listeOperateurs.get(t.op),o=e.listeChamps.get(t.code).libelle+" "+n.options.symbol+" ";return n.isBinary?o+=t.values[0]+" "+n.options.liaison+" "+t.values[1]:o+=t.getValueNames().join(", "),{code:t.id,libelle:o,selected:!(!e.filter||e.filter.id!=t.id)}})},e.prototype.render=function(e){var t=this;e&&n.OpenForm($(e),t.layout,t.model,t.data,{},function(e,n,o){switch(e.property){case"upd":t.callBack("EDIT",{id:e.actionParams.code});break;case"remove":t.callBack("REMOVE",{id:e.actionParams.code});break;case"$links.validate":t.callBack("VALIDE",{})}})},e}(),y=function(){function e(e,t,n){this.valueModel=null;var o=this;o.type=e,o.op=t,o.options=$.extend(!0,{},n),o.valueModel=o.getInstance()}return e.prototype.getInstance=function(){var e=this,t=e.addDefaultOptions(e.options);return e.op.isBinary?new C(t):e.op.code===c.empty||e.op.code===c.nempty?new b(t):"enum"===e.type?new w(t):"lookup"===e.type?new E(t):e.op.code!==c.in&&e.op.code!==c.nin||"decimal"==e.type||"money"==e.type||"date"==e.type||"date-time"==e.type?new x(t):new k(t)},e.prototype.init=function(e){this.valueModel.init(e)},e.prototype.addDefaultOptions=function(e){var t=this;switch(t.type){case"integer":e.type="number";break;case"decimal":e.type="number",e.decimals=e.decimals||5;break;case"money":e.type="number",e.format="money";break;case"date":e.type="string",e.format="date",e.title="Date";break;case"time":e.type="string",e.format="time",e.title="Time";break;case"date-time":e.type="string",e.format="date-time",e.title="Date";break;default:e.type=t.type||"string"}return e},e.prototype.getModel=function(){return this.valueModel?this.valueModel.getModel():null},e.prototype.getLayout=function(){return this.valueModel?this.valueModel.getLayout():null},e.prototype.getData=function(){return this.valueModel?this.valueModel.getData():null},e.prototype.getValues=function(){return this.valueModel?this.valueModel.getValues():null},e.prototype.setValues=function(e,t){return this.valueModel?this.valueModel.setValues(e,t):null},e.prototype.setValuesByFilter=function(e){this.valueModel&&this.valueModel.setValuesByFilter(e)},e}(),_=function(){function e(e){}return e.prototype.init=function(e){e&&e()},e.prototype.getModel=function(){return this.model},e.prototype.getLayout=function(){return this.layout},e.prototype.getData=function(){return this.data},e.prototype.getValues=function(){},e.prototype.setValues=function(e,t){},e.prototype.setValuesByFilter=function(e){},e}(),b=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.getValues=function(){return[""]},t}(_),x=function(e){function t(t){var n=e.call(this,t)||this,o=n;return o.options=t||{},o.model={type:"object",properties:{value:{title:o.options.title||"Valeur",type:o.options.type||"string"}},states:{value:{isMandatory:!0}}},o.options.format&&(o.model.properties.value.format=o.options.format),o.options.decimals&&(o.model.properties.value.decimals=o.options.decimals),o.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:12}]},o.data={value:null},n}return __extends(t,e),t.prototype.getValues=function(){return null!=this.data.value?[this.data.value]:null},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e[0]},t}(_),C=function(e){function t(t){var n=e.call(this,t)||this,o=n;return o.options=t||{},o.model={type:"object",properties:{value1:{title:(t.title||"Valeur")+" 1",type:t.type||"string"},value2:{title:(t.title||"Valeur")+" 2",type:t.type||"string"}},states:{value1:{isMandatory:!0},value2:{isMandatory:!0}}},o.options.format&&(o.model.properties.value1.format=o.options.format,o.model.properties.value2.format=o.options.format),o.options.decimals&&(o.model.properties.value1.decimals=o.options.decimals,o.model.properties.value2.decimals=o.options.decimals),o.layout={name:"filter-value",$type:"block",$items:[{$type:"row",$items:[{$items:[{$bind:"value1",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6},{$items:[{$bind:"value2",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6}]}]},o.data={value1:null,value2:null},n}return __extends(t,e),t.prototype.getValues=function(){var e=this;return null!=e.data.value1&&null!=e.data.value2?[e.data.value1,e.data.value2]:null},t.prototype.setValues=function(e){this.data.value1=e.value1,this.data.value2=e.value2},t.prototype.setValuesByFilter=function(e){this.data.value1=e[0],this.data.value2=e[1]},t}(_),k=function(e){function t(t){var n=e.call(this,t)||this,o=n;return o.options=t||{},o.model={type:"object",properties:{value:{title:"Valeur",type:"string"}},states:{value:{isMandatory:!0}}},o.options.format&&(o.model.properties.value.format=o.options.format),o.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:'Une ou plusieurs valeurs (séparées par un ";" : val1;val2;...)'}}],$colSize:12}]},o.data={value:null},n}return __extends(t,e),t.prototype.getValues=function(){var e=this;if(null==e.data.value)return null;var t=e.data.value.split(";"),n=[];return"number"==e.options.type?t.forEach(function(e){var t=parseInt(e,10);isNaN(t)||n.push(t)}):n=t,n},t.prototype.setValues=function(e){var t=this;if(e.value){var n=e.value.split(";"),o=[];(n=n.map(function(e){return e.replace(/\"/g,"")})).forEach(function(e){"number"==t.options.type?new RegExp("^[0-9]+$").test(e)&&o.push(e):o.push(e)}),t.data.value=o.join(";")}},t.prototype.setValuesByFilter=function(e){this.data.value=e.join(";")},t}(_),w=function(e){function t(t){var n=e.call(this,t)||this,o=n;return o.options=t||{},o.options.enumName=o.options.enumName||o.options.champName,o.model={type:"object",properties:{value:{title:"List",type:"array",items:{type:"string",enums:{},$enumref:"list"}}},states:{value:{isMandatory:!0}}},o.model.properties.value.items.enums[o.options.enumName]={type:"default",enum:[],enumNames:[]},o.model.properties.value.items.$enumref=o.options.enumName,o.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"enums-list",options:{titleIsHidden:!0}}],$colSize:12}]},o.options.enum&&o.options.enum.forEach(function(e){o.model.properties.value.items.enums[o.options.enumName].enum.push(e.code),o.model.properties.value.items.enums[o.options.enumName].enumNames.push(e.libelle||e.code)}),o.data={value:[]},n}return __extends(t,e),t.prototype.getValues=function(){var e=this;return e.data.value&&e.data.value.length?e.data.value.map(function(t){var n=null;return e.options.enum.forEach(function(e,o){if(t==e.code)return n=e,!1}),{code:t,lib:n.libelle||n.lib||t}}):[]},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e.map(function(e){return e.code})},t}(_),E=function(e){function t(t){var n=e.call(this,t)||this,o=n;return o.options=t||{},o.model={type:"object",properties:{value:{title:"List",type:"array",ds:o.options.lookupSchema||null,items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}},states:{value:{isMandatory:!0}}},o.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"lookup-list",options:{titleIsHidden:!0}}],$colSize:12}]},o.data={value:[]},n}return __extends(t,e),t.prototype.getValues=function(){var e=this;return e.data.value&&e.data.value.length?e.data.value:[]},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e},t}(_),P=function(){function e(e,t,n,o,i,r,a){this.champ=e,this.filter=r,this.listeFilters=t,this.listeOperateurs=n,this.listeTypes=o,this.callBack=i,this.options=a||{},this.data={operateur:null,values:[]}}return e.prototype.renderOperateur=function(){var e=this,t={type:"object",properties:{champ:{title:"Filtre",type:"string"},operateur:{title:"Opérateur",type:"string",enum:[],enumNames:[]}},states:{champ:{isReadOnly:!0,isHidden:0==e.options.showLabel},operateur:{isHidden:0==e.options.showOperateur}}},o={name:"filter-operateur",$type:"block",$items:[{$type:"block",$items:[{$bind:"champ",$readOnly:!0,options:{$expression:"{{champ}}"}},{$bind:"operateur",options:{titleIsHidden:!0}}]}]},i=t.properties;e.data.champ=e.champ.libelle;var r=e.champ.options.format||e.champ.type;if(i.operateur.enum=e.listeTypes.getOperateurs(r),i.operateur.enum.forEach(function(t){i.operateur.enumNames.push(e.listeOperateurs.get(t).libelle)}),e.filter?e.data.operateur=e.filter.op:e.data.operateur=i.operateur.enum[0],0!=e.options.showLabel||0!=e.options.showOperateur){var a=l.query(e.container,".operateur");if(a){var s=n.formManager().formByName("filter-operateur");n.removeForm(s),n.OpenForm($(a),o,t,e.data,{},function(t,n,o){switch(t.property){case"operateur":if("propchange"==t.operation){var i=e.listeOperateurs.get(n.model().operateur);e.data.operateur=n.model().operateur,e.renderValue(i)}}})}}},e.prototype.renderValue=function(e){var t=this,o=l.query(t.container,".value");if(o){var i=n.formManager().formByName("filter-value");n.removeForm(i);var r=t.champ.options||{};r.champName=t.champ.code,t.modelType=new y(t.champ.options.format||t.champ.type,e,r),t.modelType&&t.modelType.init(function(){var e=t.modelType.getModel(),i=t.modelType.getLayout();if(e&&i){t.filter&&t.modelType.setValuesByFilter(t.filter.values);var r=t.modelType.getData();n.OpenForm($(o),i,e,r,{},function(e,n,o){switch(e.operation){case"propchange":default:t.modelType.setValues(n.model()),t.data.values=t.modelType.getValues()}})}else t.data.values=t.modelType.getValues()})}},e.prototype.renderButton=function(){var e=this,t={type:"object",properties:{},links:{add:{title:a.ui.Add}}},o={name:"filter-link",$type:"block",$items:[{$inline:!0,$items:[{$bind:"$links.add",options:{type:"primary",icon:"plus",right:!0}}],$colSize:12}]},i=l.query(e.container,".link");if(i){var r=n.formManager().formByName("filter-link");n.removeForm(r),n.OpenForm($(i),o,t,e.data,{},function(t,o,i){switch(t.property){case"$links.add":var r=n.formManager().formByName("filter-value");if(!o.validate()||r&&!r.$model.validate())return;o.model();e.data.values&&e.data.values.length&&e.callBack({code:e.champ.code,op:e.data.operateur,values:e.data.values})}})}},e.prototype.render=function(e){var t=this,n=["<div>",'<div class="operateur">',"</div>",'<div class="value">',"</div>",'<div class="link">',"</div>","</div>"];e&&(t.container=e,l.empty(e),l.append(e,$(n.join("")).get(0)),t.renderOperateur(),t.renderValue(t.listeOperateurs.get(t.data.operateur)),t.renderButton())},e}(),O=function(){function e(e,t,n,o,i,r){this.listeChamps=e,this.listeChampsArbre=t,this.listeFilters=n,this.listeOperateurs=o,this.listeTypes=i,this.options=r||{}}return e.prototype.createContainer=function(){var e=this,t=['<div class="row">','<div class="col-sm-5 bs-champ-list">',"</div>",'<div class="col-sm-7 filter-edit">',"</div>","</div>",'<div class="row">','<div class="col-sm-12 bs-filter-list">',"</div>","</div>"];e.container=document.createElement("div"),l.addClass(e.container,"bs-filter-view"),e.container.innerHTML=t.join(""),e.champListView=l.query(e.container,".bs-champ-list"),e.filterListView=l.query(e.container,".bs-filter-list"),e.filterEditView=l.query(e.container,".filter-edit")},e.prototype.render=function(){var e=this;return e.createContainer(),e.listeChamps.gets().length&&(e.showChampList(),e.selecteChamp(e,e.listeChamps.gets()[0].code)),e.container},e.prototype.showChampList=function(){var e=this;e._multiSelectList=new t.MultiSelectList(this.listeChampsArbre,{maxHeight:"auto"},function(t){t&&t.data.name&&e.selecteChamp(e,t.data.name)});var n=70*(e.options.listSize||7),o=$('<div class="bs-field-list-border" style="max-height:'+n+'px;"></div>').get(0);e._multiSelectList.render(o),l.append(e.champListView,o)},e.prototype.selecteChamp=function(e,t){e._multiSelectList.addItem(t),e.updateFilter(e,t);var n=e.listeFilters.getsByChamp(t),o=null;n&&n.length&&(o=n[0]),e.showFilterList(e,o)},e.prototype.showFilterList=function(e,t){var n=new g(e.listeChamps,e.listeFilters,e.listeOperateurs,function(t,n){if("EDIT"==t){var o=e.listeFilters.get(n.id);o&&e.selecteChamp(e,o.code)}else"REMOVE"==t?e.removeFilter(e,n.id):"VALIDE"==t&&e.valideFilters()},e.options,t);l.empty(e.filterListView),n.render(e.filterListView)},e.prototype.updateFilter=function(e,t){var n=e.listeChamps.get(t),o=e.listeFilters.getsByChamp(t),i=null;o&&o.length&&(i=o[0]);var r=new P(n,e.listeFilters,e.listeOperateurs,e.listeTypes,function(t){e.addFilter(e,t)},i,e.options);l.empty(e.filterEditView),r.render(e.filterEditView)},e.prototype.addFilter=function(e,t){var n,o=e.listeFilters.getsByChamp(t.code);n=!e.options.multiple&&o&&o.length?e.listeFilters.set(o[0].id,t):e.listeFilters.add(t.code,t.op,t.values),e.showFilterList(e,n)},e.prototype.removeFilter=function(e,t){var n=e.listeFilters.get(t).code;e.listeFilters.remove(t),e.selecteChamp(e,n)},e.prototype.valideFilters=function(){},e}(),S=function(t){function n(e,n,o,i,r,a,s){var l=this,u={btnValidate:!0};return l=t.call(this,e,n,o,i,r,$.extend(!0,u,a))||this,l._callback=s,l}return __extends(n,t),n.prototype.createContainer=function(){var t=this,n=e.bootstrap4,o=['<div class="row">','<div class="col'+(n?"":"-xs")+'-12 bs-filter-list">',"</div>","</div>",'<div class="row">','<div class="col'+(n?"":"-xs")+'-12">','<h5 class="bs-block-title" data-ignore="true">'+(t.options.title||"Filtre")+"</h5>","</div>","</div>",'<div class="row">','<div class="col-sm-4 bs-champ-list">',"</div>",'<div class="col-sm-8 filter-edit">',"</div>","</div>"];t.container=document.createElement("div"),l.addClass(t.container,"bs-filter-view"),t.container.innerHTML=o.join(""),t.champListView=l.query(t.container,".bs-champ-list"),t.filterListView=l.query(t.container,".bs-filter-list"),t.filterEditView=l.query(t.container,".filter-edit")},n.prototype.valideFilters=function(){this._callback("VALIDE")},n}(O),I=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this,r=i;return o.registerListenerFor(r.$bind+".$item",r),i._state(),i}return __extends(t,e),t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.click=function(e){var t=this,n=e.target;if("LI"==n.nodeName.toUpperCase()||"I"==n.nodeName.toUpperCase()){var o=n;"I"==n.nodeName.toUpperCase()&&(o=l.parentByTag(t.$element.get(0),n,"LI"));var i=-1;if(o&&(i=parseInt(l.attr(o,"data-id"),10)),i<0)return;o=null;var r=null;if(t.state.value.forEach(function(e,t){if(e.code==i)return r=e.model(),!1}),!r)return;"REMOVE"==l.attr(n,"data-id")?t.form.execAction("remove",r):t.form.execAction("upd",r)}},t.prototype._state2UI=function(){var e=this;e.createContainer(e.id),e.state.value&&e.state.value.forEach(function(t){e.addTag(t)})},t.prototype.destroy=function(){var t=this;t.form.unRegisterListenerFor(t.$bind+".$item",t),e.prototype.destroy.call(this)},t.prototype.changed=function(e,t,n,o,i){var r=this;"add"==o?r.addTag(n):"remove"==o&&r.removeTag(i.$value.code)},t.prototype.stateChanged=function(e,t){var n=this,o=n.form.getState(n.$bind),i=n.$element?n.$element.get(0):null;i&&o.isHidden!==n.state.isHidden&&(n.state.isHidden=o.isHidden,n.setHidden(i))},t.prototype.addTag=function(e){var t=this,n=document.createElement("li");l.addClass(n,"item"),l.addClass(n,"bs-boxed-tags-item"),l.addClass(n,"bs-cursor-p"),l.addClass(n,"btn-primary"),e.selected&&l.addClass(n,"focus"),l.attr(n,"data-id",e.code),n.innerHTML=e.libelle+' <span data-id="REMOVE" class="'+l.iconClass("remove")+'" ></span>',l.append(t.$element.get(0),n)},t.prototype.removeTag=function(e){var t=this,n=l.query(t.$element.get(0),'li[data-id="'+e+'"]');l.remove(n)},t.prototype.createContainer=function(e){this.$element=$(o.format('<ul id="{0}" data-render="{0}" class="bs-boxed-tags" draggable="true"></ul>',e))},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.setEvents(null),t._state2UI()),t.appendElement(e,n),t.$element},t}(t.AbsField);n.registerControl(I,"array",!1,"tagview");var D=function(){function t(e){var t=this;t.options=e||{},t._elements=[],t._values=[]}return Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},set:function(e){e&&(this._elements=e,this._notifyChange("elements"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this._values},set:function(e){e&&(this._values=e,this._notifyChange("values"))},enumerable:!0,configurable:!0}),t.prototype._notifyChange=function(e){var t=this;switch(e){case"elements":l.empty(t.$element.get(0)),t.renderElements(t.elements||[],t.values||[],t.options||{})}},t.prototype.findVal=function(e){var t=-1;return this.values.forEach(function(n,o){if(n==e)return t=o,!1}),t},t.prototype.render=function(e){var t=this;return t.$element||(t.$element=$('<div class="row bs-checkboxlist"></div>'),t.renderElements(t.elements,t.values,t.options),t.setEvents(null)),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},t.prototype.destroy=function(){var e=this;e._removeEvents(),e.$element=null,e.options=null},t.prototype.removeVal=function(e){var t=this,n=t.findVal(e);n>=0&&t.values.splice(n,1)},t.prototype.addVal=function(e){this.values.push(e)},t.prototype.setEvents=function(e){var t=this;t.$element&&t.$element.on("click",function(e){if(!t.options.isDisabled&&!t.options.isReadOnly){var n=l.parentByClass(t.$element.get(0),e.target,"bs-checkboxlist-list");n&&t._toggleEnumByIndex(l.indexOf(n.parentNode,n))}})},t.prototype._removeEvents=function(){var e=this;e.$element&&e.$element.off("click")},t.prototype.renderElements=function(t,n,o){var i=this,r=e.bootstrap4,a=document.createDocumentFragment();if(t.length){o=o||{};var s=$('<div tabindex="0" class="bs-checkboxlist-list col-lg-6 col'+(r?"":"-xs")+'-12 checkbox-inline"><div class="bs-checkboxlist-list-check"><a><span class="'+l.iconClass("square-o")+'"></span></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);t.forEach(function(e,t){var i=s.cloneNode(!0);o.disabled?(l.attr(i,"tabindex","-1"),l.removeClass(i,"bs-pointer"),l.addClass(i,"bs-cursor-disabled")):(l.attr(i,"tabindex","0"),l.addClass(i,"bs-pointer"),l.removeClass(i,"bs-cursor-disabled")),i.firstChild.firstChild.firstChild.className=n&&n.indexOf(e.code)>=0?l.iconClass("check-square-o"):l.iconClass("square-o");var r=i.lastChild;l.append(r,document.createTextNode(e.libelle)),l.append(a,i)})}else{var u=$('<center><div class="bs-lv-nodata">Aucun résultat trouvé ...</div></center>').get(0);l.append(a,u)}l.append(i.$element.get(0),a)},t.prototype._inputs=function(){return this.$element.get(0)},t.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.className=t?l.iconClass("check-square-o"):l.iconClass("square-o")},t.prototype._toggleEnumByIndex=function(e){var t=this;if(e>=0&&e<t.elements.length){var n=t.elements[e],o=t.findVal(n.code),i=t._inputs();o>=0?(t._setItemValue(i.childNodes[e],!1),t.removeVal(n.code),t.options.onSelectItem&&t.options.onSelectItem("remove",{id:e,value:n,data:n})):(t._setItemValue(i.childNodes[e],!0),t.addVal(n.code),t.options.onSelectItem&&t.options.onSelectItem("add",{id:e,value:n,data:n}))}},t}();t.CheckBoxList=D;var M=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.click=function(e){},t.prototype._state2UI=function(){},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.changed=function(e,t,n,o,i){},t.prototype.stateChanged=function(e,t){},t.prototype._createContainer=function(e,t,n,i){var r=['<div id="{0}" data-render="{0}">','<label for="{0}_input" id="{0}_label" class="'+(n?"":"bs-none")+'">'+(n||"")+"</label>",'<div id="{0}_toolbar"></div>',"<br />",'<div id="{0}_list"></div>','<center id="{0}_paginer"></center>',"</div>"];return o.format(r.join(""),e)},t.prototype._onSelectToolElement=function(e){var t=this;"search"===e.name&&t._lookup.search(e.value)},t.prototype.createToolBar=function(e,t){var o=this;if(o.$element&&!o._toolbar){var i=[{name:"search",type:"search",right:!1}];t=$.extend(!0,{},{selectToolElement:o._onSelectToolElement.bind(o)}),o._toolbar=new n.ToolBar(i,t);var r=l.query(o.$element.get(0),"#"+e+"_toolbar");if(!r)return;o._toolbar.render($(r))}},t.prototype._onSelectPaginer=function(e){var t=this;switch(e){case"next":t._lookup.nextPage();break;case"prev":t._lookup.prevPage();break;case"first":t._lookup.firthPage();break;case"last":t._lookup.lastPage();break;default:t._lookup.toPage(e-1)}},t.prototype.createPaginer=function(e,t){var o=this;if(o.$element){if(!o._pager){t=$.extend({size:"default",boundaryLinks:!0,selectPage:o._onSelectPaginer.bind(o)},t),o._pager=new n.Pager(t);var i=l.query(o.$element.get(0),"#"+e+"_paginer");if(!i)return;o._pager.render($(i))}var r=o._pager;r.props.totalPages=o._lookup.getNbPages(),r.props.currentPage=o._lookup.currentPage()+1}},t.prototype._onSelectCheckBoxList=function(e,t){var n=this;"add"===e?n.state.value.push({code:t.value.code,lib:t.value.libelle}):"remove"===e&&n.state.value.remove(n.state.value.find("code",t.value.code))},t.prototype._getValues=function(){var e=this,t=$.extend(!0,{},e.state.value);return t._items=t._items.map(function(e){return e.code}),t._items},t.prototype.createList=function(e,t){var o=this;if(o.$element&&!o._list){o._list=new n.CheckBoxList({onSelectItem:o._onSelectCheckBoxList.bind(o)}),o._list.values=o._getValues();var i=l.query(o.$element.get(0),"#"+e+"_list");if(!i)return;o._list.render($(i))}},t.prototype.createLookup=function(e){var t=this;if(t.$schema.ds){t._lookup=new n.DsLookup(t.$schema.ds,{notify:function(e,n){(n=n||{}).inited&&n.updated?t._lookup.firthPage():e&&(t.$schema.ds.data.$params.$search&&t.createToolBar(t.id,{}),t.createList(t.id,{}),t._list.elements=e,t.createPaginer(t.id,t.renderOptions.pager))}})}},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.setEvents(null),t.$element=$(t._createContainer(t.id,s.tt(t.$schema.title,t.form.$locale),t.options.design,n)),t.createLookup({}),t._state2UI()),t.appendElement(e,n),t.$element},t}(t.AbsField);n.registerControl(M,"array",!1,"lookup-list",null);var T=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.renderInternal=function(e,t){var n=this;if(n.$element){var o;switch(t.renderModel){case"model2":o=new S(n.listeChamps,n.listeChampsArbre,n.listeFilters,n.listeOperateurs,n.listeTypes,t,function(e,t){"VALIDE"==e&&n.form.execAction("validate",{})});break;default:o=new O(n.listeChamps,n.listeChampsArbre,n.listeFilters,n.listeOperateurs,n.listeTypes,t)}l.append(n.$element.get(0),o.render())}},r.createContainer=function(e){return o.format('<div id="{0}" data-render="{0}" class="bs-filter"></div>',e)},r._state(),r._options=n||{},r.initData(),r}return __extends(t,e),t.prototype.initData=function(){var e=this;e.listeOperateurs=new p,Object.keys(c).forEach(function(t){var n=a.operators[t];e.listeOperateurs.add(t,n.title,n.binary,{symbol:n.symbol})}),e.listeTypes=new v,Object.keys(d).forEach(function(t){var n=a.types[t];e.listeTypes.addType(t,n.title,n.operators)}),e._updateData()},t.prototype._updateData=function(){var e=this;e.listeChamps=new f;var t=e.state.value&&e.state.value.lookups?e.state.value.lookups._model:{};(e.state.value&&e.state.value.champs?e.state.value.champs:[]).forEach(function(n){var o={};n.lookup?(o.lookupSchema=t[n.lookup]||u.getLookup(e.$bind,n.lookup,e.$schema,e.form.$rootSchema),o.lookup=n.lookup,o.format="lookup"):n.enum&&n.enum.length?(o.enum=n.enum,o.enumName=n.enumName,o.format="enum"):"boolean"===n.type?(o.enum=[{code:!0,libelle:a.ui.true},{code:!1,libelle:a.ui.false}],o.format="enum"):(o.decimals=n.decimals,o.format=n.format&&e.listeTypes.get(n.format)?n.format:null),n.type&&e.listeTypes.get(n.type)&&e.listeChamps.add(n.code,n.libelle,n.type,o)});var n=e.state.value&&e.state.value.filters?e.state.value.filters:[];e.listeFilters=new h(n),n.forEach(function(t){var n=[];t.values.forEach(function(e){n.push(e)});var o=[];t.values2&&t.values2.forEach(function(e){o.push(e)}),e.listeFilters.add2(t.code,t.op,o.length?o:n)}),e.listeChampsArbre=e.state.value&&e.state.value.entree&&e.state.value.entree.length?e.state.value.model().entree:null,e.listeChampsArbre?e.listeChampsArbre.forEach(function(e){e.items&&!e.items.length&&delete e.items}):e.listeChampsArbre=e.listeChamps.gets().map(function(e){return{name:e.code,title:e.libelle}})},t.prototype.refresh=function(){var e=this;e._updateData(),l.empty(e.$element.get(0)),e.renderInternal({data:e.state.value},e._options)},t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.$element=$(t.createContainer(t.id)),l.empty(t.$element.get(0)),n.id=t.id,n.title=t.$schema.title||"",n=$.extend(!0,n,t.renderOptions),t._options=n,t.renderInternal({data:t.state.value},n)),t.appendElement(e,n),t.$element},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(t.AbsField);t.ComposantFilter=T,n.registerControl(T,"object",!1,"filter")}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=t,o=e.filters,i=e.locale,r=o.OPERATORS,a=function(e,t,n,o,i){var r={code:t,libelle:n,type:o,format:(i=i||{}).format||null,decimals:i.decimals,enum:i.enum,enumName:i.enumName,lookup:i.lookup};e.push(r)},s=function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")},l=function(e){return e.replace(/\\\$/g,"$").replace(/\\\?/g,"?").replace(/\\\*/g,"*").replace(/\\\+/g,"+").replace(/\\\./g,".").replace(/\\\^/g,"^").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\{/g,"{").replace(/\\\}/g,"}").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\|/g,"|")},u=function(e,t){function n(e){return i.operators[e].symbol||""}var o=[];return e.forEach(function(e){t.forEach(function(t){if(e.code===t.code)return e.lib=t.libelle,!1});var i=(e.lib||e.code)+" "+n(e.op);e.op===r.empty||e.op===r.nempty?i+=" vide":e.op===r.between||e.op===r.nbetween?i+=" "+e.values[0]+" et "+e.values[1]:e.getValueNames?i+=" "+e.getValueNames().join(","):i+=" "+e.values.join(","),o.length&&o.push(" et "),o.push(i)}),o.join("")};t.filter={format:{toPhenix:function(e,t){if(!e||!t)return null;var n=function(e,t){for(var o=[],i=e.length%2!=0,r=i?e.length-1:e.length,a=0;a<r;a+=2)o.push({$left:e[a],$op:t,$right:e[a+1]});return i&&o.push(e[e.length-1]),o.length>=2&&(o=n(o,t)),o},o=function(t){function o(e,t,n,o){return{$left:{$left:e,$op:r.ge,$right:{type:t,value:n}},$op:"and",$right:{$left:e,$op:r.le,$right:{type:t,value:o}}}}function i(e,t,n){return{$left:"contains("+e+",'"+n+"')",$op:null,$right:null}}var a=e.find(function(e){return e.code==t.code}),s=t.op==r.in?"eq":t.op;s=s==r.nin?"ne":s;var l=t.values.map(function(e){return void 0!==e.code?e.code:e});return s==r.between||s==r.nbetween?s==r.between?o(t.code,a.type,l[0],l[1]):{$op:"not",$right:o(t.code,a.type,l[0],l[1])}:(l=l.map(function(e){var n=null;switch(s){case r.like:n=i(t.code,a.type,e);break;case r.nlike:n={$op:"not",$right:i(t.code,a.type,e)};break;case r.empty:n={$left:t.code,$op:"eq",$right:{type:"string",value:""}};break;case r.nempty:n={$left:t.code,$op:"ne",$right:{type:"string",value:""}};break;default:n={$left:t.code,$op:s,$right:{type:a.type,value:e}}}return n}),n(l,"or")[0])},i=[];return t.forEach(function(e){i.push(o(e))}),n(i,"and")[0]},toMongoDbFilter:function(e,t){if(!e||!t)return null;var n=[];return t.forEach(function(t){e.find(function(e){return e.code==t.code});var o={},i=null,a=t.values.map(function(e){return void 0!==e.code?e.code:e});switch(t.op){case r.between:i={$gte:a[0],$lte:a[1]};break;case r.nbetween:i={$not:{$gte:a[0],$lte:a[1]}};break;case r.in:i=a.length>1?{$in:a}:a[0];break;case r.nin:i=a.length>1?{$nin:a}:{$ne:a[0]};break;case r.gt:i={$gt:a[0]};break;case r.ge:i={$gte:a[0]};break;case r.lt:i={$lt:a[0]};break;case r.le:i={$lte:a[0]};break;case r.like:i={$regex:s(a[0]),$options:"i"};break;case r.nlike:i={$not:{$regex:s(a[0]),$options:"i"}};break;case r.empty:i={$exists:!1};break;case r.nempty:i={$exists:!0}}null!==i&&void 0!==i&&(o[t.code]=i,n.push(o))}),n.length?{$and:n.map(function(e){return e})}:null},toTitle:u},removeMdbFilterExpress:function(e,t,n){return e},addMdbFilterExpress:function(e,t,n){return t},addField:function(e,t,n,o,i,r,s){var l={};l.decimals=i,l.enum=r,l.enumName=s,a(e,t,n,o,l)},addField2:a,transformPropsToFilterFormat:function(e,t){t.forEach(function(t){var o=$.extend(!0,{},t.schema);switch(o.type){case"number":o.decimals>0?o.type="decimal":o.type="integer"}t.schema.enum&&(o.enum=t.schema.enum.map(function(e,n){return{code:e,libelle:t.schema.enumNames?t.schema.enumNames[n]:e}})),n.filter.addField2(e,t.name,o.title,o.type,{decimals:o.decimals,enum:o.enum,format:o.format})})},toTitle:u,mongoDbFilter2Filter:function(e,t){if(!e)return null;if(e&&e.$and){var n=[];if(e.$and.forEach(function(e){var o=Object.keys(e)[0],i=(t.find(function(t){return e.code==t}),{op:"",values:[],code:o});if("object"==typeof(e=e[o])){var a=!1;e.$not&&(a=!0,e=e.$not),void 0!=e.$gte&&void 0!=e.$lte?(i.op=a?r.nbetween:r.between,i.values.push(e.$gte),i.values.push(e.$lte)):e.$in?(i.op=r.in,i.values=e):e.$nin?(i.op=r.nin,i.values=e):e.$ne?(i.op=r.nin,i.values.push(e.$ne)):e.$gt?(i.op=r.gt,i.values.push(e.$gt)):e.$gte?(i.op=r.ge,i.values.push(e.$gte)):e.$lt?(i.op=r.lt,i.values.push(e.$lt)):e.$lte?(i.op=r.le,i.values.push(e.$lte)):void 0!=e.$exists?i.op=e.$exists?r.nempty:r.empty:e.$regex?(i.op=a?r.nlike:r.like,i.values.push(l(e.$regex))):i=null}else i.values.push(e);i&&n.push(i)}),n&&n.length)return n}return null}};var c=function(){function e(){this.filterComplex=null,this.filterExpress=null}return e.prototype.constructeFilter=function(){var e=this;return e.filterComplex&&e.filterComplex.value&&e.filterExpress&&e.filterExpress.value?{title:e.filterComplex.title+" et "+e.filterExpress.title,value:{$left:e.filterComplex.value,$op:"AND",$right:e.filterExpress.value}}:e.filterComplex&&e.filterComplex.value?e.filterComplex:e.filterExpress&&e.filterExpress.value?e.filterExpress:{title:"",value:null}},e}();t.FilterManager=c,t.filterManagerFactory=function(){return new c}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(e){e.multiSelectUtils={transformPropsToMultiselectFormat:function(e,t,n){function o(e,t,n){e.forEach(function(e){e.items=e.items||[],o(e.items,e.fields||[],n)}),t.forEach(function(t){n.every(function(e){return t.name!==e.name||(t.title=e.schema.title||e.name,!1)}),e.push(t)})}var i=t&&t.items?t.items:[],r=t&&t.fields?t.fields:[],a=t&&t.items?$.extend(!0,[],i):[];return n?o(a,r,e):function(e,t){function n(e,t){var o=null;return e.every(function(e){return e.name===t?(o=e,!1):!e.items||!(o=n(e.items,t))}),o}t.forEach(function(t){var o={name:t.name,title:t.schema.title||t.name},i=n(e,t.schema.group);i?(i.items=i.items||[],i.items.push(o)):e.push(o)})}(a,e),a},transformMultiSelectColumnsToGridColumnsFormat:function(e){var t=[];return e.forEach(function(e){t.push({$bind:e.name,options:{}})}),t},transformSelectedColumnsToMultiSelectFormat:function(e,t,n,o){function i(e,t){var n=null;return e.every(function(e){return e.name===t&&(n=e),!e.items&&!e.fields||n||(n=i(e.fields||e.items,t)),!n}),n}n=n&&n.items?n.items:[];var r=[];return Object.keys(t).forEach(function(a){(!o||!!i(n||[],a))&&e.every(function(e){return e.name!==a||(t[a]&&r.push({name:a,title:e.schema.title||e.name}),!1)})}),r}}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){e.utils,e.ulocale;var n=e.dom,o=(e.Observable.SchemaUtils,function(){function e(e,t,n){var o=this,i={mapping:{id:"name",lib:"title"},expandIcon:"plus-circle",collapseIcon:"minus-circle",checkedIcon:"check-square-o",uncheckedIcon:"square-o",itemIcon:"",groupIcon:"",multiSelect:!1,showTags:!1,groupLink:!1,itemLink:!0,border:!1,maxHeight:"300px"};o._options=$.extend(!0,i,t),o._name=o._options.mapping.id,o._title=o._options.mapping.libelle||o._options.mapping.lib,o._data=e||[],o._callback=n||null,o._nodes=$.extend(!0,[],e),o._selectedItems=[],o._init()}return Object.defineProperty(e.prototype,"items",{get:function(){return this._data},set:function(e){var t=this;t._data=e||[],t._nodes=$.extend(!0,[],e),t._selectedItems=[],t._constructeNodes(t._nodes,t._options),t._container&&t._renderItems(t._nodes)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){var t=this;t._selectedItems=$.extend(!0,[],e),t._container&&t._selectedItems.forEach(function(e){t.addItem(e[t._name])})},enumerable:!0,configurable:!0}),e.prototype._init=function(){var e=this;e._constructeNodes(e._nodes,e._options)},e.prototype._getGroupNode=function(e,t){var n=this,o=null;return e.every(function(e){return e.items&&((o=e[n._name]===t?e:null)||(o=n._getGroupNode(e.items,t))),!o}),o},e.prototype._getItemNode=function(e,t){var n=this,o=null;return e.every(function(e){return!(o=e.items||e[n._name]!==t?null:e)&&e.items&&(o=n._getItemNode(e.items,t)),!o}),o},e.prototype._getItem=function(e,t){var n=this,o=null;return e.every(function(e){return e[n._name]===t?(o=e,!1):!e.items||!(o=n._getItem(e.items,t))}),o},e.prototype._getSelectedItemIndex=function(e){var t=this,n=-1;return t._selectedItems.every(function(o,i){return o[t._name]!==e||(n=i,!1)}),n},e.prototype._itemsIsSelected=function(e){var t=this,n=!0;return e.every(function(e){var o=!1;return t._selectedItems.every(function(n){return n[t._name]!=e[t._name]||(o=!0,!1)}),!!o||(n=!1,!1)}),n},e.prototype._itemsIsUnselected=function(e){var t=this,n=!0;return e.every(function(e){return t._selectedItems.every(function(o){return o[t._name]!=e[t._name]||(n=!1,!1)}),!!n}),n},e.prototype._constructeNodes=function(e,t){function o(e,t,r,a,s){var l=$(i._template().item).get(0);i._options.border||n.addClass(l,"border-0"),e.forEach(function(e){if(e[i._name]){e.level=r||0,e.show=1==a,e.parent=t||null,e.component=l.cloneNode(),e.items&&(e.tagsSize=0,o(e.items,e,e.level+1,!1,s));for(var u=e.parent;u;)u.tagsSize++,u=u.parent;for(var c=1;c<=e.level;c++)n.append(e.component,$(i._template().indent).get(0));if(e.items){d=i._createIcon(e.component,s.expandIcon,"icon-group bs-cursor-p");if(n.attr(d,"data-event","click"),n.attr(d,"data-action","expand"),s.multiSelect){p=i._createIcon(e.component,s.uncheckedIcon,"icon-check bs-cursor-p");n.attr(p,"data-event","click"),n.attr(p,"data-action","uncheckG")}else s.groupLink&&(n.attr(e.component,"data-event","click"),n.attr(e.component,"data-action","selectitem"),n.addClass(e.component,"bs-cursor-p"));i._createIcon(e.component,s.groupIcon)}else{var d=i._createIcon(e.component);if(n.addClass(d,"icon-exist"),s.multiSelect&&s.itemLink){var p=i._createIcon(e.component,s.uncheckedIcon,"icon-check bs-cursor-p");n.attr(p,"data-event","click"),n.attr(p,"data-action","uncheck")}else s.itemLink&&(n.attr(e.component,"data-event","click"),n.attr(e.component,"data-action","selectitem"),n.addClass(e.component,"bs-cursor-p"));i._createIcon(e.component,s.itemIcon)}n.append(e.component,$("<span>"+(e[i._title]||e[i._name])+"</span>").get(0)),n.attr(e.component,"data-id",e[i._name])}})}var i=this;Array.isArray(e)&&e.length&&(o(e,null,0,!0,t),t.showTags&&i._addTags(i._nodes))},e.prototype._addTags=function(e){var t=this;e.forEach(function(e){if(e.items){var o=$(t._template().badge).get(0);n.append(o,document.createTextNode(""+e.tagsSize)),n.append(e.component,o),t._addTags(e.items)}})},e.prototype._template=function(){return{list:'<ul class="list-group bs-treeview"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge badge-pill badge-secondary float-right"></span>'}},e.prototype._createIcon=function(e,t,o){var i=this,r=$(i._template().icon).get(0);return t&&i._addIcon(r,t,o),n.append(e,r),r},e.prototype._addIcon=function(e,t,o){n.attr(e,"class","icon icon-exist "+n.iconClass(t)+(o?" "+o:""))},e.prototype._setEvents=function(){var e=this;e._container&&e._container.addEventListener("click",function(t){var o=t.target,i=null;if((i="click"===n.attr(o,"data-event")?o:n.parentByTag(e._container,o,"LI"))&&"click"===n.attr(i,"data-event")){var r=n.parentByTag(e._container,i,"LI"),a=n.attr(r,"data-id"),s=n.attr(i,"data-action");"expand"===s?e._display(a,!0):"collapse"===s?e._display(a,!1):"selectitem"===s?e._select(a,e._callback):"check"===s&&e._options.multiSelect?e._checkF(a,!1,e._callback):"uncheck"===s&&e._options.multiSelect?e._checkF(a,!0,e._callback):"checkG"===s&&e._options.multiSelect?e._checkG(a,!1,e._callback,!0):"uncheckG"===s&&e._options.multiSelect&&e._checkG(a,!0,e._callback,!0)}})},e.prototype._display=function(e,t){var o=this,i=o._getGroupNode(o._nodes,e);if(i){var r=function(e,t){e.forEach(function(e){if(e.show=t,e.items){r(e.items,!1);var i=n.query(e.component,".icon-group");i&&(o._addIcon(i,o._options.expandIcon,"icon-group bs-cursor-p"),n.attr(i,"data-action","expand"))}})};r(i.items,t);var a=n.query(i.component,".icon-group");o._addIcon(a,t?o._options.collapseIcon:o._options.expandIcon,"icon-group bs-cursor-p"),n.attr(a,"data-action",t?"collapse":"expand"),o._renderItems(o._nodes)}},e.prototype._select=function(e,t){var o=this,i=n.query(o._container,".active");i&&n.removeClass(i,"active"),o._selectedItems.splice(0);var r=o._getItem(o._nodes,e);r&&(o._showItem(e),n.addClass(r.component,"active"),(r=o._getItem(o._data,e))&&(o._selectedItems.push(r),t&&t({action:"add",data:r})))},e.prototype._unSelect=function(e,t){var o=this,i=n.query(o._container,".active");i&&n.removeClass(i,"active");var r=o._getItem(o._selectedItems,e);r&&(o._selectedItems.splice(0),t&&t({action:"remove",data:r}))},e.prototype._checkF=function(e,t,n){var o=this;o._check(e,t,n);var i=o._getItem(o._nodes,e);if(i&&i.parent){var r=o._getItem(o._data,i.parent[o._name]);if(!r)return;t&&o._itemsIsSelected(r.items)?o._checkG(r[o._name],t,n,!1):!t&&o._itemsIsUnselected(r.items)&&o._checkG(r[o._name],t,n,!1)}},e.prototype._check=function(e,t,o){var i=this,r=i._getItem(i._data,e);if(r){var a=i._getItem(i._nodes,e).component,s=n.query(a,".icon-check");i._addIcon(s,t?i._options.checkedIcon:i._options.uncheckedIcon,"icon-check bs-cursor-p"),n.attr(s,"data-action",t?"check":"uncheck");var l=void 0,u=i._getSelectedItemIndex(e);t?u<0&&(i._selectedItems.push(r),l="add"):u>=0&&(i._selectedItems.splice(u,1),l="remove"),o&&l&&o({action:l,data:r})}},e.prototype._checkG=function(e,t,o,i){var r=this,a=r._getItem(r._data,e);if(a){var s=r._getItem(r._nodes,e).component,l=n.query(s,".icon-check");r._addIcon(l,t?r._options.checkedIcon:r._options.uncheckedIcon,"icon-check bs-cursor-p"),n.attr(l,"data-action",t?"checkG":"uncheckG"),i&&a.items.forEach(function(e){e.items?r._checkG(e.name,t,o,i):r._check(e.name,t,o)})}},e.prototype._showItem=function(e){function t(e,i){e.forEach(function(e){if(e.show=i,e.items){t(e.items,!1);var r=n.query(e.component,".icon-group");r&&(o._addIcon(r,o._options.expandIcon,"icon-group bs-cursor-p"),n.attr(r,"data-action","expand"))}})}var o=this,i=o._getItem(o._nodes,e);if(i){for(var r=i.parent;r;){t(r.items,!0);var a=n.query(r.component,".icon-group");o._addIcon(a,o._options.collapseIcon,"icon-group bs-cursor-p"),n.attr(a,"data-action","collapse"),r=r.parent}o._renderItems(o._nodes)}},e.prototype.addItem=function(e){var t=this;t._options.multiSelect?t._checkF(e,!0):t._select(e)},e.prototype.removeItem=function(e){var t=this;t._options.multiSelect?t._checkF(e,!1):t._unSelect(e)},e.prototype._renderItems=function(e){function t(e,o){e.forEach(function(e){e.show&&n.append(o,e.component),e.items&&t(e.items,o)})}var o=this;n.empty(o._container);var i=document.createDocumentFragment();t(e,i),n.append(o._container,i)},e.prototype.render=function(e){var t=this;return t._container||(t._container=$(t._template().list).get(0),t._container.style.maxHeight=t._options.maxHeight,t._options.border||n.addClass(t._container,"noborder"),t._renderItems(t._nodes),t.selectedItems=t._selectedItems,t._setEvents()),e&&n.append(e,t._container),t._container},e}());t.MultiSelectList=o}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.utils,o=(e.ulocale,e.dom),i=e.drag,r=(e.uiutils,e.events),a=(e.Observable.SchemaUtils,function(){function t(e,t,n){var o=this,i={mapping:{id:"name",lib:"title"},removeIcon:"remove",border:!1};o._options=$.extend(!0,i,t),o._name=o._options.mapping.id,o._title=o._options.mapping.libelle||o._options.mapping.lib,o._data=e||[],o._callback=n||null,o._nodes=$.extend(!0,[],e),o._selectedItems=[],o._init()}return Object.defineProperty(t.prototype,"items",{get:function(){return this._data},set:function(e){var t=this;t._data=e||[],t._nodes=$.extend(!0,[],e),t._selectedItems=[],t._constructeNodes(t._nodes,t._options),t._container&&t._renderItems()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){var t=this;t._selectedItems=$.extend(!0,[],e),t._container&&t._renderItems()},enumerable:!0,configurable:!0}),t.prototype._init=function(){var e=this;e._constructeNodes(e._nodes,e._options)},t.prototype._constructeNodes=function(e,t){var n=this,i=$(n._template().itemTag).get(0),r=$(n._template().icon).get(0);e.forEach(function(e){e[n._name]&&(e.component=i.cloneNode(),o.append(e.component,document.createTextNode(e[n._title]||e[n._name])),o.attr(e.component,"data-id",e[n._name]),o.append(e.component,r.cloneNode()),e.filter=!0)}),n._input=n._input||$(n._template().itemInput).get(0)},t.prototype._getItem=function(e,t){var n=this,o=null;return e.every(function(e){return e[n._name]!==t||(o=e,!1)}),o},t.prototype._getItemIndex=function(e,t){var n=this,o=-1;return e.every(function(e,i){return e[n._name]!==t||(o=i,!1)}),o},t.prototype._addTag=function(e,t){var n=this,o=n._getItem(n._selectedItems,e);o||(o=n._getItem(n._data,e))&&(n._selectedItems.push(o),n._getItem(n._nodes,e).filter=!1,n._renderItems(),t&&t({action:"add",data:o}))},t.prototype._removeTag=function(e,t){var n=this,o=n._getItemIndex(n._selectedItems,e);o>=0&&(n._selectedItems.splice(o,1),n._getItem(n._nodes,e).filter=!0,n._renderItems(),t&&t({action:"remove",data:n._getItem(n._data,e)}))},t.prototype._filterList=function(e){var t=this;e.toLowerCase(),t._nodes.forEach(function(n){n.filter=n[t._title].toLowerCase().indexOf(e)>=0&&null==t._getItem(t._selectedItems,n[t._name])});var n=[];t._nodes.forEach(function(e){e.filter&&n.push(e)}),t._menu.show({value:n},0,!0)},t.prototype._setEvents=function(e){var t=this;if(t._container&&(t._container.addEventListener("click",function(e){var n=e.target;if(n.href&&"#"===o.attr(n,"href")&&(e.preventDefault(),e.stopPropagation()),n&&"click"===o.attr(n,"data-event")){if("remove"===o.attr(n,"data-action")){var i=o.parentByTag(t._container,n,"LI"),r=o.attr(i,"data-id");t._removeTag(r,t._callback)}}else t._menu&&t._menu.opened&&t._menu.inMenu(e.target)&&t._menu.click(e);var a=o.query(t._input,"input");a&&a.focus()}),t._container.addEventListener("keyup",function(e){13==e.keyCode&&t._menu&&t._menu.opened&&t._menu.select();var n=o.query(t._input,"input");n&&n.focus()})),t._input){var n=!0;t._input.addEventListener("keyup",function(e){var i=e.target;if(38==e.keyCode||40==e.keyCode);else if(8==e.keyCode){n?t._filterList(i.value):t._menu&&t._menu.opened&&t._menu.hide(i)}else if(13==e.keyCode&&i&&"keyup"===o.attr(i,"data-event")){var r=i;t._addTag(r.value,t._callback),r.value=""}else{t._filterList(i.value);var a=o.query(t._container,".bs-pillbox-item-tag.focus");a&&o.removeClass(a,"focus")}var s=o.query(t._input,"input");s&&s.focus()}),t._input.addEventListener("keydown",function(e){var i=e.target;if(40==e.keyCode&&t._menu&&t._menu.opened)t._menu.move(1);else if(38==e.keyCode&&t._menu&&t._menu.opened)t._menu.move(-1);else if(8==e.keyCode)if(i.value.length<=0&&t._selectedItems.length&&"keyup"===o.attr(i,"data-event")){var r=t._selectedItems[t._selectedItems.length-1],a=t._getItem(t._nodes,r[t._name]);o.hasClass(a.component,"focus")?(o.removeClass(a.component,"focus"),t._removeTag(r[t._name],t._callback)):o.addClass(a.component,"focus"),n=!1}else n=!0;else 9!=e.keyCode&&27!=e.keyCode||t._menu&&t._menu.opened&&t._menu.hide(i);var s=o.query(t._input,"input");s&&s.focus()})}t._drag=i.dragManager.addDrag([t._container]),t._drag.canStartDragHandler=t._canStartDrag.bind(t),t._drag.onDragStart=t._onDragStart.bind(t),t._drag.onDrag=t._onDrag.bind(t),t._drag.onDragEnd=t._onDragEnd.bind(t)},t.prototype._template=function(){var e=this;return{list:'<ul class="bs-pillbox noborder"></ul>',itemTag:'<li class="bs-pillbox-item bs-pillbox-item-tag" data-drag="move"></li>',icon:'<span class="icon float-right '+o.iconClass(e._options.removeIcon)+' icon-remove bs-cursor-p" data-event="click" data-action="remove"></span>',itemInput:'<li class="bs-pillbox-item bs-pillbox-item-edit"><input autocomplete="off" autofocus="true" placeholder="..." data-event="keyup" data-action="add,remove" /></li>'}},t.prototype.addItem=function(e){this._addTag(e)},t.prototype.removeItem=function(e){this._removeTag(e)},t.prototype._canStartDrag=function(e){var t=this,i=e.target,r=o.parentByTag(t._container,i,"LI");if(r){var a=o.attr(r,"data-drag");if(!a)return!1;r.id||(r.id=n.allocID());var s=t._drag;if(s.coverDocument=!0,s.data.op=a,s.data.cloneId=r.id,s.data.column=o.attr(r,"data-id"),!s.data.column)return!1;var l=o.find(t._container,s.data.cloneId);s.cursor="move",s.moveX=!0,s.moveY=!0,s.startOffset=o.position(l,null);var u={top:0,height:l.offsetHeight},c=[];return t.selectedItems.forEach(function(e){var i=o.query(t._container,"li[data-id='"+e[t._name]+"']");i&&(i.id||(i.id=n.allocID()),c.push({htmlId:i.id,info:e}))}),s.data.childrenPositions=o.childrenPositions(t._container,c,!1,"free",u),!0}},t.prototype._onDragStart=function(e){var t=this,n=t._drag;if(!n.data.op)return!1;var i=o.find(t._container,n.data.cloneId),r=i.cloneNode(!0),a=o.position(i,null);return r.style.top=a.top+"px",r.style.left=a.left+"px",r.style.width=i.offsetWidth+"px",r.style.height=i.offsetHeight+"px",r.style.zIndex="5000",r.style.position="absolute",r.style.cursor="move",n.floatElement=r,o.append(document.body,n.floatElement),!0},t.prototype._onDrag=function(e){var t=this._drag;if(!t.data.op)return!1;var n=r.point(e),i=o.findNearest(n.x,n.y,t.data.childrenPositions);if(t.data.best!=i){var a={left:i.left,top:i.top,width:i.width,height:i.height};t.data.mdiv=o.showMove(t.data.mdiv,i.vertical,a,"bs-drag-color-info")}return t.data.best=i,!0},t.prototype._onDragEnd=function(e,t){var n=this,i=n._drag;if(!i.data.op)return!1;if(i.floatElement&&(o.remove(i.floatElement),i.floatElement=null),i.data.mdiv&&(o.remove(i.data.mdiv),i.data.mdiv=null),!e){if(i.data.best&&i.data.column){var r=i.data.best.info;if("empty"===i.data.best.position||r[n._name]===i.data.column)return;var a=n._getItem(n._selectedItems,i.data.column),s=n._getItemIndex(n._selectedItems,i.data.column);n.selectedItems.splice(s,1);var l=n._getItemIndex(n._selectedItems,r[n._name]);l="after"===i.data.best.position?l+1:l,n.selectedItems.splice(l,0,a),n._callback&&n._callback({action:"drag",srcIndex:s,destIndex:l,data:a})}n._renderItems();var u=o.query(n._input,"input");u&&u.focus()}},t.prototype._onMenuSelectItemHandler=function(e){var t=this;if(e){t._addTag(e[t._name],t._callback);var n=o.query(t._input,"input");n&&(n.value="")}},t.prototype._includeDropDownMenu=function(){var t=this;if(t._input){var n=o.query(t._input,"input");$(t._input).get(0).style.zIndex="3000",t._menu=new e.formdropitems.DropItems($(t._input),n,{primaryKey:t._name,search:t._title,onselect:t._onMenuSelectItemHandler.bind(t)})}},t.prototype._renderItems=function(){var e=this;o.empty(e._container);var t=document.createDocumentFragment();!function(t,n){t.forEach(function(t){var i=e._getItem(e._nodes,t[e._name]);i&&(i.filter=!1,o.append(n,i.component))})}(e._selectedItems,t),e._input&&o.append(t,e._input),o.append(e._container,t)},t.prototype.render=function(e){var t=this;return t._container||(t._container=$(t._template().list).get(0),t._renderItems(),t._includeDropDownMenu(),t._setEvents(e)),e&&o.append(e,t._container),t._container},t.prototype.remove=function(){var e=this;e._menu=null,e._drag&&(i.dragManager.rmvDrag(e._drag),e._drag=null)},t}());t.PillBox=a}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=t,o=e.utils,i=e.uiutils,r=(e.ulocale,e.dom),i=e.uiutils,a=(e.Observable.SchemaUtils,function(e){function n(t,n,o){var i=e.call(this,t,n,o)||this,r=i;r._state();var a={mapping:{id:"name",lib:"title"},multiSelect:!0,pillBox:!0,renderModel:"top",maxHeight:"300px"},s=r.state.value.model().entree||[];return s=s.map(function(e){return e.items&&!e.items.length&&delete e.items,e}),r._sortie=r.state.value.sortie||[],r._options=$.extend(!0,a,r.renderOptions),r._name=r._options.mapping.id,r._title=r._options.mapping.libelle||r._options.mapping.lib,Array.isArray(s)&&(r._initMultiSelectList(s,r.state.value.model().sortie),r._options.pillBox&&r._initPillBox(r._extractItems(s,!1),r.state.value.model().sortie)),i}return __extends(n,e),n.prototype._initMultiSelectList=function(e,n){var o=this;o.multiSelectList||(o.multiSelectList=new t.MultiSelectList(e,o._options,function(e){if("add"===e.action)o.pillBox&&o.pillBox.addItem(e.data[o._name]),o._sortie.push(e.data);else if("remove"===e.action){o.pillBox&&o.pillBox.removeItem(e.data[o._name]);var t=o._getSortieItem(o._sortie,e.data[o._name]);t&&o._sortie.remove(t.data)}})),o.multiSelectList.selectedItems=n||[]},n.prototype._initPillBox=function(e,n){var o=this;o.pillBox=new t.PillBox(e,o._options,function(e){if("add"===e.action)o.multiSelectList.addItem(e.data[o._name]),o._sortie.push(e.data);else if("remove"===e.action){o.multiSelectList.removeItem(e.data[o._name]);var t=o._getSortieItem(o._sortie,e.data[o._name]);t&&o._sortie.remove(t.data)}else if("drag"===e.action){var n=o._getSortieItem(o._sortie,e.data[o._name]);o._sortie.remove(n.data),o._sortie.splice(e.destIndex,0,e.data)}}),o.pillBox.selectedItems=n||[]},n.prototype._getSortieItem=function(e,t){var n=this,o=null;return e.forEach(function(e,i){return e[n._name]!==t||(o={id:i,data:e},!1)}),o},n.prototype._extractItems=function(e,t){function n(e,t,o){e.forEach(function(e){e.items?(o&&t.push(e),n(e.items,t,o)):t.push(e)})}var o=[];return n(e,o,t),o},n.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},n.prototype._state2UI=function(){},n.prototype.changed=function(e,t,n,o,i){var r=this;r._sortie=r.state.value.sortie||[];var a=r.state.value.model().entree||[];a=a.map(function(e){return e.items&&!e.items.length&&delete e.items,e});var s=r.state.value.model().sortie||[];r.multiSelectList&&(r.multiSelectList.items=a,r.multiSelectList.selectedItems=s),r.pillBox&&(r.pillBox.items=r._extractItems(a,!1),r.pillBox.selectedItems=s)},n.prototype._template=function(e){var t,n=this;switch(n._options.renderModel){case"left":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+n._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>","</div>"];break;case"right":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+n._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>","</div>"];break;case"bottom":t=['<div id="{0}" data-render="{0}">','<div id="{0}_multiselect">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+n._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_pillbox">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>"];break;default:t=['<div id="{0}" data-render="{0}">','<div id="{0}_pillbox">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_multiselect">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+n._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>"]}return o.format(t.join(""),e)},n.prototype.render=function(e){var t=this,n=t._initOptions(i.utils.defaultOptions);if(!t.$element){t.$element=$(t._template(t.id));var o=t.$element.get(0);if(!t._options.pillBox){var a=r.find(o,t.id+"_pillbox");a&&r.addClass(a,"bs-none")}if(t.pillBox){var s=r.query(o,'div[data-id="pillbox"]');t.pillBox.render(s)}if(t.multiSelectList){var l=r.query(o,'div[data-id="multiselect"]');t.multiSelectList.render(l)}}return t.appendElement(e,n),t.$element},n}(t.AbsField));t.ComposantMultiSelect=a,n.registerControl(a,"object",!1,"multiselectlist",null)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e.formgrid,n=e.ui;!function(o){function i(t){var o=this,i=t.name||t.id;if("filter"===t.type&&e.formgrid.glbGridFilter){var r=!o.state.value.isQuery;return e.formgrid.glbGridFilter(o.getColumnsForFilter(r),function(e){r?o.state.value&&(o.state.value.filterManager.filterExpress=null,o.state.value.filter=e.value):(o.state.value.filterManager.filterComplex=e,o.state.value.filter=o.state.value.filterManager.constructeFilter())})}if("filterexpress"===t.type){var a=!o.state.value.isQuery;if(a){var s=o.getColumnsForFilter(a),l=o.state.value.filterManager.filterExpress?o.state.value.filterManager.filterExpress.value:null,u=t.value.value,c=o.state.value.filter;c&&(c=n.filter.removeMdbFilterExpress(c,l,s.schemaColumns)),o.state.value.filterManager.filterExpress=t.value,c=n.filter.addMdbFilterExpress(c,u,s.schemaColumns),o.state.value.filter=c}else o.state.value.filterManager.filterExpress=t.value,o.state.value.filter=o.state.value.filterManager.constructeFilter()}else{if("settings"===t.type&&e.formgrid.glbGridSettings){var d=o.getColumnsForSettings();return d.options=t.toolData,e.formgrid.glbGridSettings(d,function(e){o.setColumns(e)})}"multiselect"===t.type?o.toggleMultiselect():o.form.execAction(o.$bind+".$toolbar."+i,{toolElement:t,control:o})}}var r={filter:{champs:[],filters:[],entree:[]}};t.toolBarFactory=function(e){var t=null,o=e.fieldOptions,r=[];if(o.toolbar&&o.toolbar.items&&$.extend(!0,{},o.toolbar).items.forEach(function(t){if(t.name=t.name||t.type,t.lookup){var i=null;i=new n.DsLookup(e.$schemaItems.lookups[t.lookup],{notify:function(n,o){if((o=o||{}).inited&&o.updated)i.firthPage();else if(n){t.value=t.value||{};var r={default:t.value.default,items:[],upd:!0};r.items=n||[],e.toolBar.setValue(t.name,r)}}})}if("count"===t.type)t=$.extend({right:!0,value:e.state.value.totalCount()},t);else if("filter"===t.type)t=$.extend({value:e.state.value.filter||"",icon:"filter"},t),e.state.value.filterManager=e.state.value.filterManager||(n.filterManagerFactory?n.filterManagerFactory():null);else if("multiselect"===t.type){var a=!!(o.selecting&&o.selecting.row&&o.selecting.multiselect);t=$.extend(t,{style:"default",icon:"check",value:a})}else"filterexpress"===t.type&&(t=$.extend(t,{fields:e.getColumnsForFilterExpress(t.fields)}),e.state.value.filterManager=e.state.value.filterManager||(n.filterManagerFactory?n.filterManagerFactory():null));r.push(t)}),r.length){var a={selectToolElement:i.bind(e),gridControl:e,composition:!e.state.value.isQuery,schema:e.$schema,form:e.form,bind:e.$bind,schemaItems:e.$schemaItems};t=new n.ToolBar(r,a)}return t},t.toolBarRender=function(e,t,n){t.render(e,n)},t.glbGridFilter=function(t,o,i){if(t.schemaColumns.length){void 0!==t.filters&&(r.filter.filters=t.filters);var a={name:"filtre",$type:"block",$items:[{$type:"block",$items:[{$bind:"filter",$widget:"filter",options:{renderModel:"model1"}}]}],form:!0},s={type:"object",properties:{filter:{type:"object",title:"Filtre",properties:{champs:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},type:{type:"string"},format:{type:"string"},decimals:{type:"number"},enumName:{type:"string"},enum:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"}}}},lookup:{type:"string"}}}},filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},op:{type:"string"},values:{type:"array",items:{type:"string"}},values2:{type:"array",items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}}}},entree:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}}}},definitions:{}};r.filter.champs.length&&r.filter.champs.splice(0),n.filter.transformPropsToFilterFormat(r.filter.champs,t.schemaColumns),r.filter.entree&&(r.filter.entree=n.multiSelectUtils.transformPropsToMultiselectFormat(t.schemaColumns,t.schemaGroups));var l={title:"Filtre",buttons:[{pattern:"validate"}]};n.OpenModalForm(l,a,s,r,i,function(i,a,s,l){switch(a.property){case"validate":if(!s.validate())return;var u=null;(r=s.model()).filter.filters.length&&(u=t.mongoFilter?n.filter.format.toMongoDbFilter(r.filter.champs,r.filter.filters):n.filter.format.toPhenix(r.filter.champs,r.filter.filters)),o&&o({value:u,title:e.ui.filter.toTitle(r.filter.filters,r.filter.champs)}),i.close()}})}},t.glbGridSettings=function(e,t,o){var i={name:"settings",$type:"block",$items:[{$type:"block",$items:[{$bind:"mselect",$widget:"multiselectlist",options:{multiSelect:!0}}]}],form:!0},r={type:"object",properties:{mselect:{type:"object",properties:{entree:{type:"array",items:{$ref:"#/definitions/elt"}},sortie:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"}}}}}}},definitions:{elt:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}};e.options=e.options||{};var a={mselect:{entree:n.multiSelectUtils.transformPropsToMultiselectFormat(e.schemaColumns,e.schemaGroups,e.options.columnsLimited),sortie:n.multiSelectUtils.transformSelectedColumnsToMultiSelectFormat(e.schemaColumns,e.selectedColumns,e.schemaGroups,e.options.columnsLimited)}},s={title:e.locale&&e.locale.settingsTitle?e.locale.settingsTitle:"Options",buttons:[{pattern:"validate"}]};n.OpenModalForm(s,i,r,a,o,function(e,o,i,r){switch(o.property){case"validate":if(!i.validate())return;var a=i.model().mselect.sortie;if(a<=0)return;var s=n.multiSelectUtils.transformMultiSelectColumnsToGridColumnsFormat(a);t&&t(s),e.close()}})},t.glbMongoFilter2Filter=n.filter.mongoDbFilter2Filter}(e.gridHandlers||(e.gridHandlers={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var n=e.dom,o=t,i=e.utils,r=e.locale,a=e.uiutils,s=e.Observable.SchemaUtils,l=e.link,u=function(){function e(e,t){var n=this;n.id=i.allocID(),n.config=e||{},n.options=t||{}}return e.prototype.getValue=function(){return this.config.value},e.prototype.setValue=function(e){var t=this;t.config.value=e,t.update()},e.prototype.setOptions=function(e){var t=this;t.options=$.extend(!0,t.options,e),t.updateRender()},e.prototype.createElement=function(e,t,n){return i.format('<div data-tool-id="{0}" class="bs-toolbar-item">A</div>',this.id)},e.prototype.refresh=function(){var e=this;this.update(),e.updateRender()},e.prototype.beforeAppend=function(){},e.prototype.after=function(){},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=$(t.createElement(t.config.id,t.config,t.config.value)),t._setEvents(),t.beforeAppend()),e&&n.append(e.get(0),t.$element.get(0)),t.$element},e.prototype.destroy=function(){var e=this;e._removeEvents(),e.$element=null,e.options=null,e.config=null},e.prototype._setEvents=function(){},e.prototype._removeEvents=function(){},e.prototype.update=function(){},e.prototype.updateRender=function(){},e}();t.ToolElement=u;var c=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,n){var o=[];t.style&&o.push(t.style);var r=t.widget=t.widget||"h4",a=['<div data-tool-id="{0}" class="bs-toolbar-item">',"<"+r+' class="'+o.join(" ")+'" style="display:inline-block" data-id="title">',t.value||"","</"+r+">","</div>"];return i.format(a.join(""),this.id)},t.prototype.update=function(){var e=this;if(e.$element){var t=n.query(e.$element.get(0),e.config.widget+'[data-id="title"]');n.text(t,e.config.value)}},t}(u);t.ToolElementTitle=c;var d=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,n){var o=[];t.style&&o.push(t.style);t.widget=t.widget||"h4";var r=['<div data-tool-id="{0}" class="bs-toolbar-item">','<span class="'+o.join(" ")+" "+(t.value||"")+'"></span>',"</div>"];return i.format(r.join(""),this.id)},t}(u);t.ToolElementIcon=d;var p=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,o){var r=["bs-button btn"],a=n.bootstrapStyles().secondary;t.style=t.style.trim(),t.style&&(a=t.style,"default"===(a=n.bootstrapStyles(!0).secondary)&&(a=n.bootstrapStyles(!0).secondary)),r.push("btn-"+a);var s=['<div data-tool-id="{0}" class="bs-toolbar-item">','<button id="toolbar-item'+(t.name?"-"+t.name:"")+'" toolClick="'+e+'" type="button" class="'+r.join(" ")+'">',t.icon?'<span class="'+n.iconClass(t.icon)+'" toolClick="'+e+'" ></span>':"",t.title?"&nbsp;"+t.title:"","</button>","</div>"];return i.format(s.join(""),this.id)},t}(u);t.ToolElementButton=p;var f=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,n){var o=['<span data-tool-id="{0}" tool="'+e+'" class="'+["badge-secondary","form-control-plaintext","bs-toolbar-item","bs-toolbar-item-count"].join(" ")+'">'+n+"</span>"];return i.format(o.join(""),this.id)},t.prototype.update=function(){var e=this;e.$element&&n.text(e.$element.get(0),e.config.value)},t}(u);t.ToolElementCount=f;var m=function(t){function o(e,n){return t.call(this,e,n)||this}return __extends(o,t),o.prototype.createElement=function(t,o,r){var a=["bs-toolbar-item dropdown"],s=[];o.actions&&o.actions.forEach(function(t){e.bootstrap4?s.push('<a href="#" class="dropdown-item" data-id="'+t.code+'">'+(t.lib||t.code)+"</a>"):s.push('<li data-id="'+t.code+'"><a href="#" data-id="'+t.code+'">'+(t.lib||t.code)+"</a></li>")});var l=[];o.title||o.icon||l.push('<span class="'+n.iconClass("bars")+'"></span> '),o.icon&&l.push('<span class="'+n.iconClass(o.icon)+'"></span> '),o.title&&l.push(" "+o.title+" ");var u=['<div  data-tool-id="{0}" tabindex="'+t+'" class="'+a.join(" ")+'">','<button class="bs-button btn btn-'+n.bootstrapStyles(!0).secondary+' dropdown-toggle" id="tooltip-dropdown-'+t+'" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',l.join(""),"</button>",e.bootstrap4?'<div class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-'+t+'" data-id="toolCommands">':'<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-'+t+'" data-id="toolCommands">',s.join(""),e.bootstrap4?"</div>":"</ul>","</div>"];return i.format(u.join(""),this.id)},o.prototype.click=function(e){var t=this,o=e.target,i=n.attr(o,"data-id");i&&t.options.callback&&t.options.callback({id:t.config.id,name:t.config.name,type:t.config.type,value:i,toolData:t.config})},o}(u);t.ToolElementDropdownAction=m;var h=function(e){function t(t,n){var o=e.call(this,t,n)||this,a=o;a._form=a.options.form,a._schema=a.options.schema,a._schemaItems=a.options.schemaItems,a._bind=a.options.bind,a._grid=a.options.gridControl,a._selected=[],t.links=t.links||[],t.title=t.title||r.ui.Actions,t.options=t.options||{},void 0===t.options.caret&&(t.options.caret=!0),t.options.type=t.options.type||"secondary",t.options.titleIsHidden&&(t.options.icon=t.options.icon||t.right?"ellipsis-v":"bars");var s=a._schema.links||{};return t.links.forEach(function(e){e.id=i.allocID(),s[e.name]?(e.options=e.options||{},e.options.type=e.options.type||"secondary",e.schema=s[e.name],e.bind=a._bind+".$links."+e.name,e.isHidden=!1,a._form.registerListenerFor(e.bind,a)):console.log("Invalid link name: "+e.name)}),a._form.registerListenerFor(a._bind,a),a._updateselected(),a._state(),o}return __extends(t,e),t.prototype.beforeAppend=function(){this._state2Ui()},t.prototype._state2Ui=function(){var e=this,t=0;if(e.config.links.forEach(function(o){var i=!o.state.isHidden;if(i&&o.schema.select&&(e._selected.length?o.schema.select.multiselect||(i=1===e._selected.length):i=!1),i&&!o.important&&t++,e.$element){var r=n.find(e.$element.get(0),o.id);i?n.removeClass(r,"bs-none"):n.hasClass(r,"bs-none")||n.addClass(r,"bs-none"),i&&(o.state.isDisabled?n.hasClass(r,"disabled")||n.addClass(r,"disabled"):n.removeClass(r,"disabled"))}}),e.$element){var o=n.find(e.$element.get(0),"actions_"+e.id);t?n.removeClass(o,"bs-none"):n.hasClass(o,"bs-none")||n.addClass(o,"bs-none")}},t.prototype._updateselected=function(){var e=this,t=e._form.getValue(e._bind);t&&(e._selected=t.getSelectedItems(e._grid.renderOptions.expandingProperty))},t.prototype._stateOfLink=function(e){var t=this._form.getState(e.bind);e.state=e.state||{},Object.keys(t).forEach(function(n){e.state[n]=t[n]})},t.prototype._state=function(){var e=this;e.config.links.forEach(function(t){e._stateOfLink(t)})},t.prototype.findLinkByBind=function(e){for(var t=this,n=0;n<t.config.links.length;n++)if(t.config.links[n].bind===e)return t.config.links[n];return null},t.prototype.findLinkById=function(e){for(var t=this,n=0;n<t.config.links.length;n++)if(t.config.links[n].id===e)return t.config.links[n];return null},t.prototype.stateChanged=function(e,t){var n=this;if(e&&t&&t.property&&t.property.indexOf(".$links")>=0){var o=n.findLinkByBind(t.property);o&&(n._stateOfLink(o),n._state2Ui())}},t.prototype.changed=function(e,t,n,o,i){var r=this;if(r.$element){var a=e.substr(r._bind.length);if(!(a.indexOf(".$selected")>=0||a.indexOf(".$links")>=0||"propchange"!==o))if(e===r._bind)r._updateselected(),r._state2Ui();else{var l=e,u=s.parsePath(r._bind,l,r._grid.renderOptions.expandingProperty);if(i[u]){var c=e.substr(u.length+1);if(!c)return;s.isSelectField(c)&&(r._updateselected(),r._state2Ui())}}}},t.prototype._createImportantActions=function(e){var t=this;t.config.links.forEach(function(o){if(o.important){e.push('<div id="'+o.id+'" class="bs-toolbar-item'+(t.config.right?" right":"")+' " title="'+i.escapeHtml(o.schema.title)+'">');var r=!1;void 0!==o.options.outline?r=o.options.outline:["default","secondary","danger"].indexOf(o.options.type)>=0&&(r=!0),e.push('<button data-action-id="'+o.id+'" class="bs-button btn btn-'+n.bootstrapStyles(r)[o.options.type]+'" type="button">');var a=!1;o.options.icon&&(a=!0,e.push('<span data-action-id="'+o.id+'" class="'+n.iconClass(o.options.icon)+'"></span>')),!o.options.titleIsHidden&&o.schema.title&&e.push('<span data-action-id="'+o.id+'" '+(a?'class="d-none d-md-inline-block">&nbsp;':">")+i.escapeHtml(o.schema.title)+"</span>"),e.push("</button>"),e.push("</div>")}})},t.prototype._createMenuActions=function(e){this.config.links.forEach(function(t){t.important||e.push('<a id="'+t.id+'" data-action-id="'+t.id+'" href="#" class="dropdown-item">'+i.escapeHtml(t.schema.title)+"</a>")})},t.prototype.createElement=function(e,t,o){var r=this,a=[];return a.push('<div  data-tool-id="{0}" tabindex="{1}" class="bs-toolbar-item '+(r.config.right?" right":"")+(r.config.bottom?" bottom":"")+'">'),r._createImportantActions(a),a.push('<div class="dropdown">'),a.push('<button id="actions_{0}" title="'+i.escapeHtml(t.title)+'" class="bs-button btn btn-'+n.bootstrapStyles(!0)[t.options.type]+(t.options.caret?" dropdown-toggle":"")+'" id="tooltip-dropdown-{1}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),t.options.icon&&a.push('<span class="'+n.iconClass(t.options.icon)+'"></span>'),t.options.titleIsHidden||a.push('<span class="d-none d-md-inline-block">&nbsp;'+i.escapeHtml(t.title)+" </span>"),a.push("</button>"),a.push('<div class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-{1}" data-id="toolCommands">'),r._createMenuActions(a),a.push("</div>"),a.push("</div>"),a.push("</div>"),i.format(a.join(""),r.id,e)},t.prototype.destroy=function(){var t=this;t._bind&&(t._form.unRegisterListenerFor(t._bind,t),t._bind=null),t.config&&t.config.links.forEach(function(e){t._form.unRegisterListenerFor(e.bind,t)}),t._grid=null,t._form=null,t._schema=null,t._schemaItems=null,e.prototype.destroy.call(this)},t.prototype.click=function(e){var t=this,o=e.target;o.href&&e.preventDefault();var i=n.attr(o,"data-action-id");if(i){var r=t.findLinkById(i);r&&(r.isHidden||r.state.isDisabled||r.state.isHidden||t._form.execAction(r.bind,r.schema.select?t._selected:null))}},t}(u);t.ToolElementArrayAction=h;var v=function(e){function t(t,n){var o=e.call(this,t,n)||this;return t.value=t.value||{},t.value.default=l.context().$url.idTra,t.value.items=t.value.items||[],o}return __extends(t,e),t.prototype.createElement=function(e,t,n){var o=["bs-toolbar-item"],r=[];t.value.items&&t.value.items.forEach(function(e){r.push('<option value="'+e.code+'" '+(t.value.default==e.code?"selected":"")+">"+(e.lib||e.code)+"</option>")});var a=['<div data-tool-id="{0}" tabindex="'+e+'" class="'+o.join(" ")+'">','<div class="input-group">','<span class="input-group-addon">',t.title||"","</span>",'<select class="form-control" data-id="toolSelect">',r.join(""),"</select>","</div>","</div>"];return i.format(a.join(""),this.id)},t.prototype._select=function(){var e=this;if(e.$element&&e.$element.get(0))return n.query(e.$element.get(0),"select[data-id='toolSelect']")},t.prototype.update=function(){var e=this;if(e.$element){var t=document.createDocumentFragment();e.config.value.items&&e.config.value.items.forEach(function(o){n.append(t,$('<option value="'+o.code+'" '+(e.config.value.default==o.code?"selected":"")+">"+(o.lib||o.libelle||o.code)+"</option>").get(0))});var o=e._select();o&&(n.empty(o),n.append(o,t))}},t.prototype._setEvents=function(){var e=this,t=e._select();t&&$(t).change(function(t){var n=t.target,o=n.options[n.selectedIndex];e.options.callback&&e.options.callback({id:e.config.id,name:e.config.name,type:e.config.type,value:o.value,toolData:e.config})})},t.prototype._removeEvents=function(){var e=this._select();e&&$(e).off("change")},t}(u);t.ToolElementSelect=v;var g=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.config.value="",o.oldValue="",o}return __extends(t,e),t.prototype.createElement=function(e,t,o){var r=['<div data-tool-id="{0}" tabindex="'+e+'" class="bs-toolbar-item input-group'+[].join(" ")+'">','<input toolKeyup="'+e+'" type="text" class="form-control" placeholder="'+(t.title||"Recherche")+'" />','<span class="input-group-btn">','<button toolClick="'+e+'" class="bs-button btn btn-'+n.bootstrapStyles(!0).secondary+'" type="button">','<span toolClick="'+e+'" class="'+n.iconClass(t.icon||"search")+'"> </span>',"</button>","</span>","</div>"];return i.format(r.join(""),this.id)},t.prototype.update=function(){var e=this;if(e.$element){var t=n.query(e.$element.get(0),"input");t&&(t.value=e.config.value)}},t.prototype.getValue=function(){var e=this;return e.oldValue=e._getInputValue(),e.oldValue},t.prototype._getInputValue=function(){var e=this;if(e.$element){var t=n.query(e.$element.get(0),"input");return t?t.value:null}},t.prototype._setEvents=function(){var e=this;if(e.$element){var t=e.$element.get(0);if(t){var o=n.query(t,"input"),i=n.query(t,"button");o.addEventListener("focus",function(e){o.select()}),t.addEventListener("blur",function(t){var n=t.explicitOriginalTarget&&t.explicitOriginalTarget!=i&&null==t.relatedTarget;n=n||(null==t.relatedTarget||t.relatedTarget&&t.relatedTarget!=i)&&void 0==t.explicitOriginalTarget,t.target==o&&n&&(e.config.value=" ",e.setValue(e.oldValue))},!0)}}},t}(u);t.ToolElementSearch=g;var y=function(i){function r(e,t){var n=i.call(this,e,t)||this,o=n;return o.config.value=e.fields||o.config.value,o._init(),n}return __extends(r,i),r.prototype._init=function(){var e=this,n=e.options||{};e.filterExpress=new o.FilterExpress(e.config.fields||[],function(n){if(e.options.callback){var i=null;(n=n?Array.isArray(n)?n:[n]:null)&&n.length&&(i=e.options.mongoDbFilter?t.filter.format.toMongoDbFilter(e.config.fields,n):o.filter.format.toPhenix(e.config.fields,n));var r="";i&&(r=e._formatTitle(e.config.fields,n)),e.options.callback({id:e.config.id,name:e.config.name,type:e.config.type,value:{title:r,value:i},toolData:e.config})}},n)},r.prototype.createElement=function(t,n,o){var i=[];return e.utils.format('<div data-tool-id="{0}" class="bs-toolbar-item '+i.join(" ")+'"></div>',this.id)},r.prototype.render=function(e){var t=this;return t.$element||(t.$element=$(t.createElement(t.config.id,t.config,t.config.value)),t.filterExpress&&t.filterExpress.render(t.$element)),e&&n.append(e.get(0),t.$element.get(0)),t.$element},r.prototype.updateRender=function(){var e=this;n.empty(e.$element.get(0)),e._init(),e.filterExpress&&e.filterExpress.render(e.$element)},r.prototype._formatTitle=function(e,n){return t.filter.format.toTitle(n,e)},r.prototype.update=function(){var e=this;e.$element&&(e.config.value=e.config.fields||e.config.value||[],e.filterExpress.fields=e.config.value)},r}(u);t.ToolElementFilterExpress=y;var _=function(t){function o(e,n){return t.call(this,e,n)||this}return __extends(o,t),o.prototype.createElement=function(t,o,r){var a=['<div data-tool-id="{0}" class="bs-toolbar-item">','<button toolClick="'+t+'" type="button" class="'+["bs-button btn btn-"+n.bootstrapStyles(!0).secondary].join(" ")+'">',o.icon?'<span toolClick="'+t+'" class="'+n.iconClass(o.icon)+'"></span>':"",o.title?"&nbsp;"+o.title:"","</button>",'<span class="bs-toolbar-item-filter '+(e.bootstrap4?"form-control-plaintext":"form-control-static")+' bs-cursor-h"></span>',"</div>"];return i.format(a.join(""),this.id)},o.prototype.addTooltip=function(e){var t=this,o=$('<span data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title= "'+e+'"> '+e+" </span>"),i=n.query(t.$element.get(0),".bs-toolbar-item-filter");n.empty(i),n.append(i,o.get(0)),o.tooltip&&o.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left"></div></div>'})},o.prototype.update=function(){var e=this;e.$element&&e.addTooltip(e.config.value)},o.prototype.render=function(e){t.prototype.render.call(this,e);var n=this;n.addTooltip(n.config.value)},o}(u);t.ToolElementFilter=_;var b=function(){function t(e,t){var n=this;n.id=i.allocID(),n.options=t||{},n._map={},n.toolElements=e||[],n._schema=t.schema,n._form=t.form,n._schemaItems=t.schemaItems,n._bind=t.bind}return Object.defineProperty(t.prototype,"form",{get:function(){return this._form},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"schemaItems",{get:function(){return this._schemaItems},enumerable:!0,configurable:!0}),t.prototype._idComponent=function(e){var t=this;if(!t.$elementTop)return null;for(var n,o=e,i=t.$elementTop.get(0);o;){if(!o.getAttribute)return null;if(n=o.getAttribute("data-tool-id"))return t._map[n];o=o===i||o===document.body?null:o.parentNode}return t.$elementTop?null:void 0},t.prototype.getToolElement=function(e){var t=null;return this.toolElements.forEach(function(n,o){if(o==e||n.name===e)return t=n.$component,!1}),t},t.prototype.setValue=function(e,t){var n=this.getToolElement(e);n&&n.setValue(t)},t.prototype.getValue=function(e){var t=this.getToolElement(e);if(t)return t.getValue()},t.prototype.refresh=function(){this.toolElements.forEach(function(e){var t=e.$component;t&&t.refresh()})},t.prototype.setOptions=function(e,t){var n=this.getToolElement(e);n&&n.setOptions(t)},t.prototype.getOptions=function(e){var t=this.getToolElement(e);if(t)return t.getOptions()},t.prototype._setEvents=function(){function e(e,n){if(n>=0){var o=t.getToolElement(n);if(o&&t.options.selectToolElement){var i=o.getValue();o.after(),t.options.selectToolElement({id:o.config.id,type:o.config.type,name:o.config.name,value:i,toolData:o.config},e)}}}var t=this;t.$elementTop&&t.$elementTop.on("click",function(o){var i=n.attr(o.target,"toolClick");if(null!==i)e("click",i);else{var r=t._idComponent(o.target);r&&r.click&&r.click(o)}}).on("keyup",function(t){13==t.keyCode&&e("keyup",n.attr(t.target,"toolKeyup"))}),t.$elementBottom&&t.$elementBottom.on("click",function(e){var n=t._idComponent(e.target);n&&n.click&&n.click(e)})},t.prototype._controlById=function(e){return this._map[e]},t.prototype._removeEvents=function(){var e=this;e.$elementTop&&e.$elementTop.off("click"),e.$elementBottom&&e.$elementBottom.off("click")},t.prototype._renderToolElements=function(e){var t=this;if(e.length&&t.$elementTop){var o=t.$elementTop.get(0),i=n.find(o,t.id+"_top_left"),r=n.find(o,t.id+"_top_right"),a=t.$elementBottom?t.$elementBottom.get(0):null,s=a?n.find(a,t.id+"_bottom_left"):null,l=a?n.find(a,t.id+"_bottom_right"):null;t._map={},e.forEach(function(e,n){e.id=n;var o=e.type,u=$.extend(!0,{callback:t.options.selectToolElement},e.options||{});switch(u.form=t._form,u.schema=t._schema,u.schemaItems=t._schemaItems,u.bind=t._bind,u.gridControl=t.options.gridControl,o.toLowerCase()){case"count":e.$component=new f(e,u);break;case"filter":e.$component=new _(e,u);break;case"search":e.$component=new g(e,u);break;case"filterexpress":u.mongoDbFilter=t.options.composition,e.$component=new y(e,u);break;case"dropdownaction":e.$component=new m(e,u);break;case"links":e.$component=new h(e,u);break;case"select":e.$component=new v(e,u);break;case"title":e.$component=new c(e,u);break;case"icon":e.$component=new d(e,u);break;default:e.style=e.style||e.type,e.$component=new p(e,u)}if(e.$component){t._map[e.$component.id]=e.$component;var b=e.bottom?a?e.right?$(l):$(s):null:e.right?$(r):$(i);b&&e.$component.render(b)}})}},t.prototype.render=function(t,n){var o=this,r=!1,a=(e.bootstrap4,['<div class="container-fluid no-x-padding no-x-margin">','<div class="bs-island bs-toolbar">','<div class="bs-toolbar-left mr-auto form-inline" id="{0}_{1}_left"></div>','<div class="bs-toolbar-right form-inline" id="{0}_{1}_right"></div>',"</div>","</div>"]);if(t&&!o.$elementTop&&(o.$elementTop=$(i.format(a.join(""),o.id,"top")),r=!0),n&&!o.$elementBottom&&(o.$elementBottom=$(i.format(a.join(""),o.id,"bottom")),r=!0),r){if(o._renderToolElements(o.toolElements),t){var s=t;o.options.replaceParent?((s=$("<div></div>")).append(o.$elementTop),t.replaceWith(s)):s.append(o.$elementTop)}n&&n.append(o.$elementBottom),o._setEvents()}},t.prototype.destroy=function(){var e=this;e._removeEvents(),e.$elementTop=null,e.options=null,e.toolElements=null,e._map=null,e.toolElements&&(e.toolElements.forEach(function(e){e.$component&&(e.$component.destroy(),e.$component=null)}),e.toolElements=null),e._form=null,e._schema=null,e._schemaItems=null},t}();t.ToolBar=b;var x=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._state(),i}return __extends(t,e),t.prototype.getValue=function(e){return this._toolbar.getValue(e)},t.prototype.setValue=function(e,t){this._toolbar.setValue(e,t)},t.prototype.refresh=function(){this._toolbar.refresh()},t.prototype.getOptions=function(e){return this._toolbar.getOptions(e)},t.prototype.setOptions=function(e,t){this._toolbar.setOptions(e,t)},t.prototype.changed=function(e,t,n,o){this.refresh()},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.click=function(e){},t.prototype._createContainer=function(e){var t=this.renderOptions.style||"";return i.format('<div id="{0}" data-render="{0}" class="bs-tile '+t+'"></div>',e)},t.prototype._onSelectToolElement=function(e){var t=this,n=e.name||e.id;t.form.execAction(t.$bind+".$toolbar."+n,{toolElement:e,control:t})},t.prototype.render=function(e){var t=this,n=t._initOptions(a.utils.defaultOptions);if(!t.$element){t.$element=$(t._createContainer(t.id));var i=t.state.value||[];i.forEach(function(e){return e=$.extend(!0,e,e.data,{options:e.options}),delete e.data,delete e.options,e});var r={selectToolElement:t._onSelectToolElement.bind(t)};t._toolbar=new o.ToolBar(i,r),t._toolbar.render(t.$element)}return t.appendElement(e,n),t.$element},t}(t.AbsField);t.ToolbarForm=x,o.registerControl(x,"array",!1,"toolbar")}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.min.js.map