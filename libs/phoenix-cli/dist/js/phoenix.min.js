var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Phoenix;!function(a){var b;!function(a){var b=function(){return window.Promise||(window.ES6Promise?window.ES6Promise.Promise:null)},c=function(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b},d=function(){return c(!1)+c(!0)+c(!0)+c(!1)},e=function(){return"I"+c(!1)+c(!1)+c(!1)+c(!1)},f=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return a[0].replace(/{(\d+)}/g,function(b,c){return c=parseInt(c,10),a[c+1]})},g=function(a,b){return a.replace(/{([^{]*)}/g,function(a,c){return b[c]||""})},h=function(a,b){for(var c in a)b[c]=a[c]},i=function(a){Object.keys(a).forEach(function(b){a[b]=null})},j={scope:!1,destroy:!1,menu:!1,proxydata:!1},k=function(a){var b={};for(var c in a)b[c]=a[c];return b},l=function(a,b){if(!a&&b||!b&&a)return!1;if(a===b)return!0;if(!a&&!b)return!1;if(Array.isArray(a)){if(a.length!=b.length)return!1;for(var c=0,d=a.length;c<d;c++)if(!l(a[c],b[c]))return!1}else if("object"==typeof a){if(typeof a!=typeof b)return!1;var e=Object.keys(a),f=Object.keys(b);if(e.length!==f.length)return!1;for(var g=0,h=e.length;g<h;g++)if(!l(a[e[g]],b[e[g]]))return!1;return!0}return!1},m=function(a,b){return void 0!==b&&(j[a]=b),j[a]},n=function(a,b){j&&j[b]&&console.log(a)},o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},p=function(a){return(a||"").replace(/[&<>"'\/]/g,function(a){return o[a]})},q=function(){for(var a=document.getElementsByTagName("script"),b=a.length-1;b>=0;--b){var c=a[b].src.split("?")[0],d=c.split("/"),e=d.length,f=d[e-1].toLowerCase();if("phoenix.js"==f||"phoenix.min.js"==f||"core.js"==f&&"core"==d[e-2]){var g=e-1;return"core.js"==f&&g--,d.slice(0,g).join("/")}}throw"Invalid script Name"},r=function(a,b){if(a.indexOf(".")>=0){var c=b;return a.split(".").forEach(function(a){c&&(c=c[a])}),(c||"")+""}return void 0===b[a]?a:b[a]},s=function(a){return(a||"").indexOf("{{")>=0},t=function(a,b){return a.replace(/{{([^{]*)}}/g,function(a,c){return r(c,b)})},u=function(a,b){return a.replace(/{{([^{]*)}}/g,function(a,c){return b.push({name:c}),""})},v=function(a,b){switch(a){case"uppercase":return b.toUpperCase();case"lowercase":return b.toLowerCase();case"firstChar":return b&&b.length?b[0]:""}return b},w=function(a,b){return a.replace(/{{([^{]*)}}/g,function(a,c){for(var d=c.split("|"),e=(d[0]||"").trim(),f=r(e,b),g=1,h=d.length;g<h;g++)f=v((d[g]||"").trim(),f);return f})},x=function(a,b){var c=b||this;Object.defineProperty(c.props,a,{get:function(){return c.data[a]},set:function(b){b!=c.data[a]&&(c.data[a]=b,c._notifyChange(a))},enumerable:!0})},y=function(a,b){b.forEach(function(b){Object.getOwnPropertyNames(b.prototype).forEach(function(c){a.prototype[c]=b.prototype[c]})})},z=function(){return function(a){setTimeout(function(){a()},200)}},A=function(){var a;return a=window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}},B=function(a,b){return a=a||{},Object&&Object.assign?Object.assign(a,b):(Object.keys(b).forEach(function(c){a[c]=b[c]}),a)},C=function(a){var c=A(),d=b();return new d(function(b,d){c(function(){b(a)})})};a.Promise=b(),a.allocUuid=d,a.allocID=e,a.format=f,a.merge=h,a.formatNames=g,a.extend=B,a.logModule=m,a.log=n,a.equals=l,a.copy=k,a.escapeHtml=p,a.phoenixPath=q,a.parseExpression=t,a.hasExpression=s,a.parseVariable=r,a.defineProperty=x,a.applyMixins=y,a.nextTick=A(),a.focusDelay=z(),a.dataAsPromise=C,a.extractAngularVars=u,a.execAngularExpression=w,a.confirm=function(a,b,c){window.confirm(b)&&c()},a.alert=function(a,b,c){window.alert(b)},a.prompt=function(a,b,c){var d=window.prompt(a,b);c(d)},a.cleanUpObject=i}(b=a.utils||(a.utils={})),function(){var a=Array.prototype;a.find||(a.find=function(a,b){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var c,d=Object(this),e=d.length>>>0,b=arguments[1],f=0;f<e;f++)if(c=d[f],a.call(b,c,f,d))return c}),a.findIndex||(a.findIndex=function(a,b){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var c,d=Object(this),e=d.length>>>0,b=arguments[1],f=0;f<e;f++)if(c=d[f],a.call(b,c,f,d))return f;return-1})}()}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="./modules/utils.ts" />
var Phoenix;!function(a){a.utils;a.bootstrap4=!1;var b;!function(a){a.hashHandler=null,a.logoutHandler=null,a.forbiddenHandler=null,a.changePasswordHandler=null,a.checkLoggedInHandler=null,a.historyChangedHandler=null}(b=a.external||(a.external={}));var c;!function(a){var c,d=[],e=function(){d.pop(),b.historyChangedHandler&&b.historyChangedHandler()},f=function(a,c){if(c)return d=[a],void(b.historyChangedHandler&&b.historyChangedHandler());var e=d.length,f=e?d[e-1]:"";if(f!=a){var g=e>=2?d[e-2]:"";a==g?d.pop():d.push(a),b.historyChangedHandler&&b.historyChangedHandler()}},g=function(){return d.length>1};/* replaceHash */
if("replaceState"in window.history)c=function(a){"#"!==(""+a).charAt(0)&&(a="#"+a),window.location.hash!=a&&(e(),window.history.replaceState("","",a))};else{var h=window.location.hash;c=function(a){"#"!==(""+a).charAt(0)&&(a="#"+a),location.hash!==a&&(e(),location.hash!==h&&window.history.back(),window.location.hash=a)}}a.removeLast=e,a.add=f,a.hasBack=g,a.value=d,a.replaceHash=c}(c=a.history||(a.history={}));var d;!function(a){var b={},c=function(a,c,d){b[a]=b[a]||{},b[a][c]=d},d=function(a,c){return b[a]?b[a][c]:null};a.register=c,a.get=d}(d=a.render||(a.render={}));var e;!function(a){var b={},c=function(a,c){var d="on"+a,e=b[d];e&&e.forEach(function(a){var b=a.listener?a.handler.bind(a.listener):a.handler;b(c)})},d=function(a,c,d){b[a]=b[a]||[];var e=b[a];e.push({listener:d,handler:c})},e=function(a,c){function d(b){if(b)for(var c=b.length;c--;){var d=b[c];d.listener==a&&b.splice(c,1)}}c?d(b[c]):Object.keys(b).forEach(function(a){d(b[a])})};a.emit=c,a.listen=d,a.unlisten=e}(e=a.ipc||(a.ipc={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
var Phoenix;!function(a){var b;!function(a){var b=function(){function a(){this._eventList=[]}return a.prototype.execute=function(a){this._eventList.push(a),this._execute()},a.prototype._execute=function(){var a=this;if(!a._inExec){a._inExec=!0;try{for(;;){if(!a._eventList.length)break;var b=a._eventList.shift();try{b()}catch(c){}}}finally{a._inExec=!1}}},a}();a.Serial=b;var c=function(){function a(a,b,c,d,e){var f=this;f.ondispose=e,f.promise=b,f.resolve=c,f.errorhandler=d,f.dataHandler=f.ondata.bind(f),a?f.timer=window.setTimeout(f._execute.bind(f),a):f._execute()}return a.prototype.ondata=function(a){var b=this,c=b.resolve;b.destroy(),c&&c(a)},a.prototype.onerror=function(a){var b=this,c=b.errorhandler;b.destroy(),c&&c(a)},a.prototype._execute=function(){var a=this;a.promise&&a.promise.then?a.promise.then(a.dataHandler,a.onerror.bind(a)):a.dataHandler(a.promise)},a.prototype._cleaTimeout=function(){var a=this;a.timer&&(window.clearTimeout(a.timer),a.timer=0)},a.prototype.destroy=function(){var a=this;a.resolve=null,a.errorhandler=null,a._cleaTimeout(),a.promise=null;var b=a.ondispose;a.ondispose=null,b&&b(a)},a}(),d=function(){function a(a){this.defaultDelay=0;var b=this;b.defaultDelay=a,b._error=b._errorHandler.bind(b),b._dispose=b._onEventDisposed.bind(b)}return a.prototype._errorHandler=function(a){var b=this;b.onError&&b.onError(a)},a.prototype.clear=function(){var a=this;a.currentEvent&&(a.currentEvent.destroy(),a.currentEvent=null)},a.prototype._onEventDisposed=function(a){var b=this;b.currentEvent=null},a.prototype.push=function(a,b,d){var e=this;e.clear();var f=d?0:e.defaultDelay;e.currentEvent=new c(f,a,b,e._error,e._dispose)},a.prototype.destroy=function(){var a=this;a.clear()},a}();a.SingleEventBus=d,a.GlbSerial=new b}(b=a.utils||(a.utils={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(a){a.locale={}}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
var Phoenix;!function(a){var b;!function(a){var b={},c=function(a,c){for(var d=a.split("."),e=b,f=0,g=d.length-1;f<g;f++){var h=d[f];e[h]=e[h]||{},e=e[h]}e[d[d.length-1]]=c},d=function(a){for(var c=a.split("."),d=b,e=null,f=0,g=c.length;f<g;f++){if(e=d[c[f]],!e)return e;d=e}return e};a.register=c,a.get=d}(b=a.customData||(a.customData={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
var Phoenix;!function(a){function b(){f(a.$mem)}function c(a,b){var c=null;try{c=JSON.parse(window.sessionStorage.getItem("preferences"))}catch(d){}if(void 0===b)return c?c[a]:void 0;c=c||{},c[a]=b;try{window.sessionStorage.setItem("preferences",JSON.stringify(c))}catch(d){}}function d(a,b){var c=null;try{c=JSON.parse(window.localStorage.getItem("preferences"))}catch(d){}if(void 0===b)return c?c[a]:void 0;c=c||{},c[a]=b;try{window.localStorage.setItem("preferences",JSON.stringify(c))}catch(d){}}a.device={phone:!1,tablet:!1,deviceType:""};var e=function(){try{if(window.sessionStorage)return JSON.parse(window.sessionStorage.getItem("$mem"))||{}}catch(a){return{}}},f=function(a){a=a||{};try{window.sessionStorage&&window.sessionStorage.setItem("$mem",JSON.stringify(a))}catch(b){}};a.$mem=e(),a.save$mem=b,a.sessionPreferences=c,a.preferences=d,a.build={version:"0.1.0.0",release:!1}}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
/// <reference path="./globals.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.build,d={},e={setItem:function(a,b){d[a]=b},getItem:function(a){return d[a]}},f=[],g=function(){var a=null;try{a=c.release?window.sessionStorage:window.localStorage}catch(b){a=null}return a||(a=e),a},h=function(a,b){b||(a.basic="Basic "+window.btoa((a.login||"")+":"+(a.password||""))),g().setItem("authentication",JSON.stringify(a))},i=function(){try{return JSON.parse(g().getItem("authentication"))}catch(a){return null}},j=function(a){f.push(a)},k=function(){g().setItem("authentication","null"),f.forEach(function(a){a()})};b.db=g,b.save=h,b.load=i,b.clear=k,b.registerAfterLogout=j}(b=a.authentication||(a.authentication={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
var Phoenix;!function(a){var b;!function(a){function b(b,c){return b=b||a.name,void 0==c?h("application_"+b):g("application_"+b,c)}function c(b,c,d){if(a.name=b,a.title=c,d&&d.homes&&d.homes[b]&&(a.homeName=d.homes[b]),a.configuration=d,angular){var e=d?d.angularModules||[]:[];Array.isArray(e)||"object"!=typeof e||(e=e[b]||[]),a.angularApplication=angular.module(b,e)}}function d(){return a.configuration&&a.configuration.portailName?a.configuration.portailName:"portail"}function e(){return a.name===d()}var f={},g=function(a,b){return f[a]=b,b},h=function(a){return f[a]};a.core="phoenix",a.name="",a.support="",a.homeName="home",a.title="",a.licences={},a.configuration=null,a.config=b,a.init=c,a.portailName=d,a.isPortail=e}(b=a.application||(a.application={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
/// <reference path="./utils.ts" />
/// <reference path="./locale.ts" />
/// <reference path="./customdata.ts" />
/// <reference path="./authentication.ts" />
/// <reference path="./application.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,a.application),d=a.customData,e=a.authentication,f=a.locale,g={},h=function(a){var b=g["s"+a];return!(!b||b.disabled)&&(b.handlers.forEach(function(a){a()}),!0)},i=function(a,b){var c="s"+a,d=g[c]||{disabled:!1,handlers:[]};d.handlers.push(b),g[c]=d},j=function(a,b){var c=g["s"+a];c&&(c.disabled=!b)},k=function(a){return a&&"function"==typeof a},l=function(a){var b=null;if(a.responseText&&(b={responseText:a.responseText}),a.responseJSON)if(b=b||{},"object"==typeof a.responseJSON)b.json=a.responseJSON;else try{b.json=JSON.parse(a.responseJSON)}catch(c){}return b},m=function(a){var b={message:"",list:[]};a&&"object"!=typeof a&&(a={message:a}),a=a||{},b.status=a.status,a.message=a.message||f.errors.unknownError;var c;if(a.detail)if(a.detail.json&&a.detail.json.error){var d=a.detail.json.error,e=void 0;if(void 0!==d.details&&(e=d),c=d.message,d.innererror&&d.innererror.message&&"Json"===d.innererror.type&&(e=JSON.parse(d.innererror.message)),e)return b.message=e.message,e.details&&e.details.forEach(function(a){b.list.push({message:a.message,target:a.target})}),b}else c=a.detail.json&&a.detail.json.exceptionMessage?a.detail.json.exceptionMessage:a.detail.responseText;return b.message=c||a.message,b},n=function(b,c,e){!e&&k(c)&&(e=c,c=null);var g={type:"GET",url:b,dataType:"json",accept:"application/json"},i=null;c&&(i=c.$errors,delete c.$errors,Object.keys(g).forEach(function(a){c[a]=g[a]}),g=c);var j=a.utils.Promise;return new j(function(a,b){$.ajax(g).done(function(b,c,d){e&&(b=e(b)),a(b)}).fail(function(e,g,j){if(c&&c.ignore&&c.ignore[""+e.status])return a({});if(i&&i[e.status+""]){var k=e.status+"";if("string"!=typeof i[k])return a(i[k]);var m=d.get(i[k]);m&&a(m())}if(h(e.status))return a({});e.status>=500&&f&&f.errors&&(g=f.errors.error500,j=null);var n=l(e);n&&(j=null),j&&"string"==typeof j&&(j={message:j}),j=j||{message:g,detail:n},j.status=e.status,b(j)})})},o=function(b,c,d,e){var g=a.utils.Promise,i={type:b,contentType:"application/json",accept:"application/json",url:c,data:null};return e&&e.headers&&(i.headers=e.headers),d&&(i.data=JSON.stringify(d)),new g(function(a,b){$.ajax(i).done(function(b,c,d){a(b)}).fail(function(c,d,g){if(e&&e.ignore&&e.ignore[""+c.status])return a({});if(h(c.status))return a({});c.status>=500&&f&&f.errors&&(d=f.errors.error500,g=null);var i=l(c);i&&(g=null),g&&"string"==typeof g&&(g={message:g}),g=g||{message:d,detail:i},g.status=c.status,b(g)})})},p=function(a,b,c){return o("PUT",a,b,c)},q=function(a,b,c){return o("PATCH",a,b,c)},r=function(a,b,c){return o("POST",a,b,c)},s=function(a,b){return o("DELETE",a,null,b)},t={},u=function(){var b=a.application.config(c.name),d={headers:null};if(b&&b.odata&&b.odata.headers&&(d.headers=b.odata.headers),d.headers=d.headers||{},d.headers.Accept="application/json",b&&b.odata&&b.odata.authentication){var f=e.load();if(f)switch(b.odata.authentication){case"basic":d.headers.Authorization=f.basic;break;case"header-session":d.headers.Authorization="Bearer "+f.token}else delete d.headers.Authorization}return d},v=function(a,b,c,d){var e=t[a];if(e){if(e.loaded)return c(null);if(e.error)return c(e.error,null);
//status.loading == true
window.setTimeout(function(){v(a,b,c,d)},20)}else t[a]={loading:!0},d?d.execute(function(b){b?t[a]={error:b}:t[a]={loaded:!0},c(b)}):$.ajax({url:b,dataType:"script",cache:!0}).done(function(b,d,e){t[a]={loaded:!0},c(null)}).fail(function(b,d,e){var f=e||{message:d};t[a]={error:f},c(f)})},w=function(b){var c=a.utils.Promise;return new c(function(a,c){$.ajax({url:b,dataType:"script",cache:!0}).done(function(b,c,d){a(!0)}).fail(function(a,b,d){c(d||{message:b})})})},x=function(b,d){var e=a.utils.Promise,g=u(),i=c.config(c.name)||{},j=i.rest?i.rest.base||"":"";return b&&"/"===b.charAt(0)&&(j=""),j&&(b=j+"/"+b),new e(function(a,c){var e=function(b){var d=b.statusText;if(h(b.status))return a({});b.status>=500&&f&&f.errors&&(d=f.errors.error500);var e=null;// _parseError(xhr);
c({message:d,detail:e})},i=new XMLHttpRequest;i.open("POST",b,!0),i.responseType="arraybuffer",i.onload=function(){if(200===this.status||201===this.status){var b="",d=i.getResponseHeader("Content-Disposition");if(d&&d.indexOf("attachment")!==-1){var f=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,g=f.exec(d);null!=g&&g[1]&&(b=g[1].replace(/['"]/g,""))}var h=i.getResponseHeader("Content-Type");try{var j=new Blob([this.response],{type:h})}catch(k){return c(k)}if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(j,b),a({});else{var l=window.URL||window.webkitURL,m=l.createObjectURL(j);if(b){
// use HTML5 a[download] attribute to specify filename
var n=document.createElement("a");
// safari doesn't support this yet
"undefined"==typeof n.download?window.location=m:(n.href=m,n.download=b,document.body.appendChild(n),n.click(),document.body.removeChild(n))}else window.location=m;setTimeout(function(){l.revokeObjectURL(m),a({})},100)}}else e(this)},i.onerror=function(){e(i)},i.setRequestHeader("Content-type","application/json"),g&&g.headers&&Object.keys(g.headers).forEach(function(a){i.setRequestHeader(a,g.headers[a])}),i.send(JSON.stringify(d))})};b.extractAjaxErrors=m,b.get=n,b.getScript=w,b.getDefaultAjaxOptions=u,b.put=p,b.patch=q,b.post=r,b.remove=s,b.postAndDownload=x,b.loadScript=v,b.interceptError=i,b.activateInterceptError=j}(b=a.ajax||(a.ajax={}))}(Phoenix||(Phoenix={}));
/// <reference path="./ajax.ts" />
/// <reference path="./locale.ts" />
var Phoenix;!function(a){var b;!function(b){function c(c){var d=a.utils.phoenixPath();c!=b.currentLang&&e.getScript(d+"/locale/phoenix_"+b.lang+".min.js").then(function(){b.currentLang=c})["catch"](function(a){})}var d=a.locale,e=a.ajax,f=[],g=function(a){f.push(a)},h=function(a,b){$.extend(!0,d,a),f.forEach(function(a){a(b)})},i=function(a,b){return b=b||{},a&&"{{"==a.substring(0,2)?a.replace(/{{(.*)}}/g,function(a,c){for(var d=c.split("."),e=b,f=0,g=d.length;f<g&&e;f++)e=e[d[f]];return void 0===e?"["+c+"]":e}):a},j=["en","fr"],k=function(a,b){return a=Math.round(Math.abs(a)),isNaN(a)?b:a},l=function(a,b){b=k(b,2);var c=Math.pow(10,b);return(Math.round(a*c)/c).toFixed(b)},m=function(a,b,c,d){if(null===a)return"";var e=k(b,0),f=a<0?"-":"",g=parseInt(l(Math.abs(a||0),e),10)+"",h=g.length>3?g.length%3:0;return f+(h?g.substr(0,h)+c:"")+g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+c)+(e?d+l(Math.abs(a),e).split(".")[1]:"")},n=function(a,b,c,d,e,f){return null===a?"":(f=f||"%v %s",f.replace("%s",e).replace("%v",m(a,b,c,d)))},o=function(a){if(a instanceof Date)return a;if(!a)return null;var b=Date.parse(a);return isNaN(b)?null:new Date(b)},p=function(a){return a?Date.UTC(parseInt(a.substr(0,4),10),parseInt(a.substr(5,2),10)-1,parseInt(a.substr(8,2),10),0,0,0):0},/**
        * @param {string} val
        * @param {number || null} len
        */
q=function(a,b){for(var c=a+"";c.length<b;)c="0"+a;return c},r=function(a,b){var c=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=a.getDate(),f=a.getDay(),g=a.getMonth(),h=a.getFullYear(),i={d:e,dd:q(e,2),ddd:d.date.weekdaysShort[f],dddd:d.date.weekdays[f],m:g+1,mm:q(g+1,2),mmm:d.date.monthsShort[g],mmmm:d.date.months[g],yy:(h+"").slice(2),yyyy:h};return b.replace(c,function(a){return a in i?i[a]:a.slice(1,a.length-1)})},/**
        * Date to ISO8601
        * @param {Date} value
        */
s=function(a){var b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();return q(b,4)+"-"+q(c,2)+"-"+q(d,2)},t=function(a){var b=d.date.dateShort.split("/");if(3!=b.length)return"";var c=a.split(d.date.daySep),e=[0,0,0];b.forEach(function(a,b){var d=0;"m"===a.charAt(0)?d=1:"y"===a.charAt(0)&&(d=2),e[d]=parseInt(c[b],10),2==d&&e[d]<100&&c[b].length<3&&(e[d]+=100*Math.round((new Date).getFullYear()/100))});var f=q(e[2],4)+"-"+q(e[1],2)+"-"+q(e[0],2),g=Date.parse(f);return isNaN(g)?"":f},u=function(a){if(!a)return"";var b=o(a);if(!b)return"";var c=d.date.dateShort;return"/"!=d.date.daySep&&(c=c.replace(/\//g,d.date.daySep)),r(b,c)},v=function(a){if(!a)return"";var b=o(a);if(!b)return"";var c=d.date.dateLong;return"/"!=d.date.daySep&&(c=c.replace(/\//g,d.date.daySep)),r(b,c)},w=function(a){if(!a)return"";var b=o(a);if(!b)return"";var c=d.date.monthYear;return"/"!=d.date.daySep&&(c=c.replace(/\//g,d.date.daySep)),r(b,c)},x=function(a){return parseFloat(a.toFixed(d.number.decimal))},y=function(a,b){return a=a||0,b?n(a,d.number.places,d.number.thousand,d.number.decimal,d.number.symbol,d.number.format):m(a,d.number.places,d.number.thousand,d.number.decimal)},z=function(a,b,c){if(null===a)return"";a=a||0;var e=c?"%v %s":"%v";return n(a,b,d.number.thousand,d.number.decimal,c,e)},A=function(a,b){if(!a||!b)return b;var c=[];if(Object.keys(a).forEach(function(b){var d=a[b];"date"!=d.type&&"money"!=d.type&&"decimal"!=d.type&&"number"!=d.type||c.push({name:b,type:d.type,symbol:d.symbol,longdate:d.longdate,decimals:d.decimals,useSymbol:void 0===d.useSymbol||d.useSymbol})}),!c.length)return b;var d=Array.isArray(b)?b:[b];return d.forEach(function(a){c.forEach(function(b){switch(b.type){case"date":a[b.name]=u(a[b.name]);break;case"money":a[b.name]=y(a[b.name],b.useSymbol);break;case"integer":a[b.name]=z(a[b.name],0,b.symbol);break;case"decimal":case"number":a[b.name]=z(a[b.name],b.decimals,b.symbol)}})}),b},B=function(a){var b=a||"",c=b.indexOf("T");return c>0&&(b=b.substr(0,c)),b},C=function(b){var c=b.replace(new RegExp(a.locale.number.thousand,"g"),"");"."!=a.locale.number.decimal&&(c=c.replace(new RegExp(a.locale.number.decimal,"g"),"."));var d=parseFloat(c);return isNaN(d)&&(d=0),d};b.register=g,b.translate=h,b.tt=i,b.currentLang="en",b.defCountry="US",b.lang="fr",//(navigator.language || navigator.userLanguage || currentLang).split('-')[0];
b.country="FR",b.money=y,b.truncMoney=x,b.decimal=z,b.format=A,b.parseISODate=o,b.parseISODateAsUTC=p,b.isoDatePart=B,b.shortDate=u,b.longDate=v,b.monthYear=w,b.localeDate2ISO=t,b.date2ISO=s,b.string2Float=C,b.localeTitle=function(a){return"object"==typeof a?a[b.currentLang]:a},b.loadLocale=c,j.indexOf(b.lang)<0&&(b.lang=b.currentLang),c(b.lang)}(b=a.ulocale||(a.ulocale={}));var c;!function(a){var c=function(a){a&&a.filter&&(a.filter("money",[function(){return function(a,c){var d=null===a?null:a?parseFloat(a):0;return b.money(d,c)}}]),a.filter("decimal",[function(){return function(a,c,d){var e=null===a?null:a?parseFloat(a):0;return b.decimal(e,c||0,d)}}]),a.filter("shortdate",[function(){return function(a){return b.shortDate(a)}}]),a.filter("longdate",[function(){return function(a){return b.longDate(a)}}]),a.filter("monthyear",[function(){return function(a){return b.monthYear(a)}}]))};a.registerFilters=c}(c=a.angularjs||(a.angularjs={}))}(Phoenix||(Phoenix={}));
/// <reference path="../modules/ulocale.ts" />
var Phoenix;!function(a){var b={layouts:{design:{Save:"Save",New:"New page",Open:{title:"Open page",open:"Open",close:"Close"},PageName:"Page Name",InvalidPageName:"Invalid page name",ConflictedPageName:"A page of that name exists, do you want to give another name ?",Delete:"Delete page",ConfirmDelete:"Are you sure you want to delete this page ?",Preview:"Preview",AuthoringMode:"Authoring",layouts:"Blocks",widgets:"Widgets",fields:"Fields",actions:"Actions"},NoData:"No data"},schema:{required:"{0} is required.",minNumber:"{0} must be at least {1}",maxNumber:"{0} cannot exceed {1}",minNumberExclusive:"{0} must be greater than {1}",maxNumberExclusive:"{0} must be less than {1}",uniqueColumn:"The column '{0}' must be unique.",uniqueColumns:"Duplicate value for columns '{0}' found.",passwordMismatch:"Password mismatch.",invalidEmail:"Invalid Email Address",minLength:"{0} must be at least {1} characters"},ui:{Close:"Close",Ok:"Ok",Yes:"Yes",No:"No",Warning:"Warning",Info:"Information",Disconnect:"Disconnect",Confirm:"Confirm",Validate:"Validate",password:{oldPassword:"Old Password",newPassword:"New Password",change:"Change password"},ApplyDetailChanges:"Apply",Selected:"Sel."},errors:{Title:"Oops! An unknown error has occurred.",SendMail:"Send",MailSubject:"Error in JS client",ErrorTitle:"Error:",ErrorUser:"User:",ErrorDate:"Date and time:",Browser:"Browser:",ErrorURI:"Address:",Stack:"Call stack:",Context:"Context:",error500:"Internal server error",unknownError:"An unknown error has occurred.",notAuthorized:"Forbidden"},listView:{search:{Search:"Search",Nodata:"Aucun résultat trouvé ..."}},pagination:{Next:"»",Previous:"«",First:"First",Last:"Last"},number:{decimal:".",thousand:" ",places:2,symbol:"$",format:"%s %v"},charts:{numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",rangeSelectorZoom:"Zoom",rangeSelectorFrom:"From",rangeSelectorTo:"To"},date:{weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateShort:"mm/dd/yyyy",dateLong:"d mmmm, yyyy",monthYear:"mmmm yyyy",daySep:"-",weekStart:0,today:"Today",clear:"Clear"}};a.ulocale.translate(b,"en")}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
var Phoenix;!function(a){var b;!function(b){var c={"times-circle":"remove-sign","times-circle-o":"remove-circle",times:"remove","chevron-left":"chevron-left","chevron-right":"chevron-right",backward:"backward",forward:"forward","file-o":"file",floppy:"floppy-save","power-off":"off",user:"user",pencil:"pencil",trash:"trash","check-square-o":"check","square-o":"unchecked","plus-circle":"plus-sign","minus-circle":"minus-sign",plus:"plus",minus:"minus",search:"search","chevron-down":"menu-down","ellipsis-v":"option-vertical",bars:"menu-hamburger","thumb-tack":"pushpin",calendar:"calendar","exclamation-circle":"exclamation-sign",cloud:"cloud","caret-up":"triangle-top","caret-down":"triangle-bottom",cog:"cog",lock:"lock","question-circle":"question-sign","info-circle":"info-sign"},d=function(a,b){if(a){var c=a.split(" ");c.forEach(function(a,c){a=a.trim(),a&&"$"===a.charAt(0)&&(a="bs-style-"+a.substring(1)),b.push(a)})}},e=function(a){a&&a.select()},f=function(a,b,c){var d=(a||"").split(" "),e=d.indexOf(c);return b?e<0&&d.push(c):e>=0&&d.splice(e,1),d.join(" ")},g=function(b,d){void 0===d&&(d=!1);var e=c[b]?c[b]:b;return d?(a.bootstrap4?"fa-":"glyphicon-")+e:(a.bootstrap4?"fa fa-":"glyphicon glyphicon-")+e},h=function(){return a.bootstrap4?"fa":"glyphicon"},i=function(a){var b=document.createElement("span");return b.className=g(a,!1),b},j=function(a,b){return a?a.querySelectorAll(b):document.querySelectorAll(b)},k=function(a,b){return a?a.id==b?a:a.querySelector("#"+b):document.getElementById(b)},l=function(a,b){return a?a.querySelector(b):null},m=function(a,b){a.classList?a.classList.add(b):a.className=f(a.className,!0,b)},n=function(a,b){a.classList?a.classList.remove(b):a.className=f(a.className,!1,b)},o=function(a,b){return a.classList?a.classList.contains(b):(a.className||"").split(" ").indexOf(b)>=0},p=function(a){a.parentNode.removeChild(a)},q=function(a){return a.parentNode.removeChild(a),a},r=function(a){for(var b=a.childNodes.length-1;b>=0;b--)a.removeChild(a.childNodes[b])},s=function(a,b){a.appendChild(b)},t=function(a,b){a.parentNode.insertBefore(b,a)},u=function(){return{left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}},v=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},w=function(a){var b=document.documentElement.clientTop||document.body.clientTop||0,c=document.documentElement.clientLeft||document.body.clientLeft||0,d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,e=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;return a.top=Math.round(a.top+d-b),a.left=Math.round(a.left+e-c),a},x=function(a,b){if(b){var c=b.getBoundingClientRect(),d=a.getBoundingClientRect();return{left:Math.round(d.left-c.left),top:Math.round(d.top-c.top)}}var d=a.getBoundingClientRect();return w({left:d.left,top:d.top})},y=function(a,b,c,d,e){var f=new Array(b.length+1),g=e.firstDelta||0,h=e.lastDelta||0,i=e.delta||0,j=e.height||0,l=e.top||0;b.forEach(function(b,e){var h=k(a,b.htmlId),j=x(h,null);f[e]={info:b.info,zone:d,position:"before",vertical:c,point:{x:0,y:0},left:j.left+(c?0:0===e?g:i),top:l||j.top,width:Math.round(h.offsetWidth),height:Math.round(h.offsetHeight),htmlId:b.htmlId}});var m=null;if(f.forEach(function(a){var b=a.point;b.y=a.top+(a.height>>1),b.x=a.left+(a.width>>1),m=a}),m){var n=h-(0===f.length?g:i);m={position:"after",zone:d,info:m.info,vertical:m.vertical,point:{x:0,y:0},left:m.left+(c?0:n)+(c?0:m.width),top:m.top+(c?m.height:0),width:m.vertical?m.width:0,height:j||(m.vertical?0:m.height),htmlId:m.htmlId}}else{var o=x(a,null);m={info:{},position:"empty",zone:d,vertical:c,point:{x:0,y:0},left:o.left+(c?0:h),top:l||o.top,width:Math.round(a.offsetWidth),height:j||Math.round(a.offsetHeight),html:a.id}}return m.point.y=m.top+(m.height>>1),m.point.x=m.left+(m.width>>1),f[b.length]=m,f},z=function(a,b,c){var d,e,f=1e6;return c.forEach(function(c){var g,h=Math.abs(c.point.y-b);h<f?(f=h,e=Math.abs(c.point.x-a),d=c):h==f&&(g=Math.abs(c.point.x-a),g<e&&(e=g,d=c))}),d},A=function(a,b){if(void 0===b)return a.textContent;if(a.childNodes.length){for(var c=!1,d=0,e=a.childNodes.length;d<e;d++){var f=a.childNodes[d];if(3==f.nodeType){f.nodeValue=b,c=!0;break}}c||s(a,document.createTextNode(b))}else a.textContent=b},B=function(a,b,c,d){if(d=d||"bs-drag-color-info",a)if(a.vertical!==b)p(a),a=null;else{var e=a.firstChild.firstChild;o(e,d)||(p(a),a=null)}if(!a){var f=['<div class="bs-absolute">'];f.push('<div class="bs-absolute" style="left: 0px; top: 0px"><span class="'),b?f.push(g("arrow-left")):f.push(g("arrow-down")),d&&f.push(" "+d),f.push('"></span></div>');var h=[];f.push('<div class="bs-absolute" style="'),b?(h.push("right: 0px;"),h.push("bottom: 0px;"),f.push(h.join("")),f.push('"><span class="'),f.push(g("arrow-right"))):(h.push("left: 0px;"),h.push("bottom: 0px;"),f.push(h.join("")),f.push('"><span class="'),f.push(g("arrow-up"))),d&&f.push(" "+d),f.push('"></span></div>'),f.push("</div>"),a=$(f.join("")).get(0),a.vertical=b,s(document.body,a)}var i=a.style,j=a.firstElementChild,k=a.lastElementChild,l=Math.round(j.offsetWidth),m=Math.round(k.offsetHeight);return b?(i.height=m+"px",i.width=c.width+2*l+"px",i.left=c.left-l+"px",i.top=c.top-(m>>2)-4+"px"):(i.height=c.height+2*m+"px",i.top=c.top-m+"px",i.left=c.left-(l>>2)+"px"),i.zIndex="5002",a},C=function(a,b,c){for(var d=a;d;){if(!d.getAttribute)return null;var e=d.getAttribute(c);if(e)return d;d=d==b?null:d.parentNode}return null},D=function(a){var b=document.body.firstElementChild;b&&o(b,"bs-content")||(b=document.body);for(var c=b.className||"",d=a?"bs-body-theme-"+a:"",e=c.split(" "),f=!1,g=e.length;g--;){var h=e[g];if(0==h.indexOf("bs-body-theme-")){if(h==d)return!1;f=!0,e.splice(g,1)}}d&&(f=!0,e.push(d)),f&&(b.className=e.join(" "))},E=function(a,b){var c=a.parentNode;a=a.nextSibling,a?c.insertBefore(b,a):c.appendChild(b)},F=function(a){return null!=a&&a===a.window?a:9===a.nodeType&&a.defaultView},G=function(a){var b;if(3!=a.nodeType&&(b=a.getBoundingClientRect(),b.width||b.height)){var c=a.ownerDocument,d=F(c),e=c.documentElement;return{top:b.top+d.pageYOffset-e.clientTop,left:b.left+d.pageXOffset-e.clientLeft,width:b.width,height:b.height,bottom:0,right:0}}return b||{top:0,left:0,width:0,height:0,bottom:0,right:0}},H=function(a,b,c){for(c=c.toUpperCase();b;){if(b.tagName===c)return b;if(b=b.parentNode,b==a)break}return null},I=function(a,b,c){for(;b;){if(o(b,c))return b;if(b=b.parentNode,b==a)break}return null},J=function(a,b){for(var c=0,d=a.childNodes.length;c<d;c++)if(a.childNodes[c]==b)return c;return-1},K=function(a,b){for(;b;){if(b===a)return!0;b=b.parentNode}return!1},L=function(a,b,c){return void 0===c&&(c=void 0),void 0===c?a.getAttribute(b):void a.setAttribute(b,c)},M=function(){var a=!1,b=0;return function(){if(a)return b;var c,d=document.createElement("div");return d.style.cssText="overflow:scroll; overflow-x:hidden; zoom:1; clear:both",d.innerHTML="&nbsp;",document.body.appendChild(d),c=d.offsetWidth-d.scrollWidth,document.body.removeChild(d),a=!0,b=c,c}},N=null,O=0,P=function(){return null!=N},Q=function(a){a?(O++,N||(O=1,N=$('<div class="bs-cover"></div>').get(0),N.style.height=$(document).height()-1+"px",s(document.body,N))):(O--,O<=0&&(O=0),N&&0===O&&(p(N),N=null))},R=function(){var a=!1,b=!1;return function(){return a?b:(b="ontouchend"in document,a=!0,b)}},S=function(){$(window).trigger("global-phoenix-resize")},T=null,U=function(){$(window).on("resize.phoenix",function(){T&&clearTimeout(T),T=setTimeout(S,50)})};b.readyHandlers=[U],b.keys={VK_TAB:9,VK_UP:38,VK_DOWN:40,VK_INSERT:45,VK_DELETE:46,VK_LEFT:37,VK_RIGHT:39,VK_ENTER:13,VK_ESCAPE:27,VK_F1:112,VK_HOME:36,VK_END:35,VK_PGUP:33,VK_PGDOWN:34,VK_SPACE:32,VK_F2:113,VK_F3:114,VK_F4:115,VK_BACKSPACE:8,VK_F10:121},b.queryAll=j,b.find=k,b.query=l,b.addClass=m,b.removeClass=n,b.hasClass=o,b.icon=i,b.iconClass=g,b.iconPrefix=h,b.bodyTheme=D,b.offset=G,b.before=t,b.after=E,b.parentByTag=H,b.parentByClass=I,b.indexOf=J,b.append=s,b.select=e,b.empty=r,b.remove=p,b.detach=q,b.attr=L,b.text=A,b.findByAttribute=C,b.isChildOf=K,b.parseStyle=d,b.ignoreKeys=[0,b.keys.VK_UP,b.keys.VK_DOWN,b.keys.VK_HOME,b.keys.VK_END,b.keys.VK_PGUP,b.keys.VK_PGDOWN,b.keys.VK_ENTER,b.keys.VK_ESCAPE,b.keys.VK_DELETE,b.keys.VK_BACKSPACE,b.keys.VK_INSERT],b.processing=Q,b.inProcessing=P,b.scrollbar=M(),b.documentScroll=u,b.documentClientDim=v,b.touch=R(),b.position=x,b.childrenPositions=y,b.findNearest=z,b.showMove=B}(b=a.dom||(a.dom={})),$(document).ready(function(){b.readyHandlers.length&&b.readyHandlers.forEach(function(a){a()})})}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
/// <reference path="./utils.ts" />
/// <reference path="./dom.ts" />
/// <reference path="./globals.ts" />
/// <reference path="./authentication.ts" />
var Phoenix;!function(a){var b,c=a.utils,d=a.dom,e=a.device,f=a.authentication;!function(b){var g=function(a){if(!a)return"";var b=[];return Object.keys(a).forEach(function(c){null!==a[c]&&b.push(c+"="+encodeURIComponent(a[c]||""))}),b.length>0?"?"+b.join("&"):""},h=function(a){var b={},c=a,d=a.indexOf("?");if(d>=0){var e=a.substring(d+1);if(c=a.substring(0,d),e){var f=e.split("&");f.forEach(function(a){if(a){var c=a.split("=");b[c[0]]=decodeURIComponent(c[1])}})}}return{path:c,search:b}},i=function(b,c){if(null==b)return h(window.location.href).search;var d=g(b);if(window.location.hash){var e=window.location.hash,f=e.indexOf("?");if(f>0&&(e=e.substring(0,f),e+=d),c)a.history.replaceHash(e);else if(window.location.hash!=e&&window.history)try{window.history.replaceState(void 0,void 0,e)}catch(i){window.location.hash=e}}else window.location.search!=d&&(window.location.search=d)},j=function(a){var b=a.$page;return e.phone&&a.$pageMobile?b=a.$pageMobile:e.tablet&&a.$pageTablet&&(b=a.$pageTablet),b},k=function(){var b=null;try{b=JSON.parse(f.db().getItem("authentication"))}catch(c){}return{$url:i(null,!1),$mem:a.$mem,$user:{name:b?b.name||b.nom||b.login:"",firstName:b?b.firstName||b.prenom||b.login:"",lastName:b?b.lastName||b.nom||"":""},$item:null}},l=function(a,b,d){if(a.$page){var e=j(a),f="#/"+e,g=[];if(b&&a.$search&&a.$search.length){var h=k();Object.keys(b).forEach(function(a){h[a]=b[a]}),a.$search.forEach(function(a){a&&a.left&&g.push(a.left+"="+encodeURIComponent(c.parseVariable(a.right,h)))})}return d&&Object.keys(d).forEach(function(a){g.push(a+"="+encodeURIComponent(d[a]))}),g.length&&(f=f+"?"+g.join("&")),f}return"#"},m={},n=function(a){var b=a.indexOf("://");if(b>0){var c=m[a.substring(0,b)];if(c)return c.protocol}return null},o=function(a,b,c,d){var e=m[a.protocol];e&&e.handler&&e.handler(a.value,b,c,d)},p=function(a,b){m[a]={protocol:a,handler:b}},q=function(a,b,c){for(var e=b.target;e&&e!=a;){var f=d.attr(e,"data-phoenix-href")||d.attr(e,"href");if(f){if("#"===f){c||(b.preventDefault(),b.stopPropagation());break}var g=n(f);if(g)return c||(b.preventDefault(),b.stopPropagation()),{protocol:g,value:f}}e=e.parentNode}return null},r=function(a,b,c,d){var e,f=location.pathname,g=f.split("/"),h="";g[g.length-1].indexOf(".html")>0&&(h=g.pop());var i=g.pop();h||""!=i||g.pop(),g.push(b),h&&g.push(h),e=g.join("/"),a&&"#"===(""+a).charAt(0)||(a="#"+a),e+=a,d?location.replace(e):location.href=e},s=function(b,c){b&&"#"===(""+b).charAt(0)||(b="#"+b),window.location.hash!=b&&(a.external.hashHandler?a.external.hashHandler(b,c):(a.history.removeLast(),c&&"replaceState"in window.history?window.history.replaceState(void 0,void 0,b):location.hash=b))},t=function(a){if(a.name&&a.schema){var b="/authoring/forms/"+a.name,c=[];a.schema!==a.name&&c.push("prototype="+encodeURIComponent(a.schema)),a.locale&&c.push("locale="+encodeURIComponent(a.locale)),a.path&&c.push("path="+encodeURIComponent(a.path));var d=window.location.href.lastIndexOf("?");d>0&&c.push(window.location.href.substr(d+1)),c.length&&(b=b+"?"+c.join("&")),window.location.hash="#"+b}},u=function(a,b){var c="/authoring",d="/authoring/forms/",e=window.location.hash;"#"==e.charAt(0)&&(e=e.substring(1)),b||0!==e.indexOf(c)?window.location.hash="#"+c+(a?"/"+a:e):0===e.indexOf(d)?window.history.back():window.location.hash="#"+e.substring(c.length)},v=function(b,c,d){var e=a.application,f=e.configuration&&e.configuration.application?e.configuration.application.modules:null;if(b.$page){var g=b.$module?b.$module:e.name;if(f&&f[g]&&e.licences){var h=e.licences[f[g]];if(h&&!h.hasLicence&&a.external.forbiddenHandler)return a.external.forbiddenHandler()}var i=l(b,c,d);if(b.$module&&b.$module!=e.name)return r(i,b.$module,e.name,b.$replace);s(i,b.$replace),b.$authoring&&u()}else if(b.$logout)a.external.logoutHandler&&a.external.logoutHandler();else if(b.$formAuthoring)t(b);else if(b.$authoring)u();else if(b.$back)window.history.back();else if(b.href){var j=document.createElement("a");j.href=b.href,b.target&&(j.target=b.target),document.body.appendChild(j),j.click(),document.body.removeChild(j)}};b.search=i,b.object2search=g,b.parseUrl=h,b.hashLink=l,b.pageName=j,b.isCustomLink=q,b.registerCustomProtocol=p,b.execCustomProtocol=o,b.isCustomProtocol=n,b.doAuthoring=u,b.doFormAuthoring=t,b.setHash=s,b.execLink=v,b.context=k}(b=a.link||(a.link={}))}(Phoenix||(Phoenix={}));
/// <reference path="./core.ts" />
/// <reference path="./modules/utils.ts" />
/// <reference path="./modules/links.ts" />
/// <reference path="./modules/globals.ts" />
var Phoenix;!function(a){var b=a.link,c=a.$mem,d=a.utils;b.registerCustomProtocol("page",function(a,d,e,f){d.$url||(d.$url=b.search(null,!1)),d.$mem||(d.$mem=c);var g=a.indexOf("://");if(!(g<=0)){var h,i=a.substring(g+3),j=b.parseUrl(i),k=j.path.split("/");j.search.$replace&&(h=!0,delete j.search.$replace);var l={$page:k[0],$search:[],$replace:h,$menu:null};k.length>1&&(l.$menu=k[1]),Object.keys(j.search).forEach(function(a){l.$search.push({left:a,right:j.search[a]})}),b.execLink(l,d,null)}}),b.registerCustomProtocol("link",function(a,c,e,f){var g=a.substring("link://".length),h=g.indexOf("/");if(h<=0&&(h=g.indexOf("?")),h>0){var i=b.parseUrl(g.substring(h));g=g.substring(0,h),i.search&&(f?d.extend(f,i.search):f=i.search)}e.links&&e.links[g]&&b.execLink(e.links[g],c,f)}),b.registerCustomProtocol("click",null)}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/ajax.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../core/modules/ulocale.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.application,d=a.ulocale,e={get:function(b,e,f){e&&d.lang&&(b=b+"_"+d.lang);var g=c.config(f);if(!g)throw"Application configuration not found.";return a.ajax.get(g.menus+"/"+b+".json",{cache:!0},null)}};b.menu=e}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/ajax.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.application,d=a.ulocale,e={get:function(b,e,f){e&&d.lang&&(b=b+"_"+a.ulocale.lang);var g=c.config(f);if(!g)throw"Application configuration not found.";return a.ajax.get(g.locales+"/"+b+".json",{cache:!0},function(a){return a&&(a.$name=b),a.$view&&(a.$view.$name=b),a})}};b.schema=e}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/ajax.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.application,d=a.ajax,e=a.utils,f=function(a){return a},g={getRessources:function(b,g){var h=function(a){return g&&(a=g(a)),a},i=b.$url,j=c.config(c.name)||{};j.rest=j.rest||{};var k=j.rest.base||"";i&&"/"===i.charAt(0)&&(k=""),k&&(i=k+"/"+i);var l={};void 0===b.$module&&j.rest.$module&&(b.$module=j.rest.$module),b.$module?l.$module=b.$module:i=i.replace("{$module}/",""),j.rest.$context?l.$context=j.rest.$context:i=i.replace("{$context}/",""),i=e.formatNames(i,l);var m=d.getDefaultAjaxOptions(),n=b.$query;b.$list;switch(i+=a.link.object2search(n),i=f(i),b.$method){case"POST":return d.post(i,b.$data,m);case"PUT":return d.put(i,b.$data,m);case"PATCH":return d.patch(i,b.$data,m);case"DELETE":return d.remove(i,m);default:return d.get(i,m,function(a){return h(a)})}}};b.rest=g}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/ajax.ts" />
/// <reference path="../core/modules/links.ts" />
/// <reference path="../core/modules/application.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.application,d=a.link,e={getRessources:function(b,e){var f=function(a){return e&&(a=e(a)),a},g=c.config(c.name);if(!g)throw"Application configuration not found.";var h=g.localData+"/"+b.$url,i=b.$query;return h+=d.object2search(i),a.ajax.get(h,{},function(a){return f(a)})}};b.local=e}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/ajax.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../core/modules/authentication.ts" />
/// <reference path="../core/modules/utils.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.application,d=a.authentication,e=a.utils,f=a.ajax,g={},h=function(a){return a},i={v4:!0,transport:{doPost:f.post,doPut:f.put,doDelete:f.remove,doGet:function(a,b,c,d){return f.get(a,b,c)},doPatch:f.patch},afterLogout:function(){
//clear cache
g={}},urlResEntity:function(a,b){var d=c.config(c.name)||{};d.odata=d.odata||{};var f=d.odata.base||"/data",g={};if(void 0===a.$module&&d.odata.$module&&(a.$module=d.odata.$module),a.$module?g.$module=a.$module:f=f.replace("{$module}/",""),d.odata.$context?g.$context=d.odata.$context:f=f.replace("{$context}/",""),f=e.formatNames(f,g),!a.$entity)throw"Invalid odata entity.";if(b&&!a.$entityId)throw"Invalid odata entity id.";var h=f+"/"+a.$entity;return a.$entityId&&(h=h+"("+a.$entityId+")"),a.$propertyName&&(h=h+"/"+a.$propertyName),h},doDelete:function(a,b){var c=i.urlResEntity(a,!0),d=f.getDefaultAjaxOptions();return b&&(d.headers["If-Match"]=b),d.ignore={410:!0},c=h(c),i.transport.doDelete(c,d)},doPost:function(a,b){var c=f.getDefaultAjaxOptions(),d=i.urlResEntity(a,!1);return d=h(d),i.transport.doPost(d,b,c)},doPut:function(a,b,c,d){var e=i.urlResEntity(a,!0),g=f.getDefaultAjaxOptions();return g.headers=g.headers||{},c&&(g.headers["If-Match"]=c),d&&(g.headers.Prefer="return=representation"),e=h(e),i.transport.doPut(e,b,g)},doPatch:function(a,b,c,d){var e=i.urlResEntity(a,!0),g=f.getDefaultAjaxOptions();return g.headers=g.headers||{},c&&(g.headers["If-Match"]=c),d&&(g.headers.Prefer="return=representation"),e=h(e),i.transport.doPatch(e,b,g)},getRessources:function(d,j,k){var l=function(a){return j&&(a=j(a)),a},m=!1,n=d.$cache;delete d.$cache;var o=c.config(c.name)||{};o.odata=o.odata||{},void 0!=o.odata.v4&&(i.v4=o.odata.v4);var p=o.odata?o.odata.base||"/data":"/data",q={};void 0===d.$module&&o.odata.$module&&(d.$module=o.odata.$module),d.$module?q.$module=d.$module:p=p.replace("{$module}/",""),o.odata.$context?q.$context=o.odata.$context:p=p.replace("{$context}/",""),p=e.formatNames(p,q),delete d.$module;var r=d.$entity;d.$entityId&&(r=r+"("+d.$entityId+")",delete d.$entityId,m=!0),d.$propertyName&&(r=r+"/"+d.$propertyName,delete d.$propertyName);var s=r;delete d.$entity,m||(i.v4?(d.$top&&!d.nocount&&(d.$count=!0),delete d.nocount):d.$inlinecount="allpages");var t=!1;d.$aggregation&&"$count"==d.$aggregation&&(s=s+"/"+d.$aggregation,delete d.$aggregation,t=!0);var u=f.getDefaultAjaxOptions();return u.$errors=k,s=p+"/"+s+a.link.object2search(d),n&&g[r]&&g[r].uri==s?new e.Promise(function(a,b){var c=l(t||m?g[r].data:$.extend(!0,{},g[r].data));a(c)}):(s=h(s),b.odata.transport.doGet(s,u,function(a){var b={};return i.v4&&a&&delete a["@odata.context"],t||m?b=a:(b.documents=i.v4?a.value:a.d.results,b.dataCount=b.documents?b.documents.length:0,b.documents.forEach(function(a){delete a.__metadata}),b&&(b.pageSize=d.$top,b.skip=d.$skip||0,b.count=i.v4?a["@odata.count"]:a.d.__count,b.nodata=0==b.dataCount)),n&&(g[r]={uri:s,data:t?b:$.extend(!0,{},b)}),l(b)},{entity:r,params:d}))}};b.odata=i,d.registerAfterLogout(i.afterLogout)}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/links.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/customdata.ts" />
/// <reference path="./schema-provider.ts" />
/// <reference path="./rest-provider.ts" />
/// <reference path="./local-provider.ts" />
/// <reference path="./menu-provider.ts" />
/// <reference path="./odata-provider.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.link,d=a.utils,e=a.customData,f=a.application,g=function(a,b){if(a.$transform){var c=e.get("datasets.transform."+a.$transform);c&&(b=c(b))}return b},h=function(a,b){if(!a)return b;var c=e.get("datasets.transform."+a);return c?c($.extend(!0,{},b)):b},i=function(){var a={};return{register:function(b,c){a[b]=c},get:function(b){return a[b]}}},j=i(),k=function(a){return a=a||{},a.$type=a.$type||"basic",a.$triggers=a.$triggers||["$load"],a},l=function(a,b,c,d){if(null==a&&b)switch(b){case"number":a=void 0;break;case"integer":a=void 0;break;case"boolean":a=void 0;break;case"string":a="";break;default:a=null}if(Array.isArray(a))return d?a:JSON.stringify(a);if(c&&b&&("string"==b||"date"==b||"datetime"==b)){if(null==a)return null;"date"==b||"datetime"==b||(a="'"+a.replace(/'/g,"''")+"'")}return a},m=function(a,b){var c=b.indexOf("[");if(c<0)return null;if(a=0==c?a:a[b.substr(0,c)],!a)return null;var d=b.substr(c+1,b.length-c-2);if("*"==d||""==d)return a;var e=parseInt(d,10);return e<a.length?a[e]:null},n=function(a,b,c,d){var e,f=a,g=["$url","$context","$data","$item","$mem","$local"],h=typeof f;if("object"===h&&f&&(e=a.type,f=a.value,h=typeof f),"string"===h&&f&&"$"==f.charAt(0)){for(var i=f.split("."),j=0,k=null;j<i.length;){var n=i[j];if(0==j){var o,p=n,q=n.indexOf("[");q>0&&(o=n.substr(q),p=n.substr(0,q));var r=g.indexOf(p);if(!(r>=0))return l(f,e,c,d);k=b[g[r]],o&&i.splice(j+1,0,o)}else{if(!k)break;k="]"==n.charAt(n.length-1)?m(k,n):Array.isArray(k)?k.map(function(a){return a[n]}):k[n]}j++}return l(k,e,c,d)}return l(f,e,c,d)},o=function(a,b,c){for(var d=c.length;d--;)if(a[c[d]]!=b[c[d]])return!1;return!0},p=function(a,b){if(!a)return null;if("string"==typeof a)return n(a,b,!1,!0);var c={};return Object.keys(a).forEach(function(d){c[d]=n(a[d],b,!1,!0)}),c},q=function(b,c,d,e){return p(b,{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e})},r=function(b,c,d,e,f){if(b&&"object"==typeof b&&b.$op){var g={$op:b.$op,$nulls:b.$nulls,$left:null,$right:null};return null!=b.$left&&("object"!=typeof b.$left||!b.$left.$op&&null!==b.$left.$op?g.$left=n(b.$left,{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e},!1,!1):g.$left=r(b.$left,c,d,e,f)),null!=b.$right&&("object"!=typeof b.$right||!b.$right.$op&&null!==b.$right.$op?g.$right=n(b.$right,{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e},f,!1):g.$right=r(b.$right,c,d,e,f)),g}if(b&&"object"==typeof b&&null===b.$op&&null===b.$right&&b.$left){var g={$left:null,$op:null,$right:null};return null!=b.$left&&("object"==typeof b.$left&&b.$left.$op?g.$left=r(b.$left,c,d,e,f):g.$left=n(b.$left,{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e},!1,!1)),g}return n(b,{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e},f,!1)},s=function(b,c,d,e){return b&&"string"==typeof b&&(b=n(b,{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e},!1,!1)),r(b,c,d,e,!0)},t=function(a,b,c,d){return r(a,b,c,d,!1)},u=function(a,b){return"eq"===a.$op&&b[a.$left]==a.$right},v=function(a){if(a&&"object"==typeof a&&a.$op){var b=v(a.$left),c=v(a.$right);
//unary operators
if("not"===a.$op)return{value:"not ("+c.value+")",op:a.$op};if("in"===a.$op){var d=c.value.split(";"),e=[];return d.forEach(function(a){e.push(b.value+" eq "+a)}),{value:"("+e.join(" or ")+")",op:"in"}}if("$func"===a.$op)return{value:b.value+"("+c.value+")",op:a.$op};if("ignore"!==a.$nulls||null!=b.value&&null!=c.value){var f=b.value,g=c.value;return"and"===a.$op&&("or"===b.op&&(f="("+f+")"),"or"===c.op&&(g="("+g+")")),{value:f+" "+a.$op+" "+g,op:a.$op}}return"and"===a.$op||"or"===a.$op?null==c.value?{value:b.value,op:b.op}:{value:c.value,op:c.op}:{value:null,op:null}}if(a&&"object"==typeof a&&null===a.$op&&null===a.$right&&a.$left){var h=v(a.$left);return{value:h.value,op:null}}return{value:a,op:null}},w=function(a,b,c,d){var e=s(a,b,c,d);return v(e).value},x=function(b,c,d,e){var f={$url:null,$list:null,$query:null,$method:"GET"};return f.$method=(b.$method||"GET").toUpperCase(),f.$url=b.$url,f.$list=b.$list,b.$query&&(f.$query={},Object.keys(b.$query).forEach(function(g){f.$query[g]=n(b.$query[g],{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e},!1,!1)})),"GET"!=b.$method&&"DELETE"!=b.$method&&(b.$data?f.$data=n(b.$data,{$url:c,$context:d,$data:null,$mem:a.$mem,$local:e},!1,!1):f.$data=d||{}),f},y=function(a){return void 0===a||null===a||""===a},z=function(b,c,d,e){if(!b)return null;var f={},g={$url:c,$context:d,$data:null,$mem:a.$mem,$local:e};if(Object.keys(b).forEach(function(a){if("$search"!==a)if("$entity"===a)f.$entity=n(b.$entity,g,!1,!1);else if("$entityId"===a){var h=!1,i=typeof b.$entityId;if("object"===i)if(b.$entityId.value&&b.$entityId.type){var j=n(b.$entityId,g,!1,!1);h=y(j),f[a]=j}else{var k=[];Object.keys(b.$entityId).forEach(function(a){var c=n(b.$entityId[a],g,!1,!1);h||(h=y(c)),k.push(a+"="+c)}),f[a]=k.join(", ")}else{var l=n(b[a],g,!1,!1);h=y(l),f[a]=l}h&&(f.$entityIdNull=!0)}else"$aggregation"==a&&b.$aggregation?f.$aggregation=b.$aggregation:"$groupby"==a&&b.$groupby?f.$groupby=b.$groupby:"$filter"==a&&b.$filter?(f.$filter=w(b.$filter,c,d,e),f.$filter||delete f.$filter):b[a]&&(f[a]=n(b[a],g,!1,!1))}),b.$search&&d&&d.$searchText){var h,i=l(d.$searchText,"string",!0,!1),j=Array.isArray(b.$search)?b.$search:[b.$search];if(1==j.length)h=a.utils.format("contains({0},{1})",b.$search.field,i);else{for(var k=["("],m=j.length,o=0;o<m;o++)k.push(a.utils.format("contains({0},{1})",j[o].field,i)),o<m-1&&k.push(" or ");k.push(")"),h=k.join("")}f.$filter?f.$filter=f.$filter+" and "+h:f.$filter=h}return f},A=function(a){a=a||"";var b=c.context();return n(a,b,!1,!1)},B=function(b,c,d,e){var f,h=e&&e.getLocalContext?e.getLocalContext():null,i=q(b.$data,c,d,h);if(b.$params&&b.$params.dataProvider){var j=a.customData.get(b.$params.dataProvider);j&&(d=j(d,e))}return b.$output?(i=q(b.$data,c,d,h),f=p(b.$output,{$url:c,$context:d,$data:i,$mem:a.$mem,$local:h})):f=d,f=g(b,f),new a.utils.Promise(function(a,b){a(f)})},C=function(a,c,d,e){var f=a.$params.name;return b.schema.get(f,a.$params.localization,void 0)},D=function(a,c,d,e){var f=a.$params.name;return b.menu.get(f,a.$params.localization,void 0)},E=function(c,e,i,j){var k=c.$method||"GET",l=j&&j.getLocalContext?j.getLocalContext():null,m=h(c.$beforeExecute,c.$params),o=z(m,e,i,l);if(k&&(k=n(k,i,!1,!1),k=k.toUpperCase()),o.$entityIdNull&&(delete o.$entityIdNull,"GET"===k&&c.$create)){var r=$.extend(!0,{},c.$create);return r.$create=!0,d.Promise.resolve(r)}if(k)switch(k){case"DELETE":return b.odata.doDelete(o,i.etag?i.etag:null);case"POST":return b.odata.doPost(o,i);case"PUT":var s=i["@odata.etag"];delete i["@odata.etag"];var t=null!=i["@odata.return"];return delete i["@odata.return"],b.odata.doPut(o,i,s,t);case"PATCH":var u=i["@odata.etag"];delete i["@odata.etag"];var v=null!=i["@odata.return"];return delete i["@odata.return"],b.odata.doPatch(o,i,u,v)}var w=q(c.$data,e,i,l),x=!0;o.$aggregation&&(x=!1);var y=f.config(f.name)||{};return void 0===c.$cache&&(y.odata&&void 0!==y.odata.cache?y.odata.cache=y.odata.cache:(y.odata=y.odata||{},y.odata.cache=!0)),i&&(i.hasOwnProperty("$skip")&&i.$skip&&(o.$skip=i.$skip),i.hasOwnProperty("$top")&&i.$top&&(o.$top=i.$top)),b.odata.getRessources(o,function(b){!x||b&&b.documents&&b.documents.length||!w||(b.documents=b.documents||[],b.documents.push(w)),i&&i.hasOwnProperty("$searchText")&&(b.searchText=i.$searchText);var d=b;return c.$output&&(d=p(c.$output,{$url:e,$context:i,$data:b,$mem:a.$mem,$local:l})),d=g(c,d)},c.$errors)},F=function(c,d,e,f){var h=f&&f.getLocalContext?f.getLocalContext():null,i=x(c.$params,d,e,h);return b.local.getRessources(i,function(b){var f=b;return c.$output&&(f=p(c.$output,{$url:d,$context:e,$data:b,$mem:a.$mem,$local:h})),f=g(c,f)})},G=function(c,d,e,f){var i=f&&f.getLocalContext?f.getLocalContext():null,j=h(c.$beforeExecute,c.$params),k=x(j,d,e,i);return b.rest.getRessources(k,function(b){var f=b;return c.$output&&(f=p(c.$output,{$url:d,$context:e,$data:b,$mem:a.$mem,$local:i})),f=g(c,f)})},H=function(a){var b=[];return a.$emit&&(a.$emit.$loaded||a.$emit.$changed?(a.$emit.$loaded&&b.push(a.$emit.$loaded.$name),a.$emit.$changed&&b.push(a.$emit.$changed.$name)):b.push(a.$emit)),b};b.execData=function(a,b,d){var e=c.search(null,!1);if(!a)return null;switch(a.$type){case"basic":return B(a,e,b,d);case"odata":return E(a,e,b,d);case"rest":return G(a,e,b,d);case"local":return F(a,e,b,d);default:var f=j.get(a.$type);if(f)return f(a,e,b,d)}return null};var I=function(){function b(a){var b=this;b.config=k(a),a.$default&&(b.defaultDataset=!0),b.config.$autoselect&&(b.autoselect=!0),b._emitters=H(b.config),b.selectedIndex=-1}return b.prototype.execute=function(a,b){var d=this,e=c.search(null,!1);switch(d.config.$type){case"basic":return B(d.config,e,a,b);case"odata":return E(d.config,e,a,b);case"rest":return G(d.config,e,a,b);case"local":return F(d.config,e,a,b);case"menu":return D(d.config,e,a,b);case"widget-schema":return C(d.config,e,a,b);default:var f=j.get(d.config.$type);if(f)return f(d.config,e,a,b)}throw"Invalid dataset type"},b.prototype.enumTriggers=function(a,b){var c=this;c.config.$triggers&&c.config.$triggers.forEach(function(c){(a||"$load"!=c)&&b(c)})},b.prototype.enumEmitters=function(a){var b=this;b._emitters.forEach(a)},b.prototype.hasCustomEvents=function(){var a=this;if(a.config.$triggers){var b=a.config.$triggers;return b.length>1||"$load"!=b[0]}return!1},b.prototype.canExecute=function(a,b){var c=this;if(c.config.$condition){var d=n(c.config.$condition,b,!1,!0);if(!d||"false"===d)return!1}return c.config.$triggers.indexOf(a)>=0},b.prototype.data2Output=function(a,b){return p(a,b)},b.prototype.destroy=function(){a.utils.log("Destroy Dataset","destroy")},b.prototype._findSelectedOData=function(b){var d=this;if(b.documents){var e=-1,f=null;if(d.config.$autoselect&&"object"==typeof d.config.$autoselect)for(var g={$url:c.search(null,!1),$mem:a.$mem},h=p(d.config.$autoselect,g),i=Object.keys(h),j=0,k=b.documents.length;j<k;j++){var l=b.documents[j];if(o(l,h,i)){f=l,e=j;break}}return f?{item:f,index:e}:b.documents.length?{item:b.documents[0],index:0}:{item:null,index:-1}}return{item:null,index:-1}},b.prototype._findSelected=function(a){var b=this;switch(b.config.$type){case"odata":case"rest":return b._findSelectedOData(a);default:return{item:a,index:0}}},b.prototype.doAutoSelect=function(a,b){var c=this;if(c.selectedIndex=-1,c.config.$autoselect){if(!a||a.nodata)return b(null);var d=c._findSelected(a);c.selectedIndex=d.index,b(d.item)}},b}();b.DataSet=I,b.registerDataProvider=j.register,b.compileFilterTree=t,b.acceptFilter=u,b.extractValue=A,b.test={output:p,parseTree:w}}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.dom,
// Create page object used in template
d=(a.locale,function(a,b,c,d,e){return{number:a,text:b,icon:c,active:d,disabled:e}}),e=function(a,b,c){var e=[],f=1,g=b,h=c.maxSize&&c.maxSize<b;
// recompute if maxSize
h&&(c.rotate?(
// Current page is displayed in the middle of the visible ones
f=Math.max(a-Math.floor(c.maxSize/2),1),g=f+c.maxSize-1,
// Adjust if limit is exceeded
g>b&&(g=b,f=g-c.maxSize+1)):(
// Visible pages are paginated with maxSize
f=(Math.ceil(a/c.maxSize)-1)*c.maxSize+1,
// Adjust last page if limit is exceeded
g=Math.min(f+c.maxSize-1,b)));
// Add page number links
for(var i=f;i<=g;i++){var j=d(i,i,null,i===a,!1);e.push(j)}
// Add links to move between page sets
if(h&&!c.rotate){if(f>1){var k=d(f-1,"...",null,!1,!1);e.unshift(k)}if(g<b){var l=d(g+1,"...",null,!1,!1);e.push(l)}}var m;
//Add Previous
//Add First
//Add Next
//Add last
return c.directionLinks&&(m=d("prev",null,"chevron-left",!1,1==a),e.unshift(m)),c.boundaryLinks&&(m=d("first",null,"backward",!1,1==a),e.unshift(m)),c.directionLinks&&(m=d("next",null,"chevron-right",!1,a==b),e.push(m)),c.boundaryLinks&&(m=d("last",null,"forward",!1,a==b),e.push(m)),e},f=function(){function b(a){var b=this,c={boundaryLinks:!1,directionLinks:!0,rotate:!0,maxSize:4,size:"lg"};b._options=$.extend(c,a||{}),b.pages=[],b._updating=!1,b.visible=!1,b.props={},b.data={currentPage:-1,totalPages:0},b._defineProps()}return b.prototype._defineProps=function(){var b=this,c=a.utils.defineProperty;c("currentPage",b),c("totalPages",b)},b.prototype._notifyChange=function(a){var b=this;switch(a){case"currentPage":b._changed=!0,b._updatePages();break;case"totalPages":b._changed=!0,b.data.currentPage>=0&&b._updatePages()}},b.prototype._renderPager=function(){var a=this,b=a.$element.get(0);if(a.visible){var d=document.createDocumentFragment(),e=$("<li><a href></a><li>").get(0),f=document.createElement("span");a.pages.forEach(function(a){var b=e.cloneNode(!0);if(a.icon){var g=f.cloneNode(!0);c.attr(g,"class",c.iconClass(a.icon)),c.attr(g,"page",a.number),c.append(b.firstChild,g)}a.text&&c.text(b.firstChild,a.text),c.attr(b,"page",a.number),c.attr(b.firstChild,"page",a.number),a.disabled&&c.addClass(b,"disabled"),a.active&&c.addClass(b,"active"),d.appendChild(b)}),a.$element.empty(),b.appendChild(d),c.removeClass(b,"bs-none")}else c.addClass(b,"bs-none")},b.prototype._updatePages=function(){var a=this;if(!a._updating){a.pages=e(a.data.currentPage,a.data.totalPages,a._options),a.visible=a.data.currentPage>0&&a.data.totalPages>1;var b=5;a._options.boundaryLinks||(b-=2),a._options.directionLinks||(b-=2),a.visible=a.pages.length>b,a.$element&&a._renderPager()}},b.prototype._setEvents=function(){var a=this;a.$element&&a.$element.on("click",function(b){var d=b.target,e=c.attr(d,"page");if(e){if(b.preventDefault(),b.stopPropagation(),c.hasClass(d,"disabled")||c.hasClass(d.parentNode,"disabled"))return;if(a._options.selectPage){var f=parseInt(e,10);a._options.selectPage(isNaN(f)?e:f)}}})},b.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},b.prototype.updating=function(a){var b=this;b._updating=a,a?b._changed=!1:b._changed&&(b._changed=!1,b._updatePages())},b.prototype.render=function(a){var b=this;b.$element||(b.$element=$('<ul class="pagination'+("default"!=b._options.size?" pagination-"+b._options.size:"")+'"></ul>'),b._renderPager(),b._setEvents()),a&&(b._options.replaceParent?a.replaceWith(b.$element):a.append(b.$element))},b.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a._options=null},b}();b.Pager=f}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
var Phoenix;!function(a){var b;!function(b){function c(){return f||(f=new o),f}var d=['<div role="alert" class="bs-error alert alert-danger alert-dismissible fade in">','<button aria-label="{0}" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>',"<h4 >{1}</h4>","<p>{2}</p>","<p>",'<a class="bs-button btn btn-default" href="{4}" role="button">{3}</a>',"</p>","</div>"],e=['<div class="bs-loader"></div>'],f=null,g=a.history,h=a.utils,i=a.external,j=a.dom,k=a.link,l=a.locale,m=a.application,n=function(a){var b={emit:!1,listen:!0,triggers:[],emitters:[]};return Object.keys(a).forEach(function(c){if("view"!=c){var d=a[c];d.config.$emit&&d.enumEmitters(function(a){b.emit=!0,b.emitters.push(a)}),d.enumTriggers(!1,function(a){b.listen=!0,b.triggers.indexOf(a)<0&&b.triggers.push(a)})}}),b},o=function(){function a(){var a=this;a.childs=[],a.data={$title:"",$menuleft:!1,$menutop:!1,$menuright:!1,$menubottom:!1,$hasBack:g.hasBack(),$user:{}},a.errors=[],a.props={},a.popup=null,a._defineProps(),a._setEvents(),i.historyChangedHandler=a._historyChanged.bind(a)}return a.prototype._defineProps=function(){var a=this,b=h.defineProperty;b("$title",a),b("$menuleft",a),b("$menutop",a),b("$menuright",a),b("$menubottom",a),b("$hasBack",a),b("$user",a)},a.prototype.currentPage=function(){var a=this,b=a.childByType("layout");return b?b.data.name||"":""},a.prototype.emittersFor=function(a){var b=this,c=[],d=a.length;return b.dataListeners&&b.dataListeners.forEach(function(b){if(!b.listener.disabled&&b.emit){for(var e=!1,f=0;f<d;f++)b.emitters.indexOf(a[f])>=0&&(e=!0);e&&c.push(b.listener)}}),c},a.prototype._historyChanged=function(){this.props.$hasBack=g.hasBack()},a.prototype._notifyChange=function(a){var b=this;b._notifyChildren(a,b.data[a])},a.prototype._notifyChildOnAdd=function(a){var b=this;a&&a.onPageChange&&Object.keys(b.props).forEach(function(c){a.onPageChange(c,b.props[c])})},a.prototype._notifyChildren=function(a,b){var c=this;c.childs.forEach(function(c){var d=c.child;d&&d.onPageChange&&d.onPageChange(a,b)})},a.prototype.registerDataListener=function(a,b){var c=this;if(c.dataListeners=c.dataListeners||[],a.datasets){var d=n(a.datasets);(d.emit||d.listen)&&c.dataListeners.push({listener:a,parent:b,triggers:d.triggers,listen:d.listen,emitters:d.emitters,emit:d.emit})}},a.prototype.removeDataListener=function(a){var b=this;if(b.dataListeners)for(var c=b.dataListeners.length;c--;){var d=b.dataListeners[c];d.listener==a&&b.dataListeners.splice(c,1)}},a.prototype.removeParentDataListener=function(a){var b=this;if(b.dataListeners)for(var c=b.dataListeners.length;c--;){var d=b.dataListeners[c];d.parent==a&&b.dataListeners.splice(c,1)}},a.prototype.emitDataEvent=function(a,b,c){var d=this;d.dataListeners&&d.dataListeners.forEach(function(d){c&&c.indexOf(d.listen)<0||d.listen&&d.triggers.indexOf(a)>=0&&d.listener&&d.listener.dataEvent&&(d.listener.ds_storeLastEvent&&d.listener.ds_storeLastEvent(a,b),d.listener.disabled||d.listener.dataEvent(a,b))})},a.prototype.childByType=function(a){for(var b=this,c=0,d=b.childs.length;c<d;c++){var e=b.childs[c];if(e.type==a)return e.child}return null},a.prototype.addChild=function(a,b){var c=this;c.childs.push({child:b,type:a}),c._notifyChildOnAdd(b)},a.prototype.removeChild=function(a){for(var b=this,c=b.childs.length;c--;){var d=b.childs[c];if(d.child==a){b.childs.splice(c,1);break}}},a.prototype.destroy=function(){var a=this;if(i.historyChangedHandler=null,a._hideErrors(!0),a._hideLoading(),a.childs){for(var b=a.childs.length;b--;){var c=a.childs[b];a.removeDataListener(c.child)}a.childs=null}a.dataListeners=null,a._removeEvents()},a.prototype._setEvents=function(){var a=this;$(document).on("mousedown touchstart",function(b){a._closePopup(b)}),window.onerror=function(b,c,d,e,f){!f&&c&&(f={filename:c,lineno:d||0,colno:e||0}),a.$error||(a.lastError={message:b,stack:f?f.stack:null,stackError:f&&f.stack?null:f},a._showErrors())}},a.prototype._hideErrors=function(a){var b=this;b.$error&&(b.$error.off("closed.bs.alert"),a&&b.$error.remove(),b.$error=null)},a.prototype._showErrors=function(){var a=this,b=j.find(null,"error_box");if(b&&!a.$error){var c=["mailto:"];c.push(m.support),c.push("?subject="+encodeURIComponent(m.title)),c.push("&body=");var e=k.context(),f=new Date;c.push(encodeURIComponent(l.errors.ErrorTitle+" ")),c.push(encodeURIComponent(a.lastError.message)),c.push(encodeURIComponent("\n\n"+l.errors.ErrorUser+" ")),c.push(encodeURIComponent(e.$user.name)),c.push(encodeURIComponent("\n\n"+l.errors.ErrorDate+" ")),c.push(encodeURIComponent(f.toLocaleString())),c.push(encodeURIComponent("\n\n"+l.errors.Browser+" ")),c.push(encodeURIComponent(navigator.userAgent)),c.push(encodeURIComponent("\n\n"+l.errors.ErrorURI+" ")),c.push(encodeURIComponent(window.location.href)),(a.lastError.stack||a.lastError.stackError)&&(c.push(encodeURIComponent("\n\n"+l.errors.Stack+"\n")),a.lastError.stack?c.push(encodeURIComponent(a.lastError.stack)):c.push(encodeURIComponent(JSON.stringify(a.lastError.stackError)))),c.push(encodeURIComponent("\n\n"+l.errors.Context+" ")),c.push(encodeURIComponent(JSON.stringify(e))),a.$error=$(h.format(d.join(""),l.ui.Close,l.errors.Title,a.lastError.message,l.errors.SendMail,c.join(""))),a.$error.on("closed.bs.alert",function(){a._hideErrors(!1)}),b.appendChild(a.$error.get(0))}},a.prototype._hideLoading=function(){var a=this;a.$loading&&(a.$loading.remove(),a.$loading=null)},a.prototype._showLoading=function(){var a=this,b=document.body;b&&(a.$loading||(a.$loading=$(e.join("")),b.appendChild(a.$loading.get(0))))},a.prototype.loading=function(a){var b=this;a?b._showLoading():b._hideLoading()},a.prototype._removeEvents=function(){$(document).off("mousedown touchstart")},a.prototype._closePopup=function(a){var b=this;b.popup&&(!a||b.popup.inPopup&&!b.popup.inPopup(a.originalEvent?a.originalEvent.target:a.target))&&(b.popup.hide&&b.popup.hide(a?a.originalEvent?a.originalEvent.target:a.target:null),b.popup=null)},a.prototype.setPopup=function(a){var b=this;b._closePopup(null),b.popup=a},a}();b.PageControl=o,b.Page=c}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.ulocale,e=a.locale,f=a.dom,g=function(a){if("close"==a.pattern){var b={close:!0,type:"default",name:"close",title:e.ui.Close};return $.extend({},b,a)}if("validate"==a.pattern){var c={close:!1,type:"success",name:"validate",title:e.ui.Validate};return $.extend({},c,a)}return a},h=function(a,b,c){
//options name, type, icon, title, cancel
a=g(a),b.push('<button data-action="'+a.name+'" type="button"'),b.push(' class="bs-btn-inline pull-right bs-button btn btn-'+a.type||"default"),b.push('"'),a.close&&b.push(' data-dismiss="modal"'),b.push(">"),a.icon&&(b.push('<span class="'+f.iconClass(a.icon)+'"></span>'),a.title&&b.push("&nbsp;")),b.push(d.tt(a.title||"",c)),b.push("</button>")},i=function(a,b){var e=['<div class="modal fade" data-backdrop = "static"  id="{0}" tabindex="-1" role="dialog" aria-labelledby="{0}_label">','\t<div class="modal-dialog'+(a.size?" modal-"+a.size:"")+'" role="document">','\t\t<div class="modal-content">','\t\t<div class="modal-header">','\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>','\t\t\t<h4 class="modal-title" id="{0}_label">{1}</h4>',"\t\t</div>",'\t\t<div class="modal-body" id="{0}_body">',"\t\t</div>",'\t\t<div class="modal-footer"  id="{0}_footer">'];return a.buttons&&a.buttons.forEach(function(a){h(a,e,b)}),e.push("\t\t</div>"),e.push("\t\t</div>"),e.push("\t</div>"),e.push("</div>"),c.format(e.join(""),a.id,d.tt(a.title,b))},j=function(){function a(a,b){this.options=a||{},this.$id=c.allocID(),this.$locale=b}return a.prototype._removeEvents=function(){var a=this;a.$element.off("click"),a.$element.off("hidden.bs.modal")},a.prototype._execAction=function(a){var b=this;b._clickHnd&&b._clickHnd(a)},a.prototype._addEvents=function(){var a=this;a.$element.on("hide.bs.modal",function(b){a._inProcessing&&(b.preventDefault(),b.stopPropagation())}),a.$element.on("hidden.bs.modal",function(b){a._clear()}),a.$element.on("click",function(b){if(a.$element)for(var d=b.target,e=a.$element.get(0);d;){var f=d.getAttribute("data-action");if(f)return c.focusDelay(function(){return a._execAction(f)});d=d==e?null:d.parentNode}})},a.prototype._clear=function(){var a=this;a.$element&&(a._removeEvents(),a.render&&a.render.destroy(),a.$element.remove(),a.$element=null),a.render=null},a.prototype.processing=function(a){var b=this;b._inProcessing=a,f.processing(a),b.render&&b.render.processing&&b.render.processing(a)},a.prototype.on=function(a){this._clickHnd=a},a.prototype.close=function(){var a=this;a.$element&&a.$element.modal("hide")},a.prototype.open=function(){var a=this,b={id:a.$id,title:a.options.title||"",buttons:a.options.buttons||[],size:0};a.options.size&&(b.size=a.options.size),a.$element||(a.$element=$(i(b,a.$locale)),a.render&&a.render.render($(f.find(a.$element.get(0),a.$id+"_body"))),f.append(document.body,a.$element.get(0)),a.$element.modal({}),a._addEvents())},a.prototype.destroy=function(){var a=this;a._clear()},a}();b.Modal=j}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../data/datasets.ts" />
//TODO: config.$resources || config.$schema --> config.$resources
var Phoenix;!function(a){var b;!function(b){var c=a.data,d=a.link,e=a.$mem,f=a.utils,g=function(a,b,c,d){if(b.config.$emit[d].$updateMem){var f=b.data2Output(b.config.$emit[d].$updateMem,{$item:c});e=$.extend(e,f)}if(b.config.$emit[d].$updateLocal){var g=a.getLocalContextHandler?a.getLocalContextHandler():null;if(g){var h=b.data2Output(b.config.$emit[d].$updateLocal,{$item:c});g=$.extend(g,h)}}},h=function(a,b,e,g,h,i,j,k){var l=function(a){return k?e?e[a]:null:e},m=a,n=[],o=[],p=g||{},q="$load"==b,r=-1,s=function(a,b,c){if(m&&m.datasets){var d=m.datasets[a];d&&(n.push(d.execute(c,m)),o.push(a),d.defaultDataset&&(r=b.length-1))}};i?i&&Array.isArray(i)?i.forEach(function(a){"object"==typeof a?a.name&&(n.push(c.execData(a,l(a.name),m)),o.push(a.name)):s(a,o,l(a))}):s(i,o,l(i)):m&&m.datasets&&Object.keys(m.datasets).forEach(function(a){var c=m.datasets[a],e=(d.search(null,!1),m.ds_context());c&&c.canExecute(b,e)&&s(a,o,l(a))}),n.length?(m&&m.loadingHandler&&m.loadingHandler(!0),f.Promise.all(n).then(function(a){var b=[];o.forEach(function(c,d){var e=a[d];if(d==r&&m&&m.noDataHandler&&m.noDataHandler(!e||e.nodata,null,!0),p[c]=e,m){var f=m.datasets&&m.datasets[c];if(q&&f&&f.$menu&&m.updateMenuHandler){var g=c.split("_");b.push({name:g[g.length-1],data:e})}if(f&&(m.ds_loaded(c,e),f.autoselect))return f.doAutoSelect(e,function(a){m.ds_select(c,a)})}}),m&&m.loadingHandler&&m.loadingHandler(!1),b.forEach(function(a){m.updateMenuHandler(a.name,a.data)}),h(!0),m&&m.watchersHandler&&m.watchersHandler(o),!q&&j&&m&&m.dataChangedHandler&&m.dataChangedHandler(o)})["catch"](function(a){m&&m.loadingHandler&&m.loadingHandler(!1),m&&m.errorHandler&&m.errorHandler(a),h(!1,a),!q&&j&&m&&m.dataChangedHandler&&m.dataChangedHandler(o)})):h(!0)},i=function(){function a(){}return a.prototype.ds_init=function(a){var b=this,d=!1;if(b.props=b.props||{},b.props.data=b.props.data||{},b.props.data.ds={},a.datasets||a.$resources||a.$schema||a.$menus){b.datasets&&b.ds_destroy();var e=a.$resources||a.$schema;e&&(b.props.data.ds.view=null,b.datasets=b.datasets||{},b.datasets.view=new c.DataSet({$type:"widget-schema",$params:{name:e,localization:a.$localization}}),b.datasets.view.$schema=!0),a.$menus&&Object.keys(a.$menus).forEach(function(d){var e="$menu_"+d;b.props.data.ds[e]=null,b.datasets=b.datasets||{},b.datasets[e]=new c.DataSet({$type:"menu",$params:{name:a.$menus[d]+"-"+d}}),b.datasets[e].$menu=!0}),a.datasets&&Object.keys(a.datasets).forEach(function(e){b.props.data.ds[e]=null,b.datasets=b.datasets||{};var f=new c.DataSet(a.datasets[e]);b.datasets[e]=f,d||(d=f.hasCustomEvents()||f.config.$emit)})}return d},a.prototype.ds_storeLastEvent=function(a,b){var c=this;c._lastEvent={event:a,value:b}},a.prototype.ds_LastEvent=function(){var a=this;if(a._lastEvent){var b=a._lastEvent;return a._lastEvent=null,b}return null},a.prototype.ds_destroy=function(){f.log("Destroy Dataset Part","destroy");var a=this;a._lastEvent=null,a.datasets&&(Object.keys(a.datasets).forEach(function(b){var c=a.datasets[b];c.destroy()}),a.datasets=null)},a.prototype.ds_context=function(){var a=this,b={$url:d.search(null,!1),$mem:e,$local:a.getLocalContextHandler?a.getLocalContextHandler():null},c=a.props.data.ds;return c&&Object.keys(c).forEach(function(a){b[a]=c[a]}),b},a.prototype.ds_reemit=function(a,b){var c=this;if(c.datasets){var d=Object.keys(c.datasets);d.forEach(function(a){var b=c.props.data.ds[a],d=c.datasets[a];d.defaultDataset&&c.noDataHandler&&c.noDataHandler(!b||b.nodata,null,!0),c.ds_loaded(a,b),d.autoselect&&d.doAutoSelect(b,function(b){c.ds_select(a,b)})})}return b()},a.prototype.ds_select=function(a,b){var c=this;if(c.datasets&&c.datasets[a]){var d=c.datasets[a];d.config.$emit&&c.emitHandler&&(d.config.$emit.$changed&&g(c,d,b,"$changed"),c.emitHandler(d.config.$emit.$changed?d.config.$emit.$changed.$name:d.config.$emit,b))}},a.prototype.ds_loaded=function(a,b){var c=this;if(c.datasets&&c.datasets[a]){var d=c.datasets[a];d.config.$emit&&d.config.$emit.$loaded&&(g(c,d,b,"$loaded"),c.emitHandler(d.config.$emit.$loaded.$name,b))}},a.prototype.ds_exec=function(a,b,c,d,e,f){h(this,a,b,c,d,e,f)},a}();b.DatasetMethods=i,b.executeDatasets=function(a,b,c,d,e,f){var g={loadingHandler:d&&d.loading?d.loading:null,errorHandler:d&&d.error?d.error:null};h(g,"",b,c,e,a,!1,f)}}(b=a.DatasetPlugin||(a.DatasetPlugin={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/locale.ts" />
var Phoenix;!function(a){var b;!function(b){
//Widget data
// {$config: {$title, $titleIsHidden, $border, $style, $height, data}}
var c=a.dom,d=a.utils,e=a.locale,f=a.ulocale,g=function(a,b,d){var e=["bs-island bs-widget"];return c.parseStyle(a.$style,e),a.$border&&e.push("border"),b.design&&e.push("design"),d&&e.push("selected"),e.join(" ")},h=function(a){if(!a)return"";var b=(a+"").indexOf("%")>0?a:parseInt(a,10)+"px";return"height:"+b+";"},i=function(a,b,c,d){a.push('<div class="'),a.push(g(b.$config,c,b.$selected)),a.push('"'),c.design&&a.push(' draggable="true"'),a.push(' data-render="'+b.$id+'"'),a.push(' id="'+b.$id+'"'),a.push(">"),j(a,b.$id,b.$config,d,!1),a.push('<div class="bs-widget-content bs-widget-content-id"');var e=h(b.$config.$height);e&&a.push(' style="'+e+'"'),a.push(">")},j=function(a,b,e,g,h){a.push('<div class="bs-widget-title'+(h?" bs-widget-content-inv-x":"")+(e.$titleIsHidden&&!h?" bs-none":"")+'" id="'+b+'_title">');var i=f.localeTitle(e.$title)||"";g&&(i=f.tt(e.$title||"",g)),a.push(d.escapeHtml(i+" ")),e.icons&&e.icons.length&&e.links&&e.icons.forEach(function(b){var d=e.links[b.link];d&&d.$icon&&(a.push('<a class="bs-widget-title-icon" data-phoenix-href="link://'+b.link+'">'),a.push('<span class="'+c.iconClass(d.$icon)+'"></span>'),a.push("</a>"))}),a.push("</div>")},k=function(a,b){a.push("</div></div>")},l=function(a,b,c,d,e,f){i(a,b,e,f),k(a,e)},m=function(a,b,c,d,e){var f=[];return l(f,a,c,d,b,e),f.join("")},n=function(){return $('<div class="bs-loader"></div>')},o=function(){return $('<div class="alert alert-danger" role="alert"><span class="'+c.iconClass("exclamation-circle")+'" aria-hidden="true"></span><span></span></div>')},p=function(){return $('<span class="bs-module-settings '+c.iconClass("cog")+'" ></span>')},q=function(){return $('<div class="alert alert-warning" role="alert"></div>')},r=function(a,b){var d=[],f=b!==!1;return b=b&&b!==!0||"cloud",d.push('<div class="bs-widget-content nodata">'),d.push('<div class="bs-no-data-inside">'),f&&d.push('<center class="nodata-image"><i class="'+c.iconClass(b)+' nodata-icon"></i></center>'),d.push('<center><h4 class="nodata-text">'),d.push(a?a:e.layouts.NoData),d.push("</h4></center>"),d.push("</div>"),d.push("</div>"),$(d.join(""))};b.toHtml=m,b.cssClass=g,b.heightText=h,b.loader=n,b.error=o,b.widgetTitle=j,b.settings=p,b.warning=q,b.noData=r}(b=a.WidgetUtils||(a.WidgetUtils={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="./module.ts" />
/// <reference path="./datasets-plugin.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=a.utils,e=(a.locale,a.WidgetUtils),f=a.link,g=a.render,h=function(){function b(a,b,c){var e=this;e.item=a||{},e.item.$id||(e.item.$id=d.allocID()),a.$config=a.$config||{},a.$config.data=a.$config.data||{},e.data=a.$config,e.props={},e.item.$render=e.props,e.props.data=a.$config.data,e.options=b||{},e.contentRender=null,e.links=a.$config.links,e._defineProps(),e.layout=c,e.$local={},
//datasets
e.loadingHandler=this.loading.bind(e),e.noDataHandler=this.noData.bind(e),e.errorHandler=this.error.bind(e),e.emitHandler=this.emit.bind(e),e.getLocalContextHandler=this.getLocalContext.bind(e),e.dataChangedHandler=this.dataChanged.bind(e),e.updateMenuHandler=null,e._watchers={},e.props.data.localContext&&$.extend(e.$local,e.props.data.localContext),e.ds_init(e.data)&&e._listen()}
//implements DatasetMethods
//Called by execdataset
/* Start datasets methods*/
/* End datasets methods*/
return b.prototype.ds_init=function(a){return!1},b.prototype.ds_storeLastEvent=function(a,b){},b.prototype.ds_LastEvent=function(){return null},b.prototype.ds_destroy=function(){},b.prototype.ds_context=function(){return null},b.prototype.ds_reemit=function(a,b){return null},b.prototype.ds_select=function(a,b){},b.prototype.ds_loaded=function(a,b){},b.prototype.ds_exec=function(a,b,c,d,e,f){},b.prototype._defineProps=function(){var a=this,b=d.defineProperty;b("$title",a),b("$border",a),b("$height",a),b("$titleIsHidden",a),b("$settings",a)},b.prototype._notifyChange=function(a){var b=this;switch(a){case"$title":b._updateTitle();break;case"$border":case"$titleIsHidden":b._updateCssClass();break;case"$height":b._updateHeight()}},b.prototype._listen=function(){var a=this;a.layout&&a.layout.registerDataListener(a)},b.prototype._unlisten=function(){var a=this;a.layout&&a.layout.removeDataListener(a)},b.prototype.on=function(a,b){var c=this;c.handlers=c.handlers||{},c.handlers[a]=b},b.prototype._exec=function(a){var b=this;b.handlers&&b.handlers[a]&&b.handlers[a]()},b.prototype._setEvents=function(){var a=this,b=a.$element.get(0);a.$element.on("click",function(c){a.$settings&&c.target===a.$settings.get(0)&&a._exec("settings");var d=f.isCustomLink(b,c);d&&f.execCustomProtocol(d,a.ds_context(),{links:a.links},null)})},b.prototype.executeLink=function(a,b){var c=this,d=f.isCustomProtocol(a);d&&f.execCustomProtocol({protocol:d,value:a},c.ds_context(),{links:c.links},b)},b.prototype._removeEvents=function(){var a=this;a.$element.off("click")},b.prototype.dataChanged=function(a){var b=this;b.onDSChanged&&b.onDSChanged(a),b.contentRender&&b.contentRender.dataChanged?b.contentRender.dataChanged():b.options.onDataChanged&&b.options.onDataChanged()},b.prototype.execDataSet=function(a,b,c,d,e){var f=this;d=d||f.props.data.ds,f.ds_exec(null,b,d,c||function(){},a,e)},b.prototype._loadData=function(a){var b=this;return b.datasets?void b.ds_exec("$load",null,b.props.data.ds,a,null,!0):a(!1)},b.prototype._updateTitle=function(){var a=this;if(a.$element){var b=c.find(a.$element.get(0),a.item.$id+"_title");b&&c.text(b,this.data.$title||"")}},b.prototype._cleanErrors=function(a){var b=this;b.$loader&&(b.$loader.remove(),b.$loader=null),a||(b.$settings&&c.addClass(b.$settings.get(0),"bs-none"),b.$noData&&(b.$noData.remove(),b.$noData=null),b.$error&&(b.$error.remove(),b.$error=null),b.$warning&&(b.$warning.remove(),b.$warning=null))},b.prototype.loading=function(a){var b=this;b._cleanErrors(!a);var d=b.$element?b.$element.get(0):null;d&&(a?(c.addClass(d,"loading"),b.$loader||(b.$loader=e.loader(),b.$element.append(b.$loader))):c.removeClass(d,"loading")),a||b.settings()},b.prototype._linksState=function(a){var b=this;if(b.$element){var d=b.$element.get(0),e=c.find(d,b.item.$id+"_title");if(e){var f=c.queryAll(e,".bs-widget-title-icon");[].forEach.call(f,function(b){a?c.removeClass(b,"bs-none"):c.addClass(b,"bs-none")})}}},b.prototype.noData=function(a,b,d){var f=this;if(!b&&f.props.data.$noDataMessage&&(b=f.props.data.$noDataMessage),this._cleanErrors(!1),f.$element){var g=f.$element.get(0),h=c.query(g,".bs-widget-content-id");if(h&&(a?c.addClass(h,"bs-none"):c.removeClass(h,"bs-none"),f._linksState(!a)),a){f.$noData=e.noData(b,d);var i=f._updateHeight(f.$noData);if(i){var j=c.query(f.$noData.get(0),".bs-no-data-inside");c.addClass(j,"centred")}var k=c.find(g,f.item.$id+"_title");k&&c.after(k,f.$noData.get(0))}}},b.prototype.getLocalContext=function(){return this.$local},b.prototype.settings=function(){var a=this,b=a.data.$settings&&!a.$error&&!a.$warning&&!a.$noData;if(a.$settings)return void(b?c.removeClass(a.$settings.get(0),"bs-none"):c.addClass(a.$settings.get(0),"bs-none"));if(b){a.$settings=e.settings();var d=c.find(a.$element.get(0),a.item.$id+"_title");d&&c.after(d,a.$settings.get(0))}},b.prototype.error=function(a){var b=a;a&&a.message&&(b=a.message);var d=this;this._cleanErrors(!1);var f=d.$element?d.$element.get(0):null;if(f){d.$error=e.error();var g=d.$error.get(0);c.text(g.lastChild," "+b);var h=c.find(f,d.item.$id+"_title");h&&c.after(h,g)}},b.prototype.warning=function(a){var b=this;this._cleanErrors(!1);var d=b.$element?b.$element.get(0):null;if(d){b.$warning=e.warning();var f=b.$warning.get(0);c.text(f,a);var g=c.find(d,b.item.$id+"_title");g&&c.after(g,f)}},b.prototype._updateHeight=function(a){var b=this;a=a||b.$element;var c=a?a.get(0):null;return c&&(c.style.cssText=e.heightText(b.props.$height)),!!b.props.$height},b.prototype._updateCssClass=function(){var a=this,b=a.$element?a.$element.get(0):null;b&&(b.className=e.cssClass(a.data,a.options))},b.prototype._internalRenderContent=function(a,b,c){var d=this,e=g.get(d.options.context,"widget.content.control."+d.data.$type);if(d.$element){if(e)d.contentRender=new e(d.props,{context:d.options.context,replaceParent:!1},this);else{var f=g.get(d.options.context,"widget.content");if(f){var h=[];f(h,d.data,d.options),a.append($(h.join("")))}}d.options.beforeAdd&&d.options.beforeAdd(a,c),d.contentRender&&d.contentRender.render(a),b&&d.$element.append(a)}},b.prototype.watchersHandler=function(a){var b=this;a&&a.forEach(function(a){var c=b._watchers[a];c&&c.forEach(function(c){c(b.props.data.ds[b.props.data.ds[a]])})})},b.prototype.render=function(a){var b=this;if(b.$loader=null,b.$error=null,!b.$element){b.layout.controls[b.item.$id]=this,b.$element=$(e.toHtml(b.item,b.options,null,null,null)),b._setEvents();var d=b.$element.get(0),f=c.query(d,".bs-widget-content-id");b._loadData(function(a){b._internalRenderContent($(f),!1,a),b.settings()}),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element))}},b.prototype.emit=function(a,b,c){var d=this;d.layout&&d.layout.emitDataEvent(a,b,c)},b.prototype.dataEvent=function(a,b){var c=this;c.ds_exec(a,b,c.props.data.ds,function(){},null,!0)},b.prototype.destroy=function(){d.log("Destroy Module","destroy");var a=this;a.contentRender&&(a.contentRender.destroy(),a.contentRender=null),a._unlisten(),a.ds_destroy(),a._cleanErrors(!1),a.item.$render=null,a.$settings&&(a.$settings=null),a.$element&&(a._removeEvents(),a.$element=null),a.layout=null,a.ondatasets=null},b.prototype.watch=function(b,c){var d=this;if(d._watchers){var e=d._watchers[b]=d._watchers[b]||[];e.push(c),d.props&&d.props.data.ds&&a.utils.nextTick(function(){c(d.props.data.ds[b])})}},b.prototype.unwatch=function(a,b){var c=this;if(c._watchers){var d=c._watchers[a];if(d){var e=d.indexOf(b);e>=0&&d.splice(e,1)}}},b}();b.Widget=h,d.applyMixins(h,[a.DatasetPlugin.DatasetMethods])}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="./datasets-plugin.ts" />
/// <reference path="./page.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=(a.ulocale,a.link),e=a.$mem,f=a.dom,g=function(){function a(a,b){this._initOptions(b),this.init(a,b)}
//implements DatasetMethods
/* Start datasets methods*/
/* End datasets methods*/
return a.prototype.ds_init=function(a){return!1},a.prototype.ds_storeLastEvent=function(a,b){},a.prototype.ds_LastEvent=function(){return null},a.prototype.ds_destroy=function(){},a.prototype.ds_context=function(){return null},a.prototype.ds_reemit=function(a,b){return null},a.prototype.ds_select=function(a,b){},a.prototype.ds_loaded=function(a,b){},a.prototype.ds_exec=function(a,b,c,d,e,f){},a.prototype._initOptions=function(a){},a.prototype.emit=function(a,b,c){this.emitDataEvent(a,b,c)},a.prototype.init=function(a,d){c.log("Create Menu","menu");var e=this;
//datasets
e.loadingHandler=this.loading.bind(e),e.noDataHandler=null,e.errorHandler=null,e.emitHandler=this.emit.bind(e),e.getLocalContextHandler=null,e.dataChangedHandler=null,e.updateMenuHandler=null,e.$element=null,e.$items=null,e.options=d||{},e.options.typeMenu=e.options.type||"left",e.data={name:"none"},e.page=b.Page(),e.page.addChild("menu-"+e.options.typeMenu,e),e.setMenu(a)},a.prototype.loading=function(a){this.page.loading(a)},a.prototype.registerDataListener=function(a){var b=this;b.page&&b.page.registerDataListener(a,b)},a.prototype.removeDataListener=function(a){var b=this;b.page&&b.page.removeDataListener(a)},a.prototype.emitDataEvent=function(a,b,c){var d=this;d.page&&d.page.emitDataEvent(a,b,c)},a.prototype.onPageChange=function(a,b){var c=this;if("$user"==a&&c.items&&c.options.auth&&!c.options.autoClose){var d=c.page.props.$user&&c.page.props.$user.connected;if(d){var e=f.find(null,c.options.parentId);e?c.show($(e)):c._showContent()}else c.$content&&!d&&c._hideContent()}},a.prototype.setMenu=function(a){c.log("Set Menu","menu");var b=this,d=null!=a;a=a||{name:"none"},a.$groups||(a.$groups=[{$items:a.$items}],delete a.$items),this.data.name!==a.name?(c.log("Menu create && execute datasets","menu"),b.data=a,b.items=null,b._recreateDatasets(),b.ds_exec("$load",null,b.props.data.ds,function(){var a=!b.options.autoClose&&b.options.parentId&&d;if(a&&b.options.auth&&(a=b.page.props.$user&&b.page.props.$user.connected),b._prepareItems(),b.$content)if(b._removeContent(),d)if(a){var c=f.find(null,b.options.parentId);c&&(b.render(),b.show($(c)))}else b.render();else b._hideContent();else if(a){var e=f.find(null,b.options.parentId);e&&b.show($(e))}b.page.props["$menu"+b.options.typeMenu]=d&&b.options.autoClose},null,!0)):(c.log("Menu reexecute datasets","menu"),b.ds_reemit(null,function(){b._onPageChanged(),b.page.props["$menu"+b.options.typeMenu]=d&&b.options.autoClose}))},a.prototype._onPageChanged=function(){},a.prototype._doCloseClick=function(){},a.prototype._menuShowed=function(){},a.prototype._executeLink=function(a,b){},a.prototype._setEvents=function(){var a=this,b=a.$content.get(0);a.$content.on("click",function(c){var e=d.isCustomLink(b,c);if(e&&"click"==e.protocol){var f=e.value.substring("click://".length);if("close"==f){if(a._doCloseClick)return a._doCloseClick()}else{var g=f.split("/");a._executeLink(a.items[parseInt(g[0],10)],g.length>1?g[1]:null)}}a.options.autoClose&&a.hide()})},a.prototype.renderItems=function(a){return null},a.prototype._removeEvents=function(){var a=this;a.$content.off("click")},a.prototype._loadData=function(a){var b=this;return b.datasets?void b.ds_exec("$load",null,b.props.data.ds,a,null,!0):a(!1)},a.prototype._expandItem=function(a,b,d,e,f,g){var h={$title:"",$item:a,$index:g,$link:f};return h.$title=c.parseVariable(e,{$item:a,$url:b,$mem:d}),h},a.prototype._expandDatasetItems=function(a,b,c){var f=this,g=f.props.data.ds[a];if(g){var h=[],i=d.search(null,!1),j=e;if(g.documents){if(!g.documents.length)return null;g.documents.forEach(function(a,d){h.push(f._expandItem(a,i,j,b,c,d))})}else h.push(f._expandItem(g,i,j,b,c,-1));return h}return null},a.prototype.copyMenuItemData=function(a,b){},a.prototype._prepareItems=function(){var a=this;if(a.items=[],a.data.$groups){var b=!0;a.data.$groups.forEach(function(e){var f=null;if(e.$dataset){if(!e.$link)throw"Invalid link definition. (no link)";if(!e.$itemtitle)throw"Invalid link definition. (no itemtitle)";f=a._expandDatasetItems(e.$dataset,e.$itemtitle,e.$link)}else f=e.$items;if(f&&f.length&&(!b||e.$title||e.$dataset)){var g={divider:!0,$title:null,dataset:"",isHidden:!1};e.$title&&(g.$title=e.$title),e.dataset&&(g.dataset=e.$dataset,b&&(g.isHidden=!0)),a.items.push(g),b=!1}if(f){var h=e.$dataset?a.datasets[e.$dataset]:null;f.forEach(function(f,g){var i={$title:f.$title?c.parseExpression(f.$title,d.context()):null,$dataset:null,dataset:null,$index:0,$item:null,$link:null,$level:f.$level,selected:!1};e.dataset&&(i.dataset=e.$dataset),f.$link&&(i.$link=f.$link),h&&h.autoselect&&(i.selected=h.selectedIndex==g),a.copyMenuItemData(i,f),h&&(i.$dataset=e.$dataset,i.$index=f.$index,i.$item=f.$item),a.items.push(i),b=!1})}})}},a.prototype._removeContent=function(){this.$element&&(this.$element.remove(),this.$element=null)},a.prototype.renderContent=function(){return $("<aside></aside>")},a.prototype.show=function(a){var b=this;b.$content?b._showContent():(b.render(a),b._showContent()),b.options.autoClose&&b.page.setPopup(b)},a.prototype.hide=function(a){var b=this;b.$content&&b._hideContent(a)},a.prototype._hideContent=function(a){var b=this,c=b.$content.get(0);f.addClass(c,"bs-none")},a.prototype._showContent=function(){var a=this,b=a.$content.get(0);f.removeClass(b,"bs-none"),a._menuShowed()},a.prototype.render=function(a){var b=this,c=b.$content;if(
//
c||(c=b.renderContent()),b.$element||(b.$element=b.renderItems(c),c.append(this.$element)),a&&!b.$content){if(b.$content=c,b.options.replaceParent){var d=a.get(0);if(d&&d.id){var e=b.$content.get(0);e&&(e.id=d.id)}a.replaceWith(b.$content)}else a.append(b.$content);b._setEvents()}},a.prototype._recreateDatasets=function(){var a=this;a.ds_destroy(),a.removeDataListener(a),a.ds_init(a.data)&&a.registerDataListener(a)},a.prototype.destroy=function(){var a=this;c.log("Destroy Menu","destroy"),a.ds_destroy(),a.removeDataListener(a),a.$content&&(a._removeEvents(),this.$content=null),this.$element=null,a.page&&(a.page.removeChild(a),a.page=null)},a.prototype.inPopup=function(a){var b=this;if(!b.options.autoClose)return!0;if(!a)return!0;if(b.$content)for(var c=b.$content.get(0),d=a;d;){if(d==c)return!0;d=d.parentNode}return!1},a}();b.MenuBase=g,c.applyMixins(g,[a.DatasetPlugin.DatasetMethods])}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="./datasets-plugin.ts" />
/// <reference path="./menu-base.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.link,d=a.preferences,e=a.application,f=a.device,g=a.utils,h=a.dom,i=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype._initOptions=function(a){var b=e.configuration.header||{};a=a||{},a.replaceParent=!0,a.canStayInPage=!f.phone&&!f.tablet,a.autoClose=!a.canStayInPage||d("menu_"+a.type+"_autoClose"),void 0===a.autoClose&&(a.autoClose=!0),a.auth=b.authLeftMenu},b.prototype._hideContent=function(a){var b=this,c=b.$content.get(0);if(b.options.bodyId){var d=h.find(null,b.options.bodyId);d&&h.removeClass(d,"bs-pc-body-"+b.options.typeMenu)}h.removeClass(c,"bs-menu-opened"),h.addClass(c,"bs-menu-closed"),b.options.bodyId&&(!b.options.autoClose||a&&b.options.autoClose)&&g.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},b.prototype._showContent=function(){var a=this,b=a.$content.get(0),c=!1;if(a.options.bodyId&&!a.options.autoClose){c=!0;var d=h.find(null,a.options.bodyId);d&&h.addClass(d,"bs-pc-body-"+a.options.typeMenu)}h.removeClass(b,"bs-menu-closed"),h.addClass(b,"bs-menu-opened"),a.options.canStayInPage?h.addClass(b,"large"):h.addClass(b,"phone"),c&&g.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},b.prototype._switchAutoClose=function(){var a=this,b=!d("menu_"+a.options.type+"_autoClose");return d("menu_"+a.options.type+"_autoClose",b),a.options.autoClose=b,a._updateCloseButton(a.$content)},b.prototype._doCloseClick=function(){var a=this;return a.options.canStayInPage?(a._switchAutoClose()?a.hide(!0):a._showContent(),void(a.page.props["$menu"+a.options.typeMenu]=a.options.autoClose)):void a.hide()},b.prototype.copyMenuItemData=function(a,b){a.$icon=b.$icon},b.prototype._updateCloseButton=function(a){var b=this,c=!1,d=a.get(0),e=h.query(d,".bs-menu-button"),f=h.query(d,".bs-icon");return b.options.canStayInPage?(h.removeClass(f,h.iconClass("times",!0)),b.options.autoClose?(h.removeClass(f,h.iconClass("times-circle-o",!0)),h.addClass(f,"small"),h.addClass(f,h.iconClass("thumb-tack",!0)),c=!0):(h.removeClass(f,h.iconClass("thumb-tack",!0)),h.removeClass(f,"small"),h.addClass(f,h.iconClass("times-circle-o",!0))),h.removeClass(e,"bs-none")):(h.removeClass(f,h.iconClass("thumb-tack",!0)),h.removeClass(f,h.iconClass("times-circle-o",!0)),h.addClass(f,h.iconClass("times",!0)),h.removeClass(e,"bs-none")),c},b.prototype.renderContent=function(){var a=this,b=a.options,c=$('<div class="bs-menu-wrap bs-menu-animate bs-menu-closed bs-menu-'+b.typeMenu+'-wrap"><div class="bs-menu-button bs-none bs-menu-'+b.typeMenu+'-close"><a class="bs-xclose" href="#" data-phoenix-href="click://close"><span class="bs-icon '+h.iconPrefix()+'"></span></a></div></div>');return a._updateCloseButton(c),c},b.prototype._changeSelected=function(a){var b=this;if(b.$element){var c=b.$element.get(0).childNodes[a.$childIndex];a.selected?h.addClass(c,"active"):h.removeClass(c,"active")}},b.prototype._selectDatasetItem=function(a,b){var c=this;c.items.forEach(function(d){d.$dataset===a&&(d==b?d.selected||(d.selected=!0,c._changeSelected(d)):d.selected&&(d.selected=!1,c._changeSelected(d)))})},b.prototype._canClick=function(a){return a.$link},b.prototype.render=function(b){a.prototype.render.call(this,b),this._onPageChanged()},b.prototype.renderItems=function(){var a=this,b=$('<ul class="bs-item-list"></ul>'),c=b.get(0),d=$('<li><a class="link"><span class="title"></span></a></li>').get(0),e=$('<li class="parent"><span class="title"></span></li>').get(0),f=$('<li class="divider"></li>').get(0);if(a.items){var g=0,i=a.items.length;a.items.forEach(function(b,j){if(!b.isHidden){var k;if(b.divider)k=f.cloneNode(!0),b.$title?h.text(k,b.$title):h.addClass(k,"empty");else{var l=!1;if(j<i-1){var m=a.items[j+1];l=(m.$level||0)>(b.$level||0)}var n=!!b.$link;k=n?d.cloneNode(!0):e.cloneNode(!0),b.$level?(h.addClass(k,"level"),h.addClass(k,"level-"+b.$level)):l&&h.addClass(k,"level");var o=k.firstChild,p=n?o.firstChild:o;if(b.$title){var q=b.$icon?" "+b.$title:b.$title;h.text(p,q)}if(b.selected&&h.addClass(k,"active"),n&&(h.attr(o,"data-phoenix-href","click://"+j),a._canClick(b)||h.removeClass(o,"link")),b.$icon){var r=h.icon(b.$icon);o.insertBefore(r,o.firstChild)}}c.appendChild(k),b.$childIndex=g,g++}})}return b},b.prototype._executeLink=function(a,b){var d,e=this,f=c.context();if(a.$dataset&&(d=e.datasets[a.$dataset],f.$item=a.$item),d&&a.$link&&a.$link.$datasetSelect)d.selectedIndex!=a.$index&&(d.selectedIndex=a.$index,e.ds_select(a.$dataset,a.$item),e._selectDatasetItem(a.$dataset,a));else if(a.$link)return c.execLink(a.$link,f,null)},b.prototype._onPageChanged=function(){var a=this;if(a.$element&&a.items){var b=a.page.currentPage();a.items.forEach(function(d,f){if(d.$link&&d.$link.$page){var g=c.pageName(d.$link),h=g==b;h&&d.$link.$module&&(h=d.$link.$module===e.name),d.selected!=h&&(d.selected=h,a._changeSelected(d))}})}},b}(b.MenuBase);b.Menu=i,b.Menuleft=i,b.Menuright=i}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="./page.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=a.link,e=a.utils,f=a.application,g=a.ulocale,h=(a.locale,function(){function a(a,c){var d=this,e={justified:!1,pills:!1};d._page=b.Page(),d._options=$.extend(e,a||{}),d._tabs=c||[]}return a.prototype._renderTabs=function(){var a=this,b=a.$element.get(0),h=b.firstChild,i=document.createDocumentFragment(),j=$('<li><a href="#"></a><li>').get(0),k=a._page.currentPage();a._tabs.forEach(function(a,b){var h=j.cloneNode(!0),l=h.firstChild;c.text(l,g.localeTitle(a.$title));var m=!1;if(void 0!==a.enabled)if("string"==typeof a.enabled){var n=e.execAngularExpression(a.enabled,d.context());n&&"undefined"!==n&&"false"!==n||(m=!0)}else m=!a.enabled;if(m?c.addClass(h,"disabled"):c.attr(l,"data-phoenix-href","click://"+b),a.$page){var o=d.pageName(a),p=o==k;p&&a.$module&&(p=a.$module===f.name),p?a.active=!0:a.active=!1}a.active&&c.addClass(h,"active"),i.appendChild(h)}),c.empty(h),c.append(h,i)},a.prototype._setEvents=function(){var a=this;if(a.$element){var b=a.$element.get(0);a.$element.on("click",function(c){var e=d.isCustomLink(b,c);if(e&&"click"==e.protocol){var f=e.value.substring("click://".length),g=f.split("/"),h=d.context(),i=a._tabs[parseInt(g[0],0)];i&&i.$page&&!i.disabled&&d.execLink(i,h,null)}})}},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype.render=function(a){var b=this;b.$element||(b.$element=$('<div class="bs-widget-content-inv bs-tabs"><ul class="nav nav-tabs"><ul></div>'),b._renderTabs(),b._setEvents()),a&&(b._options.replaceParent?a.replaceWith(b.$element):a.append(b.$element))},a.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a._options=null,a._page=null},a}());b.Tabs=h}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=a.utils,e=a.locale.layouts,f=a.ulocale,g=a.render,h=function(a){a.$items.length||(a.$type="block",a.$origin="row")},i=function(a,b,c,f){switch(a.$id||(a.$id=d.allocID()),b&&(a.$parentId=b.$id),a.$idDesign=a.$id,a.$idDrag=a.$id,a.$type=a.$type||"block",a.$items=a.$items||[],s(a)||(delete a.$inline,delete a.$fieldsOptions),c&&(c[a.$id]=a),f&&a.$name&&(c[a.$name]=a),"html"!==a.$type||a.$html||(a.$html=e.Html),a.$type){case"row":h(a)}a.$origin&&a.$origin===a.$type&&delete a.$origin},j=function(a){return"accordion-group"!==a.$type||a.opened},k=function(a,b,c,e){a.$id||(a.$id=d.allocID()),b&&(a.$parentId=b.$id),a.$idDrag=a.$id,c&&(c[a.$id]=a),e&&a.$name&&(c[a.$name]=a)},l=function(a){h(a);var b=!1;if(a.$items.forEach(function(a){a.$type="column",a.$colSize||(b=!0)}),b){var c=Math.max(1,Math.floor(12/a.$items.length)),d=a.$items.length-1,e=0;a.$items.forEach(function(a,b){b===d&&(c=12-e),a.$colSize=c,e+=c})}},m=function(a){a.$items.length||a.$items.push({$type:"accordion-group"}),a.$items.forEach(function(a,b){a.$type="accordion-group",a.$title=a.$title||{},a.$title.value=a.$title.value||"No title"})},n=function(a){if("accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(!b.$items)return!1}return!0},/*_hasBorder = function(layout) {
        },*/
o=function(a){return"accordion"===a.$type&&!a.$format},p=function(a){var b=!0;return a.$items.length?(a.$items.forEach(function(a){b&&(b=!o(a))}),b):b},q=function(a){if(a.$type&&!a.$items&&(a.$items=[]),"row"===a.$type||"accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(b.$type||b.$items)return!1}return!0},r=function(a,b,d){c.parseStyle(a.$style,b),!d.design&&a.$isHidden&&b.push("bs-none")},s=function(a){return!a.$items||!a.$items.length||a.$items[0].$bind},t=function(a,b,c){var d,e,f=[];switch(a.$type){case"block":e=!0,c.design&&a.selected&&f.push("selected"),d=n(a),d&&((c.design||p(a))&&(e=!1,b&&f.push("no-x-padding")),c.design&&(f.push("drop-layouts-zone"),"row"===a.$origin&&f.push("row-color"))),q(a)&&(!a.$inline||!c.design&&a.$html||f.push("form-inline bs-inline-container"),c.design&&(f.push("drop-fields-zone"),d||(e=!1,b&&f.push("no-x-padding")))),e&&f.push("field-container"),b||(f.push("bs-root-container"),a.form||f.push("page")),c.design&&(f.push("design"),a.selected&&f.push("selected")),r(a,f,c);break;case"accordion":1===c.step&&(f.push("panel-group"),c.design&&(f.push("design"),a.selected&&f.push("selected")),r(a,f,c));break;case"row":1===c.step?(f.push("container-fluid"),c.design&&(f.push("design"),f.push("no-x-padding"),a.selected&&f.push("selected")),r(a,f,c)):2===c.step&&(f.push("row"),c.design&&(f.push("design-table"),f.push("row-color"),d=n(a),d&&f.push("drop-layouts-zone")));break;case"accordion-group":1===c.step?(f.push("panel panel-default"),c.design&&(f.push("design"),a.selected&&f.push("selected"))):2===c.step?(f.push("panel-collapse collapse"),a.opened&&f.push("in")):3===c.step&&(f.push("panel-body"),d=n(a),d&&((c.design||p(a))&&(f.push("no-x-padding"),f.push("no-y-padding")),c.design&&f.push("drop-layouts-zone")),q(a)&&(!a.$inline||!c.design&&a.$html||f.push("form-inline bs-inline-container"),c.design&&(f.push("drop-fields-zone"),d||f.push("no-x-padding"))),r(a,f,c));break;case"column":1===c.step?(c.design?f.push("col-design col-xs-"+a.$colSize):a.$customColSize?f.push(a.$customColSize):f.push("col-"+(a.$colType||"sm")+"-"+a.$colSize),f.push("no-x-padding")):2===c.step&&(e=!0,f.push("container-fluid"),d=n(a),d&&((c.design||p(a))&&(e=!1,f.push("no-x-padding")),c.design&&!a.$auto&&f.push("drop-layouts-zone")),q(a)&&(!a.$inline||!c.design&&a.$html||f.push("form-inline bs-inline-container"),c.design&&(f.push("drop-fields-zone"),d||(f.push("no-x-padding"),e=!1))),e&&f.push("field-container"),c.design&&(f.push("design col"),a.$auto&&f.push("auto"),a.selected&&f.push("selected")),r(a,f,c));break;case"html":c.design&&(f.push("design"),a.selected&&f.push("selected")),r(a,f,c)}return f},u=function(a,b,d,e){var f,g=t(b,d,e);a.className=g.join(" "),"accordion-group"===b.$type&&1===e.step?(f=c.find(a,b.$id+"_title"),f&&c.text(f,b.$title&&b.$title.value?b.$title.value:"")):"html"===b.$type&&1===e.step&&(a.innerHTML=b.$html||"")},v=function(a,b,c,d){var e=t(b,c,d);e.length&&(a.push(' class="'),a.push(e.join(" ")),a.push('"'))},w=function(a,b,c){a.push(' id="'),a.push(c?c+"_"+b.$id:b.$id),a.push('"')},x=function(a,b,c){c&&(a.push(' data-level="'),a.push(b),a.push('"'))},y=function(a,b,c,d,e){if((e||d)&&(a.push(' data-layout="'),a.push(c.$id),a.push('"'),c.$idSelect=null),e||d&&b>1){var f=c["$idStep"+b];f&&(a.push(' id="'),a.push(f),a.push('"'))}},z=function(a,b,e,g){if(g&&b.$title){var h=b.$title.size||4;a.push("<h"+h);var i=["bs-block-title"];b.$title.$style&&c.parseStyle(b.$title.$style,i),a.push(' data-ignore="true" class="'+i.join(" ")+'">'),b.$title.value&&a.push(d.escapeHtml(f.tt(b.$title.value,e))),a.push("</h"+h+">")}},A=function(a,b,c,d,e,f,g,h){a.push("<div"),f&&a.push(' draggable="true"'),v(a,b,c,{design:f,step:1}),y(a,1,b,f),w(a,b),x(a,1,f),a.push(">"),z(a,b,e,g)},B=function(a,b,c,d,e,f){a.push("</div>")},C=function(a,b,e,f,g,h){a.push(d.format('<div id="{0}_settings" class="bs-cursor-p bs-layout-detail" data-layout-detail="true"><span class="'+c.iconClass("cog")+'"></span></div>',b.$id))},D=function(a,b,c,d,e,f,g){a.push("<div"),f&&a.push(' draggable="true"'),v(a,b,c,{design:f,step:1}),y(a,1,b,f),w(a,b),x(a,1,f),a.push(">"),b.$html&&a.push(b.$html)},E=function(a,b,c,d,e){a.push("</div>")},F=function(a,b,c,d,e,f,g,h){a.push('<div role="tablist" aria-multiselectable="true"'),f&&a.push(' draggable="true"'),v(a,b,c,{design:f,step:1}),y(a,1,b,f),w(a,b),x(a,1,f),a.push(">"),m(b)},G=function(a,b,c,d,e,f){a.push("</div>")},H=function(a,b,c,e,f,g,h,i){a.push("<div"),v(a,b,c,{design:g,step:1}),w(a,b),b.$idStep2=b.$id+"_s2",b.$idStep3=b.$id+"_s3",b.$idDesign=b.$idStep3,a.push(">"),a.push('<div class="panel-heading" role="tab"'),w(a,b,"heading"),a.push(">"),a.push('<h4 class="panel-title bs-pointer collapsed" data-toggle="collapse" data-parent="#'+c.$id+'"'),b.opened?a.push(' aria-expanded="true"'):a.push(' aria-expanded="false"'),a.push(' data-target="#'+b.$idStep2+'" aria-controls="'+b.$idStep2+'"'),a.push(' id="'+b.$id+'_title">'),a.push(d.escapeHtml(b.$title?b.$title.value:"")),a.push("</h4>"),a.push("</div>"),a.push('<div role="tabpanel" aria-labelledby="heading_'+b.$id+'"'),v(a,b,c,{design:g,step:2}),y(a,2,b,g,!0),x(a,2,g),a.push(">"),a.push("<div"),v(a,b,c,{design:g,step:3}),y(a,3,b,g,!0),a.push(">")},I=function(a,b,c,d,e,f){a.push("</div></div></div>")},J=function(a,b,c,d,e,f,g,h){a.push("<div"),f&&a.push(' draggable="true"'),v(a,b,c,{design:f,step:1}),w(a,b),y(a,1,b,f),x(a,1,f),a.push(">"),b.$idStep2=b.$id+"_s2",b.$idDesign=b.$idStep2,a.push("<div"),v(a,b,c,{design:f,step:2}),y(a,2,b,f),x(a,2,f),a.push(">"),l(b)},K=function(a,b,c,d,e,f){a.push("</div></div>")},L=function(a,b,c,d,e,f,g,h){a.push("<div"),v(a,b,c,{design:f,step:1}),y(a,1,b,f),w(a,b),x(a,1,f),a.push(">"),a.push("<div"),v(a,b,c,{design:f,step:2}),f&&a.push(' draggable="true"'),b.$idDesign=b.$id+"_design",b.$idDrag=b.$id,b.$idStep2=b.$idDesign,y(a,2,b,f),x(a,2,f),b.$idSelect=b.$idDesign,a.push(">"),z(a,b,e,g)},M=function(a,b,c,d,e,f){a.push("</div></div>")},N=function(a,b,c,d,e){if(a){if(d&&!a.$type&&!a.$items)return void c(a,b,!1,!0,e);c(a,b,!0,!0,e),e&&e.stop||(q(a)?a.$items&&a.$items.forEach(function(b){c(b,a,!1,!0,e)}):a.$items&&a.$items.forEach(function(b){N(b,a,c,!1,e)})),c(a,b,!0,!1,e)}},O=function(a,b,c,d,e){a.push('<div class="bs-island'+(e.design?" design":"")+(b.$config?" bs-widget":" bs-field")+(b.selected?' selected"':'"')),e.design&&a.push(' draggable="true"'),a.push(' data-render="'+b.$id+'"'),a.push(' id="'+b.$id+'"'),a.push("></div>")},P=function(a,b,c,d,e){a.push('<div id="'+b.$id+'"></div>')},Q=function(a,b,c,e,f){var h=g.get(f.context,"widget")||P,i=g.get(f.context,"field")||O,k=a.form,l={html:c};N(a,null,function(a,c,g,l,m){if(g){var n=A,o=B;switch(a.$type){case"row":n=J,o=K;break;case"column":n=L,o=M;break;case"accordion":n=F,o=G;break;case"accordion-group":n=H,o=I;break;case"html":n=D,o=E}l?(a.$ref&&f.design&&(m.stop=!0),n(m.html,a,c,b,e,f.design,k,m.stop),m.stop&&C(m.html,a,c,b,e,f.design),j(a)||(a.oldHtml=m.html,m.html=[])):(j(a)||(a.$content=m.html,m.html=a.oldHtml,delete a.oldHtml),!f.design&&a.$html&&a.$items&&a.$items.length&&q(a)&&m.html.push(d.format(a.$html.replace(/id="/g,'id="{0}_'),a.$id)),o(m.html,a,c,b,e,f.design),a.$ref&&f.design&&(m.stop=!1))}else a.$config?h(m.html,a,c,b,f):i(m.html,a,c,b,f)},!0,l)},R=function(a,b){return!a.$auto&&("column"!==a.$type||1!==b)},S=function(a,b,c,d,e,f){N(a,b,function(a,b,g,h){h&&(g?i(a,b,c,e):k(a,b,d,f))},!0)},T=function(a,b){N(a,null,function(c,d,f,g){g&&(f?(b&&delete c.$id,delete c.$render,delete c.$idDesign,delete c.$idDrag,delete c.$idSelect,delete c.$parentId,delete c.$idStep2,delete c.$idStep3,delete c.selected,"column"===c.$type?delete c.$type:"html"===a.$type&&a.$html===e.Html&&delete a.$html):(delete c.$render,b&&delete c.$id,delete c.$parentId,delete c.$idDrag,delete c.selected,c.$config&&(c.$config.data&&(delete c.$config.data.ds,Object.keys(c.$config.data).length||delete c.$config.data),(c.$config.$titleIsHidden||c.$config.$dontSaveTitle)&&delete c.$config.$title)))},!0)},U=function(a,b,c,d,e){N(a,null,function(a,f,g,h){h&&(g?(delete b[a.$id],delete d[a.$id]):(delete c[a.$id],delete e[a.$id]))},!0)},V=function(a,b,c,d,e){"row"===a.$type?(a.$items.forEach(function(a){a.$type="column",delete a.$colSize}),l(a),a.$items.forEach(function(f){S(f,a,b,c,d,e)})):"accordion"===a.$type&&(m(a),a.$items.forEach(function(f){S(f,a,b,c,d,e)}))},W=function(a,b,c,d){var e=[];return Q(a,b,e,c,d),e.join("")};b.check=S,b.layoutVisible=j,b.clearMeta=T,b.clearMaps=U,b.afterRemoveChild=V,b.canSelect=R,b.updateCssClass=u,b.toHtml=W}(b=a.LayoutUtils||(a.LayoutUtils={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="./module.ts" />
/// <reference path="./datasets-plugin.ts" />
/// <reference path="./page.control.ts" />
/// <reference path="./layout.ts" />
/// <reference path="./menu.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=a.utils,e=(a.locale,a.WidgetUtils,a.link),f=a.render,g=a.ipc,h=a.LayoutUtils,i=function(a){for(var b=a.length;b--;)for(var c=a[b],d=Object.keys(c),e=d.length;e--;){var f=c[d[e]];if(f.selected)return f}return null},j=function(){function a(a,b,c,d,e){this.$locale=null,this._init(a,b)}/* Start datasets methods */
/* End datasets methods */
//convert blocks to columns
return a.prototype._afterCreate=function(){},a.prototype._init=function(a,c){
//Layout
var f=this;f.$element=null,f.$content=null,f.options=c||{},f.options.context=f.options.context||"javascript",f.map={},f.mapFields={},f.namedMap={},f.namedMapFields={},a=a||{},h.check(a,null,f.map,f.mapFields,f.namedMap,f.namedMapFields),f.data=a,f.data.form=f.options.form,a.map=f.map,a.fields=f.mapFields,f.children={},//Is used only in javascript mode to cleanup children
f.controls={},// list of instanced modules or controls   
f.expressionTitle=!1;var g=f.options.form;g||(f.page=b.Page(),f.page.setPopup(null),f.page.addChild("layout",f),f.options.design||(f.expressionTitle=d.hasExpression(a.$title),f.page.props.$title=a.$title?d.parseExpression(a.$title,e.context()):null)),f._setDesignListeners(),f.pageLayoutInit()},a.prototype.pageLayoutInit=function(){},a.prototype.getSchema=function(a){return null},a.prototype.getLookupForSchema=function(a,b){return null},a.prototype._setDesignListeners=function(){},a.prototype._removeEvents=function(){var a=this;a._removeBaseEvents()},a.prototype._addEvents=function(){var a=this;a._addBaseEvents()},a.prototype._removeBaseEvents=function(){var a=this;a._removeAccordionEvents()},a.prototype._addBaseEvents=function(){var a=this;a._setAccordionEvents()},a.prototype._onSelectedChanged=function(a,b,c){},a.prototype._showSelected=function(a,b){},a.prototype._setAccordionEvents=function(){var a=this;a.$element.on("show.bs.collapse hide.bs.collapse",function(b){var c=b.target;if(c&&c.hasAttribute("data-layout")){var d=c.getAttribute("data-layout"),e=a.getLayoutById(d);if(e){var f="show"==b.type;if(e.opened==f)return;if(f){var g=a.getLayoutById(e.$parentId);if(g)for(var h=0,i=g.$items.length;h<i;h++){var j=g.$items[h];if(j.opened){j.opened=!1,a._activateLayout(j,!1);break}}e.opened=f,e.$content?a._renderLayoutContent(e):a._activateLayout(e,!0)}else a._activateLayout(e,!1)}}})},a.prototype._doDatasetEventAfterEnabled=function(a){},a.prototype._activateLayout=function(a,b){var c,d=this;b?(c=d._getVisibleChildren(a),c.forEach(function(a){a.disabled=!1,d._doDatasetEventAfterEnabled(a)})):(
// disable all childrens
c=d._getChildrenOf(a),c.forEach(function(a){a.disabled=!0}))},a.prototype._removeAccordionEvents=function(){var a=this;a.$element.off("show.bs.collapse hide.bs.collapse")},a.prototype.toString=function(a){return null},a.prototype.emit=function(a,b,c){this.emitDataEvent(a,b,c)},a.prototype.openErrors=function(){var a=this;if(a.$element){var b=c.find(a.$element.get(0),a.data.$id+"_error");b&&b.firstChild&&c.removeClass(b.firstChild,"bs-none")}},a.prototype._renderLayout=function(a){var b=this,c=$(h.toHtml(a,null,b.$locale,{design:b.options.design,context:b.options.context}));return b.afterRender(c),b._renderChildren(c),b.afterRenderChildren(c),c},a.prototype.afterRenderChildren=function(a){},a.prototype.isChildOf=function(a,b){for(var c=this,d=c.map[a];d;){if(d==b)return!0;d=c.map[d.$parentId]}return!1},a.prototype._isChildVisibleOf=function(a,b){for(var c=this,d=c.map[a];d;){if(!h.layoutVisible(d))return!1;if(d==b)return!0;d=c.map[d.$parentId]}return!1},a.prototype._getVisibleChildren=function(a){var b=this,c=[];return Object.keys(b.controls).forEach(function(d){var e=b.controls[d];b.controls[d].item&&b._isChildVisibleOf(b.controls[d].item.$parentId,a)&&c.push(e)}),c},a.prototype._getChildrenOf=function(a){var b=this,c=[];return Object.keys(b.controls).forEach(function(d){var e=b.controls[d];b.controls[d].item&&b.isChildOf(b.controls[d].item.$parentId,a)&&c.push(e)}),c},a.prototype._getEventListFor=function(a){
//var that = this;
var b=[];return a.forEach(function(a){a.datasets&&Object.keys(a.datasets).forEach(function(c){var d=a.datasets[c];d.enumTriggers&&d.enumTriggers(!1,function(a){b.indexOf(a)<0&&b.push(a)})})}),b},a.prototype._refreshDataSets=function(a){},a.prototype._renderLayoutContent=function(a){var b=this,d=c.find(b.$element.get(0),a.$idDesign);if(d){var e=$(d),f=$(a.$content.join("")),g=d.parentNode,h=d.nextSibling;e.detach(),e.append(f),delete a.$content,b.options.beforeAdd&&b.options.beforeAdd(e,!0),g.insertBefore(d,h),b._renderChildren(e);var i=b._getVisibleChildren(a);b._refreshDataSets(i)}},a.prototype._isVisible=function(a){for(var b=this;;){if(!a)return!0;var c=b.map[a];if(!c)return!0;if(!h.layoutVisible(c))return!1;a=c.$parentId}},a.prototype._renderChildren=function(a){var b=this,d=[],e=a.get(0),g=f.get(b.options.context,"widget.control"),h=f.get(b.options.context,"field.control");
// only on javascript mode
return(g||h)&&Object.keys(b.mapFields).forEach(function(a){if(!b.children[a]){var f=b.mapFields[a];if(b._isVisible(f.$parentId)){var i=f.$config?g:h,j=i==h;if(j){var k=0===(f.$bind||"").indexOf("$$"),l=b.getSchema(f.$bind),m=void 0;l||k||console.log('Schema not found for field "'+f.$bind+'".'),f&&f.$lookup&&(m=b.getLookupForSchema(f.$bind,f.$lookup)),i=i?i(f,l,m):null}if(i){var n,o={context:b.options.context,design:b.options.design,replaceParent:!0,readOnly:f.$readOnly};n=j?new i(f,o,b):new i(f,o,b);var p=void 0;if(b.options.design||!f.$htmlParent)p=c.find(e,f.$id);else if(p=c.find(e,f.$parentId+"_"+f.$htmlParent)){o.replaceParent=!1;var q=c.find(e,f.$id);q&&c.remove(q)}else p=c.find(e,f.$id);n.render($(p)),b.children[a]=n,b.controls[a]=n,n.resize&&(b.resizeList=b.resizeList||[],b.resizeList.push(n)),d.push(n)}}}}),d},a.prototype._clearChildren=function(){var a=this,b=a.children;a.children={},a.controls={},a.resizeList=null,Object.keys(b).forEach(function(a){var c=b[a];c.destroy()})},a.prototype._refreshSelected=function(){var a=this;if(a.options.design){var b=i([a.map,a.mapFields]);a._onSelectedChanged(a.$element.get(0),b,!0)}},a.prototype.registerDataListener=function(a){var b=this;b.page&&b.page.registerDataListener(a,b)},a.prototype.removeDataListener=function(a){var b=this;b.page&&(a==b?b.page.removeParentDataListener(b):b.page.removeDataListener(a))},a.prototype.emitDataEvent=function(a,b,c){var d=this;d.page&&d.page.emitDataEvent(a,b,c)},a.prototype.afterRender=function(a){},a.prototype._internalRender=function(a,b){var d=this;return d.$element||(d.$element=d._renderLayout(d.data),d.options.beforeAdd&&d.options.beforeAdd(d.$element,b),d.$content.append(d.$element),d._addEvents(),d._refreshSelected(),a&&(d.options.form||c.bodyTheme(d.data.$theme),d.options.replaceParent?a.replaceWith(d.$content):a.append(d.$content),d.afterAddedInDom())),d.$content},a.prototype.afterAddedInDom=function(){},a.prototype._callInternalRender=function(a,b){var c=this;c._internalRender(a,b)},a.prototype.render=function(a){var b,c=this;return c.$content?c.$element&&(b=!0,c._clearChildren(),c._removeEvents(),c.options.beforeRemove&&c.options.beforeRemove(c.$element),c.$element.remove(),c.$element=null):c.$content=$("<div></div>"),c._callInternalRender(a,b),c.$content},a.prototype._destroyDataSets=function(){},a.prototype.destroy=function(){var a=this;d.log("Destroy Layout","destroy"),a._destroyDataSets(),g.unlisten(a),a.removeDataListener(a),a._clearChildren(),a.page&&(a.page.removeChild(a),a.page=null),a.$element&&(a._removeEvents(),a.$element=null),a.map=null,a.mapFields=null,a.namedMap=null,a.namedMapFields=null,h.clearMeta(a.data,!1)},a.prototype.check=function(a,b){var c=this,d=!1;a||(c.map={},c.mapFields={},c.namedMap={},c.namedMapFields={},b=null,a=c.data,d=!0),h.check(a,b,c.map,c.mapFields,c.namedMap,c.namedMapFields),d&&(a.fields=c.mapFields,a.map=c.map)},a.prototype._afterStructureChanged=function(a){var b=this;b.render()},a.prototype._afterPropsChanged=function(a){var b=this;if(this.$element){var d=this.$element.get(0);if(d){var e=c.find(d,a.$id),f=a.$id!=a.$idStep2?c.find(d,a.$idStep2):null,g=a.$idStep3?c.find(d,a.idStep3):null;e&&h.updateCssClass(e,a,b.getLayoutById(a.$parentId),{design:b.options.design,step:1}),f&&h.updateCssClass(f,a,b.getLayoutById(a.$parentId),{design:b.options.design,step:2}),g&&h.updateCssClass(g,a,b.getLayoutById(a.$parentId),{design:b.options.design,step:3}),a.selected&&b._refreshSelected()}}},a.prototype.removeChild=function(a){var b=this;if(a&&b.options.design){var c=b.map[a]||b.mapFields[a];if(c){var d=b.map[c.$parentId];if(d&&(!d.$auto||(c=d,d=b.map[c.$parentId]))){var e=d.$items.indexOf(c);d.$items.splice(e,1),h.clearMaps(c,this.map,this.mapFields,b.namedMap,b.namedMapFields),h.afterRemoveChild(d,b.map,b.mapFields,b.namedMap,b.namedMapFields),b._afterStructureChanged(d)}}}},a.prototype.setDesignMode=function(a){var b=this;b.options.design!=a&&(b.options.design=a,b.render())},a.prototype.getLayoutById=function(a){if(!a)return null;var b=this;return b.map[a]},a.prototype.getFieldById=function(a){if(!a)return null;var b=this;return b.mapFields[a]},a.prototype.select=function(a){var b=this,c=b.$element;if(b.options.design){var d=i([b.map,b.mapFields]);if(d&&(d.selected=!1,b._showSelected(c,d),b._onSelectedChanged(c.get(0),d,!1),d.$id==a))return void b._onSelectedChanged(c.get(0),null,!0);if(a){var e=b.map[a]?b.map[a]:b.mapFields[a];e&&(e.selected=!0,b._showSelected(c,e),b._onSelectedChanged(c.get(0),e,!0))}}},a.prototype.updateField=function(a,b){var c=this,e=c.mapFields[a];if(e)if(e.$render&&e.$config)Object.keys(b.$config).forEach(function(a){"form"!==a&&"data"!==a&&"datasets"!==a&&e.$render[a]!=b.$config[a]&&(e.$render[a]=b.$config[a])}),(e.$config.hasOwnProperty("form")||b.$config.hasOwnProperty("form"))&&(e.$config.form=b.$config.form),e.$config.datasets=b.$config.datasets,e.$config.data=b.$config.data,c._afterStructureChanged(null);else{if(d.equals(e,b))return;var f=Object.keys(b),g=Object.keys(e);f.forEach(function(a){e[a]=b[a]}),f.push("$id"),f.push("$parentId"),f.push("$idDrag"),g.forEach(function(a){f.indexOf(a)<0&&delete e[a]});var h=c.children[a];h&&(delete c.controls[a],delete c.children[a],h.destroy()),c._afterStructureChanged(null)}},a.prototype._cleanIds=function(a){a.$idDesign=null,a.$idDrag=null,a.$idSelect=null,a.$idStep2=null,a.$idStep3=null},a.prototype._blockToCols=function(a){var b=this;a.$items&&a.$items.forEach(function(c,d){var e=c.$origin||c.$type;if("block"===e||"column"===e)c.$type="column",b._cleanIds(a);else{({$items:[c],$auto:!0,$type:"column",$colSize:c.$colSize,$customColSize:c.$customColSize})}})},a.prototype._changeType=function(a,b){var c=this,d=c.map[a.$parentId],e=d&&d.$auto?c.map[d.$parentId]:null,f=a.$origin||a.$type;switch(f){case"block":"row"===b&&(a.$type=b,c._blockToCols(a),c._cleanIds(a),c.check(a,d));break;case"column":if("row"===b){var g={$items:a.$items,$type:b,selected:!1};a.$auto=!0,a.$type="column",a.$items=[g],a.selected&&(a.selected=!1,g.selected=!0),c._blockToCols(g),c._cleanIds(a),c.check(a,d)}break;case"row":if("block"===b){if(e){var h=e.$items.indexOf(d);e.$items[h]=a,a.$type=d.$type,a.$parentId=e.$id,"column"==d.$type&&(a.$colSize=d.$colSize,a.$customColSize=d.$customColSize),d=e}else a.$type=b;a.$origin&&delete a.$origin,a.$items&&a.$items.forEach(function(b,d){if(b.$type)if(b.$auto){var e=b.$items[0];e.$colSize=b.$colSize,e.$customColSize=b.$customColSize,e.$parentId=a,a.$items[d]=e,c._cleanIds(b)}else b.$type="block",c._cleanIds(b)}),c._cleanIds(a),c.check(a,d)}break;case"accordion":}},a.prototype.updateIsHidden=function(a,b){var c=this;a.$isHidden!==b&&(a.$isHidden=b,c._afterPropsChanged(a))},a.prototype.updateLayout=function(a,b){var c=this,e=c.map[a],f=!1,h=!1,i=!1;if(e){if(delete b.onlyFields,b.$type){var j=e.$origin||e.$type;b.$type!==j&&(c._changeType(e,b.$type),delete b.$type,f=!0)}if(b.parent){var k=c.map[e.$parentId];c._disableRules=!0,Object.keys(b.parent).forEach(function(a){b.parent[a]!==k[a]&&(k[a]=b.parent[a],f=!0)}),c._disableRules=!1,delete b.parent}if(delete b.selected,c._disableRules=!0,e.$title&&!b.$title?(delete e.$title,f=!0):!e.$title&&b.$title?(delete e.$title,e.$title=b.$title,delete b.$title,f=!0):e.$title&&b.$title&&(Object.keys(b.$title).forEach(function(a){b.$title[a]!=e.$title[a]&&(e.$title[a]=b.$title[a],f=!0)}),delete b.$title),(e.$inline||!1)!==(b.$inline||!1)&&(e.$inline=b.$inline,h=!0,e.$items.length&&(f=!0),delete b.$inline),d.equals(e.$fieldsOptions,b.$fieldOptions)||(e.$fieldsOption=b.$fieldOptions,h=!0,e.$items.length&&(f=!0)),delete b.$fieldOptions,(e.$refProperty||"")!==(b.$refProperty||"")&&(e.$refProperty=b.$refProperty,f=!0),(e.$ref||"")!==(b.$ref||"")&&(e.$ref=b.$ref,e.$ref?(delete e.name,delete e.form,delete e.$fieldsOption,i=!0):(delete e.$refProperty,delete e.name,delete e.form),e.$items=[],f=!0),delete b.$ref,delete b.$refProperty,Object.keys(b).forEach(function(a){b[a]!==e[a]&&(e[a]=b[a],h=!0)}),c._disableRules=!1,f){if(i)return g.emit("LoadNestedLayouts",{data:e,after:function(a){d.merge(a,e);var b=c.map[e.$parentId];c._cleanIds(e),c.check(e,b),c._afterStructureChanged(e)}});c._afterStructureChanged(e)}else h?c._afterPropsChanged(e):c._refreshSelected()}},a}();b.BaseLayout=j;var k=function(a){function c(){a.apply(this,arguments)}
//implements DatasetMethods
return __extends(c,a),c.prototype.ds_init=function(a){return!1},c.prototype.ds_storeLastEvent=function(a,b){},c.prototype.ds_LastEvent=function(){return null},c.prototype.ds_destroy=function(){},c.prototype.ds_context=function(){return null},c.prototype.ds_reemit=function(a,b){return null},c.prototype.ds_select=function(a,b){},c.prototype.ds_loaded=function(a,b){},c.prototype.ds_exec=function(a,b,c,d,e,f){},c.prototype.pageLayoutInit=function(){var a=this;
//datasets
a.loadingHandler=null,a.noDataHandler=null,a.errorHandler=null,a.emitHandler=null,a.getLocalContextHandler=null,a.dataChangedHandler=null,a.updateMenuHandler=this.updateMenu.bind(a),a._removeMenus(),a.ds_init&&a.ds_init(a.data)&&a.registerDataListener(a)},c.prototype._doDatasetEventAfterEnabled=function(a){if(a.ds_LastEvent&&a.dataEvent){var b=a.ds_LastEvent();b&&a.dataEvent(b.event,b.value)}},c.prototype._refreshDataSets=function(a){
//list --> list of new visible "datasets listeners"
var b=this;if(b.page){var c=b._getEventListFor(a);if(c.length){var d=b.page.emittersFor(c);
//reemit events
d.forEach(function(b){b.ds_reemit&&b.ds_reemit(a,function(){})})}}},c.prototype._callInternalRender=function(a,b){var c=this;c.datasets&&c.ds_exec?c.ds_exec("$load",null,c.props.data.ds,function(d,e){if(e)throw e.message;c._internalRender(a,b)},null,!0):c._internalRender(a,b)},c.prototype._destroyDataSets=function(){var a=this;a.ds_destroy&&a.ds_destroy()},c.prototype._removeMenus=function(){var a=this,b=["left","right","top","bottom"];
//var menus = [];
b.forEach(function(b){if(!a.data.$menus||!a.data.$menus[b]){var c=a.page.childByType("menu-"+b);c&&c.setMenu(null)}})},c.prototype.updateMenu=function(a,c){var e=this;d.log("From Layout Update Menu : "+(c?c.name:"null"),"menu");var f=e.page.childByType("menu-"+a);if(f)return void f.setMenu(c);var g=null;if("right"==a?g=b.Menuright:"left"==a&&(g=b.Menuleft),g){var h={type:a,bodyId:null,parentId:null},i=e.page.childByType("header");i&&(i.options.bodyId&&(h.bodyId=i.options.bodyId),i.options[h.type+"MenuPlace"]&&(h.parentId=i.options[h.type+"MenuPlace"])),f=new g(c,h)}},c}(j);b.PageLayout=k,d.applyMixins(k,[a.DatasetPlugin.DatasetMethods]);var l=function(a){function b(b,c,d,e,f){a.call(this,b,c,d,e,f)}return __extends(b,a),b}(k);b.Layout=l,b.LayoutClass=l}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/modules/locale.ts" />
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/ajax.ts" />
/// <reference path="../../core/modules/application.ts" />
/// <reference path="../../data/datasets.ts" />
/// <reference path="../datasets-plugin.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,d,e,f,g,h){g(d,a,b,f,e)&&Object.keys(a.properties).forEach(function(e){var i=a.properties[e];if(!i.$reference)if("object"===i.type){var j=d?d+"."+e:e;c(i,b,j,!1,f?f[e]:null,g,h)}else if("array"===i.type){var k=r(i.items,b);if("object"===k.type){var j=d?d+"."+e:e;c(k,b,j,!0,f?f[e]:null,g,h)}}})}var d="#/definitions/",e=d.length,f="$select";b.EXPANDED_FIELD_NAME="$expand";var g=a.ulocale,h=(a.application,a.ajax,a.dom),i=(a.link,a.data),j=a.utils,g=a.ulocale,k=a.locale,l=a.customData,m=a.locale.schema,n=a.DatasetPlugin,o=function(){var a={};return{register:function(b,c){a[b]=c},get:function(b){return a[b]}}},p=function(){var a={};return{register:function(b,c){a[b]=c},get:function(b){return a[b]}}},q=function(a){if(!a.features){a.features={};var b=void 0===a.capabilities?"filtrable,sortable":a.capabilities;b&&b.split(",").forEach(function(b){a.features[b]=!0})}},r=function(a,b){if(a.$ref){var c=a.$ref.substr(e),d=b.definitions?b.definitions[c]:null;if(!d)throw"Schema $ref not found : "+a.$ref;return d}return a},s=p(),t=o(),u={_getDefault:function(a){return"@date"==a?g.date2ISO(new Date):a},checkLookup:function(a){return a?(a=$.extend({},a),a.data&&"odata"==a.data.$type||(a.pagination=!1,a.cache=!0),a.pagination!==!1&&(a.pagination=!0),a.pagination&&(a.cache=!1),a):null},schema2Authoring:function(a,b,d){var e=[];return c(a,b,"",!1,null,function(a,b,c,f,h){return!h&&(Object.keys(b.properties).forEach(function(f){var h=b.properties[f];if(u.inModel(h,c)&&!u.isCompositionRef(h,c))
//if (_sutils.isCompositionRef(ps) || _sutils.isCompositionList(ps)) return;
{var i=a?a+"."+f:f,j={$type:"field",$bind:i,$title:g.tt(h.title,d)||i,$widget:h.$widget,options:h.$widgetOptions};e.push(j)}}),b.links&&Object.keys(b.links).forEach(function(c){var f=b.links[c],h="$links."+c;h=a?a+"."+h:h;var i={$type:"action",$bind:h,$title:g.tt(f.title,d)||h,$widget:f.widget,options:f.$widgetOptions};e.push(i)}),!0)}),e},filtrableFields:function(a,b,d){var e=[];return c(a,b,"",!1,null,function(a,b,c,f,h){return!h&&(Object.keys(b.properties).forEach(function(f){var h=b.properties[f];if(u.inModel(h,c)&&!u.isCompositionRef(h,c)&&!u.isCompositionList(h,c,!0)){var i=a?a+"."+f:f;if(u.canFilter(h)){var k={name:i,schema:j.copy(h)};k.schema.title=g.tt(k.schema.title||"",d),e.push(k)}}}),!0)}),e},columns:function(a,b,d){var e=[];return c(a,b,"",!1,null,function(a,b,c,f,h){return!h&&(Object.keys(b.properties).forEach(function(f){var h=b.properties[f];if(u.inModel(h,c)&&!u.isCompositionRef(h,c)&&!u.isCompositionList(h,c,!0)){var i=a?a+"."+f:f;if(u.canShowField(h)){var k={name:i,schema:j.copy(h)};k.schema.title=g.tt(k.schema.title||"",d),e.push(k)}}}),!0)}),e},allData:function(a){return!a.pagination},pkFields:function(a){return Array.isArray(a)?a:a.split(",").map(function(a){return a.trim()})},entityId:function(a){if("object"==typeof a){return Object.keys(a).map(function(b){var c=a[b];return"string"==typeof c?b+"='"+c+"'":b+"="+c}).join(",")}return"string"==typeof a?"'"+a+"'":a+""},extractPkValue:function(a,b){if(1==b.length)return a[b[0]];var c={};return b.forEach(function(b){c[b]=a[b]}),c},odataId:function(a,b){if(1==a.length)return b[a[0]];var c=[];return a.forEach(function(a){c.push(a+"="+encodeURIComponent(b[a]+""))}),c.join(",")},pk2Id:function(a,b){return 1===b.length?a:JSON.stringify(a)},id2Pk:function(a,b){return 1===b.length?a:JSON.parse(a)},equals:function(a,b,c){if(1===c.length)return a===b[c[0]];for(var d=0,e=c.length;d<e;d++){var f=c[d];if(a[f]!==b[f])return!1}return!0},extractBase:function(a){var b=a.split(".");return b.pop(),b.length?b.join(".")+".":""},parentPath:function(a){var b=a.split(".");return b.pop(),b.length?b.join("."):""},findByPk:function(a,b,c){if(c&&a)for(var d=0,e=c.length;d<e;d++){var f=c[d];if(u.equals(a,f,b))return f}return null},supportPagination:function(a){
//TODO
return!1},executeLookup:function(a,b,c){var d=i.execData(a.data,b,null);return c?void(d?d.then(c):c(null)):d},remoteSearch:function(a,b){return b.mapping?b.mapping[a]:a},lastSegment:function(a,b){var c=a.split("."),d=c.pop();return b&&b!=a&&(d=b.substring(c.join(".").length)),d},findFirst:function(a,b,c){if(!a||!c)return null;for(var d=a.toLocaleLowerCase(),e=d.length,f=0,g=c.length;f<g;f++){var h=c[f][b]||"";if(h.toLowerCase().substr(0,e)===d)return{item:c[f],index:f}}return null},_states:["$states","$links"],isMetaProp:function(a){return"$$"===a.substr(0,2)},removeMeta:function(a){Array.isArray(a)||Object.keys(a).forEach(function(b){u.isMetaProp(b)&&delete a[b]})},removeStates:function(a){Array.isArray(a)?a.forEach(function(a){a&&"object"==typeof a&&u.removeStates(a)}):(u._states.forEach(function(b){delete a[b]}),delete a.$errors,Object.keys(a).forEach(function(b){var c=a[b];c&&"object"==typeof c&&u.removeStates(c)}))},isMeta:function(a){var b="$$meta-".length;return"$$meta-"===a.substr(0,"$$meta-".length)?{widget:a.substr(b)}:null},getLookup:function(a,b,c,d){var e=a.split(".");e.pop();for(var f=c,g=0,h=e.length;g<h&&f;g++){var i=e[g];f="array"==f.type&&u.arrayProps.indexOf(i)>=0?r(f.items,d):f.properties?f.properties[i]:null}return f&&f.lookups?u.checkLookup(f.lookups[b]):null},getSchema:function(a,c,d,e){if(!a)return c;for(var g=a.split("."),h=c,i=!1,j=0,l=g.length;j<l&&h;j++){var m=g[j];if("array"==h.type&&u.arrayProps.indexOf(m)>=0)
// $item, $new 
h=r(h.items,d);else if("$links"===m)h=h.links,i=!0;else if(i)i=!1,h=h[m];else if(h=h.properties?h.properties[m]:null,!h&&j===l-1){if("$index"===m)return{type:"integer",title:"#",capabilities:null};if(m===f)return{type:"boolean",title:k.ui.Selected,capabilities:null};if(m===b.EXPANDED_FIELD_NAME)return{type:"integer",title:"",capabilities:null}}}return e&&h&&"array"===h.type&&h.items&&(h=r(h.items,d)),h},states:["isHidden","isDisabled","isReadOnly","isMandatory"],statesAndErrors:["isHidden","isDisabled","isReadOnly","isMandatory","errors","filter"],linksStates:["isHidden","isDisabled"],isLink:function(a){return a.split(".").indexOf("$links")>=0},_isMoney:function(a){return u.isNumber(a)&&"money"==a.format},_internalExtractEnums:function(a,b,c,d){if(a.name){if(d.indexOf(a.name)>=0)return;d.push(a.name)}var e=function(b,d){if(d=d||a,d.enums&&d.enums[b]){var e=d.enums[b].type||"default";c[e]=c[e]||{},c[e][b]=d.enums[b]}else{
//$enumref = "Satut.codif"
var f=b.split(".");2===f.length&&(c[f[1]]=c[f[1]]||{},c[f[1]][f[0]]={type:f[1]})}};a.lookups&&Object.keys(a.lookups).forEach(function(b){var c=a.lookups[b];"enum"==c.data.$type&&c.data.$enumref&&e(c.data.$enumref)}),Object.keys(a.properties).forEach(function(f){var g=a.properties[f];if(u.inModel(g,b))if(u.isCompositionRef(g,b))u._internalExtractEnums(g,b,c,d);else if(u.isCompositionList(g,b,!0))u._internalExtractEnums(r(g.items,b),b,c,d);else{var h=a;u.isSimpleList(g,b)&&(g=r(g.items,b),h=g),g.$enumref&&e(g.$enumref,h)}})},_extractEnums:function(a,b){return u._internalExtractEnums(a,a,b,[])},_fillEnums:function(a,b){u._internalFillEnums(a,a,b,[])},_internalFillEnums:function(a,b,c,d){if(a.name){if(d.indexOf(a.name)>=0)return;d.push(a.name)}a.lookups&&Object.keys(a.lookups).forEach(function(b){var d=a.lookups[b];if("enum"==d.data.$type&&d.data.$enumref){var e=d.data.$enumref.split("."),f=2===e.length?c[e[1]]:c[a.enums[d.data.$enumref].type||"default"],g=2===e.length?e[0]:d.data.$enumref;if(f){d.data.$value=[];var h=f[g];h["enum"].forEach(function(a,b){var c={code:a,title:h.enumNames[b]};h.fields&&j.extend(c,h.fields[b]),d.data.$value.push(c)})}}}),Object.keys(a.properties).forEach(function(e){var f=a.properties[e];if(u.inModel(f,b))if(u.isCompositionRef(f,b))u._internalFillEnums(f,b,c,d);else if(u.isCompositionList(f,b,!0))u._internalFillEnums(r(f.items,b),b,c,d);else{var g=a;if(u.isSimpleList(f,b)&&(f=r(f.items,b),g=f),f.$enumref){var h=f.$enumref.split(".");if(g.enums&&g.enums[f.$enumref]||2===h.length){var i=2===h.length?c[h[1]]:c[g.enums[f.$enumref].type||"default"],j=2===h.length?h[0]:f.$enumref;if(i){var k=i[j];k&&(f["enum"]=k["enum"],f.enumNames=k.enumNames,f.filters=k.filters)}}}}})},loadEnums:function(a){var b={};u._extractEnums(a,b);var c=Object.keys(b).map(function(a){var c=t.get(a);if(!c)throw"Invalid enum type: "+a;return c.promise(b[a],a)});return c.length?c:null},arrayProps:["$item","$new"],init:function(a,b,c,d){var e=d||{};return e.$states=e.$states||{},Object.keys(a.properties).forEach(function(d){var f=a.properties[d];if(u.inModel(f,b)){var g=u.isMetaProp(d),h=a.states?a.states[d]:null,i=e.$states[d]=e.$states[d]||{};if(g||h&&Object.keys(h).forEach(function(a){void 0===i[a]&&(i[a]=h[a])}),u.isCompositionRef(f,b))
// recursive	
i.isMandatory&&(e[d]=u.init(f,b,c,e[d]||{}));else if(u.isCompositionList(f,b,!1)||u.isSimpleList(f,b))e[d]=e[d]||[];else if(u.isList(f,b))e[d]=e[d]||[];else if(void 0===e[d])if(void 0!==f["default"])e[d]=u._getDefault(f["default"]);else if(f["enum"])e[d]=f["enum"][0];else switch(f.type){case"number":case"integer":e[d]=0}}}),e},
//
isCompositionRef:function(a,b){return"object"===a.type&&!a.$reference},isRef:function(a,b){return"object"===a.type&&a.$reference},isList:function(a,b){return"array"===a.type&&a.$reference},isCompositionList:function(a,b,c){if("array"===a.type&&a.items){var d=r(a.items,b);return("object"===d.type||"array"===d.type)&&(!a.$reference||c&&a.$reference)}return!1},isSimpleList:function(a,b){if("array"===a.type&&a.items){var c=r(a.items,b);return("object"!==c.type||"array"===c.type)&&!a.$reference}return!1},inModel:function(a,b){return!u.isRef(a,b)},formatNumber:function(a,b){return"money"==a.format?g.money(b,!1):g.decimal(b,a.decimals||0,null)},_title:function(a,b){return b?g.tt(a,b):a},canSort:function(a){return!!a&&(!a.hidden&&(q(a),a.features.sortable))},canShowField:function(a){return!a.hidden},canFilter:function(a){return!!a&&(!a.hidden&&(q(a),a.features.filtrable))},checkNumber:function(a,b,c,d){var e=!0;return b.exclusiveMinimum?void 0!=b.minimum&&a<=b.minimum&&(d.push({message:j.format(m.minNumberExclusive,u._title(b.title,c),u.formatNumber(b,b.minimum))}),e=!1):void 0!=b.minimum&&a<b.minimum&&(d.push({message:j.format(m.minNumber,u._title(b.title,c),u.formatNumber(b,b.minimum))}),e=!1),b.exclusiveMaximum?void 0!=b.maximum&&a>=b.maximum&&(d.push({message:j.format(m.maxNumberExclusive,u._title(b.title,c),u.formatNumber(b,b.maximum))}),e=!1):void 0!=b.maximum&&a>b.maximum&&(d.push({message:j.format(m.maxNumber,u._title(b.title,c),u.formatNumber(b,b.maximum))}),e=!1),e},_validateEmail:function(a,b){var c=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return c.test(a)},_validateJson:function(a,b){try{JSON.parse(a)}catch(c){return b.ex=c,!1}return!0},checkString:function(a,b,c,d,e){var f=!0,g=a||"";if(c.minLength&&g.length<c.minLength&&(e.push({message:j.format(m.minLength,u._title(c.title,d),c.minLength)}),f=!1),b.isMandatory&&""===g&&(e.push({message:j.format(m.required,u._title(c.title,d))}),f=!1),c.format)if("email"===c.format)a&&!u._validateEmail(a,{})&&(e.push({message:m.invalidEmail}),f=!1);else if("json"===c.format){var h={};a&&!u._validateJson(a,h)&&(e.push({message:h.ex.message}),f=!1)}return f},validatePassword:function(a,b,c,d,e,f){var g=!0;return d.isHidden||d.isDisabled?g:(a!==b&&(f.push({message:m.passwordMismatch}),g=!1),g)},validateSchema:function(a,b,c,d,e){var f=!0;if(c&&(c.isHidden||c.isDisabled))return f;switch(b.type){case"number":case"integer":f=u.checkNumber(a,b,d,e);break;case"string":f=u.checkString(a,c,b,d,e)}return f},loadEnumsPromise:function(a){var b=u.loadEnums(a);return b?j.Promise.all(b).then(function(b){var c={};return b.forEach(function(a){c[a.type]=a.enums}),u._fillEnums(a,c),a}):new j.Promise(function(b,c){b(a)})},loadSchemaRefs:function(a,b,c,d){if(!a)return d();var e=u.loadEnums(a),f=e?e:[],g=e?e.length:0,i=v.loadMainData(c);i&&f.push(i);var k=i?g+1:0;return f.length?(h.processing(!0),void j.Promise.all(f).then(function(c){h.processing(!1);var e={};c.forEach(function(a,c){c<g?e[a.type]=a.enums:c<k&&$.extend(!0,b,a)}),g&&u._fillEnums(a,e),d(b)})["catch"](function(a){throw h.processing(!1),a})):d(b)},stateProps:function(a){return a["enum"]&&a.filters?["filter"]:a.items&&a.items["enum"]&&a.items.filters?["filter"]:null},isPassword:function(a){return"string"===a.type&&"password"===a.format},isDate:function(a){return"string"===a.type&&"date"===a.format},isDateTime:function(a){return"string"===a.type&&"date-time"===a.format},isBoolean:function(a){return"boolean"===a.type},isSelectField:function(a){return a===f},isExpandField:function(a){return a===b.EXPANDED_FIELD_NAME},isNumber:function(a){return"number"===a.type||"integer"===a.type},isText:function(a){return"string"===a.type&&("json"===a.format||"memo"===a.format)},isMoney:function(a){return u.isNumber(a)&&"money"==a.format},text2Value:function(a,b){if(u.isNumber(b)){var c=u.isMoney(b)?k.number.places:b.decimals,d=g.string2Float(a);return d=parseFloat(d.toFixed(c))}return a},value2Text:function(a,b){return u.isNumber(b)?u.isMoney(b)?g.money(parseFloat(a||"0"),!1):g.decimal(a,b.decimals,null):a||""},expand$Ref:function(a,b){return r(a,b)},removeExpand:function(a,b){if(!b)return a;var c=b+".$item.",d=a.lastIndexOf(c);return d<0?a:a.substr(d+c.length)},registerValidator:s.register,getValidator:s.get,registerEnumManager:t.register,getEnumManager:t.get},v={extractDatasets:function(a){if(a.datasets){var b=Object.keys(a.datasets);if(b.length)return b.map(function(b){var c=$.extend({},a.datasets[b],!0);return c.name=b,c})}return null},isQuery:function(a){return!("odata"!==a.$type||a.$method&&"GET"!==a.$method.toUpperCase()||a.$params.hasOwnProperty("$entityId"))},isCreateOrUpdate:function(a){return"odata"===a.$type&&a.$params.hasOwnProperty("$entityId")},extractMainDataSource:function(a){var b=null;if(a.datasets){var c=Object.keys(a.datasets);c.length&&(c.forEach(function(c){a.datasets[c].$main&&(b=$.extend({},a.datasets[c],!0))}),b||(b=$.extend({},a.datasets[c[0]],!0)))}return b},datasetsAsPromise:function(a,b){return new j.Promise(function(c,d){var e={};h.processing(!0);var f=null;a.forEach(function(a){a.$main&&(f=a)}),f||(f=a[0]),v.isCreateOrUpdate(f)&&(f.$create=f.$create||{}),n.executeDatasets(a,{},e,{},function(a,g){if(h.processing(!1),g)d(g);else{if(b){var i=l.get(b);i&&i(e)}c(e[f.name])}})})},datasetAsPromise:function(a,b){return new j.Promise(function(c,d){var e={};a.name=a.name||"data",h.processing(!0),n.executeDatasets([a],b||{},e,{},function(b,f){h.processing(!1),f?d(f):c(e[a.name])})})},loadMainData:function(a){var b=v.extractDatasets(a);return b&&b.length?v.datasetsAsPromise(b,a.transform):j.Promise.resolve(null)},dsConfig:function(a,b,c){var d=b.$reference;if(a&&d){var e=Object.keys(a);if(1===e.length){var f=a[e[0]];return f.$main=!0,f}if("string"==typeof d)return a[d]}return null}},w={_enums:{},promise:function(a,b){var c={};return Object.keys(a).forEach(function(b){var d=a[b];w._enums[b]||(w._enums[b]={"enum":d["enum"],enumNames:d.enumNames,filters:d.filters}),c[b]=w._enums[b]}),new j.Promise(function(a,d){a({type:b,enums:c})})}};u.registerEnumManager("default",w),b.SchemaUtils=u,b.DataUtils=v}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a.SchemaUtils,c=function(){function a(a,b,c){}return a.prototype.destroy=function(){var a=this;a._state&&(a._state=null),a.parent=null},a.prototype.state=function(){return this._state},a.prototype._init=function(a,b,c,d){var e=this;d=d||[],e._state=c||{},e.name=b,e.parent=a,d.forEach(function(a){void 0===e._state[a]&&(e._state[a]=!1),Object.defineProperty(e,a,{get:function(){return this._state[a]||!1},set:function(b){var c=this,d=c._state[a]||!1;if(d!==b){if(c._state[a]=b,"filter"===a&&c.parent){var f=c.parent.getValue(e.name),g=c.parent.getSchema(e.name);if(g&&g["enum"]&&g.filters){var h=b?g.filters[b]:g["enum"];if(h){var i=h.indexOf(f);i<0&&c.parent.setValue(e.name,h.length?h[0]:null)}}}c.parent&&c.parent.notifyStateChanged&&c.parent.notifyStateChanged(e.name+"."+a,{})}},enumerable:!0})})},a}();a.BaseState=c;var d=function(a){function c(c,d,e){a.call(this,c,d,e);var f=c.getSchema("").properties[d],g=b.states;if(f){var h=b.stateProps(f);h&&h.length&&(g=h.concat(g))}this._init(c,d,e,g)}return __extends(c,a),c}(c);a.DataStates=d;var e=function(a){function c(c,d,e){a.call(this,c,d,e),this._init(c,"$links."+d,e,b.linksStates)}return __extends(c,a),c}(c);a.LinkStates=e}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b;!function(a){var b={errorChanged:function(a,b){if(a=a||[],b&&b.length){if(a.length!=b.length)return!0;for(var c=!1,d=0,e=a.length;d<e;d++){var f=a[d],g=b[d];if(f.code&&g.code){if(f.code!==g.code){c=!0;break}}else{if(!f.code||!g.code){c=!0;break}if(f.message!==g.message){c=!0;break}}}return c}if(a.length)return!0}},c=function(){function a(a,b,c,d){this._init(a,b,c,d)}return a.prototype.destroy=function(){var a=this;a._errors&&(a._errors=null),a.parent=null},a.prototype.errors=function(){return this._errors},a.prototype.clear=function(a){var b=this;return!!b._errors.length&&(b._errors.length=0,a&&b.notify(),!0)},a.prototype.hasErrors=function(){var a=this;return!(!a._errors||!a._errors.length)},a.prototype.addErrors=function(a,c){var d=this;d.nostore?d.parent&&d.parent.addErrors&&d.parent.addErrors(a,c):(c||b.errorChanged(d._errors,a))&&(d._errors=a||[],d.notify())},a.prototype.addError=function(a,b){var c=this;c.addErrors([{severity:"error",message:a}],b)},a.prototype.addSuccess=function(a,b){var c=this;c.addErrors([{severity:"success",message:a,timeout:2}],b)},a.prototype.addWarning=function(a,b){var c=this;c.addErrors([{severity:"warning",message:a,timeout:2}],b)},a.prototype.notify=function(){var a=this;a.parent&&a.parent.notifyStateChanged&&a.parent.notifyStateChanged(a.name+".errors",{})},a.prototype._init=function(a,b,c,d){var e=this;e._errors=c||[],e.name=b,e.parent=a,e.nostore=d},a}();a.Errors=c,a.errorsUtils=b}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="../datasets-plugin.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=a.dom,e=(b.SchemaUtils,b.DataUtils),f=a.DatasetPlugin,g=function(){function a(a,b){if("odata"!==a.$type)throw new Error("Only odata sources are supported.");var c=this;if(c._config=a||{},c._origFilter=c._config.$params.$filter,c._pageSize=0,c._model=b,c._currentPage=1,!c.isQuery())throw"Invalid Queryable DataSource";c._pageSize=c._config.$params.$top||0,c._orderby=c._config.$params.$orderby||""}return a.prototype.initPagination=function(a,b,c){var d=this;d._pageSize=a,d._totalCount=c,d._currentPage=b},a.prototype.initFromData=function(a){var b=this;b.isQuery()&&(b._pageSize=a.pageSize,b._currentPage=b._pageSize?Math.ceil(a.skip/b._pageSize)+1:0,b._totalCount=a.count,b._skip=a.skip)},Object.defineProperty(a.prototype,"filter",{get:function(){var a=this;return a._filter},set:function(a){var b=this;b._filter=a,b._filter&&b._filter.value?b._origFilter?b._config.$params.$filter={$left:b._origFilter,$op:"AND",$right:b._filter.value}:b._config.$params.$filter=b._filter.value:b._origFilter?b._config.$params.$filter=b._origFilter:b._config.$params.$filter=null,b.refresh(!0)},enumerable:!0,configurable:!0}),a.prototype.pageSize=function(){var a=this;return a.isQuery()?a._pageSize:0},a.prototype.orderBy=function(a){var b=this;return void 0===a?b._orderby:(a!==b._orderby&&(b._orderby=a,b.refresh(!0)),b._orderby)},a.prototype.refresh=function(a){var b=this;b.isQuery()&&(a&&(b._currentPage=0),b._open().then(function(){b._model.notifyPaginationChanged(),b._model.notifySortingChanged()}))},a.prototype.currentPage=function(a){var b=this;if(void 0!=a){if(b.isQuery()){var c=Math.min(a,b.totalPages());b._currentPage!=c&&(b._currentPage=c,b._open().then(function(){b._model.notifyPaginationChanged()}))}return a}return b.isQuery()?b._currentPage:0},a.prototype.totalPages=function(){var a=this;return a.isQuery()?a._pageSize?Math.ceil(a._totalCount/a._pageSize):1:0},a.prototype.totalCount=function(){var a=this;return a.isQuery()?a._totalCount:0},a.prototype.destroy=function(){var a=this;a._config=null,a._model=null},a.prototype.isQuery=function(){return e.isQuery(this._config)},a.prototype.open=function(){return this._open()},a.prototype.remove=function(a,b){var e=this,g=e.isQuery();return g?new c.Promise(function(c,g){var h={name:"data",$type:e._config.$type,$method:"DELETE",$params:{$module:e._config.$params.$module,$entity:e._config.$params.$entity,$entityId:a}},i={};d.processing(!0),f.executeDatasets([h],{etag:b},i,{},function(a,b){d.processing(!1),b?e._model?(e._model.addAjaxException(b),g(null)):g(b):c(null)})}):null},a.prototype._open=function(){var a=this;return a._config.name="data",new c.Promise(function(b,c){d.processing(!0);var e=a.isQuery(),g={};e&&(
// update orderby
a._orderby&&a._config.$params.$orderby!==a._orderby&&(a._config.$params.$orderby=a._orderby),
// update pagination
a._pageSize>0?(a._config.$params.$top=a._pageSize,a._config.$params.$skip=Math.max(0,a._currentPage-1)*a._pageSize,0==a._config.$params.$skip&&delete a._config.$params.$skip):(delete a._config.$params.$top,delete a._config.$params.$skip)),f.executeDatasets([a._config],{},g,{},function(f,h){if(d.processing(!1),h)a._model?(a._model.addAjaxException(h),c(null)):c(h);else{var i=g.data;if(a.initFromData(i),e&&a._skip&&a._skip>=a._totalCount)return a._currentPage=0,a._open().then(function(a){b(i)});a._model&&(a.isQuery()?a._model.setModel(i.documents):a._model.setModel(i)),b(i)}})})},a.prototype.save=function(){var a=this;a.isQuery()||!a._model.validate()},a}();b.QueryableDataSource=g}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/ajax.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="./state.data.ts" />
/// <reference path="./errors.data.ts" />
/// <reference path="./queryable.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=c.SchemaUtils,e=c.DataUtils,f=a.utils,g=a.ajax,h=(a.locale,a.ulocale),i=a.locale.schema,j=function(a,c){var e=a._rootParent._schema,f=a._schema.properties[c];d.inModel(f,e)&&(Object.defineProperty(a,c,{get:function(){var a=this,b=a._children[c];if(b){if(b.isNull)return null;if(b.isUndefined)return;return b}return a._model[c]},set:function(b){var e=this,f=e._model[c];if(f!==b&&e._beforeChange(c,f,b)){e._model[c]=b;var g=e._schema.properties[c],h=a._rootParent._schema;d.isCompositionRef(g,h)?(e._setRefChild(c,f,b,{}),e._notifyChanged(c,f,b,"propchange",{},!0),e.notifyStateChanged(c,{})):d.isCompositionList(g,h,!1)?(e._setListChild(c,f,b,"propchange",{}),e._notifyChanged(c,f,b,"propchange",{},!0),e.notifyStateChanged(c,{})):d.isSimpleList(g,h)?(e._setSimpleListChild(c,f,b,"propchange",{}),e._notifyChanged(c,f,b,"propchange",{},!0),e.notifyStateChanged(c,{})):d.isList(g,h)||e._notifyChanged(c,f,b,"propchange",{},!0)}},enumerable:!0}),d.isCompositionList(f,e,!1)&&
// add expand 
Object.defineProperty(a,c+b.EXPANDED_FIELD_NAME,{get:function(){var a=this,b=a[c];return b.length?b.$expand?2:1:0},set:function(a){var b=this,d=b[c];1===a?d.$expand=!1:2===a&&(d.$expand=!0)},enumerable:!0}))},k=function(a,b,e){var f=a._schema.properties[b],g=a._rootParent._schema;d.inModel(f,g)&&(a.$states[b]=new c.DataStates(a,b,e))},l=function(a,b,e){var f=a._schema.properties[b],g=a._rootParent._schema;d.inModel(f,g)&&(a.$errors[b]=new c.Errors(a,b,e,d.isCompositionRef(f,g)))},m=function(a,b,d){a.$links[b]=new c.LinkStates(a,b,d)},n={setValue:function(a,b,c,d){c.setValue(a,b,d)},getValue:function(a,b,c){return b.getValue(a,c)},getState:function(a,b,c){return b.getState(a,c)},_resolveSegment:function(a,b,c,d,e,f){if("$item"!==a)return"$new"===a?(f&&(c[a]=e),c[a]):c&&c[a]&&"function"==typeof c[a]?f?c[a](e):c[a]():(f&&(c[a]=e),c[a]);if(d){var g=d[b];if(g&&void 0!=g.$index)return f&&(c[g.$index]=e),c[g.$index]}}},o=function(){function a(a,b,c,e,f,g){var h=this;h._map={},h._expanded=!1,h._selectedUids=[],h._selectedPks=[],h._model=[],h._items=[],h._path=c,h._parent=b,h._locale=g,h._arrayParent=f,h._rootSchema=h._parent.getRootModel().getSchema(""),h._schema=a,h._schemaItems=d.expand$Ref(a.items,h._rootSchema),h.frozen=!1,h._setModel(e,!1),h._createCustomProps()}return a.prototype.pushSelected=function(a,b){var c=this,e=a.$id,f=c._selectedUids.indexOf(e);if(f<0&&c._selectedUids.push(e),b&&c._schemaItems.primaryKey){var g=d.pkFields(c._schemaItems.primaryKey);e=d.pk2Id(d.extractPkValue(a,g),g),f=c._selectedPks.indexOf(e),f<0&&c._selectedPks.push(e)}},a.prototype.removeSelected=function(a,b){var c=this,e=c._selectedUids.indexOf(a.$id);if(e>=0&&c._selectedUids.splice(e,1),b&&c._schemaItems.primaryKey){var f=d.pkFields(c._schemaItems.primaryKey),g=d.pk2Id(d.extractPkValue(a,f),f);e=c._selectedPks.indexOf(g),e>=0&&c._selectedPks.splice(e,1)}},a.prototype.notifyChangedProperty=function(a){var b=this;b._parent._notifyChanged(b._path,void 0,void 0,a,{},!1)},a.prototype.addAjaxException=function(a){var b=this;return b._parent.addAjaxException(a)},a.prototype.notifyPaginationChanged=function(){},a.prototype.notifyCountChanged=function(){this.notifyChangedProperty("count")},a.prototype.notifySortingChanged=function(){},a.prototype.isQueryable=function(){return this._queryable||!1},a.prototype.addErrors=function(a){var b=this,c=b._parent.$errors[b._path];c?c.addErrors(a):b._parent.addErrors(a)},a.prototype.addError=function(a){var b=this,c=[{severity:"error",message:a}];b.addErrors(c)},a.prototype._createCustomProps=function(){var a=this;Object.defineProperty(a,"length",{get:function(){return this._items.length},enumerable:!0})},a.prototype._destroyItems=function(){var a=this;a._items&&(a._model=[],a._items=[])},a.prototype.$orderby=function(a){return""},a.prototype.totalPages=function(){return 1},a.prototype.totalCount=function(){return this._items.length},a.prototype.length=function(){return this._items.length},a.prototype.destroy=function(){var a=this;a._parent=null,a._arrayParent=null,a._destroyItems(),a._model=null,a._schema=null,a._schemaItems=null,a._rootSchema=null},a.prototype._fillItems=function(){var a=this;a._model.forEach(function(b,c){a._items.push(b)})},a.prototype._setModel=function(a,b){var c=this;c.isNull=null===a,c.isUndefined=void 0===a,a=a||[];var d=c.frozen;b&&(c.frozen=!0),
// remove && destroy items 
c._destroyItems(),c._model=a,c._fillItems(),c.frozen=d},a.prototype.setModel=function(a){var b=this;b._setModel(a,!0),b._parent._notifyChanged(b._path,void 0,void 0,"set",{},!1),b.notifyCountChanged(),b._parent.notifyStateChanged(b._path,{})},a.prototype.updateParams=function(a,b,c){var d=this,e=d._items.indexOf(a);b=b?"$item."+b:"$item";var f=[];return a._getFullPath(f),c[f.join(".")]={$index:e,$value:a},b},a.prototype.indexOf=function(a){return this._items.indexOf(a)},a.prototype.find=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var d=a.split(","),e=d.length,f=0,g=this._items.length;f<g;f++){for(var h=!0,i=this._items[f],j=0;j<e;j++)if(b[j]!==i[d[j]]){h=!1;break}if(h)return i}return null},a.prototype._expandForEach=function(a,b,c,d){return this._items.forEach(function(e){a(e,d,c),d++;var f=e[b];f&&f.$expand&&(d=f._expandForEach(a,b,c++,d))}),d},a.prototype.forEach=function(a,b){return b?void this._expandForEach(a,b,0,0):this._items.forEach(a)},a.prototype.get=function(a){return this._items[a]},Object.defineProperty(a.prototype,"$expand",{get:function(){return this._expanded},set:function(a){var c=this;if(c._expanded!==a){var d=c._parent[c._path+b.EXPANDED_FIELD_NAME];c._expanded=a;var e=c._parent[c._path+b.EXPANDED_FIELD_NAME];e!==d&&c._parent._notifyChanged(c._path+b.EXPANDED_FIELD_NAME,d,e,"propchange",{},!0)}},enumerable:!0,configurable:!0}),a}();b.DataListCore=o;var p=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype._fillItems=function(){var a=this,b=null;a._map={},a._selectedUids=[],a._selectedPks.length&&(b=d.pkFields(a._schemaItems.primaryKey)),a._model.forEach(function(c,e){var f=new t(a._schemaItems,a._parent,a._path,c,a,(!1),a._locale,null);if(a._items.push(f),a._map[f.$id]=f,b){var g=d.pk2Id(d.extractPkValue(c,b),b);a._selectedPks.lastIndexOf(g)>=0&&(f.internalSetSelected(!0,!1),a.pushSelected(f,!1))}})},b.prototype._destroyItems=function(){var a=this;a._map={},a._selectedUids=[],a._items&&(a._items.forEach(function(a){a.destroy()}),a._model=[],a._items=[])},b.prototype._updateSelecting=function(a,b,c){var d=this;if(a)d._selectedUids.forEach(function(a){var b=d._map[a];b&&d.pushSelected(b,!0)});else if(d._selectedPks=[],d._selectedUids.length){var e=d._selectedUids.slice();c.length||c.push(e.pop()),e.forEach(function(a){var b=d._map[a];b&&(b.$select=!1)})}b&&d._items.forEach(function(d){var e=d[b];e&&e._updateSelecting(a,b,c)},null)},b.prototype.updateSelecting=function(a,b){this._updateSelecting(a,b,[])},b.prototype._enumSelected=function(a,b){var c=this;if(a)c._enumSelected(null,b),c._items.forEach(function(c){var d=c[a];d&&d.$expand&&d._enumSelected(a,b)});else{var d=c._selectedUids.slice();if(!d.length)return;b(c,null),d.forEach(function(a){var d=c._map[a];d&&b(c,d)})}},b.prototype.selectItem=function(a,b,c,d){var e=this;if(b)if(a){if(!b.$select)if(c)b.$select=!0;else{e._enumSelected(d,function(a,b){a&&!b?a._selectedUids=[]:b.internalSetSelected(!1,!0)}),b.internalSetSelected(!0,!0);var f=b._arrayParent;f&&f.pushSelected(b,!1)}}else if(b.$select)if(c)b.$select=!1;else{b.internalSetSelected(!1,!0);var f=b._arrayParent;f&&e.removeSelected(b,!1)}},b.prototype.findById=function(a){return this._map[a]},b.prototype.indexOf=function(a){var b=this;return"object"!=typeof a&&(a=b.findById(a)),a?b._items.indexOf(a):null},b}(o);b.DataListBase=p;var q=function(a){function c(c,d,f,g,h,i,j,k,l,m){a.call(this,d,f,g,h,l,m);var n=this,o=n._parent.getRootModel(),p=e.dsConfig(o.datasets,d,!0);if(!p)throw'Invalid config! You must define a dataset in form for the property: "'+g+'".';n._main=p.$main,n._queryable=!0,n._query=new b.QueryableDataSource(p,n),n._query.initPagination(i,j,k),n._main&&o&&(o.onRefresh=function(a){var b=a&&a.resetPagination;n.$refresh(b)})}return __extends(c,a),Object.defineProperty(c.prototype,"filter",{get:function(){return this._query.filter},set:function(a){this._query.filter=a,this.notifyChangedProperty("filter")},enumerable:!0,configurable:!0}),c.prototype.totalPages=function(){return this._query.totalPages()},c.prototype.totalCount=function(){return this._query.totalCount()},c.prototype.$refresh=function(a){this._query.refresh(a)},c.prototype.$orderby=function(a){return this._query.orderBy(a)},c.prototype.notifyPaginationChanged=function(){this.notifyChangedProperty("pagination")},c.prototype.notifyFilterChanged=function(){this.notifyChangedProperty("filter")},c.prototype.notifySortingChanged=function(){this.notifyChangedProperty("sorting")},c.prototype.currentPage=function(a){return void 0!=a?this._query.currentPage(a):this._query.currentPage()},c.prototype._removeItem=function(a,b){var c=this;if(c._query){var d=c._query.remove(a,b);d.then&&d.then(function(){c.$refresh(!(c._items.length>1))})}},c.prototype.remove=function(a){var b=this,c=a.model(!0),e=c?c["@odata.etag"]:null;if(b._schemaItems&&b._schemaItems.primaryKey){var g=d.odataId(d.pkFields(b._schemaItems.primaryKey),a);if(b._schemaItems.links&&b._schemaItems.links.$remove&&b._schemaItems.links.$remove.confirm){var i=b._schemaItems.links.$remove.confirm;b._locale&&(i=h.tt(i||"",b._locale)),f.confirm(null,i,function(){b._removeItem(g,e)})}else b._removeItem(g,e)}},c.prototype.destroy=function(){var b=this;if(b._query&&(b._query.destroy(),b._query=null),b._main){var c=b._parent.getRootModel();c&&(c.onRefresh=null)}a.prototype.destroy.call(this)},c}(p);b.QueryList=q;var r=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.push=function(a){var b=this;b._model.push(a),b._items.push(a),b._parent._notifyChanged(b._path,void 0,a,"add",{$index:b._items.length-1,$value:a,$id:a},!1),b.notifyCountChanged()},b.prototype.splice=function(a,b,c){if(b>0)throw"Delete count is not supported.";var d=this;d._model.splice(a,b,c),d._items.splice(a,b,c),d._parent._notifyChanged(d._path,void 0,c,"add",{$index:a,$value:c,$id:c},!1),d.notifyCountChanged()},b.prototype.remove=function(a){var b=this,c=b._items.indexOf(a);c>=0&&(b._items.splice(c,1),b._model.splice(c,1),b._parent._notifyChanged(b._path,void 0,a,"remove",{$index:c,$value:a,$id:a},!1),b.notifyCountChanged())},b}(o);b.SimpleTypeList=r;var s=function(a){function b(b,c,d,e,f,g){a.call(this,b,c,d,e,f,g);var h=this;h._createNewItem(!1,!0)}return __extends(b,a),b.prototype._initNew=function(){var a=this,b=d.init(a._schemaItems,a._rootSchema,null,null);a._new=new t(a._schemaItems,a._parent,a._path+".$new",b,null,(!0),a._locale,null),a._new._notifyChanged("",void 0,b,"propchange",{},!1),a._new.notifyStateChanged("",{})},b.prototype._createNewItem=function(a,b){var c=this;b&&Object.defineProperty(c,"$new",{get:function(){var a=this;return a._new||a._initNew(),a._new},set:function(a){var b=this;b._new||b._initNew(),b._new._setModel(a,!0),b._new._notifyChanged("",void 0,a,"propchange",{}),b._new.notifyStateChanged("",{})},enumerable:!0}),a&&!c._new&&c._initNew()},b.prototype.updateItem=function(a,b){var c=this;
// validate
if(!b.validate())return!1;
// clear errors 
b.$errors.$.addErrors([],!1);
// validate primary key
var e=b._getModel(!0);if(c._schemaItems.primaryKey){var g=d.pkFields(c._schemaItems.primaryKey),h=d.extractPkValue(e,g),j=(d.extractPkValue(a._getModel(!0),g),d.findByPk(h,g,c._items));if(j&&j!==a){
// Primary key violation
var k=g.length>1?i.uniqueColumns:i.uniqueColumn;return b.$errors.$.addErrors([{code:"duplicate_value",message:f.format(k,g.join(", "))}],!1),!1}}
// update Old object
return!0},b.prototype.addNew=function(){var a=this;if(a._new&&a._new.validate()){var b=a._new._getModel();if(a._schemaItems.primaryKey){var c=d.pkFields(a._schemaItems.primaryKey),e=d.extractPkValue(b,c),g=d.findByPk(e,c,a._items);if(
// Primary key violation
a._parent.$errors[a._path].addErrors([],!1),g){var h=c.length>1?i.uniqueColumns:i.uniqueColumn;return void a._parent.$errors[a._path].addErrors([{code:"duplicate_value",message:f.format(h,c.join(", "))}],!1)}}else a._parent.$errors[a._path].addErrors([],!1);a._destroyNew(),a.push(b),a._createNewItem(!0,!1)}},b.prototype._destroyNew=function(){var a=this;a._new&&(a._new.destroy(),a._new=null)},b.prototype.destroy=function(){var b=this;b._destroyNew(),a.prototype.destroy.call(this)},b.prototype.find=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var d=a.split(","),e=d.length,f=0,g=this._items.length;f<g;f++){for(var h=!0,i=this._items[f],j=0;j<e;j++)if(b[j]!==i[d[j]]){h=!1;break}if(h)return i}return null},b.prototype.push=function(a){this.splice(-1,0,a)},b.prototype.splice=function(a,b,c){if(b>0)throw"Delete count is not supported.";var d=this,e=d.frozen;d.frozen=!0;var f=a<0;f?d._model.push(c):d._model.splice(a,b,c);var g=new t(d._schemaItems,d._parent,d._path,c,d,(!1),d._locale,null);f?d._items.push(g):d._items.splice(a,b,g),d.frozen=e,d._map[g.$id]=g,g.$select&&d.pushSelected(g,!0),g._notifyChanged("",void 0,c,"add",{$index:f?d._items.length-1:a,$id:g.$id,$value:g},!1),g.notifyStateChanged("",{})},b.prototype.remove=function(a){var b,c=this,d=null,e=c.frozen;c.frozen=!0;var f=c._items.indexOf(a),g=a.$id;if(f>=0&&(d=a.model(),b=!0,c._items.splice(f,1),c._model.splice(f,1),c.removeSelected(a,!0),a.destroy()),c.frozen=e,delete c._map[g],b){var h=(c._path?c._path+".":"")+"$item";c._parent._notifyChanged(h,void 0,void 0,"remove",{$index:f,$value:d,$id:g},!1),c._parent.notifyStateChanged(h,{})}},b}(p);b.DataList=s;var t=function(){function h(a,b,c,e,g,h,i,j,k){var l=this;l._rootParent=b?b._rootParent:l,l.$id=f.allocID(),l.$create=!1,l._selected=!1,l._model={},l.datasets=j,l.transform=k,l.$states={},l.$errors={},l.$links={},l._path=c,l._locale=i,l._parent=b,l._schema=d.expand$Ref(a,l._rootParent._schema),l._parent||(l._validators=[{name:"schema",active:!0}]),l._arrayParent=g,l._children={},l._initFromSchema(a),l._parent&&!h||(l.frozen=!0),e&&e.$create&&(delete e.$create,l.$create=!0),l._setModel(e,!1),l.frozen=!1,l._parent||(l._notifyChanged("*",void 0,e,"propchange",{},!1),l.notifyStateChanged("*",{}))}
//validators
//TODO states for $index
return h.prototype.setModel=function(a){var b=this;b._destroyObject(b,"_children"),b._children={},b.frozen=!0,b._setModel(a,!1),b.frozen=!1,b._parent||(b._notifyChanged("*",void 0,a,"propchange",{},!1),b.notifyStateChanged("*",{}))},h.prototype.update=function(a){var b=this;if(a){var c=Object.keys(b._schema.properties),e=b._rootParent._schema;c.forEach(function(c){var f=b._schema.properties[c];if(d.inModel(f,e))if(d.isCompositionRef(f,e)){b[c]}else d.isCompositionList(f,e,!1)?b[c]=a[c]:d.isSimpleList(f,e)||(b[c]=a[c])})}},h.prototype.$refresh=function(b){var c=this;if(!c._parent)if(c.onRefresh)c.onRefresh(b);else{var d=e.extractMainDataSource(c);if(d){var f=a.data.extractValue(d.$method);"GET"===f.toUpperCase()&&e.datasetAsPromise(d).then(function(a){c.update(a)})["catch"](function(a){c.addAjaxException(a)})}}},h.prototype._validate=function(b){var c=this;if(!b||!b.length)return!0;var e=Object.keys(c._schema.properties),g=!1,h=c._rootParent._schema;return e.forEach(function(e){var j=c._schema.properties[e];if(d.inModel(j,h)){var k=c.$states[j.$stateProperty||e];if(!k.isHidden&&!k.isDisabled)if(d.isCompositionRef(j,h)){var l=c[e];l?l._validate(b)||(g=!0):k.isMandatory&&(c.$errors[e].addErrors([{message:f.format(i.required,d._title(j.title,a.locale))}],!1),g=!0)}else c._execValidators(b,e,"validate",{},{base:c,state:k,schema:j,value:c[e]})||(g=!0)}}),c._parent||c._execValidators(b,"","validate",{},{base:c,state:null,schema:c._schema,value:null})||(g=!0),!g},h.prototype.validate=function(){var a=this,b=a.getRootModel();return a._validate(b._validators)},Object.defineProperty(h.prototype,"$select",{get:function(){return this._selected},set:function(a){var b=this;b.internalSetSelected(a,!0)&&b._arrayParent&&(b._selected?b._arrayParent.pushSelected(b,!0):b._arrayParent.removeSelected(b,!0))},enumerable:!0,configurable:!0}),h.prototype.select=function(a,b,c,d){var e=this;return b?void(e._arrayParent&&e._arrayParent.selectItem(a,e,b,null)):void(d?c.selectItem(a,e,!1,d):e._arrayParent&&e._arrayParent.selectItem(a,e,!1,null))},h.prototype.toggleExpand=function(a){var b=this,c=!1;if(!a)return c;var d=b[a];return d&&(d.$expand=!d.$expand,c=d.$expand),c},h.prototype.enumVisibleChilds=function(a,b,c,d){var e=this,f=e[a];f&&(f.$expand||c)&&f._items.forEach(function(c){d(c,b+1),c.enumVisibleChilds(a,b+1,!1,d)})},h.prototype.internalSetSelected=function(a,b){var c=this;return c._selected!==a&&(c._selected=a,b&&c._notifyChanged("$select",!c._selected,a,"propchange",{},!0),!0)},h.prototype.$index=function(a){var b=this;return b._arrayParent?Math.max(b._arrayParent.indexOf(b),0)+1:0},h.prototype.$save=function(){var a=this,b=a.getRootModel();if(b!==a)return f.Promise.reject(null);if(!a.validate())return f.Promise.reject(null);var c=e.extractMainDataSource(a);if(c&&e.isCreateOrUpdate(c)){var g=a.model(!1);if(a.$create)c.$method="POST",delete c.$params.$entityId;else{if(c.$method="PUT",!a._schema.primaryKey)return void a.addError("Primary key is missing. Check schema.");var h=d.pkFields(a._schema.primaryKey),i=d.extractPkValue(g,h);c.$entityId=d.entityId(i)}return new f.Promise(function(b,d){e.datasetAsPromise(c,g).then(function(a){b()})["catch"](function(b){a.addAjaxException(b),d(null)})})}return f.Promise.reject(null)},h.prototype.getRootModel=function(){return this._rootParent},h.prototype.addValidator=function(a,b){var c=this.getRootModel();c._validators.push({name:a,active:b})},h.prototype.activateValidator=function(a,b){for(var c=this,d=c.getRootModel(),e=0,f=d._validators.length;e<f;e++){var g=d._validators[e];if(g.name===a){g.active=b;break}}},h.prototype.hasValidators=function(){var a=this,b=a.getRootModel();if(b._validators.length){if(1==b._validators.length)return b._validators[0].active;for(var c=0,d=b._validators.length;c<d;c++)if(b._validators[c].active)return!0}return!1},h.prototype.getParentOf=function(a,c){return this.getValue(b.SchemaUtils.parentPath(a),c)},h.prototype.setValue=function(a,b,c){for(var e=this,f=e,g=a.split("."),h=[],i=g.pop(),j=0,k=g.length;j<k&&f;j++){var l=g[j];h.push(l),f="$"==l.charAt(0)?n._resolveSegment(l,h.join("."),f,c):f[l]}f&&("$"!=i.charAt(0)||d.isMetaProp(i)?f[i]=b:(h.push(i),n._resolveSegment(i,h.join("."),f,c,b,!0)))},h.prototype._getModel=function(a){var b=this;if(a)return b._model;var c=$.extend(!0,{},b._model);return d.removeStates(c),d.removeMeta(c),c},h.prototype.model=function(a){return this._getModel(a)},h.prototype.getRelativeValue=function(a){return this.getValue(a,{})},h.prototype.getRelativeState=function(a){return this.getState(a,{})},h.prototype.getValue=function(a,b){var c=this;if(""==a)return c;for(var e=c,f=a.split("."),g=f.pop(),h=[],i=0,j=f.length;i<j&&e;i++){var k=f[i];h.push(k),e="$"==k.charAt(0)?n._resolveSegment(k,h.join("."),e,b):e[k]}return e?g&&"$"==g.charAt(0)&&!d.isMetaProp(g)?(h.push(g),n._resolveSegment(g,h.join("."),e,b)):g?e[g]:e:void 0},h.prototype._getFullPath=function(a,b){var c=this;return c===b?a:(c._parent&&c._parent._getFullPath(a,null),c._path&&a.push(c._path),void(c._arrayParent&&a.push("$item")))},h.prototype.getSchema=function(a){var b=this;return d.getSchema(a,b._schema,b._rootParent._schema,!1)},h.prototype.getState=function(a,b){var c,e=this,f=a.split("."),g=f.pop(),h=g,i=e,j={},k=[],l=!1,m=f.length-1,n=d.isMetaProp(g);if(n){var o=d.getSchema(a,e._schema,e._rootParent._schema,!1);o&&o.$stateProperty&&(g=o.$stateProperty)}for(var p=0;p<=m;p++){var q=f[p];if(k.push(q),d.arrayProps.indexOf(q)>=0)
//xxxxxxx
//TODO : params for $item
i=i[q];else{if(p==m&&"$links"==q){l=!0;break}c=i.$states[q]?i.$states[q].state():null,i=i[q]}if((!i||i.isNull||i.isUndefined)&&(j.isDisabled=!0),c&&c.isHidden&&(j.isHidden=!0),c&&c.isDisabled&&(j.isDisabled=!0),c&&c.isReadOnly&&(j.isReadOnly=!0),!i)break}var r={};if(i){var s="$states";l&&(s="$links");var t=i[s]?i[s][g]:null;t&&(r=t.state(),!l&&i.$errors&&(r.errors=i.$errors[h].errors()))}return $.extend({},r,j)},h.prototype._setModel=function(a,b){var c=this,e=c.frozen;b&&(c.frozen=!0),c.isNull=null===a,c.isUndefined=void 0===a,a=a||{},a.$states=a.$states||{},a.$links=a.$links||{},a.$errors=a.$errors||{};var f=Object.keys(c._schema.properties),g=c._rootParent._schema;f.forEach(function(b){var e=c._schema.properties[b];if(d.inModel(e,g)){var f=d.isMetaProp(b),h=a[b];if(h||!d.isCompositionList(e,g,!1)&&!d.isList(e,g)||(h=[],a[b]=h),d.isList(e,g)?c._setQueryListChild(b,h,a.pageSize,a.pageSize?Math.round(a.skip/a.pageSize)+1:0,a.count):c[b]=h,!f){if(a.$states&&a.$states[b]){var i=a.$states[b];Object.keys(i).forEach(function(a){c.$states[b][a]=i[a]})}a.$states[b]=c.$states[b].state()}if(a.$errors&&a.$errors[b]){var j=a.$errors[b],k=[];j.forEach(function(a){k.push(a)}),c.$errors[b].addErrors(k)}a.$errors[b]=c.$errors[b].errors()}}),
//for each link set state
a.$links&&(f=Object.keys(c._schema.links||{}),f.forEach(function(b){var d=a.$links[b],e=c.$links[b];d&&Object.keys(d).forEach(function(a){e[a]=d[a]}),a.$links[b]=c.$links[b].state()})),c._model=a,c.frozen=e},h.prototype._setRefChild=function(a,b,c){var d=this,e=d.frozen;d.frozen=!0,d._children[a]?d._children[a]._setModel(c,!1):d._children[a]=new h(d._schema.properties[a],d,a,c,null,(!1),d._locale,null),d.frozen=e},h.prototype._setListChild=function(a,b,c){var d=this,e=d.frozen;d.frozen=!0,d._children[a]?d._children[a]._setModel(c,!1):d._children[a]=new s(d._schema.properties[a],d,a,c,null,d._locale),d.frozen=e},h.prototype._setSimpleListChild=function(a,b,c){var d=this,e=d.frozen;d.frozen=!0,d._children[a]?d._children[a]._setModel(c,!1):d._children[a]=new r(d._schema.properties[a],d,a,c,null,d._locale),d.frozen=e},h.prototype._setQueryListChild=function(a,b,c,d,e){var f=this,g=f.frozen;f.frozen=!0,f._children[a]&&f._children[a].destroy(),f._children[a]=new q(f._schema,f._schema.properties[a],f,a,b,c,d,e,null,f._locale),f.frozen=g,f._notifyChanged(a,null,b,"propchange",{},!0),f.notifyStateChanged(a,{})},h.prototype._initFromSchema=function(b){var e=this;if(e._model){var f=b.states?$.extend(!0,{},b.states):null,g=b.links?$.extend(!0,{},b.links):null,h=b.errors?$.extend(!0,{},b.errors):null,i=!1,n=Object.keys(b.properties);n.forEach(function(c){if(!d.isMetaProp(c)){var e=b.properties[c];if(!("password"!==e.format||e.capabilities&&e.capabilities.noConfirming)){var f="$$"+c;e.$meta=f;var g=b.properties[f];g||(g=$.extend(!0,{},e),g.title=a.locale.ui.Confirm,
// for this field use $stateProperty to get    
g.$stateProperty=c,b.properties[f]=g,i=!0)}}}),i&&(n=Object.keys(b.properties)),n.forEach(function(a){j(e,a),d.isMetaProp(a)||k(e,a,f?f[a]:null),l(e,a,h?h[a]:null)}),b.links&&Object.keys(b.links).forEach(function(a){m(e,a,g?g[a]:null)}),
// root error
e._parent||(e.$errors.$=new c.Errors(e,"$",[],(!1)))}},h.prototype.getParentModel=function(a){var b=a.split(".");return b.pop(),n.getValue(b.join("."),this)},h.prototype.addAjaxException=function(a){var b=this;if(b._parent)return b._parent.addAjaxException(a);var c=g.extractAjaxErrors(a),e=[],f=null;c.message&&(f={message:c.message,details:[]},e.push(f)),c.list&&c.list.length&&c.list.forEach(function(a){var c=!0;if(a.target){var g=b.getParentModel(a.target);if(g){var h=d.lastSegment(a.target,null);g.hasOwnProperty(h)&&(c=!1,g.$errors[h].addError(a.message))}}c&&(f?f.details.push({message:a.message}):e.push({message:a.message}))}),b.$errors.$.addErrors(e)},h.prototype.addError=function(a){var b=this,c=[{severity:"error",message:a}];b.addErrors(c)},h.prototype.addErrors=function(a){var b=this;b._arrayParent||(b._parent?b._parent.addErrors(a):b.$errors.$&&b.$errors.$.addErrors(a))},h.prototype._beforeChange=function(a,b,c){return!0},h.prototype.notifyStateChanged=function(a,b){var c=this;c.frozen||c._arrayParent&&c._arrayParent.frozen||(c._arrayParent&&(a=c._arrayParent.updateParams(c,a,b)),c._parent?c._parent.notifyStateChanged(a?c._path+"."+a:c._path,b):(f.logModule("proxydata")&&f.log("State changed: "+c._extractPropName(a||"",b),"proxydata"),c.onstatechanged&&c.onstatechanged(a,b)))},h.prototype._extractPropName=function(a,b){return Object.keys(b).sort().reverse().forEach(function(c){var d=b[c];d&&void 0!==d.$index&&(a=a.replace(c,c+"["+d.$index+"]"))}),a},h.prototype._execValidators=function(a,b,c,e,f){var g=this,h=!1;if(b){if(!f){var i=g.getValue(b,e);if(void 0===i)return!h}}else if("validate"!==c)return!h;var j=!0;return a.forEach(function(a){a.active&&(a.hnd||(a.hnd=d.getValidator(a.name)),a.hnd&&(f&&(f.add=!j),a.hnd(c,g,{name:b,params:e,locale:g._locale},f)||(h=!0),j=!1))}),!h},h.prototype._notifyChanged=function(a,b,c,d,e,g){var h=this;if(!(h.frozen||h._arrayParent&&h._arrayParent.frozen)){if(h._arrayParent){if("propchange"===d&&a){var i=h._arrayParent.findById(h.$id);if(i===h){var j=i.$id;e.$oid?j=e.$oid:e.$oid=i.$id,h._parent._notifyChanged(h._path,b,c,"upd",{$id:i.$id,property:a,$oid:j},g)}}a=h._arrayParent.updateParams(h,a,e)}h._parent?h._parent._notifyChanged(a?h._path+"."+a:h._path,b,c,d,e,g):(f.logModule("proxydata")&&f.log("Changed: "+h._extractPropName(a||"",e)+", operation = "+d,"proxydata"),h.onchange&&h.onchange(a,b,c,d,e),g&&h._validators&&h.hasValidators()&&h._execValidators(h._validators,a,"propchanged",e))}},h.prototype._destroyObject=function(a,b){var c=a[b];c&&Object.keys(c).forEach(function(a){c[a].destroy(),delete c[a]})},h.prototype.destroy=function(){var a=this;a._parent=null,a._destroyObject(a,"_children"),a._destroyObject(a,"$states"),a._destroyObject(a,"$links"),a._destroyObject(a,"$errors"),a._arrayParent=null,a._model=null,a._schema=null,a.onRefresh=null,a.onchange=null,a.onstatechanged=null,a._rootParent=null},h}();b.Data=t,b.ObservableUtils=n}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/modules/locale.ts" />
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/utils.ts" />
/// <reference path="../../data/datasets.ts" />
/// <reference path="./proxy.data.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.data,a.utils,b.SchemaUtils),d=function(a,b,d,e){var f=!0,g="validate"===a;if("propchanged"===a||g){if(!d.name)return f;var h=c.lastSegment(d.name,null);if(c.arrayProps.indexOf(h)>=0)return f;var i=e?e.value:b.getValue(d.name,d.params),j=e?e.state:b.getState(d.name,d.params),k=e?e.schema:b.getSchema(d.name);if(j&&(j.isHidden||j.isDisabled))return f;var l=d.locale,m=[],n=e?e.base:b.getParentOf(d.name,d.params);if(c.validateSchema(i,k,j,l,m)||(f=!1),g&&c.isMetaProp(h)&&k&&"password"===k.format){var o=b.getValue(c.extractBase(d.name)+k.$stateProperty,d.params);k=b.getValue(c.extractBase(d.name)+k.$stateProperty,d.params),c.validatePassword(o,i,k,j,l,m)||(f=!1)}var p=!1;"validate"===a&&e&&(p=e.add),n.$errors[h].addErrors(m,p)}return f};c.registerValidator("schema",d)}(b=a.Observable||(a.Observable={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,function(){function a(){this._forms={},this._inAction=!1}return a.prototype.setInAction=function(a){this._inAction=a},a.prototype.isInAction=function(){return this._inAction},a.prototype.add=function(a){a&&a.data&&a.data.name&&(this._forms[a.data.name]=a)},a.prototype.remove=function(a){a&&a.data&&a.data.name&&(this._forms[a.data.name]=null)},a.prototype.formByName=function(a){return this._forms[a]},a}());b.FormManager=c;var d=function(){var a;return function(){return a||(a=new c),a}};b.formManager=d()}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
/// <reference path="../../core/core.ts" />
/// <reference path="../../ui/layout.control.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="./proxy.data.ts" />
/// <reference path="./formmanager.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a){if(a){var b=null;a.$element&&(b=a.$element.get(0)),a.destroy(),b&&h.remove(b)}}var d=b,e=a.utils,f=a.build,g=a.link,h=a.dom,i=a.preferences,j=a.Observable.SchemaUtils,k=a.Observable.ObservableUtils,l=(a.ulocale,function(b){function c(a,c,e,g,h){c=c||{},c.form=!0,b.call(this,a,c,e,g,h);var i=this;c.module&&(i.module=c.module,delete c.module),i.formManager=d.formManager(),i.formManager.add(i),i.$schema=g||{},i.$rootSchema=i.$schema,c.path&&(i.$schema=j.getSchema(c.path,i.$schema,i.$rootSchema,!0)),i.$locale=h,c&&c.storageName&&(i._settingsName=c.storageName),i.setData(e),i.$model.onchange=i._modelChanged.bind(i),i.$model.onstatechanged=i._stateChanged.bind(i),i.$bind={},Object.keys(i.map).forEach(function(a){var b=i.map[a];b.$bindState&&(i.$bind[b.$bindState]=i.$bind[b.$bindState]||[],i.$bind[b.$bindState].push(a))}),Object.keys(i.$bind).forEach(function(a){var b=i.$model.getState(a,{});if(b&&b.isHidden){var c=i.$bind[a];c.forEach(function(a){i.map[a].$isHidden=!0})}i.registerListenerFor(a,i,"layout-state")}),i.registerListenerFor("$",i),i.loadPrefs(),c&&c.validators&&c.validators.forEach(function(a){i.$model.addValidator(a,!0)}),!i.options.design&&i.options.externalSchema&&i.options.externalLayout&&!f.release&&(i.options.authoringIndicator=!0,i.options.verticalSpacing=!0),i._afterCreate()}return __extends(c,b),c.prototype._isInDelayedAction=function(){return this.formManager?this.formManager.isInAction():this._internalDelayedAction},c.prototype._setInDelayedAction=function(a){this.formManager?this.formManager.setInAction(a):this._internalDelayedAction=a},c.prototype.setData=function(b){var c=this;c.$data=j.init(c.$schema,c.$schema,null,b||{}),c.options.beforeSetModel&&c.options.beforeSetModel(c.$data,c),c.$model?c.$model.setModel(c.$data):c.$model=new a.Observable.Data(c.$schema,null,"",c.$data,null,(!1),c.$locale,c.data.datasets,c.data.transformData),c.options.afterModelCreated&&c.options.afterModelCreated(c.$model,c)},c.prototype.processing=function(a){var b=this;b._inProcessing=a},c.prototype._findControlByField=function(a){var b=this,c=[];return Object.keys(b.controls).forEach(function(d){var e=b.controls[d];e&&e.$bind===a&&c.push(e)}),c.length?c:null},c.prototype.loadPrefs=function(){var a=this;a._settingsName&&(a._settings=i(a._settingsName))},c.prototype.getFieldSettings=function(a){var b=this;return b._settings?b._settings[a]:null},c.prototype.setFieldSettings=function(a,b){var c=this;c._settings=c._settings||{},c._settings[a]=b},c.prototype.savePrefs=function(){var a=this;a._settingsName&&(a._settings=a._settings||{},i(a._settingsName,a._settings))},c.prototype.sendMessage=function(a,b,c){var d,e=this,f=e._findControlByField(b);return f&&f.length&&f.forEach(function(b){b.sendMessage&&(d=b.sendMessage(a,c))}),d},c.prototype.afterSettings=function(a,b,c){var d=this;return d.options.settingsHandler?d.options.settingsHandler("after",a,b,c):c},c.prototype.beforeSettings=function(a,b){var c=this;return c.options.settingsHandler?c.options.settingsHandler("before",a,b):null},c.prototype._createError=function(){var a=this,b=["bs-form-error"];return a.options.verticalSpacing?b.push("bs-form-vertical-space"):(a.options.closeButtonHandler||a.options.authoringIndicator)&&b.push("bs-form-settings-space"),$('<div id="'+a.data.$id+'_error" class="'+b.join(" ")+'"><div>').get(0)},c.prototype._createErrorItem=function(a,b){var c="success"==a.severity?"success":"warning"==a.severity?"warning":"danger",d=b?"":"bs-none ",f=['<div data-error="true" class="'+d+" alert alert-"+c+' alert-dismissible fade in">'];return f.push('<button type="button" data-error-close="true" class="close" aria-label="Close"><span data-error-close="true" aria-hidden="true">&times;</span></button>'),f.push(e.escapeHtml(a.message)),a.details&&a.details.length&&a.details.forEach(function(a){a.message&&f.push('<p class="bs-error-detail-item">'+e.escapeHtml(a.message)+"</p>")}),f.push("</div>"),$(f.join("")).get(0)},c.prototype.clearErrors=function(){var a=this;if(a.$element){var b=h.find(a.$element.get(0),a.data.$id+"_error");b&&h.empty(b)}},c.prototype.showErrorItem=function(a,b){var c=this;if(c.$element){var d=h.find(c.$element.get(0),c.data.$id+"_error");d&&(b&&h.empty(d),h.append(d,c._createErrorItem(a,b)))}},c.prototype.afterRenderChildren=function(a){
//setup tooltip
a.find("[data-phoenix-tooltip]").tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},c.prototype.afterRender=function(a){var b=this,c=a.get(0),d=c.firstChild?c.firstChild:c;b.options.form&&!b.options.design&&h.before(d,b._createError());var e=function(a,c,d,e){var f=["<div "+c+'="true" class="bs-cursor-p bs-form-settings'+(d?" "+d:"")+(e?"  space-"+e:"")+'" id="'+b.data.$id+'_settings">'];return f.push("<span "+c+'="true" class="'+h.iconClass(a)+'"></span>'),f.push("</div>"),f.join("")},f=0;b.options.closeButtonHandler&&(h.append(c,$(e("times-circle-o","data-form-detail-close","red",f)).get(0)),f++),b.options.authoringIndicator&&(h.append(c,$(e("cog","data-form-settings",null,f)).get(0)),f++)},c.prototype.stateChanged=function(a,b){var c=this;if("layout-state"===b.targetId){if("isHidden"===a&&b.property){var d=c.$model.getState(b.property,{}),e=c.$bind[b.property];e&&e.forEach(function(a){var b=c.map[a];b&&c.updateIsHidden(b,d.isHidden)})}}else if(c.$model.$errors&&c.$model.$errors.$){var f=c.$model.$errors.$;if(f.hasErrors())for(var g=f.errors(),h=0,i=g.length;h<i;h++){var j=g[h];c.showErrorItem(j,0==h)}else c.clearErrors();f.clear(!1)}},c.prototype.getSchema=function(a){var b=this;return j.getSchema(a,b.$schema,b.$rootSchema,!1)},c.prototype.getLookupForSchema=function(a,b){var c=this;return j.getLookup(a,b,c.$schema,c.$rootSchema)},c.prototype.registerListenerFor=function(a,b,c){var d=this,e=a;d._listenerChanged=!0,d._listeners=d._listeners||{},d._listeners[e]=d._listeners[e]||[],d._listeners[e].push({target:b,id:c||""})},c.prototype.unRegisterListenerFor=function(a,b){var c=this,d=a;if(c._listeners&&c._listeners[d]){var e=c._listeners[d].findIndex(function(a){return a.target===b});e>=0&&(c._listeners[d].splice(e,1),c._listenerChanged=!0)}},c.prototype.setValue=function(a,b){k.setValue(a,b,this.$model)},c.prototype.getValue=function(a){return k.getValue(a,this.$model)},c.prototype.getParentModel=function(a){var b=a.split(".");return b.pop(),k.getValue(b.join("."),this.$model)},c.prototype.getState=function(a){var b=this,c=k.getState(a,this.$model);return b.options.design&&(c.isHidden=!1,c.isDisabled=!1),c},c.prototype._enumListener=function(a,b){var c=this;c._listeners[a].forEach(function(a){b(a)})},c.prototype._rebuildListeners=function(){var a=this;a._listenerChanged&&(a._listenersByName=Object.keys(a._listeners),a._listenerChanged=!1)},c.prototype._match=function(a,b){var c=this,d=a.join("."),e=d+".";c._listenersByName&&c._listenersByName.forEach(function(a){a==d?b(a,!0,!1,!1):"*"!==a&&0!=a.indexOf(e)||b(a,!1,!0,!1)})},c.prototype.execAction=function(a,b,c){this._modelChanged(a,null,null,"execute",c,b)},c.prototype._modelChanged=function(a,b,c,d,e,f){var g=this,h=a.split(".");g._rebuildListeners(),
//update controls
e=e||{},"execute"!==d&&g._match(h,function(f,h,i,j){e.propName=f,h?g._enumListener(f,function(f){f.target.changed&&(e.targetId=f.id,f.target.changed(a,b,c,d,e))}):i&&g._enumListener(f,function(c){c.target.changed&&(e.targetId=c.id,c.target.changed(a,b,"propchange"===d?g.getValue(f):b,d,e))})}),g.afterchanged(a,d,e,f)},c.prototype.afterchanged=function(a,b,c,d){var e=this;if(e.onaction){if(e.inAction)return;e.inAction=!0;try{e.onaction({property:a,operation:b,params:c,actionParams:d},e.$model,e)}finally{e.inAction=!1}}},c.prototype.on=function(a){this.onaction=a},c.prototype._stateChanged=function(a){var b,c,d=this,e=a.split(".");j.statesAndErrors.indexOf(e[e.length-1])>=0&&(b=e.pop(),c=e.join(".")),d._rebuildListeners(),d._match(e,function(a,e,f,g){e?d._enumListener(a,function(a){a.target.stateChanged&&a.target.stateChanged(b,{targetId:a.id,property:c})}):f&&d._enumListener(a,function(a){a.target.stateChanged&&a.target.stateChanged(null,{targetId:a.id,property:c})})})},c.prototype.destroy=function(){var a=this;a.$data=null,a.$schema=null,a.$bind=null,a.module=null,a._listeners={},a._listenersByName=[],a.$model&&(a.$model.onchange=null,a.$model.onstatechanged=null,a.$model.destroy(),a.$model=null),a.formManager&&(a.formManager.remove(a),a.formManager=null),b.prototype.destroy.call(this)},c.prototype._idComponent=function(a){var b=this;if(b.$element){for(var c,d=a,e=b.$element.get(0);d;){if(!d.getAttribute)return null;if(c=d.getAttribute("data-render"))break;d=d==e?null:d.parentNode}return c?c:null}},c.prototype._event2FieldByElement=function(a){var b=this,c=b._idComponent(a);return c?b.controls[c]:null},c.prototype._event2Field=function(a){var b=this;return b._event2FieldByElement(a.target)},c.prototype._removeBaseEvents=function(){var a=this;a.$element.off("focusin"),a.$element.off("focusout"),a.$element.off("click"),a.$element.off("keydown"),a.$element.off("keypress"),a.$element.off("mousedown"),$(window).off("global-phoenix-resize"),b.prototype._removeBaseEvents.call(this)},c.prototype._freeze=function(a){return a.preventDefault(),a.stopPropagation(),!1},c.prototype._addBaseEvents=function(){var a=this;a.$element.on("focusin",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);if(c&&c.focusIn){if(c.focused)return;c.focused=!0,c.focusIn(b)}}),a.$element.on("focusout",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);if(c&&c.focusOut){var d={target:b.target};c.focusTimer&&(window.clearTimeout(c.focusTimer),c.focusTimer=0),a._setInDelayedAction(!0),c.focusTimer=e.focusDelay(function(){if(a._setInDelayedAction(!1),!c.destroyed){c.focusTimer=0;var b=window.document.activeElement;if(b){var e=a._event2FieldByElement(b);e!==c&&(c.focusOut(d),c.focused=!1)}else c.focusOut(d),c.focused=!1}})}}),a.$element.on("click",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);if(c&&c.click){if(c.stopProppagation&&c.stopProppagation(b),c.focusClick)return;if(!a._isInDelayedAction()||c.focused&&c.targetInControl(b.target))return c.click(b);a._setInDelayedAction(!0),c.focusClick=e.focusDelay(function(){a._setInDelayedAction(!1),c.destroyed||(c.focusClick=0,c.click(b))})}else if(!c){var d=b.target;if(d){var f=d.getAttribute("data-error-close");if(f){var i=h.findByAttribute(b.target,a.$element.get(0),"data-error");return i&&h.remove(i),a.openErrors(),a._freeze(b)}if(d.getAttribute("data-form-detail-close"))return a.options.closeButtonHandler&&a.options.closeButtonHandler(),a._freeze(b);if(d.getAttribute("data-form-settings"))return a.options.authoringIndicator&&g.execLink({$formAuthoring:!0,path:a.options.path,name:a.options.externalLayout,schema:a.options.externalSchema,locale:a.options.externalLocale},{},null),a._freeze(b)}}}),a.$element.on("keypress",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);c&&c.keypress&&c.keypress(b)}),a.$element.on("keydown",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);c&&c.keydown&&c.keydown(b)}),a.$element.on("keyup",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);c&&c.keyup&&c.keyup(b)}),a.$element.on("mousedown",function(b){if(a._inProcessing)return a._freeze(b);var c=a._event2Field(b);return!c||!c.mousedown||c.mousedown(b)}),$(window).on("global-phoenix-resize",function(b){return a.resizeList&&a.resizeList.forEach(function(a){a.resize()}),!0}),b.prototype._addBaseEvents.call(this)},c.prototype.afterAddedInDom=function(){var a=this;a.resizeList&&a.resizeList.forEach(function(a){a.resize()}),b.prototype.afterAddedInDom.call(this)},c}(b.BaseLayout));b.Form=l,b.FormClass=l,b.removeForm=c,b.OpenForm=null}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
/// <reference path="../../core/core.ts" />
/// <reference path="../../core/modules/ajax.ts" />
/// <reference path="../../core/modules/application.ts" />
/// <reference path="../modal.control.ts" />
/// <reference path="./form.control.ts" />
/// <reference path="./schema.data.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return"on"+b.replace(/(?:^|[-_\.])(\w)/g,function(a,b){return b?b.toUpperCase():""})}var d=a.ajax,e=a.utils,f=a.application,g=a.Observable.SchemaUtils,h=function(a){function c(c,d,e,f,g){a.call(this,c,g);var h=this,i=c.opts?c.opts:{};c.validators&&(i.validators=c.validators,delete c.validators),h.render=new b.Form(d,i,f,e,g),h.render.$locale=g}return __extends(c,a),c.prototype.on=function(a){var b=this,c=function(c,d,e){return a(b,c,d,e)};this._clickHnd=function(a){b.render.afterchanged(a,"modal-action",{})},b.render.on(c)},c}(b.Modal);b.ModalForm=h;var i=function(a,b,c){g.loadSchemaRefs(b.schema,b.data,b.layout,function(d){var e=new h(a,b.layout,b.schema,d,b.locale);e.open(),c&&e.on(c)})},j=function(a,b,c,g,h,j){var k=0,l=-1,m=-1,n=[],o={locale:h},p=-1,q=f.config(f.name),r={};a=a||{},a.opts=r,h&&h.$name&&(r.externalLocale=h.$name),g&&g.then?(n.push(g),p=0,k++):o.data=$.extend(!0,{},g),"object"==typeof b?o.layout=$.extend(!0,{},b):(l=k,k++,r.externalLayout=b,n.push(d.get(q.forms+"/"+b+".json"))),"object"==typeof c?o.schema=$.extend(!0,{},c):(m=k,k++,r.externalSchema=c,n.push(d.get(q.prototypes+"/"+c+".json"))),n.length?e.Promise.all(n).then(function(b){l>=0&&(o.layout=b[l]),m>=0&&(o.schema=b[m]),p>=0&&(o.data=b[p]),i(a,o,j)}):i(a,o,j)},k=function(a,c,d,e){var f=new b.Form(c.layout,e||{design:!1},c.data,c.schema,c.locale);return f.$locale=c.locale,f.render(a),d&&f.on(d),f},l=function(a,b,c,d,e){g.loadSchemaRefs(b.schema,b.data,b.layout,function(f){b.data=f;var g=k(a,b,c,d);e&&e(g)})},m=function(a,b,c,g,h,i,j,k){var m=0,n=-1,o=-1,p=[],q={locale:h},r=-1;j=j||{},h&&h.$name&&(j.externalLocale=h.$name),g&&g.then?(p.push(g),r=0,m++):q.data=$.extend(!0,{},g);var s=f.config(f.name);"object"==typeof b?q.layout=$.extend(!0,{},b):(n=m,m++,j.externalLayout=b,p.push(d.get(s.forms+"/"+b+".json"))),"object"==typeof c?q.schema=$.extend(!0,{},c):(o=m,m++,j.externalSchema=c,p.push(d.get(s.prototypes+"/"+c+".json"))),p.length?e.Promise.all(p).then(function(b){n>=0&&(q.layout=b[n]),o>=0&&(q.schema=b[o]),r>=0&&(q.data=b[r]),l(a,q,i,j,k)})["catch"](function(a){throw console.log(a),a}):l(a,q,i,j,k)},n=function(){function a(){}return a.prototype.data=function(){return null},a.prototype.initObjectState=function(a){},a.prototype.onModelChanged=function(a,b,d){var e=this;if("propchange"===a.operation){var f=c(a.property);if(e[f])return e[f](a,b,d)}},a}();b.FormController=n,b.OpenModalForm=j,b.OpenForm=m}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../ui/layout.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../form.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c="datepicker",d=(a.render,b),e=a.dom,f=a.device,g=a.Observable,h=a.bootstrap4,i=a.ulocale,j=a.locale,k=a.customData,l=g.SchemaUtils,m=function(a,b,c,d,e){c=c||!1,d=d||"",c&&(b="*"),e=e||{};var f=e.lookup||!1;e.readOnly?k.register("ui-controls-readonly-"+d,a):k.register("ui-controls-"+b+"-"+c+"-"+f+"-"+d,a)},n=function(a,b,c,d){b=b||!1,b&&(a="*"),c=c||"";var e=!(!d||!d.lookup),f=!(!d||!d.readOnly);return f?k.get("ui-controls-readonly-"+c):k.get("ui-controls-"+a+"-"+b+"-"+e+"-"+c)},o=function(){var a=!1,b=!1;return function(){if(b)return a;if(b=!0,f.phone||f.tablet){var c=document.createElement("input");return c.setAttribute("type","date"),a="date"===c.type}return!1}},p=function(a){return"center"===a?"align-center":"right"===a?"align-end":""},q=function(){var a=!1,b=!1;return function(){if(b)return a;if(b=!0,f.phone||f.tablet){var c=document.createElement("input");return c.setAttribute("type","number"),a="number"===c.type}return!1}},r=function(a,b,c){var d=k.get("ui.html."+c);return d?{value:d(a,b),html:!0}:{value:b,html:!1}},s=function(a,b,c){var d=a.avanced.icons[b]||"none",f=p(a.avanced.alignIcon||"center"),g=[];d&&g.push(e.iconClass(d));var h=a.tableOptions&&a.tableOptions.small?"small-table":"",i=["bs-image-cell",f];h&&i.push(h);var j=['<div class="'+i.join(" ")+'"'];return a.avanced._clickable&&j.push(' data-clickable="true"'),a.avanced._expandItem&&(a.level&&j.push(' style="padding-left:'+.5*a.level+'em;"'),g.push("bs-expand-space")),a.display||g.push("bs-image-size"),j.push('><span class="'+g.join(" ")+'"></span>'),a.display&&(j.push(" "),j.push(a.display)),j.push("</div>"),{value:j.join(""),html:!0}},t={useDatePicker:function(){return!t.nativeDate()&&null!=$.fn.datepicker},nativeDate:o(),nativeNumber:q(),addErrorDiv:function(a){a.push('<div class="small text-danger bs-none" id="{0}_errors"></div>')},keyPressPassword:function(a){var b=a.which;return b!==e.keys.VK_SPACE||(a.preventDefault(),!1)},keyPressCode:function(a){var b=a.which;return b!==e.keys.VK_SPACE||(a.preventDefault(),!1)},keyPressNumber:function(a){var b="-0123456789,."+j.number.decimal,c=a.which;if(!a.metaKey&&e.ignoreKeys.indexOf(c)<0){var d=String.fromCharCode(c);if(b.indexOf(d)<0)return a.preventDefault(),!1}return!0},getRegisterdControl:n,addContainerId:function(a,b){b&&a.push(' draggable="true"'),a.push(' data-render="{0}"'),a.push(' id="{0}"')},containerBaseClass:function(a,b,c){var d=[a,c.groupFieldClass||"bs-field-group","bs-island"];return c.inline&&d.push(c.inlineFieldClass||"bs-field-inline"),b&&d.push(" design"),d.join(" ")},align2Css:p,fieldWrapper:function(a,b,c,d,e){b.inline&&(b.columns=!1);var f=e&&e.formGroup?e.formGroup:"form-group",g=[t.containerBaseClass(f,c,b)],i=e&&e.tag?e.tag:"div";a.push("<"+i+' class="'),b.size&&!h&&g.push("form-group-"+b.size),b.columns&&(h||g.push("form-horizontal"),g.push("row")),b.styles&&g.push(b.styles),b.right&&g.push(" pull-right"),a.push(g.join(" ")),a.push('"'),t.addContainerId(a,c),a.push(">"),d(),a.push("</"+i+">")},fillSelect:function(a,b,c){if(b){var d=c.enumNames||c["enum"],f=c["enum"];e.empty(b);var g=document.createDocumentFragment();a.forEach(function(a){var b=f.indexOf(a),c=d[b]||a+"",h=document.createElement("option");e.attr(h,"value",a),h.textContent=c,e.append(g,h)}),e.append(b,g)}},datePickerSetValue:function(a,b){a[c]("update",i.parseISODate(b||"")||"")},datePickerInitialize:function(a,b,d){e.addClass(a.get(0),"date");var f=$.extend({language:i.currentLang,autoclose:!0},b||{});a[c](f),d&&a[c]().on("hide",d)},datePickerDestroy:function(a){a[c]("destroy")},text2value:function(a,b){return l.isDate(b)?d.Utils.nativeDate()?a:i.localeDate2ISO(a):l.isNumber(b)?l.text2Value(a+"",b):a},defaultOptions:{titleIsHidden:!1,placeHolder:!1,labelCol:3},displayValue:function(b,c,d,f){var g;if(f=f||{},void 0===b&&(b=""),c["enum"]){var h=c["enum"].indexOf(b),k=h>=0?c.enumNames?i.tt(c.enumNames[h],d):b:"";g=f.avanced&&f.avanced.transform?r(b,k,f.avanced.transform):f.avanced&&f.avanced.icons?s(f,b,k):{value:k,html:!1}}else switch(c.type){case"string":if(c.format)switch(c.format){case"date":var k=i.shortDate(b||"");g=f.avanced&&f.avanced.transform?r(b,k,f.avanced.transform):{value:k,html:!1}}g||(g=f.avanced&&f.avanced.transform?r(b,b,f.avanced.transform):f.avanced&&f.avanced.icons?s(f,b,b):{value:b,html:!1});break;case"number":var l="money"===c.format?a.ulocale.money(b||0,f.useSymbol):i.decimal(b||0,c.decimals||0,f.useSymbol?c.symbol:"");g=f.avanced&&f.avanced.transform?r(b,l,f.avanced.transform):f.avanced&&f.avanced.icons?s(f,b,b):{value:l,html:!1};break;case"integer":var m=i.decimal(b||0,0,"");g=f.avanced&&f.avanced.transform?r(b,m,f.avanced.transform):f.avanced&&f.avanced.icons?s(f,b,b):{value:m,html:!1};break;case"boolean":if(f.avanced&&f.avanced.transform)g=r(b,b?j.ui.Yes:j.ui.No,f.avanced.transform);else if(f.html){var n=[];if(f.avanced&&f.avanced.editable||f.editable||f.check||f.avanced&&f.avanced.icons){var o="",p="bs-cursor-d";f.editable?(o="bs-bool-edit",p="bs-cursor-p"):o="bs-bool";var q=f.tableOptions&&f.tableOptions.small?" small-table":"",t=f.avanced?f.avanced.icons:null;t||(t={"true":"check-square-o","false":"square-o"});var u=t[!!b+""],v=[o,p,"bs-image-size"];u&&v.push(e.iconClass(u)),n.push('<center class="bs-image-cell'+q+'"><span data-clickable="true" class="'+v.join(" ")+'"> </span></center>'),g={value:n.join(""),html:!0}}else g={value:b?j.ui.Yes:j.ui.No,html:!1}}else g={value:b?j.ui.Yes:j.ui.No,html:!1}}if(g||(g={value:b,html:!1}),f.html&&f.avanced&&f.avanced.$link){var w=['<a class="bs-cursor-p" data-phoenix-href="link://$link">'];w.push(g.value),w.push("</a>"),g.value=w.join(""),g.html=!0}return g},addTooltip:function(a,b,c){a.push('<span id="{0}_tooltip" data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title="'+b+'" class="'+e.iconClass("question-circle")+" bs-tooltip-icon"),c&&c.inline&&a.push(" bs-tooltip-icon-inline"),a.push('"></span>')}},u=function(){function a(a,b,c){var d=this;d.config=a,d.form=c,d.parent=d.form.getLayoutById(a.$parentId),d.$bind=a.$bind,d.$display=d.config.$display||d.$bind,a.$lookup&&(d.useDisplay=d.$display!==d.$bind,d.$lookup=d.form.getLookupForSchema(d.$bind,a.$lookup));var e=l.isMeta(d.$bind);e&&(d.$bind=d.getCustomBind()),d.$bind&&c.registerListenerFor(d.$bind,d),d.useDisplay&&c.registerListenerFor(d.$display,d),d._defineProps(),d.options=b||{},d.fieldOptions=a.options||{},d.renderOptions=d.fieldOptions,d.$schema=d.$bind?c.getSchema(d.$bind):{},"array"===d.$schema.type&&(d.$schemaItems=l.expand$Ref(d.$schema.items,d.form.$rootSchema)),d.id=a.$id}return a.prototype.targetInControl=function(a){var b=this;if(b.$element){var c=b.$element.get(0);return e.isChildOf(c,a)}return!1},a.prototype.getCustomBind=function(){return""},a.prototype.setHidden=function(a){a&&(this.state.isHidden?e.addClass(a,"bs-none"):e.removeClass(a,"bs-none"))},a.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);a.state.value=a.form.getValue(a.$bind),Object.keys(b).forEach(function(c){a.state[c]=b[c]})},a.prototype._defineProps=function(){},a.prototype.render=function(a){},a.prototype.appendElement=function(a,b){var c=this;a&&(c.options.replaceParent?a.replaceWith(c.$element):a.append(c.$element))},a.prototype.setEvents=function(a){},a.prototype.removeEvents=function(){},a.prototype.customOptions=function(a){},a.prototype._initOptions=function(a){var b=this,c={};
// init default options from parent layout ($fieldsOptions)
b.parent&&b.parent.$fieldsOptions&&(b.parent.$fieldsOptions.columns&&(void 0===c.columns&&(c.columns=b.parent.$fieldsOptions.columns),void 0===c.labelCol&&b.parent.$fieldsOptions.labelCol&&(c.labelCol=b.parent.$fieldsOptions.labelCol)),b.parent.$fieldsOptions.titleIsHidden&&void 0===c.titleIsHidden&&(c.titleIsHidden=!0));var d=$.extend({},a,c,b.fieldOptions);return b.parent.$inline&&(d.inline=!0),b.customOptions(d),b.renderOptions=d,d},a.prototype.destroy=function(){var a=this;a.destroyed=!0,a.$schema=null,a.parent=null,a.$element||(a.removeEvents(),a.$element=null),a.$bind&&a.form.unRegisterListenerFor(a.$bind,a),a.useDisplay&&a.form.unRegisterListenerFor(a.$display,a)},a.prototype.showErrors=function(a,b){var c=this,d=b&&b.length,f=e.find(a,c.id+"_errors");f&&(d?(e.text(f,b[0].message),e.removeClass(f,"bs-none")):e.addClass(f,"bs-none"))},a}();if(b.AbsField=u,t.useDatePicker()){var v=function(a){$.fn.datepicker.dates[a]={days:j.date.weekdays,daysShort:j.date.weekdaysShort,daysMin:j.date.weekdaysMin,months:j.date.months,monthsShort:j.date.monthsShort,today:j.date.today,clear:j.date.clear,format:j.date.dateShort.replace(/\//g,j.date.daySep),titleFormat:"MM yyyy",weekStart:j.date.weekStart}};v(i.currentLang),i.register(v)}b.Utils=t,b.registerControl=m}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,c){b=$.extend({columns:!1},b),b.columns=!1;var f=[];return d.Utils.fieldWrapper(f,b,c,function(){f.push('<div id="{0}_alert" class="alert alert-'+(b.type||"danger")+'" role="alert">'),f.push("</div>")}),e.format(f.join(""),a)}var d=b,e=a.utils,f=a.dom,g=(a.ulocale,a.bootstrap4,function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._setDisabled=function(a,b){},b.prototype._setReadOnly=function(a,b){},b.prototype._setMandatory=function(a,b){},b.prototype._label=function(){var a=this;return a.$element?f.find(a.$element.get(0),a.id+"_alert"):null},b.prototype._state2UI=function(){var a=this,b=a._label(),c=a.$element?a.$element.get(0):null;b&&(f.text(b,a.state.value||""),a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c),a._setMandatory(b,c))},b.prototype.changed=function(a,b,c,d){var e=this,g=e._label();e.state.value!=c&&(e.state.value=c,g&&f.text(g,e.state.value||""))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._label(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},b.prototype.render=function(a){var b=this,e=b._initOptions(d.Utils.defaultOptions);return b.$element||(b.$element=$(c(b.id,e,b.options.design)),b._state2UI()),b.appendElement(a,e),b.$element},b}(b.AbsField));b.Alert=g,d.registerControl(g,"string",!1,"alert",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
/// <reference path="./utils.ts" />
/// <reference path="./dom.ts" />
var Phoenix;!function(a){var b,c=a.dom;a.utils;!function(a){function b(a){return!!c.touch()||a.which<2}function d(a){a.stopPropagation(),a.preventDefault()}function e(a){var b,d=document.documentElement;if(c.touch()){var e=a.targetTouches||a.touches;e&&(b={x:e[0].pageX||e[0].clientX+(d.scrollLeft||document.body.scrollLeft),y:e[0].pageY||e[0].clientY+(d.scrollTop||document.body.scrollTop)})}return b||(b={x:a.pageX||a.clientX+(d.scrollLeft||document.body.scrollLeft),y:a.pageY||a.clientY+(d.scrollTop||document.body.scrollTop)}),b.x=Math.round(b.x),b.y=Math.round(b.y),b}var f=function(){function a(){}return a.prototype.disable=function(){this._isDisabled=!0},a.prototype.enable=function(){this._isDisabled=!1},a}();a.EventManager=f,a.mouseEvents=function(a){if(c.touch())switch(a){case"mousedown":return"touchstart";case"mouseup":return"touchend";case"mousemove":return"touchmove"}return a},a.isLeftButton=b,a.stopEvent=d,a.point=e,a.eventManager=new f}(b=a.events||(a.events={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../typings/index.d.ts" />
/// <reference path="./utils.ts" />
/// <reference path="./events.ts" />
/// <reference path="./dom.ts" />
var Phoenix;!function(a){var b,c=a.dom,d=a.utils,e=a.events;!function(b){var f=function(){function a(){}return a.prototype.initialize=function(){var a=this,b=$(document);a._mu=a.mouseUp.bind(a),a._md=a.mouseDownEmpty.bind(a),b.on(e.mouseEvents("mouseup"),a._mu),b.on(e.mouseEvents("mousedown"),a._md)},a.prototype.finalize=function(){var a=this,b=$(document);a._mu&&(b.off(e.mouseEvents("mouseup"),a._mu),a._mu=null),a._md&&(b.off(e.mouseEvents("mousedown"),a._mu),a._md=null),a._listeners=null,a._current=null},a.prototype.startMouseMove=function(){var a=this;a._mm||(a._mm=a.mouseMove.bind(a),$(document).on(e.mouseEvents("mousemove"),a._mm))},a.prototype.stopMouseMove=function(){var a=this;a._mm&&($(document).off(e.mouseEvents("mousemove"),a._mm),a._mm=null)},a.prototype._canExecuteEvent=function(a){return!!this._current},a.prototype.mouseUp=function(a){var b=this,c=b._current;return!c||(c.inDragging&&c.notifyDragEnd(!1,a),b.setCurrent(null),c.clear(),!1)},a.prototype.mouseDownEmpty=function(a){return!0},a.prototype.mouseMove=function(a){var b=this;if(b._canExecuteEvent(a)){var c=b._current;if(!c)return!0;if(!c.ready(a))return e.isLeftButton(a)||(b.setCurrent(null),c.clear()),!0;if(!e.isLeftButton(a))return b.cancelDrag(),!0;try{c.notifyDrag(a)}catch(d){b.cancelDrag()}return e.stopEvent(a),!0}},a.prototype.addDrag=function(a){var b=this,c=new g(a);return b._listeners=b._listeners||[],b._listeners.push(c),c},a.prototype.rmvDrag=function(a){var b=this;if(b._listeners){var c=b._listeners.indexOf(a);c>=0&&(b._listeners.splice(c,1),a.finalize())}},a.prototype.setCurrent=function(a){var b=this;return(!a||!b._current)&&(b._current=a,b._current||b.stopMouseMove(),!0)},a.prototype.cancelDrag=function(){var a=this,b=a._current;b&&(b.inDragging&&b.notifyDragEnd(!0,null),a.setCurrent(null),b.clear())},a.prototype.cover=function(a,b,e){var f=this;if(a){if(!f._coverId){f._coverId=d.allocID();var g=c.documentScroll(),h=c.documentClientDim();h.width+=g.left,h.height+=g.top,h.width=Math.round(Math.max(h.width,document.body.offsetWidth)),h.height=Math.round(Math.max(h.height,Math.round(document.body.offsetHeight)));var i=document.createElement("div");i.id=f._coverId,i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.backgroundColor="white",i.style.opacity="0.01",i.style.width=h.width+"px",i.style.height=h.height+"px",i.style.zIndex=(e||1e4)+"",i.style.cursor=b,c.append(document.body,i)}}else if(f._coverId){var j=c.find(document.body,f._coverId);f._coverId=null,j&&c.remove(j)}},a}();b.DragAndDropManager=f;var g=function(){function a(a){var b=this;b._elements=a,b._mdEvent=b.mousedown.bind(b),b.clear(),b._setEvents()}return a.prototype.clear=function(){var a=this,b=a.stopEvent;
//init
a.mouseMoveCount=0,a.minLeft=null,a.maxLeft=null,a.minTop=null,a.maxTop=null,a.currentLeft=0,a.currentTop=0,a.moveX=!1,a.moveY=!1,a.inDragging=!1,a.coverDocument=!0,a.cursor="default",a.startPoint=null,a.currentPoint=null,a.startOffset=null,a.stopEvent=!1,a.data={},a.floatElement=null,a.floatParent=null,
// restore
a.stopEvent=b},a.prototype._removeEvents=function(){var a=this;a._elements&&(a._elements.forEach(function(b){$(b).off(e.mouseEvents("mousedown"),a._mdEvent)}),a._elements=null)},a.prototype._setEvents=function(){var a=this;a._elements&&a._elements.forEach(function(b){$(b).on(e.mouseEvents("mousedown"),a._mdEvent)})},a.prototype.mousedown=function(a){var c=this;return c.mouseMoveCount=0,c.inDragging=!1,!e.isLeftButton(a)||(!c.canStartDrag(a)||(!b.dragManager.setCurrent(c)||(c.startPoint=e.point(a),b.dragManager.startMouseMove(),c.stopEvent&&e.stopEvent(a),!1)))},a.prototype.finalize=function(){var a=this;a._removeEvents(),d.cleanUpObject(a)},a.prototype.ready=function(a){var b=this;return b.mouseMoveCount++,2==b.mouseMoveCount&&b.notifyDragStart(a),b.inDragging},a.prototype.notifyDrag=function(a){var b=this;if(b.inDragging){b.currentPoint=e.point(a);var c=b.floatElement;if(c&&b.moveX){var d=b.startOffset.left+b.currentPoint.x-b.startPoint.x;null!==b.minLeft&&d<b.minLeft&&(d=b.minLeft),null!==b.maxLeft&&d>b.maxLeft&&(d=b.maxLeft),b.currentLeft=d,c.style.left=d+"px"}if(c&&b.moveY){var f=b.startOffset.top+b.currentPoint.y-b.startPoint.y;null!==b.minTop&&f<b.minTop&&(f=b.minTop),null!==b.maxTop&&f>b.maxTop&&(f=b.maxTop),b.currentTop=f,c.style.top=f+"px"}b.onDrag&&b.onDrag(a)}},a.prototype.notifyDragStart=function(a){var d=this;d.inDragging=!0,e.eventManager.disable(),d.coverDocument&&b.dragManager.cover(!0,d.cursor);try{d.onDragStart&&(d.onDragStart(a)||d.notifyDragEnd(!0,a),d.floatElement&&(d.startOffset=c.position(d.floatElement,d.floatParent)))}catch(f){}},a.prototype.canStartDrag=function(a){var b=this;return!b.canStartDragHandler||b.canStartDragHandler(a)},a.prototype.canDrop=function(a){var c=this;c.coverDocument&&b.dragManager.cover(!0,a?c.cursor:"no-drop")},a.prototype.notifyDragEnd=function(a,c){var f=this;f.inDragging=!1;var g=f.coverDocument;f.onDragEnd&&f.onDragEnd(a,c),d.nextTick(function(){e.eventManager.enable(),g&&b.dragManager.cover(!1)})},a}();b.DragElement=g,b.dragManager=new f,a.dom.readyHandlers.push(function(){b.dragManager.initialize()});var h,i=function(a){h=a},j=function(){return h};b.setData=i,b.getData=j}(b=a.drag||(a.drag={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../../../core/modules/locale.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.dom,c=b,f=a.ulocale,g=a.Observable.SchemaUtils,h=function(a,b,c,d){c&&d.push(' draggable="true"'),d.push(' data-render="{0}"')},i=function(a,b){var c=e.icon(b?"caret-up":"caret-down");e.addClass(c,"bs-basictable-sort"),e.attr(c,"sort","true"),e.append(a.firstElementChild,c)},j=function(a){var b=a.lastElementChild?a.firstElementChild.lastElementChild:null;b&&"true"===e.attr(b,"sort")&&e.remove(b)},k=function(b,c,d,e){var f,g=[];return d._useColGrp&&(e?(f=a.dom.find(c,b+"_colgrp_frozen_header"),f&&g.push(f),f=a.dom.find(c,b+"_colgrp_frozen"),f&&g.push(f)):(f=a.dom.find(c,b+"_colgrp_header"),f&&g.push(f),f=a.dom.find(c,b+"_colgrp"),f&&g.push(f))),d.headerIsHidden||(f=e?a.dom.find(c,b+"_frozen_cols"):a.dom.find(c,b+"_cols"),f&&g.push(f)),g},l=function(a,b,c){b.forEach(function(b){for(var d=0,f=b.childNodes.length;d<f;d++){var g=b.childNodes[d],h=e.attr(g,"colid");if(h===a){g.style.width=c+"px";break}}})},m=function(a,b,c,d){if(a.sorting&&b&&b.childElementCount){var f=(d||"").split(" ");f.length||(f=[""]);for(var g=0,h=b.children.length;g<h;g++){var k=b.children[g],l=e.attr(k,"colId");f[0]===l?(j(k),i(k,1==f.length)):j(k)}}},n=function(a){if("number"==typeof a)return!0;if("string"==typeof a){var b=parseInt(a,10)+"";if(b===a.trim())return!0;if(b+"px"===a.trim())return!0}return!1},o=function(a){return"number"==typeof a?a+"px":parseInt(a,10)+""===a.trim()?a.trim()+"px":a},p=function(a){return g.isBoolean(a)?50:g.isDate(a)?110:g.isNumber(a)?110:150},q=function(a,b){var c=document.createElement("tr");c.className="bs-table-row-detail",c.id=a+"_detail";var d=document.createElement("td");return d.colSpan=b.childNodes.length,e.append(c,d),c},r=function(a,b,c){var d=document.createDocumentFragment();return a.forEach(function(a){var b=document.createElement("col");e.attr(b,"colid",a.$bind),a.options.width&&(b.style.width=o(a.options.width)),a.options.minWidth&&(b.style.minWidth=o(a.options.minWidth)),e.append(d,b)}),d},s=function(a,b,c,d,h,j,k){var l=document.createDocumentFragment(),m=(j||"").split(" ");return b.forEach(function(a,b){var d,k=document.createElement("th");e.attr(k,"colId",a.$bind),e.attr(k,"data-drag","move"),c._useColGrp||(a.options.width&&(k.style.width=o(a.options.width)),a.options.minWidth&&(k.style.minWidth=o(a.options.minWidth))),d&&(k.className=d.join(" "));var p=document.createElement("div");if(p.className="bs-column-header",e.append(p,document.createTextNode(f.tt((a.isLink?"":a.title)||String.fromCharCode(160),h))),c.allowColumnResize&&n(a.options.width)){var q=document.createElement("div");q.className="bs-col-resize",e.attr(q,"data-drag","resize"),e.attr(k,"colId",a.$bind),e.append(p,q)}e.append(k,p),c.sorting&&g.canSort(a.schema)&&(d=d||[],d.push("bs-cursor-p"),m&&m.length&&m[0]===a.$bind&&i(k,1===j.length)),d&&(k.className=d.join(" ")),e.append(l,k)}),l},t=function(a,b,c,d,f,g,h){var i=document.createDocumentFragment();return b&&b.forEach(function(b,j){e.append(i,u(a,j,b,c,d,f,g,h))}),i},/*
        *  row: {name: fieldName, schema: {}}
        */
u=function(a,b,d,f,g,h,i,j){var k=document.createElement("tr");return"middle"===h.align&&e.addClass(k,"bs-va-middle"),g.forEach(function(a,g){var i=document.createElement("td");if(0==g)e.append(i,document.createTextNode(d.schema.title||String.fromCharCode(160)));else{e.attr(i,"rowId",a.id),e.attr(i,"colId",d.name),i.rowIndex=b,i.colIndex=g-1;var l=f.get(g-1),m=c.Utils.displayValue(l.getRelativeValue(d.name),d.schema,j,{html:!0,useSymbol:!0,editable:d.canEdit,check:d.check,avanced:null,tableOptions:h});if(m.html){var n=$(m.value);e.append(i,n.get(0))}else e.append(i,document.createTextNode(m.value))}e.append(k,i)}),k},v=function(a,b,c,d){if(c.selecting&&c.selecting.row){var f=[],g=e.find(d,a);g&&f.push(g),c.allowFrozenColumns&&(g=e.find(d,a+"_frozen"),g&&f.push(g)),f.forEach(function(a){b?e.addClass(a,"bs-row-selected"):e.removeClass(a,"bs-row-selected")})}},w=function(a,b,d,f,h,i,j,k,l,m){var n=document.createElement("tr");n.id=f.$id+(m?"_frozen":"");var p=["bs-table-row"];if("middle"===i.align&&p.push("bs-va-middle"),f.$select&&i.selecting&&i.selecting.row&&p.push("bs-row-selected"),d&&p.push("bs-row-level-"+d),n.className=p.join(" "),!i._useStripedCss){var q=b%2===1;q||e.addClass(n,"even")}return h.forEach(function(a,h){var j=document.createElement("td");0===b&&i.headerIsHidden&&!i._useColGrp&&(a.options.width&&(j.style.width=o(a.options.width)),a.options.minWidth&&(j.style.minWidth=o(a.options.minWidth)));var l=[];a.options._expandItem&&l.push("bs-cursor-d");var m=a.options.align;if(a.schema){var p=g.isNumber(a.schema),q=g.isDate(a.schema)||g.isDateTime(a.schema);i._nowrap||!p&&!q||l.push("nowrap"),m||(p?m="right":q&&(m="center"))}m&&l.push(c.Utils.align2Css(m)),l.length&&(j.className=l.join(" ")),e.attr(j,"colId",a.$bind);var r=f.getRelativeState(a.$bind);if(r.isHidden);else if(a.isLink){var s=void 0,t=void 0;if(a.options.button){var u="";s=document.createElement("button"),s.type="button",r.isDisabled&&(s.disabled=!0);var v="normal"===a.options.size?"":" btn-"+(i.size||"sm");if(s.className="bs-button btn btn-"+(a.options.type||"link")+v+(r.isDisabled?" disabled":""),a.options.icon&&(t=document.createElement("span"),t.className=e.iconClass(a.options.icon),e.append(s,t),u=" "),a.schema.title){var w=document.createTextNode(u+a.schema.title);e.append(s,w)}}else if(a.options.icon){s=document.createElement("center"),r.isDisabled&&e.addClass(s,"bs-disabled"),t=document.createElement("span");var x=["text-"+(a.options.type||"default")];x.push("bs-basictable-btn"),x.push(e.iconClass(a.options.icon)),t.className=x.join(" "),e.append(s,t)}s&&(s.$link=a.$bind,e.append(j,s))}else{var y=j,z=a.options||{},A=z.editable&&!r.isDisabled&&!r.isReadOnly&&!r.isHidden;if(!r.isHidden){var B=null;z.display&&z.displaySchema&&(B=c.Utils.displayValue(f.getRelativeValue(z.display),z.displaySchema,k,{tableOptions:i}).value);var C=c.Utils.displayValue(f.getRelativeValue(a.$bind),a.schema,k,{html:!0,useSymbol:!1,selectable:z.selectable,editable:A,check:z.check,avanced:z,tableOptions:i,display:B,level:d});if(C.html){var D=$(C.value);e.append(y,D.get(0))}else e.append(y,document.createTextNode(C.value))}}e.append(n,j)}),n},x=function(a,b,c,d,f,g,h,i){var j=document.createDocumentFragment();return b&&b.forEach(function(b,k){var l=b.level||0;i&&i(b.value,k,l);var m=k%2===1;e.append(j,w(a,k,l,b.value,c,d,f,g,m,h))}),j},y=function(a,b,c,d,f,g,h,i){var j=document.createDocumentFragment();return b&&b.forEach(function(b,k,l){l=l||0,i&&i(b,k,l);var m=k%2===1;e.append(j,w(a,k,l,b,c,d,f,g,m,h))},d.expandingProperty),j},z=function(a){for(var b=!0,c=0,d=a.length;c<d;c++){var e=a[c];if(e.options.editable&&!g.isBoolean(e.schema)){b=!1;break}}return b},A=function(a,b){
// all columns have width defined (but not minWidth)
for(var c=!0,d=0,e=b.length;d<e;d++){var f=b[d];if(!f.options.width||f.options.minWidth){c=!1;break}}if(c=c&&"auto"!==a.width,!c){var g=a.scrolling&&a.scrolling.vertical;if(g)throw"To support scrolling vertical, all columns must have explicit widths but not explicit minWidth.";if(a.editing&&!z(b))throw"To support inline editing, all columns must have explicit widths but not explicit minWidth."}return c},B=function(a,b){var c=!!(a.allowFrozenColumns&&b&&b.length);return c},C=function(a,b,c){var d=a.scrolling&&a.scrolling.vertical,e=["table","bs-control"];
//adde
return b&&e.push("table-header"),!b&&a._useStripedCss&&e.push("table-striped"),a._useColGrp&&e.push("bs-fixed"),b||!a.editing&&!a.nowrap?!b&&a.allowFrozenColumns&&(e.push("nowrap"),a._nowrap=!0):(e.push("nowrap"),a._nowrap=!0),a.allowFrozenColumns&&!a.headerIsHidden&&(b?e.push("headernowrap"):d||e.push("headernowrap")),e.push("bs-theme"),a.border&&e.push("table-bordered"),a.small&&e.push("bs-style-small-table"),e},D=function(a,b,c){var d=[];return c?d:(a.width&&"auto"!==a.width&&d.push("min-width: "+o(a.width)),d)},E=function(a,b,c,d){var e=b.scrolling&&b.scrolling.vertical,f=C(b,c,d);a.push("<table"),f.length&&a.push(' class="'+f.join(" ")+'"'),a.push(' id="{0}_table'),d&&a.push("_frozen"),c&&a.push("_header"),a.push('"');var g=D(b,c,d);g.length&&a.push(' style="'+g.join(";")+'"'),a.push(">"),
//if (options.description) {
//    html.push("<caption>");
//    _ui.Utils.addTooltip(html, options.description, options);
//    html.push("</caption>");
//}
b._useColGrp&&a.push('<colgroup id="{0}_colgrp'+(d?"_frozen":"")+(c?"_header":"")+'"></colgroup>'),b.headerIsHidden||(c?a.push('<thead><tr class="bs-va-middle" id="{0}'+(d?"_frozen":"")+'_cols"></tr></thead>'):e||a.push('<thead><tr class="bs-va-middle" id="{0}'+(d?"_frozen":"")+'_cols"></tr></thead>')),c||(a.push('<tbody id="{0}'),d&&a.push("_frozen"),a.push('_rows"></tbody>')),a.push("</table>")},F=function(a){var b=0;return a.forEach(function(a){b+=parseInt(a.options.width+"",10)}),b},G=function(a,b,c){var d=F(c),f=e.find(a,b+"_frozen_header_parent");f&&(f.style.width=d+"px"),f=e.find(a,b+"_frozen_header_sep"),f&&(d?e.removeClass(f,"empty"):e.addClass(f,"empty"))},H=function(a){var b=a.cloneNode(!0);if("th"===b.tagName.toLowerCase()){var c=a.parentElement,d=c.parentElement.parentElement,f=["<div>"];f.push('<table class="'),f.push(d.className),f.push('">'),f.push("<thead>"),f.push('<tr class="'),f.push(c.className),f.push('">'),f.push("</tr></thead><table>"),f.push("</div>");var g=$(f.join("")).get(0),h=g.firstChild.firstChild.firstChild;h.style.height=a.offsetHeight+"px",e.append(h,b),b=g}var i=e.position(a,null);return b.style.top=i.top+"px",b.style.left=i.left+"px",b.style.width=a.offsetWidth+"px",b.style.height=a.offsetHeight+"px",b.style.zIndex="5000",b.style.position="absolute",b},I=function(a,b,f,g,i,j,k){g=g||"",b._useColGrp=A(b,j),b._useStripedCss=!(b.rows&&b.rows.detail),b=$.extend({right:!1,icon:null,type:"default",width:"auto",height:"auto",size:null,scrolling:{horizontal:!1}},b),
//create div container 
void 0!==b.title&&(g=b.title);var l=[],m=["bs-field-group bs-island"];l.push('<div id="{0}" '),l.push(' class="'),f&&m.push("design"),l.push(m.join(" ")),l.push('"'),h(a,b,f,l),l.push(">"),
//create header div
l.push('<div id="{0}_header"></div>'),m=["bs-basictable-group"];var n=b.scrolling&&b.scrolling.horizontal,o=b.scrolling&&b.scrolling.vertical;if((o||b.allowFrozenColumns)&&m.push("border"),n&&!o&&m.push("bs-scroll-x"),l.push('<div id="{0}_focus" class="'),l.push(m.join(" ")),l.push('"'),b.selecting&&(b.selecting.cell||b.selecting.row)&&l.push(' tabindex="0" '),l.push(">"),b.allowFrozenColumns){l.push('<div class="bs-table-cols">');var p=F(k);if(l.push('<div id="{0}_frozen_header_parent"  class="bs-table-frozen-cols" style="width:'+p+'px;">'),o&&!b.headerIsHidden&&(
// parent of frozen header table
l.push('<div id="{0}_table_frozen_header" class="bs-table-header">'),
// frozen header table 
E(l,b,!0,!0),l.push("</div>")),
// parent of frozen table content
m=["bs-table-content-scroll frozen"],l.push('<div  class="'+m.join(" ")+'">'),m=["bs-table-content frozen"],l.push('<div id="{0}_frozen_scroll" class="'+m.join(" ")+'"'),o){var q=[];if(!b.height||"auto"===b.height)throw"To support scrolling vertical, the grid must have an explicit height.";q.push("height: "+parseInt(b.height+"",10)+"px"),q.length&&l.push(' style="'+q.join(";")+'"')}l.push(">"),l.push('<div  class="'+m.join(" ")+'">'),E(l,b,!1,!0),l.push("</div>"),l.push("</div>"),l.push("</div>"),l.push("</div>"),// bs-table-frozen-cols
l.push('<div id="{0}_frozen_header_sep" class="bs-table-cols-sep'+(k.length?"":" empty")+'"></div>'),l.push('<div class="bs-table-free-cols">')}if(o&&!b.headerIsHidden&&(l.push('<div id="{0}_table_header" class="bs-table-header" style="padding-right:'),l.push(e.scrollbar()),l.push('px;">'),l.push('<div id="{0}_table_header_content" class="bs-table-header-content">'),E(l,b,!0,!1),l.push("</div></div>")),
//create div table container
o&&l.push('<div  class="bs-table-content-scroll">'),m=["bs-table-content"],o&&m.push("vscroll"),l.push('<div id="{0}_master_scroll" class="'+m.join(" ")+'"'),o){var q=[];if(!b.height||"auto"===b.height)throw"To support scrolling vertical, the grid must have an explicit height.";q.push("height: "+parseInt(b.height+"",10)+"px"),q.length&&l.push(' style="'+q.join(";")+'"')}
// create table
//bs-table-content-scroll
//bs-table-free-cols
return l.push(">"),E(l,b,!1,!1),l.push("</div>"),o&&l.push("</div>"),b.allowFrozenColumns&&(l.push("</div>"),l.push("</div>")),l.push("</div>"),l.push('<center id="{0}_pagination"></center>'),c.Utils.addErrorDiv(l),l.push("</div>"),d.format(l.join(""),a)},J=function(a,b){var c=document.createElement("div");return c.className="bs-absolute bs-col-resize-indicator",c.style.top="0px",c.style.left=b.left+"px",e.append(a,c),c},K=function(a,b,c,e,f,g,h,i){var j=e.filter?h.schema.filters[e.filter]||[]:h.schema["enum"],k=j.indexOf(c);k<0?(d.nextTick(function(){g.item.setValue(h.$bind,j[0])}),a.input.selectedIndex=0):a.input.selectedIndex=k},L=function(a,b,c,d,e,f,h,i){return h.schema["enum"]?K(a,b,c,d,e,f,h,i):(b=b||"",g.isNumber(h.schema)?void(a.input.value=i.nativeNumber?c:b):g.isDate(h.schema)?void(a.input.value=i.nativeDate?c:b):void(a.input.value=b))},M=function(a,b,f,g,h,i,j){var k=document.createElement("select");k.type="text";var l=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];k.className=l.join(" ");var m=f.filter?i.schema.filters[f.filter]||[]:i.schema["enum"],n=m.indexOf(b);return c.Utils.fillSelect(m,k,i.schema),e.empty(g),e.addClass(g,"focused"),e.append(g,k),n<0?(d.nextTick(function(){h.item.setValue(i.$bind,m[0])}),k.selectedIndex=0):k.selectedIndex=n,{input:k,parent:k,td:g,isInputElement:!0,canSelect:!1,schema:i.schema}},N=function(a,b,d,h,i,j,k){var l=document.createElement("div");l.className="bs-inplace-parent bs-edit-border ";var m=l;k.after&&(m=document.createElement("div"),m.className="bs-input-group",l.appendChild(m));var n=g.isDate(j.schema)&&c.Utils.useDatePicker(),o=document.createElement("input");o.type=k.type||"text";var p=["bs-inplace-edit bs-inplace-edit-size"];if(k.after&&p.push("bs-input-group-main"),o.className=p.join(" "),e.append(m,o),k.after){var q=document.createElement("span");q.tabIndex=-1,q.className="bs-input-group-addon bs-cursor-d add-on";var r=document.createElement("span");r.className=e.iconClass(k.after.icon),e.append(q,r),e.append(m,q)}return e.empty(h),e.addClass(h,"focused"),e.append(h,l),g.isDate(j.schema)&&(n?(c.Utils.datePickerInitialize($(l),{showOnFocus:!1},function(a){}),c.Utils.datePickerSetValue($(l),b)):o.value=f.isoDatePart(b||"")),{input:o,parent:l,td:h,isInputElement:!0,canSelect:!0,schema:j.schema}},O=function(a){if(a.childNodes.length)for(var b=!1,c=0,d=a.childNodes.length;c<d;c++){var f=a.childNodes[c];e.hasClass(f,"bs-table-row")&&(b?e.removeClass(f,"even"):e.addClass(f,"even"),b=!b)}},P=function(a,b,d,h,i,j,k){if(j.schema["enum"])return M(a,b,d,h,i,j,k);if(g.isBoolean(j.schema))return{input:null,parent:null,td:h,isInputElement:!1,canSelect:!1,schema:j.schema};if(k.after||k.before)return N(a,b,d,h,i,j,k);var l=document.createElement("input");l.type=k.type||"text";var m=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];return j.options.align&&m.push(c.Utils.align2Css(j.options.align)),"text"===l.type&&j.schema.maxLength&&(l.maxLength=j.schema.maxLength),l.className=m.join(" "),e.empty(h),e.addClass(h,"focused"),e.append(h,l),g.isDate(j.schema)?k.nativeDate?l.value=f.isoDatePart(b||""):l.value=f.shortDate(b||""):g.isNumber(j.schema)&&k.nativeNumber?l.value=b||0:l.value=a,{input:l,parent:l,td:h,isInputElement:!0,canSelect:!0,schema:j.schema}},Q={createCols:s,createColGroup:r,updSorting:m,gridContainer:I,createRows:y,createBulkRows:x,createRow:w,setRowsSelected:v,createGridRows:t,createInplaceEdit:P,updateInplaceEdit:L,createDetail:q,updateEvenOdd:O,ensureWidth:o,updateFrozenWidth:G,setColumnWidth:l,hasFrozenColumns:B,cloneForMove:H,isPixel:n,widthFromSchema:p,resizeDiv:J,getColumnsSizeParents:k};b.GridUtil=Q}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="../../../core/modules/drag.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../errors.data.ts" />
/// <reference path="../../pager.control.ts" />
/// <reference path="./basicgrid.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.dom,c=b,f=a.ulocale,g=a.Observable,h=c.GridUtil,i=g.errorsUtils,j=a.link,k=a.locale,l=a.drag,m=a.events,n=g.SchemaUtils,o=20,p=2e3,q=function(a,b){return(b!==e.keys.VK_TAB||!a.shiftKey)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)},r=function(a){a=(a||"")+"",a=a.trim();var b=parseInt(a,10);return b+""===a||b+"px"===a||b+" px"===a};b.glbGridFilter=null,b.glbGridSettings=null;var s=function(a){function s(b,c,d){a.call(this,b,c,d),this._refreshGrid=function(){var a=this,b=a.renderOptions;a.removeEvents(),a._initCols(b),a._renderColumns(b),a._renderRows(!0,"",null),a.setEvents(a.renderOptions),a.resize()};var e=this;e._view=[],e._viewMap={},e._ignoreNotifications=!1,d.registerListenerFor(e.$bind+".$item",e),e._state(),e.checkOptions(e.fieldOptions),e._initOrigColumns(e.fieldOptions),e._initCols(e.fieldOptions),e._details=[]}return __extends(s,a),s.prototype._initOrigColumns=function(a){var b=this;b._originalCols={},a.columns=a.columns||[],a.columns.forEach(function(a){a.options=a.options||{},a.$bind===g.EXPANDED_FIELD_NAME&&a.options.display&&(b._originalCols[a.options.display]=$.extend(!0,{},a),b._originalCols[a.options.display].options._expandItem=!0)})},s.prototype.checkOptions=function(a){void 0===a.allowColumnMove&&(a.allowColumnMove=!0),a.align=a.align||"middle"},s.prototype._inplaceEditValue2Model=function(a,b,c){var d=n.text2Value(a,c.schema),e=b.getValue(c.$bind);return d!==e&&(b.setValue(c.$bind,d),!0)},s.prototype._inplaceEditAcceptKeys=function(a){var b=this;if(b.inplace.schema["enum"]){if(a===e.keys.VK_UP||a===e.keys.VK_DOWN)return!1}else if(n.isDate(b.inplace.schema)&&c.Utils.useDatePicker()&&(a===e.keys.VK_UP||a===e.keys.VK_DOWN||a===e.keys.VK_LEFT||a===e.keys.VK_RIGHT))return!1;return!0},s.prototype._inplaceEditAddEvents=function(){var a=this;a.inplace.schema["enum"]&&$(a.inplace.input).on("change",function(b){var c=a.inplace.td,d=a._td2value(c),e=a._inplaceEditGetValue(d);a._inplaceEditValue2Model(e,d.item,d.col)||a._modifyCell(d.item,d.col.$bind,c)})},s.prototype._inplaceEditRemoveEvents=function(){var a=this;a.inplace.schema["enum"]?$(a.inplace.input).off("change"):n.isDate(a.inplace.schema)&&c.Utils.useDatePicker()&&b.Utils.datePickerDestroy($(a.inplace.parent))},s.prototype._inplaceEditGetValue=function(a){var b=this;if(b.inplace.schema["enum"]){if(!a.item)return null;var d=b.inplace.input.selectedIndex,e=a.item.getState(a.col.$bind);return e.filter?b.inplace.schema.filters[e.filter][d]:b.inplace.schema["enum"][d]}return c.Utils.text2value(b.inplace.input.value,b.inplace.schema)},s.prototype._inpaceEditShow=function(a,b){var d=this,f=d._td2value(a),g=f.item.getValue(f.col.$bind),i=f.item.getState(f.col.$bind),j=n.value2Text(g,f.col.schema);a.tabIndex=-1;var k={nativeNumber:!1,nativeDate:!1,type:"text",after:null};n.isDate(f.col.schema)?(k.nativeDate=c.Utils.nativeDate(),k.nativeDate?k.type="date":c.Utils.useDatePicker()&&(k.after={icon:"calendar"})):n.isNumber(f.col.schema)&&(k.nativeNumber=c.Utils.nativeNumber(),k.nativeNumber&&(k.type="number")),d.inplace=h.createInplaceEdit(j,g,i,a,f,f.col,k),d._inplaceEditAddEvents(),d.inplace.isInputElement?(d.inplace.input.tabIndex=0,d.inplace.input.focus(),d.inplace.canSelect&&e.select(d.inplace.input)):(
// focus on td ?
a.tabIndex=0,a.focus())},s.prototype._inplaceEditRemove=function(a,b){var c=this;if(c.inplace&&!b){var d=c.inplace.td;a&&(d.tabIndex=0);var f=c._td2value(d);c._inplaceEditRemoveEvents(),c.inplace.parent&&e.remove(c.inplace.parent),e.removeClass(d,"focused");var g=!!c.inplace.input;if(g){var h=c._inplaceEditGetValue(f);if(c.inplace=null,!f.item)return;c._inplaceEditValue2Model(h+"",f.item,f.col)||c._modifyCell(f.item,f.col.$bind,d)}}c.inplace=null},s.prototype._inplaceEditModel2Control=function(a,b,d){var e=this,f=e._td2value(d),g=(e._inplaceEditGetValue(f),a.getValue(f.col.$bind)),i=a.getState(f.col.$bind),j=n.value2Text(g,f.col.schema),k={nativeNumber:c.Utils.nativeNumber(),nativeDate:c.Utils.nativeDate()};h.updateInplaceEdit(e.inplace,j,g,i,d,f,f.col,k)},s.prototype.removeEvents=function(){var a=this;a.scrollableMaster&&$(a.scrollableMaster).off("scroll"),a.scrollableFrozenContent&&a.fieldOptions.editing&&$(a.scrollableFrozenContent).off("scroll"),a.scrollableMaster=null,a.scrollableHeaderOfMaster=null,a._drag&&(l.dragManager.rmvDrag(a._drag),a._drag=null)},s.prototype.setEvents=function(a){var b=this,c=a.scrolling&&a.scrolling.vertical;if(c){var d=b.$element.get(0);b.scrollableMaster=e.find(d,b.id+"_master_scroll"),b.scrollableHeaderOfMaster=e.find(d,b.id+"_table_header_content");var f=h.hasFrozenColumns(a,b.frozenColumns);b.scrollableFrozenContent=f?e.find(d,b.id+"_frozen_scroll"):null,b.scrollableMaster&&b.scrollableHeaderOfMaster&&$(b.scrollableMaster).on("scroll",b.syncHeaderAndFrozenScroll.bind(b)),b.scrollableFrozenContent&&b.fieldOptions.editing&&$(b.scrollableFrozenContent).on("scroll",b.syncMasterScroll.bind(b))}if((a.allowColumnResize||a.allowColumnMove)&&!a.headerIsHidden){var g=l.dragManager.addDrag([b.$element.get(0)]);b._drag=g,g.canStartDragHandler=b._canStartDrag.bind(b),g.onDragStart=b._onDragStart.bind(b),g.onDrag=b._onDrag.bind(b),g.onDragEnd=b._onDragEnd.bind(b)}},s.prototype._getColsInfo=function(a,b){var c=[];return a.forEach(function(a,e){var f=b.childNodes[e];f.id||(f.id=d.allocID()),c.push({htmlId:f.id,info:a})}),c},s.prototype._canStartDrag=function(a){var b=this,c=a.target,f=e.attr(c,"data-drag"),g=e.parentByTag(b.$element.get(0),c,"th");if(g)return f||(f=e.attr(g,"data-drag")),!!f&&(g.id||(g.id=d.allocID()),b._drag.data.op=f,b._drag.data.cloneId=g.id,b._drag.data.column=e.attr(g,"colId"),!!b._drag.data.column&&b["_cdd"+f](a))},s.prototype._onDragStart=function(a){var b=this;return!!b._drag.data.op&&b["_sdd"+b._drag.data.op](a)},s.prototype._onDrag=function(a){var b=this;return!!b._drag.data.op&&b["_ddd"+b._drag.data.op](a)},s.prototype._onDragEnd=function(a,b){var c=this;return!!c._drag.data.op&&c["_edd"+c._drag.data.op](a,b)},s.prototype._cddresize=function(a){var b=this,c=b.renderOptions;if(!c.allowColumnResize)return!1;var d=b._drag;return d.coverDocument=!0,d.cursor="col-resize",d.moveX=!0,!0},s.prototype._sddresize=function(a){var b=this,c=b._drag;c.floatParent=b._gridParentFocus();var d=e.find(c.floatParent,b._drag.data.cloneId),f=e.position(d,c.floatParent);return c.floatElement=h.resizeDiv(c.floatParent,{left:Math.round(f.left+d.offsetWidth)}),c.minLeft=Math.round(f.left+o),c.maxLeft=Math.round(f.left+p),!0},s.prototype._dddresize=function(a){return!0},s.prototype._eddresize=function(a,b){var c=this,d=c._drag;if(d&&(d.floatElement&&(e.remove(d.floatElement),d.floatElement=null),!a)){var f=c._colByField(d.data.column),g=m.point(b),h=g.x-d.startPoint.x,i=e.find(d.floatParent,c._drag.data.cloneId),j=parseInt(f.options.width+"",10);if(i.offsetWidth-j>5){var k=j/i.offsetWidth;h=Math.round(k*h)}var l=Math.min(Math.max(o,j+h),p);c._updateColWidth(f,l)}},s.prototype._updateColWidth=function(a,b){var c=this,d=Math.max(parseInt(a.options.width||"0",10),p);if(d!==b){a.options.width=b;var e=a.options.frozen&&c.renderOptions.allowFrozenColumns,f=h.getColumnsSizeParents(c.id,c.$element.get(0),c.renderOptions,e);h.setColumnWidth(a.$bind,f,b),e&&h.updateFrozenWidth(c.$element.get(0),c.id,c.frozenColumns),c.resize()}},s.prototype._cddmove=function(a){var b=this,c=b.renderOptions;if(!c.allowColumnMove)return!1;var d=b.$element.get(0),f=b._drag,g=e.find(d,f.data.cloneId);f.coverDocument=!0,f.cursor="move",f.moveX=!0,f.moveY=!0,f.startOffset=e.position(g,null);var h,i,j={firstDelta:0,lastDelta:-10,delta:-4,top:f.startOffset.top,height:g.offsetHeight};if(c.allowFrozenColumns&&(h=e.find(d,b.id+"_frozen_cols"),h&&(i=e.childrenPositions(h,b._getColsInfo(b.frozenColumns,h),!1,"frozen",j))),j.lastDelta=0,h=e.find(d,b.id+"_cols")){var k=e.childrenPositions(h,b._getColsInfo(b.columns,h),!1,"free",j);i=i?i.concat(k):k}return f.data.childrenPositions=i,!0},s.prototype._sddmove=function(a){var b=this,c=b._drag,d=e.find(b.$element.get(0),c.data.cloneId);return c.floatElement=h.cloneForMove(d),e.append(document.body,c.floatElement),!0},s.prototype._eddmove=function(a,b){var c=this,d=c._drag;if(d&&(d.floatElement&&(e.remove(d.floatElement),d.floatElement=null),d.data.mdiv&&(e.remove(d.data.mdiv),d.data.mdiv=null),!a&&d.data.best&&d.data.column)){var f=d.data.best.info,g=c._mapCols[d.data.column];if("empty"===d.data.best.position)
//frozen --> free or free -> frozen
g.column.options.frozen=!g.column.options.frozen;else{if(f.$bind===g.column.$bind)return;var h=c._mapCols[f.$bind],i=g.column,j=h.column,k=g.tindex,l="after"===d.data.best.position?h.tindex+1:h.tindex,m=!1;if(!!i.options.frozen!=!!j.options.frozen&&(i.options.frozen=j.options.frozen,m=!0),k===l-1){if(!m)return}else
// remove src
c.renderOptions.columns.splice(k,1),k<l&&l--,
// insert at ni
c.renderOptions.columns.splice(l,0,i)}c._refreshGrid()}},s.prototype._dddmove=function(a){var b=this,c=b._drag,d=m.point(a),f=e.findNearest(d.x,d.y,c.data.childrenPositions);if(c.data.best!=f){var g={left:f.left,top:f.top,width:f.width,height:f.height};c.data.mdiv=e.showMove(c.data.mdiv,f.vertical,g,"frozen"===f.zone?"bs-drag-color-success":"bs-drag-color-info")}return c.data.best=f,!0},s.prototype.destroy=function(){var b=this;b._destroyDetails(),b.columns&&(b.columns.forEach(function(a){a.schema=null}),b.columns=null),b.frozenColumns&&(b.frozenColumns.forEach(function(a){a.schema=null}),b.frozenColumns=null),b.form.unRegisterListenerFor(b.$bind+".$item",b),b._inplaceEditRemove(!1,!0),b._pager&&(b._pager.destroy(),b._pager=null),b._toolBar&&(b._toolBar.destroy(),b._toolBar=null),b._details=null,b._mapCols=null,b._originalCols=null,a.prototype.destroy.call(this)},s.prototype._moveToPage=function(a){var b=this;b.state.value.currentPage(a)},s.prototype._onselectPage=function(a){var b=this;switch(a){case"next":b._moveToPage(Math.min(b._pager.props.totalPages,b._pager.props.currentPage+1));break;case"prev":b._moveToPage(Math.max(0,b._pager.props.currentPage-1));break;case"first":b._moveToPage(1);break;case"last":b._moveToPage(b._pager.props.totalPages);break;default:b._moveToPage(a)}},s.prototype._onSelectToolElement=function(a){var c=this,d=a.name||a.id;if("filter"===a.name&&b.glbGridFilter)return b.glbGridFilter(c.getColumnsForFilter(),c.state.value);if("filterexpress"===a.name)c.state.value.filter={value:a.value};else{if("settings"===a.name&&b.glbGridSettings)return b.glbGridSettings(c.getColumnsForSettings(),function(a){c.setColumns(a)});"multiselect"===a.name?c.toggleMultiselect():c.form.execAction(c.$bind+".$toolbar."+d,{toolElement:a,control:c})}},s.prototype.setColumns=function(a){var b=this;b.renderOptions.columns=a.map(function(a){var c=b._colByField(a.$bind);return c||(c=b._originalCols[a.$bind]),c&&(c.options._expandItem&&(a.$bind=g.EXPANDED_FIELD_NAME),a.options=c.options),a}),b._refreshGrid()},s.prototype._state=function(){a.prototype._state.call(this);var b=this,d=b.fieldOptions;if(b.state.value.isQueryable()){
// create pager
var e=$.extend({size:"default",selectPage:b._onselectPage.bind(b)},d.pager||{});b._pager=new c.Pager(e);var f=b._pager;f.props.totalPages=b.state.value.totalPages(),f.props.currentPage=b.state.value.currentPage()}var g=[];if(d.toolbar&&d.toolbar.items){var h=$.extend(!0,{},d.toolbar);h.items.forEach(function(a){if("count"===a.type)a=$.extend({name:"count",right:!0,value:b.state.value.totalCount()},a);else if("filter"===a.type)a=$.extend({name:"filter",value:b.state.value.filter||"",icon:"filter"},a);else if("multiselect"===a.type){var c=!!(d.selecting&&d.selecting.row&&d.selecting.multiselect);a=$.extend(a,{name:"multiselect",type:"default",icon:"check",value:c})}else"filterexpress"===a.type&&(a=$.extend(a,{name:"filterexpress",fields:b.getColumnsForFilterExpress(a.fields)}));g.push(a)})}if(g.length){var i={selectToolElement:b._onSelectToolElement.bind(b)};b._toolBar=new c.ToolBar(g,i)}},s.prototype._destroyDetails=function(){
//Destroy all inline "forms" 
var a=this;if(a._details){var b=c.formManager();a._details.forEach(function(a){var c=b.formByName(a);c&&c.destroy()}),a._details=[]}},s.prototype._destroyDetailById=function(a){var b=this,d=b._details.indexOf(a);d>=0&&b._details.splice(d,1);var e=c.formManager().formByName(a);e&&e.destroy()},s.prototype._initCols=function(a){var b=this;b._mapCols={},a.columns&&a.columns.length||(a.columns=[{$bind:"$index"}]),b.columns=[],b.frozenColumns=[];var c=a.columns.findIndex(function(a){return n.isSelectField(a.$bind)}),d=a.selecting&&a.selecting.row&&a.selecting.multiselect;d?c<0&&a.columns.splice(0,0,{$bind:"$select",options:{width:50,frozen:!0,editable:!0}}):c>=0&&a.columns.splice(c,1);var e=!!a.expandingProperty,g=a.scrolling&&a.scrolling.vertical||a.editing;a.columns.forEach(function(c,d){var i=$.extend({},c);return i.options=i.options||{},e&&n.isExpandField(c.$bind)&&(i.schema=n.getSchema(c.$bind,b.$schemaItems,b.form.$rootSchema,!1),i.$bind=a.expandingProperty+c.$bind,i.options.icons={1:"plus",2:"minus"},i.options.align=i.options.align||"left",i.options.alignIcon=i.options.alignIcon||"left",i.options._clickable=!0,i.options._expandItem=!0),i.schema||(i.schema=n.getSchema(c.$bind,b.$schemaItems,b.form.$rootSchema,!1)),i.schema||i.schema?(i.title=f.tt(i.options.title||i.schema.title,b.form.$locale),i.options.display&&(i.options.displaySchema=n.getSchema(i.options.display,b.$schemaItems,b.form.$rootSchema,!1),!i.title&&i.options.displaySchema&&(i.title=f.tt(i.options.displaySchema.title,b.form.$locale))),n.isLink(c.$bind)&&(i.isLink=!0),g&&!i.options.width&&(i.options.width=h.widthFromSchema(i.schema)),i.options.frozen&&a.allowFrozenColumns?(i.options.width?r(i.options.width)||(i.options.width=50):i.options.width=h.widthFromSchema(i.schema),b.frozenColumns.push(i),void(b._mapCols[i.$bind]={column:i,index:b.frozenColumns.length-1,tindex:d})):(b.columns.push(i),void(b._mapCols[i.$bind]={column:i,index:b.columns.length-1,tindex:d}))):void console.log("Field (bind) not found : "+c.$bind)})},s.prototype._colByField=function(a){var b=this._mapCols[a];return b?b.column:null},s.prototype.changed=function(a,b,c,d,e){var f=this;if(f.$element){if(f._ignoreNotifications)return!1;var g=!1,i=!1;switch(d){case"count":if(a===e.propName){var j=f._toolBar;j&&j.setValue&&j.setValue("count",f.state.value.totalCount())}break;case"filter":if(a===e.propName){var j=f._toolBar;j&&j.setValue&&f.state.value.filter.title&&j.setValue("filter",f.state.value.filter.title)}break;case"pagination":if(a===e.propName){var k=f._pager;k&&(k.props.totalPages=f.state.value.totalPages(),k.props.currentPage=f.state.value.currentPage())}break;case"sorting":a===e.propName&&f._updateSorting();break;case"set":case"propchange":a===e.propName&&(f._renderRows(!0,"",null),i=!0);break;case"add":f._createRow(e.$value),i=!0,g=!0;break;case"remove":f._removeRow(e.$id),g=!0;break;case"upd":if(a===e.propName){
//console.log('Grid update propName = ' + propName + ', params.property = ' + params.property + ', params.$oid = ' + params.$oid);
var l=e&&e.$oid?f._findById(e.$oid):null;if(l){var m=f.renderOptions,o=e.property;m.expandingProperty&&(o=n.removeExpand(o,m.expandingProperty)),f._modifyCell(l,o),n.isSelectField(o)&&h.setRowsSelected(l.$id,l.$select,f.fieldOptions,f.$element.get(0))}}}g&&f._updOddEven(),i&&f.resize()}},s.prototype._modifyTD=function(a,b,d){var f=this,g=f._colByField(b);if(g){var h=a.getState(b),i=g.options||{},j=i.editable&&!h.isDisabled&&!h.isReadOnly&&!h.isHidden;if(e.empty(d),!h.isHidden){var k=null,l=f._viewMap[a.$id],m=l?l.level||0:0;i.display&&i.displaySchema&&(k=c.Utils.displayValue(a.getValue(i.display),i.displaySchema,f.form.$locale,{tableOptions:f.config.options}).value);var n=c.Utils.displayValue(a.getValue(b),g.schema,f.form.$locale,{html:!0,useSymbol:!1,editable:j,selectable:i.selectable,check:i.check,avanced:i,tableOptions:f.config.options,display:k,level:m});if(n.html){var o=$(n.value);e.append(d,o.get(0))}else e.append(d,document.createTextNode(n.value))}}},s.prototype._findTR=function(a,b){var c=this,d=c.renderOptions,f=a+(b.options.frozen&&d.allowFrozenColumns?"_frozen":"");return e.find(c.$element.get(0),f)},s.prototype._id2rowId=function(a){var b=a.indexOf("_frozen");return b>0&&(a=a.substring(0,b)),a},s.prototype._findtBody=function(a){var b=this,c=b.renderOptions,d=b.id+(a.options.frozen&&c.allowFrozenColumns?"_frozen_rows":"_rows");return e.find(b.$element.get(0),d)},s.prototype._modifyCell=function(a,b,c){var d=this;if(d.$element){var f=d._colByField(b);if(f){if(c)return d.inplace&&d.inplace.input&&d.inplace.td===c?void d._inplaceEditModel2Control(a,b,c):d._modifyTD(a,b,c);var g=d._findTR(a.$id,f);if(g)
//TODO: optimize
for(var h=0,i=g.childNodes.length;h<i;h++){var j=g.childNodes[h],k=e.attr(j,"colid");if(k===b){if(d.inplace&&d.inplace.input&&d.inplace.td===j)return void d._inplaceEditModel2Control(a,b,j);d._modifyTD(a,b,j)}}}}},s.prototype._rootElement=function(){return this.$element.get(0)},s.prototype._gridParentFocus=function(){var a=this;return e.find(a.$element.get(0),a.id+"_focus")},s.prototype._setErrors=function(a,b){var c=this,d=c.state.errors;c.showErrors(b,d)},s.prototype._setTableFocus=function(a){var b=this,c=e.find(b.$element.get(0),b.id+"_table");c&&(a?e.addClass(c,"focused"):e.removeClass(c,"focused")),c=e.find(b.$element.get(0),b.id+"_table_frozen"),c&&(a?e.addClass(c,"focused"):e.removeClass(c,"focused"))},s.prototype.focusIn=function(a){var b=this;if(b.$element)if(b._setTableFocus(!0),b.selectedCell){var c=b._cell(b.selectedCell,!0),d=b.canEdit(b.selectedCell);d&&!b.inplace&&b._inpaceEditShow(c.td,!0)}else b._inplaceEditRemove(!1,!1)},s.prototype.focusOut=function(a){var b=this;b.$element&&(b._setTableFocus(!1),b._inplaceEditRemove(!0,!1))},s.prototype._doTab=function(a){var b=this;return a?b._moveDownSelectedCell(1):b._moveUpSelectedCell(1)},s.prototype.keypress=function(a){var b=this;if(b.selectedCell&&b.inplace&&e.isChildOf(b.inplace.td,a.target)){var d=b._td2value(b.inplace.td);if(n.isNumber(b.inplace.schema)){if(c.Utils.keyPressNumber(a)===!1)return!1}else if(n.isBoolean(b.inplace.schema)){if(" "===String.fromCharCode(a.which)&&b.fieldOptions.editing){var f=d.item.getRelativeState(d.col.$bind);if(!f.isDisabled&&!f.isReadOnly){var g=d.item.getValue(d.col.$bind);d.item.setValue(d.col.$bind,!g)}}a.preventDefault()}}},s.prototype.keydown=function(a){var b=this,c=a.which||a.keyCode,d=!1;if(!q(a,c)&&(!b.inplace||!e.isChildOf(b.inplace.td,a.target)||b._inplaceEditAcceptKeys(c))){if(b.fieldOptions.selecting&&b.fieldOptions.selecting.cell)switch(c){case e.keys.VK_TAB:d=b._doTab(!a.shiftKey);break;case e.keys.VK_UP:d=b._moveUpSelectedCell(1);break;case e.keys.VK_DOWN:d=b._moveDownSelectedCell(1)}d&&a.preventDefault()&&a.stopPropagation()}},s.prototype._tr2rowId=function(a,b){var c=a.id;if(b&&b.options.frozen){var d=c.indexOf("_frozen");d>0&&(c=c.substring(0,d))}return c},s.prototype._td2cell=function(a){var b=this,c=a.parentNode,d=(c.parentNode,b._colByField(e.attr(a,"colid")));if(!d)return null;var f=b._tr2rowId(c,d),g=b._findById(f);return g&&d?{row:f,col:e.attr(a,"colid")}:null},s.prototype._td2value=function(a){var b=this,c=a.parentNode,d=(c.parentNode,b._colByField(e.attr(a,"colid"))),f=b._tr2rowId(c,d),g=b._findById(f);return{item:g,col:d}},s.prototype.mousedown=function(a){var b=this,c=e.parentByTag(b.$element.get(0),a.target,"td");if(c){var d=b.renderOptions,f=b._td2cell(c);f&&(b._selectCell(f,a,!0)?a.preventDefault():d.selecting&&d.selecting.row&&!d.selecting.cell&&!d.selecting.multiselect&&b._selectRow(f.row))}return!0},s.prototype._addRows=function(a,b){var c=this;c._renderRows(!1,a.$id,b),c._updOddEven()},s.prototype._removeRows=function(a,b){var c=this;b.forEach(function(a){c._removeRow(a.value.$id)}),c._updOddEven()},s.prototype.click=function(a){var b=this,c=b.renderOptions,d=e.parentByTag(b.$element.get(0),a.target,"td");if(d){var f=b._td2cell(d);if(f){
//that._selectCell(cell, event, false);
var g=b._findById(f.row),h=b._colByField(f.col);if(g){var i=a&&a.target&&a.target.$link||a.target.parentNode.$link;if(i){var k=g.getRelativeState(h.$bind);if(k.isDisabled||k.isHidden)return;h.schema.$widgetAction?b[h.schema.$widgetAction]&&b[h.schema.$widgetAction](g):b.form.execAction(b.$bind+".$item."+i,g)}else if(h)if(h.options._expandItem){if(e.attr(a.target,"data-clickable")||e.attr(a.target.parentNode,"data-clickable")){var l=g.getRelativeState(h.$bind);if(!l.isDisabled&&!l.isReadOnly){var m=g.toggleExpand(c.expandingProperty);
//TODO : move in modifyCell
b._ignoreNotifications=!0;try{var o=[],p=b._viewMap[g.$id];if(g.enumVisibleChilds(c.expandingProperty,p.level,!0,function(a,b){var c={level:b,value:a};o.push(c)}),!o.length)return;m?b._addRows(g,o):b._removeRows(g,o)}finally{b._ignoreNotifications=!1}}}}else if(h.options.$link){var q=e.findByAttribute(a.target,d,"data-phoenix-href");if(q){var l=g.getRelativeState(h.$bind);l.isDisabled||j.execLink(h.options.$link,{$item:g},null)}}else if((n.isSelectField(h.$bind)||b.fieldOptions.editing&&h.options.editable&&n.isBoolean(h.schema))&&e.attr(a.target,"data-clickable")){var l=g.getRelativeState(h.$bind);if(!l.isDisabled&&!l.isReadOnly){var r=g.getValue(h.$bind);n.isSelectField(h.$bind)?g.select(!r,c.selecting&&c.selecting.row&&c.selecting.multiselect,b.state.value,c.expandingProperty):g.setValue(h.$bind,!r)}}}}}else{var s=e.parentByTag(b.$element.get(0),a.target,"th");if(s){var t=e.attr(s,"colid");if(c.sorting&&t){var u=b._colByField(t);if(u&&n.canSort(u.schema)){var v=u.$bind,w=b.state.value.$orderby();w===u.$bind&&(v=u.$bind+" desc"),b.state.value.$orderby(v)}}}}},s.prototype._setDisabled=function(a,b){var c=this;a.disabled=c.state.isDisabled},s.prototype._showSelected=function(a,b,c,d){var f=this;if(!a)return null;var g=f._cell(a,!1);g.td&&(b?(e.addClass(g.td,"bs-cell-selected"),f._inplaceEditRemove(!1,!1),c&&(f.focused||d)?f._inpaceEditShow(g.td,!1):(g.td.tabIndex=0,g.td.focus())):(e.removeClass(g.td,"bs-cell-selected"),g.td.tabIndex=-1))},s.prototype.canSelect=function(a){var b=this,c=b.selectedCell;if(c&&c.col===a.col&&c.row===a.row)return!1;if(!b.fieldOptions.selecting||!b.fieldOptions.selecting.cell)return!1;var d=b._colByField(a.col);return d&&d.options.selectable},s.prototype.canEdit=function(a){var b=this;if(!b.fieldOptions.editing||!b.fieldOptions.selecting||!b.fieldOptions.selecting.cell)return!1;var c=b._colByField(a.col);if(c.options._expandItem)return!1;var d=c&&c.options.editable;if(d){var e=b._findById(a.row),f=e.getState(c.$bind);return!f.isReadOnly&&!f.isDisabled}return d},s.prototype.clearSelected=function(){var a=this,b=a.selectedCell;a.selectedCell=null,b&&a._showSelected(b,!1,!0,!1),a._gridParentFocus().tabIndex=0},s.prototype._selectRow=function(a){var b=this,c=b.renderOptions,d=c.selecting&&c.selecting.row&&c.selecting.multiselect,e=b._findById(a);e&&e.select(!0,d,b.state.value,c.expandingProperty)},s.prototype._selectCell=function(a,b,c){var d=this;if(!d.canSelect(a))return!1;var e=d.selectedCell,f=d.canEdit(a);d._showSelected(a,!0,f,c),d.selectedCell=a,e?d._showSelected(e,!1,!0,c):d._gridParentFocus().tabIndex=-1;var g=d.renderOptions;return g.selecting&&g.selecting.row&&!g.selecting.multiselect&&d._selectRow(a.row),!0},s.prototype._selectFirstCell=function(){var a=this,b=a.fieldOptions;if(!b.selecting||!b.selecting.cell)return!1;var c=e.find(a.$element.get(0),a.id+"_rows");if(!c.childNodes.length)return!1;for(var d=null,f=a.frozenColumns.concat(a.columns),g=0,h=f.length;g<h;g++){var i=f[g];if(i.options.selectable){b.allowFrozenColumns&&i.options.frozen&&(c=e.find(a.$element.get(0),a.id+"_frozen_rows"));var j=c.firstChild,k=a._tr2rowId(j,i);d={col:i.$bind,row:k};break}}return!!d&&a._selectCell(d,null,!1)},s.prototype._cell=function(a,b){var c=this,d=c._mapCols[a.col],f=d.index,g=c._findTR(a.row,d.column),h=g.childNodes[f],i={td:h,tr:g,rIndex:-1,cIndex:-1};return b&&(i.rIndex=e.indexOf(g.parentNode,g),i.cIndex=f),i},s.prototype._moveUpSelectedCell=function(a){var b=this;if(!b.selectedCell)return b._selectFirstCell();var c=b._colByField(b.selectedCell.col),d=b._cell(b.selectedCell,!0),e=Math.max(d.rIndex-a,0);if(e!=d.rIndex){var f=b._findtBody(c),g=f.childNodes[e];return b._selectCell({row:b._id2rowId(g.id),col:b.selectedCell.col},null,!1)}return!1},s.prototype.resize=function(){var a=this;a._resize()},s.prototype._updateFrozenColumnsHeight=function(){var a=this,b=a.renderOptions;if(a.scrollableFrozenContent){if(!b.height||"auto"===b.height)return;var c=a.scrollableMaster.scrollWidth>a.scrollableMaster.clientWidth,d=void 0;d=c?parseInt(b.height+"",10)-e.scrollbar()+"px":parseInt(b.height+"",10)+"px",a.scrollableFrozenContent.style.height!==d&&(a.scrollableFrozenContent.style.height=d,a._vscroll())}},s.prototype._resize=function(){var a=this,b=a.renderOptions,c=b.scrolling&&b.scrolling.vertical;if(c){var d=h.hasFrozenColumns(b,a.frozenColumns);if(d){var f=e.scrollbar();f&&a._updateFrozenColumnsHeight(),a._vscroll()}}},s.prototype.syncHeaderAndFrozenScroll=function(a){var b=this;b._scroller&&"master"!==b._scroller||(b._scroller="master",b._hscroll(),b._vscroll(),b._removeScroller())},s.prototype.syncMasterScroll=function(a){var b=this;b._scroller&&"frozen"!==b._scroller||(b._scroller="frozen",b._vsmcroll(),b._removeScroller())},s.prototype._removeScroller=function(){var a=this;return a.fieldOptions.editing?(a._rsTimer&&window.clearTimeout(a._rsTimer),void(a._rsTimer=window.setTimeout(function(){a._scroller=null,a._rsTimer=null},50))):void(a._scroller=null)},s.prototype._vscroll=function(){var a=this;if(a.scrollableFrozenContent){var b=a.scrollableMaster.scrollTop,c=a.scrollableFrozenContent.scrollTop;b!==c&&(a.scrollableFrozenContent.scrollTop=b)}},s.prototype._vsmcroll=function(){var a=this,b=a.scrollableMaster.scrollTop,c=a.scrollableFrozenContent.scrollTop;b!==c&&(a.scrollableMaster.scrollTop=c)},s.prototype._hscroll=function(){var a=this,b=a.scrollableMaster.scrollLeft,c=a.scrollableHeaderOfMaster.scrollLeft;b!==c&&(a.scrollableHeaderOfMaster.scrollLeft=b)},s.prototype._moveDownSelectedCell=function(a){var b=this;if(!b.selectedCell)return b._selectFirstCell();var c=b._cell(b.selectedCell,!0),d=b._colByField(b.selectedCell.col),e=b._findtBody(d),f=Math.min(c.rIndex+a,e.childNodes.length-1);if(f!=c.rIndex){var g=e.childNodes[f];return b._selectCell({row:b._id2rowId(g.id),col:b.selectedCell.col},null,!1)}return!1},s.prototype._moveLeftSelectedCell=function(){var a=this;if(!a.selectedCell)return a._selectFirstCell()},s.prototype._moveRightSelectedCell=function(){var a=this;if(!a.selectedCell)return a._selectFirstCell()},s.prototype._state2UI=function(){var a=this,b=a._rootElement(),c=a.$element?a.$element.get(0):null;if(b){if(a._setDisabled(b,c),a.setHidden(c),a._setErrors(b,c),a._selectFirstCell(),a._toolBar){var d=$(e.find(c,a.id+"_header"));a._toolBar.render(d)}if(a._pager){var f=$(e.find(c,a.id+"_pagination"));a._pager.render(f)}}},s.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._rootElement(),f=c.$element?c.$element.get(0):null;a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),a&&"isDisabled"!==a||d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),a&&"errors"!==a||i.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(e,f))},s.prototype.stopProppagation=function(a){for(var b=this,c=a.target,d=b.$element.get(0);c;){if(c==d)return;c.href&&(a.preventDefault(),a.stopPropagation()),c=c.parentNode}},s.prototype._buildView=function(a,b,c,d,e){var f=this,g={level:c,value:a};d=d||f._view,e=e||f._viewMap,d.push(g),e[a.$id]=g},s.prototype._findById=function(a){var b=this;if(b._useView){var c=b._viewMap[a];return c?c.value:null}return b.state.value.findById(a)},s.prototype._findByIdEx=function(a){var b=this,c={index:-1,level:0,value:null};if(b._useView){var d=b._viewMap[a];d&&(c.index=b._view.indexOf(d.value),c.level=d.level,c.value=d.value)}else c.value=b.state.value.findById(a),c.value&&(c.index=b.state.value.indexOf(c.value));return c},s.prototype._renderRows=function(a,b,c){var d=this;if(d.$element){var f=d.renderOptions,g=null;a&&(d._view=[],d._viewMap={},d._useView=!0,g=d._buildView.bind(d));var i=void 0,j=void 0;if(d._inplaceEditRemove(!1,!1),d._destroyDetails(),h.hasFrozenColumns(d.renderOptions,d.frozenColumns)&&(i=e.find(d.$element.get(0),d.id+"_frozen_rows")))if(a)j=h.createRows(d.id,d.state.value,d.frozenColumns,f,d.options.design,d.form.$locale,!0,g),g=null,e.empty(i),e.append(i,j);else{j=h.createBulkRows(d.id,c,d.frozenColumns,f,d.options.design,d.form.$locale,!0,g);var k=e.find(i,b+"_frozen");e.after(k,j)}if(i=e.find(d.$element.get(0),d.id+"_rows"),a)j=h.createRows(d.id,d.state.value,d.columns,f,d.options.design,d.form.$locale,!1,g),e.empty(i),e.append(i,j);else{j=h.createBulkRows(d.id,c,d.columns,f,d.options.design,d.form.$locale,!1,g);var k=e.find(i,b);e.after(k,j)}}if(!a){var l=d._viewMap[b],m=d._view.indexOf(l);d._view.splice(m,0,c),c.forEach(function(a){d._viewMap[a.value.$id]=a})}},s.prototype.editDetail=function(a){
//not compatible with rozenColumns
var b=this,d=a.$id;if(b.$element){var f=b.renderOptions,g=h.hasFrozenColumns(f,b.frozenColumns);if(g)return;var i=e.find(b.$element.get(0),b.id+"_rows"),j=e.find(i,d+"_detail");if(j)return;var l=e.find(i,d);if(l){j=h.createDetail(d,l);
// prepare layout
var m=b.renderOptions.rows;if(!m||!m.detail||!m.detail.layout)throw new Error('Grid options missing: "options.rows.detail.layout".');var n=m.detail.layout;"string"==typeof n&&b.renderOptions.layouts&&b.renderOptions.layouts[n]&&(n=b.renderOptions.layouts[n]),"object"==typeof n&&(n=$.extend(!0,{},n),n.name&&(n._name=n.name),n.name=d);
// prepare schema
var o=a.getSchema();"object"==typeof o&&(o.links=o.links||{},o.links.$updateChanges=o.links.$updateChanges||{title:k.ui.ApplyDetailChanges});var p={};m.detail.spacing&&(p.verticalSpacing=!0),p.closeButtonHandler=function(){b.closeDetail(d)},n._name&&(p.externalLayout=n._name,p.externalSchema=b.form.options.externalSchema,p.externalLocale=b.form.options.externalLocale),p.path=b.$bind,b._details.push(d),c.OpenForm($(j.firstChild),n,b.form.$schema,a.model(),b.form.$locale,function(c,e,f){switch(c.property){case"$links.$updateChanges":if(!b.state.value.updateItem(a,e))return;a.update(e.model()),b.closeDetail(d)}},p),e.after(l,j)}}},s.prototype.closeDetail=function(a){
//not compatible with rozenColumns
var b=this;if(b._destroyDetailById(a),b.$element){var c=e.find(b.$element.get(0),a+"_detail");c&&e.remove(c)}},s.prototype._removeRow=function(a){var b=this;if(b._destroyDetailById(a),b._viewMap){var c=b._viewMap[a];if(c){delete b._viewMap[a];var d=b._view.indexOf(c);d>=0&&b._view.splice(d,1)}}if(b.$element){var f=[],g=e.find(b.$element.get(0),a);g&&f.push({element:g,columns:b.columns}),h.hasFrozenColumns(b.renderOptions,b.frozenColumns)&&(g=e.find(b.$element.get(0),a+"_frozen"),g&&f.push({element:g,columns:b.frozenColumns})),f.forEach(function(c){var d=c.element.parentNode,f=e.find(d,a+"_detail");if(f&&e.remove(f),d.firstChild===c.element&&b.renderOptions.headerIsHidden&&!b.renderOptions._useColGrp&&d.childNodes.length>1){
//no header &&  not useColGrp ==> update cols width on first row
var g=d.childNodes[1];c.columns.forEach(function(a,b){var c=g.childNodes[b];a.options.width&&(c.style.width=h.ensureWidth(a.options.width)),a.options.minWidth&&(c.style.minWidth=h.ensureWidth(a.options.minWidth))})}e.remove(c.element)})}},s.prototype._updOddEven=function(){var a=this;if(!a.renderOptions._useStripedCss&&a.$element){var b=e.find(a.$element.get(0),a.id+"_rows");h.updateEvenOdd(b),b=e.find(a.$element.get(0),a.id+"_frozen_rows"),b&&h.updateEvenOdd(b)}},s.prototype._createRow=function(a){var b=this;if(b.$element){var c=0,d=b._viewMap[a.$id];d?d=b._viewMap[a.$id]:(
//TODO find level when expandingProperty is not null
d={level:0,value:a},b._view.push(d),b._view.push(a.$id),c=b._view.length-1);var f=void 0,g=void 0,i=h.hasFrozenColumns(b.renderOptions,b.frozenColumns);i&&(f=e.find(b.$element.get(0),b.id+"_frozen_rows"),g=h.createRow(b.id,c,d.level,d.value,b.frozenColumns,b.renderOptions,b.options.design,b.form.$locale,f.childNodes.length%2===1,!0),e.append(f,g)),f=e.find(b.$element.get(0),b.id+"_rows"),g=h.createRow(b.id,c,d.level,d.value,b.columns,b.renderOptions,b.options.design,b.form.$locale,f.childNodes.length%2===1,!1),e.append(f,g)}},s.prototype.filtrableColumns=function(){var a=this,b=a.$schema,c=a.$schemaItems;return b&&"array"===b.type&&c&&"object"===c.type?n.filtrableFields(c,a.form.$rootSchema,a.form.$locale):[]},s.prototype._getColumnsFromSchema=function(){var a=this,b=a.$schema,c=a.$schemaItems;return b&&"array"===b.type&&c&&"object"===c.type?n.columns(c,a.form.$rootSchema,a.form.$locale):[]},s.prototype._getSelectedColumns=function(){var a=this,b={};return Object.keys(a._mapCols).forEach(function(c){var d=a._mapCols[c].column;d.options._expandItem&&d.options.display&&(c=d.options.display),b[c]=!0}),b},s.prototype._getGroupsFromSchema=function(){var a=this,b=a.$schema,c=a.$schemaItems;return b&&"array"===b.type&&c&&"object"===c.type&&c.groups?c.groups:{}},s.prototype.getColumnsForSettings=function(){var a=this;return{schemaGroups:a._getGroupsFromSchema(),schemaColumns:a._getColumnsFromSchema(),selectedColumns:a._getSelectedColumns(),locale:a.form.$locale}},s.prototype.getColumnsForFilter=function(){var a=this;return{schemaGroups:a._getGroupsFromSchema(),schemaColumns:a.filtrableColumns(),locale:a.form.$locale}},s.prototype.getColumnsForFilterExpress=function(a){var b,c=this;if(a&&Array.isArray(a)){var d=c._getColumnsFromSchema();b=[],a.forEach(function(a){d.every(function(c){return a!==c.name||(b.push(c),!1)})})}else b=c._getColumnsFromSchema();var e=[];return b.forEach(function(a){var b=a.schema,c={code:a.name,lib:b.title||b.name,type:b.type};b["enum"]&&(c["enum"]=b["enum"]),b.enumNames&&(c.enumNames=b.enumNames),e.push(c)}),e},s.prototype._updateSorting=function(){var a=this,b=a.renderOptions;if(b&&b.sorting&&!b.headerIsHidden){var c=e.find(a.$element.get(0),a.id+"_cols");c&&h.updSorting(b,c,a._colByField,a.state.value.$orderby()),c=e.find(a.$element.get(0),a.id+"_frozen_cols"),c&&h.updSorting(b,c,a._colByField,a.state.value.$orderby())}},s.prototype._renderColumns=function(a){var b=this;if(b._inplaceEditRemove(!1,!1),a._useColGrp){
// create free columns
var c=a.scrolling&&a.scrolling.vertical,d=c&&!a.headerIsHidden?e.find(b.$element.get(0),b.id+"_colgrp_header"):null;
// create frozen columns
if(d&&(e.empty(d),e.append(d,h.createColGroup(b.columns,a,!1))),d=e.find(b.$element.get(0),b.id+"_colgrp"),e.empty(d),e.append(d,h.createColGroup(b.columns,a,!1)),h.hasFrozenColumns(a,b.frozenColumns)){var f=c&&!a.headerIsHidden?e.find(b.$element.get(0),b.id+"_colgrp_frozen_header"):null;f&&(e.empty(f),e.append(f,h.createColGroup(b.frozenColumns,a,!0))),f=e.find(b.$element.get(0),b.id+"_colgrp_frozen"),f&&(e.empty(f),e.append(f,h.createColGroup(b.frozenColumns,a,!0)))}}if(!a.headerIsHidden){var g=e.find(b.$element.get(0),b.id+"_cols");e.empty(g),e.append(g,h.createCols(b.id,b.columns,a,b.options.design,b.form.$locale,b.state.value.$orderby(),!1)),h.hasFrozenColumns(a,b.frozenColumns)&&(g=e.find(b.$element.get(0),b.id+"_frozen_cols"),g&&(e.empty(g),e.append(g,h.createCols(b.id,b.frozenColumns,a,b.options.design,b.form.$locale,b.state.value.$orderby(),!0))))}a.allowFrozenColumns&&h.updateFrozenWidth(b.$element.get(0),b.id,b.frozenColumns)},s.prototype.toggleMultiselect=function(){var a=this;if(a.$element){var b=a.renderOptions;b.selecting&&b.selecting.row&&(b.selecting.multiselect=!b.selecting.multiselect,a.state.value.updateSelecting(b.selecting.multiselect,b.expandingProperty),a._refreshGrid())}},s.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);return b.$element||(b.$schema.description&&(d.description=f.tt(b.$schema.description,b.form.$locale)),b.$element=$(h.gridContainer(b.id,d,b.options.design,b.$schema.title,b.form.$locale,b.columns,b.frozenColumns)),b._renderColumns(d),b._renderRows(!0,"",null),b._state2UI(),b.setEvents(d)),b.appendElement(a,d),b.$element},s}(b.AbsField);b.BasicGrid=s,c.registerControl(s,"array",!1,"",null),c.registerControl(s,"array",!1,"basicgrid",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,c,f){f=f||"",b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},b);var g=[];return d.Utils.fieldWrapper(g,b,c,function(){b.columns&&(g.push('<div class="no-x-padding col-sm-offset-'+b.labelCol+" col-sm-"+(12-b.labelCol)+'">'),g.push('<div class="checkbox">'));var a=!1;b.inline||b.columns||(a=!0,g.push('<div class="checkbox">')),g.push('<label id="{0}_check" class="'+(b.inline?"checkbox-inline":a?"control-label":"checkbox")+'">'),g.push('<input type="checkbox" id="{0}_input">'),b.inline||g.push("&nbsp;"),g.push(e.escapeHtml(f||"")),g.push("</label>"),b.inline||b.columns||g.push("</div>"),b.columns&&(g.push("</div>"),g.push("</div>"))}),e.format(g.join(""),a)}var d=b,e=a.utils,f=a.dom,g=a.ulocale,h=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._input=function(){var a=this,b=a.$element.get(0);return f.find(b,a.id+"_input")},b.prototype._check=function(){var a=this,b=a.$element.get(0);return f.find(b,a.id+"_check")},b.prototype.click=function(a){var b=this,c=b._input(),d=c.checked||!1;a.target==c&&b.state.value!=d&&(b.state.value=d,b.form.setValue(b.$bind,d))},b.prototype._setDisabled=function(a,b){var c=this,d=c._check();c.state.isDisabled||c.state.isReadOnly?f.addClass(d,"disabled"):f.removeClass(d,"disabled"),a.disabled=c.state.isDisabled},b.prototype._setReadOnly=function(a,b){this._setDisabled(a,b)},b.prototype._setMandatory=function(a,b){},b.prototype._state2UI=function(){var a=this,b=a._input(),c=a.$element?a.$element.get(0):null;b&&(b.checked=a.state.value||!1,a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c))},b.prototype.changed=function(a,b,c,d){var e=this,f=e._input();e.state.value!=c&&(e.state.value=c,f.checked=e.state.value||!1)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._input(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},b.prototype.render=function(a){var b=this,e=b._initOptions(d.Utils.defaultOptions);return b.$element||(b.$element=$(c(b.id,e,b.options.design,g.tt(b.$schema.title,b.form.$locale))),b._state2UI()),b.appendElement(a,e),b.$element},b}(b.AbsField);b.Check=h,d.registerControl(h,"boolean",!1,"",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../errors.data.ts" />
/// <reference path="./basicgrid.ts" />
/// <reference path="../modalform.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=(a.utils,a.dom),c=b,e=(a.ulocale,a.Observable.errorsUtils),f=b.GridUtil,g=a.Observable.SchemaUtils,h=function(a){function b(b,c,d){a.call(this,b,c,d);var e=this,f=e.fieldOptions;e._initAllColumns(),d.registerListenerFor(e.$bind+".$item",e),e._state();var g=f.columns.header.fields||[];f.columns.header.fields=e.form.afterSettings(e.$bind,"columngrid",{columns:g}).columns;var h=e.form.getFieldSettings(e.$bind);h&&(e._settings=e.form.afterSettings(e.$bind,"columngrid",h)),e._initRows()}
// Create columns
return __extends(b,a),b.prototype.destroy=function(){var a=this;a.form.unRegisterListenerFor(a.$bind+".$item",a)},b.prototype._initSchemaRows=function(a){var b=this;b.rows=[],a.forEach(function(a,c){b.rows[c]={name:a.name,canEdit:a.canEdit,check:a.check,schema:g.getSchema(a.name,b.$schemaItems,b.form.$rootSchema,!1)||{}}})},b.prototype._colByName=function(a){for(var b=this,c=0,d=b.rows.length;c<d;c++){var e=b.rows[c];if(e.name===a)return e}return null},b.prototype.setSettings=function(a){var b=this;b._rrender()},b.prototype._initRows=function(){var a=this;if(!a.rows){var b=a.fieldOptions;b.columns||(b.columns={}),b.columns.header||(b.columns.header={}),b.columns.row||(b.columns.row={});var c=b.columns.header.fields||[];a._settings&&a._settings.columns&&a._settings.columns.length&&(c=a._settings.columns),a._initSchemaRows(c)}},b.prototype._initCols=function(a){var b=this;a.columns||(a.columns={}),a.columns.header||(a.columns.header={}),a.columns.row||(a.columns.row={});var d=$.extend({},a.columns.header),e=a.columns.row;d.options=d.options||{},e.options=e.options||{};var f,h=e.$bind;e.$bind?f=g.getSchema(e.$bind,b.$schemaItems,b.form.$rootSchema,!1):(h="$index",f={type:"integer"});var i=[];return i.push(d),b.state.value&&b.state.value.forEach(function(a){var d=c.Utils.displayValue(a.getRelativeValue(h),f,b.form.$locale,{html:!1}).value,g=$.extend({},e);g.title=d||"",g.id=a.$id,i.push(g)}),i},b.prototype._modifyRow=function(a,b,e,f,g){var h=this,i=d.find(h.$element.get(0),h.id+"_rows"),j=i.childNodes[e],k=j.childNodes[f],l=c.Utils.displayValue(a,b,h.form.$locale,{html:!0,useSymbol:!1,editable:g.editable,check:g.check,tableOptions:h.config.options});if(d.empty(k),l.html){var m=$(l.value);d.append(k,m.get(0))}else d.append(k,document.createTextNode(l.value))},b.prototype.changed=function(a,b,c,d,e){var f=this;if("upd"===d){var g=e&&e.$id?f.state.value.findById(e.$id):null;g&&f.rows.forEach(function(a,b){a.name===e.property&&f._modifyRow(g.getValue(a.name),a.schema,b,f.state.value.indexOf(g)+1,{editable:a.canEdit,check:a.check})})}},b.prototype._grid=function(){return this.$element.get(0)},b.prototype._setErrors=function(a,b){var c=this,d=c.state.errors;c.showErrors(b,d)},b.prototype.click=function(a){var b=this,c=d.parentByTag(b.$element.get(0),a.target,"td");if(c){var e=d.attr(c,"colId");if(e){var f=b._colByName(e);if(f&&f.canEdit&&g.isBoolean(f.schema)&&d.attr(a.target,"data-clickable")){var h=d.attr(c,"rowId"),i=h?b.state.value.findById(h):null;if(i){var j=i.getValue(f.name);i.setValue(f.name,!j)}}}}},b.prototype._setDisabled=function(a,b){},b.prototype._state2UI=function(){var a=this,b=a._grid(),c=a.$element?a.$element.get(0):null;b&&(a._setDisabled(b,c),a.setHidden(c),a._setErrors(b,c))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),f=c._grid(),g=c.$element?c.$element.get(0):null;a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,f&&c.setHidden(g)),a&&"isDisabled"!==a||d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,f&&c._setDisabled(f,g)),a&&"errors"!==a||e.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(f,g))},b.prototype._renderRows=function(){var a=this;if(a.$element){var b=d.find(a.$element.get(0),a.id+"_rows");d.empty(b),d.append(b,f.createGridRows(a.id,a.rows,a.state.value,a.columns,a.renderOptions,a.options.design,a.form.$locale))}},b.prototype._draw=function(a){var b=this;if(b.columns=b._initCols(b.fieldOptions),a._useColGrp){var c=d.find(b.$element.get(0),b.id+"_colgrp");d.empty(c),d.append(c,f.createColGroup(b.columns,a,!1))}if(!a.headerIsHidden){var e=d.find(b.$element.get(0),b.id+"_cols");d.empty(e),d.append(e,f.createCols(b.id,b.columns,a,b.options.design,b.form.$locale,"",!1))}b._renderRows(),b._state2UI()},b.prototype._rrender=function(){var a=this;a.$element&&a._draw(a.renderOptions)},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);if(!b.$element)return b.columns=b._initCols(b.fieldOptions),b.$element=$(f.gridContainer(b.id,d,b.options.design,b.$schema.title,b.form.$locale,b.columns,null)),b._draw(d),b.appendElement(a,d),b.$element},b.prototype._createRow=function(a){var b=this;if(b.$element){var c=d.find(b.$element.get(0),b.id+"_rows"),e=f.createRow(b.id,a,0,b.state.value.get(a),b.columns,b.renderOptions,b.options.design,b.form.$locale,a%2===1,!1);c.childNodes.length>=a?d.append(c,e):d.before(c.childNodes[a],e)}},b.prototype._initAllColumns=function(){var a=this,b=a.fieldOptions;a._allColumns=[],a._allColumnsNames=[],b.columns||(b.columns={}),b.columns.header||(b.columns.header={});var c=b.columns.header.allFields;c.forEach(function(b){a._allColumns.push($.extend({},b)),a._allColumnsNames.push(b.name)})},b.prototype._selectedColumns=function(){var a=this,b=[],c=[];return a.rows.forEach(function(a){b.push(a.name)}),a._allColumns.forEach(function(d){var e=g.getSchema(d.name,a.$schemaItems,a.form.$rootSchema,!1);b.indexOf(d.name)>=0&&c.push({name:d.name,title:e.title})}),c},b.prototype._initDataSettings=function(){var a=this,b={$type:"block",$items:[{$type:"block",$items:[]},{$type:"block",$items:[{$bind:"columns",$widget:"basicgrid",options:{border:!0,align:"middle",editing:!0,small:!0,headerIsHidden:!0,columns:[{$bind:"selected",options:{minWidth:"4em",editable:!0,check:!0}},{$bind:"caption",options:{width:"100%"}}]}}]},{$type:"block",$items:[]}]},c={properties:{columns:{type:"array",items:{type:"object",properties:{selected:{type:"boolean"},name:{type:"string"},caption:{type:"string"}}}}}},d={columns:[]},e=[];return a.rows.forEach(function(a){e.push(a.name)}),a._allColumns.forEach(function(b){var c=g.getSchema(b.name,a.$schemaItems,a.form.$rootSchema,!1);d.columns.push({name:b.name,caption:c.title,selected:e.indexOf(b.name)>=0})}),{schema:c,data:d,layout:b}},b.prototype.sendMessage=function(a,b){var c=this;switch(a){case"column-list":c.openColumns(b);break;case"selected-cols":return c._selectedColumns()}},b.prototype.stopProppagation=function(a){a.preventDefault(),a.stopPropagation()},b.prototype.openColumns=function(a){var b=this,d=b._initDataSettings(),e={title:a.title||"Columns ...",buttons:[{type:"success",title:a.okTitle||"OK",name:"ok"}]};c.OpenModalForm(e,d.layout,d.schema,d.data,{},function(a,c,d,e){if("modal-action"===c.operation)switch(c.property){case"ok":var f=d.model(!0),g={columns:[]};f.columns.forEach(function(a){if(a.selected){var c=b._allColumnsNames.indexOf(a.name);c>=0&&g.columns.push($.extend({},b._allColumns[c]))}}),b._settings=g,b.form.setFieldSettings(b.$bind,b._settings),b.form.savePrefs(),b._settings=b.form.afterSettings(b.$bind,"columngrid",g),b.rows=null,b._initRows(),a.close(),b._rrender()}})},b}(b.AbsField);b.ColumnGrid=h,c.registerControl(h,"array",!1,"columngrid",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="../../page.control.ts" />
/// <reference path="../schema.data.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.Observable.SchemaUtils,e=a.utils,f=a.dom,c=(a.locale,a.ulocale,b),g=(a.device,a.bootstrap4,function(){function a(a,b,e){this.opened=!1;var f=this;f.page=c.Page(),f.opened=!1,f.currentList=null,f.$parent=a,f._checkOptions(e),f.options=e,f.$input=b,f.keys=d.pkFields(f.options.primaryKey)}return a.prototype.click=function(a){var b=this,c=f.parentByTag(b.$element.get(0),a.target,"li");if(c){var d=c.pk;if(d){var e=b._map(),g=b._selectByPk(d,e);g&&b._doSelect(g,!0)}}},a.prototype.inMenu=function(a){var b=this;return!(!a||!b.$element)&&f.isChildOf(b.$element.get(0),a)},a._itemHeight=function(){if(!this.itemHeight){var a=$('<ul class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><li tabindex="-1"><a tabindex="-1" href="#">A</a></li></ul>').get(0);document.body.appendChild(a);var b=a.firstChild;this.itemHeight=b.offsetHeight,this.deltaHeight=a.offsetHeight-this.itemHeight,document.body.removeChild(a)}return this.itemHeight},a.prototype._checkOptions=function(a){if(!a.primaryKey)throw new Error("Invalid options no primaryKey.");if(!a.search)throw new Error("Invalid options search field.");a.display=a.display||a.search,a.maxItems=a.maxItems||8},a.prototype._renderContent=function(){var a=this;a.$element||(a.$element=$('<ul class="dropdown-menu"></ul>'),a.$parent.get(0).appendChild(a.$element.get(0)))},a.prototype._renderElements=function(){var a=this;if(a.$element||a._renderContent(),a.currentList){var b=document.createDocumentFragment(),c=a.$element.get(0);a.currentList.forEach(function(c){var g=d.pk2Id(d.extractPkValue(c,a.keys),a.keys),h=$('<li tabindex="-1"><a tabindex="-1" href="#">'+e.escapeHtml(c[a.options.display])+"</a></li>").get(0);h.pk=g,f.append(b,h)}),f.empty(c),f.append(c,b)}},a.prototype._afterHide=function(a){var b=this;b.opened=!1,b.page&&b.page.setPopup(null),b.$input&&b.$input.get(0).focus()},a.prototype.hide=function(a){var b=this;if(b.opened&&b.$element){var c=b.$element.get(0);f.removeClass(c,"bs-block"),b.opened=!1,b.page&&b.page.setPopup(null)}},a.prototype._selectByListIndex=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e.listIndex===b)return e}return null},a.prototype._emptyHtmlList=function(){var a=this;a.$element&&f.empty(a.$element.get(0))},a.prototype._show=function(b){var c=this;if(c.$element){var d=c.$element.get(0);if(d.childNodes.length){var e=-1,g=c._map(),h=c._findSeleted(g);h&&(e=h.listIndex);var i=c.$parent.get(0).offsetWidth;if(d.style.minWidth=i+"px",d.style.maxHeight=c.options.maxItems*a._itemHeight()+a.deltaHeight+"px",d.style.overflowY="auto",f.addClass(d,"bs-block"),e!=b){if(h){var j=d.childNodes[h.index];f.removeClass(j,"active"),h.selected=!1}if(b>=0){h=c._selectByListIndex(g,b);var k=d.childNodes[h.index];f.addClass(k,"active"),h.selected=!0,c._isInView(k,d)||k.scrollIntoView(!0)}else d.scrollTop=0}c.page&&c.page.popup!=c&&c.page.setPopup(c),f.addClass(d,"bs-block"),c.opened=!0}else f.removeClass(d,"bs-block"),c._afterHide(!0)}},a.prototype.triggerBlurred=function(a){var b=this;b.hide(null)},a.prototype.show=function(a,b,c){var d=this;return a&&a.value&&a.value.length?void(d.currentList==a.value?d._show(b):(d.currentList=a.value,d._renderElements(),d._show(b))):(d.currentList=null,d.hide(null),void d._emptyHtmlList())},a.prototype._map=function(){for(var a=this,b=[],c=!1,d=a.$element.get(0),e=0,g=0,h=d.childNodes.length;g<h;g++){var i=d.childNodes[g];if(i.pk){var j=!c&&f.hasClass(i,"active");j&&(c=!0),b.push({id:i.pk,index:g,selected:j,listIndex:e}),e++}}return b},a.prototype._selectByPk=function(a,b){var c=this,d=null,e=c.$element.get(0);b=b||c._map();for(var g=0,h=b.length;g<h;g++){var i=b[g];if(i.id===a){if(d=i,i.selected)break;f.addClass(e.childNodes[i.index],"active"),i.selected=!0}else if(i.selected&&(f.removeClass(e.childNodes[i.index],"active"),i.selected=!1,d))break}return d},a.prototype._findSeleted=function(a){var b=this;a=a||b._map();for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e.selected)return e}return null},a.prototype._isInView=function(b,c){var d=this,e=b.offsetTop,f=b.offsetHeight,g=c.scrollTop,h=d.options.maxItems*a._itemHeight();return e>=g&&g+h>=e+f},a.prototype.move=function(b){var c=this;if(c.$element&&c.opened){var d=c._map(),e=c.$element.get(0),g=c._findSeleted(d),h=b>0,i=void 0;if(h){if(g){if(i=1e3===b?d.length-1:d.indexOf(g)+b,i>=d.length&&(i=d.length-1,d[i].selected))return}else i=0;if(i<d.length){g&&(f.removeClass(e.childNodes[g.index],"active"),g.selected=!1);var j=e.childNodes[d[i].index];f.addClass(j,"active"),d[i].selected=!0,i==d.length-1?e.scrollTop=j.offsetTop+a._itemHeight()+1:c._isInView(j,e)||j.scrollIntoView(!1),c._doSelect(d[i],!1)}}else{if(g){if(i=b===-1e3?0:d.indexOf(g)+b,i<0&&(i=0,d[i].selected))return}else i=d.length-1;if(i>=0){g&&(f.removeClass(e.childNodes[g.index],"active"),g.selected=!1);var j=e.childNodes[d[i].index];f.addClass(j,"active"),d[i].selected=!0,0==i?e.scrollTop=0:c._isInView(j,e)||j.scrollIntoView(!0),c._doSelect(d[i],!1)}}}},a.prototype.select=function(){var a=this;if(a.$element&&a.opened){var b=a._findSeleted();b&&a._doSelect(b,!0)}},a.prototype._doSelect=function(a,b){var c=this;b&&(c.options.onselect&&c.options.onselect(d.findByPk(d.id2Pk(a.id,c.keys),c.keys,c.currentList)),c.hide(null))},a.prototype.inPopup=function(a){var b=this;if(b.$element){var c=b.$element.get(0).parentNode;return f.isChildOf(c,a)}return!1},a.prototype.destroy=function(){var a=this;a.options=null,a.currentList=null,a.$input=null,a.$parent=null,a.$element=null},a.itemHeight=0,a.deltaHeight=0,a}());b.DropItems=g}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../errors.data.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.dom,f=a.locale,g=a.Observable.SchemaUtils,h=a.ulocale,c=b,i=a.Observable.errorsUtils,j=a.bootstrap4,k=function(a,b,d,f){f=f||"input";var g="textarea"===f;if(g&&(b.before||b.after)&&(delete b.before,delete b.after),b.before||b.after){a.push('<div class="input-group"');var h=[];"money"!=b.$format&&"date"!=b.$format||void 0===b.maxWidth&&(b.maxWidth="16em"),b.minWidth&&h.push("min-width: "+b.minWidth+";"),b.maxWidth&&h.push("max-width: "+b.maxWidth+";"),h.length&&a.push('  style="'+h.join("")+'"'),a.push(">")}b.before&&(a.push('<span class="bs-grp-btn input-group-addon">'),b.before.icon?a.push('<span class="'+e.iconClass(b.before.icon)+'"></span>'):a.push(b.before.value),a.push("</span>"));var i=["form-control"];if(b.size&&j&&i.push(" form-control-"+b.size),b.inputClass&&i.push(b.inputClass),a.push("<"+f+' autocomplete="off" type="'+(b.type||"text")+'" class="'+i.join(" ")),a.push('" id="{0}_input"'),g&&a.push(' rows="'+b.rows||'3"'),!b.before&&!b.after){var h=[];b.maxWidth&&h.push("max-width: "+b.maxWidth+";"),b.minWidth&&h.push("min-width: "+b.minWidth+";"),h.length&&a.push('  style="'+h.join("")+'"')}if(b.maxLength&&a.push('  maxLength="'+b.maxLength+'"'),b.placeHolder){var k=b.placeHolder===!0?d:b.placeHolder;a.push('  placeholder="'+k+'"')}a.push(">"),b.after&&(a.push('<span tabindex="-1" class="bs-grp-btn input-group-addon'),b.after.icon&&a.push(" bs-icon-input"),a.push('">'),b.after.icon?a.push('<span class="'+e.iconClass(b.after.icon)+'"></span>'):a.push(b.after.value),a.push("</span>")),(b.before||b.after)&&a.push("</div>"),g&&a.push("</"+f+">"),c.Utils.addErrorDiv(a)},l=function(a,b,e,f,g){f=f||"",b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},b);var h=[];return b.titleIsHidden&&(b.columns=!1),c.Utils.fieldWrapper(h,b,e,function(){if(!b.titleIsHidden){h.push('<label for="{0}_input" id="{0}_label"');var a=[];b.columns&&(j?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("bs-lib-col col-sm-"+b.labelCol)),b.inline&&a.push("checkbox-inline bs-cursor-d no-x-padding"),a.length&&h.push(' class="'+a.join(" ")+'"'),h.push(">"),h.push(d.escapeHtml(f||"")+(b.inline?"&nbsp;":"")),b.description&&c.Utils.addTooltip(h,b.description,b),h.push("</label>")}b.columns&&h.push('<div class="no-x-padding col-sm-'+(12-b.labelCol)+'" id="{0}_colparent">'),k(h,b,f,g),b.columns&&h.push("</div>"),b.titleIsHidden&&b.description&&c.Utils.addTooltip(h,b.description,b)}),d.format(h.join(""),a)},m=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._input=function(){var a=this,b=a.$element?a.$element.get(0):null;return b?e.find(b,a.id+"_input"):null},b.prototype._colParent=function(){var a=this,b=a.$element.get(0);return a.renderOptions.columns?e.find(b,a.id+"_colparent"):null},b.prototype._value2Text=function(){var a=this;a._input();return a._isDate()?c.Utils.useDatePicker()?h.parseISODate(a.state.value||"")||"":c.Utils.nativeDate()?a.state.value||"":h.shortDate(a.state.value||""):a.state.value||""},b.prototype._isPassword=function(){return g.isPassword(this.$schema)},b.prototype._isDate=function(){return g.isDate(this.$schema)},b.prototype._isMemo=function(){return g.isText(this.$schema)},b.prototype._isNumber=function(){return g.isNumber(this.$schema)},b.prototype._isMoney=function(){return g.isMoney(this.$schema)},b.prototype._setDisabled=function(a,b){a.disabled=this.state.isDisabled},b.prototype._setReadOnly=function(a,b){a.readOnly=this.state.isReadOnly},b.prototype._setErrors=function(a,b){var c=this,d=c.state.errors;d&&d.length?e.addClass(b,"has-error"):e.removeClass(b,"has-error"),c.showErrors(b,d)},b.prototype._setMandatory=function(a,b){var c=this,d=this.state.isMandatory;if(a.required=d,d?e.addClass(a,"bs-mandatory"):e.removeClass(a,"bs-mandatory"),c.renderOptions.placeHolder&&(a.placeholder=c.renderOptions.title+(d?" *":"")),!c.renderOptions.titleIsHidden){var f=e.find(b,c.id+"_label");f&&e.text(f,(c.renderOptions.title||"")+(d?" *":"")+(c.renderOptions.inline?String.fromCharCode(160):""))}},b.prototype._state2UI=function(){var a=this,b=a._input(),c=a.$element?a.$element.get(0):null;b&&(a._value2Input(b),a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c),a._setMandatory(b,c),a._setErrors(b,c))},b.prototype._value2Input=function(a){var b=this;b._isDate()?c.Utils.useDatePicker()?c.Utils.datePickerSetValue(b.$element,b.state.value):c.Utils.nativeDate()?a.value=h.isoDatePart(b.state.value||""):a.value=h.shortDate(b.state.value||""):b._isNumber()&&c.Utils.nativeNumber()?a.value=b.state.value||0:a.value=b._value2Text()},b.prototype.changed=function(a,b,c,d){var e=this;if((!e.useDisplay||a!==e.$bind)&&e.$element){var f=e._input();if(c=e.form.getValue(e.$display),e.state.value!=c)e.state.value=c,e._value2Input(f);else{var g=f.value,h=e._value2Text();g!=h&&e._value2Input(f)}}},b.prototype.stateChanged=function(a,b){var c=this;if(!c.useDisplay||a!==c.$display){var d=c.form.getState(c.$bind),e=c._input(),f=c.$element?c.$element.get(0):null;a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),a&&"isDisabled"!==a||d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),a&&"isReadOnly"!==a||d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),a&&"isMandatory"!==a||d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f)),a&&"errors"!==a||i.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(e,f))}},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(b.AbsField);b.BaseEdit=m;var n=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b.prototype.beforeAppend=function(){},b.prototype.mousedown=function(a){var b=this;if(b._doSelect=!1,b.$element&&!b.state.isDisabled){var c=window.document.activeElement;if(c!==a.target){var d=b._input();d===a.target&&(b._doSelect=!0)}return!0}},b.prototype.stopProppagation=function(a){var b=this;if(b._doSelect){var c=b._input();e.select(c)}},b.prototype.click=function(a){},b.prototype.internalRender=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);b.$element||(d.title=h.tt(b.$schema.title,b.form.$locale),d.placeHolder&&1!=d.placeHolder&&(d.title=h.tt(d.placeHolder,b.form.$locale)),d.maxLength=b.$schema.maxLength,b.$schema.description&&(d.description=h.tt(b.$schema.description,b.form.$locale)),b.$element=$(l(b.id,d,b.options.design,d.title,d.tagName)),b.beforeAppend(),b.setEvents(d),b._state2UI()),b.appendElement(a,d)},b.prototype.render=function(a){var b=this;b.internalRender(a)},b.prototype._text2value=function(a){var b=this;return c.Utils.text2value(a,b.$schema)},b.prototype._value2Text=function(){var b=this;return b._isNumber()?g.value2Text(b.state.value,b.$schema):a.prototype._value2Text.call(this)},b.prototype.customOptions=function(a){var b=this;b._isDate()?b.customOptionsDate(a):b._isNumber()?b._isMoney()?b.customOptionsNumber(a,f.number.symbol):b.customOptionsNumber(a,b.$schema.symbol):b._isPassword()?b.customOptionsPassword(a):b._isMemo()&&b.customOptionsMemo(a)},b.prototype.customOptionsMemo=function(a){a.tagName="textarea"},b.prototype.customOptionsPassword=function(a){a.type="password"},b.prototype.customOptionsDate=function(a){a.$format="date",c.Utils.nativeDate()?a.type="date":(a.after={icon:"calendar"},a.date=!0)},b.prototype.customOptionsNumber=function(a,b){var d=this;a.inputClass="bs-edit-number",b&&(a.after={value:b}),a.$format=d.$schema.format,c.Utils.nativeNumber()&&(a.type="number")},b.prototype._removeEventsDate=function(){var a=this;a._isDate()&&a._setEventsDate()},b.prototype._setEventsDate=function(){var a=this;c.Utils.useDatePicker()&&c.Utils.datePickerInitialize(a.$element,{showOnFocus:!0},function(b){a.focusOut(null)})},b.prototype.setEvents=function(a){var b=this;b._isDate()&&b._setEventsDate()},b.prototype.removeEvents=function(){var a=this;a._isDate()&&a._removeEventsDate()},b.prototype.checkValue=function(a,b){b(a)},b.prototype.keypress=function(a){var b=this;if(b._isNumber()){if(c.Utils.keyPressNumber(a)===!1)return!1}else if(b._isPassword()&&c.Utils.keyPressPassword(a)===!1)return!1},b.prototype.equals=function(a){var b=this,c=b.state.value===a;return!c&&void 0===b.state.value&&"string"===b.$schema.type&&""===a||c},b.prototype.focusOut=function(a){var b=this,c=b._input(),d=b._text2value(c.value);b.equals(d)?b._isNumber()&&b._value2Input(c):b.checkValue(d,function(a){b.state.value!==a?(""===a&&"string"===b.$schema.type&&(a=void 0),b.state.value=a,b.form.setValue(b.$display,b.state.value)):b._value2Input(c)})},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(m);b.Edit=n,c.registerControl(n,"string",!1,"",null),c.registerControl(n,"number",!1,"",null),c.registerControl(n,"integer",!1,"",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../errors.data.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.dom,f=(a.locale,a.Observable.SchemaUtils,a.ulocale),c=b,g=a.Observable.errorsUtils,h=a.bootstrap4,i=function(a,b,e,f){f=f||"",b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},b);var g=[];return b.titleIsHidden&&(b.columns=!1),b.placeHolder=!1,c.Utils.fieldWrapper(g,b,e,function(){if(!b.titleIsHidden){g.push('<label for="{0}_input" id="{0}_label"');var a=[];b.columns&&(h?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("bs-lib-col col-sm-"+b.labelCol)),b.inline&&a.push("no-x-padding checkbox-inline bs-cursor-d"),a.length&&g.push(' class="'+a.join(" ")+'"'),g.push(">"),g.push(d.escapeHtml(f||"")+(b.inline?"&nbsp;":"")),b.description&&c.Utils.addTooltip(g,b.description,b),g.push("</label>")}b.columns&&g.push('<div class="no-x-padding col-sm-'+(12-b.labelCol)+'">'),g.push('<div class="bs-enum-list-wrap" id="{0}_input">'),g.push("</div>"),c.Utils.addErrorDiv(g),b.columns&&g.push("</div>")}),d.format(g.join(""),a)},j=function(a,b,c,d){d=d||c;var f=document.createDocumentFragment(),g=$('<div tabindex="0" class="bs-enum-list-row"><div class="bs-enum-list-check"><a><center><span class="'+e.iconClass("square-o")+'"></span></center></a></div><div class="bs-enum-list-title"></div></div>').get(0);return c.forEach(function(c,h){var i=g.cloneNode(!0);b?(e.attr(i,"tabindex","-1"),e.removeClass(i,"bs-pointer"),e.addClass(i,"bs-cursor-disabled")):(e.attr(i,"tabindex","0"),e.addClass(i,"bs-pointer"),e.removeClass(i,"bs-cursor-disabled"));var j=i.firstChild.firstChild.firstChild.firstChild;j.className=a&&a.indexOf(c)>=0?e.iconClass("check-square-o"):e.iconClass("square-o");var k=i.lastChild;e.append(k,document.createTextNode(d[h])),e.append(f,i)}),f},k=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._setDisabled=function(a,b){for(var c=this,d=0,f=a.childNodes.length;d<f;d++){var g=a.childNodes[d];c.state.isDisabled?(e.attr(g,"tabindex","-1"),e.removeClass(g,"bs-pointer"),e.addClass(g,"bs-cursor-disabled")):(e.attr(g,"tabindex","0"),e.addClass(g,"bs-pointer"),e.removeClass(g,"bs-cursor-disabled"))}},b.prototype._setReadOnly=function(a,b){},b.prototype._setErrors=function(a,b){var c=this,d=c.state.errors;c.showErrors(b,d)},b.prototype._setMandatory=function(a,b){},b.prototype._input=function(){var a=this,b=a.$element.get(0);return e.find(b,a.id+"_input")},b.prototype._state2UI=function(a){var b=this,c=b._input(),d=b.$element?b.$element.get(0):null;c&&(a||b._setDisabled(c,d),a||b._setFilter(),b._setReadOnly(c,d),b.setHidden(d),b._setMandatory(c,d),b._setErrors(c,d))},b.prototype.mousedown=function(a){var b=this;if(b.$element&&!b.state.isDisabled&&!b.state.isReadOnly){var c=window.document.activeElement,d=e.parentByClass(b.$element.get(0),a.target,"bs-enum-list-row");if(d)return c!==d&&d.focus(),!0}},b.prototype._getEnumsNames=function(){var a=this;if(!a.$schemaItems.enumNames)return null;if(a.state.filter){var b=a.$schemaItems.filters[a.state.filter],c=[];return b.forEach(function(b){c.push(a.$schemaItems.enumNames[a.$schemaItems["enum"].indexOf(b)])}),c}return a.$schemaItems.enumNames},b.prototype._getEnums=function(){var a=this;return a.state.filter?a.$schemaItems.filters[a.state.filter]:a.$schemaItems["enum"]},b.prototype._toggleEnumByIndex=function(a){var b=this,c=b._getEnums();if(a>=0&&a<c.length){var d=c[a],e=b.state.value.indexOf(d);e>=0?b.state.value.remove(d):b.state.value.push(d)}},b.prototype.keypress=function(a){var b=this;if(32==a.which){var c=e.parentByClass(b.$element.get(0),a.target,"bs-enum-list-row");if(!c)return;b._toggleEnumByIndex(e.indexOf(c.parentNode,c))}},b.prototype.click=function(a){var b=this;if(b.$element&&!b.state.isDisabled&&!b.state.isReadOnly){var c=e.parentByClass(b.$element.get(0),a.target,"bs-enum-list-row");c&&b._toggleEnumByIndex(e.indexOf(c.parentNode,c))}},b.prototype.changed=function(a,b,c,d,f){var g=this;if(g.$element){var h=g._input(),i=-1,k=g._getEnums(),l=g._getEnumsNames();switch(d){case"add":i=k.indexOf(f.$id),i>=0&&g._setItemValue(h.childNodes[i],!0);break;case"remove":i=k.indexOf(f.$id),i>=0&&g._setItemValue(h.childNodes[i],!1);break;case"propchange":e.empty(h);var m=j(g.state.value,g.state.isDisabled,k,l);e.empty(h),e.append(h,m)}}},b.prototype._setFilter=function(){var a=this,b=(a.state.filter,a._getEnums()),c=[];a.state.value.forEach(function(a){b.indexOf(a)>=0&&c.push(a)}),a.form.setValue(a.$bind,c)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null,f=e?c._input():null;a&&"isHidden"!==a||d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(e)),a&&"isDisabled"!==a||d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(f,e)),a&&"isReadOnly"!==a||d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly),a&&"filter"!==a||d.filter!=c.state.filter&&(c.state.filter=d.filter,e&&c._setFilter()),a&&"isMandatory"!==a||d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory),a&&"errors"!==a||g.errorChanged(c.state.errors,d.errors)&&(c.state.errors=d.errors,c._setErrors(null,e))},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);if(!b.$element){b.$schema.description&&(d.description=f.tt(b.$schema.description,b.form.$locale)),b.$element=$(i(b.id,d,b.options.design,f.tt(b.$schema.title,b.form.$locale)));var g=j(b.state.value,b.state.isDisabled,b._getEnums(),b._getEnumsNames()),h=b._input();e.append(h,g),b._state2UI(!0)}return b.appendElement(a,d),b.$element},b.prototype._setItemValue=function(a,b){var c=a.firstChild.firstChild.firstChild.firstChild;c.className=b?e.iconClass("check-square-o"):e.iconClass("square-o")},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(b.AbsField);b.EnumList=k,c.registerControl(k,"array",!1,"enums-list",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,a.dom),d=(a.ulocale,a.bootstrap4,function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._item=function(a){var b=this,d=b.$element.get(0);return c.find(d,b.id+"_item_"+a)},b.prototype.click=function(a){var b=this,c=a.target;if(!b.state.isReadOnly&&c&&c.id){var d=b.id+"_item_";if(0===c.id.indexOf(d)){var e=parseInt(c.id.substring(d.length),10),f=b.$schema["enum"][e];f!=b.state.value&&b.form.setValue(b.$bind,f)}}},b.prototype._setDisabled=function(a){if(a){var b=this;b._enumItems(function(a,c){a.disabled=b.state.isDisabled||b.state.isReadOnly})}},b.prototype._enumItems=function(a){var b=this;b.$schema["enum"].forEach(function(c,d){var e=b._item(d);a(e,c)})},b.prototype._setMandatory=function(a){},b.prototype._state2UI=function(a){var b=this,c=b.$element?b.$element.get(0):null;if(c){var d=b.$schema["enum"].indexOf(b.state.value);if(d>=0){var e=b._item(d);e&&a(e)}b._setDisabled(c),b.setHidden(c)}},b.prototype._getDefaultItem=function(){var a=this,b=a.$element?a.$element.get(0):null;if(b){var c=a.$schema["enum"].indexOf(a.state.value);return c>=0?a._item(c):void 0}},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,c.setHidden(e)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,c._setDisabled(e)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,c._setDisabled(e)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,c._setMandatory(e))},b}(b.AbsField));b.Group=d}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./group.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.dom,f=a.ulocale,g=a.bootstrap4,h=function(a,b,e,f,h,i){f=f||"",b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},b);var j=[];return c.Utils.fieldWrapper(j,b,e,function(){
//add label: 
if(!b.titleIsHidden){j.push('<label for="{0}_input" id="{0}_label"');var a=[];b.columns&&(g?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("bs-lib-col col-sm-"+b.labelCol)),b.inline&&a.push("checkbox-inline bs-cursor-d no-x-padding"),a.length&&j.push(' class="'+a.join(" ")+'"'),j.push(">"),j.push(d.escapeHtml(f||"")+(b.inline?"&nbsp;":"")),j.push("</label>")}b.columns&&j.push('<div class="no-x-padding col-sm-'+(12-b.labelCol)+'">');var c=["btn-group"];j.push('<div class="'+c.join(" ")+'">'),h.forEach(function(a,c){j.push('<button tabindex="-1" type="button" id="{0}_item_'+c+'" class="btn btn-default"'),b.width&&j.push(' style="width:'+b.width+'"'),j.push(">"),j.push(d.escapeHtml(i[c]||"")),j.push("</button>")}),j.push("</div>")}),b.columns&&j.push("</div>"),d.format(j.join(""),a)},i=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._state2UI=function(){a.prototype._state2UI.call(this,function(a){e.addClass(a,"btn-primary"),e.removeClass(a,"btn-default"),a.tabIndex=0})},b.prototype.changed=function(b,c,d,f){var g=this;if(g.state.value!=d){if(g.state.value=d,!g.$element)return;a.prototype._enumItems.call(this,function(a,b){g.state.value===b?(a.tabIndex=0,g.focused&&a.focus(),e.addClass(a,"btn-primary"),e.removeClass(a,"btn-default")):(e.addClass(a,"btn-default"),e.removeClass(a,"btn-primary"),a.tabIndex=-1)})}},b.prototype.keydown=function(a){var b=this,c=!1;if(!b.state.isReadOnly&&!(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)){var d=a.which||a.keyCode;switch(d){case e.keys.VK_LEFT:
//left
var f=b.$schema["enum"].indexOf(b.state.value);if(f>0){var g=b.$schema["enum"][f-1];b.form.setValue(b.$bind,g)}break;case e.keys.VK_RIGHT:
//right
var h=b.$schema["enum"].indexOf(b.state.value);if(h>=0&&h<b.$schema["enum"].length-1){var g=b.$schema["enum"][h+1];b.form.setValue(b.$bind,g)}}c&&a.preventDefault()&&a.stopPropagation()}},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);if(!b.$element){var e=b.$schema.enumNames||b.$schema["enum"];e=e.map(function(a){return f.tt(a,b.form.$locale)}),b.$element=$(h(b.id,d,b.options.design,f.tt(b.$schema.title,b.form.$locale),b.$schema["enum"],e)),b._state2UI()}return b.appendElement(a,d),b.$element},b}(b.Group);b.BtnGroup=i,c.registerControl(i,"*",!0,"grpbtn",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.dom,f=(a.locale,a.ulocale),c=b,g=(a.device,a.bootstrap4,function(a,b,e,f,g,h){var i=[];return f=f||"",g=g||"",c.Utils.fieldWrapper(i,b,e,function(){i.push('<img id="{0}_img" src="" class="img-responsive'),"icon"==h&&i.push(" bs-img-icon"),i.push('" alt="'),i.push(d.escapeHtml(f||"")),i.push('"')}),d.format(i.join(""),a)}),h=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._state2UI=function(){var a=this,b=a._img(),c=a.$element?a.$element.get(0):null;b&&(b.src=a.state.value||"",a.setHidden(c))},b.prototype._img=function(){var a=this,b=a.$element.get(0),c=e.find(b,a.id+"_img");return c},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);return b.$element||(d.title=f.tt(b.$schema.title,b.form.$locale),b.$element=$(g(b.id,d,b.options.design,d.title,b.state.value,b.config.$widget)),b._state2UI()),b.appendElement(a,d),b.$element},b}(b.AbsField);b.Picture=h}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./pictures.control.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a,c=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b}(a.Picture);a.Icon=c,b.registerControl(c,"string",!1,"icon",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../core/core.ts" />
/// <reference path="./pictures.control.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a,c=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b}(a.Picture);a.Image=c,b.registerControl(c,"string",!1,"image",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,c,f){f=f||"",b=$.extend({columns:!1},b);var g=b.columns;b.columns=!1,g&&(b.styles="no-x-padding");var i=[],j={formGroup:"form-group"};return g&&!h&&(j.formGroup+=" form-horizontal"),d.Utils.fieldWrapper(i,b,c,function(){i.push('<label id="{0}_label"');var a=[];g&&(h?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("col-sm-12 bs-lib-col")),b.inline&&a.push("checkbox-inline bs-cursor-d no-x-padding"),a.length&&i.push(' class="'+a.join(" ")+'"'),i.push(">"),i.push(e.escapeHtml(f||"")+(b.inline?"&nbsp;":"")),b.description&&d.Utils.addTooltip(i,b.description,b),i.push("</label>")},j),e.format(i.join(""),a)}var d=b,e=a.utils,f=a.dom,g=a.ulocale,h=a.bootstrap4,i=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype.getCustomBind=function(){var b=this;return b.config&&b.config.options&&b.config.options.$bind?b.config.options.$bind:a.prototype.getCustomBind.call(this)},b.prototype._setDisabled=function(a,b){},b.prototype._setReadOnly=function(a,b){},b.prototype._setMandatory=function(a,b){var c=this,d=this.state.isMandatory,e=c._label();e&&f.text(e,c.renderOptions.title+(d?" *":"")+(c.renderOptions.inline?String.fromCharCode(160):""))},b.prototype._label=function(){var a=this;return a.$element?f.find(a.$element.get(0),a.id+"_label"):null},b.prototype._state2UI=function(){var a=this,b=a._label(),c=a.$element?a.$element.get(0):null;b&&(a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c),a._setMandatory(b,c))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._label(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},b.prototype._title=function(){var a=this;return a.$schema&&a.$schema.title?a.$schema.title:a.config&&a.config.options&&a.config.options.title?a.config.options.title:""},b.prototype.render=function(a){var b=this,e=b._initOptions(d.Utils.defaultOptions);return b.$element||(e.title=g.tt(b._title(),b.form.$locale),b.$schema.description&&(e.description=g.tt(b.$schema.description,b.form.$locale)),b.$element=$(c(b.id,e,b.options.design,e.title)),b._state2UI()),b.appendElement(a,e),b.$element},b}(b.AbsField);b.Label=i,d.registerControl(i,"meta",!1,"label",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../form.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,c,g){g=g||"",b=$.extend({right:!1,icon:null,type:"default",size:null},b),void 0!==b.title&&(g=b.title);var h=[];return b.inline||(h.push('<div class="bs-field-group"'),e.Utils.addContainerId(h,c),h.push(">")),h.push('<button type="button"'),h.push(' class="bs-button btn btn-'+b.type),b.size&&h.push(" btn-"+b.size),b.inline?(h.push(" bs-btn-inline"),b.right&&h.push(" pull-right")):h.push(" btn-block"),h.push(" bs-island"),c&&h.push(" design"),h.push('"'),b.inline&&e.Utils.addContainerId(h,c),h.push(">"),b.icon&&(h.push('<span class="'+f.iconClass(b.icon)+'"></span>'),g&&h.push("&nbsp;")),h.push(g||""),h.push("</button>"),b.inline||h.push("</div>"),d.format(h.join(""),a)}var d=a.utils,e=b,f=a.dom,g=a.ulocale,h=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._button=function(){var a=this;return a.renderOptions.inline?a.$element.get(0):a.$element.get(0).firstChild},b.prototype.click=function(a){var b=this;b.form.execAction(b.$bind)},b.prototype._setDisabled=function(a,b){var c=this;a.disabled=c.state.isDisabled,c.state.isDisabled?f.addClass(a,"disabled"):f.removeClass(a,"disabled")},b.prototype._state2UI=function(){var a=this,b=a._button(),c=a.$element?a.$element.get(0):null;b&&(a._setDisabled(b,c),a.setHidden(c))},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._button(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f))},b.prototype.render=function(a){var b=this,d=b._initOptions(e.Utils.defaultOptions);return b.$element||(b.$element=$(c(b.id,d,b.options.design,g.tt(b.$schema?b.$schema.title:b.$bind,b.form.$locale))),b._state2UI()),b.appendElement(a,d),b.$element},b}(b.AbsField);b.Link=h}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="../../../data/datasets.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="./edit.control.ts" />
/// <reference path="./dropitems.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.Observable.SchemaUtils,e=a.data,f=a.utils,g=a.dom,c=(a.locale,a.ulocale,b),h=(a.device,a.bootstrap4,{27:"esc",9:"tab",13:"enter",33:"pgUp",34:"pgDown",35:"end",36:"home",38:"up",40:"down",115:"f4"}),i=function(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey},j={autoComplete:!1,maxItems:-1},k=function(a,b){if(""===a||null===a||void 0===a)return"";if(b&&b.data&&b.data.$value){for(var c=b.data.$value,d=0,e=c.length;d<e;d++){var f=c[d];if(f.code===a)return f.title}return a||""}return a||""},l=function(a,b,c){if(a.value&&(a=a.value),b){var d=[],f=e.compileFilterTree(b,null,c,null);return a.forEach(function(a){e.acceptFilter(f,a)&&d.push(a)}),d}return a},m=function(c){function e(b,d,e){c.call(this,b,d,e);var f=this;f.lookupOptions=j,f.eventBus=new a.utils.SingleEventBus(50),f.onselectItemHandler=f._onselectItem.bind(f),f.isEnum=f.$lookup&&f.$lookup.data&&"enum"===f.$lookup.data.$type}
//TEST
return __extends(e,c),e.prototype.customOptions=function(a){a.after={icon:"chevron-down"}},e.prototype._value2Text=function(){var a=this;return a.isEnum?k(a.state.value,a.$lookup):a.state.value||""},e.prototype._getSource=function(a){var b=this,c=b.form.getParentModel(b.$bind);
//options: {search: '', select: false,  find: false, findFirst: true}
//options: {search: '', select: false,  find: false, findFirst: true}
return b.$lookup.data&&b.$lookup.data.$type?"inline"==b.$lookup.data.$type||"enum"==b.$lookup.data.$type?f.dataAsPromise(l(b.$lookup.data.$value,b.$lookup.data&&b.$lookup.data.$params?b.$lookup.data.$params.$filter:null,c.model(!0))):d.allData(b.$lookup)?b.$lookup.cache&&b.hasCachedData?f.dataAsPromise(b.cachedData):d.executeLookup(b.$lookup,b.form.getParentModel(b.$bind)):f.dataAsPromise(null):f.dataAsPromise(null)},e.prototype._filterResult=function(a,b){var c=this;if(a&&Array.isArray(a)?a={value:a}:a&&a.documents&&(a.value=a.documents,delete a.documents),d.allData(c.$lookup)){if(c.$lookup.cache&&!c.hasCachedData&&(c.hasCachedData=!0,c.cachedData=a),b.findFirst&&!b.search)return null;if(b.search&&a&&a.value&&b.findFirst){var e=d.findFirst(b.search,c.isEnum?"title":d.remoteSearch(d.lastSegment(c.$bind,c.$display),c.$lookup),a.value);return e?{value:[e.item]}:null}}return a},e.prototype._findselected=function(a,b){var c=this;if(b.search&&b.select&&a&&a.value){var e=d.findFirst(b.search,c.isEnum?"title":d.remoteSearch(d.lastSegment(c.$bind,c.$display),c.$lookup),a.value);if(e)return e.index}return-1},e.prototype._findValue=function(a,b){var c=this;a||""!=a||this.eventBus.push(null,function(a){b(null)},!0);var d={search:a,select:!1,findFirst:!0,find:!1};this.eventBus.push(c._getSource(d),function(a){a=c._filterResult(a,d),b(a&&a.value&&a.value.length?a.value[0]:null)},!0)},e.prototype._onselectItem=function(a){var b=this;this.eventBus.push(a,function(a){var c=Object.keys(b.$lookup.mapping),e=d.extractBase(b.$bind);c.forEach(function(c){b.form.setValue(e+c,a?a[b.$lookup.mapping[c]]||"":"")});var f=b._input();f.value!=b._value2Text()&&b._value2Input(f)},!0)},e.prototype._checkPopupMenu=function(){var a=this;if(!a.menu){var c=a._input(),e=a.$element;a.renderOptions.columns&&(e=$(a._colParent())),a.menu=new b.DropItems(e,c,{primaryKey:a.$lookup.primaryKey,search:a.isEnum?"title":d.remoteSearch(d.lastSegment(a.$bind,a.$display),a.$lookup),onselect:a.onselectItemHandler})}},e.prototype.mousedown=function(a){var b=this;return b.menu&&b.menu.opened&&b.menu.inMenu(a.target)?(a.stopPropagation(),!1):c.prototype.mousedown.call(this,a)},e.prototype.stopProppagation=function(a){var b=this;c.prototype.stopProppagation.call(this,a),b.menu&&b.menu.opened&&b.menu.inMenu(a.target)&&(a.preventDefault(),a.stopPropagation())},e.prototype.click=function(a){var b=this,c=b._input();if(g.isChildOf(c.parentNode.lastChild,a.target))if(d.supportPagination(b.$lookup));else if(b._checkPopupMenu(),b.menu.opened)this.eventBus.push(null,function(c){b.menu.hide(a.target)},!0);else{var e={search:c.value,select:!0,find:!1,findFirst:!1};this.eventBus.push(b._getSource(e),function(a){a=b._filterResult(a,e);var c=-1;e.select&&(c=b._findselected(a,e)),b.menu.show(a,c,!1)},!0)}else b.menu&&b.menu.opened&&b.menu.inMenu(a.target)&&b.menu.click(a)},e.prototype.beforeAppend=function(){},e.prototype._managePreventDefault=function(a,b){var c;switch(a){case"up":case"pgDown":case"pgUp":case"home":case"end":c=!i(b);break;case"down":b.ctrlKey?(c=!0,a="f4"):c=!i(b);break;default:c=!1}return c&&b.preventDefault()&&b.stopPropagation(),a},e.prototype._shouldTrigger=function(a,b){var c;switch(a){case"tab":c=!i(b);break;default:c=!0}return c},e.prototype.setEvents=function(a){var b=this;$(b._input()).on("input",function(){b.inputChanged()})},e.prototype.removeEvents=function(){var a=this;$(a._input()).off("input")},e.prototype.inputChanged=function(){var a=this,b=a._input();a.modified=b.value!=a._value2Text(),a.trigger("inputChanged",null)},e.prototype.checkValue=function(a,b){var c=this,d=c._input(),e=d.value!=c._value2Text();e?c._findValue(d.value,function(a){c._onselectItem(a)}):b(c.state.value)},e.prototype.keydown=function(a){var b=this,c=h[a.which||a.keyCode];c=b._managePreventDefault(c,a),c&&b._shouldTrigger(c,a)&&b.trigger(c+"Keyed",a)},e.prototype.focusOut=function(a){var b=this;b.menu&&b.menu.opened&&this.eventBus.push(null,function(a){b.menu.hide(null)},!0),c.prototype.focusOut.call(this,a)},e.prototype.focusIn=function(a){this.trigger("focused")},e.prototype.trigger=function(a,b){var c=this,e=c._input();if(c.menu&&c.menu.opened)switch(a){case"escKeyed":c.eventBus.push(null,function(a){c.menu.hide(null)},!0);break;case"enterKeyed":c.eventBus.push(null,function(a){c.menu.select()},!0);break;case"upKeyed":c.eventBus.push(null,function(a){c.menu.move(-1)},!0);break;case"downKeyed":c.eventBus.push(null,function(a){c.menu.move(1)},!0);break;case"homeKeyed":c.eventBus.push(null,function(a){c.menu.move(-1e3)},!0);break;case"endKeyed":c.eventBus.push(null,function(a){c.menu.move(1e3)},!0);break;case"pgDownKeyed":c.eventBus.push(null,function(a){c.menu.move(7)},!0);break;case"pgUpKeyed":c.eventBus.push(null,function(a){c.menu.move(-7)},!0);break;case"inputChanged":var f={search:e.value,select:!0,find:!1,findFirst:!1};this.eventBus.push(c._getSource(f),function(a){if(c.menu&&c.menu.opened){f.search=e.value,a=c._filterResult(a,f);var b=-1;f.select&&(b=c._findselected(a,f)),c.menu.show(a,b,!0)}},!1)}else if("f4Keyed"==a)if(d.supportPagination(c.$lookup));else if(!c.menu||!c.menu.opened){c._checkPopupMenu();var f={search:e.value,select:!0,find:!1,findFirst:!1};c.eventBus.push(c._getSource(f),function(a){a=c._filterResult(a,f);var b=-1;f.select&&(b=c._findselected(a,f)),c.menu.show(a,b,!1)},!0)}},e.prototype.destroy=function(){var a=this;a.onselectItemHandler=null,a.cachedData=null,a.menu&&(a.menu.destroy(),a.menu=null),c.prototype.destroy.call(this)},e}(b.Edit);b.Lookup=m,c.registerControl(m,"string",!1,"",{lookup:!0}),c.registerControl(m,"number",!1,"",{lookup:!0})}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./group.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=(a.dom,a.ulocale),f=a.bootstrap4,g=function(a,b,e,g,h,i){g=g||"",b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,horizontal:!1},b);var j=[],k=null;return c.Utils.fieldWrapper(j,b,e,function(){if(!b.titleIsHidden){j.push('<label for="{0}_input" id="{0}_label"');var a=[];b.columns&&(f?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("bs-lib-col col-sm-"+b.labelCol)),b.inline&&a.push("checkbox-inline bs-cursor-d no-x-padding"),a.length&&j.push(' class="'+a.join(" ")+'"'),j.push(">"),j.push(d.escapeHtml(g||"")+(b.inline?"&nbsp;":"")),b.description&&c.Utils.addTooltip(j,b.description,b),j.push("</label>"),!b.inline&&b.horizontal&&j.push("<div></div>")}b.columns&&j.push('<div class="no-x-padding  col-sm-'+(12-b.labelCol)+'">');var e=b.inline||b.horizontal?["radio-inline"]:[];h.forEach(function(a,c){b.inline||b.horizontal||j.push('<div id="{0}_radio" class="radio">'),j.push("<label"),e.length&&j.push(' class="'+e.join(" ")+'"'),j.push(">"),j.push('<input type="radio" name="{0}_input" id="{0}_item_'+c+'" value="'+a+'">'),j.push("&nbsp;"),j.push(d.escapeHtml(i[c]||"")),j.push("</label>"),b.inline||b.horizontal||j.push("</div>")}),b.columns&&j.push("</div>")},k),d.format(j.join(""),a)},h=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._state2UI=function(){a.prototype._state2UI.call(this,function(a){a.checked=!0})},b.prototype.changed=function(b,c,d,e){var f=this;if(f.state.value!=d){f.state.value=d;var g=f.$schema["enum"].indexOf(f.state.value),h=a.prototype._item.call(this,g);h&&(h.checked=!0)}},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);if(!b.$element){var f=b.$schema.enumNames||b.$schema["enum"];f=f.map(function(a){return e.tt(a,b.form.$locale)}),b.$schema.description&&(d.description=e.tt(b.$schema.description,b.form.$locale)),b.$element=$(g(b.id,d,b.options.design,e.tt(b.$schema.title,b.form.$locale),b.$schema["enum"],f)),b.setEvents(d),b._state2UI()}return b.appendElement(a,d),b.$element},b}(b.Group);b.RadioGroup=h,c.registerControl(h,"*",!0,"radio",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,c,f,g){f=f||"",b=$.extend({titleIsHidden:!1},b);var h=[];return d.Utils.fieldWrapper(h,b,c,function(){h.push('<div style="background-color: red;">'+f+"</div>")}),e.format(h.join(""),a)}var d=b,e=a.utils,f=a.dom,g=a.ulocale,h=function(a){function b(b,c,d){a.call(this,b,c,d);var f=this;f._map=[],b.options&&b.options.$expression?(f.$expression=b.options.$expression,e.extractAngularVars(f.$expression,f._map)):(f.$expression=e.format("{0}: {{{1}}}",e.escapeHtml(g.tt(f.$schema.title,f.form.$locale)),f.$bind),f._map.push({name:f.$bind})),f._map.forEach(function(a){a.name!=f.$bind?(a.schema=d.getSchema(a.name),f.form.registerListenerFor(a.name,f)):a.schema=f.$schema}),this._state()}return __extends(b,a),b.prototype._state=function(){var a=this;a.state=a.state||{},a.state.values=a.state.values||{},a.state.fvalues=a.state.fvalues||{};var b=a.form.getState(a.$bind);a.state.isHidden=b.isHidden,a._map.forEach(function(b){a.state.values[b.name]=a.form.getValue(b.name),a.state.fvalues[b.name]=d.Utils.displayValue(a.state.values[b.name],b.schema,a.form.$locale,{html:!1,useSymbol:!0}).value})},b.prototype._value2UI=function(){var a=this,b=a.$element?a.$element.get(0):null,c=e.execAngularExpression(a.$expression,a.state.fvalues),d=$("<div>"+c+"</div>").get(0);for(f.empty(b);d.childNodes.length>0;)b.appendChild(d.childNodes[0])},b.prototype._findMap=function(a){for(var b=this,c=0,d=b._map.length;c<d;c++){var e=b._map[c];if(e.name==a)return e}return null},b.prototype.changed=function(a,b,c,e){var f=this;if(a&&f.state.values[a]!=c){var g=f._findMap(a);g&&(f.state.values[a]=c,f.state.fvalues[a]=d.Utils.displayValue(f.state.values[a],g.schema,f.form.$locale,{html:!1,useSymbol:!0}).value,f._value2UI())}},b.prototype.stateChanged=function(a,b){if(!a||"isHidden"===a){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(e))}},b.prototype._state2UI=function(){var a=this,b=a.$element?a.$element.get(0):null;b&&(a.setHidden(b),a._value2UI())},b.prototype.render=function(a){var b=this,e=b._initOptions(d.Utils.defaultOptions);return b.$element||(b.$element=$(c(b.id,e,b.options.design,g.tt(b.$schema.title,b.form.$locale),"")),b._state2UI()),b.appendElement(a,e),b.$element},b.prototype.destroy=function(){var b=this;b._map.forEach(function(a){a.name!=b.$bind&&b.form.unRegisterListenerFor(a.name,b)}),a.prototype.destroy.call(this)},b}(b.AbsField);b.ReadOnlyField=h,d.registerControl(h,"*",!1,"",{readOnly:!0})}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="../../../core/modules/locale.ts" />
/// <reference path="./absfield.control.ts" />
/// <reference path="../schema.data.ts" />
/// <reference path="../errors.data.ts" />
/// <reference path="./edit.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=(a.dom,a.locale,a.Observable.SchemaUtils,a.ulocale),c=b,f=a.bootstrap4,g=function(a,b,e,g,h,i){g=g||"",b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},b);var j=[];return b.titleIsHidden&&(b.columns=!1),b.placeHolder=!1,c.Utils.fieldWrapper(j,b,e,function(){if(!b.titleIsHidden){j.push('<label for="{0}_input" id="{0}_label"');var a=[];b.columns&&(f?a.push("form-control-label"):a.push("checkbox-inline bs-cursor-d"),a.push("bs-lib-col col-sm-"+b.labelCol)),b.inline&&a.push("no-x-padding checkbox-inline bs-cursor-d"),a.length&&j.push(' class="'+a.join(" ")+'"'),j.push(">"),j.push(d.escapeHtml(g||"")+(b.inline?"&nbsp;":"")),b.description&&c.Utils.addTooltip(j,b.description,b),j.push("</label>")}b.columns&&j.push('<div class="no-x-padding col-sm-'+(12-b.labelCol)+'">'),j.push('<select class="form-control'),b.size&&f&&j.push(" form-control-"+b.size),j.push('" id="{0}_input"');var e=[];b.maxWidth&&e.push("max-width: "+b.maxWidth+";"),b.minWidth&&e.push("min-width: "+b.minWidth+";"),e.length&&j.push(' style="'+e.join("")+'"'),j.push(">"),h.forEach(function(a,b){j.push('<option value="'+a+'">'+i[b]+"</option>")}),j.push("</select>"),c.Utils.addErrorDiv(j),b.columns&&j.push("</div>"),b.titleIsHidden&&b.description&&c.Utils.addTooltip(j,b.description,b)}),d.format(j.join(""),a)},h=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b.prototype.fillSelect=function(a){var b=this;c.Utils.fillSelect(a,b._input(),b.$schema)},b.prototype._state2UI=function(){var b=this,c=b._input();c&&b._setFilter(!0),a.prototype._state2UI.call(this)},b.prototype._setFilter=function(a){var b=this,c=b.state.filter;if(!a){var d=c?b.$schema.filters[c]||[]:b.$schema["enum"];if(b.fillSelect(d),!a){var e=d.indexOf(b.state.value);if(e<0)b.form.setValue(b.$display,d.length?d[0]:null);else{var f=b._input();f&&b._value2Input(f)}}}},b.prototype.stateChanged=function(b,c){var d=this,e=d.form.getState(d.$bind);a.prototype.stateChanged.call(this,b,c),b&&"filter"!==b||(d.state.filter=e.filter,d._setFilter(!1))},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);if(!b.$element){var f=b.$schema.enumNames||b.$schema["enum"];f=f.map(function(a){return e.tt(a+"",b.form.$locale)}),d.title=e.tt(b.$schema.title,b.form.$locale),b.$schema.description&&(d.description=e.tt(b.$schema.description,b.form.$locale)),b.$element=$(g(b.id,d,b.options.design,d.title,b.$schema["enum"],f)),b._state2UI(),b.setEvents(d)}return b.appendElement(a,d),b.$element},b.prototype.removeEvents=function(){var a=this,b=a._input();$(b).off("change")},b.prototype._value2Input=function(a){var b=this;a.selectedIndex=b.state.filter?b.$schema.filters[b.state.filter].indexOf(b.state.value):b.$schema["enum"].indexOf(b.state.value)},b.prototype.setEvents=function(a){var b=this,c=b._input();$(c).on("change",function(a){var c=b._input(),d=b.state.filter?b.$schema.filters[b.state.filter][c.selectedIndex]:b.$schema["enum"][c.selectedIndex];b.state.value!==d&&(b.state.value=d,b.form.setValue(b.$display,b.state.value))})},b}(b.BaseEdit);b.Select=h,c.registerControl(h,"*",!0,"",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../../../typings/index.d.ts" />
/// <reference path="../../../core/core.ts" />
/// <reference path="./absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){function c(a,b,c,g){g=g||"",b=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},b);var h=[];return e.Utils.fieldWrapper(h,b,c,function(){var a=[];b.titleIsHidden||(h.push('<label for="{0}_toggle" id="{0}_label"'),b.columns&&(i?a.push("form-control-label"):a.push("checkbox-inline"),a.push("bs-lib-col col-sm-"+b.labelCol)),b.inline&&a.push("checkbox-inline no-x-padding"),a.length&&h.push(' class="'+a.join(" ")+'"'),h.push(">"),h.push(f.escapeHtml(g||"")+(b.inline?"&nbsp;":"")),b.description&&e.Utils.addTooltip(h,b.description,b),h.push("</label>")),b.columns&&h.push('<div class="no-x-padding col-sm-'+(12-b.labelCol)+'" id="{0}_colparent">'),d(h,b,g),b.columns&&h.push("</div>"),b.titleIsHidden&&b.description&&e.Utils.addTooltip(h,b.description,b)}),f.format(h.join(""),a)}function d(a,b,c){a.push('<input class="tgl tgl-light" id="{0}_toggle" type="checkbox">'),a.push('<label class="tgl-btn" for="{0}_toggle"></label>')}var e=b,f=a.utils,g=a.dom,h=a.ulocale,i=a.bootstrap4,j=function(a){function b(b,c,d){a.call(this,b,c,d),this._state()}return __extends(b,a),b.prototype._check=function(){var a=this,b=a.$element.get(0);return g.find(b,a.id+"_toggle")},b.prototype.click=function(a){var b=this,c=b._check(),d=c.checked||!1;a.target==c&&b.state.value!=d&&(b.state.value=d,b.form.setValue(b.$bind,d))},b.prototype._setDisabled=function(a,b){var c=this,d=c._check();c.state.isDisabled||c.state.isReadOnly?g.addClass(d,"disabled"):g.removeClass(d,"disabled"),a.disabled=c.state.isDisabled},b.prototype._setReadOnly=function(a,b){this._setDisabled(a,b)},b.prototype._setMandatory=function(a,b){},b.prototype._state2UI=function(){var a=this,b=a._check(),c=a.$element?a.$element.get(0):null;b&&(b.checked=a.state.value||!1,a._setDisabled(b,c),a._setReadOnly(b,c),a.setHidden(c))},b.prototype.changed=function(a,b,c,d){var e=this,f=e._check();e.state.value!=c&&(e.state.value=c,f.checked=e.state.value||!1)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c._check(),f=c.$element?c.$element.get(0):null;d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,e&&c.setHidden(f)),d.isDisabled!=c.state.isDisabled&&(c.state.isDisabled=d.isDisabled,e&&c._setDisabled(e,f)),d.isReadOnly!=c.state.isReadOnly&&(c.state.isReadOnly=d.isReadOnly,e&&c._setReadOnly(e,f)),d.isMandatory!=c.state.isMandatory&&(c.state.isMandatory=d.isMandatory,e&&c._setMandatory(e,f))},b.prototype.render=function(a){var b=this,d=b._initOptions(e.Utils.defaultOptions);return b.$element||(b.$schema.description&&(d.description=h.tt(b.$schema.description,b.form.$locale)),b.$element=$(c(b.id,d,b.options.design,h.tt(b.$schema.title,b.form.$locale))),b._state2UI()),b.appendElement(a,d),b.$element},b}(b.AbsField);b.Toggle=j,e.registerControl(j,"boolean",!1,"toggle",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../core/core.ts" />
/// <reference path="./schema.data.ts" />
/// <reference path="./controls/absfield.control.ts" />
/// <reference path="./controls/link.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.render,d=b,e=(a.Observable,a.Observable.SchemaUtils),f=function(a,c,f){if(e.isLink(a.$bind))return b.Link;var g=e.isMeta(a.$bind);if(g)return d.Utils.getRegisterdControl("meta",!1,g.widget,{});if(!c)return null;var h;return a.$readOnly&&(h=h||{},h.readOnly=!0),f&&(h=h||{},h.lookup=!0),d.Utils.getRegisterdControl(c.type,!!c["enum"],a.$widget,h)};c.register("javascript","field.control",f),c.register("angular","field.control",f)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.locale,d=a.utils,e={type:"object",properties:{message:{type:"string"}}},f={name:"alert",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},g=function(d,g,h){d=d||c.ui.Info;var i={title:d,buttons:[{type:"primary",title:c.ui.Ok,name:"ok"}]},j={message:g};b.OpenModalForm(i,f,e,j,a.locale,function(a,b,c,d){if("modal-action"===b.operation)switch(b.property){case"ok":a.close(),h&&h()}})};d.alert=function(a,b,c){g(a,b,c)}}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
/// <reference path="../ui/datasets-plugin.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.locale,d=(a.utils,a.external),e=a.application,f=a.DatasetPlugin,g=a.dom,h=b,i={name:"form",$type:"block",$items:[{$bind:"oldPwd"},{$bind:"newPwd"},{$bind:"$$newPwd"}]},j=function(a){var b={type:"object",properties:{oldPwd:{title:c.ui.password.oldPassword,type:"string",format:"password",capabilities:{noConfirming:!0}},newPwd:{title:c.ui.password.newPassword,type:"string",format:"password",minLength:8}},states:{oldPwd:{isMandatory:!0},newPwd:{isMandatory:!0}}},d={title:c.ui.password.change,buttons:[{pattern:"validate"}]};h.OpenModalForm(d,i,b,{},{},function(b,c,d,h){switch(c.property){case"validate":if(!d.validate())return;var i={},j=e.configuration&&e.configuration.application&&e.configuration.application.authentication?e.configuration.application.authentication.changePasswordDs:null;if(!j)return void b.close();g.processing(!0);var k={oldPwd:d.oldPwd,newPwd:d.newPwd};j.name="data",f.executeDatasets([j],k,i,[],function(c,e){e?(d.addAjaxException(e),g.processing(!1)):(g.processing(!1),b.close(),a&&a())})}})};d.changePasswordHandler=j}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.locale,d=a.utils,e={type:"object",properties:{message:{type:"string"}}},f={name:"confirm",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},g=function(d,g,h){d=d||c.ui.Warning;var i={title:d,buttons:[{type:"default",title:c.ui.No,name:"no"},{type:"primary",title:c.ui.Yes,name:"yes"}]},j={message:g};b.OpenModalForm(i,f,e,j,a.locale,function(a,b,c,d){if("modal-action"===b.operation)switch(b.property){case"yes":a.close(),h&&h();break;case"no":a.close()}})};b.confirmDlg=g,d.confirm=function(a,b,c){g(a,b,c)}}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/core.ts" />
/// <reference path="../data/odata-provider.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=function(){function a(a,b,c,d,e,f,g){var h=this;h._enums={},h._entity=b,h._module=a,h._typeField=c,h._codeField=d,h._titleField=e,h._orderByField=f,h._fields=g}return a.prototype.promise=function(a,b){var e={},f=[],g=this,h=[];if(Object.keys(a).forEach(function(b){var c=a[b];if(g._enums[b])e[b]=g._enums[b];else{f.push({name:b,config:c});var d=g._typeField+" eq '"+b+"'";c.filter&&(d="("+d+" and "+c.filter+")"),h.push(d)}}),!f.length)return new d.Promise(function(a,c){a({type:b,enums:e})});var i={$top:1e3,nocount:!0,$entity:g._entity,$module:g._module,$filter:h.join(" or "),$orderby:g._typeField+","+g._orderByField};return c.odata.getRessources(i,function(a){return a.documents&&a.documents.forEach(function(a){var b=a[g._codeField],c=a[g._titleField],d=a[g._typeField];if(e[d]||(e[d]={"enum":[],enumNames:[]},g._enums[d]=e[d]),g._fields){e[d].fields=e[d].fields||[];var f=[],h={};if(g._fields.forEach(function(b){a[b]&&f.push(a[b]),h[b]=a[b]}),e[d].fields.push(h),f.length){var i=f.join("$");e[d].filters=e[d].filters||{},e[d].filters[i]=e[d].filters[i]||[],e[d].filters[i].push(b)}}e[d]["enum"].push(b),e[d].enumNames.push(c)}),{type:b,enums:e}})},a}();b.OdataEnumManager=e}(b=a.data||(a.data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.locale,d=a.utils,e={type:"object",properties:{value:{type:"string"}}},f={name:"prompt",$type:"block",$items:[{$bind:"value",options:{titleIsHidden:!0}}]},g=function(d,g,h){d=d||c.ui.Warning;var i={title:d,buttons:[{type:"primary",title:c.ui.Ok,name:"ok"}]},j={value:g||""};b.OpenModalForm(i,f,e,j,a.locale,function(a,b,c,d){if("modal-action"===b.operation)switch(b.property){case"ok":var e=c.value;a.close(),h&&h(e)}})};d.prompt=function(a,b,c){g(a,b,c)}}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../core/modules/locale.ts" />
/// <reference path="../core/core.ts" />
/// <reference path="../core/modules/application.ts" />
/// <reference path="../data/datasets.ts" />
/// <reference path="../ui/form/schema.data.ts" />
var Phoenix;!function(a){var b;a.ulocale,a.application,a.ajax;!function(b){var c=a.data,d=a.utils,e=a.Observable.SchemaUtils,f=a.dom,g=a.application,h={getRessources:function(b,c){var h=function(a){return c&&(a=c(a)),a},i=g.config(g.name);if(!i)throw"Application configuration not found.";var j=i.prototypes+"/"+b,k=a.ajax.get(j,{},function(a){return a});return new d.Promise(function(a,b){k.then(function(c){f.processing(!0),e.loadEnumsPromise(c).then(function(b){f.processing(!1),a(h(b))})["catch"](function(a){f.processing(!1),b(a)})})["catch"](function(a){b(a)})})}},i=function(a,b,c,d){return h.getRessources(a.$params.$url,function(a){return a})};c.registerDataProvider("form-meta",i)}(b=a.Data||(a.Data={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.ulocale,a.utils),d=(a.ajax,a.dom),e=(a.link,a.render,function(){/*******************************
            ************ METHODS
            *******************************/
function a(a,b){this._id=c.allocID(),this._fieldList=this._formatFieldList(a),this._cb=b}
// Called at instanciation of component
// Constants
// "Valider"
return a.prototype.destroy=function(){
// Events
this._nodeSelect.off("click"),this._nodeValidate.off("click"),
// Nodes
d.find(this._nodeParent[0],this._id).remove(),
// Variables
this._id=null,this._fieldList=null,this._cb=null,this._selectedField=null,this._nodeSelect=null,this._nodeSelectButtonTxt=null,this._nodeEdit=null,this._nodeValidate=null,this._nodeSelectedLi=null},a.prototype.render=function(a){var b=this;b._nodeParent=a,a.append(b._internalRender()),
// Change field event
b._nodeSelect.click(function(a){var c=a.target.attributes.code.value,d=b._getFieldByCode(c);d&&(b._nodeSelectButtonTxt.text(d.lib+" "),b._changeEditField(d),b._selectedField=d),
// Style changed
b._nodeSelectedLi&&b._nodeSelectedLi.removeClass("bs-row-selected"),b._nodeSelectedLi=$(a.target.parentNode),b._nodeSelectedLi.addClass("bs-row-selected")}),
// Validate filter event
b._nodeValidate.click(function(){if(b._selectedField){var a={code:b._selectedField.code,op:b._getOpField(b._selectedField),values:[b._nodeEdit.val()]};b._cb&&b._checkFilter(a)&&b._cb(a)}})},a.prototype._internalRender=function(){var b=this,c=$("<div id='"+b._id+"'></div>"),e=$("<div class='input-group'></div>"),f=$("<div class='input-group-btn'></div>"),g="<button type='button' ";g+="class='btn btn-default dropdown-toggle' data-toggle='dropdown' ",g+="aria-haspopup='true' aria-expanded='false'></button>";var h=$(g);b._nodeSelectButtonTxt=$("<span>"+a.FIELD_SELECT_TEXT_DEFAULT+" </span>");var i=$("<span class='caret'></span>");
// Fill fields in selectNode
b._nodeSelect=$("<ul class='dropdown-menu'></ul>"),b._fieldList.forEach(function(a){var c=$("<li><a code='"+a.code+"'>"+a.lib+"</a></li>");b._nodeSelect.append(c)}),
// Add editNode
b._nodeEdit=$("<input type='text' class='form-control' aria-label='...'>");
// Add validateNode
var j=$("<div class='input-group-btn'></div>");
// Append nodes to mainNode
return b._nodeValidate=$("<button class='btn btn-default' type='submit'><span class='"+d.iconClass(a.VALIDATE_ICON_DEFAULT)+"'></span> "+a.VALIDATE_TEXT_DEFAULT+"</button>"),c.append(e),e.append(f),e.append(b._nodeEdit),e.append(j),f.append(h),f.append(b._nodeSelect),h.append(b._nodeSelectButtonTxt),h.append(i),j.append(b._nodeValidate),c},a.prototype._getFieldByCode=function(a){var b=this,c=null;return b._fieldList.forEach(function(b){b.code===a&&(c=b)}),c},a.prototype._changeEditField=function(a){var b,c,d=this;c=d._getEditField(a).get(0),b=d._nodeEdit.get(0);b.parentNode;b.parentNode.replaceChild(c,b),d._nodeEdit=$(c)},a.prototype._getEditField=function(b){var c;switch(b.format){case a.FORMAT_INTEGER:c="<input type='number' class='form-control' aria-label='...'>";break;case a.FORMAT_STRING:c="<input type='text' class='form-control' aria-label='...'>";break;case a.FORMAT_ENUM:c="<select class='form-control'>",b["enum"]&&b["enum"].forEach(function(a,d){var e=b.enumNames&&b.enumNames[d]?b.enumNames[d]:a;c+="<option value='"+a+"'>"+e+"</option>"}),c+="</select>"}return $(c)},a.prototype._getOpField=function(b){var c;switch(b.format){case a.FORMAT_INTEGER:c=a.OP_INTEGER;break;case a.FORMAT_STRING:c=a.OP_STRING;break;case a.FORMAT_ENUM:c=a.OP_ENUM;break;default:c=""}return c},a.prototype._checkFilter=function(a){return""!=a.code&&(""!=a.op&&""!=a.values[0])},a.prototype._formatFieldList=function(a){return a.forEach(function(a){a.format=a["enum"]?"enum":"number"===a.type?"integer":a.type}),a},a.FIELD_SELECT_TEXT_DEFAULT="Choix du champ",a.VALIDATE_TEXT_DEFAULT="",a.VALIDATE_ICON_DEFAULT="search",a.FORMAT_STRING="string",a.FORMAT_INTEGER="integer",a.FORMAT_ENUM="enum",a.OP_STRING="like",a.OP_INTEGER="eq",a.OP_ENUM="eq",a}());b.FilterExpress=e}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/core/core.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.DatasetPlugin,d=a.dom,e=function(){function a(a,b){var c=this;c._init=!1,c._options=b||{},c._notify=b.notify,c._ds=a||{},c._ds.mapping=c._ds.mapping||{},c._ds.mapping.code=c._ds.mapping.code||"code",c._ds.mapping.libelle=c._ds.mapping.libelle||c._ds.mapping.lib||"lib";var d=a.data.$params||{};c._pageSize=d.$top||null,c.searchText=null,c._count=0,c._page=0,c._items=[],c._initData()}return a.prototype._initData=function(){var a=this,b={},e=a._ds.data||{},f={name:"dataset",$type:e.$type||"odata",$params:{$entity:e.$params.$entity,$module:e.$params.$module,$aggregation:"$count"}};d.processing(!0),c.executeDatasets([f],{},b,null,function(c,e){d.processing(!1),e||(a._init=!0,a._count=b.dataset,a._notify(null,{inited:!0,updated:!0}))},!1)},Object.defineProperty(a.prototype,"items",{get:function(){return this._items},set:function(a){a&&(this._items=a,this._notifyChange("items"))},enumerable:!0,configurable:!0}),a.prototype._notifyChange=function(a){var b=this;switch(a){case"items":b._notify(b.items,{})}},a.prototype.getNbPages=function(){var a=this;return Math.ceil(a._count/a._pageSize)},a.prototype._getSkip=function(a){var b=this;return a*b._pageSize},a.prototype._getPage=function(a,b){var e=this;if(e._init){var f=$.extend(!0,{},e._ds.data),g={};f.name="dataset",f.$params=f.$params||{},f.$params.$skip=e._getSkip(a),b=b||{},e.searchText&&(b.$searchText=e.searchText),d.processing(!0),c.executeDatasets([f],b,g,null,function(a,b){if(d.processing(!1),!b){var c=g.dataset;c&&e._count!=c.count&&(e._count=c.count,e._page=0,e._notify(null,{updated:!0})),c.documents&&(c.documents=c.documents.map(function(a){return{code:a[e._ds.mapping.code],libelle:a[e._ds.mapping.libelle]}}),e.items=c.documents)}},!1)}},a.prototype.currentPage=function(){return this._page},a.prototype.toPage=function(a){var b=this;a>=0&&a<b.getNbPages()&&(b._page=a,b._getPage(a))},a.prototype.nextPage=function(){var a=this,b=a._page+1;b<a.getNbPages()&&(a._page=b,a._getPage(b))},a.prototype.prevPage=function(){var a=this,b=a._page-1;b>=0&&(a._page=b,a._getPage(b))},a.prototype.firthPage=function(){var a=this;a._page=0,a._getPage(0)},a.prototype.lastPage=function(){var a=this,b=a.getNbPages()-1;a._page=b,a._getPage(b)},a.prototype.search=function(a){var b=this;b.searchText=a?a:null,b._ds.data.$params.$search&&b._getPage(0)},a}();b.DsLookup=e}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/core/modules/locale.ts" />
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
/// <reference path="./filter-lookup.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=a.ulocale,f=a.dom,g=a.Observable.SchemaUtils,h=(a.bootstrap4,function(){function a(){this.liste=[]}return a.prototype.add=function(a,b,c,d){var e=this,f={code:a,libelle:b||a,isBinary:c,options:d||{}};f.options.symbol=d.symbol||b||a,c&&(f.options.liaison=f.options.liaison||"et"),e.liste.push(f)},a.prototype.gets=function(){return this.liste},a.prototype.get=function(a){return this.liste.find(function(b){return b.code==a})},a.prototype.remove=function(a){var b=this.liste.findIndex(function(b){return b.code==a});b>=0&&this.liste.splice(b,1)},a}());b.ListeOperateurs=h;var i=function(){function a(){this.liste=[]}return a.prototype.add=function(a,b,c,d){var e=this;e.liste.push({code:a,libelle:b||a,type:c||"string",options:d||{}})},a.prototype.get=function(a){return this.liste.find(function(b){return b.code==a})},a.prototype.gets=function(){return this.liste},a.prototype.remove=function(a){var b=this.liste.findIndex(function(b){return b.code==a});b>=0&&this.liste.splice(b,1)},a}();b.ListeChamps=i;var j=function(){function a(a,b,c,d){var e=this;e.id=a,e.code=b,e.op=c,e.values=d||[]}return a.prototype.getValues=function(){return this.values.map(function(a){return a&&a.code?a.code:a})},a.prototype.getValueNames=function(){return this.values.map(function(a){return a&&a.lib?a.lib:a})},a}();b.Filter=j;var k=function(){function a(a){this.liste=[],this.filters=a,this.compteur=0}
//getCode(values) {
//    let id = -1;
//    this.liste.forEach(function (filter) {
//        let isOK = true;
//        if (Array.isArray(values)) {
//            values.forEach(function (v, indexV) {
//                if (filter.values[indexV] && v != filter.values[indexV]) {
//                    isOK = false;
//                    return false;
//                }
//            });
//        }
//        else if (filter.values[0] != values)
//            isOK = false;
//        if (isOK) {
//            code = filter.code;
//            return false;
//        }
//    });
//    return code;
//}
return a.prototype.add=function(a,b,c){var d=this,e=new j((d.compteur++),a,b,c);return d.liste.push(e),d.filters.push(e),e},a.prototype.add2=function(a,b,c){var d=this,e=new j((d.compteur++),a,b,c);return d.liste.push(e),e},a.prototype.set=function(a,b){var c,d=this,e=-1;if(d.liste.forEach(function(b,d){b.id==a&&(c=b,e=d)}),c&&(c.op=b.op,c.values=b.values||[]),e>=0&&e<d.filters.length){var f=d.filters.get(e);f&&(f.code=c.code,f.op=c.op,f.values=c.values)}return c},a.prototype.get=function(a){return this.liste.find(function(b){return b.id==a})},a.prototype.getByIndex=function(a){return this.liste[a]},a.prototype.gets=function(){return this.liste},a.prototype.getsByChamp=function(a){var b=[];return this.liste.forEach(function(c){c.code==a&&b.push(c)}),b},a.prototype.remove=function(a){var b=this,c=b.liste.findIndex(function(b){return b.id==a});c>=0&&(b.liste.splice(c,1),b.filters.remove(b.filters.get(c)))},a.prototype.removeAll=function(){var a=this;a.liste.splice(0),a.filters.forEach(function(b,c){a.filters.remove(a.filters.get(c))})},a.prototype.removeAllByChamp=function(a){var b=this;b.liste.forEach(function(c,d){c.code==a&&(b.liste.splice(d,1),b.filters.remove(b.filters.get(d)))})},a}();b.ListeFilters=k;var l=function(){function a(){this.liste=[]}return a.prototype.addType=function(a,b,c){this.liste.push({code:a,libelle:b||a,operateurs:c||[]})},a.prototype.addOperateur=function(a,b){this.liste.find(function(b){return b.code==a}).operateurs.push(b)},a.prototype.getOperateurs=function(a){return this.liste.find(function(b){return b.code==a}).operateurs},a}();b.ListeTypes=l;var m=function(){function a(a,b,c,d,e,f){this.listeChamps=a,this.listeFilters=b,this.listeOperateurs=c,this.filter=f,this.callBack=d,this.options=e||{},this.data={},this.init()}return a.prototype.init=function(){var a=this;a.model={type:"object",properties:{filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},selected:{type:"string"}}}}},links:{validate:{title:"Valider",isHidden:1!=a.options.btnValidate}}},a.layout={name:"form",$type:"block",$items:[{$type:"block",$items:[{$type:"block",$items:[{$bind:"filters",$widget:"tagview"}]},{$type:"block",$inline:!0,$items:[{$bind:"$links.validate",options:{type:"success",right:!0}}]}],$title:{value:"Filtres sélectionnés",size:5,style:""}}]},a.data.filters=a.listeFilters.gets().map(function(b){var c=a.listeOperateurs.get(b.op),d=a.listeChamps.get(b.code),e=d.libelle+" "+c.options.symbol+" ";return e+=c.isBinary?b.values[0]+" "+c.options.liaison+" "+b.values[1]:b.getValueNames().join(", "),{code:b.id,libelle:e,selected:!(!a.filter||a.filter.id!=b.id)}})},a.prototype.render=function(a){var b=this;a&&c.OpenForm($(a),b.layout,b.model,b.data,{},function(a,c,d){switch(a.property){case"upd":b.callBack("EDIT",{id:a.actionParams.code});break;case"remove":b.callBack("REMOVE",{id:a.actionParams.code});break;case"$links.validate":b.callBack("VALIDE",{})}})},a}(),n=function(){function a(a,b,c){this.valueModel=null;var d=this;d.type=a,d.op=b,d.options=$.extend(!0,{},c),d.valueModel=d.getInstance()}return a.prototype.getInstance=function(){var a=this,b=a.addDefaultOptions(a.options);return a.op.isBinary?new r(b):"vide"===a.op.code||"nvide"===a.op.code?new p(b):"enum"===a.type?new t(b):"lookup"===a.type?new u(b):"in"!==a.op.code&&"nin"!==a.op.code||"decimal"==a.type||"money"==a.type||"date"==a.type?new q(b):new s(b)},a.prototype.init=function(a){this.valueModel.init(a)},a.prototype.addDefaultOptions=function(a){var b=this;switch(b.type){case"integer":a.type="number";break;case"decimal":a.type="number",
// "symbol": "jours",
// "decimals": 0
a.decimals=a.decimals||5;break;case"money":a.type="number",a.format="money";break;case"date":a.type="string",a.format="date",a.title="Date";break;default:a.type=b.type||"string"}return a},a.prototype.getModel=function(){return this.valueModel?this.valueModel.getModel():null},a.prototype.getLayout=function(){return this.valueModel?this.valueModel.getLayout():null},a.prototype.getData=function(){return this.valueModel?this.valueModel.getData():null},a.prototype.getValues=function(){return this.valueModel?this.valueModel.getValues():null},a.prototype.setValues=function(a,b){return this.valueModel?this.valueModel.setValues(a,b):null},a.prototype.setValuesByFilter=function(a){this.valueModel&&this.valueModel.setValuesByFilter(a)},a}(),o=function(){function a(a){}return a.prototype.init=function(a){a&&a()},a.prototype.getModel=function(){return this.model},a.prototype.getLayout=function(){return this.layout},a.prototype.getData=function(){return this.data},a.prototype.getValues=function(){},a.prototype.setValues=function(a,b){},a.prototype.setValuesByFilter=function(a){},a}(),p=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.prototype.getValues=function(){return[""]},b}(o),q=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value:{title:c.options.title||"Valeur",type:c.options.type||"string"}},states:{value:{isMandatory:!0}}},c.options.format&&(c.model.properties.value.format=c.options.format),c.options.decimals&&(c.model.properties.value.decimals=c.options.decimals),c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:12}]},c.data={value:null}}return __extends(b,a),b.prototype.getValues=function(){return this.data.value?[this.data.value]:null},b.prototype.setValues=function(a){this.data.value=a.value},b.prototype.setValuesByFilter=function(a){this.data.value=a[0]},b}(o),r=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value1:{title:(b.title||"Valeur")+" 1",type:b.type||"string"},value2:{title:(b.title||"Valeur")+" 2",type:b.type||"string"}},states:{value1:{isMandatory:!0},value2:{isMandatory:!0}}},c.options.format&&(c.model.properties.value1.format=c.options.format,c.model.properties.value2.format=c.options.format),c.options.decimals&&(c.model.properties.value1.decimals=c.options.decimals,c.model.properties.value2.decimals=c.options.decimals),c.layout={name:"filter-value",$type:"block",$items:[{$type:"row",$items:[{$items:[{$bind:"value1",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6},{$items:[{$bind:"value2",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6}]}]},c.data={value1:null,value2:null}}return __extends(b,a),b.prototype.getValues=function(){var a=this;return a.data.value1&&a.data.value2?[a.data.value1,a.data.value2]:null},b.prototype.setValues=function(a){this.data.value1=a.value1,this.data.value2=a.value2},b.prototype.setValuesByFilter=function(a){this.data.value1=a[0],this.data.value2=a[1]},b}(o),s=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value:{title:"Valeur",type:"string"}},states:{value:{isMandatory:!0}}},c.options.format&&(c.model.properties.value.format=c.options.format),c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:'Une ou plusieurs valeurs (séparées par un ";" : val1;val2;...)'}}],$colSize:12}]},c.data={value:null}}return __extends(b,a),b.prototype.getValues=function(){var a=this;if(!a.data.value)return null;var b=a.data.value.split(";");return"number"==a.options.type&&(b=b.map(function(a){return parseInt(a,10)})),b},b.prototype.setValues=function(a){var b=this;if(a.value){var c=a.value.split(";");c=c.map(function(a){return a.replace(/\"/g,"")});var d=[];c.forEach(function(a){"number"==b.options.type?new RegExp("^[0-9]+$").test(a)&&d.push(a):d.push(a)}),b.data.value=d.join(";")}},b.prototype.setValuesByFilter=function(a){this.data.value=a.join(";")},b}(o),t=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.options.enumName=c.options.enumName||c.options.champName,c.model={type:"object",properties:{value:{title:"List",type:"array",items:{type:"string",enums:{},$enumref:"list"}}},states:{value:{isMandatory:!0}}},c.model.properties.value.items.enums[c.options.enumName]={type:"default","enum":[],enumNames:[]},c.model.properties.value.items.$enumref=c.options.enumName,c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"enums-list",options:{titleIsHidden:!0}}],$colSize:12}]},c.options["enum"]&&c.options["enum"].forEach(function(a){c.model.properties.value.items.enums[c.options.enumName]["enum"].push(a.code),c.model.properties.value.items.enums[c.options.enumName].enumNames.push(a.libelle||a.code)}),c.data={value:[]}}return __extends(b,a),b.prototype.getValues=function(){var a=this;return a.data.value&&a.data.value.length?a.data.value.map(function(b){var c=null;return a.options["enum"].forEach(function(a,d){if(b==a.code)return c=a,!1}),{code:b,lib:c.libelle||c.lib||b}}):[]},b.prototype.setValues=function(a){this.data.value=a.value},b.prototype.setValuesByFilter=function(a){this.data.value=a.map(function(a){return a.code})},b}(o),u=function(a){function b(b){a.call(this,b);var c=this;c.options=b||{},c.model={type:"object",properties:{value:{title:"List",type:"array",ds:c.options.lookupSchema||null,items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}},states:{value:{isMandatory:!0}}},c.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"lookup-list",options:{titleIsHidden:!0}}],$colSize:12}]},c.data={value:[]}}return __extends(b,a),b.prototype.getValues=function(){var a=this;return a.data.value&&a.data.value.length?a.data.value:[]},b.prototype.setValues=function(a){this.data.value=a.value},b.prototype.setValuesByFilter=function(a){this.data.value=a},b}(o),v=function(){function a(a,b,c,d,e,f,g){this.champ=a,this.filter=f,this.listeFilters=b,this.listeOperateurs=c,this.listeTypes=d,this.callBack=e,this.options=g||{},this.data={operateur:null,values:[]}}return a.prototype.renderOperateur=function(){var a=this,b={type:"object",properties:{champ:{title:"Filtre",type:"string"},operateur:{title:"Opérateur",type:"string","enum":[],enumNames:[]}},states:{champ:{isReadOnly:!0,isHidden:0==a.options.showLabel},operateur:{isHidden:0==a.options.showOperateur}}},d={name:"filter-operateur",$type:"block",$items:[{$type:"block",$items:[{$bind:"champ",$readOnly:!0,options:{$expression:"{{champ}}"}},{$bind:"operateur",options:{titleIsHidden:!0}}]}]},e=b.properties;b.states;
// Champ
a.data.champ=a.champ.libelle;
// Opérateurs
var g=a.champ.options.format||a.champ.type;if(e.operateur["enum"]=a.listeTypes.getOperateurs(g),e.operateur["enum"].forEach(function(b){e.operateur.enumNames.push(a.listeOperateurs.get(b).libelle)}),a.filter?a.data.operateur=a.filter.op:a.data.operateur=e.operateur["enum"][0],0!=a.options.showLabel||0!=a.options.showOperateur){var h=f.query(a.container,".operateur");if(h){var i=c.formManager().formByName("filter-operateur");c.removeForm(i),c.OpenForm($(h),d,b,a.data,{},function(b,c,d){switch(b.property){case"operateur":if("propchange"==b.operation){var e=a.listeOperateurs.get(c.model().operateur);a.data.operateur=c.model().operateur,a.renderValue(e)}}})}}},a.prototype.renderValue=function(a){var b=this,d=f.query(b.container,".value");if(d){var e=c.formManager().formByName("filter-value");c.removeForm(e);var g=b.champ.options||{};g.champName=b.champ.code,b.modelType=new n(b.champ.options.format||b.champ.type,a,g),b.modelType&&b.modelType.init(function(){var a=b.modelType.getModel(),e=b.modelType.getLayout();if(a&&e){var f=void 0;b.filter&&b.modelType.setValuesByFilter(b.filter.values),f=b.modelType.getData(),c.OpenForm($(d),e,a,f,{},function(a,c,d){switch(a.operation){case"propchange":b.modelType.setValues(c.model()),b.data.values=b.modelType.getValues();break;default:b.modelType.setValues(c.model()),b.data.values=b.modelType.getValues()}})}else b.data.values=b.modelType.getValues()})}},a.prototype.renderButton=function(){var a=this,b={type:"object",properties:{},links:{add:{title:"Ajouter"}}},d={name:"filter-link",$type:"block",$items:[{$inline:!0,$items:[{$bind:"$links.add",options:{type:"primary",icon:"plus",right:!0}}],$colSize:12}]},e=f.query(a.container,".link");if(e){var g=c.formManager().formByName("filter-link");c.removeForm(g),c.OpenForm($(e),d,b,a.data,{},function(b,d,e){switch(b.property){case"$links.add":var f=c.formManager(),g=f.formByName("filter-value");if(!d.validate()||g&&!g.$model.validate())return;d.model();a.data.values&&a.data.values.length&&a.callBack({code:a.champ.code,op:a.data.operateur,values:a.data.values})}})}},a.prototype.render=function(a){var b=this,c=["<div>",'<div class="operateur">',"</div>",'<div class="value">',"</div>",'<div class="link">',"</div>","</div>"];a&&(b.container=a,f.empty(a),f.append(a,$(c.join("")).get(0)),b.renderOperateur(),b.renderValue(b.listeOperateurs.get(b.data.operateur)),b.renderButton())},a}(),w=function(){function a(a,b,c,d,e,f){this.listeChamps=a,this.listeChampsArbre=b,this.listeFilters=c,this.listeOperateurs=d,this.listeTypes=e,this.options=f||{}}return a.prototype.createContainer=function(){var a=this,b=['<div class="row">','<div class="col-sm-5 champ-list">',"</div>",'<div class="col-sm-7 filter-edit">',"</div>","</div>",'<div class="row">','<div class="col-sm-12 filter-list">',"</div>","</div>"];a.container=document.createElement("div"),f.addClass(a.container,"filter-view"),a.container.innerHTML=b.join(""),a.champListView=f.query(a.container,".champ-list"),a.filterListView=f.query(a.container,".filter-list"),a.filterEditView=f.query(a.container,".filter-edit")},a.prototype.render=function(){var a=this;return a.createContainer(),a.listeChamps.gets().length&&(a.showChampList(),a.selecteChamp(a,a.listeChamps.gets()[0].code)),a.container},a.prototype.showChampList=function(){
// let that = this;
// let list = $('<div class="list-group"></div>').get(0);
// list.addEventListener("click", function (event) {
//     item = <HTMLLinkElement>event.target;
//     if (item["href"]) {
//         var href = _dom.attr(item, 'href');
//         if (href === '#') {
//             event.preventDefault();
//             event.stopPropagation();
//         }
//     }
//     let champCode = _dom.attr(item, "data-code");
//     if (champCode)
//         that.selecteChamp(that, champCode);
// }, false);
// let listHeightSize = 70 * (that.options.listSize || 7);
// let containerScroll = $('<div style="overflow-y:auto;max-height:' + listHeightSize + 'px;"></div>').get(0);
// _dom.append(containerScroll, list);
// _dom.append(that.champListView, containerScroll);
// let item = $('<a href="#" class="list-group-item"></a>').get(0);
// that.listeChamps && that.listeChamps.gets().forEach(function (champ, key) {
//     let itemClone = <HTMLLinkElement>item.cloneNode(true);
//     _dom.attr(itemClone, "data-code", champ.code);
//     _dom.text(itemClone, champ.libelle);
//     _dom.append(list, itemClone);
// });
var a=this;a._multiSelectList=new b.MultiSelectList(this.listeChampsArbre,{maxHeight:"auto"},function(b){b&&b.data.name&&a.selecteChamp(a,b.data.name)});var c=70*(a.options.listSize||7),d=$('<div style="border: 1px solid #dddddd; overflow:auto;max-height:'+c+'px;"></div>').get(0);a._multiSelectList.render(d),f.append(a.champListView,d)},a.prototype.selecteChamp=function(a,b){
// let oldItem = _dom.query(that.champListView, ".active");
// let newItem = _dom.query(that.champListView, 'a[data-code="' + codeChamp + '"]');
// if (oldItem)
//     _dom.removeClass(oldItem, "active");
// if (newItem)
//     _dom.addClass(newItem, "active");
a._multiSelectList.addItem(b),a.updateFilter(a,b);var c=a.listeFilters.getsByChamp(b),d=null;c&&c.length&&(d=c[0]),a.showFilterList(a,d)},a.prototype.showFilterList=function(a,b){var c=new m(a.listeChamps,a.listeFilters,a.listeOperateurs,function(b,c){if("EDIT"==b){var d=a.listeFilters.get(c.id);d&&a.selecteChamp(a,d.code)}else"REMOVE"==b?a.removeFilter(a,c.id):"VALIDE"==b&&a.valideFilters()},a.options,b);f.empty(a.filterListView),c.render(a.filterListView)},a.prototype.updateFilter=function(a,b){var c=a.listeChamps.get(b),d=a.listeFilters.getsByChamp(b),e=null;d&&d.length&&(e=d[0]);var g=new v(c,a.listeFilters,a.listeOperateurs,a.listeTypes,function(b){a.addFilter(a,b)},e,a.options);f.empty(a.filterEditView),g.render(a.filterEditView)},a.prototype.addFilter=function(a,b){var c,d=a.listeFilters.getsByChamp(b.code);c=!a.options.multiple&&d&&d.length?a.listeFilters.set(d[0].id,b):a.listeFilters.add(b.code,b.op,b.values),a.showFilterList(a,c)},a.prototype.removeFilter=function(a,b){var c=a.listeFilters.get(b).code;a.listeFilters.remove(b),a.selecteChamp(a,c)},a.prototype.valideFilters=function(){},a}(),x=function(a){function b(b,c,d,e,f,g,h){g.btnValidate=!0,a.call(this,b,c,d,e,f,g),this._callback=h}return __extends(b,a),b.prototype.createContainer=function(){var a=this,b=['<div class="row">','<div class="col-sm-12 filter-list">',"</div>","</div>",'<div class="row">','<div class="col-xs-12">','<h5 class="bs-block-title" data-ignore="true">'+(a.options.title||"Filtre")+"</h5>","</div>","</div>",'<div class="row">','<div class="col-sm-4 champ-list">',"</div>",'<div class="col-sm-8 filter-edit">',"</div>","</div>"];a.container=document.createElement("div"),f.addClass(a.container,"filter-view"),a.container.innerHTML=b.join(""),a.champListView=f.query(a.container,".champ-list"),a.filterListView=f.query(a.container,".filter-list"),a.filterEditView=f.query(a.container,".filter-edit")},b.prototype.valideFilters=function(){this._callback("VALIDE")},b}(w),y=function(a){function b(b,c,d){a.call(this,b,c,d);var e=this;d.registerListenerFor(e.$bind+".$item",e),this._state()}return __extends(b,a),b.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},b.prototype.click=function(a){var b=this,c=a.target;if("LI"==c.nodeName.toUpperCase()||"I"==c.nodeName.toUpperCase()){var d=c;"I"==c.nodeName.toUpperCase()&&(d=f.parentByTag(b.$element.get(0),c,"LI"));var e=-1;if(d&&(e=parseInt(f.attr(d,"data-id"),10)),e<0)return;d=null;var g=null;if(b.state.value.forEach(function(a,b){if(a.code==e)return g=a.model(),!1}),!g)return;var h=f.attr(c,"data-id");"REMOVE"==h?b.form.execAction("remove",g):b.form.execAction("upd",g)}},b.prototype._state2UI=function(){var a=this;a.createContainer(a.id),a.state.value&&a.state.value.forEach(function(b){a.addTag(b)})},b.prototype.destroy=function(){var b=this;b.form.unRegisterListenerFor(b.$bind+".$item",b),a.prototype.destroy.call(this)},b.prototype.changed=function(a,b,c,d,e){var f=this;"add"==d?f.addTag(c):"remove"==d&&f.removeTag(e.$value.code)},b.prototype.stateChanged=function(a,b){var c=this,d=c.form.getState(c.$bind),e=c.$element?c.$element.get(0):null;e&&d.isHidden!==c.state.isHidden&&(c.state.isHidden=d.isHidden,c.setHidden(e))},b.prototype.addTag=function(a){var b=this,c=document.createElement("li");f.addClass(c,"item"),f.addClass(c,"boxed-tags-item"),f.addClass(c,"bs-cursor-p"),f.addClass(c,"btn-primary"),a.selected&&f.addClass(c,"focus"),f.attr(c,"data-id",a.code),
//item.innerHTML = tag.libelle + ' <i data-id="UPDATE" class="glyphicon glyphicon-pencil" ></i><i data-id="REMOVE" class="glyphicon glyphicon-remove" ></i>';
c.innerHTML=a.libelle+' <i data-id="REMOVE" class="glyphicon glyphicon-remove" ></i>',f.append(b.$element.get(0),c)},b.prototype.removeTag=function(a){var b=this,c=f.query(b.$element.get(0),'li[data-id="'+a+'"]');f.remove(c)},b.prototype.createContainer=function(a){var b=this;b.$element=$(d.format('<ul id="{0}" data-render="{0}" class="boxed-tags" draggable="true"></ul>',a))},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);return b.$element||(b.setEvents(null),b._state2UI()),b.appendElement(a,d),b.$element},b}(b.AbsField);c.registerControl(y,"array",!1,"tagview");var z=function(){function a(a){var b=this;b.options=a||{},b._elements=[],b._values=[]}return Object.defineProperty(a.prototype,"elements",{get:function(){return this._elements},set:function(a){a&&(this._elements=a,this._notifyChange("elements"))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"values",{get:function(){return this._values},set:function(a){a&&(this._values=a,this._notifyChange("values"))},enumerable:!0,configurable:!0}),a.prototype._notifyChange=function(a){var b=this;switch(a){case"elements":f.empty(b.$element.get(0)),b.renderElements(b.elements||[],b.values||[],b.options||{})}},a.prototype.findVal=function(a){var b=-1;return this.values.forEach(function(c,d){if(c==a)return b=d,!1}),b},a.prototype.render=function(a){var b=this;return b.$element||(b.$element=$('<div class="row bs-checkboxlist"></div>'),b.renderElements(b.elements,b.values,b.options),b.setEvents(null)),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},a.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a.options=null},a.prototype.removeVal=function(a){var b=this,c=b.findVal(a);c>=0&&b.values.splice(c,1)},a.prototype.addVal=function(a){this.values.push(a)},a.prototype.setEvents=function(a){var b=this;b.$element&&b.$element.on("click",function(a){if(!b.options.isDisabled&&!b.options.isReadOnly){var c=f.parentByClass(b.$element.get(0),a.target,"bs-checkboxlist-list");c&&b._toggleEnumByIndex(f.indexOf(c.parentNode,c))}})},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype.renderElements=function(a,b,c){var d=this,e=document.createDocumentFragment();if(a.length){c=c||{};
//let e: HTMLElement = $('<div tabindex="0" class="bs-checkboxlist-list checkbox-inline"><div class="bs-checkboxlist-list-check"><a><center><span class="' + _dom.iconClass('square-o') + '"></span></center></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);
var g=$('<div tabindex="0" class="bs-checkboxlist-list col-lg-6 col-xs-12 checkbox-inline"><div class="bs-checkboxlist-list-check"><a><span class="'+f.iconClass("square-o")+'"></span></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);a.forEach(function(a,d){var h=g.cloneNode(!0);c.disabled?(f.attr(h,"tabindex","-1"),f.removeClass(h,"bs-pointer"),f.addClass(h,"bs-cursor-disabled")):(f.attr(h,"tabindex","0"),f.addClass(h,"bs-pointer"),f.removeClass(h,"bs-cursor-disabled"));var i=h.firstChild.firstChild.firstChild;i.className=b&&b.indexOf(a.code)>=0?f.iconClass("check-square-o"):f.iconClass("square-o");var j=h.lastChild;f.append(j,document.createTextNode(a.libelle)),f.append(e,h)})}else{var h=$('<center><div class="bs-lv-nodata">Aucun résultat trouvé ...</div></center>').get(0);f.append(e,h)}f.append(d.$element.get(0),e)},a.prototype._inputs=function(){return this.$element.get(0)},a.prototype._setItemValue=function(a,b){var c=a.firstChild.firstChild.firstChild;c.className=b?f.iconClass("check-square-o"):f.iconClass("square-o")},a.prototype._toggleEnumByIndex=function(a){var b=this;if(a>=0&&a<b.elements.length){var c=b.elements[a],d=b.findVal(c.code),e=b._inputs();d>=0?(b._setItemValue(e.childNodes[a],!1),b.removeVal(c.code),b.options.onSelectItem&&b.options.onSelectItem("remove",{id:a,value:c,data:c})):(b._setItemValue(e.childNodes[a],!0),b.addVal(c.code),b.options.onSelectItem&&b.options.onSelectItem("add",{id:a,value:c,data:c}))}},a}();b.CheckBoxList=z;var A=function(a){function b(b,c,d){a.call(this,b,c,d);var e=this;d.registerListenerFor(e.$bind+".$item",e),this._state()}return __extends(b,a),b.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},b.prototype.click=function(a){},b.prototype._state2UI=function(){},b.prototype.destroy=function(){var b=this;b.form.unRegisterListenerFor(b.$bind+".$item",b),a.prototype.destroy.call(this)},b.prototype.changed=function(a,b,c,d,e){},b.prototype.stateChanged=function(a,b){},b.prototype._createContainer=function(a,b,c,e){var f=['<div id="{0}" data-render="{0}">','<label for="{0}_input" id="{0}_label" class="'+(c?"":"bs-none")+'">'+(c||"")+"</label>",'<div id="{0}_toolbar"></div>',"<br />",'<div id="{0}_list"></div>','<center id="{0}_paginer"></center>',"</div>"];return d.format(f.join(""),a)},b.prototype._onSelectToolElement=function(a){var b=this;"search"===a.name&&b._lookup.search(a.value)},b.prototype.createToolBar=function(a,b){var d=this;if(d.$element&&!d._toolbar){var e=[{name:"search",type:"search",right:!1}];b=$.extend({selectToolElement:d._onSelectToolElement.bind(d)}),d._toolbar=new c.ToolBar(e,b);var g=f.query(d.$element.get(0),"#"+a+"_toolbar");if(!g)return;d._toolbar.render($(g))}},b.prototype._onSelectPaginer=function(a){var b=this;switch(a){case"next":b._lookup.nextPage();break;case"prev":b._lookup.prevPage();break;case"first":b._lookup.firthPage();break;case"last":b._lookup.lastPage();break;default:b._lookup.toPage(a-1)}},b.prototype.createPaginer=function(a,b){var d=this;if(d.$element){if(!d._pager){b=$.extend({size:"default",boundaryLinks:!0,selectPage:d._onSelectPaginer.bind(d)},b),d._pager=new c.Pager(b);var e=f.query(d.$element.get(0),"#"+a+"_paginer");if(!e)return;d._pager.render($(e))}var g=d._pager;g.props.totalPages=d._lookup.getNbPages(),g.props.currentPage=d._lookup.currentPage()+1}},b.prototype._onSelectCheckBoxList=function(a,b){var c=this;"add"===a?c.state.value.push({code:b.value.code,lib:b.value.libelle}):"remove"===a&&c.state.value.remove(c.state.value.find("code",b.value.code))},b.prototype._getValues=function(){var a=this,b=$.extend(!0,{},a.state.value);return b._items=b._items.map(function(a){return a.code}),b._items},b.prototype.createList=function(a,b){var d=this;if(d.$element&&!d._list){d._list=new c.CheckBoxList({onSelectItem:d._onSelectCheckBoxList.bind(d)}),d._list.values=d._getValues();var e=f.query(d.$element.get(0),"#"+a+"_list");if(!e)return;d._list.render($(e))}},b.prototype.createLookup=function(a){var b=this;if(b.$schema.ds){var d=function(a,c){c=c||{},c.inited&&c.updated?b._lookup.firthPage():a&&(b.$schema.ds.data.$params.$search&&b.createToolBar(b.id,{}),b.createList(b.id,{}),b._list.elements=a,b.createPaginer(b.id,b.renderOptions.pager))};b._lookup=new c.DsLookup(b.$schema.ds,{notify:d})}},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);return b.$element||(b.setEvents(null),b.$element=$(b._createContainer(b.id,e.tt(b.$schema.title,b.form.$locale),b.options.design,d)),b.createLookup({}),b._state2UI()),b.appendElement(a,d),b.$element},b}(b.AbsField);c.registerControl(A,"array",!1,"lookup-list",null);var B=function(a){function b(b,c,e){a.call(this,b,c,e),this.renderInternal=function(a,b){var c=this;if(c.$element){var d;switch(b.renderModel){case"model2":d=new x(c.listeChamps,c.listeChampsArbre,c.listeFilters,c.listeOperateurs,c.listeTypes,b,function(a,b){"VALIDE"==a&&c.form.execAction("validate",{})});break;default:d=new w(c.listeChamps,c.listeChampsArbre,c.listeFilters,c.listeOperateurs,c.listeTypes,b)}f.append(c.$element.get(0),d.render())}},this.createContainer=function(a){return d.format('<div id="{0}" data-render="{0}" class="bs-filter"></div>',a)},this._state(),this.options=c||{},this.initData()}return __extends(b,a),b.prototype.initData=function(){var a=this;
// reporter sur un fichier json les labels
a.listeOperateurs=new h,a.listeOperateurs.add("in","égal à",!1,{symbol:"="}),a.listeOperateurs.add("nin","différent de",!1,{symbol:"!="}),a.listeOperateurs.add("gt","supérieur à",!1,{symbol:">"}),a.listeOperateurs.add("ge","supérieur ou égal à",!1,{symbol:">="}),a.listeOperateurs.add("lt","inférieur à",!1,{symbol:"<"}),a.listeOperateurs.add("le","inférieur ou égal à",!1,{symbol:"<="}),a.listeOperateurs.add("between","entre",!0,{symbol:"entre"}),a.listeOperateurs.add("nbetween","pas entre",!0,{symbol:"pas entre"}),a.listeOperateurs.add("like","contient",!1,{symbol:"contient"}),a.listeOperateurs.add("nlike","ne contient pas",!1,{symbol:"ne contient pas"}),a.listeOperateurs.add("vide","vide",!1,{symbol:"est vide"}),a.listeOperateurs.add("nvide","pas vide",!1,{symbol:"n'est pas vide"}),a.listeTypes=new l,a.listeTypes.addType("decimal","Décimal",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("money","Money",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("integer","Entier",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("date","Date",["in","nin","gt","ge","lt","le","between","nbetween","vide","nvide"]),a.listeTypes.addType("string","Chaîne de caractères",["in","nin","like","nlike","vide","nvide"]),a.listeTypes.addType("enum","Enum",["in","nin","vide","nvide"]),a.listeTypes.addType("lookup","Lookup",["in","nin","vide","nvide"]),a.listeTypes.addType("boolean","Booléen",["in","nin","vide","nvide"]),a.listeChamps=new i;var b=a.state.value&&a.state.value.champs?a.state.value.champs:[];b.forEach(function(b){var c={};b.lookup?(c.lookupSchema=g.getLookup(a.$bind,b.lookup,a.$schema,a.form.$rootSchema),c.lookup=b.lookup,c.format="lookup"):b["enum"]&&b["enum"].length?(c["enum"]=b["enum"],c.enumName=b.enumName,c.format="enum"):"boolean"===b.type?(c["enum"]=[{code:"true",libelle:"Vrai"},{code:"false",libelle:"Faux"}],c.format="enum"):(c.decimals=b.decimals,c.format=b.format||null),a.listeChamps.add(b.code,b.libelle,b.type,c)});var c=a.state.value&&a.state.value.filters?a.state.value.filters:[];a.listeFilters=new k(c),c.forEach(function(b){var c=[];b.values.forEach(function(a){c.push(a)});var d=[];b.values2&&b.values2.forEach(function(a){d.push(a)}),a.listeFilters.add2(b.code,b.op,d.length?d:c)}),a.listeChampsArbre=a.state.value&&a.state.value.entree?a.state.value.model().entree:[]},b.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},b.prototype.click=function(a){},b.prototype._setDisabled=function(a,b){},b.prototype._setReadOnly=function(a,b){},b.prototype._setMandatory=function(a,b){},b.prototype._state2UI=function(){},b.prototype.changed=function(a,b,c,d){},b.prototype.stateChanged=function(a,b){},b.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);return b.$element||(b.$element=$(b.createContainer(b.id)),f.empty(b.$element.get(0)),d.id=b.id,d.title=b.$schema.title||"",d=$.extend(!0,d,b.renderOptions),b.renderInternal({data:b.state.value},d),b.setEvents(null),b._state2UI()),b.appendElement(a,d),b.$element},b.prototype.destroy=function(){a.prototype.destroy.call(this)},b}(b.AbsField);b.ComposantFilter=B,c.registerControl(B,"object",!1,"filter")}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/core/core.ts" />
/// <reference path="../../js/ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a,c=function(a,b,c,d,e){e=e||{};var f={code:b,libelle:c,type:d,format:e.format||null,decimals:e.decimals,"enum":e["enum"],enumName:e.enumName,lookup:e.lookup};a.push(f)},d=function(a,b,d,e,f,g,h){var i={};i.decimals=f,i["enum"]=g,i.enumName=h,c(a,b,d,e,i)},e=function(a,b){var c=function(a,b){for(var d=[],e=a.length%2!=0,f=e?a.length-1:a.length,g=0;g<f;g+=2)d.push({$left:a[g],$op:b,$right:a[g+1]});return e&&d.push(a[a.length-1]),d.length>=2&&(d=c(d,b)),d},d=function(b){function d(a,b,c,d){return{$left:{$left:a,$op:"ge",$right:{type:b,value:c}},$op:"and",$right:{$left:a,$op:"le",$right:{type:b,value:d}}}}function e(a,b,c){return{$left:"contains("+a+",'"+c+"')",$op:null,$right:null}}var f=a.find(function(a){return a.code==b.code}),g="in"==b.op?"eq":b.op;g="nin"==g?"ne":g;var h=b.values.map(function(a){return a.code?a.code:a});return"between"==g||"nbetween"==g?"between"==g?d(b.code,f.type,h[0],h[1]):{$op:"not",$right:d(b.code,f.type,h[0],h[1])}:(h=h.map(function(a){var c=null;switch(g){case"like":c=e(b.code,f.type,a);break;case"nlike":c={$op:"not",$right:e(b.code,f.type,a)};break;case"vide":c={$left:b.code,$op:"eq",$right:{type:"string",value:""}};break;case"nvide":c={$left:b.code,$op:"ne",$right:{type:"string",value:""}};break;default:c={$left:b.code,$op:g,$right:{type:f.type,value:a}}}return c}),c(h,"or")[0])},e=[];return b.forEach(function(a){e.push(d(a))}),c(e,"and")[0]};a.filterData={filter:{champs:[],filters:[],entree:[]}},b.glbGridFilter=function(c,d,e){function f(a,b){function c(a){var b;switch(a){case"in":b="=";break;case"nin":b="!=";break;case"like":b="contient";break;case"nlike":b="ne contient pas";break;case"vide":b="est";break;case"nvide":b="n'est pas";break;case"gt":b=">";break;case"ge":b=">=";break;case"lt":b="<";break;case"le":b="<=";break;case"between":b="entre";break;case"nbetween":b="pas entre";break;default:b=a}return b}var d=[];return a.forEach(function(a){b.forEach(function(b){if(a.code===b.code)return a.lib=b.libelle,!1});var e=(a.lib||a.code)+" "+c(a.op);e+="vide"===a.op||"nvide"===a.op?" vide":"between"===a.op||"nbetween"===a.op?" "+a.values[0]+" et "+a.values[1]:a.getValueNames?" "+a.getValueNames().join(","):" "+a.values.join(","),d.length&&d.push(" et "),d.push(e)}),d.join("")}if(c.schemaColumns.length){var g={name:"filtre",$type:"block",$items:[{$type:"block",$items:[{$bind:"filter",$widget:"filter",options:{renderModel:"model1"}}]}],form:!0},h={type:"object",properties:{filter:{type:"object",title:"Filtre",properties:{champs:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},type:{type:"string"},format:{type:"string"},decimals:{type:"number"},enumName:{type:"string"},"enum":{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"}}}},lookup:{type:"string"}}}},filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},op:{type:"string"},values:{type:"array",items:{type:"string"}},values2:{type:"array",items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}}}},entree:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array"}}}}}}}};a.filterData.filter.champs.length&&a.filterData.filter.champs.splice(0),c.schemaColumns.forEach(function(c){var d=$.extend(!0,{},c.schema);switch(d.type){case"number":d.decimals>0?d.type="decimal":d.type="integer"}c.schema["enum"]&&(d["enum"]=c.schema["enum"].map(function(a,b){return{code:a,libelle:c.schema.enumNames?c.schema.enumNames[b]:a}})),b.filter.addField2(a.filterData.filter.champs,c.name,d.title,d.type,{decimals:d.decimals,"enum":d["enum"],format:d.format})}),a.filterData.filter.entree&&(a.filterData.filter.entree=a.multiSelectUtils.transformPropsToMultiselectFormat(c.schemaColumns,c.schemaGroups));var i={title:"Filtre",buttons:[{pattern:"validate"}]};b.OpenModalForm(i,g,h,a.filterData,e,function(c,e,g,h){switch(e.property){case"validate":if(!g.validate())return;a.filterData=g.model();var i=null;a.filterData.filter.filters.length&&(i=b.filter.format.toPhenix(a.filterData.filter.champs,a.filterData.filter.filters)),d.filter={value:i,title:f(a.filterData.filter.filters,a.filterData.filter.champs)},c.close()}})}},a.filter={format:{toPhenix:e},addField:d,addField2:c}}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/core/core.ts" />
/// <reference path="../../js/ui/form/modalform.control.ts" />
var Phoenix;!function(a){var b;!function(a){var b=a;b.glbGridSettings=function(c,d,e){var f={name:"settings",$type:"block",$items:[{$type:"block",$items:[{$bind:"mselect",$widget:"multiselectlist",options:{multiSelect:!0}}]}],form:!0},g={properties:{mselect:{type:"object",properties:{entree:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array"}}}},sortie:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"}}}}}}}},h={mselect:{entree:a.multiSelectUtils.transformPropsToMultiselectFormat(c.schemaColumns,c.schemaGroups),sortie:a.multiSelectUtils.transformSelectedColumnsToMultiSelectFormat(c.schemaColumns,c.selectedColumns)}},i={title:c.locale.settingsTitle||"Options",buttons:[{pattern:"validate"}]};b.OpenModalForm(i,f,g,h,e,function(b,c,e,f){switch(c.property){case"validate":if(!e.validate())return;var g=e.model().mselect.sortie;if(g<=0)return;var h=a.multiSelectUtils.transformMultiSelectColumnsToGridColumnsFormat(g);d&&d(h),b.close()}})};var c=function(a,b){function c(a,b){function c(a,b){var d=null;return a.every(function(a){return a.name===b?(d=a,!1):!a.items||!(d=c(a.items,b))}),d}b.forEach(function(b){var d={name:b.name,title:b.schema.title||b.name},e=c(a,b.schema.group);e?(e.items=e.items||[],e.items.push(d)):a.push(d)})}var d=b&&b.items?b.items:[],e=b&&b.items?$.extend(!0,[],d):[];return c(e,a),e},d=function(a){var b=[];return a.forEach(function(a){b.push({$bind:a.name})}),b},e=function(a,b){var c=[];return Object.keys(b).forEach(function(d){a.every(function(a){return a.name!==d||(b[d]&&c.push({name:d,title:a.schema.title||a.name}),!1)})}),c};a.multiSelectUtils={transformPropsToMultiselectFormat:c,transformMultiSelectColumnsToGridColumnsFormat:d,transformSelectedColumnsToMultiSelectFormat:e}}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/core/modules/locale.ts" />
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=(a.utils,a.ulocale,a.dom),d=(a.Observable.SchemaUtils,a.bootstrap4,function(){function a(a,b,c){var d=this,e={mapping:{id:"name",lib:"title"},expandIcon:"plus-sign",collapseIcon:"minus-sign",checkedIcon:"check",uncheckedIcon:"unchecked",itemIcon:"",groupIcon:"",multiSelect:!1,showTags:!1,groupLink:!1,itemLink:!0,border:!1,maxHeight:"300px"};d._options=$.extend(!0,e,b),d._name=d._options.mapping.id,d._title=d._options.mapping.libelle||d._options.mapping.lib,d._data=a||[],d._callback=c||null,d._nodes=$.extend(!0,[],a),d._selectedItems=[],d._init()}return Object.defineProperty(a.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(a){var b=this;b._selectedItems=a,b._selectedItems.forEach(function(a){b.addItem(a[b._name])})},enumerable:!0,configurable:!0}),a.prototype._init=function(){var a=this;a._contructeNodes(a._nodes,a._options)},a.prototype._getGroupNode=function(a,b){var c=this,d=null;return a.every(function(a){return a.items&&(d=a[c._name]===b?a:null,d||(d=c._getGroupNode(a.items,b))),!d}),d},a.prototype._getItemNode=function(a,b){var c=this,d=null;return a.every(function(a){return d=a.items||a[c._name]!==b?null:a,!d&&a.items&&(d=c._getItemNode(a.items,b)),!d}),d},a.prototype._getItem=function(a,b){var c=this,d=null;return a.every(function(a){return a[c._name]===b?(d=a,!1):!a.items||!(d=c._getItem(a.items,b))}),d},a.prototype._contructeNodes=function(a,b){function d(a,b,f,g,h){var i=$(e._template().item).get(0);e._options.border||c.addClass(i,"noborder"),a.forEach(function(a){if(a[e._name]){a.level=f||0,a.show=1==g,a.parent=b||null,a.component=i.cloneNode(),a.items&&(a.tagsSize=0,d(a.items,a,a.level+1,!1,h));for(var j=a.parent;j;)j.tagsSize++,j=j.parent;for(var k=1;k<=a.level;k++)c.append(a.component,$(e._template().indent).get(0));if(a.items){var l=e._createIcon(a.component,h.expandIcon,"icon-group bs-cursor-p");if(c.attr(l,"data-event","click"),c.attr(l,"data-action","expand"),h.multiSelect&&h.groupLink){var m=e._createIcon(a.component,h.uncheckedIcon,"icon-check bs-cursor-p");c.attr(m,"data-event","click"),c.attr(m,"data-action","uncheck")}else h.groupLink&&(c.attr(a.component,"data-event","click"),c.attr(a.component,"data-action","selectitem"),c.addClass(a.component,"bs-cursor-p"));e._createIcon(a.component,h.groupIcon)}else{var l=e._createIcon(a.component);if(c.addClass(l,"icon-exist"),h.multiSelect&&h.itemLink){var m=e._createIcon(a.component,h.uncheckedIcon,"icon-check bs-cursor-p");c.attr(m,"data-event","click"),c.attr(m,"data-action","uncheck")}else h.itemLink&&(c.attr(a.component,"data-event","click"),c.attr(a.component,"data-action","selectitem"),c.addClass(a.component,"bs-cursor-p"));e._createIcon(a.component,h.itemIcon)}c.append(a.component,$("<span>"+(a[e._title]||a[e._name])+"</span>").get(0)),c.attr(a.component,"data-id",a[e._name])}})}var e=this;Array.isArray(a)&&a.length&&(d(a,null,0,!0,b),b.showTags&&e._addTags(e._nodes))},a.prototype._addTags=function(a){var b=this;a.forEach(function(a){if(a.items){var d=$(b._template().badge).get(0);c.append(d,document.createTextNode(""+a.tagsSize)),c.append(a.component,d),b._addTags(a.items)}})},a.prototype._template=function(){return{list:'<ul class="list-group bs-treeview"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge"></span>'}},a.prototype._createIcon=function(a,b,d){var e=this,f=$(e._template().icon).get(0);return b&&e._addIcon(f,b,d),c.append(a,f),f},a.prototype._addIcon=function(a,b,d){c.attr(a,"class","icon icon-exist "+c.iconClass(b)+(d?" "+d:""))},a.prototype._setEvents=function(){var a=this;a._container&&a._container.addEventListener("click",function(b){var d=b.target,e=null;if(e="click"===c.attr(d,"data-event")?d:c.parentByTag(a._container,d,"LI"),e&&"click"===c.attr(e,"data-event")){var f=c.parentByTag(a._container,e,"LI"),g=c.attr(f,"data-id"),h=c.attr(e,"data-action");"expand"===h?a._display(g,!0):"collapse"===h?a._display(g,!1):"selectitem"===h?a._select(g,a._callback):"check"===h&&a._options.multiSelect?a._check(g,!1,a._callback):"uncheck"===h&&a._options.multiSelect&&a._check(g,!0,a._callback)}})},a.prototype._display=function(a,b){var d=this,e=d._getGroupNode(d._nodes,a);if(e){var f=function(a,b){a.forEach(function(a){if(a.show=b,a.items){f(a.items,!1);var e=c.query(a.component,".icon-group");e&&(d._addIcon(e,d._options.expandIcon,"icon-group bs-cursor-p"),c.attr(e,"data-action","expand"))}})};f(e.items,b);var g=c.query(e.component,".icon-group");d._addIcon(g,b?d._options.collapseIcon:d._options.expandIcon,"icon-group bs-cursor-p"),c.attr(g,"data-action",b?"collapse":"expand"),d._renderItems(d._nodes)}},a.prototype._select=function(a,b){var d=this,e=c.query(d._container,".active");e&&c.removeClass(e,"active"),d._selectedItems.splice(0);var f=d._getItem(d._nodes,a);f&&(d._showItem(a),c.addClass(f.component,"active"),f=d._getItem(d._data,a),f&&(d._selectedItems.push(f),b&&b({action:"add",data:f})))},a.prototype._unSelect=function(a,b){var d=this,e=c.query(d._container,".active");e&&c.removeClass(e,"active");var f=d._getItem(d._selectedItems,a);f&&(d._selectedItems.splice(0),b&&b({action:"remove",data:f}))},a.prototype._check=function(a,b,d){var e=this,f=e._getItem(e._data,a);if(f){var g=e._getItem(e._nodes,a).component,h=c.query(g,".icon-check");e._addIcon(h,b?e._options.checkedIcon:e._options.uncheckedIcon,"icon-check bs-cursor-p"),c.attr(h,"data-action",b?"check":"uncheck");var i=void 0;if(b)e._selectedItems.push(f),i="add";else{var j=-1;e._selectedItems.every(function(b,c){return b[e._name]!==a||(j=c,!1)}),j>=0&&(e._selectedItems.splice(j,1),i="remove")}d&&d({action:i,data:f})}},a.prototype._showItem=function(a){function b(a,e){a.forEach(function(a){if(a.show=e,a.items){b(a.items,!1);var f=c.query(a.component,".icon-group");f&&(d._addIcon(f,d._options.expandIcon,"icon-group bs-cursor-p"),c.attr(f,"data-action","expand"))}})}var d=this,e=d._getItem(d._nodes,a);if(e){for(var f=e.parent;f;){b(f.items,!0);var g=c.query(f.component,".icon-group");d._addIcon(g,d._options.collapseIcon,"icon-group bs-cursor-p"),c.attr(g,"data-action","collapse"),f=f.parent}d._renderItems(d._nodes)}},a.prototype.addItem=function(a){var b=this;b._options.multiSelect?b._check(a,!0):b._select(a)},a.prototype.removeItem=function(a){var b=this;b._options.multiSelect?b._check(a,!1):b._unSelect(a)},a.prototype._renderItems=function(a){function b(a,d){a.forEach(function(a){a.show&&c.append(d,a.component),a.items&&b(a.items,d)})}var d=this;c.empty(d._container);var e=document.createDocumentFragment();b(a,e),c.append(d._container,e)},a.prototype.render=function(a){var b=this;return b._container||(b._container=$(b._template().list).get(0),b._container.style.maxHeight=b._options.maxHeight,b._options.border||c.addClass(b._container,"noborder"),b._renderItems(b._nodes),b._setEvents()),a&&c.append(a,b._container),b._container},a}());b.MultiSelectList=d}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.utils,d=(a.ulocale,a.dom),e=a.drag,f=a.events,g=(a.Observable.SchemaUtils,a.bootstrap4,function(){function a(a,b,c){var d=this,e={mapping:{id:"name",lib:"title"},removeIcon:"remove",border:!1};d._options=$.extend(!0,e,b),d._name=d._options.mapping.id,d._title=d._options.mapping.libelle||d._options.mapping.lib,d._data=a||[],d._callback=c||null,d._nodes=$.extend(!0,[],a),d._selectedItems=[],d._init()}return Object.defineProperty(a.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(a){this._selectedItems=a},enumerable:!0,configurable:!0}),a.prototype._init=function(){var a=this;a._constructeNodes(a._nodes,a._options)},a.prototype._constructeNodes=function(a,b){if(Array.isArray(a)&&a.length){var c=this,e=$(c._template().itemTag).get(0),f=$(c._template().icon).get(0);a.forEach(function(a){a[c._name]&&(a.component=e.cloneNode(),d.append(a.component,document.createTextNode(a[c._title]||a[c._name])),d.attr(a.component,"data-id",a[c._name]),d.append(a.component,f.cloneNode()),a.filter=!0)}),c._input=$(c._template().itemInput).get(0)}},a.prototype._getItem=function(a,b){var c=this,d=null;return a.every(function(a){return a[c._name]!==b||(d=a,!1)}),d},a.prototype._getItemIndex=function(a,b){var c=this,d=-1;return a.every(function(a,e){return a[c._name]!==b||(d=e,!1)}),d},a.prototype._addTag=function(a,b){var c=this,d=c._getItem(c._selectedItems,a);d||(d=c._getItem(c._data,a),d&&(c._selectedItems.push(d),c._getItem(c._nodes,a).filter=!1,c._renderItems(),b&&b({action:"add",data:d})))},a.prototype._removeTag=function(a,b){var c=this,d=c._getItemIndex(c._selectedItems,a);d>=0&&(c._selectedItems.splice(d,1),c._getItem(c._nodes,a).filter=!0,c._renderItems(),b&&b({action:"remove",data:c._getItem(c._data,a)}))},a.prototype._filterList=function(a){var b=this;a.toLowerCase(),b._nodes.forEach(function(c){c.filter=c[b._title].toLowerCase().indexOf(a)>=0&&null==b._getItem(b._selectedItems,c[b._name])});var c=[];b._nodes.forEach(function(a){a.filter&&c.push(a)}),b._menu.show({value:c},0,!0)},a.prototype._setEvents=function(a){var b=this;if(b._container&&(b._container.addEventListener("click",function(a){var c=a.target;if(c.href){var e=d.attr(c,"href");"#"===e&&(a.preventDefault(),a.stopPropagation())}if(c&&"click"===d.attr(c,"data-event")){var f=d.attr(c,"data-action");if("remove"===f){var g=d.parentByTag(b._container,c,"LI"),h=d.attr(g,"data-id");b._removeTag(h,b._callback)}}else b._menu&&b._menu.opened&&b._menu.inMenu(a.target)&&b._menu.click(a);var i=d.query(b._input,"input");i&&i.focus()}),b._container.addEventListener("keyup",function(a){13==a.keyCode&&b._menu&&b._menu.opened&&b._menu.select();var c=d.query(b._input,"input");c&&c.focus()})),b._input){var c=!0;b._input.addEventListener("keyup",function(a){var e=a.target;if(38==a.keyCode||40==a.keyCode);else if(8==a.keyCode){c?b._filterList(e.value):b._menu&&b._menu.opened&&b._menu.hide(e)}else if(13==a.keyCode&&e&&"keyup"===d.attr(e,"data-event")){var f=e;b._addTag(f.value,b._callback),f.value=""}else{b._filterList(e.value);var g=d.query(b._container,".bs-pillbox-item-tag.focus");g&&d.removeClass(g,"focus")}var h=d.query(b._input,"input");h&&h.focus()}),b._input.addEventListener("keydown",function(a){var e=a.target;if(40==a.keyCode&&b._menu&&b._menu.opened)b._menu.move(1);else if(38==a.keyCode&&b._menu&&b._menu.opened)b._menu.move(-1);else if(8==a.keyCode){var f=e;if(f.value.length<=0&&b._selectedItems.length&&"keyup"===d.attr(e,"data-event")){var g=b._selectedItems[b._selectedItems.length-1],h=b._getItem(b._nodes,g[b._name]);d.hasClass(h.component,"focus")?(d.removeClass(h.component,"focus"),b._removeTag(g[b._name],b._callback)):d.addClass(h.component,"focus"),c=!1}else c=!0}var i=d.query(b._input,"input");i&&i.focus()})}b._drag=e.dragManager.addDrag([b._container]),b._drag.canStartDragHandler=b._canStartDrag.bind(b),b._drag.onDragStart=b._onDragStart.bind(b),b._drag.onDrag=b._onDrag.bind(b),b._drag.onDragEnd=b._onDragEnd.bind(b)},a.prototype._template=function(){var a=this;return{list:'<ul class="bs-pillbox noborder"></ul>',itemTag:'<li class="bs-pillbox-item bs-pillbox-item-tag" data-drag="move"></li>',icon:'<span class="icon pull-right '+d.iconClass(a._options.removeIcon)+' icon-remove bs-cursor-p" data-event="click" data-action="remove"></span>',itemInput:'<li class="bs-pillbox-item bs-pillbox-item-edit"><input autocomplete="off" autofocus="true" placeholder="..." data-event="keyup" data-action="add,remove" /></li>'}},a.prototype.addItem=function(a){this._addTag(a)},a.prototype.removeItem=function(a){this._removeTag(a)},a.prototype._canStartDrag=function(a){var b=this,e=a.target,f=d.parentByTag(b._container,e,"LI");if(f){var g=d.attr(f,"data-drag");if(!g)return!1;f.id||(f.id=c.allocID());var h=b._drag;if(h.coverDocument=!0,h.data.op=g,h.data.cloneId=f.id,h.data.column=d.attr(f,"data-id"),!h.data.column)return!1;var i=d.find(b._container,h.data.cloneId);h.cursor="move",h.moveX=!0,h.moveY=!0,h.startOffset=d.position(i,null);var j={top:0,height:i.offsetHeight},k=[];return b.selectedItems.forEach(function(a){var e=d.query(b._container,"li[data-id='"+a[b._name]+"']");e&&(e.id||(e.id=c.allocID()),k.push({htmlId:e.id,info:a}))}),h.data.childrenPositions=d.childrenPositions(b._container,k,!1,"free",j),!0}},a.prototype._onDragStart=function(a){var b=this,c=b._drag;if(!c.data.op)return!1;var e=d.find(b._container,c.data.cloneId),f=e.cloneNode(!0),g=d.position(e,null);return f.style.top=g.top+"px",f.style.left=g.left+"px",f.style.width=e.offsetWidth+"px",f.style.height=e.offsetHeight+"px",f.style.zIndex="5000",f.style.position="absolute",c.floatElement=f,d.append(document.body,c.floatElement),!0},a.prototype._onDrag=function(a){var b=this,c=b._drag;if(!c.data.op)return!1;var e=f.point(a),g=d.findNearest(e.x,e.y,c.data.childrenPositions);if(c.data.best!=g){var h={left:g.left,top:g.top,width:g.width,height:g.height};c.data.mdiv=d.showMove(c.data.mdiv,g.vertical,h,"bs-drag-color-info")}return c.data.best=g,!0},a.prototype._onDragEnd=function(a,b){var c=this,e=c._drag;if(!e.data.op)return!1;if(e.floatElement&&(d.remove(e.floatElement),e.floatElement=null),e.data.mdiv&&(d.remove(e.data.mdiv),e.data.mdiv=null),!a){if(e.data.best&&e.data.column){var f=e.data.best.info;if("empty"===e.data.best.position||f[c._name]===e.data.column)return;var g=c._getItem(c._selectedItems,e.data.column),h=c._getItemIndex(c._selectedItems,e.data.column);c.selectedItems.splice(h,1);var i=c._getItemIndex(c._selectedItems,f[c._name]);i="after"===e.data.best.position?i+1:i,c.selectedItems.splice(i,0,g),c._callback&&c._callback({action:"drag",srcIndex:h,destIndex:i,data:g})}c._renderItems();var j=d.query(c._input,"input");j&&j.focus()}},a.prototype._onMenuSelectItemHandler=function(a){var b=this;if(a){b._addTag(a[b._name],b._callback);var c=d.query(b._input,"input");c&&(c.value="")}},a.prototype._includeDropDownMenu=function(){var a=this,c=d.query(a._input,"input");a._menu=new b.DropItems($(a._input),c,{primaryKey:a._name,search:a._title,onselect:a._onMenuSelectItemHandler.bind(a)})},a.prototype._renderItems=function(){function a(a,c){a.forEach(function(a){var e=b._getItem(b._nodes,a[b._name]);e.filter=!1,d.append(c,e.component)})}var b=this;d.empty(b._container);var c=document.createDocumentFragment();a(b._selectedItems,c),d.append(c,b._input),d.append(b._container,c)},a.prototype.render=function(a){var b=this;return b._container||(b._container=$(b._template().list).get(0),b._renderItems(),b._includeDropDownMenu(),b._setEvents(a)),a&&d.append(a,b._container),b._container},a.prototype.remove=function(){var a=this;a._menu=null,a._drag&&(e.dragManager.rmvDrag(a._drag),a._drag=null)},a}());b.PillBox=g}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/ui/form/form.control.ts" />
/// <reference path="../../js/ui/form/controls/absfield.control.ts" />
/// <reference path="./multiselect.ts" />
/// <reference path="./pillbox.ts" />
var Phoenix;!function(a){var b;!function(b){var c=b,d=a.utils,e=(a.ulocale,a.dom),f=(a.Observable.SchemaUtils,a.bootstrap4,function(a){function f(c,d,e){function f(a,b){var c=null;return a.forEach(function(a,d){return a[g._name]!==b||(c={id:d,data:a},!1)}),c}a.call(this,c,d,e);var g=this;g._state();var h={mapping:{id:"name",lib:"title"},groupLink:!1,itemLink:!0,multiSelect:!0,showTags:!1},i=g.state.value.model().entree||[],j=g.state.value.sortie||[],k=$.extend(!0,h,g.renderOptions);if(g._name=k.mapping.id,g._title=k.mapping.libelle||k.mapping.lib,Array.isArray(i)&&i.length){g.multiSelectList=new b.MultiSelectList(i,k,function(a){if("add"===a.action)g.pillBox.addItem(a.data[g._name]),j.push(a.data);else if("remove"===a.action){g.pillBox.removeItem(a.data[g._name]);var b=f(j,a.data[g._name]);b&&j.remove(b.data)}}),g.multiSelectList.selectedItems=g.state.value.model().sortie;var l=g._extractItems(i,k.groupLink);g.pillBox=new b.PillBox(l,k,function(a){if("add"===a.action)g.multiSelectList.addItem(a.data[g._name]),j.push(a.data);else if("remove"===a.action){g.multiSelectList.removeItem(a.data[g._name]);var b=f(j,a.data[g._name]);b&&j.remove(b.data)}else if("drag"===a.action){var c=f(j,a.data[g._name]);j.remove(c.data),j.splice(a.destIndex,0,a.data)}}),g.pillBox.selectedItems=g.state.value.model().sortie}}return __extends(f,a),f.prototype._extractItems=function(a,b){function c(a,b,d){a.forEach(function(a){a.items?(d&&b.push(a),c(a.items,b,d)):b.push(a)})}var d=[];return c(a,d,b),d},f.prototype._state=function(){var a=this;a.state=a.state||{};var b=a.form.getState(a.$bind);Object.keys(b).forEach(function(c){a.state[c]=b[c]}),a.state.value=a.form.getValue(a.$bind)},f.prototype._state2UI=function(){},f.prototype.changed=function(a,b,c,d,e){},f.prototype.stateChanged=function(a){},f.prototype._template=function(a){return d.format('<div id="{0}" data-render="{0}"><h5 class="bs-block-title">Choix de colonnes</h5><div data-id="pillbox"></div><h5 class="bs-block-title">Liste de champs</h5><div data-id="multiselect" style="overflow-y:auto;max-height:300px;border: 1px solid #dddddd;"></div></div>',a)},f.prototype.render=function(a){var b=this,d=b._initOptions(c.Utils.defaultOptions);if(!b.$element){b.$element=$(b._template(b.id));var f=b.$element.get(0),g=e.query(f,'div[data-id="pillbox"]'),h=e.query(f,'div[data-id="multiselect"]');b.pillBox.render(g),b.multiSelectList.render(h)}return b.appendElement(a,d),b.$element},f}(b.AbsField));b.ComposantMultiSelect=f,c.registerControl(f,"object",!1,"multiselectlist",null)}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
/// <reference path="../../../typings/index.d.ts" />
/// <reference path="../../js/core/core.ts" />
/// <reference path="../filter-express/filter-express.control.ts" />
var Phoenix;!function(a){var b;!function(b){var c=a.dom,d=b,e=(a.utils,a.locale,function(){function b(a,b){var c=this;c.config=a||{},c.options=b||{},c.data={value:a.value},c.props={},c._defineProps()}return b.prototype._defineProps=function(){var b=this,c=a.utils.defineProperty;c("value",b)},b.prototype._notifyChange=function(a){var b=this;switch(a){case"value":b.update()}},b.prototype.createElement=function(a,b,c){return'<div class="bs-toolbar-item">A</div>'},b.prototype._setEvents=function(){},b.prototype.update=function(){},b.prototype.getValue=function(){},b.prototype.render=function(a){var b=this;return b.$element||(b.$element=$(b.createElement(b.config.id,b.config,b.data.value)),b._setEvents()),a&&c.append(a.get(0),b.$element.get(0)),b.$element},b.prototype.destroy=function(){var a=this;a.$element=null,a.options=null,a.config=null},b}());b.ToolElement=e;var f=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.createElement=function(a,b,d){var e=["bs-button btn btn-default"];b.type&&e.push("btn-"+b.type),b.right&&e.push("pull-right");var f=['<div class="bs-toolbar-item '+(b.right?"pull-right":"")+'">','<button toolClick="'+a+'" type="button" class="'+e.join(" ")+'">',b.icon?'<span class="'+c.iconClass(b.icon)+'" toolClick="'+a+'" ></span>':"",b.title?"&nbsp;"+b.title:"","</button>","</div>"];return f.join("")},b}(e);b.ToolElementButton=f;var g=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.createElement=function(a,b,c){var d=["label label-default form-control-static bs-toolbar-item bs-toolbar-item-count"];b.right&&d.push("pull-right");var e=['<span tool="'+a+'" class="'+d.join(" ")+'">'+c+"</span>"];return e.join("")},b.prototype.update=function(){var a=this;a.$element&&c.text(a.$element.get(0),a.data.value)},b}(e);b.ToolElementCount=g;var h=function(a){function b(b,c){a.call(this,b,c),this.data.value="",this.oldValue=""}return __extends(b,a),b.prototype.createElement=function(a,b,d){var e=[];b.right&&e.push("pull-right");var f=['<div tabindex="'+a+'" class="bs-toolbar-item '+e.join(" ")+'">','<input toolKeyup="'+a+'" type="text" class="form-control" placeholder="'+(b.title||"Recherche")+'" />','<span class="input-group-btn">','<button toolClick="'+a+'" class="bs-button btn btn-default" type="button">','<span toolClick="'+a+'" class="'+c.iconClass(b.icon||"search")+'"> </span>',"</button>","</span>","</div>"];return f.join("")},b.prototype.update=function(){var a=this;if(a.$element){var b=c.query(a.$element.get(0),"input");b&&(b.value=a.data.value)}},b.prototype.getValue=function(){var a=this;return a.oldValue=a._getInputValue(),a.oldValue},b.prototype._getInputValue=function(){var a=this;if(a.$element){var b=c.query(a.$element.get(0),"input");return b?b.value:null}},b.prototype._setEvents=function(){var a=this;if(a.$element){var b=a.$element.get(0);if(b){var d=c.query(b,"input"),e=c.query(b,"button");d.addEventListener("focus",function(a){d.select()}),b.addEventListener("blur",function(b){var c=b.explicitOriginalTarget&&b.explicitOriginalTarget!=e&&null==b.relatedTarget;c=c||(null==b.relatedTarget||b.relatedTarget&&b.relatedTarget!=e)&&void 0==b.explicitOriginalTarget,b.target==d&&c&&(
//if (!that._getInputValue() && that.filtering){
a.data.value=" ",a.props.value=a.oldValue)},!0)}}},b}(e);b.ToolElementSearch=h;var i=function(a){function b(b,c){a.call(this,b,c);var e=this;e.filterExpress=new d.FilterExpress(b.fields||[],function(a){e.options.callback&&e.options.callback({id:b.id,name:b.name,value:d.filter.format.toPhenix(b.fields,[a]),toolData:b})})}return __extends(b,a),b.prototype.createElement=function(a,b,c){var d=[];return b.right&&d.push("pull-right"),'<div class="bs-toolbar-item '+d.join(" ")+'"></div>'},b.prototype.render=function(a){var b=this;return b.$element||(b.$element=$(b.createElement(b.config.id,b.config,b.data.value)),b.filterExpress&&b.filterExpress.render(b.$element)),a&&c.append(a.get(0),b.$element.get(0)),b.$element},b}(e);b.ToolElementFilterExpress=i;var j=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.createElement=function(a,b,d){var e=["bs-button btn btn-default"],f=['<div class="bs-toolbar-item '+(b.right?"pull-right":"")+'">','<button toolClick="'+a+'" type="button" class="'+e.join(" ")+'">',b.icon?'<span toolClick="'+a+'" class="'+c.iconClass(b.icon)+'"></span>':"",b.title?"&nbsp;"+b.title:"","</button>",'<span class="bs-toolbar-item-filter form-control-static bs-cursor-h"></span>',"</div>"];return f.join("")},b.prototype.addTooltip=function(a){var b=this,d=$('<span data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title= "'+a+'"> '+a+" </span>"),e=c.query(b.$element.get(0),".bs-toolbar-item-filter");c.empty(e),c.append(e,d.get(0)),d.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left"></div></div>'})},b.prototype.update=function(){var a=this;a.$element&&a.addTooltip(a.data.value)},b.prototype.render=function(b){a.prototype.render.call(this,b);var c=this;c.addTooltip(c.data.value)},b}(e);b.ToolElementFilter=j;var k=function(){function a(a,b){var c=this;c.options=b||{},c.toolElements=a||{}}return a.prototype.getToolElement=function(a){var b=null;return this.toolElements.forEach(function(c,d){if(d==a||c.name===a)return b=c.$component,!1}),b},a.prototype.setValue=function(a,b){var c=this,d=c.getToolElement(a);d&&(d.props.value=b)},a.prototype.getValue=function(a,b){var c=this,d=c.getToolElement(a);if(d)return d.getValue()},a.prototype._setEvents=function(){function a(a,c){if(c>=0){var d=b.getToolElement(c);if(d&&b.options.selectToolElement){var e=d.getValue();b.options.selectToolElement({id:d.config.id,name:d.config.name,value:e,toolData:d.config},a)}}}var b=this;b.$element&&b.$element.on("click",function(b){var d=c.attr(b.target,"toolClick");null!==d&&a("click",d)}).on("keyup",function(b){if(13==b.keyCode){var d=c.attr(b.target,"toolKeyup");a("keyup",d)}})},a.prototype._removeEvents=function(){var a=this;a.$element&&a.$element.off("click")},a.prototype._renderToolElements=function(a){var b=this;if(a.length){b.$element.get(0);a.forEach(function(a,c){a.id=c;var d=a.type;switch(d.toLowerCase()){case"count":a.$component=new g(a,{callback:b.options.selectToolElement});break;case"filter":a.$component=new j(a,{callback:b.options.selectToolElement});break;case"search":a.$component=new h(a,{callback:b.options.selectToolElement});break;case"filterexpress":a.$component=new i(a,{callback:b.options.selectToolElement});break;default:a.$component=new f(a,{callback:b.options.selectToolElement})}a.$component&&a.$component.render(b.$element)})}},a.prototype.render=function(a){var b=this;return b.$element||(b.$element=$('<div class="form-inline bs-toolbar"></div>'),b._renderToolElements(b.toolElements),b._setEvents()),a&&(b.options.replaceParent?a.replaceWith(b.$element):a.append(b.$element)),b.$element},a.prototype.destroy=function(){var a=this;a._removeEvents(),a.$element=null,a.options=null},a}();b.ToolBar=k}(b=a.ui||(a.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.min.js.map