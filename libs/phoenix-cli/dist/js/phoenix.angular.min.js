angular&&angular.module("phoenix.ui",[]);var Phoenix;!function(e){function o(e){if("string"==typeof e)return e;var o=e.message;return"error"===o&&e.detail&&e.detail.responseText&&(o=e.detail.responseText),o}function n(e){function n(e){var o=window.location.hash,n=o.indexOf("?");n>=0&&(o=o.substr(0,n));o.split("/");var t=e?"/authoring/forms/":"/authoring/";return(n=o.indexOf(t))>=0&&(o=o.substr(n+t.length)),o}e.component.saveHandler=function(t){var r=a.config(a.name),l=a.isCustomizable(e.isform?"forms":"pages",t.name);if(r){var u=l?r.dev:r.current;if(!u)return;var c=e.isform?u.forms:u.pages;if(!c)return;i.rest.put(c+"/"+n(e.isform),t).then(function(e){},function(e){alert(o(e))})}},e.component.loadNestedHandler=function(n,t){var r=a.config(a.name);r&&r.current&&r.current.pages&&r.current.forms&&c.post((e.isform?r.current.forms:r.current.pages)+"/load/nested",n).then(function(e){t&&t(e)},function(e){alert(o(e))})},e.component.createHandler=function(n,t){var i=a.config(a.name),l=n;if(i&&i.current&&i.current.pages&&i.current.forms){t.name=n.split("/").pop();var u=function(e){var o=s.context(),n={$page:l,$authoring:!0};s.execLink(n,o,null)},f=function(a){"Conflict"==a?r.prompt(p.layouts.design.ConflictedPageName,n,function(o){o&&(o=o.trim())&&(o.indexOf(" ")>=0?alert(p.layouts.design.InvalidPageName):(t.name=o.split("/").pop(),l=o,c.post((e.isform?i.current.forms:i.current.pages)+"/"+l,t).then(u,f)))}):alert(o(a))};l=n,c.post((e.isform?i.current.forms:i.current.pages)+"/"+l,t).then(u,f)}},e.component.openHandler=function(e){var o=s.context(),n={$page:e,$authoring:!0};s.execLink(n,o,null)},e.component.removeHandler=function(){var t=n(e.isform),r=a.config(a.name),u=a.isCustomizable(e.isform?"forms":"pages",t);if(r){var c=u?r.dev:r.current;if(!c)return;var p=e.isform?c.forms:c.pages;if(!p)return;i.rest.remove(p+"/"+t).then(function(e){if(l.release)window.location.reload(!0);else{var o=s.context(),n={$page:a.homeName};s.execLink(n,o,null)}},function(e){alert(o(e))})}},e.component.listHandler=function(n){var t=a.config(a.name);t&&t.current&&t.current.pages&&t.current.forms&&c.get(e.isform?t.current.forms:t.current.pages).then(function(e){n(e)},function(e){alert(o(e))})}}if(angular){var t=e,r=t.utils,i=t.data,a=t.application,l=t.build,u=t.ui,c=t.ajax,s=t.link,p=t.locale,f=t.serial,m=angular.module("phoenix.ui");m.controller("uiLayoutController",["$scope",function(e){}]),m.directive("layout",["$compile",function(e){return{scope:{model:"=",isform:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiLayoutController",controllerAs:"layout",link:function(o,t,i){var a=o.$new();o.$on("$destroy",function(){r.log("destroy layout","scope"),o.component.destroy(),o.component=null}),o.isform=!!o.layout.isform;var l={design:a.layout.authoring,path:a.layout.path,replaceParent:!0,context:"angular",beforeAdd:function(n,t){r.log("compile layout","scope"),e(n)(a),t&&f.GlbSerial.execute(function(){o.$digest()})},beforeRemove:function(e){r.log("remove layout","scope"),a.component=null,a.layout=null,a.$destroy(),a=o.$new()}};o.isform?u.OpenForm(t,o.layout.model,o.layout.prototype,{},o.layout.locale&&o.layout.locale.$view?o.layout.locale.$view:o.layout.locale,null,l,function(e){o.component=e,n(o)}):(o.component=new u.LayoutClass(o.layout.model||{},l,{},o.layout.prototype,o.layout.locale&&o.layout.locale.$view?o.layout.locale.$view:o.layout.locale,null),n(o),o.component.render(t))}}}])}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){if(angular){var o=e.utils,n=e.render,t=e.device,r=e.serial,i=e.ui,a=angular.module("phoenix.ui");a.controller("uiWidgetController",["$scope",function(e){}]),a.directive("widget",["$compile",function(e){return{scope:{data:"=",layout:"=",authoring:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiWidgetController",controllerAs:"item",compile:function(n,t){return{pre:function(n,t,a){var l=n.item.data||{};n.component=new i.Widget(l,{design:n.item.authoring,replaceParent:!0,context:"angular",beforeAdd:function(t,i){o.log("compile module","scope"),e(t)(n),i&&r.GlbSerial.execute(function(){n.$digest()})},onDataChanged:function(){r.GlbSerial.execute(function(){n.$digest()})}},n.item.layout),n.component.render(t),n.$on("$destroy",function(){o.log("destroy module","scope"),n.component&&n.component.destroy()})},post:function(e,o,n){}}}}}]);n.register("angular","widget.content",function(e,o,n){e.push("<widget-"+o.$type),e.push(' authoring="'+(n.design?"true":"false")+'"'),e.push(' phone="'+(t.phone?"true":"false")+'"'),e.push(' tablet="'+(t.tablet?"true":"false")+'"'),e.push(" module=component props=component.props links=component.links data=component.props.data.ds></widget-"+o.$type+">")}),n.register("angular","widget",function(e,o,n,t,r){e.push('<widget authoring="'+(r.design?"true":"false")+'" layout=component data=layout.model.fields.'+o.$id+"></widget>")})}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){if(angular){var o=e,n=o.utils,t=angular.module("phoenix.ui");t.controller("uiAuthoringController",["$scope",function(e){}]),t.directive("authoring",[function(){return{scope:{toolbox:"=",isform:"=",model:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiAuthoringController",controllerAs:"item",link:function(e,t,r){var i=o.authoring;i&&(e.isform=!!e.item.isform,e.component=new i.AuthoringEditor({form:!!e.isform,design:!0,replaceParent:!0,context:"angular"},e.item.toolbox),e.component.render(t),e.$on("$destroy",function(){e.component&&(n.log("destroy authoring","scope"),e.component.destroy(),e.component=null)}))}}}])}}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.angular.min.js.map