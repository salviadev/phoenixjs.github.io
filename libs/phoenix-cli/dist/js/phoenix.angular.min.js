angular&&angular.module("phoenix.ui",[]);var Phoenix;!function(a){function b(a){if("string"==typeof a)return a;var b=a.message;return"error"===b&&a.detail&&a.detail.responseText&&(b=a.detail.responseText),b}function c(a){a.component.saveHandler=function(c){var d=g.config(g.name),e=g.isCustomizable(a.isform?"forms":"pages",c.name);if(d){var h=e?d.dev:d.current;if(!h)return;var i=a.isform?h.forms:h.pages;if(!i)return;f.rest.put(i+"/"+c.name,c).then(function(a){},function(a){alert(b(a))})}},a.component.loadNestedHandler=function(c,d){var e=g.config(g.name);e&&e.current&&e.current.pages&&e.current.forms&&j.post((a.isform?e.current.forms:e.current.pages)+"/load/nested",c).then(function(a){d&&d(a)},function(a){alert(b(a))})},a.component.createHandler=function(c,d){var f=g.config(g.name);if(f&&f.current&&f.current.pages&&f.current.forms){d.name=c;var h=function(a){var b=k.context(),c={$page:a.name,$authoring:!0};k.execLink(c,b,null)},i=function(c){"Conflict"==c?e.prompt(l.layouts.design.ConflictedPageName,d.name,function(b){if(b&&(b=b.trim())){if(b.indexOf(" ")>=0)return void alert(l.layouts.design.InvalidPageName);d.name=b,j.post((a.isform?f.current.forms:f.current.pages)+"/"+d.name,d).then(h,i)}}):alert(b(c))};j.post((a.isform?f.current.forms:f.current.pages)+"/"+d.name,d).then(h,i)}},a.component.openHandler=function(a){var b=k.context(),c={$page:a,$authoring:!0};k.execLink(c,b,null)},a.component.removeHandler=function(c){var d=g.config(g.name),e=g.isCustomizable(a.isform?"forms":"pages",c);if(d){var i=e?d.dev:d.current;if(!i)return;var j=a.isform?i.forms:i.pages;if(!j)return;f.rest.remove(j+"/"+c).then(function(a){if(h.release)window.location.reload(!0);else{var b=k.context(),c={$page:"home"};k.execLink(c,b,null)}},function(a){alert(b(a))})}},a.component.listHandler=function(c){var d=g.config(g.name);d&&d.current&&d.current.pages&&d.current.forms&&j.get(a.isform?d.current.forms:d.current.pages).then(function(a){c(a)},function(a){alert(b(a))})}}if(angular){var d=a,e=d.utils,f=d.data,g=d.application,h=d.build,i=d.ui,j=d.ajax,k=d.link,l=d.locale,m=d.serial,n=angular.module("phoenix.ui");n.controller("uiLayoutController",["$scope",function(a){}]),n.directive("layout",["$compile",function(a){return{scope:{model:"=",isform:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiLayoutController",controllerAs:"layout",link:function(b,d,f){var g=b.$new();b.$on("$destroy",function(){e.log("destroy layout","scope"),b.component.destroy(),b.component=null}),b.isform=!!b.layout.isform;var h={design:g.layout.authoring,path:g.layout.path,replaceParent:!0,context:"angular",beforeAdd:function(c,d){e.log("compile layout","scope"),a(c)(g),d&&m.GlbSerial.execute(function(){b.$digest()})},beforeRemove:function(a){e.log("remove layout","scope"),g.component=null,g.layout=null,g.$destroy(),g=b.$new()}};b.isform?i.OpenForm(d,b.layout.model,b.layout.prototype,{},b.layout.locale&&b.layout.locale.$view?b.layout.locale.$view:b.layout.locale,null,h,function(a){b.component=a,c(b)}):(b.component=new i.LayoutClass(b.layout.model||{},h,{},b.layout.prototype,b.layout.locale&&b.layout.locale.$view?b.layout.locale.$view:b.layout.locale,null),c(b),b.component.render(d))}}}])}}(Phoenix||(Phoenix={}));var Phoenix;!function(a){if(angular){var b=a.utils,c=a.render,d=a.device,e=a.serial,f=a.ui,g=angular.module("phoenix.ui");g.controller("uiWidgetController",["$scope",function(a){}]),g.directive("widget",["$compile",function(a){return{scope:{data:"=",layout:"=",authoring:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiWidgetController",controllerAs:"item",compile:function(c,d){return{pre:function(c,d,g){var h=c.item.data||{};c.component=new f.Widget(h,{design:c.item.authoring,replaceParent:!0,context:"angular",beforeAdd:function(d,f){b.log("compile module","scope"),a(d)(c),f&&e.GlbSerial.execute(function(){c.$digest()})},onDataChanged:function(){e.GlbSerial.execute(function(){c.$digest()})}},c.item.layout),c.component.render(d),c.$on("$destroy",function(){b.log("destroy module","scope"),c.component&&c.component.destroy()})},post:function(a,b,c){}}}}}]);var h=function(a,b,c,d,e){a.push('<widget authoring="'+(e.design?"true":"false")+'" layout=component data=layout.model.fields.'+b.$id+"></widget>")},i=function(a,b,c){a.push("<widget-"+b.$type),a.push(' authoring="'+(c.design?"true":"false")+'"'),a.push(' phone="'+(d.phone?"true":"false")+'"'),a.push(' tablet="'+(d.tablet?"true":"false")+'"'),a.push(" module=component props=component.props links=component.links data=component.props.data.ds></widget-"+b.$type+">")};c.register("angular","widget.content",i),c.register("angular","widget",h)}}(Phoenix||(Phoenix={}));var Phoenix;!function(a){if(angular){var b=a,c=b.utils,d=angular.module("phoenix.ui");d.controller("uiAuthoringController",["$scope",function(a){}]),d.directive("authoring",[function(){return{scope:{toolbox:"=",isform:"=",model:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiAuthoringController",controllerAs:"item",link:function(a,d,e){var f=b.authoring;f&&(a.isform=!!a.item.isform,a.component=new f.AuthoringEditor({form:!!a.isform,design:!0,replaceParent:!0,context:"angular"},a.item.toolbox),a.component.render(d),a.$on("$destroy",function(){a.component&&(c.log("destroy authoring","scope"),a.component.destroy(),a.component=null)}))}}}])}}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.angular.min.js.map