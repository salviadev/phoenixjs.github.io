var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){!function(e){var t=function(){function e(){this._eventList=[]}return e.prototype.execute=function(e){this._eventList.push(e),this._execute()},e.prototype._execute=function(){if(!this._inExec){this._inExec=!0;try{for(;this._eventList.length;){var e=this._eventList.shift();try{e()}catch(e){}}}finally{this._inExec=!1}}},e}();e.Serial=t;var i=function(){function e(e,t,i,n,s){var o=this;o.ondispose=s,o.promise=t,o.resolve=i,o.errorhandler=n,o.dataHandler=o.ondata.bind(o),e?o.timer=window.setTimeout(o._execute.bind(o),e):o._execute()}return e.prototype.ondata=function(e){var t=this.resolve;this.destroy(),t&&t(e)},e.prototype.onerror=function(e){var t=this.errorhandler;this.destroy(),t&&t(e)},e.prototype._execute=function(){var e=this;e.promise&&e.promise.then?e.promise.then(e.dataHandler,e.onerror.bind(e)):e.promise&&"function"==typeof e.promise?e.dataHandler(e.promise()):e.dataHandler(e.promise)},e.prototype._cleaTimeout=function(){this.timer&&(window.clearTimeout(this.timer),this.timer=0)},e.prototype.destroy=function(){this.resolve=null,this.errorhandler=null,this._cleaTimeout(),this.promise=null;var e=this.ondispose;this.ondispose=null,e&&e(this)},e}(),n=function(){function e(e){this.defaultDelay=0;this.defaultDelay=e,this._error=this._errorHandler.bind(this),this._dispose=this._onEventDisposed.bind(this)}return e.prototype._errorHandler=function(e){this.onError&&this.onError(e)},e.prototype.clear=function(){this.currentEvent&&(this.currentEvent.destroy(),this.currentEvent=null)},e.prototype._onEventDisposed=function(e){this.currentEvent=null},e.prototype.push=function(e,t,n){this.clear();var s=n?0:this.defaultDelay;this.currentEvent=new i(s,e,t,this._error,this._dispose)},e.prototype.destroy=function(){this.clear()},e}();e.SingleEventBus=n,e.GlbSerial=new t}(e.serial||(e.serial={}))}(Phoenix||(Phoenix={}));!function(e){!function(e){var t=function(){return window.Promise||(window.ES6Promise?window.ES6Promise.Promise:null)},i=function(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t},n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[0].replace(/{(\d+)}/g,function(t,i){return i=parseInt(i,10),e[i+1]})},s=function(e,t){if(e)for(var i in e){var n=e[i];t[i];null===n||"object"!=typeof n||Array.isArray(n)?t[i]=n:(t[i]=t[i]||{},s(n,t[i]))}},o={scope:!1,destroy:!1,menu:!1,proxydata:!1},r=function(e,t){if(!e&&t||!t&&e)return!1;if(e===t)return!0;if(!e&&!t)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var i=0,n=e.length;i<n;i++)if(!r(e[i],t[i]))return!1;return!0}if("object"==typeof e){if(typeof e!=typeof t)return!1;var s=Object.keys(e),o=Object.keys(t);if(s.length!==o.length)return!1;for(var a=0,l=s.length;a<l;a++)if(!r(e[s[a]],t[s[a]]))return!1;return!0}return!1},a=function(e,t,i){var n=Object.keys(e),s=Object.keys(t);n.forEach(function(n){var o=e[n],l=s.indexOf(n);if(l>=0){s.splice(l,1);var u=t[n];if(u===o)return;null===u?i[n]=null:null===o?i[n]=u:Array.isArray(o)?r(o,u)||(i[n]=u):"object"==typeof o?r(o,u)||(i[n]={},a(o,u,i[n])):i[n]=u}else i[n]=null}),s.forEach(function(e){i[e]=t[e]})},l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},u=!1,c=function(e,t,i){if(e.indexOf(".")>=0){var n=t;return e.split(".").forEach(function(e){n&&(n=n[e])}),(n||"")+""}return void 0===t[e]?i?e:"":t[e]},d=function(e,t){switch(e){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"firstChar":return t&&t.length?t[0]:""}return t};e.Promise=t(),e.allocUuid=function(){return i(!1)+i(!0)+i(!0)+i(!1)},e.allocID=function(){return"I"+i(!1)+i(!1)+i(!1)+i(!1)},e.format=n,e.merge=s,e.formatNames=function(e,t){return e.replace(/{([^{]*)}/g,function(e,i){for(var n=i.split("."),s=t;n.length&&(s=s[n.shift()]););return s||""})},e.extend=function(e,t){return e=e||{},Object&&Object.assign?Object.assign(e,t):(Object.keys(t).forEach(function(i){e[i]=t[i]}),e)},e.logModule=function(e,t){return void 0!==t&&(o[e]=t),o[e]},e.log=function(e,t){o&&o[t]&&console.log(e)},e.equals=r,e.copy=function(e){var t={};for(var i in e)t[i]=e[i];return t},e.deltaPatch=function(e,t){var i={};return a(e,t,i),Object.keys(i).length?i:null},e.isNull=function(e){return null===e},e.isUndefined=function(e){return void 0===e},e.isNullOrUndefined=function(e){return null===e||void 0===e},e.logRule=function(e,t,i,s){if(u){e=(e||1)-1;var o=new Array(e).join("  ");"string"==typeof t?console.log(n('{0}{1}".',o,t)):console.log(n('{0} {4} Rule: "{1} - {2}", triggered by "{3}".',o,t.name,t.description,i,s))}},e.showRules=function(e){return void 0!==e&&(u=e),u},e.escapeHtml=function(e){return(e||"").replace(/[&<>"'\/]/g,function(e){return l[e]})},e.phoenixPath=function(){for(var e=document.getElementsByTagName("script"),t=e.length-1;t>=0;--t){var i=e[t].src.split("?")[0].split("/"),n=i.length,s=i[n-1].toLowerCase();if("phoenix.js"==s||"phoenix.min.js"==s||"core.js"==s&&"core"==i[n-2]){var o=n-1;return"core.js"==s&&o--,i.slice(0,o).join("/")}}throw"Invalid script Name"},e.parseExpression=function(e,t){return e.replace(/{{([^{]*)}}/g,function(e,i){return c(i,t,!1)})},e.hasExpression=function(e){return(e||"").indexOf("{{")>=0},e.parseVariable=function(e,t){return c(e,t,!0)},e.defineProperty=function(e,t){var i=t||this;Object.defineProperty(i.props,e,{get:function(){return i.data[e]},set:function(t){t!=i.data[e]&&(i.data[e]=t,i._notifyChange(e))},enumerable:!0})},e.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(i){e.prototype[i]=t.prototype[i]})})},e.nextTick=window.setImmediate?function(e){setImmediate(function(){e()})}:function(e){setTimeout(function(){e()},0)},e.focusDelay=function(e){setTimeout(function(){e()},30)},e.dataAsPromise=function(e){return t().resolve(e)},e.extractAngularVars=function(e,t){return e.replace(/\{\{([^{]*)\}\}/g,function(e,i){return t.push({name:i.split("|")[0].trim()}),""}),t.length>0},e.execAngularExpression=function(e,t,i){return e.replace(/\{\{([^{]*)\}\}/g,function(e,n){for(var s=n.split("|"),o=(s[0]||"").trim(),r=i?t[o]:c(o,t,!1),a=1,l=s.length;a<l;a++)r=d((s[a]||"").trim(),r);return r})},e.confirm=function(e,t,i,n){window.confirm(t)?i():n&&n()},e.alert=function(e,t,i){window.alert(t)},e.prompt=function(e,t,i){i(window.prompt(e,t))},e.cleanUpObject=function(e){Object.keys(e).forEach(function(t){e[t]=null})},e.getValue=function(e,t){var i=t.split(".");if(1===i.length)return e?e[t]:void 0;for(var n=e,s=null,o=0,r=i.length;o<r;o++){if(!(s=n[i[o]]))return s;n=s}return s}}(e.utils||(e.utils={})),function(){var e=Array.prototype;e.find||(e.find=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i,n=Object(this),s=n.length>>>0,o=(t=arguments[1],0);o<s;o++)if(i=n[o],e.call(t,i,o,n))return i}),e.findIndex||(e.findIndex=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i,n=Object(this),s=n.length>>>0,o=(t=arguments[1],0);o<s;o++)if(i=n[o],e.call(t,i,o,n))return o;return-1})}()}(Phoenix||(Phoenix={}));(Phoenix||(Phoenix={})).locale={};!function(e){!function(e){var t={};e.register=function(e,i){for(var n=e.split("."),s=t,o=0,r=n.length-1;o<r;o++){var a=n[o];s[a]=s[a]||{},s=s[a]}s[n[n.length-1]]=i},e.unregister=function(e,i){for(var n=e.split("."),s=t,o=0,r=n.length-1;o<r;o++){var a=n[o];if(!s[a])return;s[a]=s[a]||{},s=s[a]}s[n[n.length-1]]=null},e.get=function(e){for(var i=e.split("."),n=t,s=null,o=0,r=i.length;o<r;o++){if(!(s=n[i[o]]))return s;n=s}return s}}(e.customData||(e.customData={}))}(Phoenix||(Phoenix={}));!function(e){e.device={phone:!1,tablet:!1,deviceType:""};var t=function(e){e=e||{};try{window.sessionStorage&&window.sessionStorage.setItem("$mem",JSON.stringify(e))}catch(e){}};e.$mem=function(){try{if(window.sessionStorage)return JSON.parse(window.sessionStorage.getItem("$mem"))||{}}catch(e){return{}}}();e.save$mem=function(){t(e.$mem)};e.sessionPreferences=function(e,t){var i=null;try{i=JSON.parse(window.sessionStorage.getItem("preferences"))}catch(e){}if(void 0===t)return i?i[e]:void 0;(i=i||{})[e]=t;try{window.sessionStorage.setItem("preferences",JSON.stringify(i))}catch(e){}};e.preferences=function(e,t){var i=null;try{i=JSON.parse(window.localStorage.getItem("preferences"))}catch(e){}if(void 0===t)return i?i[e]:void 0;(i=i||{})[e]=t;try{window.localStorage.setItem("preferences",JSON.stringify(i))}catch(e){}},e.build={version:"0.1.0.0",release:!1,authMode:"dev"}}(Phoenix||(Phoenix={}));!function(e){e.build;!function(e){var t={},i={setItem:function(e,i){t[e]=i},getItem:function(e){return t[e]}},n=[],s=function(){var e=null;try{e=window.localStorage}catch(t){e=null}return e||(e=i),e};e.db=s,e.save=function(e,t){t||(e.basic="Basic "+window.btoa((e.login||"")+":"+(e.password||""))),s().setItem("authentication",JSON.stringify(e))},e.load=function(){try{return JSON.parse(s().getItem("authentication"))}catch(e){return null}},e.clear=function(){s().setItem("authentication","null"),n.forEach(function(e){e()})},e.registerAfterLogout=function(e){n.push(e)}}(e.authentication||(e.authentication={}))}(Phoenix||(Phoenix={}));!function(e){!function(e){var t={},i=function(e,i){return t[e]=i,i},n=function(e){return t[e]};e.core="phoenix",e.name="",e.support="",e.homeName="home",e.title="",e.licences={},e.configuration=null,e.useJSONPatch=!1;function s(t,s){return t=t||e.name,void 0==s?n("application_"+t):i("application_"+t,s)}e.config=s;e.init=function(t,i,n){if(e.name=t,e.title=i,n&&n.homes&&n.homes[t]&&(e.homeName=n.homes[t]),e.configuration=n,angular){var s=n?n.angularModules||[]:[];Array.isArray(s)||"object"!=typeof s||(s=s[t]||[]),e.angularApplication=angular.module(t,s)}};function o(){return e.configuration&&e.configuration.portailName?e.configuration.portailName:"portail"}e.portailName=o;e.isPortail=function(){return e.name===o()};e.isCustomizable=function(t,i){var n=s(e.name);return!(!n||!n.customizable)&&(i.indexOf(".json")<0&&(i+=".json"),n.customizable.indexOf([t,e.name,i].join("/"))>=0)}}(e.application||(e.application={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.utils,n=e.application,s=e.customData,o=e.authentication,r=e.locale,a={},l=function(e){var t=a["s"+e];return!(!t||t.disabled)&&(t.handlers.forEach(function(e){e()}),!0)},u=function(e){var t=null;if(e.responseText&&(t={responseText:e.responseText}),e.responseJSON)if(t=t||{},"object"==typeof e.responseJSON)t.json=e.responseJSON;else try{t.json=JSON.parse(e.responseJSON)}catch(e){}return t},c=function(e,t,n,s){var o=i.Promise;t&&":"===t.charAt(0)&&(t=location.protocol+"//"+location.hostname+t);var a={type:e,contentType:"application/json",accept:"application/json",url:t,data:null};return s&&s.headers&&(a.headers=s.headers,a.headers.contentType&&(a.contentType=a.headers.contentType)),n&&a.contentType.indexOf("application/json")>=0?a.data=JSON.stringify(n):a.data=n,new o(function(e,t){$.ajax(a).done(function(t,i,n){e(t)}).fail(function(i,n,o){if(s&&s.ignore&&s.ignore[""+i.status])return e({});if(l(i.status))return e({});i.status>=500&&r&&r.errors&&(n=r.errors.error500,o=null);var a=u(i);a&&(o=null);var c=null;o&&(c="string"==typeof o?{message:o}:o),(c=c||{message:n,detail:a}).status=i.status,t(c)})})},d={},p=function(e){if(!e){var t=n.config(n.name);e=t?t.odata:null}var i={headers:null};if(e&&e.headers&&(i.headers=e.headers),i.headers=i.headers||{},i.headers.Accept="application/json",e&&e.authentication){var s=o.load();if(s)switch(e.authentication){case"basic":i.headers.Authorization=s.basic;break;case"header-session":i.headers.Authorization="Bearer "+s.token}else delete i.headers.Authorization}return i},h=function(e,t,i,n){var s=d[e];if(s){if(s.loaded)return i(null);if(s.error)return i(s.error,null);window.setTimeout(function(){h(e,t,i,n)},20)}else d[e]={loading:!0},n?n.execute(function(t){d[e]=t?{error:t}:{loaded:!0},i(t)}):$.ajax({url:t,dataType:"script",cache:!0}).done(function(t,n,s){d[e]={loaded:!0},i(null)}).fail(function(t,n,s){var o=s||{message:n};d[e]={error:o},i(o)})};t.extractAjaxErrors=function(e){var t={message:"",list:[]};e&&"object"!=typeof e&&(e={message:e}),e=e||{},t.status=e.status,e.message=e.message||r.errors.unknownError;var i;if(e.detail)if(e.detail.json&&e.detail.json.error){var n=e.detail.json.error,s=void 0;if(void 0!==n.details&&(s=n),i=n.message,n.innererror&&n.innererror.message&&"Json"===n.innererror.type&&(s=JSON.parse(n.innererror.message)),s)return t.message=s.message,s.details&&s.details.forEach(function(e){t.list.push({message:e.message,target:e.target})}),t}else i=e.detail.json&&e.detail.json.exceptionMessage?e.detail.json.exceptionMessage:e.detail.responseText;return t.message=i||e.message,t},t.get=function(e,t,n){e&&":"===e.charAt(0)&&(e=location.protocol+"//"+location.hostname+e),!n&&(o=t,o&&"function"==typeof o)&&(n=t,t=null);var o,a={type:"GET",url:e,dataType:"json",accept:"application/json"},c=null;t&&(c=t.$errors,delete t.$errors,Object.keys(a).forEach(function(e){t[e]=a[e]}),a=t);return new(0,i.Promise)(function(e,i){$.ajax(a).done(function(t,i,s){n&&(t=n(t)),e(t)}).fail(function(n,o,a){if(t&&t.ignore&&t.ignore[""+n.status])return e({});if(c&&c[n.status+""]){var d=n.status+"";if("string"!=typeof c[d])return e(c[d]);var p=s.get(c[d]);p&&e(p())}if(l(n.status))return e({});n.status>=500&&r&&r.errors&&(o=r.errors.error500,a=null);var h=u(n);h&&(a=null);var f=null;a&&(f="string"==typeof a?{message:a}:a),(f=f||{message:o,detail:h}).status=n.status,f._ajax=!0,"error"===f.message&&f.detail&&f.detail.responseText&&(f.message=f.detail.responseText),i(f)})})},t.getScript=function(e){return new(0,i.Promise)(function(t,i){$.ajax({url:e,dataType:"script",cache:!0}).done(function(e,i,n){t(!0)}).fail(function(e,t,n){i(n||{message:t})})})},t.getDefaultAjaxOptions=p,t.put=function(e,t,i){return c("PUT",e,t,i)},t.patch=function(e,t,i){return c("PATCH",e,t,i)},t.post=function(e,t,i){return c("POST",e,t,i)},t.remove=function(e,t){return c("DELETE",e,null,t)},t.postAndDownload=function(e,t){var s=i.Promise,o=p(null),a=n.config(n.name)||{},u=a.rest?a.rest.base||"":"";return e&&"/"===e.charAt(0)&&(u=""),u&&(e=u+"/"+e),new s(function(i,n){var s=function(e){var t=e.statusText;if(l(e.status))return i({});e.status>=500&&r&&r.errors&&(t=r.errors.error500),n({message:t,detail:null})},a=new XMLHttpRequest;a.open("POST",e,!0),a.responseType="arraybuffer",a.onload=function(){if(200===this.status||201===this.status){var e="",t=a.getResponseHeader("Content-Disposition");if(t&&-1!==t.indexOf("attachment")){var o=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);null!=o&&o[1]&&(e=o[1].replace(/['"]/g,""))}var r=a.getResponseHeader("Content-Type");try{var l=new Blob([this.response],{type:r})}catch(e){return n(e)}if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(l,e),i({});else{var u=window.URL||window.webkitURL,c=u.createObjectURL(l);if(e){var d=document.createElement("a");void 0===d.download?window.location.href=c:(d.href=c,d.download=e,document.body.appendChild(d),d.click(),document.body.removeChild(d))}else window.location.href=c;setTimeout(function(){u.revokeObjectURL(c),i({})},300)}}else s(this)},a.onerror=function(){s(a)},a.setRequestHeader("Content-type","application/json"),o&&o.headers&&Object.keys(o.headers).forEach(function(e){a.setRequestHeader(e,o.headers[e])}),a.send(JSON.stringify(t))})},t.addAuthToUrl=function(e){var t=n.config(n.name);if(t&&t.odata&&t.odata.authentication){var i=o.load();if(i)switch(t.odata.authentication){case"basic":break;case"header-session":var s="token="+encodeURIComponent(i.token);e+=s=e.indexOf("?")>0?"&"+s:"?"+s}}return e},t.loadScript=h,t.interceptError=function(e,t){var i="s"+e;if("s401"!==i||!function(){var e=n.configuration;return e&&e.authentication&&e.authentication.autoLogon&&e.authentication.autoLogon.force}()){var s=a[i]||{disabled:!1,handlers:[]};s.handlers.push(t),a[i]=s}},t.activateInterceptError=function(e,t){var i=a["s"+e];i&&(i.disabled=!t)}}(e.ajax||(e.ajax={}))}(Phoenix||(Phoenix={}));!function(e){var t,i=e,n=i.locale,s=i.utils,o=i.ajax;!function(t){var i=[],r=function(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e},a=function(e,t){t=r(t,2);var i=Math.pow(10,t);return(Math.round(e*i)/i).toFixed(t)},l=function(e,t,i,n){if(null===e)return"";var s=r(t,0),o=e<0?"-":"",l=parseInt(a(Math.abs(e||0),s),10)+"",u=l.length>3?l.length%3:0;return o+(u?l.substr(0,u)+i:"")+l.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+i)+(s?n+a(Math.abs(e),s).split(".")[1]:"")},u=function(e,t,i,n,s,o){return null===e?"":(o=o||"%v %s").replace("%s",s).replace("%v",l(e,t,i,n))},c=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},d=function(e,t){for(var i=e+"";i.length<t;)i="0"+e;return i},p=function(e,t){var i=e.getDate(),s=e.getDay(),o=e.getMonth(),r=e.getFullYear(),a=e.getHours(),l=e.getMinutes(),u={d:i,dd:d(i,2),ddd:n.date.weekdaysShort[s],dddd:n.date.weekdays[s],m:o+1,mm:d(o+1,2),mmm:n.date.monthsShort[o],mmmm:n.date.months[o],yy:(r+"").slice(2),yyyy:r,H:a+"",HH:d(a,2),h:(a>12?a-12:a)+"",hh:d(a>12?a-12:a,2),M:l+"",MM:d(l,2),A:a>12?"PM":"AM"};return t.replace(/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTtA])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,function(e){return e in u?u[e]:e.slice(1,e.length-1)})},h=function(e){var t=n.date.dateShort.split("/");if(3!==t.length)return"";var i=(e||"").split(n.date.daySep),s=[0,0,0],o="";t.forEach(function(e,t){var n=0;"m"===e.charAt(0)?n=1:"y"===e.charAt(0)&&(n=2);var r=i[t]||"";if(2===t){var a=r.indexOf(" ");a>0&&(o=r.substr(a+1).trim(),r=r.substr(0,a))}s[n]=parseInt(r,10),2==n&&s[n]<100&&r.length<3&&(s[n]+=100*Math.round((new Date).getFullYear()/100))});var r={d:s[0],m:s[1],y:s[2],H:0,M:0,S:0};if(o){var a=n.date.shortTime.split(" "),l=o.split(" "),u=!1;a.length<=2&&l.length===a.length&&(2===a.length&&(u="PM"===l[1]),(l=l[0].split(":")).length>=2&&(r.H=parseInt(l[0],10),r.M=parseInt(l[1],10),l.length>2&&(r.S=parseInt(l[2],10)),u&&r.H<12&&(r.H=r.H+12)))}return r},f=function(e){var t=h(e),i=d(t.y,4)+"-"+d(t.m,2)+"-"+d(t.d,2),n=Date.parse(i);if(isNaN(n))return"";var s=new Date(i);return s.setHours(t.H),s.setMinutes(t.M),s.setSeconds(t.S),s.setMilliseconds(0),s.toISOString()},m=function(e){if(!e)return"";var t=c(e);if(!t)return"";var i=n.date.dateShort;return"/"!==n.date.daySep&&(i=i.replace(/\//g,n.date.daySep)),p(t,i+" "+n.date.shortTime)},v=function(e){if(!e)return"";var t=c(e);if(!t)return"";var i=n.date.dateShort;return"/"!=n.date.daySep&&(i=i.replace(/\//g,n.date.daySep)),p(t,i)},g=function(e,t){return e=e||0,t?u(e,n.number.places,n.number.thousand,n.number.decimal,n.number.symbol,n.number.format):l(e,n.number.places,n.number.thousand,n.number.decimal)},y=function(e,t,i){if(null===e)return"";e=e||0;var s=i?"%v %s":"%v";return u(e,t,n.number.thousand,n.number.decimal,i,s)},_=function(e,t,i,n){var s=e[t],o=e[i],r=e[n],a=new Date(r,o-1,s);return a.getFullYear()==r&&a.getMonth()+1==o&&a.getDate()==s};t.register=function(e){i.push(e)},t.translate=function(e,t){$.extend(!0,n,e),i.forEach(function(e){e(t)})},t.tt=function(e,t){return t=t||{},e&&"{{"==e.substring(0,2)?e.replace(/{{(.*)}}/g,function(e,i){for(var n=i.split("."),s=t,o=0,r=n.length;o<r&&s;o++)s=s[n[o]];return void 0===s?"["+i+"]":s}):e},t.currentLang="en",t.defCountry="US",t.lang="fr",t.country="FR",t.money=g,t.truncMoney=function(e){return parseFloat(e.toFixed(n.number.decimal))},t.decimal=y,t.integer=function(e){return(e||0)+""},t.format=function(e,t){if(!e||!t)return t;var i=[];if(Object.keys(e).forEach(function(t){var n=e[t];"date"!==n.type&&"money"!==n.type&&"decimal"!==n.type&&"number"!==n.type||i.push({name:t,type:n.type,symbol:n.symbol,longdate:n.longdate,decimals:n.decimals,useSymbol:void 0===n.useSymbol||n.useSymbol})}),!i.length)return t;return(Array.isArray(t)?t:[t]).forEach(function(e){i.forEach(function(t){switch(t.type){case"date":e[t.name]=v(e[t.name]);break;case"money":e[t.name]=g(e[t.name],t.useSymbol);break;case"integer":e[t.name]=y(e[t.name],0,t.symbol);break;case"decimal":case"number":e[t.name]=y(e[t.name],t.decimals,t.symbol)}})}),t},t.parseISODate=c,t.parseISODateAsUTC=function(e){return e?Date.UTC(parseInt(e.substr(0,4),10),parseInt(e.substr(5,2),10)-1,parseInt(e.substr(8,2),10),0,0,0):0},t.parseISODateTime=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},t.isoDatePart=function(e){var t=e||"",i=t.indexOf("T");return i>0&&(t=t.substr(0,i)),t},t.shortDateTime=m,t.shortDate=v,t.longDate=function(e){if(!e)return"";var t=c(e);if(!t)return"";var i=n.date.dateLong;return"/"!=n.date.daySep&&(i=i.replace(/\//g,n.date.daySep)),p(t,i)},t.monthYear=function(e){if(!e)return"";var t=c(e);if(!t)return"";var i=n.date.monthYear;return"/"!=n.date.daySep&&(i=i.replace(/\//g,n.date.daySep)),p(t,i)},t.localeDate2ISO=function(e){var t=h(e),i=d(t.y,4)+"-"+d(t.m,2)+"-"+d(t.d,2),n=Date.parse(i);return isNaN(n)?"":i},t.localeDateTime2ISO=f,t.date2ISO=function(e){var t=e.getFullYear(),i=e.getMonth()+1,n=e.getDate();return d(t,4)+"-"+d(i,2)+"-"+d(n,2)},t.string2Float=function(e){var t=e.replace(new RegExp(n.number.thousand,"g"),"");"."!=n.number.decimal&&(t=t.replace(new RegExp(n.number.decimal,"g"),"."));var i=parseFloat(t);return isNaN(i)&&(i=0),i},t.tryParseDate=function(t){var i=e.locale.date.daySep,s=t.split(i);if(3!==s.length)return"";for(var o=0;o<3;o++)s[o]=parseInt(s[o],10);var r=0,a=0,l=0;switch(n.date.dateShort){case"dd/mm/yyyy":r=0,a=1,l=2;break;case"mm/dd/yyyy":r=1,a=0,l=2;break;case"yyyy/mm/dd":r=2,a=1,l=0}return s[l]<100&&(s[l]+=2e3),_(s,r,a,l)?(s[r]=d(s[r],2),s[a]=d(s[a],2),s[l]=d(s[l],4),s.join(n.date.daySep)):""},t.tryParseDateTime=function(e){var t=f(e);return t?m(t):""},t.localeTitle=function(e){return"object"==typeof e?e[t.currentLang]:e};function b(e){var i=s.phoenixPath();e!=t.currentLang&&o.getScript(i+"/locale/phoenix_"+t.lang+".min.js").then(function(){t.currentLang=e}).catch(function(e){})}t.loadLocale=b,["en","fr"].indexOf(t.lang)<0&&(t.lang=t.currentLang),b(t.lang)}(t=e.ulocale||(e.ulocale={}));(e.angularjs||(e.angularjs={})).registerFilters=function(e){e&&e.filter&&(e.filter("money",[function(){return function(e,i){var n=null===e?null:e?parseFloat(e):0;return t.money(n,i)}}]),e.filter("decimal",[function(){return function(e,i,n){var s=null===e?null:e?parseFloat(e):0;return t.decimal(s,i||0,n)}}]),e.filter("shortdate",[function(){return function(e){return t.shortDate(e)}}]),e.filter("longdate",[function(){return function(e){return t.longDate(e)}}]),e.filter("monthyear",[function(){return function(e){return t.monthYear(e)}}]))}}(Phoenix||(Phoenix={}));(Phoenix||(Phoenix={})).ulocale.translate({layouts:{design:{Save:"Save",New:"New page",Open:{title:"Open page",open:"Open",close:"Close"},PageName:"Page Name",InvalidPageName:"Invalid page name",ConflictedPageName:"A page of that name exists, do you want to give another name ?",Delete:"Delete page",DeletePreferences:"Delete preferences",ConfirmDelete:"Are you sure you want to delete this page ?",ConfirmDeletePrefs:"Are you sure you want to delete preferences for this page ?",Preview:"Preview",AuthoringMode:"Authoring",layouts:"Blocks",widgets:"Widgets",fields:"Fields",actions:"Actions",properties:"Properties",childrenFlow:"Children disposition",childrenFlowVertical:"Vertical Flow",childrenTableCell:"Table cell",childrenAccordionGroup:"Accordion Group",customStyle:"Custom style",nestedLayoutName:"Nested Layout Name",nestedLayoutBind:"Bind for nested layout",nestedFormController:"Controller for nested form",columnSize:"Size",customColumnSize:"Custom Size",appearance:"Appearance",appearanceAccordion:"Accordion",appearanceTabs:"Tabs",appearanceWizard:"None",showTitle:"Show title",bindPagesTitle:"Bind",name:"Name",forceDisplayTable:"Force display(Css) table",title:"Title",actionApply:"Apply",formType:"Form Type",ftVertical:"Vertical Form",ftHorizontal:"Horizontal Form",ftInline:"Inline form",labelSize:"Label width (Bootstrap cols)",blockPosition:"Position",bpStatic:"Static",bpStickyTop:"Sticky Top",bpStickyBottom:"Sticky Bottom",noTitlesForFields:"Don't show field's titles",fieldsTitle:"Children (Fields)"},defaultTitle:"No title",NoData:"No data"},schema:{required:"{0} is required.",minNumber:"{0} must be at least {1}",maxNumber:"{0} cannot exceed {1}",minNumberExclusive:"{0} must be greater than {1}",maxNumberExclusive:"{0} must be less than {1}",uniqueColumn:"The column '{0}' must be unique.",uniqueColumns:"Duplicate value for columns '{0}' found.",passwordMismatch:"Password mismatch.",invalidEmail:"Invalid Email Address",minLength:"{0} must be at least {1} characters"},ui:{Close:"Close",Ok:"Ok",Yes:"Yes",No:"No",false:"False",true:"True",Warning:"Warning",Info:"Information",Disconnect:"Disconnect",Confirm:"Confirm",Validate:"Validate",Create:"create",password:{oldPassword:"Old Password",newPassword:"New Password",change:"Change password"},ApplyDetailChanges:"Apply",Selected:"Sel.",Add:"Add",selectedFilters:"Selected filters",OpenNewTab:"Open link in new tab",Search:"Search",Actions:"Actions"},errors:{Title:"Oops! An unknown error has occurred.",SendMail:"Send",MailSubject:"Error in JS client",ErrorTitle:"Error:",ErrorUser:"User:",ErrorDate:"Date and time:",Browser:"Browser:",ErrorURI:"Address:",Stack:"Call stack:",Context:"Context:",error500:"Internal server error",unknownError:"An unknown error has occurred.",notAuthorized:"Forbidden"},listView:{search:{Search:"Search",Nodata:"Aucun résultat trouvé ..."}},pagination:{Next:"»",Previous:"«",First:"First",Last:"Last"},number:{decimal:".",thousand:" ",places:2,symbol:"$",format:"%s %v"},charts:{numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",rangeSelectorZoom:"Zoom",rangeSelectorFrom:"From",rangeSelectorTo:"To"},date:{weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateShort:"mm/dd/yyyy",dateLong:"d mmm, yyyy",monthYear:"mmmm yyyy",shortTime:"hh:MM A",daySep:"-",weekStart:0,today:"Today",clear:"Clear"},operators:{in:{symbol:"=",title:"equal",binary:!1},nin:{symbol:"!=",title:"not equal",binary:!1},gt:{symbol:">",title:"is greater than",binary:!1},ge:{symbol:">=",title:"is greater or equal than",binary:!1},lt:{symbol:"<",title:"is less than",binary:!1},le:{symbol:">",title:"is less or equal than",binary:!1},between:{symbol:"between",title:"between",binary:!0},nbetween:{symbol:"not between",title:"not between",binary:!0},like:{symbol:"contains",title:"contains",binary:!1},nlike:{symbol:"not contains",title:"not contains",binary:!1},empty:{symbol:"is null",title:"is null",binary:!1},nempty:{symbol:"is not null",title:"is not null",binary:!1}},types:{number:{title:"Number",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},decimal:{title:"Decimal",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},money:{title:"Money",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},integer:{title:"Integer",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},date:{title:"Date",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},time:{title:"Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},"date-time":{title:"Date Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},string:{title:"String",operators:["in","nin","like","nlike","empty","nempty"]},enum:{title:"Enum",operators:["in","nin","empty","nempty"]},lookup:{title:"Lookup",operators:["in","nin","empty","nempty"]},boolean:{title:"Boolean",operators:["in","nin","empty","nempty"]}}},"en");!function(e){var t,i=e.utils;(n=t=e.external||(e.external={})).hashHandler=null,n.logoutHandler=null,n.forbiddenHandler=null,n.changePasswordHandler=null,n.checkLoggedInHandler=null,n.historyChangedHandler=null,n.formOpenHandler=null,n.preferenceLoadHandler=function(e){var t=i.Promise;return window.localStorage?new t(function(t,i){var n=window.localStorage.getItem("preferences."+e);t(n?JSON.parse(n):null)}):new t(function(e,t){e(null)})},n.preferenceSaveHandler=function(e,t){var n=i.Promise;return window.localStorage?new n(function(i,n){t?window.localStorage.setItem("preferences."+e,JSON.stringify(t)):window.localStorage.setItem("preferences."+e,""),i()}):new n(function(e,t){e()})},n.ruleLoaderHandler=null,n.ruleViewer=null;var n;!function(e){var i=[];e.removeLast=function(){i.pop(),t.historyChangedHandler&&t.historyChangedHandler()},e.add=function(e,n){if(n)return i=[e],void(t.historyChangedHandler&&t.historyChangedHandler());var s=i.length;(s?i[s-1]:"")!=e&&(e===(s>=2?i[s-2]:"")?i.pop():i.push(e),t.historyChangedHandler&&t.historyChangedHandler())},e.hasBack=function(){return i.length>1},e.value=i,e.locationPrefix="!"}(e.history||(e.history={}));!function(e){var t={};e.register=function(e,i,n){t[e]=t[e]||{},t[e][i]=n},e.get=function(e,i){return t[e]?t[e][i]:null}}(e.render||(e.render={}));!function(e){var t={};e.emit=function(e,i){var n=t["on"+e];n&&n.forEach(function(e){(e.listener?e.handler.bind(e.listener):e.handler)(i)})},e.listen=function(e,i,n){t[e]=t[e]||[];t[e].push({listener:n,handler:i})},e.unlisten=function(e,i){function n(t){if(t)for(var i=t.length;i--;)t[i].listener==e&&t.splice(i,1)}i?n(t[i]):Object.keys(t).forEach(function(e){n(t[e])})}}(e.ipc||(e.ipc={}))}(Phoenix||(Phoenix={}));!function(e){e.bootstrap4=!0,e.fontawesome=!1,e.modalPlugin="modal";var t;!function(t){var i={"arrow-left":"arrow-back","arrow-right":"arrow-forward","arrow-down":"arrow-downward","arrow-up":"arrow-upward",backward:"fast-rewind",bars:"menu",bolt:"toys",filter:"filter-list",wrench:"build",building:"add-to-queue",calendar:"date-range","caret-up":"arrow-drop-up","caret-down":"arrow-drop-down","check-square-o":"check-box","chevron-down":"expand-more","chevron-left":"chevron-left","chevron-right":"chevron-right","clock-o":"schedule",cloud:"cloud",cog:"settings","ellipsis-v":"more-vert","exclamation-circle":"error",eye:"visibility",forward:"fast-forward","file-o":"folder",floppy:"done","info-circle":"info",lock:"lock",minus:"remove",remove:"clear","minus-circle":"remove-circle",pencil:"edit","power-off":"power-settings-new",plus:"add","plus-circle":"add-circle","question-circle":"info",search:"search","square-o":"check-box-outline-blank",th:"apps","thumb-tack":"turned-in",times:"close","times-circle":"cancel","times-circle-o":"highlight-off",trash:"delete",user:"account-box","window-minimize":"fullscreen-exit","window-maximize":"fullscreen"},n=null,s=null,o=function(e,t,i){var n=(e||"").split(" "),s=n.indexOf(i);return t?s<0&&n.push(i):s>=0&&n.splice(s,1),n.join(" ")},r=0,a=function(t,n){void 0===n&&(n=!1);var s=e.fontawesome?t:i[t]?i[t]:t;return n?(e.fontawesome?"fa-":"mdi-")+s:(e.fontawesome?"fa fa-":"mdi mdi-")+s},l=function(e,t){return e?e.querySelectorAll(t):document.querySelectorAll(t)},u=function(e,t){return e?e.id==t?e:e.querySelector("#"+t):document.getElementById(t)},c=function(e,t){e.classList?e.classList.remove(t):e.className=o(e.className,!1,t)},d=function(e,t){return e.classList?e.classList.contains(t):(e.className||"").split(" ").indexOf(t)>=0},p=function(e){e.parentNode.removeChild(e)},h=function(e,t){e.appendChild(t)},f=function(e,t){if(t){var i=t.getBoundingClientRect(),n=e.getBoundingClientRect();return{left:Math.round(n.left-i.left),top:Math.round(n.top-i.top),width:Math.round(n.width),height:Math.round(n.height)}}return function(e){var t=document.documentElement.clientTop||document.body.clientTop||0,i=document.documentElement.clientLeft||document.body.clientLeft||0,n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,s=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;return e.top=Math.round(e.top+n-t),e.left=Math.round(e.left+s-i),e}({left:(n=e.getBoundingClientRect()).left,top:n.top,width:n.width,height:n.height})},m=function(e,t){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},v=function(e,t,i){if(void 0===i&&(i=void 0),void 0===i)return e.getAttribute(t);e.setAttribute(t,i)},g=null,y=0,_=function(){$(window).trigger("global-phoenix-resize")},b=null,x=function(e){for(var t=(document.cookie||"").split("; "),i=0,n=t.length;i<n;i++){var s=t[i].split("=");if(e==s[0]){var o=s[1]||"";return""===o?null:o}}return null};t.readyHandlers=[function(){$(window).on("resize.phoenix",function(){b&&clearTimeout(b),b=setTimeout(_,50)})}],t.finalizeHandlers=[],t.keys={VK_TAB:9,VK_UP:38,VK_DOWN:40,VK_INSERT:45,VK_DELETE:46,VK_LEFT:37,VK_RIGHT:39,VK_ENTER:13,VK_ESCAPE:27,VK_F1:112,VK_HOME:36,VK_END:35,VK_PGUP:33,VK_PGDOWN:34,VK_SPACE:32,VK_F2:113,VK_F3:114,VK_F4:115,VK_BACKSPACE:8,VK_F10:121},t.queryAll=l,t.find=u,t.query=function(e,t){return e?e.querySelector(t):window.document.querySelector(t)},t.addClass=function(e,t){e.classList?e.classList.add(t):e.className=o(e.className,!0,t)},t.removeClass=c,t.hasClass=d,t.icon=function(e){var t=document.createElement("span");return t.className=a(e,!1),t},t.iconClass=a,t.customIconClass=function(e,t){return t?t+" "+t+"-"+e:a(e)},t.iconPrefix=function(){return e.fontawesome?"fa":"mdi"},t.bodyTheme=function(e){var t=document.body.firstElementChild;t&&d(t,"bs-content")||(t=document.body);for(var i=t.className||"",n=e?"bs-body-theme-"+e:"",s=i.split(" "),o=!1,r=s.length;r--;){var a=s[r];if(0==a.indexOf("bs-body-theme-")){if(a==n)return!1;o=!0,s.splice(r,1)}}n&&(o=!0,s.push(n)),o&&(t.className=s.join(" "))},t.offset=function(e){var t;if(3!=e.nodeType&&((t=e.getBoundingClientRect()).width||t.height)){var i=e.ownerDocument,n=(o=i,null!=o&&o===o.window?o:9===o.nodeType&&o.defaultView),s=i.documentElement;return{top:t.top+n.pageYOffset-s.clientTop,left:t.left+n.pageXOffset-s.clientLeft,width:t.width,height:t.height,bottom:0,right:0}}var o;return t||{top:0,left:0,width:0,height:0,bottom:0,right:0}},t.before=function(e,t){e.parentNode.insertBefore(t,e)},t.after=function(e,t){var i=e.parentNode;(e=e.nextSibling)?i.insertBefore(t,e):i.appendChild(t)},t.parentByTag=function(e,t,i){for(i=i.toUpperCase();t;){if(t.tagName===i)return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},t.parentByAttr=function(e,t,i){for(;t;){if(v(t,i))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},t.parentByClass=function(e,t,i){for(;t;){if(d(t,i))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},t.indexOf=function(e,t){for(var i=0,n=e.childNodes.length;i<n;i++)if(e.childNodes[i]==t)return i;return-1},t.append=h,t.prepend=function(e,t){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},t.select=function(e){e&&e.select()},t.empty=function(e){for(var t=e.childNodes.length-1;t>=0;t--)e.removeChild(e.childNodes[t])},t.remove=p,t.detach=function(e){return e.parentNode.removeChild(e),e},t.downloadFrame=function(){var e=u(document.body,"glb_down_frame");return e||((e=document.createElement("iframe")).style.cssText="position: absolute; top: -1000px; left -1000px; width: 0px; height: 0px;",e.frameBorder="0",e.scrolling="yes",e.id="glb_down_frame",e.src="about:blank",h(document.body,e)),e},t.attr=v,t.text=function(e,t){if(void 0===t)return e.textContent;if(e.childNodes.length){for(var i=!1,n=0,s=e.childNodes.length;n<s;n++){var o=e.childNodes[n];if(3==o.nodeType){o.nodeValue=t,i=!0;break}}i||h(e,document.createTextNode(t))}else e.textContent=t},t.findByAttribute=function(e,t,i){for(var n=e;n;){if(!n.getAttribute)return null;if(n.getAttribute(i))return n;n=n==t?null:n.parentNode}return null},t.isChildOf=m,t.parseStyle=function(e,t){e&&e.split(" ").forEach(function(e,i){(e=e.trim())&&"$"===e.charAt(0)&&(e="bs-style-"+e.substring(1)),t.push(e)})},t.ignoreKeys=[0,t.keys.VK_UP,t.keys.VK_DOWN,t.keys.VK_HOME,t.keys.VK_END,t.keys.VK_PGUP,t.keys.VK_PGDOWN,t.keys.VK_ENTER,t.keys.VK_ESCAPE,t.keys.VK_DELETE,t.keys.VK_BACKSPACE,t.keys.VK_INSERT],t.arrowKeys=[t.keys.VK_LEFT,t.keys.VK_RIGHT,t.keys.VK_UP,t.keys.VK_DOWN],t.processing=function(e,t){e?(y++,g||(y=1,(g=$('<div class="bs-cover'+(t?" bs-none":"")+'"></div>').get(0)).style.height=$(document).height()-1+"px",h(document.body,g),t&&setTimeout(function(){g&&c(g,"bs-none")},t))):(--y<=0&&(y=0),g&&0===y&&(p(g),g=null))},t.inProcessing=function(){return null!=g},t.inCover=function(e){return g&&m(g,e)},t.scrollbar=function(){var e=!1,t=0;return function(){if(e)return t;var i,n=document.createElement("div");return n.style.cssText="overflow:scroll; overflow-x:hidden; zoom:1; clear:both",n.innerHTML="&nbsp;",document.body.appendChild(n),i=n.offsetWidth-n.scrollWidth,document.body.removeChild(n),e=!0,t=i,i}}(),t.supportCssCalc=function(){var e=document.createElement("a");return e.style.cssText="width: calc(10px);",!!e.style.length},t.documentScroll=function(){return{left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}},t.documentClientDim=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},t.documentViewSize=function(){return{height:Math.max(document.documentElement.clientHeight||document.body.clientHeight,window.innerHeight||0),width:Math.max(document.documentElement.clientWidth||document.body.clientWidth,window.innerWidth||0)}},t.touch=function(){var e=!1,t=!1;return function(){return e?t:(t="ontouchend"in document,e=!0,t)}}(),t.position=f,t.childrenPositions=function(e,t,i,n,s){var o=new Array(t.length+1),r=s.firstDelta||0,a=s.lastDelta||0,l=s.delta||0,c=s.height||0,d=s.top||0;t.forEach(function(t,s){var a=u(e,t.htmlId),c=f(a,null);o[s]={info:t.info,zone:n,position:"before",vertical:i,point:{x:0,y:0},left:c.left+(i?0:0===s?r:l),top:d||c.top,width:Math.round(a.offsetWidth),height:Math.round(a.offsetHeight),htmlId:t.htmlId}});var p=null;if(o.forEach(function(e){var t=e.point;t.y=e.top+(e.height>>1),t.x=e.left+(e.width>>1),p=e}),p){var h=a-(0===o.length?r:l);p={position:"after",zone:n,info:p.info,vertical:p.vertical,point:{x:0,y:0},left:p.left+(i?0:h)+(i?0:p.width),top:p.top+(i?p.height:0),width:p.vertical?p.width:0,height:c||(p.vertical?0:p.height),htmlId:p.htmlId}}else{var m=f(e,null);p={info:{},position:"empty",zone:n,vertical:i,point:{x:0,y:0},left:m.left+(i?0:a),top:d||m.top,width:Math.round(e.offsetWidth),height:c||Math.round(e.offsetHeight),html:e.id}}return p.point.y=p.top+(p.height>>1),p.point.x=p.left+(p.width>>1),o[t.length]=p,o},t.findNearest=function(e,t,i){var n,s,o=1e6;return i.forEach(function(i){var r,a=Math.abs(i.point.y-t);a<o?(o=a,s=Math.abs(i.point.x-e),n=i):a==o&&(r=Math.abs(i.point.x-e))<s&&(s=r,n=i)}),n},t.showMove=function(e,t,i,n){if(n=n||"bs-drag-color-info",e)if(e.vertical!==t)p(e),e=null;else{var s=e.firstChild.firstChild;d(s,n)||(p(e),e=null)}if(!e){var o=['<div class="bs-absolute">'];o.push('<div class="bs-absolute" style="left: 0px; top: 0px"><span class="'),t?o.push(a("arrow-left")):o.push(a("arrow-down")),n&&o.push(" "+n),o.push('"></span></div>');var r=[];o.push('<div class="bs-absolute" style="'),t?(r.push("right: 0px;"),r.push("bottom: 0px;"),o.push(r.join("")),o.push('"><span class="'),o.push(a("arrow-right"))):(r.push("left: 0px;"),r.push("bottom: 0px;"),o.push(r.join("")),o.push('"><span class="'),o.push(a("arrow-up"))),n&&o.push(" "+n),o.push('"></span></div>'),o.push("</div>"),(e=$(o.join("")).get(0)).vertical=t,h(document.body,e)}var l=e.style,u=e.firstElementChild,c=e.lastElementChild,f=Math.round(u.offsetWidth),m=Math.round(c.offsetHeight);return t?(l.height=m+"px",l.width=i.width+2*f+"px",l.left=i.left-f+"px",l.top=i.top-(m>>2)-4+"px"):(l.height=i.height+2*m+"px",l.top=i.top-m+"px",l.left=i.left-(f>>2)+"px"),l.zIndex="9002",e},t.featureTest=function(e,t,i){var n=e+":",s=document.createElement("test").style;return s.cssText=i?n+t:n+["-webkit-","-moz-","-ms-","-o-",""].join(t+";"+n)+t+";",-1!==s[e].indexOf(t)},t.getPx=function(e){return parseInt(e,10)||0},t.removeStype=function(e,t){e.style.removeProperty?e.style.removeProperty(t):e.style[t]="border"===t?"none":""},t.rem2px=function(e){return Math.round(e*(r||(r=parseFloat(getComputedStyle(document.documentElement).fontSize)),r))},t.checkSize=function(e){return"number"==typeof e?e+"px":e},t.bootstrapStyles=function(t){if(t){if(s)return s;var i=e.bootstrap4;return s={primary:i?"outline-primary":"primary",secondary:i?"outline-secondary":"default",default:i?"outline-secondary":"default",important:i?"outline-important":"important",success:i?"outline-success":"success",info:i?"outline-info":"info",danger:i?"outline-danger":"danger",warning:i?"outline-warning":"warning",link:i?"outline-link":"link",dark:i?"outline-dark":"default"}}if(n)return n;i=e.bootstrap4;return n={primary:"primary",secondary:i?"secondary":"default",default:i?"secondary":"default",important:"important",success:"success",info:"info",danger:"danger",warning:"warning",link:"link",dark:"default"}},t.selectRange=function(e,t,i){void 0===i&&(i=t),e.setSelectionRange(t,i)},t.childrenRectsbyAttribute=function(e,t){for(var i=l(e,"[data-"+t.attributeName+"]"),n=[],s=0,o=i.length;s<o;s++){var r=i[s],a=f(r,e);a.value=v(r,"data-"+t.attributeName),n.push(a)}return n},t.findAttrByPosition=function(e,t,i){for(var n=0;n<i.length;n++){var s=i[n];if(e>=s.left&&t>=s.top&&e<=s.left+s.width&&t<=s.top+t)return s}return null},t.setCookie=function(e,t,i,n){try{t||(n=new Date),document.cookie=e+"="+t+(null!=n?"; expires="+n.toUTCString():"")+(i?"; path="+i:"/")}catch(e){return!1}return x(e)==t},t.getCookie=x,t.iframeAsPromise=function(t,i,n,s){return new(0,e.utils.Promise)(function(e,o){try{var r=function(i){var o=u(null,t);o&&o.contentWindow&&i.source===o.contentWindow&&"object"==typeof i.data&&i.data.action===n&&(window.removeEventListener("message",r),document.body.removeChild(o),s&&s(i.data.params),e())};window.setTimeout(function(){var e=u(null,t);e&&(window.removeEventListener("message",r),document.body.removeChild(e),o({message:"Timeout"}))},1e4);var a=document.createElement("iframe");a.style.cssText="position: absolute; top: -1000px; left -1000px; width: 0px; height: 0px;",a.frameBorder="0",a.scrolling="yes",a.id=t,a.src=i,h(document.body,a),window.addEventListener("message",r,!1)}catch(e){o(e)}})}}(t=e.dom||(e.dom={})),$(document).ready(function(){t.readyHandlers.length&&t.readyHandlers.forEach(function(e){e()})})}(Phoenix||(Phoenix={}));!function(e){var t=e.dom;e.utils;!function(e){var i=function(){function e(){}return e.prototype.disable=function(){this._isDisabled=!0},e.prototype.enable=function(){this._isDisabled=!1},e}();e.EventManager=i,e.mouseEvents=function(e){if(t.touch())switch(e){case"mousedown":return"touchstart";case"mouseup":return"touchend";case"mousemove":return"touchmove"}return e};e.isLeftButton=function(e){return!!t.touch()||e.which<2};e.stopEvent=function(e){e.stopPropagation(),e.preventDefault()};e.point=function(e){var i,n=document.documentElement;if(t.touch()){var s=e.targetTouches||e.touches;s&&(i={x:s[0].pageX||s[0].clientX+(n.scrollLeft||document.body.scrollLeft),y:s[0].pageY||s[0].clientY+(n.scrollTop||document.body.scrollTop)})}return i||(i={x:e.pageX||e.clientX+(n.scrollLeft||document.body.scrollLeft),y:e.pageY||e.clientY+(n.scrollTop||document.body.scrollTop)}),i.x=Math.round(i.x),i.y=Math.round(i.y),i},e.eventManager=new i}(e.events||(e.events={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.dom,i=e.utils,n=e.events,s=e.customData;!function(e){var o=function(){function e(){}return e.prototype.initialize=function(){var e=$(document);this._mu=this.mouseUp.bind(this),this._md=this.mouseDownEmpty.bind(this),e.on(n.mouseEvents("mouseup"),this._mu),e.on(n.mouseEvents("mousedown"),this._md)},e.prototype.finalize=function(){var e=$(document);this._mu&&(e.off(n.mouseEvents("mouseup"),this._mu),this._mu=null),this._md&&(e.off(n.mouseEvents("mousedown"),this._mu),this._md=null),this._listeners=null,this._current=null},e.prototype.startMouseMove=function(){this._mm||(this._mm=this.mouseMove.bind(this),$(document).on(n.mouseEvents("mousemove"),this._mm))},e.prototype.stopMouseMove=function(){this._mm&&($(document).off(n.mouseEvents("mousemove"),this._mm),this._mm=null)},e.prototype._canExecuteEvent=function(e){return!!this._current},e.prototype.mouseUp=function(e){var t=this._current;return!t||(t.inDragging&&t.notifyDragEnd(!1,e),this.setCurrent(null),t.clear(),!1)},e.prototype.mouseDownEmpty=function(e){return!0},e.prototype.mouseMove=function(e){var t=this;if(t._canExecuteEvent(e)){var i=t._current;if(!i)return!0;if(!i.ready(e))return n.isLeftButton(e)||(t.setCurrent(null),i.clear()),!0;if(!n.isLeftButton(e))return t.cancelDrag(),!0;try{i.notifyDrag(e)}catch(e){t.cancelDrag()}return n.stopEvent(e),!0}},e.prototype.addDrag=function(e){var t=new r(e);return this._listeners=this._listeners||[],this._listeners.push(t),t},e.prototype.rmvDrag=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t>=0&&(this._listeners.splice(t,1),e.finalize())}},e.prototype.setCurrent=function(e){return(!e||!this._current)&&(this._current=e,this._current||this.stopMouseMove(),!0)},e.prototype.cancelDrag=function(){var e=this._current;e&&(e.inDragging&&e.notifyDragEnd(!0,null),this.setCurrent(null),e.clear())},e.prototype.cover=function(e,n,s){if(e)if(this._coverId){if(void 0!==n){(l=t.find(document.body,this._coverId)).style.cursor=n}}else{this._coverId=i.allocID();var o=t.documentScroll(),r=t.documentClientDim();r.width+=o.left,r.height+=o.top,r.width=Math.round(Math.max(r.width,document.body.offsetWidth)),r.height=Math.round(Math.max(r.height,Math.round(document.body.offsetHeight)));var a=document.createElement("div");a.id=this._coverId,a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.style.backgroundColor="white",a.style.opacity="0.01",a.style.width=r.width+"px",a.style.height=r.height+"px",a.style.zIndex=(s||1e4)+"",a.style.cursor=n,t.append(document.body,a)}else if(this._coverId){var l=t.find(document.body,this._coverId);this._coverId=null,l&&t.remove(l)}},e}();e.DragAndDropManager=o;var r=function(){function o(e){this._elements=e,this._mdEvent=this.mousedown.bind(this),this.clear(),this._setEvents()}return o.prototype.clear=function(){var e=this.stopEvent;this.mouseMoveCount=0,this._lastDropTarget=null,this.minLeft=null,this.maxLeft=null,this.minTop=null,this.maxTop=null,this.currentLeft=0,this.currentTop=0,this.moveX=!1,this.moveY=!1,this.moveSourceName=null,this._targets=null,this.inDragging=!1,this.coverDocument=!0,this.cursor="default",this.startPoint=null,this.currentPoint=null,this.startOffset=null,this.stopEvent=!1,this.data={},this.floatElement=null,this.floatParent=null,this.stopEvent=e},o.prototype._removeEvents=function(){var e=this;e._elements&&(e._elements.forEach(function(t){$(t).off(n.mouseEvents("mousedown"),e._mdEvent)}),e._elements=null)},o.prototype._setEvents=function(){var e=this;e._elements&&e._elements.forEach(function(t){$(t).on(n.mouseEvents("mousedown"),e._mdEvent)})},o.prototype.mousedown=function(t){return this.mouseMoveCount=0,this.inDragging=!1,!n.isLeftButton(t)||(!this.canStartDrag(t)||(!e.dragManager.setCurrent(this)||(this.startPoint=n.point(t),e.dragManager.startMouseMove(),this.stopEvent&&n.stopEvent(t),!1)))},o.prototype.finalize=function(){this._removeEvents(),i.cleanUpObject(this)},o.prototype.ready=function(e){return this.mouseMoveCount++,2==this.mouseMoveCount&&this.notifyDragStart(e),this.inDragging},o.prototype.notifyDrag=function(e){if(this.inDragging){this.currentPoint=n.point(e);var i=this.floatElement;if(i&&this.moveX){var s=this.startOffset.left+this.currentPoint.x-this.startPoint.x;null!==this.minLeft&&s<this.minLeft&&(s=this.minLeft),null!==this.maxLeft&&s>this.maxLeft&&(s=this.maxLeft),this.currentLeft=s,i.style.left=s+"px"}if(i&&this.moveY){var o=this.startOffset.top+this.currentPoint.y-this.startPoint.y;null!==this.minTop&&o<this.minTop&&(o=this.minTop),null!==this.maxTop&&o>this.maxTop&&(o=this.maxTop),this.currentTop=o,i.style.top=o+"px"}if(this.onDrag&&this.onDrag(e),i&&this._targets){var r=t.position(i,null),a=t.findAttrByPosition(r.left,r.top,this._targets);this.canDrop(!!a),this._lastDropTarget=a?{value:a.value,x:r.left-a.left,y:r.top-a.top}:null}}},o.prototype.notifyDragStart=function(i){this.inDragging=!0,n.eventManager.disable(),this.coverDocument&&e.dragManager.cover(!0,this.cursor);try{var s=!0;this.onDragStart&&(this.onDragStart(i)||(this.notifyDragEnd(!0,i),s=!1),this.floatElement&&(this.startOffset=t.position(this.floatElement,this.floatParent))),s&&(this.moveX||this.moveY)&&this.moveSourceName&&(this._targets=t.childrenRectsbyAttribute(null,{attributeName:"drag-"+this.moveSourceName}))}catch(e){}},o.prototype.canStartDrag=function(e){return!this.canStartDragHandler||this.canStartDragHandler(e)},o.prototype.canDrop=function(t){this.coverDocument&&e.dragManager.cover(!0,t?this.cursor:"no-drop")},o.prototype.notifyDragEnd=function(t,o){this.inDragging=!1;var r=this.coverDocument;if(this.onDragEnd&&this.onDragEnd(t,o),this._lastDropTarget&&!t){var a=s.get(this._lastDropTarget.value);a&&"object"==typeof a&&a.dragEnd&&a.dragEnd(o)}i.nextTick(function(){n.eventManager.enable(),r&&e.dragManager.cover(!1)})},o}();e.DragElement=r,e.dragManager=new o,t.readyHandlers.push(function(){e.dragManager.initialize()}),t.finalizeHandlers.push(function(){e.dragManager.finalize()});var a;e.setData=function(e){a=e},e.getData=function(){return a}}(e.drag||(e.drag={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.utils,s=i.dom,o=i.customData,r=i.device,a=i.application,l=i.external,u=i.authentication,c=i.history,d=[],p=function(e){if(!e)return"";var t=[];return Object.keys(e).forEach(function(i){null!==e[i]&&t.push(i+"="+encodeURIComponent(e[i]||""))}),t.length>0?"?"+t.join("&"):""},h=function(e,t){var i="",n={},s=e;if(0===e.indexOf("http")){var o=e.indexOf("//");i=e.substr(0,o+2),(o=(s=e.substr(o+2)).indexOf("/"))>0&&(i+=s.substr(0,o),s=s.substr(o))}"#"===s.charAt(0)&&(s=s.substr(1)),c.locationPrefix&&s.charAt(0)===c.locationPrefix&&(s=s.substr(1));var r=s.indexOf("?");if(r>=0){var a=s.substring(r+1);if(s=s.substring(0,r),a){a.split("&").forEach(function(e){if(e){var i=e.split("="),s=decodeURIComponent(i[1]);if(t&&s)if("["===s.charAt(0)&&"]"===s.charAt(s.length-1))try{s=JSON.parse(s)}catch(e){}else if("{"===s.charAt(0)&&"}"===s.charAt(s.length-1))try{s=JSON.parse(s)}catch(e){}n[decodeURIComponent(i[0])]=s}})}}return{path:s,search:n,host:i}},f=function(e){for(var t=0,i=d.length;t<i;t++){var n=d[t];if(n.test(e))return n}return null},m=function(e){return h(window.location.href,e).search},v=function(e){var t=e.$page;return r.phone&&e.$pageMobile?t=e.$pageMobile:r.tablet&&e.$pageTablet&&(t=e.$pageTablet),t},g=function(e){var t=null;try{t=JSON.parse(u.db().getItem("authentication"))}catch(e){}var n={$url:m(!0),$mem:i.$mem,$user:{name:t?t.name||t.nom||t.login:"",firstName:t?t.firstName||t.prenom||t.login:"",lastName:t?t.lastName||t.nom||"":""},$item:null,$cookie:null,$target:null};if(e&&e.cookie){n.$cookie={};(document.cookie||"").split(";").forEach(function(e){var t=e.split("=");t[0]=t[0].replace(/^ /,""),n.$cookie[decodeURIComponent(t[0])]=decodeURIComponent(t[1])})}return n},y=function(e,t,i){if(e.$page){var s=v(e),o="#"+c.locationPrefix+"/"+s,r=[];if(t&&e.$search&&e.$search.length){var a=g();Object.keys(t).forEach(function(e){a[e]=t[e]}),e.$search.forEach(function(e){e&&e.left&&r.push(e.left+"="+encodeURIComponent(n.parseVariable(e.right,a)))})}return i&&Object.keys(i).forEach(function(e){r.push(e+"="+encodeURIComponent(i[e]))}),r.length&&(o=o+"?"+r.join("&")),o}return"#"},_={},$=function(e){var t=e.indexOf("://");if(t>0){var i=_[e.substring(0,t)];if(i)return i.protocol}return null},b=function(e,t,i,n){if(e&&"#"===(""+e).charAt(0)||(e="#"+e),c.locationPrefix&&e.charAt(1)!==c.locationPrefix&&(e=e="#"+c.locationPrefix+e.substring(1)),i){var s=document.createElement("a");return s.href=e,s.target="_blank",document.body.appendChild(s),s.click(),void document.body.removeChild(s)}window.location.hash!==e&&(l.hashHandler?l.hashHandler(e,t,n):(c.removeLast(),t&&"replaceState"in window.history?window.history.replaceState(void 0,void 0,e):location.hash=e))},x=function(e){if(e.name&&e.schema){var t="/authoring/forms/"+e.name,i=[];e.schema!==e.name&&i.push("prototype="+encodeURIComponent(e.schema)),e.locale&&i.push("locale="+encodeURIComponent(e.locale)),e.path&&i.push("path="+encodeURIComponent(e.path));var n=window.location.href.lastIndexOf("?");if(n>0){var s=[];window.location.href.substr(n+1).split("&").forEach(function(e){var t=e.split("=");["prototype","path","locale"].indexOf(t[0])<0&&s.push(e)}),i.push(s.join("&"))}i.length&&(t=t+"?"+i.join("&")),window.location.hash="#"+c.locationPrefix+t}},C=function(e,t){var i="/authoring",n=window.location.hash;"#"===n.charAt(0)&&(n=n.substring(1)),c.locationPrefix&&n.charAt(0)===c.locationPrefix&&(n=n.substring(1)),t||0!==n.indexOf(i)?window.location.hash="#"+c.locationPrefix+i+(e?"/"+e:n):0===n.indexOf("/authoring/forms/")?window.history.back():window.location.hash="#"+c.locationPrefix+n.substring(i.length)};t.search=m,t.object2search=p,t.parseUrl=h,t.hashLink=y,t.pageName=v,t.isCustomLink=function(e,t,i){for(var n=t.target;n&&n!=e;){var o=s.attr(n,"data-phoenix-href")||s.attr(n,"href");if(o){if("#"===o){i||(t.preventDefault(),t.stopPropagation());break}var r=$(o);if(r)return i||(t.preventDefault(),t.stopPropagation()),{protocol:r,value:o}}n=n.parentNode}return null},t.registerLinkExecutor=function(e){d.push(e)},t.getLinkExecutor=f,t.registerCustomProtocol=function(e,t){_[e]={protocol:e,handler:t}},t.execCustomProtocol=function(e,t,i,n){var s=_[e.protocol];s&&s.handler&&s.handler(e.value,t,i,n)},t.isCustomProtocol=$,t.doAuthoring=C,t.doFormAuthoring=x,t.execLink=function(e,t,i){var n=a.configuration&&a.configuration.application?a.configuration.application.modules:null;if(e.$page){var s=e.$module?e.$module:a.name;if(n&&n[s]&&a.licences){var r=a.licences[n[s]];if(r&&!r.hasLicence&&l.forbiddenHandler)return l.forbiddenHandler()}var u=y(e,t,i),d=t&&"blank"===t.$target;if(e.$module&&e.$module!==a.name)return function(e,t,i,n,s){var o,r=location.pathname.split("/"),a="";r[r.length-1].indexOf(".html")>0&&(a=r.pop());var l=r.pop();if(a||""!=l||r.pop(),r.push(t),a&&r.push(a),o=r.join("/"),e&&"#"===(""+e).charAt(0)||(e="#"+e),c.locationPrefix&&e.charAt(1)!==c.locationPrefix&&(e="#"+c.locationPrefix+e.substr(1)),o+=e,s){var u=document.createElement("a");return u.href=o,u.target="_blank",document.body.appendChild(u),u.click(),void document.body.removeChild(u)}n?location.replace(o):location.href=o}(u,e.$module,a.name,e.$replace,d);b(u,e.$replace,d,!1),e.$authoring&&C()}else if(e.$logout)l.logoutHandler&&l.logoutHandler();else if(e.$form)v=e.$form,l.formOpenHandler&&l.formOpenHandler(v);else if(e.$action&&e.$action.name){var p=o.get(e.$action.name);p&&p(e.$action.params)}else if(e.$formAuthoring)x(e);else if(e.$authoring)C();else if(e.$back)window.history.back();else if(e.href){var h=document.createElement("a");h.href=e.href,e.target&&(h.target=e.target),document.body.appendChild(h),h.click(),document.body.removeChild(h)}else{var m=f(e);m&&m.hnd(e)}var v},t.context=g,t.changeSearch=function(t){var i=h(window.location.hash,!1);n.merge(t,i.search);var s,o=(s=i,"#"+(e.history.locationPrefix?e.history.locationPrefix:"")+s.path+p(s.search));b(o,!0,!1,!0)}}(e.link||(e.link={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.dom;!function(e){e.topOffset=0,e.bottomOffset=0;var i=t.featureTest("position","sticky",!1),n=t.featureTest("position","fixed",!0),s="bs-sticky-on",o="bs-sticky-off",r="bs-sticky-dummy",a=function(i,n,r){n?(t.addClass(i,s),"top"===r?i.style.top=e.topOffset+"px":"bottom"===r&&(i.style.bottom=e.bottomOffset+"px"),t.removeClass(i,o)):(t.addClass(i,o),t.removeClass(i,s),t.removeStype(i,"width"),t.removeStype(i,"top"),t.removeStype(i,"bottom"))},l=function(){function o(){this._map={},this._list=[],this._scroll=null,this._resize=null,this._refreshTimer=null,this._scrollTimer=null}return o.prototype.add=function(e){!i&&n&&(this._map[e.id]=e,this._list.push(e))},o.prototype.remove=function(e){var i=this._map[e];if(void 0!==i){i.element&&function(e,i){var n=e.element,s=($(n),t.find(n.parentNode,e.id+"_sticky_clone"));a(n,!1,i),s&&t.remove(s)}(i,i.position),i.element=null,delete this._map[e];var n=this._list.indexOf(i);n>=0&&this._list.splice(n,1)}},o.prototype.initialize=function(){!i&&n&&(this._scroll=this._onscroll.bind(this),this._resize=this._onresize.bind(this),$(window).on("scroll.sticky",this._scroll),$(window).on("global-phoenix-resize",this._resize))},o.prototype._updateElements=function(i){this._list.forEach(function(n){var o=n.element;i&&!t.hasClass(o,s)||o.offsetWidth&&function(i){var n,o,l=i.element,u=$(l),c=t.offset(l),d=u.outerHeight(),p=0,h=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,f=t.hasClass(l,s),m=$(window).height(),v=u.parent(),g=v.offset().top,y=v.outerHeight(),_=t.find(v.get(0),i.id+"_sticky_clone");if(_){var b=t.offset(_);_.style.height=d+"px",p=b.width?b.top:c.top}else p=c.top,(_=document.createElement("div")).id=i.id+"_sticky_clone",_.className=r,_.style.height=d+"px",t.after(l,_);var x="top"===i.position,C="bottom"===i.position;n=0,o=0,x&&function(){var t=h+n+e.topOffset;return p<t&&t+d<=g+y}()||C&&p+(d||0)>h+m-o&&h+m-o>=g+(d||0)?f?(b=t.offset(_),l.style.width=b.width+"px"):(a(l,!0,i.position),l.style.width=c.width+"px"):f&&a(l,!1,i.position)}(n)})},o.prototype._onscroll=function(){var e=this;e._scrollTimer&&(window.clearTimeout(e._scrollTimer),e._scrollTimer=null),e._scrollTimer=window.setTimeout(function(){e._updateElements(!1)},20),e._updateElements(!1)},o.prototype._onresize=function(){this._updateElements(!0)},o.prototype._refresh=function(e){e&&this._updateElements(!1)},o.prototype.refresh=function(e){var t=this;t._refreshTimer&&(window.clearTimeout(t._refreshTimer),t._refreshTimer=null),t._refreshTimer=window.setTimeout(function(){t._refresh(e)},200)},o.prototype.finalize=function(){if(!i&&n){this._refreshTimer&&(window.clearTimeout(this._refreshTimer),this._refreshTimer=null),this._scrollTimer&&(window.clearTimeout(this._scrollTimer),this._scrollTimer=null),$(window).off("scroll.sticky",this._scroll),$(window).off("global-phoenix-resize",this._resize),this._scroll=null,this._resize=null}},o}();e.StickyManager=l,t.readyHandlers.push(function(){e.stickyManager.initialize()}),t.finalizeHandlers.push(function(){e.stickyManager.finalize()}),e.stickyManager=new e.StickyManager,e.native=i||!n}(e.sticky||(e.sticky={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){(e.jsonpatch||(e.jsonpatch={})).compare=function(e,t,i){var n=[];return o(e,t,n,"",i=i||{}),n};var i=function(e){if(Array.isArray(e)){for(var t=new Array(e.length),i=0;i<t.length;i++)t[i]=""+i;return t}return Object.keys(e)},n=function(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")},s=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},o=function(e,t,r,a,l){for(var u=l.useId,c=Array.isArray(t),d=i(t),p=i(e),h=!1,f=p.length-1;f>=0;f--){var m=e[y=p[f]],v=c&&u&&m.id?m.id+"":y;if(!t.hasOwnProperty(y)||void 0===t[y]&&void 0!==m&&!1===Array.isArray(t))r.push({op:"remove",path:a+"/"+n(v)}),h=!0;else{var g=t[y];"object"==typeof m&&null!=m&&"object"==typeof g&&null!=g?o(m,g,r,a+"/"+n(v),l):m!==g&&(!0,r.push({op:"replace",path:a+"/"+n(v),value:s(g)}))}}if(h||d.length!=p.length)for(f=0;f<d.length;f++){var y=d[f];e.hasOwnProperty(y)||void 0===t[y]||r.push({op:"add",path:a+"/"+(c&&u?"-":n(y)),value:s(t[y])})}}}()}(Phoenix||(Phoenix={}));!function(e){(t=e.filters||(e.filters={})).OPERATORS={in:"in",nin:"nin",gt:"gt",ge:"ge",lt:"lt",le:"le",between:"between",nbetween:"nbetween",like:"like",nlike:"nlike",empty:"empty",nempty:"nempty"},t.TYPES={number:"number",decimal:"decimal",money:"money",integer:"integer",date:"date",time:"time","date-time":'"date-time',string:"string",enum:"enum",lookup:"lookup",boolean:"boolean"};var t}(Phoenix||(Phoenix={}));!function(e){var t=Phoenix||(Phoenix={}),i=t.link,n=t.utils;i.registerCustomProtocol("page",function(e,n,s,o){n.$url||(n.$url=i.search(!0)),n.$mem||(n.$mem=t.$mem);var r=e.indexOf("://");if(!(r<=0)){var a,l=e.substring(r+3),u=i.parseUrl(l),c=u.path.split("/");u.search.$replace&&(a=!0,delete u.search.$replace);var d={$page:c[0],$search:[],$replace:a,$menu:null};c.length>1&&(d.$menu=c[1]),Object.keys(u.search).forEach(function(e){d.$search.push({left:e,right:u.search[e]})}),i.execLink(d,n,null)}}),i.registerCustomProtocol("link",function(e,t,s,o){var r=e.substring("link://".length),a=r.indexOf("/");if(a<=0&&(a=r.indexOf("?")),a>0){var l=i.parseUrl(r.substring(a));r=r.substring(0,a),l.search&&(o?n.extend(o,l.search):o=l.search)}s.links&&s.links[r]&&i.execLink(s.links[r],t,o)}),i.registerCustomProtocol("click",null)}();!function(e){var t=e,i=t.application,n=t.ajax,s=t.ulocale;!function(t){var o={get:function(e,t,o){t&&s.lang&&(e=e+"_"+s.lang);var r=i.config(o);if(!r)throw"Application configuration not found.";return n.get(r.current.menus+"/"+e+".json",{cache:!0},null)}};(e.data||(e.data={})).menu=o}()}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.ulocale,n=(t.utils,t.ajax),s=t.application;!function(t){var o={get:function(e,t,o){t&&i.lang&&(e=e+"_"+i.lang);var r=s.config(o);if(!r)throw"Application configuration not found.";return n.get(r.current.locales+"/"+e+".json",{cache:!0},function(t){return t&&(t.$name=e),t.$view&&(t.$view.$name=e),t})}};(e.data||(e.data={})).schema=o}()}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.ajax,n=t.utils,s=e.dom,o=t.link,r=t.application;!function(t){var a=function(e,t){if(s.getCookie(e))return t();window.setTimeout(a.bind(window,e,t),500)},l={get:function(e){return new n.Promise(function(t,i){var n={$url:e,$method:"GET"};l.getRessources(n,!1,function(e){t(e)})})},put:function(e,t){return new n.Promise(function(i,n){var s={$url:e,$method:"PUT",$data:t};l.getRessources(s,!1,function(e){i(e)})})},post:function(e,t){return new n.Promise(function(i,n){var s={$url:e,$data:t,$method:"POST"};l.getRessources(s,!1,function(e){i(e)})})},remove:function(e){var t={$url:e,$method:"DELETE"};return l.getRessources(t,!1,null)},getRessources:function(e,t,l){var u=l?function(e){return e=l(e)}:null,c=e.$url,d=!1,p=e.$download,h="";p&&(delete e.$download,e.$cookie&&(h=e.$cookie,delete e.$cookie,s.setCookie(h,"","/",null)));var f=$.extend(!0,{},r.config(r.name)||{});f.rest=(e.$type?f[e.$type]:null)||f.rest||{},f.sync=(e.$type?f[e.$type]:null)||f.sync||{},delete e.$type;var m=t?f.sync:f.rest,v=m.base||"";!c||"/"!==c.charAt(0)&&"."!==c.charAt(0)||(v=""),v?c=v+"/"+c:d=!0;var g=o.context({cookie:!0});void 0===e.$module&&m.$module&&(e.$module=m.$module),e.$module?g.$module=e.$module:c=c.replace("{$module}/",""),m.$context?g.$context=m.$context:c=c.replace("{$context}/",""),c=n.formatNames(c,g),m.headers&&m.headers.Authorization&&(m.headers.Authorization=n.formatNames(m.headers.Authorization,g));var y=i.getDefaultAjaxOptions(m),_=e.$query;e.$list;c+=o.object2search(_),c=c;switch(e.$method){case"POST":return u?new n.Promise(function(t,n){i.post(c,e.$data,y).then(function(e){e=u(e),t(e)}).catch(function(e){n(e)})}):i.post(c,e.$data,y);case"PUT":return i.put(c,e.$data,y);case"PATCH":return i.patch(c,e.$data,y);case"DELETE":return i.remove(c,y);default:if(p){var b=s.downloadFrame();return d&&(c=i.addAuthToUrl(c)),b.src=c,h?new n.Promise(function(e,t){a(h,e)}):n.Promise.resolve()}return i.get(c,y,function(e){return u?u(e):e})}}};(e.data||(e.data={})).rest=l}()}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.application,n=t.ajax,s=t.link;!function(t){var o={getRessources:function(e,t){var o=i.config(i.name);if(!o)throw"Application configuration not found.";var r=o.localData+"/"+e.$url,a=e.$query;return r+=s.object2search(a),n.get(r,{},function(e){return i=e,t&&(i=t(i)),i;var i})}};(e.data||(e.data={})).local=o}()}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.application,n=t.link,s=t.authentication,o=t.utils,r=t.ajax;!function(t){var a={},l=function(e){return e},u={v4:!0,transport:{doPost:r.post,doPut:r.put,doDelete:r.remove,doGet:function(e,t,i,n){return r.get(e,t,i)},doPatch:r.patch},afterLogout:function(){a={}},addImageUrlToken:function(e){var t=i.config(i.name)||{};if(t.odata=t.odata||{},t&&t.odata&&t.odata.authentication){var n=s.load();if(n)switch(t.odata.authentication){case"header-session":e=e+"?token="+n.token}}return e},baseUrl:function(e){var t=i.config(i.name)||{};t.odata=t.odata||{};var s=t.odata.base||"/data",r=n.context({cookie:!0});return void 0===(e=e||{}).$module&&t.odata.$module&&(e.$module=t.odata.$module),e.$module?r.$module=e.$module:s=s.replace("{$module}/",""),t.odata.$context?r.$context=t.odata.$context:s=s.replace("{$context}/",""),o.formatNames(s,r)},configOdata:function(e){var t=$.extend(!0,{},i.config(i.name)||{});t.odata=(e.$type?t[e.$type]:null)||t.odata||{};var s=t.odata.base||"/data",r=n.context({cookie:!0});return void 0===(e=e||{}).$module&&t.odata.$module&&(e.$module=t.odata.$module),e.$module?r.$module=e.$module:s=s.replace("{$module}/",""),t.odata.$context?r.$context=t.odata.$context:s=s.replace("{$context}/",""),t.odata.base=o.formatNames(s,r),t.odata.headers&&t.odata.headers.Authorization&&(t.odata.base=o.formatNames(t.odata.headers.Authorization,r)),t.odata},urlResEntity:function(e,t){var i=u.baseUrl(e);if(!e.$entity)throw"Invalid odata entity.";if(t&&!e.$entityId)throw"Invalid odata entity id.";var n=i+"/"+e.$entity;return e.$entityId&&(n=n+"("+e.$entityId+")"),e.$propertyName&&(n=n+"/"+e.$propertyName),n},doDelete:function(e,t){var i=u.urlResEntity(e,!0),n=r.getDefaultAjaxOptions(u.configOdata(e));return t&&(n.headers["If-Match"]=t),n.ignore={410:!0},i=l(i),u.transport.doDelete(i,n)},doPost:function(e,t){var i=r.getDefaultAjaxOptions(u.configOdata(e)),n=u.urlResEntity(e,!1);return n=l(n),u.transport.doPost(n,t,i)},doPut:function(e,t,i,n){var s=u.urlResEntity(e,!0),o=r.getDefaultAjaxOptions(u.configOdata(e));return o.headers=o.headers||{},i&&(o.headers["If-Match"]=i),n&&(o.headers.Prefer="return=representation"),s=l(s),u.transport.doPut(s,t,o)},doPatch:function(t,i,n,s){var o=u.urlResEntity(t,!0),a=r.getDefaultAjaxOptions(u.configOdata(t));return a.headers=a.headers||{},e.application.useJSONPatch&&(a.headers["Content-Type"]="application/json-patch+json"),n&&(a.headers["If-Match"]=n),s&&(a.headers.Prefer="return=representation"),o=l(o),u.transport.doPatch(o,i,a)},applyFilters:function(e,t,i,n,s,r){var a=[],l=e.length;if((t=(t||"")+"")&&i&&i.length){var u=i.length,c=t.toLowerCase();e.forEach(function(e){for(var t=!1,n=0;n<u;n++){var s=i[n].replace(/\//g,".");if(((o.getValue(e,s)||"")+"").toLowerCase().indexOf(c)>=0){t=!0;break}}t&&a.push(e)}),l=a.length}else a=e;n=n||0;var d=s||a.length;if(r){var p=r.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 2===t.length?{field:t[0],asc:"asc"===t[1]}:{field:e,asc:!0}});a.sort(function(e,t){for(var i=0;i<p.length;i++){var n=p[i],s=e[n.field],o=t[n.field];if(s!==o){var r=s>o?1:-1;return n.asc||(r*=-1),r}}return 0})}var h=a.slice(n,n+d);return{documents:h,count:l,dataCount:h.length,skip:n,pageSize:s,nodata:0===h.length,search:t,orderBy:r}},getRessources:function(e,s,c,d){var p=function(e){return s&&(e=s(e)),e},h=e.$relation;h&&delete e.$relation;var f=!1,m=e.$cache;delete e.$cache;var v=$.extend(!0,{},i.config(i.name)||{});v.odata=(e.$type?v[e.$type]:null)||v.odata||{},delete e.$type,void 0!=v.odata.v4&&(u.v4=v.odata.v4);var g=v.odata?v.odata.base||"/data":"/data",y=n.context({cookie:!0});void 0===e.$module&&v.odata.$module&&(e.$module=v.odata.$module),e.$module?y.$module=e.$module:g=g.replace("{$module}/",""),v.odata.$context?y.$context=v.odata.$context:g=g.replace("{$context}/",""),g=o.formatNames(g,y),v.odata.headers&&v.odata.headers.Authorization&&(v.odata.headers.Authorization=o.formatNames(v.odata.headers.Authorization,y)),delete e.$module;var _=e.$entity;e.$entityId&&(_=_+"("+e.$entityId+")",delete e.$entityId,f=!0),e.$propertyName&&(_=_+"/"+e.$propertyName,delete e.$propertyName,f=!0);var b=_;delete e.$entity;var x,C="",k=[],w=e.$skip||0,E=!1,O=e.$orderby;e.$searchByFieldsValue&&(C=e.$searchByFieldsValue,k=e.$searchByFieldsFields,delete e.$searchByFieldsValue,delete e.$searchByFieldsFields),f||(e.$top&&(x=parseInt(e.$top+"",10)),u.v4?(e.$top&&!e.nocount&&(e.$count=!0),delete e.nocount):(e.$top&&!e.nocount&&(e.$inlinecount="allpages"),delete e.nocount),(v.odata.array||v.odata.nocount)&&(e.$count||e.$inlinecount)&&e.$top&&!e.$allData&&(E=!0,x++,e.$top=x,delete e.$count,delete e.$inlinecount));var S=e.$allData||h;S&&(delete e.$skip,delete e.$top,delete e.$allData,delete e.$orderby);var P=r.getDefaultAjaxOptions(v.odata);if(P.$errors=c,b=g+"/"+b+n.object2search(e),m&&a[_]&&a[_].uri===b)return new o.Promise(function(e,t){e(p(f?a[_].data:$.extend(!0,{},a[_].data)))});b=l(b);var I=t.odata.transport.doGet;return h&&(I=function(e,t,i,n){var s={value:[]};return d&&d.model&&(s.value=d.model.getValue(n.params.relation).model(!1)||[]),i&&(s=i(s)),o.Promise.resolve(s)}),I(b,P,function(e){var t={};if(u.v4&&e&&delete e["@odata.context"],f)t=e;else{if(t.documents=v.odata.array?e:u.v4?e.value:e.d.results,S&&(t._origData=[]),t.documents.forEach(function(e){delete e.__metadata,S&&t._origData.push($.extend(!0,{},e))}),(v.odata.array||v.odata.nocount)&&(t._noPagesCount=!0,t._hasNext=!1,t._hasPrev=!!w),S){var i=u.applyFilters(t.documents,C,k,w,x,O);t.documents=i.documents,t.count=i.count}else v.odata.array||v.odata.nocount?E&&(t.documents.length===x&&(t._hasNext=!0,t.documents.pop()),x--):t.count=u.v4?e["@odata.count"]:e.d.__count;t.dataCount=t.documents.length,t.pageSize=x,t.skip=w,t.nodata=0==t.dataCount,t.uri=(n=b,0!==n.indexOf("http")&&(n=window.location.origin+n),n),t.search=C,t.orderBy=O}var n;return m&&(a[_]={uri:b,data:$.extend(!0,{},t)}),p(t)},{entity:_,params:e})}};t.odata=u,s.registerAfterLogout(u.afterLogout)}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.link,n=t.utils,s=t.data,o=t.customData,r=t.application;!function(e){var a=function(e,t){if(e.$transform){var i=o.get("datasets.transform."+e.$transform);i&&(t=i(t))}return t},l=function(e,t,i){if(!e)return t;var n=o.get("datasets.transform."+e);return n?n($.extend(!0,{},t,i)):t},u=function(){var e={};return{register:function(t,i){e[t]=i},get:function(t){return e[t]}}}(),c=function(e){return(e=e||{}).$type=e.$type||"basic",e.$triggers=e.$triggers||["$load"],e},d=function(e,t,i,n){if(null==e&&t)switch(t){case"number":case"integer":case"boolean":e=void 0;break;case"string":e="";break;default:e=null}if(Array.isArray(e))return n?e:JSON.stringify(e);if(i&&t&&("string"===t||"date"===t||"date-time"===t)){if(null==e)return null;"date"===t||"date-time"===t||(e="'"+e.replace(/'/g,"''")+"'")}return e},p=function(e,t){var i=t.indexOf("[");if(i<0)return null;if(!(e=0===i?e:e[t.substr(0,i)]))return null;var n=t.substr(i+1,t.length-i-2);if("*"==n||""==n)return e;var s=parseInt(n,10);return s<e.length?e[s]:null},h=function(e,t,i,n,s){var o,r=e,a=["$url","$context","$data","$item","$mem","$local"],l=typeof r;if("object"===l&&r){if(o=e.type,r=e.value,"literal"===o)return s?e:r;l=typeof r}var u=!1;if("string"===l&&r&&"["===r.charAt(0)&&"]"===r.charAt(r.length-1)&&(u=!0,r=r.substr(1,r.length-2)),"string"===l&&r&&"$"===r.charAt(0)){for(var c=r.split("."),h=0,f=null;h<c.length;){var m=c[h];if(0==h){var v,g=m,y=m.indexOf("[");y>0&&(v=m.substr(y),g=m.substr(0,y));var _=a.indexOf(g);if(!(_>=0))return o||(o=typeof r),d(r,o,i,n);f=t[a[_]],v&&c.splice(h+1,0,v)}else{if(!f)break;f="]"==m.charAt(m.length-1)?p(f,m):Array.isArray(f)?f.map(function(e){return e[m]}):f[m]}h++}return u?(o||(o=typeof f),[d(f,o,i,n)]):(o||(o=typeof f),d(f,o,i,n))}return o||(o=typeof r),d(r,o,i,n)},f=function(e,t,i,n){if("object"!=typeof e)return null;if(!Array.isArray(e)){var s={};return Object.keys(e).forEach(function(o){s[o]=h(e[o],t,i,n,!1)}),s}},m=function(e,t,i){for(var n=i.length;n--;)if(e[i[n]]!=t[i[n]])return!1;return!0},v=function(e,t){if(!e)return null;if("string"==typeof e)return h(e,t,!1,!0,!1);var i={};return Object.keys(e).forEach(function(n){"$data.documents"===e[n]?t.$data&&t.$data.documents&&(i[n]=t.$data.documents,void 0===i.pageSize&&(i.pageSize=t.$data.pageSize),void 0===i.skip&&(i.skip=t.$data.skip),void 0===i.count&&(i.count=t.$data.count),void 0===i.uri&&(i.uri=t.$data.uri)):i[n]=h(e[n],t,!1,!0,!1)}),i},g=function(e){return"and"!==e&&"or"!==e&&"$func"!==e&&("("!==e&&")"!==e&&"not"!==e)},y=function(e,i,n,s,o,r){if(e&&"object"==typeof e&&e.$op){var a={$op:e.$op,$nulls:e.$nulls,$left:null,$right:null};if("$func"===e.$op&&e.$arguments){var l=!1;if(e.$arguments.forEach(function(o,a){var u=!0;"object"==typeof o&&(u="literal"!==o.type);var c=h(o,{$url:i,$context:n,$data:null,$mem:t.$mem,$local:s},!0,!1,r);e.$arguments[a]=c,!u||"''"!==c&&null!==c&&void 0!==c||(l=!0)}),l)return a.$right=null,a.$left=null,a;e.$right=e.$arguments.join(", ")}else if("in"===e.$op&&e.$children){var u=o&&g(e.$op);if(Array.isArray(e.$children)||(e.$children=(p=e.$children,f={$url:i,$context:n,$data:null,$mem:t.$mem,$local:s},m=u,h(p,f,m,!0,!1))),e.$children.length){var c=e.$children.map(function(e){return h(e,{$url:i,$context:n,$data:null,$mem:t.$mem,$local:s},u,!1,r)});a.$right="("+c.join(",")+")",a.$left=e.$left,a.nativeIn=!0}return a}if(null!=e.$left&&("object"!=typeof e.$left||!e.$left.$op&&null!==e.$left.$op?a.$left=h(e.$left,{$url:i,$context:n,$data:null,$mem:t.$mem,$local:s},!1,!1,r):a.$left=y(e.$left,i,n,s,o,r)),null!=e.$right)if("object"!=typeof e.$right||!e.$right.$op&&null!==e.$right.$op){var d=o&&g(e.$op);a.$right=h(e.$right,{$url:i,$context:n,$data:null,$mem:t.$mem,$local:s},d,!1,r)}else a.$right=y(e.$right,i,n,s,o,r);return a}if(e&&"object"==typeof e&&null===e.$op&&null===e.$right&&e.$left){a={$left:null,$op:null,$right:null};return null!=e.$left&&("object"==typeof e.$left&&e.$left.$op?a.$left=y(e.$left,i,n,s,o,r):a.$left=h(e.$left,{$url:i,$context:n,$data:null,$mem:t.$mem,$local:s},!1,!1,r)),a}d=o&&g(e.$op);return h(e,{$url:i,$context:n,$data:null,$mem:t.$mem,$local:s},d,!1,r);var p,f,m},_=function(e){if(e&&"object"==typeof e&&e.$op){var t=_(e.$left),i=_(e.$right);if("ignore"===e.$nulls&&null==i.value)return"not"===e.op?{value:null,op:null}:{value:t.value,op:t.op};if("not"===e.$op)return{value:"not ("+i.value+")",op:e.$op};if("in"!==e.$op||e.nativeIn){if("$func"===e.$op)return{value:t.value+"("+i.value+")",op:e.$op};if("ignore"!==e.$nulls||null!=t.value&&null!=i.value){var n=t.value,s=i.value;if("and"===e.$op||"or"===e.$op){if(!n&&!s)return{value:null,op:null};if(!n)return{value:s,op:e.$op};if(!s)return{value:n,op:e.$op}}if("and"===e.$op)"or"===t.op&&(n="("+n+")"),"or"===i.op&&(s="("+s+")");else if(s&&"ignore"===e.$nulls&&"''"===s)return{value:null,op:null};return{value:n+" "+e.$op+" "+s,op:e.$op}}return"and"===e.$op||"or"===e.$op?null==i.value?{value:t.value,op:t.op}:{value:i.value,op:i.op}:{value:null,op:null}}var o=[];return(i.value||"").split(";").forEach(function(e){o.push(t.value+" eq "+e)}),{value:"("+o.join(" or ")+")",op:"in"}}if(e&&"object"==typeof e&&null===e.$op&&null===e.$right&&e.$left){return{value:_(e.$left).value,op:null}}return{value:e,op:null}},b=function(e,i,n,s){var o,r,a,l,u=(o=e,r=i,a=n,l=s,o&&"string"==typeof o?o=h(o,{$url:r,$context:a,$data:null,$mem:t.$mem,$local:l},!1,!1,!1):y(o,r,a,l,!0,!1));return _(u).value},x=function(e,i,s,o,r){var a={$url:null,$list:null,$query:null,$method:"GET"};a.$method=(e.$method||"GET").toUpperCase();var l,u;if(a.$data=e.$data?$.extend(!0,{},e.$data):null,e.$type&&(a.$type=e.$type),r){if(!e.$entity)throw"Invalid sync dataset - $params.$entity";if(a.$transactionId=e.$transactionId||"id",!a.$transactionId)throw"Invalid sync dataset -$params.$transactionId";if(a.$viewId=e.$viewId||"viewId",!a.$viewId)throw"Invalid sync dataset -$params.$viewId";l=i[a.$transactionId],u=i[a.$viewId],a.$method=l&&u?"PATCH"===e.$method?"PATCH":"GET":"POST","POST"!==a.$method&&(a.$data=null)}a.$url=e.$url||"",a.$url=n.execAngularExpression(a.$url,{$url:i,$context:s,$data:null,$mem:t.$mem,$local:o});var c=e.$query?$.extend(!0,{},e.$query):null;if(r){var d=a.$url?a.$url.split("/"):[];d.push(e.$entity),u&&l&&(d.push(u),(c=c||{}).id=l),a.$url=d.join("/")}return e.$download&&(a.$download=e.$download),e.$cookie&&(a.$cookie=e.$cookie),a.$list=e.$list,c&&(a.$query={},Object.keys(c).forEach(function(e){"$filter"===e&&c.$filter?(a.$query.$filter=b(c.$filter,i,s,o),a.$query.$filter||delete a.$query.$filter):a.$query[e]=h(c[e],{$url:i,$context:s,$data:null,$mem:t.$mem,$local:o},!1,!1,!1)})),"GET"!==e.$method&&"DELETE"!==e.$method&&(a.$data?a.$data=r?f(a.$data,{$url:i,$context:s,$data:null,$mem:t.$mem,$local:o},!1,!0):h(a.$data,{$url:i,$context:s,$data:null,$mem:t.$mem,$local:o},!1,!1,!1):a.$data=s||{}),a},C=function(e){return void 0===e||null===e||""===e||"''"===e},k=function(e,i,s,r){var l,u=r&&r.getLocalContext?r.getLocalContext():null,c=e.$data;if(e.$params&&e.$params.dataProvider){var d=o.get(e.$params.dataProvider);d&&(s=d(s,r))}return!e.$main&&e.$output?(c=e.$data,l=v(e.$output,{$url:i,$context:s,$data:c,$mem:t.$mem,$local:u})):l=c,l=a(e,l),new n.Promise(function(e,t){e(l)})},w=function(e,i,o,u){var c=e.$method||"GET",p=u&&u.getLocalContext?u.getLocalContext():null,f=function(e,i,s,o){if(!e)return null;var a={},l={$url:i,$context:s,$data:null,$mem:t.$mem,$local:o},u=e.$filter?$.extend(!0,{},e.$filter):null;if(e.$searchByFields&&e.$searchByFields.value&&e.$searchByFields.fields&&e.$searchByFields.fields.length){var c=null,p=r.config(r.name)||{},f=(e.$type?p[e.$type]:null)||p.odata||{},m=f.caseSensitive||!1;e.$searchByFields.fields.forEach(function(t){var i=t.replace(/\./g,"/"),n="'"+e.$searchByFields.value.replace(/'/g,"''")+"'";m&&(i="tolower("+i+")",n="tolower("+n+")");var s={$left:f.contains||"contains",$op:"$func",$right:i+", "+n};c=c?{$left:c,$op:"or",$right:s}:s}),e.$searchByFieldsValue=e.$searchByFields.value,e.$searchByFieldsFields=e.$searchByFields.fields,e.$allData||(u=u?{$left:u,$op:"and",$right:c}:c)}if(Object.keys(e).forEach(function(t){if("$search"!==t&&"$searchByFields"!==t)if("$entity"===t)a.$entity=h(e.$entity,l,!1,!1,!1);else if("$entityId"===t){var i=!1;if("object"==typeof e.$entityId)if(e.$entityId.value&&e.$entityId.type){var n=h(e.$entityId,l,!0,!1,!1);i=C(n),a[t]=n}else{var s=[];Object.keys(e.$entityId).forEach(function(t){var n=h(e.$entityId[t],l,!0,!1,!1);i||(i=C(n)),s.push(t+"="+n)}),a[t]=s.join(", ")}else{var o=h(e[t],l,!0,!1,!1);i=C(o),a[t]=o}i&&(a.$entityIdNull=!0)}else if("aggregate"==t&&e.aggregate)a.aggregate=e.aggregate;else if("groupby"==t&&e.groupby)a.groupby=e.groupby;else if("having"==t&&e.having)a.having=e.having;else{if("$filter"==t&&e.$filter)return;"$searchByFieldsFields"==t?a[t]=e[t]:e[t]&&(a[t]=h(e[t],l,!1,!1,!1))}}),u&&(a.$filter=b(u,i,s,o),a.$filter||delete a.$filter),e.$search&&s&&s.$searchText){var v,g=d(s.$searchText,"string",!0,!1),y=Array.isArray(e.$search)?e.$search:[e.$search];if(1===y.length)v=n.format("contains({0},{1})",e.$search.field,g);else{for(var _=["("],x=y.length,k=0;k<x;k++)_.push(n.format("contains({0},{1})",y[k].field,g)),k<x-1&&_.push(" or ");_.push(")"),v=_.join("")}a.$filter?a.$filter=a.$filter+" and "+v:a.$filter=v}return a}(l(e.$beforeExecute,e.$params,o),i,o,p);if(c&&(c=(c=h(c,o,!1,!1,!1)).toUpperCase()),f.$entityIdNull&&(delete f.$entityIdNull,"GET"===c&&e.$create)){var m=$.extend(!0,{},e.$create);return m.$create=!0,n.Promise.resolve(m)}if(c)switch(c){case"DELETE":return s.odata.doDelete(f,o.etag?o.etag:null);case"POST":return s.odata.doPost(f,o);case"PUT":var g=o["@odata.etag"];delete o["@odata.etag"];var y=null!=o["@odata.return"];return delete o["@odata.return"],s.odata.doPut(f,o,g,y);case"PATCH":var _=o["@odata.etag"];delete o["@odata.etag"];var x=null!=o["@odata.return"];return delete o["@odata.return"],s.odata.doPatch(f,o,_,x)}var k,w,E,O,S=(k=e.$data,w=i,E=o,O=p,v(k,{$url:w,$context:E,$data:null,$mem:t.$mem,$local:O})),P=r.config(r.name)||{};return void 0===e.$cache&&(P.odata&&void 0!==P.odata.cache?P.odata.cache=P.odata.cache:(P.odata=P.odata||{},P.odata.cache=!0)),o&&(o.hasOwnProperty("$skip")&&o.$skip&&(f.$skip=o.$skip),o.hasOwnProperty("$top")&&o.$top&&(f.$top=o.$top)),"relation"===e.$type&&(f.$relation=!0),s.odata.getRessources(f,function(n){"POST"!==c&&n&&(n.$create=!1),n&&n.documents&&n.documents.length||!S||(n.documents=n.documents||[],n.documents.push(S)),o&&o.hasOwnProperty("$searchText")&&(n.searchText=o.$searchText);var s=n;return!e.$main&&e.$output&&(s=v(e.$output,{$url:i,$context:o,$data:n,$mem:t.$mem,$local:p})),s=a(e,s)},e.$errors,o)},E=function(e,i,n,o){var r=o&&o.getLocalContext?o.getLocalContext():null,l=x(e.$params,i,n,r,!1);return s.local.getRessources(l,function(s){var o=s;return!e.$main&&e.$output&&(o=v(e.$output,{$url:i,$context:n,$data:s,$mem:t.$mem,$local:r})),a(e,o)})},O=function(e,i,n,o){var r=o&&o.getLocalContext?o.getLocalContext():null,u=(l(e.$beforeExecute,e.$params,n),x(e.$params,i,n,r,!1));return e.$method&&(u.$method=e.$method),s.rest.getRessources(u,!1,function(s){var o=s;return e.$output&&(o=v(e.$output,{$url:i,$context:n,$data:s,$mem:t.$mem,$local:r})),a(e,o)})},S=function(e){var t=[];return e.$emit&&(e.$emit.$loaded||e.$emit.$changed?(e.$emit.$loaded&&t.push(e.$emit.$loaded.$name),e.$emit.$changed&&t.push(e.$emit.$changed.$name)):t.push(e.$emit)),t};e.execData=function(e,o,r){var c=i.search(!0);if(!e)return null;if(e.$condition){var d=i.context();d.$context=o;var p=h(e.$condition,d,!1,!0,!1);if(!p||"false"===p)return n.Promise.resolve(null)}switch(e.$type){case"basic":return k(e,c,o,r);case"odata":return w(e,c,o,r);case"relation":return o.model?w(e,c,o,r):null;case"sync":return function(e,n,o,r){var u=r&&r.getLocalContext?r.getLocalContext():null,c=l(e.$beforeExecute,e.$params,o),d=x(c,n,o,u,!0),p=function(s){var r=s;if("GET"===d.$method&&(r.$transactionId=d.$query[d.$transactionId]),"POST"===d.$method){r=r.data;var l={};l[d.$transactionId]=s.id,l[d.$viewId]=r.id,r.$transactionId=s.id,i.changeSearch(l)}return e.$output&&(r=v(e.$output,{$url:n,$context:o,$data:s,$mem:t.$mem,$local:u})),a(e,r)};return"DELETE"!==d.$method&&"PUT"!==d.$method||(p=null),s.rest.getRessources(d,!0,p)}(e,c,o,r);case"rest":return O(e,c,o,r);case"local":return E(e,c,o,r);default:var f=u.get(e.$type);if(f)return f(e,c,o,r)}return null};var P=function(){function e(e){this.config=c(e),e.$default&&(this.defaultDataset=!0),this.config.$autoselect&&(this.autoselect=!0),this._emitters=S(this.config),this.selectedIndex=-1}return e.prototype.execute=function(e,t){var n=i.search(!0);switch(this.config.$type){case"basic":return k(this.config,n,e,t);case"odata":return w(this.config,n,e,t);case"rest":return O(this.config,n,e,t);case"local":return E(this.config,n,e,t);case"menu":return function(e,t,i,n){var o=e.$params.name;return s.menu.get(o,e.$params.localization,void 0)}(this.config);case"widget-schema":return function(e,t,i,n){var o=e.$params.name;return s.schema.get(o,e.$params.localization,void 0)}(this.config);default:var o=u.get(this.config.$type);if(o)return o(this.config,n,e,t)}throw"Invalid dataset type"},e.prototype.enumTriggers=function(e,t){this.config.$triggers&&this.config.$triggers.forEach(function(i){(e||"$load"!=i)&&t(i)})},e.prototype.enumEmitters=function(e){this._emitters.forEach(e)},e.prototype.hasCustomEvents=function(){if(this.config.$triggers){var e=this.config.$triggers;return e.length>1||"$load"!=e[0]}return!1},e.prototype.canExecute=function(e,t){if(this.config.$condition){var i=h(this.config.$condition,t,!1,!0,!1);if(!i||"false"===i)return!1}return this.config.$triggers.indexOf(e)>=0},e.prototype.data2Output=function(e,t){return v(e,t)},e.prototype.destroy=function(){n.log("Destroy Dataset","destroy")},e.prototype._findSelectedOData=function(e){if(e.documents){var n=-1,s=null;if(this.config.$autoselect&&"object"==typeof this.config.$autoselect)for(var o={$url:i.search(!0),$mem:t.$mem},r=v(this.config.$autoselect,o),a=Object.keys(r),l=0,u=e.documents.length;l<u;l++){var c=e.documents[l];if(m(c,r,a)){s=c,n=l;break}}return s?{item:s,index:n}:e.documents.length?{item:e.documents[0],index:0}:{item:null,index:-1}}return{item:null,index:-1}},e.prototype._findSelected=function(e){switch(this.config.$type){case"odata":case"rest":return this._findSelectedOData(e);default:return{item:e,index:0}}},e.prototype.doAutoSelect=function(e,t){if(this.selectedIndex=-1,this.config.$autoselect){if(!e||e.nodata)return t(null);var i=this._findSelected(e);this.selectedIndex=i.index,t(i.item)}},e}();e.DataSet=P,e.getUrlBaseByType=function(e,t){var s=r.config(r.name)||{},o=s?s[e]:null,a="";if(o&&o.base&&(a=o.base),a&&a.indexOf("{")>=0){var l=i.context({cookie:!0});a=n.formatNames(a,l)}return(t=t&&0!==a.toLowerCase().indexOf("http"))&&(a=a&&":"===a.charAt(0)?location.protocol+"//"+location.hostname+a:location.protocol+"//"+location.host+a),a},e.replaceFilterVars=function(e,n){var s=i.context();return e&&"string"==typeof e?h(e,{$url:s.$url,$context:n,$data:null,$mem:t.$mem,$local:null},!1,!1,!0):y(e,s.$url,n,null,!1,!0)},e.registerDataProvider=u.register,e.compileFilterTree=function(e,t,i,n){return y(e,t,i,n,!1,!1)},e.acceptFilter=function(e,t){return"eq"===e.$op&&t[e.$left]==e.$right},e.extractValue=function(e){e=e||"";var t=i.context();return h(e,t,!1,!1,!1)},e.execOutputData=function(e,t){if(e.$output){var n=i.context();n.$data=t[e.name],n.$context=t,t[e.name]=v(e.$output,n)}},e.test={output:v,parseTree:b}}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.dom,s=i.utils,o=(i.locale,function(e,t,i,n,s){return{number:e,text:t,icon:i,active:n,disabled:s}}),r=function(){function t(e){this._options=$.extend({boundaryLinks:!1,directionLinks:!0,rotate:!0,maxSize:4,size:"lg"},e||{}),this.pages=[],this._updating=!1,this.visible=!1,this.props={},this.data={currentPage:-1,totalPages:0,hasNext:!1,hasPrev:!1},this._defineProps()}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),t.prototype._defineProps=function(){var e=s.defineProperty;e("currentPage",this),e("totalPages",this),e("hasPrev",this),e("hasNext",this)},t.prototype._notifyChange=function(e){switch(e){case"currentPage":if(this._options.noPagesCount)return;this._changed=!0,this._updatePages();break;case"totalPages":if(this._options.noPagesCount)return;this._changed=!0,this.data.currentPage>=0&&this._updatePages();break;case"hasNext":case"hasPrev":if(!this._options.noPagesCount)return;this._changed=!0,this._updatePages()}},t.prototype._renderPager=function(){var t=this.$element.get(0);if(e.bootstrap4&&(t=t.lastChild),this.visible){var i=document.createDocumentFragment(),s=$(e.bootstrap4?'<li class="page-item"><a class="page-link bs-button" href></a><li>':"<li><a href></a><li>").get(0),o=document.createElement("span");this.pages.forEach(function(e){var t=s.cloneNode(!0);if(e.icon){var r=o.cloneNode(!0);n.attr(r,"class",n.iconClass(e.icon)),n.attr(r,"page",e.number),n.append(t.firstChild,r)}e.text&&n.text(t.firstChild,e.text),n.attr(t,"page",e.number),n.attr(t.firstChild,"page",e.number),e.disabled&&n.addClass(t,"disabled"),e.active&&n.addClass(t,"active"),i.appendChild(t)}),$(t).empty(),t.appendChild(i),n.removeClass(t,"bs-none")}else n.addClass(t,"bs-none")},t.prototype._updatePages=function(){if(!this._updating){if(this.pages=function(e,t,i,n,s){var r=[];if(i.noPagesCount)return f=o("prev",null,"chevron-left",!1,!s),r.unshift(f),f=o("next",null,"chevron-right",!1,!n),r.push(f),r;var a=1,l=t,u=i.maxSize&&i.maxSize<t;u&&(i.rotate?(l=(a=Math.max(e-Math.floor(i.maxSize/2),1))+i.maxSize-1)>t&&(a=(l=t)-i.maxSize+1):(a=(Math.ceil(e/i.maxSize)-1)*i.maxSize+1,l=Math.min(a+i.maxSize-1,t)));for(var c=a;c<=l;c++){var d=o(c,c,null,c===e,!1);r.push(d)}if(u&&!i.rotate){if(a>1){var p=o(a-1,"...",null,!1,!1);r.unshift(p)}if(l<t){var h=o(l+1,"...",null,!1,!1);r.push(h)}}var f;return i.directionLinks&&(f=o("prev",null,"chevron-left",!1,1==e),r.unshift(f)),i.boundaryLinks&&(f=o("first",null,"backward",!1,1==e),r.unshift(f)),i.directionLinks&&(f=o("next",null,"chevron-right",!1,e==t),r.push(f)),i.boundaryLinks&&(f=o("last",null,"forward",!1,e==t),r.push(f)),r}(this.data.currentPage,this.data.totalPages,this._options,this.data.hasNext,this.data.hasPrev),this._options.noPagesCount)this.visible=this.data.hasNext||this.data.hasPrev;else{this.visible=this.data.currentPage>0&&this.data.totalPages>1;var e=5;this._options.boundaryLinks||(e-=2),this._options.directionLinks||(e-=2),this.visible=this.pages.length>e}this.$element&&this._renderPager()}},t.prototype._setEvents=function(){var e=this;e.$element&&e.$element.on("click",function(t){var i=t.target,s=n.attr(i,"page");if(s){if(t.preventDefault(),t.stopPropagation(),n.hasClass(i,"disabled")||n.hasClass(i.parentNode,"disabled"))return;if(e._options.selectPage){var o=parseInt(s,10);e._options.selectPage(isNaN(o)?s:o)}}})},t.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},t.prototype.updating=function(e){this._updating=e,e?this._changed=!1:this._changed&&(this._changed=!1,this._updatePages())},t.prototype.render=function(t){this.$element||(this.$element=$((e.bootstrap4?'<nav><div class="bs-island"></div>':"")+'<ul class="no-y-margin d-inline-flex pagination'+("default"!=this._options.size?" pagination-"+this._options.size:"")+'"></ul>'+(e.bootstrap4?"</nav>":"")),this._renderPager(),this._setEvents()),t&&(this._options.replaceParent?t.replaceWith(this.$element):t.append(this.$element))},t.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null},t}();t.Pager=r}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.history,s=i.utils,o=i.external,r=i.dom,a=i.link,l=i.locale,u=i.application,c=['<div role="alert" class="bs-error alert alert-danger alert-dismissible fade show">','<button aria-label="{0}" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>',"<h4 >{1}</h4>","<p>{2}</p>","<p>",'<a class="bs-button btn btn-'+r.bootstrapStyles(!1).secondary+'" href="{4}" role="button">{3}</a>',"</p>","</div>"],d=['<div class="bs-loader"></div>'],p=null,h=function(){function e(){this.children=[],this.data={$title:"",$menuleft:!1,$menutop:!1,$menuright:!1,$menubottom:!1,$hasBack:n.hasBack(),$user:{}},this.errors=[],this.props={},this.popup=null,this.contextMenu=null,this._defineProps(),this._setEvents(),o.historyChangedHandler=this._historyChanged.bind(this)}return e.prototype._defineProps=function(){var e=s.defineProperty;e("$title",this),e("$menuleft",this),e("$menutop",this),e("$menuright",this),e("$menubottom",this),e("$hasBack",this),e("$user",this)},e.prototype.currentPage=function(){var e=a.parseUrl(window.location.hash).path;return e&&"/"===e.charAt(0)&&(e=e.substr(1)),e},e.prototype.emittersFor=function(e){var t=[],i=e.length;return this.dataListeners&&this.dataListeners.forEach(function(n){if(!n.listener.disabled&&n.emit){for(var s=!1,o=0;o<i;o++)n.emitters.indexOf(e[o])>=0&&(s=!0);s&&t.push(n.listener)}}),t},e.prototype._historyChanged=function(){this.props.$hasBack=n.hasBack()},e.prototype._notifyChange=function(e){this._notifyChildren(e,this.data[e])},e.prototype._notifyChildOnAdd=function(e,t){var i=this;if(e){if("layout"===t){var n=i.childByType("header");if(n&&n.setPage){var s=e.data.name||"";n.setPage(s,e)}}e.onPageChange&&Object.keys(i.props).forEach(function(t){e.onPageChange(t,i.props[t])})}},e.prototype._notifyChildren=function(e,t){this.children.forEach(function(i){var n=i.child;n&&n.onPageChange&&n.onPageChange(e,t)})},e.prototype.registerDataListener=function(e,t){if(this.dataListeners=this.dataListeners||[],e.datasets){var i=function(e){var t={emit:!1,listen:!0,triggers:[],emitters:[]};return Object.keys(e).forEach(function(i){if("view"!=i){var n=e[i];n.config.$emit&&n.enumEmitters(function(e){t.emit=!0,t.emitters.push(e)}),n.enumTriggers(!1,function(e){t.listen=!0,t.triggers.indexOf(e)<0&&t.triggers.push(e)})}}),t}(e.datasets);(i.emit||i.listen)&&this.dataListeners.push({listener:e,parent:t,triggers:i.triggers,listen:i.listen,emitters:i.emitters,emit:i.emit})}},e.prototype.removeDataListener=function(e){if(this.dataListeners)for(var t=this.dataListeners.length;t--;){this.dataListeners[t].listener==e&&this.dataListeners.splice(t,1)}},e.prototype.removeParentDataListener=function(e){if(this.dataListeners)for(var t=this.dataListeners.length;t--;){this.dataListeners[t].parent==e&&this.dataListeners.splice(t,1)}},e.prototype.emitDataEvent=function(e,t,i){this.dataListeners&&this.dataListeners.forEach(function(n){i&&i.indexOf(n.listen)<0||n.listen&&n.triggers.indexOf(e)>=0&&n.listener&&n.listener.dataEvent&&(n.listener.ds_storeLastEvent&&n.listener.ds_storeLastEvent(e,t),n.listener.disabled||n.listener.dataEvent(e,t))})},e.prototype.childByType=function(e){for(var t=0,i=this.children.length;t<i;t++){var n=this.children[t];if(n.type===e)return n.child}return null},e.prototype.addChild=function(e,t){this.children.push({child:t,type:e}),this._notifyChildOnAdd(t,e)},e.prototype.removeChild=function(e){for(var t=this.children.length;t--;){if(this.children[t].child==e){this.children.splice(t,1);break}}},e.prototype.destroy=function(){if(o.historyChangedHandler=null,this._hideErrors(!0),this._hideLoading(),this.children){for(var e=this.children.length;e--;){var t=this.children[e];this.removeDataListener(t.child)}this.children=null}this.dataListeners=null,this._removeEvents()},e.prototype._setEvents=function(){var e=this;$(document).on("mousedown touchstart",function(t){r.inCover(t.target)||(e._inContextMenu(t)||e._closePopup(t),e._closeContextMenu(t))}),window.onerror=function(t,i,n,s,o){!o&&i&&(o={filename:i,lineno:n||0,colno:s||0}),e.$error||(e.lastError={message:t,stack:o?o.stack:null,stackError:o&&o.stack?null:o},e._showErrors())}},e.prototype._hideErrors=function(e){this.$error&&(this.$error.off("closed.bs.alert"),e&&this.$error.remove(),this.$error=null)},e.prototype._showErrors=function(){var e=this,t=r.find(null,"error_box");if(t&&!e.$error){var i=["mailto:"];i.push(u.support),i.push("?subject="+encodeURIComponent(u.title)),i.push("&body=");var n=a.context(),o=new Date;i.push(encodeURIComponent(l.errors.ErrorTitle+" ")),i.push(encodeURIComponent(e.lastError.message)),i.push(encodeURIComponent("\n\n"+l.errors.ErrorUser+" ")),i.push(encodeURIComponent(n.$user.name)),i.push(encodeURIComponent("\n\n"+l.errors.ErrorDate+" ")),i.push(encodeURIComponent(o.toLocaleString())),i.push(encodeURIComponent("\n\n"+l.errors.Browser+" ")),i.push(encodeURIComponent(navigator.userAgent)),i.push(encodeURIComponent("\n\n"+l.errors.ErrorURI+" ")),i.push(encodeURIComponent(window.location.href)),(e.lastError.stack||e.lastError.stackError)&&(i.push(encodeURIComponent("\n\n"+l.errors.Stack+"\n")),e.lastError.stack?i.push(encodeURIComponent(e.lastError.stack)):i.push(encodeURIComponent(JSON.stringify(e.lastError.stackError)))),i.push(encodeURIComponent("\n\n"+l.errors.Context+" ")),i.push(encodeURIComponent(JSON.stringify(n))),e.$error=$(s.format(c.join(""),l.ui.Close,l.errors.Title,e.lastError.message,l.errors.SendMail,i.join(""))),e.$error.on("closed.bs.alert",function(){e._hideErrors(!1)}),t.appendChild(e.$error.get(0))}},e.prototype._hideLoading=function(){this.$loading&&(this.$loading.remove(),this.$loading=null)},e.prototype._showLoading=function(){var e=document.body;e&&(this.$loading||(this.$loading=$(d.join("")),e.appendChild(this.$loading.get(0))))},e.prototype.loading=function(e){e?this._showLoading():this._hideLoading()},e.prototype._removeEvents=function(){$(document).off("mousedown touchstart")},e.prototype._closePopup=function(e){!this.popup||this.popup.stayOnTop&&null!==e||(!e||this.popup.inPopup&&!this.popup.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(this.popup.hide&&this.popup.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),this.popup=null)},e.prototype._inContextMenu=function(e){return!!(this.contextMenu&&e&&this.contextMenu.inPopup&&this.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))},e.prototype._closeContextMenu=function(e){this.contextMenu&&(!e||this.contextMenu.inPopup&&!this.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(this.contextMenu.hide&&this.contextMenu.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),this.contextMenu=null)},e.prototype.setPopup=function(e){this._closePopup(null),this.popup=e},e.prototype.setContextMenu=function(e){this._closeContextMenu(null),this.contextMenu=e},e.prototype.activePage=function(){return{$module:u.name,$page:this.currentPage()}},e}();t.PageControl=h;t.Page=function(){return p||(p=new h),p}}(e.pagecontrol||(e.pagecontrol={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.utils,n=(t.ulocale,t.locale,t.ui,t.link),s=t.pagecontrol,o=t.dom;!function(e){var r=function(){function e(e,t){this._data=e,this._parent=t}return e.prototype.destroy=function(){if(this.$element){this.$element.off("click");var e=this.$element.get(0);o.remove(e),this.$element=null}this._parent=null,this._data=null},e.prototype.open=function(e){var r=this,a=[];!function(e,n){var s=t.bootstrap4;s?e.push('<div class="dropdown-menu bs-block bs-conntext-menu">'):e.push('<ul class="dropdown-menu bs-block bs-conntext-menu">'),n.forEach(function(t){t.id=t.id||i.allocID(),s?t.separator?e.push('<div class="dropdown-divider bs-cursor-d"></div>'):(e.push('<a class="dropdown-item'+(t.disabled?" disabled":" bs-cursor-p")+'" data-phoenix-href="click://'+t.id+'">'),e.push(i.escapeHtml(t.title)),e.push("</a>")):t.separator?e.push('<li role="separator" class="divider bs-cursor-d"></li>'):(e.push("<li"+(t.disabled?' class="disabled"':' class="bs-cursor-p"')+'><a data-phoenix-href="click://'+t.id+'">'),e.push(i.escapeHtml(t.title)),e.push("</a></li>"))}),s?e.push("</div>"):e.push("</ul>")}(a,r._data),r.$element=$(a.join("")),r.$element.on("click",function(e){var t=n.isCustomLink(r.$element.get(0),e,!0);if(t&&"click"===t.protocol){var i=t.value.substring("click://".length),o=r._data.find(function(e){return e.id===i});o&&r._parent&&r._parent.contextMenu&&r._parent.contextMenu(o)}s.Page().setContextMenu(null)});var l=r.$element.get(0);l.style.left=e.pageX+"px",l.style.top=e.pageY+"px",o.append(document.body,r.$element.get(0))},e.prototype.hide=function(e){this.destroy()},e.prototype.inPopup=function(e){return this.$element&&o.isChildOf(this.$element.get(0),e)},e}();e.openContextMenu=function(e,t,i){var n=new r(i,t);n.open(e),s.Page().setContextMenu(n)}}(e.contextmenu||(e.contextmenu={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.utils,n=t.ulocale,s=t.locale,o=(t.ui,t.dom);!function(t){var r=function(e,t,i){e=function(e){if("close"===e.pattern){var t={close:!0,type:"default",name:"close",title:s.ui.Close};return $.extend({},t,e)}if("validate"===e.pattern){var i={close:!1,type:"success",name:"validate",title:s.ui.Validate};return $.extend({},i,e)}if("create"===e.pattern){var n={close:!1,type:"success",name:"create",title:s.ui.Create};return $.extend({},n,e)}return e}(e),t.push('<button data-action="'+e.name+'" type="button"'),t.push(' class="bs-btn-inline float-right bs-button btn btn-'+e.type||"default"),t.push('"'),e.close&&t.push(' data-dismiss="modal"'),t.push(">"),e.icon&&(t.push('<span class="'+o.iconClass(e.icon)+'"></span>'),e.title&&t.push("&nbsp;")),t.push(n.tt(e.title||"",i)),t.push("</button>")},a=function(){function t(e,t){this.options=e||{},this.$id=i.allocID(),this.$locale=t}return t.prototype._removeEvents=function(){this.$element.off("click"),this.$element.off("hidden.bs.modal")},t.prototype._execAction=function(e){this._clickHnd&&this._clickHnd(e)},t.prototype._addEvents=function(){var e=this;e.$element.on("hide.bs.modal",function(t){e._inProcessing&&(t.preventDefault(),t.stopPropagation())}),e.$element.on("hidden.bs.modal",function(t){e._clear()}),e.$element.on("click",function(t){if(e.$element)for(var n=t.target,s=e.$element.get(0);n;){var o=n.getAttribute("data-action");if(o)return i.focusDelay(function(){return e._execAction(o)});n=n==s?null:n.parentNode}})},t.prototype._clear=function(){this.$element&&(this._removeEvents(),this.render&&this.render.destroy(),this.$element.remove(),this.$element=null),this.render=null},t.prototype.processing=function(e){this._inProcessing=e,o.processing(e),this.render&&this.render.processing&&this.render.processing(e)},t.prototype.on=function(e){this._clickHnd=e},t.prototype.close=function(){var t=e.modalPlugin;this.$element&&this.$element[t]("hide")},t.prototype.open=function(){var t={id:this.$id,title:this.options.title||"",buttons:this.options.buttons||[],size:0};if(this.options.size&&(t.size=this.options.size),!this.$element){this.$element=$(function(t,s){var o=e.bootstrap4,a=['<div class="modal fade" data-backdrop="static"  id="{0}" role="dialog" aria-labelledby="{0}_label">','\t<div class="modal-dialog'+(t.size?" modal-"+t.size:"")+'" role="document">','\t\t<div class="modal-content">','\t\t<div class="modal-header">',o?'\t\t\t<h5 class="modal-title" id="{0}_label">{1}</h5>':"",'\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',o?"":'\t\t\t<h4 class="modal-title" id="{0}_label">{1}</h4>',"\t\t</div>",'\t\t<div class="modal-body" id="{0}_body">',"\t\t</div>",'\t\t<div class="modal-footer"  id="{0}_footer">'];return t.buttons&&t.buttons.forEach(function(e){r(e,a,s)}),a.push("\t\t</div>"),a.push("\t\t</div>"),a.push("\t</div>"),a.push("</div>"),i.format(a.join(""),t.id,n.tt(t.title,s))}(t,this.$locale)),this.render&&this.render.render($(o.find(this.$element.get(0),this.$id+"_body"))),o.append(document.body,this.$element.get(0));var s=e.modalPlugin;this.$element[s]&&(this.$element[s]({}),this._addEvents())}},t.prototype.destroy=function(){this._clear()},t}();t.Modal=a}(e.modal||(e.modal={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.data,s=i.link,o=i.$mem,r=i.utils,a=function(e,t,i,n){if(t.config.$emit[n].$updateMem){var s=t.data2Output(t.config.$emit[n].$updateMem,{$item:i});o=$.extend(o,s)}if(t.config.$emit[n].$updateLocal){var r=e.getLocalContextHandler?e.getLocalContextHandler():null;if(r){var a=t.data2Output(t.config.$emit[n].$updateLocal,{$item:i});r=$.extend(r,a)}}},l=function(e,t,i,o,a,l,u,c){var d=function(e){return c?i?i[e]:null:i},p=e,h=[],f=[],m=o||{},v="$load"==t,g=-1,y=function(e,t,i){if(p&&p.datasets){var n=p.datasets[e];n&&(h.push(n.execute(i,p)),f.push(e),n.defaultDataset&&(g=t.length-1))}};l?l&&Array.isArray(l)?l.forEach(function(e){"object"==typeof e?e.name&&(h.push(n.execData(e,d(e.name),p)),f.push(e.name)):y(e,f,d(e))}):y(l,f,d(l)):p&&p.datasets&&Object.keys(p.datasets).forEach(function(e){var i=p.datasets[e],n=(s.search(!0),p.ds_context());i&&i.canExecute(t,n)&&y(e,f,d(e))}),h.length?(p&&p.loadingHandler&&p.loadingHandler(!0),r.Promise.all(h).then(function(e){var t=[];f.forEach(function(i,n){var s=e[n];if(n==g&&p&&p.noDataHandler&&p.noDataHandler(!s||s.nodata,null,!0),m[i]=s,p){var o=p.datasets&&p.datasets[i];if(v&&o&&o.$menu&&p.updateMenuHandler){var r=i.split("_");t.push({name:r[r.length-1],data:s})}if(o&&(p.ds_loaded(i,s),o.autoselect))return o.doAutoSelect(s,function(e){p.ds_select(i,e)})}}),p&&p.loadingHandler&&p.loadingHandler(!1),t.forEach(function(e){p.updateMenuHandler(e.name,e.data)}),a(!0),p&&p.watchersHandler&&p.watchersHandler(f),!v&&u&&p&&p.dataChangedHandler&&p.dataChangedHandler(f)}).catch(function(e){e&&console.log(e),p&&p.loadingHandler&&p.loadingHandler(!1),p&&p.errorHandler&&p.errorHandler(e),a(!1,e),!v&&u&&p&&p.dataChangedHandler&&p.dataChangedHandler(f)})):a(!0)},u=function(){function e(){}return e.prototype.ds_init=function(e){var t=this,i=!1;if(t.props=t.props||{},t.props.data=t.props.data||{},t.props.data.ds={},e.datasets||e.$resources||e.$schema||e.$menus){t.datasets&&t.ds_destroy();var s=e.$resources||e.$schema;s&&(t.props.data.ds.view=null,t.datasets=t.datasets||{},t.datasets.view=new n.DataSet({$type:"widget-schema",$params:{name:s,localization:e.$localization}}),t.datasets.view.$schema=!0),e.$menus&&Object.keys(e.$menus).forEach(function(i){var s="$menu_"+i;t.props.data.ds[s]=null,t.datasets=t.datasets||{},t.datasets[s]=new n.DataSet({$type:"menu",$params:{name:e.$menus[i]+"-"+i}}),t.datasets[s].$menu=!0}),e.datasets&&Object.keys(e.datasets).forEach(function(s){t.props.data.ds[s]=null,t.datasets=t.datasets||{};var o=new n.DataSet(e.datasets[s]);t.datasets[s]=o,i||(i=o.hasCustomEvents()||o.config.$emit)})}return i},e.prototype.ds_storeLastEvent=function(e,t){this._lastEvent={event:e,value:t}},e.prototype.ds_LastEvent=function(){if(this._lastEvent){var e=this._lastEvent;return this._lastEvent=null,e}return null},e.prototype.ds_destroy=function(){r.log("Destroy Dataset Part","destroy");var e=this;e._lastEvent=null,e.datasets&&(Object.keys(e.datasets).forEach(function(t){e.datasets[t].destroy()}),e.datasets=null)},e.prototype.ds_context=function(){var e={$url:s.search(!0),$mem:o,$local:this.getLocalContextHandler?this.getLocalContextHandler():null},t=this.props.data.ds;return t&&Object.keys(t).forEach(function(i){e[i]=t[i]}),e},e.prototype.ds_reemit=function(e,t){var i=this;if(i.datasets){Object.keys(i.datasets).forEach(function(e){var t=i.props.data.ds[e],n=i.datasets[e];n.defaultDataset&&i.noDataHandler&&i.noDataHandler(!t||t.nodata,null,!0),i.ds_loaded(e,t),n.autoselect&&n.doAutoSelect(t,function(t){i.ds_select(e,t)})})}return t()},e.prototype.ds_select=function(e,t){if(this.datasets&&this.datasets[e]){var i=this.datasets[e];i.config.$emit&&this.emitHandler&&(i.config.$emit.$changed&&a(this,i,t,"$changed"),this.emitHandler(i.config.$emit.$changed?i.config.$emit.$changed.$name:i.config.$emit,t))}},e.prototype.ds_loaded=function(e,t){if(this.datasets&&this.datasets[e]){var i=this.datasets[e];i.config.$emit&&i.config.$emit.$loaded&&(a(this,i,t,"$loaded"),this.emitHandler(i.config.$emit.$loaded.$name,t))}},e.prototype.ds_exec=function(e,t,i,n,s,o){l(this,e,t,i,n,s,o)},e}();t.DatasetMethods=u,t.executeDatasets=function(e,t,i,n,s,o){var r={loadingHandler:n&&n.loading?n.loading:null,errorHandler:n&&n.error?n.error:null};l(r,"",t,i,s,e,!1,o)}}(e.DatasetPlugin||(e.DatasetPlugin={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.dom,s=i.utils,o=i.locale,r=i.ulocale,a=function(e,t,i){var s=["bs-island bs-widget"];return n.parseStyle(e.$style,s),e.$border&&s.push("border"),t.design&&s.push("design"),i&&s.push("selected"),s.join(" ")},l=function(e){if(!e)return"";return"height:"+((e+"").indexOf("%")>0?e:parseInt(e,10)+"px")+";"},u=function(e,t,i,o,a){e.push('<div class="bs-widget-title'+(a?" bs-widget-content-inv-x":"")+(i.$titleIsHidden&&!a?" bs-none":"")+'" id="'+t+'_title">');var l=r.localeTitle(i.$title)||"";o&&(l=r.tt(i.$title||"",o)),e.push(s.escapeHtml(l+" ")),i.icons&&i.icons.length&&i.links&&i.icons.forEach(function(t){var s=i.links[t.link];s&&s.$icon&&(e.push('<a class="bs-widget-title-icon" data-phoenix-href="link://'+t.link+'">'),e.push('<span class="'+n.iconClass(s.$icon)+'"></span>'),e.push("</a>"))}),e.push("</div>")},c=function(e,t,i,n,s,o){!function(e,t,i,n){e.push('<div class="'),e.push(a(t.$config,i,t.$selected)),e.push('"'),i.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push(">"),u(e,t.$id,t.$config,n,!1),e.push('<div class="bs-widget-content bs-widget-content-id"');var s=l(t.$config.$height);s&&e.push(' style="'+s+'"'),e.push(">")}(e,t,s,o),e.push("</div></div>")};t.toHtml=function(e,t,i,n,s){var o=[];return c(o,e,0,0,t,s),o.join("")},t.cssClass=a,t.heightText=l,t.loader=function(){return $('<div class="bs-loader"></div>')},t.error=function(){return $('<div class="alert alert-danger" role="alert"><span class="'+n.iconClass("exclamation-circle")+'" aria-hidden="true"></span><span></span></div>')},t.widgetTitle=u,t.settings=function(){return $('<span class="bs-module-settings '+n.iconClass("cog")+'" ></span>')},t.warning=function(){return $('<div class="alert alert-warning" role="alert"></div>')},t.noData=function(e,t){var i=[],s=!1!==t;return t=t&&!0!==t||"cloud",i.push('<div class="bs-widget-content nodata">'),i.push('<div class="bs-no-data-inside">'),s&&i.push('<center class="nodata-image"><i class="'+n.iconClass(t)+' nodata-icon"></i></center>'),i.push('<center><h4 class="nodata-text">'),i.push(e||o.layouts.NoData),i.push("</h4></center>"),i.push("</div>"),i.push("</div>"),$(i.join(""))}}(e.WidgetUtils||(e.WidgetUtils={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.dom,s=i.utils,o=(i.locale,i.WidgetUtils),r=i.DatasetPlugin,a=i.link,l=i.render,u=function(){function e(e,t,i){this.item=e||{},this.item.$id||(this.item.$id=s.allocID()),e.$config=e.$config||{},e.$config.data=e.$config.data||{},this.data=e.$config,this.props={},this.item.$render=this.props,this.props.data=e.$config.data,this.options=t||{},this.contentRender=null,this.links=e.$config.links,this._defineProps(),this.layout=i,this.$local={},this.loadingHandler=this.loading.bind(this),this.noDataHandler=this.noData.bind(this),this.errorHandler=this.error.bind(this),this.emitHandler=this.emit.bind(this),this.getLocalContextHandler=this.getLocalContext.bind(this),this.dataChangedHandler=this.dataChanged.bind(this),this.updateMenuHandler=null,this._watchers={},this.props.data.localContext&&$.extend(this.$local,this.props.data.localContext),this.ds_init(this.data)&&this._listen()}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,i,n,s,o){},e.prototype._defineProps=function(){var e=s.defineProperty;e("$title",this),e("$border",this),e("$height",this),e("$titleIsHidden",this),e("$settings",this)},e.prototype._notifyChange=function(e){switch(e){case"$title":this._updateTitle();break;case"$border":case"$titleIsHidden":this._updateCssClass();break;case"$height":this._updateHeight()}},e.prototype._listen=function(){this.layout&&this.layout.registerDataListener(this)},e.prototype._unlisten=function(){this.layout&&this.layout.removeDataListener(this)},e.prototype.on=function(e,t){this.handlers=this.handlers||{},this.handlers[e]=t},e.prototype._exec=function(e){this.handlers&&this.handlers[e]&&this.handlers[e]()},e.prototype._setEvents=function(){var e=this,t=e.$element.get(0);e.$element.on("click",function(i){var n=i.target;e.$settings&&n===e.$settings.get(0)&&e._exec("settings");var s=a.isCustomLink(t,i);s&&a.execCustomProtocol(s,e.ds_context(),{links:e.links},null)})},e.prototype.executeLink=function(e,t){var i=a.isCustomProtocol(e);i&&a.execCustomProtocol({protocol:i,value:e},this.ds_context(),{links:this.links},t)},e.prototype._removeEvents=function(){this.$element.off("click")},e.prototype.dataChanged=function(e){this.onDSChanged&&this.onDSChanged(e),this.contentRender&&this.contentRender.dataChanged?this.contentRender.dataChanged():this.options.onDataChanged&&this.options.onDataChanged()},e.prototype.execDataSet=function(e,t,i,n,s){n=n||this.props.data.ds,this.ds_exec(null,t,n,i||function(){},e,s)},e.prototype._loadData=function(e){if(!this.datasets)return e(!1);this.ds_exec("$load",null,this.props.data.ds,e,null,!0)},e.prototype._updateTitle=function(){if(this.$element){var e=n.find(this.$element.get(0),this.item.$id+"_title");e&&n.text(e,this.data.$title||"")}},e.prototype._cleanErrors=function(e){this.$loader&&(this.$loader.remove(),this.$loader=null),e||(this.$settings&&n.addClass(this.$settings.get(0),"bs-none"),this.$noData&&(this.$noData.remove(),this.$noData=null),this.$error&&(this.$error.remove(),this.$error=null),this.$warning&&(this.$warning.remove(),this.$warning=null))},e.prototype.loading=function(e){this._cleanErrors(!e);var t=this.$element?this.$element.get(0):null;t&&(e?(n.addClass(t,"loading"),this.$loader||(this.$loader=o.loader(),this.$element.append(this.$loader))):n.removeClass(t,"loading")),e||this.settings()},e.prototype._linksState=function(e){if(this.$element){var t=this.$element.get(0),i=n.find(t,this.item.$id+"_title");if(i){var s=n.queryAll(i,".bs-widget-title-icon");[].forEach.call(s,function(t){e?n.removeClass(t,"bs-none"):n.addClass(t,"bs-none")})}}},e.prototype.noData=function(e,t,i){if(!t&&this.props.data.$noDataMessage&&(t=this.props.data.$noDataMessage),this._cleanErrors(!1),this.$element){var s=this.$element.get(0),r=n.query(s,".bs-widget-content-id");if(r&&(e?n.addClass(r,"bs-none"):n.removeClass(r,"bs-none"),this._linksState(!e)),e){this.$noData=o.noData(t,i);if(this._updateHeight(this.$noData)){var a=n.query(this.$noData.get(0),".bs-no-data-inside");n.addClass(a,"centred")}var l=n.find(s,this.item.$id+"_title");l&&n.after(l,this.$noData.get(0))}}},e.prototype.getLocalContext=function(){return this.$local},e.prototype.settings=function(){var e=this.data.$settings&&!this.$error&&!this.$warning&&!this.$noData;if(this.$settings)e?n.removeClass(this.$settings.get(0),"bs-none"):n.addClass(this.$settings.get(0),"bs-none");else if(e){this.$settings=o.settings();var t=n.find(this.$element.get(0),this.item.$id+"_title");t&&n.after(t,this.$settings.get(0))}},e.prototype.error=function(e){var t=e;e&&e.message&&(t=e.message);this._cleanErrors(!1);var i=this.$element?this.$element.get(0):null;if(i){this.$error=o.error();var s=this.$error.get(0);n.text(s.lastChild," "+t);var r=n.find(i,this.item.$id+"_title");r&&n.after(r,s)}},e.prototype.warning=function(e){this._cleanErrors(!1);var t=this.$element?this.$element.get(0):null;if(t){this.$warning=o.warning();var i=this.$warning.get(0);n.text(i,e);var s=n.find(t,this.item.$id+"_title");s&&n.after(s,i)}},e.prototype._updateHeight=function(e){var t=(e=e||this.$element)?e.get(0):null;return t&&(t.style.cssText=o.heightText(this.props.$height)),!!this.props.$height},e.prototype._updateCssClass=function(){var e=this.$element?this.$element.get(0):null;e&&(e.className=o.cssClass(this.data,this.options))},e.prototype._internalRenderContent=function(e,t,i){var n=l.get(this.options.context,"widget.content.control."+this.data.$type);if(this.$element){if(n)this.contentRender=new n(this.props,{context:this.options.context,replaceParent:!1},this);else{var s=l.get(this.options.context,"widget.content");if(s){var o=[];s(o,this.data,this.options),e.append($(o.join("")))}}this.options.beforeAdd&&this.options.beforeAdd(e,i),this.contentRender&&this.contentRender.render(e),t&&this.$element.append(e)}},e.prototype.watchersHandler=function(e){var t=this;e&&e.forEach(function(e){var i=t._watchers[e];i&&i.forEach(function(i){i(t.props.data.ds[t.props.data.ds[e]])})})},e.prototype.render=function(e){var t=this;if(t.$loader=null,t.$error=null,!t.$element){t.layout.controls[t.item.$id]=this,t.$element=$(o.toHtml(t.item,t.options,null,null,null)),t._setEvents();var i=t.$element.get(0),s=n.query(i,".bs-widget-content-id");t._loadData(function(e){t._internalRenderContent($(s),!1,e),t.settings()}),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))}},e.prototype.emit=function(e,t,i){this.layout&&this.layout.emitDataEvent(e,t,i)},e.prototype.dataEvent=function(e,t){this.ds_exec(e,t,this.props.data.ds,function(){},null,!0)},e.prototype.destroy=function(){s.log("Destroy Module","destroy");this.contentRender&&(this.contentRender.destroy(),this.contentRender=null),this._unlisten(),this.ds_destroy(),this._cleanErrors(!1),this.item.$render=null,this.$settings&&(this.$settings=null),this.$element&&(this._removeEvents(),this.$element=null),this.layout=null,this.ondatasets=null},e.prototype.watch=function(e,t){var i=this;if(i._watchers){(i._watchers[e]=i._watchers[e]||[]).push(t),i.props&&i.props.data.ds&&s.nextTick(function(){t(i.props.data.ds[e])})}},e.prototype.unwatch=function(e,t){if(this._watchers){var i=this._watchers[e];if(i){var n=i.indexOf(t);n>=0&&i.splice(n,1)}}},e}();t.Widget=u,s.applyMixins(u,[r.DatasetMethods])}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.pagecontrol,s=i.utils,o=(i.ulocale,i.link),r=i.$mem,a=i.DatasetPlugin,l=i.dom,u=function(e,t,i,n,o){t&&t.forEach(function(t){void 0===t.$level&&(t.$level=o),t.$id=s.allocID(),n&&(t.$parentId=n.$id),i.push(t),t.$items&&t.$items.length?(void 0===t.collapsed&&(t.collapsed=!!e.canExpandItems),u(e,t.$items,i,t,o+1)):t.collapsed=!1})},c=function(){function e(e,t){this._initOptions(t),this.init(e,t)}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,i,n,s,o){},e.prototype._initOptions=function(e){},e.prototype.emit=function(e,t,i){this.emitDataEvent(e,t,i)},e.prototype.init=function(e,t){s.log("Create Menu","menu");this.loadingHandler=this.loading.bind(this),this.noDataHandler=null,this.errorHandler=null,this.emitHandler=this.emit.bind(this),this.getLocalContextHandler=null,this.dataChangedHandler=null,this.updateMenuHandler=null,this.$element=null,this.$items=null,this.options=t||{},this.options.typeMenu=this.options.type||"left",this.data={name:"none"},this.page=n.Page(),this.page.addChild("menu-"+this.options.typeMenu,this),this.setMenu(e)},e.prototype.loading=function(e){this.page.loading(e)},e.prototype.registerDataListener=function(e){this.page&&this.page.registerDataListener(e,this)},e.prototype.removeDataListener=function(e){this.page&&this.page.removeDataListener(e)},e.prototype.emitDataEvent=function(e,t,i){this.page&&this.page.emitDataEvent(e,t,i)},e.prototype.onPageChange=function(e,t){if("$user"===e&&this.items&&this.options.auth&&!this.options.autoClose){var i=this.page.props.$user&&this.page.props.$user.connected;if(i){var n=l.find(null,this.options.parentId);n?this.show($(n)):this._showContent()}else this.$content&&!i&&this._hideContent()}"$title"===e&&this._onPageChanged()},e.prototype.setMenu=function(e){s.log("Set Menu","menu");var t=this,i=null!=e;(e=e||{name:"none"}).$groups||(e.$groups=[{$items:e.$items}]),t.data.name!==e.name||void 0===e.name?(s.log("Menu create && execute datasets","menu"),t.data=e,t.items=null,t._map={},t._recreateDatasets(),t.ds_exec("$load",null,t.props.data.ds,function(){var e=!t.options.autoClose&&t.options.parentId&&i;if(e&&t.options.auth&&(e=t.page.props.$user&&t.page.props.$user.connected),t._prepareItems(),t.$content)if(t._removeContent(),i)if(e){var n=l.find(null,t.options.parentId);n&&(t.render(),t.show($(n)))}else t.render();else t._hideContent();else if(e){var s=l.find(null,t.options.parentId);s&&t.show($(s))}t.page.props["$menu"+t.options.typeMenu]=i&&t.options.autoClose},null,!0),t._onPageChanged()):(s.log("Menu reexecute datasets","menu"),t.ds_reemit(null,function(){t._onPageChanged(),t.page.props["$menu"+t.options.typeMenu]=i&&t.options.autoClose}))},e.prototype._onPageChanged=function(){},e.prototype._doCloseClick=function(){},e.prototype._menuShowed=function(){},e.prototype._executeLink=function(e,t){},e.prototype._executeContextMenu=function(e,t,i){return!1},e.prototype._setEvents=function(){var e=this,t=e.$content.get(0);e.$content.on("click",function(i){var n=o.isCustomLink(t,i,!0);if(n&&"click"===n.protocol){var s=n.value.substring("click://".length);if("close"===s){if(e._doCloseClick)return e._doCloseClick()}else{if(0===s.indexOf("collapse/")){var r=(s=s.substring("collapse/".length)).split("/"),a=e.items[parseInt(r[0],10)];return void(a&&(e.colapse(a,!a.collapsed,!1),e.updateItemsAfterCollapse()))}var l=s.split("/");e._executeLink(e.items[parseInt(l[0],10)],l.length>1?l[1]:null)}}e.options.autoClose&&e.hide()}),e.$content.contextmenu(function(i){if(e.options.noContextMenu)return i.preventDefault(),!1;var n=o.isCustomLink(t,i,!0);if(n&&"click"===n.protocol){var s=n.value.substring("click://".length);if("close"===s);else if(0===s.indexOf("collapse/"));else{var r=s.split("/");if(e._executeContextMenu(i,e.items[parseInt(r[0],10)],r.length>1?r[1]:null))return i.preventDefault(),!1}}})},e.prototype.updateItemsAfterCollapse=function(){},e.prototype.renderItems=function(e){return null},e.prototype._removeEvents=function(){this.$content.off("click"),this.$content.off("contextmenu")},e.prototype._loadData=function(e){if(!this.datasets)return e(!1);this.ds_exec("$load",null,this.props.data.ds,e,null,!0)},e.prototype._expandItem=function(e,t,i,n,o,r){var a={$title:"",$item:e,$index:r,$link:o};return a.$title=s.parseVariable(n,{$item:e,$url:t,$mem:i}),a},e.prototype._expandDatasetItems=function(e,t,i){var n=this,s=n.props.data.ds[e];if(s){var a=[],l=o.search(!0),u=r;if(s.documents){if(!s.documents.length)return null;s.documents.forEach(function(e,s){a.push(n._expandItem(e,l,u,t,i,s))})}else a.push(n._expandItem(s,l,u,t,i,-1));return a}return null},e.prototype.copyMenuItemData=function(e,t){},e.prototype.isVisible=function(e){if(e.$parentId&&this.options.canExpandItems){for(var t=!0,i=e;i&&i.$parentId;)if((i=this._map[i.$parentId])&&i.collapsed){t=!1;break}return t}return!0},e.prototype.colapseAll=function(e){this.items.forEach(function(t){t.collapsed=e})},e.prototype.colapse=function(e,t,i){var n=this;e.collapsed=t,e.$items&&e.$items.forEach(function(e){e.collapsed=t,i&&e.$items&&n.colapse(e,t,!0)})},Object.defineProperty(e.prototype,"search",{get:function(){return this._search},set:function(e){this._search!==e&&(this._search=e,this._updateSearch()),this._search=e},enumerable:!0,configurable:!0}),e.prototype._updateSearch=function(){},e.prototype._prepareItems=function(){var e=this;if(e._searchList=[],e.items=[],e.data.$groups){var t=!0;e.data.$groups.forEach(function(i,n){var r=null;if(0===n&&(i.$title=i.$title||String.fromCharCode(160)),i.$dataset){if(!i.$link)throw"Invalid link definition. (no link)";if(!i.$itemtitle)throw"Invalid link definition. (no itemtitle)";r=e._expandDatasetItems(i.$dataset,i.$itemtitle,i.$link)}else r=i.$items;if(r&&r.length){var a=[];if(u(e.options,r,a,null,0),r=a,!t||i.$title||0===n||i.$dataset){var l={$id:s.allocID(),divider:!0,$title:null,$firstGroup:0===n,dataset:"",isHidden:!1,collapsed:!1};l.$title=i.$title,i.dataset&&(l.dataset=i.$dataset,t&&(l.isHidden=!0)),e._map[l.$id]=l,e.items.push(l),t=!1}}if(r){var c=i.$dataset?e.datasets[i.$dataset]:null;r.forEach(function(n,r){var a={$id:n.$id,$parentId:n.$parentId,$title:n.$title?s.parseExpression(n.$title,o.context()):null,$dataset:null,dataset:null,$index:0,$item:null,$link:null,$level:n.$level,selected:!1,collapsed:n.collapsed,$items:n.$items};i.dataset&&(a.dataset=i.$dataset),n.$link&&(a.$link=n.$link),c&&c.autoselect&&(a.selected=c.selectedIndex==r),e.copyMenuItemData(a,n),c&&(a.$dataset=i.$dataset,a.$index=n.$index,a.$item=n.$item),e._map[a.$id]=a,e.items.push(a),a.$title&&e._searchList.push({id:a.$id,title:a.$title}),t=!1})}})}},e.prototype._removeContent=function(){this.$element&&(this.$element.remove(),this.$element=null)},e.prototype.renderContent=function(){return $("<aside></aside>")},e.prototype.show=function(e){var t=this;if(!e&&t.options.parentId){var i=l.find(null,t.options.parentId);i&&(e=$(i))}t.$content?t._showContent():(t.render(e),t.options.autoClose?s.nextTick(function(){t._showContent()}):t._showContent()),t.options.autoClose&&t.page.setPopup(t)},e.prototype.hide=function(e){this.$content&&this._hideContent(e)},e.prototype._hideContent=function(e){var t=this.$content.get(0);l.addClass(t,"bs-none")},e.prototype._showContent=function(){var e=this.$content.get(0);l.removeClass(e,"bs-none"),this._menuShowed()},e.prototype.render=function(e){var t=this.$content;if(t||(t=this.renderContent()),this.$element||(this.$element=this.renderItems(t),t.append(this.$element)),e&&!this.$content){if(this.$content=t,this.options.replaceParent){var i=e.get(0);if(i&&i.id){var n=this.$content.get(0);n&&(n.id=i.id)}e.replaceWith(this.$content)}else e.append(this.$content);this._setEvents()}},e.prototype._recreateDatasets=function(){this.ds_destroy(),this.removeDataListener(this),this.ds_init(this.data)&&this.registerDataListener(this)},e.prototype.destroy=function(){s.log("Destroy Menu","destroy"),this.ds_destroy(),this.removeDataListener(this),this.$content&&(this._removeEvents(),this.$content=null),this.$element=null,this.page&&(this.page.removeChild(this),this.page=null)},e.prototype.inPopup=function(e){if(!this.options.autoClose)return!0;if(!e)return!0;if(this.$content)for(var t=this.$content.get(0),i=e;i;){if(i==t)return!0;i=i.parentNode}return!1},e}();t.MenuBase=c,s.applyMixins(c,[a.DatasetMethods])}(e.menubase||(e.menubase={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i="#/definitions/",n=i.length;t.INDEX_FIELD_NAME="$index",t.SELECTED_FIELD_NAME="$select",t.EXPANDED_FIELD_NAME="$expand";var s=e.ulocale,o=e.external,r=e.application,a=(e.ajax,e.dom),l=(e.link,e.data),u=e.utils,c=(s=e.ulocale,e.locale),d=e.customData,p=e.locale.schema,h=e.DatasetPlugin,f=[t.INDEX_FIELD_NAME,t.SELECTED_FIELD_NAME,t.EXPANDED_FIELD_NAME],m=function(e){if(!e.features){e.features={};var t=void 0===e.capabilities?"filtrable,sortable":e.capabilities;t&&t.split(",").forEach(function(t){e.features[t]=!0})}},v=function(e,t){if(e.$ref){var i=e.$ref.substr(n),s=t.definitions?t.definitions[i]:null;if(!s)throw"Schema $ref not found : "+e.$ref;return s}return e},g=function(){var e={};return{register:function(t,i){e[t]=i},get:function(t){return e[t]}}}(),y=function(){var e={};return{register:function(t,i){e[t]=i},get:function(t){return e[t]}}}();function _(e,t,i,n,s,o,r){o(i,e,t,s,n,r=r||{})&&Object.keys(e.properties).forEach(function(n){var a=e.properties[n];if(!a.$reference||r&&r.$references)if(!a.type&&a.$ref&&(a=v(a,t)),"object"===a.type){_(a,t,u=i?i+"."+n:n,!1,s?s[n]:null,o,r)}else if("array"===a.type){var l=v(a.items,t);if("object"===l.type){var u=i?i+"."+n:n;r.currentRef=a.items.$ref,_(l,t,u,!0,s?s[n]:null,o,r)}}})}function b(e,t){if(!t.definitions)throw new Error("schema.definitions is null");var s=e,o=s.indexOf(i);if(o<0)throw new Error(u.format("Invalid $ref. ({0})",s));var r=s.substring(o+n);return t.definitions[r]}function x(e,t,i){var n=null;return e.allOf?(n=e.allOf,delete e.allOf):e.$ref&&t.indexOf(e.$ref)<0&&(n=[{$ref:e.$ref}],e.ux&&(n[0].ux=!0),delete e.$ref),n&&n.forEach(function(n){var s=t.slice(0);if(n.$ref){var o=b(n.$ref,i);n.ux&&(o.properties&&Object.keys(o.properties).forEach(function(e){var t=o.properties[e];void 0===t.ux&&(t.ux=!0)}),o.links&&Object.keys(o.links).forEach(function(e){var t=o.links[e];void 0===t.ux&&(t.ux=!0)})),"array"!==n.type&&"array"!==o.type&&s.push(n.$ref),delete n.$ref,u.merge(o,n)}C(n,s,i),u.merge(n,e)}),n}function C(e,t,i){x(e,t.slice(0),i);var n=null;e.properties?n=e:"array"===e.type&&e.items&&(n=e.items),n&&n.properties&&Object.keys(n.properties).forEach(function(e){var s=n.properties[e];(s.allOf||s.$ref)&&x(s,t,i),"array"===s.type&&s.items&&(s.items.allOf||s.items.$ref)&&x(s.items,t,i)})}var k={RATE_DECIMALS:2,RATE_MAXIMUM:1e3,RATE_SYMBOL:"%",expandSchema$Ref:function(t){return t.definitions&&Object.keys(t.definitions).forEach(function(i){var n=t.definitions[i];if(n.allOf){var s=n.allOf;delete n.allOf,s.forEach(function(i){if(i.$ref){var s=$.extend(!0,{},b(i.$ref,t));delete i.$ref,i.ux&&(s.properties&&Object.keys(s.properties).forEach(function(e){var t=s.properties[e];void 0===t.ux&&(t.ux=!0)}),s.links&&Object.keys(s.links).forEach(function(e){var t=s.links[e];void 0===t.ux&&(t.ux=!0)})),u.merge(s,i)}e.utils.merge(i,n)})}}),C(t,[],t)},path2RulePath:function(e){var t=[];return e.split(".").forEach(function(e){"$"!==e.charAt(0)&&t.push(e)}),t.join(".")},_getDefault:function(e){return"@date"===e?s.date2ISO(new Date):e},checkLookup:function(e){return e?((e=$.extend({},e)).data&&"odata"==e.data.$type||(e.pagination=!1,e.cache=!0),!1!==e.pagination&&(e.pagination=!0),e.pagination&&(e.cache=!1),e):null},schema2Authoring:function(e,t,i){var n=[];return _(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,o)&&!k.isCompositionRef(a,o)){var l=e?e+"."+r:r,u={$type:"field",$bind:l,$title:s.tt(a.title,i)||l,$widget:a.$widget,options:a.$widgetOptions};n.push(u)}}),t.links&&Object.keys(t.links).forEach(function(o){var r=t.links[o],a="$links."+o,l={$type:"action",$bind:a=e?e+"."+a:a,$title:s.tt(r.title,i)||a,$widget:r.widget,options:r.$widgetOptions};n.push(l)}),!0)}),n},extractClassNames:function(e,t){var i={},n={};return _(e,t,"",!1,null,function(e,t,s,o,r,a){if(a.currentRef){if(n[a.currentRef])return!1;n[a.currentRef]=!0}if(t.name){if(i[t.name])return!1;i[t.name]=!0}return!0},{$references:!0}),Object.keys(i).length?i:null},expandRules:function(e,t){var i={rulesbyClass:{},rulesById:{}};return e.forEach(function(e){e.ruleType&&(e.triggers=e.triggers.split(",").map(function(e){return e.trim()}),e.id=u.allocID(),i.rulesById[e.id]=e,e.entities&&e.entities.forEach(function(n){t[n.entity]&&e.triggers.forEach(function(t){var s=e.ruleType;if("$events.created"===t?s="created":"$events.loaded"===t?s="loaded":"$events.saving"===t&&(s="saving"),i.rulesbyClass[s]=i.rulesbyClass[s]||{},"created"===s||"loaded"===s||"saving"===s)i.rulesbyClass[s][n.entity]=i.rulesbyClass[s][n.entity]||[],i.rulesbyClass[s][n.entity].push(e.id);else{var o=i.rulesbyClass[s][n.entity]=i.rulesbyClass[s][n.entity]||{};o[t]=o[t]||[],o[t].push(e.id)}})}))}),i},filtrableFields:function(e,t,i){var n=[];return _(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,o)&&!k.isCompositionRef(a,o)&&!k.isCompositionList(a,o,!0)){var l=e?e+"."+r:r;if(k.canFilter(a)){var c={name:l,schema:u.copy(a)};c.schema.title=s.tt(c.schema.title||"",i),n.push(c)}}}),!0)}),n},searchableFields:function(e,t,i){var n=[];return _(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,o)&&!k.isCompositionList(a,o,!0)){var l=e?e+"."+r:r;if(k.canSearch(a)){var c={name:l,schema:u.copy(a)};c.schema.title=s.tt(c.schema.title||"",i),n.push(c)}}}),!0)}),n},isFwField:function(e){return f.indexOf(e)>=0},copyModel:function(e,t,i,n,s){var o={};return function e(t,i,n,s,o,r){Object.keys(n).forEach(function(a){var l=n[a];if(void 0!==l){var u=null;if(!t||o||!(u=t.properties[a])||!(u.$reference||u.$ux||u.ux))if(!u&&"$"===a.charAt(0)||"_"===a.charAt(0))r&&"$states"===a&&(s[a]=$.extend(!0,{},l));else if(u)if(!u.type&&u.$ref&&(u=v(u,i)),"object"===u.type)null===l?s[a]=null:(s[a]={},e(u,i,l,s[a],o));else{if("array"===u.type){var c=v(u.items,i);return null===l?void(s[a]=null):void("object"===c.type?void 0===l||(null===l?s[a]=null:(s[a]=new Array(l.length),l.forEach(function(t,n){var r={};s[a][n]=r,e(c,i,t,r,o)}))):s[a]=l.slice(0))}s[a]=l}else null===l?s[a]=null:Array.isArray(l)?(s[a]=new Array(l.length),l.forEach(function(t,n){if(null===t||void 0===t||"object"!=typeof t)s[a][n]=t;else{var r={};s[a][n]=r,e(null,i,t,r,o)}})):"object"==typeof l?(s[a]={},e(null,i,l,s[a],o)):s[a]=l}})}(e,i=i||e,t,o,n,s),o},columns:function(e,t,i){var n=[];return _(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(k.inModel(a,o)&&!k.isCompositionRef(a,o)&&!k.isCompositionList(a,o,!0)){var l=e?e+"."+r:r;if(k.canShowField(a)){var c={name:l,schema:u.copy(a)};c.schema.title=s.tt(c.schema.title||"",i),n.push(c)}}}),!0)}),n},allData:function(e){return!e.pagination||"relation"===e.data.$type},pkFields:function(e){return Array.isArray(e)?e:e.split(",").map(function(e){return e.trim()})},entityId:function(e){if("object"==typeof e){return Object.keys(e).map(function(t){var i=e[t];return"string"==typeof i?t+"='"+i+"'":t+"="+i}).join(",")}return"string"==typeof e?"'"+e+"'":e},extractPkValue:function(e,t){if(1==t.length)return e[t[0]];var i={};return t.forEach(function(t){i[t]=e[t]}),i},odataId:function(e,t){if(1==e.length)return t[e[0]];var i=[];return e.forEach(function(e){i.push(e+"="+encodeURIComponent(t[e]+""))}),i.join(",")},pk2Id:function(e,t){return 1===t.length?e:JSON.stringify(e)},id2Pk:function(e,t){return 1===t.length?e:JSON.parse(e)},equals:function(e,t,i){if(1===i.length)return e===t[i[0]];for(var n=0,s=i.length;n<s;n++){var o=i[n];if(e[o]!==t[o])return!1}return!0},extractBase:function(e){var t=e.split(".");return t.pop(),t.length?t.join(".")+".":""},parentPath:function(e){var t=e.split(".");return t.pop(),t.length?t.join("."):""},findByPk:function(e,t,i){if(i&&e)for(var n=0,s=i.length;n<s;n++){var o=i[n];if(k.equals(e,o,t))return o}return null},supportPagination:function(e){return!(!e.data||"odata"!==e.data.$type&&"relation"!==e.data.$type)},executeLookup:function(e,t,i,n){var s=e.data;if(s.$params&&i.containerId&&(s.$params.containerId=i.containerId),s.$params&&i.viewId&&(s.$params.viewId=i.viewId),s.$params&&i.selected&&(s.$params.selected=i.selected),i.paginated&&(i.findFirst||i.find)){s=$.extend(!0,{},e.data),i.search=(i.search||"")+"";var o=s.$params.$allData||"relation"==s.$type,a=null,c=r.config(r.name)||{},d=(s.$params.$type?c[s.$params.$type]:null)||c.odata||{},p=d.startswith||"startswith",h=d.caseSensitive||!1;if(!o)if(s.$params.$searchByFields&&s.$params.$searchByFields.fields&&s.$params.$searchByFields.fields.length){var f=[];for(s.$params.$searchByFields.fields.forEach(function(e){var t=e.replace(/\./g,"/"),n="'"+i.search.replace(/'/g,"''")+"'";h&&(t="tolower("+t+")",n="tolower("+n+")"),f.push({$left:p,$op:"$func",$right:t+", "+n})});f.length;){var m=f.shift();a=a?{$op:"or",$left:m,$right:a}:m}}else{var v=i.fieldName.replace(/\./g,"/"),g="'"+i.search.replace(/'/g,"''")+"'";h&&(v="tolower("+v+")",g="tolower("+g+")"),a={$left:p,$op:"$func",$right:v+", "+g}}if(o&&(a=null),a)if(s.$params.$filter){var y=s.$params.$filter;s.$params.$filter={$left:a,$op:"and",$right:y}}else s.$params.$filter=a;i.findFirst&&(o||(s.$params.$top=1),s.$params.nocount=!0)}var _=null;if("relation"===s.$type?(t={documents:t.getValue(s.$params.relation).model(!1)||[]},_=u.Promise.resolve(t)):_=l.execData(s,t,null),!n)return _;_?_.then(n):n(null)},remoteSearch:function(e,t){return t.mapping?t.mapping[e]:e},lastSegment:function(e,t){var i=e.split("."),n=i.pop();return t&&t!==e&&(n=t.substring(i.join(".").length)),n},hasProperty:function(e,t,i){for(var n=t,s=0,o=e.split(".");s<o.length;s++){var r=o[s];if("$"!==r.charAt(0)){if(!n.properties)return!1;if(!(n=n.properties[r]))return!1;!n.type&&n.$ref&&(n=v(n,i)),"array"===n.type&&(n=v(n.items,i))}}return!0},findFirst:function(e,t,i){if(!e||!i)return null;for(var n=e.toLocaleLowerCase(),s=n.length,o=null,r=0,a=i.length;r<a;r++){var l=(i[r][t]||"").toLowerCase();if(l.substr(0,s)===n)return{item:i[r],index:r};!o&&l.indexOf(n)>=0&&(o={item:i[r],index:r})}return o},_states:["$states","$links"],isMetaProp:function(e){return"$$"===e.substr(0,2)},isMeta:function(e){var t="$$meta-".length;return"$$meta-"===e.substr(0,"$$meta-".length)?{widget:e.substr(t)}:null},getLookup:function(e,t,i,n){var s=e.split(".");s.pop();for(var o=i,r=0,a=s.length;r<a&&o;r++){var l=s[r];k.arrayProps.indexOf(l)>=0||((o=o.properties?o.properties[l]:null)&&!o.type&&o.$ref&&(o=v(o,n)),o&&"array"===o.type&&(o=v(o.items,n)))}return o&&o.lookups?k.checkLookup(o.lookups[t]):null},getSchema:function(e,i,n,s){if(!e)return i;for(var o=e.split("."),r=i,a=!1,l=0,u=o.length;l<u&&r;l++){var d=o[l];if(!r.type&&r.$ref&&(r=v(r,n)),"array"==r.type&&k.arrayProps.indexOf(d)>=0)r=v(r.items,n);else if("$links"===d)r=r.links,a=!0;else{if(a){a=!1,(r=r[d]).isLink=!0;break}if(!(r=r.properties?r.properties[d]:null)&&l===u-1){if(d===t.INDEX_FIELD_NAME)return{type:"integer",title:"#",capabilities:null};if(d===t.SELECTED_FIELD_NAME)return{type:"boolean",title:c.ui.Selected,capabilities:null};if(d===t.EXPANDED_FIELD_NAME)return{type:"integer",title:"",capabilities:null}}}}return s&&r&&"array"===r.type&&r.items&&(r=v(r.items,n)),r},states:["isHidden","isDisabled","isReadOnly","isMandatory","style"],statesAndErrors:["isHidden","isDisabled","isReadOnly","isMandatory","errors","filter","symbol","decimals","style","search","selected","columns","orderBy","filter"],linksStates:["isHidden","isDisabled"],isLink:function(e){return e.split(".").indexOf("$links")>=0},_isMoney:function(e){return k.isNumber(e)&&"money"==e.format},_internalExtractEnums:function(e,t,i,n){if(e.name){if(n.indexOf(e.name)>=0)return;n.push(e.name)}var s=function(t,n){if((n=n||e).enums&&n.enums[t]){var s=n.enums[t].type||"default";i[s]=i[s]||{},i[s][t]=n.enums[t]}else{var o=t.split(".");2===o.length&&(i[o[1]]=i[o[1]]||{},i[o[1]][o[0]]={type:o[1]})}};e.lookups&&Object.keys(e.lookups).forEach(function(t){var i=e.lookups[t];"enum"===i.data.$type&&i.data.$enumref&&s(i.data.$enumref)}),Object.keys(e.properties).forEach(function(o){var r=e.properties[o];if(!r.type&&r.$ref&&(r=v(r,t)),k.inModel(r,t))if(k.isCompositionRef(r,t))k._internalExtractEnums(r,t,i,n);else if(k.isCompositionList(r,t,!0)){if(r.items.$ref){if(n.indexOf(r.items.$ref)>=0)return;n.push(r.items.$ref)}k._internalExtractEnums(v(r.items,t),t,i,n)}else{var a=e;k.isSimpleList(r,t)&&(a=r=v(r.items,t)),r.$enumref&&s(r.$enumref,a)}})},_extractEnums:function(e,t){return k._internalExtractEnums(e,e,t,[])},_fillEnums:function(e,t){k._internalFillEnums(e,e,t,[])},_internalFillEnums:function(e,t,i,n){if(e.name){if(n.indexOf(e.name)>=0)return;n.push(e.name)}e.lookups&&Object.keys(e.lookups).forEach(function(t){var n=e.lookups[t];if("enum"==n.data.$type&&n.data.$enumref){var s=n.data.$enumref.split("."),o=2===s.length?i[s[1]]:i[e.enums[n.data.$enumref].type||"default"],r=2===s.length?s[0]:n.data.$enumref;if(o){n.data.$value=[];var a=o[r];a.enum.forEach(function(e,t){var i={code:e,title:a.enumNames[t]};a.fields&&u.extend(i,a.fields[t]),n.data.$value.push(i)})}}}),Object.keys(e.properties).forEach(function(s){var o=e.properties[s];if(o.$ref&&!o.type&&(o=v(o.items,t)),k.inModel(o,t))if(k.isCompositionRef(o,t))k._internalFillEnums(o,t,i,n);else if(k.isCompositionList(o,t,!0))k._internalFillEnums(v(o.items,t),t,i,n);else{var r=e;if(k.isSimpleList(o,t)&&(r=o=v(o.items,t)),o.$enumref){var a=o.$enumref.split(".");if(r.enums&&r.enums[o.$enumref]||2===a.length){var l=2===a.length?i[a[1]]:i[r.enums[o.$enumref].type||"default"],u=2===a.length?a[0]:o.$enumref;if(l){var c=l[u];c&&(o.enum=c.enum,o.enumNames=c.enumNames,o.filters=c.filters)}}}}})},loadEnums:function(e){var t={};k._extractEnums(e,t);var i=Object.keys(t).map(function(e){var i=y.get(e);if(!i)throw"Invalid enum type: "+e;return i.promise(t[e],e)});return i.length?i:null},arrayProps:["$item","$new","$selected"],init:function(e,t,i,n,s,o){if(null===n)return n;var r=n||{};return r._schema_initialized?r:(r._schema_initialized=!0,r.$create=s,r.$states=r.$states||{},Object.keys(e.properties).forEach(function(n){var a=e.properties[n];if(!a.type&&a.$ref&&(a=v(a,t)),k.inModel(a,t)){var l=k.isMetaProp(n),u=e.states?e.states[n]:null,c=r.$states[n]=r.$states[n]||{};if(l||u&&Object.keys(u).forEach(function(e){void 0===c[e]&&(c[e]=u[e])}),k.isCompositionRef(a,t))r[n]=k.init(a,t,i,null===r[n]?null:r[n]||{},s,{children:o.children,select:o.select});else if(k.isCompositionList(a,t,!1)){r[n]=r[n]||[];var d=o.select&&(!a.children||a.children!==o.children),p={children:a.children,select:o.select},h=v(a.items,t),f=null,m=r.$states?r.$states[n]:null,g=null;m&&m.selected&&(g=JSON.parse("["+m.selected+"]")),r[n].forEach(function(e,n){e.id&&g&&g.indexOf(e.id)>=0&&(e.$select=!0),d&&0===n&&void 0===e.$select&&(f=e),e.$select&&(f=null),k.init(h,t,i,e,s,p)}),f&&!a.syncSelected&&!1!==a.autoSelect&&(f.$select=!0),m&&delete m.selected}else if(k.isSimpleList(a,t));else if(k.isList(a,t));else if(s&&void 0===r[n])if(void 0!==a.default&&null!==a.default)r[n]=k._getDefault(a.default);else if(a.enum)r[n]=a.enum[0];else switch(a.type){case"number":case"integer":void 0!==a.default&&(r[n]=a.default)}}}),r)},isCompositionRef:function(e,t){return!e.type&&e.$ref&&(e=v(e,t)),"object"===e.type&&!e.$reference},isRef:function(e,t){return"object"===e.type&&e.$reference},isList:function(e,t){return!e.type&&e.$ref&&(e=v(e,t)),"array"===e.type&&e.$reference},isCompositionList:function(e,t,i){if(!e.type&&e.$ref&&(e=v(e,t)),"array"===e.type&&e.items){var n=v(e.items,t);return("object"===n.type||"array"===n.type)&&(!e.$reference||i&&e.$reference)}return!1},isSimpleList:function(e,t){if(!e.type&&e.$ref&&(e=v(e,t)),"array"===e.type&&e.items){var i=v(e.items,t);return("object"!==i.type||"array"===i.type)&&!e.$reference}return!1},inModel:function(e,t){return!k.isRef(e,t)},formatNumber:function(e,t){return"money"==e.format?s.money(t,!1):s.decimal(t,e.decimals||0,null)},_title:function(e,t){return t?s.tt(e,t):e},canSort:function(e){return!!e&&(!e.isLink&&(!e.hidden&&(m(e),e.features.sortable)))},canShowField:function(e){return!e.hidden},canFilter:function(e){return!!e&&(!e.hidden&&(m(e),e.features.filtrable))},canSearch:function(e){return!!e&&(!e.hidden&&(m(e),e.features.searchable))},checkNumber:function(e,t,i,n){var s=!0;return e=e||0,t.exclusiveMinimum?void 0!=t.minimum&&e<=t.minimum&&(n.push({message:u.format(p.minNumberExclusive,k._title(t.title,i),k.formatNumber(t,t.minimum))}),s=!1):void 0!=t.minimum&&e<t.minimum&&(n.push({message:u.format(p.minNumber,k._title(t.title,i),k.formatNumber(t,t.minimum))}),s=!1),t.exclusiveMaximum?void 0!=t.maximum&&e>=t.maximum&&(n.push({message:u.format(p.maxNumberExclusive,k._title(t.title,i),k.formatNumber(t,t.maximum))}),s=!1):void 0!=t.maximum&&e>t.maximum&&(n.push({message:u.format(p.maxNumber,k._title(t.title,i),k.formatNumber(t,t.maximum))}),s=!1),s},_validateEmail:function(e,t){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)},_validateJson:function(e,t){try{JSON.parse(e)}catch(e){return t.ex=e,!1}return!0},checkString:function(e,t,i,n,s){var o=!0,r=e||"";if(i.minLength&&r.length<i.minLength&&(s.push({message:u.format(p.minLength,k._title(i.title,n),i.minLength)}),o=!1),t.isMandatory&&""===r&&(s.push({message:u.format(p.required,k._title(i.title,n))}),o=!1),i.format)if("email"===i.format)e&&!k._validateEmail(e,{})&&(s.push({message:p.invalidEmail}),o=!1);else if("json"===i.format){var a={};e&&!k._validateJson(e,a)&&(s.push({message:a.ex.message}),o=!1)}return o},validatePassword:function(e,t,i,n,s,o){var r=!0;return n.isHidden||n.isDisabled?r:(e!==t&&(o.push({message:p.passwordMismatch}),r=!1),r)},validateSchema:function(e,t,i,n,s,o){var r=!0;if(t){if(i&&(i.isHidden||i.isDisabled))return r;switch(t.type){case"number":case"integer":r=k.checkNumber(e,t,n,s);break;case"string":r=k.checkString(e,i,t,n,s)}return r}},loadEnumsPromise:function(e){var t=k.loadEnums(e);return t?u.Promise.all(t).then(function(t){var i={};return t.forEach(function(e){i[e.type]=e.enums}),k._fillEnums(e,i),e}):new u.Promise(function(t,i){t(e)})},loadSchemaRefs:function(t,i,n,s,r){if(!t)return r(null,null);var l=function(){try{k.expandSchema$Ref(t);var l=-1,c=k.loadEnums(t),d=c||[],p=c?c.length:0,h=i;s&&((h=h||{}).model=s);var f=w.loadMainData({datasets:n.datasets,transform:n.transform,context:h},!0);f&&d.push(f);var m=f?p+1:0,v=k.extractClassNames(t,t);if(v&&t.loadRules&&e.external.ruleLoaderHandler&&(d.push(o.ruleLoaderHandler(Object.keys(v))),l=d.length-1),!d.length)return r(null,i);a.processing(!0),u.Promise.all(d).then(function(e){a.processing(!1);var n={},s=null;if(e.forEach(function(t,o){o<p?n[t.type]=t.enums:o<m&&$.extend(i,t),o===l&&(s=e[l])}),t.rules&&(s=s?s.concat(t.rules):t.rules),s&&s.length){var o=k.expandRules(s,v);t.rules=o.rulesbyClass,t.rulesMap=o.rulesById}else delete t.rules;p&&k._fillEnums(t,n),r(null,i)}).catch(function(e){a.processing(!1),r(e,null)})}catch(e){r(e,null)}},c=n.before?d.get(n.before):null;c?c().then(function(){l()}).catch(function(e){r(e,null)}):l()},stateProps:function(e){return e.enum&&e.filters?["filter"]:e.items&&e.items.enum&&e.items.filters?["filter"]:k.isNumber(e)?["symbol","decimals"]:"array"===e.type&&e.items&&"object"===e.items.type&&!e.items.$reference?["orderBy","selected","filter","search","columns"]:void 0},isPassword:function(e){return"string"===e.type&&"password"===e.format},isDate:function(e){return"string"===e.type&&"date"===e.format},isDateTime:function(e){return"string"===e.type&&"date-time"===e.format},isBoolean:function(e){return"boolean"===e.type},isSelectField:function(e){return e===t.SELECTED_FIELD_NAME},isExpandField:function(e){return e===t.EXPANDED_FIELD_NAME},isNumber:function(e){return"number"===e.type||"integer"===e.type},isText:function(e){return"string"===e.type&&("json"===e.format||"memo"===e.format)},isMoney:function(e){return k.isNumber(e)&&"money"===e.format},hasSymbol:function(e){return k.isNumber(e)&&("money"===e.format||"rate"===e.format||e.symbol)},text2Value:function(e,t,i){if(k.isNumber(t)){var n=i.decimals,o="number"==typeof e?e:s.string2Float(e||"");return o=parseFloat(o.toFixed(n))}if("string"!==t.type||""!==e&&null!==e)return e},value2Text:function(e,t,i){return k.isNumber(t)?s.decimal(e,i.decimals,null):e||""},expand$Ref:function(e,t){return v(e,t)},parsePath:function(e,t,i){var n=t.substr(e.length+1),s=n.split("."),o=s.shift();if(!i)return e+"."+o;n=s.join(".");for(var r=[e,o],a=i+".$item.",l=a.length,u=i+".$selected.",c=a.length;;)if(n.substr(0,l)===a)r.push(i+".$item"),n=n.substr(l);else{if(n.substr(0,c)!==u)break;r.push(i+".$selected"),n=n.substr(c)}return n===i&&r.push(n),r.join(".")},registerValidator:g.register,getValidator:g.get,registerEnumManager:y.register,getEnumManager:y.get},w={extractDatasets:function(e,t){if(e.datasets){var i=Object.keys(e.datasets);if(i.length){var n=[];return i.forEach(function(i){var s=e.datasets[i];if(!t||!1!==s.$autoOpen){var o=$.extend({},s,!0);o.name=i,n.push(o)}}),n}}return null},isQuery:function(e){return!("odata"!==e.$type&&"relation"!==e.$type||e.$method&&"GET"!==e.$method.toUpperCase()||e.$params.hasOwnProperty("$entityId"))},isCreateOrUpdate:function(e){return"odata"===e.$type&&e.$params.hasOwnProperty("$entityId")},extractMainDataSource:function(e){var t=null;if(e.datasets){var i=Object.keys(e.datasets);i.length&&(i.forEach(function(i){e.datasets[i].$main&&((t=$.extend({},e.datasets[i],!0)).name=i)}),t||((t=$.extend({},e.datasets[i[0]],!0)).name=i[0]))}return t},datasetsAsPromise:function(e,t,i){return new u.Promise(function(n,s){var o={};a.processing(!0);var r=null,u=[];e.forEach(function(e){e.$main&&(r=e)}),r||((r=e[0]).$main=!0),r.children&&Object.keys(r.children).forEach(function(e){r.children[e].name=e,u.push(r.children[e])}),w.isCreateOrUpdate(r)&&(r.$create=r.$create||{}),h.executeDatasets(e,i||{},o,{},function(e,i){if(a.processing(!1),i)s(i);else{var c=$.extend({},o[r.name]||{});if(c.$datasets=o,u&&u.length){a.processing(!0);var p={};return h.executeDatasets(u,c,p,{},function(e,i){if(delete c.$datasets,c=void 0,a.processing(!1),Object.keys(p).forEach(function(e){o[e]=p[e]}),l.execOutputData(r,o),t){var s=d.get("datasets.transform."+t);s&&s(o)}n(o[r.name])},!1)}if(l.execOutputData(r,o),t){var f=d.get("datasets.transform."+t);f&&f(o)}n(o[r.name])}})})},datasetAsPromise:function(e,t){return new u.Promise(function(i,n){var s={};e.name=e.name||"data",a.processing(!0),h.executeDatasets([e],t||{},s,{},function(t,o){a.processing(!1),o?n(o):i(s[e.name])})})},loadMainData:function(e,t){var i=w.extractDatasets(e,t);return i&&i.length?w.datasetsAsPromise(i,e.transform,e.context):u.Promise.resolve(null)},dsConfig:function(e,t,i){var n=t.$reference;if(e&&n){var s=Object.keys(e);if(1===s.length){var o=e[s[0]];return o.$main=!0,o.name=s[0],o}if("string"==typeof n){var r=e[n];return r.name=n,r}}return null}},E={_enums:{},promise:function(e,t){var i={};return Object.keys(e).forEach(function(t){var n=e[t];E._enums[t]||(E._enums[t]={enum:n.enum,enumNames:n.enumNames,filters:n.filters}),i[t]=E._enums[t]}),new u.Promise(function(e,n){e({type:t,enums:i})})}};k.registerEnumManager("default",E),t.SchemaUtils=k,t.DataUtils=w}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.pagecontrol,n=t.Observable.SchemaUtils,s=t.utils,o=t.dom;!function(e){var r=function(){function e(e,t,s){this.opened=!1;this.page=i.Page(),this.opened=!1,this.currentList=null,this.$parent=e,this._checkOptions(s),this.options=s,this.$input=t,this.keys=n.pkFields(this.options.primaryKey)}return e.prototype.click=function(e){var i=t.bootstrap4,n=o.parentByTag(this.$element.get(0),e.target,i?"a":"li");if(n){var s=n.pk;if(s){var r=this._map(),a=this._selectByPk(s,r);a&&this._doSelect(a,!0)}}},e.prototype.inMenu=function(e){return!(!e||!this.$element)&&o.isChildOf(this.$element.get(0),e)},e._itemHeight=function(){if(!this.itemHeight){var e=void 0;e=t.bootstrap4?$('<div class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><a tabindex="-1" class="dropdown-item" href="#">A</a></div>').get(0):$('<ul class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><li tabindex="-1"><a tabindex="-1" href="#">A</a></li></ul>').get(0),document.body.appendChild(e);var i=e.firstChild;this.itemHeight=i.offsetHeight,this.deltaHeight=e.offsetHeight-this.itemHeight,document.body.removeChild(e)}return this.itemHeight},e.prototype._checkOptions=function(e){if(!e.primaryKey)throw new Error("Invalid options no primaryKey.");if(!e.search)throw new Error("Invalid options search field.");e.display=e.display||e.search,e.maxItems=e.maxItems||8},e.prototype._renderContent=function(){var e=t.bootstrap4;this.$element||(this.$element=e?$('<div class="dropdown-menu"></div>'):$('<ul class="dropdown-menu"></ul>'),this.$parent.get(0).appendChild(this.$element.get(0)))},e.prototype._renderElements=function(){var e=this,i=t.bootstrap4;if(e.$element||e._renderContent(),e.currentList){var r=document.createDocumentFragment(),a=e.$element.get(0);e.currentList.forEach(function(t){var a,l=n.pk2Id(n.extractPkValue(t,e.keys),e.keys);(a=i?$('<a tabindex="-1" class="dropdown-item" href="#">'+s.escapeHtml(t[e.options.display])+"</a>").get(0):$('<li class="dropdown-item" tabindex="-1"><a tabindex="-1" href="#">'+s.escapeHtml(t[e.options.display])+"</a></li>").get(0)).pk=l,o.append(r,a)}),o.empty(a),o.append(a,r)}},e.prototype._afterHide=function(e){this.opened=!1,this.page&&this.page.setPopup(null),this.$input&&this.$input.get(0).focus()},e.prototype.hide=function(e){if(this.opened&&this.$element){var t=this.$element.get(0);o.removeClass(t,"bs-block"),this.opened=!1,this.page&&this.page.setPopup(null)}},e.prototype._selectByListIndex=function(e,t){for(var i=0,n=e.length;i<n;i++){var s=e[i];if(s.listIndex===t)return s}return null},e.prototype._emptyHtmlList=function(){this.$element&&o.empty(this.$element.get(0))},e.prototype._show=function(t){if(this.$element){var i=this.$element.get(0);if(i.childNodes.length){var n=-1,s=this._map(),r=this._findSeleted(s);r&&(n=r.listIndex);var a=this.$parent.get(0).offsetWidth;if(i.style.minWidth=a+"px",i.style.maxHeight=this.options.maxItems*e._itemHeight()+e.deltaHeight+"px",i.style.overflowY="auto",o.addClass(i,"bs-block"),n!=t){if(r){var l=i.childNodes[r.index];o.removeClass(l,"active"),r.selected=!1}if(t>=0){r=this._selectByListIndex(s,t);var u=i.childNodes[r.index];o.addClass(u,"active"),r.selected=!0,this._isInView(u,i)||u.scrollIntoView(!0)}else i.scrollTop=0}this.page&&this.page.popup!=this&&this.page.setPopup(this),o.addClass(i,"bs-block"),this.opened=!0}else o.removeClass(i,"bs-block"),this._afterHide(!0)}},e.prototype.triggerBlurred=function(e){this.hide(null)},e.prototype.show=function(e,t,i){if(!(e&&e.value&&e.value.length))return this.currentList=null,this.hide(null),void this._emptyHtmlList();this.currentList==e.value?this._show(t):(this.currentList=e.value,this._renderElements(),this._show(t))},e.prototype._map=function(){for(var e=[],t=!1,i=this.$element.get(0),n=0,s=0,r=i.childNodes.length;s<r;s++){var a=i.childNodes[s];if(a.pk){var l=!t&&o.hasClass(a,"active");l&&(t=!0),e.push({id:a.pk,index:s,selected:l,listIndex:n}),n++}}return e},e.prototype._selectByPk=function(e,t){for(var i=null,n=this.$element.get(0),s=0,r=(t=t||this._map()).length;s<r;s++){var a=t[s];if(a.id===e){if(i=a,a.selected)break;o.addClass(n.childNodes[a.index],"active"),a.selected=!0}else if(a.selected&&(o.removeClass(n.childNodes[a.index],"active"),a.selected=!1,i))break}return i},e.prototype._findSeleted=function(e){for(var t=0,i=(e=e||this._map()).length;t<i;t++){var n=e[t];if(n.selected)return n}return null},e.prototype._isInView=function(t,i){var n=t.offsetTop,s=t.offsetHeight,o=i.scrollTop,r=this.options.maxItems*e._itemHeight();return n>=o&&o+r>=n+s},e.prototype.move=function(t){if(this.$element&&this.opened){var i=this._map(),n=this.$element.get(0),s=this._findSeleted(i),r=void 0;if(t>0){if(s){if((r=1e3===t?i.length-1:i.indexOf(s)+t)>=i.length&&i[r=i.length-1].selected)return}else r=0;if(r<i.length){s&&(o.removeClass(n.childNodes[s.index],"active"),s.selected=!1);var a=n.childNodes[i[r].index];o.addClass(a,"active"),i[r].selected=!0,r==i.length-1?n.scrollTop=a.offsetTop+e._itemHeight()+1:this._isInView(a,n)||a.scrollIntoView(!1),this._doSelect(i[r],!1)}}else{if(s){if((r=-1e3===t?0:i.indexOf(s)+t)<0&&i[r=0].selected)return}else r=i.length-1;if(r>=0){s&&(o.removeClass(n.childNodes[s.index],"active"),s.selected=!1);a=n.childNodes[i[r].index];o.addClass(a,"active"),i[r].selected=!0,0==r?n.scrollTop=0:this._isInView(a,n)||a.scrollIntoView(!0),this._doSelect(i[r],!1)}}}},e.prototype.select=function(){if(this.$element&&this.opened){var e=this._findSeleted();e&&this._doSelect(e,!0)}},e.prototype._doSelect=function(e,t){t&&(this.options.onselect&&this.options.onselect(n.findByPk(n.id2Pk(e.id,this.keys),this.keys,this.currentList)),this.hide(null))},e.prototype.inPopup=function(e){if(this.$element){var t=this.$element.get(0).parentNode;return o.isChildOf(t,e)}return!1},e.prototype.destroy=function(){this.options=null,this.currentList=null,this.$input=null,this.$parent=null,this.$element=null},e.itemHeight=0,e.deltaHeight=0,e}();e.DropItems=r}(e.formdropitems||(e.formdropitems={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.link,n=(t.menubase,t.preferences),s=t.application,o=t.device,r=t.utils,a=t.locale,l=e.contextmenu,u=t.dom;!function(t){var c=function(e){var t=["bs-menu-right-icon normal"];return e.collapsed?t.push(u.iconClass("plus")):t.push(u.iconClass("minus")),t.join(" ")},d=function(t){__extends(d,t);function d(e,i){var n=t.call(this,e,i)||this;return n.id=r.allocID(),n}return d.prototype._checkSearchPopupMenu=function(){if(!this._menu){var t=this._searchInput();if(!t)return;var i=$(t.parentNode);this._menu=new e.formdropitems.DropItems(i,t,{primaryKey:"id",search:"title"})}},d.prototype._searchInput=function(){return this.$element?u.find(this.$element.get(0),this.id+"_search"):null},d.prototype._initOptions=function(e){s.configuration=s.configuration||{};var t=s.configuration.header||{};(e=e||{}).typeMenu=e.typeMenu||"left",e.replaceParent=!0,e.canStayInPage=!!e.inline||!o.phone&&!o.tablet,e.autoClose=!e.inline&&(!e.canStayInPage||n("menu_"+e.type+"_autoClose")),void 0===e.autoClose&&(e.autoClose=!0),e.auth=void 0===t.authLeftMenu||t.authLeftMenu,t["menu"+e.typeMenu]&&r.merge(t["menu"+e.typeMenu],e),e.styles=e.styles||{root:"$upper",parent:"",leaf:""},e.canExpandItems=!0},d.prototype._updateSearch=function(){},d.prototype._hideContent=function(e){var t=this.$content.get(0);if(this.options.bodyId){var i=u.find(null,this.options.bodyId);i&&u.removeClass(i,"bs-pc-body-"+this.options.typeMenu)}u.removeClass(t,"bs-menu-opened"),u.addClass(t,"bs-menu-closed"),this.options.bodyId&&(!this.options.autoClose||e&&this.options.autoClose)&&r.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},d.prototype._showContent=function(){var e=this.$content.get(0),t=!1;if(this.options.bodyId&&!this.options.autoClose){t=!0;var i=u.find(null,this.options.bodyId);i&&u.addClass(i,"bs-pc-body-"+this.options.typeMenu)}u.removeClass(e,"bs-menu-closed"),u.addClass(e,"bs-menu-opened"),this.options.canStayInPage?u.addClass(e,"large"):u.addClass(e,"phone"),t&&r.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},d.prototype._switchAutoClose=function(){var e=!n("menu_"+this.options.type+"_autoClose");return n("menu_"+this.options.type+"_autoClose",e),this.options.autoClose=e,this.options.autoClose?this.page.setPopup(this):this.page.popup=null,this._updateCloseButton(this.$content)},d.prototype._doCloseClick=function(){this.options.canStayInPage?(this._switchAutoClose()?this.hide(!0):this._showContent(),this.page.props["$menu"+this.options.typeMenu]=this.options.autoClose):this.hide()},d.prototype.copyMenuItemData=function(e,t){e.$icon=t.$icon},d.prototype._updateCloseButton=function(e){var t=!1,i=e.get(0),n=u.query(i,".bs-menu-button");if(n)return this.options.canStayInPage?(u.removeClass(n,u.iconClass("times",!0)),this.options.autoClose?(u.removeClass(n,u.iconClass("times-circle-o",!0)),u.addClass(n,"small"),u.addClass(n,u.iconClass("thumb-tack",!0)),t=!0):(u.removeClass(n,u.iconClass("thumb-tack",!0)),u.removeClass(n,"small"),u.addClass(n,u.iconClass("times-circle-o",!0))),u.removeClass(n,"bs-none")):(u.removeClass(n,u.iconClass("thumb-tack",!0)),u.removeClass(n,u.iconClass("times-circle-o",!0)),u.addClass(n,u.iconClass("times",!0)),u.removeClass(n,"bs-none")),t},d.prototype.renderContent=function(){var e=this.options,t=$('<div class="bs-menu-wrap bs-scrollbar bs-menu-closed bs-menu-'+e.typeMenu+'-wrap"></div>'),i=t.get(0);e.inline&&u.addClass(i,"parent");var n=this.page.childByType("header");if(n&&n.$element){var s=u.offset(n.$element.get(0));o.phone||o.tablet||(u.supportCssCalc()?(i.style.top=s.height+"px",i.style.height="calc(100% -  "+s.height+"px)"):i.style.paddingTop=s.height+"px",i.style.zIndex="1000")}return t},d.prototype._changeSelected=function(e){if(this.$element)for(var t=e;t;){var i=u.find(this.$element.get(0),t.$id);i&&(e.selected?u.addClass(i,"active"):u.removeClass(i,"active")),t=this._map[t.$parentId]}},d.prototype._selectDatasetItem=function(e,t){var i=this,n=null;i.items.forEach(function(s){s.$dataset===e&&(s===t?s.selected||(s.selected=!0,i._changeSelected(s)):s.selected&&(s.selected=!1,i._changeSelected(s),n=s))}),i._expandSelected(n)},d.prototype._expandSelected=function(e){for(var t=[],i={},n=e;n;)t.push(n),i[n.$id]=!0,n.collapsed=!1,n=this._map[n.$parentId];this.items.forEach(function(e){e.collapsed||i[e.$id]||(e.collapsed=!0)}),this.updateItemsAfterCollapse();var s=t.reverse().map(function(e){return e.$title});this.data&&this.data.$moduleTitle&&s.unshift(this.data.$moduleTitle);var o=this.page.childByType("header");o&&o.setLocation(s.join(" - "),!1)},d.prototype._canClick=function(e){return e.$link},d.prototype.render=function(e){t.prototype.render.call(this,e),this._onPageChanged()},d.prototype.renderItems=function(){var e=this,t=$('<ul class="bs-item-list"></ul>'),i=t.get(0),n=$('<li class="link"><a><span class="title"></span></a></li>').get(0),s=$('<li class="parent"><span class="title"></span></li>').get(0),o=($('<li class="parent"><span class="title"></span></li>').get(0),$('<li class="divider"><span class="title"></span></li>').get(0));if(e.items){var r=e.items.length;e.items.forEach(function(t,a){if(!t.isHidden){var l;if(t.divider)l=o.cloneNode(!0),u.text(l.firstChild,t.$title||String.fromCharCode(160));else{var d=e.options.canExpandItems&&t.$items&&t.$items.length,p=!1,h="";if(a<r-1){var f=e.items[a+1];p=(f.$level||0)>(t.$level||0)&&!f.$parentId}var m=!!t.$link;if(l=m||d?n.cloneNode(!0):s.cloneNode(!0),t.$items?(h=t.$parentId?"parent":"root",u.addClass(l,"bs-menu-item-parent")):t.$parentId&&(h="leaf"),t.$level?(t.$parentId||u.addClass(l,"level"),u.addClass(l,"level-"+t.$level)):p&&u.addClass(l,"level"),h){var v=null;if(e.options.styles&&e.options.styles[h]&&(v=e.options.styles[h]),v){var g=[];u.parseStyle(v,g),g.length&&(l.className=l.className+" "+g.join(" "))}}var y=l.firstChild,_=m||d?y.firstChild:y;if(t.$title){var $=t.$icon?" "+t.$title:t.$title;u.text(_,$)}if(t.selected&&u.addClass(l,"active"),m&&(u.attr(y,"data-phoenix-href","click://"+a),e._canClick(t)||u.removeClass(y,"link")),e.options.canExpandItems){if(d){u.attr(l,"data-phoenix-href","click://collapse/"+a);var b=document.createElement("span");b.id=t.$id+"_collapse",b.className=c(t),u.append(l,b)}e.isVisible(t)||(u.addClass(l,"closed"),l.style.height="0px")}if(t.$icon){var x=u.icon(t.$icon);u.addClass(x,"bs-icon-menu"),y.insertBefore(x,y.firstChild)}}if(t.$firstGroup&&!e.options.inline){var C=document.createElement("span");C.className="bs-menu-button bs-menu-right-icon bs-none "+u.iconPrefix(),u.attr(C,"data-phoenix-href","click://close"),u.append(l,C)}l.id=t.$id,i.appendChild(l)}})}return e._updateCloseButton(t),t},d.prototype.updateItemsAfterCollapse=function(){var e=this;e.$element&&e.items&&e.options.canExpandItems&&e.items.forEach(function(t,i){if(!t.isHidden){var n=t.$items&&t.$items.length,s=e.isVisible(t),o=u.find(e.$element.get(0),t.$id);if(o){if(s!==!u.hasClass(o,"closed"))if(s){var r=window.getComputedStyle(o,null).getPropertyValue("line-height");u.removeClass(o,"closed"),o.style.height=r}else u.addClass(o,"closed"),o.style.height="0px";if(n){var a=u.find(e.$element.get(0),t.$id+"_collapse");if(a){var l=c(t);a.className!==l&&(a.className=l)}}}}})},d.prototype._executeLink=function(e,t){var n,s=i.context();if(e.$dataset&&(n=this.datasets[e.$dataset],s.$item=e.$item),n&&e.$link&&e.$link.$datasetSelect)n.selectedIndex!=e.$index&&(n.selectedIndex=e.$index,this.ds_select(e.$dataset,e.$item),this._selectDatasetItem(e.$dataset,e));else if(e.$link)return i.execLink(e.$link,s,null)},d.prototype._executeContextMenu=function(e,t,i){if(t.$link&&t.$link.$page){var n=[{link:$.extend(!0,{},t.$link),title:a.ui.OpenNewTab}];return l.openContextMenu(e,this,n),!0}return!1},d.prototype.contextMenu=function(e){if(e.link){var t=i.context();t.$target="blank",i.execLink(e.link,t,null)}},d.prototype._onPageChanged=function(){var e={page:this.page.currentPage(),module:s.name};this.search="",this.selectItem(e)},d.prototype.selectItem=function(e){var t=this,n=e&&"object"==typeof e&&e.page;if(t.items){var s=null;t.items.forEach(function(o,r){if(o.$link){var a=!1;if(n&&o.$link.$page){(a=i.pageName(o.$link)===e.page)&&o.$link.$module&&(a=o.$link.$module===e.module)}else{var l=i.getLinkExecutor(o.$link);l&&(a=l.equal(e,o.$link))}o.selected!==a&&(o.selected=a,o.selected||t._changeSelected(o)),a&&(s=o)}}),s&&(t._changeSelected(s),t._expandSelected(s))}},d}(e.menubase.MenuBase);t.Menu=d,t.Menuleft=d,t.Menuright=d}(e.menu||(e.menu={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.pagecontrol,s=(i.external,i.ulocale),o=i.utils,r=i.locale,a=(i.ajax,i.dom),l=i.sticky,u=(i.ui,i.build),c=i.application,d=(i.render,i.link),p=function(e,t){var n=document.createDocumentFragment(),o=i.bootstrap4,l=$(o?'<a class="dropdown-item" href="#"></a>':'<li><a href="#"></a><li>').get(0);e.menu.items.forEach(function(t,i){t.$pattern&&(e.menu.items[i]=(u=t,"logout"===u.$pattern&&(u.icon="lock",u.title=r.ui.Disconnect,u.link={$logout:!0},delete u.$pattern),u),t=e.menu.items[i]);var u,c=l.cloneNode(!0),d=o?c:c.firstChild;if(a.attr(d,"data-phoenix-href","click://"+e.$index+"/"+i),t.icon){var p=document.createElement("span");p.className=a.iconClass(t.icon),a.append(d,p)}var h=t.title;"object"==typeof t.title&&(h=t.title[s.currentLang]),a.text(d," "+(h||"Error: title not defined")),a.append(n,c)}),a.append(t,n)},h=function(){function e(e,t){this._init(e,t)}return e.prototype.setLocation=function(e,t){var i=this;i.options.showLocation&&(i._locationTimeOut&&window.clearTimeout(i._locationTimeOut),i._locationTimeOut=window.setTimeout(function(){i._locationTimeOut=0,i._location!==e&&(i._location=e||"",i.$location&&a.text(i.$location.get(0).lastChild,i._location))},100))},e.prototype._init=function(e,t){var i=this;i.title="",i._ctx=d.context(),i._ignoreClick=!1,i.leftButtonsSpace=0,i.rightButtonsSpace=0,i.$location=null,i.$element=null,i.$buttons=[],i.options=t||{},i.page=n.Page(),i.title=c.title||"";var s=c.configuration,o=s&&s.header?s.header:{};if(void 0!==i.options.showOnDisconnected?i.options.showOnDisconnected=i.options.showOnDisconnected:i.options.showOnDisconnected=o.alwaysShow,void 0!==o.showLocation&&(i.options.showLocation=o.showLocation),void 0!==o.leftMenuButtonInLocation&&(i.options.leftMenuButtonInLocation=o.leftMenuButtonInLocation),void 0===i.options.backButton&&(i.options.backButton=!0),void 0===i.options.leftMenuButton&&(i.options.leftMenuButton=!0),void 0===i.options.topMenuButton&&(i.options.topMenuButton=!0),void 0===i.options.disconnectButton&&(i.options.disconnectButton=!0),o.logo){var r={$isHidden:!1,$type:"logo"},a="";"string"==typeof o.logo?a=o.logo:(a=o.logo.style,r.link=o.logo.link),r.$className=a,i.$buttons.push(r)}o.buttons&&o.buttons.before&&o.buttons.before.forEach(function(e){i.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),i.options.backButton&&i.$buttons.push({$icon:"chevron-left",$isHidden:!i.page.props.$hasBack&&!i.options._alwaysShowBack,$type:"back",link:{$back:!0}}),i.options.leftMenuButton&&i.$buttons.push({auth:o.authLeftMenu,$isHidden:!0,$icon:"bars",$type:"menuleft",$parent:i.options.leftMenuPlace,$location:i.options.showLocation&&i.options.leftMenuButtonInLocation}),i.options.disconnectButton&&(o.userMenu?i.$buttons.push({$icon:"user",iconStyle:"$icon-normal",right:!0,auth:!0,menu:$.extend(!0,{},o.userMenu),expression:o.userMenu.expression||"John Doe",$type:"user"}):i.$buttons.push({$icon:"power-off",right:!0,auth:!0,$type:"disconnect",link:{$logout:!0}})),i.$buttons.push({$icon:"pencil",right:!0,auth:!0,$isHidden:u.release,$type:"authoring",link:{$authoring:!0}}),u.release||i.$buttons.push({$icon:"cog",title:"Utils",right:!0,auth:!0,menu:{items:[{title:"Create a new form",icon:"building",link:{$action:{name:"phoenix.action.createform"}}},{title:"Modify form schema",icon:"pencil",link:{$action:{name:"phoenix.action.updschema"}}}]}}),i.options.rightMenuButton&&i.$buttons.push({auth:!0,$isHidden:!0,$icon:"ellipsis-v",$type:"menuright",$parent:i.options.rightMenuPlace}),i.options.topMenuButton&&i.$buttons.push({auth:!0,$isHidden:!0,$icon:"chevron-down",$type:"menutop",right:!0,$parent:i.options.topMenuPlace}),o.buttons&&o.buttons.after&&o.buttons.after.forEach(function(e){i.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),i.page.addChild("header",i),i.setData(e)},e.prototype._show=function(){var e=i.sessionPreferences("headerisHidden");return!this._ctx.$url.$inline&&!e||(e||i.sessionPreferences("headerisHidden",!0),!1)},e.prototype.setData=function(e){e=e||{}},e.prototype.buttonByType=function(e){for(var t=0,i=this.$buttons.length;t<i;t++){var n=this.$buttons[t];if(n.$type==e)return n}return null},e.prototype._createButtons=function(){if(this.$element){var e=this.$element.get(0),t=a.query(e,".header_left_buttons"),n=a.query(e,".header_right_buttons"),r=this.$location?a.query(this.$location.get(0),".bs-location-buttons"):null;this.$buttons.forEach(function(e,l){e.$index=l;for(var u=function(e,t){var n=[],r=i.bootstrap4,l=r?"d-none d-sm-inline-block":"hidden-xs";e.id=o.allocID();var u=e.title;if(u&&"object"==typeof u&&(u=u[s.currentLang]),e.$location)n.push('<span id="{1}" class="bs-loc-link bs-style-icon-lg {2}" href="#" data-phoenix-href="click://{0}"><span>');else{if(n.push('<li id="{1}">'),"logo"===e.$type)e.$location||n.push('<a tabindex="-1" class="'+l+" bs-nav-logo "+e.$className+'" href="#" data-phoenix-href="click://{0}"></a>');else{var c=[];e.iconStyle?a.parseStyle(e.iconStyle,c):c.push("bs-style-icon-lg"),e.title||e.expression?(n.push('<a class="bs-nav-link"'),n.push('  href="#" data-phoenix-href="click://{0}"'),n.push(">"),c.push("{2}"),n.push('<span class="'+c.join(" ")+'"></span>'),c=["bs-icon-header-title"],r&&c.push("dropdown-toggle"),n.push('<span class="'+c.join(" ")+'"><span class="'+l+'">{3}</span>'),r&&c.push("dropdown-toggle"),e.menu&&n.push(' <span class="caret"></span>'),n.push("</span>"),n.push("</a>"),e.menu&&e.menu.items&&(r?(n.push('<div class="dropdown-menu bs-right-menu">'),n.push("</div>")):(n.push('<ul class="dropdown-menu bs-right-menu">'),n.push("</ul>")))):(n.push('<a class="bs-nav-link" href="#" data-phoenix-href="click://{0}">'),c.push("{2}"),n.push('<span class="'+c.join(" ")+'"></span>'),n.push("</a>"))}n.push("</li>")}return e.link&&e.link.$form&&(e.link.$form.alignElementId=e.id),$(o.format(n.join(""),t,e.id,a.customIconClass(e.$icon,e.$iconClass),u||e.expression||""))}(e,l),c=e.$location?r:e.right?n:t,d=0,p=u.length;d<p;d++)a.append(c,u.get(d))})}},e.prototype._updateButtons=function(){var e=this,t=12;if(i.bootstrap4&&(t=a.rem2px(.8571)),e.$element){var n=e.page.props.$user&&e.page.props.$user.connected,s=t,r=t,l=e.$element.get(0);e.$buttons.forEach(function(t){var i=a.find(l,t.id);if(t.$isHidden||!n&&t.auth)a.addClass(i,"bs-none");else{if("user"===t.$type){var u=o.execAngularExpression(t.expression,e.page.props.$user.credentials);if(u!==t.title){t.title=u;var c=a.query(i,".bs-icon-header-title");c&&a.text(c.firstChild,u)}}a.removeClass(i,"bs-none"),t.$location||(t.right?r+=a.offset(i).width:s+=a.offset(i).width)}}),e.leftButtonsSpace===s&&e.rightButtonsSpace===r||(e.leftButtonsSpace=s,e.rightButtonsSpace=r,e._updateTitleSpaceMargins())}},e.prototype._updateTitleSpaceMargins=function(){if(this.$element){var e=this.$element.get(0),t=a.query(e,".header_title");t.style.marginLeft=this.leftButtonsSpace+"px",t.style.marginRight=this.rightButtonsSpace+"px"}},e.prototype.inPopup=function(e){if(this._ob){var t=a.find(this.$element.get(0),this._ob.id);return a.isChildOf(t,e)}return!1},e.prototype.hide=function(e){if(this._ob){var t=a.find(this.$element.get(0),this._ob.id);a.removeClass(t.lastChild,"bs-block"),this._ob=null}},e.prototype._openPopup=function(e){this.page.setPopup(this),this._ob=e;var t=a.find(this.$element.get(0),e.id);a.addClass(t.lastChild,"bs-block")},e.prototype._executeLink=function(e,t){if(e.menu){var i=a.find(this.$element.get(0),e.id);if(i&&i.lastChild&&(i.lastChild.childNodes.length||p(e,i.lastChild)),!(t>=0)){if(this._ob){if(this._ob===e)return void this.page.setPopup(null);this.page.setPopup(null)}if(i&&i.lastChild){i.lastChild.style.minWidth=Math.max(a.offset(i).width,160)+"px"}return this._openPopup(e)}var n=e.menu.items[t];n.link&&d.execLink(n.link,d.context(),null),this.page.setPopup(null)}else if(e.link)return e.link.$form&&(e.link.$form.opener=e.id),d.execLink(e.link,d.context(),null);if(["menuleft","menuright","menutop","menubottom"].indexOf(e.$type)>=0&&e.$parent&&this.page){var s=this.page.childByType("menu-"+e.$type.substring(4));s&&s.show($(a.find(null,e.$parent)))}},e.prototype._onresize=function(){this.$element&&this._updateButtons()},e.prototype._setEvents=function(){var e=this,t=e.$element.get(0);e.$element.on("mousedown",function(i){var n=d.isCustomLink(t,i,!0);if(n&&"click"===n.protocol){var s=n.value.substring("click://".length).split("/"),o=(s.length>1&&parseInt(s[1],10),e.$buttons[parseInt(s[0],10)]);if(o)if(["menuleft","menuright","menutop","menubottom"].indexOf(o.$type)>=0){if(o.$parent&&e.page){var r=e.page.childByType("menu-"+o.$type.substring(4));e.page.popup===r&&(e._ignoreClick=!0)}}else o.link&&o.link.$form&&!o.link.$form.modal&&e.page.popup&&e.page.popup.opener&&e.page.popup.opener===o.id&&(e._ignoreClick=!0)}}),e.$element.on("click",function(i){var n=d.isCustomLink(t,i);if(e._ignoreClick)e._ignoreClick=!1;else if(n&&"click"===n.protocol){var s=n.value.substring("click://".length).split("/"),o=s.length>1?parseInt(s[1],10):-1,r=e.$buttons[parseInt(s[0],10)];if(e._executeLink(r,o),r&&"logo"===r.$type){var a=document.activeElement;a&&a.blur()}}}),$(window).on("resize.header",function(){clearTimeout(e._doResize),e._doResize=setTimeout(e._onresize.bind(e),100)})},e.prototype.setPage=function(e,t){if(u.release){var i=c.isCustomizable("pages",e),n=this.buttonByType("authoring");n&&n.$isHidden!=!i&&(n.$isHidden=!i,this._updateButtons())}},e.prototype.onPageChange=function(e,t){var i;switch(e){case"$title":this.title=t||c.title||"",this._renderTitle();break;case"$hasBack":this.options._alwaysShowBack&&(t=!0),this.options.backButton&&(i=this.buttonByType("back"))&&i.$isHidden!==!t&&(i.$isHidden=!t,this._updateButtons());break;case"$user":this._auth(!1),this._updateButtons();break;case"$menuleft":this.options.leftMenuButton&&(i=this.buttonByType("menuleft"))&&i.$isHidden==t&&(i.$isHidden=!t,this._updateButtons());break;case"$menutop":this.options.topMenuButton&&(i=this.buttonByType("menutop"))&&i.$isHidden==t&&(i.$isHidden=!t,this._updateButtons())}},e.prototype._removeEvents=function(){this.$element.off("mousedown"),this.$element.off("click"),$(window).off("resize.header")},e.prototype.renderButtons=function(){this._createButtons(),this._updateButtons(),o.nextTick(function(){})},e.prototype._renderTitle=function(){if(this.$element){var e=this.$element.get(0),t=a.query(e,".header_title");a.text(t,this.title||"")}},e.prototype._auth=function(e){if(this.$parent&&this._show()){var t=this.$parent.get(0),i=this.$element.get(0),n=!1;if(this.page.props.$user&&this.page.props.$user.connected?(n=!0,a.removeClass(i,"bs-none")):this.options.showOnDisconnected?(n=!0,a.removeClass(i,"bs-none")):a.addClass(i,"bs-none"),!e){var s=a.offset(this.$element.get(0));l.topOffset=n?s.height:0,t.style.paddingTop=n?s.height+"px":"0px"}}},e.prototype.render=function(e){var t=this;if(t._show()&&e&&!this.$element){t.$element=function(e){var t=[],n=i.bootstrap4,s=["no-y-margin no-x-margin"];return n?s.push("fixed-top"):s.push("navbar-fixed-top"),t.push('<div class="'+s.join(" ")+'">'),s=["bs-header-bar no-y-margin no-x-margin no-x-padding  no-y-padding"],n?s.push("bg-dark"):s.push("navbar navbar-inverse"),t.push('<nav class="'+s.join(" ")+'">'),t.push('    <div class="container-fluid no-x-padding">'),t.push('        <div class="bs-title bs-title-nav-pos header_title"></div>'),t.push('        <ul class="'+(n?"":"nav navbar-nav ")+'no-x-margin no-y-margin bs-nav-button bs-left-nav header_left_buttons">'),t.push("        </ul>"),t.push('        <ul class="'+(n?"":"nav navbar-nav ")+'no-x-margin no-y-margin bs-nav-button bs-right-nav header_right_buttons">'),t.push("        </ul>"),t.push("    </div>"),t.push("</nav>"),e.showLocation&&t.push('<div class="bs-header-location"><span class="bs-location-buttons"></span><span class="bs-header-location-title">&nbsp;</span></div>'),t.push("</div>"),$(t.join(""))}(t.options);var n=t.$element.get(0);t.options.showLocation&&(t.$location=$(n.lastChild));var s=c.configuration,r=s&&s.header?s.header:{},u=a.query(n,".header_title");r.uppercase&&a.addClass(u,"bs-transform-uppercase"),r.align&&a.addClass(u,"align-"+r.align),t._renderTitle(),t.renderButtons();var d=e.get(0);t.options.replaceParent&&(d=d.parentNode),t.$parent=$(d),t._auth(!0),t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element),t._setEvents();var p=a.offset(t.$element.get(0));l.topOffset=p.height,d.style.paddingTop=p.height+"px",o.nextTick(function(){t._onresize()})}},e.prototype.destroy=function(){o.log("Header Destroy","destroy"),this.$parent=null,this.$element&&(this._removeEvents(),this.$element=null),this.page&&(this.page.removeChild(this),this.page=null)},e}();t.Header=h}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.pagecontrol,s=i.dom,o=i.link,r=i.utils,a=i.application,l=i.ulocale,u=(i.locale,function(){function t(e,t){this._page=n.Page(),this._options=$.extend({justified:!1,pills:!1},e||{}),this._tabs=t||[]}return t.prototype._renderTabs=function(){var t=this.$element.get(0).firstChild,i=document.createDocumentFragment(),n=$('<li><a href="#"></a><li>').get(0),u=this._page.currentPage();this._tabs.forEach(function(t,c){var d=n.cloneNode(!0),p=d.firstChild;s.text(p,l.localeTitle(t.$title));var h=!1;if(void 0!==t.enabled)if("string"==typeof t.enabled){var f=r.execAngularExpression(t.enabled,o.context());f&&"undefined"!==f&&"false"!==f||(h=!0)}else h=!t.enabled;if(h?s.addClass(d,"disabled"):s.attr(p,"data-phoenix-href","click://"+c),t.$page){var m=o.pageName(t)==u;m&&t.$module&&(m=t.$module===a.name),t.active=!!m}t.active&&s.addClass(d,e.bootstrap4?"show active":"active"),i.appendChild(d)}),s.empty(t),s.append(t,i)},t.prototype._setEvents=function(){var e=this;if(e.$element){var t=e.$element.get(0);e.$element.on("click",function(i){var n=o.isCustomLink(t,i);if(n&&"click"===n.protocol){var s=n.value.substring("click://".length).split("/"),r=o.context(),a=e._tabs[parseInt(s[0],0)];a&&a.$page&&!a.disabled&&o.execLink(a,r,null)}})}},t.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},t.prototype.render=function(e){this.$element||(this.$element=$('<div class="bs-widget-content-inv bs-tabs"><ul class="nav nav-tabs"><ul></div>'),this._renderTabs(),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},t.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null,this._page=null},t}());t.Tabs=u}(e.tabs||(e.tabs={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){t.LAYOUT_BLOCK="block",t.LAYOUT_ROW="row",t.LAYOUT_COLUMN="column",t.LAYOUT_HTML="html",t.LAYOUT_ACCORDION="accordion",t.LAYOUT_ACCORDION_GROUP="accordion-group";var i=e,n=i.dom,s=i.utils,o=i.locale.layouts,r=i.ulocale,a=i.render,l=i.sticky,u=function(e){e.$items.length||(e.$type=t.LAYOUT_BLOCK,e.$origin=t.LAYOUT_ROW)},c=function(e){u(e);var i=!1;if(e.$items.forEach(function(e){e.$type=t.LAYOUT_COLUMN,e.$colSize||(i=!0)}),i){var n=Math.max(1,Math.floor(12/e.$items.length)),s=e.$items.length-1,o=0;e.$items.forEach(function(e,t){t===s&&(n=12-o),e.$colSize=n,o+=n})}},d=function(e){e.$items.length||e.$items.push({$type:t.LAYOUT_ACCORDION_GROUP}),e.$items.forEach(function(e,i){e.$type=t.LAYOUT_ACCORDION_GROUP,e.$title=e.$title||{},e.$name=function(e,t){if(!(e=e||""))return"page"+t;if(0===e.indexOf("page")){var i=e.substring("page".length);if(parseInt(i,10)+""===i)return"page"+t}return e}(e.$name,i),e.$title.value=e.$title.value||o.defaultTitle})},p=function(e){if(e.$type===t.LAYOUT_HTML)return!1;if(e.$items.length>0){if(!e.$items[0].$items)return!1}return!0},h=function(e,n){var s=!0,o=i.bootstrap4;return e.$items.length?!(e.$type===t.LAYOUT_ACCORDION_GROUP&&!e.$widget&&!o)&&(e.$items.forEach(function(e){s&&(i=e,s=!(i.$type===t.LAYOUT_ACCORDION&&!i.$widget));var i}),s):s},f=function(e){if(e.$type&&!e.$items&&(e.$items=[]),e.$type===t.LAYOUT_ROW||e.$type===t.LAYOUT_ACCORDION||e.$type===t.LAYOUT_HTML)return!1;if(e.$items.length>0){var i=e.$items[0];if(i.$type||i.$items)return!1}return!0},m=function(e){if(e.$items&&e.$items.length){var t=!0;return e.$items.forEach(function(e){t=t&&e&&e.options&&e.options.right}),t}return!1},v=function(e,t,i){var s=e.$style;!s&&e.$sticky&&(s="$white"),n.parseStyle(s,t),!i.design&&e.$isHidden&&t.push("bs-none")},g=function(e){return!e.$items||!e.$items.length||e.$items[0].$bind},y=function(n,s,o,r,a){var u,c,d=i.bootstrap4;switch(n.$type){case t.LAYOUT_BLOCK:c=!0,o.design&&n.selected&&r.push("selected"),(u=p(n))&&((o.design||h(n))&&(c=!1,s&&r.push("no-x-padding")),o.design&&(r.push("drop-layouts-zone"),n.$origin===t.LAYOUT_ROW&&r.push("row-color"))),f(n)&&(!n.$inline||!o.design&&n.$html||(e.bootstrap4&&m(n)?r.push("form-inline d-block bs-inline-container"):r.push("form-inline bs-inline-container")),o.design&&(r.push("drop-fields-zone"),u||(c=!1,s&&r.push("no-x-padding")))),c&&r.push("field-container"),s||(r.push("bs-root-container"),o.design&&r.push("bs-scroll-container"),n.form||r.push("page")),o.design&&(r.push("design"),n.selected&&r.push("selected")),v(n,r,o),!o.design&&n.$sticky&&l&&l.native&&(r.push("bs-sticky"),"top"===n.$sticky?a.push("top:"+l.topOffset+"px;"):"bottom"===n.$sticky&&a.push("bottom:"+l.bottomOffset+"px;"));break;case t.LAYOUT_ACCORDION:1===o.step&&(r.push("panel-group bs-island"),o.design&&(r.push("design"),r.push("drop-layouts-zone"),n.selected&&r.push("selected")),v(n,r,o));break;case t.LAYOUT_ROW:1===o.step?(r.push("container-fluid"),!o.design&&n.$forceTable&&r.push("no-x-padding"),o.design&&(r.push("design"),r.push("no-x-padding"),n.selected&&r.push("selected")),v(n,r,o)):2===o.step&&(r.push("row"),n.$forceTable&&r.push("bs-row-table"),o.design&&(r.push("design-table"),r.push("row-color"),(u=p(n))&&r.push("drop-layouts-zone")));break;case t.LAYOUT_ACCORDION_GROUP:1===o.step?(d?r.push("card"):r.push("panel panel-default"),o.design&&(r.push("design"),n.selected&&r.push("selected"))):2===o.step?d?(r.push("collapse"),n.opened&&r.push("show")):(r.push("panel-collapse collapse"),n.opened&&r.push("in")):3===o.step&&(d&&r.push("card-body"),(u=p(n))&&((o.design||h(n))&&(r.push("no-x-padding"),r.push("no-y-padding")),o.design&&r.push("drop-layouts-zone")),f(n)&&(!n.$inline||!o.design&&n.$html||(e.bootstrap4&&m(n)?r.push("form-inline d-block bs-inline-container"):r.push("form-inline bs-inline-container")),o.design&&(r.push("drop-fields-zone"),u||r.push("no-x-padding"))),v(n,r,o));break;case t.LAYOUT_COLUMN:1===o.step?(o.design?r.push("col-design col"+(d?"":"-xs")+"-"+n.$colSize):n.$customColSize?r.push(n.$customColSize):r.push("col-"+(n.$colType||"sm")+"-"+n.$colSize),r.push("no-x-padding")):2===o.step&&(c=!0,r.push("container-fluid"),(u=p(n))&&((o.design||h(n))&&(c=!1,r.push("no-x-padding")),o.design&&!n.$auto&&r.push("drop-layouts-zone")),f(n)&&(!n.$inline||!o.design&&n.$html||(e.bootstrap4&&m(n)?r.push("form-inline d-block bs-inline-container"):r.push("form-inline bs-inline-container")),o.design&&(r.push("drop-fields-zone"),u||(r.push("no-x-padding"),c=!1))),c&&r.push("field-container"),o.design&&(r.push("design col"),n.$auto&&r.push("auto"),n.selected&&r.push("selected")),v(n,r,o));break;case t.LAYOUT_HTML:o.design&&(r.push("design"),n.selected&&r.push("selected")),v(n,r,o)}},_=function(e,t,i,n){var s=[],o=[];y(t,i,n,s,o),s.length&&(e.push(' class="'),e.push(s.join(" ")),e.push('"')),o.length&&(e.push(' style="'),e.push(o.join(" ")),e.push('"'))},$=function(e,t,i){e.push(' id="'),e.push(i?i+"_"+t.$id:t.$id),e.push('"')},b=function(e,t,i){i&&(e.push(' data-level="'),e.push(t),e.push('"'))},x=function(e,t,i,n,s){if((s||n)&&(e.push(' data-layout="'),e.push(i.$id),e.push('"'),i.$idSelect=null),s||n&&t>1){var o=i["$idStep"+t];o&&(e.push(' id="'),e.push(o),e.push('"'))}},C=function(e,t,a,l,u){if(t.$title&&t.$title.value===o.defaultTitle)delete t.$title;else if(l&&t.$title&&!t.$title.isHidden){var c=t.$title.size||(i.bootstrap4?5:4);e.push("<h"+c);var d=["bs-block-title"];if(t.$title.$style&&n.parseStyle(t.$title.$style,d),e.push(' data-ignore="true" class="'+d.join(" ")+'" id="'+t.$id+'_title">'),t.$title.value){var p=r.tt(t.$title.value,a);t.$fields&&(p=s.execAngularExpression(p,u||{})),e.push(s.escapeHtml(p))}e.push("</h"+c+">")}},k=function(e,t,i,n,s,o,r,a){e.push("<div"),o&&e.push(' draggable="true"'),_(e,t,i,{design:o,step:1}),x(e,1,t,o),$(e,t),b(e,1,o),e.push(">"),C(e,t,s,r,n)},w=function(e,t,i,n,s,o){e.push("</div>")},E=function(e,t,i,n,s,o,r){e.push("<div"),o&&e.push(' draggable="true"'),_(e,t,i,{design:o,step:1}),x(e,1,t,o),$(e,t),b(e,1,o),e.push(">"),t.$html&&e.push(t.$html)},O=function(e,t,i,n,s){e.push("</div>")},S=function(t,n,o,a,l,u,c,p){if(d(n),u||!n.$widget)t.push('<div role="tablist"'),e.bootstrap4||t.push(' aria-multiselectable="true"'),u&&t.push(' draggable="true"'),_(t,n,o,{design:u,step:1}),x(t,1,n,u),$(t,n),b(t,1,u),t.push(' id="'+n.$id+'_parent"'),t.push(">");else{if("tabs"!==n.$widget&&"none"!==n.$widget)throw"Invalid accordion $widget.";var h="none"===n.$widget;t.push("<div"),_(t,n,o,{design:u,step:1}),x(t,1,n,u),$(t,n),b(t,1,u),t.push(">"),t.push('<ul  id="'+n.$id+'_tab" class="nav nav-tabs bs-tabs'+(h&&!n.showTabs?" bs-none":"")+'" role="tablist">'),n.$items.forEach(function(e){return function(e,t,n,o,a,l,u,c,d){if(i.bootstrap4){e.push('<li class="nav-item">');var p=["nav-link"];t.opened&&p.push("active"),e.push(s.format('<a class="'+p.join(" ")+'" id="{0}_title" href="#{0}" data-layout="{0}" aria-expanded="'+(t.opened?"true":"false")+'" role="tab" data-toggle="tab">',t.$id));var h=r.tt(t.$title.value,a);t.$fields&&(h=s.execAngularExpression(h,c||{})),e.push(s.escapeHtml(h)),e.push("</a></li>")}else e.push('<li role="presentation"'),t.opened&&e.push(' class="active"'),e.push(">"),e.push(s.format('<a href="#{0}" id="{0}_title" aria-controls="{0}"  data-layout="{0}" role="tab" data-toggle="tab">',t.$id)),h=r.tt(t.$title.value,a),t.$fields&&(h=s.execAngularExpression(h,c||{})),e.push(s.escapeHtml(h)),e.push("</a></li>")}(t,e,0,0,l,0,0,a)}),t.push("</ul>"),t.push('<div class="tab-content">')}},P=function(e,t,i,n,s,o){o||!t.$widget?e.push("</div>"):"tabs"!==t.$widget&&"none"!==t.$widget||(e.push("</div>"),e.push("</div>"))},I=function(e,t,n,o,r,a,l,u){var c=i.bootstrap4;if(a||!n.$widget)e.push("<div"),_(e,t,n,{design:a,step:1}),x(e,1,t,a),$(e,t),b(e,1,a),t.$idStep2=t.$id+"_s2",t.$idStep3=t.$id+"_s3",t.$idDesign=t.$idStep3,a&&e.push(' draggable="true"'),e.push(">"),c?e.push('<div class="card-header" role="tab"'):e.push('<div class="panel-heading" role="tab"'),$(e,t,"heading"),e.push(">"),c?e.push('<h5 class="mb-0">'):(e.push('<h4 class="panel-title bs-pointer collapsed" data-toggle="collapse" data-parent="#'+n.$id+'"'),t.opened?e.push(' aria-expanded="true"'):e.push(' aria-expanded="false"'),e.push(' data-target="#'+t.$idStep2+'" aria-controls="'+t.$idStep2+'"'),e.push(' id="'+t.$id+'_title">')),c&&(e.push("<a"),e.push(' data-toggle="collapse"'),e.push(' href="#'+t.$idStep2+'"'),e.push(' aria-controls="'+t.$idStep2+'"'),t.opened?e.push(' aria-expanded="true"'):(e.push(' aria-expanded="false"'),e.push(' class="collapsed"')),e.push(">")),e.push(s.escapeHtml(t.$title?t.$title.value:"")),c?e.push("</a></h5>"):e.push("</h4>"),e.push("</div>"),e.push('<div role="tabpanel" aria-labelledby="heading_'+t.$id+'"'),c&&e.push(' data-parent="#'+n.$id+'"'),_(e,t,n,{design:a,step:2}),x(e,2,t,a,!0),b(e,2,a),e.push(">"),e.push("<div"),_(e,t,n,{design:a,step:3}),x(e,3,t,a,!0),e.push(">");else if("tabs"===n.$widget||"none"===n.$widget){var d=["tab-pane fade"];t.opened&&d.push("in "+(c?"show active":"active")),e.push('<div role="tabpanel"'),e.push(' class="'+d.join(" ")+'"'),t.$idDesign=t.$id,$(e,t),e.push(">")}},D=function(e,t,i,n,s,o){o||!i.$widget?e.push("</div></div></div>"):"tabs"!==i.$widget&&"none"!==i.$widget||e.push("</div>")},M=function(e,t,i,n,s,o,r,a){e.push("<div"),o&&e.push(' draggable="true"'),_(e,t,i,{design:o,step:1}),$(e,t),x(e,1,t,o),b(e,1,o),e.push(">"),t.$idStep2=t.$id+"_s2",t.$idDesign=t.$idStep2,e.push("<div"),_(e,t,i,{design:o,step:2}),x(e,2,t,o),b(e,2,o),e.push(">"),c(t)},T=function(e,t,i,n,s,o){e.push("</div></div>")},L=function(e,t,i,n,s,o,r,a){e.push("<div"),_(e,t,i,{design:o,step:1}),x(e,1,t,o),$(e,t),b(e,1,o),e.push(">"),e.push("<div"),_(e,t,i,{design:o,step:2}),o&&e.push(' draggable="true"'),t.$idDesign=t.$id+"_design",t.$idDrag=t.$id,t.$idStep2=t.$idDesign,x(e,2,t,o),b(e,2,o),t.$idSelect=t.$idDesign,e.push(">"),C(e,t,s,r,n)},F=function(e,t,i,n,s,o){e.push("</div></div>")},N=function(e,t,i,n,s){if(e){if(n&&!e.$type&&!e.$items)return void i(e,t,!1,!0,s);i(e,t,!0,!0,s),s&&s.stop||(f(e)?e.$items&&e.$items.forEach(function(t){i(t,e,!1,!0,s)}):e.$items&&e.$items.forEach(function(t){N(t,e,i,!1,s)})),i(e,t,!0,!1,s)}},A=function(e,t,i,n,s){e.push('<div class="bs-island'+(s.design?" design":"")+(t.$config?" bs-widget":" bs-field")+(t.selected?' selected"':'"')),s.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push("></div>")},R=function(e,t,i,n,s){e.push('<div id="'+t.$id+'"></div>')},j=function(e,i,o,r,l,u){var c=a.get(l.context,"widget")||R,d=a.get(l.context,"field")||A,p=e.form;N(e,null,function(e,o,a,h,m){if(a){var v=k,g=w;switch(e.$type){case t.LAYOUT_ROW:v=M,g=T;break;case t.LAYOUT_COLUMN:v=L,g=F;break;case t.LAYOUT_ACCORDION:v=S,g=P;break;case t.LAYOUT_ACCORDION_GROUP:v=I,g=D;break;case t.LAYOUT_HTML:v=E,g=O}h?(e.$ref&&l.design&&(m.stop=!0),v(m.html,e,o,i,r,l.design,p,m.stop),m.stop&&(y=m.html,_=e,l.design,y.push(s.format('<div id="{0}_settings" class="bs-cursor-p bs-layout-detail" data-layout-detail="true"><span class="'+n.iconClass("cog")+'"></span></div>',_.$id))),u&&u(e)):(!l.design&&e.$html&&e.$items&&e.$items.length&&f(e)&&m.html.push(s.format(e.$html.replace(/id="/g,'id="{0}_'),e.$id)),g(m.html,e,o,i,r,l.design),e.$ref&&l.design&&(m.stop=!1))}else e.$config?c(m.html,e,o,i,l):d(m.html,e,o,i,l);var y,_},!0,{html:o})},H=function(e,i,n,r,a,l){N(e,i,function(e,i,c,d){d&&(c?function(e,i,n,r){if(e.$id||(e.$id=s.allocID()),i&&(e.$parentId=i.$id),e.$idDesign=e.$id,e.$idDrag=e.$id,e.$type=e.$type||t.LAYOUT_BLOCK,e.$items=e.$items||[],e.$title&&(e.$title.style||void 0==e.$title.style||delete e.$title.style),g(e)?e.$fieldsOptions&&!Object.keys(e.$fieldsOptions)&&delete e.$fieldsOptions:(delete e.$inline,delete e.$fieldsOptions),n&&(n[e.$id]=e),r&&e.$name){var a=r[e.$name];a?Array.isArray(a)?a.push(e):r[e.$name]=[r[e.$name],e]:r[e.$name]=e}switch(e.$type!==t.LAYOUT_HTML||e.$html||(e.$html=o.Html),e.$type){case t.LAYOUT_ROW:u(e);break;default:delete e.$forceTable}e.$origin&&e.$origin===e.$type&&delete e.$origin,e.$type!==t.LAYOUT_ACCORDION_GROUP&&e.$title&&e.$title.value===o.defaultTitle&&delete e.$title}(e,i,n,a):(h=i,f=r,m=l,(p=e).$id||(p.$id=s.allocID()),h&&(p.$parentId=h.$id),p.$idDrag=p.$id,f&&(f[p.$id]=p),m&&p.$name&&(m[p.$name]=p)));var p,h,f,m},!0)};t.check=H,t.layoutVisible=function(e){return e.$type!==t.LAYOUT_ACCORDION_GROUP||e.opened},t.clearMeta=function(e,i){N(e,null,function(n,s,r,a){a&&(r?(i&&delete n.$id,delete n.$fields,delete n.$render,delete n.$idDesign,delete n.$idDrag,delete n.$idSelect,delete n.$parentId,delete n.$idStep2,delete n.$idStep3,delete n.$content,delete n.selected,delete n.showTabs,n.$type!==t.LAYOUT_BLOCK&&(delete n.$sticky,n.$type===t.LAYOUT_COLUMN?delete n.$type:e.$type===t.LAYOUT_HTML&&e.$html===o.Html&&delete e.$html),n.$type===t.LAYOUT_ROW&&!1!==e.$forceTable||delete e.$forceTable,n.$name||void 0===n.$name||delete n.$name,!1===n.$inline&&delete n.$inline,n.$fieldsOptions&&(!1===n.$fieldsOptions.columns&&delete n.$fieldsOptions.columns,!1===n.$fieldsOptions.titleIsHidden&&delete n.$fieldsOptions.titleIsHidden,0===Object.keys(n.$fieldsOptions).length&&delete n.$fieldsOptions),n.datasets&&0===Object.keys(n.datasets).length&&delete n.datasets):(delete n.$render,i&&delete n.$id,delete n.$parentId,delete n.$idDrag,delete n.selected,n.$config&&(n.$config.data&&(delete n.$config.data.ds,Object.keys(n.$config.data).length||delete n.$config.data),(n.$config.$titleIsHidden||n.$config.$dontSaveTitle)&&delete n.$config.$title)))},!0)},t.namesOfLayout=function(e){var t=[];return N(e,null,function(e,i,n,s,o){n&&s&&e.$name&&t.push({name:e.$name,title:e.$title&&e.$title.value?e.$title.value:e.$name})},!0),t},t.clearMaps=function(e,t,i,n,s){N(e,null,function(e,o,r,a){if(a)if(r){if(delete t[e.$id],e.$name){var l=n[e.$name];if(Array.isArray(l)){var u=l.indexOf(e);u>=0&&l.splice(u,1),l.length||delete n[e.$name]}else delete n[e.$name]}}else delete i[e.$id],e.$name&&delete s[e.$name]},!0)},t.afterRemoveChild=function(e,i,n,s,o){e.$type===t.LAYOUT_ROW?(e.$items.forEach(function(e){e.$type=t.LAYOUT_COLUMN,delete e.$colSize}),c(e),e.$items.forEach(function(t){H(t,e,i,n,s,o)})):e.$type===t.LAYOUT_ACCORDION&&(d(e),e.$items.forEach(function(t){H(t,e,i,n,s,o)}))},t.canSelect=function(e,i){return!e.$auto&&(e.$type!==t.LAYOUT_COLUMN||1!==i)},t.updateCssClass=function(e,i,s,o){var r,a=[],l=[];y(i,s,o,a,l),e.className=a.join(" "),l.length&&(e.style=l.join(" ")),i.$type===t.LAYOUT_ACCORDION_GROUP&&1===o.step?(r=n.find(e,i.$id+"_title"))&&n.text(r,i.$title&&i.$title.value?i.$title.value:""):i.$type===t.LAYOUT_HTML&&1===o.step&&(e.innerHTML=i.$html||"")},t.toHtml=function(e,t,i,n,s){var o=[];return j(e,t,o,i,n,s),o.join("")},t.updateLayoutTitle=function(e,t,i,o){if(t.$title.value){var a=r.tt(t.$title.value,o);t.$fields&&(a=s.execAngularExpression(a,i||{})),n.text(e,a)}},t.enumSubLayouts=function(e,t){N(e,null,function(e,i,n,s){s&&n&&t(e)},!1)}}(e.layoutUtils||(e.layoutUtils={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.pagecontrol,n=t.menu,s=t.dom,o=t.utils,r=(t.locale,t.WidgetUtils,t.link),a=t.render,l=t.ipc,u=t.sticky,c=t.layoutUtils;!function(t){var d=function(e){for(var t=e.length;t--;)for(var i=e[t],n=Object.keys(i),s=n.length;s--;){var o=i[n[s]];if(o.selected)return o}return null},p=function(){function e(e,t,i,n,s,o){t=this.initOptions(t),this.$locale=null,this._init(e,t)}return e.prototype._afterCreate=function(){},e.prototype.initOptions=function(e){return e},e.prototype._init=function(e,t){this.$element=null,this.$content=null,this.options=t||{},this.options.context=this.options.context||"javascript",this.map={},this.mapFields={},this.namedMap={},this.namedMapFields={},e=e||{},c.check(e,null,this.map,this.mapFields,this.namedMap,this.namedMapFields),this.data=e,this.data.form=this.options.form,e.map=this.map,e.fields=this.mapFields,this.children={},this.controls={},this.expressionTitle=!1;this.options.form||(this.page=i.Page(),this.page.setPopup(null),this.page.addChild("layout",this),this.options.design||(this.expressionTitle=o.hasExpression(e.$title),this.page.props.$title=e.$title?o.parseExpression(e.$title,r.context()):null)),this._setDesignListeners(),this.pageLayoutInit()},e.prototype.pageLayoutInit=function(){},e.prototype.getSchema=function(e){return null},e.prototype.getLookupForSchema=function(e,t){return null},e.prototype._setDesignListeners=function(){},e.prototype._removeEvents=function(){this._removeBaseEvents()},e.prototype._addEvents=function(){this._addBaseEvents()},e.prototype._removeBaseEvents=function(){this._removeAccordionEvents()},e.prototype._addBaseEvents=function(){this._setAccordionEvents()},e.prototype._onSelectedChanged=function(e,t,i){},e.prototype._showSelected=function(e,t){},e.prototype._setAccordionEvents=function(){var e=this;e.$element.on("shown.bs.collapse hide.bs.collapse shown.bs.tab hide.bs.tab",function(t){var i=t.target;if(i&&i.hasAttribute("data-layout")){var n=i.getAttribute("data-layout"),s=e.getLayoutById(n);if(s){var o="shown"===t.type;if(s.opened===o)return;o?e._openTab(n):e._activateLayout(s,!1)}}})},e.prototype._activatePageLayout=function(e){var t=this.$element?s.find(this.$element.get(0),e.$id+"_title"):null;if(t){$(t).tab("show")}},e.prototype.activatePage=function(e){var t=this,i=t.getLayoutsByName(e);i&&i.forEach(function(e){return t._activatePageLayout(e)})},e.prototype._openTab=function(e){var t=this.getLayoutById(e);if(!t.opened){var i=this.getLayoutById(t.$parentId);if(i)for(var n=0,s=i.$items.length;n<s;n++){var o=i.$items[n];if(o.opened){o.opened=!1,this._activateLayout(o,!1);break}}t.opened=!0,this._updateLayoutContent(t),this._activateLayout(t,!0)}},e.prototype._doDatasetEventAfterEnabled=function(e){},e.prototype._activateLayout=function(e,t){var i=this;t?i._getVisibleChildren(e).forEach(function(e){e.disabled=!1,i._doDatasetEventAfterEnabled(e)}):i._getChildrenOf(e).forEach(function(e){e.disabled=!0}),i._afterVisibilityChanged({inDom:!0,resize:t})},e.prototype._removeAccordionEvents=function(){this.$element.off("show.bs.collapse hide.bs.collapse")},e.prototype.toString=function(e){return null},e.prototype.emit=function(e,t,i){this.emitDataEvent(e,t,i)},e.prototype.openErrors=function(){if(this.$element){var e=s.find(this.$element.get(0),this.data.$id+"_error");e&&e.firstChild&&s.removeClass(e.firstChild,"bs-none")}},e.prototype._getFormLData=function(){return null},e.prototype._renderLayout=function(e){var t=this;t.stickies=null;var i=$(c.toHtml(e,t._getFormLData(),t.$locale,{design:t.options.design,context:t.options.context},function(e){t.options.design||u.native||!e.$sticky||(t.stickies=t.stickies||{},t.stickies[e.$id]=e)}));return t.$element=i,t.afterRender(i),t._renderChildren(i),t.afterRenderChildren(i),i},e.prototype.afterRenderChildren=function(e){},e.prototype.isChildOf=function(e,t){for(var i=this.map[e];i;){if(i==t)return!0;i=this.map[i.$parentId]}return!1},e.prototype._isChildVisibleOf=function(e,t){for(var i=this.map[e];i;){if(!c.layoutVisible(i))return!1;if(i==t)return!0;i=this.map[i.$parentId]}return!1},e.prototype._getVisibleChildren=function(e){var t=this,i=[];return Object.keys(t.controls).forEach(function(n){var s=t.controls[n];t.controls[n].item&&t._isChildVisibleOf(t.controls[n].item.$parentId,e)&&i.push(s)}),i},e.prototype._getChildrenOf=function(e){var t=this,i=[];return Object.keys(t.controls).forEach(function(n){var s=t.controls[n];t.controls[n].item&&t.isChildOf(t.controls[n].item.$parentId,e)&&i.push(s)}),i},e.prototype._getEventListFor=function(e){var t=[];return e.forEach(function(e){e.datasets&&Object.keys(e.datasets).forEach(function(i){var n=e.datasets[i];n.enumTriggers&&n.enumTriggers(!1,function(e){t.indexOf(e)<0&&t.push(e)})})}),t},e.prototype._refreshDataSets=function(e){},e.prototype._afterLayoutAdded=function(e){},e.prototype._updateLayoutContent=function(e){var t=s.find(this.$element.get(0),e.$idDesign),i=$(t);this._renderChildren(i),this.afterAddedInDom()},e.prototype._renderLayoutContent=function(e){var t=s.find(this.$element.get(0),e.$idDesign);if(t){var i=$(t),n=$(e.$content.join("")),o=t.parentNode,r=t.nextSibling;i.detach(),i.append(n),delete e.$content,this.options.beforeAdd&&this.options.beforeAdd(i,!0),o.insertBefore(t,r),this._afterLayoutAdded(e),this._renderChildren(i);var a=this._getVisibleChildren(e);this._refreshDataSets(a),this.afterAddedInDom(),this.options.design&&(this._removeEvents(),this._addEvents())}},e.prototype._isVisible=function(e){for(;;){if(!e)return!0;var t=this.map[e];if(!t)return!0;if(!c.layoutVisible(t))return!1;e=t.$parentId}},e.prototype._renderChildren=function(e){var t=this,i=[],n=e.get(0),r=a.get(t.options.context,"widget.control"),l=a.get(t.options.context,"field.control"),u=[],c={},d=[];return t._autofocus=null,(r||l)&&(Object.keys(t.mapFields).forEach(function(e){if(!t.children[e]){var a=t.mapFields[e];if(t._isVisible(a.$parentId)){var p=a.$config?r:l,h=p===l;if(h){var f=0===(a.$bind||"").indexOf("$$"),m=t.getSchema(a.$bind),v=void 0;m||f||console.log('Schema not found for field "'+a.$bind+'".'),a&&a.$lookup&&(v=t.getLookupForSchema(a.$bind,a.$lookup)),p=p?p(a,m,v):null}if(p){var g,y={context:t.options.context,design:t.options.design,replaceParent:!0,readOnly:a.$readOnly};if(h){if((g=new p(a,y,t)).isMeta()?u.push(g):a.$bind&&(c[a.$bind]=g),a.options&&a.options.autofocus&&(t._autofocus=g),g.getSubControls&&g.addSubControls){var _=g.getSubControls();_&&_.forEach(function(e){var i,n=0===(e.$bind||"").indexOf("$$"),s=t.getSchema(e.$bind);s||n||console.log('Schema not found for field "'+e.$bind+'".'),e&&e.$lookup&&(i=t.getLookupForSchema(e.$bind,e.$lookup));var o=new(l?l(e,s,i):null)(e,{context:t.options.context,design:t.options.design,replaceParent:!1,readOnly:e.$readOnly},t);o.isMeta()?u.push(o):e.$bind&&(c[e.$bind]=o),g.addSubControls(o)})}}else g=new p(a,y,t);var $=void 0;if(t.options.design||!a.$htmlParent)$=s.find(n,a.$id);else if($=s.find(n,a.$parentId+"_"+a.$htmlParent)){y.replaceParent=!1;var b=s.find(n,a.$id);b&&s.remove(b)}else $=s.find(n,a.$id);if(d.push({parent:$,control:g}),t.children[e]=g,t.controls[e]=g,g.resize&&(t.resizeList=t.resizeList||[],t.resizeList.push(g)),i.push(g),h&&g.getChildren){var x=g.getChildren();x&&x.forEach(function(e){d.push({parent:e.parent,control:e.control}),e.control.id=e.control.id||o.allocID(),t.children[e.control.id]=e.control,t.controls[e.control.id]=e.control,e.control.resize&&(t.resizeList=t.resizeList||[],t.resizeList.push(e.control))})}}}}}),u.forEach(function(e){var t=e.getCustomBind();if(t){var i=c[t];i&&e.setParentId(i.id)}}),d.forEach(function(e){"string"==typeof e.parent&&(e.parent=s.find(n,e.parent)),e.control.render($(e.parent)),e.control.afterAddedInDom&&(t.afterRenderList=t.afterRenderList||[],t.afterRenderList.push(e.control))})),i},e.prototype.addControl=function(e,t,i){},e.prototype._afterVisibilityChanged=function(e){this._refreshCurrentResizeList(),this._refreshStickies(e.resize)},e.prototype._refreshStickies=function(e){var t=this;if(t.stickies&&t.$element){var i={};Object.keys(t.stickies).forEach(function(e){var n=t.stickies[e];t._isVisible(n.$parentId)&&(i[n.$id]=n,!0)});var n=[];t.activeStickies&&Object.keys(t.activeStickies).forEach(function(e){i[e]?delete i[e]:n.push(t.activeStickies[e])}),t.activeStickies=t.activeStickies||{},n.forEach(function(e){delete t.activeStickies[e.id],u.stickyManager.remove(e.id)}),Object.keys(i).forEach(function(e){var n=i[e];if(n.$type===c.LAYOUT_BLOCK){var o=s.find(t.$element.get(0),n.$id);o&&(t.activeStickies[n.$id]={id:n.$id,element:o,position:n.$sticky},u.stickyManager.add(t.activeStickies[n.$id]))}}),e&&u.stickyManager.refresh(!0)}},e.prototype._refreshCurrentResizeList=function(){var e=this;e.resizeList?e.currentResizeList?(e.currentResizeList=[],e.resizeList.forEach(function(t){e._isVisible(t.config.$parentId)&&e.currentResizeList.push(t)})):e.currentResizeList=e.resizeList.map(function(e){return e}):e.currentResizeList=null},e.prototype._clearSticks=function(){this.stickies=null,this.activeStickies&&(Object.keys(this.activeStickies).forEach(function(e){u.stickyManager.remove(e)}),this.activeStickies=null)},e.prototype._clearChildren=function(){var e=this.children;this.children={},this.controls={},this._clearSticks(),this.resizeList=null,this.currentResizeList=null,this.afterRenderList=null,Object.keys(e).forEach(function(t){e[t].destroy()})},e.prototype._refreshSelected=function(){if(this.options.design){var e=d([this.map,this.mapFields]);this._onSelectedChanged(this.$element.get(0),e,!0)}},e.prototype.registerDataListener=function(e){this.page&&this.page.registerDataListener(e,this)},e.prototype.removeDataListener=function(e){this.page&&(e==this?this.page.removeParentDataListener(this):this.page.removeDataListener(e))},e.prototype.emitDataEvent=function(e,t,i){this.page&&this.page.emitDataEvent(e,t,i)},e.prototype.afterRender=function(e){},e.prototype._internalRender=function(e,t){return this.$element||(this.$element=this._renderLayout(this.data),this.options.beforeAdd&&this.options.beforeAdd(this.$element,t),this.$content.append(this.$element),this._addEvents(),this._refreshSelected(),e&&(this.options.form||s.bodyTheme(this.data.$theme),this.options.replaceParent?e.replaceWith(this.$content):e.append(this.$content),this._afterVisibilityChanged({inDom:!1,resize:!0}),this.afterAddedInDom())),this.$content},e.prototype.afterAddedInDom=function(){var e=r.context();e.$url.$scroll&&this.scrollTo(e.$url.$scroll)},e.prototype._callInternalRender=function(e,t){this._internalRender(e,t)},e.prototype.render=function(e){var t;return this.$content?this.$element&&(t=!0,this._clearChildren(),this._removeEvents(),this.options.beforeRemove&&this.options.beforeRemove(this.$element),this.$element.remove(),this.$element=null):this.$content=$("<div></div>"),this._callInternalRender(e,t),this.$content},e.prototype._destroyDataSets=function(){},e.prototype.destroy=function(){o.log("Destroy Layout","destroy"),this._destroyDataSets(),l.unlisten(this),this.removeDataListener(this),this._clearChildren(),this.page&&(this.page.removeChild(this),this.page=null),this.$element&&(this._removeEvents(),this.$element=null),this._autofocus=null,this.map=null,this.mapFields=null,this.namedMap=null,this.namedMapFields=null,this.autoClose=null,c.clearMeta(this.data,!1)},e.prototype.check=function(e,t){var i=!1;e||(this.map={},this.mapFields={},this.namedMap={},this.namedMapFields={},t=null,e=this.data,i=!0),c.check(e,t,this.map,this.mapFields,this.namedMap,this.namedMapFields),i&&(e.fields=this.mapFields,e.map=this.map)},e.prototype._afterStructureChanged=function(e){this.render()},e.prototype._afterPropsChanged=function(e){if(this.$element){var t=this.$element.get(0);if(t){var i=s.find(t,e.$id),n=e.$id!=e.$idStep2?s.find(t,e.$idStep2):null,o=e.$idStep3?s.find(t,e.idStep3):null;i&&c.updateCssClass(i,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:1}),n&&c.updateCssClass(n,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:2}),o&&c.updateCssClass(o,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:3}),e.selected&&this._refreshSelected()}}},e.prototype.removeChild=function(e){if(e&&this.options.design){var t=this.map[e]||this.mapFields[e];if(t){var i=this.map[t.$parentId];if(i&&(!i.$auto||(t=i,i=this.map[t.$parentId]))){var n=i.$items.indexOf(t);i.$items.splice(n,1),c.clearMaps(t,this.map,this.mapFields,this.namedMap,this.namedMapFields),c.afterRemoveChild(i,this.map,this.mapFields,this.namedMap,this.namedMapFields),this._afterStructureChanged(i)}}}},e.prototype.setDesignMode=function(e){this.options.design!=e&&(this.options.design=e,this.render())},e.prototype.getLayoutById=function(e){if(!e)return null;return this.map[e]},e.prototype.getLayoutElementByName=function(e){if(!e)return null;var t=this.namedMap[e];return t&&this.$element?s.find(this.$element.get(0),t.$id):null},e.prototype.getLayoutByName=function(e){if(!e)return null;var t=this.namedMap[e];return t&&Array.isArray(t)?t[0]:t},e.prototype.getLayoutsByName=function(e){if(!e)return null;var t=this.namedMap[e];return t?Array.isArray(t)?t:[t]:null},e.prototype.scrollTo=function(e){var t=this.getLayoutByName(e);if(t&&this.$element){var i=s.find(this.$element.get(0),t.$id);i&&i.scrollIntoView({behavior:"smooth",block:"start"})}},e.prototype.getNamedLayouts=function(){return c.namesOfLayout(this.data)},e.prototype.getFieldById=function(e){if(!e)return null;return this.mapFields[e]},e.prototype.select=function(e){var t=this.$element;if(this.options.design){var i=d([this.map,this.mapFields]);if(i&&(i.selected=!1,this._showSelected(t,i),this._onSelectedChanged(t.get(0),i,!1),i.$id==e))this._onSelectedChanged(t.get(0),null,!0);else if(e){var n=this.map[e]?this.map[e]:this.mapFields[e];n&&(n.selected=!0,this._showSelected(t,n),this._onSelectedChanged(t.get(0),n,!0))}}},e.prototype.updateField=function(e,t){var i=this.mapFields[e];if(i)if(i.$render&&i.$config)Object.keys(t.$config).forEach(function(e){"form"!==e&&"data"!==e&&"datasets"!==e&&i.$render[e]!=t.$config[e]&&(i.$render[e]=t.$config[e])}),(i.$config.hasOwnProperty("form")||t.$config.hasOwnProperty("form"))&&(i.$config.form=t.$config.form),i.$config.datasets=t.$config.datasets,i.$config.data=t.$config.data,this._afterStructureChanged(null);else{if(o.equals(i,t))return;var n=Object.keys(t),s=Object.keys(i);n.forEach(function(e){i[e]=t[e]}),n.push("$id"),n.push("$parentId"),n.push("$idDrag"),s.forEach(function(e){n.indexOf(e)<0&&delete i[e]});var r=this.children[e];r&&(delete this.controls[e],delete this.children[e],r.destroy()),this._afterStructureChanged(null)}},e.prototype._cleanIds=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},e.prototype._blockToCols=function(e){var t=this;e.$items&&e.$items.forEach(function(i,n){var s=i.$origin||i.$type;if(s===c.LAYOUT_BLOCK||s===c.LAYOUT_COLUMN)i.$type=c.LAYOUT_COLUMN,t._cleanIds(e);else c.LAYOUT_COLUMN,i.$colSize,i.$customColSize})},e.prototype._changeType=function(e,t){var i=this,n=i.map[e.$parentId],s=n&&n.$auto?i.map[n.$parentId]:null;switch(e.$origin||e.$type){case c.LAYOUT_BLOCK:t===c.LAYOUT_ROW&&(e.$type=t,i._blockToCols(e),i._cleanIds(e),i.check(e,n));break;case c.LAYOUT_COLUMN:if(t===c.LAYOUT_ROW){var o={$items:e.$items,$type:t,selected:!1};e.$auto=!0,e.$type=c.LAYOUT_COLUMN,e.$items=[o],e.selected&&(e.selected=!1,o.selected=!0),i._blockToCols(o),i._cleanIds(e),i.check(e,n)}break;case c.LAYOUT_ROW:if(t===c.LAYOUT_BLOCK){if(s){var r=s.$items.indexOf(n);s.$items[r]=e,e.$type=n.$type,e.$parentId=s.$id,n.$type==c.LAYOUT_COLUMN&&(e.$colSize=n.$colSize,e.$customColSize=n.$customColSize),n=s}else e.$type=t;e.$origin&&delete e.$origin,e.$items&&e.$items.forEach(function(t,n){if(t.$type)if(t.$auto){var s=t.$items[0];s.$colSize=t.$colSize,s.$customColSize=t.$customColSize,s.$parentId=e,e.$items[n]=s,i._cleanIds(t)}else t.$type=c.LAYOUT_BLOCK,i._cleanIds(t)}),i._cleanIds(e),i.check(e,n)}break;case c.LAYOUT_ACCORDION:}},e.prototype.updateIsHidden=function(e,t){e.$isHidden!==t&&(e.$isHidden=t,this._afterPropsChanged(e),t||this._activateLayout(e,!0))},e.prototype.updateLayout=function(e,t){var i=this,n=i.map[e],s=!1,r=!1,a=!1;if(n){if(delete t.onlyFields,t.$type){var u=n.$origin||n.$type;t.$type!==u&&(i._changeType(n,t.$type),delete t.$type,s=!0)}if(t.parent){var d=i.map[n.$parentId];i._disableRules=!0,Object.keys(t.parent).forEach(function(e){t.parent[e]!==d[e]&&(d[e]=t.parent[e],s=!0)}),i._disableRules=!1,delete t.parent}if(delete t.selected,i._disableRules=!0,n.$title&&!t.$title?(delete n.$title,s=!0):!n.$title&&t.$title?(delete n.$title,n.$title=t.$title,delete t.$title,s=!0):n.$title&&t.$title&&(Object.keys(t.$title).forEach(function(e){t.$title[e]!=n.$title[e]&&(n.$title[e]=t.$title[e],s=!0)}),delete t.$title),(n.$inline||!1)!==(t.$inline||!1)&&(n.$inline=t.$inline,r=!0,n.$items.length&&(s=!0),delete t.$inline),o.equals(n.$fieldsOptions,t.$fieldsOptions)||(n.$fieldsOptions=t.$fieldsOptions,r=!0,n.$items.length&&(s=!0)),delete t.$fieldsOptions,(n.$refProperty||"")!==(t.$refProperty||"")&&(n.$refProperty=t.$refProperty,s=!0),(n.$refController||"")!==(t.$refController||"")&&(n.$refController=t.$refController,s=!0),(n.$sticky||"")!==(t.$sticky||"")&&(n.$sticky=t.$sticky,s=!0),(n.$forceTable||!1)!==(t.$forceTable||!1)&&(n.$forceTable=t.$forceTable,n.$type===c.LAYOUT_ROW&&n.$forceTable||delete n.$forceTable,s=!0),(n.$ref||"")!==(t.$ref||"")&&(n.$ref=t.$ref,n.$ref?(delete n.name,delete n.form,delete n.$fieldsOptions,a=!0):(delete n.$refProperty,delete n.$refController,delete n.name,delete n.form),n.$items=[],s=!0),delete t.$ref,delete t.$refProperty,delete t.$refController,delete t.$sticky,delete t.$forceTable,(n.$widget||"")!==(t.$widget||"")&&(n.$widget=t.$widget,s=!0),delete t.$widget,(n.$bindPages||"")!==(t.$bindPages||"")&&(n.$bindPages=t.$bindPages,s=!0),delete t.$bindPages,Object.keys(t).forEach(function(e){t[e]!==n[e]&&(n[e]=t[e],r=!0)}),i._disableRules=!1,s){if(a)return l.emit("LoadNestedLayouts",{data:n,after:function(e){o.merge(e,n);var t=i.map[n.$parentId];i._cleanIds(n),i.check(n,t),i._afterStructureChanged(n)}});i._afterStructureChanged(n)}else r?i._afterPropsChanged(n):i._refreshSelected()}},e}();t.BaseLayout=p;var h=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t.prototype.ds_init=function(e){return!1},t.prototype.ds_storeLastEvent=function(e,t){},t.prototype.ds_LastEvent=function(){return null},t.prototype.ds_destroy=function(){},t.prototype.ds_context=function(){return null},t.prototype.ds_reemit=function(e,t){return null},t.prototype.ds_select=function(e,t){},t.prototype.ds_loaded=function(e,t){},t.prototype.ds_exec=function(e,t,i,n,s,o){},t.prototype.pageLayoutInit=function(){this.loadingHandler=null,this.noDataHandler=null,this.errorHandler=null,this.emitHandler=null,this.getLocalContextHandler=null,this.dataChangedHandler=null,this.updateMenuHandler=this.updateMenu.bind(this),this._removeMenus(),this.ds_init&&this.ds_init(this.data)&&this.registerDataListener(this)},t.prototype._doDatasetEventAfterEnabled=function(e){if(e.ds_LastEvent&&e.dataEvent){var t=e.ds_LastEvent();t&&e.dataEvent(t.event,t.value)}},t.prototype._refreshDataSets=function(e){if(this.page){var t=this._getEventListFor(e);if(t.length){this.page.emittersFor(t).forEach(function(t){t.ds_reemit&&t.ds_reemit(e,function(){})})}}},t.prototype._callInternalRender=function(e,t){var i=this;i.datasets&&i.ds_exec?i.ds_exec("$load",null,i.props.data.ds,function(n,s){if(s)throw s.message;i._internalRender(e,t)},null,!0):i._internalRender(e,t)},t.prototype._destroyDataSets=function(){this.ds_destroy&&this.ds_destroy()},t.prototype._removeMenus=function(){var e=this;["left","right","top","bottom"].forEach(function(t){if(!e.data.$menus||!e.data.$menus[t]){var i=e.page.childByType("menu-"+t);i&&i.setMenu(null)}})},t.prototype.updateMenu=function(e,t){o.log("From Layout Update Menu : "+(t?t.name:"null"),"menu");var i=this.page.childByType("menu-"+e);if(i)i.setMenu(t);else{var s=null;if("right"==e?s=n.Menuright:"left"==e&&(s=n.Menuleft),s){var r={type:e,bodyId:null,parentId:null},a=this.page.childByType("header");a&&(a.options.bodyId&&(r.bodyId=a.options.bodyId),a.options[r.type+"MenuPlace"]&&(r.parentId=a.options[r.type+"MenuPlace"])),i=new s(t,r)}}},t}(p);t.PageLayout=h,o.applyMixins(h,[e.DatasetPlugin.DatasetMethods]);var f=function(e){__extends(t,e);function t(t,i,n,s,o,r){return e.call(this,t,i,n,s,o,r)||this}return t}(h);t.Layout=f,t.LayoutClass=f}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=(t.ulocale,t.utils),n=(t.locale,t.pagecontrol),s=t.dom;t.ui;!function(e){e.SCREEN_CENTER="screencenter",e.SCREEN_TOP_CENTER="screentopcenter",e.BOTTOM_LEFT="bottom-left",e.BOTTOM_RIGHT="bottom-right";var t=function(){function t(e,t){this._align=e,this.id=i.allocID(),t=t||t,this._checkOptions(t),this._width=t.width,this._height=t.height,this._minWidth=t.minWidth,this._minHeight=t.minHeight,this._style=t.style,this._beforeClose=t.beforeClose,this._contentRender=t.contentRender,this._autocloseParents=t.parents||[],this.opener=t.opener,this.stayOnTop=t.stayOnTop,t.alignElement&&(this.$alignElement=$(t.alignElement)),this.$parent=$(t.parent),this._page=n.Page(),this._resize=this.resize.bind(this)}return t.prototype.resize=function(){this._setMinWidthAndMinHeight(),this._alignElement()},t.prototype.destroy=function(){$(window).off("global-phoenix-resize",this._resize),this._autocloseParents=null,this.$element=null,this.$parent=null,this.$alignElement=null,this._beforeClose=null,this._contentRender=null,this._page=null,this.renderControl&&(this.renderControl.destroy&&this.renderControl.destroy(),this.renderControl=null)},t.prototype.inPopup=function(e){for(var t=0,i=this._autocloseParents.length;t<i;t++){var n=this._autocloseParents[t],o=s.find(null,n);if(o&&s.isChildOf(o,e))return!0}return!1},t.prototype._checkOptions=function(t){if(t.parent=t.parent||document.body,t.alignElement||(t.parent=document.body,t.alignElement=null,this._align!==e.SCREEN_TOP_CENTER&&(this._align=e.SCREEN_CENTER)),this._align!==e.SCREEN_TOP_CENTER&&this._align!==e.SCREEN_CENTER&&!t.alignElement)throw"Align element is null";if(!t.contentRender)throw"Invalid content render"},t.prototype._alignXScreenCenter=function(){var e=this.$element.get(0),t=s.offset(e),i=s.offset(e.parentNode);e.style.left=Math.floor(Math.max((i.width-t.width)/2,0))+"px"},t.prototype._alignYScreenCenter=function(){var e=this.$element.get(0),t=s.offset(e),i=s.offset(e.parentNode);e.style.top=Math.floor(Math.max((i.height-t.height)/2,0))+"px"},t.prototype._alignTopScreen=function(){this.$element.get(0).style.top="0px"},t.prototype._alignScreenTopCenter=function(){this._alignXScreenCenter(),this._alignTopScreen()},t.prototype._alignScreenCenter=function(){this._alignXScreenCenter(),this._alignYScreenCenter()},t.prototype._alignBottomLeft=function(){var e=this.$element.get(0),t=this.$alignElement.get(0),i=s.documentClientDim(),n=s.offset(e),o=s.offset(t),r=s.documentScroll(),a=s.documentViewSize(),l=Math.round(o.top+o.height)-1;l+n.height>r.top+a.height&&(l=r.top+a.height-n.height),e.style.top=Math.max(0,Math.round(Math.max(r.top,l)))+"px";var u=o.left;u+n.width>i.width&&(u=Math.max(0,i.width-n.width)),e.style.left=u+"px"},t.prototype._alignBottomRight=function(){var e=this.$element.get(0),t=this.$alignElement.get(0),i=s.documentClientDim(),n=s.offset(e),o=s.offset(t);e.style.top=Math.max(0,Math.round(o.top+o.height)-1)+"px";var r=Math.max(0,Math.round(i.width-o.left-o.width));r+n.width>i.width&&(r=Math.max(0,i.width-n.width)),e.style.right=r+"px"},t.prototype._alignElement=function(){this._align===e.SCREEN_CENTER?this._alignScreenCenter():this._align===e.SCREEN_TOP_CENTER?this._alignScreenTopCenter():this._align===e.BOTTOM_LEFT?this._alignBottomLeft():this._align===e.BOTTOM_RIGHT&&this._alignBottomRight()},t.prototype._setMinWidthAndMinHeight=function(){var e=this.$element.get(0);this._minWidth&&"auto"!==this._minWidth&&(e.style.minWidth=s.checkSize(this._minWidth)),this._minHeight&&"auto"!==this._minHeight&&(e.style.minHeight=s.checkSize(this._minHeight))},t.prototype._setHeightAndWidth=function(){var e=this.$element.get(0);this._setMinWidthAndMinHeight(),this._width&&"auto"!==this._width&&(e.style.width=s.checkSize(this._width)),this._height&&"auto"!==this._height&&(e.style.height=s.checkSize(this._height))},t.prototype.open=function(){var e=this,t=["bs-autoclose","bs-autoclose-hidden"];e._style=e._style||"modal-content",e._style&&s.parseStyle(e._style,t),e.$element=$('<div id="'+e.id+'" class="'+t.join(" ")+'"><div></div></div>'),e._autocloseParents.push(e.id);var i=e.$element.get(0),n=e.$parent.get(0);e._setHeightAndWidth(),s.append(n,i),e._contentRender($(i.firstChild),e,function(t){if(t)return console.log(t),void e.destroy();e._alignElement(),s.removeClass(i,"bs-autoclose-hidden"),e._page.setPopup(e),$(window).on("global-phoenix-resize",e._resize)})},t.prototype.hide=function(e){this._beforeClose&&this._beforeClose();var t=this.$element.get(0);s.remove(t),this.$element=null,this.destroy()},t}();e.open=function(e,i){new t(e,i).open()}}(e.autoclose||(e.autoclose={}))}(Phoenix||(Phoenix={}));!function(e){!function(e){var t=e.SchemaUtils,i=function(){function e(e,t,i){this.isState=!0}return e.prototype.destroy=function(){this._state&&(this._state=null),this.parent=null},e.prototype.state=function(){return this._state},e.prototype._init=function(e,t,i,n){var s=this;n=n||[],s._state=i||{},s.name=t,s.parent=e,n.forEach(function(e){void 0===s._state[e]&&(s._state[e]=!1),Object.defineProperty(s,e,{get:function(){return this._state[e]||!1},set:function(t){if((this._state[e]||!1)!==t){if(this._state[e]=t,"filter"===e&&this.parent){var i=this.parent.getValue(s.name),n=this.parent.getSchema(s.name);if(n&&n.enum&&n.filters){var o=t?n.filters[t]:n.enum;if(o){o.indexOf(i)<0&&this.parent.setValue(s.name,o.length?o[0]:null)}}}this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(s.name+"."+e,{})}},enumerable:!0})})},e}();e.BaseState=i;var n=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s._init(t,i,n,null),s}return t.prototype._init=function(e,t,i,n){this._state=i||{},this.name=t,this.parent=e},Object.defineProperty(t.prototype,"columns",{get:function(){return(this.parent[this.name].columns||[]).join(",")},set:function(e){var t=this.parent[this.name];(t.columns||[]).join(",")!==(e=e||"")&&(t.columns=e?e.split(","):void 0,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".columns",{}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this.parent[this.name].getSelectedItems().join(",")},set:function(e){var t=this.parent[this.name],i=t.getSelectedItems().join(",").split(",").sort(),n=(e||"").split(",").sort().join(",");i.join(",")!==n&&t.setSelectedItems(JSON.parse("["+n+"]"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orderBy",{get:function(){return this._orderBy},set:function(e){this._orderBy!==e&&(this._orderBy=e,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".orderBy",{}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){this._filter!==e&&(this._filter=e,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".filter",{}))},enumerable:!0,configurable:!0}),t}(i);e.ListStates=n;var s=function(e){__extends(i,e);function i(i,n,s){var o=e.call(this,i,n,s)||this,r=i.getSchema("").properties[n],a=t.states;if(r){var l=t.stateProps(r);l&&l.length&&(a=l.concat(a))}return o._init(i,n,s,a),o}return i}(i);e.DataStates=s;var o=function(e){__extends(i,e);function i(i,n,s){var o=e.call(this,i,n,s)||this,r=n;return r.indexOf(".$links")<0&&(r="$links."+n),o._init(i,r,s,t.linksStates),o}return i}(i);e.LinkStates=o}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils;!function(e){var i=function(){function e(e,t,i){this._init(e,t,i),this.isArray=!0}return e.prototype.destroy=function(){this._errors&&(this._errors=null),this.parent=null},e.prototype.errors=function(){return this._errors.slice()},Object.defineProperty(e.prototype,"length",{get:function(){return this._errors?this._errors.length:0},enumerable:!0,configurable:!0}),e.prototype.find=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(!this._errors)return null;for(var n=e.split(","),s=n.length,o=0,r=this._errors.length;o<r;o++){for(var a=!0,l=this._errors[o],u=0;u<s;u++)if(t[u]!==l[n[u]]){a=!1;break}if(a)return l}return null},e.prototype.clear=function(e){return!!this._errors.length&&(this._errors.length=0,e&&this.notify(),!0)},e.prototype.hasErrors=function(){return!(!this._errors||!this._errors.length)},e.prototype.rmvError=function(e){if(this._errors&&this._errors.length){var t=this._errors.findIndex(function(t){return"error"===t.severity&&t.message===e});t>=0&&(this._errors.splice(t,1),this.notify())}},e.prototype.rmvErrorById=function(e){if(this._errors&&this._errors.length){var t=this._errors.findIndex(function(t){return t.id===e});t>=0&&(this._errors.splice(t,1),this.notify())}},e.prototype.addErrors=function(e){this._errors=this._errors||[],e&&e.length&&(e.forEach(function(e){e.id=e.id||t.allocUuid()}),this._errors=this._errors.concat(e),this.notify())},e.prototype.push=function(e){this.addErrors([e])},e.prototype.remove=function(e){if(this._errors){var t=this._errors.indexOf(e);t>=0&&(this._errors.splice(t,1),this.notify())}},e.prototype.addError=function(e,i){this.addErrors([{severity:"error",message:e,id:i||t.allocUuid()}])},e.prototype.addSuccess=function(e,i){this.addErrors([{severity:"success",message:e,timeout:2,id:i||t.allocUuid()}])},e.prototype.addWarning=function(e,i){this.addErrors([{severity:"warning",message:e,timeout:2,id:i||t.allocUuid()}])},e.prototype.notify=function(){this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".errors",{})},e.prototype._init=function(e,t,i){this._errors=i||[],this.name=t,this.parent=e},e}();e.Errors=i,e.errorsUtils={errorChanged:function(e,t){if(e=e||[],t&&t.length){if(e.length!=t.length)return!0;for(var i=!1,n=0,s=e.length;n<s;n++){var o=e[n],r=t[n];if(o.code&&r.code){if(o.code!==r.code){i=!0;break}}else{if(!o.code||!r.code){i=!0;break}if(o.message!==r.message){i=!0;break}}}return i}if(e.length)return!0}}}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.utils,n=e.dom,s=e.application,o=e.data.odata,r=(t.SchemaUtils,t.DataUtils),a=e.DatasetPlugin,l=function(){function t(e,t){if("odata"!==e.$type&&"relation"!==e.$type)throw new Error("Only odata sources are supported.");var i=e.$params&&e.$params.$type?e.$params.$type:"odata";if(((s.config(s.name)||{})[i]||{}).array&&(this._noPageCount=!0),this._config=e,this._origFilter=this._config.$params.$filter,this._config.$params.$searchByFields&&(this._search=this._config.$params.$searchByFields.value,this._searchFields=this._config.$params.$searchByFields.fields),this._pageSize=0,this._model=t,this._currentPage=1,this._hasPrev=!1,this._hasNext=!1,!this.isQuery())throw"Invalid Queryable DataSource";this._pageSize=this._config.$params.$top||0,this._orderby=this._config.$params.$orderby||""}return t.prototype.initPagination=function(e,t,i,n,s,o){this._pageSize=e,this._noPageCount=o,this._noPageCount?(this._hasNext=n,this._hasPrev=s):this._totalCount=i,this._currentPage=t},t.prototype.initFromData=function(e){if(this.isQuery()&&(this._pageSize=e.pageSize,this._noPageCount=e._noPagesCount,this._currentPage=this._pageSize?Math.ceil(e.skip/this._pageSize)+1:0,this._noPageCount?(this._hasPrev=e._hasPrev,this._hasNext=e._hasNext):this._totalCount=e.count,this._skip=e.skip,e.uri)){var t=this._model.parent;t.hasOwnProperty("uri")&&(t.uri=e.uri),t.hasOwnProperty("search")&&(t.search=e.search)}},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){this._filter=e,this._filter&&this._filter.value?this._origFilter?this._config.$params.$filter={$left:this._origFilter,$op:"AND",$right:this._filter.value}:this._config.$params.$filter=this._filter.value:this._origFilter?this._config.$params.$filter=this._origFilter:this._config.$params.$filter=null,this.refresh(!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"search",{get:function(){return this._search},set:function(e){e!==this._search&&(this._search=e,this._config.$params.$searchByFields={fields:this._searchFields,value:e},this._searchFields&&this.refresh(!0,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchFields",{get:function(){return this._searchFields},set:function(e){if(e.join("$$$")!==this._searchFields.join("$$$")){var t=!!this._search;this._search="",this._searchFields=e,this._config.$params.$searchByFields={fields:this._searchFields,value:e},t&&this.refresh(!0,!1)}},enumerable:!0,configurable:!0}),t.prototype.pageSize=function(){return this.isQuery()?this._pageSize:0},t.prototype.orderBy=function(e){return void 0===e?this._orderby:(e!==this._orderby&&(this._orderby=e,this.refresh(!0,!1)),this._orderby)},t.prototype.refresh=function(e,t){var n=this;return new i.Promise(function(i,s){n.isQuery()?(e&&(n._currentPage=0),n._open(t).then(function(){n._model.notifyPaginationChanged(),n._model.notifySortingChanged(),i()})):i()})},t.prototype.currentPage=function(e){var t=this;if(void 0!==e){if(t.isQuery()){var i=t.noPagesCount()?e:Math.min(e,t.totalPages());t._currentPage!==i&&(t._currentPage=i,t._open(!1).then(function(){t._model.notifyPaginationChanged()}))}return e}return t.isQuery()?t._currentPage:0},t.prototype.totalPages=function(){return this.isQuery()&&!this._noPageCount?this._pageSize?Math.ceil(this._totalCount/this._pageSize):1:0},t.prototype.totalCount=function(){return this.isQuery()&&!this._noPageCount?this._totalCount:0},t.prototype.noPagesCount=function(){return this._noPageCount},t.prototype.hasNext=function(){return this._hasNext},t.prototype.hasPrev=function(){return this._hasPrev},t.prototype.destroy=function(){this._config=null,this._model=null},t.prototype.isQuery=function(){return r.isQuery(this._config)},t.prototype.open=function(){return this._open(!0)},t.prototype.remove=function(e,t){var s=this;return s.isQuery()?new i.Promise(function(i,o){var r={name:"data",$type:s._config.$type,$method:"DELETE",$params:{$module:s._config.$params.$module,$entity:s._config.$params.$entity,$entityId:e}};n.processing(!0),a.executeDatasets([r],{etag:t},{},{},function(e,t){n.processing(!1),t?s._model?(s._model.addAjaxException(t),o(null)):o(t):i(null)})}):null},t.prototype._applyFilters=function(){var e=this._model.allData;return o.applyFilters(e,this._search,this._searchFields,this._skip,this._pageSize,this._orderby)},t.prototype._open=function(t){var s=this;return s._config.name="data",new i.Promise(function(i,o){n.processing(!0);var r=s.isQuery(),l={};r&&(s._orderby&&s._config.$params.$orderby!==s._orderby&&(s._config.$params.$orderby=s._orderby),s._pageSize>0?(s._config.$params.$top=s._pageSize,s._config.$params.$skip=Math.max(0,s._currentPage-1)*s._pageSize,0==s._config.$params.$skip&&delete s._config.$params.$skip,s._skip=s._config.$params.$skip):(delete s._config.$params.$top,delete s._config.$params.$skip));var u=s._config;if(!t&&r&&s._config.$params.$allData&&s._model.allData){var c=s._applyFilters();return e.dom.processing(!1),s.initFromData(c),s._model.setModel(c.documents),void i(c)}a.executeDatasets([u],s._model.parent.model(!0)||{},l,{},function(e,a){if(n.processing(!1),a)s._model?(s._model.addAjaxException(a),o(null)):o(a);else{var u=l.data;if(s.initFromData(u),r&&s._skip&&!s._noPageCount&&s._skip>=s._totalCount)return s._currentPage=0,s._open(t).then(function(e){i(e)});r&&s._config.$params.$allData&&(s._model.allData=u._allData),s._model&&(r?s._model.setModel(u.documents):s._model.setModel(u)),i(u)}})})},t.prototype.save=function(){this.isQuery()||this._model.validate()},t}();t.QueryableDataSource=l}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.Observable,n=i.SchemaUtils,s=(i.DataUtils,e.locale,e.ulocale),o=e.utils,r={},a=function(e,t){return(t=t||{}).isPropagation&&(e=e.replace(/sum\(\s*([^)]+?)\s*\)/g,function(e,t){var i=t.split(/\s*,\s*/);if(i&&1===i.length){var n=i[0].split("."),s=n.pop();return"sum("+n.join(".")+", '"+s+"')"}return e})),e},l=function(e,t,i,n){try{e.code||(e.code=new Function("o","ctx","window",a(e.expression,{isPropagation:!0})),e.conditionCode=e.condition?new Function("o","ctx","window","return "+a(e.condition,{isPropagation:!1})):null);var s=!0;if(e.conditionCode&&(s=e.conditionCode(t,i,null)),s){var r=t.getRootModel();o.logRule(r._callStack?r._callStack.length:0,e,n,t.className||""),e.code(t,i,null)}}catch(i){u(i,e,t.getRootModel())}},u=function(e,t,i){"string"==typeof e&&(e={message:e});var n=o.format("Rule '{0}'  {1}:",t.name,t.description||"");i.addError([n,e.message||""].join("\n"))},c=function(e){var t={today:s.date2ISO(new Date),now:function(){return(new Date).toISOString()},addHours:function(e,t){var i=s.parseISODateTime(e);if(null!==i)return i.setTime(i.getTime()+60*t*60*1e3),i.toISOString()},isTriggeredBy:function(e){return!1},sum:function(e,t){var i=0;return e&&e.forEach(function(e,n,s){i+=e[t]||0},""),i},safeDivide:function(e,t,i){t=t||0,e=e||0;return 0===parseFloat(t.toFixed(8))?i||0:e/t},partition:function(e,t,i,n){var s=-1,o=-1,r=e=e||0,a=0;if(t.forEach(function(e,t,i){var r=e[n]||0;Math.abs(r)>s&&(s=Math.abs(r),o=t),a+=r}),0!==(a=parseFloat(a.toFixed(8)))&&o>=0&&(t.forEach(function(t,s,o){var l=t[n]||0;t[i]=e*l/a,r-=t[i]}),0!==(r=parseFloat(r.toFixed(8))))){var l=t.get(o);l[i]=(l[i]||0)+r}},utc:function(e){if(!e)return 0;var t=s.parseISODateTime(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},milliseconds2Hours:function(e){return e/36e5},date:function(e){return s.parseISODateTime(e)}};return Object.keys(r).forEach(function(e){t[e]||(t[e]=r[e])}),t},d=function(e,t,i){return o.execAngularExpression(e,{o:i||{},ctx:t})};t.execInitRules=function(e){var t,i,n=e.getRootModel().getSchema("");if(e.$create?(t=n.rules&&n.rules.created?n.rules.created[e.className]:null,i="$events.created"):(t=n.rules&&n.rules.loaded?n.rules.loaded[e.className]:null,i="$events.loaded"),t){var s=c(e.getRootModel());t.forEach(function(t){return l(n.rulesMap[t],e,s,i)})}},t.execBeforeSaveRules=function(e){var t=e.getRootModel().getSchema(""),i=t.rules&&t.rules.saving?t.rules.saving[e.className]:null;if(i){var n=c(e.getRootModel());i.forEach(function(i){return l(t.rulesMap[i],e,n,"$events.saving")})}},t.execPropChangeRules=function(e,t,i,n){e.callStack=e.callStack||[];var s,r=(s=t,s);e.callStack.push(r);try{if(e.$schema.rules&&(e.$schema.rules.validation&&n.validations||e.$schema.rules.propagation&&n.propagations)){var p=t.split("."),h=p.pop();if("$"===h.charAt(0))return;for(var f=[h],m=i.instance,v=m,g=c(),y=function(){var t=n.propagations&&e.$schema.rules.propagation?e.$schema.rules.propagation[m.className]:null,i=f.join("."),s=t?t[i]:null;s&&s.forEach(function(t){return l(e.$schema.rulesMap[t],m,g,i)}),(s=(t=n.validations&&e.$schema.rules.validation?e.$schema.rules.validation[m.className]:null)?t[i]:null)&&s.forEach(function(t){var n=e.$schema.rulesMap[t];try{if(!n.code){var s="return ";n.expression.indexOf(s)>=0&&(s=""),n.code=new Function("o","ctx","window",s+a(n.expression,{isPropagation:!1})),n.conditionCode=n.condition?new Function("o","ctx","window","return "+a(n.condition,{isPropagation:!1})):null}var r=n.triggers.length>1,l=!0;n.conditionCode&&(l=n.conditionCode(m,g,null)),l&&o.logRule(e.callStack?e.callStack.length:0,n,i,m.className||""),!l||n.code(m,g,null)?r?e.rmvError(d(n.errorMsg,g,m)):v.$errors[h].rmvError(d(n.errorMsg,g,m)):r?e.addError(d(n.errorMsg,g,m)):v.$errors[h].addError(d(n.errorMsg,g,m))}catch(t){u(t,n,e)}});var r=p.pop();r&&"$"===r.charAt(0)&&(r=p.pop()),r&&f.unshift(r),m=m.parent};m;)y()}}finally{e.callStack.pop(),e.callStack.length||(e.callStack=null)}},t.execValidationRules=function(e,t){if(!e.className)return!1;var i=e.getRootModel();if(!i.$schema.rules||!i.$schema.rules.validation||!i.$schema.rules.validation[e.className])return!1;var s=Object.keys(i.$schema.rules.validation[e.className]),r=c(),l=!1;return s.forEach(function(s){if(t&&t.indexOf(s)<0)return!1;var c=i.$schema.rules.validation[e.className][s];c&&c.forEach(function(t){var c=i.$schema.rulesMap[t];try{if(!c.code){var p="return ";c.expression.indexOf(p)>=0&&(p=""),c.code=new Function("o","ctx","window",p+a(c.expression,{isPropagation:!1})),c.conditionCode=c.condition?new Function("o","ctx","window","return "+a(c.condition,{isPropagation:!1})):null}var h=!0;if(c.triggers.length&&c.triggers.forEach(function(t){0!==t.indexOf("$events.")&&h&&(h=n.hasProperty(t,e.$schema,i.$schema))}),!h)return;var f=c.triggers.length>1,m=!0;c.conditionCode&&(m=c.conditionCode(e,r,null)),m&&o.logRule(i.callStack?i.callStack.length:0,c,s,e.className||""),!m||c.code(e,r,null)?f?i.rmvError(d(c.errorMsg,r,e)):e.$errors[s].rmvError(d(c.errorMsg,r,e)):(l=!0,f?i.addError(d(c.errorMsg,r,e)):e.$errors[s].addError(d(c.errorMsg,r,e)))}catch(e){u(e,c,i)}})}),l},t.injectInContext=function(e,t){r[e]=t}}(e.rules||(e.rules={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.application,s=t,o=i.rules,r=s.SchemaUtils,a=s.DataUtils,l=e.utils,u=i.jsonpatch,c=(o=i.rules,e.ajax),d=e.locale,p=e.ulocale,h=e.locale.schema,f={setValue:function(e,t,i,n){i.setValue(e,t,n)},getValue:function(e,t,i){return t.getValue(e,i)},getState:function(e,t,i){return t.getState(e,i)},_segment2Id:function(e){var t=parseInt(e,10);return t+""!==e&&(t=e),t},_resolveJSONPatchSegment:function(e,t,i){if(t.isArray){if("$links"===e)return{value:t.$links,useId:i};var n=f._segment2Id(e);return{value:t.find("id",n),useId:i}}return{value:t[e],useId:i}},getJSONPatchParent:function(e,t){var i=e.split("/");i.shift();var n={lastSegment:i.pop(),value:null,type:0};if(e.indexOf("$states")>=0)n.type=2;else if(e.indexOf("$errors")>=0)n.type=3;else if(e.indexOf("$links")>=0){n.type=1;var s=i.pop(),o=s.split(".");if(o.length>1){var r=o.shift();s=o.join(".");var a=i.pop();i.push(r),i.push(a)}i.push(s)}for(var l=t,u=!0;i.length;){var c=f._resolveJSONPatchSegment(i.shift(),l,u);if(u=c.useId,!(l=c.value))break}if(l){var d=l[n.lastSegment];d&&d.isArray&&(n.lastSegment="",l=d)}return n.value=l,n},_resolveSegment:function(e,t,i,n,s,o){if("$item"!==e)return"$selected"===e?(o&&(i[e]=s),i[e]):"$new"===e?(o&&(i[e]=s),i[e]):i&&i[e]&&"function"==typeof i[e]?o?i[e](s):i[e]():(o&&(i[e]=s),i[e]);if(n){return n[t]}}},m=function(){function e(e,t,i,n,o,a,l,u){var c=this;if(c.isArray=!0,c._map={},c._expanded=!1,c.isQuery=l,c._selectedUids=[],c._selectedPks=[],c.isNull=!1,c.isUndefined=!0,c._model=void 0,c._items=[],c._path=i,c._parent=t,c._parentSelected=u,c._locale=a,c._arrayParent=o,c._rootSchema=c._parent.getRootModel().getSchema(""),c._schema=r.expand$Ref(e,c._rootSchema),c._schemaItems=r.expand$Ref(c._schema.items,c._rootSchema),c.frozen=!1,c.$links={},c._schema.links){var d=c._parent.model(!0);Object.keys(c._schema.links).forEach(function(e){var t=$.extend({},c._schema.links[e]),n=i+"."+e;d.$links=d.$links||{},d.$links[n]=$.extend(t,d.$links[n]||{}),c.$links[e]=new s.LinkStates(c.parent,i+".$links."+e,d.$links[n])})}c._setModel(n,!0)}return e.prototype.selecting=function(e,t){var i=this;if(i._schema.syncSelected)if(e)i._simulateSelecting=!0,i._savedSelectedUids=i._selectedUids.slice();else{var n=i._selectedPks.slice();i._selectedUids=[],i._selectedPks=[];var s={};i._savedSelectedUids.forEach(function(e){s[e]=!0});var o=null;if(i._schemaItems.primaryKey){var a=!1;o=r.pkFields(i._schemaItems.primaryKey),i.forEach(function(e){s[e.$id]?(e.internalSetSelected(!0)&&(a=!0),i._selectedUids.push(e.$id),o&&i._selectedPks.push(r.pk2Id(r.extractPkValue(e,o),o))):e.internalSetSelected(!1)&&(a=!0)},t),i._savedSelectedUids=null,i._simulateSelecting=!1,a&&i._parent.execSyncAction(i.getJSONPatchPath()+".$selected",n.join(","))}}},Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},set:function(e){this._columns=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manageSelecting",{get:function(){return this._selecting&&!this._multiselect&&!1!==this.schema.autoSelect&&!this.schema.syncSelected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowSelecting",{get:function(){return this._selecting},set:function(e){this._selecting=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiselect",{get:function(){return this._multiselect},set:function(e){this._multiselect=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expandingProperty",{get:function(){return this._expandingProperty},set:function(e){this._expandingProperty=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simulateSelecting",{get:function(){return this._simulateSelecting},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$selected",{get:function(){return this._parentSelected?this._parentSelected.$selected:this._selected},set:function(e){this._setSelected(e,!0)},enumerable:!0,configurable:!0}),e.prototype._setSelected=function(e,t){if(this._parentSelected)this._parentSelected._setSelected(e,t);else if(this._selected!==e){var i=this._selected;this._selected=e,t&&this._parent&&!this.simulateSelecting&&this._parent.notifyChanged(this._path+".$selected",i,this._selected,"propchange",{checkChildren:!0,instance:this._parent},!1)}},e.prototype.enumSelectedItems=function(e,t){},e.prototype.getJSONPatchPath=function(e){return e=e?this.path+"."+e:this.path,this.parent.getJSONPatchPath(e)},e.prototype.getFullPath=function(){return this.parent.getPropertyPath(this.path)},e.prototype._rmvSelected=function(e,t){if(this._parentSelected)this._parentSelected._rmvSelected(e,t);else if(this._selected===e){var i=null,n=this._selected;this._schema&&this._schema.children&&this.enumSelectedItems(this._schema.children,function(e){i||(i=e)}),this._selected=i,t&&this._parent&&!this.simulateSelecting&&this._parent.notifyChanged(this._path+".$selected",n,this._selected,"propchange",{checkChildren:!0,instance:this._parent},!1)}},e.prototype.pushSelected=function(e,t){var i=e.$id,n=this._selectedUids.indexOf(i);if(n<0&&this._selectedUids.push(i),this._schemaItems.primaryKey){var s=r.pkFields(this._schemaItems.primaryKey);i=r.pk2Id(r.extractPkValue(e,s),s),(n=this._selectedPks.indexOf(i))<0&&this._selectedPks.push(i)}this._setSelected(e,t)},e.prototype.model=function(e){return this._getModel(e)},e.prototype.schemaModel=function(){return this._model},e.prototype._getModel=function(e){return this._model},e.prototype._initModelInParent=function(){if(!this._model&&(this._model=[],this.isNull=!1,this.isUndefined=!1,this._parent)){this._parent.model(!0)[this._path]=this._model}},e.prototype.removeSelected=function(e,t){var i=this._selectedUids.indexOf(e.$id);if(i>=0&&this._selectedUids.splice(i,1),this._schemaItems.primaryKey){var n=r.pkFields(this._schemaItems.primaryKey),s=r.pk2Id(r.extractPkValue(e,n),n);(i=this._selectedPks.indexOf(s))>=0&&this._selectedPks.splice(i,1)}this._rmvSelected(e,t)},e.prototype.notifyChangedProperty=function(e){this._parent.notifyChanged(this._path,void 0,void 0,e,{instance:this._parent},!1)},e.prototype.addAjaxException=function(e){return this._parent.addAjaxException(e)},e.prototype.notifyPaginationChanged=function(){},e.prototype.notifyCountChanged=function(){this.notifyChangedProperty("count")},e.prototype.notifySortingChanged=function(){},e.prototype.isQueryable=function(){return this._queryable||!1},e.prototype.addErrors=function(e){var t=this._parent.$errors[this._path];t?t.addErrors(e):this._parent.addErrors(e)},e.prototype.addError=function(e){var t=[{severity:"error",message:e,id:l.allocUuid()}];this.addErrors(t)},e.prototype.rmvError=function(e){var t=this._parent.$errors[this._path];t?t.rmvError(e):this._parent.rmvError(e)},Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),e.prototype._destroyItems=function(){this._selectedUids=[],this._items&&(this._model=void 0,this._items=[])},e.prototype.$orderby=function(e){return""},e.prototype.hasNext=function(){return!1},e.prototype.hasPrev=function(){return!1},e.prototype.noPagesCount=function(){return!1},e.prototype.totalPages=function(){return 1},e.prototype.currentPage=function(e){return 0},e.prototype.totalCount=function(){return this._items.length},e.prototype.destroy=function(){this._parent=null,this._arrayParent=null,this._parentSelected=null,this._destroyItems(),this.$links=null,this._selectedPks=null,this._model=null,this._schema=null,this._schemaItems=null,this._rootSchema=null},e.prototype._fillItems=function(){var e=this;e._model&&e._model.forEach(function(t,i){e._items.push(t)})},e.prototype._setModel=function(e,t){this.isNull=null===e,this.isUndefined=void 0===e;var i=this.frozen;t&&(this.frozen=!0),this._destroyItems(),this._model=e,this._fillItems(),this.frozen=i},e.prototype.setModel=function(e){this._setModel(e,!0),this._parent.notifyChanged(this._path,void 0,void 0,"propchange",{instance:this._parent,checkChildren:!0},!1),this.notifyCountChanged(),this._parent.notifyStateChanged(this._path,{instance:this._parent,checkChildren:!0}),this.afterSetModel()},e.prototype.afterSetModel=function(){this.$selected=null},e.prototype.indexOf=function(e){return this._items.indexOf(e)},e.prototype.find=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=e.split(","),s=n.length,o=0,r=this._items.length;o<r;o++){for(var a=!0,l=this._items[o],u=0;u<s;u++)if(t[u]!==l[n[u]]){a=!1;break}if(a)return l}return null},e.prototype._expandForEach=function(e,t,i,n,s){return this._items.forEach(function(o){e(o,n,i),n++;var r=l.getValue(o,t);r&&(r.$expand||s)&&(n=r._expandForEach(e,t,i+1,n,s))}),n},e.prototype.forEach=function(e,t,i){if(!t)return this._items.forEach(function(t,i){return e(t,i,0)});this._expandForEach(e,t,0,0,i)},e.prototype.get=function(e){return this._items[e]},Object.defineProperty(e.prototype,"$expand",{get:function(){return this._expanded},set:function(e){if(this._expanded!==e){var i=this._parent[this._path+t.EXPANDED_FIELD_NAME];this._expanded=e;var n=this._parent[this._path+t.EXPANDED_FIELD_NAME];n!==i&&this._parent.notifyChanged(this._path+t.EXPANDED_FIELD_NAME,i,n,"propchange",{instance:this._parent},!0)}},enumerable:!0,configurable:!0}),e}();t.DataListCore=m;var v=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t.prototype._fillItems=function(){var e=this,t=null;e._map={},e._selectedUids=[],e._selected&&(e.$selected=null),e._selectedPks.length&&(t=r.pkFields(e._schemaItems.primaryKey)),e._model&&e._model.forEach(function(i,n){e.isQuery&&i&&(i.$create=!1);var s=new C(e._schemaItems,e._parent,e._path,i,e,!1,e._locale,null),o=!1;if(e._items.push(s),e._map[s.$id]=s,t){var a=r.pk2Id(r.extractPkValue(i,t),t);e._selectedPks.lastIndexOf(a)>=0?(s.internalSetSelected(!0)&&(e.simulateSelecting||s.notifyChanged("$select",!1,!0,"propchange",{instance:s},!0)),o=!0):s.$select&&(o=!0)}else s.$select&&(o=!0);o&&e.pushSelected(s,!1)})},t.prototype._updateSelecting=function(e,t,i,n){var s=this;if(e)s._selectedUids.forEach(function(e){var t=s._map[e];t&&s.pushSelected(t,!0)});else if(s._selectedPks=[],s._selected=null,s._selectedUids.length){var o=s._selectedUids.slice(0);if(i.length||i.push(o.pop()),o.forEach(function(e){var t=s._map[e];t&&(t.$select=!1)}),i.length&&i[0]){var r=s._map[i[0]];i[0]=null,r&&s.pushSelected(r,!0)}}t&&s._items.forEach(function(n){var s=l.getValue(n,t);s&&s._updateSelecting(e,t,i,!1)},null)},t.prototype.clearSelection=function(e,t){var i=this;i.enumSelectedItems(e,function(t){i.selectItem(!1,t,!1,e,!1)}),t&&(i._selectedPks=[])},t.prototype.getSelectedItems=function(e){var t=[];if(this._schemaItems.primaryKey){var i=r.pkFields(this._schemaItems.primaryKey);this.enumSelectedItems(e,function(e){var n=r.pk2Id(r.extractPkValue(e,i),i);t.push(n)})}return t},t.prototype.setSelectedItems=function(e){var t=this;if(t._schemaItems.primaryKey){var i=r.pkFields(t._schemaItems.primaryKey);t.enumSelectedItems("",function(n){var s=r.pk2Id(r.extractPkValue(n,i),i),o=e.indexOf(s);o<0?t.selectItem(!1,n,!1,"",!1):e.splice(o,1)}),e.forEach(function(e){var n=r.findByPk(e,i,t._items);n&&t.selectItem(!0,n,!0,"",!1)})}},t.prototype.updateSelecting=function(e,t){this._updateSelecting(e,t,[],!0)},t.prototype.enumSelectedItems=function(e,t){this._enumSelected(e,function(e,i){i&&t(i)})},t.prototype._enumChildren=function(e,t){e&&this._items.forEach(function(i){t(i);var n=i[e];n&&n._enumChildren(e,t)})},t.prototype._enumSelected=function(e,t){var i=this;if(e)i._enumSelected(null,t),i._items.forEach(function(i){var n=l.getValue(i,e);n&&n.length&&n._enumSelected(e,t)});else{var n=i._selectedUids.slice(0);if(t(i,null),!n.length)return;n.forEach(function(e){var n=i._map[e];n&&t(i,n)})}},t.prototype.selectItem=function(e,t,i,n,s){var o=this;if(t)if(e){if(!t.$select)if(i){if(t.$select=!0,n&&s){(a=l.getValue(t,n))&&a._enumChildren(n,function(e){e.$select=!0})}}else{var r=[];o._enumSelected(n,function(e,t){e&&!t?(e._selectedUids=[],e._selectedPks=[]):t.internalSetSelected(!1)&&r.push({item:t,value:!1})}),t.internalSetSelected(!0)&&r.push({item:t,value:!0});(u=t._arrayParent)&&u.pushSelected(t,!0),r.forEach(function(e){o.simulateSelecting||e.item.notifyChanged("$select",!e.value,e.value,"propchange",{instance:e.item},!0)})}}else if(t.$select)if(i){if(t.$select=!1,n&&s){var a;(a=l.getValue(t,n))&&a._enumChildren(n,function(e){e.$select=!1})}}else{var u,c=t.internalSetSelected(!1,!0);(u=t._arrayParent)&&o.removeSelected(t,!0),c&&(o.simulateSelecting||t.notifyChanged("$select",!0,!1,"propchange",{instance:t},!0))}},t.prototype.canDoNext=function(){if(this.noPagesCount())return this.hasNext();var e=this.totalPages();return this.currentPage()<e},t.prototype.canDoPrev=function(){return this.noPagesCount()?this.hasPrev():this.currentPage()>1},t.prototype.moveSelected=function(e,t){var i=null;if(this.enumSelectedItems("",function(e){i||(i=e)}),i){var n=this._items.indexOf(i),s=Math.max(0,Math.min(n+e,this._items.length-1));if(t&&s!==n+e){if(e>0&&this.canDoNext())return void this.currentPage(this.currentPage()+1);if(e<0&&this.canDoPrev())return void this.currentPage(this.currentPage()-1)}var o=this._items[s];o!==i&&this.selectItem(!0,o,!1,"",!1)}},t.prototype.sortByKey=function(e,t){var i=this;if(e&&e.length&&i._model&&i._model.length){var n={},s={},o=[];i._model.forEach(function(e,r){n[e[t]]=e,s[e[t]]=i._items[r],o.push(e[t])}),i._model.splice(0,i._model.length),i._items.splice(0,i._items.length),e.forEach(function(e,t){i._model.push(n[e]),i._items.push(s[e])}),o.join("$$")!==e.join("$$")&&i._parent.notifyChanged(i._path,void 0,void 0,"propchange",{instance:i._parent,checkChildren:!0,sorting:!0},!1)}},t.prototype.findById=function(e){return this._map[e]},t.prototype.findByPk=function(e){if(this._schemaItems.primaryKey){var t=r.pkFields(this._schemaItems.primaryKey);return r.findByPk(e,t,this._items)}return null},t.prototype.indexOf=function(e){return"object"!=typeof e&&(e=this.findById(e)),e?this._items.indexOf(e):null},t.prototype.$orderby=function(e){var t=this.parent.$states[this.path];return void 0===e?t.orderBy:(t.orderBy=e,t.orderBy)},t.prototype.$filter=function(e){var t=this.parent.$states[this.path];return void 0===e?t.filter:(t.filter=e,t.filter)},t}(m);t.DataListBase=v;var g=function(e){__extends(i,e);function i(i,n,s,o,r,l,u,c,d,p,h,f,m,v){var g=e.call(this,n,s,o,r,m,v,!0,null)||this,y=g,_=y._parent.getRootModel(),$=a.dsConfig(_.datasets,n,!0);if(_.design&&($={$type:"odata",$params:{$entity:"EntityIsMissing"},$autoOpen:!1}),!$)throw'Invalid config! You must define a dataset in form for the property: "'+o+'".';return y.allData=f,y._main=$.$main,y._queryable=!0,void 0===l&&(l=$.$params.$top||20),y._query=new t.QueryableDataSource($,y),y._query.initPagination(l,u,c,d,p,h),y._main&&_&&(_.onRefresh=function(e){var t=e&&e.resetPagination;return y.$refresh(t)}),g}return Object.defineProperty(i.prototype,"filter",{get:function(){return this._query.filter},set:function(e){this._query.filter=e,this.notifyChangedProperty("filter")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"searchFields",{get:function(){return this._query.searchFields},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"searchField",{set:function(e){this._query.searchFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"search",{get:function(){return this._query.search},set:function(e){this._query.search=e},enumerable:!0,configurable:!0}),i.prototype.totalPages=function(){return this._query.totalPages()},i.prototype.totalCount=function(){return this._query.totalCount()},i.prototype.hasNext=function(){return this._query.hasNext()},i.prototype.hasPrev=function(){return this._query.hasPrev()},i.prototype.noPagesCount=function(){return this._query.noPagesCount()},i.prototype.$refresh=function(e){return this._query.refresh(e,!0)},i.prototype.$orderby=function(e){return this._query.orderBy(e)},i.prototype.notifyPaginationChanged=function(){this.notifyChangedProperty("pagination")},i.prototype.notifyFilterChanged=function(){this.notifyChangedProperty("filter")},i.prototype.notifySortingChanged=function(){this.notifyChangedProperty("sorting")},i.prototype.currentPage=function(e){return void 0!=e?this._query.currentPage(e):this._query.currentPage()},i.prototype._removeItem=function(e,t){var i=this;if(i._query){var n=i._query.remove(e,t);n.then&&n.then(function(){i.$refresh(!(i._items.length>1)).then(function(){})})}},i.prototype.remove=function(e){var t=this,i=e.model(!0),n=(e.$select,i?i["@odata.etag"]:null);if(t._schemaItems&&t._schemaItems.primaryKey){var s=r.odataId(r.pkFields(t._schemaItems.primaryKey),e);if(t._schemaItems.links&&t._schemaItems.links.$remove&&t._schemaItems.links.$remove.confirm){var o=t._schemaItems.links.$remove.confirm;t._locale&&(o=p.tt(o||"",t._locale)),l.confirm(null,o,function(){t._removeItem(s,n)})}else t._removeItem(s,n)}},i.prototype.destroy=function(){if(this.allData=null,this._query&&(this._query.destroy(),this._query=null),this._main){var t=this._parent.getRootModel();t&&(t.onRefresh=null)}e.prototype.destroy.call(this)},i}(v);t.QueryList=g;var y=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this);this._selectedPks=[]},t.prototype.find=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=e.split(","),s=n.length,o=0,r=this._items.length;o<r;o++){for(var a=!0,l=this._items[o],u=0;u<s;u++)if(t[u]!==l[n[u]]){a=!1;break}if(a)return l}return null},t}(v);t.CompositionList=y;var _=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this);this._selectedPks=[]},t}(m);t.SimpleCompositionList=_;var b=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t.prototype.push=function(e){this._initModelInParent(),this._model.push(e),this._items.push(e),this._parent.notifyChanged(this._path,void 0,e,"add",{$index:this._items.length-1,$value:e,$id:e,instance:this._parent},!1),this.notifyCountChanged()},t.prototype.splice=function(e,t,i){if(t>0)throw"Delete count is not supported.";this._model&&(i.$create=!0,this._model.splice(e,t,i),this._items.splice(e,t,i),this._parent.notifyChanged(this._path,void 0,i,"add",{method:!0,change:!0,$index:e,$value:i,$id:i,instance:this._parent},!1),this.notifyCountChanged())},t.prototype.remove=function(e){var t=this._items.indexOf(e);t>=0&&(this._items.splice(t,1),this._model.splice(t,1),this._parent.notifyChanged(this._path,void 0,e,"remove",{method:!0,change:!0,$index:t,$value:e,$id:e,instance:this._parent},!1),this.notifyCountChanged())},t}(_);t.SimpleTypeList=b;var x=function(e){__extends(t,e);function t(t,i,n,s,o,r,a){var l=e.call(this,t,i,n,s,o,r,!1,a)||this;return l._createNewItem(!1,!0),l}return t.prototype._initNew=function(){var e={$create:!0};this._new=new C(this._schemaItems,this._parent,this._path+".$new",e,null,!0,this._locale,null),this._new.notifyChanged("",void 0,e,"propchange",{instance:this._new,checkChildren:!0},!1),this._new.notifyStateChanged("",{instance:this._new,checkChildren:!0})},Object.defineProperty(t.prototype,"filter",{get:function(){var e=this.$filter();return e?JSON.parse(e):null},set:function(e){var t=e?JSON.stringify(e):"";t!==(this.$filter()||"")&&(this.parent.execSyncAction(this.getJSONPatchPath()+".$filter",t,t)||this.$filter(t))},enumerable:!0,configurable:!0}),t.prototype._createNewItem=function(e,t){t&&Object.defineProperty(this,"$new",{get:function(){return this._new||this._initNew(),this._new},set:function(e){this._new||this._initNew(),this._new._setModel(e,!0),this._new.notifyChanged("",void 0,e,"propchange",{instance:this._new}),this._new.notifyStateChanged("",{instance:this._new,checkChildren:!0})},enumerable:!0}),e&&!this._new&&this._initNew()},t.prototype.updateItem=function(e,t){if(!t.validate())return!1;t.$errors.$.addErrors([],!1);var i=t._getModel(!0);if(this._schemaItems.primaryKey){var n=r.pkFields(this._schemaItems.primaryKey),s=r.extractPkValue(i,n),o=(r.extractPkValue(e._getModel(!0),n),r.findByPk(s,n,this._items));if(o&&o!==e){var a=n.length>1?h.uniqueColumns:h.uniqueColumn;return t.$errors.$.addErrors([{code:"duplicate_value",message:l.format(a,n.join(", "))}],!1),!1}}return!0},t.prototype.addNew=function(){if(this._new&&this._new.validate()){var e=this._new._getModel(!1,!0);if(this._schemaItems.primaryKey){var t=r.pkFields(this._schemaItems.primaryKey),i=r.extractPkValue(e,t),n=r.findByPk(i,t,this._items);if(this._parent.$errors[this._path].addErrors([],!1),n){var s=t.length>1?h.uniqueColumns:h.uniqueColumn;return void this._parent.$errors[this._path].addErrors([{code:"duplicate_value",message:l.format(s,t.join(", "))}],!1)}}else this._parent.$errors[this._path].addErrors([],!1);this._destroyNew(),this.push(e),this._createNewItem(!0,!1)}},t.prototype._destroyNew=function(){this._new&&(this._new.destroy(),this._new=null)},t.prototype.destroy=function(){this._destroyNew(),e.prototype.destroy.call(this)},t.prototype.push=function(e){e.$create=!0,e.$select&&e.$create&&this.clearSelection(),this._initModelInParent(),this.splice(-1,0,e)},t.prototype.splice=function(e,t,i){if(t>0)throw"Delete count is not supported.";this._initModelInParent(),this.manageSelecting&&(this.clearSelection(this.expandingProperty),i.$select=!0);var n=this.frozen;this.frozen=!0;var s=e<0;s?this._model.push(i):this._model.splice(e,t,i);var o=new C(this._schemaItems,this._parent,this._path,i,this,!1,this._locale,null);s?this._items.push(o):this._items.splice(e,t,o),this.frozen=n,this._map[o.$id]=o,o.$select&&this.pushSelected(o,!0),this._parent.notifyChanged(this._path,void 0,i,"add",{method:!0,change:!0,$index:s?this._items.length-1:e,$id:o.$id,$value:o,source:this._parent.getPropertyPath(this._path),instance:this._parent},!1),o.notifyStateChanged("",{checkChildren:!0})},t.prototype.remove=function(e){var t,i=null,n=this.frozen;if(this._model){this.frozen=!0;var s=this._items.indexOf(e),o=e.$id,r=null;if(s>=0&&(i=e.model(),t=!0,e.$select&&this.manageSelecting&&(s+1<this._items.length?r=this._items[s+1]:s>0&&(r=this._items[s-1])),this._items.splice(s,1),this._model.splice(s,1),n||(this.frozen=n),this.removeSelected(e,!1),this.frozen=!0,e.destroy()),this.frozen=n,delete this._map[o],t){this._parent.notifyChanged(this._path,void 0,e,"remove",{mmethod:!0,change:!0,$index:s,$value:i,$id:o,instance:this._parent},!1);var a=(this._path?this._path+".":"")+"$item";this._parent.notifyStateChanged(a,{}),r&&(this.pushSelected(r,!0),r.internalSetSelected(!0),r.notifyChanged("$select",!1,!0,"propchange",{instance:r},!0))}}},t}(y);t.DataList=x;var C=function(){function i(e,t,i,n,s,a,u,c,d,p){this._rootParent=t?t._rootParent:this;var h=[];if(t){var f=t.getPropertyPath();f&&h.push(f)}i&&h.push(i),s&&h.push("$item"),this._fullPath=h.join("."),this.design=p,this.$id=l.allocID(),this.$create=!1,this._initialized={},this._selected=!(!n||!n.$select),this._model={},this.datasets=c,this.transform=d,this.$states={},this.$errors={},this.$links={},this._path=i,this._locale=u,this._parent=t,this._schema=r.expand$Ref(e,this._rootParent._schema),this.className=this._schema.name,this._parent||(this._validators=[{name:"schema",active:!0}]),this._arrayParent=s,this._children={},this._initFromSchema(e),this._parent&&!a||(this.frozen=!0),this===this._rootParent&&(this._rootParent.$create=!!n&&(n.$create||!1)),this._setModel(n,!0),this.frozen=!1,this._parent||(this.notifyChanged("*",void 0,n,"propchange",{source:""},!1),this.notifyStateChanged("*",{checkChildren:!0})),o.execInitRules(this)}return Object.defineProperty(i.prototype,"fullPath",{get:function(){return this._fullPath},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"owner",{get:function(){return this._arrayParent?this._arrayParent:this._parent},enumerable:!0,configurable:!0}),i.prototype.pkId=function(){if(this._schema.primaryKey){var e=r.pkFields(this._schema.primaryKey);return r.pk2Id(r.extractPkValue(this,e),e)}},i.prototype.getJSONPatchPath=function(e){return this.parent?this._arrayParent?this._arrayParent.getJSONPatchPath(this._model.id+(e?"."+e:"")):this.parent.getJSONPatchPath(e?this._path+"."+e:this._path):e},i.prototype.getPropertyPath=function(e,t){if(void 0===e)return this._fullPath;var i=this._fullPath;if(t&&this._fullPath){for(var n=this._fullPath.split("."),s=n.length-1;s>0&&n[s-1]===t&&"$selected"===n[s];)n.pop(),n.pop(),s-=2;i=n.join(".")}return i?i+"."+e:e},i.prototype.saveModel=function(){this._origModel=r.copyModel(this._schema,this._model)},Object.defineProperty(i.prototype,"$schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"root",{get:function(){return this._rootParent},enumerable:!0,configurable:!0}),i.prototype.setModel=function(e){this._destroyObject(this,"_children"),this._children={},this.frozen=!0,this._setModel(e,!1),this.frozen=!1,this._parent||(this.notifyChanged("*",void 0,e,"propchange",{sourve:""},!1),this.notifyStateChanged("*",{checkChildren:!0}))},i.prototype.update=function(e){var t=this;if(e){var i=Object.keys(t._schema.properties),n=t._rootParent._schema;i.forEach(function(i){var s=t._schema.properties[i];if(r.inModel(s,n))if(r.isCompositionRef(s,n))t[i];else r.isCompositionList(s,n,!1)?t[i]=e[i]:r.isSimpleList(s,n)?t[i]=e[i]:(r.isList(s,n),t[i]=e[i])})}},i.prototype.$refresh=function(e){var t=this;return t._parent?l.Promise.resolve():t.onRefresh?t.onRefresh(e):new l.Promise(function(e,i){a.loadMainData({datasets:t.datasets,transform:t.transform,context:t.model(!0)},!1).then(function(i){t.update(i),e()}).catch(function(e){t.addAjaxException(e),i()})})},i.prototype.clearErrors=function(e){var t=this;if(t.$errors&&Object.keys(t.$errors).forEach(function(e){t.$errors[e].clear(!0)}),e){var i=t._rootParent.$schema;Object.keys(t._schema.properties).forEach(function(n){var s=t._schema.properties[n];if(r.inModel(s,i))if(r.isCompositionRef(s,i)){var o=t[n];o&&o.clearErrors(e)}else if(r.isCompositionList(s,i,!1)){var a=t[n];a&&a.forEach(function(t){t.clearErrors(e)})}})}},i.prototype._validate=function(t,i,n){var s=this;if(s.clearErrors(!1),!t||!t.length)return!0;var a=Object.keys(s._schema.properties),u=!1,c=s._rootParent._schema;return i&&o.execBeforeSaveRules(s),a.forEach(function(o){var a=s._schema.properties[o],d=!1;if(r.inModel(a,c)){var p=s.$states[a.$stateProperty||o];if(!p.isHidden&&!p.isDisabled){if(n&&n.indexOf(o)<0)return!1;if(r.isCompositionRef(a,c)){var f=s[o];f?f._validate(t,i)||(u=!0):p.isMandatory&&(s.$errors[o].addErrors([{message:l.format(h.required,r._title(a.title,e.locale))}],!1),u=!0)}else if(r.isCompositionList(a,c,!1)){var m=s[o];m&&(m.forEach(function(e){e._validate(t,i)||(u=!0)}),d=!0)}else d=!0;d&&(s._execValidators(t,o,"validate",{},{base:s,state:p,schema:a,value:s[o]})||(u=!0))}}}),o.execValidationRules(s,n)&&(u=!0),s._parent||s._execValidators(t,"","validate",{},{base:s,state:null,schema:s._schema,value:null})||(u=!0),!u},i.prototype.isRecursiveRule=function(e){var t=this.getRootModel();if(t.callStack){var i=this.getPropertyPath(e);return t.callStack.indexOf(i)>=0&&(l.logRule(t.callStack.length,"Recursive rule detected: property: "+i+" - last rule canceled.",i,""),!0)}},i.prototype.validate=function(e){var t=this.getRootModel();return this._validate(t._validators,e)},i.prototype.partialValidate=function(e){var t=this.getRootModel();return this._validate(t._validators,!1,e)},Object.defineProperty(i.prototype,"$select",{get:function(){return this._selected},set:function(e){this.internalSetSelected(e)&&this._arrayParent&&(this._selected?this._arrayParent.pushSelected(this,!0):this._arrayParent.removeSelected(this,!0),this._arrayParent.simulateSelecting||this.notifyChanged("$select",!e,e,"propchange",{source:this.getPropertyPath("$select"),instance:this},!0))},enumerable:!0,configurable:!0}),i.prototype.select=function(e,t,i,n,s){t?this._arrayParent&&this._arrayParent.selectItem(e,this,t,n,s):n?i.selectItem(e,this,!1,n,s,!0):this._arrayParent&&this._arrayParent.selectItem(e,this,!1,null,!1)},i.prototype.toggleExpand=function(e){var t=!1;if(!e)return t;var i=l.getValue(this,e);return i&&(i.$expand=!i.$expand,t=i.$expand),t},i.prototype.enumVisibleChildren=function(e,t,i,n){var s=l.getValue(this,e);s&&(s.$expand||i)&&s._items.forEach(function(i){n(i,t+1),i.enumVisibleChildren(e,t+1,!1,n)})},i.prototype.internalSetSelected=function(e){return this._selected!==e&&(this._selected=e,!0)},Object.defineProperty(i.prototype,"$index",{get:function(){return this._arrayParent?Math.max(this._arrayParent.indexOf(this),0)+1:0},enumerable:!0,configurable:!0}),i.prototype.getJsonPachDelta=function(e){var t=this.model(!1),i=u.compare(this._origModel,t,e);return i&&i.length?(this._origModel=t,i):null},i.prototype.applyJsonPachDelta=function(e){var t=this;if(e&&e.length){t._updating=!0;try{e.forEach(function(e){var i=f.getJSONPatchParent(e.path,t);if(1!==i.type){var n=i.value;if(n.isArray&&0===i.type)if("add"===e.op)n.push(e.value);else if("remove"===e.op){var s=n.find("id",f._segment2Id(i.lastSegment));s&&n.remove(s)}else"sort"===e.op&&n.sortByKey(e.value,"id");else if(3===i.type)if("$errors"===i.lastSegment)e.value?Object.keys(e.value).forEach(function(t){var i=n.$errors[t];i&&(i.clear("remove"===e.op),"remove"!==e.op&&i.addErrors(e.value[t]))}):n.clearErrors(!0);else if(n.isArray&&!i.lastSegment)"add"===e.op&&n.addErrors([e.value]);else{var o=n[i.lastSegment];o&&("remove"===e.op?o.clear(!0):o.addErrors(e.value))}else if(2===i.type){if(n&&!n.isState)return n=n[i.lastSegment],void("object"==typeof e.value&&Object.keys(e.value).forEach(function(t){if(n[t]&&n[t].isState){var i=e.value[t];"object"==typeof i&&Object.keys(i).forEach(function(e){n[t][e]=i[e]})}else n[t]=e.value[t]}));"remove"===e.op?n[i.lastSegment]=void 0:n[i.lastSegment]=e.value}else"remove"===e.op?n[i.lastSegment]=void 0:n[i.lastSegment]=e.value}else i.value&&(i.value[i.lastSegment]=e.value)})}finally{var i=t.model(!1);t._origModel=i,t._updating=!1}}},i.prototype.$save=function(){var e=this;if(e.getRootModel()!==e)return l.Promise.reject(null);if(!e.validate(!0))return l.Promise.reject(null);var t=a.extractMainDataSource(e);if(t&&a.isCreateOrUpdate(t)){var i=e.model(!1);if(e.$create)t.$method="POST",delete t.$params.$entityId;else{if(t.$method="PATCH",!e._schema.primaryKey)return e.addError("Primary key is missing. Check schema."),l.Promise.reject(null);var s=void 0;if(n.useJSONPatch){var o=r.pkFields(e._schema.primaryKey),c=r.extractPkValue(i,o);if(t.$params.$entityId=r.entityId(c),!(s=u.compare(e._origModel,i,{useId:!0}))||!s.length)return l.Promise.resolve(i)}else if(!(s=l.deltaPatch(e._origModel,i)))return l.Promise.resolve(i);i=s}return new l.Promise(function(n,s){a.datasetAsPromise(t,i).then(function(t){e.$create=!1,n()}).catch(function(t){e.addAjaxException(t),s(null)})})}return l.Promise.reject(null)},i.prototype.getRootModel=function(){return this._rootParent},i.prototype.addValidator=function(e,t){this.getRootModel()._validators.push({name:e,active:t})},i.prototype.activateValidator=function(e,t){for(var i=this.getRootModel(),n=0,s=i._validators.length;n<s;n++){var o=i._validators[n];if(o.name===e){o.active=t;break}}},i.prototype.hasValidators=function(){var e=this.getRootModel();if(e._validators.length){if(1==e._validators.length)return e._validators[0].active;for(var t=0,i=e._validators.length;t<i;t++)if(e._validators[t].active)return!0}return!1},i.prototype.getParentOf=function(e,i){return this.getValue(t.SchemaUtils.parentPath(e),i)},i.prototype.setValue=function(e,t,i){var n=this,s=e.split("."),o=i?s.lastIndexOf("$item"):-1,r=i?s.lastIndexOf("$selected"):-1;o>0?n=r>0&&r>o?i[s.slice(0,r+1).join(".")]:i[s.slice(0,o+1).join(".")]:r>0&&(n=i[s.slice(0,r+1).join(".")]);for(var a=Math.max(Math.max(o+1,r+1),0),l=s.length;a<l&&n;a++)a===l-1?n[s[a]]=t:n=n[s[a]]},i.prototype._getModel=function(e,t){if(e)return this._model;var i=this.getRootModel(),n=i?i._schema:this._schema;return r.copyModel(this._schema,this._model,n,t)},i.prototype.schemaModel=function(e){var t=this.getRootModel(),i=t?t._schema:this._schema;return r.copyModel(this._schema,this._model,i,!0,e)},i.prototype.model=function(e){return this._getModel(e)},i.prototype.getRelativeValue=function(e){return this.getValue(e,{})},i.prototype.getRelativeState=function(e){return this.getState(e,{})},i.prototype.getValueInfo=function(e,t){if(!e)return{value:this,parentIsNull:!1};var i=this,n=e.split("."),s=t?n.lastIndexOf("$item"):-1,o=t?n.lastIndexOf("$selected"):-1;s>0?i=o>0&&o>s?t[n.slice(0,o+1).join(".")]:t[n.slice(0,s+1).join(".")]:o>0&&(i=t[n.slice(0,o+1).join(".")]);for(var r=Math.max(Math.max(s+1,o+1),0),a=n.length;r<a&&i;r++)i=i[n[r]];return{value:i,parentIsNull:!1}},i.prototype.getValue=function(e,t){return this.getValueInfo(e,t).value},i.prototype.getSchema=function(e){return r.getSchema(e,this._schema,this._rootParent._schema,!1)},i.prototype.getState=function(e,i){if(!e)return{value:this,parentIsNull:!1};var n,s=this,o=e.split("."),a=o.pop(),l=a,u={},c=!1,d=o.length-1;if(r.isMetaProp(a)){var p=r.getSchema(e,this._schema,this._rootParent._schema,!1);p&&p.$stateProperty&&(a=p.$stateProperty)}var h=i?o.lastIndexOf("$item"):-1,f=i?o.lastIndexOf("$selected"):-1;h>0?s=f>0&&f>h?i[o.slice(0,f+1).join(".")]:i[o.slice(0,h+1).join(".")]:f>0&&(s=i[o.slice(0,f+1).join(".")]);for(var m=Math.max(Math.max(h+1,f+1),0),v=o.length;m<v;m++){var g=o[m];if(m===d&&"$links"===g){c=!0;break}if(n=(s=s[g])&&s.$states&&s.$states[g]?s.$states[g].state():null,(!s||s.isNull||s.isUndefined)&&(u.isDisabled=!0),n&&n.isHidden&&(u.isHidden=!0),n&&n.isDisabled&&(u.isDisabled=!0),n&&n.isReadOnly&&(u.isReadOnly=!0),!s)break}var y={};if(!c){if(a===t.SELECTED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!1,isHidden:!1};if(a===t.INDEX_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1};if(a===t.EXPANDED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1}}if(s){var _="$states";c&&(_="$links");var b=s[_]?s[_][a]:null;b&&(y=b.state(),!c&&s.$errors&&s.$errors[l]&&(y.errors=s.$errors[l].errors()))}return $.extend({},y,u)},i.prototype._setPropErrors=function(e,t){if(t.$errors&&t.$errors[e]&&this.$errors[e]){var i=[];t.$errors[e].forEach(function(e){i.push(e)}),this.$errors[e].addErrors(i)}this.$errors[e]&&(t.$errors[e]=this.$errors[e].errors())},i.prototype._setModel=function(e,t){var i=this,n=i.frozen;t&&(i.frozen=!0),i.isNull=null===e,i.isUndefined=void 0===e;var s=void 0!==(e=e||{}).$create?e.$create:!!i._parent&&i._parent.$create;e&&(e=r.init(i._schema,i._rootParent._schema,null,e,s,{select:i._schema===i._rootParent._schema}))&&(i.$create=e.$create,e.$create),e.$states=e.$states||{},e.$links=e.$links||{},e.$errors=e.$errors||{};var o=Object.keys(i._schema.properties),a=i._rootParent._schema;i._model.$links=e.$links,o.forEach(function(t){var n=i._schema.properties[t];if(r.inModel(n,a)){var s=r.isMetaProp(t),o=e[t];if(o||!r.isCompositionList(n,a,!1)&&!r.isList(n,a)||(e[t]=o),r.isList(n,a)?i._setQueryListChild(t,o,e.pageSize,e.pageSize?Math.round(e.skip/e.pageSize)+1:0,e.count,e._hasNext,e._hasPrev,e._noPagesCount,e._origData):i[t]=o,!s){if(e.$states&&e.$states[t]){var l=e.$states[t];Object.keys(l).forEach(function(e){i.$states[t][e]=l[e]})}e.$states[t]=i.$states[t].state()}i._setPropErrors(t,e)}}),i._setPropErrors("$",e),e.$links&&(o=Object.keys(i._schema.links||{})).forEach(function(t){var n=e.$links[t],s=i.$links[t];n&&Object.keys(n).forEach(function(e){s[e]=n[e]}),e.$links[t]=i.$links[t].state()}),i._model=e,i.frozen=n},i.prototype._setRefChild=function(e,t,n){var s=this.frozen;this.frozen=!0,this._children[e]?this._children[e]._setModel(n,!0):this._children[e]=new i(this._schema.properties[e],this,e,n,null,!0,this._locale,null),this.frozen=s},i.prototype._setListChild=function(e,t,i){var n=this.frozen;if(this.frozen=!0,this._children[e])this._children[e]._setModel(i,!0);else{var s=null;this._arrayParent&&this._arrayParent.schema.children===e&&(s=this._arrayParent),this._children[e]=new x(this._schema.properties[e],this,e,i,null,this._locale,s)}this.frozen=n},i.prototype._setSimpleListChild=function(e,t,i){var n=this.frozen;this.frozen=!0,this._children[e]?this._children[e]._setModel(i,!0):this._children[e]=new b(this._schema.properties[e],this,e,i,null,this._locale,!1,null),this.frozen=n},i.prototype._setQueryListChild=function(e,t,i,n,s,o,r,a,l){var u=this.frozen;this.frozen=!0,this._children[e]&&this._children[e].destroy(),this._children[e]=new g(this._schema,this._schema.properties[e],this,e,t,i,n,s,o,r,a,l,null,this._locale),this.frozen=u,this.notifyChanged(e,null,t,"propchange",{instance:this},!0),this.notifyStateChanged(e,{instance:this,checkChildren:!0})},i.prototype._initFromSchema=function(i){var n=this;if(n._model){var o=i.states?$.extend(!0,{},i.states):null,a=i.links?$.extend(!0,{},i.links):null,l=i.errors?$.extend(!0,{},i.errors):null,u=!1,c=Object.keys(i.properties);c.forEach(function(t){if(!r.isMetaProp(t)){var n=i.properties[t];if("password"===n.format){if(!n.capabilities||!n.capabilities.noConfirming){var s="$$"+t;n.$meta=s;var o=i.properties[s];o||((o=$.extend(!0,{},n)).title=e.locale.ui.Confirm,o.$stateProperty=t,i.properties[s]=o,u=!0)}}else"rate"===n.format&&(n.exclusiveMinimum=!0,n.exclusiveMaximum=!0,void 0===n.decimals&&(n.decimals=r.RATE_DECIMALS),void 0===n.maximum&&(n.maximum=r.RATE_MAXIMUM),void 0===n.minimum&&(n.minimum=-r.RATE_MAXIMUM),void 0===n.symbol&&(n.symbol=r.RATE_SYMBOL))}}),u&&(c=Object.keys(i.properties)),c.forEach(function(e){!function(e,i){var n=e._rootParent._schema,s=e._schema.properties[i];r.inModel(s,n)&&(Object.defineProperty(e,i,{get:function(){var e=this._children[i];return e||this._model[i]},set:function(t){var n=this._model[i];if(n!==t||!this._initialized[i]){var s=this._schema.properties[i],o=this._beforeChange(this,i,s,n,t,!this._initialized[i]);if(t=o.value,this._initialized[i]=!0,o.continue){if(this.isRecursiveRule(i))return;this._model[i]=t;var a=e._rootParent._schema,l=this.$errors[i];l&&l.clear(!0),r.isCompositionRef(s,a)?(this._setRefChild(i,n,t,{}),this.notifyChanged(i,n,t,"propchange",{instance:this,checkChildren:!0},!0),this.notifyStateChanged(i,{instance:this,checkChildren:!0})):r.isCompositionList(s,a,!1)?(this._setListChild(i,n,t,"propchange",{checkChildren:!0}),this.notifyChanged(i,n,t,"propchange",{instance:this},!0),this.notifyStateChanged(i,{instance:this,checkChildren:!0})):r.isSimpleList(s,a)?(this._setSimpleListChild(i,n,t,"propchange",{}),this.notifyChanged(i,n,t,"propchange",{instance:this},!0),this.notifyStateChanged(i,{instance:this,checkChildren:!0})):r.isList(s,a)?this[i].setModel(t):this.notifyChanged(i,n,t,"propchange",{instance:this},!0)}}},enumerable:!0}),r.isCompositionList(s,n,!1)&&Object.defineProperty(e,i+t.EXPANDED_FIELD_NAME,{get:function(){var e=this[i];return e&&e.length?e.$expand?2:1:0},set:function(e){var t=this[i];t&&(1===e?t.$expand=!1:2===e&&(t.$expand=!0))},enumerable:!0}))}(n,e),r.isMetaProp(e)||function(e,t,i){var n=e._schema.properties[t],o=e._rootParent._schema;r.inModel(n,o)&&(r.isNumber(n)&&(r.isMoney(n)?((i=i||{}).symbol||(i.symbol=n.symbol||d.number.symbol),i.decimals||(i.decimals=void 0!==n.decimals?n.decimals:d.number.places)):(i=i||{},void 0!==n.symbol&&((i=i||{}).symbol=n.symbol),void 0!==n.decimals?i.decimals=n.decimals:i.decimals=0)),"array"!==n.type||n.items&&n.items.type&&"object"!==n.items.type?e.$states[t]=new s.DataStates(e,t,i):e.$states[t]=new s.ListStates(e,t,i))}(n,e,o?o[e]:null),function(e,t,i){var n=e.$schema.properties[t],o=e.root.$schema;r.inModel(n,o)&&!r.isCompositionRef(n,o)&&(e.$errors[t]=new s.Errors(e,t,i))}(n,e,l?l[e]:null)}),i.links&&Object.keys(i.links).forEach(function(e){t=n,i=e,o=a?a[e]:null,t.$links[i]=new s.LinkStates(t,i,o);var t,i,o}),n._parent&&!n._arrayParent||(n.$errors.$=new s.Errors(n,"$",[]))}},i.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),f.getValue(t.join("."),this)},i.prototype.addAjaxException=function(e){var t=this;if(t._parent)return t._parent.addAjaxException(e);var i=c.extractAjaxErrors(e),n=[],s=null;i.message&&(s={message:i.message,details:[]},n.push(s)),i.list&&i.list.length&&i.list.forEach(function(e){var i=!0;if(e.target){var o=t.getParentModel(e.target);if(o){var a=r.lastSegment(e.target,null);o.hasOwnProperty(a)&&(i=!1,o.$errors[a].addError(e.message))}}i&&(s?s.details.push({message:e.message}):n.push({message:e.message}))}),t.$errors.$.addErrors(n)},i.prototype.addError=function(e){var t=[{severity:"error",message:e,id:l.allocUuid()}];this.addErrors(t)},i.prototype.rmvError=function(e){this.$errors.$?this.$errors.$.rmvError(e):this._parent&&this._parent.rmvError(e)},i.prototype.addErrors=function(e){this.$errors.$?this.$errors.$.addErrors(e):this._parent&&this._parent.addErrors(e)},i.prototype._beforeChange=function(e,t,i,n,s,o){var a={continue:!0,value:s};return r.isNumber(i)&&!isNaN(s)&&null!==s&&void 0!==s&&this.$states[t]&&void 0!==this.$states[t].decimals&&(a.value=parseFloat(s.toFixed(this.$states[t].decimals)),o||n!==a.value||(a.continue=!1)),a.continue&&i.ux&&i.emitChanging&&(a.continue=e.notifyBeforeChanged(t,n,s,{})),a},i.prototype.notifyStateChanged=function(e,t){var i=this;if(!(i.frozen||i._arrayParent&&i._arrayParent.frozen))if(i!==i._rootParent){t.fromChildren=!0;i._getPaths(t).forEach(function(n,s){var o=n;e&&(o=o?o+"."+e:e),t.change=0===s,i._rootParent.notifyStateChanged(o,t)})}else t.fromChildren||(t.change=!0),l.logModule("proxydata")&&l.log("State changed: "+i._extractPropName(e||"",t),"proxydata"),i.onstatechanged&&i.onstatechanged(e,t)},i.prototype._extractPropName=function(e,t){return Object.keys(t).sort().reverse().forEach(function(i){var n=t[i];n&&void 0!==n.$index&&(e=e.replace(i,i+"["+n.$index+"]"))}),e},i.prototype._execValidators=function(e,t,i,n,s){var o=this,a=!1;if(t){if(!s){var l=o.getValueInfo(t,n);if(void 0===l.value&&l.parentIsNull)return!a}}else if("validate"!==i)return!a;return e.forEach(function(e){e.active&&(e.hnd||(e.hnd=r.getValidator(e.name)),e.hnd&&(e.hnd(i,o,{name:t,params:n,locale:o._locale},s)||(a=!0)))}),!a},i.prototype.notifyBeforeChanged=function(e,t,i,n){var s=this;if(!(s.frozen||s._arrayParent&&s._arrayParent.frozen)){if(s===s._rootParent)return n.fromChildren||(n.change=!0),n.continue=!0,s.onchange&&n.change&&s.onchange(e,t,i,"beforeChange",n),n.continue;n.fromChildren=!0;var o=!0;s._getPaths(n).forEach(function(r,a){var l=r;e&&(l=l?l+"."+e:e),n.change=0===a,o=o&&s._rootParent.notifyBeforeChanged(l,t,i,n)})}},i.prototype._getSelectedParentArray=function(e){for(var t=this._arrayParent,i=this._arrayParent.path+".$item";t.schema.children&&t.schema.children===t.path&&t.parent._arrayParent;)i=(t=t.parent._arrayParent).path+".$item."+i;return e?{path:i,value:t}:t},i.prototype._getPaths=function(e){var t=this;if(t._arrayParent){var i=t._getSelectedParentArray(!0),n=i.value,s=n.parent._getPaths(e),o=null;return n.$selected===t&&(o=[],s.forEach(function(i,s){if(i.indexOf(".$selected.")>0||i.indexOf(".$item.")<0){var r=(i?i+".":"")+n.path+".$selected";o.push(r),e[r]=t}})),s.forEach(function(n,o){s[o]=(n?n+".":"")+i.path,e[s[o]]=t}),o?s.concat(o):s}if(!t.parent)return[""];var r=t.parent._getPaths(e);return r.forEach(function(e,i){r[i]=e?e+"."+t._path:t._path}),r},i.prototype.notifyChanged=function(e,t,i,n,s,r){var a=this;if(!(a.frozen||a._arrayParent&&a._arrayParent.frozen))if(a!==a._rootParent){s.fromChildren=!1;a._getPaths(s).forEach(function(o,l){var u=o;e&&(u=u?u+"."+e:e),s.change=0===l,a._rootParent.notifyChanged(u,t,i,n,s,r)})}else s.fromChildren||(s.change=!0),l.logModule("proxydata")&&l.log("Changed: "+a._extractPropName(e||"",s)+", operation = "+n,"proxydata"),a.onchange&&a.onchange(e,t,i,n,s),!a._updating&&r&&a._validators&&s.change&&a.hasValidators()&&a._execValidators(a._validators,e,"propchanged",s),!a._updating&&s.change&&(o.execPropChangeRules(a,e,s,{validations:!0,propagations:!0}),a.onsync&&a.onsync(null))},i.prototype.execSyncAction=function(e,t,i){var n=this._rootParent;if(n.onsync&&(!i||!i.$nosync)){var s=n.syncAction(e,t);if(s)return n.onsync(s),!0}return!1},i.prototype.syncAction=function(e,t){var i=e.split(".");if("$sort"===i[i.length-1])return{op:"replace",path:"/"+i.join("/"),params:t};if("$filter"===i[i.length-1])return{op:t?"replace":"remove",path:"/"+i.join("/"),params:t};if("$selected"===i[i.length-1])return{op:"replace",path:"/"+i.join("/"),params:t,delayed:!0};var n=e.indexOf("$links.");if(n<0)return null;var s="";n>0&&(s=e.substr(0,n-1));var o=e.substr(n+"$links.".length),r=this.getSchema(s);if(r.links&&r.links[o]&&r.links[o].ux)return null;if(!s&&"save"===o&&!this.validate(!0))return null;var a=null;return r.links&&r.links[o]&&(r.links[o].data&&(t=r.links[o].data),a=r.links[o].after),{path:"/"+i.join("/"),params:t,after:a}},i.prototype._destroyObject=function(e,t){var i=e[t];i&&Object.keys(i).forEach(function(e){i[e].destroy(),delete i[e]})},i.prototype.hasErrors=function(){var e=!1;if(e)return e;for(var t=Object.keys(this.$errors),i=0,n=t;i<n.length;i++){var s=n[i];if(this.$errors[s].hasErrors()){e=!0;break}}t=Object.keys(this._schema.properties||{});for(var o=this._rootParent._schema,a=0,l=t;a<l.length;a++){s=l[a];var u=this._schema.properties[s];if(r.inModel(u,o)){if(r.isCompositionRef(u,o))e=this[s].hasErrors();else if(r.isCompositionList(u,o,!1)){this[s].forEach(function(t){e||(e=t.hasErrors())})}if(e)break}}return e},i.prototype.destroy=function(){this._parent=null,this._destroyObject(this,"_children"),this._destroyObject(this,"$states"),this._destroyObject(this,"$links"),this._destroyObject(this,"$errors"),this._arrayParent=null,this._model=null,this._schema=null,this.onRefresh=null,this.onchange=null,this.onsync=null,this.onstatechanged=null,this._rootParent=null},i}();t.Data=C,t.ObservableUtils=f}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=e.Observable,s=(n.SchemaUtils,n.DataUtils,i.DatasetPlugin);e.locale,e.ulocale,e.utils;t.update=function(e,t,i,n,o){try{var r=e.getJsonPachDelta({useId:!0});if(t&&t.length&&(r=r||[],t.forEach(function(e){r.push({op:e.op||"add",path:e.path,value:e.params})})),!r){try{n(null)}finally{o()}return}var a=i.syncDataSet();a.name="patch",a.$params.$method="PATCH";var l={};s.executeDatasets([a],r,l,[],function(t,i){try{i?e.addAjaxException(i):n(l.patch)}finally{o()}})}catch(e){o()}}}(e.serversync||(e.serversync={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){e.data,e.utils;var i=t.SchemaUtils;i.registerValidator("schema",function(e,t,n,s){var o=!0,r="validate"===e;if("propchanged"===e||r){if(!n.name)return o;if(n.method)return!0;var a=i.lastSegment(n.name,null);if(i.arrayProps.indexOf(a)>=0)return o;var l=s?s.value:t.getValue(n.name,n.params),u=s?s.state:t.getState(n.name,n.params),c=s?s.schema:t.getSchema(n.name);if(u&&(u.isHidden||u.isDisabled))return o;var d=n.locale,p=[],h=s?s.base:t.getParentOf(n.name,n.params);if(i.validateSchema(l,c,u,d,p,[])||(o=!1),r&&i.isMetaProp(a)&&c&&"password"===c.format){var f=t.getValue(i.extractBase(n.name)+c.$stateProperty,n.params);c=t.getValue(i.extractBase(n.name)+c.$stateProperty,n.params),i.validatePassword(f,l,c,u,d,p)||(o=!1)}h.$errors&&h.$errors[a]&&h.$errors[a].addErrors(p)}return o})}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.utils,n=function(){function e(){this._forms={},this._inAction=!1}return e.prototype.setInAction=function(e){this._inAction=e},e.prototype.isInAction=function(){return this._inAction},e.prototype.broadcast=function(e,t){var n=this;i.nextTick(function(){Object.keys(n._forms).forEach(function(i){var s=n._forms[i];s&&s.execAction(e,t)})})},e.prototype.add=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=e)},e.prototype.remove=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=null)},e.prototype.formByName=function(e){return this._forms[e]},e}();t.FormManager=n;t.formManager=function(){var e;return function(){return e||(e=new n),e}}()}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.ui,s=i.utils,o=i.build,r=i.link,a=i.dom,l=i.layoutUtils,u=i.customData,c=i.preferences,d=i.Observable.SchemaUtils,p=i.Observable.ObservableUtils,h=(i.ulocale,function(i){__extends(h,i);function h(t,a,u,c,p,h){var f=i.call(this,t,a,u,c,p,h)||this;f._event2Layout=function(e){if(!this.$element)return null;for(var t=this.$element.get(0),i=e.target;i;){var n=i.getAttribute("data-render");if(n){var s=this.getLayoutById(n);if(s)return s}i=i===t?null:i.parentNode}return null};var m=f;u&&u.$transactionId&&(m._transactionId=u.$transactionId,m._viewId=u.id,delete u.$transactionId),m._resizeHnd=function(e){return m._resizeControls(!1),!0};r.context().$url.$showRules&&s.showRules(!0),a.module&&(m.module=a.module,delete a.module),t.data&&(m.formData=$.extend(!0,{},t.data)),m.formManager=n.formManager(),m.formManager.add(m),m.$schema=c||{},m.$rootSchema=m.$schema,a.path&&(m.$rootPath=a.path,m.$schema=d.getSchema(a.path,m.$schema,m.$rootSchema,!0)),a.checkFormLayout&&a.checkFormLayout(m),m.$locale=p,a&&a.preferenceName&&(m._settingsName=a.preferenceName,m._settings=h),a&&a.storageName&&(m._settingsName=a.storageName,m._localSettings=!0);var v=a&&a.jsonSync||null!==m.syncDataSet();return v&&(m.onsync=e.serversync.update),m.setData(u),m.$model.onchange=m._modelChanged.bind(m),v&&(m.$model.onsync=m._synModel.bind(m)),m.$model.onstatechanged=m._stateChanged.bind(m),m._bindStates={},m._bindTitles={},m._bindAccordion={},Object.keys(m.map).forEach(function(e){var t=m.map[e];if(t.$bindState&&(m._bindStates[t.$bindState]=m._bindStates[t.$bindState]||[],m._bindStates[t.$bindState].push(e)),t.$title&&t.$title.value&&!t.$title.isHidden){var i=[];s.extractAngularVars(t.$title.value,i)&&(i&&i.forEach(function(t){m._bindTitles[t.name]||(m._bindTitles[t.name]=[],m.registerListenerFor(t.name,m,"layout-titles")),m._bindTitles[t.name].push(e)}),t.$fields=!0)}t.$bindPages&&t.$type===l.LAYOUT_ACCORDION&&"none"===t.$widget&&(m._bindAccordion[t.$bindPages]||(m._bindAccordion[t.$bindPages]=[],m.registerListenerFor(t.$bindPages,m,"layout-accordion")),m._bindAccordion[t.$bindPages].push(e),m._activateTab(t))}),Object.keys(m._bindStates).forEach(function(e){var t=m.$model.getState(e,{});if(t&&t.isHidden){m._bindStates[e].forEach(function(e){m.map[e].$isHidden=!0})}m.registerListenerFor(e,m,"layout-state")}),m.registerListenerFor("$",m),m.loadPrefs(),a&&a.validators&&a.validators.forEach(function(e){m.$model.addValidator(e,!0)}),m.options.design||!m.options.externalSchema||!m.options.externalLayout||o.release||a.autoClose||(m.options.authoringIndicator=!0,m.options.verticalSpacing=!0),m._afterCreate(),f}return h.prototype.addChildForm=function(e,t){this._childrenForms=this._childrenForms||[],this._childrenForms.push({form:e,parentId:t}),e._parentForm=this},h.prototype.removeChildForm=function(e){if(this._childrenForms)for(var t=this._childrenForms.length;t--;){if(this._childrenForms[t].form===e){this._childrenForms.splice(t,1);break}}},h.prototype.closeInlineForms=function(e){var t=this.getLayoutByName(e);if(t&&this._childrenForms)for(var i=this._childrenForms.length;i--;){var n=this._childrenForms[i];n.parentId===t.$id&&(this._childrenForms.splice(i,1),n.form._parentForm=null,n.form.close())}},h.prototype.hasInlineForms=function(e){var t=this.getLayoutByName(e);if(t&&this._childrenForms)for(var i=this._childrenForms.length;i--;){var n=this._childrenForms[i];if(n.parentId===t.$id)return n.form}return null},h.prototype._isInDelayedAction=function(){return this.formManager?this.formManager.isInAction():this._internalDelayedAction},h.prototype._setInDelayedAction=function(e){this.formManager?this.formManager.setInAction(e):this._internalDelayedAction=e},h.prototype.initOptions=function(e){return(e=e||{}).parentContext&&(this._parentModel=e.parentContext,e.parentContext=null),e.form=!0,e},h.prototype.syncTransactionId=function(){return this._transactionId},h.prototype.syncViewId=function(){return this._viewId},h.prototype.execLater=function(e){this._afterProcessing?this._afterProcessing[e.id]=e.hnd:e.hnd()},h.prototype._processing=function(e,t){var i=this;t&&(i._afterProcessing={});try{e()}finally{i._afterProcessing&&Object.keys(i._afterProcessing).forEach(function(e){i._afterProcessing[e]()}),i._afterProcessing=null}},h.prototype.syncDataSet=function(){var e=this.data.datasets?Object.keys(this.data.datasets):[];if(1===e.length&&"sync"===this.data.datasets[e[0]].$type){return s.copy(this.data.datasets[e[0]])}return null},h.prototype._getFormLData=function(){return this.$model},h.prototype._activateTab=function(e){var t=this.$model.getValue(e.$bindPages,{}),i=this.$model.getState(e.$bindPages,{});if(e.showTabs=!0===i.isHidden,t){var n=null,s=null;e.$items.forEach(function(e){e.opened&&(n=e),e.$name===t&&(s=e)}),s?(s.opened=!0,n&&n!==s&&(n.opened=!1)):!n&&e.$items.length&&(e.$items[0].opened=!0)}},h.prototype.setData=function(t){t=t||{},this.$data=t,this.options.beforeSetModel&&this.options.beforeSetModel(this.$data,this),this.$model?this.$model.setModel(this.$data):this.$model=new e.Observable.Data(this.$schema,null,"",this.$data,null,!1,this.$locale,this.data.datasets,this.data.transform,this.options.design),this.$model.saveModel(),this.options.afterModelCreated&&this.options.afterModelCreated(this.$model,this)},h.prototype.processing=function(e){this._inProcessing=e,a.processing(e,100)},h.prototype.controlByField=function(e){return this._findControlByField(e)},h.prototype.controlByName=function(e,t){return this._findControlByName(e,t)},h.prototype._findControlByField=function(e){var t=this,i=[];return Object.keys(t.controls).forEach(function(n){var s=t.controls[n];s&&s.$bind===e&&i.push(s)}),i.length?i:null},h.prototype._findControlByName=function(e,t){var i=this,n=[];return Object.keys(i.controls).forEach(function(t){var s=i.controls[t];s&&s.name===e&&n.push(s)}),t&&!n.length&&i.namedMapFields[e]&&n.push(i.namedMapFields[e]),n.length?n:null},h.prototype.loadPrefs=function(){this._localSettings&&this._settingsName&&(this._settings=c(this._settingsName))},h.prototype.supportSettings=function(){return!!this._settingsName},h.prototype.getFieldSettings=function(e){return this._settings?this._settings[e]:null},h.prototype.setFieldSettings=function(e,t){this._settings=this._settings||{},this._settings[e]=t},h.prototype.savePrefs=function(t){this._settingsName&&(this._localSettings?(this._settings=this._settings||{},c(this._settingsName,this._settings),t()):e.external.preferenceSaveHandler(this._settingsName,this._settings).then(function(){t()}))},h.prototype.sendMessage=function(e,t,i){var n,s=this._findControlByField(t);return s&&s.length&&s.forEach(function(t){t.sendMessage&&(n=t.sendMessage(e,i))}),n},h.prototype.afterSettings=function(e,t,i){return this.options.settingsHandler?this.options.settingsHandler("after",e,t,i):i},h.prototype.beforeSettings=function(e,t){return this.options.settingsHandler?this.options.settingsHandler("before",e,t):null},h.prototype._createError=function(){var e=["bs-form-error"];return this.options.verticalSpacing?e.push("bs-form-vertical-space"):(this.options.closeButtonHandler||this.options.authoringIndicator)&&e.push("bs-form-settings-space"),$('<div id="'+this.data.$id+'_error" class="'+e.join(" ")+'"><div>').get(0)},h.prototype._createErrorItem=function(e,t){var i="success"==e.severity?"success":"warning"==e.severity?"warning":"danger",n=t?"":"bs-none ",o=[s.format('<div id="{0}_error" data-error="true" class="'+n+" alert alert-"+i+' alert-dismissible fade show">',e.id)];return o.push('<button type="button" data-error-close="true" class="close" aria-label="Close">'),o.push('<span data-error-close="true" aria-hidden="true">&times;</span>'),o.push("</button>"),o.push(s.escapeHtml(e.message)),e.details&&e.details.length&&e.details.forEach(function(e){e.message&&o.push('<p class="bs-error-detail-item">'+s.escapeHtml(e.message)+"</p>")}),o.push("</div>"),$(o.join("")).get(0)},h.prototype.clearErrors=function(){if(this.$element){var e=a.find(this.$element.get(0),this.data.$id+"_error");e&&a.empty(e)}},h.prototype.showErrorItem=function(e,t){if(this.$element){var i=a.find(this.$element.get(0),this.data.$id+"_error");i&&(t&&a.empty(i),a.append(i,this._createErrorItem(e,t)))}},h.prototype.afterRenderChildren=function(e){var t=e.find("[data-phoenix-tooltip]");t.tooltip&&t.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},h.prototype._loadNestedControllers=function(){var e=this;e._nestedControllers=[],Object.keys(e.map).forEach(function(t){var i=e.map[t];if(i.$refController){var n={$refProperty:i.$refProperty,handler:null,beforeSetModel:null},o=u.get(i.$refController);if(!o)throw s.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',i.$refController);o.onModelChanged&&(n.handler=o.onModelChanged.bind(o)),o.beforeSetModel&&(n.beforeSetModel=o.beforeSetModel.bind(o)),e._nestedControllers.push(n)}})},h.prototype.hasNestedControllers=function(){return this._nestedControllers||this._loadNestedControllers(),this._nestedControllers.length>0},h.prototype.modelCreated=function(e){this._nestedControllers.forEach(function(t){if(t.beforeSetModel){var i=e,n=!1;t.$refProperty?(n=!0,i=s.getValue(e,t.$refProperty)):t.$refProperty||(n=!0),n&&i&&t.beforeSetModel(i)}})},h.prototype.modelChanged=function(e,t,i,n){this._nestedControllers.forEach(function(o){if(o.handler){var r=e,a=t,l=!1;o.$refProperty&&r.property&&0===r.property.indexOf(o.$refProperty+".")?(l=!0,(r=s.copy(e)).property=r.property.substring(o.$refProperty.length+1),a=t.getValue(o.$refProperty,e.params)):o.$refProperty||(l=!0),l&&o.handler(r,a,i,n)}})},h.prototype.afterRender=function(e){var t=this,i=e.get(0);t.autoClose&&(i.tabIndex=0);var n=i.firstChild?i.firstChild:i;t.options.form&&!t.options.design&&a.before(n,t._createError());var s=function(e,i,n,s){var o=["<div "+i+'="true" class="bs-cursor-p bs-form-settings'+(n?" "+n:"")+(s?"  space-"+s:"")+'" id="'+t.data.$id+'_settings">'];return o.push("<span "+i+'="true" class="'+a.iconClass(e)+'"></span>'),o.push("</div>"),o.join("")},o=0;if(t.options.closeButtonHandler){var r="times-circle-o",l="red";t.options.autoClose&&(r="remove",l="normal"),a.append(i,$(s(r,"data-form-detail-close",l,o)).get(0)),o++}t.options.authoringIndicator&&(a.append(i,$(s("cog","data-form-settings",null,o)).get(0)),o++),t._showErrors()},h.prototype._afterLayoutAdded=function(t){var i=this;l.enumSubLayouts(t,function(t){if(t.$fields&&t.$title&&t.$title.value){var n=i.$element.get(0),s=a.find(n,t.$id+"_title");s&&e.layoutUtils.updateLayoutTitle(s,t,i.$model,i.$locale)}})},h.prototype.changed=function(e,t,i,n,s){var o=this;if("layout-titles"===s.targetId){if(o._bindTitles[s.propName]&&o.$element){var r=o.$element.get(0);o._bindTitles[s.propName].forEach(function(e){var t=a.find(r,e+"_title");if(t){var i=o.getLayoutById(e);i&&i.$title&&i.$title.value&&l.updateLayoutTitle(t,i,o.$model,o.$locale)}})}}else"layout-accordion"===s.targetId&&o._bindAccordion[s.propName]&&o._bindAccordion[s.propName].forEach(function(e){o.getLayoutById(e).$items.forEach(function(e){e.$name!==i||e.opened||o._activatePageLayout(e)})})},h.prototype._showErrors=function(){var e=this.$model.$errors.$;if(e.hasErrors())for(var t=e.errors(),i=0,n=t.length;i<n;i++){var s=t[i];this.showErrorItem(s,0==i)}else this.clearErrors()},h.prototype.stateChanged=function(e,t){var i=this;if("layout-accordion"===t.targetId){if("isHidden"===e&&t.property){var n=i.$model.getState(t.property,{});(s=i._bindAccordion[t.property])&&s.forEach(function(e){var t=i.map[e],s=a.find(i.$element.get(0),t.$id+"_tab");s&&(n.isHidden?a.removeClass(s,"bs-none"):a.addClass(s,"bs-none"))})}}else if("layout-state"===t.targetId){if("isHidden"===e&&t.property){var s,o=i.$model.getState(t.property,{});(s=i._bindStates[t.property])&&s.forEach(function(e){var t=i.map[e];t&&i.updateIsHidden(t,o.isHidden)})}}else"$"===t.property&&"errors"===e&&i._showErrors()},h.prototype.getSchema=function(e){return d.getSchema(e,this.$schema,this.$rootSchema,!1)},h.prototype.getLookupForSchema=function(e,t){return d.getLookup(e,t,this.$schema,this.$rootSchema)},h.prototype.registerListenerFor=function(e,t,i){var n=e;this._listenerChanged=!0,this._listeners=this._listeners||{},this._listeners[n]=this._listeners[n]||[],this._listeners[n].push({target:t,id:i||""})},h.prototype.unRegisterListenerFor=function(e,t){var i=e;if(this._listeners&&this._listeners[i]){var n=this._listeners[i].findIndex(function(e){return e.target===t});n>=0&&(this._listeners[i].splice(n,1),this._listenerChanged=!0)}},h.prototype.setValue=function(e,t){p.setValue(e,t,this.$model)},h.prototype.getValue=function(e){return p.getValue(e,this.$model)},h.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),p.getValue(t.join("."),this.$model)},h.prototype.getState=function(e){var t=p.getState(e,this.$model);return this.options.design&&(t.isHidden=!1,t.isDisabled=!1),t},h.prototype._enumListener=function(e,t){this._listeners[e].forEach(function(e){t(e)})},h.prototype._rebuildListeners=function(){this._listenerChanged&&(this._listenersByName=Object.keys(this._listeners),this._listenerChanged=!1)},h.prototype._match=function(e,t,i){var n=e.join("."),s=n+".";this._listenersByName&&this._listenersByName.forEach(function(e){e===n?t(e,!0,!1,!1):"*"===n||0===n.indexOf(e+".")?t(e,!1,!0,!1):i.checkChildren&&0===e.indexOf(s)&&t(e,!1,!1,!0)})},h.prototype.openInlineForm=function(e){var i=this,n=i.getLayoutByName(e.where);n&&t.OpenInlineForm&&t.OpenInlineForm(n.$id,e.name,e.meta,e.controller,e.data,e.locale,function(e){i.addChildForm(e,n.$id)})},h.prototype.execAction=function(e,t,i){if(!this.$model.execSyncAction(e,t,i)){if(0===e.indexOf("$action.")){var n=e.split(".");n.shift();var s={};return s[n.join(".")]=!0,r.execLink(s,t,null)}this._modelChanged(e,null,null,"execute",i,t)}},h.prototype.close=function(){this.$content&&(this.$content.empty(),a.remove(this.$content.get(0))),this.destroy()},h.prototype.broadcast=function(e,t){this.formManager.broadcast(e,t)},h.prototype.patch=function(e){var t=this;t._inSync=!0,t.processing(!0);try{t._processing(function(){t.$model.applyJsonPachDelta(e)},e.length>10)}finally{t.processing(!1),t._inSync=!1}},h.prototype._sendData=function(){var e=this;e._inSync=!0,e.processing(!0);var t=null;e._actions&&e._actions.length&&(t=e._actions),e._actions=null,e.onsync(e.$model,t,e,function(t){t&&t.length&&e._processing(function(){e.$model.applyJsonPachDelta(t)},t.length>10)},function(){e.processing(!1),e._inSync=!1,t&&t.forEach(function(t){t&&t.after&&e.execAction(t.after,{},{$nosync:!0})})})},h.prototype._synModel=function(e){var t=this;if(!t._inSync&&t.onsync)if(t._syncTimeOut&&clearTimeout(t._syncTimeOut),e){var i=e.delayed;delete e.delayed,t._actions=t._actions||[];var n=t._actions.findIndex(function(t){return t.path===e.path&&t.op===e.op});n>=0&&t._actions.splice(n,1),t._actions.push(e),i?setTimeout(function(){t._sendData()},80):t._sendData()}else setTimeout(function(){t._sendData()},80)},h.prototype._modelChanged=function(e,t,i,n,s,o){var r=this,a=e.split(".");r._rebuildListeners(),(s=s||{}).oldValue=t,s.newValue=i,"execute"!==n&&"beforeChange"!==n&&r._match(a,function(o,a,l,u){("propchange"===n||a)&&(s.propName=o,a?r._enumListener(o,function(o){o.target.changed&&(s.targetId=o.id,o.target.changed(e,t,i,n,s))}):l?r._enumListener(o,function(o){o.target.changed&&(s.targetId=o.id,o.target.changed(e,t,i,n,s))}):u&&r._enumListener(o,function(e){e.target.changed&&(s.targetId=e.id,e.target.changed(o,t,r.getValue(o),n,s))}))},s),r.afterchanged(e,n,s,o)},h.prototype.afterchanged=function(e,t,i,n){if(this.onaction){if(this.inAction)return;this.inAction=!0;try{this.onaction({property:e,operation:t,params:i,actionParams:n},this.$model,this)}finally{this.inAction=!1}}},h.prototype.on=function(e){this.onaction=e,this.onaction&&this.onaction({operation:"init"},this.$model,this)},h.prototype._stateChanged=function(e,t){var i,n,s=this,o=e.split("."),r=!1;d.statesAndErrors.indexOf(o[o.length-1])>=0&&(i=o.pop(),n=o.join("."),r=!0),s._rebuildListeners(),s._match(o,function(o,a,l,u){a?s._enumListener(o,function(s){s.target.stateChanged&&s.target.stateChanged(i,{targetId:s.id,property:n,origProperty:e,isState:r},t)}):l?s._enumListener(o,function(i){i.target.stateChanged&&i.target.stateChanged(null,{targetId:i.id,property:n,origProperty:e,isState:r},t)}):u&&s._enumListener(o,function(i){i.target.stateChanged&&(t.targetId=i.id,i.target.stateChanged(null,{targetId:i.id,property:n,origProperty:e,isState:r},t))})},t)},h.prototype.destroy=function(){if(this.$data=null,this.$schema=null,this._bindStates=null,this._bindTitles=null,this._bindAccordion=null,this.module=null,this.onsync=null,this.onaction=null,this._listeners={},this._parentModel=null,this._listenersByName=[],this._loadNestedControllers=null,this._parentForm&&this._parentForm.removeChildForm(this),this._childrenForms){this._childrenForms.slice().forEach(function(e){return e.form.destroy()}),this._childrenForms=null}this.$model&&(this.$model.onchange=null,this.$model.onstatechanged=null,this.$model.destroy(),this.$model=null),this.formManager&&(this.formManager.remove(this),this.formManager=null),i.prototype.destroy.call(this)},h.prototype._idComponent=function(e){if(!this.$element)return null;for(var t,i=e,n=this.$element.get(0);i;){if(!i.getAttribute)return null;if(t=i.getAttribute("data-render")){if(this.controls[t])break;t=null}i=i===n?null:i.parentNode}return t||null},h.prototype._event2FieldByElement=function(e){var t=this._idComponent(e);return t?this.controls[t]:null},h.prototype.postMessageToParent=function(e,t){var i=this;i._parentForm&&s.nextTick(function(){i._parentForm.execAction(e,t)})},h.prototype._event2Field=function(e){return this._event2FieldByElement(e.target)},h.prototype._removeBaseEvents=function(){var e=this.$element;e.off("focusin"),e.off("focusout"),e.off("click"),e.off("dblclick"),e.off("keydown"),e.off("keyup"),e.off("keypress"),e.off("mousedown"),e.off("paste"),$(window).off("global-phoenix-resize",this._resizeHnd),i.prototype._removeBaseEvents.call(this)},h.prototype._freeze=function(e){return e.preventDefault(),e.stopPropagation(),!1},h.prototype._doKeyDown=function(e){return!0},h.prototype._doKeyPress=function(t){if(this.autoClose){if(t.keyCode===a.keys.VK_ESCAPE||t.keyCode===a.keys.VK_F4)return this.autoClose.explicitClose=!0,e.pagecontrol.Page().setPopup(null),!1;t.keyCode===a.keys.VK_ENTER&&this.execAction("form-validate")}return!0},h.prototype._addBaseEvents=function(){var e=this;e.$element.on("focusin",function(t){if(e._inProcessing)return e._freeze(t);var i=e._event2Field(t);if(i&&i.focusIn){if(i.focused)return;i.focused=!0,i.focusIn(t)}}),e.$element.on("focusout",function(t){if(e._inProcessing)return e._freeze(t);var i=e._event2Field(t);if(i&&i.focusOut){var n={target:t.target};i.focusTimer&&(window.clearTimeout(i.focusTimer),i.focusTimer=0),e._setInDelayedAction(!0),i.focusTimer=s.focusDelay(function(){if(e._setInDelayedAction(!1),!i.destroyed){i.focusTimer=0;var t=window.document.activeElement;if(t){var s=e._event2FieldByElement(t);s!==i?i.focusInControl(t)&&(s=i):s===i&&(i.focusInControl(t)||(s=null)),s!==i&&(i.focusOut(n),i.focused=!1)}else i.focusOut(n),i.focused=!1}})}}),e.$element.on("dblclick",function(t){if(e._inProcessing)return e._freeze(t);var i=e._event2Field(t);i&&i.dblclick&&i.dblclick(t)}),e.$element.on("click",function(t){if(e._inProcessing)return e._freeze(t);var i=e._event2Field(t),n=t.target;if(i&&n.id===i.id+"_rules")return i.showRules(),void t.preventDefault();if(i&&i.click){if(i.stopProppagation&&i.stopProppagation(t),i.focusClick)return;if(!e._isInDelayedAction()||i.focused&&i.targetInControl(t.target))return i.click(t);e._setInDelayedAction(!0),i.focusClick=s.focusDelay(function(){e._setInDelayedAction(!1),i.destroyed||(i.focusClick=0,i.click(t))})}else if(!i){var o=t.target;if(o){if(o.getAttribute("data-error-close")){var l=a.findByAttribute(o,e.$element.get(0),"data-error");if(l)if(l.id){var u=l.id.substr(0,l.id.length-6);e.$model.$errors.$.rmvErrorById(u)}else a.remove(l),e.openErrors();return e._freeze(t)}if(o.getAttribute("data-form-detail-close"))return e.options.closeButtonHandler&&e.options.closeButtonHandler(),e._freeze(t);if(o.getAttribute("data-form-settings"))return e.options.authoringIndicator&&r.execLink({$formAuthoring:!0,path:e.options.path,name:e.options.externalLayout,schema:e.options.externalSchema,locale:e.options.externalLocale},{},null),e._freeze(t)}}var c=e._event2Layout(t);c&&c.$actionName&&e.execAction(c.$actionName)}),e.$element.on("keypress",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyDown(t)){var i=e._event2Field(t);i&&i.keypress&&i.keypress(t)}}),e.$element.on("keydown",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyPress(t)){var i=e._event2Field(t);i&&i.keydown&&i.keydown(t)}}),e.$element.on("keyup",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyDown(t)){var i=e._event2Field(t);i&&i.keyup&&i.keyup(t)}}),e.$element.on("paste",function(t){if(e._inProcessing)return e._freeze(t);var i=e._event2Field(t);i&&i.paste&&i.paste(t)}),e.$element.on("keyup",function(t){if(e._inProcessing)return e._freeze(t);var i=e._event2Field(t);i&&i.keyup&&i.keyup(t)}),e.$element.on("mousedown",function(t){if(e._inProcessing)return e._freeze(t);var i=e._event2Field(t);return!i||!i.mousedown||i.mousedown(t)}),$(window).on("global-phoenix-resize",e._resizeHnd),i.prototype._addBaseEvents.call(this)},h.prototype._resizeControls=function(e){this.currentResizeList&&this.currentResizeList.forEach(function(t){t.resize(e)})},h.prototype._resizeAndAfterRender=function(e){this.afterRenderList&&(this.afterRenderList.forEach(function(e){e.afterAddedInDom()}),this.afterRenderList=[]),this._resizeControls(e)},h.prototype.afterAddedInDom=function(){i.prototype.afterAddedInDom.call(this);var e=this;e._resizeAndAfterRender(!1),e._autofocus&&e._autofocus.setFocus&&window.setTimeout(function(){e._autofocus&&(e._autofocus.setFocus(),e._autofocus=null)},200)},h.prototype._afterVisibilityChanged=function(e){i.prototype._afterVisibilityChanged.call(this,e);e.inDom&&e.resize&&this._resizeAndAfterRender(!0)},h}(t.BaseLayout));t.Form=h,t.FormClass=h;t.removeForm=function(e){if(e){var t=null;e.$element&&(t=e.$element.get(0)),e.destroy(),t&&a.remove(t)}},t.OpenForm=null,t.OpenInlineForm=null}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.ajax,n=t.dom,s=t.utils,o=t.autoclose,r=(t.modal,t.pagecontrol),a=t.application,l=t.Observable.SchemaUtils,u=t.external,c=t.customData;!function(t){var d=function(e){__extends(i,e);function i(i,n,s,o,r,a){var l=e.call(this,i,r)||this,u=l,c=i.opts?i.opts:{};return i.validators&&(c.validators=i.validators,delete i.validators),u.render=new t.Form(n,c,o,s,r,a),u.render.$locale=r,l}return i.prototype.on=function(e){var t=this;t._clickHnd=function(e){t.render.afterchanged(e,"modal-action",{})},t.render.on(function(i,n,s){return e(t,i,n,s)})},i.prototype.onNatural=function(e){var t=this;t._clickHnd=function(e){t.render.afterchanged(e,"modal-action",{})},t.render.on(function(i,n,s){return e(i,n,s,t)})},i}(e.modal.Modal);t.ModalForm=d;function p(e){return"string"==typeof e?{message:e}:e}var h=function(e,t,n,o,r,l){var c=0,d=-1,p=-1,h=[],f={locale:o},m=-1,v=-1,g=a.config(a.name);r=r||{},o&&o.$name&&(r.externalLocale=o.$name),n&&n.then?(h.push(n),m=0,c++):f.data=$.extend(!0,{},n);var y;"object"==typeof e?(f.layout=$.extend(!0,{},e),y=f.layout.name):(d=c,c++,r.externalLayout=e,y=e,h.push(i.get(g.current.forms+"/"+e+".json"))),"object"==typeof t?f.schema=$.extend(!0,{},t):(p=c,c++,r.externalSchema=t,h.push(i.get(g.current.prototypes+"/"+t+".json")));var _=function(e,t){var i="";if(e&&a.name&&(i=a.name+"_form_"+e),i&&t&&t.current&&t.current.preferences){var n=t.current.preferences;n.excludedForms&&n.excludedForms.indexOf(i)>=0&&(i="")}return i}(y,g);_&&u.preferenceLoadHandler&&(v=c,c++,r.preferenceName=_,h.push(u.preferenceLoadHandler(_))),h.length?s.Promise.all(h).then(function(e){d>=0&&(f.layout=e[d]),p>=0&&(f.schema=e[p]),m>=0&&(f.data=e[m]),v>=0&&(f.preferences=e[v]),l(null,r,f)}).catch(function(e){l(e,null,null)}):l(null,r,f)},f=function(e,t,n,o,r,a){h(t,n,o,r,null,function(t,n,o){if(t)return console.log(t),t=(t=p(t))._ajax?i.extractAjaxErrors(t):t,e&&e.module&&e.module.error?e.module.error(t):void s.alert("",t.message,function(){});(e=e||{}).opts=n,r=e,u=o,c=a,l.loadSchemaRefs(u.schema,u.data,u.layout,null,function(e,t){if(e)return console.log(e),e=(e=p(e))._ajax?i.extractAjaxErrors(e):e,r&&r.module&&r.module.error?r.module.error(e):void s.alert("",e.message,function(){});var n=new d(r,u.layout,u.schema,t,u.locale,u.preferences);n.open(),c&&(r.natural?n.onNatural(c):n.on(c))});var r,u,c})},m=function(e,t){t.isFormController?e.beforeSetModel=t.beforeSetModel?t.beforeSetModel.bind(t):null:e.beforeSetModel=t.initObjectState?t.initObjectState.bind(t):null,e.beforeModelCreated=t.initModel?t.initModel.bind(t):null,e.onSettings=t.onSettings?t.onSettings.bind(t):null,e.storageName=t.storageName,e.validators=t.validators,e.checkFormLayout=t.checkFormLayout},v=function(e,t){if(!e.controller)throw"Controller name is empty.";var i="string"==typeof e.controller?c.get(e.controller):e.controller;if(!i)throw s.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var n={};m(n,i);var o=e.options;o.opts=n,o.parentContext=e.parentContext,o.natural=!0;var r=null;i.isFormController?r=i.modelChanged.bind(i):i.onModelChanged&&(r=i.onModelChanged.bind(i)),f(o,e.name,e.meta,t,e.locale,r)},g=function(e,t,i){if(!e.controller)throw"Controller name is empty.";var n="string"==typeof e.controller?c.get(e.controller):e.controller;if(!n)throw s.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var o={};m(o,n);var r=e.options;(r=o).natural=!0,r.parentContext=e.parentContext;var a=null;n.isFormController?a=n.modelChanged.bind(n):n.onModelChanged&&(a=n.onModelChanged.bind(n)),r.autoClose=e.autoClose,_(null,e.name,e.meta,t,null,a,r,i)},y=function(e,a,u,c,d){l.loadSchemaRefs(a.schema,a.data,a.layout,c?c.parentContext:null,function(l,h){if(l)return console.log(l),l=(l=p(l))._ajax?i.extractAjaxErrors(l):l,c&&c.module&&c.module.error?c.module.error(l):void s.alert("",l.message,function(){});a.data=h,function(e,i,s,a,l){if((a=a||{design:!1})&&a.autoClose){var u=a.autoClose,c={parent:u.parentId?n.find(null,u.parentId):null,alignElement:u.alignElementId?n.find(null,u.alignElementId):null,style:u.style,parents:u.parents,opener:u.opener,width:u.width,height:u.height,minWidth:u.minWidth,minHeight:u.minHeight,stayOnTop:u.stayOnTop,beforeClose:u.beforeClose,contentRender:function(e,n,o){try{var c=a;a.opts&&(a=a.opts||{}),c!==a&&c.parentContext&&(a.parentContext=c.parentContext,c.parentContext=null),u.showCloseButton&&(a.closeButtonHandler=function(){r.Page().setPopup(null)});var d=new t.Form(i.layout,a,i.data,i.schema,i.locale,i.preferences);d.$locale=i.locale,d.autoClose=n,d.render(e),s&&d.on(s),n.renderControl=d,o(),l&&l(d)}catch(e){o(e)}}};o.open(u.align,c)}else{var d=a;a.opts&&(a=a.opts||{}),d!==a&&d.parentContext&&(a.parentContext=d.parentContext,d.parentContext=null);var p=new t.Form(i.layout,a||{design:!1},i.data,i.schema,i.locale,i.preferences);p.$locale=i.locale,p.render(e),s&&p.on(s),l&&l(p)}}(e,a,u,c,d)})},_=function(e,t,n,o,r,a,l,u){h(t,n,o,r,l,function(t,n,o){if(t)return console.log(t),t=(t=p(t))._ajax?i.extractAjaxErrors(t):t,l&&l.module&&l.module.error?l.module.error(t):void s.alert("",t.message,function(){});n&&l&&l.parentContext&&(n.parentContext=l.parentContext),y(e,o,a,n,u)})};var b=function(){function e(){}return e.prototype.isFormController=function(){return!0},e.prototype.data=function(){return null},e.prototype.beforeSetModel=function(e,t){t&&t.hasNestedControllers()&&t.modelCreated(e),this.initObjectState(e,t)},e.prototype.initObjectState=function(e,t){},e.prototype.modelChanged=function(e,t,i,n){i.hasNestedControllers()&&i.modelChanged(e,t,i,n),this.onModelChanged(e,t,i,n)},e.prototype.onModelChanged=function(e,t,i,n){var s=e.property,o=e;if(s){this.bindProperty&&0===s.indexOf(this.bindProperty)&&(s=s.substr(this.bindProperty.length),o.property=s);s.indexOf("$links.")>=0&&(s=s.replace(/\$links\./g,""));var r="on"+(a=s,a.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("").split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(""));if(this[r])return this[r](o,t,i,n)}var a},e}();t.FormController=b,c.register("phoenix.empty.controller",{onModelChanged:function(e,t,i,n){}}),t.loadSchema=function(e){if("object"==typeof e)return s.Promise.resolve($.extend(!0,{},e));var t=a.config(a.name);return i.get(t.current.prototypes+"/"+e+".json")},t.formController2Options=m,t.OpenModalForm=f,t.showModalForm=v,t.showAutoCloseForm=g,t.OpenForm=_,t.OpenInlineForm=function(e,t,i,o,r,a,l,u){var d={name:t,meta:i,controller:o,options:{},formParent:e,locale:a};u&&s.merge(u,d.options),function(e,t,i){if(!e.controller)throw"Controller name is empty.";var o="string"==typeof e.controller?c.get(e.controller):e.controller;if(!o)throw s.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var r={};m(r,o);var a=e.options;a.opts=r,a.parentContext=e.parentContext,a.natural=!0;var l=null;if(o.isFormController?l=o.modelChanged.bind(o):o.onModelChanged&&(l=o.onModelChanged.bind(o)),!e.formParent)throw"No form parent.";var u=n.find(null,e.formParent);if(!u)throw"No form parent.";_($(u),e.name,e.meta,i,e.locale,l,a,t)}(d,l,r)},u.formOpenHandler=function(e){var t={name:e.name,meta:e.meta,controller:e.controller||"phoenix.empty.controller",options:e.options||{}};e.modal?v(t):(t.autoClose={align:o.BOTTOM_LEFT,opener:e.opener,alignElementId:e.alignElementId,style:e.style,parents:e.parents,width:e.width,height:e.height,minWidth:e.minWidth,minHeight:e.minHeight,showCloseButton:e.showCloseButton},g(t))}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){e.render,e.ui;var t=e.dom,i=e.utils,n=e.device,s=e.Observable,o=e.ulocale,r=e.locale,a=e.customData,l=s.SchemaUtils;!function(s){var u="datepicker",c="datetimepicker",d=function(e){return"center"===e?"align-center":"right"===e?"align-end":""},p=function(e,t,i,n){var s=a.get("ui.html."+i);return s?{value:s(e,t,n),html:!0}:{value:t,html:!1}},h=function(e,i,n){var s=e.avanced.icons[i]||"none",o=e.avanced.iconClass||null,r=d(e.avanced.alignIcon||"center"),a=[];s&&a.push(o?t.customIconClass(s,o):t.iconClass(s));var l=e.tableOptions&&e.tableOptions.small?"small-table":"",u=["bs-image-cell",r];e.avanced._expandItem&&(u.push("bs-expand-parent"),a.push("bs-expand-child")),l&&u.push(l);var c=['<div class="'+u.join(" ")+'"'];return e.avanced._clickable&&c.push(' data-clickable="true"'),e.avanced._expandItem&&(e.level&&c.push(' style="margin-left:'+.5*e.level+'em;"'),a.push("bs-expand-space"),e.avanced._expandItemClass&&a.push(e.avanced._expandItemClass)),e.display||a.push("bs-image-size"),c.push('><span class="'+a.join(" ")+'"></span>'),e.avanced._expandItem&&e.display&&e.display.value&&(c.push('<span class="bs-expand-child">'),c.push(" "),c.push(e.display.value),c.push("</span>")),c.push("</div>"),{value:c.join(""),html:!0}},f={useDatePicker:function(){return!f.nativeDate()&&null!=$.fn[u]},useDateTimePicker:function(){return null!=$.fn[c]},nativeDate:function(){var e=!1,t=!1;return function(){if(t)return e;if(t=!0,n.phone||n.tablet){var i=document.createElement("input");return i.setAttribute("type","date"),e="date"===i.type}return!1}}(),nativeNumber:function(){var e=!1,t=!1;return function(){if(t)return e;if(t=!0,n.phone||n.tablet){var i=document.createElement("input");return i.setAttribute("type","number"),e="number"===i.type}return!1}}(),addErrorDiv:function(t,i){e.bootstrap4?t.push('<div class="invalid-feedback bs-none'+(i?" no-y-margin":"")+'" id="{0}_errors"></div>'):t.push('<div class="small text-danger bs-none" id="{0}_errors"></div>')},keyPressPassword:function(e,i,n){return e.which!==t.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressDate:function(e,t,i){return!0},keyPressCode:function(e,i,n){return e.keyCode!==t.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressNumber:function(e,i,n){var s="-0123456789,."+n.decimalSep,o=e.keyCode;if(!e.metaKey&&t.ignoreKeys.indexOf(o)<0){var r=String.fromCharCode(o);if(s.indexOf(r)<0)return e.preventDefault(),!1}return!0},doPasteDate:function(e,t,i){return!0},doPasteCode:function(e,t,i){return!0},doPasteNumber:function(e,t,i){return!0},doPastePassword:function(e,t,i){return!0},keyDownDate:function(e,t,i){return!0},keyDownCode:function(e,t,i){return!0},keyDownNumber:function(e,t,i){return!0},keyDownPassword:function(e,t,i){return!0},addContainerId:function(e,t){t&&e.push(' draggable="true"'),e.push(' data-render="{0}"'),e.push(' id="{0}"')},containerBaseClass:function(e,t,i){var n=[e,i.groupFieldClass||"bs-field-group","bs-island"];return i.noVerticalMargins&&!t&&n.pop(),i.inline&&n.push(i.inlineFieldClass||"bs-field-inline"),t&&n.push(" design"),n.join(" ")},align2Css:d,fieldWrapper:function(t,i,n,s,o){var r=e.bootstrap4;i.inline&&(i.columns=!1);var a=o&&o.formGroup?o.formGroup:"form-group",l=[f.containerBaseClass(a,n,i)],u=o&&o.tag?o.tag:"div";t.push("<"+u+' class="'),i.size&&l.push((r?"form-control":"form-group-")+i.size),i.columns&&(r||l.push("form-horizontal"),l.push("row")),i.styles&&l.push(i.styles),i.right&&l.push(" float-right"),t.push(l.join(" ")),t.push('"'),f.addContainerId(t,n),t.push(">"),s(),t.push("</"+u+">")},fillSelect:function(e,i,n){if(i){var s=n.enumNames||n.enum,o=n.enum;t.empty(i);var r=document.createDocumentFragment();e.forEach(function(e){var i=o.indexOf(e),n=s[i]||e+"",a=document.createElement("option");t.attr(a,"value",e),a.textContent=n,t.append(r,a)}),t.append(i,r)}},datePickerSetValue:function(e,t){e[u]("update",o.parseISODate(t||"")||"")},datePickerInitialize:function(e,i,n){t.addClass(e.get(0),"date");var s=$.extend({zIndexOffset:1e3,language:o.currentLang,autoclose:!0},i||{});e[u](s),n&&e[u]().on("hide",n)},datePickerDestroy:function(e){e[u]("destroy")},dateTimePickerSetValue:function(e,t){e[c]("date",o.parseISODate(t||"")||"")},dateTimePickerInitialize:function(e,i,n){t.addClass(e.get(0),"date");var s={icons:{time:t.iconClass("clock-o"),date:t.iconClass("calendar"),up:t.iconClass("arrow-up"),down:t.iconClass("arrow-down"),previous:t.iconClass("arrow-left"),next:t.iconClass("arrow-right"),today:t.iconClass("exclamation-circle"),clear:t.iconClass("trash"),close:t.iconClass("times")},locale:o.currentLang,showClose:!0},r=$.extend(s,i||{});e[c](r),n&&e[c]().on("hide",n)},dateTimePickerDestroy:function(e){e[c]("destroy")},text2value:function(e,t,i){if(l.isDate(t)){if(f.nativeDate())return e;var n=o.tryParseDate(e);return o.localeDate2ISO(n)}if(l.isDateTime(t)){n=o.tryParseDateTime(e);return o.localeDateTime2ISO(n)}return l.isNumber(t)?l.text2Value(e+"",t,i):e},defaultOptions:{titleIsHidden:!1,placeHolder:!1,labelCol:3},displayValue:function(e,n,s,a,u,c){var d;if(a=a||{},i.isNullOrUndefined(e))return d={value:"",html:!1};if(a.isTotal&&(l.isFwField(c)||n.enum))return d={value:"",html:!1};if(n.enum){var f=n.enum.indexOf(e),m=f>=0?n.enumNames?o.tt(n.enumNames[f],s):e:"";d=a.avanced&&a.avanced.transform?p(e,m,a.avanced.transform,u):a.avanced&&a.avanced.icons?h(a,e):{value:m,html:!1}}else switch(n.type){case"string":if(n.format)switch(n.format){case"date":m=o.shortDate(e||"");d=a.avanced&&a.avanced.transform?p(e,m,a.avanced.transform,u):{value:m,html:!1};break;case"date-time":var v=o.shortDateTime(e||"");d=a.avanced&&a.avanced.transform?p(e,v,a.avanced.transform,u):{value:v,html:!1}}d||(d=a.avanced&&a.avanced.transform?p(e,e,a.avanced.transform,u):a.avanced&&a.avanced.icons?h(a,e):e&&a.avanced&&a.avanced.multiline?{value:"<span>"+e.split("\n").map(function(e){return i.escapeHtml(e)}).join("<br/>")+"</span>",html:!0}:{value:e,html:!1});break;case"number":var g=void 0;g=a.state?o.decimal(e||0,a.state.decimals||0,a.useSymbol?a.state.symbol||"":""):"money"===n.format?o.money(e||0,a.useSymbol):o.decimal(e||0,n.decimals||0,a.useSymbol?n.symbol:""),d=a.avanced&&a.avanced.transform?p(e,g,a.avanced.transform,u):a.avanced&&a.avanced.icons?h(a,e):{value:g,html:!1};break;case"integer":var y=o.integer(e);d=a.avanced&&a.avanced.transform?p(e,y,a.avanced.transform,u):a.avanced&&a.avanced.icons?h(a,e):{value:y,html:!1};break;case"boolean":if(a.isTotal)return d={value:"",html:!1};if(a.avanced&&a.avanced.transform)d=p(e,e?r.ui.Yes:r.ui.No,a.avanced.transform,u);else if(a.html){var _=[];if(a.avanced&&a.avanced.editable||a.editable||a.check||a.avanced&&a.avanced.icons){var $=a.tableOptions&&a.tableOptions.small?" small-table":"",b=a.avanced?a.avanced.icons:null;b||(b={true:"check-square-o",false:"square-o"});var x=b[!!e+""],C=["bs-bool-edit","bs-image-size"];x&&C.push(t.iconClass(x)),_.push('<center class="bs-image-cell'+$+'"><span data-clickable="true" class="'+C.join(" ")+'"></span>&nbsp;</center>'),d={value:_.join(""),html:!0}}else d={value:e?r.ui.Yes:r.ui.No,html:!1}}else d={value:e?r.ui.Yes:r.ui.No,html:!1}}if(d||(d={value:e,html:!1}),a.html&&a.avanced&&a.avanced.$link){var k=['<a href="#" class="bs-cursor-p" data-phoenix-href="link://$link">'];k.push(d.value),k.push("</a>"),d.value=k.join(""),d.html=!0}return d},addTooltipAndRule:function(e,i){i.description&&(e.push('<span id="{0}_tooltip" data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title="'+i.description+'" class="'+t.iconClass("question-circle")+" bs-tooltip-icon"),e.push('"></span>')),i.rules&&(e.push('<span id="{0}_rules"  class="'+t.iconClass("bolt")+" bs-rules"),e.push('"></span>'))}};if(f.useDatePicker()){var m=function(t){var i=$.fn[u];e.bootstrap4&&(i.DPGlobal.template=i.DPGlobal.template.replace(/\"table-condensed\"/g,'"table-sm"')),i.dates[t]={days:r.date.weekdays,daysShort:r.date.weekdaysShort,daysMin:r.date.weekdaysMin,months:r.date.months,monthsShort:r.date.monthsShort,today:r.date.today,clear:r.date.clear,format:r.date.dateShort.replace(/\//g,r.date.daySep),titleFormat:"MM yyyy",weekStart:r.date.weekStart}};t.readyHandlers.push(function(){m(o.currentLang)}),o.register(m)}if(f.useDateTimePicker()){m=function(t){var i=window.moment;i&&i.updateLocale(t,{months:r.date.months,monthsShort:r.date.monthsShort,weekdays:r.date.weekdays,weekdaysShort:r.date.weekdaysShort,weekdaysMin:r.date.weekdaysMin,longDateFormat:{LT:e.locale.date.shortTime.replace(/M/g,"m").replace(/S/g,"s"),L:r.date.dateShort.replace(/\//g,r.date.daySep).toUpperCase()},week:{dow:r.date.weekStart}})};t.readyHandlers.push(function(){m(o.currentLang)}),o.register(m)}s.utils=f}(e.uiutils||(e.uiutils={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils,i=(e.uiutils,e.Observable),n=e.dom,s=e.external,o=e.customData,r=i.SchemaUtils;!function(i){var a=function(){function i(e,t,i){this._isBinded=!0,this.config=e,this.form=i,this.options=t||{},e.options=e.options||{},this.parent=this.form.getLayoutById(e.$parentId),this.$bind=e.$bind,"$none"===this.$bind&&(this._isBinded=!1,this._internalValue=e.options.value,this._internalState=e.options.state||{}),e.$name&&(this.name=e.$name),this.$display=this.config.$display||this.$bind,e.$lookup&&(this.useDisplay=this.$display!==this.$bind,this.$lookup=this.form.getLookupForSchema(this.$bind,e.$lookup));r.isMeta(this.$bind)&&(this.$bind=this.getCustomBind()),this._isBinded&&this.$bind&&i.registerListenerFor(this.$bind,this),this._isBinded&&this.useDisplay&&i.registerListenerFor(this.$display,this),this._defineProps(),this.fieldOptions=e.options||{},this.renderOptions=this.fieldOptions,this.$schema=this._isBinded&&this.$bind?i.getSchema(this.$bind):{},this.$schema&&"array"===this.$schema.type&&(this.$schemaItems=r.expand$Ref(this.$schema.items,this.form.$rootSchema)),this.id=e.$id,this.title=this.fieldOptions.title?this.fieldOptions.title:this.$schema?this.$schema.title:this.$bind}return i.prototype.hide=function(e){this._isBinded&&(this._internalState.isHidden=!0,this.stateChanged&&this.stateChanged("isHidden",{}))},i.prototype.setInternalValue=function(e,t){if(!this._isBinded&&this._internalValue!==e){var i=this._internalValue;this._internalValue=e,this.changed&&this.changed("",i,e,"propchange"),this.fieldOptions.onChange&&this.fieldOptions.onChange()}},i.prototype.getInternalValue=function(){return this._internalValue},i.prototype.getSettingsName=function(e){var t=[this.$bind,e];return this.name&&t.push(this.name),t.join("_")},i.prototype.targetInControl=function(e){if(this.$element){var t=this.$element.get(0);return n.isChildOf(t,e)}return!1},i.prototype.focusInControl=function(e){if(this.$element){var t=this.$element.get(0);return n.isChildOf(t,e)}return!1},i.prototype.setParentId=function(e){},i.prototype.isMeta=function(){return!1},i.prototype.beforeSaveSettings=function(){return!1},i.prototype.savePreferences=function(e){if(this._isBinded)return this.form.supportSettings()?void(this.beforeSaveSettings()&&this.form.savePrefs(e)):e()},i.prototype.getCustomBind=function(){return""},i.prototype.getBind=function(){var e=[];return this.$bind&&e.push(this.$bind),e},i.prototype.setHidden=function(e){e&&(this.state.isHidden?n.addClass(e,"bs-none"):n.removeClass(e,"bs-none"))},i.prototype._state=function(){var e=this;e.state=e.state||{};var t;e._isBinded?(t=e.form.getState(e.$bind),e.state.value=e.form.getValue(e.$bind)):(t=e._internalState,e.state.value=e._internalValue),Object.keys(t).forEach(function(i){e.state[i]=t[i]})},i.prototype._defineProps=function(){},i.prototype.render=function(e){},i.prototype.appendElement=function(e,t){e&&(this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},i.prototype.setEvents=function(e){},i.prototype.removeEvents=function(){},i.prototype.customOptions=function(e){if(this._isBinded&&t.showRules()){var i=this.form.$rootSchema,n=this.form.$schema;this.getBind().forEach(function(t){var s=r.getSchema(r.parentPath(t),n,i,!0),o=r.lastSegment(t,null);s&&s.name&&(n.rules&&n.rules.validation&&n.rules.validation[s.name]&&n.rules.validation[s.name][o]?e.rules=!0:n.rules&&n.rules.propagation&&n.rules.propagation[s.name]&&n.rules.propagation[s.name][o]&&(e.rules=!0))})}},i.prototype.showRules=function(){if(this._isBinded){var e=this.form.$rootSchema,t=[],i=this.form.$schema;this.getBind().forEach(function(n){var s=r.getSchema(r.parentPath(n),i,e,!0),o=r.lastSegment(n,null);s&&s.name&&(i.rules&&i.rules.validation&&i.rules.validation[s.name]&&i.rules.validation[s.name][o]&&t.push(i.rulesMap[i.rules.validation[s.name][o]]),i.rules&&i.rules.propagation&&i.rules.propagation[s.name]&&i.rules.propagation[s.name][o]&&t.push(i.rulesMap[i.rules.propagation[s.name][o]]))}),s.ruleViewer&&s.ruleViewer(t)}},i.prototype._initOptions=function(e){var t={};this.parent&&this.parent.$fieldsOptions&&(this.parent.$fieldsOptions.columns&&(void 0===t.columns&&(t.columns=this.parent.$fieldsOptions.columns),void 0===t.labelCol&&this.parent.$fieldsOptions.labelCol&&(t.labelCol=this.parent.$fieldsOptions.labelCol)),this.parent.$fieldsOptions.titleIsHidden&&void 0===t.titleIsHidden&&(t.titleIsHidden=!0));var i=$.extend({},e,t,this.fieldOptions);return this.parent&&this.parent.$inline&&(i.inline=!0),this.customOptions(i),this.renderOptions=i,i},i.prototype.destroy=function(){this.focusTimer&&(window.clearTimeout(this.focusTimer),this.focusTimer=0),this.$element&&(this.removeEvents(),this.$element=null),this.destroyed=!0,this.$schema=null,this.parent=null,this._isBinded&&(this.$bind&&this.form.unRegisterListenerFor(this.$bind,this),this.useDisplay&&this.form.unRegisterListenerFor(this.$display,this))},i.prototype.showErrors=function(t,i){var s=i&&i.length,o=n.find(t,this.id+"_errors");if(o)if(s){var r=i[0].message;this.renderOptions.inline&&e.bootstrap4&&(r="  ("+r+")"),n.text(o,r),n.removeClass(o,"bs-none")}else n.addClass(o,"bs-none")},i}();i.AbsField=a,i.registerControl=function(e,t,i,n,s){i=i||!1,n=n||"",i&&(t="*");var r=(s=s||{}).lookup||!1,a=s.format||"";s.readOnly?o.register("ui-controls-readonly-"+n+"-"+a,e):o.register("ui-controls-"+t+"-"+i+"-"+r+"-"+n+"-"+a,e)},i.getRegisteredControl=function(e,t,i,n,s){(t=t||!1)&&(e="*"),i=i||"",n=n||"";var r=!(!s||!s.lookup);if(s&&s.readOnly)return!(a=o.get("ui-controls-readonly-"+i+"-"+n))&&n&&(a=o.get("ui-controls-readonly-"+i+"-")),a;var a;return!(a=o.get("ui-controls-"+e+"-"+t+"-"+r+"-"+i+"-"+n))&&n&&(a=o.get("ui-controls-"+e+"-"+t+"-"+r+"-"+i+"-")),a},i.registerLinkControl=function(e,t){t=t||"button",o.register("ui-control-links-"+t,e)},i.getRegisteredLinkControl=function(e){return e=e||"button",o.get("ui-control-links-"+e)},i.filterManagerFactory=null}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){var t,i=e,n=i.utils,s=i.dom,o=i.ui,r=i.uiutils;!function(t){var i=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s}return t.prototype._setDisabled=function(e,t){},t.prototype._setReadOnly=function(e,t){},t.prototype._setMandatory=function(e,t){},t.prototype._label=function(){return this.$element?s.find(this.$element.get(0),this.id+"_alert"):null},t.prototype._state2UI=function(){var e=this._label(),t=this.$element?this.$element.get(0):null;e&&(s.text(e,this.state.value||""),this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setMandatory(e,t))},t.prototype.changed=function(e,t,i,n){var o=this._label();this.state.value!=i&&(this.state.value=i,o&&s.text(o,this.state.value||""))},t.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this._label(),s=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(s)),i.isDisabled!==this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n,s)),i.isReadOnly!==this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,n&&this._setReadOnly(n,s)),i.isMandatory!==this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,n&&this._setMandatory(n,s))},t.prototype.render=function(e){var t=this._initOptions(r.utils.defaultOptions);return this.$element||(this.$element=$(function(e,t,i){(t=$.extend({columns:!1},t)).columns=!1;var s=[];return r.utils.fieldWrapper(s,t,i,function(){s.push('<div id="{0}_alert" class="alert alert-'+(t.type||"danger")+'" role="alert">'),s.push("</div>")}),n.format(s.join(""),e)}(this.id,t,this.options.design)),this._state2UI()),this.appendElement(e,t),this.$element},t}(e.ui.AbsField);t.Alert=i,o.registerControl(i,"string",!1,"alert",null)}(t||(t={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils,i=e.dom,n=e.ui,s=e.uiutils;!function(o){var r=function(e){__extends(n,e);function n(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s}return n.prototype.click=function(e){},n.prototype._setDisabled=function(e){},n.prototype._setReadOnly=function(e){},n.prototype._setMandatory=function(e){},n.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&this.renderContent(e)},n.prototype.renderContent=function(e){var t="";void 0!=this.state.value&&(t=JSON.stringify(this.state.value.model(!0),null,2)),i.append(e,$("<pre>"+t+"</pre>").get(0))},n.prototype.changed=function(e,t,i,n){this.state.value=this.form.getValue(this.$bind),this._state2UI()},n.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,this.setHidden(n)),i.isDisabled!==this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,this._setDisabled(n)),i.isReadOnly!==this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,this._setReadOnly(n)),i.isMandatory!==this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,this._setMandatory(n))},n.prototype.render=function(e){var n=this._initOptions(s.utils.defaultOptions);return this.$element||(this.$element=$(function(e,n,o){n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var r=[];if(o)s.utils.fieldWrapper(r,n,o,function(){});else{var a=[];n.style&&i.parseStyle(n.style,a),r.push("<div"),a.length&&r.push(' class= "'+a.join(" ")+'"'),s.utils.addContainerId(r,o),r.push("/></div>")}return t.format(r.join(""),e)}(this.id,n,this.options.design)),this._state2UI(),this.setEvents(n)),this.appendElement(e,n),this.$element},n}(e.ui.AbsField);o.ComplexBase=r,n.registerControl(r,"object",!1,"objectjson",null),n.registerControl(r,"array",!1,"objectjson",null)}(e.formcomplex||(e.formcomplex={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.customData,s=(i.formcomplex,i.ui),o=i.utils,r=i.dom,a=(i.link,function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t.prototype.customOptions=function(t){if(e.prototype.customOptions.call(this,t),!t.item||!t.item.render)throw'Item render is null. Use options: { item : {render: "my_item_render"}} ';if(this._render=n.get(t.item.render),!this._render)throw"Item render isn't registered. Use customData.register(\""+t.item.render+'", controller);'},t.prototype._renderContentElement=function(e,t,i){void 0===i&&(i=!1);var n,s=[];if("scroll"===this._layout&&s.push(this._id+"_inScroll"),"grid"===this._layout||"column"===this._layout){var o=t%this._columns;if(0===o&&"grid"===this._layout||0===t&&"column"===this._layout){this._row=$('<div class="row"></div>').get(0);for(var a=Math.floor(12/this._columns),l=0;l<this._columns;l++)r.append(this._row,$('<div class="col-sm-'+a+'"></div>').get(0));r.append(this._cp,this._row)}n=this._row.childNodes[o]}else n=this._cp,s.push("bs-inline-block bs-va-top");this.renderOptions.item.style&&r.parseStyle(this.renderOptions.item.style,s);var u=$('<div class="'+s.join(" ")+'"></div>').get(0);i?this._parentItemAddedInDom=u:!e&&this._render.lastRender?this._render.lastRender(u,e,this._id):this._render.render(u,e,this._map,this.state.value.get(t)),r.append(n,u)},t.prototype.beforeRenderContent=function(){this._render&&this._render.beforeRenderContent&&this._render.beforeRenderContent(this)},t.prototype.renderContent=function(e){var t=this;r.empty(e),t._parent=e,t._id=o.allocID(),t._map={},t._layout="inline",t.renderOptions&&t.renderOptions.layout&&(t._layout=t.renderOptions.layout.type),t._cp=document.createDocumentFragment(),"grid"!==t._layout&&"column"!==t._layout||(t._columns=Math.max(Math.min(t.renderOptions.layout.columns||4,12),1));var i=t.state.value.model(!0);if(t._localModel=i,t.beforeRenderContent(),i&&i.forEach(function(e,i){t._renderContentElement(e,i)}),t._render.lastRender&&t._renderContentElement(null,i&&i.length),t._renderContentElement(null,i&&i.length+1,!0),"grid"!==t._layout&&"column"!==t._layout||r.hasClass(e,"container-fluid")||r.addClass(e,"container-fluid"),"scroll"===t._layout){var n=$(o.format('<div id="{0}_overflow" class="array-control-overflow">',t._id)).get(0);r.append(n,$(o.format('<div id="{0}_left" class="{0}_move array-control-move array-control-goLeft"><span class="{1}"></span></div>',t._id,r.iconClass("chevron-left"))).get(0)),r.append(n,$(o.format('<div id="{0}_right" class="{0}_move array-control-move array-control-goRight"><span class="{1}"></span></div>',t._id,r.iconClass("chevron-right"))).get(0));var s=$(o.format('<div id="{0}_container"></div>',t._id)).get(0);r.append(n,s),r.append(s,t._cp),r.append(e,n)}else r.append(e,t._cp)},t.prototype.destroy=function(){this._map=null,this._render=null,e.prototype.destroy.call(this)},t.prototype.setEvents=function(e){this._render.setEvents&&this._render.setEvents(e)},t.prototype.removeEvents=function(){this._render.removeEvents&&this._render.removeEvents()},t.prototype.click=function(e){this._render.click&&this._render.click(this.$element.get(0),e,this._map,this.state.value,this.form)},t.prototype.afterAddedInDom=function(){this._render.afterAddedInDomRender&&this._render.afterAddedInDomRender(this._parentItemAddedInDom,this._id)},t.prototype.resize=function(){var e=this,t=0,i=0,n=0;if("scroll"===e._layout){e._nOverflow=$(o.format("#{0}_overflow",e._id)),e._nCtrlLeft=$(o.format("#{0}_left",e._id)),e._nCtrlRight=$(o.format("#{0}_right",e._id)),e._nContainer=$(o.format("#{0}_container",e._id)),e._nInScroll=$(o.format(".{0}_inScroll",e._id)),e._nCtrls=$(o.format(".{0}_move",e._id)),e._nInScroll.each(function(){t+=$(this).outerWidth(),$(this).height()>i&&(i=$(this).height()),$(this).outerWidth()>n&&(n=$(this).outerWidth())}),t=Math.round(t),i=Math.round(i),e._nContainer.css("width",t+"px"),e._nContainer.css("height",i+10+"px");var s=e._nCtrls.height();e._nCtrls.css("padding-top",Math.round(i/2-s/2)),e._nCtrls.css("padding-bottom",Math.round(i/2-s/2));e._nCtrlLeft.css("padding-left",10),e._nCtrlLeft.css("padding-right",20),e._nCtrlRight.css("padding-left",20),e._nCtrlRight.css("padding-right",10),e._nCtrlRight.css("left",Math.round(e._nOverflow.outerWidth()-(30+e._nCtrls.width()+3))),e._setMoveCtrls(),e._moveDelta=0,e._nCtrlLeft.mouseenter(function(){e._moveDelta=-5,e._activeMove()}),e._nCtrlLeft.mouseleave(function(){e._moveDelta=0}),e._nCtrlRight.mouseenter(function(){e._moveDelta=5,e._activeMove()}),e._nCtrlRight.mouseleave(function(){e._moveDelta=0})}e._render.afterResize&&e._render.afterResize(e._id,e.state.value,e.form)},t.prototype.changed=function(t,i,n,s){e.prototype.changed.call(this,t,i,n,s);var o=this;setTimeout(function(){o.afterAddedInDom(),o.resize()},50)},t.prototype._activeMove=function(){var e=this;0==e._moveDelta?e._moving=!1:e._moving||(setTimeout(function(){e._move(e)},10),e._moving=!0)},t.prototype._setMoveCtrls=function(){var e=this._nOverflow.scrollLeft();this._nCtrlLeft.css("display","block"),this._nCtrlRight.css("display","block"),0==e&&this._nCtrlLeft.css("display","none"),e+this._nOverflow.outerWidth()+1>this._nContainer.outerWidth()&&this._nCtrlRight.css("display","none")},t.prototype._move=function(e){var t=e,i=t._nOverflow.scrollLeft();t._nOverflow.scrollLeft(i+t._moveDelta),t._moving=!1,t._activeMove(),t._setMoveCtrls()},t}(e.formcomplex.ComplexBase));t.ArrayControl=a,s.registerControl(a,"array",!1,"array-control",null)}(e.formarray||(e.formarray={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.utils,n=e.dom,s=(e.ui,e.uiutils),o=e.ulocale,r=e.Observable.SchemaUtils,a=function(e,t){var i=n.icon(t?"caret-up":"caret-down");n.addClass(i,"bs-basictable-sort"),n.attr(i,"sort","true"),n.append(e.firstElementChild,i)},l=function(e){var t=e.lastElementChild?e.firstElementChild.lastElementChild:null;t&&"true"===n.attr(t,"sort")&&n.remove(t)},u=function(e){if("number"==typeof e)return!0;if("string"==typeof e){var t=parseInt(e,10)+"";if(t===e.trim())return!0;if(t+"px"===e.trim())return!0}return!1},c=function(e){return"number"==typeof e?e+"px":parseInt(e,10)+""===e.trim()?e.trim()+"px":e},d=function(e,t,i,o,r,a,l,u){var c=document.createElement("tr");return"middle"===a.align&&n.addClass(c,"bs-va-middle"),r.forEach(function(e,r){var l=document.createElement("td");if(0==r)n.append(l,document.createTextNode(i.schema.title||String.fromCharCode(160)));else{n.attr(l,"rowId",e.id),n.attr(l,"colId",i.name),l.rowIndex=t,l.colIndex=r-1;var d=o.get(r-1),p=s.utils.displayValue(d.getRelativeValue(i.name),i.schema,u,{html:!0,useSymbol:!0,editable:i.canEdit,check:i.check,avanced:null,tableOptions:a,state:null},d,i.name);if(p.html){var h=$(p.value);n.append(l,h.get(0))}else n.append(l,document.createTextNode(p.value))}n.append(c,l)}),c},p=function(t,i,o,a,l,u,d,p,h,f,m,v){e.bootstrap4;var g=document.createElement("tr");g.id=a.$id+(f?"_frozen":"");var y=["bs-table-row"];if("middle"===u.align&&y.push("bs-va-middle"),u.bindStatus){var _=a[u.bindStatus];_&&y.push("table-"+_)}if(!m&&a.$select&&u.selecting&&u.selecting.row&&(u.noRowSelectedIndicator||y.push("bs-row-selected")),o&&y.push("bs-row-level-"+o),g.className=y.join(" "),!u._useStripedCss&&u.striped){i%2==1||n.addClass(g,"even")}return l.forEach(function(e,t){var d=document.createElement("td");if(v)if(0===t)e=v.columnField?l.find(function(e){return e.$bind===v.columnField}):null,d.colSpan=v.colspan;else if(t<v.colspan)return;var h=!1;if(e){0===i&&u.headerIsHidden&&!u._useColGrp&&(e.options.width&&(d.style.width=c(e.options.width)),e.options.minWidth&&(d.style.minWidth=c(e.options.minWidth)));var f=[];e.options._expandItem&&f.push("bs-cursor-d");var y=a.getRelativeState(e.$bind);y.style&&n.parseStyle(y.style,f);var _=e.options.align;if(e.schema){var b=r.isNumber(e.schema),x=r.isDate(e.schema)||r.isDateTime(e.schema);u._nowrap||!b&&!x||f.push("nowrap"),_||(b?_="right":x&&(_="center"))}if(_&&f.push(s.utils.align2Css(_)),e.isLink&&!m&&e.options.button&&f.push("bs-td-button"),!m&&u.editing&&(!y.isHidden&&y.isReadOnly||y.isDisabled||!1===e.options.editing||!1===e.options.selecting)&&f.push("bs-td-readonly"),f.length&&(d.className=f.join(" ")),n.attr(d,"colId",e.$bind),y.isHidden)h=!0;else if(e.isLink){if(!m){var C=void 0,k=void 0;if(e.options.button){var w="";(C=document.createElement("button")).type="button",y.isDisabled&&(C.disabled=!0);var E=e.options.size||"sm",O="normal"===E?"":" btn-"+E,S=e.options.type||"link";if(S=n.bootstrapStyles(e.options.outline)[S],C.className="bs-button btn btn-"+S+O+(y.isDisabled?" disabled":""),e.options.icon&&((k=document.createElement("span")).className=n.iconClass(e.options.icon),n.append(C,k),w=" "),e.schema.title)if(e.options.titleIsHidden)C.title=e.schema.title;else{var P=document.createTextNode(w+e.schema.title);n.append(C,P)}}else if(e.options.icon){C=document.createElement("center"),y.isDisabled&&n.addClass(C,"bs-disabled"),k=document.createElement("span");var I=["text-"+(e.options.type||"default")];I.push("bs-basictable-btn"),I.push(n.iconClass(e.options.icon)),k.className=I.join(" "),n.append(C,k)}else h=!0;C&&(C.$link=e.$bind,n.append(d,C))}}else{var D=d,M=e.options||{},T=(u.editing||r.isSelectField(e.$bind))&&!y.isDisabled&&!y.isReadOnly&&!y.isHidden;if(!y.isHidden){var L=null;M.display&&M.displaySchema&&(L=s.utils.displayValue(a.getRelativeValue(M.display),M.displaySchema,p,{tableOptions:u,avanced:M.displayOptions||{},state:a.getRelativeState(M.display)},a,M.display));var F=s.utils.displayValue(a.getRelativeValue(e.$bind),e.schema,p,{html:!0,useSymbol:!1,selectable:!y.isDisabled,editable:T,isTotal:m,check:u.editing,avanced:M,tableOptions:u,display:L,level:o,state:y},a,e.$bind);if(F.html){var N=$(F.value);n.append(D,N.get(0))}else""===F.value?h=!0:n.append(D,document.createTextNode(F.value))}}}else h=!0;h&&n.append(d,document.createTextNode(String.fromCharCode(160))),n.append(g,d)}),g},h=function(e,t,i,n,s){var o=t.scrolling&&t.scrolling.vertical,r=function(e,t,i,n){var s=e.scrolling&&e.scrolling.vertical,o=["table","bs-control"];return s&&o.push("scrolling"),(t||n)&&(o.push("table-header"),n?o.push("footer"):o.push("header"),n&&e.total&&e.total.light&&o.push("light")),!t&&!n&&e._useStripedCss&&e.striped&&o.push("table-striped"),e._useColGrp&&o.push("bs-fixed"),t||n||!e.editing&&!e.nowrap?t||n||!e.allowFrozenColumns||(o.push("nowrap"),e._nowrap=!0):(o.push("nowrap"),e._nowrap=!0),e.allowFrozenColumns&&!e.headerIsHidden&&(t?o.push("headernowrap"):s||o.push("headernowrap")),o.push("bs-theme"),e.border&&o.push("table-bordered"),e.small&&o.push("bs-style-small-table"),o}(t,i,0,s);e.push("<table"),r.length&&e.push(' class="'+r.join(" ")+'"'),e.push(' id="{0}_table'),n&&e.push("_frozen"),i&&e.push("_header"),s&&e.push("_footer"),e.push('"');var a=function(e,t,i,n){var s=[];return i?s:(e.width&&"auto"!==e.width&&s.push("min-width: "+c(e.width)),s)}(t,0,n);a.length&&e.push(' style="'+a.join(";")+'"'),e.push(">"),t._useColGrp&&e.push('<colgroup id="{0}_colgrp'+(n?"_frozen":"")+(i?"_header":"")+(s?"_footer":"")+'"></colgroup>'),i?t.headerIsHidden||e.push('<thead><tr class="bs-va-middle" id="{0}'+(n?"_frozen":"")+'_cols"></tr></thead>'):o||(t.headerIsHidden||e.push('<thead><tr class="bs-va-middle" id="{0}'+(n?"_frozen":"")+'_cols"></tr></thead>'),t.total&&t.total.property&&e.push('<tfoot id="{0}'+(n?"_frozen":"")+'_totals"></tfoot>')),s&&t.total&&t.total.property&&e.push('<tfoot id="{0}'+(n?"_frozen":"")+'_totals"></tfoot>'),i||s||(e.push('<tbody id="{0}'),n&&e.push("_frozen"),e.push('_rows"></tbody>')),e.push("</table>")},f=function(e){var t=0;return e.forEach(function(e){t+=parseInt(e.options.width+"",10)}),t},m=function(t,i,s){var o=n.find(s,i+"_close_ms");t?(n.addClass(s,"minimized"),o&&(n.removeClass(o,e.dom.iconClass("window-minimize",!0)),n.addClass(o,e.dom.iconClass("window-maximize",!0)))):(n.removeClass(s,"minimized"),o&&(n.removeClass(o,e.dom.iconClass("window-maximize",!0)),n.addClass(o,e.dom.iconClass("window-minimize",!0))))},v=function(e,t,i){var n=t.offsetHeight-(i?3:1);e.style.height=Math.floor(n)+"px"},g={createCols:function(e,t,i,l,d,p,h){var f=document.createDocumentFragment(),m=(p||"").split(" ");return t.forEach(function(e,t){var l,h=document.createElement("th");n.attr(h,"colId",e.$bind),n.attr(h,"data-drag","move"),i._useColGrp||(e.options.width&&(h.style.width=c(e.options.width)),e.options.minWidth&&(h.style.minWidth=c(e.options.minWidth))),l&&(h.className=l.join(" "));var v=document.createElement("div"),g=["bs-column-header"];i.header&&i.header.align&&g.push(i.header.align),v.className=g.join(" ");var y=v;if(i.headerLines&&(console.log("headerLines is obsolete. use instead header.rows"),i.header=i.header={},i.header.rows=i.headerLines),i.header&&i.header.rows&&i.header.rows>1){var _=document.createElement("div");g=["bs-header-rows-parent row-"+i.header.rows],_.className=g.join(" "),g=["bs-header-rows"],(y=document.createElement("div")).className=g.join(" "),_.appendChild(y),v.appendChild(_)}if(i.selecting&&i.selecting.multiselect&&i.selecting.selectAll&&r.isSelectField(e.$bind)){var b=s.utils.displayValue(!1,e.schema,d,{html:!0,selectable:!0,editable:!0,isTotal:!1,check:!0,avanced:e.options||{},tableOptions:i,state:{}},null,e.$bind);if(b.html){var x=$(b.value);n.append(y,x.get(0))}else n.append(y,document.createTextNode(b.value))}else n.append(y,document.createTextNode(o.tt((e.isLink&&!e.options.titleIsHidden?"":e.title)||String.fromCharCode(160),d)));if(i.allowColumnResize&&u(e.options.width)){var C=document.createElement("div");C.className="bs-col-resize",n.attr(C,"data-drag","resize"),n.attr(h,"colId",e.$bind),n.append(v,C)}if(n.append(h,v),i.sorting){var k=e.options.display?e.options.displaySchema:e.schema,w=e.options.display?e.options.display:e.$bind;k&&r.canSort(k)&&((l=l||[]).push("bs-cursor-p"),m&&m.length&&m[0]===w&&a(h,1===p.length))}l&&(h.className=l.join(" ")),n.append(f,h)}),f},createColGroup:function(e,t,i){var s=document.createDocumentFragment();return e.forEach(function(e){var t=document.createElement("col");n.attr(t,"colid",e.$bind),e.options.width&&(t.style.width=c(e.options.width)),e.options.minWidth&&(t.style.minWidth=c(e.options.minWidth)),n.append(s,t)}),s},updSorting:function(e,t,i,s){if(e.sorting&&t&&t.childElementCount){var o=(s||"").split(" ");o.length||(o=[""]);for(var r=0,u=t.children.length;r<u;r++){var c=t.children[r],d=n.attr(c,"colId"),p=i(d);d=p&&p.options&&p.options.display?p.options.display:d,o[0]===d?(l(c),a(c,1==o.length)):l(c)}}},gridContainer:function(e,t,o,r,a,l,u){r=r||"",t._useColGrp=function(e,t){for(var i=!0,n=0,s=t.length;n<s;n++){var o=t[n];if(!o.options.width||o.options.minWidth){i=!1;break}}if(!(i=i&&"auto"!==e.width)){if(e.scrolling&&e.scrolling.vertical)throw"To support scrolling vertical, all columns must have explicit widths but not explicit minWidth.";if(e.editing)throw"To support inline editing, all columns must have explicit widths but not explicit minWidth."}return i}(t,l),t._useStripedCss=!(t.rows&&t.rows.detail)&&t.striped,void 0!==(t=$.extend({right:!1,icon:null,type:"default",width:"auto",height:"auto",size:null,scrolling:{horizontal:!1}},t)).title&&(r=t.title);var c=[],d=["bs-field-group bs-tab-font bs-island"];t.noVerticalMargins&&!t.design&&d.pop(),c.push('<div id="{0}" '),c.push(' class="'),o&&d.push("design"),c.push(d.join(" ")),c.push('"'),m=c,(p=o)&&m.push(' draggable="true"'),p&&m.push(' data-render="{0}"');var p,m;c.push(">"),c.push('<div id="{0}_header"></div>'),d=["bs-basictable-group"];var v=t.scrolling&&t.scrolling.horizontal,g=t.scrolling&&t.scrolling.vertical;if((g||t.allowFrozenColumns)&&d.push("border"),v&&!g&&d.push("bs-scroll-x"),c.push('<div id="{0}_focus" class="'),c.push(d.join(" ")),c.push('"'),o||c.push(' data-render="{0}"'),t.selecting&&(t.selecting.cell||t.selecting.row)&&c.push(' tabindex="0" '),c.push(">"),t.allowFrozenColumns){c.push('<div class="bs-table-cols">');var y=f(u);if(c.push('<div id="{0}_frozen_header_parent"  class="bs-table-frozen-cols" style="width:'+y+'px;">'),g&&!t.headerIsHidden&&(c.push('<div id="{0}_table_frozen_header" class="bs-table-header header">'),h(c,t,!0,!0,!1),c.push("</div>")),d=["bs-table-content-scroll frozen"],c.push('<div  class="'+d.join(" ")+'">'),d=["bs-table-content frozen"],c.push('<div id="{0}_frozen_scroll" class="'+d.join(" ")+'"'),g){var _=[];if(t.minHeight&&_.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)_.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";_.length&&c.push(' style="'+_.join(";")+'"')}c.push(">"),c.push('<div  class="'+d.join(" ")+'">'),h(c,t,!1,!0,!1),g&&c.push('<div id="{0}_frozen_scroll_delta" class="bs-relative"></div>'),c.push("</div>"),c.push("</div>"),c.push("</div>"),g&&t.total&&t.total.property&&(c.push('<div id="{0}_table_frozen_footer" class="bs-table-header footer'+(t.total.light?" light":"")+'">'),h(c,t,!1,!0,!0),c.push("</div>")),c.push("</div>"),c.push('<div id="{0}_frozen_header_sep" class="bs-table-cols-sep'+(u.length?"":" empty")+'"></div>'),c.push('<div class="bs-table-free-cols">')}if(g&&!t.headerIsHidden&&(c.push('<div id="{0}_table_header" class="bs-table-header header" style="padding-right:'),c.push(n.scrollbar()),c.push('px;">'),c.push('<div id="{0}_table_header_content" class="bs-table-header-content">'),h(c,t,!0,!1,!1),c.push("</div></div>")),g&&c.push('<div class="bs-table-content-scroll">'),d=["bs-table-content"],g&&d.push("vscroll"),c.push('<div id="{0}_master_scroll" class="'+d.join(" ")+'"'),g){if(_=[],t.minHeight&&_.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)_.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";_.length&&c.push(' style="'+_.join(";")+'"')}return c.push(">"),h(c,t,!1,!1,!1),c.push("</div>"),g&&(c.push("</div>"),t.total&&t.total.property&&(c.push('<div id="{0}_table_footer" class="bs-table-header footer'+(t.total.light?" light":"")+'" style="padding-right:'),c.push(n.scrollbar()),c.push('px;">'),c.push('<div id="{0}_table_footer_content" class="bs-table-header-content">'),h(c,t,!1,!1,!0),c.push("</div>"),c.push("</div>"))),t.allowFrozenColumns&&(c.push("</div>"),c.push("</div>")),c.push("</div>"),c.push('<center id="{0}_pagination"></center>'),c.push('<div id="{0}_bottom"></div>'),s.utils.addErrorDiv(c),c.push("</div>"),i.format(c.join(""),e)},createRows:function(e,t,i,s,o,a,l,u,c,d,h){var f=null;if(d||h){for(var m=0,v=0;v<i.length;v++){var g=i[v];if(h){if(g.$bind===h)break}else if(r.isNumber(g.schema))break;m++}m>1&&(f={colspan:m,columnField:d})}var y=document.createDocumentFragment();return t&&t.forEach(function(e,t,o){o=o||0,c&&c(e,t,o),n.append(y,p(0,t,o,e,i,s,0,a,0,l,u,f))},s.expandingProperty),y},createBulkRows:function(e,t,i,s,o,r,a,l,u){var c=document.createDocumentFragment();return t&&t.forEach(function(e,t){var o=e.level||0;u&&u(e.value,t,o),n.append(c,p(0,t,o,e.value,i,s,0,r,0,a,l,null))}),c},createRow:p,setRowsSelected:function(e,t,i,s){if(i.selecting&&i.selecting.row){var o=[],r=n.find(s,e);r&&o.push(r),i.allowFrozenColumns&&(r=n.find(s,e+"_frozen"))&&o.push(r),o.forEach(function(e){t?n.addClass(e,"bs-row-selected"):n.removeClass(e,"bs-row-selected")})}},createGridRows:function(e,t,i,s,o,r,a){var l=document.createDocumentFragment();return t&&t.forEach(function(t,u){n.append(l,d(e,u,t,i,s,o,r,a))}),l},createInplaceEdit:function(e,t,a,l,u,c,d){if(c.schema.enum)return function(e,t,o,r,a,l,u){var c=document.createElement("select");c.type="text",c.className=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"].join(" ");var d=o.filter?l.schema.filters[o.filter]||[]:l.schema.enum,p=d.indexOf(t);return s.utils.fillSelect(d,c,l.schema),v(c,r,!1),n.empty(r),n.addClass(r,"focused"),n.append(r,c),p<0?(i.nextTick(function(){a.item.setValue(l.$bind,d[0])}),c.selectedIndex=0):c.selectedIndex=p,{input:c,parent:c,td:r,combo:null,isInputElement:!0,canSelect:!1,schema:l.schema}}(0,t,a,l,u,c);if(r.isBoolean(c.schema))return{input:null,parent:null,td:l,isInputElement:!1,canSelect:!1,schema:c.schema,combo:null};if(d.after||d.before)return function(e,t,i,a,l,u,c){var d=document.createElement("div");d.className="bs-inplace-parent bs-edit-border ";var p=d;c.after&&((p=document.createElement("div")).className="bs-input-group",d.appendChild(p));var h=r.isDate(u.schema)&&s.utils.useDatePicker(),f=document.createElement("input");f.type=c.type||"text";var m=["bs-inplace-edit bs-inplace-edit-size"];if(c.after&&m.push("bs-input-group-main"),f.className=m.join(" "),n.append(p,f),c.after){var g=document.createElement("span");g.tabIndex=-1,g.className="bs-input-group-addon bs-cursor-d input-group-append input-group-addon";var y=document.createElement("span");y.className=n.iconClass(c.after.icon),n.append(g,y),n.append(p,g),c.id&&(g.id=c.id+"_after")}return v(f,a,!0),n.empty(a),n.addClass(a,"focused"),n.append(a,d),r.isDate(u.schema)?h?(s.utils.datePickerInitialize($(d),{showOnFocus:!1},function(e){}),s.utils.datePickerSetValue($(d),t)):f.value=o.isoDatePart(t||""):f.value=e,{input:f,parent:d,td:a,isInputElement:!0,canSelect:!0,schema:u.schema,combo:null}}(e,t,0,l,0,c,d);var p=document.createElement("input");p.type=d.type||"text";var h=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];return c.options.align&&h.push(s.utils.align2Css(c.options.align)),"text"===p.type&&c.schema.maxLength&&(p.maxLength=c.schema.maxLength),p.className=h.join(" "),v(p,l,!1),n.empty(l),n.addClass(l,"focused"),n.append(l,p),r.isDate(c.schema)?d.nativeDate?p.value=o.isoDatePart(t||""):p.value=o.shortDate(t||""):r.isNumber(c.schema)&&d.nativeNumber?p.value=t||0:p.value=e,{input:p,parent:p,td:l,isInputElement:!0,canSelect:!0,schema:c.schema,decimals:a.decimals,combo:null}},updateInplaceEdit:function(e,t,n,o,a,l,u,c){if(u.schema.enum)return function(e,t,n,s,o,r,a,l){var u=s.filter?a.schema.filters[s.filter]||[]:a.schema.enum,c=u.indexOf(n);c<0?(i.nextTick(function(){r.item.setValue(a.$bind,u[0])}),e.input.selectedIndex=0):e.input.selectedIndex=c}(e,0,n,o,0,l,u);t=t||"",r.isNumber(u.schema)?e.input.value=c.nativeNumber?n:t:r.isDate(u.schema)?s.utils.useDatePicker()?s.utils.datePickerSetValue($(a),n):e.input.value=c.nativeDate?n:t:e.input.value=t},createDetail:function(e,t){var i=document.createElement("tr");i.className="bs-table-row-detail",i.id=e+"_detail";var s=document.createElement("td");return s.colSpan=t.childNodes.length,n.append(i,s),i},updateEvenOdd:function(e){if(e.childNodes.length)for(var t=!1,i=0,s=e.childNodes.length;i<s;i++){var o=e.childNodes[i];n.hasClass(o,"bs-table-row")&&(t?n.removeClass(o,"even"):n.addClass(o,"even"),t=!t)}},ensureWidth:c,updateFrozenWidth:function(e,t,i){var s=f(i),o=n.find(e,t+"_frozen_header_parent");o&&(o.style.width=s+"px"),(o=n.find(e,t+"_frozen_header_sep"))&&(s?n.removeClass(o,"empty"):n.addClass(o,"empty"))},setColumnWidth:function(e,t,i){t.forEach(function(t){for(var s=0,o=t.childNodes.length;s<o;s++){var r=t.childNodes[s];if(n.attr(r,"colid")===e){r.style.width=i+"px";break}}})},hasFrozenColumns:function(e,t){return!!(e.allowFrozenColumns&&t&&t.length)},cloneForMove:function(e){var t=e.cloneNode(!0);if("th"===t.tagName.toLowerCase()){var i=e.parentElement,s=i.parentElement.parentElement,o=["<div>"];o.push('<table class="'),o.push(s.className),o.push('">'),o.push("<thead>"),o.push('<tr class="'),o.push(i.className),o.push('">'),o.push("</tr></thead><table>"),o.push("</div>");var r=$(o.join("")).get(0),a=r.firstChild.firstChild.firstChild;a.style.height=e.offsetHeight+"px",n.append(a,t),t=r}var l=n.position(e,null);return t.style.top=l.top+"px",t.style.left=l.left+"px",t.style.width=e.offsetWidth+"px",t.style.height=e.offsetHeight+"px",t.style.zIndex="9000",t.style.position="absolute",t},isPixel:u,widthFromSchema:function(e){return r.isBoolean(e)?50:r.isDate(e)?110:r.isNumber(e)?110:150},resizeDiv:function(e,t){var i=document.createElement("div");return i.className="bs-absolute bs-col-resize-indicator",i.style.top="0px",i.style.left=t.left+"px",n.append(e,i),i},getColumnsSizeParents:function(t,i,n,s){var o,r=[];return n._useColGrp?s?((o=e.dom.find(i,t+"_colgrp_frozen_header"))&&r.push(o),(o=e.dom.find(i,t+"_colgrp_frozen"))&&r.push(o),n.total&&n.total.property&&(o=e.dom.find(i,t+"_colgrp_frozen_footer"))&&r.push(o)):((o=e.dom.find(i,t+"_colgrp_header"))&&r.push(o),(o=e.dom.find(i,t+"_colgrp"))&&r.push(o),n.total&&n.total.property&&(o=e.dom.find(i,t+"_colgrp_footer"))&&r.push(o)):n.headerIsHidden||(o=s?e.dom.find(i,t+"_frozen_cols"):e.dom.find(i,t+"_cols"))&&r.push(o),r},multiselectContainer:function(e,t){var s=['<div class="modal-content bs-table-selected-list" id="{0}_ms">'];s.push('<div class="bs-table-selected-list-header"><span id="{0}_close_ms" class="icon-close {1}"></span></div>'),s.push('<div class="bs-table-selected-list-content">'),s.push('<ul class="list-group"  id="{0}_ms_list">'),s.push("</ul>"),s.push("</div>"),s.push("</div>");var o=$(i.format(s.join(""),e,n.iconClass("window-minimize"))).get(0);return t||m(!0,e,o),o},createMultiselectItems:function(e,t,s,o){var r=n.find(t,e+"_ms_list"),a=s.rowMove.expression||"{{$id}}",l=$('<li class="list-group-item bs-list-item-button"></li>').get(0),u=$('<div class="bs-list-button"><span class="'+n.iconClass("times")+'"></span></div>').get(0),c=document.createDocumentFragment();for(o.forEach(function(e){var t=l.cloneNode();n.attr(t,"data-ms-unselect",e.$id),n.text(t,i.execAngularExpression(a,e.model(!0))),n.append(c,t),n.append(t,u.cloneNode(!0))});r.firstChild;)n.remove(r.firstChild);n.append(r,c)},isMultiselectMinimized:function(e){return n.hasClass(e,"minimized")},setMultiselectMinimized:m};t.GridUtil=g}(e.gridrender||(e.gridrender={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils,i=e.dom,n=e.ui,s=e.ulocale,o=e.uiutils,r=e.Observable,a=e.gridrender.GridUtil,l=r.errorsUtils,u=e.link,c=e.locale,d=e.drag,p=e.events,h=r.SchemaUtils;!function(f){f.toolBarFactory=null,f.toolBarRender=null;f.gridlookup=null,f.glbGridFilter=null,f.glbGridSettings=null,f.glbMongoFilter2Filter=null;var m=function(m){__extends(v,m);function v(e,t,i){var n=m.call(this,e,t,i)||this;n._refreshGrid=function(){var e=this.renderOptions;this.state.value&&(this.state.value.allowSelecting=this.renderOptions.selecting&&(this.renderOptions.selecting.row||this.renderOptions.selecting.cell),this.state.value.multiselect=this.renderOptions.selecting&&this.renderOptions.selecting.multiselect,this.state.value.expandingProperty=this.renderOptions.expandingProperty),this.removeEvents(),this._initCols(e),this._renderColumns(e),this._renderRows(!0,"",null),this._renderTotalRows(),this.setEvents(this.renderOptions),this.resize()};var s=n;if(void 0===s.fieldOptions.striped&&(s.fieldOptions.striped=!0),s._view=[],s._viewMap={},s._ignoreNotifications=!1,s._state(),i.supportSettings()&&(s._settingsName=s.getSettingsName("basicgrid"),s._settings=i.getFieldSettings(s._settingsName)),s._settings){var o=s.fieldOptions.columns,r=s._settings.columns||[],a={};o.forEach(function(e){a[e.$bind]=e}),r.forEach(function(e){var t=a[e.$bind];if(t){var i=e.options||{},n=t.options||{};i.width&&(n.width=i.width),i.frozen&&(n.frozen=i.frozen),i.display&&(n.display=i.display),e.options=n}}),s.fieldOptions.columns=r,s._settings.columns=null}if(s.fieldOptions&&s.fieldOptions.total&&s.fieldOptions.total.property){s._totalProperty=s.fieldOptions.total.property;var l=s.form.getSchema(s._totalProperty);s._totalIsArray=l&&"array"===l.type,s._totalField=s.fieldOptions.total.field,s._stopField=s.fieldOptions.total.firstTotal,i.registerListenerFor(s._totalProperty,s)}return s.checkOptions(s.fieldOptions),s._initOrigColumns(s.fieldOptions),s._initCols(s.fieldOptions),s._details=[],s._onselectItemHandler=s._onselectItem.bind(s),n}return v.prototype._initOrigColumns=function(e){var t=this;t._originalCols={},e.columns=e.columns||[],e.columns.forEach(function(e){e.options=e.options||{},e.$bind===r.EXPANDED_FIELD_NAME&&e.options.display&&(t._originalCols[e.options.display]=$.extend(!0,{},e),t._originalCols[e.options.display].options._expandItem=!0)})},v.prototype.checkOptions=function(e){void 0===e.allowColumnMove&&(e.allowColumnMove=!0),e.align=e.align||"middle"},v.prototype.beforeSaveSettings=function(){var e=this;if(e._settingsName){e._settings={columns:[]};return(e.renderOptions.columns||[]).forEach(function(t){var i={$bind:t.$bind,options:null},n={};t.canStartDragHandler&&(n.frozen=!0),t.options.width&&(n.width=t.options.width),t.options.display&&(n.display=t.options.display),t.options.frozen&&(n.frozen=t.options.frozen),t.options._expandItem&&(i.$bind=r.EXPANDED_FIELD_NAME),i.options=n,e._settings.columns.push(i)}),e.form.setFieldSettings(e._settingsName,e._settings),!0}return!1},v.prototype._inplaceEditValue2Model=function(e,t,i){var n=t.getState(i.$bind),s=h.text2Value(e,i.schema,n);return s!==t.getValue(i.$bind)&&(t.setValue(i.$bind,s),!0)},v.prototype.setFocus=function(e){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden)if(this.inplace&&this.inplace.input&&this.inplace.isInputElement){this.inplace.input.focus()}else if(this.$element){var n=i.query(this.$element.get(0),'[tabindex="0"]');n&&n.focus()}},v.prototype._inplaceEditAcceptKeys=function(e){if(this.inplace.schema.enum){if(e===i.keys.VK_UP||e===i.keys.VK_DOWN)return!1}else if(h.isDate(this.inplace.schema)&&o.utils.useDatePicker()&&(e===i.keys.VK_UP||e===i.keys.VK_DOWN||e===i.keys.VK_LEFT||e===i.keys.VK_RIGHT))return!1;return!0},v.prototype._inplaceEditAddEvents=function(){var e=this;e.inplace.schema.enum&&$(e.inplace.input).on("change",function(t){var i=e.inplace.td,n=e._td2value(i),s=e._inplaceEditGetValue(n);e._inplaceEditValue2Model(s,n.item,n.col)||e._modifyCell(n.item,n.col.$bind,null,i)})},v.prototype._inplaceEditRemoveEvents=function(){this.inplace.schema.enum?$(this.inplace.input).off("change"):h.isDate(this.inplace.schema)&&o.utils.useDatePicker()&&o.utils.datePickerDestroy($(this.inplace.parent))},v.prototype._inplaceEditGetValue=function(e){if(!e.item)return null;var t=e.item.getState(e.col.$bind);if(this.inplace.schema.enum){var i=this.inplace.input.selectedIndex;return t.filter?this.inplace.schema.filters[t.filter][i]:this.inplace.schema.enum[i]}return o.utils.text2value(this.inplace.input.value,this.inplace.schema,t)},v.prototype._inpaceEditShow=function(e,n){var s=this._td2value(e),r=s.item.getValue(s.col.$bind),l=s.item.getState(s.col.$bind),u=h.value2Text(r,s.col.schema,l);e.tabIndex=-1;var c={nativeNumber:!1,nativeDate:!1,type:"text",after:null,id:null};s.col.$lookup?(c.after={icon:"chevron-down"},c.id=e.id||t.allocID(),e.id=c.id):h.isDate(s.col.schema)?(c.nativeDate=o.utils.nativeDate(),c.nativeDate?c.type="date":o.utils.useDatePicker()&&(c.after={icon:"calendar"})):h.isNumber(s.col.schema)&&(c.nativeNumber=o.utils.nativeNumber(),c.nativeNumber&&(c.type="number")),this.inplace=a.createInplaceEdit(u,r,l,e,s,s.col,c),s.col.$lookup&&(this.inplace.id=c.id,this.inplace.col=s.col,this._createGridPopup()),this._inplaceEditAddEvents(),this.inplace.isInputElement?(this.inplace.input.tabIndex=0,this.inplace.input.focus(),this.inplace.canSelect&&i.select(this.inplace.input)):(e.tabIndex=0,e.focus()),this._onFrozenFocusScroll(e,s.col)},v.prototype._destroyInplaceEdit=function(){this.inplace&&(this.inplace.combo&&(this.inplace.combo.destroy(),this.inplace.combo=null),this.inplace=null)},v.prototype._inplaceEditRemove=function(e,t,n){var s=this;if(s.inplace&&!t){var o=s.inplace.td;e&&(o.tabIndex=0);var r=s._td2value(o);s._inplaceEditRemoveEvents(),s.inplace.parent&&i.remove(s.inplace.parent),i.removeClass(o,"focused");if(!!s.inplace.input){var a=s._inplaceEditGetValue(r);if(s._destroyInplaceEdit(),!r.item)return;if(r.col.$lookup){var l=(r.item.getValue(r.col.$bind)||"")+"";if(!n&&a!==l)return s._findValue(a,r,function(e){s._setRemoteValue(r.col,r.item,e),s._modifyCell(r.item,r.col.$bind,null,o)});s._modifyCell(r.item,r.col.$bind,null,o)}else!n&&s._inplaceEditValue2Model(a+"",r.item,r.col)||s._modifyCell(r.item,r.col.$bind,null,o)}}s._destroyInplaceEdit()},v.prototype._inplaceEditModel2Control=function(e,t,i){var n=this._td2value(i),s=(this._inplaceEditGetValue(n),e.getValue(n.col.$bind)),r=e.getState(n.col.$bind),l=h.value2Text(s,n.col.schema,r),u={nativeNumber:o.utils.nativeNumber(),nativeDate:o.utils.nativeDate()};a.updateInplaceEdit(this.inplace,l,s,r,i,n,n.col,u)},v.prototype.removeEvents=function(){this._scrollableMaster&&$(this._scrollableMaster).off("scroll"),this._scrollableMaster=null,this._scrollableHeaderOfMaster=null,this._scrollableFooterOfMaster=null,this._drag&&(d.dragManager.rmvDrag(this._drag),this._drag=null)},v.prototype._onFrozenFocusScroll=function(e,t){if(t&&t.options&&t.options.frozen){var i=this.renderOptions;a.hasFrozenColumns(i,this.frozenColumns)&&i.scrolling&&i.scrolling.vertical&&(this._rsFrozenTimer&&(this._rsFrozenTimer.clearTimeout(),this._rsFrozenTimer=null),this.syncMasterScroll(null))}},v.prototype.setEvents=function(e){if(e.scrolling&&e.scrolling.vertical){var t=this.$element.get(0);this._scrollableMaster=i.find(t,this.id+"_master_scroll"),this._scrollableHeaderOfMaster=i.find(t,this.id+"_table_header_content"),this._totalProperty&&(this._scrollableFooterOfMaster=i.find(t,this.id+"_table_footer_content"));var n=a.hasFrozenColumns(e,this.frozenColumns);this._scrollableFrozenContent=n?i.find(t,this.id+"_frozen_scroll"):null,this._deltaHScrollContent=n?i.find(t,this.id+"_frozen_scroll_delta"):null,this._scrollableMaster&&this._scrollableHeaderOfMaster&&$(this._scrollableMaster).on("scroll",this.syncHeaderAndFrozenScroll.bind(this))}if((e.allowColumnResize||e.allowColumnMove)&&!e.headerIsHidden||e.rowMove){var s=d.dragManager.addDrag([this.$element.get(0)]);this._drag=s,s.canStartDragHandler=this._canStartDrag.bind(this),s.onDragStart=this._onDragStart.bind(this),s.onDrag=this._onDrag.bind(this),s.onDragEnd=this._onDragEnd.bind(this)}},v.prototype._getColsInfo=function(e,i){var n=[];return e.forEach(function(e,s){var o=i.childNodes[s];o.id||(o.id=t.allocID()),n.push({htmlId:o.id,info:e})}),n},v.prototype._canStartDrag=function(e){var n=e.target,s=i.attr(n,"data-drag"),o=this.renderOptions,r=null;if(o.headerIsHidden||!o.allowColumnResize&&!o.allowColumnMove||(r=i.parentByTag(this.$element.get(0),n,"th")),r){var a=this.renderOptions;return!(a.headerIsHidden||!a.allowColumnResize&&!a.allowColumnMove)&&(s||(s=i.attr(r,"data-drag")),!!s&&(r.id||(r.id=t.allocID()),this._drag.data.op=s,this._drag.data.cloneId=r.id,this._drag.data.column=i.attr(r,"colId"),!!this._drag.data.column&&this["_cdd"+s](e)))}var l=o.rowMove?i.parentByTag(this.$element.get(0),e.target,"td"):null;if(l){var u=this._td2cell(l);if(u){this.renderOptions;if(this._findById(u.row))return this._drag.data.op="rowmove",this._drag.data.row=u.row,this._drag.coverDocument=!1,this._drag.cursor="default",this._drag.moveSourceName="rowmove",!0}}return!1},v.prototype._onDragStart=function(e){return!!this._drag.data.op&&this["_sdd"+this._drag.data.op](e)},v.prototype._onDrag=function(e){return!!this._drag.data.op&&this["_ddd"+this._drag.data.op](e)},v.prototype._onDragEnd=function(e,t){return!!this._drag.data.op&&this["_edd"+this._drag.data.op](e,t)},v.prototype._cddresize=function(e){if(!this.renderOptions.allowColumnResize)return!1;var t=this._drag;return t.coverDocument=!0,t.cursor="col-resize",t.moveX=!0,!0},v.prototype._sddresize=function(e){var t=this._drag;t.floatParent=this._gridParentFocus();var n=i.find(t.floatParent,this._drag.data.cloneId),s=i.position(n,t.floatParent);return t.floatElement=a.resizeDiv(t.floatParent,{left:Math.round(s.left+n.offsetWidth)}),t.minLeft=Math.round(s.left+20),t.maxLeft=Math.round(s.left+2e3),!0},v.prototype._dddresize=function(e){return!0},v.prototype._eddresize=function(e,t){var n=this._drag;if(n&&(n.floatElement&&(i.remove(n.floatElement),n.floatElement=null),!e)){var s=this._colByField(n.data.column),o=p.point(t).x-n.startPoint.x,r=i.find(n.floatParent,this._drag.data.cloneId),a=parseInt(s.options.width+"",10);if(r.offsetWidth-a>5){var l=a/r.offsetWidth;o=Math.round(l*o)}var u=Math.min(Math.max(20,a+o),2e3);this._updateColWidth(s,u),this.savePreferences(function(){})}},v.prototype._updateColWidth=function(e,t){if(Math.max(parseInt(e.options.width||"0",10),2e3)!==t){e.options.width=t;var i=e.options.frozen&&this.renderOptions.allowFrozenColumns,n=a.getColumnsSizeParents(this.id,this.$element.get(0),this.renderOptions,i);a.setColumnWidth(e.$bind,n,t),i&&a.updateFrozenWidth(this.$element.get(0),this.id,this.frozenColumns),this.resize()}},v.prototype._cddmove=function(e){var t=this.renderOptions;if(!t.allowColumnMove)return!1;var n=this.$element.get(0),s=this._drag,o=i.find(n,s.data.cloneId);s.coverDocument=!0,s.cursor="move",s.moveX=!0,s.moveY=!0,s.startOffset=i.position(o,null);var r,a,l={firstDelta:0,lastDelta:-10,delta:-4,top:s.startOffset.top,height:o.offsetHeight};if(t.allowFrozenColumns&&(r=i.find(n,this.id+"_frozen_cols"))&&(a=i.childrenPositions(r,this._getColsInfo(this.frozenColumns,r),!1,"frozen",l)),l.lastDelta=0,r=i.find(n,this.id+"_cols")){var u=i.childrenPositions(r,this._getColsInfo(this.columns,r),!1,"free",l);a=a?a.concat(u):u}return s.data.childrenPositions=a,!0},v.prototype._cddrowmove=function(e){if(!this.renderOptions.rowMove)return!1;this.$element.get(0),this._drag;return!0},v.prototype._sddrowmove=function(e){var n=this.renderOptions;if(!n.rowMove)return!1;if(n.rowMove.multiselect&&(!n.selecting||!n.selecting.row||!n.selecting.multiselect))return!1;var s=n.rowMove.expression||"{{$id}}",o=this._drag,r=this._findById(this._drag.data.row);if(n.rowMove.multiselect&&r.$select)return!1;var l=$('<div><span class="bs-row-in-drag">'+t.escapeHtml(t.execAngularExpression(s,r))+"</span></div>").get(0);return o.floatElement=a.cloneForMove(l),o.floatElement.style.left=e.pageX-5+"px",o.floatElement.style.top=e.pageY-5+"px",i.append(document.body,o.floatElement),o.moveX=!0,o.moveY=!0,o.data.item=r,n.rowMove.multiselect&&(o.data.multiSelTarget=this._openMultiselectSummary(null,!0)),!0},v.prototype._dddrowmove=function(e){return!0},v.prototype._eddrowmove=function(e,t){var n=this._drag;if(n&&(n.floatElement&&(i.remove(n.floatElement),n.floatElement=null),!e&&t&&n.data.multiSelTarget)){var s=p.point(t),o=i.position(n.data.multiSelTarget,null);if(s.x>o.left&&s.x<o.left+n.data.multiSelTarget.offsetWidth&&s.y>o.top&&s.y<o.top+n.data.multiSelTarget.offsetHeight){var r=this.renderOptions;if(this.state.value){var a=this.state.value;a.selecting(!0,r.expandingProperty);try{n.data.item.select(!0,r.selecting&&r.selecting.row&&r.selecting.multiselect,this.state.value,r.expandingProperty,r.expanding&&r.expanding.selectChildren)}finally{a.selecting(!1,r.expandingProperty)}}}}},v.prototype._sddmove=function(e){var t=this._drag,n=i.find(this.$element.get(0),t.data.cloneId);return t.floatElement=a.cloneForMove(n),i.append(document.body,t.floatElement),!0},v.prototype._eddmove=function(e,t){var n=this,s=n._drag;if(s&&(s.floatElement&&(i.remove(s.floatElement),s.floatElement=null),s.data.mdiv&&(i.remove(s.data.mdiv),s.data.mdiv=null),!e&&s.data.best&&s.data.column)){var o=s.data.best.info,r=n._mapCols[s.data.column];if("empty"===s.data.best.position)r.column.options.frozen=!r.column.options.frozen;else{if(o.$bind===r.column.$bind)return;var a=n._mapCols[o.$bind],l=r.column,u=a.column,c=r.tindex,d="after"===s.data.best.position?a.tindex+1:a.tindex,p=!1;if(!!l.options.frozen!=!!u.options.frozen&&(l.options.frozen=u.options.frozen,p=!0),c===d-1){if(!p)return}else n.renderOptions.columns.splice(c,1),c<d&&d--,n.renderOptions.columns.splice(d,0,l)}n.savePreferences(function(){n._refreshGrid()})}},v.prototype._dddmove=function(e){var t=this._drag,n=p.point(e),s=i.findNearest(n.x,n.y,t.data.childrenPositions);if(t.data.best!=s){var o={left:s.left,top:s.top,width:s.width,height:s.height};t.data.mdiv=i.showMove(t.data.mdiv,s.vertical,o,"frozen"===s.zone?"bs-drag-color-success":"bs-drag-color-info")}return t.data.best=s,!0},v.prototype.destroy=function(){this._destroyDetails(),this.columns&&(this.columns.forEach(function(e){e.schema=null}),this.columns=null),this.frozenColumns&&(this.frozenColumns.forEach(function(e){e.schema=null}),this.frozenColumns=null),this._totalProperty&&this.form.unRegisterListenerFor(this._totalProperty,this),this._inplaceEditRemove(!1,!0,!1),this._onselectItemHandler=null,this._eventBus&&(this._eventBus.destroy(),this._eventBus=null),this._pager&&(this._pager.destroy(),this._pager=null),this.toolBar&&(this.toolBar.destroy(),this.toolBar=null),this._details=null,this._mapCols=null,this._originalCols=null,this._settings=null,this._scroller=null,this._rsTimer=null,this._rsFrozenTimer=null,this._scrollableMaster=null,this._scrollableHeaderOfMaster=null,this._scrollableFooterOfMaster=null,this._scrollableFrozenContent=null,this._deltaHScrollContent=null,m.prototype.destroy.call(this)},v.prototype._moveToPage=function(e){this.state.value&&this.state.value.currentPage(e)},v.prototype._onselectPage=function(e){switch(e){case"next":this._moveToPage(this._pager.options.noPagesCount?this._pager.props.currentPage+1:Math.min(this._pager.props.totalPages,this._pager.props.currentPage+1));break;case"prev":this._moveToPage(Math.max(0,this._pager.props.currentPage-1));break;case"first":this._moveToPage(1);break;case"last":this._moveToPage(this._pager.props.totalPages);break;default:this._moveToPage(e)}},v.prototype.setColumns=function(e){var t=this;t.renderOptions.columns=e.map(function(e){var i=t._colByField(e.$bind);return i||(i=t._originalCols[e.$bind]),i&&(i.options._expandItem&&(e.$bind=r.EXPANDED_FIELD_NAME),e.options=i.options),e}),t.savePreferences(function(){t._refreshGrid()})},v.prototype._setVisiblesColumns=function(e){var t=this;t.renderOptions.columns.forEach(function(t){var i=t.$bind;h.isSelectField(i)||(t.options._expandItem&&(i=r.EXPANDED_FIELD_NAME),t._isHidden=!!e&&e.indexOf(i)<0)}),t.savePreferences(function(){t._refreshGrid()})},v.prototype._getMultiselectdItems=function(){var e=[],t=this.renderOptions,i=this.state.value;if(i)return i.enumSelectedItems(t.expandingProperty,function(t){e.push(t)}),e},v.prototype._updateMultiselectSummary=function(e){var t=this,i=t.renderOptions;i.rowMove&&i.rowMove.multiselect&&i.selecting&&i.selecting.row&&i.selecting.multiselect&&(t._timeOutSelected&&window.clearTimeout(t._timeOutSelected),t._timeOutSelected=window.setTimeout(function(){var e=t._getMultiselectdItems();e.length?t._openMultiselectSummary(e,!1):t._closeMultiselectSummary(!0,!1)},100))},v.prototype._openMultiselectSummary=function(e,t){var n=i.find(this.$element.get(0),this.id+"_ms");return n?(e||(e=this._getMultiselectdItems()),t&&a.isMultiselectMinimized(n)&&a.setMultiselectMinimized(!1,this.id,n),a.createMultiselectItems(this.id,n,this.renderOptions,e)):n=this._toggleMultiselectSummary(e,t),n},v.prototype._closeMultiselectSummary=function(e,t){var n=i.find(this.$element.get(0),this.id+"_ms");if(e)n&&this._toggleMultiselectSummary(null,!1);else if(t&&n){var s=!a.isMultiselectMinimized(n);a.setMultiselectMinimized(s,this.id,n)}},v.prototype._toggleMultiselectSummary=function(e,t){var n=i.find(this.$element.get(0),this.id+"_ms");if(n)return i.remove(n),null;e||(e=this._getMultiselectdItems()),n=a.multiselectContainer(this.id,t),a.createMultiselectItems(this.id,n,this.renderOptions,e);var s=i.find(this.$element.get(0),this.id+"_focus");return s&&i.append(s,n),n},v.prototype._renderToolbar=function(){if(this.toolBar&&f.toolBarRender){var e=this.fieldOptions.toolbar||{},t=e.parentName&&!this.options.design?this.form.getLayoutElementByName(e.parentName):null,n=this.$element.get(0);t?(i.addClass(t,"bs-field-group"),i.removeClass(t,"no-x-padding")):t=i.find(n,this.id+"_header");var s=i.find(n,this.id+"_bottom");f.toolBarRender($(t),this.toolBar,$(s))}},v.prototype._createToolbar=function(){f.toolBarFactory&&(this.toolBar=f.toolBarFactory(this))},v.prototype._state=function(){m.prototype._state.call(this);var e=this.fieldOptions;if(this.state.value){if(this.state.value.allowSelecting=this.renderOptions.selecting&&(this.renderOptions.selecting.row||this.renderOptions.selecting.cell),this.state.value.multiselect=this.renderOptions.selecting&&this.renderOptions.selecting.multiselect,this.state.value.expandingProperty=this.renderOptions.expandingProperty,this.state.value.isQueryable()){var t=$.extend({size:"default",selectPage:this._onselectPage.bind(this),noPagesCount:this.state.value.noPagesCount()},e.pager||{});this._pager=new n.Pager(t);var i=this._pager;i.props.hasNext=this.state.value.hasNext(),i.props.hasPrev=this.state.value.hasPrev(),i.props.totalPages=this.state.value.totalPages(),i.props.currentPage=this.state.value.currentPage()}this._createToolbar()}},v.prototype._destroyDetails=function(){if(this._details){var e=n.formManager();this._details.forEach(function(t){var i=e.formByName(t);i&&i.destroy()}),this._details=[]}},v.prototype._destroyDetailById=function(e){var t=this._details.indexOf(e);t>=0&&this._details.splice(t,1);var i=n.formManager().formByName(e);i&&i.destroy()},v.prototype._initCols=function(e){var t=this;t._mapCols={},e.columns&&e.columns.length||(e.columns=[{$bind:"$index"}]),t.columns=[],t.frozenColumns=[];var i=e.columns.findIndex(function(e){return h.isSelectField(e.$bind)}),n=null;e.selecting&&e.selecting.row&&e.selecting.multiselect?i<0?(n={$bind:r.SELECTED_FIELD_NAME,options:{width:50,frozen:!0}},e.columns.splice(0,0,n)):n=e.columns[i]:i>=0&&e.columns.splice(i,1);var o=!!e.expandingProperty,l=e.scrolling&&e.scrolling.vertical||e.editing,u=t.state.value&&t.state.value.columns?t.state.value.columns:null;e.columns.forEach(function(i,r){var c=$.extend({},i);if(c.options=c.options||{},n!==i&&u&&u.indexOf(i.$bind)<0&&(c._isHidden=!0),o&&h.isExpandField(i.$bind)&&(i,c.schema=h.getSchema(i.$bind,t.$schemaItems,t.form.$rootSchema,!1),c.$bind=e.expandingProperty+i.$bind,c.options.icons={1:e.expanding&&e.expanding.plus?e.expanding.plus:"plus",2:e.expanding&&e.expanding.minus?e.expanding.minus:"minus"},c.options.align=c.options.align||"left",c.options.alignIcon=c.options.alignIcon||"left",c.options._clickable=!0,c.options._expandItem=!0,e.expanding&&(e.expanding.style&&(c.options._expandItemClass=e.expanding.style),e.expanding.iconClass&&(c.options.iconClass=e.expanding.iconClass))),c.schema||(c.schema=h.getSchema(i.$bind,t.$schemaItems,t.form.$rootSchema,!1)),c.schema||c.schema)if(c.options.$lookup&&(c.$lookup=t.form.getLookupForSchema(t.$bind+"."+c.$bind,c.options.$lookup)),t._mapCols[c.$bind])console.log("Duplicate column name  : "+i.$bind);else{if(c.title=s.tt(c.options.title||c.schema.title,t.form.$locale),c.options.display&&(c.options.displaySchema=h.getSchema(c.options.display,t.$schemaItems,t.form.$rootSchema,!1),!c.title&&c.options.displaySchema&&(c.title=s.tt(c.options.displaySchema.title,t.form.$locale))),h.isLink(i.$bind)&&(c.isLink=!0,c._isHidden=!1),l&&!c.options.width&&(c.options.width=a.widthFromSchema(c.schema)),c.options.frozen&&e.allowFrozenColumns)return c.options.width?function(e){e=(e=(e||"")+"").trim();var t=parseInt(e,10);return t+""===e||t+"px"===e||t+" px"===e}(c.options.width)||(c.options.width=50):c.options.width=a.widthFromSchema(c.schema),void(c._isHidden||(t.frozenColumns.push(c),t._mapCols[c.$bind]={column:c,index:t.frozenColumns.length-1,tindex:r}));c._isHidden||(t.columns.push(c),t._mapCols[c.$bind]={column:c,index:t.columns.length-1,tindex:r})}else console.log("Field (bind) not found : "+i.$bind)})},v.prototype._colByField=function(e){var t=this._mapCols[e];return t?t.column:null},v.prototype._totalChanged=function(e,t,i,n,s){if(this.$element){if(this._ignoreNotifications)return!1;switch(n){case"propchange":if(e===this._totalProperty)this._renderTotalRows();else{var o=null,r="";if(this._totalIsArray){var a=h.parsePath(this._totalProperty,e,"");o=s[a],r=e.substr(a.length+1)}else o=s.instance,r=e.split(".").pop();o&&this._modifyFooterCell(o,r)}}}},v.prototype.changed=function(e,t,n,s,o){if(this.$element){if(this._ignoreNotifications)return!1;if(!(e.substr(this.$bind.length).indexOf(".$selected")>=0)){var r=this.renderOptions.hideWhenNoRows,l=this.selectedCell,u=null;o.checkChildren&&"propchange"===s&&e===this.$bind&&(r=!0,!0,this.state.value=this.form.getValue(this.$bind),this.state.value.allowSelecting=this.renderOptions.selecting&&(this.renderOptions.selecting.row||this.renderOptions.selecting.cell),this.state.value.multiselect=this.renderOptions.selecting&&this.renderOptions.selecting.multiselect,this.state.value.expandingProperty=this.renderOptions.expandingProperty);var c=!1,d=!1,p=!1;if(this._totalProperty){if(0===e.indexOf(this._totalProperty))return void this._totalChanged(e,t,n,s,o);o.checkChildren&&"propchange"===s&&e===this._totalProperty&&this._totalChanged(this._totalProperty,t,n,s,o)}switch(this.state.value||(s="none"),s){case"count":var f=this.toolBar;f&&f.setValue&&f.setValue("count",this.state.value.totalCount());break;case"filter":var m=this.toolBar;m&&m.setValue&&m.setValue("filter",this.state.value.filter.title||"");break;case"pagination":var v=this._pager;v&&(v.props.totalPages=this.state.value.totalPages(),v.props.currentPage=this.state.value.currentPage(),v.props.hasNext=this.state.value.hasNext(),v.props.hasPrev=this.state.value.hasPrev());break;case"sorting":this._updateSorting();break;case"propchange":if(e===this.$bind)o.sorting?(this._renderRows(!0,"",null,!1),l&&this._selectCell(l,null,!1,!1)):(this._renderRows(!0,"",null,!1),p=!0),d=!0,r=!0;else{var g=e,y=h.parsePath(this.$bind,g,this.renderOptions.expandingProperty),_=o[y];if(_){var $=e.substr(y.length+1);if(!$)return;this._modifyCell(_,$,null,null),h.isSelectField($)&&(this.renderOptions.noRowSelectedIndicator||a.setRowsSelected(_.$id,_.$select,this.fieldOptions,this.$element.get(0)),_.$select&&this.renderOptions.selecting&&this.renderOptions.selecting.cell&&(this.selectedCell&&this.selectedCell.row===_.$id||(this._selectFirstCellEditable("model",_.$id,null),p=!1)),this._updateMultiselectSummary(!1))}}break;case"add":this._createRow(o.$value),o.$value.$select&&(u=o.$value.$id,p=!0),d=!0,c=!0,r=!0;break;case"remove":this.renderOptions.expandingProperty,this._removeRow(o.$id),c=!0,r=!0}if(r){this._isHidden()!==i.hasClass(this.$element.get(0),"bs-none")&&(this.setHidden(this.$element.get(0)),d=!0)}if(c&&this._updOddEvenLater(),d&&this.resize(),p){var b=null;!u&&l&&(u=l.row,b=l.col),u&&!this._findById(u)&&(u=null,b=null),this._selectFirstCellEditable("model",u,b)}}}},v.prototype._modifyStateTD=function(e,t,n,s){var o=this.renderOptions,r=this._colByField(t);if(r){var a=e.getState(t),l=r.options||{},u=(o.editing||h.isSelectField(t))&&!a.isDisabled&&!a.isReadOnly&&!a.isHidden&&!1!==l.editing&&!1!==l.selecting;a.isHidden&&i.empty(s),o.editing&&(u?i.removeClass(s,"bs-td-readonly"):i.addClass(s,"bs-td-readonly"))}},v.prototype._modifyTD=function(e,t,n){var s=this.renderOptions,r=this._colByField(t);if(r){var a=e.getState(t),l=r.options||{},u=(s.editing||h.isSelectField(t))&&!a.isDisabled&&!a.isReadOnly&&!a.isHidden;if(i.empty(n),!a.isHidden){var c=null,d=this._viewMap[e.$id],p=d?d.level||0:0;l.display&&l.displaySchema&&(c=o.utils.displayValue(e.getValue(l.display),l.displaySchema,this.form.$locale,{html:!0,tableOptions:s,avanced:l.displayOptions||{},state:e.getState(l.display)},e,l.display));var f=o.utils.displayValue(e.getValue(t),r.schema,this.form.$locale,{html:!0,useSymbol:!1,editable:u,selectable:!a.isDisabled,check:s.editing,avanced:l,tableOptions:s,display:c,level:p,state:a},e,t);if(f.html){var m=$(f.value);i.append(n,m.get(0))}else{var v=f.value;""===v&&(v=String.fromCharCode(160)),i.append(n,document.createTextNode(v))}}}},v.prototype._findTR=function(e,t){var n=this.renderOptions,s=e+(t.options.frozen&&n.allowFrozenColumns?"_frozen":"");return i.find(this.$element.get(0),s)},v.prototype._id2rowId=function(e){var t=e.indexOf("_frozen");return t>0&&(e=e.substring(0,t)),e},v.prototype._findtBody=function(e){var t=this.renderOptions,n=this.id+(e.options.frozen&&t.allowFrozenColumns?"_frozen_rows":"_rows");return i.find(this.$element.get(0),n)},v.prototype._modifyFooterCell=function(e,t){if(this.$element){var i=this._colByField(t);if(i){var n=this._findTR(e.$id,i);n&&this._findCellAndModify(e,n,t,null)}}},v.prototype._findCellAndModify=function(e,t,n,s){for(var o=i.queryAll(t,'td[colid="'+n+'"]'),r=0,a=o.length;r<a;r++){var l=o.item(r);if(s){!0===e.$states[n][s]&&["isDisabled","isHidden","isReadOnly"].indexOf(s)>=0&&this.inplace&&this.inplace.input&&this.inplace.td===l&&this._inplaceEditRemove(!1,!1,!0),this._modifyStateTD(e,n,s,l)}else{if(this.inplace&&this.inplace.input&&this.inplace.td===l)return void this._inplaceEditModel2Control(e,n,l);this._modifyTD(e,n,l)}}},v.prototype._modifyCell=function(e,t,i,n){if(this.$element){var s=this._colByField(t);if(s){if(n)return this.inplace&&this.inplace.input&&this.inplace.td===n?void this._inplaceEditModel2Control(e,t,n):this._modifyTD(e,t,n);var o=this._findTR(e.$id,s);o&&this._findCellAndModify(e,o,t,i)}}},v.prototype._rootElement=function(){return this.$element?this.$element.get(0):null},v.prototype._gridParentFocus=function(){return this.$element?i.find(this.$element.get(0),this.id+"_focus"):null},v.prototype._setErrors=function(t,n){var s=this.state.errors;if(n&&e.bootstrap4){s&&s.length?i.addClass(n,"is-invalid"):i.removeClass(n,"is-invalid")}this.showErrors(n,s)},v.prototype._setTableFocus=function(e){var t=i.find(this.$element.get(0),this.id+"_table");t&&(e?i.addClass(t,"focused"):i.removeClass(t,"focused")),(t=i.find(this.$element.get(0),this.id+"_table_frozen"))&&(e?i.addClass(t,"focused"):i.removeClass(t,"focused"))},v.prototype.focusIn=function(e){if(this.$element)if(this._setTableFocus(!0),this.selectedCell){var t=this._cell(this.selectedCell,!0);if(t||(this.selectedCell=null,this._selectFirstCell("focusin",null,!1,null),this.selectedCell&&(t=this._cell(this.selectedCell,!0))),!t)return;this.canEdit(this.selectedCell)&&!this.inplace&&this._inpaceEditShow(t.td,!0)}else this._inplaceEditRemove(!1,!1,!1)},v.prototype.focusOut=function(e){this.$element&&(this._setTableFocus(!1),this._inplaceEditRemove(!0,!1,!1))},v.prototype._doTab=function(e){return e?this._moveRightSelectedCell(!0):this._moveLeftSelectedCell(!0)},v.prototype.keypress=function(e){var t=this._gridParentFocus();if(i.isChildOf(t,e.target)&&this.selectedCell&&this.inplace&&i.isChildOf(this.inplace.td,e.target)){var n=this._td2value(this.inplace.td);if(h.isNumber(this.inplace.schema)&&!this.inplace.schema.enum){if(!1===o.utils.keyPressNumber(e,this.inplace.input,{decimalSep:c.number.decimal,thousandSep:c.number.thousand,places:this.inplace.decimals,schema:this.inplace.schema}))return!1}else if(h.isDate(this.inplace.schema)&&!this.inplace.schema.enum){if(!1===o.utils.keyPressDate(e,this.inplace.input,{sep:c.date.daySep,format:c.date.dateShort,schema:this.inplace.schema}))return!1}else if(h.isBoolean(this.inplace.schema)){if(" "===String.fromCharCode(e.which)&&this.fieldOptions.editing){var s=n.item.getRelativeState(n.col.$bind);if(!s.isDisabled&&!s.isReadOnly){var r=n.item.getValue(n.col.$bind);n.item.setValue(n.col.$bind,!r)}}e.preventDefault()}}},v.prototype.keydown=function(e){var t=e.which||e.keyCode,n=this._gridParentFocus();if(i.isChildOf(n,e.target)){var s=!1;if(this.inplace&&i.isChildOf(this.inplace.td,e.target)){if(!this._inplaceEditAcceptKeys(t))return;if(this.inplace.combo&&(t===i.keys.VK_F4||t===i.keys.VK_DOWN&&e.ctrlKey))this._toggleGridLookup();else if(h.isNumber(this.inplace.schema)&&!this.inplace.schema.enum){if(!1===o.utils.keyDownNumber(e,this.inplace.input,{decimalSep:c.number.decimal,thousandSep:c.number.thousand,places:this.inplace.decimals,schema:this.inplace.schema}))return}else if(h.isDate(this.inplace.schema)&&!this.inplace.schema.enum&&!1===o.utils.keyDownDate(e,this.inplace.input,{sep:c.date.daySep,format:c.date.dateShort,schema:this.inplace.schema}))return}if(r=e,t===i.keys.VK_TAB&&r.shiftKey||!(r.altKey||r.ctrlKey||r.metaKey||r.shiftKey)){var r;if(this.fieldOptions.selecting&&this.fieldOptions.selecting.cell)switch(t){case i.keys.VK_TAB:case i.keys.VK_ENTER:s=this._doTab(!e.shiftKey);break;case i.keys.VK_UP:s=this._moveUpSelectedCell(1);break;case i.keys.VK_DOWN:s=this._moveDownSelectedCell(1)}s&&e.preventDefault()&&e.stopPropagation()}}},v.prototype._toggleGridLookup=function(){this.inplace&&this.inplace.combo&&(this.inplace.combo.opened?f.gridlookup.closeGridLookup(this.inplace,this._eventBus,"combo"):this._openGridLookup())},v.prototype._createGridPopup=function(){this._eventBus||(this._eventBus=new e.serial.SingleEventBus(50));var t=this.inplace.input,i=this.$element.get(0);this.inplace.combo=f.gridlookup.checkGridPopup(this,this.inplace.col.$lookup,t,i)},v.prototype._searchText=function(){if(this.inplace&&this.inplace.combo){var e=this.inplace.col,t=this._td2cell(this.inplace.td);if(t){var i=this._findById(t.row);if(i){var n=i.getValue(e.$bind,null)||"",s=this.inplace.input.value||"";if(s!==n)return s}}}return""},v.prototype._getSource=function(e,t){return t.fieldName=e.col.$lookup.mapping[e.col.$bind],t.paginated=!0,t.containerId=this.form.syncTransactionId(),t.viewId=this.form.syncViewId(),t.selected=e.item.pkId(),h.executeLookup(e.col.$lookup,e.item,t)},v.prototype._findValue=function(e,t,i){var n=this;if(e||""!==e){var s={search:e,select:!1,findFirst:!0,find:!1,paginated:n.renderOptions.paginated};n._eventBus.push(n._getSource(t,s),function(e){(e=n._filterResult(e,s,t.col.$lookup,t.col.$bindp,t.col.$display))&&e.value&&e.value.length?i(e.value[0]):i(null)},!0)}else n._eventBus.push(null,function(e){return i(null)},!0)},v.prototype._filterResult=function(e,t,i,n,s){if(i=f.gridlookup.checkGridLookup(i,this.form.$model),e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(i.data&&i.data.$params&&i.data.$params.$allData){var o=h.findFirst(t.search,h.remoteSearch(h.lastSegment(n,n),i),e.documents);return o?{value:[o.item]}:null}e.value=e.documents,delete e.documents}return e},v.prototype._setRemoteValue=function(e,t,i){var n=Object.keys(e.$lookup.mapping),s=h.extractBase(e.$bind),o=[],r=!1;n.forEach(function(n){if(e.$lookup.mapping[n]){var a=t.getValue(s+n,null)||"",l=i?i[e.$lookup.mapping[n]]||"":"";""===l&&("number"==typeof a?l=0:"boolean"==typeof a&&(l=!1)),l!==a&&(t.setValue(s+n,l,null),r=!0)}else o.push(n)}),r&&o.forEach(function(i){t.setValue(s+i,e.$lookup.mapping[i])})},v.prototype._onselectItem=function(e){var t=this;if(t.inplace&&t.inplace.combo){var i=t.inplace.col,n=t._td2cell(t.inplace.td);if(n){var s=t._findById(n.row);s&&t._eventBus.push(e,function(e){t._setRemoteValue(i,s,e)},!0)}}},v.prototype._openGridLookup=function(){if(!this.inplace.combo.opened){var e=this._td2cell(this.inplace.td),t=void 0;if(e){var i=this._findById(e.row);i&&(t=i.pkId())}var n=f.gridlookup.checkGridLookup(this.inplace.col.$lookup,this.form.$model);f.gridlookup.openGridLookup(this.inplace,{lookup:n,parentControl:this,formControl:this.form,display:this.inplace.col.$bind,bind:this.inplace.col.$bind,containerId:this.form.syncTransactionId(),viewId:this.form.syncViewId(),selected:t,align:this.inplace.id,openerId:this.inplace.id+"_after",searchText:this._searchText(),onselect:this._onselectItemHandler,lookupColumns:this.inplace.col.options.lookupColumns?this.inplace.col.options.lookupColumns:void 0,propertyName:"combo",minWidth:this.inplace.col.options.lookupMinWidth||0})}},v.prototype.checkFocus=function(e){var i=this;t.nextTick(function(){var e=window.document.activeElement;e&&i.targetInControl(e)||(i.focusOut(null),i.focused=!1)})},v.prototype.focusInControl=function(e){var t=this._gridParentFocus(),n=i.isChildOf(t,e);if(!n&&this.inplace){if(this.inplace.combo&&this.inplace.combo.opened)return this.inplace.combo.focusInCombo(e);if(this.inplace&&h.isDate(this.inplace.schema)&&o.utils.useDatePicker()){var s=i.query(document.body,".datepicker");if(s&&(i.isChildOf(s,e)||e===document.body))return!0}}return n},v.prototype._tr2rowId=function(e,t){var i=e.id;if(t&&t.options.frozen){var n=i.indexOf("_frozen");n>0&&(i=i.substring(0,n))}return i},v.prototype._td2cell=function(e){var t=e.parentNode,n=(t.parentNode,this._colByField(i.attr(e,"colid")));if(!n)return null;var s=this._tr2rowId(t,n);return this._findById(s)&&n?{row:s,col:i.attr(e,"colid")}:null},v.prototype._td2value=function(e){var t=e.parentNode,n=(t.parentNode,this._colByField(i.attr(e,"colid"))),s=this._tr2rowId(t,n);return{item:this._findById(s),col:n}},v.prototype.mousedown=function(e){var t=this._gridParentFocus();if(!i.isChildOf(t,e.target))return!0;var n=i.parentByTag(this.$element.get(0),e.target,"td");if(n){var s=this.renderOptions,o=this._td2cell(n);o&&(this._selectCell(o,e,!0,!1)?e.preventDefault():s.selecting&&!s.selecting.multiselect&&this._selectRow(o.row))}return!0},v.prototype._addRows=function(e,t){this._renderRows(!1,e.$id,t,!1),this._updOddEvenLater()},v.prototype._removeRows=function(e,t){var i=this;t.forEach(function(e){i._removeRow(e.value.$id)}),i._updOddEvenLater()},v.prototype.dblclick=function(e){var t=this.renderOptions;if(t.doubleClick){var n=i.parentByTag(this.$element.get(0),e.target,"td");if(n){var s=this._td2cell(n);if(s){var o=this._findById(s.row);this.form.execAction(this.$bind+".$links."+t.doubleClick,o)}}}},v.prototype.click=function(e){var t=this;if(t.state.value){var n=t.renderOptions,s=i.parentByTag(t.$element.get(0),e.target,"td");if(s){var o=t._td2cell(s);if(o){var r=t._findById(o.row),a=t._colByField(o.col);if(r){var l=e&&e.target&&e.target.$link||e.target.parentNode.$link;if(l){var c=r.getRelativeState(a.$bind);if(c.isDisabled||c.isHidden)return;a.schema.$widgetAction?t[a.schema.$widgetAction]&&t[a.schema.$widgetAction](r):t.form.execAction(t.$bind+".$item."+l,r)}else if(a){if(t.inplace&&t.inplace.input&&t.inplace.td===s)return void(t.inplace.combo&&(e.target.id!==t.inplace.id+"_after"&&e.target.parentNode.id!==t.inplace.id+"_after"||t._toggleGridLookup()));if(a.options._expandItem){if(i.attr(e.target,"data-clickable")||i.attr(e.target.parentNode,"data-clickable")){if(!(v=r.getRelativeState(a.$bind)).isDisabled&&!v.isReadOnly){var d=r.toggleExpand(n.expandingProperty);t._ignoreNotifications=!0;try{var p=[],f=t._viewMap[r.$id];if(r.enumVisibleChildren(n.expandingProperty,f.level,!0,function(e,t){var i={level:t,value:e};p.push(i)}),!p.length)return;d?t._addRows(r,p):t._removeRows(r,p)}finally{t._ignoreNotifications=!1}}}}else if(a.options.$link){if(i.findByAttribute(e.target,s,"data-phoenix-href")){(v=r.getRelativeState(a.$bind)).isDisabled||(a.options.$link.action?t.form.execAction(t.$bind+".$links."+a.options.$link.action,r):u.execLink(a.options.$link,{$item:r},null))}}else if(a.options.actionName){(v=r.getRelativeState("$links."+a.options.actionName))&&!v.isDisabled&&t.form.execAction(t.$bind+".$item.$links."+a.options.actionName,r)}else if(h.isSelectField(a.$bind)||n.editing&&h.isBoolean(a.schema)){if(i.attr(e.target,"data-clickable")){if(!(v=r.getRelativeState(a.$bind)).isDisabled&&!v.isReadOnly&&!v.isHidden){var m=r.getValue(a.$bind);if(h.isSelectField(a.$bind)){(E=t.state.value).selecting(!0,n.expandingProperty);try{r.select(!m,n.selecting&&n.selecting.row&&n.selecting.multiselect,t.state.value,n.expandingProperty,n.expanding&&n.expanding.selectChildren)}finally{E.selecting(!1,n.expandingProperty)}}else r.setValue(a.$bind,!m)}}}else if(n.selecting&&n.selecting.row&&!n.selecting.multiselect&&n.selecting.action){var v;(v=r.getRelativeState("$links."+n.selecting.action))&&!v.isDisabled&&t.form.execAction(t.$bind+".$item.$links."+n.selecting.action,r)}}}}}else{var g=i.parentByTag(t.$element.get(0),e.target,"th");if(g){var y=i.attr(g,"colid");if(y){var _=t._colByField(y),$=_.options.display?_.options.displaySchema:_.schema;if(!$||!_)return;if(h.isSelectField(_.$bind)&&n.selecting&&n.selecting.row&&n.selecting.multiselect&&n.selecting.selectAll){var b=i.parentByTag(t.$element.get(0),e.target,"center");if(b){var x=i.query(b,".bs-bool-edit");if(x){var C=i.iconClass("check-square-o",!0),k=i.iconClass("square-o",!0),w=i.hasClass(x,C);w?(i.removeClass(x,C),i.addClass(x,k)):(i.removeClass(x,k),i.addClass(x,C));var E=t.state.value;if(w){E.selecting(!0,n.expandingProperty);try{t._getMultiselectdItems().forEach(function(e){e.select(!1,n.selecting&&n.selecting.row&&n.selecting.multiselect,t.state.value,n.expandingProperty,!1)})}finally{E.selecting(!1,n.expandingProperty)}}else{E.selecting(!0,n.expandingProperty);try{E.forEach(function(e,i,s){e.select(!0,n.selecting&&n.selecting.row&&n.selecting.multiselect,t.state.value,n.expandingProperty,!1)},n.expandingProperty,!0)}finally{E.selecting(!1,n.expandingProperty)}}}}}else if(n.sorting&&h.canSort($)){var O=$.orderBy?$.orderBy:_.options.display?_.options.display:_.$bind,S=O;if(t.state.value.$orderby()===O){S=O.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 1===t.length?t.push("desc"):t[1]="desc"===t[1]?"asc":"desc",t.join(" ")}).join(",")}t.state.value.isQueryable()?t.state.value.$orderby(S):t.state.value&&t.form.execAction(t.state.value.getJSONPatchPath()+".$sort",S)}}}else if(e.target.id===t.id+"_close_ms")t._closeMultiselectSummary(!1,!0);else{var P=i.parentByAttr(t.$element.get(0),e.target,"data-ms-unselect");if(P){var I=i.attr(P,"data-ms-unselect");if(r=t._findById(I)){(E=t.state.value).selecting(!0,n.expandingProperty);try{r.select(!1,n.selecting&&n.selecting.row&&n.selecting.multiselect,t.state.value,n.expandingProperty,n.expanding&&n.expanding.selectChildren)}finally{E.selecting(!1,n.expandingProperty)}}}else if(t.toolBar){var D=t.toolBar.htmlRoots();for(f=0;f<D.length;f++){var M=D[f];if(i.isChildOf(M.element,e.target)){t.toolBar.execClick(e);break}}}}}}},v.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled},v.prototype._showSelected=function(e,t,n,s){if(!e)return null;var o=this._cell(e,!1);o&&o.td&&(t?(i.addClass(o.td,"bs-cell-selected"),this._inplaceEditRemove(!1,!1,!1),n&&(this.focused||s)?this._inpaceEditShow(o.td,!1):(o.td.tabIndex=0,(this.focused||s)&&o.td.focus()),this._onFrozenFocusScroll(o.td,this._colByField(e.col))):(i.removeClass(o.td,"bs-cell-selected"),o.td.tabIndex=-1))},v.prototype.canSelect=function(e,t){var i=this.selectedCell;if(i&&i.col===e.col&&i.row===e.row)return!1;if(!this.fieldOptions.selecting||!this.fieldOptions.selecting.cell)return!1;var n=this._colByField(e.col);if(n){if(!t)return!0;if(n.options&&!1===n.options.selecting)return!1;var s=this._findById(e.row);if(s){var o=s.getState(n.$bind);return!o.isDisabled&&!o.isHidden}}return!1},v.prototype.canEdit=function(e){if(!this.fieldOptions.editing||!this.fieldOptions.selecting||!this.fieldOptions.selecting.cell)return!1;var t=this._colByField(e.col);if(t.options&&!1===t.options.editing)return!1;if(t.isLink)return!1;if(t.options._expandItem)return!1;var i=this._findById(e.row).getState(t.$bind);return!i.isReadOnly&&!i.isDisabled&&!i.isHidden},v.prototype._selectRow=function(e){var t=this.renderOptions;if(this.state.value){var i=t.selecting&&t.selecting.row&&t.selecting.multiselect,n=this._findById(e);if(n){var s=this.state.value;s.selecting(!0,t.expandingProperty);try{n.select(!0,i,this.state.value,t.expandingProperty)}finally{s.selecting(!1,t.expandingProperty)}}}},v.prototype._selectCell=function(e,t,i,n){if(!this.canSelect(e,n)){if(i){var s=this.selectedCell;return(!s||s.row!==e.row)&&this._selectFirstCell("mouseDown",e.row,n,null)}return!1}var o=this.selectedCell,r=this.canEdit(e);this.selectedCell=e,this._showSelected(e,!0,r,i),o?this._showSelected(o,!1,!0,i):this._gridParentFocus().tabIndex=-1;var a=this.renderOptions;return a.selecting&&!a.selecting.multiselect&&this._selectRow(e.row),!0},v.prototype._selectFirstCellEditable=function(e,t,i){this._selectFirstCell(e,t,!0,i)||this._selectFirstCell(e,t,!1,i)},v.prototype._selectFirstCell=function(e,t,n,s){var o=this.fieldOptions;if(!o.selecting||!o.selecting.cell)return!1;var r=i.find(this.$element.get(0),this.id+"_rows");if(!r.childNodes.length)return!1;var a=null,l=this.frozenColumns.concat(this.columns),u=0;s&&((u=l.indexOf(s))>=0?n&&(n=!1):u=0);for(var c=l.length;u<c;u++){var d=l[u],p=void 0;if(t)p=t;else{if(o.selecting&&o.selecting.row&&!o.selecting.multiselect){var h=this._getMultiselectdItems();h&&h.length&&(p=h[0].$id)}if(!p){o.allowFrozenColumns&&d.options.frozen&&(r=i.find(this.$element.get(0),this.id+"_frozen_rows"));var f=r.firstChild;p=this._tr2rowId(f,d)}}if(a={col:d.$bind,row:p},this.canSelect(a,n))break;a=null}return!!a&&this._selectCell(a,null,!1,n)},v.prototype._cell=function(e,t){var n=this._mapCols[e.col],s=n.index,o=this._findTR(e.row,n.column);if(!o)return null;var r={td:o.childNodes[s],tr:o,rIndex:-1,cIndex:-1};return t&&(r.rIndex=i.indexOf(o.parentNode,o),r.cIndex=s),r},v.prototype._moveUpSelectedCell=function(e){if(!this.selectedCell)return this._selectFirstCell("keydown",null,!1,null);var t=this._colByField(this.selectedCell.col),i=this._cell(this.selectedCell,!0);if(!i)return this.selectedCell=null,this._selectFirstCell("keydown",null,!1,null);var n=Math.max(i.rIndex-e,0);if(n!=i.rIndex){var s=this._findtBody(t).childNodes[n];return this._selectCell({row:this._id2rowId(s.id),col:this.selectedCell.col},null,!1,!1)}return!1},v.prototype.resize=function(){var e=this;e.form.execLater({id:e.id+"_resize",hnd:function(){e._resize()}})},v.prototype._updateFrozenColumnsHeight=function(){var e=this.renderOptions;if(this._scrollableFrozenContent){if(!(e.height&&"auto"!==e.height||e.minHeight))return;var t=void 0;t=this._scrollableMaster.scrollWidth>this._scrollableMaster.clientWidth?i.scrollbar()+"px":"0px",this._deltaHScrollContent.style.height!==t&&(this._deltaHScrollContent.style.height=t,this._vscroll())}},v.prototype._resize=function(){var e=this.renderOptions;if(e.scrolling&&e.scrolling.vertical&&(this.$element||console.log("Invalid resize call"),this._scrollableMaster)){i.position(this._scrollableMaster,null);if(e.bottom){var t=i.documentViewSize();if(this._scrollableMaster){var n=i.position(this._scrollableMaster,null),s=(this.$element.get(0),Math.max(0,t.height-n.top-e.bottom));this._scrollableMaster.style.height=s+"px",this._scrollableFrozenContent&&(this._scrollableFrozenContent.style.height=s+"px")}}if(a.hasFrozenColumns(e,this.frozenColumns)){i.scrollbar()&&this._updateFrozenColumnsHeight(),this._vscroll()}}},v.prototype.syncHeaderAndFrozenScroll=function(e){this._scroller&&"master"!==this._scroller||(this._scroller="master",this._hscroll(),this._vscroll(),this._removeScroller())},v.prototype.syncMasterScroll=function(e){this._scroller&&"frozen"!==this._scroller||(this._scroller="frozen",this._vsmcroll(),this._removeScroller())},v.prototype._removeScroller=function(){var e=this;e.fieldOptions.editing?(e._rsTimer&&window.clearTimeout(e._rsTimer),e._rsTimer=window.setTimeout(function(){e._scroller=null,e._rsTimer=null},50)):e._scroller=null},v.prototype._vscroll=function(){if(this._scrollableFrozenContent){var e=this._scrollableMaster.scrollTop;e!==this._scrollableFrozenContent.scrollTop&&(this._scrollableFrozenContent.scrollTop=e)}},v.prototype._vsmcroll=function(){var e=this._scrollableMaster.scrollTop,t=this._scrollableFrozenContent.scrollTop;e!==t&&(this._scrollableMaster.scrollTop=t)},v.prototype._hscroll=function(){var e=this._scrollableMaster.scrollLeft;if(e!==this._scrollableHeaderOfMaster.scrollLeft&&(this._scrollableHeaderOfMaster.scrollLeft=e),this._scrollableFooterOfMaster){e!==this._scrollableFooterOfMaster.scrollLeft&&(this._scrollableFooterOfMaster.scrollLeft=e)}},v.prototype._moveDownSelectedCell=function(e){if(!this.selectedCell)return this._selectFirstCell("keydown",null,!1,null);var t=this._cell(this.selectedCell,!0);if(!t)return this.selectedCell=null,this._selectFirstCell("keydown",null,!1,null);var i=this._colByField(this.selectedCell.col),n=this._findtBody(i),s=Math.min(t.rIndex+e,n.childNodes.length-1);if(s!=t.rIndex){var o=n.childNodes[s];return this._selectCell({row:this._id2rowId(o.id),col:this.selectedCell.col},null,!1,!1)}return!1},v.prototype._moveRightSelectedCell=function(e){if(!this.fieldOptions.selecting||!this.fieldOptions.selecting.cell)return!1;if(!this.selectedCell)return this._selectFirstCell("keydown",null,e,null);var t=this.frozenColumns.concat(this.columns).map(function(e){return e.$bind}),i=t.indexOf(this.selectedCell.col),n=this._findById(this.selectedCell.row);if(!n||i<0)return!1;for(var s=i+1,o=t.length;s<o;s++){var r={col:t[s],row:n.$id};if(this.canSelect(r,e))return this._selectCell(r,null,!1,e)}if(n=this._findNext(n.$id))for(s=0,o=i;s<=o;s++){r={col:t[s],row:n.$id};if(!e||this.canSelect(r,e))return this._selectCell(r,null,!1,e)}return!1},v.prototype._moveLeftSelectedCell=function(e){if(!this.fieldOptions.selecting||!this.fieldOptions.selecting.cell)return!1;if(!this.selectedCell)return this._selectFirstCell("keydown",null,e,null);var t=this.frozenColumns.concat(this.columns).map(function(e){return e.$bind}),i=t.indexOf(this.selectedCell.col),n=this._findById(this.selectedCell.row);if(!n||i<0)return!1;for(var s=i-1;s>=0;s--){var o={col:t[s],row:n.$id};if(this.canSelect(o,e))return this._selectCell(o,null,!1,e)}if(n=this._findPrev(n.$id))for(s=t.length-1;s>=i;s--){o={col:t[s],row:n.$id};if(this.canSelect(o,e))return this._selectCell(o,null,!1,e)}return!1},v.prototype.getSubControls=function(){return this.toolBar&&this.toolBar.getSubControls?this.toolBar.getSubControls():null},v.prototype.addSubControls=function(e){this.toolBar.addSubControls(e)},v.prototype.getChildren=function(){return this.toolBar?this.toolBar.getChildren():null},v.prototype._state2UI=function(e){var t=this._rootElement(),n=this.$element?this.$element.get(0):null;if(t&&(this._setDisabled(t,n),this.setHidden(n),this._setErrors(t,n),e||this._selectFirstCell("model",null,!1,null),this._renderToolbar(),this._pager)){var s=$(i.find(n,this.id+"_pagination"));this._pager.render(s)}},v.prototype.afterAddedInDom=function(){this._selectFirstCell("model",null,!0,null)},v.prototype._isHidden=function(){return this.state.isHidden||!this.state.value||this.renderOptions.hideWhenNoRows&&!this.state.value.length},v.prototype.setHidden=function(e){if(e){this._isHidden()?i.addClass(e,"bs-none"):i.removeClass(e,"bs-none")}},v.prototype.stateChanged=function(e,t,i){if(this.$element){if(this._ignoreNotifications)return!1;var n=t.origProperty.substr(this.$bind.length);if(!(n.indexOf(".$selected")>=0)&&0!==n.indexOf(".$links")){var s=this.form.getState(this.$bind),o=this._rootElement(),r=this.$element?this.$element.get(0):null;if("columns"===e&&this.state.value&&this._setVisiblesColumns(this.state.value.columns),e||!t.isState)e&&"isHidden"!==e||s.isHidden!==this.state.isHidden&&(this.state.isHidden=s.isHidden,o&&this.setHidden(r)),e&&"isDisabled"!==e||s.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=s.isDisabled,o&&this._setDisabled(o,r)),e&&"errors"!==e||l.errorChanged(this.state.errors,s.errors)&&(this.state.errors=s.errors,this._setErrors(o,r)),e&&"orderBy"!==e||this._updateSorting();else{var a=h.parsePath(this.$bind,t.property,this.renderOptions.expandingProperty),u=i[a];if(u){var c=t.property.substr(a.length+1),d=t.origProperty.substr(t.property.length+1);this._modifyCell(u,c,d,null)}}}}},v.prototype.stopProppagation=function(e){var t=e.target,n=this.$element.get(0),s=this._gridParentFocus();if(i.isChildOf(s,e.target))for(;t;){if(t===n)return;t.href&&(e.preventDefault(),e.stopPropagation()),t=t.parentNode}},v.prototype._buildView=function(e,t,i,n,s){var o={level:i,value:e};n=n||this._view,s=s||this._viewMap,n.push(o),s[e.$id]=o},v.prototype._findById=function(e){if(!this.state.value)return null;if(this._useView){var t=this._viewMap[e];return t?t.value:null}return this.state.value.findById(e)},v.prototype._findByIdEx=function(e){if(!this.state.value)return null;var t={index:-1,level:0,value:null};if(this._useView){var i=this._viewMap[e];i&&(t.index=this._view.indexOf(i),t.level=i.level,t.value=i.value)}else t.value=this.state.value.findById(e),t.value&&(t.index=this.state.value.indexOf(t.value));return t},v.prototype._findNext=function(e){if(!this.state.value)return null;if(this._useView){if(i=this._viewMap[e]){var t=this._view.indexOf(i);if(this._view.length>t+1)return this._view[t+1].value}}else{var i;if(i=this.state.value.findById(e)){t=this.state.value.indexOf(i);if(this.state.value.length>t+1)return this.state.value.get(t+1)}}return null},v.prototype._findPrev=function(e){if(!this.state.value)return null;if(this._useView){if(t=this._viewMap[e]){if((i=this._view.indexOf(t))>0)return this._view[i-1].value}}else{var t;if(t=this.state.value.findById(e)){var i;if((i=this.state.value.indexOf(t))>0)return this.state.value.get(i-1)}}return null},v.prototype._renderTotalRows=function(){if(this.$element){var e=this.renderOptions;if(this._totalProperty){var t=this.form.getValue(this._totalProperty);this._totalIsArray||(t=[t||{}]);var n=!!this._totalField||!!this._stopField,s=void 0,o=void 0;a.hasFrozenColumns(this.renderOptions,this.frozenColumns)&&(n=!1,(s=i.find(this.$element.get(0),this.id+"_frozen_totals"))&&(o=a.createRows(this.id,t,this.frozenColumns,e,this.options.design,this.form.$locale,!0,!0,null,null,null),i.empty(s),i.append(s,o))),s=i.find(this.$element.get(0),this.id+"_totals"),o=a.createRows(this.id,t,this.columns,e,this.options.design,this.form.$locale,!1,!0,null,n?this._totalField:null,n?this._stopField:null),i.empty(s),i.append(s,o)}}},v.prototype._renderRows=function(e,t,n,s){var o=this;if(o.$element){var r=o.renderOptions,l=null;e&&(o._view=[],o._viewMap={},o._useView=!0,l=o._buildView.bind(o));var u=void 0,c=void 0;if(o._inplaceEditRemove(!1,!1,!0),o._destroyDetails(),a.hasFrozenColumns(o.renderOptions,o.frozenColumns)&&(u=i.find(o.$element.get(0),o.id+"_frozen_rows")))if(e)c=o.state.value?a.createRows(o.id,o.state.value,o.frozenColumns,r,o.options.design,o.form.$locale,!0,!1,l,null,null):null,l=null,i.empty(u),c&&i.append(u,c);else{c=a.createBulkRows(o.id,n,o.frozenColumns,r,o.options.design,o.form.$locale,!0,!1,l);var d=i.find(u,t+"_frozen");i.after(d,c)}if(u=i.find(o.$element.get(0),o.id+"_rows"),e)c=o.state.value?a.createRows(o.id,o.state.value,o.columns,r,o.options.design,o.form.$locale,!1,!1,l,null,null):null,i.empty(u),c&&i.append(u,c);else{c=a.createBulkRows(o.id,n,o.columns,r,o.options.design,o.form.$locale,!1,!1,l);d=i.find(u,t);i.after(d,c)}}if(!e){var p=o._viewMap[t],h=o._view.indexOf(p);o._view.splice(h,0,n),n.forEach(function(e){o._viewMap[e.value.$id]=e})}o._updateMultiselectSummary(s)},v.prototype.editDetail=function(e){var t=this,s=e.$id;if(t.$element){var o=t.renderOptions;if(a.hasFrozenColumns(o,t.frozenColumns))return;var r=i.find(t.$element.get(0),t.id+"_rows"),l=i.find(r,s+"_detail");if(l)return;var u=i.find(r,s);if(u){l=a.createDetail(s,u);var d=t.renderOptions.rows;if(!d||!d.detail||!d.detail.layout)throw new Error('Grid options missing: "options.rows.detail.layout".');var p=d.detail.layout;"string"==typeof p&&t.renderOptions.layouts&&t.renderOptions.layouts[p]&&(p=t.renderOptions.layouts[p]),"object"==typeof p&&((p=$.extend(!0,{},p)).name&&(p._name=p.name),p.name=s);var h=e.getSchema();"object"==typeof h&&(h.links=h.links||{},h.links.$updateChanges=h.links.$updateChanges||{title:c.ui.ApplyDetailChanges});var f={};d.detail.spacing&&(f.verticalSpacing=!0),f.closeButtonHandler=function(){t.closeDetail(s)},p._name&&(f.externalLayout=p._name,f.externalSchema=t.form.options.externalSchema,f.externalLocale=t.form.options.externalLocale),f.path=t.$bind,t._details.push(s),n.OpenForm($(l.firstChild),p,t.form.$schema,e.schemaModel(!0),t.form.$locale,function(i,n,o){if("init"===i.operation)t.form.execAction("$links.$beforeEdit",n,n);else switch(i.property){case"$links.$updateChanges":if(!t.state.value.updateItem(e,n))return;e.update(n.schemaModel(!1)),t.form.execAction("$links.$afterUpdateChanges",e,e),t.closeDetail(s)}},f),i.after(u,l)}}},v.prototype.closeDetail=function(e){if(this._destroyDetailById(e),this.$element){var t=i.find(this.$element.get(0),e+"_detail");t&&i.remove(t)}},v.prototype._removeRow=function(e){var t=this;if(t._destroyDetailById(e),t._viewMap){var n=t._viewMap[e];if(n){delete t._viewMap[e];var s=t._view.indexOf(n);s>=0&&t._view.splice(s,1)}}if(t.$element){var o=[],r=i.find(t.$element.get(0),e);r&&o.push({element:r,columns:t.columns}),a.hasFrozenColumns(t.renderOptions,t.frozenColumns)&&(r=i.find(t.$element.get(0),e+"_frozen"))&&o.push({element:r,columns:t.frozenColumns}),o.forEach(function(n){var s=n.element.parentNode,o=i.find(s,e+"_detail");if(o&&i.remove(o),s.firstChild===n.element&&t.renderOptions.headerIsHidden&&!t.renderOptions._useColGrp&&s.childNodes.length>1){var r=s.childNodes[1];n.columns.forEach(function(e,t){var i=r.childNodes[t];e.options.width&&(i.style.width=a.ensureWidth(e.options.width)),e.options.minWidth&&(i.style.minWidth=a.ensureWidth(e.options.minWidth))})}i.remove(n.element)})}},v.prototype._updOddEven=function(){if(!this.renderOptions._useStripedCss&&this.renderOptions.striped&&this.$element){var e=i.find(this.$element.get(0),this.id+"_rows");a.updateEvenOdd(e),(e=i.find(this.$element.get(0),this.id+"_frozen_rows"))&&a.updateEvenOdd(e)}},v.prototype._updOddEvenLater=function(){var e=this;e.form.execLater({id:e.id+"_odd_even",hnd:function(){e._updOddEven()}})},v.prototype._createRow=function(e){if(this.$element){var t=0,n=this._viewMap[e.$id];n?n=this._viewMap[e.$id]:(n={level:0,value:e},this._view.push(n),this._view.push(e.$id),t=this._view.length-1,this._viewMap[e.$id]=n);var s=void 0,o=void 0;a.hasFrozenColumns(this.renderOptions,this.frozenColumns)&&(s=i.find(this.$element.get(0),this.id+"_frozen_rows"),o=a.createRow(this.id,t,n.level,n.value,this.frozenColumns,this.renderOptions,this.options.design,this.form.$locale,s.childNodes.length%2==1,!0,!1),i.append(s,o)),s=i.find(this.$element.get(0),this.id+"_rows"),o=a.createRow(this.id,t,n.level,n.value,this.columns,this.renderOptions,this.options.design,this.form.$locale,s.childNodes.length%2==1,!1,!1),i.append(s,o)}},v.prototype.filtrableColumns=function(){var e=this.$schema,t=this.$schemaItems;return e&&"array"===e.type&&t&&"object"===t.type?h.filtrableFields(t,this.form.$rootSchema,this.form.$locale):[]},v.prototype._getColumnsFromSchema=function(){var e=this.$schema,t=this.$schemaItems;return e&&"array"===e.type&&t&&"object"===t.type?h.columns(t,this.form.$rootSchema,this.form.$locale):[]},v.prototype._getSelectedColumns=function(){var e=this,t={};return Object.keys(e._mapCols).forEach(function(i){var n=e._mapCols[i].column;n.options._expandItem&&n.options.display&&(i=n.options.display),t[i]=!0}),t},v.prototype._getGroupsFromSchema=function(){var e=this.$schema,t=this.$schemaItems;return e&&"array"===e.type&&t&&"object"===t.type&&t.groups?t.groups:{}},v.prototype.getColumnsForSettings=function(){return{schemaGroups:this._getGroupsFromSchema(),schemaColumns:this._getColumnsFromSchema(),selectedColumns:this._getSelectedColumns(),locale:this.form.$locale}},v.prototype.getColumnsForFilter=function(e){var t={schemaGroups:this._getGroupsFromSchema(),schemaColumns:this.filtrableColumns(),locale:this.form.$locale,mongoFilter:e,filters:void 0};return e&&f.glbMongoFilter2Filter&&(t.filters=f.glbMongoFilter2Filter(this.state.value.filter,this.filtrableColumns())),t},v.prototype.getColumnsForFilterExpress=function(e){var t;if(e&&Array.isArray(e)){var i=this._getColumnsFromSchema();t=[],e.forEach(function(e){i.every(function(i){return e!==i.name||(t.push(i),!1)})})}else t=this._getColumnsFromSchema();var n=[];return t.forEach(function(e){var t=e.schema,i={code:e.name,lib:t.title||t.name,type:t.type,selected:!0};t.enum&&(i.enum=t.enum),t.enumNames&&(i.enumNames=t.enumNames),n.push(i)}),n},v.prototype._updateSorting=function(){var e=this.renderOptions;if(this.$element&&e&&e.sorting&&!e.headerIsHidden){if(!this.state.value)return;var t=i.find(this.$element.get(0),this.id+"_cols");t&&a.updSorting(e,t,this._colByField.bind(this),this.state.value.$orderby()),(t=i.find(this.$element.get(0),this.id+"_frozen_cols"))&&a.updSorting(e,t,this._colByField.bind(this),this.state.value.$orderby())}},v.prototype._renderColumns=function(e){if(this._inplaceEditRemove(!1,!1,!0),e._useColGrp){var t=e.scrolling&&e.scrolling.vertical,n=t&&!e.headerIsHidden?i.find(this.$element.get(0),this.id+"_colgrp_header"):null;if(n&&(i.empty(n),i.append(n,a.createColGroup(this.columns,e,!1))),n=i.find(this.$element.get(0),this.id+"_colgrp"),i.empty(n),i.append(n,a.createColGroup(this.columns,e,!1)),e.total&&e.total.property&&(n=i.find(this.$element.get(0),this.id+"_colgrp_footer"))&&(i.empty(n),i.append(n,a.createColGroup(this.columns,e,!0))),a.hasFrozenColumns(e,this.frozenColumns)){var s=t&&!e.headerIsHidden?i.find(this.$element.get(0),this.id+"_colgrp_frozen_header"):null;s&&(i.empty(s),i.append(s,a.createColGroup(this.frozenColumns,e,!0))),(s=i.find(this.$element.get(0),this.id+"_colgrp_frozen"))&&(i.empty(s),i.append(s,a.createColGroup(this.frozenColumns,e,!0))),e.total&&e.total.property&&(s=i.find(this.$element.get(0),this.id+"_colgrp_frozen_footer"))&&(i.empty(s),i.append(s,a.createColGroup(this.frozenColumns,e,!0)))}}if(!e.headerIsHidden){var o=i.find(this.$element.get(0),this.id+"_cols");i.empty(o),i.append(o,a.createCols(this.id,this.columns,e,this.options.design,this.form.$locale,this.state.value?this.state.value.$orderby():null,!1)),a.hasFrozenColumns(e,this.frozenColumns)&&(o=i.find(this.$element.get(0),this.id+"_frozen_cols"))&&(i.empty(o),i.append(o,a.createCols(this.id,this.frozenColumns,e,this.options.design,this.form.$locale,this.state.value?this.state.value.$orderby():null,!0)))}e.allowFrozenColumns&&a.updateFrozenWidth(this.$element.get(0),this.id,this.frozenColumns)},v.prototype.toggleMultiselect=function(){var e=this;if(e.$element){var t=e.renderOptions;if(t.selecting&&t.selecting.row){if(t.selecting.multiselect=!t.selecting.multiselect,e.state.value){var i=e.state.value;i.selecting(!0,t.expandingProperty);try{e.state.value.updateSelecting(t.selecting.multiselect,t.expandingProperty)}finally{i.selecting(!1,t.expandingProperty)}}e.savePreferences(function(){e._refreshGrid()})}}},v.prototype.render=function(e){var t=this._initOptions(o.utils.defaultOptions);return this.$element||(this.$schema.description&&(t.description=s.tt(this.$schema.description,this.form.$locale)),this.$element=$(a.gridContainer(this.id,t,this.options.design,this.$schema.title,this.form.$locale,this.columns,this.frozenColumns)),this._renderColumns(t),this._renderRows(!0,"",null,!0),this._renderTotalRows(),this._state2UI(!0),this.setEvents(t)),this.appendElement(e,t),this.$element},v}(e.ui.AbsField);f.BasicGrid=m,n.registerControl(m,"array",!1,"",null),n.registerControl(m,"array",!1,"basicgrid",null)}(e.formgrid||(e.formgrid={}))}(Phoenix||(Phoenix={}));!function(e){var t,i=e.utils,n=e.ui,s=e.dom,o=e.ulocale,r=e.Observable.errorsUtils,a=e.uiutils;!function(t){var l=function(t){__extends(n,t);function n(e,i,n){var s=t.call(this,e,i,n)||this;return s._state(),s}return n.prototype._input=function(){if(!this.$element)return null;var e=this.$element.get(0);return s.find(e,this.id+"_input")},n.prototype._check=function(){if(!this.$element)return null;var e=this.$element.get(0);return s.find(e,this.id+"_check")},n.prototype.click=function(e){var t=this._input(),i=t.checked||!1;e.target==t&&this.state.value!=i&&(this._isBinded?(this.state.value=i,this.form.setValue(this.$bind,i)):this.setInternalValue(i,!0))},n.prototype._setDisabled=function(e,t){var i=this._check();this.state.isDisabled||this.state.isReadOnly?s.addClass(i,"disabled"):s.removeClass(i,"disabled"),e.disabled=this.state.isDisabled},n.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},n.prototype._setMandatory=function(e,t){},n.prototype._setErrors=function(t){var i=this.state.errors;if(t&&e.bootstrap4){i&&i.length?s.addClass(t,"is-invalid"):s.removeClass(t,"is-invalid")}this.showErrors(t,i)},n.prototype._state2UI=function(){var e=this._input(),t=this.$element?this.$element.get(0):null;e&&(e.checked=this.state.value||!1,this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setErrors(t))},n.prototype.changed=function(e,t,i,n){var s=this._input();this.state.value!=i&&(this.state.value=i,s&&(s.checked=this.state.value||!1))},n.prototype.stateChanged=function(e,t){var i=this._isBinded?this.form.getState(this.$bind):this._internalState,n=this._input(),s=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(s)),i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n,s)),i.isReadOnly!=this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,n&&this._setReadOnly(n,s)),i.isMandatory!=this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,n&&this._setMandatory(n,s)),e&&"errors"!==e||r.errorChanged(this.state.errors,i.errors)&&(this.state.errors=i.errors,this._setErrors(s))},n.prototype.render=function(t){var n=this._initOptions(a.utils.defaultOptions);return this.$element||(this.$element=$(function(t,n,s,o){e.bootstrap4,o=o||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var r=[];return a.utils.fieldWrapper(r,n,s,function(){n.columns&&r.push('<div class="no-x-padding ml-sm-auto col-sm-'+(12-n.labelCol)+'">'),r.push('<div id="{0}_check" class="custom-control custom-checkbox">'),r.push('<input type="checkbox" id="{0}_input" class="custom-control-input">'),r.push('<label class="custom-control-label" for="{0}_input"> '),r.push(i.escapeHtml(o||"")),r.push("&nbsp;"),r.push("</label>"),r.push("</div>"),a.utils.addErrorDiv(r,!1),n.columns&&r.push("</div>")}),i.format(r.join(""),t)}(this.id,n,this.options.design,o.tt(this.$schema.title,this.form.$locale))),this._state2UI()),this.appendElement(t,n),this.$element},n}(e.ui.AbsField);t.Check=l,n.registerControl(l,"boolean",!1,"",null)}(t||(t={}))}(Phoenix||(Phoenix={}));!function(e){var t;!function(t){e.utils;var i=e.ui,n=e.dom,s=e.uiutils,o=e.Observable.errorsUtils,r=e.gridrender.GridUtil,a=e.Observable.SchemaUtils,l=function(t){__extends(l,t);function l(e,i,n){var s=t.call(this,e,i,n)||this,o=s,r=o.fieldOptions;o._initAllColumns(),o._state();var a=r.columns.header.fields||[];r.columns.header.fields=o.form.afterSettings(o.$bind,"columngrid",{columns:a}).columns;var l=o.form.getFieldSettings(o.$bind);return l&&(o._settings=o.form.afterSettings(o.$bind,"columngrid",l)),o._initRows(),s}return l.prototype._initSchemaRows=function(e){var t=this;t.rows=[],e.forEach(function(e,i){t.rows[i]={name:e.name,canEdit:e.canEdit,check:e.check,schema:a.getSchema(e.name,t.$schemaItems,t.form.$rootSchema,!1)||{}}})},l.prototype._colByName=function(e){for(var t=0,i=this.rows.length;t<i;t++){var n=this.rows[t];if(n.name===e)return n}return null},l.prototype.setSettings=function(e){this._rrender()},l.prototype._initRows=function(){if(!this.rows){var e=this.fieldOptions;e.columns||(e.columns={}),e.columns.header||(e.columns.header={}),e.columns.row||(e.columns.row={});var t=e.columns.header.fields||[];this._settings&&this._settings.columns&&this._settings.columns.length&&(t=this._settings.columns),this._initSchemaRows(t)}},l.prototype._initCols=function(e){var t=this;e.columns||(e.columns={}),e.columns.header||(e.columns.header={}),e.columns.row||(e.columns.row={});var i=$.extend({},e.columns.header),n=e.columns.row;i.options=i.options||{},n.options=n.options||{};var o,r=n.$bind;n.$bind?o=a.getSchema(n.$bind,t.$schemaItems,t.form.$rootSchema,!1):(r="$index",o={type:"integer"});var l=[];return l.push(i),t.state.value&&t.state.value.forEach(function(e){var i=s.utils.displayValue(e.getRelativeValue(r),o,t.form.$locale,{html:!1},e,r).value,a=$.extend({},n);a.title=i||"",a.id=e.$id,l.push(a)}),l},l.prototype._modifyRow=function(e,t,i,o,r,a,l){var u=n.find(this.$element.get(0),this.id+"_rows").childNodes[i].childNodes[o],c=s.utils.displayValue(e,t,this.form.$locale,{html:!0,useSymbol:!1,editable:r.editable,check:r.check,tableOptions:this.config.options},a,l);if(n.empty(u),c.html){var d=$(c.value);n.append(u,d.get(0))}else n.append(u,document.createTextNode(c.value))},l.prototype.changed=function(e,t,i,n,s){var o=this;if("upd"===n){var r=s&&s.$id?o.state.value.findById(s.$id):null;r&&o.rows.forEach(function(e,t){e.name===s.property&&o._modifyRow(r.getValue(e.name),e.schema,t,o.state.value.indexOf(r)+1,{editable:e.canEdit,check:e.check},r,e.name)})}},l.prototype._grid=function(){return this.$element.get(0)},l.prototype._setErrors=function(t,i){var s=this.state.errors;if(i&&e.bootstrap4){s&&s.length?n.addClass(i,"is-invalid"):n.removeClass(i,"is-invalid")}this.showErrors(i,s)},l.prototype.click=function(e){var t=n.parentByTag(this.$element.get(0),e.target,"td");if(t){var i=n.attr(t,"colId");if(i){var s=this._colByName(i);if(s&&s.canEdit&&a.isBoolean(s.schema)&&n.attr(e.target,"data-clickable")){var o=n.attr(t,"rowId"),r=o?this.state.value.findById(o):null;if(r){var l=r.getValue(s.name);r.setValue(s.name,!l)}}}}},l.prototype._setDisabled=function(e,t){},l.prototype._state2UI=function(){var e=this._grid(),t=this.$element?this.$element.get(0):null;e&&(this._setDisabled(e,t),this.setHidden(t),this._setErrors(e,t))},l.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this._grid(),s=this.$element?this.$element.get(0):null;e&&"isHidden"!==e||i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(s)),e&&"isDisabled"!==e||i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n,s)),e&&"errors"!==e||o.errorChanged(this.state.errors,i.errors)&&(this.state.errors=i.errors,this._setErrors(n,s))},l.prototype._renderRows=function(){if(this.$element){var e=n.find(this.$element.get(0),this.id+"_rows");n.empty(e),n.append(e,r.createGridRows(this.id,this.rows,this.state.value,this.columns,this.renderOptions,this.options.design,this.form.$locale))}},l.prototype._draw=function(e){if(this.columns=this._initCols(this.fieldOptions),e._useColGrp){var t=n.find(this.$element.get(0),this.id+"_colgrp");n.empty(t),n.append(t,r.createColGroup(this.columns,e,!1))}if(!e.headerIsHidden){var i=n.find(this.$element.get(0),this.id+"_cols");n.empty(i),n.append(i,r.createCols(this.id,this.columns,e,this.options.design,this.form.$locale,"",!1))}this._renderRows(),this._state2UI()},l.prototype._rrender=function(){this.$element&&this._draw(this.renderOptions)},l.prototype.render=function(e){var t=this._initOptions(s.utils.defaultOptions);if(!this.$element)return this.columns=this._initCols(this.fieldOptions),this.$element=$(r.gridContainer(this.id,t,this.options.design,this.$schema.title,this.form.$locale,this.columns,null)),this._draw(t),this.appendElement(e,t),this.$element},l.prototype._createRow=function(e){if(this.$element){var t=n.find(this.$element.get(0),this.id+"_rows"),i=r.createRow(this.id,e,0,this.state.value.get(e),this.columns,this.renderOptions,this.options.design,this.form.$locale,e%2==1,!1,!1);t.childNodes.length>=e?n.append(t,i):n.before(t.childNodes[e],i)}},l.prototype._initAllColumns=function(){var e=this,t=e.fieldOptions;e._allColumns=[],e._allColumnsNames=[],t.columns||(t.columns={}),t.columns.header||(t.columns.header={});t.columns.header.allFields.forEach(function(t){e._allColumns.push($.extend({},t)),e._allColumnsNames.push(t.name)})},l.prototype._selectedColumns=function(){var e=this,t=[],i=[];return e.rows.forEach(function(e){t.push(e.name)}),e._allColumns.forEach(function(n){var s=a.getSchema(n.name,e.$schemaItems,e.form.$rootSchema,!1);t.indexOf(n.name)>=0&&i.push({name:n.name,title:s.title})}),i},l.prototype._initDataSettings=function(){var e=this,t={columns:[]},i=[];return e.rows.forEach(function(e){i.push(e.name)}),e._allColumns.forEach(function(n){var s=a.getSchema(n.name,e.$schemaItems,e.form.$rootSchema,!1);t.columns.push({name:n.name,caption:s.title,$select:i.indexOf(n.name)>=0})}),{schema:{properties:{columns:{type:"array",items:{type:"object",properties:{name:{type:"string"},caption:{type:"string"}}}}}},data:t,layout:{$type:"block",$items:[{$type:"block",$items:[]},{$type:"block",$items:[{$bind:"columns",$widget:"basicgrid",options:{border:!0,align:"middle",small:!0,noRowSelectedIndicator:!0,headerIsHidden:!0,selecting:{row:!0,multiselect:!0},columns:[{$bind:"caption",options:{width:"100%"}}]}}]},{$type:"block",$items:[]}]}}},l.prototype.sendMessage=function(e,t){switch(e){case"column-list":this.openColumns(t);break;case"selected-cols":return this._selectedColumns()}},l.prototype.stopProppagation=function(e){e.preventDefault(),e.stopPropagation()},l.prototype.openColumns=function(e){var t=this,n=t._initDataSettings(),s={title:e.title||"Columns ...",buttons:[{type:"success",title:e.okTitle||"OK",name:"ok"}]};i.OpenModalForm(s,n.layout,n.schema,n.data,{},function(e,i,n,s){if("modal-action"===i.operation)switch(i.property){case"ok":var o={columns:[]};n.columns.forEach(function(e){if(e.$select){var i=t._allColumnsNames.indexOf(e.name);i>=0&&o.columns.push($.extend({},t._allColumns[i]))}}),t._settings=o,t.form.setFieldSettings(t.$bind,t._settings),t.form.savePrefs(function(){t._settings=t.form.afterSettings(t.$bind,"columngrid",o),t.rows=null,t._initRows(),e.close(),t._rrender()})}})},l}(e.ui.AbsField);i.registerControl(l,"array",!1,"columngrid",null)}(t||(t={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=(i.serial,i.utils),s=i.dom,o=i.locale,r=i.Observable.SchemaUtils,a=i.ulocale,l=i.ui,u=i.uiutils,c=i.Observable.errorsUtils,d=function(e,t,o,r,a){r=r||"";var l=[];return(t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t)).titleIsHidden&&(t.columns=!1),t.readOnly&&(delete t.after,delete t.before),u.utils.fieldWrapper(l,t,o,function(){var e=i.bootstrap4;if(!t.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var o=["bs-label"];t.columns&&(e?o.push("col-form-label"):o.push("checkbox-inline bs-cursor-d"),o.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&o.push("text-left")),t.inline&&(e?o.push("form-check-inline bs-cursor-d no-x-padding"):o.push("checkbox-inline bs-cursor-d no-x-padding")),o.length&&l.push(' class="'+o.join(" ")+'"'),l.push(">"),l.push(n.escapeHtml(r||"")+(t.inline?"&nbsp;":"")),u.utils.addTooltipAndRule(l,t),l.push("</label>")}t.columns&&l.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'" id="{0}_colparent">'),function(e,t,n,o){var r=i.bootstrap4,a="textarea"===(o=o||"input");t.readOnly&&(o="div"),a&&(t.before||t.after)&&(delete t.before,delete t.after);var l="date-time"===t.$format,c="date"===t.$format;if(("money"===t.$format||c||l)&&void 0===t.maxWidth&&(t.maxWidth="16em"),t.before||t.after){e.push('<div class="input-group" id="{0}_group"');var d=[];t.minWidth&&d.push("min-width: "+t.minWidth+";"),t.maxWidth&&d.push("max-width: "+t.maxWidth+";"),d.length&&e.push('  style="'+d.join("")+'"'),e.push(">")}t.before&&(e.push('<span class="bs-grp-btn input-group-prepend">'),e.push('<span class="input-group-text">'),t.before.icon?e.push('<span class="'+s.iconClass(t.before.icon)+'"></span>'):e.push(t.before.value),e.push("</span>"),e.push("</span>"));var p=["form-control"];t.size&&r&&p.push("form-control-"+t.size),t.inputClass&&p.push(t.inputClass),t.readOnly&&p.push("bs-read-only"),e.push("<"+o+' autocomplete="off"'+(t.readOnly?"":' type="'+(t.type||"text")+'"')+' class="'+p.join(" ")),e.push('" id="{0}_input"'),a&&e.push(' rows="'+(t.rows||3)+'"'),t.before||t.after||(d=[],t.maxWidth&&d.push("max-width: "+t.maxWidth+";"),t.minWidth&&d.push("min-width: "+t.minWidth+";"),a&&t.noResize&&d.push("resize: none;"),d.length&&e.push('  style="'+d.join("")+'"'));if(t.maxLength&&e.push('  maxLength="'+t.maxLength+'"'),t.placeHolder){var h=!0===t.placeHolder?n:t.placeHolder;e.push('  placeholder="'+h+'"')}e.push(">"),t.after&&(e.push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-append input-group-addon'),t.after.icon&&e.push(" bs-icon-input"),e.push('">'),e.push('<span class="input-group-text">'),t.after.icon?e.push('<span class="'+s.iconClass(t.after.icon)+'"></span>'):e.push(t.after.value),e.push("</span>"),e.push("</span>")),(t.before||t.after)&&e.push("</div>"),(a||t.readOnly)&&e.push("</"+o+">"),u.utils.addErrorDiv(e)}(l,t,r,a),t.columns&&l.push("</div>"),t.titleIsHidden&&t.inline&&u.utils.addTooltipAndRule(l,t)}),n.format(l.join(""),e)},p=function(t){__extends(i,t);function i(i,n,s){var o=t.call(this,i,n,s)||this,r=o;return r._search=i&&i.options&&i.options.search,r._search&&(r._searchEventBus=new e.serial.SingleEventBus(500)),r._state(),o}return i.prototype._input=function(){var e=this.$element?this.$element.get(0):null;return e?s.find(e,this.id+"_input"):null},i.prototype._after=function(){var e=this.$element?this.$element.get(0):null;if(!e)return null;var t=s.find(e,this.id+"_after");return t?t.firstChild:null},i.prototype._colParent=function(){var e=this.$element.get(0);return this.renderOptions.columns?s.find(e,this.id+"_colparent"):null},i.prototype._value2Text=function(){this._input();return this._isDate()?u.utils.useDatePicker()?a.parseISODate(this.state.value||"")||"":u.utils.nativeDate()?this.state.value||"":a.shortDate(this.state.value||""):this._isDateTime()?u.utils.useDateTimePicker()?a.parseISODateTime(this.state.value||"")||"":a.shortDateTime(this.state.value||""):this.state.value||""},i.prototype._isPassword=function(){return r.isPassword(this.$schema)},i.prototype._isDate=function(){return r.isDate(this.$schema)},i.prototype._isDateTime=function(){return r.isDateTime(this.$schema)},i.prototype._isMemo=function(){return r.isText(this.$schema)},i.prototype._isNumber=function(){return r.isNumber(this.$schema)},i.prototype.setFocus=function(e){if(!this.renderOptions.readOnly){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden){var i=this._input();i&&i.focus()}}},i.prototype._isMoney=function(){return r.isMoney(this.$schema)},i.prototype._setDisabled=function(e,t){this.renderOptions.readOnly||(e.disabled=this.state.isDisabled)},i.prototype._setReadOnly=function(e,t){this.renderOptions.readOnly||(e.readOnly=this.state.isReadOnly)},i.prototype._setErrors=function(t,i){if(!this.renderOptions.readOnly){var n=this.state.errors,o=e.bootstrap4?"is-invalid":"has-error";n&&n.length?(s.addClass(i,o),e.bootstrap4&&s.addClass(t,o)):(s.removeClass(i,o),e.bootstrap4&&s.removeClass(t,o)),this.showErrors(i,n)}},i.prototype._setMandatory=function(e,t){if(!this.renderOptions.readOnly){var i=this.state.isMandatory;if(e.required=i,i?s.addClass(e,"bs-mandatory"):s.removeClass(e,"bs-mandatory"),this.renderOptions.placeHolder&&(e.placeholder=this.renderOptions.title+(i?" *":"")),!this.renderOptions.titleIsHidden){var n=s.find(t,this.id+"_label");n&&s.text(n,(this.renderOptions.title||"")+(i?" *":"")+(this.renderOptions.inline?String.fromCharCode(160):""))}}},i.prototype._state2UI=function(){var e=this._input(),t=this.$element?this.$element.get(0):null;e&&(this._value2Input(e),this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setMandatory(e,t),this._setErrors(e,t),this._setSymbol(t))},i.prototype._setSymbol=function(e){if(!this.renderOptions.readOnly&&this._hasSymbol&&e){var t=this._after();t&&(this.state.symbol?s.text(t,this.state.symbol):s.text(t,String.fromCharCode(160)))}},i.prototype._value2Input=function(e){this.renderOptions.readOnly?this._isDate()?s.text(e,a.shortDate(this.state.value||"")||String.fromCharCode(160)):this._isDateTime()?s.text(e,a.shortDateTime(this.state.value||"")||String.fromCharCode(160)):(this._isNumber(),s.text(e,this._value2Text()||String.fromCharCode(160))):this._isDate()?u.utils.useDatePicker()?u.utils.datePickerSetValue(this.$element,this.state.value):u.utils.nativeDate()?e.value=a.isoDatePart(this.state.value||""):e.value=a.shortDate(this.state.value||""):this._isDateTime()?u.utils.useDateTimePicker()?u.utils.dateTimePickerSetValue($(s.find(this.$element.get(0),this.id+"_group")),this.state.value):e.value=a.shortDateTime(this.state.value||""):this._isNumber()&&u.utils.nativeNumber()?e.value=this.state.value||0:e.value=this._value2Text()},i.prototype.changed=function(e,t,i,n){if((!this.useDisplay||e!==this.$bind)&&this.$element){var s=this._input();if(i=this.form.getValue(this.$display),this.state.value!=i)this.state.value=i,this._value2Input(s);else{s.value!=this._value2Text()&&this._value2Input(s)}}},i.prototype.stateChanged=function(e,t){if(!this.useDisplay||e!==this.$display){var i=this.form.getState(this.$bind),n=this._input(),s=this.$element?this.$element.get(0):null;e&&"symbol"!==e||i.symbol!==this.state.symbol&&(this.state.symbol=i.symbol,n&&this._setSymbol(s)),e&&"decimals"!==e||i.decimals!==this.state.decimals&&(this.state.decimals=i.decimals),e&&"isHidden"!==e||i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(s)),e&&"isDisabled"!==e||i.isDisabled!==this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n,s)),e&&"isReadOnly"!==e||i.isReadOnly!==this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,n&&this._setReadOnly(n,s)),e&&"isMandatory"!==e||i.isMandatory!==this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,n&&this._setMandatory(n,s)),e&&"errors"!==e||c.errorChanged(this.state.errors,i.errors)&&(this.state.errors=i.errors,this._setErrors(n,s))}},i.prototype.destroy=function(){this._searchEventBus&&(this._searchEventBus.destroy(),this._searchEventBus=null),t.prototype.destroy.call(this)},i}(e.ui.AbsField);t.BaseEdit=p;var h=function(e){__extends(t,e);function t(t,i,n){return e.call(this,t,i,n)||this}return t.prototype.beforeAppend=function(){},t.prototype.mousedown=function(e){if(!this.renderOptions.readOnly&&(this._doSelect=!1,this.$element&&!this.state.isDisabled)){if(window.document.activeElement!==e.target){this._input()===e.target&&(this._doSelect=!0)}return!0}},t.prototype.stopProppagation=function(e){if(!this.renderOptions.readOnly&&this._doSelect){var t=this._input();s.select(t)}},t.prototype.click=function(e){if(!this.state.isDisabled&&!this.state.isReadOnly){var t=e.target;if(this.renderOptions.after&&this.renderOptions.after.$bind){var i=this._after();if(s.isChildOf(i,t)){this._afterEnter();var n=this._input();n&&n.focus()}}}},t.prototype.internalRender=function(e){var t=this._initOptions(u.utils.defaultOptions);this.$element||(t.title=a.tt(this.$schema.title,this.form.$locale),t.placeHolder&&1!=t.placeHolder&&(t.title=a.tt(t.placeHolder,this.form.$locale)),t.maxLength=this.$schema.maxLength,this.$schema.description&&(t.description=a.tt(this.$schema.description,this.form.$locale)),this.$element=$(d(this.id,t,this.options.design,t.title,t.tagName)),this.beforeAppend(),this.setEvents(t),this._state2UI()),this.appendElement(e,t)},t.prototype.render=function(e){this.internalRender(e)},t.prototype._text2value=function(e){return u.utils.text2value(e,this.$schema,this.state)},t.prototype._value2Text=function(){return this._isNumber()?r.value2Text(this.state.value,this.$schema,this.state):e.prototype._value2Text.call(this)},t.prototype.customOptions=function(t){e.prototype.customOptions.call(this,t),this._isDate()?this.customOptionsDate(t):this._isDateTime()?this.customOptionsDateTime(t):this._isNumber()?this.customOptionsNumber(t,this.state.symbol):this._isPassword()?this.customOptionsPassword(t):this._isMemo()&&this.customOptionsMemo(t)},t.prototype.customOptionsMemo=function(e){e.tagName="textarea"},t.prototype.customOptionsPassword=function(e){e.type="password"},t.prototype.customOptionsDate=function(e){e.$format="date",!u.utils.nativeDate()&&u.utils.useDatePicker()?(e.after={icon:"calendar"},e.date=!0):e.type="date"},t.prototype.customOptionsDateTime=function(e){e.$format="date-time",u.utils.useDateTimePicker()&&(e.after={icon:"calendar"},e.date=!0)},t.prototype.customOptionsNumber=function(e,t){e.inputClass="bs-edit-number",(t||r.hasSymbol(this.$schema))&&(e.after={value:t},this._hasSymbol=!0),e.$format=this.$schema.format,u.utils.nativeNumber()&&(e.type="number")},t.prototype._removeEventsDate=function(){u.utils.useDatePicker()&&u.utils.datePickerDestroy(this.$element)},t.prototype._setEventsDate=function(){var e=this;e.renderOptions.readOnly||u.utils.useDatePicker()&&u.utils.datePickerInitialize(e.$element,{showOnFocus:!0},function(t){e.focusOut(null)})},t.prototype._removeEventsDateTime=function(){this.renderOptions.readOnly||u.utils.useDateTimePicker()&&u.utils.dateTimePickerDestroy($(s.find(this.$element.get(0),this.id+"_group")))},t.prototype._setEventsDateTime=function(){var e=this;e.renderOptions.readOnly||u.utils.useDateTimePicker()&&u.utils.dateTimePickerInitialize($(s.find(e.$element.get(0),e.id+"_group")),{},function(t){e.focusOut(null)})},t.prototype.setEvents=function(e){this._isDate()?this._setEventsDate():this._isDateTime()&&this._setEventsDateTime()},t.prototype.removeEvents=function(){this._isDate()?this._removeEventsDate():this._isDateTime()&&this._removeEventsDateTime()},t.prototype.checkValue=function(e,t){t(e)},t.prototype.paste=function(e){if(!this.renderOptions.readOnly){var t=this._input();if(this.state.isReadOnly||this.state.isDisabled)return!0;if(this._isNumber()&&!this.$lookup){if(!1===u.utils.doPasteNumber(e,t,{decimalSep:o.number.decimal,thousandSep:o.number.thousand,places:this.state.decimals,schema:this.$schema}))return!1}else if(this._isDate()){if(!1===u.utils.doPasteDate(e,t,{sep:o.date.daySep,format:o.date.dateShort,schema:this.$schema}))return!1}else if(this._isPassword()&&!1===u.utils.doPastePassword(e,t,{schema:this.$schema}))return!1;return!0}},t.prototype._ignoreKeys=function(e,t){return e.which===s.keys.VK_TAB||e.which!==s.keys.VK_DELETE&&(!(!t&&e.which===s.keys.VK_BACKSPACE)&&(t?0===e.which||s.arrowKeys.indexOf(e.which)>=0:s.ignoreKeys.indexOf(e.which)>=0||s.arrowKeys.indexOf(e.which)>=0))},t.prototype.keypress=function(e){if(this.renderOptions.readOnly)return!0;if(this.state.isReadOnly||this.state.isDisabled)return!0;var t=this._input();if(this._ignoreKeys(e,!0))return!0;if(this._isNumber()&&!this.$lookup){if(!1===u.utils.keyPressNumber(e,t,{decimalSep:o.number.decimal,thousandSep:o.number.thousand,places:this.state.decimals,schema:this.$schema}))return!1}else if(this._isDate()){if(!1===u.utils.keyPressDate(e,t,{sep:o.date.daySep,format:o.date.dateShort,schema:this.$schema}))return!1}else if(this._isPassword()&&!1===u.utils.keyPressPassword(e,t,{schema:this.$schema}))return!1;return!0},t.prototype._afterEnter=function(){this._input2Model(!0),this.renderOptions&&this.renderOptions.after&&this.renderOptions.after.$bind&&this.form.execAction(this.renderOptions.after.$bind,this.state.value)},t.prototype.keydown=function(e){if(this.renderOptions.readOnly)return!0;if(this.state.isReadOnly||this.state.isDisabled)return!0;var t=this._input();if(this._ignoreKeys(e,!1))return e.which===s.keys.VK_ENTER&&this._afterEnter(),!0;if(this._isNumber()&&!this.$lookup){if(!1===u.utils.keyDownNumber(e,t,{decimalSep:o.number.decimal,thousandSep:o.number.thousand,places:this.state.decimals,schema:this.$schema}))return!1}else if(this._isDate()){if(!1===u.utils.keyDownDate(e,t,{sep:o.date.daySep,format:o.date.dateShort,schema:this.$schema}))return!1}else if(this._isPassword()&&!1===u.utils.keyDownPassword(e,t,{schema:this.$schema}))return!1;return!0},t.prototype.equals=function(e){var t=this.state.value===e;return!t&&void 0===this.state.value&&"string"===this.$schema.type&&""===e||t},t.prototype.updateModel=function(){this.form.setValue(this.$display,this.state.value)},t.prototype._internalSetValue=function(e,t){var i=this;i._searchEventBus?i._searchEventBus.push(null,function(t){i.state.value=e,i.updateModel()},t):(i.state.value=e,i.updateModel())},t.prototype._input2Model=function(e){var t=this,i=t._input(),n=t._text2value(i.value);t.equals(n)?(t._isNumber()||t._isDate()||t._isDateTime())&&t._value2Input(i):t.checkValue(n,function(n){t.state.value!==n?(""===n&&"string"===t.$schema.type&&(n=void 0),t._internalSetValue(n,e)):t._value2Input(i)})},t.prototype.focusOut=function(e){this.renderOptions.readOnly||this._input2Model(!0)},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(p);t.Edit=h,l.registerControl(h,"string",!1,"",null),l.registerControl(h,"number",!1,"",null),l.registerControl(h,"integer",!1,"",null)}(e.formedit||(e.formedit={}))}(Phoenix||(Phoenix={}));!function(e){var t,i=e.utils,n=e.dom,s=e.ui,o=(e.locale,e.uiutils),r=(e.Observable.SchemaUtils,e.ulocale),a=e.Observable.errorsUtils;!function(t){var l=function(e,t,i,s){s=s||i;var o=document.createDocumentFragment(),r=$('<div tabindex="0" class="bs-enum-list-row"><div class="bs-enum-list-check"><a><center><span class="'+n.iconClass("square-o")+'"></span></center></a></div><div class="bs-enum-list-title"></div></div>').get(0);return i.forEach(function(i,a){var l=r.cloneNode(!0);t?(n.attr(l,"tabindex","-1"),n.removeClass(l,"bs-pointer"),n.addClass(l,"bs-cursor-disabled")):(n.attr(l,"tabindex","0"),n.addClass(l,"bs-pointer"),n.removeClass(l,"bs-cursor-disabled"));l.firstChild.firstChild.firstChild.firstChild.className=e&&e.indexOf(i)>=0?n.iconClass("check-square-o"):n.iconClass("square-o");var u=l.lastChild;n.append(u,document.createTextNode(s[a])),n.append(o,l)}),o},u=function(t){__extends(s,t);function s(e,i,n){var s=t.call(this,e,i,n)||this;return s._state(),s}return s.prototype._setDisabled=function(e,t){for(var i=0,s=e.childNodes.length;i<s;i++){var o=e.childNodes[i];this.state.isDisabled?(n.attr(o,"tabindex","-1"),n.removeClass(o,"bs-pointer"),n.addClass(o,"bs-cursor-disabled")):(n.attr(o,"tabindex","0"),n.addClass(o,"bs-pointer"),n.removeClass(o,"bs-cursor-disabled"))}},s.prototype._setReadOnly=function(e,t){},s.prototype._setErrors=function(t,i){var s=this.state.errors;if(i&&e.bootstrap4){s&&s.length?n.addClass(i,"is-invalid"):n.removeClass(i,"is-invalid")}this.showErrors(i,s)},s.prototype._setMandatory=function(e,t){},s.prototype._input=function(){var e=this.$element.get(0);return n.find(e,this.id+"_input")},s.prototype._state2UI=function(e){var t=this._input(),i=this.$element?this.$element.get(0):null;t&&(e||this._setDisabled(t,i),e||this._setFilter(),this._setReadOnly(t,i),this.setHidden(i),this._setMandatory(t,i),this._setErrors(t,i))},s.prototype.mousedown=function(e){if(this.$element&&!this.state.isDisabled&&!this.state.isReadOnly){var t=window.document.activeElement,i=n.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");if(i)return t!==i&&i.focus(),!0}},s.prototype._getEnumsNames=function(){var e=this;if(!e.$schemaItems.enumNames)return null;if(e.state.filter){var t=[];return e.$schemaItems.filters[e.state.filter].forEach(function(i){t.push(e.$schemaItems.enumNames[e.$schemaItems.enum.indexOf(i)])}),t}return e.$schemaItems.enumNames},s.prototype._getEnums=function(){return this.state.filter?this.$schemaItems.filters[this.state.filter]:this.$schemaItems.enum},s.prototype._toggleEnumByIndex=function(e){var t=this._getEnums();if(e>=0&&e<t.length){var i=t[e];this.state.value.indexOf(i)>=0?this.state.value.remove(i):this.state.value.push(i)}},s.prototype.keypress=function(e){if(32==e.which){var t=n.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");if(!t)return;this._toggleEnumByIndex(n.indexOf(t.parentNode,t))}},s.prototype.click=function(e){if(this.$element&&!this.state.isDisabled&&!this.state.isReadOnly){var t=n.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");t&&this._toggleEnumByIndex(n.indexOf(t.parentNode,t))}},s.prototype.changed=function(e,t,i,s,o){if(this.$element){var r=this._input(),a=-1,u=this._getEnums(),c=this._getEnumsNames();switch(s){case"add":(a=u.indexOf(o.$id))>=0&&this._setItemValue(r.childNodes[a],!0);break;case"remove":(a=u.indexOf(o.$id))>=0&&this._setItemValue(r.childNodes[a],!1);break;case"propchange":n.empty(r),e===this.$bind&&(this.state.value=this.form.getValue(this.$bind));var d=l(this.state.value,this.state.isDisabled,u,c);n.empty(r),n.append(r,d)}}},s.prototype._setFilter=function(){this.state.filter;var e=this._getEnums(),t=[];this.state.value.forEach(function(i){e.indexOf(i)>=0&&t.push(i)}),this.form.setValue(this.$bind,t)},s.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this.$element?this.$element.get(0):null,s=n?this._input():null;e&&"isHidden"!==e||i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(n)),e&&"isDisabled"!==e||i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(s,n)),e&&"isReadOnly"!==e||i.isReadOnly!=this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly),e&&"filter"!==e||i.filter!=this.state.filter&&(this.state.filter=i.filter,n&&this._setFilter()),e&&"isMandatory"!==e||i.isMandatory!=this.state.isMandatory&&(this.state.isMandatory=i.isMandatory),e&&"errors"!==e||a.errorChanged(this.state.errors,i.errors)&&(this.state.errors=i.errors,this._setErrors(null,n))},s.prototype.render=function(t){var s=this._initOptions(o.utils.defaultOptions);if(!this.$element){this.$schema.description&&(s.description=r.tt(this.$schema.description,this.form.$locale)),this.$element=$(function(t,n,s,r){var a=e.bootstrap4;r=r||"";var l=[];return(n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},n)).titleIsHidden&&(n.columns=!1),n.placeHolder=!1,o.utils.fieldWrapper(l,n,s,function(){if(!n.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];n.columns&&(a?e.push("col-form-label"):e.push("checkbox-inline bs-cursor-d"),e.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&e.push("text-left")),n.inline&&(a?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("no-x-padding bs-cursor-d")),e.length&&l.push(' class="'+e.join(" ")+'"'),l.push(">"),l.push(i.escapeHtml(r||"")+(n.inline?"&nbsp;":"")),o.utils.addTooltipAndRule(l,n),l.push("</label>")}n.columns&&l.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),l.push('<div class="bs-enum-list-wrap" id="{0}_input">'),l.push("</div>"),o.utils.addErrorDiv(l),n.columns&&l.push("</div>")}),i.format(l.join(""),t)}(this.id,s,this.options.design,r.tt(this.$schema.title,this.form.$locale)));var a=l(this.state.value,this.state.isDisabled,this._getEnums(),this._getEnumsNames()),u=this._input();n.append(u,a),this._state2UI(!0)}return this.appendElement(t,s),this.$element},s.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.firstChild.className=t?n.iconClass("check-square-o"):n.iconClass("square-o")},s.prototype.destroy=function(){t.prototype.destroy.call(this)},s}(e.ui.AbsField);s.registerControl(u,"array",!1,"enums-list",null)}(t||(t={}))}(Phoenix||(Phoenix={}));!function(e){e.ui;var t=e.uiutils,i=e.dom;e.ulocale;function n(e,t,i){return e=e.substr(0,t)+e.substr(i,e.length-i)}function s(e,t,i){var n=l(e,i,""),s="."==t?n:n.replace(t,".");l(s,"-","");return s}function o(e,t,i,n){e||(e="0"),-1==e.indexOf(".")&&(e+="."+r("",t));var s=function(e){var t=e.split(".");""==t[0]&&(t[0]="0");return t}(e),o=function(e,t){var i="";0==e.indexOf("-")&&(i="-",e=e.substr(1,e.length-1));for(var n=0;n<e.length-1;n++){e[n];if("0"!=e[n])break}if(""==(e=e.substr(n,e.length-n)))return"0";if(e.length<=3)return i+e;for(var s=a(e),o="",n=0;n<s.length;n++)n%3==0&&n>0&&(o+=t),o+=s[n];return a(o+i)}(s[0],n),l=s[1];return l.length>t&&(l=l.substr(0,t)),l.length<t&&(l=r(l,t)),o+i+l}function r(e,t){for(var i=e.length,n=0;n<t-i;n++)e+="0";return e}function a(e){return e.split("").reverse().join("")}function l(e,t,i){for(var n="",s=0;s<e.length;s++)e[s]==t?n+=i:n+=e[s];return n}function u(e,t,i,n,s){var o=parseFloat(e);if(i){if(o<=t)return!1}else if(o<t)return!1;if(s){if(o>=n)return!1}else if(o>n)return!1;return!0}function c(e,t,n){var s=e.value,o=0;if(0!=t){for(var r=0;r<s.length&&(s[r]!=n&&t--,0!=t);r++);o=r+1}i.selectRange(e,o)}t.utils.doPasteNumber=function(e,t,i){var r=parseFloat(s(e.originalEvent.clipboardData.getData("Text"),i.decimalSep,i.thousandSep)),a="";if(r<0&&(a="-",r=-r),isNaN(r))return e.preventDefault(),!0;var l=r.toString(),d=e.target.selectionStart,p=e.target.selectionEnd,h=p-d>0?n(t.value,d,p):t.value,f=h.substr(0,d),m=s(f+r+h.substr(d,h.length),i.decimalSep,i.thousandSep);if(!u(a+m,i.schema.minimum,i.schema.exclusiveMinimum,i.schema.maximum,i.schema.exclusiveMaximum))return e.preventDefault(),!1;t.value=o(a+m,i.places,i.decimalSep,i.thousandSep),c(t,s(f,i.decimalSep,i.thousandSep).length+l.length,i.thousandSep),e.preventDefault()},t.utils.keyPressNumber=function(e,t,r){var a,l=e.target.selectionStart,d=e.target.selectionEnd,p=d-l>0,h=p?n(t.value,l,d):t.value,f="";a=h,-1!=a.indexOf("-")&&(h=h.substr(1,h.length-1),f="-",-0!=l&&(l--,d--));var m=h.substr(0,l),v=h.substr(l,h.length);if(e.key===r.decimalSep||"."===e.key)return i.selectRange(t,h.indexOf(r.decimalSep)+1+f.length),e.preventDefault(),!0;if("-"===e.key){if(0!=h.indexOf("-")){var g=s(h,r.decimalSep,r.thousandSep);if(g==function(e){for(var t="0.",i=0;i<e;i++)t+="0";return t}(r.places)||""==g){var y=o(g,r.places,r.decimalSep,r.thousandSep);t.value=y}else{if(!u("-"+g,r.schema.minimum,r.schema.exclusiveMinimum,r.schema.maximum,r.schema.exclusiveMaximum))return e.preventDefault(),!1;t.value=o("-"+g,r.places,r.decimalSep,r.thousandSep)}}return i.selectRange(t,1),e.preventDefault(),!0}if((_=e).which<48||_.which>57)return e.preventDefault(),!1;var _;if("0"===e.key&&0==l&&!p)return e.preventDefault(),!0;var $=s(m+e.key+v,r.decimalSep,r.thousandSep);if(!u(f+$,r.schema.minimum,r.schema.exclusiveMinimum,r.schema.maximum,r.schema.exclusiveMaximum))return e.preventDefault(),!1;t.value=o(f+$,r.places,r.decimalSep,r.thousandSep);var b="0"==m?0:1;return c(t,s(m,r.decimalSep,r.thousandSep).length+b,r.thousandSep),e.preventDefault(),!0},t.utils.keyDownNumber=function(e,t,r){if(e.which!=i.keys.VK_BACKSPACE&&e.which!=i.keys.VK_DELETE)return!0;var a=0;e.which==i.keys.VK_BACKSPACE&&(a=-1);var l=e.target.selectionStart,u=e.target.selectionEnd,d=u-l>0,p=d?n(t.value,l,u):t.value,h=p.substr(0,l),f=p.substr(l,p.length);if(d)return function(e,t,i,n,r,a){var l=o(s(t,r,n),a,r,n);e.value=l,c(e,s(i,r,n).length,n)}(t,p,h,r.thousandSep,r.decimalSep,r.places),e.preventDefault(),!0;if(e.which==i.keys.VK_BACKSPACE&&0==l)return e.preventDefault(),!0;if(e.which==i.keys.VK_BACKSPACE){if(p[l+a]==r.decimalSep)return i.selectRange(t,l+a),e.preventDefault(),!0}else if(p[l+a]==r.decimalSep)return i.selectRange(t,l+a+1),e.preventDefault(),!0;if(p[l+a]==r.thousandSep)return i.selectRange(t,l+1+2*a),e.preventDefault(),!0;var m="";e.which==i.keys.VK_DELETE?m=s(h+f.substr(1,f.length-1),r.decimalSep,r.thousandSep):e.which==i.keys.VK_BACKSPACE&&(m=s(h.substr(0,h.length-1)+f,r.decimalSep,r.thousandSep));var v=function(e,t,i,n,s,r,a,l){var u=parseFloat(e);if(i){if(u<=t)return o(t.toString(),r,a,l)}else if(u<t)return o(t.toString(),r,a,l);if(s){if(u>=n)return o(n.toString(),r,a,l)}else if(u>n)return o(n.toString(),r,a,l);return o(u.toString(),r,a,l)}(m,r.schema.minimum,r.schema.exclusiveMinimum,r.schema.maximum,r.schema.exclusiveMaximum,r.places,r.decimalSep,r.thousandSep);t.value=v;var g=s(h,r.decimalSep,r.thousandSep).length+a;return e.which==i.keys.VK_BACKSPACE&&0==m.indexOf(".")&&1==l&&(g=1),e.which==i.keys.VK_DELETE&&0==m.indexOf(".")&&0==l&&(g=1),c(t,g,r.thousandSep),e.preventDefault(),!0}}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.utils,n=t.ui,s=t.dom,o=t.uiutils;!function(t){var r=function(e,t){if(":"===e.charAt(0)&&(e=location.protocol+"//"+location.hostname+e),t.noCache){i.allocUuid();e.indexOf("?")>=0&&"&"}return e},a=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s._msghandler=s._onmessage.bind(s),s}return t.prototype._setDisabled=function(e){},t.prototype._setReadOnly=function(e){this._setDisabled(e)},t.prototype._setMandatory=function(e){},t.prototype._onmessage=function(e){var t=this._iframe();t&&t.contentWindow&&e.source===t.contentWindow&&e.data&&("string"==typeof e.data&&e.data.indexOf("[iFrameSizer]")>=0||this.fieldOptions&&this.fieldOptions.messages&&e.data.action&&this.fieldOptions.messages[e.data.action]&&this.form.execAction(this.fieldOptions.messages[e.data.action],e.data.action,e.data))},t.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;if(e){var t=this._iframe();t&&this.state.value&&(t.src=r(this.state.value,this.renderOptions)),this._setDisabled(e),this._setReadOnly(e),this.setHidden(e)}},t.prototype.changed=function(e,t,i,n){var o=this._iframe();if(this.state.value!==i){this.state.value=i;var a=this.$element?this.$element.get(0):null;if(o)o&&(this.state.value?o.src=r(this.state.value,this.renderOptions):o.iFrameResizer&&o.iFrameResizer.close());else if(this.state.value&&a){var l=s.find(a,this.id+"_parent"),u=$('<iframe src="'+r(this.state.value,this.renderOptions)+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>');s.append(l,u.get(0)),this._applyIResize()}}},t.prototype._applyIResize=function(){if(this.$element){if(!this._iframe())return;var e=$(this._iframe());this.state.value&&e.iFrameResize&&e.iFrameResize({})}},t.prototype.afterAddedInDom=function(){this._applyIResize()},t.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(n)),i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n)),i.isReadOnly!=this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,n&&this._setReadOnly(n)),i.isMandatory!=this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,n&&this._setMandatory(n))},t.prototype._iframe=function(){var e=this.$element.get(0);return e?e.firstChild.firstChild:null},t.prototype.setEvents=function(e){window.addEventListener("message",this._msghandler)},t.prototype.resize=function(e){if(e&&this.fieldOptions.refreshOnVisibilityChanged){var t=this._iframe();if(t){t.iFrameResizer&&t.iFrameResizer.close();var i=this.state.value;this.state.value="",this.changed(this.$bind,"",i,null)}}},t.prototype.removeEvents=function(){var e=this._iframe();e&&e.iFrameResizer&&e.iFrameResizer.close(),window.removeEventListener("message",this._msghandler)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._msghandler=null},t.prototype.render=function(e){var t=this._initOptions(o.utils.defaultOptions);return this.$element||(t.src=this.state.value,this.$element=$(function(e,t,n){var s=[];return o.utils.fieldWrapper(s,t,n,function(){s.push('<div id="{0}_parent">'),t.src&&s.push('<iframe scrolling="no" width="100%" frameBorder="0" border="0"></iframe>'),s.push("</div>")},null),i.format(s.join(""),e)}(this.id,t,this.options.design)),this._state2UI(),this.setEvents(t)),this.appendElement(e,t),this.$element},t}(e.ui.AbsField);n.registerControl(a,"string",!1,"iframe",{})}(e.frame||(e.frame={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.utils,n=t.dom,s=t.ui,o=t.autoclose,r=t.pagecontrol,a=t.Observable,l=t.data,u=t.formgrid,c=a.SchemaUtils,d=t.locale;!function(e){var t={name:"$lookup",form:!0,datasets:{list:{$main:!0,$type:"odata",$method:"GET",$params:{$entity:"Country",$module:"",$top:5,$orderby:"",$searchByFields:void 0,$allData:!1}}},$type:"block",$items:[{$type:"block",$items:[{$bind:"search",$widget:"search",options:{autofocus:!0,search:"documents"}}]},{$type:"block",$items:[{$bind:"documents",options:{border:!0,scrolling:{horizontal:!0},sorting:!0,selecting:{row:!0,action:"selectAndClose"},columns:[]}}]}]},a=function(){function e(e,t,i){}return e.prototype._modelChanged=function(e,t,i,n){if("init"===e.operation){(o=t.documents).length&&o.selectItem(!0,t.documents.get(0),!1,"",!1)}else if("form-validate"===e.property){if(this._onselect){var s=null;(o=t.documents).enumSelectedItems("",function(e){s||(s=e)}),this._onselect(s?s.model():null)}i.autoClose.explicitClose=!0,this.hide()}else if("documents"===e.property){if("propchange"===e.operation){var o;(o=t.documents).length&&o.selectItem(!0,t.documents.get(0),!1,"",!1)}}else"documents.$item.$links.selectAndClose"===e.property&&(this._onselect&&this._onselect(e.actionParams.model()),i.autoClose.explicitClose=!0,this.hide())},e.prototype._checkFormLayout=function(e){var t=this;e.$schema.properties.search={title:d.ui.Search,type:"string"},e.$schema.properties.documents.$reference="list",t._lookupColumns||(t._lookupColumns=[],Object.keys(e.$schema.properties.documents.items.properties).forEach(function(i){var n=e.$schema.properties.documents.items.properties[i];n.title&&"object"!==n.type&&"array"!==n.type&&t._lookupColumns.push(i)})),e.$schema.properties.documents.items.links={selectAndClose:{}};var i=e.data.$items[1].$items[0].options.columns;t._lookupColumns.forEach(function(e){var n=e;"string"==typeof e&&(n={$bind:e}),n.$bind===t._searchField?i.splice(0,0,n):i.push(n)})},e.prototype._beforeClose=function(){if(this._form){var e=this._form,t=this._parentControl,i=this._focusParams;this._form=null,t&&t.focused&&(e.autoClose&&e.autoClose.explicitClose?t.setFocus&&t.setFocus(i):t.checkFocus&&t.checkFocus(i))}},e.prototype._checkPopup=function(){},Object.defineProperty(e.prototype,"opened",{get:function(){return!!this._form},enumerable:!0,configurable:!0}),e.prototype.focusInCombo=function(e){return!(!this._form||!this._form.autoClose)&&this._form.autoClose.inPopup(e)},e.prototype.show=function(e,i,r){var a=this;if(a._parentControl=i,a._focusParams=r.focusParams,a._lookup=r.lookup,a._lookupColumns=r.lookupColumns,a._onselect=r.onselect,!a._lookup.schema)throw"Invalid lookup definition. Foreign schema is missing.";var l=$.extend(!0,{},t);a._lookup.data&&a._lookup.data.$params&&a._lookup.data.$params.$allData&&(l.datasets.list.$params.$allData=!0);var u="string"==typeof a._lookup.schema?a._lookup.schema:$.extend(!0,{},a._lookup.schema),d=l.datasets.list,p=r.minWidth||0;if(r.alignElementId){var h=n.find(null,r.alignElementId);h&&(p=Math.max(h.offsetWidth,p)),p=Math.max(p,300)}$.extend(d.$params,e.$params),e.$transform&&(d.$transform=e.$transform),e.$type&&(d.$type=e.$type),d.$params.$orderby=d.$params.$orderby||(r.display?a._lookup.mapping[r.display]:"");var f=r.display?a._lookup.mapping[r.display]:"";a._searchField=f,s.loadSchema(u).then(function(e){c.expandSchema$Ref(e);var t=c.searchableFields(e.properties.documents.items,e,null),i=[];d.$params.$searchByFields&&d.$params.$searchByFields.fields&&d.$params.$searchByFields.fields.length?i=d.$params.$searchByFields.fields:f&&i.push(f),t.forEach(function(e){i.indexOf(e.name)<0&&i.push(e.name)}),d.$params.$searchByFields={fields:i,value:r.search?r.search:""},s.showAutoCloseForm({name:l,meta:e,controller:{onModelChanged:a._modelChanged.bind(a),checkFormLayout:a._checkFormLayout.bind(a)},autoClose:{align:o.BOTTOM_LEFT,opener:r.openerId,parents:r.openerId?[r.openerId]:void 0,alignElementId:r.alignElementId,beforeClose:a._beforeClose.bind(a),minWidth:p,showCloseButton:!1},parentContext:a._parentControl.form.$model,options:{}},null,function(e){a._form=e})})},e.prototype.hide=function(){if(this._form){r.Page().setPopup(null)}this._parentControl=null,this._focusParams=null,this._lookup=null,this._onselect=null,this._lookupColumns=null},e.prototype.destroy=function(){this.hide()},e}();e.GridItems=a;var p={checkGridPopup:function(e,t,i,n){return new a($(n),i,{primaryKey:t.primaryKey})},closeGridLookup:function(e,t,i){e[i]&&e[i].opened&&t.push(null,function(t){e[i]&&e[i].opened&&e[i].hide()},!0)},checkGridLookup:function(e,t){if("relation"===e.data.$type){var n=i.copy(e),s=t.getSchema(null),o=c.expand$Ref(t.getSchema(e.data.$params.relation),s);return o.items=c.expand$Ref(o.items,s),n.schema={type:"object",properties:{documents:o}},n.primaryKey=n.schema.properties.documents.items.primaryKey,n}return e},openGridLookup:function(e,t){var i=$.extend(!0,{},t.lookup.data),n={alignElementId:t.align,openerId:t.openerId,lookup:t.lookup,lookupColumns:t.lookupColumns,display:t.display,onselect:t.onselect,search:t.searchText,minWidth:t.minWidth};i&&i.$params&&i.$params.$filter&&(i.$params.$filter=l.replaceFilterVars(i.$params.$filter,t.formControl.getParentModel(t.bind).model(!0))),t.containerId&&(i.$params.containerId=t.containerId),t.viewId&&(i.$params.viewId=t.viewId),t.selected&&(i.$params.selected=t.selected),e[t.propertyName].show(i,t.parentControl,n)}};e.utils={checkGridPopup:p.checkGridPopup,closeGridLookup:p.closeGridLookup,openGridLookup:p.openGridLookup,checkGridLookup:p.checkGridLookup},u.gridlookup=e.utils}(e.gridlookup||(e.gridlookup={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){e.utils,e.ui;var i=e.Observable.errorsUtils,n=e.dom,s=(e.ulocale,function(t){__extends(s,t);function s(e,i,n){var s=t.call(this,e,i,n)||this;return s._state(),s}return s.prototype._item=function(e){if(!this.$element)return null;var t=this.$element.get(0);return n.find(t,this.id+"_item_"+e)},s.prototype.click=function(e){var t=e.target;if(!this.state.isReadOnly){var i=t.id?t.id:t.parentNode.id;if(i){"#"===(n.attr(t,"data-phoenix-href")||n.attr(t,"href"))&&e.preventDefault();var s=this.id+"_item_";if(0===i.indexOf(s)){var o=parseInt(i.substring(s.length),10),r=this.$schema.enum[o],a=this.$schema.enum.indexOf(this.state.value);if(this.renderOptions.wizard&&a>=0&&o>=0&&o-a>0)return;r!==this.state.value&&this.form.setValue(this.$bind,r)}}}},s.prototype._setDisabled=function(e){if(e){var t=this;t._enumItems(function(e,i){e.disabled=t.state.isDisabled||t.state.isReadOnly})}},s.prototype._enumItems=function(e){var t=this;t.$schema.enum.forEach(function(i,n){var s=t._item(n);e(s,i)})},s.prototype._setMandatory=function(e){},s.prototype._state2UI=function(e){var t=this.$element?this.$element.get(0):null;if(t){var i=this.$schema.enum.indexOf(this.state.value);if(i>=0){var n=this._item(i);n&&e(n)}this._setDisabled(t),this.setHidden(t),this._setErrors(t)}},s.prototype._setErrors=function(t){var i=this.state.errors;if(t&&e.bootstrap4){i&&i.length?n.addClass(t,"is-invalid"):n.removeClass(t,"is-invalid")}this.showErrors(t,i)},s.prototype._getDefaultItem=function(){if(this.$element?this.$element.get(0):null){var e=this.$schema.enum.indexOf(this.state.value);return e>=0?this._item(e):void 0}},s.prototype.stateChanged=function(e,t){var n=this.form.getState(this.$bind),s=this.$element?this.$element.get(0):null;n.isHidden!==this.state.isHidden&&(this.state.isHidden=n.isHidden,this.setHidden(s)),n.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=n.isDisabled,this._setDisabled(s)),n.isReadOnly!=this.state.isReadOnly&&(this.state.isReadOnly=n.isReadOnly,this._setDisabled(s)),n.isMandatory!=this.state.isMandatory&&(this.state.isMandatory=n.isMandatory,this._setMandatory(s)),e&&"errors"!==e||i.errorChanged(this.state.errors,n.errors)&&(this.state.errors=n.errors,this._setErrors(s))},s}(e.ui.AbsField));t.Group=s}(e.groupctrl||(e.groupctrl={}))}(Phoenix||(Phoenix={}));!function(e){var t;!function(t){var i=e.utils,n=e.ui,s=e.dom,o=(e.groupctrl,e.ulocale),r=e.uiutils,a=function(t){__extends(n,t);function n(e,i,n){var s=t.call(this,e,i,n)||this;return s._state(),s}return n.prototype._state2UI=function(){var e=this.renderOptions.binary?"bactive":"active";t.prototype._state2UI.call(this,function(t){s.addClass(t,e)})},n.prototype.changed=function(e,i,n,o){var r=this,a=r.renderOptions.binary?"bactive":"active";if(r.state.value!=n){if(r.state.value=n,!r.$element)return;t.prototype._enumItems.call(this,function(e,t){r.state.value===t?s.addClass(e,a):s.removeClass(e,a)})}},n.prototype.mousedown=function(e){this.options.design||e.preventDefault(),this.setFocus()},n.prototype.focusIn=function(e){},n.prototype.focusOut=function(e){},n.prototype.setFocus=function(e){if(!this.renderOptions.readOnly){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden&&this.$element){s.find(this.$element.get(0),this.id+"_grp").focus()}}},n.prototype.keydown=function(e){if(!this.state.isReadOnly&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){switch(e.which||e.keyCode){case s.keys.VK_LEFT:var t=this.$schema.enum.indexOf(this.state.value);if(t>0){var i=this.$schema.enum[t-1];this.form.setValue(this.$bind,i)}break;case s.keys.VK_RIGHT:var n=this.$schema.enum.indexOf(this.state.value);if(n>=0&&n<this.$schema.enum.length-1){i=this.$schema.enum[n+1];this.form.setValue(this.$bind,i)}}}},n.prototype.render=function(t){var n=this,s=n._initOptions(r.utils.defaultOptions);if(!n.$element){var a=n.$schema.enumNames||n.$schema.enum;a=a.map(function(e){return o.tt(e,n.form.$locale)}),n.$element=$(function(t,n,s,o,a,l){o=o||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var u=[];return r.utils.fieldWrapper(u,n,s,function(){var t=e.bootstrap4,s=!n.columns&&!n.inline;if(!n.titleIsHidden){u.push('<label id="{0}_label" for="{0}_grp" ');var c=["bs-label"];n.columns?(t?c.push("col-form-label"):c.push("checkbox-inline bs-cursor-d"),c.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&c.push("text-left")):n.inline&&(t?c.push("form-check-inline"):c.push("checkbox-inline"),c.push("bs-cursor-d no-x-padding")),c.length&&u.push(' class="'+c.join(" ")+'"'),u.push(">"),u.push(i.escapeHtml(o||"")+(n.inline?"&nbsp;":"")),u.push("</label>")}r.utils.addErrorDiv(u),n.columns&&u.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),s&&u.push("<div>"),u.push('<ul id="{0}_grp" tabindex="0" class="'+["no-y-margin d-inline-flex pagination"].join(" ")+'">'),a.forEach(function(e,t){u.push('<li id="{0}_item_'+t+'" class="page-item">'),u.push('<a tabindex="-1" href="#" class="page-link bs-nowrap"'),n.width&&u.push(' style="width:'+n.width+'"'),u.push(">"),u.push(i.escapeHtml(l[t]||"")),u.push("</a>"),u.push("</li>")}),u.push("</div>"),s&&u.push("</div>")}),n.columns&&u.push("</div>"),i.format(u.join(""),t)}(n.id,s,n.options.design,o.tt(n.$schema.title,n.form.$locale),n.$schema.enum,a)),n._state2UI()}return n.appendElement(t,s),n.$element},n}(e.groupctrl.Group);t.BtnGroup=a,n.registerControl(a,"*",!0,"grpbtn",null)}(t||(t={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils,i=e.ui,n=e.dom,s=e.ulocale,o=e.uiutils;!function(r){var a=function(i){__extends(r,i);function r(e,t,n){var s=i.call(this,e,t,n)||this;return s._state(),s}return r.prototype.isMeta=function(){return!0},r.prototype.setParentId=function(e){this._parentId=e},r.prototype.getCustomBind=function(){return this.config&&this.config.options&&this.config.options.$bind?this.config.options.$bind:i.prototype.getCustomBind.call(this)},r.prototype._setDisabled=function(e,t){},r.prototype._setReadOnly=function(e,t){},r.prototype._setMandatory=function(e,t){var i=this.state.isMandatory,s=this._label();s&&n.text(s,this.renderOptions.title+(i?" *":"")+(this.renderOptions.inline?String.fromCharCode(160):""))},r.prototype._label=function(){return this.$element?n.find(this.$element.get(0),this.id+"_label"):null},r.prototype._state2UI=function(){var e=this._label(),t=this.$element?this.$element.get(0):null;e&&(this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setMandatory(e,t))},r.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this._label(),s=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(s)),i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n,s)),i.isReadOnly!=this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,n&&this._setReadOnly(n,s)),i.isMandatory!=this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,n&&this._setMandatory(n,s))},r.prototype._title=function(){return this.$schema&&this.$schema.title?this.$schema.title:this.config&&this.config.options&&this.config.options.title?this.config.options.title:""},r.prototype.render=function(i){var n=this._initOptions(o.utils.defaultOptions);return this.$element||(n.title=s.tt(this._title(),this.form.$locale),this.$schema.description&&(n.description=s.tt(this.$schema.description,this.form.$locale)),this._parentId&&(n.parentId=this._parentId),this.$element=$(function(i,n,s,r){var a=e.bootstrap4;r=r||"";var l=(n=$.extend({columns:!1},n)).columns;n.columns=!1,l&&(n.styles="bs-field-group-labels");var u=[],c={formGroup:"form-group"};return l&&!a&&(c.formGroup+=" form-horizontal"),o.utils.fieldWrapper(u,n,s,function(){u.push('<label id="{0}_label"');var e=["bs-label"];l&&(a?e.push("col-form-label"):e.push("checkbox-inline bs-cursor-d"),e.push("col-sm-12 bs-lib-col"),n.labelLeft&&e.push("text-left")),n.inline&&(a?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&u.push(' class="'+e.join(" ")+'"'),n.parentId&&u.push(' for="'+n.parentId+'_input"'),u.push(">"),u.push(t.escapeHtml(r||"")+(n.inline?"&nbsp;":"")),o.utils.addTooltipAndRule(u,n),u.push("</label>")},c),t.format(u.join(""),i)}(this.id,n,this.options.design,n.title)),this._state2UI()),this.appendElement(i,n),this.$element},r}(e.ui.AbsField);r.Label=a,i.registerControl(a,"meta",!1,"label",null)}(e.formlabel||(e.formlabel={}))}(Phoenix||(Phoenix={}));!function(e){e.utils,e.ui;var t=e.dom,i=e.uiutils;e.ulocale;!function(n){var s=function(e){__extends(n,e);function n(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s}return n.prototype._button=function(){},n.prototype.click=function(e){this.state.isDisabled||(this._isBinded?this.form.execAction(this.$bind):this.fieldOptions.onChange&&this.fieldOptions.onChange())},n.prototype._setDisabled=function(e,i){e.disabled=this.state.isDisabled,this.state.isDisabled?t.addClass(e,"disabled"):t.removeClass(e,"disabled")},n.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null,t=this._button();t&&(this._setDisabled(t,e),this.setHidden(e))},n.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this._button(),s=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(s)),i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n,s))},n.prototype._renderButton=function(){return null},n.prototype.render=function(e){var t=this._initOptions(i.utils.defaultOptions);return this.$element||(this.$element=this._renderButton(),this._state2UI()),this.appendElement(e,t),this.$element},n}(e.ui.AbsField);n.LinkBase=s}(e.formlinkbase||(e.formlinkbase={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils,i=e.ui,n=e.dom,s=e.uiutils,o=e.ulocale;!function(r){var a=function(e){__extends(i,e);function i(){return null!==e&&e.apply(this,arguments)||this}return i.prototype._button=function(){return this.$element?this.renderOptions.inline?this.$element.get(0):this.$element.get(0).firstChild:null},i.prototype._renderButton=function(){return $(function(e,i,o,r){r=r||"",void 0!==(i=$.extend({right:!1,icon:null,type:"default",size:null},i)).title&&(r=i.title);var a=[];if(!i.inline){var l=["bs-island","bs-field-group"];o&&l.push("design"),a.push('<div class="'+l.join(" ")+'"'),s.utils.addContainerId(a,o),a.push(">")}return a.push('<button type="button"'),a.push(' class="bs-button btn btn-'+n.bootstrapStyles("secondary"===i.type||"default"===i.type)[i.type]),i.classButton&&a.push(" "+i.classButton.join("")),i.size&&a.push(" btn-"+i.size),i.inline?(a.push(" bs-btn-inline"),a.push(" bs-island"),i.right&&a.push(" float-right"),o&&a.push(" design")):a.push(" btn-block"),i.style&&a.push(" "+i.style),a.push('"'),i.inline&&s.utils.addContainerId(a,o),a.push(">"),i.icon&&!i.iconRight&&a.push('<span class="'+n.iconClass(i.icon)+'"></span>'),i.titleIsHidden||(i.icon&&!i.iconRight&&a.push("&nbsp;"),a.push(r||""),i.icon&&i.iconRight&&a.push("&nbsp;")),i.icon&&i.iconRight&&a.push('<span class="'+n.iconClass(i.icon)+'"></span>'),a.push("</button>"),i.inline||a.push("</div>"),t.format(a.join(""),e)}(this.id,this.renderOptions,this.options.design,o.tt(this.title,this.form.$locale)))},i}(e.formlinkbase.LinkBase);r.Link=a,i.registerLinkControl(a,"button")}(e.formlink||(e.formlink={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=(i.serial,i.ui),s=i.Observable.SchemaUtils,o=i.data,r=i.utils,a=e.gridlookup,l=i.dom,u=(i.formedit,i.locale,function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey}),c={autoComplete:!1,maxItems:-1},d=function(t){__extends(i,t);function i(i,n,s){var o=t.call(this,i,n,s)||this,r=o;return r.lookupOptions=c,r.eventBus=new e.serial.SingleEventBus(50),r.onselectItemHandler=r._onselectItem.bind(r),r.isEnum=r.$lookup&&r.$lookup.data&&"enum"===r.$lookup.data.$type,o}return i.prototype.customOptions=function(e){t.prototype.customOptions.call(this,e),e.after={icon:"chevron-down"},e.paginated=void 0!==e.paginated?e.paginated:s.supportPagination(this.$lookup)},i.prototype._value2Text=function(){return this.isEnum?function(e,t){if(""===e||null===e||void 0===e)return"";if(t&&t.data&&t.data.$value){for(var i=t.data.$value,n=0,s=i.length;n<s;n++){var o=i[n];if(o.code===e)return o.title}return e||""}return e||""}(this.state.value,this.$lookup):this.state.value||""},i.prototype._getSource=function(e){var t=this.form.getParentModel(this.$bind);if(!this.$lookup.data||!this.$lookup.data.$type)return r.dataAsPromise(null);if("inline"===this.$lookup.data.$type||"enum"===this.$lookup.data.$type){var i=(this.form,n=this.$lookup.data,n.$value);return r.dataAsPromise(function(e,t,i){if(e.value&&(e=e.value),t){var n=[],s=o.compileFilterTree(t,null,i,null);return e.forEach(function(e){o.acceptFilter(s,e)&&n.push(e)}),n}return e}(i,this.$lookup.data&&this.$lookup.data.$params?this.$lookup.data.$params.$filter:null,t.model(!0)))}var n;return s.allData(this.$lookup)?this.$lookup.cache&&this.hasCachedData?r.dataAsPromise(this.cachedData):(e.containerId=this.form.syncTransactionId(),e.viewId=this.form.syncViewId(),s.executeLookup(this.$lookup,this.form.getParentModel(this.$bind),e)):(e.fieldName=this.$lookup.mapping[this.$display],e.paginated=!0,e.containerId=this.form.syncTransactionId(),e.viewId=this.form.syncViewId(),s.executeLookup(this.$lookup,this.form.getParentModel(this.$bind),e))},i.prototype._filterResult=function(e,t){if(e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(t.findFirst&&this.$lookup.data&&this.$lookup.data.$params&&(this.$lookup.data.$params.$allData||"relation"===this.$lookup.data.$type)){var i=a.utils.checkGridLookup(this.$lookup,this.form.$model);return(n=s.findFirst(t.search,s.remoteSearch(s.lastSegment(this.$bind,this.$display),i),e.documents))?{value:[n.item]}:null}e.value=e.documents,delete e.documents}if(s.allData(this.$lookup)){if(this.$lookup.cache&&!this.hasCachedData&&(this.hasCachedData=!0,this.cachedData=e),t.findFirst&&!t.search)return null;if(t.search&&e&&e.value&&t.findFirst){var n;i=a.utils.checkGridLookup(this.$lookup,this.form.$model);return(n=s.findFirst(t.search,this.isEnum?"title":s.remoteSearch(s.lastSegment(this.$bind,this.$display),i),e.value))?{value:[n.item]}:null}}return e},i.prototype._findselected=function(e,t){if(t.search&&t.select&&e&&e.value){var i=a.utils.checkGridLookup(this.$lookup,this.form.$model),n=s.findFirst(t.search,this.isEnum?"title":s.remoteSearch(s.lastSegment(this.$bind,this.$display),i),e.value);if(n)return n.index}return-1},i.prototype._findValue=function(e,t){var i=this;if(e||""!==e){var n={search:e,select:!1,findFirst:!0,find:!1,paginated:i.renderOptions.paginated};i.eventBus.push(i._getSource(n),function(e){(e=i._filterResult(e,n))&&e.value&&e.value.length?t(e.value[0]):t(null)},!0)}else i.eventBus.push(null,function(e){t(null)},!0)},i.prototype._onselectItem=function(e){var t=this;t.eventBus.push(e,function(e){var i=Object.keys(t.$lookup.mapping),n=s.extractBase(t.$bind),o=[],r=!1;i.forEach(function(i){if(t.$lookup.mapping[i]){var s=t.form.getValue(n+i)||"",a=e?e[t.$lookup.mapping[i]]||"":"";a!==s&&(t.form.setValue(n+i,a),r=!0)}else o.push(i)}),r&&o.forEach(function(e){t.form.setValue(n+e,t.$lookup.mapping[e])});var a=t._input();a.value!=t._value2Text()&&t._value2Input(a)},!0)},i.prototype._checkPopupMenu=function(){if(!this.menu){var t=this._input(),i=this.$element;this.renderOptions.columns&&(i=$(this._colParent()));var n=a.utils.checkGridLookup(this.$lookup,this.form.$model);this.menu=new e.formdropitems.DropItems(i,t,{primaryKey:n.primaryKey,search:this.isEnum?"title":s.remoteSearch(s.lastSegment(this.$bind,this.$display),n),onselect:this.onselectItemHandler})}},i.prototype.mousedown=function(e){return this.menu&&this.menu.opened&&this.menu.inMenu(e.target)?(e.stopPropagation(),!1):t.prototype.mousedown.call(this,e)},i.prototype.stopProppagation=function(e){t.prototype.stopProppagation.call(this,e),this.menu&&this.menu.opened&&this.menu.inMenu(e.target)&&(e.preventDefault(),e.stopPropagation())},i.prototype.click=function(e){var t=this._input();l.isChildOf(t.parentNode.lastChild,e.target)?this.renderOptions.paginated?this._toggleGridLookup():this._toggleMenuLookup():this.menu&&this.menu.opened&&this.menu.inMenu(e.target)&&this.menu.click(e)},i.prototype.beforeAppend=function(){},i.prototype._searchText=function(){var e=this._input(),t=this._text2value(e.value);return this.equals(t)?"":t},i.prototype._managePreventDefault=function(e,t){var i;switch(e){case l.keys.VK_UP:case l.keys.VK_PGDOWN:case l.keys.VK_PGUP:case l.keys.VK_HOME:case l.keys.VK_END:i=!u(t);break;case l.keys.VK_DOWN:t.ctrlKey?(i=!0,e=l.keys.VK_F4):i=!u(t);break;default:i=!1}return i&&t.preventDefault()&&t.stopPropagation(),e},i.prototype._shouldTrigger=function(e,t){var i=!1;switch(e){case l.keys.VK_TAB:i=!u(t);break;default:i=!0}return i},i.prototype.setEvents=function(e){var t=this;$(t._input()).on("input",function(){t.inputChanged()})},i.prototype.removeEvents=function(){$(this._input()).off("input")},i.prototype.inputChanged=function(){var e=this._input();this.modified=e.value!=this._value2Text(),this._triggerEvent("inputChanged",null)},i.prototype.checkValue=function(e,t){var i=this,n=i._input();n.value!=i._value2Text()?i._findValue(n.value,function(e){i._onselectItem(e)}):t(i.state.value)},i.prototype.keydown=function(e){var t=e.which||e.keyCode;return(t=this._managePreventDefault(t,e))&&this._shouldTrigger(t,e)&&this._triggerKey(t,e),!0},i.prototype.focusIn=function(e){},i.prototype.focusOut=function(e){a.utils.closeGridLookup(this,this.eventBus,"gc"),this._closeMenuLookup(),t.prototype.focusOut.call(this,e)},i.prototype._triggerEvent=function(e,t){var i=this,n=i._input();if(i.menu&&i.menu.opened)switch(e){case"inputChanged":var s={search:n.value,select:!0,find:!1,findFirst:!1};this.eventBus.push(i._getSource(s),function(e){if(i.menu&&i.menu.opened){s.search=n.value,e=i._filterResult(e,s);var t=-1;s.select&&(t=i._findselected(e,s)),i.menu.show(e,t,!0)}},!1)}},i.prototype._checkGridPopup=function(){var e=this._input(),t=this.$element.get(0);this.renderOptions.columns&&(t=this._colParent()),this.gc=a.utils.checkGridPopup(this,this.$lookup,e,t)},i.prototype.focusInControl=function(e){var i=t.prototype.focusInControl.call(this,e);return!i&&this.gc&&this.gc.opened?this.gc.focusInCombo(e):i},i.prototype._openGridLookup=function(){if(!this.gc||!this.gc.opened){this._checkGridPopup();var e=a.utils.checkGridLookup(this.$lookup,this.form.$model);a.utils.openGridLookup(this,{lookup:e,parentControl:this,formControl:this.form,display:this.$display,bind:this.$bind,containerId:this.form.syncTransactionId(),viewId:this.form.syncViewId(),align:this.id+"_group",openerId:this.id+"_after",searchText:this._searchText(),onselect:this.onselectItemHandler,lookupColumns:this.fieldOptions?this.fieldOptions.lookupColumns:void 0,propertyName:"gc",minWidth:this.fieldOptions?this.fieldOptions.lookupMinWidth:0})}},i.prototype._toggleGridLookup=function(){this.gc&&this.gc.opened?a.utils.closeGridLookup(this,this.eventBus,"gc"):this.gc&&this.gc.opened||this._openGridLookup()},i.prototype._closeMenuLookup=function(){var e=this;e.menu&&e.menu.opened&&e.eventBus.push(null,function(t){e.menu&&e.menu.opened&&e.menu.hide(null)},!0)},i.prototype._toggleMenuLookup=function(){var e=this,t=e._input();if(e.menu&&e.menu.opened)e.menu&&e.menu.opened&&e._closeMenuLookup();else{e._checkPopupMenu();var i={search:t.value,select:!0,find:!1,findFirst:!1};e.eventBus.push(e._getSource(i),function(t){t=e._filterResult(t,i);var n=-1;i.select&&(n=e._findselected(t,i)),e.menu.show(t,n,!1)},!0)}},i.prototype._triggerKey=function(e,t){var i=this;if(i.menu&&i.menu.opened)switch(e){case l.keys.VK_ESCAPE:i.eventBus.push(null,function(e){i._closeMenuLookup()},!0);break;case l.keys.VK_ENTER:i.eventBus.push(null,function(e){i.menu.select()},!0);break;case l.keys.VK_UP:i.eventBus.push(null,function(e){i.menu.move(-1)},!0);break;case l.keys.VK_DOWN:i.eventBus.push(null,function(e){i.menu.move(1)},!0);break;case l.keys.VK_HOME:i.eventBus.push(null,function(e){i.menu.move(-1e3)},!0);break;case l.keys.VK_END:i.eventBus.push(null,function(e){i.menu.move(1e3)},!0);break;case l.keys.VK_PGDOWN:i.eventBus.push(null,function(e){i.menu.move(7)},!0);break;case l.keys.VK_PGUP:i.eventBus.push(null,function(e){i.menu.move(-7)},!0)}e===l.keys.VK_F4&&(i.renderOptions.paginated?i._toggleGridLookup():i._toggleMenuLookup())},i.prototype.destroy=function(){this.onselectItemHandler=null,this.cachedData=null,this.eventBus&&(this.eventBus.destroy(),this.eventBus=null),this.menu&&(this.menu.destroy(),this.menu=null),this.gc&&(this.gc.destroy(),this.gc=null),t.prototype.destroy.call(this)},i.prototype.checkFocus=function(e){var t=this;r.nextTick(function(){var e=window.document.activeElement;e&&t.targetInControl(e)||(t.focusOut(null),t.focused=!1)})},i}(e.formedit.Edit);t.Lookup=d,n.registerControl(d,"string",!1,"",{lookup:!0}),n.registerControl(d,"number",!1,"",{lookup:!0}),n.registerControl(d,"integer",!1,"",{lookup:!0})}(e.formlookup||(e.formlookup={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.ui,n=e.utils,s=(e.formedit,e.uiutils),o=(e.dom,e.locale,e.Observable.SchemaUtils,e.ulocale),r=(i=e.ui,function(e){__extends(t,e);function t(t,i,n){return e.call(this,t,i,n)||this}return t.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype._setReadOnly=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype._state2UI=function(){this._input();e.prototype._state2UI.call(this)},t.prototype.stateChanged=function(t,i){this.form.getState(this.$bind);e.prototype.stateChanged.call(this,t,i)},t.prototype.render=function(e){var t=this._initOptions(s.utils.defaultOptions);return this.$element||(t.title=o.tt(this.$schema.title,this.form.$locale),this.$schema.description&&(t.description=o.tt(this.$schema.description,this.form.$locale)),this.$element=$(function(e,t,i,o){o=o||"";var r=[];return(t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t)).titleIsHidden&&(t.columns=!1),t.placeHolder=!1,s.utils.fieldWrapper(r,t,i,function(){if(!t.titleIsHidden){r.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&r.push(' class="'+e.join(" ")+'"'),r.push(">"),r.push(n.escapeHtml(o||"")+(t.inline?"&nbsp;":"")),s.utils.addTooltipAndRule(r,t),r.push("</label>")}if(t.columns&&r.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'">'),t.readOnly){r.push('<div class="bs-mv-container form-control bs-read-only'),t.size&&r.push(" form-control-"+t.size),r.push('" id="{0}_array"');var i=[];t.maxWidth&&i.push("max-width: "+t.maxWidth+";"),t.minWidth&&i.push("min-width: "+t.minWidth+";"),i.length&&r.push(' style="'+i.join("")+'"'),r.push(">"),r.push('<input type="text "class="bs-tags-input">'),r.push("</div>")}else r.push('<div class="bs-mv-container form-control'),t.size&&r.push(" form-control-"+t.size),r.push('" id="{0}_array"'),i=[],t.maxWidth&&i.push("max-width: "+t.maxWidth+";"),t.minWidth&&i.push("min-width: "+t.minWidth+";"),i.length&&r.push(' style="'+i.join("")+'"'),r.push(">"),r.push('<input type="text "class="bs-tags-input">'),r.push("</div>");s.utils.addErrorDiv(r),t.columns&&r.push("</div>"),t.titleIsHidden&&s.utils.addTooltipAndRule(r,t)}),n.format(r.join(""),e)}(this.id,t,this.options.design,t.title)),this._state2UI(),this.setEvents(t)),this.appendElement(e,t),this.$element},t.prototype._value2Input=function(e){},t}(e.formedit.Edit));i.registerControl(r,"array",!1,"multivalue",null)}(e.multivalue||(e.multivalue={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils,i=e.ui,n=e.dom,s=(e.device,e.uiutils),o=e.Observable,r=e.data.odata,a=o.DataUtils,l=e.ulocale;!function(o){var u=function(i){__extends(o,i);function o(e,t,n){var s=i.call(this,e,t,n)||this;return s._state(),s}return o.prototype._setDisabled=function(e){},o.prototype._setReadOnly=function(e){this._setDisabled(e)},o.prototype._setMandatory=function(e){},o.prototype._state2UI=function(){var e=this._img(),t=this.$element?this.$element.get(0):null;e&&(this._showValue(this.state.value),this._setDisabled(t),this._setReadOnly(t),this.setHidden(t))},o.prototype._showValue=function(e){},o.prototype.changed=function(e,t,i,n){this._img();this.state.value!==i&&(this.state.value=i,this._showValue(this.state.value))},o.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(n)),i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n)),i.isReadOnly!=this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,n&&this._setReadOnly(n)),i.isMandatory!=this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,n&&this._setMandatory(n))},o.prototype._img=function(){var e=this.$element.get(0);return e?n.find(e,this.id+"_img"):null},o.prototype._altimg=function(){var e=this.$element.get(0);return e?n.find(e,this.id+"_alt"):null},o.prototype.render=function(i){var o=this._initOptions(s.utils.defaultOptions);return this.$element||(o.title=l.tt(this.$schema.title,this.form.$locale),this.$element=$(function(i,o,r,a,l){var u=[];return a=a||"",s.utils.fieldWrapper(u,o,r,function(){var i=e.bootstrap4;if(!o.titleIsHidden){u.push('<label id="{0}_label"');var r=["bs-label"];o.columns&&(i?r.push("col-form-label"):r.push("checkbox-inline bs-cursor-d"),r.push("bs-lib-col col-sm-"+o.labelCol),o.labelLeft&&r.push("text-left")),o.inline&&(i?r.push("form-check-inline"):r.push("checkbox-inline"),r.push("bs-cursor-d no-x-padding")),r.length&&u.push(' class="'+r.join(" ")+'"'),u.push(">"),u.push(t.escapeHtml(a||"")+(o.inline?"&nbsp;":"")),s.utils.addTooltipAndRule(u,o),u.push("</label>")}o.columns&&u.push('<div class="no-x-padding col-sm-'+(12-o.labelCol)+'">'),o.inline?u.push('<span id="{0}_alt" class="bs-no-image">'):u.push('<div id="{0}_alt" class="bs-no-image">'),l&&u.push('<input id="{0}_upload" class="bs-hidden-file" accept="image/*" type="file" />');var c=["bs-none bs-relative"];o.inline||c.push(i?"img-fluid":"img-responsive"),u.push('<img id="{0}_img" class="'),u.push(c.join(" ")),u.push('"/>'),l&&u.push('<div id="{0}_remove" class="bs-rt-button bs-image-remove bs-none"><span class="'+n.iconClass("times-circle")+'"></span></div>'),o.inline?u.push("</span>"):u.push("</div>"),o.columns&&u.push("</div>")},null),t.format(u.join(""),i)}(this.id,o,this.options.design,o.title,this.editable)),this._state2UI(),this.setEvents(o)),this.appendElement(i,o),this.$element},o}(e.ui.AbsField),c=function(e){__extends(i,e);function i(t,i,n){var s=e.call(this,t,i,n)||this;return s.editable=!0,s}return i.prototype._createImage=function(e){var t=this,i=e.target.files;if(i&&i.length){var s=i[0];if(!s.type.match("image.*"))return;var o=window.URL||window.webkitURL;if(o){var r={id:t.state.value?t.state.value.id:void 0,fileName:s.name,value:"",url:t.state.value?t.state.value.url:void 0,contentType:s.type};if("image/svg+xml"===s.type){var a=new FileReader;a.onload=function(e){r.value=a.result,t.form.setValue(t.$bind,r),n.processing(!1)},n.processing(!0),a.readAsDataURL(s)}else{var l=document.createElement("img"),u=document.createElement("canvas");n.processing(!0),l.src=o.createObjectURL(s),l.onload=function(){var e=1,i=l.width*l.height;i>12e5?e=2:i>24e5?e=4:i>4e6&&(e=8),u.width=l.width/e,u.height=l.height/e;u.getContext("2d").drawImage(l,0,0,u.width,u.height),r.value=u.toDataURL(),t.form.setValue(t.$bind,r),n.processing(!1)}}}}},i.prototype._removeImage=function(){var e={id:this.state.value?this.state.value.id:void 0,value:""};this.form.setValue(this.$bind,e)},i.prototype.click=function(e){if(!this.state.isDisabled&&!this.state.isReadOnly){var t=this.id+"_remove";if(e.target.id===t||e.target.parentNode.id===t)this._removeImage();else{this._upload().click()}}},i.prototype._upload=function(){var e=this.$element.get(0);return e?n.find(e,this.id+"_upload"):null},i.prototype.setEvents=function(e){var t=this,i=t._upload();i&&$(i).on("change",function(e){t._createImage(e)})},i.prototype.removeEvents=function(){var e=this._upload();e&&$(e).off("change")},i.prototype._setDisabled=function(e){this._upload().disabled=this.state.isDisabled||this.state.isReadOnly,this._showRemoveImage(this.state.value)},i.prototype._showRemoveImage=function(e){var t=!this.state.isHidden&&!this.state.isDisabled&&!this.state.isReadOnlyd;t&&(t=e&&(e.url||e.value));var i=this._rmv();i&&(t?n.removeClass(i,"bs-none"):n.addClass(i,"bs-none"))},i.prototype._rmv=function(){var e=this.$element.get(0);return e?n.find(e,this.id+"_remove"):null},i.prototype._showValue=function(e){var i=this._img(),s=this._altimg();if(i){var o=!1;if(e)if(void 0!==e.value)e.value?(i.src=e.value,o=!0):i.src="";else if(e.url){if(e.url.indexOf("{{baseUrl}}")>=0){var l=a.extractMainDataSource(this.form.$model);l||(l={$module:this.renderOptions.$module,$context:this.renderOptions.$context});r.baseUrl(l);var u=t.execAngularExpression(e.url,{baseUrl:r.baseUrl(l)||""});i.src=r.addImageUrlToken(u)}else i.src="";o=!0}else i.src="";else i.src="";o?(n.removeClass(i,"bs-none"),n.removeClass(s,"bs-no-image")):(n.addClass(i,"bs-none"),n.addClass(s,"bs-no-image")),this._showRemoveImage(e)}},i}(u),d=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s.editable=!1,s}return t.prototype._showValue=function(e){var t=this._img(),i=this._altimg();if(t){var s=!1;e&&(t.src=e,s=!0),s?(n.removeClass(t,"bs-none"),n.removeClass(i,"bs-no-image")):(n.addClass(t,"bs-none"),n.addClass(i,"bs-no-image"))}},t}(u);i.registerControl(c,"string",!1,"",{format:"stream"}),i.registerControl(d,"string",!1,"imageurl",{})}(e.formpicture||(e.formpicture={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.utils,n=e.ui,s=(e.dom,e.groupctrl,e.ulocale),o=e.uiutils,r=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s}return t.prototype._state2UI=function(){e.prototype._state2UI.call(this,function(e){e.checked=!0})},t.prototype.changed=function(t,i,n,s){if(this.state.value!=n){this.state.value=n;var o=this.$schema.enum.indexOf(this.state.value),r=e.prototype._item.call(this,o);r&&(r.checked=!0)}},t.prototype.render=function(e){var t=this,n=t._initOptions(o.utils.defaultOptions);if(!t.$element){var r=t.$schema.enumNames||t.$schema.enum;r=r.map(function(e){return s.tt(e,t.form.$locale)}),t.$schema.description&&(n.description=s.tt(t.$schema.description,t.form.$locale)),t.$element=$(function(e,t,n,s,r,a){s=s||"",t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,horizontal:!1},t);var l=[];return o.utils.fieldWrapper(l,t,n,function(){if(!t.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&l.push(' class="'+e.join(" ")+'"'),l.push(">"),l.push(i.escapeHtml(s||"")+(t.inline?"&nbsp;":"")),o.utils.addTooltipAndRule(l,t),l.push("</label>"),!t.inline&&t.horizontal&&l.push("<div></div>")}t.columns&&l.push('<div class="no-x-padding  col-sm-'+(12-t.labelCol)+'">');var n=t.inline||t.horizontal;r.forEach(function(e,t){l.push('<div class="custom-control custom-radio'+(n?" custom-control-inline":"")+'">'),l.push('<input class="custom-control-input" type="radio" name="{0}_input" id="{0}_item_'+t+'" value="'+e+'">'),l.push('<label class="custom-control-label" for="{0}_item_'+t+'">'),l.push(i.escapeHtml(a[t]||"")),l.push("</label>"),l.push("</div>")}),o.utils.addErrorDiv(l),t.columns&&l.push("</div>")},null),i.format(l.join(""),e)}(t.id,n,t.options.design,s.tt(t.$schema.title,t.form.$locale),t.$schema.enum,r)),t.setEvents(n),t._state2UI()}return t.appendElement(e,n),t.$element},t}(e.groupctrl.Group);n.registerControl(r,"*",!0,"radio",null)}(e.radiogroup||(e.radiogroup={}))}(Phoenix||(Phoenix={}));!function(e){var t;!function(t){var i=e.utils,n=e.ui,s=e.dom,o=e.ulocale,r=e.uiutils;var a=function(t){__extends(n,t);function n(e,n,s){var r=t.call(this,e,n,s)||this,a=r;return a._map=[],e.options&&e.options.$expression?(a.$expression=e.options.$expression,i.extractAngularVars(a.$expression,a._map)):(a.$expression=i.format("{0}: {{{1}}}",i.escapeHtml(o.tt(a.$schema.title,a.form.$locale)),a.$bind),a._map.push({name:a.$bind})),a._map.forEach(function(e){e.name!=a.$bind?(e.schema=s.getSchema(e.name),a.form.registerListenerFor(e.name,a)):e.schema=a.$schema}),r._state(),r}return n.prototype._state=function(){this.state=this.state||{},this.state.values=this.state.values||{},this.state.fvalues=this.state.fvalues||{};var e=this.form.getState(this.$bind);this.state.isHidden=e.isHidden,this._refreshValues()},n.prototype._refreshValues=function(){var e=this;e._map.forEach(function(t){e.state.values[t.name]=e.form.getValue(t.name);var i=e.form.getState(t.name);e.state.fvalues[t.name]=r.utils.displayValue(e.state.values[t.name],t.schema,e.form.$locale,{html:!1,useSymbol:!0,state:i},e.state.values,t.name).value})},n.prototype._value2UI=function(){var e=this.$element?this.$element.get(0):null,t=i.execAngularExpression(this.$expression,this.state.fvalues,!0),n=$("<div>"+i.escapeHtml(t)+"</div>").get(0);for(s.empty(e);n.childNodes.length>0;)e.appendChild(n.childNodes[0])},n.prototype._findMap=function(e){for(var t=0,i=this._map.length;t<i;t++){var n=this._map[t];if(n.name===e)return n}return null},n.prototype.changed=function(e,t,i,n){this._refreshValues(),this._value2UI()},n.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(n)),i.symbol!==this.state.symbol&&(i.symbol=this.state.symbol),i.decimals!==this.state.decimals&&(i.decimals=this.state.decimals)},n.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this.setHidden(e),this._value2UI())},n.prototype.render=function(t){var n=this._initOptions(r.utils.defaultOptions);return this.$element||(this.$element=$(function(t,n,s,o,a){o=o||"",n.styles=n.styles?n.styles:e.bootstrap4?"form-control-plaintext":"form-control-static",n=$.extend({titleIsHidden:!1},n);var l=[];return r.utils.fieldWrapper(l,n,s,function(){l.push('<div style="background-color: red;">'+o+"</div>")}),i.format(l.join(""),t)}(this.id,n,this.options.design,o.tt(this.$schema.title,this.form.$locale))),this._state2UI()),this.appendElement(t,n),this.$element},n.prototype.destroy=function(){var e=this;e._map.forEach(function(t){t.name!=e.$bind&&e.form.unRegisterListenerFor(t.name,e)}),t.prototype.destroy.call(this)},n}(e.ui.AbsField);t.ReadOnlyField=a,n.registerControl(a,"*",!1,"",{readOnly:!0})}(t||(t={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=(i.formedit,i.dom),s=(i.locale,i.ui),o=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this,o=s;return o._searchField=t.options.search,o._query=o.form.getValue(o._searchField),s}return t.prototype.updateModel=function(){this._query.search=this.state.value},t.prototype.destroy=function(){this._query=null,e.prototype.destroy.call(this)},t.prototype.keyup=function(e){this._input();return!!this._ignoreKeys(e,!0)||(this.state.isReadOnly||this.state.isDisabled,this.customKeyUp(e),!0)},t.prototype.customKeyUp=function(e){var t=this;t._incremental&&(window.clearTimeout(t._incremental),delete t._incremental),t._incremental=window.setTimeout(function(){delete t._incremental,t._input2Model(!1)},0)},t.prototype.changed=function(e,t,i,n){},t.prototype._ignoreKeys=function(t,i){if(!i){if(t.which===n.keys.VK_UP)return this._query.moveSelected(-1,!0),!0;if(t.which===n.keys.VK_DOWN)return this._query.moveSelected(1,!0),!0}return e.prototype._ignoreKeys.call(this,t,i)},t}(e.formedit.Edit);t.Search=o,s.registerControl(o,"string",!1,"search",null)}(e.search||(e.search={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.ui,n=e.utils,s=(e.formedit,e.uiutils),o=e.dom,r=(e.locale,e.Observable.SchemaUtils,e.ulocale),a=(i=e.ui,function(t){__extends(i,t);function i(e,i,n){return t.call(this,e,i,n)||this}return i.prototype.fillSelect=function(e){this.renderOptions.readOnly||s.utils.fillSelect(e,this._input(),this.$schema)},i.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},i.prototype._setReadOnly=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},i.prototype._state2UI=function(){this._input()&&this._setFilter(!0),t.prototype._state2UI.call(this)},i.prototype._setFilter=function(e){var t=this.state.filter;if(!e||t){var i=t?this.$schema.filters[t]||[]:this.$schema.enum;if(this.fillSelect(i),!e){if(i.indexOf(this.state.value)<0)this.form.setValue(this.$display,i.length?i[0]:null);else{var n=this._input();n&&this._value2Input(n)}}}},i.prototype.stateChanged=function(e,i){var n=this.form.getState(this.$bind);t.prototype.stateChanged.call(this,e,i),e&&"filter"!==e||this.state.filter!==n.filter&&(this.state.filter=n.filter,this._setFilter(!1))},i.prototype.render=function(t){var i=this,o=i._initOptions(s.utils.defaultOptions);if(!i.$element){var a=i.$schema.enumNames||i.$schema.enum;a=a.map(function(e){return r.tt(e+"",i.form.$locale)}),o.title=r.tt(i.$schema.title,i.form.$locale),i.$schema.description&&(o.description=r.tt(i.$schema.description,i.form.$locale));var l=i.state.filter,u=l?i.$schema.filters[l]||[]:i.$schema.enum;i.$element=$(function(t,i,o,r,a,l){r=r||"";var u=[];return(i=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},i)).titleIsHidden&&(i.columns=!1),i.placeHolder=!1,s.utils.fieldWrapper(u,i,o,function(){var t=e.bootstrap4;if(!i.titleIsHidden){u.push('<label for="{0}_input" id="{0}_label"');var o=["bs-label"];i.columns&&(t?o.push("col-form-label"):o.push("checkbox-inline bs-cursor-d"),o.push("bs-lib-col col-sm-"+i.labelCol),i.labelLeft&&o.push("text-left")),i.inline&&(t?o.push("form-check-inline"):o.push("checkbox-inline"),o.push("bs-cursor-d no-x-padding")),o.length&&u.push(' class="'+o.join(" ")+'"'),u.push(">"),u.push(n.escapeHtml(r||"")+(i.inline?"&nbsp;":"")),s.utils.addTooltipAndRule(u,i),u.push("</label>")}if(i.columns&&u.push('<div class="no-x-padding col-sm-'+(12-i.labelCol)+'">'),i.readOnly){u.push('<div class="form-control bs-read-only'),t&&i.size&&u.push(" form-control-"+i.size),u.push('" id="{0}_input"');var c=[];i.maxWidth&&c.push("max-width: "+i.maxWidth+";"),i.minWidth&&c.push("min-width: "+i.minWidth+";"),c.length&&u.push(' style="'+c.join("")+'"'),u.push(">"),u.push("</div>")}else u.push('<select class="form-control'),i.size&&t&&u.push(" form-control-"+i.size),u.push('" id="{0}_input"'),c=[],i.maxWidth&&c.push("max-width: "+i.maxWidth+";"),i.minWidth&&c.push("min-width: "+i.minWidth+";"),c.length&&u.push(' style="'+c.join("")+'"'),u.push(">"),a.forEach(function(e,t){u.push('<option value="'+e+'">'+l[t]+"</option>")}),u.push("</select>");s.utils.addErrorDiv(u),i.columns&&u.push("</div>"),i.titleIsHidden&&s.utils.addTooltipAndRule(u,i)}),n.format(u.join(""),t)}(i.id,o,i.options.design,o.title,u,a)),i._state2UI(),i.setEvents(o)}return i.appendElement(t,o),i.$element},i.prototype.removeEvents=function(){if(!this.renderOptions.readOnly){var e=this._input();$(e).off("change")}},i.prototype._value2Input=function(e){var t=this;if(t.renderOptions.readOnly){var i=t.$schema.enumNames||t.$schema.enum;i=i.map(function(e){return r.tt(e+"",t.form.$locale)});var n=t.$schema.enum.indexOf(t.state.value);o.text(e,i[n]||String.fromCharCode(160))}else e.selectedIndex=t.state.filter?t.$schema.filters[t.state.filter].indexOf(t.state.value):t.$schema.enum.indexOf(t.state.value)},i.prototype.setEvents=function(e){var t=this;if(!t.renderOptions.readOnly){var i=t._input();$(i).on("change",function(e){var i=t._input(),n=t.state.filter?t.$schema.filters[t.state.filter][i.selectedIndex]:t.$schema.enum[i.selectedIndex];t.state.value!==n&&(t.state.value=n,t.form.setValue(t.$display,t.state.value))})}},i}(e.formedit.BaseEdit));i.registerControl(a,"*",!0,"",null)}(e.select||(e.select={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.utils,n=e.ui,s=e.dom,o=(e.groupctrl,e.ulocale),r=e.uiutils,a=function(t){__extends(n,t);function n(e,i,n){var s=t.call(this,e,i,n)||this;return s._state(),s}return n.prototype._state2UI=function(){t.prototype._state2UI.call(this,function(e){s.addClass(e,"btn-primary"),s.removeClass(e,"btn-"+s.bootstrapStyles(!0).secondary),e.tabIndex=0})},n.prototype.changed=function(e,i,n,o){var r=this;if(r.state.value!=n){if(r.state.value=n,!r.$element)return;t.prototype._enumItems.call(this,function(e,t){r.state.value===t?(e.tabIndex=0,r.focused&&e.focus(),s.addClass(e,"btn-"+s.bootstrapStyles(!1).primary),s.removeClass(e,"btn-"+s.bootstrapStyles(!0).secondary)):(s.addClass(e,"btn-"+s.bootstrapStyles(!0).secondary),s.removeClass(e,"btn-"+s.bootstrapStyles(!1).primary),e.tabIndex=-1)})}},n.prototype.render=function(t){var n=this,a=n._initOptions(r.utils.defaultOptions);if(!n.$element){var l=n.$schema.enumNames||n.$schema.enum;l=l.map(function(e){return o.tt(e,n.form.$locale)}),n.$element=$(function(t,n,o,a,l,u){a=a||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var c=[];return r.utils.fieldWrapper(c,n,o,function(){e.bootstrap4,c.push('<div class="'+["btn-group"].join(" ")+'">'),l.forEach(function(e,t){c.push('<button tabindex="-1" type="button" id="{0}_item_'+t+'" class="btn btn-'+s.bootstrapStyles(!0).secondary+'"'),n.width&&c.push(' style="width:'+n.width+'"'),c.push(">"),c.push(i.escapeHtml(u[t]||"")),c.push("</button>")}),c.push("</div>")}),i.format(c.join(""),t)}(n.id,a,n.options.design,o.tt(n.$schema.title,n.form.$locale),n.$schema.enum,l)),n._state2UI()}return n.appendElement(t,a),n.$element},n}(e.groupctrl.Group);t.WizardSteps=a,n.registerControl(a,"*",!0,"wizardctrl",null)}(e.wizardctrl||(e.wizardctrl={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.utils,i=e.ui,n=e.dom,s=e.uiutils,o=e.ulocale;!function(r){var a=function(e){__extends(i,e);function i(){return null!==e&&e.apply(this,arguments)||this}return i.prototype._button=function(){return this.$element?this.renderOptions.inline?this.$element.get(0):this.$element.get(0).firstChild:null},i.prototype._renderButton=function(){return $(function(e,i,o,r){r=r||"",i=$.extend({icon:null,type:"default",size:null},i);var a=[];return s.utils.fieldWrapper(a,i,o,function(){a.push('<button type="button"'),a.push(' class="bs-button btn btn-link'),i.size&&a.push(" btn-"+i.size),a.push('"'),a.push(">"),a.push('<span class="'+n.iconClass(i.icon)+'"></span>'),a.push("</button>"),a.push("<span>"+r+"</span>")}),t.format(a.join(""),e)}(this.id,this.renderOptions,this.options.design,o.tt(this.title,this.form.$locale)))},i}(e.formlinkbase.LinkBase);i.registerLinkControl(a,"title-button")}(e.formlink||(e.formlink={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.ui,n=e.utils,s=e.dom,o=e.ulocale,r=e.uiutils;function a(t,i,s,o){o=o||"",i=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},i);var a=[];return r.utils.fieldWrapper(a,i,s,function(){var t=e.bootstrap4;if(!i.titleIsHidden){var s=["bs-label"];a.push('<label for="{0}_input" id="{0}_label"'),i.columns&&(t?s.push("col-form-label"):s.push("checkbox-inline"),s.push("bs-lib-col col-sm-"+i.labelCol),i.labelLeft&&s.push("text-left")),i.inline&&(t?s.push("form-check-inline"):s.push("checkbox-inline"),s.push("bs-cursor-d no-x-padding")),s.length&&a.push(' class="'+s.join(" ")+'"'),a.push(">"),a.push(n.escapeHtml(o||"")+(i.inline?"&nbsp;":"")),r.utils.addTooltipAndRule(a,i),a.push("</label>")}i.columns&&a.push('<div class="no-x-padding col-sm-'+(12-i.labelCol)+'" id="{0}_colparent">'),function(e,t,i){var s=t.inline?"tgl-btn-inline":"";e.push('<input class="tgl tgl-light" id="{0}_input" type="checkbox">'),e.push(n.format('<label class="tgl-btn {0}" for="{1}_input"></label>',s,"{0}"))}(a,i),i.columns&&a.push("</div>"),i.titleIsHidden&&r.utils.addTooltipAndRule(a,i)}),n.format(a.join(""),t)}var l=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s}return t.prototype._check=function(){if(!this.$element)return null;var e=this.$element.get(0);return s.find(e,this.id+"_input")},t.prototype.click=function(e){var t=this._check(),i=t.checked||!1;e.target==t&&this.state.value!=i&&(this._isBinded?(this.state.value=i,this.form.setValue(this.$bind,i)):this.setInternalValue(i,!0))},t.prototype._setDisabled=function(e,t){var i=this._check();this.state.isDisabled||this.state.isReadOnly?s.addClass(i,"disabled"):s.removeClass(i,"disabled"),e.disabled=this.state.isDisabled},t.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},t.prototype._setMandatory=function(e,t){},t.prototype._state2UI=function(){var e=this._check(),t=this.$element?this.$element.get(0):null;e&&(e.checked=this.state.value||!1,this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t))},t.prototype.changed=function(e,t,i,n){var s=this._check();this.state.value!=i&&(this.state.value=i,s.checked=this.state.value||!1)},t.prototype.stateChanged=function(e,t){var i=this._isBinded?this.form.getState(this.$bind):this._internalState,n=this._check(),s=this.$element?this.$element.get(0):null;i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,n&&this.setHidden(s)),i.isDisabled!=this.state.isDisabled&&(this.state.isDisabled=i.isDisabled,n&&this._setDisabled(n,s)),i.isReadOnly!=this.state.isReadOnly&&(this.state.isReadOnly=i.isReadOnly,n&&this._setReadOnly(n,s)),i.isMandatory!=this.state.isMandatory&&(this.state.isMandatory=i.isMandatory,n&&this._setMandatory(n,s))},t.prototype.render=function(e){var t=this._initOptions(r.utils.defaultOptions);return this.$element||(this.$schema.description&&(t.description=o.tt(this.$schema.description,this.form.$locale)),this.$element=$(a(this.id,t,this.options.design,o.tt(this.title,this.form.$locale))),this._state2UI()),this.appendElement(e,t),this.$element},t}(e.ui.AbsField);t.Toggle=l,i.registerControl(l,"boolean",!1,"toggle",null)}(e.togglectrl||(e.togglectrl={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.utils,n=t.ui,s=t.dom,o=t.uiutils;!function(t){var r="invisible",a=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this,o=s;return o._step=1e3,o.fieldOptions.bindStep?(o._step=o.form.getValue(o.fieldOptions.bindStep),n.registerListenerFor(o.fieldOptions.bindStep,o)):o.fieldOptions.step&&(o._step=o.fieldOptions.step),o._state(),o._init(),s}return t.prototype.destroy=function(){this.form.unRegisterListenerFor(this.fieldOptions.bindStep,this),e.prototype.destroy.call(this)},t.prototype._createSteps=function(){var e=this,t=e.$element.get(0),n=s.find(t,e.id+"_parent"),o=e._steps.length-1;e._steps.forEach(function(t,r){n.appendChild(function(e,t,n,o,r,a){var l=['<div id="{0}_{1}" class="d-inline-block">','<div class="bs-step bs-cursor-p d-table align-middle bs-cursor-pointer">','<span data-step-code="{2}" class="bs-step-icon d-table-cell align-middle">','<span data-step-code="{2}" id="{0}_{1}_icon" class="bs-step-circle text-center d-inline-block'+("A"===r?" active "+s.iconClass("edit"):"V"===r?" validated "+s.iconClass("check"):"")+'">'+("N"===r?t:"")+"</span>","</span>",'<span data-step-code="{2}" id="{0}_{1}_title" class="bs-pointer-p bs-step-title d-table-cell align-middle text-nowrap">'+i.escapeHtml(o)+"</span>",'<span id="{0}_{1}_line" class="bs-step-line bs-cursor-d d-table-cell align-middle'+(a?" bs-none":"")+'"><span class="bs-step-line-content"></span></span>',"</div>","</div>"];return $(i.format(l.join(""),e,t,n)).get(0)}(e.id,r+1,t.code,t.libelle,t.status,r&&r===o))})},t.prototype._measure=function(e){var t=this;t._measured=!0;var i=t.$element.get(0),n=s.find(i,t.id+"_parent");t._steps.length;t._hlineWidth=0,t._steps.forEach(function(e,i){var o=n.childNodes[i],r=s.position(o,n);e.width=r.width;var a=s.find(o,t.id+"_"+(i+1)+"_title");if(s.addClass(a,"bs-none"),r=s.position(o,n),e.widthNoCaption=r.width,s.removeClass(a,"bs-none"),0===i){var l=s.find(o,t.id+"_"+(i+1)+"_line");r=s.position(l,n),t._hlineWidth=r.width}}),t._resizeTo(e),s.removeClass(n,"invisible")},t.prototype._init=function(){this._steps=[];for(var e=!1,t=0;t<this.$schema.enum.length;t++){var i="V";e?i="N":this.state.value===this.$schema.enum[t]&&(e=!0,i="A"),this._steps.push({code:this.$schema.enum[t],libelle:this.$schema.enumNames[t],status:i,width:0,widthNoCaption:0})}},t.prototype.stateChanged=function(e,t){this._state(),this.$element&&"isHidden"===e&&(this.setHidden(this.$element.get(0)),this.state.isHidden||this.resize())},t.prototype.click=function(e){if(0!==this._step){var t;if(!this.state.isDisabled){var i=s.attr(e.target,"data-action");if("next"===i){(n=this.$schema.enum.indexOf(this.state.value))>=0&&n+1<this.$schema.enum.length&&(t=this.$schema.enum[n+1])}else if("prev"===i){(n=this.$schema.enum.indexOf(this.state.value))>0&&(t=this.$schema.enum[n-1])}else t=s.attr(e.target,"data-step-code");if(t){if(1===this._step){var n;this.state.value;if((n=this.$schema.enum.indexOf(this.state.value))>=0){var o=this.$schema.enum.indexOf(t);o&&o>n&&(t=this.$schema.enum[n+1])}else t=this.state.value}this.form.setValue(this.$bind,t)}}}},t.prototype.changed=function(e,t,i,n){if(e===this.$bind){this.state.value=i;var o=!1;if(this._steps&&this._steps.length)for(var r=0;r<this._steps.length;r++){var a=this._steps[r],l="V";if(o?l="N":this.state.value===a.code&&(o=!0,l="A"),a.status!==l){a.status=l;var u=s.find(this.$element.get(0),this.id+"_"+(r+1)+"_icon"),c=["bs-step-circle text-center d-inline-block"],d=!0;"A"===l?(d=!0,c.push(s.iconClass("edit")),c.push("active")):"V"===l?(d=!0,c.push(s.iconClass("check")),c.push("validated")):d=!1,u.className=c.join(" "),s.text(u,d?"":r+1+"")}}this.resize()}else if(e&&e===this.fieldOptions.bindStep){var p=this.form.getValue(this.fieldOptions.bindStep);if(p!==this._step){var h=0===p||0===this._step;this._step=p,h&&this.resize()}}},t.prototype._resizeTo=function(e){var t=this,i=t.$element.get(0),n=s.find(i,t.id+"_parent"),o=0,r=0,a=0,l=t._steps.length;t._steps.forEach(function(e,i){switch(o+=e.width,e.status){case"A":r+=e.width,a+=e.width;break;case"V":var n=t._steps[i+1];n&&"A"===n.status?r+=e.width:r+=e.widthNoCaption,a+=e.widthNoCaption;break;case"N":var s=t._steps[i-1];s&&"A"===s.status?r+=e.width:r+=e.widthNoCaption,a+=e.widthNoCaption}});var u=0,c=!1,d=!1,p=!1;if(o<=e?(c=!0,u=e-o):r<=e?(c=!0,d=!0,u=e-r):a<=e&&(c=!0,p=!0,u=e-a),c){for(var h=t._steps.length>1?t._steps.length-1:1,f=Math.floor(u/h)+t._hlineWidth,m=s.queryAll(n,".bs-step-line"),v=0,g=m.length;v<g;v++){var y=m[v];s.hasClass(y,"bs-none")||(y.style.width=f+"px")}t._steps.forEach(function(e,i){var o=n.childNodes[i],r=s.find(o,t.id+"_"+(i+1)+"_title");if(i&&i===l-1){var a=s.find(o,t.id+"_"+(i+1)+"_line");s.hasClass(a,"bs-none")||s.addClass(a,"bs-none")}if(d)switch(e.status){case"A":s.removeClass(r,"bs-none");break;case"V":var u=t._steps[i+1];u&&"A"===u.status?s.removeClass(r,"bs-none"):s.hasClass(r,"bs-none")||s.addClass(r,"bs-none");break;case"N":var c=t._steps[i-1];c&&"A"===c.status?s.removeClass(r,"bs-none"):s.hasClass(r,"bs-none")||s.addClass(r,"bs-none")}else p?"A"===e.status?s.removeClass(r,"bs-none"):s.hasClass(r,"bs-none")||s.addClass(r,"bs-none"):s.removeClass(r,"bs-none");s.removeClass(o,"bs-none")})}else t._steps.forEach(function(i,o){var r=n.childNodes[o],a=s.find(r,t.id+"_"+(o+1)+"_title");if("A"===i.status){var u=s.find(r,t.id+"_"+(o+1)+"_line");o===l-1&&s.removeClass(u,"bs-none"),u.style.width=Math.max(0,e-i.width+t._hlineWidth)+"px",s.removeClass(a,"bs-none"),s.removeClass(r,"bs-none")}else s.hasClass(r,"bs-none")||s.addClass(r,"bs-none")})},t.prototype.resize=function(){var e=this,t=e.$element.get(0),i=s.find(t,e.id+"_root"),n=(s.find(t,e.id+"_parent"),e.$schema.enum.indexOf(e.state.value)),o=0!==e._step&&n+1<e.$schema.enum.length,a=0!==e._step&&n>0,l=s.find(t,e.id+"_next"),u=s.find(t,e.id+"_prev");o?s.removeClass(l,r):s.hasClass(l,r)||s.addClass(l,r),a?s.removeClass(u,r):s.hasClass(u,r)||s.addClass(u,r);var c=s.position(i,null).width;c&&(e._measured?e._resizeTo(c):window.setTimeout(function(){e._measure(c)},10))},t.prototype.render=function(e){var t=this._initOptions(o.utils.defaultOptions);return this.$element||(this.$element=$(function(e,t){var n=[];return o.utils.fieldWrapper(n,{},t,function(){n.push('<div class="bs-step-root">'),n.push('<span data-action="prev" id="{0}_prev" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle invisible">'),n.push('<span data-action="prev" class="bs-step-arrow text-center d-inline-block '+s.iconClass("arrow-left")+'"></span>'),n.push("</span>"),n.push('<div class="bs-step-parent-parent" id="{0}_root"><div class="bs-step-parent invisible" id="{0}_parent"></div></div>'),n.push('<span data-action="next" id="{0}_next" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle invisible">'),n.push('<span data-action="next" class="bs-step-arrow text-center d-inline-block '+s.iconClass("arrow-right")+'"></span>'),n.push("</span>"),n.push("</div>")}),$(i.format(n.join(""),e)).get(0)}(this.id,this.options.design)),this._createSteps()),this.setHidden(this.$element.get(0)),this.appendElement(e,t),this.$element},t}(e.ui.AbsField);n.registerControl(a,"*",!0,"steppers")}(e.wizard||(e.wizard={}))}(Phoenix||(Phoenix={}));!function(e){var t,i=e.render,n=e.ui,s=(e.Observable,e.Observable.SchemaUtils);!function(e){var t=function(e,t,i){if(s.isLink(e.$bind))return n.getRegisteredLinkControl(e.$widget);var o=s.isMeta(e.$bind);if(o)return n.getRegisteredControl("meta",!1,o.widget,"",{});if(!t)return null;var r;return e.$readOnly&&((r=r||{}).readOnly=!0),i&&((r=r||{}).lookup=!0),n.getRegisteredControl(t.type,!!t.enum,e.$widget,t.format,r)};i.register("javascript","field.control",t),i.register("angular","field.control",t)}(t||(t={}))}(Phoenix||(Phoenix={}));!function(e){var t=Phoenix||(Phoenix={}),i=t.locale,n=t.ui,s={type:"object",properties:{message:{type:"string"}}},o={name:"alert",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]};t.utils.alert=function(e,t,r){!function(e,t,r){var a={title:e=e||i.ui.Info,buttons:[{type:"primary",title:i.ui.Ok,name:"ok"}]},l={message:t};n.OpenModalForm(a,o,s,l,null,function(e,t,i,n){if("modal-action"===t.operation)switch(t.property){case"ok":e.close(),r&&r()}})}(e,t,r)}}();!function(e){var t=Phoenix||(Phoenix={}),i=t.locale,n=(t.utils,t.external),s=t.application,o=t.DatasetPlugin,r=t.dom,a=t.ui,l={name:"form",$type:"block",$items:[{$bind:"oldPwd"},{$bind:"newPwd"},{$bind:"$$newPwd"}]};n.changePasswordHandler=function(e){var t={type:"object",properties:{oldPwd:{title:i.ui.password.oldPassword,type:"string",format:"password",capabilities:{noConfirming:!0}},newPwd:{title:i.ui.password.newPassword,type:"string",format:"password",minLength:8}},states:{oldPwd:{isMandatory:!0},newPwd:{isMandatory:!0}}},n={title:i.ui.password.change,buttons:[{pattern:"validate"}]};a.OpenModalForm(n,l,t,{},{},function(t,i,n,a){switch(i.property){case"validate":if(!n.validate())return;var l=s.configuration&&s.configuration.application&&s.configuration.application.authentication?s.configuration.application.authentication.changePasswordDs:null;if(!l)return void t.close();r.processing(!0);var u={oldPwd:n.oldPwd,newPwd:n.newPwd};l.name="data",o.executeDatasets([l],u,{},[],function(i,s){s?(n.addAjaxException(s),r.processing(!1)):(r.processing(!1),t.close(),e&&e())})}})}}();!function(e){var t=e,i=t.locale,n=t.ui,s=t.utils,o={type:"object",properties:{message:{type:"string"}}},r={name:"confirm",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},a=function(e,t,s,a){var l={title:e=e||i.ui.Warning,buttons:[{type:"default",title:i.ui.No,name:"no"},{type:"primary",title:i.ui.Yes,name:"yes"}]},u={message:t};n.OpenModalForm(l,r,o,u,null,function(e,t,i,n){if("modal-action"===t.operation)switch(t.property){case"yes":e.close(),s&&s();break;case"no":e.close(),a&&a()}})};e.confirmDlg=a,s.confirm=function(e,t,i,n){a(e,t,i,n)}}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=(i.dom,i.link),s=i.utils,o=(i.application,i.ulocale,i.locale,function(){function e(e,t){this.$id=s.allocID(),t.maxWidth=t.maxWidth||128,this._options=t}return e.prototype._setEvents=function(){var e=this;if(e.$element){if(e._options.authoring)return;var t=e.$element.get(0);e.$element.on("click",function(i){var s=n.isCustomLink(t,i);if(s&&"click"===s.protocol){var o=e._options.link,r=n.context();"string"==typeof o?e.module&&e.module.links&&e.module.links[o]?n.execLink(e.module.links[o],r,null):n.execLink({$page:o},r,null):o.$page&&n.execLink(o,r,null)}})}},e.prototype._removeEvents=function(){this._options.authoring||this.$element&&this.$element.off("click")},e.prototype.render=function(e){this.$element||(this.$element=$(s.format(function(e){var t=i.bootstrap4,n=[],s=["bs-relative bs-image-mi-image"];s.push(t?"img-fluid":"img-responsive"),n.push('<div id="{0}" class="bs-image-mi bs-cursor-d">'),n.push('<div class="bs-image-mi-border"'),e.link&&n.push('href="click://navigate"'),n.push(">");var o=["max-width:"+e.maxWidth+"px;"];return n.push('<img id="{0}_img" class="'),n.push(s.join(" ")),n.push('" src="'+e.imageSrc+'"'),o.length&&n.push(' style="'+o.join("")+'"'),n.push(" />"),n.push('<span class="bs-image-mi-title">'+e.title+"</span>"),n.push("</div>"),n.push("</div>"),n.join("")}(this._options),this.$id)),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.destroy=function(){this.module=null,this._removeEvents(),this.$element=null,this._options=null},e}());t.ImageMenuItem=o}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.data,s=i.utils,o=function(){function e(e,t,i,n,s,o,r){this._enums={},this._entity=t,this._module=e,this._typeField=i,this._codeField=n,this._titleField=s,this._orderByField=o,this._fields=r}return e.prototype.promise=function(e,t){var i={},o=[],r=this,a=[];if(Object.keys(e).forEach(function(t){var n=e[t];if(r._enums[t])i[t]=r._enums[t];else{o.push({name:t,config:n});var s=r._typeField+" eq '"+t+"'";n.filter&&(s="("+s+" and "+n.filter+")"),a.push(s)}}),!o.length)return new s.Promise(function(e,n){e({type:t,enums:i})});var l={$top:1e3,nocount:!0,$entity:r._entity,$module:r._module,$filter:a.join(" or "),$orderby:r._typeField+","+r._orderByField};return n.odata.getRessources(l,function(e){return e.documents&&e.documents.forEach(function(e){var t=e[r._codeField],n=e[r._titleField],s=e[r._typeField];if(i[s]||(i[s]={enum:[],enumNames:[]},r._enums[s]=i[s]),r._fields){i[s].fields=i[s].fields||[];var o=[],a={};if(r._fields.forEach(function(t){e[t]&&o.push(e[t]),a[t]=e[t]}),i[s].fields.push(a),o.length){var l=o.join("$");i[s].filters=i[s].filters||{},i[s].filters[l]=i[s].filters[l]||[],i[s].filters[l].push(t)}}i[s].enum.push(t),i[s].enumNames.push(n)}),{type:t,enums:i}})},e}();t.OdataEnumManager=o}(e.data||(e.data={}))}(Phoenix||(Phoenix={}));!function(e){var t=Phoenix||(Phoenix={}),i=t.locale,n=t.utils,s=t.ui,o={type:"object",properties:{value:{type:"string"}}},r={name:"prompt",$type:"block",$items:[{$bind:"value",options:{titleIsHidden:!0}}]};n.prompt=function(e,t,n){!function(e,t,n){var a={title:e=e||i.ui.Warning,buttons:[{type:"primary",title:i.ui.Ok,name:"ok"}]},l={value:t||""};s.OpenModalForm(a,r,o,l,null,function(e,t,i,s){if("modal-action"===t.operation)switch(t.property){case"ok":var o=i.value;e.close(),n&&n(o)}})}(e,t,n)}}();!function(e){var t=e.application,i=e.external,n=e.ajax,s=e.utils;i.ruleLoaderHandler=function(e){var i=t.configuration;if(i&&i.rules&&i.rules.odataEntity){var o=i.rules.odataEntity+"?$filter="+encodeURIComponent("clientSide eq 'true'")+"&$expand="+encodeURIComponent("entities($filter=entity in ("+e.map(function(e){return"'"+e+"'"}).join(",")+"))"),r=n.getDefaultAjaxOptions(null);return n.get(o,r,function(e){return e.value})}return s.Promise.resolve([])}}(Phoenix||(Phoenix={}));!function(e){var t=e.autoclose,i=e.external,n=e.ui;i.ruleViewer=function(e){var i={name:{name:"rule-list-viewer",form:!0,$type:"block",$items:[{$type:"block",$title:{value:"Rules",size:4},$items:[{$bind:"rules",$widget:"basicgrid",options:{border:!0,height:400,scrolling:{horizontal:!0,vertical:!0},columns:[{$bind:"ruleType",options:{width:70}},{$bind:"name",options:{width:100}},{$bind:"description",options:{width:150}},{$bind:"expression",options:{width:200}}]}}]}]},meta:{type:"object",properties:{rules:{type:"array",items:{type:"object",properties:{name:{type:"string",title:"Name"},description:{type:"string",title:"Description"},ruleType:{type:"string",title:"Type"},expression:{type:"string",title:"Expression"}}}}}},controller:{onModelChanged:function(){}},autoClose:{align:t.SCREEN_CENTER,minWidth:300,showCloseButton:!0},options:{}};n.showAutoCloseForm(i,{rules:e},null)}}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=(i.ulocale,i.application),s=i.ajax,o=i.data,r=i.utils,a=i.Observable.SchemaUtils,l=i.dom,u=function(e,t){var i=n.config(n.name);if(!i)throw"Application configuration not found.";var o=i.current.prototypes+"/"+e,u=s.get(o,{},function(e){return e});return new r.Promise(function(e,i){u.then(function(n){l.processing(!0),a.loadEnumsPromise(n).then(function(i){l.processing(!1),e((n=i,t&&(n=t(n)),n));var n}).catch(function(e){l.processing(!1),i(e)})}).catch(function(e){i(e)})})};o.registerDataProvider("form-meta",function(e,t,i,n){return u(e.$params.$url,function(e){return e})})}(e.Data||(e.Data={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=(i.dom,i.utils,i.locale,function(){function e(e){this._options=$.extend({src:"https://www.google.com"},e||{})}return e.prototype._setEvents=function(){if(this.$element){var e=this.$element;e.iFrameResize&&e.iFrameResize(this._options)}},e.prototype._removeEvents=function(){},e.prototype.render=function(e){this.$element||(this.$element=$('<iframe src="'+this._options.src+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>'),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null},e}());t.IFrame=n}(e.iframe||(e.iframe={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){e.ulocale;var i=e.utils,n=(e.ajax,e.dom),s=(e.link,function(){function e(e,t,i){this._fieldList=e||[],this._oldFilter=[],this._cb=t||null,this._options=i||{},this._nodeMain=$("<div class='form-inline bs-filterexpress' id='"+this._options.id+"'></div>")}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._fieldList},set:function(e){this._fieldList=e&&Array.isArray(e)&&e.length?e:this._fieldList,this.renderFieldsList(),this.renderSelectedFields()},enumerable:!0,configurable:!0}),e.prototype._getFieldByCode=function(e){var t=null;return this._fieldList.forEach(function(i){i.code===e&&(t=i)}),t},e.prototype._getEditField=function(e){var t;switch(e.format){case a.FORMAT_INTEGER:t="<input type='number' class='form-control' aria-label='...'>";break;case a.FORMAT_STRING:t="<input type='text' class='form-control' aria-label='...'>";break;case a.FORMAT_ENUM:t="<select class='form-control'>",e.enum&&e.enum.forEach(function(i,n){var s=e.enumNames&&e.enumNames[n]?e.enumNames[n]:i;t+="<option value='"+i+"'>"+s+"</option>"}),t+="</select>"}return $(t)},e.prototype._getOpField=function(e){var t;switch(e.format){case a.FORMAT_INTEGER:t=a.OP_INTEGER;break;case a.FORMAT_STRING:t=a.OP_STRING;break;case a.FORMAT_ENUM:t=a.OP_ENUM;break;default:t=""}return t},e.prototype._checkFilter=function(e){return!e||""!=e.code&&""!=e.op},e.prototype.destroy=function(){this._nodeValidate.off("click"),this._nodeMain.off("blur"),this._fieldList=null,this._cb=null,this._nodeMain=null,this._nodeValidate=null,this._options=null},e.prototype.renderFieldsList=function(){},e.prototype.renderSelectedFields=function(){},e.prototype.validerFilter=function(){},e.prototype.setEvents=function(){var e=this;e._nodeValidate.click(function(){e.validerFilter()})},e}()),o=function(t){__extends(i,t);function i(i,s,o){var r=t.call(this,i,s,o)||this,l=r,u=e.bootstrap4,c=$('<div class="input-group"></div>'),d=$('<div class="input-group-prepend"></div>'),p='<button type="button" ';p+='class="bs-button btn btn-'+n.bootstrapStyles(!0).secondary+' dropdown-toggle" data-toggle="dropdown" ',p+='aria-haspopup="true" aria-expanded="false"></button>';var h=$(p);l._nodeSelectButtonTxt=$("<span>"+a.FIELD_SELECT_TEXT_DEFAULT+"</span>");var f=$('<span class="caret"></span>');l._nodeSelectList=u?$('<div class="dropdown-menu"></div>'):$('<ul class="dropdown-menu"></ul>'),l._nodeEdit=$('<input type="text" class="form-control" aria-label="...">');var m=$("<div class='input-group-apppend'></div>");return l._nodeValidate=$('<button class="bs-button btn btn-'+n.bootstrapStyles(!0).secondary+'" type="button"><span class="'+n.iconClass(a.VALIDATE_ICON_DEFAULT)+'"></span> '+a.VALIDATE_TEXT_DEFAULT+"</button>"),l._nodeMain.append(c),c.append(d),c.append(l._nodeEdit),c.append(m),d.append(h),d.append(l._nodeSelectList),h.append(l._nodeSelectButtonTxt),h.append(f),m.append(l._nodeValidate),l.renderFieldsList(),l.renderSelectedFields(),l.setEvents(),r}return i.prototype.renderSelectedFields=function(){var t=null,i=e.bootstrap4;if(this._fieldList.every(function(e){return!e.selected||(t=e,!1)}),!t&&this._fieldList&&this._fieldList.length&&(this._fieldList[0].selected=!0,t=this._fieldList[0]),t&&(this._nodeSelectButtonTxt.text(t.lib+" "),this._changeEditField(t)),this._nodeSelectedLi&&this._nodeSelectedLi.removeClass("active"),t){var s=n.query(this._nodeSelectList.get(0),(i?"a[data-value='":"li[data-value='")+t.code+"']");s&&(this._nodeSelectedLi=$(s),this._nodeSelectedLi.addClass("active"))}},i.prototype._changeEditField=function(e){var t=this;t._removeEvents();var i,s;s=t._getEditField(e).get(0);(i=t._nodeEdit.get(0)).parentNode.replaceChild(s,i),t._nodeEdit=$(s),s.focus(),e.enum?(n.addClass(t._nodeValidate.get(0),"bs-none"),t._nodeEdit.change(function(e){e.target===t._nodeEdit.get(0)&&t.validerFilter()}),t._nodeEdit.get(0).style.borderTopRightRadius="4px",t._nodeEdit.get(0).style.borderBottomRightRadius="4px"):(n.removeClass(t._nodeValidate.get(0),"bs-none"),t._nodeEdit.keyup(function(e){13==e.keyCode&&t.validerFilter()}),t._nodeEdit.focus(function(e){t._nodeEdit.get(0).select()}))},i.prototype._removeEvents=function(){this._nodeEdit.off("focus"),this._nodeEdit.off("keyup"),this._nodeEdit.off("change")},i.prototype.renderFieldsList=function(){var t=this,i=e.bootstrap4;n.empty(t._nodeSelectList.get(0)),t._fieldList.forEach(function(e){i?t._nodeSelectList.append('<a class="bs-cursor-p dropdown-item" data-value="'+e.code+'">'+e.lib+"</a>"):t._nodeSelectList.append("<li class='bs-cursor-p' data-value='"+e.code+"'><a>"+e.lib+"</a></li>")})},i.prototype.setEvents=function(){var e=this;t.prototype.setEvents.call(this),e._nodeSelectList.click(function(t){var i=n.findByAttribute(t.target,e._nodeSelectList.get(0),"data-value");if(i){var s=i.attributes["data-value"].value;if(s){var o=e._getFieldByCode(s);e._fieldList=e._fieldList.map(function(e){return e.selected=e.code==s,e}),o&&e.renderSelectedFields()}}});var i=!1;e._nodeMain.get(0).addEventListener("focusout",function(t){i=!0;var s=!1,o=t.relatedTarget;if(o){var r=o;do{if(!r)break;if(n.hasClass(r,"bs-filterexpress")){s=!0;break}r=r.parentNode}while(r&&!s)}if(!s&&t.target==e._nodeEdit.get(0)&&e._oldFilter&&e._oldFilter.length&&e._oldFilter[0].code){var a=e._getSelected();a&&a.code!==e._oldFilter[0].code&&(e._fieldList=e._fieldList.map(function(t){return t.selected=t.code==e._oldFilter[0].code,t}),e.renderSelectedFields()),e._nodeEdit.val(e._oldFilter[0].values[0])}},!0),e._nodeMain.get(0).addEventListener("blur",function(t){if(!i){var s=!1,o=t.relatedTarget||t.explicitOriginalTarget;if(o){var r=o;do{if(!r)break;if(n.hasClass(r,"bs-filterexpress")){s=!0;break}r=r.parentNode}while(r&&!s)}if(!s&&t.target==e._nodeEdit.get(0)&&e._oldFilter&&e._oldFilter.length&&e._oldFilter[0].code){var a=e._getSelected();a&&a.code!==e._oldFilter[0].code&&(e._fieldList=e._fieldList.map(function(t){return t.selected=t.code==e._oldFilter[0].code,t}),e.renderSelectedFields()),e._nodeEdit.val(e._oldFilter[0].values[0])}}},!0)},i.prototype.validerFilter=function(){if(this._cb){var e=this._getSelected(),t=this._nodeEdit.val()?{code:e.code,op:this._getOpField(e),values:[this._nodeEdit.val()]}:null;t&&!this._checkFilter(t)&&(t=null),this._oldFilter.splice(0),t&&this._oldFilter.push(t),this._cb(t)}},i.prototype._getSelected=function(){var e=null;return this._fieldList.every(function(t){return!t.selected||(e=t,!1)}),e},i}(s),r=function(t){__extends(i,t);function i(i,s,o){var r=t.call(this,i,s,o)||this,l=r,u=e.bootstrap4;l.leftTools=$('<div class="input-group-prepend"></div>'),l.rightTools=$('<div class="input-group-append"></div>'),l._nodeValidate=$("<button class='btn btn-default' type='button'><span class='"+n.iconClass(a.VALIDATE_ICON_DEFAULT)+"'></span> "+a.VALIDATE_TEXT_DEFAULT+"</button>");var c=$('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span>&nbsp;<span class="sr-only">Toggle Dropdown</span></button>');return l._nodeSelectList=u?$('<div class="dropdown-menu dropdown-menu-left"></div>'):$('<ul class="dropdown-menu dropdown-menu-left"></ul>'),l.rightTools.append(l._nodeValidate),l.leftTools.append(c),l.leftTools.append(l._nodeSelectList),l.renderFieldsList(),l.renderSelectedFields(),l.setEvents(),r}return i.prototype.renderSelectedFields=function(){var e=this;n.empty(e._nodeMain.get(0)),e._fieldList.forEach(function(t){t.selected&&e.addField(t)});var t,i;e._nodeMain.get(0).childNodes.length?(t=$(e._nodeMain.get(0).firstChild),i=$(e._nodeMain.get(0).lastChild)):(i=t=$('<div class="input-group"></div>'),e._nodeMain.append(t)),i.append(e.rightTools),$(t.get(0).firstChild).before(e.leftTools)},i.prototype.addField=function(e){e.composant={label:$('<span class="input-group-prepend" id="sizing-addon2"><span class="input-group-text">'+(e.lib||e.libelle||e.code)+"</span></span>"),value:this._getEditField(e)};var t=$('<div class="input-group"></div>');t.append(e.composant.label),t.append(e.composant.value),this._nodeMain.append(t),e.selected=!0},i.prototype.renderFieldsList=function(){var t=this,i=e.bootstrap4;n.empty(t._nodeSelectList.get(0)),t._fieldList.forEach(function(e){i?t._nodeSelectList.append('<a href="#" tabIndex="-1" class="bs-cursor-p dropdown-item" data-value="'+e.code+'"><input type="checkbox" '+(e.selected?"checked":"")+" />&nbsp;"+(e.lib||e.libelle||e.code)+"</a></li>"):t._nodeSelectList.append('<li class="bs-cursor-p" data-value="'+e.code+'"><a href="#" tabIndex="-1"><input type="checkbox" '+(e.selected?"checked":"")+" />&nbsp;"+(e.lib||e.libelle||e.code)+"</a></li>")})},i.prototype.setEvents=function(){var e=this;t.prototype.setEvents.call(this),e._nodeSelectList.on("click",function(t){var i=n.findByAttribute(t.target,e._nodeSelectList.get(0),"data-value");if(i){var s=$(i);if(s.attr("data-value")){var o=s.find("input"),r=e._getFieldByCode(s.attr("data-value"));return r&&(r.selected?(setTimeout(function(){o.prop("checked",!1)},0),r.selected=!1):(setTimeout(function(){o.prop("checked",!0)},0),r.selected=!0),e.renderSelectedFields()),$(t.target).blur(),!1}}})},i.prototype.validerFilter=function(){var e=this;if(e._cb){var t=[];e._fieldList.forEach(function(i){if(i.selected){var n=i.composant.value.val();if(n){var s={code:i.code,op:e._getOpField(i),values:[n]};e._checkFilter(s)&&t.push(s)}}}),e._oldFilter.splice(0),e._oldFilter=t,e._cb(t.length?t:null)}},i}(s),a=function(){function e(e,t,n){e=this._completeFieldList($.extend(!0,[],e)),this._cb=t;var s={id:i.allocID(),multiple:!1};this._options=$.extend(!0,s,n),this._options.multiple?this._render=new r(e,this._cb,this._options):this._render=new o(e,this._cb,this._options)}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._render.fields},set:function(e){this._render.fields=e&&Array.isArray(e)?this._completeFieldList($.extend(!0,[],e)):[]},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._render.destroy(),n.find(this._nodeParent[0],this._options.id).remove(),this._render=null,this._cb=null,this._options=null},e.prototype.render=function(e){this._nodeParent=e,e.append(this._render._nodeMain)},e.prototype._completeFieldList=function(e){return e.forEach(function(e){e.enum&&Array.isArray(e.enum)?(e.format="enum",e.enum.splice(0,0,""),e.enumNames&&e.enumNames.splice(0,0,"")):e.format="number"===e.type?"integer":e.type}),e},e.FIELD_SELECT_TEXT_DEFAULT="Choix du champ",e.VALIDATE_TEXT_DEFAULT="",e.VALIDATE_ICON_DEFAULT="search",e.FORMAT_STRING="string",e.FORMAT_INTEGER="integer",e.FORMAT_ENUM="enum",e.OP_STRING="like",e.OP_INTEGER="in",e.OP_ENUM="in",e}();t.FilterExpress=a}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.DatasetPlugin,n=e.dom,s=function(){function e(e,t){this._init=!1,this._options=t||{},this._notify=t.notify,this._ds=e||{},this._ds.mapping=this._ds.mapping||{},this._ds.mapping.code=this._ds.mapping.code||"code",this._ds.mapping.libelle=this._ds.mapping.libelle||this._ds.mapping.lib||"lib";var i=e.data.$params||{};this._pageSize=i.$top||null,this.searchText=null,this._count=0,this._page=0,this._items=[],this._initData()}return e.prototype._initData=function(){var e=this,t={},s=e._ds.data||{},o={name:"dataset",$type:s.$type||"odata",$params:{$entity:s.$params.$entity,$module:s.$params.$module,$top:1}};n.processing(!0),i.executeDatasets([o],{},t,null,function(i,s){if(n.processing(!1),!s){e._init=!0;var o=t.dataset;e._count=o.count,e._notify(null,{inited:!0,updated:!0})}},!1)},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){e&&(this._items=e,this._notifyChange("items"))},enumerable:!0,configurable:!0}),e.prototype._notifyChange=function(e){switch(e){case"items":this._notify(this.items,{})}},e.prototype.getNbPages=function(){return Math.ceil(this._count/this._pageSize)},e.prototype._getSkip=function(e){return this._pageSize?e*this._pageSize:0},e.prototype._getPage=function(e,t){var s=this;if(s._init){var o=$.extend(!0,{},s._ds.data),r={};o.name="dataset",o.$params=o.$params||{},o.$params.$skip=s._getSkip(e),t=t||{},s.searchText&&(t.$searchText=s.searchText),n.processing(!0),i.executeDatasets([o],t,r,null,function(e,t){if(n.processing(!1),!t){var i=r.dataset;i&&s._count!=i.count&&(s._count=i.count,s._page=0,s._notify(null,{updated:!0})),i.documents&&(i.documents=i.documents.map(function(e){return{code:e[s._ds.mapping.code],libelle:e[s._ds.mapping.libelle]||e[s._ds.mapping.code]}}),s.items=i.documents)}},!1)}},e.prototype.currentPage=function(){return this._page},e.prototype.toPage=function(e){e>=0&&e<this.getNbPages()&&(this._page=e,this._getPage(e))},e.prototype.nextPage=function(){var e=this._page+1;e<this.getNbPages()&&(this._page=e,this._getPage(e))},e.prototype.prevPage=function(){var e=this._page-1;e>=0&&(this._page=e,this._getPage(e))},e.prototype.firthPage=function(){this._page=0,this._getPage(0)},e.prototype.lastPage=function(){var e=this.getNbPages()-1;this._page=e,this._getPage(e)},e.prototype.search=function(e){this.searchText=e||null,this._ds.data.$params.$search&&this._getPage(0)},e.prototype.remove=function(){},e}();t.DsLookup=s}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=t,n=e.utils,s=e.filters,o=e.uiutils,r=e.locale,a=e.ulocale,l=e.dom,u=e.Observable.SchemaUtils,c=s.OPERATORS,d=s.TYPES,p=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,i,n){var s={code:e,libelle:t||e,isBinary:i,options:n||{}};s.options.symbol=n.symbol||t||e,i&&(s.options.liaison=s.options.liaison||"et"),this.liste.push(s)},e.prototype.gets=function(){return this.liste},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.code==e});t>=0&&this.liste.splice(t,1)},e}();t.ListeOperateurs=p;var h=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,i,n){this.liste.push({code:e,libelle:t||e,type:i||"string",options:n||{}})},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.gets=function(){return this.liste},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.code==e});t>=0&&this.liste.splice(t,1)},e}();t.ListeChamps=h;var f=function(){function e(e,t,i,n){this.id=e,this.code=t,this.op=i,this.values=n||[]}return e.prototype.getValues=function(){return this.values.map(function(e){return e&&e.code?e.code:e})},e.prototype.getValueNames=function(){return this.values.map(function(e){return e&&e.lib?e.lib:e})},e}();t.Filter=f;var m=function(){function e(e){this.liste=[],this.filters=e,this.compteur=0}return e.prototype.add=function(e,t,i){var n=new f(this.compteur++,e,t,i);return this.liste.push(n),this.filters.push(n),n},e.prototype.add2=function(e,t,i){var n=new f(this.compteur++,e,t,i);return this.liste.push(n),n},e.prototype.set=function(e,t){var i,n=-1;if(this.liste.forEach(function(t,s){t.id==e&&(i=t,n=s)}),i&&(i.op=t.op,i.values=t.values||[]),n>=0&&n<this.filters.length){var s=this.filters.get(n);s&&(s.code=i.code,s.op=i.op,s.values=i.values)}return i},e.prototype.get=function(e){return this.liste.find(function(t){return t.id==e})},e.prototype.getByIndex=function(e){return this.liste[e]},e.prototype.gets=function(){return this.liste},e.prototype.getsByChamp=function(e){var t=[];return this.liste.forEach(function(i){i.code==e&&t.push(i)}),t},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.id==e});t>=0&&(this.liste.splice(t,1),this.filters.remove(this.filters.get(t)))},e.prototype.removeAll=function(){var e=this;e.liste.splice(0),e.filters.forEach(function(t,i){e.filters.remove(e.filters.get(i))})},e.prototype.removeAllByChamp=function(e){var t=this;t.liste.forEach(function(i,n){i.code==e&&(t.liste.splice(n,1),t.filters.remove(t.filters.get(n)))})},e}();t.ListeFilters=m;var v=function(){function e(){this.liste=[]}return e.prototype.addType=function(e,t,i){this.liste.push({code:e,libelle:t||e,operateurs:i||[]})},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.addOperateur=function(e,t){this.liste.find(function(t){return t.code==e}).operateurs.push(t)},e.prototype.getOperateurs=function(e){return this.liste.find(function(t){return t.code==e}).operateurs},e}();t.ListeTypes=v;var g=function(){function e(e,t,i,n,s,o){this.listeChamps=e,this.listeFilters=t,this.listeOperateurs=i,this.filter=o,this.callBack=n,this.options=s||{},this.data={},this.init()}return e.prototype.init=function(){var e=this;e.model={type:"object",properties:{filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},selected:{type:"string"}}}}},links:{validate:{title:r.ui.Validate,isHidden:1!=e.options.btnValidate}}},e.layout={name:"form",$type:"block",$items:[{$type:"block",$items:[{$type:"block",$items:[{$bind:"filters",$widget:"tagview"}]},{$type:"block",$inline:!0,$items:[{$bind:"$links.validate",options:{type:"success",right:!0}}]}],$title:{value:r.ui.selectedFilters,size:5,style:""}}]},e.data.filters=e.listeFilters.gets().map(function(t){var i=e.listeOperateurs.get(t.op),n=e.listeChamps.get(t.code).libelle+" "+i.options.symbol+" ";return i.isBinary?n+=t.values[0]+" "+i.options.liaison+" "+t.values[1]:n+=t.getValueNames().join(", "),{code:t.id,libelle:n,selected:!(!e.filter||e.filter.id!=t.id)}})},e.prototype.render=function(e){var t=this;e&&i.OpenForm($(e),t.layout,t.model,t.data,{},function(e,i,n){switch(e.property){case"upd":t.callBack("EDIT",{id:e.actionParams.code});break;case"remove":t.callBack("REMOVE",{id:e.actionParams.code});break;case"$links.validate":t.callBack("VALIDE",{})}})},e}(),y=function(){function e(e,t,i){this.valueModel=null;this.type=e,this.op=t,this.options=$.extend(!0,{},i),this.valueModel=this.getInstance()}return e.prototype.getInstance=function(){var e=this.addDefaultOptions(this.options);return this.op.isBinary?new C(e):this.op.code===c.empty||this.op.code===c.nempty?new b(e):"enum"===this.type?new w(e):"lookup"===this.type?new E(e):this.op.code!==c.in&&this.op.code!==c.nin||"decimal"==this.type||"money"==this.type||"date"==this.type||"date-time"==this.type?new x(e):new k(e)},e.prototype.init=function(e){this.valueModel.init(e)},e.prototype.addDefaultOptions=function(e){switch(this.type){case"integer":e.type="number";break;case"decimal":e.type="number",e.decimals=e.decimals||5;break;case"money":e.type="number",e.format="money";break;case"date":e.type="string",e.format="date",e.title="Date";break;case"time":e.type="string",e.format="time",e.title="Time";break;case"date-time":e.type="string",e.format="date-time",e.title="Date";break;default:e.type=this.type||"string"}return e},e.prototype.getModel=function(){return this.valueModel?this.valueModel.getModel():null},e.prototype.getLayout=function(){return this.valueModel?this.valueModel.getLayout():null},e.prototype.getData=function(){return this.valueModel?this.valueModel.getData():null},e.prototype.getValues=function(){return this.valueModel?this.valueModel.getValues():null},e.prototype.setValues=function(e,t){return this.valueModel?this.valueModel.setValues(e,t):null},e.prototype.setValuesByFilter=function(e){this.valueModel&&this.valueModel.setValuesByFilter(e)},e}(),_=function(){function e(e){}return e.prototype.init=function(e){e&&e()},e.prototype.getModel=function(){return this.model},e.prototype.getLayout=function(){return this.layout},e.prototype.getData=function(){return this.data},e.prototype.getValues=function(){},e.prototype.setValues=function(e,t){},e.prototype.setValuesByFilter=function(e){},e}(),b=function(e){__extends(t,e);function t(t){return e.call(this,t)||this}return t.prototype.getValues=function(){return[""]},t}(_),x=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this,n=i;return n.options=t||{},n.model={type:"object",properties:{value:{title:n.options.title||"Valeur",type:n.options.type||"string"}},states:{value:{isMandatory:!0}}},n.options.format&&(n.model.properties.value.format=n.options.format),n.options.decimals&&(n.model.properties.value.decimals=n.options.decimals),n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:12}]},n.data={value:null},i}return t.prototype.getValues=function(){return null!=this.data.value?[this.data.value]:null},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e[0]},t}(_),C=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this,n=i;return n.options=t||{},n.model={type:"object",properties:{value1:{title:(t.title||"Valeur")+" 1",type:t.type||"string"},value2:{title:(t.title||"Valeur")+" 2",type:t.type||"string"}},states:{value1:{isMandatory:!0},value2:{isMandatory:!0}}},n.options.format&&(n.model.properties.value1.format=n.options.format,n.model.properties.value2.format=n.options.format),n.options.decimals&&(n.model.properties.value1.decimals=n.options.decimals,n.model.properties.value2.decimals=n.options.decimals),n.layout={name:"filter-value",$type:"block",$items:[{$type:"row",$items:[{$items:[{$bind:"value1",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6},{$items:[{$bind:"value2",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6}]}]},n.data={value1:null,value2:null},i}return t.prototype.getValues=function(){return null!=this.data.value1&&null!=this.data.value2?[this.data.value1,this.data.value2]:null},t.prototype.setValues=function(e){this.data.value1=e.value1,this.data.value2=e.value2},t.prototype.setValuesByFilter=function(e){this.data.value1=e[0],this.data.value2=e[1]},t}(_),k=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this,n=i;return n.options=t||{},n.model={type:"object",properties:{value:{title:"Valeur",type:"string"}},states:{value:{isMandatory:!0}}},n.options.format&&(n.model.properties.value.format=n.options.format),n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:'Une ou plusieurs valeurs (séparées par un ";" : val1;val2;...)'}}],$colSize:12}]},n.data={value:null},i}return t.prototype.getValues=function(){if(null==this.data.value)return null;var e=this.data.value.split(";"),t=[];return"number"==this.options.type?e.forEach(function(e){var i=parseInt(e,10);isNaN(i)||t.push(i)}):t=e,t},t.prototype.setValues=function(e){var t=this;if(e.value){var i=e.value.split(";"),n=[];(i=i.map(function(e){return e.replace(/\"/g,"")})).forEach(function(e){"number"==t.options.type?new RegExp("^[0-9]+$").test(e)&&n.push(e):n.push(e)}),t.data.value=n.join(";")}},t.prototype.setValuesByFilter=function(e){this.data.value=e.join(";")},t}(_),w=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this,n=i;return n.options=t||{},n.options.enumName=n.options.enumName||n.options.champName,n.model={type:"object",properties:{value:{title:"List",type:"array",items:{type:"string",enums:{},$enumref:"list"}}},states:{value:{isMandatory:!0}}},n.model.properties.value.items.enums[n.options.enumName]={type:"default",enum:[],enumNames:[]},n.model.properties.value.items.$enumref=n.options.enumName,n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"enums-list",options:{titleIsHidden:!0}}],$colSize:12}]},n.options.enum&&n.options.enum.forEach(function(e){n.model.properties.value.items.enums[n.options.enumName].enum.push(e.code),n.model.properties.value.items.enums[n.options.enumName].enumNames.push(e.libelle||e.code)}),n.data={value:[]},i}return t.prototype.getValues=function(){var e=this;return e.data.value&&e.data.value.length?e.data.value.map(function(t){var i=null;return e.options.enum.forEach(function(e,n){if(t==e.code)return i=e,!1}),{code:t,lib:i.libelle||i.lib||t}}):[]},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e.map(function(e){return e.code})},t}(_),E=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this,n=i;return n.options=t||{},n.model={type:"object",properties:{value:{title:"List",type:"array",ds:n.options.lookupSchema||null,items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}},states:{value:{isMandatory:!0}}},n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"lookup-list",options:{titleIsHidden:!0}}],$colSize:12}]},n.data={value:[]},i}return t.prototype.getValues=function(){return this.data.value&&this.data.value.length?this.data.value:[]},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e},t}(_),O=function(){function e(e,t,i,n,s,o,r){this.champ=e,this.filter=o,this.listeFilters=t,this.listeOperateurs=i,this.listeTypes=n,this.callBack=s,this.options=r||{},this.data={operateur:null,values:[]}}return e.prototype.renderOperateur=function(){var e=this,t={type:"object",properties:{champ:{title:"Filtre",type:"string"},operateur:{title:"Opérateur",type:"string",enum:[],enumNames:[]}},states:{champ:{isReadOnly:!0,isHidden:0==e.options.showLabel},operateur:{isHidden:0==e.options.showOperateur}}},n=t.properties;e.data.champ=e.champ.libelle;var s=e.champ.options.format||e.champ.type;if(n.operateur.enum=e.listeTypes.getOperateurs(s),n.operateur.enum.forEach(function(t){n.operateur.enumNames.push(e.listeOperateurs.get(t).libelle)}),e.filter?e.data.operateur=e.filter.op:e.data.operateur=n.operateur.enum[0],0!=e.options.showLabel||0!=e.options.showOperateur){var o=l.query(e.container,".operateur");if(o){var r=i.formManager().formByName("filter-operateur");i.removeForm(r),i.OpenForm($(o),{name:"filter-operateur",$type:"block",$items:[{$type:"block",$items:[{$bind:"champ",$readOnly:!0,options:{$expression:"{{champ}}"}},{$bind:"operateur",options:{titleIsHidden:!0}}]}]},t,e.data,{},function(t,i,n){switch(t.property){case"operateur":if("propchange"==t.operation){var s=e.listeOperateurs.get(i.model().operateur);e.data.operateur=i.model().operateur,e.renderValue(s)}}})}}},e.prototype.renderValue=function(e){var t=this,n=l.query(t.container,".value");if(n){var s=i.formManager().formByName("filter-value");i.removeForm(s);var o=t.champ.options||{};o.champName=t.champ.code,t.modelType=new y(t.champ.options.format||t.champ.type,e,o),t.modelType&&t.modelType.init(function(){var e=t.modelType.getModel(),s=t.modelType.getLayout();if(e&&s){t.filter&&t.modelType.setValuesByFilter(t.filter.values);var o=t.modelType.getData();i.OpenForm($(n),s,e,o,{},function(e,i,n){switch(e.operation){case"propchange":default:t.modelType.setValues(i.model()),t.data.values=t.modelType.getValues()}})}else t.data.values=t.modelType.getValues()})}},e.prototype.renderButton=function(){var e=this,t={type:"object",properties:{},links:{add:{title:r.ui.Add}}},n=l.query(e.container,".link");if(n){var s=i.formManager().formByName("filter-link");i.removeForm(s),i.OpenForm($(n),{name:"filter-link",$type:"block",$items:[{$inline:!0,$items:[{$bind:"$links.add",options:{type:"primary",icon:"plus",right:!0}}],$colSize:12}]},t,e.data,{},function(t,n,s){switch(t.property){case"$links.add":var o=i.formManager().formByName("filter-value");if(!n.validate()||o&&!o.$model.validate())return;n.model();e.data.values&&e.data.values.length&&e.callBack({code:e.champ.code,op:e.data.operateur,values:e.data.values})}})}},e.prototype.render=function(e){e&&(this.container=e,l.empty(e),l.append(e,$(["<div>",'<div class="operateur">',"</div>",'<div class="value">',"</div>",'<div class="link">',"</div>","</div>"].join("")).get(0)),this.renderOperateur(),this.renderValue(this.listeOperateurs.get(this.data.operateur)),this.renderButton())},e}(),S=function(){function e(e,t,i,n,s,o){this.listeChamps=e,this.listeChampsArbre=t,this.listeFilters=i,this.listeOperateurs=n,this.listeTypes=s,this.options=o||{}}return e.prototype.createContainer=function(){this.container=document.createElement("div"),l.addClass(this.container,"bs-filter-view"),this.container.innerHTML=['<div class="row">','<div class="col-sm-5 bs-champ-list">',"</div>",'<div class="col-sm-7 filter-edit">',"</div>","</div>",'<div class="row">','<div class="col-sm-12 bs-filter-list">',"</div>","</div>"].join(""),this.champListView=l.query(this.container,".bs-champ-list"),this.filterListView=l.query(this.container,".bs-filter-list"),this.filterEditView=l.query(this.container,".filter-edit")},e.prototype.render=function(){return this.createContainer(),this.listeChamps.gets().length&&(this.showChampList(),this.selecteChamp(this,this.listeChamps.gets()[0].code)),this.container},e.prototype.showChampList=function(){var e=this;e._multiSelectList=new t.MultiSelectList(this.listeChampsArbre,{maxHeight:"auto"},function(t){t&&t.data.name&&e.selecteChamp(e,t.data.name)});var i=70*(e.options.listSize||7),n=$('<div class="bs-field-list-border" style="max-height:'+i+'px;"></div>').get(0);e._multiSelectList.render(n),l.append(e.champListView,n)},e.prototype.selecteChamp=function(e,t){e._multiSelectList.addItem(t),e.updateFilter(e,t);var i=e.listeFilters.getsByChamp(t),n=null;i&&i.length&&(n=i[0]),e.showFilterList(e,n)},e.prototype.showFilterList=function(e,t){var i=new g(e.listeChamps,e.listeFilters,e.listeOperateurs,function(t,i){if("EDIT"==t){var n=e.listeFilters.get(i.id);n&&e.selecteChamp(e,n.code)}else"REMOVE"==t?e.removeFilter(e,i.id):"VALIDE"==t&&e.valideFilters()},e.options,t);l.empty(e.filterListView),i.render(e.filterListView)},e.prototype.updateFilter=function(e,t){var i=e.listeChamps.get(t),n=e.listeFilters.getsByChamp(t),s=null;n&&n.length&&(s=n[0]);var o=new O(i,e.listeFilters,e.listeOperateurs,e.listeTypes,function(t){e.addFilter(e,t)},s,e.options);l.empty(e.filterEditView),o.render(e.filterEditView)},e.prototype.addFilter=function(e,t){var i,n=e.listeFilters.getsByChamp(t.code);i=!e.options.multiple&&n&&n.length?e.listeFilters.set(n[0].id,t):e.listeFilters.add(t.code,t.op,t.values),e.showFilterList(e,i)},e.prototype.removeFilter=function(e,t){var i=e.listeFilters.get(t).code;e.listeFilters.remove(t),e.selecteChamp(e,i)},e.prototype.valideFilters=function(){},e}(),P=function(t){__extends(i,t);function i(e,i,n,s,o,r,a){var l=this;return(l=t.call(this,e,i,n,s,o,$.extend(!0,{btnValidate:!0},r))||this)._callback=a,l}return i.prototype.createContainer=function(){var t=e.bootstrap4,i=['<div class="row">','<div class="col'+(t?"":"-xs")+'-12 bs-filter-list">',"</div>","</div>",'<div class="row">','<div class="col'+(t?"":"-xs")+'-12">','<h5 class="bs-block-title" data-ignore="true">'+(this.options.title||"Filtre")+"</h5>","</div>","</div>",'<div class="row">','<div class="col-sm-4 bs-champ-list">',"</div>",'<div class="col-sm-8 filter-edit">',"</div>","</div>"];this.container=document.createElement("div"),l.addClass(this.container,"bs-filter-view"),this.container.innerHTML=i.join(""),this.champListView=l.query(this.container,".bs-champ-list"),this.filterListView=l.query(this.container,".bs-filter-list"),this.filterEditView=l.query(this.container,".filter-edit")},i.prototype.valideFilters=function(){this._callback("VALIDE")},i}(S),I=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this,o=s;return n.registerListenerFor(o.$bind+".$item",o),s._state(),s}return t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(i){e.state[i]=t[i]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.click=function(e){var t=e.target;if("LI"==t.nodeName.toUpperCase()||"SPAN"==t.nodeName.toUpperCase()){var i=t;"SPAN"==t.nodeName.toUpperCase()&&(i=l.parentByTag(this.$element.get(0),t,"LI"));var n=-1;if(i&&(n=parseInt(l.attr(i,"data-id"),10)),n<0)return;i=null;var s=null;if(this.state.value.forEach(function(e,t){if(e.code==n)return s=e.model(),!1}),!s)return;"REMOVE"==l.attr(t,"data-id")?this.form.execAction("remove",s):this.form.execAction("upd",s)}},t.prototype._state2UI=function(){var e=this;e.createContainer(e.id),e.state.value&&e.state.value.forEach(function(t){e.addTag(t)})},t.prototype.destroy=function(){this.form.unRegisterListenerFor(this.$bind+".$item",this),e.prototype.destroy.call(this)},t.prototype.changed=function(e,t,i,n,s){"add"==n?this.addTag(i):"remove"==n&&this.removeTag(s.$value.code)},t.prototype.stateChanged=function(e,t){var i=this.form.getState(this.$bind),n=this.$element?this.$element.get(0):null;n&&i.isHidden!==this.state.isHidden&&(this.state.isHidden=i.isHidden,this.setHidden(n))},t.prototype.addTag=function(e){var t=document.createElement("li");l.addClass(t,"item"),l.addClass(t,"bs-boxed-tags-item"),l.addClass(t,"bs-cursor-p"),l.addClass(t,"btn-primary"),e.selected&&l.addClass(t,"focus"),l.attr(t,"data-id",e.code),t.innerHTML=e.libelle+' <span data-id="REMOVE" class="'+l.iconClass("remove")+'" ></span>',l.append(this.$element.get(0),t)},t.prototype.removeTag=function(e){var t=l.query(this.$element.get(0),'li[data-id="'+e+'"]');l.remove(t)},t.prototype.createContainer=function(e){this.$element=$(n.format('<ul id="{0}" data-render="{0}" class="bs-boxed-tags" draggable="true"></ul>',e))},t.prototype.render=function(e){var t=this._initOptions(o.utils.defaultOptions);return this.$element||(this.setEvents(null),this._state2UI()),this.appendElement(e,t),this.$element},t}(t.AbsField);i.registerControl(I,"array",!1,"tagview");var D=function(){function t(e){this.options=e||{},this._elements=[],this._values=[]}return Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},set:function(e){e&&(this._elements=e,this._notifyChange("elements"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this._values},set:function(e){e&&(this._values=e,this._notifyChange("values"))},enumerable:!0,configurable:!0}),t.prototype._notifyChange=function(e){switch(e){case"elements":l.empty(this.$element.get(0)),this.renderElements(this.elements||[],this.values||[],this.options||{})}},t.prototype.findVal=function(e){var t=-1;return this.values.forEach(function(i,n){if(i==e)return t=n,!1}),t},t.prototype.render=function(e){return this.$element||(this.$element=$('<div class="row bs-checkboxlist"></div>'),this.renderElements(this.elements,this.values,this.options),this.setEvents(null)),e&&(this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element)),this.$element},t.prototype.destroy=function(){this._removeEvents(),this.$element=null,this.options=null},t.prototype.removeVal=function(e){var t=this.findVal(e);t>=0&&this.values.splice(t,1)},t.prototype.addVal=function(e){this.values.push(e)},t.prototype.setEvents=function(e){var t=this;t.$element&&t.$element.on("click",function(e){if(!t.options.isDisabled&&!t.options.isReadOnly){var i=l.parentByClass(t.$element.get(0),e.target,"bs-checkboxlist-list");i&&t._toggleEnumByIndex(l.indexOf(i.parentNode,i))}})},t.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},t.prototype.renderElements=function(t,i,n){var s=e.bootstrap4,o=document.createDocumentFragment();if(t.length){n=n||{};var r=$('<div tabindex="0" class="bs-checkboxlist-list col-lg-6 col'+(s?"":"-xs")+'-12 checkbox-inline"><div class="bs-checkboxlist-list-check"><a><span class="'+l.iconClass("square-o")+'"></span></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);t.forEach(function(e,t){var s=r.cloneNode(!0);n.disabled?(l.attr(s,"tabindex","-1"),l.removeClass(s,"bs-pointer"),l.addClass(s,"bs-cursor-disabled")):(l.attr(s,"tabindex","0"),l.addClass(s,"bs-pointer"),l.removeClass(s,"bs-cursor-disabled"));s.firstChild.firstChild.firstChild.className=i&&i.indexOf(e.code)>=0?l.iconClass("check-square-o"):l.iconClass("square-o");var a=s.lastChild;l.append(a,document.createTextNode(e.libelle)),l.append(o,s)})}else{var a=$('<center><div class="bs-lv-nodata">Aucun résultat trouvé ...</div></center>').get(0);l.append(o,a)}l.append(this.$element.get(0),o)},t.prototype._inputs=function(){return this.$element.get(0)},t.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.className=t?l.iconClass("check-square-o"):l.iconClass("square-o")},t.prototype._toggleEnumByIndex=function(e){if(e>=0&&e<this.elements.length){var t=this.elements[e],i=this.findVal(t.code),n=this._inputs();i>=0?(this._setItemValue(n.childNodes[e],!1),this.removeVal(t.code),this.options.onSelectItem&&this.options.onSelectItem("remove",{id:e,value:t,data:t})):(this._setItemValue(n.childNodes[e],!0),this.addVal(t.code),this.options.onSelectItem&&this.options.onSelectItem("add",{id:e,value:t,data:t}))}},t}();t.CheckBoxList=D;var M=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s}return t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(i){e.state[i]=t[i]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.click=function(e){},t.prototype._state2UI=function(){},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.changed=function(e,t,i,n,s){},t.prototype.stateChanged=function(e,t){},t.prototype._createContainer=function(e,t,i,s){var o=['<div id="{0}" data-render="{0}">','<label for="{0}_input" id="{0}_label" class="'+(i?"":"bs-none")+'">'+(i||"")+"</label>",'<div id="{0}_toolbar"></div>',"<br />",'<div id="{0}_list"></div>','<center id="{0}_paginer"></center>',"</div>"];return n.format(o.join(""),e)},t.prototype._onSelectToolElement=function(e){"search"===e.name&&this._lookup.search(e.value)},t.prototype.createToolBar=function(e,t){if(this.$element&&!this._toolbar){t=$.extend(!0,{},{selectToolElement:this._onSelectToolElement.bind(this)}),this._toolbar=new i.ToolBar([{name:"search",type:"search",right:!1}],t);var n=l.query(this.$element.get(0),"#"+e+"_toolbar");if(!n)return;this._toolbar.render($(n))}},t.prototype._onSelectPaginer=function(e){switch(e){case"next":this._lookup.nextPage();break;case"prev":this._lookup.prevPage();break;case"first":this._lookup.firthPage();break;case"last":this._lookup.lastPage();break;default:this._lookup.toPage(e-1)}},t.prototype.createPaginer=function(e,t){if(this.$element){if(!this._pager){t=$.extend({size:"default",boundaryLinks:!0,selectPage:this._onSelectPaginer.bind(this)},t),this._pager=new i.Pager(t);var n=l.query(this.$element.get(0),"#"+e+"_paginer");if(!n)return;this._pager.render($(n))}var s=this._pager;s.props.totalPages=this._lookup.getNbPages(),s.props.currentPage=this._lookup.currentPage()+1}},t.prototype._onSelectCheckBoxList=function(e,t){"add"===e?this.state.value.push({code:t.value.code,lib:t.value.libelle}):"remove"===e&&this.state.value.remove(this.state.value.find("code",t.value.code))},t.prototype._getValues=function(){var e=$.extend(!0,{},this.state.value);return e._items=e._items.map(function(e){return e.code}),e._items},t.prototype.createList=function(e,t){if(this.$element&&!this._list){this._list=new i.CheckBoxList({onSelectItem:this._onSelectCheckBoxList.bind(this)}),this._list.values=this._getValues();var n=l.query(this.$element.get(0),"#"+e+"_list");if(!n)return;this._list.render($(n))}},t.prototype.createLookup=function(e){var t=this;if(t.$schema.ds){t._lookup=new i.DsLookup(t.$schema.ds,{notify:function(e,i){(i=i||{}).inited&&i.updated?t._lookup.firthPage():e&&(t.$schema.ds.data.$params.$search&&t.createToolBar(t.id,{}),t.createList(t.id,{}),t._list.elements=e,t.createPaginer(t.id,t.renderOptions.pager))}})}},t.prototype.render=function(e){var t=this._initOptions(o.utils.defaultOptions);return this.$element||(this.setEvents(null),this.$element=$(this._createContainer(this.id,a.tt(this.$schema.title,this.form.$locale),this.options.design,t)),this.createLookup({}),this._state2UI()),this.appendElement(e,t),this.$element},t}(t.AbsField);i.registerControl(M,"array",!1,"lookup-list",null);var T=function(e){__extends(t,e);function t(t,i,s){var o=e.call(this,t,i,s)||this;return o.renderInternal=function(e,t){var i=this;if(i.$element){var n;switch(t.renderModel){case"model2":n=new P(i.listeChamps,i.listeChampsArbre,i.listeFilters,i.listeOperateurs,i.listeTypes,t,function(e,t){"VALIDE"==e&&i.form.execAction("validate",{})});break;default:n=new S(i.listeChamps,i.listeChampsArbre,i.listeFilters,i.listeOperateurs,i.listeTypes,t)}l.append(i.$element.get(0),n.render())}},o.createContainer=function(e){return n.format('<div id="{0}" data-render="{0}" class="bs-filter"></div>',e)},o._state(),o._options=i||{},o.initData(),o}return t.prototype.initData=function(){var e=this;e.listeOperateurs=new p,Object.keys(c).forEach(function(t){var i=r.operators[t];e.listeOperateurs.add(t,i.title,i.binary,{symbol:i.symbol})}),e.listeTypes=new v,Object.keys(d).forEach(function(t){var i=r.types[t];e.listeTypes.addType(t,i.title,i.operators)}),e._updateData()},t.prototype._updateData=function(){var e=this;e.listeChamps=new h;var t=e.state.value&&e.state.value.lookups?e.state.value.lookups._model:{};(e.state.value&&e.state.value.champs?e.state.value.champs:[]).forEach(function(i){var n={};i.lookup?(n.lookupSchema=t[i.lookup]||u.getLookup(e.$bind,i.lookup,e.$schema,e.form.$rootSchema),n.lookup=i.lookup,n.format="lookup"):i.enum&&i.enum.length?(n.enum=i.enum,n.enumName=i.enumName,n.format="enum"):"boolean"===i.type?(n.enum=[{code:!0,libelle:r.ui.true},{code:!1,libelle:r.ui.false}],n.format="enum"):(n.decimals=i.decimals,n.format=i.format&&e.listeTypes.get(i.format)?i.format:null),i.type&&e.listeTypes.get(i.type)&&e.listeChamps.add(i.code,i.libelle,i.type,n)});var i=e.state.value&&e.state.value.filters?e.state.value.filters:[];e.listeFilters=new m(i),i.forEach(function(t){var i=[];t.values.forEach(function(e){i.push(e)});var n=[];t.values2&&t.values2.forEach(function(e){n.push(e)}),e.listeFilters.add2(t.code,t.op,n.length?n:i)}),e.listeChampsArbre=e.state.value&&e.state.value.entree&&e.state.value.entree.length?e.state.value.model().entree:null,e.listeChampsArbre?e.listeChampsArbre.forEach(function(e){e.items&&!e.items.length&&delete e.items}):e.listeChampsArbre=e.listeChamps.gets().map(function(e){return{name:e.code,title:e.libelle}})},t.prototype.refresh=function(){this._updateData(),l.empty(this.$element.get(0)),this.renderInternal({data:this.state.value},this._options)},t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(i){e.state[i]=t[i]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.render=function(e){var t=this._initOptions(o.utils.defaultOptions);return this.$element||(this.$element=$(this.createContainer(this.id)),l.empty(this.$element.get(0)),t.id=this.id,t.title=this.$schema.title||"",t=$.extend(!0,t,this.renderOptions),this._options=t,this.renderInternal({data:this.state.value},t)),this.appendElement(e,t),this.$element},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(t.AbsField);t.ComposantFilter=T,i.registerControl(T,"object",!1,"filter")}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=t,n=e.filters,s=e.locale,o=n.OPERATORS,r=function(e,t,i,n,s){var o={code:t,libelle:i,type:n,format:(s=s||{}).format||null,decimals:s.decimals,enum:s.enum,enumName:s.enumName,lookup:s.lookup};e.push(o)},a=function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")},l=function(e,t){var i=[];e.forEach(function(e){t.forEach(function(t){if(e.code===t.code)return e.lib=t.libelle,!1});var n,r=(e.lib||e.code)+" "+(n=e.op,s.operators[n].symbol||"");e.op===o.empty||e.op===o.nempty?r+=" vide":e.op===o.between||e.op===o.nbetween?r+=" "+e.values[0]+" et "+e.values[1]:e.getValueNames?r+=" "+e.getValueNames().join(","):r+=" "+e.values.join(","),i.length&&i.push(" et "),i.push(r)});return i.join("")};t.filter={format:{toPhenix:function(e,t){if(!e||!t)return null;var i=function(e,t){for(var n=[],s=e.length%2!=0,o=s?e.length-1:e.length,r=0;r<o;r+=2)n.push({$left:e[r],$op:t,$right:e[r+1]});return s&&n.push(e[e.length-1]),n.length>=2&&(n=i(n,t)),n},n=[];return t.forEach(function(t){n.push(function(t){var n=e.find(function(e){return e.code==t.code}),s=t.op==o.in?"eq":t.op;s=s==o.nin?"ne":s;var r=t.values.map(function(e){return void 0!==e.code?e.code:e});return s==o.between||s==o.nbetween?s==o.between?a(t.code,n.type,r[0],r[1]):{$op:"not",$right:a(t.code,n.type,r[0],r[1])}:(r=r.map(function(e){var i=null;switch(s){case o.like:i=l(t.code,n.type,e);break;case o.nlike:i={$op:"not",$right:l(t.code,n.type,e)};break;case o.empty:i={$left:t.code,$op:"eq",$right:{type:"string",value:""}};break;case o.nempty:i={$left:t.code,$op:"ne",$right:{type:"string",value:""}};break;default:i={$left:t.code,$op:s,$right:{type:n.type,value:e}}}return i}),i(r,"or")[0]);function a(e,t,i,n){return{$left:{$left:e,$op:o.ge,$right:{type:t,value:i}},$op:"and",$right:{$left:e,$op:o.le,$right:{type:t,value:n}}}}function l(e,t,i){return{$left:"contains("+e+",'"+i+"')",$op:null,$right:null}}}(t))}),i(n,"and")[0]},toMongoDbFilter:function(e,t){if(!e||!t)return null;var i=[];return t.forEach(function(t){e.find(function(e){return e.code==t.code});var n={},s=null,r=t.values.map(function(e){return void 0!==e.code?e.code:e});switch(t.op){case o.between:s={$gte:r[0],$lte:r[1]};break;case o.nbetween:s={$not:{$gte:r[0],$lte:r[1]}};break;case o.in:s=r.length>1?{$in:r}:r[0];break;case o.nin:s=r.length>1?{$nin:r}:{$ne:r[0]};break;case o.gt:s={$gt:r[0]};break;case o.ge:s={$gte:r[0]};break;case o.lt:s={$lt:r[0]};break;case o.le:s={$lte:r[0]};break;case o.like:s={$regex:a(r[0]),$options:"i"};break;case o.nlike:s={$not:{$regex:a(r[0]),$options:"i"}};break;case o.empty:s={$exists:!1};break;case o.nempty:s={$exists:!0}}null!==s&&void 0!==s&&(n[t.code]=s,i.push(n))}),i.length?{$and:i.map(function(e){return e})}:null},toTitle:l},removeMdbFilterExpress:function(e,t,i){return e},addMdbFilterExpress:function(e,t,i){return t},addField:function(e,t,i,n,s,o,a){var l={};l.decimals=s,l.enum=o,l.enumName=a,r(e,t,i,n,l)},addField2:r,transformPropsToFilterFormat:function(e,t){t.forEach(function(t){var n=$.extend(!0,{},t.schema);switch(n.type){case"number":n.decimals>0?n.type="decimal":n.type="integer"}t.schema.enum&&(n.enum=t.schema.enum.map(function(e,i){return{code:e,libelle:t.schema.enumNames?t.schema.enumNames[i]:e}})),i.filter.addField2(e,t.name,n.title,n.type,{decimals:n.decimals,enum:n.enum,format:n.format})})},toTitle:l,mongoDbFilter2Filter:function(e,t){if(!e)return null;if(e&&e.$and){var i=[];if(e.$and.forEach(function(e){var n=Object.keys(e)[0],s=(t.find(function(t){return e.code==t}),{op:"",values:[],code:n});if("object"==typeof(e=e[n])){var r=!1;e.$not&&(r=!0,e=e.$not),void 0!=e.$gte&&void 0!=e.$lte?(s.op=r?o.nbetween:o.between,s.values.push(e.$gte),s.values.push(e.$lte)):e.$in?(s.op=o.in,s.values=e.$in):e.$nin?(s.op=o.nin,s.values=e.$nin):e.$ne?(s.op=o.nin,s.values.push(e.$ne)):e.$gt?(s.op=o.gt,s.values.push(e.$gt)):e.$gte?(s.op=o.ge,s.values.push(e.$gte)):e.$lt?(s.op=o.lt,s.values.push(e.$lt)):e.$lte?(s.op=o.le,s.values.push(e.$lte)):void 0!=e.$exists?s.op=e.$exists?o.nempty:o.empty:e.$regex?(s.op=r?o.nlike:o.like,s.values.push(e.$regex.replace(/\\\$/g,"$").replace(/\\\?/g,"?").replace(/\\\*/g,"*").replace(/\\\+/g,"+").replace(/\\\./g,".").replace(/\\\^/g,"^").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\{/g,"{").replace(/\\\}/g,"}").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\|/g,"|"))):s=null}else s.op=o.in,s.values.push(e);s&&i.push(s)}),i&&i.length)return i}return null}};var u=function(){function e(){this.filterComplex=null,this.filterExpress=null}return e.prototype.constructeFilter=function(){return this.filterComplex&&this.filterComplex.value&&this.filterExpress&&this.filterExpress.value?{title:this.filterComplex.title+" et "+this.filterExpress.title,value:{$left:this.filterComplex.value,$op:"AND",$right:this.filterExpress.value}}:this.filterComplex&&this.filterComplex.value?this.filterComplex:this.filterExpress&&this.filterExpress.value?this.filterExpress:{title:"",value:null}},e}();t.FilterManager=u,t.filterManagerFactory=function(){return new u}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){(e.ui||(e.ui={})).multiSelectUtils={transformPropsToMultiselectFormat:function(e,t,i){var n=t&&t.items?t.items:[],s=t&&t.fields?t.fields:[],o=t&&t.items?$.extend(!0,[],n):[];i?function e(t,i,n){t.forEach(function(t){t.items=t.items||[],e(t.items,t.fields||[],n)}),i.forEach(function(e){n.every(function(t){return e.name!==t.name||(e.title=t.schema.title||t.name,!1)}),t.push(e)})}(o,s,e):(r=o,e.forEach(function(e){var t={name:e.name,title:e.schema.title||e.name},i=function e(t,i){var n=null;return t.every(function(t){return t.name===i?(n=t,!1):!t.items||!(n=e(t.items,i))}),n}(r,e.schema.group);i?(i.items=i.items||[],i.items.push(t)):r.push(t)}));var r;return o},transformMultiSelectColumnsToGridColumnsFormat:function(e){var t=[];return e.forEach(function(e){t.push({$bind:e.name,options:{}})}),t},transformSelectedColumnsToMultiSelectFormat:function(e,t,i,n){i=i&&i.items?i.items:[];var s=[];return Object.keys(t).forEach(function(o){(!n||function e(t,i){var n=null;return t.every(function(t){return t.name===i&&(n=t),!t.items&&!t.fields||n||(n=e(t.fields||t.items,i)),!n}),n}(i||[],o))&&e.every(function(e){return e.name!==o||(t[o]&&s.push({name:o,title:e.schema.title||e.name}),!1)})}),s}}}(Phoenix||(Phoenix={}));!function(e){!function(t){e.utils,e.ulocale;var i=e.dom,n=(e.Observable.SchemaUtils,function(){function e(e,t,i){this._options=$.extend(!0,{mapping:{id:"name",lib:"title"},expandIcon:"plus-circle",collapseIcon:"minus-circle",checkedIcon:"check-square-o",uncheckedIcon:"square-o",itemIcon:"",groupIcon:"",multiSelect:!1,showTags:!1,groupLink:!1,itemLink:!0,border:!1,maxHeight:"300px"},t),this._name=this._options.mapping.id,this._title=this._options.mapping.libelle||this._options.mapping.lib,this._data=e||[],this._callback=i||null,this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._init()}return Object.defineProperty(e.prototype,"items",{get:function(){return this._data},set:function(e){this._data=e||[],this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._constructeNodes(this._nodes,this._options),this._container&&this._renderItems(this._nodes)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){var t=this;t._selectedItems=$.extend(!0,[],e),t._container&&t._selectedItems.forEach(function(e){t.addItem(e[t._name])})},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._constructeNodes(this._nodes,this._options)},e.prototype._getGroupNode=function(e,t){var i=this,n=null;return e.every(function(e){return e.items&&((n=e[i._name]===t?e:null)||(n=i._getGroupNode(e.items,t))),!n}),n},e.prototype._getItemNode=function(e,t){var i=this,n=null;return e.every(function(e){return!(n=e.items||e[i._name]!==t?null:e)&&e.items&&(n=i._getItemNode(e.items,t)),!n}),n},e.prototype._getItem=function(e,t){var i=this,n=null;return e.every(function(e){return e[i._name]===t?(n=e,!1):!e.items||!(n=i._getItem(e.items,t))}),n},e.prototype._getSelectedItemIndex=function(e){var t=this,i=-1;return t._selectedItems.every(function(n,s){return n[t._name]!==e||(i=s,!1)}),i},e.prototype._itemsIsSelected=function(e){var t=this,i=!0;return e.every(function(e){var n=!1;return t._selectedItems.every(function(i){return i[t._name]!=e[t._name]||(n=!0,!1)}),!!n||(i=!1,!1)}),i},e.prototype._itemsIsUnselected=function(e){var t=this,i=!0;return e.every(function(e){return t._selectedItems.every(function(n){return n[t._name]!=e[t._name]||(i=!1,!1)}),!!i}),i},e.prototype._constructeNodes=function(e,t){var n=this;Array.isArray(e)&&e.length&&(!function e(t,s,o,r,a){var l=$(n._template().item).get(0);n._options.border||i.addClass(l,"border-0");t.forEach(function(t){if(t[n._name]){t.level=o||0,t.show=1==r,t.parent=s||null,t.component=l.cloneNode(),t.items&&(t.tagsSize=0,e(t.items,t,t.level+1,!1,a));for(var u=t.parent;u;)u.tagsSize++,u=u.parent;for(var c=1;c<=t.level;c++)i.append(t.component,$(n._template().indent).get(0));if(t.items){var d=n._createIcon(t.component,a.expandIcon,"icon-group bs-cursor-p");if(i.attr(d,"data-event","click"),i.attr(d,"data-action","expand"),a.multiSelect){var p=n._createIcon(t.component,a.uncheckedIcon,"icon-check bs-cursor-p");i.attr(p,"data-event","click"),i.attr(p,"data-action","uncheckG")}else a.groupLink&&(i.attr(t.component,"data-event","click"),i.attr(t.component,"data-action","selectitem"),i.addClass(t.component,"bs-cursor-p"));n._createIcon(t.component,a.groupIcon)}else{var d=n._createIcon(t.component);if(i.addClass(d,"icon-exist"),a.multiSelect&&a.itemLink){var p=n._createIcon(t.component,a.uncheckedIcon,"icon-check bs-cursor-p");i.attr(p,"data-event","click"),i.attr(p,"data-action","uncheck")}else a.itemLink&&(i.attr(t.component,"data-event","click"),i.attr(t.component,"data-action","selectitem"),i.addClass(t.component,"bs-cursor-p"));n._createIcon(t.component,a.itemIcon)}i.append(t.component,$("<span>"+(t[n._title]||t[n._name])+"</span>").get(0)),i.attr(t.component,"data-id",t[n._name])}})}(e,null,0,!0,t),t.showTags&&n._addTags(n._nodes))},e.prototype._addTags=function(e){var t=this;e.forEach(function(e){if(e.items){var n=$(t._template().badge).get(0);i.append(n,document.createTextNode(""+e.tagsSize)),i.append(e.component,n),t._addTags(e.items)}})},e.prototype._template=function(){return{list:'<ul class="list-group bs-treeview"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge badge-pill badge-secondary float-right"></span>'}},e.prototype._createIcon=function(e,t,n){var s=$(this._template().icon).get(0);return t&&this._addIcon(s,t,n),i.append(e,s),s},e.prototype._addIcon=function(e,t,n){i.attr(e,"class","icon icon-exist "+i.iconClass(t)+(n?" "+n:""))},e.prototype._setEvents=function(){var e=this;e._container&&e._container.addEventListener("click",function(t){var n=t.target,s=null;if((s="click"===i.attr(n,"data-event")?n:i.parentByTag(e._container,n,"LI"))&&"click"===i.attr(s,"data-event")){var o=i.parentByTag(e._container,s,"LI"),r=i.attr(o,"data-id"),a=i.attr(s,"data-action");"expand"===a?e._display(r,!0):"collapse"===a?e._display(r,!1):"selectitem"===a?e._select(r,e._callback):"check"===a&&e._options.multiSelect?e._checkF(r,!1,e._callback):"uncheck"===a&&e._options.multiSelect?e._checkF(r,!0,e._callback):"checkG"===a&&e._options.multiSelect?e._checkG(r,!1,e._callback,!0):"uncheckG"===a&&e._options.multiSelect&&e._checkG(r,!0,e._callback,!0)}})},e.prototype._display=function(e,t){var n=this,s=n._getGroupNode(n._nodes,e);if(s){var o=function(e,t){e.forEach(function(e){if(e.show=t,e.items){o(e.items,!1);var s=i.query(e.component,".icon-group");s&&(n._addIcon(s,n._options.expandIcon,"icon-group bs-cursor-p"),i.attr(s,"data-action","expand"))}})};o(s.items,t);var r=i.query(s.component,".icon-group");n._addIcon(r,t?n._options.collapseIcon:n._options.expandIcon,"icon-group bs-cursor-p"),i.attr(r,"data-action",t?"collapse":"expand"),n._renderItems(n._nodes)}},e.prototype._select=function(e,t){var n=i.query(this._container,".active");n&&i.removeClass(n,"active"),this._selectedItems.splice(0);var s=this._getItem(this._nodes,e);s&&(this._showItem(e),i.addClass(s.component,"active"),(s=this._getItem(this._data,e))&&(this._selectedItems.push(s),t&&t({action:"add",data:s})))},e.prototype._unSelect=function(e,t){var n=i.query(this._container,".active");n&&i.removeClass(n,"active");var s=this._getItem(this._selectedItems,e);s&&(this._selectedItems.splice(0),t&&t({action:"remove",data:s}))},e.prototype._checkF=function(e,t,i){this._check(e,t,i);var n=this._getItem(this._nodes,e);if(n&&n.parent){var s=this._getItem(this._data,n.parent[this._name]);if(!s)return;t&&this._itemsIsSelected(s.items)?this._checkG(s[this._name],t,i,!1):!t&&this._itemsIsUnselected(s.items)&&this._checkG(s[this._name],t,i,!1)}},e.prototype._check=function(e,t,n){var s=this._getItem(this._data,e);if(s){var o=this._getItem(this._nodes,e).component,r=i.query(o,".icon-check");this._addIcon(r,t?this._options.checkedIcon:this._options.uncheckedIcon,"icon-check bs-cursor-p"),i.attr(r,"data-action",t?"check":"uncheck");var a=void 0,l=this._getSelectedItemIndex(e);t?l<0&&(this._selectedItems.push(s),a="add"):l>=0&&(this._selectedItems.splice(l,1),a="remove"),n&&a&&n({action:a,data:s})}},e.prototype._checkG=function(e,t,n,s){var o=this,r=o._getItem(o._data,e);if(r){var a=o._getItem(o._nodes,e).component,l=i.query(a,".icon-check");o._addIcon(l,t?o._options.checkedIcon:o._options.uncheckedIcon,"icon-check bs-cursor-p"),i.attr(l,"data-action",t?"checkG":"uncheckG"),s&&r.items.forEach(function(e){e.items?o._checkG(e.name,t,n,s):o._check(e.name,t,n)})}},e.prototype._showItem=function(e){var t=this,n=t._getItem(t._nodes,e);if(n){for(var s=n.parent;s;){r(s.items,!0);var o=i.query(s.component,".icon-group");t._addIcon(o,t._options.collapseIcon,"icon-group bs-cursor-p"),i.attr(o,"data-action","collapse"),s=s.parent}t._renderItems(t._nodes)}function r(e,n){e.forEach(function(e){if(e.show=n,e.items){r(e.items,!1);var s=i.query(e.component,".icon-group");s&&(t._addIcon(s,t._options.expandIcon,"icon-group bs-cursor-p"),i.attr(s,"data-action","expand"))}})}},e.prototype.addItem=function(e){this._options.multiSelect?this._checkF(e,!0):this._select(e)},e.prototype.removeItem=function(e){this._options.multiSelect?this._checkF(e,!1):this._unSelect(e)},e.prototype._renderItems=function(e){i.empty(this._container);var t=document.createDocumentFragment();!function e(t,n){t.forEach(function(t){t.show&&i.append(n,t.component),t.items&&e(t.items,n)})}(e,t),i.append(this._container,t)},e.prototype.render=function(e){return this._container||(this._container=$(this._template().list).get(0),this._container.style.maxHeight=this._options.maxHeight,this._options.border||i.addClass(this._container,"noborder"),this._renderItems(this._nodes),this.selectedItems=this._selectedItems,this._setEvents()),e&&i.append(e,this._container),this._container},e}());t.MultiSelectList=n}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e.utils,n=(e.ulocale,e.dom),s=e.drag,o=(e.uiutils,e.events);e.Observable.SchemaUtils;var r=function(){function t(e,t,i){this._options=$.extend(!0,{mapping:{id:"name",lib:"title"},removeIcon:"remove",border:!1},t),this._name=this._options.mapping.id,this._title=this._options.mapping.libelle||this._options.mapping.lib,this._data=e||[],this._callback=i||null,this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._init()}return Object.defineProperty(t.prototype,"items",{get:function(){return this._data},set:function(e){this._data=e||[],this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._constructeNodes(this._nodes,this._options),this._container&&this._renderItems()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=$.extend(!0,[],e),this._container&&this._renderItems()},enumerable:!0,configurable:!0}),t.prototype._init=function(){this._constructeNodes(this._nodes,this._options)},t.prototype._constructeNodes=function(e,t){var i=this,s=$(i._template().itemTag).get(0),o=$(i._template().icon).get(0);e.forEach(function(e){e[i._name]&&(e.component=s.cloneNode(),n.append(e.component,document.createTextNode(e[i._title]||e[i._name])),n.attr(e.component,"data-id",e[i._name]),n.append(e.component,o.cloneNode()),e.filter=!0)}),i._input=i._input||$(i._template().itemInput).get(0)},t.prototype._getItem=function(e,t){var i=this,n=null;return e.every(function(e){return e[i._name]!==t||(n=e,!1)}),n},t.prototype._getItemIndex=function(e,t){var i=this,n=-1;return e.every(function(e,s){return e[i._name]!==t||(n=s,!1)}),n},t.prototype._addTag=function(e,t){var i=this._getItem(this._selectedItems,e);i||(i=this._getItem(this._data,e))&&(this._selectedItems.push(i),this._getItem(this._nodes,e).filter=!1,this._renderItems(),t&&t({action:"add",data:i}))},t.prototype._removeTag=function(e,t){var i=this._getItemIndex(this._selectedItems,e);i>=0&&(this._selectedItems.splice(i,1),this._getItem(this._nodes,e).filter=!0,this._renderItems(),t&&t({action:"remove",data:this._getItem(this._data,e)}))},t.prototype._filterList=function(e){var t=this;e.toLowerCase(),t._nodes.forEach(function(i){i.filter=i[t._title].toLowerCase().indexOf(e)>=0&&null==t._getItem(t._selectedItems,i[t._name])});var i=[];t._nodes.forEach(function(e){e.filter&&i.push(e)}),t._menu.show({value:i},0,!0)},t.prototype._setEvents=function(e){var t=this;if(t._container&&(t._container.addEventListener("click",function(e){var i=e.target;if(i.href){"#"===n.attr(i,"href")&&(e.preventDefault(),e.stopPropagation())}if(i&&"click"===n.attr(i,"data-event")){if("remove"===n.attr(i,"data-action")){var s=n.parentByTag(t._container,i,"LI"),o=n.attr(s,"data-id");t._removeTag(o,t._callback)}}else t._menu&&t._menu.opened&&t._menu.inMenu(e.target)&&t._menu.click(e);var r=n.query(t._input,"input");r&&r.focus()}),t._container.addEventListener("keyup",function(e){13===e.keyCode&&t._menu&&t._menu.opened&&t._menu.select();var i=n.query(t._input,"input");i&&i.focus()})),t._input){var i=!0;t._input.addEventListener("keyup",function(e){var s=e.target;if(38===e.keyCode||40===e.keyCode);else if(8===e.keyCode){i?t._filterList(s.value):t._menu&&t._menu.opened&&t._menu.hide(s)}else if(13===e.keyCode&&s&&"keyup"===n.attr(s,"data-event")){var o=s;t._addTag(o.value,t._callback),o.value=""}else{t._filterList(s.value);var r=n.query(t._container,".bs-pillbox-item-tag.focus");r&&n.removeClass(r,"focus")}var a=n.query(t._input,"input");a&&a.focus()}),t._input.addEventListener("keydown",function(e){var s=e.target;if(40==e.keyCode&&t._menu&&t._menu.opened)t._menu.move(1);else if(38===e.keyCode&&t._menu&&t._menu.opened)t._menu.move(-1);else if(8===e.keyCode){if(s.value.length<=0&&t._selectedItems.length&&"keyup"===n.attr(s,"data-event")){var o=t._selectedItems[t._selectedItems.length-1],r=t._getItem(t._nodes,o[t._name]);n.hasClass(r.component,"focus")?(n.removeClass(r.component,"focus"),t._removeTag(o[t._name],t._callback)):n.addClass(r.component,"focus"),i=!1}else i=!0}else 9!=e.keyCode&&27!=e.keyCode||t._menu&&t._menu.opened&&t._menu.hide(s);var a=n.query(t._input,"input");a&&a.focus()})}t._drag=s.dragManager.addDrag([t._container]),t._drag.canStartDragHandler=t._canStartDrag.bind(t),t._drag.onDragStart=t._onDragStart.bind(t),t._drag.onDrag=t._onDrag.bind(t),t._drag.onDragEnd=t._onDragEnd.bind(t)},t.prototype._template=function(){return{list:'<ul class="bs-pillbox noborder"></ul>',itemTag:'<li class="bs-pillbox-item bs-pillbox-item-tag" data-drag="move"></li>',icon:'<span class="icon float-right '+n.iconClass(this._options.removeIcon)+' icon-remove bs-cursor-p" data-event="click" data-action="remove"></span>',itemInput:'<li class="bs-pillbox-item bs-pillbox-item-edit"><input autocomplete="off" autofocus="true" placeholder="..." data-event="keyup" data-action="add,remove" /></li>'}},t.prototype.addItem=function(e){this._addTag(e)},t.prototype.removeItem=function(e){this._removeTag(e)},t.prototype._canStartDrag=function(e){var t=this,s=e.target,o=n.parentByTag(t._container,s,"LI");if(o){var r=n.attr(o,"data-drag");if(!r)return!1;o.id||(o.id=i.allocID());var a=t._drag;if(a.coverDocument=!0,a.data.op=r,a.data.cloneId=o.id,a.data.column=n.attr(o,"data-id"),!a.data.column)return!1;var l=n.find(t._container,a.data.cloneId);a.cursor="move",a.moveX=!0,a.moveY=!0,a.startOffset=n.position(l,null);var u={top:0,height:l.offsetHeight},c=[];return t.selectedItems.forEach(function(e){var s=n.query(t._container,"li[data-id='"+e[t._name]+"']");s&&(s.id||(s.id=i.allocID()),c.push({htmlId:s.id,info:e}))}),a.data.childrenPositions=n.childrenPositions(t._container,c,!1,"free",u),!0}},t.prototype._onDragStart=function(e){var t=this._drag;if(!t.data.op)return!1;var i=n.find(this._container,t.data.cloneId),s=i.cloneNode(!0),o=n.position(i,null);return s.style.top=o.top+"px",s.style.left=o.left+"px",s.style.width=i.offsetWidth+"px",s.style.height=i.offsetHeight+"px",s.style.zIndex="5000",s.style.position="absolute",s.style.cursor="move",t.floatElement=s,n.append(document.body,t.floatElement),!0},t.prototype._onDrag=function(e){var t=this._drag;if(!t.data.op)return!1;var i=o.point(e),s=n.findNearest(i.x,i.y,t.data.childrenPositions);if(t.data.best!=s){var r={left:s.left,top:s.top,width:s.width,height:s.height};t.data.mdiv=n.showMove(t.data.mdiv,s.vertical,r,"bs-drag-color-info")}return t.data.best=s,!0},t.prototype._onDragEnd=function(e,t){var i=this._drag;if(!i.data.op)return!1;if(i.floatElement&&(n.remove(i.floatElement),i.floatElement=null),i.data.mdiv&&(n.remove(i.data.mdiv),i.data.mdiv=null),!e){if(i.data.best&&i.data.column){var s=i.data.best.info;if("empty"===i.data.best.position||s[this._name]===i.data.column)return;var o=this._getItem(this._selectedItems,i.data.column),r=this._getItemIndex(this._selectedItems,i.data.column);this.selectedItems.splice(r,1);var a=this._getItemIndex(this._selectedItems,s[this._name]);a="after"===i.data.best.position?a+1:a,this.selectedItems.splice(a,0,o),this._callback&&this._callback({action:"drag",srcIndex:r,destIndex:a,data:o})}this._renderItems();var l=n.query(this._input,"input");l&&l.focus()}},t.prototype._onMenuSelectItemHandler=function(e){if(e){this._addTag(e[this._name],this._callback);var t=n.query(this._input,"input");t&&(t.value="")}},t.prototype._includeDropDownMenu=function(){if(this._input){var t=n.query(this._input,"input");$(this._input).get(0).style.zIndex="3000",this._menu=new e.formdropitems.DropItems($(this._input),t,{primaryKey:this._name,search:this._title,onselect:this._onMenuSelectItemHandler.bind(this)})}},t.prototype._renderItems=function(){var e=this;n.empty(e._container);var t=document.createDocumentFragment();i=e._selectedItems,s=t,i.forEach(function(t){var i=e._getItem(e._nodes,t[e._name]);i&&(i.filter=!1,n.append(s,i.component))});var i,s;e._input&&n.append(t,e._input),n.append(e._container,t)},t.prototype.render=function(e){return this._container||(this._container=$(this._template().list).get(0),this._renderItems(),this._includeDropDownMenu(),this._setEvents(e)),e&&n.append(e,this._container),this._container},t.prototype.remove=function(){this._menu=null,this._drag&&(s.dragManager.rmvDrag(this._drag),this._drag=null)},t}();t.PillBox=r}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=t,n=e.utils,s=e.uiutils,o=(e.ulocale,e.dom),r=(s=e.uiutils,e.Observable.SchemaUtils,function(e){__extends(i,e);function i(t,i,n){var s=e.call(this,t,i,n)||this,o=s;o._state();var r=o.state.value.model().entree||[];return r=r.map(function(e){return e.items&&!e.items.length&&delete e.items,e}),o._sortie=o.state.value.sortie||[],o._options=$.extend(!0,{mapping:{id:"name",lib:"title"},multiSelect:!0,pillBox:!0,renderModel:"top",maxHeight:"300px"},o.renderOptions),o._name=o._options.mapping.id,o._title=o._options.mapping.libelle||o._options.mapping.lib,Array.isArray(r)&&(o._initMultiSelectList(r,o.state.value.model().sortie),o._options.pillBox&&o._initPillBox(o._extractItems(r,!1),o.state.value.model().sortie)),s}return i.prototype._initMultiSelectList=function(e,i){var n=this;n.multiSelectList||(n.multiSelectList=new t.MultiSelectList(e,n._options,function(e){if("add"===e.action)n.pillBox&&n.pillBox.addItem(e.data[n._name]),n._sortie.push(e.data);else if("remove"===e.action){n.pillBox&&n.pillBox.removeItem(e.data[n._name]);var t=n._getSortieItem(n._sortie,e.data[n._name]);t&&n._sortie.remove(t.data)}})),n.multiSelectList.selectedItems=i||[]},i.prototype._initPillBox=function(e,i){var n=this;n.pillBox=new t.PillBox(e,n._options,function(e){if("add"===e.action)n.multiSelectList.addItem(e.data[n._name]),n._sortie.push(e.data);else if("remove"===e.action){n.multiSelectList.removeItem(e.data[n._name]);var t=n._getSortieItem(n._sortie,e.data[n._name]);t&&n._sortie.remove(t.data)}else if("drag"===e.action){var i=n._getSortieItem(n._sortie,e.data[n._name]);n._sortie.remove(i.data),n._sortie.splice(e.destIndex,0,e.data)}}),n.pillBox.selectedItems=i||[]},i.prototype._getSortieItem=function(e,t){var i=this,n=null;return e.forEach(function(e,s){return e[i._name]!==t||(n={id:s,data:e},!1)}),n},i.prototype._extractItems=function(e,t){var i=[];!function e(t,i,n){t.forEach(function(t){t.items?(n&&i.push(t),e(t.items,i,n)):i.push(t)})}(e,i,t);return i},i.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(i){e.state[i]=t[i]}),e.state.value=e.form.getValue(e.$bind)},i.prototype._state2UI=function(){},i.prototype.changed=function(e,t,i,n,s){this._sortie=this.state.value.sortie||[];var o=this.state.value.model().entree||[];o=o.map(function(e){return e.items&&!e.items.length&&delete e.items,e});var r=this.state.value.model().sortie||[];this.multiSelectList&&(this.multiSelectList.items=o,this.multiSelectList.selectedItems=r),this.pillBox&&(this.pillBox.items=this._extractItems(o,!1),this.pillBox.selectedItems=r)},i.prototype._template=function(e){var t;switch(this._options.renderModel){case"left":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>","</div>"];break;case"right":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>","</div>"];break;case"bottom":t=['<div id="{0}" data-render="{0}">','<div id="{0}_multiselect">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_pillbox">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>"];break;default:t=['<div id="{0}" data-render="{0}">','<div id="{0}_pillbox">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_multiselect">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>"]}return n.format(t.join(""),e)},i.prototype.render=function(e){var t=this._initOptions(s.utils.defaultOptions);if(!this.$element){this.$element=$(this._template(this.id));var i=this.$element.get(0);if(!this._options.pillBox){var n=o.find(i,this.id+"_pillbox");n&&o.addClass(n,"bs-none")}if(this.pillBox){var r=o.query(i,'div[data-id="pillbox"]');this.pillBox.render(r)}if(this.multiSelectList){var a=o.query(i,'div[data-id="multiselect"]');this.multiSelectList.render(a)}}return this.appendElement(e,t),this.$element},i}(t.AbsField));t.ComposantMultiSelect=r,i.registerControl(r,"object",!1,"multiselectlist",null)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){var t=e.formgrid,i=e.ui;!function(n){var s={filter:{champs:[],filters:[],entree:[]}};t.toolBarFactory=function(t){var n=null,s=t.fieldOptions,o=[];s.toolbar&&s.toolbar.items&&$.extend(!0,{},s.toolbar).items.forEach(function(e){if(e.name=e.name||e.type,e.lookup){var n=null;n=new i.DsLookup(t.$schemaItems.lookups[e.lookup],{notify:function(i,s){if((s=s||{}).inited&&s.updated)n.firthPage();else if(i){e.value=e.value||{};var o={default:e.value.default,items:[],upd:!0};o.items=i||[],t.toolBar.setValue(e.name,o)}}})}if("count"===e.type)e=$.extend({right:!0,value:t.state.value.totalCount()},e);else if("filter"===e.type)e=$.extend({value:"",icon:"filter"},e),t.state.value.filterManager=t.state.value.filterManager||(i.filterManagerFactory?i.filterManagerFactory():null);else if("multiselect"===e.type){var r=!!(s.selecting&&s.selecting.row&&s.selecting.multiselect);e=$.extend(e,{style:"default",icon:"check",value:r})}else"filterexpress"===e.type&&(e=$.extend(e,{fields:t.getColumnsForFilterExpress(e.fields)}),t.state.value.filterManager=t.state.value.filterManager||(i.filterManagerFactory?i.filterManagerFactory():null));o.push(e)});if(o.length){var r={selectToolElement:function(t){var n=this,s=t.name||t.id;if("filter"===t.type&&e.formgrid.glbGridFilter){var o=!n.state.value.isQuery;return e.formgrid.glbGridFilter(n.getColumnsForFilter(o),function(e){o?n.state.value&&(n.state.value.filterManager.filterExpress=null,n.state.value.filter=e.value):(n.state.value.filterManager.filterComplex=e,n.state.value.filter=n.state.value.filterManager.constructeFilter())})}if("filterexpress"===t.type){var r=!n.state.value.isQuery;if(r){var a=n.getColumnsForFilter(r),l=n.state.value.filterManager.filterExpress?n.state.value.filterManager.filterExpress.value:null,u=t.value.value,c=n.state.value.filter;c&&(c=i.filter.removeMdbFilterExpress(c,l,a.schemaColumns)),n.state.value.filterManager.filterExpress=t.value,c=i.filter.addMdbFilterExpress(c,u,a.schemaColumns),n.state.value.filter=c}else n.state.value.filterManager.filterExpress=t.value,n.state.value.filter=n.state.value.filterManager.constructeFilter()}else{if("settings"===t.type&&e.formgrid.glbGridSettings){var d=n.getColumnsForSettings();return d.options=t.toolData,e.formgrid.glbGridSettings(d,function(e){n.setColumns(e)})}"multiselect"===t.type?n.toggleMultiselect():n.form.execAction(n.$bind+".$toolbar."+s,{toolElement:t,control:n})}}.bind(t),gridControl:t,composition:!t.state.value.isQuery,schema:t.$schema,form:t.form,bind:t.$bind,schemaItems:t.$schemaItems};n=new i.ToolBar(o,r)}return n},t.toolBarRender=function(e,t,i){t.render(e,i)},t.glbGridFilter=function(t,n,o){t.schemaColumns.length&&(void 0!==t.filters&&(s.filter.filters=t.filters),s.filter.champs.length&&s.filter.champs.splice(0),i.filter.transformPropsToFilterFormat(s.filter.champs,t.schemaColumns),s.filter.entree&&(s.filter.entree=i.multiSelectUtils.transformPropsToMultiselectFormat(t.schemaColumns,t.schemaGroups)),i.OpenModalForm({title:"Filtre",buttons:[{pattern:"validate"}]},{name:"filtre",$type:"block",$items:[{$type:"block",$items:[{$bind:"filter",$widget:"filter",options:{renderModel:"model1"}}]}],form:!0},{type:"object",properties:{filter:{type:"object",title:"Filtre",properties:{champs:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},type:{type:"string"},format:{type:"string"},decimals:{type:"number"},enumName:{type:"string"},enum:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"}}}},lookup:{type:"string"}}}},filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},op:{type:"string"},values:{type:"array",items:{type:"string"}},values2:{type:"array",items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}}}},entree:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}}}},definitions:{}},s,o,function(o,r,a,l){switch(r.property){case"validate":if(!a.validate())return;var u=null;(s=a.model()).filter.filters.length&&(u=t.mongoFilter?i.filter.format.toMongoDbFilter(s.filter.champs,s.filter.filters):i.filter.format.toPhenix(s.filter.champs,s.filter.filters)),n&&n({value:u,title:e.ui.filter.toTitle(s.filter.filters,s.filter.champs)}),o.close()}}))},t.glbGridSettings=function(e,t,n){e.options=e.options||{};var s={mselect:{entree:i.multiSelectUtils.transformPropsToMultiselectFormat(e.schemaColumns,e.schemaGroups,e.options.columnsLimited),sortie:i.multiSelectUtils.transformSelectedColumnsToMultiSelectFormat(e.schemaColumns,e.selectedColumns,e.schemaGroups,e.options.columnsLimited)}},o={title:e.locale&&e.locale.settingsTitle?e.locale.settingsTitle:"Options",buttons:[{pattern:"validate"}]};i.OpenModalForm(o,{name:"settings",$type:"block",$items:[{$type:"block",$items:[{$bind:"mselect",$widget:"multiselectlist",options:{multiSelect:!0}}]}],form:!0},{type:"object",properties:{mselect:{type:"object",properties:{entree:{type:"array",items:{$ref:"#/definitions/elt"}},sortie:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"}}}}}}},definitions:{elt:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}},s,n,function(e,n,s,o){switch(n.property){case"validate":if(!s.validate())return;var r=s.model().mselect.sortie;if(r<=0)return;var a=i.multiSelectUtils.transformMultiSelectColumnsToGridColumnsFormat(r);t&&t(a),e.close()}})},t.glbMongoFilter2Filter=i.filter.mongoDbFilter2Filter}(e.gridHandlers||(e.gridHandlers={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){!function(t){var i=e.dom,n=t,s=e.utils,o=e.locale,r=e.uiutils,a=e.Observable.SchemaUtils,l=e.link,u=function(){function e(e,t){this.id=s.allocID(),this.config=e||{},this.options=t||{}}return e.prototype.getValue=function(){return this.config.value},e.prototype.setValue=function(e){this.config.value=e,this.update()},e.prototype.setOptions=function(e){this.options=$.extend(!0,this.options,e),this.updateRender()},e.prototype.createElement=function(e,t,i){return s.format('<div data-tool-id="{0}" class="bs-toolbar-item">A</div>',this.id)},e.prototype.refresh=function(){this.update(),this.updateRender()},e.prototype.beforeAppend=function(){},e.prototype.after=function(){},e.prototype.render=function(e){return this.$element||(this.$element=$(this.createElement(this.config.id,this.config,this.config.value)),this._setEvents(),this.beforeAppend()),e&&i.append(e.get(0),this.$element.get(0)),this.$element},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this.options=null,this.config=null},e.prototype._setEvents=function(){},e.prototype._removeEvents=function(){},e.prototype.update=function(){},e.prototype.updateRender=function(){},e}();t.ToolElement=u;var c=function(e){__extends(t,e);function t(t,i){return e.call(this,t,i)||this}return t.prototype.createElement=function(e,t,i){var n=[];t.style&&n.push(t.style);var o=t.widget=t.widget||"h4",r=['<div data-tool-id="{0}" class="bs-toolbar-item">',"<"+o+' class="'+n.join(" ")+'" style="display:inline-block" data-id="title">',t.value||"","</"+o+">","</div>"];return s.format(r.join(""),this.id)},t.prototype.update=function(){if(this.$element){var e=i.query(this.$element.get(0),this.config.widget+'[data-id="title"]');i.text(e,this.config.value)}},t}(u);t.ToolElementTitle=c;var d=function(e){__extends(t,e);function t(t,i){return e.call(this,t,i)||this}return t.prototype.createElement=function(e,t,i){var n=[];t.style&&n.push(t.style);t.widget=t.widget||"h4";var o=['<div data-tool-id="{0}" class="bs-toolbar-item">','<span class="'+n.join(" ")+" "+(t.value||"")+'"></span>',"</div>"];return s.format(o.join(""),this.id)},t}(u);t.ToolElementIcon=d;var p=function(e){__extends(t,e);function t(t,i){return e.call(this,t,i)||this}return t.prototype.createElement=function(e,t,n){var o=["bs-button btn"],r=i.bootstrapStyles().secondary;t.style=t.style.trim(),t.style&&(r=t.style,"default"===(r=i.bootstrapStyles(!0).secondary)&&(r=i.bootstrapStyles(!0).secondary)),o.push("btn-"+r);var a=['<div data-tool-id="{0}" class="bs-toolbar-item">','<button id="toolbar-item'+(t.name?"-"+t.name:"")+'" toolClick="'+e+'" type="button" class="'+o.join(" ")+'">',t.icon?'<span class="'+i.iconClass(t.icon)+'" toolClick="'+e+'" ></span>':"",t.title?"&nbsp;"+t.title:"","</button>","</div>"];return s.format(a.join(""),this.id)},t}(u);t.ToolElementButton=p;var h=function(e){__extends(t,e);function t(t,i){return e.call(this,t,i)||this}return t.prototype.createElement=function(e,t,i){var n=['<span data-tool-id="{0}" tool="'+e+'" class="'+["badge-secondary","form-control-plaintext","bs-toolbar-item","bs-toolbar-item-count"].join(" ")+'">'+i+"</span>"];return s.format(n.join(""),this.id)},t.prototype.update=function(){this.$element&&i.text(this.$element.get(0),this.config.value)},t}(u);t.ToolElementCount=h;var f=function(t){__extends(n,t);function n(e,i){return t.call(this,e,i)||this}return n.prototype.createElement=function(t,n,o){var r=[];n.actions&&n.actions.forEach(function(t){e.bootstrap4?r.push('<a href="#" class="dropdown-item" data-id="'+t.code+'">'+(t.lib||t.code)+"</a>"):r.push('<li data-id="'+t.code+'"><a href="#" data-id="'+t.code+'">'+(t.lib||t.code)+"</a></li>")});var a=[];n.title||n.icon||a.push('<span class="'+i.iconClass("bars")+'"></span> '),n.icon&&a.push('<span class="'+i.iconClass(n.icon)+'"></span> '),n.title&&a.push(" "+n.title+" ");var l=['<div  data-tool-id="{0}" tabindex="'+t+'" class="'+["bs-toolbar-item dropdown"].join(" ")+'">','<button class="bs-button btn btn-'+i.bootstrapStyles(!0).secondary+' dropdown-toggle" id="tooltip-dropdown-'+t+'" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',a.join(""),"</button>",e.bootstrap4?'<div class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-'+t+'" data-id="toolCommands">':'<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-'+t+'" data-id="toolCommands">',r.join(""),e.bootstrap4?"</div>":"</ul>","</div>"];return s.format(l.join(""),this.id)},n.prototype.click=function(e){var t=e.target,n=i.attr(t,"data-id");n&&this.options.callback&&this.options.callback({id:this.config.id,name:this.config.name,type:this.config.type,value:n,toolData:this.config})},n}(u);t.ToolElementDropdownAction=f;var m=function(e){__extends(t,e);function t(t,i){var n=e.call(this,t,i)||this,r=n;r._form=r.options.form,r._schema=r.options.schema,r._schemaItems=r.options.schemaItems,r._bind=r.options.bind,r._grid=r.options.gridControl,r._selected=[],t.links=t.links||[],t.title=t.title||o.ui.Actions,t.options=t.options||{},void 0===t.options.caret&&(t.options.caret=!0),t.options.type=t.options.type||"secondary",t.options.titleIsHidden&&(t.options.icon=t.options.icon||t.right?"ellipsis-v":"bars");var a=r._schema.links||{};return t.links.forEach(function(e){e.id=s.allocID(),a[e.name]?(e.options=e.options||{},e.options.type=e.options.type||"secondary",e.schema=a[e.name],e.bind=r._bind+".$links."+e.name,e.isHidden=!1,r._form.registerListenerFor(e.bind,r)):console.log("Invalid link name: "+e.name)}),r._form.registerListenerFor(r._bind,r),r._updateselected(),r._state(),n}return t.prototype.beforeAppend=function(){this._state2Ui()},t.prototype._state2Ui=function(){var e=this,t=0;if(e.config.links.forEach(function(n){var s=!n.state.isHidden;if(s&&n.schema.select&&(e._selected.length?n.schema.select.multiselect||(s=1===e._selected.length):s=!1),s&&!n.important&&t++,e.$element){var o=i.find(e.$element.get(0),n.id);s?i.removeClass(o,"bs-none"):i.hasClass(o,"bs-none")||i.addClass(o,"bs-none"),s&&(n.state.isDisabled?i.hasClass(o,"disabled")||i.addClass(o,"disabled"):i.removeClass(o,"disabled"))}}),e.$element){var n=i.find(e.$element.get(0),"actions_"+e.id);t?i.removeClass(n,"bs-none"):i.hasClass(n,"bs-none")||i.addClass(n,"bs-none")}},t.prototype._updateselected=function(){var e=this._form.getValue(this._bind);e&&(this._selected=e.getSelectedItems(this._grid.renderOptions.expandingProperty))},t.prototype._stateOfLink=function(e){var t=this._form.getState(e.bind);e.state=e.state||{},Object.keys(t).forEach(function(i){e.state[i]=t[i]})},t.prototype._state=function(){var e=this;e.config.links.forEach(function(t){e._stateOfLink(t)})},t.prototype.findLinkByBind=function(e){for(var t=0;t<this.config.links.length;t++)if(this.config.links[t].bind===e)return this.config.links[t];return null},t.prototype.findLinkById=function(e){for(var t=0;t<this.config.links.length;t++)if(this.config.links[t].id===e)return this.config.links[t];return null},t.prototype.stateChanged=function(e,t){if(e&&t&&t.property&&t.property.indexOf(".$links")>=0){var i=this.findLinkByBind(t.property);i&&(this._stateOfLink(i),this._state2Ui())}},t.prototype.changed=function(e,t,i,n,s){if(this.$element){var o=e.substr(this._bind.length);if(!(o.indexOf(".$selected")>=0||o.indexOf(".$links")>=0||"propchange"!==n&&"add"!==n&&"remove"!==n))if(e===this._bind)this._updateselected(),this._state2Ui();else{var r=e,l=a.parsePath(this._bind,r,this._grid.renderOptions.expandingProperty);if(s[l]){var u=e.substr(l.length+1);if(!u)return;a.isSelectField(u)&&(this._updateselected(),this._state2Ui())}}}},t.prototype._createImportantActions=function(e){var t=this;t.config.links.forEach(function(n){if(n.important){e.push('<div id="'+n.id+'" class="bs-toolbar-item'+(t.config.right?" right":"")+' " title="'+s.escapeHtml(n.schema.title)+'">');var o=!1;void 0!==n.options.outline?o=n.options.outline:["default","secondary","danger"].indexOf(n.options.type)>=0&&(o=!0),e.push('<button data-action-id="'+n.id+'" class="bs-button btn btn-'+i.bootstrapStyles(o)[n.options.type]+'" type="button">');var r=!1;n.options.icon&&(r=!0,e.push('<span data-action-id="'+n.id+'" class="'+i.iconClass(n.options.icon)+'"></span>')),!n.options.titleIsHidden&&n.schema.title&&e.push('<span data-action-id="'+n.id+'" '+(r?'class="d-none d-md-inline-block">&nbsp;':">")+s.escapeHtml(n.schema.title)+"</span>"),e.push("</button>"),e.push("</div>")}})},t.prototype._createMenuActions=function(e){this.config.links.forEach(function(t){t.important||e.push('<a id="'+t.id+'" data-action-id="'+t.id+'" href="#" class="dropdown-item">'+s.escapeHtml(t.schema.title)+"</a>")})},t.prototype.createElement=function(e,t,n){var o=[];return o.push('<div  data-tool-id="{0}" tabindex="{1}" class="bs-toolbar-item '+(this.config.right?" right":"")+(this.config.bottom?" bottom":"")+'">'),this._createImportantActions(o),o.push('<div class="dropdown">'),o.push('<button id="actions_{0}" title="'+s.escapeHtml(t.title)+'" class="bs-button btn btn-'+i.bootstrapStyles(!0)[t.options.type]+(t.options.caret?" dropdown-toggle":"")+'" id="tooltip-dropdown-{1}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),t.options.icon&&o.push('<span class="'+i.iconClass(t.options.icon)+'"></span>'),t.options.titleIsHidden||o.push('<span class="d-none d-md-inline-block">&nbsp;'+s.escapeHtml(t.title)+" </span>"),o.push("</button>"),o.push('<div class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-{1}" data-id="toolCommands">'),this._createMenuActions(o),o.push("</div>"),o.push("</div>"),o.push("</div>"),s.format(o.join(""),this.id,e)},t.prototype.destroy=function(){var t=this;t._bind&&(t._form.unRegisterListenerFor(t._bind,t),t._bind=null),t.config&&t.config.links.forEach(function(e){t._form.unRegisterListenerFor(e.bind,t)}),t._grid=null,t._form=null,t._schema=null,t._schemaItems=null,e.prototype.destroy.call(this)},t.prototype.click=function(e){var t=e.target;t.href&&e.preventDefault();var n=i.attr(t,"data-action-id");if(n){var s=this.findLinkById(n);s&&(s.isHidden||s.state.isDisabled||s.state.isHidden||this._form.execAction(s.bind,s.schema.select?this._selected:null),this._grid&&this._grid.setFocus())}},t}(u);t.ToolElementArrayAction=m;var v=function(e){__extends(t,e);function t(t,i){var n=e.call(this,t,i)||this;return t.value=t.value||{},t.value.default=l.context().$url.idTra,t.value.items=t.value.items||[],n}return t.prototype.createElement=function(e,t,i){var n=[];t.value.items&&t.value.items.forEach(function(e){n.push('<option value="'+e.code+'" '+(t.value.default==e.code?"selected":"")+">"+(e.lib||e.code)+"</option>")});var o=['<div data-tool-id="{0}" tabindex="'+e+'" class="'+["bs-toolbar-item"].join(" ")+'">','<div class="input-group">','<span class="input-group-prepend">','<span class="input-group-text">',t.title||"","</span>","</span>",'<select class="form-control" data-id="toolSelect">',n.join(""),"</select>","</div>","</div>"];return s.format(o.join(""),this.id)},t.prototype._select=function(){if(this.$element){if(this.$element.get(0))return i.query(this.$element.get(0),"select[data-id='toolSelect']")}},t.prototype.update=function(){var e=this;if(e.$element){var t=document.createDocumentFragment();e.config.value.items&&e.config.value.items.forEach(function(n){i.append(t,$('<option value="'+n.code+'" '+(e.config.value.default==n.code?"selected":"")+">"+(n.lib||n.libelle||n.code)+"</option>").get(0))});var n=e._select();n&&(i.empty(n),i.append(n,t))}},t.prototype._setEvents=function(){var e=this,t=e._select();t&&$(t).change(function(t){var i=t.target,n=i.options[i.selectedIndex];e.options.callback&&e.options.callback({id:e.config.id,name:e.config.name,type:e.config.type,value:n.value,toolData:e.config})})},t.prototype._removeEvents=function(){var e=this._select();e&&$(e).off("change")},t}(u);t.ToolElementSelect=v;var g=function(e){__extends(t,e);function t(t,i){var n=e.call(this,t,i)||this;return n.config.value="",n.oldValue="",n}return t.prototype.createElement=function(e,t,n){var o=['<div data-tool-id="{0}" tabindex="'+e+'" class="bs-toolbar-item input-group'+[].join(" ")+'">','<input toolKeyup="'+e+'" type="text" class="form-control" placeholder="'+(t.title||"Recherche")+'" />','<span class="input-group-append">','<button toolClick="'+e+'" class="bs-button btn btn-'+i.bootstrapStyles(!0).secondary+'" type="button">','<span toolClick="'+e+'" class="'+i.iconClass(t.icon||"search")+'"> </span>',"</button>","</span>","</div>"];return s.format(o.join(""),this.id)},t.prototype.update=function(){if(this.$element){var e=i.query(this.$element.get(0),"input");e&&(e.value=this.config.value)}},t.prototype.getValue=function(){return this.oldValue=this._getInputValue(),this.oldValue},t.prototype._getInputValue=function(){if(this.$element){var e=i.query(this.$element.get(0),"input");return e?e.value:null}},t.prototype._setEvents=function(){var e=this;if(e.$element){var t=e.$element.get(0);if(t){var n=i.query(t,"input"),s=i.query(t,"button");n.addEventListener("focus",function(e){n.select()}),t.addEventListener("blur",function(t){var i=t.explicitOriginalTarget&&t.explicitOriginalTarget!=s&&null==t.relatedTarget;i=i||(null==t.relatedTarget||t.relatedTarget&&t.relatedTarget!=s)&&void 0==t.explicitOriginalTarget,t.target==n&&i&&(e.config.value=" ",e.setValue(e.oldValue))},!0)}}},t}(u);t.ToolElementSearch=g;var y=function(s){__extends(o,s);function o(e,t){var i=s.call(this,e,t)||this,n=i;return n.config.value=e.fields||n.config.value,n._init(),i}return o.prototype._init=function(){var e=this,i=e.options||{};e.filterExpress=new n.FilterExpress(e.config.fields||[],function(i){if(e.options.callback){var s=null;(i=i?Array.isArray(i)?i:[i]:null)&&i.length&&(s=e.options.mongoDbFilter?t.filter.format.toMongoDbFilter(e.config.fields,i):n.filter.format.toPhenix(e.config.fields,i));var o="";s&&(o=e._formatTitle(e.config.fields,i)),e.options.callback({id:e.config.id,name:e.config.name,type:e.config.type,value:{title:o,value:s},toolData:e.config})}},i)},o.prototype.createElement=function(t,i,n){return e.utils.format('<div data-tool-id="{0}" class="bs-toolbar-item '+[].join(" ")+'"></div>',this.id)},o.prototype.render=function(e){return this.$element||(this.$element=$(this.createElement(this.config.id,this.config,this.config.value)),this.filterExpress&&this.filterExpress.render(this.$element)),e&&i.append(e.get(0),this.$element.get(0)),this.$element},o.prototype.updateRender=function(){i.empty(this.$element.get(0)),this._init(),this.filterExpress&&this.filterExpress.render(this.$element)},o.prototype._formatTitle=function(e,i){return t.filter.format.toTitle(i,e)},o.prototype.update=function(){this.$element&&(this.config.value=this.config.fields||this.config.value||[],this.filterExpress.fields=this.config.value)},o}(u);t.ToolElementFilterExpress=y;var _=function(t){__extends(n,t);function n(e,i){return t.call(this,e,i)||this}return n.prototype.createElement=function(t,n,o){var r=['<div data-tool-id="{0}" class="bs-toolbar-item">','<button toolClick="'+t+'" type="button" class="'+["bs-button btn btn-"+i.bootstrapStyles(!0).secondary].join(" ")+'">',n.icon?'<span toolClick="'+t+'" class="'+i.iconClass(n.icon)+'"></span>':"",n.title?"&nbsp;"+n.title:"","</button>",'<span class="bs-toolbar-item-filter '+(e.bootstrap4?"form-control-plaintext":"form-control-static")+' bs-cursor-h"></span>',"</div>"];return s.format(r.join(""),this.id)},n.prototype.addTooltip=function(e){var t=$('<span data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title= "'+e+'"> '+e+" </span>"),n=i.query(this.$element.get(0),".bs-toolbar-item-filter");i.empty(n),i.append(n,t.get(0)),t.tooltip&&t.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left"></div></div>'})},n.prototype.update=function(){this.$element&&this.addTooltip(this.config.value)},n.prototype.render=function(e){t.prototype.render.call(this,e);this.addTooltip(this.config.value)},n}(u);t.ToolElementFilter=_;var b=function(){function t(e,t){this.id=s.allocID(),this.options=t||{},this._map={},this.toolElements=e||[],this._schema=t.schema,this._form=t.form,this._schemaItems=t.schemaItems,this._bind=t.bind}return t.prototype.getSubControls=function(){var e=null;return this.toolElements.forEach(function(t){"control"===t.type&&(e=e||[],t.options=t.options||{},t.options.inline=!0,t.options._parentId=s.allocID(),e.push(t))}),e},t.prototype.addSubControls=function(e){this._subcontrols=this._subcontrols||[],this._subcontrols.push(e)},t.prototype.getChildren=function(){if(!this._subcontrols)return null;var e=[];return this._subcontrols.forEach(function(t){e.push({control:t,parent:t.fieldOptions._parentId})}),this._subcontrols=null,e},Object.defineProperty(t.prototype,"form",{get:function(){return this._form},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"schemaItems",{get:function(){return this._schemaItems},enumerable:!0,configurable:!0}),t.prototype.htmlRoots=function(){var e=[];return this.$elementTop&&e.push({position:"top",element:this.$elementTop.get(0)}),this.$elementBottom&&e.push({position:"bottom",element:this.$elementBottom.get(0)}),e},t.prototype.execClick=function(e){var t=i.attr(e.target,"toolClick");if(null!==t)this._onToolElement("click",t);else{var n=this._idComponent(e.target);n&&n.click&&n.click(e)}},t.prototype._idComponent=function(e){if(!this.$elementTop)return null;for(var t,i=e,n=this.$elementTop.get(0);i;){if(!i.getAttribute)return null;if(t=i.getAttribute("data-tool-id"))return this._map[t];i=i===n||i===document.body?null:i.parentNode}return this.$elementTop?null:void 0},t.prototype.getToolElement=function(e){var t=null;return this.toolElements.forEach(function(i,n){if(n==e||i.name===e)return t=i.$component,!1}),t},t.prototype.setValue=function(e,t){var i=this.getToolElement(e);i&&i.setValue(t)},t.prototype.getValue=function(e){var t=this.getToolElement(e);if(t)return t.getValue()},t.prototype.refresh=function(){this.toolElements.forEach(function(e){var t=e.$component;t&&t.refresh()})},t.prototype.setOptions=function(e,t){var i=this.getToolElement(e);i&&i.setOptions(t)},t.prototype.getOptions=function(e){var t=this.getToolElement(e);if(t)return t.getOptions()},t.prototype._onToolElement=function(e,t){if(t>=0){var i=this.getToolElement(t);if(i&&this.options.selectToolElement){var n=i.getValue();i.after(),this.options.selectToolElement({id:i.config.id,type:i.config.type,name:i.config.name,value:n,toolData:i.config},e)}}},t.prototype._setEvents=function(){var e=this;e.$elementTop&&!e.options.gridControl&&e.$elementTop.on("click",function(t){e.execClick(t)}),e.$elementTop&&e.$elementTop.on("keyup",function(t){if(13==t.keyCode){var n=i.attr(t.target,"toolKeyup");e._onToolElement("keyup",n)}}),e.$elementBottom&&!e.options.gridControl&&e.$elementBottom.on("click",function(t){e.execClick(t)})},t.prototype._controlById=function(e){return this._map[e]},t.prototype._removeEvents=function(){this.$elementTop&&this.$elementTop.off("click"),this.$elementBottom&&this.$elementBottom.off("click")},t.prototype._renderToolElements=function(e){var t=this;if(e.length&&t.$elementTop){var n=t.$elementTop.get(0),o=i.find(n,t.id+"_top_left"),r=i.find(n,t.id+"_top_right"),a=t.$elementBottom?t.$elementBottom.get(0):null,l=a?i.find(a,t.id+"_bottom_left"):null,u=a?i.find(a,t.id+"_bottom_right"):null;t._map={},e.forEach(function(e,i){e.id=i;var n=e.type,b=$.extend(!0,{callback:t.options.selectToolElement},e.options||{});switch(b.form=t._form,b.schema=t._schema,b.schemaItems=t._schemaItems,b.bind=t._bind,b.gridControl=t.options.gridControl,n.toLowerCase()){case"control":break;case"count":e.$component=new h(e,b);break;case"filter":e.$component=new _(e,b);break;case"search":e.$component=new g(e,b);break;case"filterexpress":b.mongoDbFilter=t.options.composition,e.$component=new y(e,b);break;case"dropdownaction":e.$component=new f(e,b);break;case"links":e.$component=new m(e,b);break;case"select":e.$component=new v(e,b);break;case"title":e.$component=new c(e,b);break;case"icon":e.$component=new d(e,b);break;default:e.style=e.style||e.type,e.$component=new p(e,b)}if(e.$component){t._map[e.$component.id]=e.$component;(x=e.bottom?a?e.right?$(u):$(l):null:e.right?$(r):$(o))&&e.$component.render(x)}else if("control"===n.toLowerCase()){var x;(x=e.bottom?a?e.right?$(u):$(l):null:e.right?$(r):$(o))&&x.append($(s.format('<div id="{0}" class="bs-toolbar-item"></div>',e.options._parentId)))}})}},t.prototype.render=function(t,i){var n=!1,o=(e.bootstrap4,['<div class="container-fluid no-x-padding no-x-margin">','<div class="bs-island bs-toolbar" data-render="{2}">','<div class="bs-toolbar-left mr-auto form-inline" id="{0}_{1}_left"></div>','<div class="bs-toolbar-right form-inline" id="{0}_{1}_right"></div>',"</div>","</div>"]);if(t&&!this.$elementTop&&(this.$elementTop=$(s.format(o.join(""),this.id,"top",this.options.gridControl?this.options.gridControl.id:this.id)),n=!0),i&&!this.$elementBottom&&(this.$elementBottom=$(s.format(o.join(""),this.id,"bottom",this.options.gridControl?this.options.gridControl.id:this.id)),n=!0),n){if(this._renderToolElements(this.toolElements),t){var r=t;this.options.replaceParent?((r=$("<div></div>")).append(this.$elementTop),t.replaceWith(r)):r.append(this.$elementTop)}i&&i.append(this.$elementBottom),this._setEvents()}},t.prototype.destroy=function(){this._removeEvents(),this.$elementTop=null,this.options=null,this.toolElements=null,this._map=null,this.toolElements&&(this.toolElements.forEach(function(e){e.$component&&(e.$component.destroy(),e.$component=null)}),this.toolElements=null),this._form=null,this._schema=null,this._schemaItems=null,this._subcontrols=null},t}();t.ToolBar=b;var x=function(e){__extends(t,e);function t(t,i,n){var s=e.call(this,t,i,n)||this;return s._state(),s}return t.prototype.getValue=function(e){return this._toolbar.getValue(e)},t.prototype.setValue=function(e,t){this._toolbar.setValue(e,t)},t.prototype.refresh=function(){this._toolbar.refresh()},t.prototype.getOptions=function(e){return this._toolbar.getOptions(e)},t.prototype.setOptions=function(e,t){this._toolbar.setOptions(e,t)},t.prototype.changed=function(e,t,i,n){this.refresh()},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.click=function(e){},t.prototype._createContainer=function(e){var t=this.renderOptions.style||"";return s.format('<div id="{0}" data-render="{0}" class="bs-tile '+t+'"></div>',e)},t.prototype._onSelectToolElement=function(e){var t=e.name||e.id;this.form.execAction(this.$bind+".$toolbar."+t,{toolElement:e,control:this})},t.prototype.render=function(e){var t=this._initOptions(r.utils.defaultOptions);if(!this.$element){this.$element=$(this._createContainer(this.id));var i=this.state.value||[];i.forEach(function(e){return delete(e=$.extend(!0,e,e.data,{options:e.options})).data,delete e.options,e});var s={selectToolElement:this._onSelectToolElement.bind(this)};this._toolbar=new n.ToolBar(i,s),this._toolbar.render(this.$element)}return this.appendElement(e,t),this.$element},t}(t.AbsField);t.ToolbarForm=x,n.registerControl(x,"array",!1,"toolbar")}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.min.js.map