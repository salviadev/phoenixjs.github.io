var Phoenix,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){!function(e){var t=function(){function e(){this._eventList=[]}return e.prototype.execute=function(e){this._eventList.push(e),this._execute()},e.prototype._execute=function(){var e=this;if(!e._inExec){e._inExec=!0;try{for(;e._eventList.length;){var t=e._eventList.shift();try{t()}catch(e){}}}finally{e._inExec=!1}}},e}();e.Serial=t;var n=function(){function e(e,t,n,i,o){var r=this;r.ondispose=o,r.promise=t,r.resolve=n,r.errorhandler=i,r.dataHandler=r.ondata.bind(r),e?r.timer=window.setTimeout(r._execute.bind(r),e):r._execute()}return e.prototype.ondata=function(e){var t=this.resolve;this.destroy(),t&&t(e)},e.prototype.onerror=function(e){var t=this.errorhandler;this.destroy(),t&&t(e)},e.prototype._execute=function(){var e=this;e.promise&&e.promise.then?e.promise.then(e.dataHandler,e.onerror.bind(e)):e.promise&&"function"==typeof e.promise?e.dataHandler(e.promise()):e.dataHandler(e.promise)},e.prototype._cleaTimeout=function(){var e=this;e.timer&&(window.clearTimeout(e.timer),e.timer=0)},e.prototype.destroy=function(){var e=this;e.resolve=null,e.errorhandler=null,e._cleaTimeout(),e.promise=null;var t=e.ondispose;e.ondispose=null,t&&t(e)},e}(),i=function(){function e(e){this.defaultDelay=0;var t=this;t.defaultDelay=e,t._error=t._errorHandler.bind(t),t._dispose=t._onEventDisposed.bind(t)}return e.prototype._errorHandler=function(e){this.onError&&this.onError(e)},e.prototype.clear=function(){var e=this;e.currentEvent&&(e.currentEvent.destroy(),e.currentEvent=null)},e.prototype._onEventDisposed=function(e){this.currentEvent=null},e.prototype.push=function(e,t,i){var o=this;o.clear();var r=i?0:o.defaultDelay;o.currentEvent=new n(r,e,t,o._error,o._dispose)},e.prototype.destroy=function(){this.clear()},e}();e.SingleEventBus=i,e.GlbSerial=new t}(e.serial||(e.serial={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c,p,h;t=e.utils||(e.utils={}),n=function(){return window.Promise||(window.ES6Promise?window.ES6Promise.Promise:null)},i=function(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t},o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[0].replace(/{(\d+)}/g,function(t,n){return n=parseInt(n,10),e[n+1]})},r=function(e,t){if(e)for(var n in e){var i=e[n];t[n];null===i||"object"!=typeof i||Array.isArray(i)?t[n]=i:(t[n]=t[n]||{},r(i,t[n]))}},s={scope:!1,destroy:!1,menu:!1,proxydata:!1},a=function(e,t){if(!e&&t||!t&&e)return!1;if(e===t)return!0;if(!e&&!t)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(!a(e[n],t[n]))return!1;return!0}if("object"==typeof e){if(typeof e!=typeof t)return!1;var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(var s=0,l=o.length;s<l;s++)if(!a(e[o[s]],t[o[s]]))return!1;return!0}return!1},l=function(e,t,n){var i=Object.keys(e),o=Object.keys(t);i.forEach(function(i){var r=e[i],s=o.indexOf(i);if(s>=0){o.splice(s,1);var u=t[i];if(u===r)return;null===u?n[i]=null:null===r?n[i]=u:Array.isArray(r)?a(r,u)||(n[i]=u):"object"==typeof r?a(r,u)||(n[i]={},l(r,u,n[i])):n[i]=u}else n[i]=null}),o.forEach(function(e){n[e]=t[e]})},u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},d=!1,c=function(e,t,n){if(e.indexOf(".")>=0){var i=t;return e.split(".").forEach(function(e){i&&(i=i[e])}),(i||"")+""}return void 0===t[e]?n?e:"":t[e]},p=function(e,t){switch(e){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"firstChar":return t&&t.length?t[0]:""}return t},t.Promise=n(),t.allocUuid=function(){return i(!1)+i(!0)+i(!0)+i(!1)},t.allocID=function(){return"I"+i(!1)+i(!1)+i(!1)+i(!1)},t.format=o,t.merge=r,t.formatNames=function(e,t){return e.replace(/{([^{]*)}/g,function(e,n){for(var i=n.split("."),o=t;i.length&&(o=o[i.shift()]););return o||""})},t.extend=function(e,t){return e=e||{},Object&&Object.assign?Object.assign(e,t):(Object.keys(t).forEach(function(n){e[n]=t[n]}),e)},t.logModule=function(e,t){return void 0!==t&&(s[e]=t),s[e]},t.log=function(e,t){s&&s[t]&&console.log(e)},t.equals=a,t.copy=function(e){var t={};for(var n in e)t[n]=e[n];return t},t.deltaPatch=function(e,t){var n={};return l(e,t,n),Object.keys(n).length?n:null},t.isNull=function(e){return null===e},t.isUndefined=function(e){return void 0===e},t.isNullOrUndefined=function(e){return null===e||void 0===e},t.logRule=function(e,t,n,i){if(d){e=(e||1)-1;var r=new Array(e).join("  ");"string"==typeof t?console.log(o('{0}{1}".',r,t)):console.log(o('{0} {4} Rule: "{1} - {2}", triggered by "{3}".',r,t.name,t.description,n,i))}},t.showRules=function(e){return void 0!==e&&(d=e),d},t.escapeHtml=function(e){return(e||"").replace(/[&<>"'\/]/g,function(e){return u[e]})},t.phoenixPath=function(){for(var e=document.getElementsByTagName("script"),t=e.length-1;t>=0;--t){var n=e[t].src.split("?")[0].split("/"),i=n.length,o=n[i-1].toLowerCase();if("phoenix.js"==o||"phoenix.min.js"==o||"core.js"==o&&"core"==n[i-2]){var r=i-1;return"core.js"==o&&r--,n.slice(0,r).join("/")}}throw"Invalid script Name"},t.parseExpression=function(e,t){return e.replace(/{{([^{]*)}}/g,function(e,n){return c(n,t,!1)})},t.hasExpression=function(e){return(e||"").indexOf("{{")>=0},t.parseVariable=function(e,t){return c(e,t,!0)},t.defineProperty=function(e,t){var n=t||this;Object.defineProperty(n.props,e,{get:function(){return n.data[e]},set:function(t){t!=n.data[e]&&(n.data[e]=t,n._notifyChange(e))},enumerable:!0})},t.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})},t.nextTick=window.setImmediate?function(e){setImmediate(function(){e()})}:function(e){setTimeout(function(){e()},0)},t.focusDelay=function(e){setTimeout(function(){e()},30)},t.dataAsPromise=function(e){return n().resolve(e)},t.extractAngularVars=function(e,t){return e.replace(/\{\{([^{]*)\}\}/g,function(e,n){return t.push({name:n.split("|")[0].trim()}),""}),t.length>0},t.execAngularExpression=function(e,t,n){return e.replace(/\{\{([^{]*)\}\}/g,function(e,i){for(var o=i.split("|"),r=(o[0]||"").trim(),s=n?t[r]:c(r,t,!1),a=1,l=o.length;a<l;a++)s=p((o[a]||"").trim(),s);return s})},t.gmapsKey="AIzaSyDiKrbrYbAywKceJxGkXMp-g2n0nHKCCQo",t.confirm=function(e,t,n,i){window.confirm(t)?n():i&&i()},t.alert=function(e,t,n){window.alert(t)},t.prompt=function(e,t,n){n(window.prompt(e,t))},t.cleanUpObject=function(e){Object.keys(e).forEach(function(t){e[t]=null})},t.getValue=function(e,t){var n=t.split(".");if(1===n.length)return e?e[t]:void 0;for(var i=e,o=null,r=0,s=n.length;r<s;r++){if(!(o=i[n[r]]))return o;i=o}return o},(h=Array.prototype).find||(h.find=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,i=Object(this),o=i.length>>>0,r=(t=arguments[1],0);r<o;r++)if(n=i[r],e.call(t,n,r,i))return n}),h.findIndex||(h.findIndex=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,i=Object(this),o=i.length>>>0,r=(t=arguments[1],0);r<o;r++)if(n=i[r],e.call(t,n,r,i))return r;return-1})}(Phoenix||(Phoenix={})),(Phoenix||(Phoenix={})).locale={},function(e){var t,n;t=e.customData||(e.customData={}),n={},t.register=function(e,t){for(var i=e.split("."),o=n,r=0,s=i.length-1;r<s;r++){var a=i[r];o[a]=o[a]||{},o=o[a]}o[i[i.length-1]]=t},t.unregister=function(e,t){for(var i=e.split("."),o=n,r=0,s=i.length-1;r<s;r++){var a=i[r];if(!o[a])return;o[a]=o[a]||{},o=o[a]}o[i[i.length-1]]=null},t.get=function(e){for(var t=e.split("."),i=n,o=null,r=0,s=t.length;r<s;r++){if(!(o=i[t[r]]))return o;i=o}return o}}(Phoenix||(Phoenix={})),function(e){e.device={phone:!1,tablet:!1,deviceType:""};var t=function(e){e=e||{};try{window.sessionStorage&&window.sessionStorage.setItem("$mem",JSON.stringify(e))}catch(e){}};e.$mem=function(){try{if(window.sessionStorage)return JSON.parse(window.sessionStorage.getItem("$mem"))||{}}catch(e){return{}}}(),e.save$mem=function(){t(e.$mem)},e.sessionPreferences=function(e,t){var n=null;try{n=JSON.parse(window.sessionStorage.getItem("preferences"))}catch(e){}if(void 0===t)return n?n[e]:void 0;(n=n||{})[e]=t;try{window.sessionStorage.setItem("preferences",JSON.stringify(n))}catch(e){}},e.preferences=function(e,t){var n=null;try{n=JSON.parse(window.localStorage.getItem("preferences"))}catch(e){}if(void 0===t)return n?n[e]:void 0;(n=n||{})[e]=t;try{window.localStorage.setItem("preferences",JSON.stringify(n))}catch(e){}},e.build={version:"0.1.0.0",release:!1,authMode:"dev"}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r;e.build;t=e.authentication||(e.authentication={}),n={},i={setItem:function(e,t){n[e]=t},getItem:function(e){return n[e]}},o=[],r=function(){var e=null;try{e=window.localStorage}catch(t){e=null}return e||(e=i),e},t.db=r,t.save=function(e,t){t||(e.basic="Basic "+window.btoa((e.login||"")+":"+(e.password||""))),r().setItem("authentication",JSON.stringify(e))},t.load=function(){try{return JSON.parse(r().getItem("authentication"))}catch(e){return null}},t.clear=function(){r().setItem("authentication","null"),o.forEach(function(e){e()})},t.registerAfterLogout=function(e){o.push(e)}}(Phoenix||(Phoenix={})),function(e){!function(e){var t={},n=function(e,n){return t[e]=n,n},i=function(e){return t[e]};function o(t,o){return t=t||e.name,void 0==o?i("application_"+t):n("application_"+t,o)}function r(){return e.configuration&&e.configuration.portailName?e.configuration.portailName:"portail"}e.core="phoenix",e.name="",e.support="",e.homeName="home",e.title="",e.licences={},e.configuration=null,e.useJSONPatch=!1,e.config=o,e.init=function(t,n,i){if(e.name=t,e.title=n,i&&i.homes&&i.homes[t]&&(e.homeName=i.homes[t]),e.configuration=i,angular){var o=i&&i.angularModules||[];Array.isArray(o)||"object"!=typeof o||(o=o[t]||[]),e.angularApplication=angular.module(t,o)}},e.portailName=r,e.isPortail=function(){return e.name===r()},e.isCustomizable=function(t,n){var i=o(e.name);return!(!i||!i.customizable)&&(n.indexOf(".json")<0&&(n+=".json"),i.customizable.indexOf([t,e.name,n].join("/"))>=0)}}(e.application||(e.application={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c,p,h;t=e.ajax||(e.ajax={}),n=e.utils,i=e.application,o=e.customData,r=e.authentication,s=e.locale,a={},l=function(e){var t=a["s"+e];return!(!t||t.disabled)&&(t.handlers.forEach(function(e){e()}),!0)},u=function(e){var t=null;if(e.responseText&&(t={responseText:e.responseText}),e.responseJSON)if(t=t||{},"object"==typeof e.responseJSON)t.json=e.responseJSON;else try{t.json=JSON.parse(e.responseJSON)}catch(e){}return t},d=function(e,t,i,o){var r=n.Promise;t&&":"===t.charAt(0)&&(t=location.protocol+"//"+location.hostname+t);var a={type:e,contentType:"application/json",accept:"application/json",url:t,data:null};return o&&o.headers&&(a.headers=o.headers,a.headers.contentType&&(a.contentType=a.headers.contentType)),i&&a.contentType.indexOf("application/json")>=0?a.data=JSON.stringify(i):a.data=i,new r(function(e,t){$.ajax(a).done(function(t,n,i){e(t)}).fail(function(n,i,r){if(o&&o.ignore&&o.ignore[""+n.status])return e({});if(l(n.status))return e({});n.status>=500&&s&&s.errors&&(i=s.errors.error500,r=null);var a=u(n);a&&(r=null);var d=null;r&&(d="string"==typeof r?{message:r}:r),(d=d||{message:i,detail:a}).status=n.status,t(d)})})},c={},p=function(e){if(!e){var t=i.config(i.name);e=t?t.odata:null}var n={headers:null};if(e&&e.headers&&(n.headers=e.headers),n.headers=n.headers||{},n.headers.Accept="application/json",e&&e.authentication){var o=r.load();if(o)switch(e.authentication){case"basic":n.headers.Authorization=o.basic;break;case"header-session":n.headers.Authorization="Bearer "+o.token}else delete n.headers.Authorization}return n},h=function(e,t,n,i){var o=c[e];if(o){if(o.loaded)return n(null);if(o.error)return n(o.error,null);window.setTimeout(function(){h(e,t,n,i)},20)}else c[e]={loading:!0},i?i.execute(function(t){c[e]=t?{error:t}:{loaded:!0},n(t)}):$.ajax({url:t,dataType:"script",cache:!0}).done(function(t,i,o){c[e]={loaded:!0},n(null)}).fail(function(t,i,o){var r=o||{message:i};c[e]={error:r},n(r)})},t.extractAjaxErrors=function(e){var t,n={message:"",list:[]};if(e&&"object"!=typeof e&&(e={message:e}),e=e||{},n.status=e.status,e.message=e.message||s.errors.unknownError,e.detail)if(e.detail.json&&e.detail.json.error){var i=e.detail.json.error,o=void 0;if(void 0!==i.details&&(o=i),t=i.message,i.innererror&&i.innererror.message&&"Json"===i.innererror.type&&(o=JSON.parse(i.innererror.message)),o)return n.message=o.message,o.details&&o.details.forEach(function(e){n.list.push({message:e.message,target:e.target})}),n}else t=e.detail.json&&e.detail.json.exceptionMessage?e.detail.json.exceptionMessage:e.detail.responseText;return n.message=t||e.message,n},t.get=function(e,t,i){var r;e&&":"===e.charAt(0)&&(e=location.protocol+"//"+location.hostname+e),!i&&(r=t)&&"function"==typeof r&&(i=t,t=null);var a={type:"GET",url:e,dataType:"json",accept:"application/json"},d=null;return t&&(d=t.$errors,delete t.$errors,Object.keys(a).forEach(function(e){t[e]=a[e]}),a=t),new(0,n.Promise)(function(e,n){$.ajax(a).done(function(t,n,o){i&&(t=i(t)),e(t)}).fail(function(i,r,a){if(t&&t.ignore&&t.ignore[""+i.status])return e({});if(d&&d[i.status+""]){var c=i.status+"";if("string"!=typeof d[c])return e(d[c]);var p=o.get(d[c]);p&&e(p())}if(l(i.status))return e({});i.status>=500&&s&&s.errors&&(r=s.errors.error500,a=null);var h=u(i);h&&(a=null);var f=null;a&&(f="string"==typeof a?{message:a}:a),(f=f||{message:r,detail:h}).status=i.status,f._ajax=!0,"error"===f.message&&f.detail&&f.detail.responseText&&(f.message=f.detail.responseText),n(f)})})},t.getScript=function(e){return new(0,n.Promise)(function(t,n){$.ajax({url:e,dataType:"script",cache:!0}).done(function(e,n,i){t(!0)}).fail(function(e,t,i){n(i||{message:t})})})},t.getDefaultAjaxOptions=p,t.put=function(e,t,n){return d("PUT",e,t,n)},t.patch=function(e,t,n){return d("PATCH",e,t,n)},t.post=function(e,t,n){return d("POST",e,t,n)},t.remove=function(e,t){return d("DELETE",e,null,t)},t.postAndDownload=function(e,t){var o=n.Promise,r=p(null),a=i.config(i.name)||{},u=a.rest&&a.rest.base||"";return e&&"/"===e.charAt(0)&&(u=""),u&&(e=u+"/"+e),new o(function(n,i){var o=function(e){var t=e.statusText;if(l(e.status))return n({});e.status>=500&&s&&s.errors&&(t=s.errors.error500),i({message:t,detail:null})},a=new XMLHttpRequest;a.open("POST",e,!0),a.responseType="arraybuffer",a.onload=function(){if(200===this.status||201===this.status){var e="",t=a.getResponseHeader("Content-Disposition");if(t&&-1!==t.indexOf("attachment")){var r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);null!=r&&r[1]&&(e=r[1].replace(/['"]/g,""))}var s=a.getResponseHeader("Content-Type");try{var l=new Blob([this.response],{type:s})}catch(e){return i(e)}if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(l,e),n({});else{var u=window.URL||window.webkitURL,d=u.createObjectURL(l);if(e){var c=document.createElement("a");void 0===c.download?window.location.href=d:(c.href=d,c.download=e,document.body.appendChild(c),c.click(),document.body.removeChild(c))}else window.location.href=d;setTimeout(function(){u.revokeObjectURL(d),n({})},300)}}else o(this)},a.onerror=function(){o(a)},a.setRequestHeader("Content-type","application/json"),r&&r.headers&&Object.keys(r.headers).forEach(function(e){a.setRequestHeader(e,r.headers[e])}),a.send(JSON.stringify(t))})},t.addAuthToUrl=function(e){var t=i.config(i.name);if(t&&t.odata&&t.odata.authentication){var n=r.load();if(n)switch(t.odata.authentication){case"basic":break;case"header-session":var o="token="+encodeURIComponent(n.token);e+=o=e.indexOf("?")>0?"&"+o:"?"+o}}return e},t.loadScript=h,t.interceptError=function(e,t){var n="s"+e;if(!("s401"===n&&(o=i.configuration,o&&o.authentication&&o.authentication.autoLogon&&o.authentication.autoLogon.force))){var o,r=a[n]||{disabled:!1,handlers:[]};r.handlers.push(t),a[n]=r}},t.activateInterceptError=function(e,t){var n=a["s"+e];n&&(n.disabled=!t)}}(Phoenix||(Phoenix={})),function(e){var t,n=e,i=n.locale,o=n.utils,r=n.ajax;!function(t){var n=[],s=function(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e},a=function(e,t){t=s(t,2);var n=Math.pow(10,t);return(Math.round(e*n)/n).toFixed(t)},l=function(e,t,n,i){if(null===e)return"";var o=s(t,0),r=e<0?"-":"",l=parseInt(a(Math.abs(e||0),o),10)+"",u=l.length>3?l.length%3:0;return r+(u?l.substr(0,u)+n:"")+l.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+n)+(o?i+a(Math.abs(e),o).split(".")[1]:"")},u=function(e,t,n,i,o,r){return null===e?"":(r=r||"%v %s").replace("%s",o).replace("%v",l(e,t,n,i))},d=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},c=function(e,t){for(var n=e+"";n.length<t;)n="0"+e;return n},p=function(e,t){var n=e.getDate(),o=e.getDay(),r=e.getMonth(),s=e.getFullYear(),a=e.getHours(),l=e.getMinutes(),u={d:n,dd:c(n,2),ddd:i.date.weekdaysShort[o],dddd:i.date.weekdays[o],m:r+1,mm:c(r+1,2),mmm:i.date.monthsShort[r],mmmm:i.date.months[r],yy:(s+"").slice(2),yyyy:s,H:a+"",HH:c(a,2),h:(a>12?a-12:a)+"",hh:c(a>12?a-12:a,2),M:l+"",MM:c(l,2),A:a>12?"PM":"AM"};return t.replace(/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTtA])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,function(e){return e in u?u[e]:e.slice(1,e.length-1)})},h=function(e){var t=i.date.dateShort.split("/");if(3!==t.length)return"";var n=(e||"").split(i.date.daySep),o=[0,0,0],r="";t.forEach(function(e,t){var i=0;"m"===e.charAt(0)?i=1:"y"===e.charAt(0)&&(i=2);var s=n[t]||"";if(2===t){var a=s.indexOf(" ");a>0&&(r=s.substr(a+1).trim(),s=s.substr(0,a))}o[i]=parseInt(s,10),2==i&&o[i]<100&&s.length<3&&(o[i]+=100*Math.round((new Date).getFullYear()/100))});var s={d:o[0],m:o[1],y:o[2],H:0,M:0,S:0};if(r){var a=i.date.shortTime.split(" "),l=r.split(" "),u=!1;a.length<=2&&l.length===a.length&&(2===a.length&&(u="PM"===l[1]),(l=l[0].split(":")).length>=2&&(s.H=parseInt(l[0],10),s.M=parseInt(l[1],10),l.length>2&&(s.S=parseInt(l[2],10)),u&&s.H<12&&(s.H=s.H+12)))}return s},f=function(e){var t=h(e),n=c(t.y,4)+"-"+c(t.m,2)+"-"+c(t.d,2),i=Date.parse(n);if(isNaN(i))return"";var o=new Date(n);return o.setHours(t.H),o.setMinutes(t.M),o.setSeconds(t.S),o.setMilliseconds(0),o.toISOString()},m=function(e){if(!e)return"";var t=d(e);if(!t)return"";var n=i.date.dateShort;return"/"!==i.date.daySep&&(n=n.replace(/\//g,i.date.daySep)),p(t,n+" "+i.date.shortTime)},v=function(e){if(!e)return"";var t=d(e);if(!t)return"";var n=i.date.dateShort;return"/"!=i.date.daySep&&(n=n.replace(/\//g,i.date.daySep)),p(t,n)},g=function(e,t){return e=e||0,t?u(e,i.number.places,i.number.thousand,i.number.decimal,i.number.symbol,i.number.format):l(e,i.number.places,i.number.thousand,i.number.decimal)},y=function(e,t,n){if(null===e)return"";e=e||0;var o=n?"%v %s":"%v";return u(e,t,i.number.thousand,i.number.decimal,n,o)},_=function(e,t,n,i){var o=e[t],r=e[n],s=e[i],a=new Date(s,r-1,o);return a.getFullYear()==s&&a.getMonth()+1==r&&a.getDate()==o};function b(e){var n=o.phoenixPath();e!=t.currentLang&&r.getScript(n+"/locale/phoenix_"+t.lang+".min.js").then(function(){t.currentLang=e}).catch(function(e){})}t.register=function(e){n.push(e)},t.translate=function(e,t){$.extend(!0,i,e),n.forEach(function(e){e(t)})},t.tt=function(e,t){return t=t||{},e&&"{{"==e.substring(0,2)?e.replace(/{{(.*)}}/g,function(e,n){for(var i=n.split("."),o=t,r=0,s=i.length;r<s&&o;r++)o=o[i[r]];return void 0===o?"["+n+"]":o}):e},t.currentLang="en",t.defCountry="US",t.lang="fr",t.country="FR",t.money=g,t.truncMoney=function(e){return parseFloat(e.toFixed(i.number.decimal))},t.decimal=y,t.integer=function(e){return(e||0)+""},t.format=function(e,t){if(!e||!t)return t;var n=[];return Object.keys(e).forEach(function(t){var i=e[t];"date"!==i.type&&"money"!==i.type&&"decimal"!==i.type&&"number"!==i.type||n.push({name:t,type:i.type,symbol:i.symbol,longdate:i.longdate,decimals:i.decimals,useSymbol:void 0===i.useSymbol||i.useSymbol})}),n.length?((Array.isArray(t)?t:[t]).forEach(function(e){n.forEach(function(t){switch(t.type){case"date":e[t.name]=v(e[t.name]);break;case"money":e[t.name]=g(e[t.name],t.useSymbol);break;case"integer":e[t.name]=y(e[t.name],0,t.symbol);break;case"decimal":case"number":e[t.name]=y(e[t.name],t.decimals,t.symbol)}})}),t):t},t.parseISODate=d,t.parseISODateAsUTC=function(e){return e?Date.UTC(parseInt(e.substr(0,4),10),parseInt(e.substr(5,2),10)-1,parseInt(e.substr(8,2),10),0,0,0):0},t.parseISODateTime=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},t.isoDatePart=function(e){var t=e||"",n=t.indexOf("T");return n>0&&(t=t.substr(0,n)),t},t.shortDateTime=m,t.shortDate=v,t.longDate=function(e){if(!e)return"";var t=d(e);if(!t)return"";var n=i.date.dateLong;return"/"!=i.date.daySep&&(n=n.replace(/\//g,i.date.daySep)),p(t,n)},t.monthYear=function(e){if(!e)return"";var t=d(e);if(!t)return"";var n=i.date.monthYear;return"/"!=i.date.daySep&&(n=n.replace(/\//g,i.date.daySep)),p(t,n)},t.localeDate2ISO=function(e){var t=h(e),n=c(t.y,4)+"-"+c(t.m,2)+"-"+c(t.d,2),i=Date.parse(n);return isNaN(i)?"":n},t.localeDateTime2ISO=f,t.date2ISO=function(e){var t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate();return c(t,4)+"-"+c(n,2)+"-"+c(i,2)},t.string2Float=function(e){var t=e.replace(new RegExp(i.number.thousand,"g"),"");"."!=i.number.decimal&&(t=t.replace(new RegExp(i.number.decimal,"g"),"."));var n=parseFloat(t);return isNaN(n)&&(n=0),n},t.tryParseDate=function(t){var n=e.locale.date.daySep,o=t.split(n);if(3!==o.length)return"";for(var r=0;r<3;r++)o[r]=parseInt(o[r],10);var s=0,a=0,l=0;switch(i.date.dateShort){case"dd/mm/yyyy":s=0,a=1,l=2;break;case"mm/dd/yyyy":s=1,a=0,l=2;break;case"yyyy/mm/dd":s=2,a=1,l=0}return o[l]<100&&(o[l]+=2e3),_(o,s,a,l)?(o[s]=c(o[s],2),o[a]=c(o[a],2),o[l]=c(o[l],4),o.join(i.date.daySep)):""},t.tryParseDateTime=function(e){var t=f(e);return t?m(t):""},t.localeTitle=function(e){return"object"==typeof e?e[t.currentLang]:e},t.loadLocale=b,["en","fr"].indexOf(t.lang)<0&&(t.lang=t.currentLang),b(t.lang)}(t=e.ulocale||(e.ulocale={})),(e.angularjs||(e.angularjs={})).registerFilters=function(e){e&&e.filter&&(e.filter("money",[function(){return function(e,n){var i=null===e?null:e?parseFloat(e):0;return t.money(i,n)}}]),e.filter("decimal",[function(){return function(e,n,i){var o=null===e?null:e?parseFloat(e):0;return t.decimal(o,n||0,i)}}]),e.filter("shortdate",[function(){return function(e){return t.shortDate(e)}}]),e.filter("longdate",[function(){return function(e){return t.longDate(e)}}]),e.filter("monthyear",[function(){return function(e){return t.monthYear(e)}}]))}}(Phoenix||(Phoenix={})),(Phoenix||(Phoenix={})).ulocale.translate({layouts:{design:{Save:"Save",New:"New page",Open:{title:"Open page",open:"Open",close:"Close"},PageName:"Page Name",InvalidPageName:"Invalid page name",ConflictedPageName:"A page of that name exists, do you want to give another name ?",Delete:"Delete page",DeletePreferences:"Delete preferences",ConfirmDelete:"Are you sure you want to delete this page ?",ConfirmDeletePrefs:"Are you sure you want to delete preferences for this page ?",Preview:"Preview",AuthoringMode:"Authoring",layouts:"Blocks",widgets:"Widgets",fields:"Fields",actions:"Actions",properties:"Properties",childrenFlow:"Children disposition",childrenFlowVertical:"Vertical Flow",childrenTableCell:"Table cell",childrenAccordionGroup:"Accordion Group",customStyle:"Custom style",nestedLayoutName:"Nested Layout Name",nestedLayoutBind:"Bind for nested layout",nestedFormController:"Controller for nested form",columnSize:"Size",customColumnSize:"Custom Size",appearance:"Appearance",appearanceAccordion:"Accordion",appearanceTabs:"Tabs",appearanceWizard:"None",showTitle:"Show title",bindPagesTitle:"Bind",name:"Name",forceDisplayTable:"Force display(Css) table",title:"Title",actionApply:"Apply",formType:"Form Type",ftVertical:"Vertical Form",ftHorizontal:"Horizontal Form",ftInline:"Inline form",labelSize:"Label width (Bootstrap cols)",blockPosition:"Position",bpStatic:"Static",bpStickyTop:"Sticky Top",bpStickyBottom:"Sticky Bottom",noTitlesForFields:"Don't show field's titles",fieldsTitle:"Children (Fields)"},defaultTitle:"No title",NoData:"No data"},schema:{required:"{0} is required.",minNumber:"{0} must be at least {1}",maxNumber:"{0} cannot exceed {1}",minNumberExclusive:"{0} must be greater than {1}",maxNumberExclusive:"{0} must be less than {1}",uniqueColumn:"The column '{0}' must be unique.",uniqueColumns:"Duplicate value for columns '{0}' found.",passwordMismatch:"Password mismatch.",invalidEmail:"Invalid Email Address",minLength:"{0} must be at least {1} characters"},ui:{Close:"Close",Abandon:"Abandon",Ok:"Ok",Yes:"Yes",No:"No",false:"False",true:"True",Warning:"Warning",Info:"Information",Disconnect:"Disconnect",Confirm:"Confirm",Validate:"Validate",Create:"create",password:{oldPassword:"Old Password",newPassword:"New Password",change:"Change password"},ApplyDetailChanges:"Apply",Selected:"Sel.",Add:"Add",selectedFilters:"Selected filters",OpenNewTab:"Open link in new tab",Search:"Search",Actions:"Actions"},errors:{Title:"Oops! An unknown error has occurred.",SendMail:"Send",MailSubject:"Error in JS client",ErrorTitle:"Error:",ErrorUser:"User:",ErrorDate:"Date and time:",Browser:"Browser:",ErrorURI:"Address:",Stack:"Call stack:",Context:"Context:",error500:"Internal server error",unknownError:"An unknown error has occurred.",notAuthorized:"Forbidden"},listView:{search:{Search:"Search",Nodata:"Aucun résultat trouvé ..."}},pagination:{Next:"»",Previous:"«",First:"First",Last:"Last"},number:{decimal:".",thousand:" ",places:2,symbol:"$",format:"%s %v"},charts:{numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",rangeSelectorZoom:"Zoom",rangeSelectorFrom:"From",rangeSelectorTo:"To"},date:{weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateShort:"mm/dd/yyyy",dateLong:"d mmm, yyyy",monthYear:"mmmm yyyy",shortTime:"hh:MM A",daySep:"-",weekStart:0,today:"Today",clear:"Clear"},operators:{in:{symbol:"=",title:"equal",binary:!1},nin:{symbol:"!=",title:"not equal",binary:!1},gt:{symbol:">",title:"is greater than",binary:!1},ge:{symbol:">=",title:"is greater or equal than",binary:!1},lt:{symbol:"<",title:"is less than",binary:!1},le:{symbol:">",title:"is less or equal than",binary:!1},between:{symbol:"between",title:"between",binary:!0},nbetween:{symbol:"not between",title:"not between",binary:!0},like:{symbol:"contains",title:"contains",binary:!1},nlike:{symbol:"not contains",title:"not contains",binary:!1},empty:{symbol:"is null",title:"is null",binary:!1},nempty:{symbol:"is not null",title:"is not null",binary:!1}},types:{number:{title:"Number",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},decimal:{title:"Decimal",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},money:{title:"Money",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},integer:{title:"Integer",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},date:{title:"Date",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},time:{title:"Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},"date-time":{title:"Date Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},string:{title:"String",operators:["in","nin","like","nlike","empty","nempty"]},enum:{title:"Enum",operators:["in","nin","empty","nempty"]},lookup:{title:"Lookup",operators:["in","nin","empty","nempty"]},boolean:{title:"Boolean",operators:["in","nin","empty","nempty"]}}},"en"),function(e){var t,n,i,o,r,s,a,l,u=e.utils;(n=t=e.external||(e.external={})).hashHandler=null,n.logoutHandler=null,n.forbiddenHandler=null,n.changePasswordHandler=null,n.checkLoggedInHandler=null,n.historyChangedHandler=null,n.formOpenHandler=null,n.preferenceLoadHandler=function(e){var t=u.Promise;return window.localStorage?new t(function(t,n){var i=window.localStorage.getItem("preferences."+e);t(i?JSON.parse(i):null)}):new t(function(e,t){e(null)})},n.preferenceSaveHandler=function(e,t){var n=u.Promise;return window.localStorage?new n(function(n,i){t?window.localStorage.setItem("preferences."+e,JSON.stringify(t)):window.localStorage.setItem("preferences."+e,""),n()}):new n(function(e,t){e()})},n.ruleLoaderHandler=null,n.ruleViewer=null,i=e.history||(e.history={}),o=[],i.removeLast=function(){o.pop(),t.historyChangedHandler&&t.historyChangedHandler()},i.add=function(e,n){if(n)return o=[e],void(t.historyChangedHandler&&t.historyChangedHandler());var i=o.length;(i?o[i-1]:"")!=e&&(e===(i>=2?o[i-2]:"")?o.pop():o.push(e),t.historyChangedHandler&&t.historyChangedHandler())},i.hasBack=function(){return o.length>1},i.value=o,i.locationPrefix="!",r=e.render||(e.render={}),s={},r.register=function(e,t,n){s[e]=s[e]||{},s[e][t]=n},r.get=function(e,t){return s[e]?s[e][t]:null},a=e.ipc||(e.ipc={}),l={},a.emit=function(e,t){var n=l["on"+e];n&&n.forEach(function(e){(e.listener?e.handler.bind(e.listener):e.handler)(t)})},a.listen=function(e,t,n){l[e]=l[e]||[],l[e].push({listener:n,handler:t})},a.unlisten=function(e,t){function n(t){if(t)for(var n=t.length;n--;)t[n].listener==e&&t.splice(n,1)}t?n(l[t]):Object.keys(l).forEach(function(e){n(l[e])})}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c,p,h,f,m,v,g,y,_,b,x,C,k,w,E,O;e.bootstrap4=!0,e.fontawesome=!1,e.modalPlugin="modal",n=t=e.dom||(e.dom={}),a={"arrow-left":"arrow-back","arrow-right":"arrow-forward","arrow-down":"arrow-downward","arrow-up":"arrow-upward",backward:"fast-rewind",bars:"menu",bolt:"toys",filter:"filter-list",wrench:"build",building:"add-to-queue",calendar:"date-range","caret-up":"arrow-drop-up","caret-down":"arrow-drop-down","check-square-o":"check-box","chevron-down":"expand-more","chevron-left":"chevron-left","chevron-right":"chevron-right","clock-o":"schedule",cloud:"cloud",cog:"settings","ellipsis-v":"more-vert","exclamation-circle":"error",eye:"visibility",forward:"fast-forward","file-o":"folder",floppy:"done","info-circle":"info",lock:"lock",minus:"remove",remove:"clear","minus-circle":"remove-circle",pencil:"edit","power-off":"power-settings-new",plus:"add","plus-circle":"add-circle","question-circle":"info",search:"search","square-o":"check-box-outline-blank",th:"apps","thumb-tack":"turned-in",times:"close","times-circle":"cancel","times-circle-o":"highlight-off",trash:"delete",user:"account-box","window-minimize":"fullscreen-exit","window-maximize":"fullscreen"},l=null,u=null,d=function(e,t,n){var i=(e||"").split(" "),o=i.indexOf(n);return t?o<0&&i.push(n):o>=0&&i.splice(o,1),i.join(" ")},c=0,p=function(t,n){void 0===n&&(n=!1);var i=e.fontawesome?t:a[t]?a[t]:t;return n?(e.fontawesome?"fa-":"mdi-")+i:(e.fontawesome?"fa fa-":"mdi mdi-")+i},h=function(e,t){return e?e.querySelectorAll(t):document.querySelectorAll(t)},f=function(e,t){return e?e.id==t?e:e.querySelector("#"+t):document.getElementById(t)},m=function(e,t){e.classList?e.classList.remove(t):e.className=d(e.className,!1,t)},v=function(e,t){return e.classList?e.classList.contains(t):(e.className||"").split(" ").indexOf(t)>=0},g=function(e){e.parentNode.removeChild(e)},y=function(e,t){e.appendChild(t)},_=function(e,t){if(t){var n=t.getBoundingClientRect(),i=e.getBoundingClientRect();return{left:Math.round(i.left-n.left),top:Math.round(i.top-n.top),width:Math.round(i.width),height:Math.round(i.height)}}var o,r,s,a,l;i=e.getBoundingClientRect();return o={left:i.left,top:i.top,width:i.width,height:i.height},r=document.documentElement.clientTop||document.body.clientTop||0,s=document.documentElement.clientLeft||document.body.clientLeft||0,a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,o.top=Math.round(o.top+a-r),o.left=Math.round(o.left+l-s),o},b=function(e,t){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},x=function(e,t,n){if(void 0===n&&(n=void 0),void 0===n)return e.getAttribute(t);e.setAttribute(t,n)},C=null,k=0,w=function(){$(window).trigger("global-phoenix-resize")},E=null,O=function(e){for(var t=(document.cookie||"").split("; "),n=0,i=t.length;n<i;n++){var o=t[n].split("=");if(e==o[0]){var r=o[1]||"";return""===r?null:r}}return null},n.readyHandlers=[function(){$(window).on("resize.phoenix",function(){E&&clearTimeout(E),E=setTimeout(w,50)})}],n.finalizeHandlers=[],n.keys={VK_TAB:9,VK_UP:38,VK_DOWN:40,VK_INSERT:45,VK_DELETE:46,VK_LEFT:37,VK_RIGHT:39,VK_ENTER:13,VK_ESCAPE:27,VK_F1:112,VK_HOME:36,VK_END:35,VK_PGUP:33,VK_PGDOWN:34,VK_SPACE:32,VK_F2:113,VK_F3:114,VK_F4:115,VK_BACKSPACE:8,VK_F10:121},n.queryAll=h,n.find=f,n.query=function(e,t){return e?e.querySelector(t):window.document.querySelector(t)},n.addClass=function(e,t){e.classList?e.classList.add(t):e.className=d(e.className,!0,t)},n.removeClass=m,n.hasClass=v,n.icon=function(e){var t=document.createElement("span");return t.className=p(e,!1),t},n.iconClass=p,n.customIconClass=function(e,t){return t?t+" "+t+"-"+e:p(e)},n.iconPrefix=function(){return e.fontawesome?"fa":"mdi"},n.bodyTheme=function(e){var t=document.body.firstElementChild;t&&v(t,"bs-content")||(t=document.body);for(var n=t.className||"",i=e?"bs-body-theme-"+e:"",o=n.split(" "),r=!1,s=o.length;s--;){var a=o[s];if(0==a.indexOf("bs-body-theme-")){if(a==i)return!1;r=!0,o.splice(s,1)}}i&&(r=!0,o.push(i)),r&&(t.className=o.join(" "))},n.offset=function(e){var t,n;if(3!=e.nodeType&&((t=e.getBoundingClientRect()).width||t.height)){var i=e.ownerDocument,o=null!=(n=i)&&n===n.window?n:9===n.nodeType&&n.defaultView,r=i.documentElement;return{top:t.top+o.pageYOffset-r.clientTop,left:t.left+o.pageXOffset-r.clientLeft,width:t.width,height:t.height,bottom:0,right:0}}return t||{top:0,left:0,width:0,height:0,bottom:0,right:0}},n.before=function(e,t){e.parentNode.insertBefore(t,e)},n.after=function(e,t){var n=e.parentNode;(e=e.nextSibling)?n.insertBefore(t,e):n.appendChild(t)},n.parentByTag=function(e,t,n){for(n=n.toUpperCase();t;){if(t.tagName===n)return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},n.parentByAttr=function(e,t,n){for(;t;){if(x(t,n))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},n.parentByClass=function(e,t,n){for(;t;){if(v(t,n))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},n.indexOf=function(e,t){for(var n=0,i=e.childNodes.length;n<i;n++)if(e.childNodes[n]==t)return n;return-1},n.append=y,n.prepend=function(e,t){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},n.select=function(e){e&&e.select()},n.empty=function(e){for(var t=e.childNodes.length-1;t>=0;t--)e.removeChild(e.childNodes[t])},n.remove=g,n.detach=function(e){return e.parentNode.removeChild(e),e},n.downloadFrame=function(){var e=f(document.body,"glb_down_frame");return e||((e=document.createElement("iframe")).style.cssText="position: absolute; top: -1000px; left -1000px; width: 0px; height: 0px;",e.frameBorder="0",e.scrolling="yes",e.id="glb_down_frame",e.src="about:blank",y(document.body,e)),e},n.attr=x,n.text=function(e,t){if(void 0===t)return e.textContent;if(e.childNodes.length){for(var n=!1,i=0,o=e.childNodes.length;i<o;i++){var r=e.childNodes[i];if(3==r.nodeType){r.nodeValue=t,n=!0;break}}n||y(e,document.createTextNode(t))}else e.textContent=t},n.findByAttribute=function(e,t,n){for(var i=e;i;){if(!i.getAttribute)return null;if(i.getAttribute(n))return i;i=i==t?null:i.parentNode}return null},n.isChildOf=b,n.parseStyle=function(e,t){e&&e.split(" ").forEach(function(e,n){(e=e.trim())&&"$"===e.charAt(0)&&(e="bs-style-"+e.substring(1)),t.push(e)})},n.ignoreKeys=[0,n.keys.VK_UP,n.keys.VK_DOWN,n.keys.VK_HOME,n.keys.VK_END,n.keys.VK_PGUP,n.keys.VK_PGDOWN,n.keys.VK_ENTER,n.keys.VK_ESCAPE,n.keys.VK_DELETE,n.keys.VK_BACKSPACE,n.keys.VK_INSERT],n.arrowKeys=[n.keys.VK_LEFT,n.keys.VK_RIGHT,n.keys.VK_UP,n.keys.VK_DOWN],n.processing=function(e,t){e?(k++,C||(k=1,(C=$('<div class="bs-cover'+(t?" bs-none":"")+'"></div>').get(0)).style.height=$(document).height()-1+"px",y(document.body,C),t&&setTimeout(function(){C&&m(C,"bs-none")},t))):(--k<=0&&(k=0),C&&0===k&&(g(C),C=null))},n.inProcessing=function(){return null!=C},n.inCover=function(e){return C&&b(C,e)},n.scrollbar=(i=!1,o=0,function(){if(i)return o;var e,t=document.createElement("div");return t.style.cssText="overflow:scroll; overflow-x:hidden; zoom:1; clear:both",t.innerHTML="&nbsp;",document.body.appendChild(t),e=t.offsetWidth-t.scrollWidth,document.body.removeChild(t),i=!0,o=e,e}),n.supportCssCalc=function(){var e=document.createElement("a");return e.style.cssText="width: calc(10px);",!!e.style.length},n.documentScroll=function(){return{left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}},n.documentClientDim=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},n.documentViewSize=function(){return{height:Math.max(document.documentElement.clientHeight||document.body.clientHeight,window.innerHeight||0),width:Math.max(document.documentElement.clientWidth||document.body.clientWidth,window.innerWidth||0)}},n.touch=(r=!1,s=!1,function(){return r?s:(s="ontouchend"in document,r=!0,s)}),n.position=_,n.childrenPositions=function(e,t,n,i,o){var r=new Array(t.length+1),s=o.firstDelta||0,a=o.lastDelta||0,l=o.delta||0,u=o.height||0,d=o.top||0;t.forEach(function(t,o){var a=f(e,t.htmlId),u=_(a,null);r[o]={info:t.info,zone:i,position:"before",vertical:n,point:{x:0,y:0},left:u.left+(n?0:0===o?s:l),top:d||u.top,width:Math.round(a.offsetWidth),height:Math.round(a.offsetHeight),htmlId:t.htmlId}});var c=null;if(r.forEach(function(e){var t=e.point;t.y=e.top+(e.height>>1),t.x=e.left+(e.width>>1),c=e}),c){var p=a-(0===r.length?s:l);c={position:"after",zone:i,info:c.info,vertical:c.vertical,point:{x:0,y:0},left:c.left+(n?0:p)+(n?0:c.width),top:c.top+(n?c.height:0),width:c.vertical?c.width:0,height:u||(c.vertical?0:c.height),htmlId:c.htmlId}}else{var h=_(e,null);c={info:{},position:"empty",zone:i,vertical:n,point:{x:0,y:0},left:h.left+(n?0:a),top:d||h.top,width:Math.round(e.offsetWidth),height:u||Math.round(e.offsetHeight),html:e.id}}return c.point.y=c.top+(c.height>>1),c.point.x=c.left+(c.width>>1),r[t.length]=c,r},n.findNearest=function(e,t,n){var i,o,r=1e6;return n.forEach(function(n){var s,a=Math.abs(n.point.y-t);a<r?(r=a,o=Math.abs(n.point.x-e),i=n):a==r&&(s=Math.abs(n.point.x-e))<o&&(o=s,i=n)}),i},n.showMove=function(e,t,n,i){if(i=i||"bs-drag-color-info",e)if(e.vertical!==t)g(e),e=null;else{var o=e.firstChild.firstChild;v(o,i)||(g(e),e=null)}if(!e){var r=['<div class="bs-absolute">'];r.push('<div class="bs-absolute" style="left: 0px; top: 0px"><span class="'),t?r.push(p("arrow-left")):r.push(p("arrow-down")),i&&r.push(" "+i),r.push('"></span></div>');var s=[];r.push('<div class="bs-absolute" style="'),t?(s.push("right: 0px;"),s.push("bottom: 0px;"),r.push(s.join("")),r.push('"><span class="'),r.push(p("arrow-right"))):(s.push("left: 0px;"),s.push("bottom: 0px;"),r.push(s.join("")),r.push('"><span class="'),r.push(p("arrow-up"))),i&&r.push(" "+i),r.push('"></span></div>'),r.push("</div>"),(e=$(r.join("")).get(0)).vertical=t,y(document.body,e)}var a=e.style,l=e.firstElementChild,u=e.lastElementChild,d=Math.round(l.offsetWidth),c=Math.round(u.offsetHeight);return t?(a.height=c+"px",a.width=n.width+2*d+"px",a.left=n.left-d+"px",a.top=n.top-(c>>2)-4+"px"):(a.height=n.height+2*c+"px",a.top=n.top-c+"px",a.left=n.left-(d>>2)+"px"),a.zIndex="9002",e},n.featureTest=function(e,t,n){var i=e+":",o=document.createElement("test").style;return o.cssText=n?i+t:i+["-webkit-","-moz-","-ms-","-o-",""].join(t+";"+i)+t+";",-1!==o[e].indexOf(t)},n.getPx=function(e){return parseInt(e,10)||0},n.removeStype=function(e,t){e.style.removeProperty?e.style.removeProperty(t):e.style[t]="border"===t?"none":""},n.rem2px=function(e){return Math.round(e*(c||(c=parseFloat(getComputedStyle(document.documentElement).fontSize)),c))},n.checkSize=function(e){return"number"==typeof e?e+"px":e},n.bootstrapStyles=function(t){if(t){if(u)return u;var n=e.bootstrap4;return u={primary:n?"outline-primary":"primary",secondary:n?"outline-secondary":"default",default:n?"outline-secondary":"default",important:n?"outline-important":"important",success:n?"outline-success":"success",info:n?"outline-info":"info",danger:n?"outline-danger":"danger",warning:n?"outline-warning":"warning",link:n?"outline-link":"link",dark:n?"outline-dark":"default"}}return l||(n=e.bootstrap4,l={primary:"primary",secondary:n?"secondary":"default",default:n?"secondary":"default",important:"important",success:"success",info:"info",danger:"danger",warning:"warning",link:"link",dark:"default"})},n.selectRange=function(e,t,n){void 0===n&&(n=t),e.setSelectionRange(t,n)},n.childrenRectsbyAttribute=function(e,t){for(var n=h(e,"[data-"+t.attributeName+"]"),i=[],o=0,r=n.length;o<r;o++){var s=n[o],a=_(s,e);a.value=x(s,"data-"+t.attributeName),i.push(a)}return i},n.findAttrByPosition=function(e,t,n){for(var i=0;i<n.length;i++){var o=n[i];if(e>=o.left&&t>=o.top&&e<=o.left+o.width&&t<=o.top+t)return o}return null},n.setCookie=function(e,t,n,i){try{t||(i=new Date),document.cookie=e+"="+t+(null!=i?"; expires="+i.toUTCString():"")+(n?"; path="+n:"/")}catch(e){return!1}return O(e)==t},n.getCookie=O,n.iframeAsPromise=function(t,n,i,o){return new(0,e.utils.Promise)(function(e,r){try{var s=function(n){var r=f(null,t);r&&r.contentWindow&&n.source===r.contentWindow&&"object"==typeof n.data&&n.data.action===i&&(window.removeEventListener("message",s),document.body.removeChild(r),o&&o(n.data.params),e())};window.setTimeout(function(){var e=f(null,t);e&&(window.removeEventListener("message",s),document.body.removeChild(e),r({message:"Timeout"}))},1e4);var a=document.createElement("iframe");a.style.cssText="position: absolute; top: -1000px; left -1000px; width: 0px; height: 0px;",a.frameBorder="0",a.scrolling="yes",a.id=t,a.src=n,y(document.body,a),window.addEventListener("message",s,!1)}catch(e){r(e)}})},$(document).ready(function(){t.readyHandlers.length&&t.readyHandlers.forEach(function(e){e()})})}(Phoenix||(Phoenix={})),function(e){var t=e.dom;e.utils;!function(e){var n=function(){function e(){}return e.prototype.disable=function(){this._isDisabled=!0},e.prototype.enable=function(){this._isDisabled=!1},e}();e.EventManager=n,e.mouseEvents=function(e){if(t.touch())switch(e){case"mousedown":return"touchstart";case"mouseup":return"touchend";case"mousemove":return"touchmove"}return e},e.isLeftButton=function(e){return!!t.touch()||e.which<2},e.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},e.point=function(e){var n,i=document.documentElement;if(t.touch()){var o=e.targetTouches||e.touches;o&&(n={x:o[0].pageX||o[0].clientX+(i.scrollLeft||document.body.scrollLeft),y:o[0].pageY||o[0].clientY+(i.scrollTop||document.body.scrollTop)})}return n||(n={x:e.pageX||e.clientX+(i.scrollLeft||document.body.scrollLeft),y:e.pageY||e.clientY+(i.scrollTop||document.body.scrollTop)}),n.x=Math.round(n.x),n.y=Math.round(n.y),n},e.eventManager=new n}(e.events||(e.events={}))}(Phoenix||(Phoenix={})),function(e){var t=e.dom,n=e.utils,i=e.events,o=e.customData;!function(e){var r=function(){function e(){}return e.prototype.initialize=function(){var e=this,t=$(document);e._mu=e.mouseUp.bind(e),e._md=e.mouseDownEmpty.bind(e),t.on(i.mouseEvents("mouseup"),e._mu),t.on(i.mouseEvents("mousedown"),e._md)},e.prototype.finalize=function(){var e=this,t=$(document);e._mu&&(t.off(i.mouseEvents("mouseup"),e._mu),e._mu=null),e._md&&(t.off(i.mouseEvents("mousedown"),e._mu),e._md=null),e._listeners=null,e._current=null},e.prototype.startMouseMove=function(){var e=this;e._mm||(e._mm=e.mouseMove.bind(e),$(document).on(i.mouseEvents("mousemove"),e._mm))},e.prototype.stopMouseMove=function(){this._mm&&($(document).off(i.mouseEvents("mousemove"),this._mm),this._mm=null)},e.prototype._canExecuteEvent=function(e){return!!this._current},e.prototype.mouseUp=function(e){var t=this._current;return!t||(t.inDragging&&t.notifyDragEnd(!1,e),this.setCurrent(null),t.clear(),!1)},e.prototype.mouseDownEmpty=function(e){return!0},e.prototype.mouseMove=function(e){var t=this;if(t._canExecuteEvent(e)){var n=t._current;if(!n)return!0;if(!n.ready(e))return i.isLeftButton(e)||(t.setCurrent(null),n.clear()),!0;if(!i.isLeftButton(e))return t.cancelDrag(),!0;try{n.notifyDrag(e)}catch(e){t.cancelDrag()}return i.stopEvent(e),!0}},e.prototype.addDrag=function(e){var t=new s(e);return this._listeners=this._listeners||[],this._listeners.push(t),t},e.prototype.rmvDrag=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t>=0&&(this._listeners.splice(t,1),e.finalize())}},e.prototype.setCurrent=function(e){return(!e||!this._current)&&(this._current=e,this._current||this.stopMouseMove(),!0)},e.prototype.cancelDrag=function(){var e=this._current;e&&(e.inDragging&&e.notifyDragEnd(!0,null),this.setCurrent(null),e.clear())},e.prototype.cover=function(e,i,o){var r=this;if(e)if(r._coverId){if(void 0!==i)(u=t.find(document.body,r._coverId)).style.cursor=i}else{r._coverId=n.allocID();var s=t.documentScroll(),a=t.documentClientDim();a.width+=s.left,a.height+=s.top,a.width=Math.round(Math.max(a.width,document.body.offsetWidth)),a.height=Math.round(Math.max(a.height,Math.round(document.body.offsetHeight)));var l=document.createElement("div");l.id=r._coverId,l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.style.backgroundColor="white",l.style.opacity="0.01",l.style.width=a.width+"px",l.style.height=a.height+"px",l.style.zIndex=(o||1e4)+"",l.style.cursor=i,t.append(document.body,l)}else if(r._coverId){var u=t.find(document.body,r._coverId);r._coverId=null,u&&t.remove(u)}},e}();e.DragAndDropManager=r;var s=function(){function r(e){var t=this;t._elements=e,t._mdEvent=t.mousedown.bind(t),t.clear(),t._setEvents()}return r.prototype.clear=function(){var e=this,t=e.stopEvent;e.mouseMoveCount=0,e._lastDropTarget=null,e.minLeft=null,e.maxLeft=null,e.minTop=null,e.maxTop=null,e.currentLeft=0,e.currentTop=0,e.moveX=!1,e.moveY=!1,e.moveSourceName=null,e._targets=null,e.inDragging=!1,e.coverDocument=!0,e.cursor="default",e.startPoint=null,e.currentPoint=null,e.startOffset=null,e.stopEvent=!1,e.data={},e.floatElement=null,e.floatParent=null,e.stopEvent=t},r.prototype._removeEvents=function(){var e=this;e._elements&&(e._elements.forEach(function(t){$(t).off(i.mouseEvents("mousedown"),e._mdEvent)}),e._elements=null)},r.prototype._setEvents=function(){var e=this;e._elements&&e._elements.forEach(function(t){$(t).on(i.mouseEvents("mousedown"),e._mdEvent)})},r.prototype.mousedown=function(t){var n=this;return n.mouseMoveCount=0,n.inDragging=!1,!i.isLeftButton(t)||(!n.canStartDrag(t)||(!e.dragManager.setCurrent(n)||(n.startPoint=i.point(t),e.dragManager.startMouseMove(),n.stopEvent&&i.stopEvent(t),!1)))},r.prototype.finalize=function(){this._removeEvents(),n.cleanUpObject(this)},r.prototype.ready=function(e){return this.mouseMoveCount++,2==this.mouseMoveCount&&this.notifyDragStart(e),this.inDragging},r.prototype.notifyDrag=function(e){var n=this;if(n.inDragging){n.currentPoint=i.point(e);var o=n.floatElement;if(o&&n.moveX){var r=n.startOffset.left+n.currentPoint.x-n.startPoint.x;null!==n.minLeft&&r<n.minLeft&&(r=n.minLeft),null!==n.maxLeft&&r>n.maxLeft&&(r=n.maxLeft),n.currentLeft=r,o.style.left=r+"px"}if(o&&n.moveY){var s=n.startOffset.top+n.currentPoint.y-n.startPoint.y;null!==n.minTop&&s<n.minTop&&(s=n.minTop),null!==n.maxTop&&s>n.maxTop&&(s=n.maxTop),n.currentTop=s,o.style.top=s+"px"}if(n.onDrag&&n.onDrag(e),o&&n._targets){var a=t.position(o,null),l=t.findAttrByPosition(a.left,a.top,n._targets);n.canDrop(!!l),n._lastDropTarget=l?{value:l.value,x:a.left-l.left,y:a.top-l.top}:null}}},r.prototype.notifyDragStart=function(n){var o=this;o.inDragging=!0,i.eventManager.disable(),o.coverDocument&&e.dragManager.cover(!0,o.cursor);try{var r=!0;o.onDragStart&&(o.onDragStart(n)||(o.notifyDragEnd(!0,n),r=!1),o.floatElement&&(o.startOffset=t.position(o.floatElement,o.floatParent))),r&&(o.moveX||o.moveY)&&o.moveSourceName&&(o._targets=t.childrenRectsbyAttribute(null,{attributeName:"drag-"+o.moveSourceName}))}catch(e){}},r.prototype.canStartDrag=function(e){return!this.canStartDragHandler||this.canStartDragHandler(e)},r.prototype.canDrop=function(t){this.coverDocument&&e.dragManager.cover(!0,t?this.cursor:"no-drop")},r.prototype.notifyDragEnd=function(t,r){var s=this;s.inDragging=!1;var a=s.coverDocument;if(s.onDragEnd&&s.onDragEnd(t,r),s._lastDropTarget&&!t){var l=o.get(s._lastDropTarget.value);l&&"object"==typeof l&&l.dragEnd&&l.dragEnd(r)}n.nextTick(function(){i.eventManager.enable(),a&&e.dragManager.cover(!1)})},r}();e.DragElement=s,e.dragManager=new r,t.readyHandlers.push(function(){e.dragManager.initialize()}),t.finalizeHandlers.push(function(){e.dragManager.finalize()});var a;e.setData=function(e){a=e},e.getData=function(){return a}}(e.drag||(e.drag={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c,p,h,f,m,v,g,y,_,$,b,x,C;t=e.link||(e.link={}),i=(n=e).utils,o=n.dom,r=n.customData,s=n.device,a=n.application,l=n.external,u=n.authentication,d=n.history,c=[],p=function(e){if(!e)return"";var t=[];return Object.keys(e).forEach(function(n){null!==e[n]&&t.push(n+"="+encodeURIComponent(e[n]||""))}),t.length>0?"?"+t.join("&"):""},h=function(e,t){var n="",i={},o=e;if(0===e.indexOf("http")){var r=e.indexOf("//");n=e.substr(0,r+2),(r=(o=e.substr(r+2)).indexOf("/"))>0&&(n+=o.substr(0,r),o=o.substr(r))}"#"===o.charAt(0)&&(o=o.substr(1)),d.locationPrefix&&o.charAt(0)===d.locationPrefix&&(o=o.substr(1));var s=o.indexOf("?");if(s>=0){var a=o.substring(s+1);if(o=o.substring(0,s),a)a.split("&").forEach(function(e){if(e){var n=e.split("="),o=decodeURIComponent(n[1]);if(t&&o)if("["===o.charAt(0)&&"]"===o.charAt(o.length-1))try{o=JSON.parse(o)}catch(e){}else if("{"===o.charAt(0)&&"}"===o.charAt(o.length-1))try{o=JSON.parse(o)}catch(e){}i[decodeURIComponent(n[0])]=o}})}return{path:o,search:i,host:n}},f=function(e){for(var t=0,n=c.length;t<n;t++){var i=c[t];if(i.test(e))return i}return null},m=function(e){return h(window.location.href,e).search},v=function(e){var t=e.$page;return s.phone&&e.$pageMobile?t=e.$pageMobile:s.tablet&&e.$pageTablet&&(t=e.$pageTablet),t},g=function(e){var t=null;try{t=JSON.parse(u.db().getItem("authentication"))}catch(e){}var i={$url:m(!0),$mem:n.$mem,$user:{name:t?t.name||t.nom||t.login:"",firstName:t?t.firstName||t.prenom||t.login:"",lastName:t&&(t.lastName||t.nom)||""},$item:null,$cookie:null,$target:null};e&&e.cookie&&(i.$cookie={},(document.cookie||"").split(";").forEach(function(e){var t=e.split("=");t[0]=t[0].replace(/^ /,""),i.$cookie[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}));return i},y=function(e,t,n){if(e.$page){var o=v(e),r="#"+d.locationPrefix+"/"+o,s=[];if(t&&e.$search&&e.$search.length){var a=g();Object.keys(t).forEach(function(e){a[e]=t[e]}),e.$search.forEach(function(e){e&&e.left&&s.push(e.left+"="+encodeURIComponent(i.parseVariable(e.right,a)))})}return n&&Object.keys(n).forEach(function(e){s.push(e+"="+encodeURIComponent(n[e]))}),s.length&&(r=r+"?"+s.join("&")),r}return"#"},_={},$=function(e){var t=e.indexOf("://");if(t>0){var n=_[e.substring(0,t)];if(n)return n.protocol}return null},b=function(e,t,n,i){if(e&&"#"===(""+e).charAt(0)||(e="#"+e),d.locationPrefix&&e.charAt(1)!==d.locationPrefix&&(e=e="#"+d.locationPrefix+e.substring(1)),n){var o=document.createElement("a");return o.href=e,o.target="_blank",document.body.appendChild(o),o.click(),void document.body.removeChild(o)}window.location.hash!==e&&(l.hashHandler?l.hashHandler(e,t,i):(d.removeLast(),t&&"replaceState"in window.history?window.history.replaceState(void 0,void 0,e):location.hash=e))},x=function(e){if(e.name&&e.schema){var t="/authoring/forms/"+e.name,n=[];e.schema!==e.name&&n.push("prototype="+encodeURIComponent(e.schema)),e.locale&&n.push("locale="+encodeURIComponent(e.locale)),e.path&&n.push("path="+encodeURIComponent(e.path));var i=window.location.href.lastIndexOf("?");if(i>0){var o=[];window.location.href.substr(i+1).split("&").forEach(function(e){var t=e.split("=");["prototype","path","locale"].indexOf(t[0])<0&&o.push(e)}),n.push(o.join("&"))}n.length&&(t=t+"?"+n.join("&")),window.location.hash="#"+d.locationPrefix+t}},C=function(e,t){var n="/authoring",i=window.location.hash;"#"===i.charAt(0)&&(i=i.substring(1)),d.locationPrefix&&i.charAt(0)===d.locationPrefix&&(i=i.substring(1)),t||0!==i.indexOf(n)?window.location.hash="#"+d.locationPrefix+n+(e?"/"+e:i):0===i.indexOf("/authoring/forms/")?window.history.back():window.location.hash="#"+d.locationPrefix+i.substring(n.length)},t.search=m,t.object2search=p,t.parseUrl=h,t.hashLink=y,t.pageName=v,t.isCustomLink=function(e,t,n){for(var i=t.target;i&&i!=e;){var r=o.attr(i,"data-phoenix-href")||o.attr(i,"href");if(r){if("#"===r){n||t.preventDefault();break}var s=$(r);if(s)return n||t.preventDefault(),{protocol:s,value:r}}i=i.parentNode}return null},t.registerLinkExecutor=function(e){c.push(e)},t.getLinkExecutor=f,t.registerCustomProtocol=function(e,t){_[e]={protocol:e,handler:t}},t.execCustomProtocol=function(e,t,n,i){var o=_[e.protocol];o&&o.handler&&o.handler(e.value,t,n,i)},t.isCustomProtocol=$,t.doAuthoring=C,t.doFormAuthoring=x,t.execLink=function(e,t,n){var i,o=a.configuration&&a.configuration.application?a.configuration.application.modules:null;if(e.$page){var s=e.$module?e.$module:a.name;if(o&&o[s]&&a.licences){var u=a.licences[o[s]];if(u&&!u.hasLicence&&l.forbiddenHandler)return l.forbiddenHandler()}var c=y(e,t,n),p=t&&"blank"===t.$target;if(e.$module&&e.$module!==a.name)return function(e,t,n,i,o){var r,s=location.pathname.split("/"),a="";s[s.length-1].indexOf(".html")>0&&(a=s.pop());var l=s.pop();if(a||""!=l||s.pop(),s.push(t),a&&s.push(a),r=s.join("/"),e&&"#"===(""+e).charAt(0)||(e="#"+e),d.locationPrefix&&e.charAt(1)!==d.locationPrefix&&(e="#"+d.locationPrefix+e.substr(1)),r+=e,o){var u=document.createElement("a");return u.href=r,u.target="_blank",document.body.appendChild(u),u.click(),void document.body.removeChild(u)}i?location.replace(r):location.href=r}(c,e.$module,a.name,e.$replace,p);b(c,e.$replace,p,!1),e.$authoring&&C()}else if(e.$logout)l.logoutHandler&&l.logoutHandler();else if(e.$form)i=e.$form,l.formOpenHandler&&l.formOpenHandler(i);else if(e.$action&&e.$action.name){var h=r.get(e.$action.name);h&&h(e.$action.params)}else if(e.$formAuthoring)x(e);else if(e.$authoring)C();else if(e.$back)window.history.back();else if(e.href){var m=document.createElement("a");m.href=e.href,e.target&&(m.target=e.target),document.body.appendChild(m),m.click(),document.body.removeChild(m)}else{var v=f(e);v&&v.hnd(e)}},t.context=g,t.changeSearch=function(t){var n=h(window.location.hash,!1);i.merge(t,n.search);var o,r=(o=n,"#"+(e.history.locationPrefix?e.history.locationPrefix:"")+o.path+p(o.search));b(r,!0,!1,!0)}}(Phoenix||(Phoenix={})),function(e){var t=e.dom;!function(e){e.topOffset=0,e.bottomOffset=0;var n=t.featureTest("position","sticky",!1),i=t.featureTest("position","fixed",!0),o="bs-sticky-on",r="bs-sticky-off",s="bs-sticky-dummy",a=function(n,i,s){i?(t.addClass(n,o),"top"===s?n.style.top=e.topOffset+"px":"bottom"===s&&(n.style.bottom=e.bottomOffset+"px"),t.removeClass(n,r)):(t.addClass(n,r),t.removeClass(n,o),t.removeStype(n,"width"),t.removeStype(n,"top"),t.removeStype(n,"bottom"))},l=function(){function r(){this._map={},this._list=[],this._scroll=null,this._resize=null,this._refreshTimer=null,this._scrollTimer=null}return r.prototype.add=function(e){!n&&i&&(this._map[e.id]=e,this._list.push(e))},r.prototype.remove=function(e){var n,i,o,r,s=this._map[e];if(void 0!==s){s.element&&(n=s,i=s.position,o=n.element,$(o),r=t.find(o.parentNode,n.id+"_sticky_clone"),a(o,!1,i),r&&t.remove(r)),s.element=null,delete this._map[e];var l=this._list.indexOf(s);l>=0&&this._list.splice(l,1)}},r.prototype.initialize=function(){var e=this;!n&&i&&(e._scroll=e._onscroll.bind(e),e._resize=e._onresize.bind(e),$(window).on("scroll.sticky",e._scroll),$(window).on("global-phoenix-resize",e._resize))},r.prototype._updateElements=function(n){this._list.forEach(function(i){var r=i.element;n&&!t.hasClass(r,o)||r.offsetWidth&&function(n){var i,r=n.element,l=$(r),u=t.offset(r),d=l.outerHeight(),c=0,p=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,h=t.hasClass(r,o),f=$(window).height(),m=l.parent(),v=m.offset().top,g=m.outerHeight(),y=t.find(m.get(0),n.id+"_sticky_clone");if(y){var _=t.offset(y);y.style.height=d+"px",c=_.width?_.top:u.top}else c=u.top,(y=document.createElement("div")).id=n.id+"_sticky_clone",y.className=s,y.style.height=d+"px",t.after(r,y);var b,x="top"===n.position,C="bottom"===n.position;i=0,x&&(b=p+0+e.topOffset,c<b&&b+d<=v+g)||C&&c+(d||0)>p+f-i&&p+f-i>=v+(d||0)?h?(_=t.offset(y),r.style.width=_.width+"px"):(a(r,!0,n.position),r.style.width=u.width+"px"):h&&a(r,!1,n.position)}(i)})},r.prototype._onscroll=function(){var e=this;e._scrollTimer&&(window.clearTimeout(e._scrollTimer),e._scrollTimer=null),e._scrollTimer=window.setTimeout(function(){e._updateElements(!1)},20),e._updateElements(!1)},r.prototype._onresize=function(){this._updateElements(!0)},r.prototype._refresh=function(e){e&&this._updateElements(!1)},r.prototype.refresh=function(e){var t=this;t._refreshTimer&&(window.clearTimeout(t._refreshTimer),t._refreshTimer=null),t._refreshTimer=window.setTimeout(function(){t._refresh(e)},200)},r.prototype.finalize=function(){if(!n&&i){var e=this;e._refreshTimer&&(window.clearTimeout(e._refreshTimer),e._refreshTimer=null),e._scrollTimer&&(window.clearTimeout(e._scrollTimer),e._scrollTimer=null),$(window).off("scroll.sticky",e._scroll),$(window).off("global-phoenix-resize",e._resize),e._scroll=null,e._resize=null}},r}();e.StickyManager=l,t.readyHandlers.push(function(){e.stickyManager.initialize()}),t.finalizeHandlers.push(function(){e.stickyManager.finalize()}),e.stickyManager=new e.StickyManager,e.native=n||!i}(e.sticky||(e.sticky={}))}(Phoenix||(Phoenix={})),function(e){!function(t){(e.jsonpatch||(e.jsonpatch={})).compare=function(e,t,n){var i=[];return r(e,t,i,"",n=n||{}),i};var n=function(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}return Object.keys(e)},i=function(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")},o=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},r=function(e,t,s,a,l){for(var u=l.useId,d=Array.isArray(t),c=n(t),p=n(e),h=!1,f=p.length-1;f>=0;f--){var m=e[y=p[f]],v=d&&u&&m.id?m.id+"":y;if(!t.hasOwnProperty(y)||void 0===t[y]&&void 0!==m&&!1===Array.isArray(t))s.push({op:"remove",path:a+"/"+i(v)}),h=!0;else{var g=t[y];"object"==typeof m&&null!=m&&"object"==typeof g&&null!=g?r(m,g,s,a+"/"+i(v),l):m!==g&&(!0,s.push({op:"replace",path:a+"/"+i(v),value:o(g)}))}}if(h||c.length!=p.length)for(f=0;f<c.length;f++){var y=c[f];e.hasOwnProperty(y)||void 0===t[y]||s.push({op:"add",path:a+"/"+(d&&u?"-":i(y)),value:o(t[y])})}}}()}(Phoenix||(Phoenix={})),function(e){var t;(t=e.filters||(e.filters={})).OPERATORS={in:"in",nin:"nin",gt:"gt",ge:"ge",lt:"lt",le:"le",between:"between",nbetween:"nbetween",like:"like",nlike:"nlike",empty:"empty",nempty:"nempty"},t.TYPES={number:"number",decimal:"decimal",money:"money",integer:"integer",date:"date",time:"time","date-time":'"date-time',string:"string",enum:"enum",lookup:"lookup",boolean:"boolean"}}(Phoenix||(Phoenix={})),function(e){var t=Phoenix||(Phoenix={}),n=t.link,i=t.utils;n.registerCustomProtocol("page",function(e,i,o,r){i.$url||(i.$url=n.search(!0)),i.$mem||(i.$mem=t.$mem);var s=e.indexOf("://");if(!(s<=0)){var a,l=e.substring(s+3),u=n.parseUrl(l),d=u.path.split("/");u.search.$replace&&(a=!0,delete u.search.$replace);var c={$page:d[0],$search:[],$replace:a,$menu:null};d.length>1&&(c.$menu=d[1]),Object.keys(u.search).forEach(function(e){c.$search.push({left:e,right:u.search[e]})}),n.execLink(c,i,null)}}),n.registerCustomProtocol("link",function(e,t,o,r){var s=e.substring("link://".length),a=s.indexOf("/");if(a<=0&&(a=s.indexOf("?")),a>0){var l=n.parseUrl(s.substring(a));s=s.substring(0,a),l.search&&(r?i.extend(r,l.search):r=l.search)}o.links&&o.links[s]&&n.execLink(o.links[s],t,r)}),n.registerCustomProtocol("click",null)}(),function(e){var t,n=e,i=n.application,o=n.ajax,r=n.ulocale;t={get:function(e,t,n){t&&r.lang&&(e=e+"_"+r.lang);var s=i.config(n);if(!s)throw"Application configuration not found.";return o.get(s.current.menus+"/"+e+".json",{cache:!0},null)}},(e.data||(e.data={})).menu=t}(Phoenix||(Phoenix={})),function(e){var t,n=e,i=n.ulocale,o=(n.utils,n.ajax),r=n.application;t={get:function(e,t,n){t&&i.lang&&(e=e+"_"+i.lang);var s=r.config(n);if(!s)throw"Application configuration not found.";return o.get(s.current.locales+"/"+e+".json",{cache:!0},function(t){return t&&(t.$name=e),t.$view&&(t.$view.$name=e),t})}},(e.data||(e.data={})).schema=t}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,o=i.ajax,r=i.utils,s=e.dom,a=i.link,l=i.application;t=function(e,n){if(s.getCookie(e))return n();window.setTimeout(t.bind(window,e,n),500)},n={get:function(e){return new r.Promise(function(t,i){var o={$url:e,$method:"GET"};n.getRessources(o,!1,function(e){t(e)})})},put:function(e,t){return new r.Promise(function(i,o){var r={$url:e,$method:"PUT",$data:t};n.getRessources(r,!1,function(e){i(e)})})},post:function(e,t){return new r.Promise(function(i,o){var r={$url:e,$data:t,$method:"POST"};n.getRessources(r,!1,function(e){i(e)})})},remove:function(e){var t={$url:e,$method:"DELETE"};return n.getRessources(t,!1,null)},getRessources:function(e,n,i){var u=i?function(e){return e=i(e)}:null,d=e.$url,c=!1,p=e.$download,h="";p&&(delete e.$download,e.$cookie&&(h=e.$cookie,delete e.$cookie,s.setCookie(h,"","/",null)));var f=$.extend(!0,{},l.config(l.name)||{});f.rest=(e.$type?f[e.$type]:null)||f.rest||{},f.sync=(e.$type?f[e.$type]:null)||f.sync||{},delete e.$type;var m=n?f.sync:f.rest,v=m.base||"";!d||"/"!==d.charAt(0)&&"."!==d.charAt(0)||(v=""),v?d=v+"/"+d:c=!0;var g=a.context({cookie:!0});void 0===e.$module&&m.$module&&(e.$module=m.$module),e.$module?g.$module=e.$module:d=d.replace("{$module}/",""),m.$context?g.$context=m.$context:d=d.replace("{$context}/",""),d=r.formatNames(d,g),m.headers&&m.headers.Authorization&&(m.headers.Authorization=r.formatNames(m.headers.Authorization,g));var y=o.getDefaultAjaxOptions(m),_=e.$query;e.$list;switch(d+=a.object2search(_),d=d,e.$method){case"POST":return u?new r.Promise(function(t,n){o.post(d,e.$data,y).then(function(e){e=u(e),t(e)}).catch(function(e){n(e)})}):o.post(d,e.$data,y);case"PUT":return o.put(d,e.$data,y);case"PATCH":return o.patch(d,e.$data,y);case"DELETE":return o.remove(d,y);default:if(p){var b=s.downloadFrame();return c&&(d=o.addAuthToUrl(d)),b.src=d,h?new r.Promise(function(e,n){t(h,e)}):r.Promise.resolve()}return o.get(d,y,function(e){return u?u(e):e})}}},(e.data||(e.data={})).rest=n}(Phoenix||(Phoenix={})),function(e){var t,n=e,i=n.application,o=n.ajax,r=n.link;t={getRessources:function(e,t){var n=i.config(i.name);if(!n)throw"Application configuration not found.";var s=n.localData+"/"+e.$url,a=e.$query;return s+=r.object2search(a),o.get(s,{},function(e){return n=e,t&&(n=t(n)),n;var n})}},(e.data||(e.data={})).local=t}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r=e,s=r.application,a=r.link,l=r.authentication,u=r.utils,d=r.ajax;t=e.data||(e.data={}),n={},i=function(e){return e},o={v4:!0,transport:{doPost:d.post,doPut:d.put,doDelete:d.remove,doGet:function(e,t,n,i){return d.get(e,t,n)},doPatch:d.patch},afterLogout:function(){n={}},addImageUrlToken:function(e){var t=s.config(s.name)||{};if(t.odata=t.odata||{},t&&t.odata&&t.odata.authentication){var n=l.load();if(n)switch(t.odata.authentication){case"header-session":e=e+"?token="+n.token}}return e},baseUrl:function(e){var t=s.config(s.name)||{};t.odata=t.odata||{};var n=t.odata.base||"/data",i=a.context({cookie:!0});return void 0===(e=e||{}).$module&&t.odata.$module&&(e.$module=t.odata.$module),e.$module?i.$module=e.$module:n=n.replace("{$module}/",""),t.odata.$context?i.$context=t.odata.$context:n=n.replace("{$context}/",""),u.formatNames(n,i)},configOdata:function(e){var t=$.extend(!0,{},s.config(s.name)||{});t.odata=(e.$type?t[e.$type]:null)||t.odata||{};var n=t.odata.base||"/data",i=a.context({cookie:!0});return void 0===(e=e||{}).$module&&t.odata.$module&&(e.$module=t.odata.$module),e.$module?i.$module=e.$module:n=n.replace("{$module}/",""),t.odata.$context?i.$context=t.odata.$context:n=n.replace("{$context}/",""),t.odata.base=u.formatNames(n,i),t.odata.headers&&t.odata.headers.Authorization&&(t.odata.base=u.formatNames(t.odata.headers.Authorization,i)),t.odata},urlResEntity:function(e,t){var n=o.baseUrl(e);if(!e.$entity)throw"Invalid odata entity.";if(t&&!e.$entityId)throw"Invalid odata entity id.";var i=n+"/"+e.$entity;return e.$entityId&&(i=i+"("+e.$entityId+")"),e.$propertyName&&(i=i+"/"+e.$propertyName),i},doDelete:function(e,t){var n=o.urlResEntity(e,!0),r=d.getDefaultAjaxOptions(o.configOdata(e));return t&&(r.headers["If-Match"]=t),r.ignore={410:!0},n=i(n),o.transport.doDelete(n,r)},doPost:function(e,t){var n=d.getDefaultAjaxOptions(o.configOdata(e)),r=o.urlResEntity(e,!1);return r=i(r),o.transport.doPost(r,t,n)},doPut:function(e,t,n,r){var s=o.urlResEntity(e,!0),a=d.getDefaultAjaxOptions(o.configOdata(e));return a.headers=a.headers||{},n&&(a.headers["If-Match"]=n),r&&(a.headers.Prefer="return=representation"),s=i(s),o.transport.doPut(s,t,a)},doPatch:function(t,n,r,s){var a=o.urlResEntity(t,!0),l=d.getDefaultAjaxOptions(o.configOdata(t));return l.headers=l.headers||{},e.application.useJSONPatch&&(l.headers["Content-Type"]="application/json-patch+json"),r&&(l.headers["If-Match"]=r),s&&(l.headers.Prefer="return=representation"),a=i(a),o.transport.doPatch(a,n,l)},applyFilters:function(e,t,n,i,o,r){var s=[],a=e.length;if((t=(t||"")+"")&&n&&n.length){var l=n.length,d=t.toLowerCase();e.forEach(function(e){for(var t=!1,i=0;i<l;i++){var o=n[i].replace(/\//g,".");if(((u.getValue(e,o)||"")+"").toLowerCase().indexOf(d)>=0){t=!0;break}}t&&s.push(e)}),a=s.length}else s=e;i=i||0;var c=o||s.length;if(r){var p=r.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 2===t.length?{field:t[0],asc:"asc"===t[1]}:{field:e,asc:!0}});s.sort(function(e,t){for(var n=0;n<p.length;n++){var i=p[n],o=e[i.field],r=t[i.field];if(o!==r){var s=o>r?1:-1;return i.asc||(s*=-1),s}}return 0})}var h=s.slice(i,i+c);return{documents:h,count:a,dataCount:h.length,skip:i,pageSize:o,nodata:0===h.length,search:t,orderBy:r}},getRessources:function(e,r,l,c){var p=function(e){return r&&(e=r(e)),e},h=e.$relation;h&&delete e.$relation;var f=!1,m=e.$cache;delete e.$cache;var v=$.extend(!0,{},s.config(s.name)||{});v.odata=(e.$type?v[e.$type]:null)||v.odata||{},delete e.$type,void 0!=v.odata.v4&&(o.v4=v.odata.v4);var g=v.odata&&v.odata.base||"/data",y=a.context({cookie:!0});void 0===e.$module&&v.odata.$module&&(e.$module=v.odata.$module),e.$module?y.$module=e.$module:g=g.replace("{$module}/",""),v.odata.$context?y.$context=v.odata.$context:g=g.replace("{$context}/",""),g=u.formatNames(g,y),v.odata.headers&&v.odata.headers.Authorization&&(v.odata.headers.Authorization=u.formatNames(v.odata.headers.Authorization,y)),delete e.$module;var _=e.$entity;e.$entityId&&(_=_+"("+e.$entityId+")",delete e.$entityId,f=!0),e.$propertyName&&(_=_+"/"+e.$propertyName,delete e.$propertyName,f=!0);var b=_;delete e.$entity;var x,C="",k=[],w=e.$skip||0,E=!1,O=e.$orderby;e.$searchByFieldsValue&&(C=e.$searchByFieldsValue,k=e.$searchByFieldsFields,delete e.$searchByFieldsValue,delete e.$searchByFieldsFields),f||(e.$top&&(x=parseInt(e.$top+"",10)),o.v4?(e.$top&&!e.nocount&&(e.$count=!0),delete e.nocount):(e.$top&&!e.nocount&&(e.$inlinecount="allpages"),delete e.nocount),(v.odata.array||v.odata.nocount)&&(e.$count||e.$inlinecount)&&e.$top&&!e.$allData&&(E=!0,x++,e.$top=x,delete e.$count,delete e.$inlinecount));var S=e.$allData||h;S&&(delete e.$skip,delete e.$top,delete e.$allData,delete e.$orderby);var P=d.getDefaultAjaxOptions(v.odata);if(P.$errors=l,b=g+"/"+b+a.object2search(e),m&&n[_]&&n[_].uri===b)return new u.Promise(function(e,t){e(p(f?n[_].data:$.extend(!0,{},n[_].data)))});b=i(b);var I=t.odata.transport.doGet;return h&&(I=function(e,t,n,i){var o={value:[]};return c&&c.model&&(o.value=c.model.getValue(i.params.relation).model(!1)||[]),n&&(o=n(o)),u.Promise.resolve(o)}),I(b,P,function(e){var t,i={};if(o.v4&&e&&delete e["@odata.context"],f)i=e;else{if(i.documents=v.odata.array?e:o.v4?e.value:e.d.results,S&&(i._origData=[]),i.documents.forEach(function(e){delete e.__metadata,S&&i._origData.push($.extend(!0,{},e))}),(v.odata.array||v.odata.nocount)&&(i._noPagesCount=!0,i._hasNext=!1,i._hasPrev=!!w),S){var r=o.applyFilters(i.documents,C,k,w,x,O);i.documents=r.documents,i.count=r.count}else v.odata.array||v.odata.nocount?E&&(i.documents.length===x&&(i._hasNext=!0,i.documents.pop()),x--):i.count=o.v4?e["@odata.count"]:e.d.__count;i.dataCount=i.documents.length,i.pageSize=x,i.skip=w,i.nodata=0==i.dataCount,i.uri=(0!==(t=b).indexOf("http")&&(t=window.location.origin+t),t),i.search=C,i.orderBy=O}return m&&(n[_]={uri:b,data:$.extend(!0,{},i)}),p(i)},{entity:_,params:e})}},t.odata=o,l.registerAfterLogout(o.afterLogout)}(Phoenix||(Phoenix={})),function(e){var t=e,n=t.link,i=t.utils,o=t.data,r=t.customData,s=t.application;!function(e){var a,l=function(e,t){if(e.$transform){var n=r.get("datasets.transform."+e.$transform);n&&(t=n(t))}return t},u=function(e,t,n){if(!e)return t;var i=r.get("datasets.transform."+e);return i?i($.extend(!0,{},t,n)):t},d=(a={},{register:function(e,t){a[e]=t},get:function(e){return a[e]}}),c=function(e){return(e=e||{}).$type=e.$type||"basic",e.$triggers=e.$triggers||["$load"],e},p=function(e,t,n,i){if(null==e&&t)switch(t){case"number":case"integer":case"boolean":e=void 0;break;case"string":e="";break;default:e=null}if(Array.isArray(e))return i?e:JSON.stringify(e);if(n&&t&&("string"===t||"date"===t||"date-time"===t)){if(null==e)return null;"date"===t||"date-time"===t||(e="'"+e.replace(/'/g,"''")+"'")}return e},h=function(e,t){var n=t.indexOf("[");if(n<0)return null;if(!(e=0===n?e:e[t.substr(0,n)]))return null;var i=t.substr(n+1,t.length-n-2);if("*"==i||""==i)return e;var o=parseInt(i,10);return o<e.length?e[o]:null},f=function(e,t,n,i,o){var r,s=e,a=["$url","$context","$data","$item","$mem","$local"],l=typeof s;if("object"===l&&s){if(r=e.type,s=e.value,"literal"===r)return o?e:s;l=typeof s}var u=!1;if("string"===l&&s&&"["===s.charAt(0)&&"]"===s.charAt(s.length-1)&&(u=!0,s=s.substr(1,s.length-2)),"string"===l&&s&&"$"===s.charAt(0)){for(var d=s.split("."),c=0,f=null;c<d.length;){var m=d[c];if(0==c){var v,g=m,y=m.indexOf("[");y>0&&(v=m.substr(y),g=m.substr(0,y));var _=a.indexOf(g);if(!(_>=0))return r||(r=typeof s),p(s,r,n,i);f=t[a[_]],v&&d.splice(c+1,0,v)}else{if(!f)break;f="]"==m.charAt(m.length-1)?h(f,m):Array.isArray(f)?f.map(function(e){return e[m]}):f[m]}c++}return u?(r||(r=typeof f),[p(f,r,n,i)]):(r||(r=typeof f),p(f,r,n,i))}return r||(r=typeof s),p(s,r,n,i)},m=function(e,t,n,i){if("object"!=typeof e)return null;if(!Array.isArray(e)){var o={};return Object.keys(e).forEach(function(r){o[r]=f(e[r],t,n,i,!1)}),o}},v=function(e,t,n){for(var i=n.length;i--;)if(e[n[i]]!=t[n[i]])return!1;return!0},g=function(e,t){if(!e)return null;if("string"==typeof e)return f(e,t,!1,!0,!1);var n={};return Object.keys(e).forEach(function(i){"$data.documents"===e[i]?t.$data&&t.$data.documents&&(n[i]=t.$data.documents,void 0===n.pageSize&&(n.pageSize=t.$data.pageSize),void 0===n.skip&&(n.skip=t.$data.skip),void 0===n.count&&(n.count=t.$data.count),void 0===n.uri&&(n.uri=t.$data.uri)):n[i]=f(e[i],t,!1,!0,!1)}),n},y=function(e){return"and"!==e&&"or"!==e&&"$func"!==e&&("("!==e&&")"!==e&&"not"!==e)},_=function(e,n,i,o,r,s){if(e&&"object"==typeof e&&e.$op){var a={$op:e.$op,$nulls:e.$nulls,$left:null,$right:null};if("$func"===e.$op&&e.$arguments){var l=!1;if(e.$arguments.forEach(function(r,a){var u=!0;"object"==typeof r&&(u="literal"!==r.type);var d=f(r,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:o},!0,!1,s);e.$arguments[a]=d,!u||"''"!==d&&null!==d&&void 0!==d||(l=!0)}),l)return a.$right=null,a.$left=null,a;e.$right=e.$arguments.join(", ")}else if("in"===e.$op&&e.$children){var u=r&&y(e.$op);if(Array.isArray(e.$children)||(e.$children=(p=e.$children,h={$url:n,$context:i,$data:null,$mem:t.$mem,$local:o},f(p,h,u,!0,!1))),e.$children.length){var d=e.$children.map(function(e){return f(e,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:o},u,!1,s)});a.$right="("+d.join(",")+")",a.$left=e.$left,a.nativeIn=!0}return a}if(null!=e.$left&&("object"!=typeof e.$left||!e.$left.$op&&null!==e.$left.$op?a.$left=f(e.$left,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:o},!1,!1,s):a.$left=_(e.$left,n,i,o,r,s)),null!=e.$right)if("object"!=typeof e.$right||!e.$right.$op&&null!==e.$right.$op){var c=r&&y(e.$op);a.$right=f(e.$right,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:o},c,!1,s)}else a.$right=_(e.$right,n,i,o,r,s);return a}if(e&&"object"==typeof e&&null===e.$op&&null===e.$right&&e.$left){a={$left:null,$op:null,$right:null};return null!=e.$left&&("object"==typeof e.$left&&e.$left.$op?a.$left=_(e.$left,n,i,o,r,s):a.$left=f(e.$left,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:o},!1,!1,s)),a}var p,h;c=r&&y(e.$op);return f(e,{$url:n,$context:i,$data:null,$mem:t.$mem,$local:o},c,!1,s)},b=function(e){if(e&&"object"==typeof e&&e.$op){var t=b(e.$left),n=b(e.$right);if("ignore"===e.$nulls&&null==n.value)return"not"===e.op?{value:null,op:null}:{value:t.value,op:t.op};if("not"===e.$op)return{value:"not ("+n.value+")",op:e.$op};if("in"!==e.$op||e.nativeIn){if("$func"===e.$op)return{value:t.value+"("+n.value+")",op:e.$op};if("ignore"!==e.$nulls||null!=t.value&&null!=n.value){var i=t.value,o=n.value;if("and"===e.$op||"or"===e.$op){if(!i&&!o)return{value:null,op:null};if(!i)return{value:o,op:e.$op};if(!o)return{value:i,op:e.$op}}if("and"===e.$op)"or"===t.op&&(i="("+i+")"),"or"===n.op&&(o="("+o+")");else if(o&&"ignore"===e.$nulls&&"''"===o)return{value:null,op:null};return{value:i+" "+e.$op+" "+o,op:e.$op}}return"and"===e.$op||"or"===e.$op?null==n.value?{value:t.value,op:t.op}:{value:n.value,op:n.op}:{value:null,op:null}}var r=[];return(n.value||"").split(";").forEach(function(e){r.push(t.value+" eq "+e)}),{value:"("+r.join(" or ")+")",op:"in"}}return e&&"object"==typeof e&&null===e.$op&&null===e.$right&&e.$left?{value:b(e.$left).value,op:null}:{value:e,op:null}},x=function(e,n,i,o){var r,s,a,l,u=(s=n,a=i,l=o,(r=e)&&"string"==typeof r?r=f(r,{$url:s,$context:a,$data:null,$mem:t.$mem,$local:l},!1,!1,!1):_(r,s,a,l,!0,!1));return b(u).value},C=function(e,n,o,r,s){var a,l,u={$url:null,$list:null,$query:null,$method:"GET"};if(u.$method=(e.$method||"GET").toUpperCase(),u.$data=e.$data?$.extend(!0,{},e.$data):null,e.$type&&(u.$type=e.$type),s){if(!e.$entity)throw"Invalid sync dataset - $params.$entity";if(u.$transactionId=e.$transactionId||"id",!u.$transactionId)throw"Invalid sync dataset -$params.$transactionId";if(u.$viewId=e.$viewId||"viewId",!u.$viewId)throw"Invalid sync dataset -$params.$viewId";a=n[u.$transactionId],l=n[u.$viewId],u.$method=a&&l?"PATCH"===e.$method?"PATCH":"GET":"POST","POST"!==u.$method&&(u.$data=null)}u.$url=e.$url||"",u.$url=i.execAngularExpression(u.$url,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:r});var d=e.$query?$.extend(!0,{},e.$query):null;if(s){var c=u.$url?u.$url.split("/"):[];c.push(e.$entity),l&&a&&(c.push(l),(d=d||{}).id=a),u.$url=c.join("/")}return e.$download&&(u.$download=e.$download),e.$cookie&&(u.$cookie=e.$cookie),u.$list=e.$list,d&&(u.$query={},Object.keys(d).forEach(function(e){"$filter"===e&&d.$filter?(u.$query.$filter=x(d.$filter,n,o,r),u.$query.$filter||delete u.$query.$filter):u.$query[e]=f(d[e],{$url:n,$context:o,$data:null,$mem:t.$mem,$local:r},!1,!1,!1)})),"GET"!==e.$method&&"DELETE"!==e.$method&&(u.$data?u.$data=s?m(u.$data,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:r},!1,!0):f(u.$data,{$url:n,$context:o,$data:null,$mem:t.$mem,$local:r},!1,!1,!1):u.$data=o||{}),u},k=function(e){return void 0===e||null===e||""===e||"''"===e},w=function(e,n,o,s){var a,u=s&&s.getLocalContext?s.getLocalContext():null,d=e.$data;if(e.$params&&e.$params.dataProvider){var c=r.get(e.$params.dataProvider);c&&(o=c(o,s))}return!e.$main&&e.$output?(d=e.$data,a=g(e.$output,{$url:n,$context:o,$data:d,$mem:t.$mem,$local:u})):a=d,a=l(e,a),new i.Promise(function(e,t){e(a)})},E=function(e,n,r,a){var d=e.$method||"GET",c=a&&a.getLocalContext?a.getLocalContext():null,h=function(e,n,o,r){if(!e)return null;var a={},l={$url:n,$context:o,$data:null,$mem:t.$mem,$local:r},u=e.$filter?$.extend(!0,{},e.$filter):null;if(e.$searchByFields&&e.$searchByFields.value&&e.$searchByFields.fields&&e.$searchByFields.fields.length){var d=null,c=s.config(s.name)||{},h=(e.$type?c[e.$type]:null)||c.odata||{},m=h.caseSensitive||!1;e.$searchByFields.fields.forEach(function(t){var n=t.replace(/\./g,"/"),i="'"+e.$searchByFields.value.replace(/'/g,"''")+"'";m&&(n="tolower("+n+")",i="tolower("+i+")");var o={$left:h.contains||"contains",$op:"$func",$right:n+", "+i};d=d?{$left:d,$op:"or",$right:o}:o}),e.$searchByFieldsValue=e.$searchByFields.value,e.$searchByFieldsFields=e.$searchByFields.fields,e.$allData||(u=u?{$left:u,$op:"and",$right:d}:d)}if(Object.keys(e).forEach(function(t){if("$search"!==t&&"$searchByFields"!==t)if("$entity"===t)a.$entity=f(e.$entity,l,!1,!1,!1);else if("$entityId"===t){var n=!1;if("object"==typeof e.$entityId)if(e.$entityId.value&&e.$entityId.type){var i=f(e.$entityId,l,!0,!1,!1);n=k(i),a[t]=i}else{var o=[];Object.keys(e.$entityId).forEach(function(t){var i=f(e.$entityId[t],l,!0,!1,!1);n||(n=k(i)),o.push(t+"="+i)}),a[t]=o.join(", ")}else{var r=f(e[t],l,!0,!1,!1);n=k(r),a[t]=r}n&&(a.$entityIdNull=!0)}else if("aggregate"==t&&e.aggregate)a.aggregate=e.aggregate;else if("groupby"==t&&e.groupby)a.groupby=e.groupby;else if("having"==t&&e.having)a.having=e.having;else{if("$filter"==t&&e.$filter)return;"$searchByFieldsFields"==t?a[t]=e[t]:e[t]&&(a[t]=f(e[t],l,!1,!1,!1))}}),u&&(a.$filter=x(u,n,o,r),a.$filter||delete a.$filter),e.$search&&o&&o.$searchText){var v,g=p(o.$searchText,"string",!0,!1),y=Array.isArray(e.$search)?e.$search:[e.$search];if(1===y.length)v=i.format("contains({0},{1})",e.$search.field,g);else{for(var _=["("],b=y.length,C=0;C<b;C++)_.push(i.format("contains({0},{1})",y[C].field,g)),C<b-1&&_.push(" or ");_.push(")"),v=_.join("")}a.$filter?a.$filter=a.$filter+" and "+v:a.$filter=v}return a}(u(e.$beforeExecute,e.$params,r),n,r,c);if(d&&(d=(d=f(d,r,!1,!1,!1)).toUpperCase()),h.$entityIdNull&&(delete h.$entityIdNull,"GET"===d&&e.$create)){var m=$.extend(!0,{},e.$create);return m.$create=!0,i.Promise.resolve(m)}if(d)switch(d){case"DELETE":return o.odata.doDelete(h,r.etag?r.etag:null);case"POST":return o.odata.doPost(h,r);case"PUT":var v=r["@odata.etag"];delete r["@odata.etag"];var y=null!=r["@odata.return"];return delete r["@odata.return"],o.odata.doPut(h,r,v,y);case"PATCH":var _=r["@odata.etag"];delete r["@odata.etag"];var b=null!=r["@odata.return"];return delete r["@odata.return"],o.odata.doPatch(h,r,_,b)}var C,w,E=(C=e.$data,w=c,g(C,{$url:n,$context:r,$data:null,$mem:t.$mem,$local:w})),O=s.config(s.name)||{};return void 0===e.$cache&&(O.odata&&void 0!==O.odata.cache?O.odata.cache=O.odata.cache:(O.odata=O.odata||{},O.odata.cache=!0)),r&&(r.hasOwnProperty("$skip")&&r.$skip&&(h.$skip=r.$skip),r.hasOwnProperty("$top")&&r.$top&&(h.$top=r.$top)),"relation"===e.$type&&(h.$relation=!0),o.odata.getRessources(h,function(i){"POST"!==d&&i&&(i.$create=!1),i&&i.documents&&i.documents.length||!E||(i.documents=i.documents||[],i.documents.push(E)),r&&r.hasOwnProperty("$searchText")&&(i.searchText=r.$searchText);var o=i;return!e.$main&&e.$output&&(o=g(e.$output,{$url:n,$context:r,$data:i,$mem:t.$mem,$local:c})),o=l(e,o)},e.$errors,r)},O=function(e,n,i,r){var s=r&&r.getLocalContext?r.getLocalContext():null,a=C(e.$params,n,i,s,!1);return o.local.getRessources(a,function(o){var r=o;return!e.$main&&e.$output&&(r=g(e.$output,{$url:n,$context:i,$data:o,$mem:t.$mem,$local:s})),l(e,r)})},S=function(e,n,i,r){var s=r&&r.getLocalContext?r.getLocalContext():null,a=(u(e.$beforeExecute,e.$params,i),C(e.$params,n,i,s,!1));return e.$method&&(a.$method=e.$method),o.rest.getRessources(a,!1,function(o){var r=o;return e.$output&&(r=g(e.$output,{$url:n,$context:i,$data:o,$mem:t.$mem,$local:s})),l(e,r)})},P=function(e){var t=[];return e.$emit&&(e.$emit.$loaded||e.$emit.$changed?(e.$emit.$loaded&&t.push(e.$emit.$loaded.$name),e.$emit.$changed&&t.push(e.$emit.$changed.$name)):t.push(e.$emit)),t};e.execData=function(e,r,s){var a,c,p,h,m,v,y,_,$=n.search(!0);if(!e)return null;if(e.$condition){var b=n.context();b.$context=r;var x=f(e.$condition,b,!1,!0,!1);if(!x||"false"===x)return i.Promise.resolve(null)}switch(e.$type){case"basic":return w(e,$,r,s);case"odata":return E(e,$,r,s);case"relation":return r.model?E(e,$,r,s):null;case"sync":return a=e,c=$,p=r,m=(h=s)&&h.getLocalContext?h.getLocalContext():null,v=u(a.$beforeExecute,a.$params,p),y=C(v,c,p,m,!0),_=function(e){var i=e;if("GET"===y.$method&&(i.$transactionId=y.$query[y.$transactionId]),"POST"===y.$method){i=i.data;var o={};o[y.$transactionId]=e.id,o[y.$viewId]=i.id,i.$transactionId=e.id,n.changeSearch(o)}return a.$output&&(i=g(a.$output,{$url:c,$context:p,$data:e,$mem:t.$mem,$local:m})),l(a,i)},"DELETE"!==y.$method&&"PUT"!==y.$method||(_=null),o.rest.getRessources(y,!0,_);case"rest":return S(e,$,r,s);case"local":return O(e,$,r,s);default:var k=d.get(e.$type);if(k)return k(e,$,r,s)}return null};var I=function(){function e(e){var t=this;t.config=c(e),e.$default&&(t.defaultDataset=!0),t.config.$autoselect&&(t.autoselect=!0),t._emitters=P(t.config),t.selectedIndex=-1}return e.prototype.execute=function(e,t){var i,r,s,a,l=this,u=n.search(!0);switch(l.config.$type){case"basic":return w(l.config,u,e,t);case"odata":return E(l.config,u,e,t);case"rest":return S(l.config,u,e,t);case"local":return O(l.config,u,e,t);case"menu":return s=l.config,a=s.$params.name,o.menu.get(a,s.$params.localization,void 0);case"widget-schema":return i=l.config,r=i.$params.name,o.schema.get(r,i.$params.localization,void 0);default:var c=d.get(l.config.$type);if(c)return c(l.config,u,e,t)}throw"Invalid dataset type"},e.prototype.enumTriggers=function(e,t){this.config.$triggers&&this.config.$triggers.forEach(function(n){(e||"$load"!=n)&&t(n)})},e.prototype.enumEmitters=function(e){this._emitters.forEach(e)},e.prototype.hasCustomEvents=function(){if(this.config.$triggers){var e=this.config.$triggers;return e.length>1||"$load"!=e[0]}return!1},e.prototype.canExecute=function(e,t){if(this.config.$condition){var n=f(this.config.$condition,t,!1,!0,!1);if(!n||"false"===n)return!1}return this.config.$triggers.indexOf(e)>=0},e.prototype.data2Output=function(e,t){return g(e,t)},e.prototype.destroy=function(){i.log("Destroy Dataset","destroy")},e.prototype._findSelectedOData=function(e){if(e.documents){var i=-1,o=null;if(this.config.$autoselect&&"object"==typeof this.config.$autoselect)for(var r={$url:n.search(!0),$mem:t.$mem},s=g(this.config.$autoselect,r),a=Object.keys(s),l=0,u=e.documents.length;l<u;l++){var d=e.documents[l];if(v(d,s,a)){o=d,i=l;break}}return o?{item:o,index:i}:e.documents.length?{item:e.documents[0],index:0}:{item:null,index:-1}}return{item:null,index:-1}},e.prototype._findSelected=function(e){switch(this.config.$type){case"odata":case"rest":return this._findSelectedOData(e);default:return{item:e,index:0}}},e.prototype.doAutoSelect=function(e,t){if(this.selectedIndex=-1,this.config.$autoselect){if(!e||e.nodata)return t(null);var n=this._findSelected(e);this.selectedIndex=n.index,t(n.item)}},e}();e.DataSet=I,e.getUrlBaseByType=function(e,t){var o=s.config(s.name)||{},r=o?o[e]:null,a="";if(r&&r.base&&(a=r.base),a&&a.indexOf("{")>=0){var l=n.context({cookie:!0});a=i.formatNames(a,l)}return(t=t&&0!==a.toLowerCase().indexOf("http"))&&(a=a&&":"===a.charAt(0)?location.protocol+"//"+location.hostname+a:location.protocol+"//"+location.host+a),a},e.replaceFilterVars=function(e,i){var o=n.context();return e&&"string"==typeof e?f(e,{$url:o.$url,$context:i,$data:null,$mem:t.$mem,$local:null},!1,!1,!0):_(e,o.$url,i,null,!1,!0)},e.registerDataProvider=d.register,e.compileFilterTree=function(e,t,n,i){return _(e,t,n,i,!1,!1)},e.acceptFilter=function(e,t){return"eq"===e.$op&&t[e.$left]==e.$right},e.extractValue=function(e){e=e||"";var t=n.context();return f(e,t,!1,!1,!1)},e.execOutputData=function(e,t){if(e.$output){var i=n.context();i.$data=t[e.name],i.$context=t,t[e.name]=g(e.$output,i)}},e.test={output:g,parseTree:x}}(e.data||(e.data={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s;t=e.ui||(e.ui={}),i=(n=e).dom,o=n.utils,n.locale,r=function(e,t,n,i,o){return{number:e,text:t,icon:n,active:i,disabled:o}},s=function(){function t(e){var t=this;t._options=$.extend({boundaryLinks:!1,directionLinks:!0,rotate:!0,maxSize:4,size:"lg"},e||{}),t.pages=[],t._updating=!1,t.visible=!1,t.props={},t.data={currentPage:-1,totalPages:0,hasNext:!1,hasPrev:!1},t._defineProps()}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),t.prototype._defineProps=function(){var e=o.defineProperty;e("currentPage",this),e("totalPages",this),e("hasPrev",this),e("hasNext",this)},t.prototype._notifyChange=function(e){var t=this;switch(e){case"currentPage":if(t._options.noPagesCount)return;t._changed=!0,t._updatePages();break;case"totalPages":if(t._options.noPagesCount)return;t._changed=!0,t.data.currentPage>=0&&t._updatePages();break;case"hasNext":case"hasPrev":if(!t._options.noPagesCount)return;t._changed=!0,t._updatePages()}},t.prototype._renderPager=function(){var t=this.$element.get(0);if(e.bootstrap4&&(t=t.lastChild),this.visible){var n=document.createDocumentFragment(),o=$(e.bootstrap4?'<li class="page-item"><a class="page-link bs-button" href></a><li>':"<li><a href></a><li>").get(0),r=document.createElement("span");this.pages.forEach(function(e){var t=o.cloneNode(!0);if(e.icon){var s=r.cloneNode(!0);i.attr(s,"class",i.iconClass(e.icon)),i.attr(s,"page",e.number),i.append(t.firstChild,s)}e.text&&i.text(t.firstChild,e.text),i.attr(t,"page",e.number),i.attr(t.firstChild,"page",e.number),e.disabled&&i.addClass(t,"disabled"),e.active&&i.addClass(t,"active"),n.appendChild(t)}),$(t).empty(),t.appendChild(n),i.removeClass(t,"bs-none")}else i.addClass(t,"bs-none")},t.prototype._updatePages=function(){var e=this;if(!e._updating){if(e.pages=function(e,t,n,i,o){var s=[];if(n.noPagesCount)return a=r("prev",null,"chevron-left",!1,!o),s.unshift(a),a=r("next",null,"chevron-right",!1,!i),s.push(a),s;var a,l=1,u=t,d=n.maxSize&&n.maxSize<t;d&&(n.rotate?(u=(l=Math.max(e-Math.floor(n.maxSize/2),1))+n.maxSize-1)>t&&(l=(u=t)-n.maxSize+1):(l=(Math.ceil(e/n.maxSize)-1)*n.maxSize+1,u=Math.min(l+n.maxSize-1,t)));for(var c=l;c<=u;c++){var p=r(c,c,null,c===e,!1);s.push(p)}if(d&&!n.rotate){if(l>1){var h=r(l-1,"...",null,!1,!1);s.unshift(h)}if(u<t){var f=r(u+1,"...",null,!1,!1);s.push(f)}}return n.directionLinks&&(a=r("prev",null,"chevron-left",!1,1==e),s.unshift(a)),n.boundaryLinks&&(a=r("first",null,"backward",!1,1==e),s.unshift(a)),n.directionLinks&&(a=r("next",null,"chevron-right",!1,e==t),s.push(a)),n.boundaryLinks&&(a=r("last",null,"forward",!1,e==t),s.push(a)),s}(e.data.currentPage,e.data.totalPages,e._options,e.data.hasNext,e.data.hasPrev),e._options.noPagesCount)e.visible=e.data.hasNext||e.data.hasPrev;else{e.visible=e.data.currentPage>0&&e.data.totalPages>1;var t=5;e._options.boundaryLinks||(t-=2),e._options.directionLinks||(t-=2),e.visible=e.pages.length>t}e.$element&&e._renderPager()}},t.prototype._setEvents=function(){var e=this;e.$element&&e.$element.on("click",function(t){var n=t.target,o=i.attr(n,"page");if(o){if(t.preventDefault(),t.stopPropagation(),i.hasClass(n,"disabled")||i.hasClass(n.parentNode,"disabled"))return;if(e._options.selectPage){var r=parseInt(o,10);e._options.selectPage(isNaN(r)?o:r)}}})},t.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},t.prototype.updating=function(e){var t=this;t._updating=e,e?t._changed=!1:t._changed&&(t._changed=!1,t._updatePages())},t.prototype.render=function(t){var n=this;n.$element||(n.$element=$((e.bootstrap4?'<nav><div class="bs-island"></div>':"")+'<ul class="no-y-margin d-inline-flex pagination'+("default"!=n._options.size?" pagination-"+n._options.size:"")+'"></ul>'+(e.bootstrap4?"</nav>":"")),n._renderPager(),n._setEvents()),t&&(n._options.replaceParent?t.replaceWith(n.$element):t.append(n.$element))},t.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null},t}(),t.Pager=s}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e,i=n.history,o=n.utils,r=n.external,s=n.dom,a=n.link,l=n.locale,u=n.application,d=['<div role="alert" class="bs-error alert alert-danger alert-dismissible fade show">','<button aria-label="{0}" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>',"<h4 >{1}</h4>","<p>{2}</p>","<p>",'<a class="bs-button btn btn-'+s.bootstrapStyles(!1).secondary+'" href="{4}" role="button">{3}</a>',"</p>","</div>"],c=['<div class="bs-loader"></div>'],p=null,h=function(){function e(){var e=this;e.children=[],e.data={$title:"",$menuleft:!1,$menutop:!1,$menuright:!1,$menubottom:!1,$hasBack:i.hasBack(),$user:{}},e.errors=[],e.props={},e.popup=null,e.contextMenu=null,e._defineProps(),e._setEvents(),r.historyChangedHandler=e._historyChanged.bind(e)}return e.prototype._defineProps=function(){var e=this,t=o.defineProperty;t("$title",e),t("$menuleft",e),t("$menutop",e),t("$menuright",e),t("$menubottom",e),t("$hasBack",e),t("$user",e)},e.prototype.currentPage=function(){var e=a.parseUrl(window.location.hash).path;return e&&"/"===e.charAt(0)&&(e=e.substr(1)),e},e.prototype.emittersFor=function(e){var t=[],n=e.length;return this.dataListeners&&this.dataListeners.forEach(function(i){if(!i.listener.disabled&&i.emit){for(var o=!1,r=0;r<n;r++)i.emitters.indexOf(e[r])>=0&&(o=!0);o&&t.push(i.listener)}}),t},e.prototype._historyChanged=function(){this.props.$hasBack=i.hasBack()},e.prototype._notifyChange=function(e){this._notifyChildren(e,this.data[e])},e.prototype._notifyChildOnAdd=function(e,t){var n=this;if(e){if("layout"===t){var i=n.childByType("header");if(i&&i.setPage){var o=e.data.name||"";i.setPage(o,e)}}e.onPageChange&&Object.keys(n.props).forEach(function(t){e.onPageChange(t,n.props[t])})}},e.prototype._notifyChildren=function(e,t){this.children.forEach(function(n){var i=n.child;i&&i.onPageChange&&i.onPageChange(e,t)})},e.prototype.registerDataListener=function(e,t){if(this.dataListeners=this.dataListeners||[],e.datasets){var n,i,o=(n=e.datasets,i={emit:!1,listen:!0,triggers:[],emitters:[]},Object.keys(n).forEach(function(e){if("view"!=e){var t=n[e];t.config.$emit&&t.enumEmitters(function(e){i.emit=!0,i.emitters.push(e)}),t.enumTriggers(!1,function(e){i.listen=!0,i.triggers.indexOf(e)<0&&i.triggers.push(e)})}}),i);(o.emit||o.listen)&&this.dataListeners.push({listener:e,parent:t,triggers:o.triggers,listen:o.listen,emitters:o.emitters,emit:o.emit})}},e.prototype.removeDataListener=function(e){if(this.dataListeners)for(var t=this.dataListeners.length;t--;){this.dataListeners[t].listener==e&&this.dataListeners.splice(t,1)}},e.prototype.removeParentDataListener=function(e){if(this.dataListeners)for(var t=this.dataListeners.length;t--;){this.dataListeners[t].parent==e&&this.dataListeners.splice(t,1)}},e.prototype.emitDataEvent=function(e,t,n){this.dataListeners&&this.dataListeners.forEach(function(i){n&&n.indexOf(i.listen)<0||i.listen&&i.triggers.indexOf(e)>=0&&i.listener&&i.listener.dataEvent&&(i.listener.ds_storeLastEvent&&i.listener.ds_storeLastEvent(e,t),i.listener.disabled||i.listener.dataEvent(e,t))})},e.prototype.childByType=function(e){for(var t=0,n=this.children.length;t<n;t++){var i=this.children[t];if(i.type===e)return i.child}return null},e.prototype.addChild=function(e,t){this.children.push({child:t,type:e}),this._notifyChildOnAdd(t,e)},e.prototype.removeChild=function(e){for(var t=this.children.length;t--;){if(this.children[t].child==e){this.children.splice(t,1);break}}},e.prototype.destroy=function(){var e=this;if(r.historyChangedHandler=null,e._hideErrors(!0),e._hideLoading(),e.children){for(var t=e.children.length;t--;){var n=e.children[t];e.removeDataListener(n.child)}e.children=null}e.dataListeners=null,e._removeEvents()},e.prototype._setEvents=function(){var e=this;$(document).on("mousedown touchstart",function(t){s.inCover(t.target)||(e._inContextMenu(t)||e._closePopup(t),e._closeContextMenu(t))}),window.onerror=function(t,n,i,o,r){!r&&n&&(r={filename:n,lineno:i||0,colno:o||0}),e.$error||(e.lastError={message:t,stack:r?r.stack:null,stackError:r&&r.stack?null:r},e._showErrors())}},e.prototype._hideErrors=function(e){this.$error&&(this.$error.off("closed.bs.alert"),e&&this.$error.remove(),this.$error=null)},e.prototype._showErrors=function(){var e=this,t=s.find(null,"error_box");if(t&&!e.$error){var n=["mailto:"];n.push(u.support),n.push("?subject="+encodeURIComponent(u.title)),n.push("&body=");var i=a.context(),r=new Date;n.push(encodeURIComponent(l.errors.ErrorTitle+" ")),n.push(encodeURIComponent(e.lastError.message)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorUser+" ")),n.push(encodeURIComponent(i.$user.name)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorDate+" ")),n.push(encodeURIComponent(r.toLocaleString())),n.push(encodeURIComponent("\n\n"+l.errors.Browser+" ")),n.push(encodeURIComponent(navigator.userAgent)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorURI+" ")),n.push(encodeURIComponent(window.location.href)),(e.lastError.stack||e.lastError.stackError)&&(n.push(encodeURIComponent("\n\n"+l.errors.Stack+"\n")),e.lastError.stack?n.push(encodeURIComponent(e.lastError.stack)):n.push(encodeURIComponent(JSON.stringify(e.lastError.stackError)))),n.push(encodeURIComponent("\n\n"+l.errors.Context+" ")),n.push(encodeURIComponent(JSON.stringify(i))),e.$error=$(o.format(d.join(""),l.ui.Close,l.errors.Title,e.lastError.message,l.errors.SendMail,n.join(""))),e.$error.on("closed.bs.alert",function(){e._hideErrors(!1)}),t.appendChild(e.$error.get(0))}},e.prototype._hideLoading=function(){this.$loading&&(this.$loading.remove(),this.$loading=null)},e.prototype._showLoading=function(){var e=document.body;e&&(this.$loading||(this.$loading=$(c.join("")),e.appendChild(this.$loading.get(0))))},e.prototype.loading=function(e){e?this._showLoading():this._hideLoading()},e.prototype._removeEvents=function(){$(document).off("mousedown touchstart")},e.prototype._closePopup=function(e){var t=this;!t.popup||t.popup.stayOnTop&&null!==e||(!e||t.popup.inPopup&&!t.popup.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(t.popup.hide&&t.popup.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),t.popup=null)},e.prototype._inContextMenu=function(e){return!!(this.contextMenu&&e&&this.contextMenu.inPopup&&this.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))},e.prototype._closeContextMenu=function(e){var t=this;t.contextMenu&&(!e||t.contextMenu.inPopup&&!t.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(t.contextMenu.hide&&t.contextMenu.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),t.contextMenu=null)},e.prototype.setPopup=function(e){this._closePopup(null),this.popup=e},e.prototype.setContextMenu=function(e){this._closeContextMenu(null),this.contextMenu=e},e.prototype.activePage=function(){return{$module:u.name,$page:this.currentPage()}},e}();t.PageControl=h,t.Page=function(){return p||(p=new h),p}}(e.pagecontrol||(e.pagecontrol={}))}(Phoenix||(Phoenix={})),function(e){var t=e,n=t.utils,i=(t.ulocale,t.locale,t.ui,t.link),o=t.pagecontrol,r=t.dom;!function(e){var s=function(){function e(e,t){this._data=e,this._parent=t}return e.prototype.destroy=function(){var e=this;if(e.$element){e.$element.off("click");var t=e.$element.get(0);r.remove(t),e.$element=null}e._parent=null,e._data=null},e.prototype.open=function(e){var s,a,l,u=this,d=[];s=d,a=u._data,(l=t.bootstrap4)?s.push('<div class="dropdown-menu bs-block bs-conntext-menu">'):s.push('<ul class="dropdown-menu bs-block bs-conntext-menu">'),a.forEach(function(e){e.id=e.id||n.allocID(),l?e.separator?s.push('<div class="dropdown-divider bs-cursor-d"></div>'):(s.push('<a class="dropdown-item'+(e.disabled?" disabled":" bs-cursor-p")+'" data-phoenix-href="click://'+e.id+'">'),s.push(n.escapeHtml(e.title)),s.push("</a>")):e.separator?s.push('<li role="separator" class="divider bs-cursor-d"></li>'):(s.push("<li"+(e.disabled?' class="disabled"':' class="bs-cursor-p"')+'><a data-phoenix-href="click://'+e.id+'">'),s.push(n.escapeHtml(e.title)),s.push("</a></li>"))}),l?s.push("</div>"):s.push("</ul>"),u.$element=$(d.join("")),u.$element.on("click",function(e){var t=i.isCustomLink(u.$element.get(0),e,!0);if(t&&"click"===t.protocol){var n=t.value.substring("click://".length),r=u._data.find(function(e){return e.id===n});r&&u._parent&&u._parent.contextMenu&&u._parent.contextMenu(r)}o.Page().setContextMenu(null)});var c=u.$element.get(0);c.style.left=e.pageX+"px",c.style.top=e.pageY+"px",r.append(document.body,u.$element.get(0))},e.prototype.hide=function(e){this.destroy()},e.prototype.inPopup=function(e){return this.$element&&r.isChildOf(this.$element.get(0),e)},e}();e.openContextMenu=function(e,t,n){var i=new s(n,t);i.open(e),o.Page().setContextMenu(i)}}(e.contextmenu||(e.contextmenu={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o=e,r=o.utils,s=o.ulocale,a=o.locale,l=(o.ui,o.dom);t=e.modal||(e.modal={}),n=function(e,t,n){e=function(e){if("close"===e.pattern){var t={close:!0,type:"default",name:"close",title:a.ui.Close};return $.extend({},t,e)}if("validate"===e.pattern){var n={close:!1,type:"success",name:"validate",title:a.ui.Validate};return $.extend({},n,e)}if("create"===e.pattern){var i={close:!1,type:"success",name:"create",title:a.ui.Create};return $.extend({},i,e)}if("abandon"===e.pattern)return t={close:!0,type:"default",name:"abandon",title:a.ui.Abandon},$.extend({},t,e);return e}(e),t.push('<button data-action="'+e.name+'" type="button"'),t.push(' class="bs-btn-inline float-right bs-button btn btn-'+l.bootstrapStyles(!1)[e.type||"default"]),t.push('"'),e.close&&t.push(' data-dismiss="modal"'),t.push(">"),e.icon&&(t.push('<span class="'+l.iconClass(e.icon)+'"></span>'),e.title&&t.push("&nbsp;")),t.push(s.tt(e.title||"",n)),t.push("</button>")},i=function(){function t(e,t){this.options=e||{},this.$id=r.allocID(),this.$locale=t}return t.prototype._removeEvents=function(){this.$element.off("click"),this.$element.off("hidden.bs.modal")},t.prototype._execAction=function(e){this._clickHnd&&this._clickHnd(e)},t.prototype._addEvents=function(){var e=this;e.$element.on("hide.bs.modal",function(t){e._inProcessing&&(t.preventDefault(),t.stopPropagation())}),e.$element.on("hidden.bs.modal",function(t){e._clear()}),e.$element.on("click",function(t){if(e.$element)for(var n=t.target,i=e.$element.get(0);n;){var o=n.getAttribute("data-action");if(o)return r.focusDelay(function(){return e._execAction(o)});n=n==i?null:n.parentNode}})},t.prototype._clear=function(){var e=this;e.$element&&(e._removeEvents(),e.render&&e.render.destroy(),e.$element.remove(),e.$element=null),e.render=null},t.prototype.processing=function(e){this._inProcessing=e,l.processing(e),this.render&&this.render.processing&&this.render.processing(e)},t.prototype.on=function(e){this._clickHnd=e},t.prototype.close=function(){var t=e.modalPlugin;this.$element&&this.$element[t]("hide")},t.prototype.open=function(){var t,i,o,a,u=this,d={id:u.$id,title:u.options.title||"",buttons:u.options.buttons||[],size:0,noClose:!1};if(u.options.size&&(d.size=u.options.size),u.options.noClose&&(d.noClose=u.options.noClose),!u.$element){u.$element=$((t=d,i=u.$locale,o=e.bootstrap4,a=['<div class="modal fade" data-backdrop="static"  id="{0}" role="dialog" aria-labelledby="{0}_label">','\t<div class="modal-dialog'+(t.size?" modal-"+t.size:"")+'" role="document">','\t\t<div class="modal-content">','\t\t<div class="modal-header">',o?'\t\t\t<h5 class="modal-title" id="{0}_label">{1}</h5>':"",t.noClose?"":'\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',o?"":'\t\t\t<h4 class="modal-title" id="{0}_label">{1}</h4>',"\t\t</div>",'\t\t<div class="modal-body" id="{0}_body">',"\t\t</div>",'\t\t<div class="modal-footer"  id="{0}_footer">'],t.buttons&&t.buttons.forEach(function(e){n(e,a,i)}),a.push("\t\t</div>"),a.push("\t\t</div>"),a.push("\t</div>"),a.push("</div>"),r.format(a.join(""),t.id,s.tt(t.title,i)))),u.render&&u.render.render($(l.find(u.$element.get(0),u.$id+"_body"))),l.append(document.body,u.$element.get(0));var c=e.modalPlugin;u.$element[c]&&(u.$element[c]({}),u._addEvents())}},t.prototype.destroy=function(){this._clear()},t}(),t.Modal=i}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u;t=e.DatasetPlugin||(e.DatasetPlugin={}),i=(n=e).data,o=n.link,r=n.$mem,s=n.utils,a=function(e,t,n,i){if(t.config.$emit[i].$updateMem){var o=t.data2Output(t.config.$emit[i].$updateMem,{$item:n});r=$.extend(r,o)}if(t.config.$emit[i].$updateLocal){var s=e.getLocalContextHandler?e.getLocalContextHandler():null;if(s){var a=t.data2Output(t.config.$emit[i].$updateLocal,{$item:n});s=$.extend(s,a)}}},l=function(e,t,n,r,a,l,u,d){var c=function(e){return d?n?n[e]:null:n},p=e,h=[],f=[],m=r||{},v="$load"==t,g=-1,y=function(e,t,n){if(p&&p.datasets){var i=p.datasets[e];i&&(h.push(i.execute(n,p)),f.push(e),i.defaultDataset&&(g=t.length-1))}};l?l&&Array.isArray(l)?l.forEach(function(e){"object"==typeof e?e.name&&(h.push(i.execData(e,c(e.name),p)),f.push(e.name)):y(e,f,c(e))}):y(l,f,c(l)):p&&p.datasets&&Object.keys(p.datasets).forEach(function(e){var n=p.datasets[e],i=(o.search(!0),p.ds_context());n&&n.canExecute(t,i)&&y(e,f,c(e))}),h.length?(p&&p.loadingHandler&&p.loadingHandler(!0),s.Promise.all(h).then(function(e){var t=[];f.forEach(function(n,i){var o=e[i];if(i==g&&p&&p.noDataHandler&&p.noDataHandler(!o||o.nodata,null,!0),m[n]=o,p){var r=p.datasets&&p.datasets[n];if(v&&r&&r.$menu&&p.updateMenuHandler){var s=n.split("_");t.push({name:s[s.length-1],data:o})}if(r&&(p.ds_loaded(n,o),r.autoselect))return r.doAutoSelect(o,function(e){p.ds_select(n,e)})}}),p&&p.loadingHandler&&p.loadingHandler(!1),t.forEach(function(e){p.updateMenuHandler(e.name,e.data)}),a(!0),p&&p.watchersHandler&&p.watchersHandler(f),!v&&u&&p&&p.dataChangedHandler&&p.dataChangedHandler(f)}).catch(function(e){e&&console.log(e),p&&p.loadingHandler&&p.loadingHandler(!1),p&&p.errorHandler&&p.errorHandler(e),a(!1,e),!v&&u&&p&&p.dataChangedHandler&&p.dataChangedHandler(f)})):a(!0)},u=function(){function e(){}return e.prototype.ds_init=function(e){var t=this,n=!1;if(t.props=t.props||{},t.props.data=t.props.data||{},t.props.data.ds={},e.datasets||e.$resources||e.$schema||e.$menus){t.datasets&&t.ds_destroy();var o=e.$resources||e.$schema;o&&(t.props.data.ds.view=null,t.datasets=t.datasets||{},t.datasets.view=new i.DataSet({$type:"widget-schema",$params:{name:o,localization:e.$localization}}),t.datasets.view.$schema=!0),e.$menus&&Object.keys(e.$menus).forEach(function(n){var o="$menu_"+n;t.props.data.ds[o]=null,t.datasets=t.datasets||{},t.datasets[o]=new i.DataSet({$type:"menu",$params:{name:e.$menus[n]+"-"+n}}),t.datasets[o].$menu=!0}),e.datasets&&Object.keys(e.datasets).forEach(function(o){t.props.data.ds[o]=null,t.datasets=t.datasets||{};var r=new i.DataSet(e.datasets[o]);t.datasets[o]=r,n||(n=r.hasCustomEvents()||r.config.$emit)})}return n},e.prototype.ds_storeLastEvent=function(e,t){this._lastEvent={event:e,value:t}},e.prototype.ds_LastEvent=function(){if(this._lastEvent){var e=this._lastEvent;return this._lastEvent=null,e}return null},e.prototype.ds_destroy=function(){s.log("Destroy Dataset Part","destroy");var e=this;e._lastEvent=null,e.datasets&&(Object.keys(e.datasets).forEach(function(t){e.datasets[t].destroy()}),e.datasets=null)},e.prototype.ds_context=function(){var e={$url:o.search(!0),$mem:r,$local:this.getLocalContextHandler?this.getLocalContextHandler():null},t=this.props.data.ds;return t&&Object.keys(t).forEach(function(n){e[n]=t[n]}),e},e.prototype.ds_reemit=function(e,t){var n=this;n.datasets&&Object.keys(n.datasets).forEach(function(e){var t=n.props.data.ds[e],i=n.datasets[e];i.defaultDataset&&n.noDataHandler&&n.noDataHandler(!t||t.nodata,null,!0),n.ds_loaded(e,t),i.autoselect&&i.doAutoSelect(t,function(t){n.ds_select(e,t)})});return t()},e.prototype.ds_select=function(e,t){var n=this;if(n.datasets&&n.datasets[e]){var i=n.datasets[e];i.config.$emit&&n.emitHandler&&(i.config.$emit.$changed&&a(n,i,t,"$changed"),n.emitHandler(i.config.$emit.$changed?i.config.$emit.$changed.$name:i.config.$emit,t))}},e.prototype.ds_loaded=function(e,t){var n=this;if(n.datasets&&n.datasets[e]){var i=n.datasets[e];i.config.$emit&&i.config.$emit.$loaded&&(a(n,i,t,"$loaded"),n.emitHandler(i.config.$emit.$loaded.$name,t))}},e.prototype.ds_exec=function(e,t,n,i,o,r){l(this,e,t,n,i,o,r)},e}(),t.DatasetMethods=u,t.executeDatasets=function(e,t,n,i,o,r){var s={loadingHandler:i&&i.loading?i.loading:null,errorHandler:i&&i.error?i.error:null};l(s,"",t,n,o,e,!1,r)}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d;t=e.WidgetUtils||(e.WidgetUtils={}),i=(n=e).dom,o=n.utils,r=n.locale,s=n.ulocale,a=function(e,t,n){var o=["bs-island bs-widget"];return i.parseStyle(e.$style,o),e.$border&&o.push("border"),t.design&&o.push("design"),n&&o.push("selected"),o.join(" ")},l=function(e){return e?"height:"+((e+"").indexOf("%")>0?e:parseInt(e,10)+"px")+";":""},u=function(e,t,n,r,a){e.push('<div class="bs-widget-title'+(a?" bs-widget-content-inv-x":"")+(n.$titleIsHidden&&!a?" bs-none":"")+'" id="'+t+'_title">');var l=s.localeTitle(n.$title)||"";r&&(l=s.tt(n.$title||"",r)),e.push(o.escapeHtml(l+" ")),n.icons&&n.icons.length&&n.links&&n.icons.forEach(function(t){var o=n.links[t.link];o&&o.$icon&&(e.push('<a class="bs-widget-title-icon" data-phoenix-href="link://'+t.link+'">'),e.push('<span class="'+i.iconClass(o.$icon)+'"></span>'),e.push("</a>"))}),e.push("</div>")},d=function(e,t,n,i,o,r){!function(e,t,n,i){e.push('<div class="'),e.push(a(t.$config,n,t.$selected)),e.push('"'),n.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push(">"),u(e,t.$id,t.$config,i,!1),e.push('<div class="bs-widget-content bs-widget-content-id"');var o=l(t.$config.$height);o&&e.push(' style="'+o+'"'),e.push(">")}(e,t,o,r),e.push("</div></div>")},t.toHtml=function(e,t,n,i,o){var r=[];return d(r,e,0,0,t,o),r.join("")},t.cssClass=a,t.heightText=l,t.loader=function(){return $('<div class="bs-loader"></div>')},t.error=function(){return $('<div class="alert alert-danger" role="alert"><span class="'+i.iconClass("exclamation-circle")+'" aria-hidden="true"></span><span></span></div>')},t.widgetTitle=u,t.settings=function(){return $('<span class="bs-module-settings '+i.iconClass("cog")+'" ></span>')},t.warning=function(){return $('<div class="alert alert-warning" role="alert"></div>')},t.noData=function(e,t){var n=[],o=!1!==t;return t=t&&!0!==t||"cloud",n.push('<div class="bs-widget-content nodata">'),n.push('<div class="bs-no-data-inside">'),o&&n.push('<center class="nodata-image"><i class="'+i.iconClass(t)+' nodata-icon"></i></center>'),n.push('<center><h4 class="nodata-text">'),n.push(e||r.layouts.NoData),n.push("</h4></center>"),n.push("</div>"),n.push("</div>"),$(n.join(""))}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u;t=e.ui||(e.ui={}),i=(n=e).dom,o=n.utils,n.locale,r=n.WidgetUtils,s=n.DatasetPlugin,a=n.link,l=n.render,u=function(){function e(e,t,n){var i=this;i.item=e||{},i.item.$id||(i.item.$id=o.allocID()),e.$config=e.$config||{},e.$config.data=e.$config.data||{},i.data=e.$config,i.props={},i.item.$render=i.props,i.props.data=e.$config.data,i.options=t||{},i.contentRender=null,i.links=e.$config.links,i._defineProps(),i.layout=n,i.$local={},i.loadingHandler=i.loading.bind(i),i.noDataHandler=i.noData.bind(i),i.errorHandler=i.error.bind(i),i.emitHandler=i.emit.bind(i),i.getLocalContextHandler=i.getLocalContext.bind(i),i.dataChangedHandler=i.dataChanged.bind(i),i.updateMenuHandler=null,i._watchers={},i.props.data.localContext&&$.extend(i.$local,i.props.data.localContext),i.ds_init(i.data)&&i._listen()}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,n,i,o,r){},e.prototype._defineProps=function(){var e=this,t=o.defineProperty;t("$title",e),t("$border",e),t("$height",e),t("$titleIsHidden",e),t("$settings",e)},e.prototype._notifyChange=function(e){switch(e){case"$title":this._updateTitle();break;case"$border":case"$titleIsHidden":this._updateCssClass();break;case"$height":this._updateHeight()}},e.prototype._listen=function(){this.layout&&this.layout.registerDataListener(this)},e.prototype._unlisten=function(){this.layout&&this.layout.removeDataListener(this)},e.prototype.on=function(e,t){this.handlers=this.handlers||{},this.handlers[e]=t},e.prototype._exec=function(e){this.handlers&&this.handlers[e]&&this.handlers[e]()},e.prototype._setEvents=function(){var e=this,t=e.$element.get(0);e.$element.on("click",function(n){var i=n.target;e.$settings&&i===e.$settings.get(0)&&e._exec("settings");var o=a.isCustomLink(t,n);o&&a.execCustomProtocol(o,e.ds_context(),{links:e.links},null)})},e.prototype.executeLink=function(e,t){var n=a.isCustomProtocol(e);n&&a.execCustomProtocol({protocol:n,value:e},this.ds_context(),{links:this.links},t)},e.prototype._removeEvents=function(){this.$element.off("click")},e.prototype.dataChanged=function(e){var t=this;t.onDSChanged&&t.onDSChanged(e),t.contentRender&&t.contentRender.dataChanged?t.contentRender.dataChanged():t.options.onDataChanged&&t.options.onDataChanged()},e.prototype.execDataSet=function(e,t,n,i,o){i=i||this.props.data.ds,this.ds_exec(null,t,i,n||function(){},e,o)},e.prototype._loadData=function(e){if(!this.datasets)return e(!1);this.ds_exec("$load",null,this.props.data.ds,e,null,!0)},e.prototype._updateTitle=function(){if(this.$element){var e=i.find(this.$element.get(0),this.item.$id+"_title");e&&i.text(e,this.data.$title||"")}},e.prototype._cleanErrors=function(e){var t=this;t.$loader&&(t.$loader.remove(),t.$loader=null),e||(t.$settings&&i.addClass(t.$settings.get(0),"bs-none"),t.$noData&&(t.$noData.remove(),t.$noData=null),t.$error&&(t.$error.remove(),t.$error=null),t.$warning&&(t.$warning.remove(),t.$warning=null))},e.prototype.loading=function(e){var t=this;t._cleanErrors(!e);var n=t.$element?t.$element.get(0):null;n&&(e?(i.addClass(n,"loading"),t.$loader||(t.$loader=r.loader(),t.$element.append(t.$loader))):i.removeClass(n,"loading")),e||t.settings()},e.prototype._linksState=function(e){if(this.$element){var t=this.$element.get(0),n=i.find(t,this.item.$id+"_title");if(n){var o=i.queryAll(n,".bs-widget-title-icon");[].forEach.call(o,function(t){e?i.removeClass(t,"bs-none"):i.addClass(t,"bs-none")})}}},e.prototype.noData=function(e,t,n){var o=this;if(!t&&o.props.data.$noDataMessage&&(t=o.props.data.$noDataMessage),this._cleanErrors(!1),o.$element){var s=o.$element.get(0),a=i.query(s,".bs-widget-content-id");if(a&&(e?i.addClass(a,"bs-none"):i.removeClass(a,"bs-none"),o._linksState(!e)),e){if(o.$noData=r.noData(t,n),o._updateHeight(o.$noData)){var l=i.query(o.$noData.get(0),".bs-no-data-inside");i.addClass(l,"centred")}var u=i.find(s,o.item.$id+"_title");u&&i.after(u,o.$noData.get(0))}}},e.prototype.getLocalContext=function(){return this.$local},e.prototype.settings=function(){var e=this,t=e.data.$settings&&!e.$error&&!e.$warning&&!e.$noData;if(e.$settings)t?i.removeClass(e.$settings.get(0),"bs-none"):i.addClass(e.$settings.get(0),"bs-none");else if(t){e.$settings=r.settings();var n=i.find(e.$element.get(0),e.item.$id+"_title");n&&i.after(n,e.$settings.get(0))}},e.prototype.error=function(e){var t=e;e&&e.message&&(t=e.message);var n=this;this._cleanErrors(!1);var o=n.$element?n.$element.get(0):null;if(o){n.$error=r.error();var s=n.$error.get(0);i.text(s.lastChild," "+t);var a=i.find(o,n.item.$id+"_title");a&&i.after(a,s)}},e.prototype.warning=function(e){var t=this;this._cleanErrors(!1);var n=t.$element?t.$element.get(0):null;if(n){t.$warning=r.warning();var o=t.$warning.get(0);i.text(o,e);var s=i.find(n,t.item.$id+"_title");s&&i.after(s,o)}},e.prototype._updateHeight=function(e){var t=(e=e||this.$element)?e.get(0):null;return t&&(t.style.cssText=r.heightText(this.props.$height)),!!this.props.$height},e.prototype._updateCssClass=function(){var e=this.$element?this.$element.get(0):null;e&&(e.className=r.cssClass(this.data,this.options))},e.prototype._internalRenderContent=function(e,t,n){var i=this,o=l.get(i.options.context,"widget.content.control."+i.data.$type);if(i.$element){if(o)i.contentRender=new o(i.props,{context:i.options.context,replaceParent:!1},this);else{var r=l.get(i.options.context,"widget.content");if(r){var s=[];r(s,i.data,i.options),e.append($(s.join("")))}}i.options.beforeAdd&&i.options.beforeAdd(e,n),i.contentRender&&i.contentRender.render(e),t&&i.$element.append(e)}},e.prototype.watchersHandler=function(e){var t=this;e&&e.forEach(function(e){var n=t._watchers[e];n&&n.forEach(function(n){n(t.props.data.ds[t.props.data.ds[e]])})})},e.prototype.render=function(e){var t=this;if(t.$loader=null,t.$error=null,!t.$element){t.layout.controls[t.item.$id]=this,t.$element=$(r.toHtml(t.item,t.options,null,null,null)),t._setEvents();var n=t.$element.get(0),o=i.query(n,".bs-widget-content-id");t._loadData(function(e){t._internalRenderContent($(o),!1,e),t.settings()}),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))}},e.prototype.emit=function(e,t,n){this.layout&&this.layout.emitDataEvent(e,t,n)},e.prototype.dataEvent=function(e,t){this.ds_exec(e,t,this.props.data.ds,function(){},null,!0)},e.prototype.destroy=function(){o.log("Destroy Module","destroy");var e=this;e.contentRender&&(e.contentRender.destroy(),e.contentRender=null),e._unlisten(),e.ds_destroy(),e._cleanErrors(!1),e.item.$render=null,e.$settings&&(e.$settings=null),e.$element&&(e._removeEvents(),e.$element=null),e.layout=null,e.ondatasets=null},e.prototype.watch=function(e,t){var n=this;n._watchers&&((n._watchers[e]=n._watchers[e]||[]).push(t),n.props&&n.props.data.ds&&o.nextTick(function(){t(n.props.data.ds[e])}))},e.prototype.unwatch=function(e,t){if(this._watchers){var n=this._watchers[e];if(n){var i=n.indexOf(t);i>=0&&n.splice(i,1)}}},e}(),t.Widget=u,o.applyMixins(u,[s.DatasetMethods])}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d;t=e.menubase||(e.menubase={}),i=(n=e).pagecontrol,o=n.utils,n.ulocale,r=n.link,s=n.$mem,a=n.DatasetPlugin,l=n.dom,u=function(e,t,n,i,r){t&&t.forEach(function(t){void 0===t.$level&&(t.$level=r),t.$id=o.allocID(),i&&(t.$parentId=i.$id),n.push(t),t.$items&&t.$items.length?(void 0===t.collapsed&&(t.collapsed=!!e.canExpandItems),u(e,t.$items,n,t,r+1)):t.collapsed=!1})},d=function(){function e(e,t){this._initOptions(t),this.init(e,t)}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,n,i,o,r){},e.prototype._initOptions=function(e){},e.prototype.emit=function(e,t,n){this.emitDataEvent(e,t,n)},e.prototype.init=function(e,t){o.log("Create Menu","menu");var n=this;n.loadingHandler=this.loading.bind(n),n.noDataHandler=null,n.errorHandler=null,n.emitHandler=this.emit.bind(n),n.getLocalContextHandler=null,n.dataChangedHandler=null,n.updateMenuHandler=null,n.$element=null,n.$items=null,n.options=t||{},n.options.typeMenu=n.options.type||"left",n.data={name:"none"},n.page=i.Page(),n.page.addChild("menu-"+n.options.typeMenu,n),n.setMenu(e)},e.prototype.loading=function(e){this.page.loading(e)},e.prototype.registerDataListener=function(e){this.page&&this.page.registerDataListener(e,this)},e.prototype.removeDataListener=function(e){this.page&&this.page.removeDataListener(e)},e.prototype.emitDataEvent=function(e,t,n){this.page&&this.page.emitDataEvent(e,t,n)},e.prototype.onPageChange=function(e,t){var n=this;if("$user"===e&&n.items&&n.options.auth&&!n.options.autoClose){var i=n.page.props.$user&&n.page.props.$user.connected;if(i){var o=l.find(null,n.options.parentId);o?n.show($(o)):n._showContent()}else n.$content&&!i&&n._hideContent()}"$title"===e&&n._onPageChanged()},e.prototype.setMenu=function(e){o.log("Set Menu","menu");var t=this,n=null!=e;(e=e||{name:"none"}).$groups||(e.$groups=[{$items:e.$items}]),t.data.name!==e.name||void 0===e.name?(o.log("Menu create && execute datasets","menu"),t.data=e,t.items=null,t._map={},t._recreateDatasets(),t.ds_exec("$load",null,t.props.data.ds,function(){var e=!t.options.autoClose&&t.options.parentId&&n;if(e&&t.options.auth&&(e=t.page.props.$user&&t.page.props.$user.connected),t._prepareItems(),t.$content)if(t._removeContent(),n)if(e){var i=l.find(null,t.options.parentId);i&&(t.render(),t.show($(i)))}else t.render();else t._hideContent();else if(e){var o=l.find(null,t.options.parentId);o&&t.show($(o))}t.page.props["$menu"+t.options.typeMenu]=n&&t.options.autoClose},null,!0),t._onPageChanged()):(o.log("Menu reexecute datasets","menu"),t.ds_reemit(null,function(){t._onPageChanged(),t.page.props["$menu"+t.options.typeMenu]=n&&t.options.autoClose}))},e.prototype._onPageChanged=function(){},e.prototype._doCloseClick=function(){},e.prototype._menuShowed=function(){},e.prototype._executeLink=function(e,t){},e.prototype._executeContextMenu=function(e,t,n){return!1},e.prototype._setEvents=function(){var e=this,t=e.$content.get(0);e.$content.on("click",function(n){var i=r.isCustomLink(t,n,!0);if(i&&"click"===i.protocol){var o=i.value.substring("click://".length);if("close"===o){if(e._doCloseClick)return e._doCloseClick()}else{if(0===o.indexOf("collapse/")){var s=(o=o.substring("collapse/".length)).split("/"),a=e.items[parseInt(s[0],10)];return void(a&&(e.colapse(a,!a.collapsed,!1),e.updateItemsAfterCollapse()))}var l=o.split("/");e._executeLink(e.items[parseInt(l[0],10)],l.length>1?l[1]:null)}}e.options.autoClose&&e.hide()}),e.$content.contextmenu(function(n){if(e.options.noContextMenu)return n.preventDefault(),!1;var i=r.isCustomLink(t,n,!0);if(i&&"click"===i.protocol){var o=i.value.substring("click://".length);if("close"===o);else if(0===o.indexOf("collapse/"));else{var s=o.split("/");if(e._executeContextMenu(n,e.items[parseInt(s[0],10)],s.length>1?s[1]:null))return n.preventDefault(),!1}}})},e.prototype.updateItemsAfterCollapse=function(){},e.prototype.renderItems=function(e){return null},e.prototype._removeEvents=function(){this.$content.off("click"),this.$content.off("contextmenu")},e.prototype._loadData=function(e){if(!this.datasets)return e(!1);this.ds_exec("$load",null,this.props.data.ds,e,null,!0)},e.prototype._expandItem=function(e,t,n,i,r,s){var a={$title:"",$item:e,$index:s,$link:r};return a.$title=o.parseVariable(i,{$item:e,$url:t,$mem:n}),a},e.prototype._expandDatasetItems=function(e,t,n){var i=this,o=i.props.data.ds[e];if(o){var a=[],l=r.search(!0),u=s;if(o.documents){if(!o.documents.length)return null;o.documents.forEach(function(e,o){a.push(i._expandItem(e,l,u,t,n,o))})}else a.push(i._expandItem(o,l,u,t,n,-1));return a}return null},e.prototype.copyMenuItemData=function(e,t){},e.prototype.isVisible=function(e){if(e.$parentId&&this.options.canExpandItems){for(var t=!0,n=e;n&&n.$parentId;)if((n=this._map[n.$parentId])&&n.collapsed){t=!1;break}return t}return!0},e.prototype.colapseAll=function(e){this.items.forEach(function(t){t.collapsed=e})},e.prototype.colapse=function(e,t,n){var i=this;e.collapsed=t,e.$items&&e.$items.forEach(function(e){e.collapsed=t,n&&e.$items&&i.colapse(e,t,!0)})},Object.defineProperty(e.prototype,"search",{get:function(){return this._search},set:function(e){this._search!==e&&(this._search=e,this._updateSearch()),this._search=e},enumerable:!0,configurable:!0}),e.prototype._updateSearch=function(){},e.prototype._prepareItems=function(){var e=this;if(e._searchList=[],e.items=[],e.data.$groups){var t=!0;e.data.$groups.forEach(function(n,i){var s=null;if(0===i&&(n.$title=n.$title||String.fromCharCode(160)),n.$dataset){if(!n.$link)throw"Invalid link definition. (no link)";if(!n.$itemtitle)throw"Invalid link definition. (no itemtitle)";s=e._expandDatasetItems(n.$dataset,n.$itemtitle,n.$link)}else s=n.$items;if(s&&s.length){var a=[];if(u(e.options,s,a,null,0),s=a,!t||n.$title||0===i||n.$dataset){var l={$id:o.allocID(),divider:!0,$title:null,$firstGroup:0===i,dataset:"",isHidden:!1,collapsed:!1};l.$title=n.$title,n.dataset&&(l.dataset=n.$dataset,t&&(l.isHidden=!0)),e._map[l.$id]=l,e.items.push(l),t=!1}}if(s){var d=n.$dataset?e.datasets[n.$dataset]:null;s.forEach(function(i,s){var a={$id:i.$id,$parentId:i.$parentId,$title:i.$title?o.parseExpression(i.$title,r.context()):null,$dataset:null,dataset:null,$index:0,$item:null,$link:null,$level:i.$level,selected:!1,collapsed:i.collapsed,$items:i.$items};n.dataset&&(a.dataset=n.$dataset),i.$link&&(a.$link=i.$link),d&&d.autoselect&&(a.selected=d.selectedIndex==s),e.copyMenuItemData(a,i),d&&(a.$dataset=n.$dataset,a.$index=i.$index,a.$item=i.$item),e._map[a.$id]=a,e.items.push(a),a.$title&&e._searchList.push({id:a.$id,title:a.$title}),t=!1})}})}},e.prototype._removeContent=function(){this.$element&&(this.$element.remove(),this.$element=null)},e.prototype.renderContent=function(){return $("<aside></aside>")},e.prototype.show=function(e){var t=this;if(!e&&t.options.parentId){var n=l.find(null,t.options.parentId);n&&(e=$(n))}t.$content?t._showContent():(t.render(e),t.options.autoClose?o.nextTick(function(){t._showContent()}):t._showContent()),t.options.autoClose&&t.page.setPopup(t)},e.prototype.hide=function(e){this.$content&&this._hideContent(e)},e.prototype._hideContent=function(e){var t=this.$content.get(0);l.addClass(t,"bs-none")},e.prototype._showContent=function(){var e=this.$content.get(0);l.removeClass(e,"bs-none"),this._menuShowed()},e.prototype.render=function(e){var t=this,n=t.$content;if(n||(n=t.renderContent()),t.$element||(t.$element=t.renderItems(n),n.append(this.$element)),e&&!t.$content){if(t.$content=n,t.options.replaceParent){var i=e.get(0);if(i&&i.id){var o=t.$content.get(0);o&&(o.id=i.id)}e.replaceWith(t.$content)}else e.append(t.$content);t._setEvents()}},e.prototype._recreateDatasets=function(){var e=this;e.ds_destroy(),e.removeDataListener(e),e.ds_init(e.data)&&e.registerDataListener(e)},e.prototype.destroy=function(){var e=this;o.log("Destroy Menu","destroy"),e.ds_destroy(),e.removeDataListener(e),e.$content&&(e._removeEvents(),this.$content=null),this.$element=null,e.page&&(e.page.removeChild(e),e.page=null)},e.prototype.inPopup=function(e){if(!this.options.autoClose)return!0;if(!e)return!0;if(this.$content)for(var t=this.$content.get(0),n=e;n;){if(n==t)return!0;n=n.parentNode}return!1},e}(),t.MenuBase=d,o.applyMixins(d,[a.DatasetMethods])}(Phoenix||(Phoenix={})),function(e){!function(t){var n="#/definitions/",i=n.length;t.INDEX_FIELD_NAME="$index",t.SELECTED_FIELD_NAME="$select",t.EXPANDED_FIELD_NAME="$expand";var o,r,s=e.ulocale,a=e.external,l=e.application,u=(e.ajax,e.dom),d=(e.link,e.data),c=e.utils,p=(s=e.ulocale,e.locale),h=e.customData,f=e.locale.schema,m=e.DatasetPlugin,v=[t.INDEX_FIELD_NAME,t.SELECTED_FIELD_NAME,t.EXPANDED_FIELD_NAME],g=function(e){if(!e.features){e.features={};var t=void 0===e.capabilities?"filtrable,sortable":e.capabilities;t&&t.split(",").forEach(function(t){e.features[t]=!0})}},y=function(e,t){if(e.$ref){var n=e.$ref.substr(i),o=t.definitions?t.definitions[n]:null;if(!o)throw"Schema $ref not found : "+e.$ref;return o}return e},_=(r={},{register:function(e,t){r[e]=t},get:function(e){return r[e]}}),b=(o={},{register:function(e,t){o[e]=t},get:function(e){return o[e]}});function x(e,t,n,i,o,r,s){r(n,e,t,o,i,s=s||{})&&Object.keys(e.properties).forEach(function(i){var a=e.properties[i];if(!a.$reference||s&&s.$references)if(!a.type&&a.$ref&&(a=y(a,t)),"object"===a.type)x(a,t,u=n?n+"."+i:i,!1,o?o[i]:null,r,s);else if("array"===a.type){var l=y(a.items,t);if("object"===l.type){var u=n?n+"."+i:i;s.currentRef=a.items.$ref,x(l,t,u,!0,o?o[i]:null,r,s)}}})}function C(e,t){if(!t.definitions)throw new Error("schema.definitions is null");var o=e,r=o.indexOf(n);if(r<0)throw new Error(c.format("Invalid $ref. ({0})",o));var s=o.substring(r+i);return t.definitions[s]}function k(e,t,n){var i=null;return e.allOf?(i=e.allOf,delete e.allOf):e.$ref&&t.indexOf(e.$ref)<0&&(i=[{$ref:e.$ref}],e.ux&&(i[0].ux=!0),delete e.$ref),i&&i.forEach(function(i){var o=t.slice(0);if(i.$ref){var r=C(i.$ref,n);i.ux&&(r.properties&&Object.keys(r.properties).forEach(function(e){var t=r.properties[e];void 0===t.ux&&(t.ux=!0)}),r.links&&Object.keys(r.links).forEach(function(e){var t=r.links[e];void 0===t.ux&&(t.ux=!0)})),"array"!==i.type&&"array"!==r.type&&o.push(i.$ref),delete i.$ref,c.merge(r,i)}w(i,o,n),c.merge(i,e)}),i}function w(e,t,n){k(e,t.slice(0),n);var i=null;e.properties?i=e:"array"===e.type&&e.items&&(i=e.items),i&&i.properties&&Object.keys(i.properties).forEach(function(e){var o=i.properties[e];(o.allOf||o.$ref)&&k(o,t,n),"array"===o.type&&o.items&&(o.items.allOf||o.items.$ref)&&k(o.items,t,n)})}var E={RATE_DECIMALS:2,RATE_MAXIMUM:1e3,RATE_SYMBOL:"%",expandSchema$Ref:function(t){return t.definitions&&Object.keys(t.definitions).forEach(function(n){var i=t.definitions[n];if(i.allOf){var o=i.allOf;delete i.allOf,o.forEach(function(n){if(n.$ref){var o=$.extend(!0,{},C(n.$ref,t));delete n.$ref,n.ux&&(o.properties&&Object.keys(o.properties).forEach(function(e){var t=o.properties[e];void 0===t.ux&&(t.ux=!0)}),o.links&&Object.keys(o.links).forEach(function(e){var t=o.links[e];void 0===t.ux&&(t.ux=!0)})),c.merge(o,n)}e.utils.merge(n,i)})}}),w(t,[],t)},path2RulePath:function(e){var t=[];return e.split(".").forEach(function(e){"$"!==e.charAt(0)&&t.push(e)}),t.join(".")},_getDefault:function(e){return"@date"===e?s.date2ISO(new Date):e},checkLookup:function(e){return e?((e=$.extend({},e)).data&&"odata"==e.data.$type||(e.pagination=!1,e.cache=!0),!1!==e.pagination&&(e.pagination=!0),e.pagination&&(e.cache=!1),e):null},schema2Authoring:function(e,t,n){var i=[];return x(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(E.inModel(a,o)&&!E.isCompositionRef(a,o)){var l=e?e+"."+r:r,u={$type:"field",$bind:l,$title:s.tt(a.title,n)||l,$widget:a.$widget,options:a.$widgetOptions};i.push(u)}}),t.links&&Object.keys(t.links).forEach(function(o){var r=t.links[o],a="$links."+o,l={$type:"action",$bind:a=e?e+"."+a:a,$title:s.tt(r.title,n)||a,$widget:r.widget,options:r.$widgetOptions};i.push(l)}),!0)}),i},extractClassNames:function(e,t){var n={},i={};return x(e,t,"",!1,null,function(e,t,o,r,s,a){if(a.currentRef){if(i[a.currentRef])return!1;i[a.currentRef]=!0}if(t.name){if(n[t.name])return!1;n[t.name]=!0}return!0},{$references:!0}),Object.keys(n).length?n:null},expandRules:function(e,t){var n={rulesbyClass:{},rulesById:{}};return e.forEach(function(e){e.ruleType&&(e.triggers=e.triggers.split(",").map(function(e){return e.trim()}),e.id=c.allocID(),n.rulesById[e.id]=e,e.entities&&e.entities.forEach(function(i){t[i.entity]&&e.triggers.forEach(function(t){var o=e.ruleType;if("$events.created"===t?o="created":"$events.loaded"===t?o="loaded":"$events.saving"===t&&(o="saving"),n.rulesbyClass[o]=n.rulesbyClass[o]||{},"created"===o||"loaded"===o||"saving"===o)n.rulesbyClass[o][i.entity]=n.rulesbyClass[o][i.entity]||[],n.rulesbyClass[o][i.entity].push(e.id);else{var r=n.rulesbyClass[o][i.entity]=n.rulesbyClass[o][i.entity]||{};r[t]=r[t]||[],r[t].push(e.id)}})}))}),n},filtrableFields:function(e,t,n){var i=[];return x(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(E.inModel(a,o)&&!E.isCompositionRef(a,o)&&!E.isCompositionList(a,o,!0)){var l=e?e+"."+r:r;if(E.canFilter(a)){var u={name:l,schema:c.copy(a)};u.schema.title=s.tt(u.schema.title||"",n),i.push(u)}}}),!0)}),i},searchableFields:function(e,t,n){var i=[];return x(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(E.inModel(a,o)&&!E.isCompositionList(a,o,!0)){var l=e?e+"."+r:r;if(E.canSearch(a)){var u={name:l,schema:c.copy(a)};u.schema.title=s.tt(u.schema.title||"",n),i.push(u)}}}),!0)}),i},isFwField:function(e){return e.indexOf(t.EXPANDED_FIELD_NAME)>=0||v.indexOf(e)>=0},copyModel:function(e,t,n,i,o){var r={};return function e(t,n,i,o,r,s){Object.keys(i).forEach(function(a){var l=i[a];if(void 0!==l){var u=null;if(!t||r||!(u=t.properties[a])||!(u.$reference||u.$ux||u.ux))if(!u&&"$"===a.charAt(0)||"_"===a.charAt(0))s&&"$states"===a&&(o[a]=$.extend(!0,{},l));else if(u)if(!u.type&&u.$ref&&(u=y(u,n)),"object"===u.type)null===l?o[a]=null:(o[a]={},e(u,n,l,o[a],r));else{if("array"===u.type){var d=y(u.items,n);return null===l?void(o[a]=null):void("object"===d.type?void 0===l||(null===l?o[a]=null:(o[a]=new Array(l.length),l.forEach(function(t,i){var s={};o[a][i]=s,e(d,n,t,s,r)}))):o[a]=l.slice(0))}o[a]=l}else null===l?o[a]=null:Array.isArray(l)?(o[a]=new Array(l.length),l.forEach(function(t,i){if(null===t||void 0===t||"object"!=typeof t)o[a][i]=t;else{var s={};o[a][i]=s,e(null,n,t,s,r)}})):"object"==typeof l?(o[a]={},e(null,n,l,o[a],r)):o[a]=l}})}(e,n=n||e,t,r,i,o),r},columns:function(e,t,n){var i=[];return x(e,t,"",!1,null,function(e,t,o,r,a){return!a&&(Object.keys(t.properties).forEach(function(r){var a=t.properties[r];if(E.inModel(a,o)&&!E.isCompositionRef(a,o)&&!E.isCompositionList(a,o,!0)){var l=e?e+"."+r:r;if(E.canShowField(a)){var u={name:l,schema:c.copy(a)};u.schema.title=s.tt(u.schema.title||"",n),i.push(u)}}}),!0)}),i},allData:function(e){return!e.pagination||"relation"===e.data.$type},pkFields:function(e){return Array.isArray(e)?e:e.split(",").map(function(e){return e.trim()})},entityId:function(e){if("object"==typeof e){return Object.keys(e).map(function(t){var n=e[t];return"string"==typeof n?t+"='"+n+"'":t+"="+n}).join(",")}return"string"==typeof e?"'"+e+"'":e},extractPkValue:function(e,t){if(1==t.length)return e[t[0]];var n={};return t.forEach(function(t){n[t]=e[t]}),n},odataId:function(e,t){if(1==e.length)return t[e[0]];var n=[];return e.forEach(function(e){n.push(e+"="+encodeURIComponent(t[e]+""))}),n.join(",")},pk2Id:function(e,t){return 1===t.length?e:JSON.stringify(e)},id2Pk:function(e,t){return 1===t.length?e:JSON.parse(e)},equals:function(e,t,n){if(1===n.length)return e===t[n[0]];for(var i=0,o=n.length;i<o;i++){var r=n[i];if(e[r]!==t[r])return!1}return!0},extractBase:function(e){var t=e.split(".");return t.pop(),t.length?t.join(".")+".":""},parentPath:function(e){var t=e.split(".");return t.pop(),t.length?t.join("."):""},findByPk:function(e,t,n){if(n&&e)for(var i=0,o=n.length;i<o;i++){var r=n[i];if(E.equals(e,r,t))return r}return null},supportPagination:function(e){return!(!e.data||"odata"!==e.data.$type&&"relation"!==e.data.$type)},executeLookup:function(e,t,n,i){var o=e.data;if(o.$params&&n.containerId&&(o.$params.containerId=n.containerId),o.$params&&n.viewId&&(o.$params.viewId=n.viewId),o.$params&&n.selected&&(o.$params.selected=n.selected),n.paginated&&(n.findFirst||n.find)){o=$.extend(!0,{},e.data),n.search=(n.search||"")+"";var r=o.$params.$allData||"relation"==o.$type,s=null,a=l.config(l.name)||{},u=(o.$params.$type?a[o.$params.$type]:null)||a.odata||{},p=u.startswith||"startswith",h=u.caseSensitive||!1;if(!r)if(o.$params.$searchByFields&&o.$params.$searchByFields.fields&&o.$params.$searchByFields.fields.length){var f=[];for(o.$params.$searchByFields.fields.forEach(function(e){var t=e.replace(/\./g,"/"),i="'"+n.search.replace(/'/g,"''")+"'";h&&(t="tolower("+t+")",i="tolower("+i+")"),f.push({$left:p,$op:"$func",$right:t+", "+i})});f.length;){var m=f.shift();s=s?{$op:"or",$left:m,$right:s}:m}}else{var v=n.fieldName.replace(/\./g,"/"),g="'"+n.search.replace(/'/g,"''")+"'";h&&(v="tolower("+v+")",g="tolower("+g+")"),s={$left:p,$op:"$func",$right:v+", "+g}}if(r&&(s=null),s)if(o.$params.$filter){var y=o.$params.$filter;o.$params.$filter={$left:s,$op:"and",$right:y}}else o.$params.$filter=s;n.findFirst&&(r||(o.$params.$top=1),o.$params.nocount=!0)}var _=null;if("relation"===o.$type?(t={documents:t.getValue(o.$params.relation).model(!1)||[]},_=c.Promise.resolve(t)):_=d.execData(o,t,null),!i)return _;_?_.then(i):i(null)},remoteSearch:function(e,t){return t.mapping?t.mapping[e]:e},lastSegment:function(e,t){var n=e.split("."),i=n.pop();return t&&t!==e&&(i=t.substring(n.join(".").length)),i},hasProperty:function(e,t,n){for(var i=t,o=0,r=e.split(".");o<r.length;o++){var s=r[o];if("$"!==s.charAt(0)){if(!i.properties)return!1;if(!(i=i.properties[s]))return!1;!i.type&&i.$ref&&(i=y(i,n)),"array"===i.type&&(i=y(i.items,n))}}return!0},findFirst:function(e,t,n){if(!e||!n)return null;for(var i=e.toLocaleLowerCase(),o=i.length,r=null,s=0,a=n.length;s<a;s++){var l=(n[s][t]||"").toLowerCase();if(l.substr(0,o)===i)return{item:n[s],index:s};!r&&l.indexOf(i)>=0&&(r={item:n[s],index:s})}return r},_states:["$states","$links"],isMetaProp:function(e){return"$$"===e.substr(0,2)},isMeta:function(e){var t="$$meta-".length;return"$$meta-"===e.substr(0,"$$meta-".length)?{widget:e.substr(t)}:null},getLookup:function(e,t,n,i){var o=e.split(".");o.pop();for(var r=n,s=0,a=o.length;s<a&&r;s++){var l=o[s];E.arrayProps.indexOf(l)>=0||((r=r.properties?r.properties[l]:null)&&!r.type&&r.$ref&&(r=y(r,i)),r&&"array"===r.type&&(r=y(r.items,i)))}return r&&r.lookups?E.checkLookup(r.lookups[t]):null},getSchema:function(e,n,i,o){if(!e)return n;for(var r=e.split("."),s=n,a=!1,l=0,u=r.length;l<u&&s;l++){var d=r[l];if(!s.type&&s.$ref&&(s=y(s,i)),"array"==s.type&&E.arrayProps.indexOf(d)>=0)s=y(s.items,i);else if("$links"===d)s=s.links,a=!0;else{if(a){a=!1,(s=s[d]).isLink=!0;break}if(!(s=s.properties?s.properties[d]:null)&&l===u-1){if(d===t.INDEX_FIELD_NAME)return{type:"integer",title:"#",capabilities:null};if(d===t.SELECTED_FIELD_NAME)return{type:"boolean",title:p.ui.Selected,capabilities:null};if(d===t.EXPANDED_FIELD_NAME)return{type:"integer",title:"",capabilities:null}}}}return o&&s&&"array"===s.type&&s.items&&(s=y(s.items,i)),s},states:["isHidden","isDisabled","isReadOnly","isMandatory","style"],statesAndErrors:["isHidden","isDisabled","isReadOnly","isMandatory","errors","filter","symbol","decimals","style","search","selected","columns","orderBy","filter"],linksStates:["isHidden","isDisabled"],isLink:function(e){return e.split(".").indexOf("$links")>=0},_isMoney:function(e){return E.isNumber(e)&&"money"==e.format},_internalExtractEnums:function(e,t,n,i){if(e.name){if(i.indexOf(e.name)>=0)return;i.push(e.name)}var o=function(t,i){if((i=i||e).enums&&i.enums[t]){var o=i.enums[t].type||"default";n[o]=n[o]||{},n[o][t]=i.enums[t]}else{var r=t.split(".");2===r.length&&(n[r[1]]=n[r[1]]||{},n[r[1]][r[0]]={type:r[1]})}};e.lookups&&Object.keys(e.lookups).forEach(function(t){var n=e.lookups[t];"enum"===n.data.$type&&n.data.$enumref&&o(n.data.$enumref)}),Object.keys(e.properties).forEach(function(r){var s=e.properties[r];if(!s.type&&s.$ref&&(s=y(s,t)),E.inModel(s,t))if(E.isCompositionRef(s,t))E._internalExtractEnums(s,t,n,i);else if(E.isCompositionList(s,t,!0)){if(s.items.$ref){if(i.indexOf(s.items.$ref)>=0)return;i.push(s.items.$ref)}E._internalExtractEnums(y(s.items,t),t,n,i)}else{var a=e;E.isSimpleList(s,t)&&(a=s=y(s.items,t)),s.$enumref&&o(s.$enumref,a)}})},_extractEnums:function(e,t){return E._internalExtractEnums(e,e,t,[])},_fillEnumsFromData:function(e,t,n,i){e._id=e._id||c.allocID(),i.indexOf(e._id)>=0||(i.push(e._id),Object.keys(e.properties||{}).forEach(function(o){var r=e.properties[o];if(r.$ref&&!r.type&&(r=y(r,t)),E.inModel(r,t))if(E.isCompositionRef(r,t))E._fillEnumsFromData(r,t,n,i);else if(E.isCompositionList(r,t,!0))E._fillEnumsFromData(y(r.items,t),t,n,i);else{if(E.isSimpleList(r,t)&&(r=y(r.items,t)),r.enum&&!Array.isArray(r.enum)&&r.enum.arrayProperty&&r.enum.code&&r.enum.title){var s=c.getValue(n,r.enum.arrayProperty),a=[],l=[];Array.isArray(s)&&s.forEach(function(e){a.push(e[r.enum.code]),l.push(e[r.enum.title])}),r.enum=a,r.enumNames=l}}}))},fillEnumsFromData:function(e,t){E._fillEnumsFromData(e,e,t,[])},_fillEnums:function(e,t){E._internalFillEnums(e,e,t,[])},_internalFillEnums:function(e,t,n,i){if(e.name){if(i.indexOf(e.name)>=0)return;i.push(e.name)}e.lookups&&Object.keys(e.lookups).forEach(function(t){var i=e.lookups[t];if("enum"==i.data.$type&&i.data.$enumref){var o=i.data.$enumref.split("."),r=2===o.length?n[o[1]]:n[e.enums[i.data.$enumref].type||"default"],s=2===o.length?o[0]:i.data.$enumref;if(r){i.data.$value=[];var a=r[s];a.enum.forEach(function(e,t){var n={code:e,title:a.enumNames[t]};a.fields&&c.extend(n,a.fields[t]),i.data.$value.push(n)})}}}),Object.keys(e.properties).forEach(function(o){var r=e.properties[o];if(r.$ref&&!r.type&&(r=y(r.items,t)),E.inModel(r,t))if(E.isCompositionRef(r,t))E._internalFillEnums(r,t,n,i);else if(E.isCompositionList(r,t,!0))E._internalFillEnums(y(r.items,t),t,n,i);else{var s=e;if(E.isSimpleList(r,t)&&(s=r=y(r.items,t)),r.$enumref){var a=r.$enumref.split(".");if(s.enums&&s.enums[r.$enumref]||2===a.length){var l=2===a.length?n[a[1]]:n[s.enums[r.$enumref].type||"default"],u=2===a.length?a[0]:r.$enumref;if(l){var d=l[u];d&&(r.enum=d.enum,r.enumNames=d.enumNames,r.filters=d.filters)}}}}})},loadEnums:function(e){var t={};E._extractEnums(e,t);var n=Object.keys(t).map(function(e){var n=b.get(e);if(!n)throw"Invalid enum type: "+e;return n.promise(t[e],e)});return n.length?n:null},arrayProps:["$item","$new","$selected"],init:function(e,t,n,i,o,r){if(null===i)return i;var s=i||{};return s._schema_initialized?s:(s._schema_initialized=!0,s.$create=o,s.$states=s.$states||{},Object.keys(e.properties).forEach(function(i){var a=e.properties[i];if(!a.type&&a.$ref&&(a=y(a,t)),E.inModel(a,t)){var l=E.isMetaProp(i),u=e.states?e.states[i]:null,d=s.$states[i]=s.$states[i]||{};if(l||u&&Object.keys(u).forEach(function(e){void 0===d[e]&&(d[e]=u[e])}),E.isCompositionRef(a,t))s[i]=E.init(a,t,n,null===s[i]?null:s[i]||{},o,{children:r.children,select:r.select});else if(E.isCompositionList(a,t,!1)){s[i]=s[i]||[];var c=r.select&&(!a.children||a.children!==r.children),p={children:a.children,select:r.select},h=y(a.items,t),f=null,m=s.$states?s.$states[i]:null,v=null;m&&m.selected&&(v=JSON.parse("["+m.selected+"]")),s[i].forEach(function(e,i){e.id&&v&&v.indexOf(e.id)>=0&&(e.$select=!0),c&&0===i&&void 0===e.$select&&(f=e),e.$select&&(f=null),E.init(h,t,n,e,o,p)}),f&&!a.syncSelected&&!1!==a.autoSelect&&(f.$select=!0),m&&delete m.selected}else if(E.isSimpleList(a,t));else if(E.isList(a,t));else if(o&&void 0===s[i])if(void 0!==a.default&&null!==a.default)s[i]=E._getDefault(a.default);else if(a.enum)s[i]=a.enum[0];else switch(a.type){case"number":case"integer":void 0!==a.default&&(s[i]=a.default)}}}),s)},isCompositionRef:function(e,t){return!e.type&&e.$ref&&(e=y(e,t)),"object"===e.type&&!e.$reference},isRef:function(e,t){return"object"===e.type&&e.$reference},isList:function(e,t){return!e.type&&e.$ref&&(e=y(e,t)),"array"===e.type&&e.$reference},isCompositionList:function(e,t,n){if(!e.type&&e.$ref&&(e=y(e,t)),"array"===e.type&&e.items){var i=y(e.items,t);return("object"===i.type||"array"===i.type)&&(!e.$reference||n&&e.$reference)}return!1},isSimpleList:function(e,t){if(!e.type&&e.$ref&&(e=y(e,t)),"array"===e.type&&e.items){var n=y(e.items,t);return("object"!==n.type||"array"===n.type)&&!e.$reference}return!1},inModel:function(e,t){return!E.isRef(e,t)},formatNumber:function(e,t){return"money"==e.format?s.money(t,!1):s.decimal(t,e.decimals||0,null)},_title:function(e,t){return t?s.tt(e,t):e},canSort:function(e){return!!e&&(!e.isLink&&(!e.hidden&&(g(e),e.features.sortable)))},canShowField:function(e){return!e.hidden},canFilter:function(e){return!!e&&(!e.hidden&&(g(e),e.features.filtrable))},canSearch:function(e){return!!e&&(!e.hidden&&(g(e),e.features.searchable))},checkNumber:function(e,t,n,i){var o=!0;return e=e||0,t.exclusiveMinimum?void 0!=t.minimum&&e<=t.minimum&&(i.push({message:c.format(f.minNumberExclusive,E._title(t.title,n),E.formatNumber(t,t.minimum))}),o=!1):void 0!=t.minimum&&e<t.minimum&&(i.push({message:c.format(f.minNumber,E._title(t.title,n),E.formatNumber(t,t.minimum))}),o=!1),t.exclusiveMaximum?void 0!=t.maximum&&e>=t.maximum&&(i.push({message:c.format(f.maxNumberExclusive,E._title(t.title,n),E.formatNumber(t,t.maximum))}),o=!1):void 0!=t.maximum&&e>t.maximum&&(i.push({message:c.format(f.maxNumber,E._title(t.title,n),E.formatNumber(t,t.maximum))}),o=!1),o},_validateEmail:function(e,t){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)},_validateJson:function(e,t){try{JSON.parse(e)}catch(e){return t.ex=e,!1}return!0},checkString:function(e,t,n,i,o){var r=!0,s=e||"";if(n.minLength&&s.length<n.minLength&&(o.push({message:c.format(f.minLength,E._title(n.title,i),n.minLength)}),r=!1),t.isMandatory&&""===s&&(o.push({message:c.format(f.required,E._title(n.title,i))}),r=!1),n.format)if("email"===n.format)e&&!E._validateEmail(e,{})&&(o.push({message:f.invalidEmail}),r=!1);else if("json"===n.format){var a={};e&&!E._validateJson(e,a)&&(o.push({message:a.ex.message}),r=!1)}return r},validatePassword:function(e,t,n,i,o,r){var s=!0;return i.isHidden||i.isDisabled?s:(e!==t&&(r.push({message:f.passwordMismatch}),s=!1),s)},validateSchema:function(e,t,n,i,o,r){var s=!0;if(t){if(n&&(n.isHidden||n.isDisabled))return s;switch(t.type){case"number":case"integer":s=E.checkNumber(e,t,i,o);break;case"string":s=E.checkString(e,n,t,i,o)}return s}},loadEnumsPromise:function(e){var t=E.loadEnums(e);return t?c.Promise.all(t).then(function(t){var n={};return t.forEach(function(e){n[e.type]=e.enums}),E._fillEnums(e,n),e}):new c.Promise(function(t,n){t(e)})},loadSchemaRefs:function(t,n,i,o,r){if(!t)return r(null,null);var s=function(){try{E.expandSchema$Ref(t);var s=-1,l=E.loadEnums(t),d=l||[],p=l?l.length:0,h=n;o&&((h=h||{}).model=o);var f=O.loadMainData({datasets:i.datasets,transform:i.transform,context:h},!0);f&&d.push(f);var m=f?p+1:0,v=E.extractClassNames(t,t);if(v&&t.loadRules&&e.external.ruleLoaderHandler&&(d.push(a.ruleLoaderHandler(Object.keys(v))),s=d.length-1),!d.length)return r(null,n);u.processing(!0),c.Promise.all(d).then(function(e){u.processing(!1);var i={},o=null;if(e.forEach(function(t,r){r<p?i[t.type]=t.enums:r<m&&$.extend(n,t),r===s&&(o=e[s])}),t.rules&&(o=o?o.concat(t.rules):t.rules),o&&o.length){var a=E.expandRules(o,v);t.rules=a.rulesbyClass,t.rulesMap=a.rulesById}else delete t.rules;p&&E._fillEnums(t,i),r(null,n)}).catch(function(e){u.processing(!1),r(e,null)})}catch(e){r(e,null)}},l=i.before?h.get(i.before):null;l?l().then(function(){s()}).catch(function(e){r(e,null)}):s()},stateProps:function(e){return e.enum&&e.filters?["filter"]:e.items&&e.items.enum&&e.items.filters?["filter"]:E.isNumber(e)?["symbol","decimals"]:"array"===e.type&&e.items&&"object"===e.items.type&&!e.items.$reference?["orderBy","selected","filter","search","columns"]:void 0},isPassword:function(e){return"string"===e.type&&"password"===e.format},isDate:function(e){return"string"===e.type&&"date"===e.format},isDateTime:function(e){return"string"===e.type&&"date-time"===e.format},isBoolean:function(e){return"boolean"===e.type},isSelectField:function(e){return e===t.SELECTED_FIELD_NAME},isExpandField:function(e){return e===t.EXPANDED_FIELD_NAME},isNumber:function(e){return"number"===e.type||"integer"===e.type},isText:function(e){return"string"===e.type&&("json"===e.format||"memo"===e.format)},isMoney:function(e){return E.isNumber(e)&&"money"===e.format},hasSymbol:function(e){return E.isNumber(e)&&("money"===e.format||"rate"===e.format||e.symbol)},text2Value:function(e,t,n){if(E.isNumber(t)){var i=n.decimals,o="number"==typeof e?e:s.string2Float(e||"");return o=parseFloat(o.toFixed(i))}if("string"!==t.type||""!==e&&null!==e)return e},value2Text:function(e,t,n){return E.isNumber(t)?s.decimal(e,n.decimals,null):e||""},expand$Ref:function(e,t){return y(e,t)},parsePath:function(e,t,n){var i=t.substr(e.length+1),o=i.split("."),r=o.shift();if(!n)return e+"."+r;i=o.join(".");for(var s=[e,r],a=n+".$item.",l=a.length,u=n+".$selected.",d=a.length;;)if(i.substr(0,l)===a)s.push(n+".$item"),i=i.substr(l);else{if(i.substr(0,d)!==u)break;s.push(n+".$selected"),i=i.substr(d)}return i===n&&s.push(i),s.join(".")},registerValidator:_.register,getValidator:_.get,registerEnumManager:b.register,getEnumManager:b.get},O={extractDatasets:function(e,t){if(e.datasets){var n=Object.keys(e.datasets);if(n.length){var i=[];return n.forEach(function(n){var o=e.datasets[n];if(!t||!1!==o.$autoOpen){var r=$.extend({},o,!0);r.name=n,i.push(r)}}),i}}return null},isQuery:function(e){return!("odata"!==e.$type&&"relation"!==e.$type||e.$method&&"GET"!==e.$method.toUpperCase()||e.$params.hasOwnProperty("$entityId"))},isCreateOrUpdate:function(e){return"odata"===e.$type&&e.$params.hasOwnProperty("$entityId")},extractMainDataSource:function(e){var t=null;if(e.datasets){var n=Object.keys(e.datasets);n.length&&(n.forEach(function(n){e.datasets[n].$main&&((t=$.extend({},e.datasets[n],!0)).name=n)}),t||((t=$.extend({},e.datasets[n[0]],!0)).name=n[0]))}return t},datasetsAsPromise:function(e,t,n){return new c.Promise(function(i,o){var r={};u.processing(!0);var s=null,a=[];e.forEach(function(e){e.$main&&(s=e)}),s||((s=e[0]).$main=!0),s.children&&Object.keys(s.children).forEach(function(e){s.children[e].name=e,a.push(s.children[e])}),O.isCreateOrUpdate(s)&&(s.$create=s.$create||{}),m.executeDatasets(e,n||{},r,{},function(e,n){if(u.processing(!1),n)o(n);else{var l=$.extend({},r[s.name]||{});if(l.$datasets=r,a&&a.length){u.processing(!0);var c={};return m.executeDatasets(a,l,c,{},function(e,n){if(delete l.$datasets,l=void 0,u.processing(!1),Object.keys(c).forEach(function(e){r[e]=c[e]}),d.execOutputData(s,r),t){var o=h.get("datasets.transform."+t);o&&o(r)}i(r[s.name])},!1)}if(d.execOutputData(s,r),t){var p=h.get("datasets.transform."+t);p&&p(r)}i(r[s.name])}})})},datasetAsPromise:function(e,t){return new c.Promise(function(n,i){var o={};e.name=e.name||"data",u.processing(!0),m.executeDatasets([e],t||{},o,{},function(t,r){u.processing(!1),r?i(r):n(o[e.name])})})},loadMainData:function(e,t){var n=O.extractDatasets(e,t);return n&&n.length?O.datasetsAsPromise(n,e.transform,e.context):c.Promise.resolve(null)},dsConfig:function(e,t,n){var i=t.$reference;if(e&&i){var o=Object.keys(e);if(1===o.length){var r=e[o[0]];return r.$main=!0,r.name=o[0],r}if("string"==typeof i){var s=e[i];return s.name=i,s}}return null}},S={_enums:{},promise:function(e,t){var n={};return Object.keys(e).forEach(function(t){var i=e[t];S._enums[t]||(S._enums[t]={enum:i.enum,enumNames:i.enumNames,filters:i.filters}),n[t]=S._enums[t]}),new c.Promise(function(e,i){e({type:t,enums:n})})}};E.registerEnumManager("default",S),t.SchemaUtils=E,t.DataUtils=O}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,o=i.pagecontrol,r=i.Observable.SchemaUtils,s=i.utils,a=i.dom;t=e.formdropitems||(e.formdropitems={}),n=function(){function e(e,t,n){this.opened=!1;var i=this;i.page=o.Page(),i.opened=!1,i.currentList=null,i.$parent=e,i._checkOptions(n),i.options=n,i.$input=t,i.keys=r.pkFields(i.options.primaryKey)}return e.prototype.click=function(e){var t=i.bootstrap4,n=a.parentByTag(this.$element.get(0),e.target,t?"a":"li");if(n){var o=n.pk;if(o){var r=this._map(),s=this._selectByPk(o,r);s&&this._doSelect(s,!0)}}},e.prototype.inMenu=function(e){return!(!e||!this.$element)&&a.isChildOf(this.$element.get(0),e)},e._itemHeight=function(){if(!this.itemHeight){var e=void 0;e=i.bootstrap4?$('<div class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><a tabindex="-1" class="dropdown-item" href="#">A</a></div>').get(0):$('<ul class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><li tabindex="-1"><a tabindex="-1" href="#">A</a></li></ul>').get(0),document.body.appendChild(e);var t=e.firstChild;this.itemHeight=t.offsetHeight,this.deltaHeight=e.offsetHeight-this.itemHeight,document.body.removeChild(e)}return this.itemHeight},e.prototype._checkOptions=function(e){if(!e.primaryKey)throw new Error("Invalid options no primaryKey.");if(!e.search)throw new Error("Invalid options search field.");e.display=e.display||e.search,e.maxItems=e.maxItems||8},e.prototype._renderContent=function(){var e=i.bootstrap4;this.$element||(this.$element=e?$('<div class="dropdown-menu"></div>'):$('<ul class="dropdown-menu"></ul>'),this.$parent.get(0).appendChild(this.$element.get(0)))},e.prototype._renderElements=function(){var e=this,t=i.bootstrap4;if(e.$element||e._renderContent(),e.currentList){var n=document.createDocumentFragment(),o=e.$element.get(0);e.currentList.forEach(function(i){var o,l=r.pk2Id(r.extractPkValue(i,e.keys),e.keys);(o=t?$('<a tabindex="-1" class="dropdown-item" href="#">'+s.escapeHtml(i[e.options.display])+"</a>").get(0):$('<li class="dropdown-item" tabindex="-1"><a tabindex="-1" href="#">'+s.escapeHtml(i[e.options.display])+"</a></li>").get(0)).pk=l,a.append(n,o)}),a.empty(o),a.append(o,n)}},e.prototype._afterHide=function(e){var t=this;t.opened=!1,t.page&&t.page.setPopup(null),t.$input&&t.$input.get(0).focus()},e.prototype.hide=function(e){var t=this;if(t.opened&&t.$element){var n=t.$element.get(0);a.removeClass(n,"bs-block"),t.opened=!1,t.page&&t.page.setPopup(null)}},e.prototype._selectByListIndex=function(e,t){for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o.listIndex===t)return o}return null},e.prototype._emptyHtmlList=function(){this.$element&&a.empty(this.$element.get(0))},e.prototype._show=function(t){var n=this;if(n.$element){var i=n.$element.get(0);if(i.childNodes.length){var o=-1,r=n._map(),s=n._findSeleted(r);s&&(o=s.listIndex);var l=n.$parent.get(0).offsetWidth;if(i.style.minWidth=l+"px",i.style.maxHeight=n.options.maxItems*e._itemHeight()+e.deltaHeight+"px",i.style.overflowY="auto",a.addClass(i,"bs-block"),o!=t){if(s){var u=i.childNodes[s.index];a.removeClass(u,"active"),s.selected=!1}if(t>=0){s=n._selectByListIndex(r,t);var d=i.childNodes[s.index];a.addClass(d,"active"),s.selected=!0,n._isInView(d,i)||d.scrollIntoView(!0)}else i.scrollTop=0}n.page&&n.page.popup!=n&&n.page.setPopup(n),a.addClass(i,"bs-block"),n.opened=!0}else a.removeClass(i,"bs-block"),n._afterHide(!0)}},e.prototype.triggerBlurred=function(e){this.hide(null)},e.prototype.show=function(e,t,n){var i=this;if(!(e&&e.value&&e.value.length))return i.currentList=null,i.hide(null),void i._emptyHtmlList();i.currentList==e.value?i._show(t):(i.currentList=e.value,i._renderElements(),i._show(t))},e.prototype._map=function(){for(var e=[],t=!1,n=this.$element.get(0),i=0,o=0,r=n.childNodes.length;o<r;o++){var s=n.childNodes[o];if(s.pk){var l=!t&&a.hasClass(s,"active");l&&(t=!0),e.push({id:s.pk,index:o,selected:l,listIndex:i}),i++}}return e},e.prototype._selectByPk=function(e,t){for(var n=null,i=this.$element.get(0),o=0,r=(t=t||this._map()).length;o<r;o++){var s=t[o];if(s.id===e){if(n=s,s.selected)break;a.addClass(i.childNodes[s.index],"active"),s.selected=!0}else if(s.selected&&(a.removeClass(i.childNodes[s.index],"active"),s.selected=!1,n))break}return n},e.prototype._findSeleted=function(e){for(var t=0,n=(e=e||this._map()).length;t<n;t++){var i=e[t];if(i.selected)return i}return null},e.prototype._isInView=function(t,n){var i=t.offsetTop,o=t.offsetHeight,r=n.scrollTop,s=this.options.maxItems*e._itemHeight();return i>=r&&r+s>=i+o},e.prototype.move=function(t){var n=this;if(n.$element&&n.opened){var i=n._map(),o=n.$element.get(0),r=n._findSeleted(i),s=void 0;if(t>0){if(r){if((s=1e3===t?i.length-1:i.indexOf(r)+t)>=i.length&&i[s=i.length-1].selected)return}else s=0;if(s<i.length){r&&(a.removeClass(o.childNodes[r.index],"active"),r.selected=!1);var l=o.childNodes[i[s].index];a.addClass(l,"active"),i[s].selected=!0,s==i.length-1?o.scrollTop=l.offsetTop+e._itemHeight()+1:n._isInView(l,o)||l.scrollIntoView(!1),n._doSelect(i[s],!1)}}else{if(r){if((s=-1e3===t?0:i.indexOf(r)+t)<0&&i[s=0].selected)return}else s=i.length-1;if(s>=0){r&&(a.removeClass(o.childNodes[r.index],"active"),r.selected=!1);l=o.childNodes[i[s].index];a.addClass(l,"active"),i[s].selected=!0,0==s?o.scrollTop=0:n._isInView(l,o)||l.scrollIntoView(!0),n._doSelect(i[s],!1)}}}},e.prototype.select=function(){if(this.$element&&this.opened){var e=this._findSeleted();e&&this._doSelect(e,!0)}},e.prototype._doSelect=function(e,t){var n=this;t&&(n.options.onselect&&n.options.onselect(r.findByPk(r.id2Pk(e.id,n.keys),n.keys,n.currentList)),n.hide(null))},e.prototype.inPopup=function(e){if(this.$element){var t=this.$element.get(0).parentNode;return a.isChildOf(t,e)}return!1},e.prototype.destroy=function(){var e=this;e.options=null,e.currentList=null,e.$input=null,e.$parent=null,e.$element=null},e.itemHeight=0,e.deltaHeight=0,e}(),t.DropItems=n}(Phoenix||(Phoenix={})),function(e){var t,n,i,o=e,r=o.link,s=(o.menubase,o.preferences),a=o.application,l=o.device,u=o.utils,d=o.locale,c=e.contextmenu,p=o.dom;t=e.menu||(e.menu={}),n=function(e){var t=["bs-menu-right-icon normal"];return e.collapsed?t.push(p.iconClass("plus")):t.push(p.iconClass("minus")),t.join(" ")},i=function(t){function i(e,n){var i=t.call(this,e,n)||this;return i.id=u.allocID(),i}return __extends(i,t),i.prototype._checkSearchPopupMenu=function(){if(!this._menu){var t=this._searchInput();if(!t)return;var n=$(t.parentNode);this._menu=new e.formdropitems.DropItems(n,t,{primaryKey:"id",search:"title"})}},i.prototype._searchInput=function(){return this.$element?p.find(this.$element.get(0),this.id+"_search"):null},i.prototype._initOptions=function(e){a.configuration=a.configuration||{};var t=a.configuration.header||{};(e=e||{}).typeMenu=e.typeMenu||"left",e.replaceParent=!0,e.canStayInPage=!!e.inline||!l.phone&&!l.tablet,e.autoClose=!e.inline&&(!e.canStayInPage||s("menu_"+e.type+"_autoClose")),void 0===e.autoClose&&(e.autoClose=!0),e.auth=void 0===t.authLeftMenu||t.authLeftMenu,t["menu"+e.typeMenu]&&u.merge(t["menu"+e.typeMenu],e),e.styles=e.styles||{root:"$upper",parent:"",leaf:""},e.canExpandItems=!0},i.prototype._updateSearch=function(){},i.prototype._hideContent=function(e){var t=this,n=t.$content.get(0);if(t.options.bodyId){var i=p.find(null,t.options.bodyId);i&&p.removeClass(i,"bs-pc-body-"+t.options.typeMenu)}p.removeClass(n,"bs-menu-opened"),p.addClass(n,"bs-menu-closed"),t.options.bodyId&&(!t.options.autoClose||e&&t.options.autoClose)&&u.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},i.prototype._showContent=function(){var e=this,t=e.$content.get(0),n=!1;if(e.options.bodyId&&!e.options.autoClose){n=!0;var i=p.find(null,e.options.bodyId);i&&p.addClass(i,"bs-pc-body-"+e.options.typeMenu)}p.removeClass(t,"bs-menu-closed"),p.addClass(t,"bs-menu-opened"),e.options.canStayInPage?p.addClass(t,"large"):p.addClass(t,"phone"),n&&u.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},i.prototype._switchAutoClose=function(){var e=this,t=!s("menu_"+e.options.type+"_autoClose");return s("menu_"+e.options.type+"_autoClose",t),e.options.autoClose=t,e.options.autoClose?e.page.setPopup(e):e.page.popup=null,e._updateCloseButton(e.$content)},i.prototype._doCloseClick=function(){var e=this;e.options.canStayInPage?(e._switchAutoClose()?e.hide(!0):e._showContent(),e.page.props["$menu"+e.options.typeMenu]=e.options.autoClose):e.hide()},i.prototype.copyMenuItemData=function(e,t){e.$icon=t.$icon},i.prototype._updateCloseButton=function(e){var t=!1,n=e.get(0),i=p.query(n,".bs-menu-button");if(i)return this.options.canStayInPage?(p.removeClass(i,p.iconClass("times",!0)),this.options.autoClose?(p.removeClass(i,p.iconClass("times-circle-o",!0)),p.addClass(i,"small"),p.addClass(i,p.iconClass("thumb-tack",!0)),t=!0):(p.removeClass(i,p.iconClass("thumb-tack",!0)),p.removeClass(i,"small"),p.addClass(i,p.iconClass("times-circle-o",!0))),p.removeClass(i,"bs-none")):(p.removeClass(i,p.iconClass("thumb-tack",!0)),p.removeClass(i,p.iconClass("times-circle-o",!0)),p.addClass(i,p.iconClass("times",!0)),p.removeClass(i,"bs-none")),t},i.prototype.renderContent=function(){var e=this.options,t=$('<div class="bs-menu-wrap bs-scrollbar bs-menu-closed bs-menu-'+e.typeMenu+'-wrap"></div>'),n=t.get(0);e.inline&&p.addClass(n,"parent");var i=this.page.childByType("header");if(i&&i.$element){var o=p.offset(i.$element.get(0));l.phone||l.tablet||(p.supportCssCalc()?(n.style.top=o.height+"px",n.style.height="calc(100% -  "+o.height+"px)"):n.style.paddingTop=o.height+"px",n.style.zIndex="1000")}return t},i.prototype._changeSelected=function(e){if(this.$element)for(var t=e;t;){var n=p.find(this.$element.get(0),t.$id);n&&(e.selected?p.addClass(n,"active"):p.removeClass(n,"active")),t=this._map[t.$parentId]}},i.prototype._selectDatasetItem=function(e,t){var n=this,i=null;n.items.forEach(function(o){o.$dataset===e&&(o===t?o.selected||(o.selected=!0,n._changeSelected(o)):o.selected&&(o.selected=!1,n._changeSelected(o),i=o))}),n._expandSelected(i)},i.prototype._expandSelected=function(e){for(var t=this,n=[],i={},o=e;o;)n.push(o),i[o.$id]=!0,o.collapsed=!1,o=t._map[o.$parentId];t.items.forEach(function(e){e.collapsed||i[e.$id]||(e.collapsed=!0)}),t.updateItemsAfterCollapse();var r=n.reverse().map(function(e){return e.$title});t.data&&t.data.$moduleTitle&&r.unshift(t.data.$moduleTitle);var s=t.page.childByType("header");s&&s.setLocation(r.join(" - "),!1)},i.prototype._canClick=function(e){return e.$link},i.prototype.render=function(e){t.prototype.render.call(this,e),this._onPageChanged()},i.prototype.renderItems=function(){var e=this,t=$('<ul class="bs-item-list"></ul>'),i=t.get(0),o=$('<li class="link"><a><span class="title"></span></a></li>').get(0),r=$('<li class="parent"><span class="title"></span></li>').get(0),s=($('<li class="parent"><span class="title"></span></li>').get(0),$('<li class="divider"><span class="title"></span></li>').get(0));if(e.items){var a=e.items.length;e.items.forEach(function(t,l){if(!t.isHidden){var u;if(t.divider)u=s.cloneNode(!0),p.text(u.firstChild,t.$title||String.fromCharCode(160));else{var d=e.options.canExpandItems&&t.$items&&t.$items.length,c=!1,h="";if(l<a-1){var f=e.items[l+1];c=(f.$level||0)>(t.$level||0)&&!f.$parentId}var m=!!t.$link;if(u=m||d?o.cloneNode(!0):r.cloneNode(!0),t.$items?(h=t.$parentId?"parent":"root",p.addClass(u,"bs-menu-item-parent")):t.$parentId&&(h="leaf"),t.$level?(t.$parentId||p.addClass(u,"level"),p.addClass(u,"level-"+t.$level)):c&&p.addClass(u,"level"),h){var v=null;if(e.options.styles&&e.options.styles[h]&&(v=e.options.styles[h]),v){var g=[];p.parseStyle(v,g),g.length&&(u.className=u.className+" "+g.join(" "))}}var y=u.firstChild,_=m||d?y.firstChild:y;if(t.$title){var $=t.$icon?" "+t.$title:t.$title;p.text(_,$)}if(t.selected&&p.addClass(u,"active"),m&&(p.attr(y,"data-phoenix-href","click://"+l),e._canClick(t)||p.removeClass(y,"link")),e.options.canExpandItems){if(d){p.attr(u,"data-phoenix-href","click://collapse/"+l);var b=document.createElement("span");b.id=t.$id+"_collapse",b.className=n(t),p.append(u,b)}e.isVisible(t)||(p.addClass(u,"closed"),u.style.height="0px")}if(t.$icon){var x=p.icon(t.$icon);p.addClass(x,"bs-icon-menu"),y.insertBefore(x,y.firstChild)}}if(t.$firstGroup&&!e.options.inline){var C=document.createElement("span");C.className="bs-menu-button bs-menu-right-icon bs-none "+p.iconPrefix(),p.attr(C,"data-phoenix-href","click://close"),p.append(u,C)}u.id=t.$id,i.appendChild(u)}})}return e._updateCloseButton(t),t},i.prototype.updateItemsAfterCollapse=function(){var e=this;e.$element&&e.items&&e.options.canExpandItems&&e.items.forEach(function(t,i){if(!t.isHidden){var o=t.$items&&t.$items.length,r=e.isVisible(t),s=p.find(e.$element.get(0),t.$id);if(s){if(r!==!p.hasClass(s,"closed"))if(r){var a=window.getComputedStyle(s,null).getPropertyValue("line-height");p.removeClass(s,"closed"),s.style.height=a}else p.addClass(s,"closed"),s.style.height="0px";if(o){var l=p.find(e.$element.get(0),t.$id+"_collapse");if(l){var u=n(t);l.className!==u&&(l.className=u)}}}}})},i.prototype._executeLink=function(e,t){var n,i=r.context();if(e.$dataset&&(n=this.datasets[e.$dataset],i.$item=e.$item),n&&e.$link&&e.$link.$datasetSelect)n.selectedIndex!=e.$index&&(n.selectedIndex=e.$index,this.ds_select(e.$dataset,e.$item),this._selectDatasetItem(e.$dataset,e));else if(e.$link)return r.execLink(e.$link,i,null)},i.prototype._executeContextMenu=function(e,t,n){if(t.$link&&t.$link.$page){var i=[{link:$.extend(!0,{},t.$link),title:d.ui.OpenNewTab}];return c.openContextMenu(e,this,i),!0}return!1},i.prototype.contextMenu=function(e){if(e.link){var t=r.context();t.$target="blank",r.execLink(e.link,t,null)}},i.prototype._onPageChanged=function(){var e={page:this.page.currentPage(),module:a.name};this.search="",this.selectItem(e)},i.prototype.selectItem=function(e){var t=this,n=e&&"object"==typeof e&&e.page;if(t.items){var i=null;t.items.forEach(function(o,s){if(o.$link){var a=!1;if(n&&o.$link.$page){(a=r.pageName(o.$link)===e.page)&&o.$link.$module&&(a=o.$link.$module===e.module)}else{var l=r.getLinkExecutor(o.$link);l&&(a=l.equal(e,o.$link))}o.selected!==a&&(o.selected=a,o.selected||t._changeSelected(o)),a&&(i=o)}}),i&&(t._changeSelected(i),t._expandSelected(i))}},i}(e.menubase.MenuBase),t.Menu=i,t.Menuleft=i,t.Menuright=i}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c,p,h;t=e.ui||(e.ui={}),i=(n=e).pagecontrol,n.external,o=n.ulocale,r=n.utils,s=n.locale,n.ajax,a=n.dom,l=n.sticky,n.ui,u=n.build,d=n.application,n.render,c=n.link,p=function(e,t){var i=document.createDocumentFragment(),r=n.bootstrap4,l=$(r?'<a class="dropdown-item" href="#"></a>':'<li><a href="#"></a><li>').get(0);e.menu.items.forEach(function(t,n){var u;t.$pattern&&(e.menu.items[n]=("logout"===(u=t).$pattern&&(u.icon="lock",u.title=s.ui.Disconnect,u.link={$logout:!0},delete u.$pattern),u),t=e.menu.items[n]);var d=l.cloneNode(!0),c=r?d:d.firstChild;if(a.attr(c,"data-phoenix-href","click://"+e.$index+"/"+n),t.icon){var p=document.createElement("span");p.className=a.iconClass(t.icon),a.append(c,p)}var h=t.title;"object"==typeof t.title&&(h=t.title[o.currentLang]),a.text(c," "+(h||"Error: title not defined")),a.append(i,d)}),a.append(t,i)},h=function(){function e(e,t){this._init(e,t)}return e.prototype.setLocation=function(e,t){var n=this;n.options.showLocation&&(n._locationTimeOut&&window.clearTimeout(n._locationTimeOut),n._locationTimeOut=window.setTimeout(function(){n._locationTimeOut=0,n._location!==e&&(n._location=e||"",n.$location&&a.text(n.$location.get(0).lastChild,n._location))},100))},e.prototype._init=function(e,t){var n=this;n.title="",n._ctx=c.context(),n._ignoreClick=!1,n.leftButtonsSpace=0,n.rightButtonsSpace=0,n.$location=null,n.$element=null,n.$buttons=[],n.options=t||{},n.page=i.Page(),n.title=d.title||"";var o=d.configuration,r=o&&o.header?o.header:{};if(void 0!==n.options.showOnDisconnected?n.options.showOnDisconnected=n.options.showOnDisconnected:n.options.showOnDisconnected=r.alwaysShow,void 0!==r.showLocation&&(n.options.showLocation=r.showLocation),void 0!==r.leftMenuButtonInLocation&&(n.options.leftMenuButtonInLocation=r.leftMenuButtonInLocation),void 0===n.options.backButton&&(n.options.backButton=!0),void 0===n.options.leftMenuButton&&(n.options.leftMenuButton=!0),void 0===n.options.topMenuButton&&(n.options.topMenuButton=!0),void 0===n.options.disconnectButton&&(n.options.disconnectButton=!0),r.logo){var s={$isHidden:!1,$type:"logo"},a="";"string"==typeof r.logo?a=r.logo:(a=r.logo.style,s.link=r.logo.link),s.$className=a,n.$buttons.push(s)}r.buttons&&r.buttons.before&&r.buttons.before.forEach(function(e){n.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),n.options.backButton&&n.$buttons.push({$icon:"chevron-left",$isHidden:!n.page.props.$hasBack&&!n.options._alwaysShowBack,$type:"back",link:{$back:!0}}),n.options.leftMenuButton&&n.$buttons.push({auth:r.authLeftMenu,$isHidden:!0,$icon:"bars",$type:"menuleft",$parent:n.options.leftMenuPlace,$location:n.options.showLocation&&n.options.leftMenuButtonInLocation}),n.options.disconnectButton&&(r.userMenu?n.$buttons.push({$icon:"user",iconStyle:"$icon-normal",right:!0,auth:!0,menu:$.extend(!0,{},r.userMenu),expression:r.userMenu.expression||"John Doe",$type:"user"}):n.$buttons.push({$icon:"power-off",right:!0,auth:!0,$type:"disconnect",link:{$logout:!0}})),n.$buttons.push({$icon:"pencil",right:!0,auth:!0,$isHidden:u.release,$type:"authoring",link:{$authoring:!0}}),u.release||n.$buttons.push({$icon:"cog",title:"Utils",right:!0,auth:!0,menu:{items:[{title:"Create a new form",icon:"building",link:{$action:{name:"phoenix.action.createform"}}},{title:"Modify form schema",icon:"pencil",link:{$action:{name:"phoenix.action.updschema"}}}]}}),n.options.rightMenuButton&&n.$buttons.push({auth:!0,$isHidden:!0,$icon:"ellipsis-v",$type:"menuright",$parent:n.options.rightMenuPlace}),n.options.topMenuButton&&n.$buttons.push({auth:!0,$isHidden:!0,$icon:"chevron-down",$type:"menutop",right:!0,$parent:n.options.topMenuPlace}),r.buttons&&r.buttons.after&&r.buttons.after.forEach(function(e){n.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),n.page.addChild("header",n),n.setData(e)},e.prototype._show=function(){var e=n.sessionPreferences("headerisHidden");return!this._ctx.$url.$inline&&!e||(e||n.sessionPreferences("headerisHidden",!0),!1)},e.prototype.setData=function(e){e=e||{}},e.prototype.buttonByType=function(e){for(var t=0,n=this.$buttons.length;t<n;t++){var i=this.$buttons[t];if(i.$type==e)return i}return null},e.prototype._createButtons=function(){if(this.$element){var e=this.$element.get(0),t=a.query(e,".header_left_buttons"),i=a.query(e,".header_right_buttons"),s=this.$location?a.query(this.$location.get(0),".bs-location-buttons"):null;this.$buttons.forEach(function(e,l){e.$index=l;for(var u=function(e,t){var i=[],s=n.bootstrap4,l=s?"d-none d-sm-inline-block":"hidden-xs";e.id=r.allocID();var u=e.title;if(u&&"object"==typeof u&&(u=u[o.currentLang]),e.$location)i.push('<span id="{1}" class="bs-loc-link bs-style-icon-lg {2}" href="#" data-phoenix-href="click://{0}"><span>');else{if(i.push('<li id="{1}">'),"logo"===e.$type)e.$location||i.push('<a tabindex="-1" class="'+l+" bs-nav-logo "+e.$className+'" href="#" data-phoenix-href="click://{0}"></a>');else{var d=[];e.iconStyle?a.parseStyle(e.iconStyle,d):d.push("bs-style-icon-lg"),e.title||e.expression?(i.push('<a class="bs-nav-link"'),i.push('  href="#" data-phoenix-href="click://{0}"'),i.push(">"),d.push("{2}"),i.push('<span class="'+d.join(" ")+'"></span>'),d=["bs-icon-header-title"],s&&d.push("dropdown-toggle"),i.push('<span class="'+d.join(" ")+'"><span class="'+l+'">{3}</span>'),s&&d.push("dropdown-toggle"),e.menu&&i.push(' <span class="caret"></span>'),i.push("</span>"),i.push("</a>"),e.menu&&e.menu.items&&(s?(i.push('<div class="dropdown-menu bs-right-menu">'),i.push("</div>")):(i.push('<ul class="dropdown-menu bs-right-menu">'),i.push("</ul>")))):(i.push('<a class="bs-nav-link" href="#" data-phoenix-href="click://{0}">'),d.push("{2}"),i.push('<span class="'+d.join(" ")+'"></span>'),i.push("</a>"))}i.push("</li>")}return e.link&&e.link.$form&&(e.link.$form.alignElementId=e.id),$(r.format(i.join(""),t,e.id,a.customIconClass(e.$icon,e.$iconClass),u||e.expression||""))}(e,l),d=e.$location?s:e.right?i:t,c=0,p=u.length;c<p;c++)a.append(d,u.get(c))})}},e.prototype._updateButtons=function(){var e=this,t=12;if(n.bootstrap4&&(t=a.rem2px(.8571)),e.$element){var i=e.page.props.$user&&e.page.props.$user.connected,o=t,s=t,l=e.$element.get(0);e.$buttons.forEach(function(t){var n=a.find(l,t.id);if(t.$isHidden||!i&&t.auth)a.addClass(n,"bs-none");else{if("user"===t.$type){var u=r.execAngularExpression(t.expression,e.page.props.$user.credentials);if(u!==t.title){t.title=u;var d=a.query(n,".bs-icon-header-title");d&&a.text(d.firstChild,u)}}a.removeClass(n,"bs-none"),t.$location||(t.right?s+=a.offset(n).width:o+=a.offset(n).width)}}),e.leftButtonsSpace===o&&e.rightButtonsSpace===s||(e.leftButtonsSpace=o,e.rightButtonsSpace=s,e._updateTitleSpaceMargins())}},e.prototype._updateTitleSpaceMargins=function(){if(this.$element){var e=this.$element.get(0),t=a.query(e,".header_title");t.style.marginLeft=this.leftButtonsSpace+"px",t.style.marginRight=this.rightButtonsSpace+"px"}},e.prototype.inPopup=function(e){if(this._ob){var t=a.find(this.$element.get(0),this._ob.id);return a.isChildOf(t,e)}return!1},e.prototype.hide=function(e){if(this._ob){var t=a.find(this.$element.get(0),this._ob.id);a.removeClass(t.lastChild,"bs-block"),this._ob=null}},e.prototype._openPopup=function(e){this.page.setPopup(this),this._ob=e;var t=a.find(this.$element.get(0),e.id);a.addClass(t.lastChild,"bs-block")},e.prototype._executeLink=function(e,t){if(e.menu){var n=a.find(this.$element.get(0),e.id);if(n&&n.lastChild&&(n.lastChild.childNodes.length||p(e,n.lastChild)),!(t>=0)){if(this._ob){if(this._ob===e)return void this.page.setPopup(null);this.page.setPopup(null)}if(n&&n.lastChild)n.lastChild.style.minWidth=Math.max(a.offset(n).width,160)+"px";return this._openPopup(e)}var i=e.menu.items[t];i.link&&c.execLink(i.link,c.context(),null),this.page.setPopup(null)}else if(e.link)return e.link.$form&&(e.link.$form.opener=e.id),c.execLink(e.link,c.context(),null);if(["menuleft","menuright","menutop","menubottom"].indexOf(e.$type)>=0&&e.$parent&&this.page){var o=this.page.childByType("menu-"+e.$type.substring(4));o&&o.show($(a.find(null,e.$parent)))}},e.prototype._onresize=function(){this.$element&&this._updateButtons()},e.prototype._setEvents=function(){var e=this,t=e.$element.get(0);e.$element.on("mousedown",function(n){var i=c.isCustomLink(t,n,!0);if(i&&"click"===i.protocol){var o=i.value.substring("click://".length).split("/"),r=(o.length>1&&parseInt(o[1],10),e.$buttons[parseInt(o[0],10)]);if(r)if(["menuleft","menuright","menutop","menubottom"].indexOf(r.$type)>=0){if(r.$parent&&e.page){var s=e.page.childByType("menu-"+r.$type.substring(4));e.page.popup===s&&(e._ignoreClick=!0)}}else r.link&&r.link.$form&&!r.link.$form.modal&&e.page.popup&&e.page.popup.opener&&e.page.popup.opener===r.id&&(e._ignoreClick=!0)}}),e.$element.on("click",function(n){var i=c.isCustomLink(t,n);if(e._ignoreClick)e._ignoreClick=!1;else if(i&&"click"===i.protocol){var o=i.value.substring("click://".length).split("/"),r=o.length>1?parseInt(o[1],10):-1,s=e.$buttons[parseInt(o[0],10)];if(e._executeLink(s,r),s&&"logo"===s.$type){var a=document.activeElement;a&&a.blur()}}}),$(window).on("resize.header",function(){clearTimeout(e._doResize),e._doResize=setTimeout(e._onresize.bind(e),100)})},e.prototype.setPage=function(e,t){if(u.release){var n=d.isCustomizable("pages",e),i=this.buttonByType("authoring");i&&i.$isHidden!=!n&&(i.$isHidden=!n,this._updateButtons())}},e.prototype.onPageChange=function(e,t){var n,i=this;switch(e){case"$title":i.title=t||d.title||"",i._renderTitle();break;case"$hasBack":i.options._alwaysShowBack&&(t=!0),i.options.backButton&&(n=i.buttonByType("back"))&&n.$isHidden!==!t&&(n.$isHidden=!t,i._updateButtons());break;case"$user":i._auth(!1),i._updateButtons();break;case"$menuleft":i.options.leftMenuButton&&(n=i.buttonByType("menuleft"))&&n.$isHidden==t&&(n.$isHidden=!t,i._updateButtons());break;case"$menutop":i.options.topMenuButton&&(n=i.buttonByType("menutop"))&&n.$isHidden==t&&(n.$isHidden=!t,i._updateButtons())}},e.prototype._removeEvents=function(){this.$element.off("mousedown"),this.$element.off("click"),$(window).off("resize.header")},e.prototype.renderButtons=function(){this._createButtons(),this._updateButtons(),r.nextTick(function(){})},e.prototype._renderTitle=function(){if(this.$element){var e=this.$element.get(0),t=a.query(e,".header_title");a.text(t,this.title||"")}},e.prototype._auth=function(e){if(this.$parent&&this._show()){var t=this.$parent.get(0),n=this.$element.get(0),i=!1;if(this.page.props.$user&&this.page.props.$user.connected?(i=!0,a.removeClass(n,"bs-none")):this.options.showOnDisconnected?(i=!0,a.removeClass(n,"bs-none")):a.addClass(n,"bs-none"),!e){var o=a.offset(this.$element.get(0));l.topOffset=i?o.height:0,t.style.paddingTop=i?o.height+"px":"0px"}}},e.prototype.render=function(e){var t,i,o,s,u=this;if(u._show()&&e&&!this.$element){u.$element=(t=u.options,i=[],o=n.bootstrap4,s=["no-y-margin no-x-margin"],o?s.push("fixed-top"):s.push("navbar-fixed-top"),i.push('<div class="'+s.join(" ")+'">'),s=["bs-header-bar no-y-margin no-x-margin no-x-padding no-y-padding"],o?s.push("bg-dark"):s.push("navbar navbar-inverse"),i.push('<nav class="'+s.join(" ")+'">'),i.push('    <div class="container-fluid no-x-padding">'),i.push('        <div class="bs-title bs-title-nav-pos header_title"></div>'),i.push('        <ul class="'+(o?"":"nav navbar-nav ")+'no-x-margin no-y-margin bs-nav-button bs-left-nav header_left_buttons">'),i.push("        </ul>"),i.push('        <ul class="'+(o?"":"nav navbar-nav ")+'no-x-margin no-y-margin bs-nav-button bs-right-nav header_right_buttons">'),i.push("        </ul>"),i.push("    </div>"),i.push("</nav>"),t.showLocation&&i.push('<div class="bs-header-location"><span class="bs-location-buttons"></span><span class="bs-header-location-title">&nbsp;</span></div>'),i.push("</div>"),$(i.join("")));var c=u.$element.get(0);u.options.showLocation&&(u.$location=$(c.lastChild));var p=d.configuration,h=p&&p.header?p.header:{},f=a.query(c,".header_title");h.uppercase&&a.addClass(f,"bs-transform-uppercase"),h.align&&a.addClass(f,"align-"+h.align),u._renderTitle(),u.renderButtons();var m=e.get(0);u.options.replaceParent&&(m=m.parentNode),u.$parent=$(m),u._auth(!0),u.options.replaceParent?e.replaceWith(u.$element):e.append(u.$element),u._setEvents();var v=a.offset(u.$element.get(0));l.topOffset=v.height,m.style.paddingTop=v.height+"px",r.nextTick(function(){u._onresize()})}},e.prototype.destroy=function(){r.log("Header Destroy","destroy"),this.$parent=null,this.$element&&(this._removeEvents(),this.$element=null),this.page&&(this.page.removeChild(this),this.page=null)},e}(),t.Header=h}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u;t=e.tabs||(e.tabs={}),i=(n=e).pagecontrol,o=n.dom,r=n.link,s=n.utils,a=n.application,l=n.ulocale,n.locale,u=function(){function t(e,t){this._page=i.Page(),this._options=$.extend({justified:!1,pills:!1},e||{}),this._tabs=t||[]}return t.prototype._renderTabs=function(){var t=this.$element.get(0).firstChild,n=document.createDocumentFragment(),i=$('<li><a href="#"></a><li>').get(0),u=this._page.currentPage();this._tabs.forEach(function(t,d){var c=i.cloneNode(!0),p=c.firstChild;o.text(p,l.localeTitle(t.$title));var h=!1;if(void 0!==t.enabled)if("string"==typeof t.enabled){var f=s.execAngularExpression(t.enabled,r.context());f&&"undefined"!==f&&"false"!==f||(h=!0)}else h=!t.enabled;if(h?o.addClass(c,"disabled"):o.attr(p,"data-phoenix-href","click://"+d),t.$page){var m=r.pageName(t)==u;m&&t.$module&&(m=t.$module===a.name),t.active=!!m}t.active&&o.addClass(c,e.bootstrap4?"show active":"active"),n.appendChild(c)}),o.empty(t),o.append(t,n)},t.prototype._setEvents=function(){var e=this;if(e.$element){var t=e.$element.get(0);e.$element.on("click",function(n){var i=r.isCustomLink(t,n);if(i&&"click"===i.protocol){var o=i.value.substring("click://".length).split("/"),s=r.context(),a=e._tabs[parseInt(o[0],0)];a&&a.$page&&!a.disabled&&r.execLink(a,s,null)}})}},t.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},t.prototype.render=function(e){this.$element||(this.$element=$('<div class="bs-widget-content-inv bs-tabs"><ul class="nav nav-tabs"><ul></div>'),this._renderTabs(),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},t.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null,this._page=null},t}(),t.Tabs=u}(Phoenix||(Phoenix={})),function(e){!function(t){t.LAYOUT_BLOCK="block",t.LAYOUT_ROW="row",t.LAYOUT_COLUMN="column",t.LAYOUT_HTML="html",t.LAYOUT_ACCORDION="accordion",t.LAYOUT_ACCORDION_GROUP="accordion-group";var n=e,i=n.dom,o=n.utils,r=n.locale.layouts,s=n.ulocale,a=n.render,l=n.sticky,u="page",d=function(e){e.$items.length||(e.$type=t.LAYOUT_BLOCK,e.$origin=t.LAYOUT_ROW)},c=function(e){d(e);var n=!1;if(e.$items.forEach(function(e){e.$type=t.LAYOUT_COLUMN,e.$colSize||(n=!0)}),n){var i=Math.max(1,Math.floor(12/e.$items.length)),o=e.$items.length-1,r=0;e.$items.forEach(function(e,t){t===o&&(i=12-r),e.$colSize=i,r+=i})}},p=function(e){e.$items.length||e.$items.push({$type:t.LAYOUT_ACCORDION_GROUP}),e.$items.forEach(function(e,n){e.$type=t.LAYOUT_ACCORDION_GROUP,e.$title=e.$title||{},e.$name=function(e,t){if(!(e=e||""))return u+t;if(0===e.indexOf(u)){var n=e.substring(u.length);if(parseInt(n,10)+""===n)return u+t}return e}(e.$name,n),e.$title.value=e.$title.value||r.defaultTitle})},h=function(e){if(e.$type===t.LAYOUT_HTML)return!1;if(e.$items.length>0&&!e.$items[0].$items)return!1;return!0},f=function(e,i){var o=!0,r=n.bootstrap4;return e.$items.length?!(e.$type===t.LAYOUT_ACCORDION_GROUP&&!e.$widget&&!r)&&(e.$items.forEach(function(e){var n;o&&(o=!((n=e).$type===t.LAYOUT_ACCORDION&&!n.$widget))}),o):o},m=function(e){if(e.$type&&!e.$items&&(e.$items=[]),e.$type===t.LAYOUT_ROW||e.$type===t.LAYOUT_ACCORDION||e.$type===t.LAYOUT_HTML)return!1;if(e.$items.length>0){var n=e.$items[0];if(n.$type||n.$items)return!1}return!0},v=function(e){if(e.$items&&e.$items.length){var t=!0;return e.$items.forEach(function(e){t=t&&e&&e.options&&e.options.right}),t}return!1},g=function(e,t,n){var o=e.$style;!o&&e.$sticky&&(o="$white"),i.parseStyle(o,t),!n.design&&e.$isHidden&&t.push("bs-none")},y=function(e){return!e.$items||!e.$items.length||e.$items[0].$bind},_=function(i,o,r,s,a){var u,d,c=n.bootstrap4;switch(i.$type){case t.LAYOUT_BLOCK:d=!0,r.design&&i.selected&&s.push("selected"),(u=h(i))&&((r.design||f(i))&&(d=!1,o&&s.push("no-x-padding")),r.design&&(s.push("drop-layouts-zone"),i.$origin===t.LAYOUT_ROW&&s.push("row-color"))),m(i)&&(!i.$inline||!r.design&&i.$html||(e.bootstrap4&&v(i)?s.push("form-inline d-flex flex-row-reverse bs-inline-container"):s.push("form-inline bs-inline-container")),r.design&&(s.push("drop-fields-zone"),u||(d=!1,o&&s.push("no-x-padding")))),d&&s.push("field-container"),o||(s.push("bs-root-container"),r.design&&s.push("bs-scroll-container"),i.form||s.push("page")),r.design&&(s.push("design"),i.selected&&s.push("selected")),g(i,s,r),!r.design&&i.$sticky&&l&&l.native&&(s.push("bs-sticky"),"top"===i.$sticky?a.push("top:"+l.topOffset+"px;"):"bottom"===i.$sticky&&a.push("bottom:"+l.bottomOffset+"px;"));break;case t.LAYOUT_ACCORDION:1===r.step&&(s.push("panel-group bs-island"),r.design&&(s.push("design"),s.push("drop-layouts-zone"),i.selected&&s.push("selected")),g(i,s,r));break;case t.LAYOUT_ROW:1===r.step?(s.push("container-fluid"),!r.design&&i.$forceTable&&s.push("no-x-padding"),r.design&&(s.push("design"),s.push("no-x-padding"),i.selected&&s.push("selected")),g(i,s,r)):2===r.step&&(s.push("row"),i.$forceTable&&s.push("bs-row-table"),r.design&&(s.push("design-table"),s.push("row-color"),(u=h(i))&&s.push("drop-layouts-zone")));break;case t.LAYOUT_ACCORDION_GROUP:1===r.step?(c?s.push("card"):s.push("panel panel-default"),r.design&&(s.push("design"),i.selected&&s.push("selected"))):2===r.step?c?(s.push("collapse"),i.opened&&s.push("show")):(s.push("panel-collapse collapse"),i.opened&&s.push("in")):3===r.step&&(c&&s.push("card-body"),(u=h(i))&&((r.design||f(i))&&(s.push("no-x-padding"),s.push("no-y-padding")),r.design&&s.push("drop-layouts-zone")),m(i)&&(!i.$inline||!r.design&&i.$html||(e.bootstrap4&&v(i)?s.push("form-inline d-flex flex-row-reverse bs-inline-container"):s.push("form-inline bs-inline-container")),r.design&&(s.push("drop-fields-zone"),u||s.push("no-x-padding"))),g(i,s,r));break;case t.LAYOUT_COLUMN:1===r.step?(r.design?s.push("col-design col"+(c?"":"-xs")+"-"+i.$colSize):i.$customColSize?s.push(i.$customColSize):s.push("col-"+(i.$colType||"sm")+"-"+i.$colSize),s.push("no-x-padding")):2===r.step&&(d=!0,s.push("container-fluid"),(u=h(i))&&((r.design||f(i))&&(d=!1,s.push("no-x-padding")),r.design&&!i.$auto&&s.push("drop-layouts-zone")),m(i)&&(!i.$inline||!r.design&&i.$html||(e.bootstrap4&&v(i)?s.push("form-inline d-flex flex-row-reverse bs-inline-container"):s.push("form-inline bs-inline-container")),r.design&&(s.push("drop-fields-zone"),u||(s.push("no-x-padding"),d=!1))),d&&s.push("field-container"),r.design&&(s.push("design col"),i.$auto&&s.push("auto"),i.selected&&s.push("selected")),g(i,s,r));break;case t.LAYOUT_HTML:r.design&&(s.push("design"),i.selected&&s.push("selected")),g(i,s,r)}},$=function(e,t,n,i){var o=[],r=[];_(t,n,i,o,r),o.length&&(e.push(' class="'),e.push(o.join(" ")),e.push('"')),r.length&&(e.push(' style="'),e.push(r.join(" ")),e.push('"'))},b=function(e,t,n){e.push(' id="'),e.push(n?n+"_"+t.$id:t.$id),e.push('"')},x=function(e,t,n){n&&(e.push(' data-level="'),e.push(t),e.push('"'))},C=function(e,t,n,i,o){if((o||i)&&(e.push(' data-layout="'),e.push(n.$id),e.push('"'),n.$idSelect=null),o||i&&t>1){var r=n["$idStep"+t];r&&(e.push(' id="'),e.push(r),e.push('"'))}},k=function(e,t,a,l,u){if(t.$title&&t.$title.value===r.defaultTitle)delete t.$title;else if(l&&t.$title&&!t.$title.isHidden){var d=t.$title.size||(n.bootstrap4?5:4);e.push("<h"+d);var c=["bs-block-title"];if(t.$title.$style&&i.parseStyle(t.$title.$style,c),e.push(' data-ignore="true" class="'+c.join(" ")+'" id="'+t.$id+'_title">'),t.$title.value){var p=s.tt(t.$title.value,a);t.$fields&&(p=o.execAngularExpression(p,u||{})),e.push(o.escapeHtml(p))}e.push("</h"+d+">")}},w=function(e,t,n,i,o,r,s,a){e.push("<div"),r&&e.push(' draggable="true"'),$(e,t,n,{design:r,step:1}),C(e,1,t,r),b(e,t),x(e,1,r),e.push(">"),k(e,t,o,s,i)},E=function(e,t,n,i,o,r){e.push("</div>")},O=function(e,t,n,i,o,r,s){e.push("<div"),r&&e.push(' draggable="true"'),$(e,t,n,{design:r,step:1}),C(e,1,t,r),b(e,t),x(e,1,r),e.push(">"),t.$html&&e.push(t.$html)},S=function(e,t,n,i,o){e.push("</div>")},P=function(t,i,r,a,l,u,d,c){if(p(i),u||!i.$widget)t.push('<div role="tablist"'),e.bootstrap4||t.push(' aria-multiselectable="true"'),u&&t.push(' draggable="true"'),$(t,i,r,{design:u,step:1}),C(t,1,i,u),b(t,i),x(t,1,u),t.push(' id="'+i.$id+'_parent"'),t.push(">");else{if("tabs"!==i.$widget&&"none"!==i.$widget)throw"Invalid accordion $widget.";var h="none"===i.$widget;t.push("<div"),$(t,i,r,{design:u,step:1}),C(t,1,i,u),b(t,i),x(t,1,u),t.push(">"),t.push('<ul  id="'+i.$id+'_tab" class="nav nav-tabs bs-tabs'+(h&&!i.showTabs?" bs-none":"")+'" role="tablist">'),i.$items.forEach(function(e){return function(e,t,i,r,a,l,u,d,c){if(n.bootstrap4){e.push('<li class="nav-item">');var p=["nav-link"];t.opened&&p.push("active"),e.push(o.format('<a class="'+p.join(" ")+'" id="{0}_title" href="#{0}" data-layout="{0}" aria-expanded="'+(t.opened?"true":"false")+'" role="tab" data-toggle="tab">',t.$id));var h=s.tt(t.$title.value,a);t.$fields&&(h=o.execAngularExpression(h,d||{})),e.push(o.escapeHtml(h)),e.push("</a></li>")}else e.push('<li role="presentation"'),t.opened&&e.push(' class="active"'),e.push(">"),e.push(o.format('<a href="#{0}" id="{0}_title" aria-controls="{0}"  data-layout="{0}" role="tab" data-toggle="tab">',t.$id)),h=s.tt(t.$title.value,a),t.$fields&&(h=o.execAngularExpression(h,d||{})),e.push(o.escapeHtml(h)),e.push("</a></li>")}(t,e,0,0,l,0,0,a)}),t.push("</ul>"),t.push('<div class="tab-content">')}},I=function(e,t,n,i,o,r){r||!t.$widget?e.push("</div>"):"tabs"!==t.$widget&&"none"!==t.$widget||(e.push("</div>"),e.push("</div>"))},D=function(e,t,i,r,s,a,l,u){var d=n.bootstrap4;if(a||!i.$widget)e.push("<div"),$(e,t,i,{design:a,step:1}),C(e,1,t,a),b(e,t),x(e,1,a),t.$idStep2=t.$id+"_s2",t.$idStep3=t.$id+"_s3",t.$idDesign=t.$idStep3,a&&e.push(' draggable="true"'),e.push(">"),d?e.push('<div class="card-header" role="tab"'):e.push('<div class="panel-heading" role="tab"'),b(e,t,"heading"),e.push(">"),d?e.push('<h5 class="mb-0">'):(e.push('<h4 class="panel-title bs-pointer collapsed" data-toggle="collapse" data-parent="#'+i.$id+'"'),t.opened?e.push(' aria-expanded="true"'):e.push(' aria-expanded="false"'),e.push(' data-target="#'+t.$idStep2+'" aria-controls="'+t.$idStep2+'"'),e.push(' id="'+t.$id+'_title">')),d&&(e.push("<a"),e.push(' data-toggle="collapse"'),e.push(' href="#'+t.$idStep2+'"'),e.push(' aria-controls="'+t.$idStep2+'"'),t.opened?e.push(' aria-expanded="true"'):(e.push(' aria-expanded="false"'),e.push(' class="collapsed"')),e.push(">")),e.push(o.escapeHtml(t.$title?t.$title.value:"")),d?e.push("</a></h5>"):e.push("</h4>"),e.push("</div>"),e.push('<div role="tabpanel" aria-labelledby="heading_'+t.$id+'"'),d&&e.push(' data-parent="#'+i.$id+'"'),$(e,t,i,{design:a,step:2}),C(e,2,t,a,!0),x(e,2,a),e.push(">"),e.push("<div"),$(e,t,i,{design:a,step:3}),C(e,3,t,a,!0),e.push(">");else if("tabs"===i.$widget||"none"===i.$widget){var c=["tab-pane fade"];t.opened&&c.push("in "+(d?"show active":"active")),e.push('<div role="tabpanel"'),e.push(' class="'+c.join(" ")+'"'),t.$idDesign=t.$id,b(e,t),e.push(">")}},M=function(e,t,n,i,o,r){r||!n.$widget?e.push("</div></div></div>"):"tabs"!==n.$widget&&"none"!==n.$widget||e.push("</div>")},T=function(e,t,n,i,o,r,s,a){e.push("<div"),r&&e.push(' draggable="true"'),$(e,t,n,{design:r,step:1}),b(e,t),C(e,1,t,r),x(e,1,r),e.push(">"),t.$idStep2=t.$id+"_s2",t.$idDesign=t.$idStep2,e.push("<div"),$(e,t,n,{design:r,step:2}),C(e,2,t,r),x(e,2,r),e.push(">"),c(t)},F=function(e,t,n,i,o,r){e.push("</div></div>")},L=function(e,t,n,i,o,r,s,a){e.push("<div"),$(e,t,n,{design:r,step:1}),C(e,1,t,r),b(e,t),x(e,1,r),e.push(">"),e.push("<div"),$(e,t,n,{design:r,step:2}),r&&e.push(' draggable="true"'),t.$idDesign=t.$id+"_design",t.$idDrag=t.$id,t.$idStep2=t.$idDesign,C(e,2,t,r),x(e,2,r),t.$idSelect=t.$idDesign,e.push(">"),k(e,t,o,s,i)},N=function(e,t,n,i,o,r){e.push("</div></div>")},A=function(e,t,n,i,o){if(e){if(i&&!e.$type&&!e.$items)return void n(e,t,!1,!0,o);n(e,t,!0,!0,o),o&&o.stop||(m(e)?e.$items&&e.$items.forEach(function(t){n(t,e,!1,!0,o)}):e.$items&&e.$items.forEach(function(t){A(t,e,n,!1,o)})),n(e,t,!0,!1,o)}},R=function(e,t,n,i,o){e.push('<div class="bs-island'+(o.design?" design":"")+(t.$config?" bs-widget":" bs-field")+(t.selected?' selected"':'"')),o.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push("></div>")},j=function(e,t,n,i,o){e.push('<div id="'+t.$id+'"></div>')},H=function(e,n,r,s,l,u){var d=a.get(l.context,"widget")||j,c=a.get(l.context,"field")||R,p=e.form;A(e,null,function(e,r,a,h,f){if(a){var v=w,g=E;switch(e.$type){case t.LAYOUT_ROW:v=T,g=F;break;case t.LAYOUT_COLUMN:v=L,g=N;break;case t.LAYOUT_ACCORDION:v=P,g=I;break;case t.LAYOUT_ACCORDION_GROUP:v=D,g=M;break;case t.LAYOUT_HTML:v=O,g=S}h?(e.$ref&&l.design&&(f.stop=!0),v(f.html,e,r,n,s,l.design,p,f.stop),f.stop&&(y=f.html,_=e,l.design,y.push(o.format('<div id="{0}_settings" class="bs-cursor-p bs-layout-detail" data-layout-detail="true"><span class="'+i.iconClass("cog")+'"></span></div>',_.$id))),u&&u(e)):(!l.design&&e.$html&&e.$items&&e.$items.length&&m(e)&&f.html.push(o.format(e.$html.replace(/id="/g,'id="{0}_'),e.$id)),g(f.html,e,r,n,s,l.design),e.$ref&&l.design&&(f.stop=!1))}else e.$config?d(f.html,e,r,n,l):c(f.html,e,r,n,l);var y,_},!0,{html:r})},B=function(e,n,i,s,a,l){A(e,n,function(e,n,u,c){var p,h,f,m;c&&(u?function(e,n,i,s){if(e.$id||(e.$id=o.allocID()),n&&(e.$parentId=n.$id),e.$idDesign=e.$id,e.$idDrag=e.$id,e.$type=e.$type||t.LAYOUT_BLOCK,e.$items=e.$items||[],e.$title&&(e.$title.style||void 0==e.$title.style||delete e.$title.style),y(e)?e.$fieldsOptions&&!Object.keys(e.$fieldsOptions)&&delete e.$fieldsOptions:(delete e.$inline,delete e.$fieldsOptions),i&&(i[e.$id]=e),s&&e.$name){var a=s[e.$name];a?Array.isArray(a)?a.push(e):s[e.$name]=[s[e.$name],e]:s[e.$name]=e}switch(e.$type!==t.LAYOUT_HTML||e.$html||(e.$html=r.Html),e.$type){case t.LAYOUT_ROW:d(e);break;default:delete e.$forceTable}e.$origin&&e.$origin===e.$type&&delete e.$origin,e.$type!==t.LAYOUT_ACCORDION_GROUP&&e.$title&&e.$title.value===r.defaultTitle&&delete e.$title}(e,n,i,a):(h=n,f=s,m=l,(p=e).$id||(p.$id=o.allocID()),h&&(p.$parentId=h.$id),p.$idDrag=p.$id,f&&(f[p.$id]=p),m&&p.$name&&(m[p.$name]=p)))},!0)};t.check=B,t.layoutVisible=function(e){return e.$type!==t.LAYOUT_ACCORDION_GROUP||e.opened},t.clearMeta=function(e,n){A(e,null,function(i,o,s,a){a&&(s?(n&&delete i.$id,delete i.$fields,delete i.$render,delete i.$idDesign,delete i.$idDrag,delete i.$idSelect,delete i.$parentId,delete i.$idStep2,delete i.$idStep3,delete i.$content,delete i.selected,delete i.showTabs,i.$type!==t.LAYOUT_BLOCK&&(delete i.$sticky,i.$type===t.LAYOUT_COLUMN?delete i.$type:e.$type===t.LAYOUT_HTML&&e.$html===r.Html&&delete e.$html),i.$type===t.LAYOUT_ROW&&!1!==e.$forceTable||delete e.$forceTable,i.$name||void 0===i.$name||delete i.$name,!1===i.$inline&&delete i.$inline,i.$fieldsOptions&&(!1===i.$fieldsOptions.columns&&delete i.$fieldsOptions.columns,!1===i.$fieldsOptions.titleIsHidden&&delete i.$fieldsOptions.titleIsHidden,0===Object.keys(i.$fieldsOptions).length&&delete i.$fieldsOptions),i.datasets&&0===Object.keys(i.datasets).length&&delete i.datasets):(delete i.$render,n&&delete i.$id,delete i.$parentId,delete i.$idDrag,delete i.selected,i.$config&&(i.$config.data&&(delete i.$config.data.ds,Object.keys(i.$config.data).length||delete i.$config.data),(i.$config.$titleIsHidden||i.$config.$dontSaveTitle)&&delete i.$config.$title)))},!0)},t.namesOfLayout=function(e){var t=[];return A(e,null,function(e,n,i,o,r){i&&o&&e.$name&&t.push({name:e.$name,title:e.$title&&e.$title.value?e.$title.value:e.$name})},!0),t},t.clearMaps=function(e,t,n,i,o){A(e,null,function(e,r,s,a){if(a)if(s){if(delete t[e.$id],e.$name){var l=i[e.$name];if(Array.isArray(l)){var u=l.indexOf(e);u>=0&&l.splice(u,1),l.length||delete i[e.$name]}else delete i[e.$name]}}else delete n[e.$id],e.$name&&delete o[e.$name]},!0)},t.afterRemoveChild=function(e,n,i,o,r){e.$type===t.LAYOUT_ROW?(e.$items.forEach(function(e){e.$type=t.LAYOUT_COLUMN,delete e.$colSize}),c(e),e.$items.forEach(function(t){B(t,e,n,i,o,r)})):e.$type===t.LAYOUT_ACCORDION&&(p(e),e.$items.forEach(function(t){B(t,e,n,i,o,r)}))},t.canSelect=function(e,n){return!e.$auto&&(e.$type!==t.LAYOUT_COLUMN||1!==n)},t.updateCssClass=function(e,n,o,r){var s,a=[],l=[];_(n,o,r,a,l),e.className=a.join(" "),l.length&&(e.style=l.join(" ")),n.$type===t.LAYOUT_ACCORDION_GROUP&&1===r.step?(s=i.find(e,n.$id+"_title"))&&i.text(s,n.$title&&n.$title.value?n.$title.value:""):n.$type===t.LAYOUT_HTML&&1===r.step&&(e.innerHTML=n.$html||"")},t.toHtml=function(e,t,n,i,o){var r=[];return H(e,t,r,n,i,o),r.join("")},t.updateLayoutTitle=function(e,t,n,r){if(t.$title.value){var a=s.tt(t.$title.value,r);t.$fields&&(a=o.execAngularExpression(a,n||{})),i.text(e,a)}},t.enumSubLayouts=function(e,t){A(e,null,function(e,n,i,o){o&&i&&t(e)},!1)}}(e.layoutUtils||(e.layoutUtils={}))}(Phoenix||(Phoenix={})),function(e){var t=e,n=t.pagecontrol,i=t.menu,o=t.dom,r=t.utils,s=(t.locale,t.WidgetUtils,t.link),a=t.render,l=t.ipc,u=t.sticky,d=t.layoutUtils;!function(t){var c=function(e){for(var t=e.length;t--;)for(var n=e[t],i=Object.keys(n),o=i.length;o--;){var r=n[i[o]];if(r.selected)return r}return null},p=function(){function e(e,t,n,i,o,r){t=this.initOptions(t),this.$locale=null,this._init(e,t)}return e.prototype._afterCreate=function(){},e.prototype.initOptions=function(e){return e},e.prototype._init=function(e,t){var i=this;i.$element=null,i.$content=null,i.options=t||{},i.options.context=i.options.context||"javascript",i.map={},i.mapFields={},i.namedMap={},i.namedMapFields={},e=e||{},d.check(e,null,i.map,i.mapFields,i.namedMap,i.namedMapFields),i.data=e,i.data.form=i.options.form,e.map=i.map,e.fields=i.mapFields,i.children={},i.controls={},i.expressionTitle=!1,i.options.form||(i.page=n.Page(),i.page.setPopup(null),i.page.addChild("layout",i),i.options.design||(i.expressionTitle=r.hasExpression(e.$title),i.page.props.$title=e.$title?r.parseExpression(e.$title,s.context()):null)),i._setDesignListeners(),i.pageLayoutInit()},e.prototype.pageLayoutInit=function(){},e.prototype.getSchema=function(e){return null},e.prototype.getLookupForSchema=function(e,t){return null},e.prototype._setDesignListeners=function(){},e.prototype._removeEvents=function(){this._removeBaseEvents()},e.prototype._addEvents=function(){this._addBaseEvents()},e.prototype._removeBaseEvents=function(){this._removeAccordionEvents()},e.prototype._addBaseEvents=function(){this._setAccordionEvents()},e.prototype._onSelectedChanged=function(e,t,n){},e.prototype._showSelected=function(e,t){},e.prototype._setAccordionEvents=function(){var e=this;e.$element.on("shown.bs.collapse hide.bs.collapse shown.bs.tab hide.bs.tab",function(t){var n=t.target;if(n&&n.hasAttribute("data-layout")){var i=n.getAttribute("data-layout"),o=e.getLayoutById(i);if(o){var r="shown"===t.type;if(o.opened===r)return;r?e._openTab(i):e._activateLayout(o,!1)}}})},e.prototype._activatePageLayout=function(e){var t=this.$element?o.find(this.$element.get(0),e.$id+"_title"):null;t&&$(t).tab("show")},e.prototype.activatePage=function(e){var t=this,n=t.getLayoutsByName(e);n&&n.forEach(function(e){return t._activatePageLayout(e)})},e.prototype._openTab=function(e){var t=this.getLayoutById(e);if(!t.opened){var n=this.getLayoutById(t.$parentId);if(n)for(var i=0,o=n.$items.length;i<o;i++){var r=n.$items[i];if(r.opened){r.opened=!1,this._activateLayout(r,!1);break}}t.opened=!0,this._updateLayoutContent(t),this._activateLayout(t,!0)}},e.prototype._doDatasetEventAfterEnabled=function(e){},e.prototype._activateLayout=function(e,t){var n=this;t?n._getVisibleChildren(e).forEach(function(e){e.disabled=!1,n._doDatasetEventAfterEnabled(e)}):n._getChildrenOf(e).forEach(function(e){e.disabled=!0}),n._afterVisibilityChanged({inDom:!0,resize:t})},e.prototype._removeAccordionEvents=function(){this.$element.off("show.bs.collapse hide.bs.collapse")},e.prototype.toString=function(e){return null},e.prototype.emit=function(e,t,n){this.emitDataEvent(e,t,n)},e.prototype.openErrors=function(){if(this.$element){var e=o.find(this.$element.get(0),this.data.$id+"_error");e&&e.firstChild&&o.removeClass(e.firstChild,"bs-none")}},e.prototype._getFormLData=function(){return null},e.prototype._renderLayout=function(e){var t=this;t.stickies=null;var n=$(d.toHtml(e,t._getFormLData(),t.$locale,{design:t.options.design,context:t.options.context},function(e){t.options.design||u.native||!e.$sticky||(t.stickies=t.stickies||{},t.stickies[e.$id]=e)}));return t.$element=n,t.afterRender(n),t._renderChildren(n),t.afterRenderChildren(n),n},e.prototype.afterRenderChildren=function(e){},e.prototype.isChildOf=function(e,t){for(var n=this.map[e];n;){if(n==t)return!0;n=this.map[n.$parentId]}return!1},e.prototype._isChildVisibleOf=function(e,t){for(var n=this.map[e];n;){if(!d.layoutVisible(n))return!1;if(n==t)return!0;n=this.map[n.$parentId]}return!1},e.prototype._getVisibleChildren=function(e){var t=this,n=[];return Object.keys(t.controls).forEach(function(i){var o=t.controls[i];t.controls[i].item&&t._isChildVisibleOf(t.controls[i].item.$parentId,e)&&n.push(o)}),n},e.prototype._getChildrenOf=function(e){var t=this,n=[];return Object.keys(t.controls).forEach(function(i){var o=t.controls[i];t.controls[i].item&&t.isChildOf(t.controls[i].item.$parentId,e)&&n.push(o)}),n},e.prototype._getEventListFor=function(e){var t=[];return e.forEach(function(e){e.datasets&&Object.keys(e.datasets).forEach(function(n){var i=e.datasets[n];i.enumTriggers&&i.enumTriggers(!1,function(e){t.indexOf(e)<0&&t.push(e)})})}),t},e.prototype._refreshDataSets=function(e){},e.prototype._afterLayoutAdded=function(e){},e.prototype._updateLayoutContent=function(e){var t=o.find(this.$element.get(0),e.$idDesign),n=$(t);this._renderChildren(n),this.afterAddedInDom()},e.prototype._renderLayoutContent=function(e){var t=this,n=o.find(t.$element.get(0),e.$idDesign);if(n){var i=$(n),r=$(e.$content.join("")),s=n.parentNode,a=n.nextSibling;i.detach(),i.append(r),delete e.$content,t.options.beforeAdd&&t.options.beforeAdd(i,!0),s.insertBefore(n,a),t._afterLayoutAdded(e),t._renderChildren(i);var l=t._getVisibleChildren(e);t._refreshDataSets(l),t.afterAddedInDom(),t.options.design&&(t._removeEvents(),t._addEvents())}},e.prototype._isVisible=function(e){for(;;){if(!e)return!0;var t=this.map[e];if(!t)return!0;if(!d.layoutVisible(t))return!1;e=t.$parentId}},e.prototype._renderChildren=function(e){var t=this,n=[],i=e.get(0),s=a.get(t.options.context,"widget.control"),l=a.get(t.options.context,"field.control"),u=[],d={},c=[];return t._autofocus=null,(s||l)&&(Object.keys(t.mapFields).forEach(function(e){if(!t.children[e]){var a=t.mapFields[e];if(t._isVisible(a.$parentId)){var p=a.$config?s:l,h=p===l;if(h){var f=0===(a.$bind||"").indexOf("$$"),m=t.getSchema(a.$bind),v=void 0;m||f||console.log('Schema not found for field "'+a.$bind+'".'),a&&a.$lookup&&(v=t.getLookupForSchema(a.$bind,a.$lookup)),p=p?p(a,m,v):null}if(p){var g,y={context:t.options.context,design:t.options.design,replaceParent:!0,readOnly:a.$readOnly};if(h){if((g=new p(a,y,t)).isMeta()?u.push(g):a.$bind&&(d[a.$bind]=g),a.options&&a.options.autofocus&&(t._autofocus=g),g.getSubControls&&g.addSubControls){var _=g.getSubControls();_&&_.forEach(function(e){var n,i=0===(e.$bind||"").indexOf("$$"),o=t.getSchema(e.$bind);o||i||console.log('Schema not found for field "'+e.$bind+'".'),e&&e.$lookup&&(n=t.getLookupForSchema(e.$bind,e.$lookup));var r=new(l?l(e,o,n):null)(e,{context:t.options.context,design:t.options.design,replaceParent:!1,readOnly:e.$readOnly},t);r.isMeta()?u.push(r):e.$bind&&(d[e.$bind]=r),g.addSubControls(r)})}}else g=new p(a,y,t);var $=void 0;if(t.options.design||!a.$htmlParent)$=o.find(i,a.$id);else if($=o.find(i,a.$parentId+"_"+a.$htmlParent)){y.replaceParent=!1;var b=o.find(i,a.$id);b&&o.remove(b)}else $=o.find(i,a.$id);if(c.push({parent:$,control:g}),t.children[e]=g,t.controls[e]=g,g.resize&&(t.resizeList=t.resizeList||[],t.resizeList.push(g)),n.push(g),h&&g.getChildren){var x=g.getChildren();x&&x.forEach(function(e){c.push({parent:e.parent,control:e.control}),e.control.id=e.control.id||r.allocID(),t.children[e.control.id]=e.control,t.controls[e.control.id]=e.control,e.control.resize&&(t.resizeList=t.resizeList||[],t.resizeList.push(e.control))})}}}}}),u.forEach(function(e){var t=e.getCustomBind();if(t){var n=d[t];n&&e.setParentId(n.id)}}),c.forEach(function(e){"string"==typeof e.parent&&(e.parent=o.find(i,e.parent)),e.control.render($(e.parent)),e.control.afterAddedInDom&&(t.afterRenderList=t.afterRenderList||[],t.afterRenderList.push(e.control))})),n},e.prototype.addControl=function(e,t,n){},e.prototype._afterVisibilityChanged=function(e){this._refreshCurrentResizeList(),this._refreshStickies(e.resize)},e.prototype._refreshStickies=function(e){var t=this;if(t.stickies&&t.$element){var n={};Object.keys(t.stickies).forEach(function(e){var i=t.stickies[e];t._isVisible(i.$parentId)&&(n[i.$id]=i,!0)});var i=[];t.activeStickies&&Object.keys(t.activeStickies).forEach(function(e){n[e]?delete n[e]:i.push(t.activeStickies[e])}),t.activeStickies=t.activeStickies||{},i.forEach(function(e){delete t.activeStickies[e.id],u.stickyManager.remove(e.id)}),Object.keys(n).forEach(function(e){var i=n[e];if(i.$type===d.LAYOUT_BLOCK){var r=o.find(t.$element.get(0),i.$id);r&&(t.activeStickies[i.$id]={id:i.$id,element:r,position:i.$sticky},u.stickyManager.add(t.activeStickies[i.$id]))}}),e&&u.stickyManager.refresh(!0)}},e.prototype._refreshCurrentResizeList=function(){var e=this;e.resizeList?e.currentResizeList?(e.currentResizeList=[],e.resizeList.forEach(function(t){e._isVisible(t.config.$parentId)&&e.currentResizeList.push(t)})):e.currentResizeList=e.resizeList.map(function(e){return e}):e.currentResizeList=null},e.prototype._clearSticks=function(){this.stickies=null,this.activeStickies&&(Object.keys(this.activeStickies).forEach(function(e){u.stickyManager.remove(e)}),this.activeStickies=null)},e.prototype._clearChildren=function(){var e=this.children;this.children={},this.controls={},this._clearSticks(),this.resizeList=null,this.currentResizeList=null,this.afterRenderList=null,Object.keys(e).forEach(function(t){e[t].destroy()})},e.prototype._refreshSelected=function(){if(this.options.design){var e=c([this.map,this.mapFields]);this._onSelectedChanged(this.$element.get(0),e,!0)}},e.prototype.registerDataListener=function(e){this.page&&this.page.registerDataListener(e,this)},e.prototype.removeDataListener=function(e){this.page&&(e==this?this.page.removeParentDataListener(this):this.page.removeDataListener(e))},e.prototype.emitDataEvent=function(e,t,n){this.page&&this.page.emitDataEvent(e,t,n)},e.prototype.afterRender=function(e){},e.prototype._internalRender=function(e,t){var n=this;return n.$element||(n.$element=n._renderLayout(n.data),n.options.beforeAdd&&n.options.beforeAdd(n.$element,t),n.$content.append(n.$element),n._addEvents(),n._refreshSelected(),e&&(n.options.form||o.bodyTheme(n.data.$theme),n.options.replaceParent?e.replaceWith(n.$content):e.append(n.$content),n._afterVisibilityChanged({inDom:!1,resize:!0}),n.afterAddedInDom())),n.$content},e.prototype.afterAddedInDom=function(){var e=s.context();e.$url.$scroll&&this.scrollTo(e.$url.$scroll)},e.prototype._callInternalRender=function(e,t){this._internalRender(e,t)},e.prototype.render=function(e){var t,n=this;return n.$content?n.$element&&(t=!0,n._clearChildren(),n._removeEvents(),n.options.beforeRemove&&n.options.beforeRemove(n.$element),n.$element.remove(),n.$element=null):n.$content=$("<div></div>"),n._callInternalRender(e,t),n.$content},e.prototype._destroyDataSets=function(){},e.prototype.destroy=function(){var e=this;r.log("Destroy Layout","destroy"),e._destroyDataSets(),l.unlisten(e),e.removeDataListener(e),e._clearChildren(),e.page&&(e.page.removeChild(e),e.page=null),e.$element&&(e._removeEvents(),e.$element=null),e._autofocus=null,e.map=null,e.mapFields=null,e.namedMap=null,e.namedMapFields=null,e.autoClose=null,d.clearMeta(e.data,!1)},e.prototype.check=function(e,t){var n=this,i=!1;e||(n.map={},n.mapFields={},n.namedMap={},n.namedMapFields={},t=null,e=n.data,i=!0),d.check(e,t,n.map,n.mapFields,n.namedMap,n.namedMapFields),i&&(e.fields=n.mapFields,e.map=n.map)},e.prototype._afterStructureChanged=function(e){this.render()},e.prototype._afterPropsChanged=function(e){if(this.$element){var t=this.$element.get(0);if(t){var n=o.find(t,e.$id),i=e.$id!=e.$idStep2?o.find(t,e.$idStep2):null,r=e.$idStep3?o.find(t,e.idStep3):null;n&&d.updateCssClass(n,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:1}),i&&d.updateCssClass(i,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:2}),r&&d.updateCssClass(r,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:3}),e.selected&&this._refreshSelected()}}},e.prototype.removeChild=function(e){var t=this;if(e&&t.options.design){var n=t.map[e]||t.mapFields[e];if(n){var i=t.map[n.$parentId];if(i&&(!i.$auto||(n=i,i=t.map[n.$parentId]))){var o=i.$items.indexOf(n);i.$items.splice(o,1),d.clearMaps(n,this.map,this.mapFields,t.namedMap,t.namedMapFields),d.afterRemoveChild(i,t.map,t.mapFields,t.namedMap,t.namedMapFields),t._afterStructureChanged(i)}}}},e.prototype.setDesignMode=function(e){this.options.design!=e&&(this.options.design=e,this.render())},e.prototype.getLayoutById=function(e){if(!e)return null;return this.map[e]},e.prototype.getLayoutElementByName=function(e){if(!e)return null;var t=this.namedMap[e];return t&&this.$element?o.find(this.$element.get(0),t.$id):null},e.prototype.getLayoutByName=function(e){if(!e)return null;var t=this.namedMap[e];return t&&Array.isArray(t)?t[0]:t},e.prototype.getLayoutsByName=function(e){if(!e)return null;var t=this.namedMap[e];return t?Array.isArray(t)?t:[t]:null},e.prototype.scrollTo=function(e){var t=this.getLayoutByName(e);if(t&&this.$element){var n=o.find(this.$element.get(0),t.$id);n&&n.scrollIntoView({behavior:"smooth",block:"start"})}},e.prototype.getNamedLayouts=function(){return d.namesOfLayout(this.data)},e.prototype.getFieldById=function(e){if(!e)return null;return this.mapFields[e]},e.prototype.select=function(e){var t=this,n=t.$element;if(t.options.design){var i=c([t.map,t.mapFields]);if(i&&(i.selected=!1,t._showSelected(n,i),t._onSelectedChanged(n.get(0),i,!1),i.$id==e))t._onSelectedChanged(n.get(0),null,!0);else if(e){var o=t.map[e]?t.map[e]:t.mapFields[e];o&&(o.selected=!0,t._showSelected(n,o),t._onSelectedChanged(n.get(0),o,!0))}}},e.prototype.updateField=function(e,t){var n=this.mapFields[e];if(n)if(n.$render&&n.$config)Object.keys(t.$config).forEach(function(e){"form"!==e&&"data"!==e&&"datasets"!==e&&n.$render[e]!=t.$config[e]&&(n.$render[e]=t.$config[e])}),(n.$config.hasOwnProperty("form")||t.$config.hasOwnProperty("form"))&&(n.$config.form=t.$config.form),n.$config.datasets=t.$config.datasets,n.$config.data=t.$config.data,this._afterStructureChanged(null);else{if(r.equals(n,t))return;var i=Object.keys(t),o=Object.keys(n);i.forEach(function(e){n[e]=t[e]}),i.push("$id"),i.push("$parentId"),i.push("$idDrag"),o.forEach(function(e){i.indexOf(e)<0&&delete n[e]});var s=this.children[e];s&&(delete this.controls[e],delete this.children[e],s.destroy()),this._afterStructureChanged(null)}},e.prototype._cleanIds=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},e.prototype._blockToCols=function(e){var t=this;e.$items&&e.$items.forEach(function(n,i){var o=n.$origin||n.$type;if(o===d.LAYOUT_BLOCK||o===d.LAYOUT_COLUMN)n.$type=d.LAYOUT_COLUMN,t._cleanIds(e);else d.LAYOUT_COLUMN,n.$colSize,n.$customColSize})},e.prototype._changeType=function(e,t){var n=this,i=n.map[e.$parentId],o=i&&i.$auto?n.map[i.$parentId]:null;switch(e.$origin||e.$type){case d.LAYOUT_BLOCK:t===d.LAYOUT_ROW&&(e.$type=t,n._blockToCols(e),n._cleanIds(e),n.check(e,i));break;case d.LAYOUT_COLUMN:if(t===d.LAYOUT_ROW){var r={$items:e.$items,$type:t,selected:!1};e.$auto=!0,e.$type=d.LAYOUT_COLUMN,e.$items=[r],e.selected&&(e.selected=!1,r.selected=!0),n._blockToCols(r),n._cleanIds(e),n.check(e,i)}break;case d.LAYOUT_ROW:if(t===d.LAYOUT_BLOCK){if(o){var s=o.$items.indexOf(i);o.$items[s]=e,e.$type=i.$type,e.$parentId=o.$id,i.$type==d.LAYOUT_COLUMN&&(e.$colSize=i.$colSize,e.$customColSize=i.$customColSize),i=o}else e.$type=t;e.$origin&&delete e.$origin,e.$items&&e.$items.forEach(function(t,i){if(t.$type)if(t.$auto){var o=t.$items[0];o.$colSize=t.$colSize,o.$customColSize=t.$customColSize,o.$parentId=e,e.$items[i]=o,n._cleanIds(t)}else t.$type=d.LAYOUT_BLOCK,n._cleanIds(t)}),n._cleanIds(e),n.check(e,i)}break;case d.LAYOUT_ACCORDION:}},e.prototype.updateIsHidden=function(e,t){e.$isHidden!==t&&(e.$isHidden=t,this._afterPropsChanged(e),t||this._activateLayout(e,!0))},e.prototype.updateLayout=function(e,t){var n=this,i=n.map[e],o=!1,s=!1,a=!1;if(i){if(delete t.onlyFields,t.$type){var u=i.$origin||i.$type;t.$type!==u&&(n._changeType(i,t.$type),delete t.$type,o=!0)}if(t.parent){var c=n.map[i.$parentId];n._disableRules=!0,Object.keys(t.parent).forEach(function(e){t.parent[e]!==c[e]&&(c[e]=t.parent[e],o=!0)}),n._disableRules=!1,delete t.parent}if(delete t.selected,n._disableRules=!0,i.$title&&!t.$title?(delete i.$title,o=!0):!i.$title&&t.$title?(delete i.$title,i.$title=t.$title,delete t.$title,o=!0):i.$title&&t.$title&&(Object.keys(t.$title).forEach(function(e){t.$title[e]!=i.$title[e]&&(i.$title[e]=t.$title[e],o=!0)}),delete t.$title),(i.$inline||!1)!==(t.$inline||!1)&&(i.$inline=t.$inline,s=!0,i.$items.length&&(o=!0),delete t.$inline),r.equals(i.$fieldsOptions,t.$fieldsOptions)||(i.$fieldsOptions=t.$fieldsOptions,s=!0,i.$items.length&&(o=!0)),delete t.$fieldsOptions,(i.$refProperty||"")!==(t.$refProperty||"")&&(i.$refProperty=t.$refProperty,o=!0),(i.$refController||"")!==(t.$refController||"")&&(i.$refController=t.$refController,o=!0),(i.$sticky||"")!==(t.$sticky||"")&&(i.$sticky=t.$sticky,o=!0),(i.$forceTable||!1)!==(t.$forceTable||!1)&&(i.$forceTable=t.$forceTable,i.$type===d.LAYOUT_ROW&&i.$forceTable||delete i.$forceTable,o=!0),(i.$ref||"")!==(t.$ref||"")&&(i.$ref=t.$ref,i.$ref?(delete i.name,delete i.form,delete i.$fieldsOptions,a=!0):(delete i.$refProperty,delete i.$refController,delete i.name,delete i.form),i.$items=[],o=!0),delete t.$ref,delete t.$refProperty,delete t.$refController,delete t.$sticky,delete t.$forceTable,(i.$widget||"")!==(t.$widget||"")&&(i.$widget=t.$widget,o=!0),delete t.$widget,(i.$bindPages||"")!==(t.$bindPages||"")&&(i.$bindPages=t.$bindPages,o=!0),delete t.$bindPages,Object.keys(t).forEach(function(e){t[e]!==i[e]&&(i[e]=t[e],s=!0)}),n._disableRules=!1,o){if(a)return l.emit("LoadNestedLayouts",{data:i,after:function(e){r.merge(e,i);var t=n.map[i.$parentId];n._cleanIds(i),n.check(i,t),n._afterStructureChanged(i)}});n._afterStructureChanged(i)}else s?n._afterPropsChanged(i):n._refreshSelected()}},e}();t.BaseLayout=p;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ds_init=function(e){return!1},t.prototype.ds_storeLastEvent=function(e,t){},t.prototype.ds_LastEvent=function(){return null},t.prototype.ds_destroy=function(){},t.prototype.ds_context=function(){return null},t.prototype.ds_reemit=function(e,t){return null},t.prototype.ds_select=function(e,t){},t.prototype.ds_loaded=function(e,t){},t.prototype.ds_exec=function(e,t,n,i,o,r){},t.prototype.pageLayoutInit=function(){var e=this;e.loadingHandler=null,e.noDataHandler=null,e.errorHandler=null,e.emitHandler=null,e.getLocalContextHandler=null,e.dataChangedHandler=null,e.updateMenuHandler=this.updateMenu.bind(e),e._removeMenus(),e.ds_init&&e.ds_init(e.data)&&e.registerDataListener(e)},t.prototype._doDatasetEventAfterEnabled=function(e){if(e.ds_LastEvent&&e.dataEvent){var t=e.ds_LastEvent();t&&e.dataEvent(t.event,t.value)}},t.prototype._refreshDataSets=function(e){if(this.page){var t=this._getEventListFor(e);if(t.length)this.page.emittersFor(t).forEach(function(t){t.ds_reemit&&t.ds_reemit(e,function(){})})}},t.prototype._callInternalRender=function(e,t){var n=this;n.datasets&&n.ds_exec?n.ds_exec("$load",null,n.props.data.ds,function(i,o){if(o)throw o.message;n._internalRender(e,t)},null,!0):n._internalRender(e,t)},t.prototype._destroyDataSets=function(){this.ds_destroy&&this.ds_destroy()},t.prototype._removeMenus=function(){var e=this;["left","right","top","bottom"].forEach(function(t){if(!e.data.$menus||!e.data.$menus[t]){var n=e.page.childByType("menu-"+t);n&&n.setMenu(null)}})},t.prototype.updateMenu=function(e,t){r.log("From Layout Update Menu : "+(t?t.name:"null"),"menu");var n=this.page.childByType("menu-"+e);if(n)n.setMenu(t);else{var o=null;if("right"==e?o=i.Menuright:"left"==e&&(o=i.Menuleft),o){var s={type:e,bodyId:null,parentId:null},a=this.page.childByType("header");a&&(a.options.bodyId&&(s.bodyId=a.options.bodyId),a.options[s.type+"MenuPlace"]&&(s.parentId=a.options[s.type+"MenuPlace"])),n=new o(t,s)}}},t}(p);t.PageLayout=h,r.applyMixins(h,[e.DatasetPlugin.DatasetMethods]);var f=function(e){function t(t,n,i,o,r,s){return e.call(this,t,n,i,o,r,s)||this}return __extends(t,e),t}(h);t.Layout=f,t.LayoutClass=f}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){var t=e,n=(t.ulocale,t.utils),i=(t.locale,t.pagecontrol),o=t.dom;t.ui;!function(e){e.SCREEN_CENTER="screencenter",e.SCREEN_TOP_CENTER="screentopcenter",e.BOTTOM_LEFT="bottom-left",e.BOTTOM_RIGHT="bottom-right";var t=function(){function t(e,t){var o=this;o._align=e,o.id=n.allocID(),t=t||t,o._checkOptions(t),o._width=t.width,o._height=t.height,o._minWidth=t.minWidth,o._minHeight=t.minHeight,o._style=t.style,o._beforeClose=t.beforeClose,o._contentRender=t.contentRender,o._autocloseParents=t.parents||[],o.opener=t.opener,o.stayOnTop=t.stayOnTop,t.alignElement&&(o.$alignElement=$(t.alignElement)),o.$parent=$(t.parent),o._page=i.Page(),o._resize=o.resize.bind(o)}return t.prototype.resize=function(){this._setMinWidthAndMinHeight(),this._alignElement()},t.prototype.destroy=function(){var e=this;$(window).off("global-phoenix-resize",e._resize),e._autocloseParents=null,e.$element=null,e.$parent=null,e.$alignElement=null,e._beforeClose=null,e._contentRender=null,e._page=null,e.renderControl&&(e.renderControl.destroy&&e.renderControl.destroy(),e.renderControl=null)},t.prototype.inPopup=function(e){for(var t=0,n=this._autocloseParents.length;t<n;t++){var i=this._autocloseParents[t],r=o.find(null,i);if(r&&o.isChildOf(r,e))return!0}return!1},t.prototype._checkOptions=function(t){if(t.parent=t.parent||document.body,t.alignElement||(t.parent=document.body,t.alignElement=null,this._align!==e.SCREEN_TOP_CENTER&&(this._align=e.SCREEN_CENTER)),this._align!==e.SCREEN_TOP_CENTER&&this._align!==e.SCREEN_CENTER&&!t.alignElement)throw"Align element is null";if(!t.contentRender)throw"Invalid content render"},t.prototype._alignXScreenCenter=function(){var e=this.$element.get(0),t=o.offset(e),n=o.offset(e.parentNode);e.style.left=Math.floor(Math.max((n.width-t.width)/2,0))+"px"},t.prototype._alignYScreenCenter=function(){var e=this.$element.get(0),t=o.offset(e),n=o.offset(e.parentNode);e.style.top=Math.floor(Math.max((n.height-t.height)/2,0))+"px"},t.prototype._alignTopScreen=function(){this.$element.get(0).style.top="0px"},t.prototype._alignScreenTopCenter=function(){this._alignXScreenCenter(),this._alignTopScreen()},t.prototype._alignScreenCenter=function(){this._alignXScreenCenter(),this._alignYScreenCenter()},t.prototype._alignBottomLeft=function(){var e=this.$element.get(0),t=this.$alignElement.get(0),n=o.documentClientDim(),i=o.offset(e),r=o.offset(t),s=o.documentScroll(),a=o.documentViewSize(),l=Math.round(r.top+r.height)-1;l+i.height>s.top+a.height&&(l=s.top+a.height-i.height),e.style.top=Math.max(0,Math.round(Math.max(s.top,l)))+"px";var u=r.left;u+i.width>n.width&&(u=Math.max(0,n.width-i.width)),e.style.left=u+"px"},t.prototype._alignBottomRight=function(){var e=this.$element.get(0),t=this.$alignElement.get(0),n=o.documentClientDim(),i=o.offset(e),r=o.offset(t);e.style.top=Math.max(0,Math.round(r.top+r.height)-1)+"px";var s=Math.max(0,Math.round(n.width-r.left-r.width));s+i.width>n.width&&(s=Math.max(0,n.width-i.width)),e.style.right=s+"px"},t.prototype._alignElement=function(){this._align===e.SCREEN_CENTER?this._alignScreenCenter():this._align===e.SCREEN_TOP_CENTER?this._alignScreenTopCenter():this._align===e.BOTTOM_LEFT?this._alignBottomLeft():this._align===e.BOTTOM_RIGHT&&this._alignBottomRight()},t.prototype._setMinWidthAndMinHeight=function(){var e=this.$element.get(0);this._minWidth&&"auto"!==this._minWidth&&(e.style.minWidth=o.checkSize(this._minWidth)),this._minHeight&&"auto"!==this._minHeight&&(e.style.minHeight=o.checkSize(this._minHeight))},t.prototype._setHeightAndWidth=function(){var e=this.$element.get(0);this._setMinWidthAndMinHeight(),this._width&&"auto"!==this._width&&(e.style.width=o.checkSize(this._width)),this._height&&"auto"!==this._height&&(e.style.height=o.checkSize(this._height))},t.prototype.open=function(){var e=this,t=["bs-autoclose","bs-autoclose-hidden"];e._style=e._style||"modal-content",e._style&&o.parseStyle(e._style,t),e.$element=$('<div id="'+e.id+'" class="'+t.join(" ")+'"><div></div></div>'),e._autocloseParents.push(e.id);var n=e.$element.get(0),i=e.$parent.get(0);e._setHeightAndWidth(),o.append(i,n),e._contentRender($(n.firstChild),e,function(t){if(t)return console.log(t),void e.destroy();e._alignElement(),o.removeClass(n,"bs-autoclose-hidden"),e._page.setPopup(e),$(window).on("global-phoenix-resize",e._resize)})},t.prototype.hide=function(e){this._beforeClose&&this._beforeClose();var t=this.$element.get(0);o.remove(t),this.$element=null,this.destroy()},t}();e.open=function(e,n){new t(e,n).open()}}(e.autoclose||(e.autoclose={}))}(Phoenix||(Phoenix={})),function(e){!function(e){var t=e.SchemaUtils,n=function(){function e(e,t,n){this.isState=!0}return e.prototype.destroy=function(){this._state&&(this._state=null),this.parent=null},e.prototype.state=function(){return this._state},e.prototype._init=function(e,t,n,i){var o=this;i=i||[],o._state=n||{},o.name=t,o.parent=e,i.forEach(function(e){void 0===o._state[e]&&(o._state[e]=!1),Object.defineProperty(o,e,{get:function(){return this._state[e]||!1},set:function(t){if((this._state[e]||!1)!==t){if(this._state[e]=t,"filter"===e&&this.parent){var n=this.parent.getValue(o.name),i=this.parent.getSchema(o.name);if(i&&i.enum&&i.filters){var r=t?i.filters[t]:i.enum;if(r)r.indexOf(n)<0&&this.parent.setValue(o.name,r.length?r[0]:null)}}this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(o.name+"."+e,{})}},enumerable:!0})})},e}();e.BaseState=n;var i=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o._init(t,n,i,null),o}return __extends(t,e),t.prototype._init=function(e,t,n,i){this._state=n||{},this.name=t,this.parent=e},Object.defineProperty(t.prototype,"columns",{get:function(){return(this.parent[this.name].columns||[]).join(",")},set:function(e){var t=this.parent[this.name];(t.columns||[]).join(",")!==(e=e||"")&&(t.columns=e?e.split(","):void 0,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".columns",{}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this.parent[this.name].getSelectedItems().join(",")},set:function(e){var t=this.parent[this.name],n=t.getSelectedItems().join(",").split(",").sort(),i=(e||"").split(",").sort().join(",");n.join(",")!==i&&t.setSelectedItems(JSON.parse("["+i+"]"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orderBy",{get:function(){return this._orderBy},set:function(e){this._orderBy!==e&&(this._orderBy=e,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".orderBy",{}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){this._filter!==e&&(this._filter=e,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".filter",{}))},enumerable:!0,configurable:!0}),t}(n);e.ListStates=i;var o=function(e){function n(n,i,o){var r=e.call(this,n,i,o)||this,s=n.getSchema("").properties[i],a=t.states;if(s){var l=t.stateProps(s);l&&l.length&&(a=l.concat(a))}return r._init(n,i,o,a),r}return __extends(n,e),n}(n);e.DataStates=o;var r=function(e){function n(n,i,o){var r=e.call(this,n,i,o)||this,s=i;return s.indexOf(".$links")<0&&(s="$links."+i),r._init(n,s,o,t.linksStates),r}return __extends(n,e),n}(n);e.LinkStates=r}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i=e.utils;t=e.Observable||(e.Observable={}),n=function(){function e(e,t,n){this._init(e,t,n),this.isArray=!0}return e.prototype.destroy=function(){this._errors&&(this._errors=null),this.parent=null},e.prototype.errors=function(){return this._errors.slice()},Object.defineProperty(e.prototype,"length",{get:function(){return this._errors?this._errors.length:0},enumerable:!0,configurable:!0}),e.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!this._errors)return null;for(var i=e.split(","),o=i.length,r=0,s=this._errors.length;r<s;r++){for(var a=!0,l=this._errors[r],u=0;u<o;u++)if(t[u]!==l[i[u]]){a=!1;break}if(a)return l}return null},e.prototype.clear=function(e){return!!this._errors.length&&(this._errors.length=0,e&&this.notify(),!0)},e.prototype.hasErrors=function(){return!(!this._errors||!this._errors.length)},e.prototype.rmvError=function(e){if(this._errors&&this._errors.length){var t=this._errors.findIndex(function(t){return"error"===t.severity&&t.message===e});t>=0&&(this._errors.splice(t,1),this.notify())}},e.prototype.rmvErrorById=function(e){if(this._errors&&this._errors.length){var t=this._errors.findIndex(function(t){return t.id===e});t>=0&&(this._errors.splice(t,1),this.notify())}},e.prototype.addErrors=function(e){this._errors=this._errors||[],e&&e.length&&(e.forEach(function(e){e.id=e.id||i.allocUuid()}),this._errors=this._errors.concat(e),this.notify())},e.prototype.push=function(e){this.addErrors([e])},e.prototype.remove=function(e){if(this._errors){var t=this._errors.indexOf(e);t>=0&&(this._errors.splice(t,1),this.notify())}},e.prototype.addError=function(e,t){this.addErrors([{severity:"error",message:e,id:t||i.allocUuid()}])},e.prototype.addSuccess=function(e,t){this.addErrors([{severity:"success",message:e,timeout:2,id:t||i.allocUuid()}])},e.prototype.addWarning=function(e,t){this.addErrors([{severity:"warning",message:e,timeout:2,id:t||i.allocUuid()}])},e.prototype.notify=function(){this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".errors",{})},e.prototype._init=function(e,t,n){this._errors=n||[],this.name=t,this.parent=e},e}(),t.Errors=n,t.errorsUtils={errorChanged:function(e,t){if(e=e||[],t&&t.length){if(e.length!=t.length)return!0;for(var n=!1,i=0,o=e.length;i<o;i++){var r=e[i],s=t[i];if(r.code&&s.code){if(r.code!==s.code){n=!0;break}}else{if(!r.code||!s.code){n=!0;break}if(r.message!==s.message){n=!0;break}}}return n}if(e.length)return!0}}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l;t=e.Observable||(e.Observable={}),n=e.utils,i=e.dom,o=e.application,r=e.data.odata,t.SchemaUtils,s=t.DataUtils,a=e.DatasetPlugin,l=function(){function t(e,t){if("odata"!==e.$type&&"relation"!==e.$type)throw new Error("Only odata sources are supported.");var n=this,i=e.$params&&e.$params.$type?e.$params.$type:"odata";if(((o.config(o.name)||{})[i]||{}).array&&(n._noPageCount=!0),n._config=e,n._origFilter=n._config.$params.$filter,n._config.$params.$searchByFields&&(n._search=n._config.$params.$searchByFields.value,n._searchFields=n._config.$params.$searchByFields.fields),n._pageSize=0,n._model=t,n._currentPage=1,n._hasPrev=!1,n._hasNext=!1,!n.isQuery())throw"Invalid Queryable DataSource";n._pageSize=n._config.$params.$top||0,n._orderby=n._config.$params.$orderby||""}return t.prototype.initPagination=function(e,t,n,i,o,r){this._pageSize=e,this._noPageCount=r,this._noPageCount?(this._hasNext=i,this._hasPrev=o):this._totalCount=n,this._currentPage=t},t.prototype.initFromData=function(e){var t=this;if(t.isQuery()&&(t._pageSize=e.pageSize,t._noPageCount=e._noPagesCount,t._currentPage=t._pageSize?Math.ceil(e.skip/t._pageSize)+1:0,t._noPageCount?(t._hasPrev=e._hasPrev,t._hasNext=e._hasNext):t._totalCount=e.count,t._skip=e.skip,e.uri)){var n=t._model.parent;n.hasOwnProperty("uri")&&(n.uri=e.uri),n.hasOwnProperty("search")&&(n.search=e.search)}},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){var t=this;t._filter=e,t._filter&&t._filter.value?t._origFilter?t._config.$params.$filter={$left:t._origFilter,$op:"AND",$right:t._filter.value}:t._config.$params.$filter=t._filter.value:t._origFilter?t._config.$params.$filter=t._origFilter:t._config.$params.$filter=null,t.refresh(!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"search",{get:function(){return this._search},set:function(e){e!==this._search&&(this._search=e,this._config.$params.$searchByFields={fields:this._searchFields,value:e},this._searchFields&&this.refresh(!0,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchFields",{get:function(){return this._searchFields},set:function(e){if(e.join("$$$")!==this._searchFields.join("$$$")){var t=!!this._search;this._search="",this._searchFields=e,this._config.$params.$searchByFields={fields:this._searchFields,value:e},t&&this.refresh(!0,!1)}},enumerable:!0,configurable:!0}),t.prototype.pageSize=function(){return this.isQuery()?this._pageSize:0},t.prototype.orderBy=function(e){return void 0===e?this._orderby:(e!==this._orderby&&(this._orderby=e,this.refresh(!0,!1)),this._orderby)},t.prototype.refresh=function(e,t){var i=this;return new n.Promise(function(n,o){i.isQuery()?(e&&(i._currentPage=0),i._open(t).then(function(){i._model.notifyPaginationChanged(),i._model.notifySortingChanged(),n()})):n()})},t.prototype.currentPage=function(e){var t=this;if(void 0!==e){if(t.isQuery()){var n=t.noPagesCount()?e:Math.min(e,t.totalPages());t._currentPage!==n&&(t._currentPage=n,t._open(!1).then(function(){t._model.notifyPaginationChanged()}))}return e}return t.isQuery()?t._currentPage:0},t.prototype.totalPages=function(){return this.isQuery()&&!this._noPageCount?this._pageSize?Math.ceil(this._totalCount/this._pageSize):1:0},t.prototype.totalCount=function(){return this.isQuery()&&!this._noPageCount?this._totalCount:0},t.prototype.noPagesCount=function(){return this._noPageCount},t.prototype.hasNext=function(){return this._hasNext},t.prototype.hasPrev=function(){return this._hasPrev},t.prototype.destroy=function(){this._config=null,this._model=null},t.prototype.isQuery=function(){return s.isQuery(this._config)},t.prototype.open=function(){return this._open(!0)},t.prototype.remove=function(e,t){var o=this;return o.isQuery()?new n.Promise(function(n,r){var s={name:"data",$type:o._config.$type,$method:"DELETE",$params:{$module:o._config.$params.$module,$entity:o._config.$params.$entity,$entityId:e}};i.processing(!0),a.executeDatasets([s],{etag:t},{},{},function(e,t){i.processing(!1),t?o._model?(o._model.addAjaxException(t),r(null)):r(t):n(null)})}):null},t.prototype._applyFilters=function(){var e=this._model.allData;return r.applyFilters(e,this._search,this._searchFields,this._skip,this._pageSize,this._orderby)},t.prototype._open=function(t){var o=this;return o._config.name="data",new n.Promise(function(n,r){i.processing(!0);var s=o.isQuery(),l={};s&&(o._orderby&&o._config.$params.$orderby!==o._orderby&&(o._config.$params.$orderby=o._orderby),o._pageSize>0?(o._config.$params.$top=o._pageSize,o._config.$params.$skip=Math.max(0,o._currentPage-1)*o._pageSize,0==o._config.$params.$skip&&delete o._config.$params.$skip,o._skip=o._config.$params.$skip):(delete o._config.$params.$top,delete o._config.$params.$skip));var u=o._config;if(!t&&s&&o._config.$params.$allData&&o._model.allData){var d=o._applyFilters();return e.dom.processing(!1),o.initFromData(d),o._model.setModel(d.documents),void n(d)}a.executeDatasets([u],o._model.parent.model(!0)||{},l,{},function(e,a){if(i.processing(!1),a)o._model?(o._model.addAjaxException(a),r(null)):r(a);else{var u=l.data;if(o.initFromData(u),s&&o._skip&&!o._noPageCount&&o._skip>=o._totalCount)return o._currentPage=0,o._open(t).then(function(e){n(e)});s&&o._config.$params.$allData&&(o._model.allData=u._allData),o._model&&(s?o._model.setModel(u.documents):o._model.setModel(u)),n(u)}})})},t.prototype.save=function(){this.isQuery()||this._model.validate()},t}(),t.QueryableDataSource=l}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c;t=e.rules||(e.rules={}),n=e.Observable,i=n.SchemaUtils,n.DataUtils,e.locale,o=e.ulocale,r=e.utils,s={},a=function(e,t){return(t=t||{}).isPropagation&&(e=e.replace(/sum\(\s*([^)]+?)\s*\)/g,function(e,t){var n=t.split(/\s*,\s*/);if(n&&1===n.length){var i=n[0].split("."),o=i.pop();return"sum("+i.join(".")+", '"+o+"')"}return e})),e},l=function(e,t,n,i){try{e.code||(e.code=new Function("o","ctx","window",a(e.expression,{isPropagation:!0})),e.conditionCode=e.condition?new Function("o","ctx","window","return "+a(e.condition,{isPropagation:!1})):null);var o=!0;if(e.conditionCode&&(o=e.conditionCode(t,n,null)),o){var s=t.getRootModel();r.logRule(s._callStack?s._callStack.length:0,e,i,t.className||""),e.code(t,n,null)}}catch(n){u(n,e,t.getRootModel())}},u=function(e,t,n){"string"==typeof e&&(e={message:e});var i=r.format("Rule '{0}'  {1}:",t.name,t.description||"");n.addError([i,e.message||""].join("\n"))},d=function(e){var t={today:o.date2ISO(new Date),now:function(){return(new Date).toISOString()},addHours:function(e,t){var n=o.parseISODateTime(e);if(null!==n)return n.setTime(n.getTime()+60*t*60*1e3),n.toISOString()},isTriggeredBy:function(e){return!1},sum:function(e,t){var n=0;return e&&e.forEach(function(e,i,o){n+=e[t]||0},""),n},safeDivide:function(e,t,n){return t=t||0,e=e||0,0===parseFloat(t.toFixed(8))?n||0:e/t},partition:function(e,t,n,i){var o=-1,r=-1,s=e=e||0,a=0;if(t.forEach(function(e,t,n){var s=e[i]||0;Math.abs(s)>o&&(o=Math.abs(s),r=t),a+=s}),0!==(a=parseFloat(a.toFixed(8)))&&r>=0&&(t.forEach(function(t,o,r){var l=t[i]||0;t[n]=e*l/a,s-=t[n]}),0!==(s=parseFloat(s.toFixed(8))))){var l=t.get(r);l[n]=(l[n]||0)+s}},utc:function(e){if(!e)return 0;var t=o.parseISODateTime(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},milliseconds2Hours:function(e){return e/36e5},date:function(e){return o.parseISODateTime(e)}};return Object.keys(s).forEach(function(e){t[e]||(t[e]=s[e])}),t},c=function(e,t,n){return r.execAngularExpression(e,{o:n||{},ctx:t})},t.execInitRules=function(e){var t,n,i=e.getRootModel().getSchema("");if(e.$create?(t=i.rules&&i.rules.created?i.rules.created[e.className]:null,n="$events.created"):(t=i.rules&&i.rules.loaded?i.rules.loaded[e.className]:null,n="$events.loaded"),t){var o=d(e.getRootModel());t.forEach(function(t){return l(i.rulesMap[t],e,o,n)})}},t.execBeforeSaveRules=function(e){var t=e.getRootModel().getSchema(""),n=t.rules&&t.rules.saving?t.rules.saving[e.className]:null;if(n){var i=d(e.getRootModel());n.forEach(function(n){return l(t.rulesMap[n],e,i,"$events.saving")})}},t.execPropChangeRules=function(e,t,n,i){e.callStack=e.callStack||[];var o=t;e.callStack.push(o);try{if(e.$schema.rules&&(e.$schema.rules.validation&&i.validations||e.$schema.rules.propagation&&i.propagations)){var s=t.split("."),p=s.pop();if("$"===p.charAt(0))return;for(var h=[p],f=n.instance,m=f,v=d(),g=function(){var t=i.propagations&&e.$schema.rules.propagation?e.$schema.rules.propagation[f.className]:null,n=h.join("."),o=t?t[n]:null;o&&o.forEach(function(t){return l(e.$schema.rulesMap[t],f,v,n)}),(o=(t=i.validations&&e.$schema.rules.validation?e.$schema.rules.validation[f.className]:null)?t[n]:null)&&o.forEach(function(t){var i=e.$schema.rulesMap[t];try{if(!i.code){var o="return ";i.expression.indexOf(o)>=0&&(o=""),i.code=new Function("o","ctx","window",o+a(i.expression,{isPropagation:!1})),i.conditionCode=i.condition?new Function("o","ctx","window","return "+a(i.condition,{isPropagation:!1})):null}var s=i.triggers.length>1,l=!0;i.conditionCode&&(l=i.conditionCode(f,v,null)),l&&r.logRule(e.callStack?e.callStack.length:0,i,n,f.className||""),!l||i.code(f,v,null)?s?e.rmvError(c(i.errorMsg,v,f)):m.$errors[p].rmvError(c(i.errorMsg,v,f)):s?e.addError(c(i.errorMsg,v,f)):m.$errors[p].addError(c(i.errorMsg,v,f))}catch(t){u(t,i,e)}});var d=s.pop();d&&"$"===d.charAt(0)&&(d=s.pop()),d&&h.unshift(d),f=f.parent};f;)g()}}finally{e.callStack.pop(),e.callStack.length||(e.callStack=null)}},t.execValidationRules=function(e,t){if(!e.className)return!1;var n=e.getRootModel();if(!n.$schema.rules||!n.$schema.rules.validation||!n.$schema.rules.validation[e.className])return!1;var o=Object.keys(n.$schema.rules.validation[e.className]),s=d(),l=!1;return o.forEach(function(o){if(t&&t.indexOf(o)<0)return!1;var d=n.$schema.rules.validation[e.className][o];d&&d.forEach(function(t){var d=n.$schema.rulesMap[t];try{if(!d.code){var p="return ";d.expression.indexOf(p)>=0&&(p=""),d.code=new Function("o","ctx","window",p+a(d.expression,{isPropagation:!1})),d.conditionCode=d.condition?new Function("o","ctx","window","return "+a(d.condition,{isPropagation:!1})):null}var h=!0;if(d.triggers.length&&d.triggers.forEach(function(t){0!==t.indexOf("$events.")&&h&&(h=i.hasProperty(t,e.$schema,n.$schema))}),!h)return;var f=d.triggers.length>1,m=!0;d.conditionCode&&(m=d.conditionCode(e,s,null)),m&&r.logRule(n.callStack?n.callStack.length:0,d,o,e.className||""),!m||d.code(e,s,null)?f?n.rmvError(c(d.errorMsg,s,e)):e.$errors[o].rmvError(c(d.errorMsg,s,e)):(l=!0,f?n.addError(c(d.errorMsg,s,e)):e.$errors[o].addError(c(d.errorMsg,s,e)))}catch(e){u(e,d,n)}})}),l},t.injectInContext=function(e,t){s[e]=t}}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e,i=n.application,o=t,r=n.rules,s=o.SchemaUtils,a=o.DataUtils,l=e.utils,u=n.jsonpatch,d=(r=n.rules,e.ajax),c=e.locale,p=e.ulocale,h=e.locale.schema,f={setValue:function(e,t,n,i){n.setValue(e,t,i)},getValue:function(e,t,n){return t.getValue(e,n)},getState:function(e,t,n){return t.getState(e,n)},_segment2Id:function(e){var t=parseInt(e,10);return t+""!==e&&(t=e),t},_resolveJSONPatchSegment:function(e,t,n){if(t.isArray){if("$links"===e)return{value:t.$links,useId:n};var i=f._segment2Id(e);return{value:t.find("id",i),useId:n}}return{value:t[e],useId:n}},getJSONPatchParent:function(e,t){var n=e.split("/");n.shift();var i={lastSegment:n.pop(),value:null,type:0};if(e.indexOf("$states")>=0)i.type=2;else if(e.indexOf("$errors")>=0)i.type=3;else if(e.indexOf("$links")>=0){i.type=1;var o=n.pop(),r=o.split(".");if(r.length>1){var s=r.shift();o=r.join(".");var a=n.pop();n.push(s),n.push(a)}n.push(o)}for(var l=t,u=!0;n.length;){var d=f._resolveJSONPatchSegment(n.shift(),l,u);if(u=d.useId,!(l=d.value))break}if(l){var c=l[i.lastSegment];c&&c.isArray&&(i.lastSegment="",l=c)}return i.value=l,i},_resolveSegment:function(e,t,n,i,o,r){return"$item"!==e?"$selected"===e?(r&&(n[e]=o),n[e]):"$new"===e?(r&&(n[e]=o),n[e]):n&&n[e]&&"function"==typeof n[e]?r?n[e](o):n[e]():(r&&(n[e]=o),n[e]):i?i[t]:void 0}},m=function(){function e(e,t,n,i,r,a,l,u){var d=this;if(d.isArray=!0,d._map={},d._expanded=!1,d.isQuery=l,d._selectedUids=[],d._selectedPks=[],d.isNull=!1,d.isUndefined=!0,d._model=void 0,d._items=[],d._path=n,d._parent=t,d._parentSelected=u,d._locale=a,d._arrayParent=r,d._rootSchema=d._parent.getRootModel().getSchema(""),d._schema=s.expand$Ref(e,d._rootSchema),d._schemaItems=s.expand$Ref(d._schema.items,d._rootSchema),d.frozen=!1,d.$links={},d._schema.links){var c=d._parent.model(!0);Object.keys(d._schema.links).forEach(function(e){var t=$.extend({},d._schema.links[e]),i=n+"."+e;c.$links=c.$links||{},c.$links[i]=$.extend(t,c.$links[i]||{}),d.$links[e]=new o.LinkStates(d.parent,n+".$links."+e,c.$links[i])})}d._setModel(i,!0)}return e.prototype.selecting=function(e,t){var n=this;if(n._schema.syncSelected)if(e)n._simulateSelecting=!0,n._savedSelectedUids=n._selectedUids.slice();else{var i=n._selectedPks.slice();n._selectedUids=[],n._selectedPks=[];var o={};n._savedSelectedUids.forEach(function(e){o[e]=!0});var r=null;if(n._schemaItems.primaryKey){var a=!1;r=s.pkFields(n._schemaItems.primaryKey),n.forEach(function(e){o[e.$id]?(e.internalSetSelected(!0)&&(a=!0),n._selectedUids.push(e.$id),r&&n._selectedPks.push(s.pk2Id(s.extractPkValue(e,r),r))):e.internalSetSelected(!1)&&(a=!0)},t),n._savedSelectedUids=null,n._simulateSelecting=!1,a&&n._parent.execSyncAction(n.getJSONPatchPath()+".$selected",i.join(","))}}},Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},set:function(e){this._columns=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manageSelecting",{get:function(){return this._selecting&&!this._multiselect&&!1!==this.schema.autoSelect&&!this.schema.syncSelected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowSelecting",{get:function(){return this._selecting},set:function(e){this._selecting=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiselect",{get:function(){return this._multiselect},set:function(e){this._multiselect=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expandingProperty",{get:function(){return this._expandingProperty},set:function(e){this._expandingProperty=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simulateSelecting",{get:function(){return this._simulateSelecting},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$selected",{get:function(){return this._parentSelected?this._parentSelected.$selected:this._selected},set:function(e){this._setSelected(e,!0)},enumerable:!0,configurable:!0}),e.prototype._setSelected=function(e,t){var n=this;if(n._parentSelected)n._parentSelected._setSelected(e,t);else if(n._selected!==e){var i=n._selected;n._selected=e,t&&n._parent&&!n.simulateSelecting&&n._parent.notifyChanged(n._path+".$selected",i,n._selected,"propchange",{checkChildren:!0,instance:n._parent},!1)}},e.prototype.enumSelectedItems=function(e,t){},e.prototype.getJSONPatchPath=function(e){return e=e?this.path+"."+e:this.path,this.parent.getJSONPatchPath(e)},e.prototype.getFullPath=function(){return this.parent.getPropertyPath(this.path)},e.prototype._rmvSelected=function(e,t){var n=this;if(n._parentSelected)n._parentSelected._rmvSelected(e,t);else if(n._selected===e){var i=null,o=n._selected;n._schema&&n._schema.children&&n.enumSelectedItems(n._schema.children,function(e){i||(i=e)}),n._selected=i,t&&n._parent&&!n.simulateSelecting&&n._parent.notifyChanged(n._path+".$selected",o,n._selected,"propchange",{checkChildren:!0,instance:n._parent},!1)}},e.prototype.pushSelected=function(e,t){var n=e.$id,i=this._selectedUids.indexOf(n);if(i<0&&this._selectedUids.push(n),this._schemaItems.primaryKey){var o=s.pkFields(this._schemaItems.primaryKey);n=s.pk2Id(s.extractPkValue(e,o),o),(i=this._selectedPks.indexOf(n))<0&&this._selectedPks.push(n)}this._setSelected(e,t)},e.prototype.model=function(e){return this._getModel(e)},e.prototype.schemaModel=function(){return this._model},e.prototype._getModel=function(e){return this._model},e.prototype._initModelInParent=function(){this._model||(this._model=[],this.isNull=!1,this.isUndefined=!1,this._parent&&(this._parent.model(!0)[this._path]=this._model))},e.prototype.removeSelected=function(e,t){var n=this._selectedUids.indexOf(e.$id);if(n>=0&&this._selectedUids.splice(n,1),this._schemaItems.primaryKey){var i=s.pkFields(this._schemaItems.primaryKey),o=s.pk2Id(s.extractPkValue(e,i),i);(n=this._selectedPks.indexOf(o))>=0&&this._selectedPks.splice(n,1)}this._rmvSelected(e,t)},e.prototype.notifyChangedProperty=function(e){this._parent.notifyChanged(this._path,void 0,void 0,e,{instance:this._parent},!1)},e.prototype.addAjaxException=function(e){return this._parent.addAjaxException(e)},e.prototype.notifyPaginationChanged=function(){},e.prototype.notifyCountChanged=function(){this.notifyChangedProperty("count")},e.prototype.notifySortingChanged=function(){},e.prototype.isQueryable=function(){return this._queryable||!1},e.prototype.addErrors=function(e){var t=this._parent.$errors[this._path];t?t.addErrors(e):this._parent.addErrors(e)},e.prototype.addError=function(e){var t=[{severity:"error",message:e,id:l.allocUuid()}];this.addErrors(t)},e.prototype.rmvError=function(e){var t=this._parent.$errors[this._path];t?t.rmvError(e):this._parent.rmvError(e)},Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),e.prototype._destroyItems=function(){this._selectedUids=[],this._items&&(this._model=void 0,this._items=[])},e.prototype.$orderby=function(e){return""},e.prototype.hasNext=function(){return!1},e.prototype.hasPrev=function(){return!1},e.prototype.noPagesCount=function(){return!1},e.prototype.totalPages=function(){return 1},e.prototype.currentPage=function(e){return 0},e.prototype.totalCount=function(){return this._items.length},e.prototype.destroy=function(){var e=this;e._parent=null,e._arrayParent=null,e._parentSelected=null,e._destroyItems(),e.$links=null,e._selectedPks=null,e._model=null,e._schema=null,e._schemaItems=null,e._rootSchema=null},e.prototype._fillItems=function(){var e=this;e._model&&e._model.forEach(function(t,n){e._items.push(t)})},e.prototype._setModel=function(e,t){this.isNull=null===e,this.isUndefined=void 0===e;var n=this.frozen;t&&(this.frozen=!0),this._destroyItems(),this._model=e,this._fillItems(),this.frozen=n},e.prototype.setModel=function(e){this._setModel(e,!0),this._parent.notifyChanged(this._path,void 0,void 0,"propchange",{instance:this._parent,checkChildren:!0},!1),this.notifyCountChanged(),this._parent.notifyStateChanged(this._path,{instance:this._parent,checkChildren:!0}),this.afterSetModel()},e.prototype.afterSetModel=function(){this.$selected=null},e.prototype.indexOf=function(e){return this._items.indexOf(e)},e.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=e.split(","),o=i.length,r=0,s=this._items.length;r<s;r++){for(var a=!0,l=this._items[r],u=0;u<o;u++)if(t[u]!==l[i[u]]){a=!1;break}if(a)return l}return null},e.prototype._expandForEach=function(e,t,n,i,o){return this._items.forEach(function(r){e(r,i,n),i++;var s=l.getValue(r,t);s&&(s.$expand||o)&&(i=s._expandForEach(e,t,n+1,i,o))}),i},e.prototype.forEach=function(e,t,n){if(!t)return this._items.forEach(function(t,n){return e(t,n,0)});this._expandForEach(e,t,0,0,n)},e.prototype.get=function(e){return this._items[e]},Object.defineProperty(e.prototype,"$expand",{get:function(){return this._expanded},set:function(e){if(this._expanded!==e){var n=this._parent[this._path+t.EXPANDED_FIELD_NAME];this._expanded=e;var i=this._parent[this._path+t.EXPANDED_FIELD_NAME];i!==n&&this._parent.notifyChanged(this._path+t.EXPANDED_FIELD_NAME,n,i,"propchange",{instance:this._parent},!0)}},enumerable:!0,configurable:!0}),e}();t.DataListCore=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._fillItems=function(){var e=this,t=null;e._map={},e._selectedUids=[],e._selected&&(e.$selected=null),e._selectedPks.length&&(t=s.pkFields(e._schemaItems.primaryKey)),e._model&&e._model.forEach(function(n,i){e.isQuery&&n&&(n.$create=!1);var o=new C(e._schemaItems,e._parent,e._path,n,e,!1,e._locale,null),r=!1;if(e._items.push(o),e._map[o.$id]=o,t){var a=s.pk2Id(s.extractPkValue(n,t),t);e._selectedPks.lastIndexOf(a)>=0?(o.internalSetSelected(!0)&&(e.simulateSelecting||o.notifyChanged("$select",!1,!0,"propchange",{instance:o},!0)),r=!0):o.$select&&(r=!0)}else o.$select&&(r=!0);r&&e.pushSelected(o,!1)})},t.prototype._updateSelecting=function(e,t,n,i){var o=this;if(e)o._selectedUids.forEach(function(e){var t=o._map[e];t&&o.pushSelected(t,!0)});else if(o._selectedPks=[],o._selected=null,o._selectedUids.length){var r=o._selectedUids.slice(0);if(n.length||n.push(r.pop()),r.forEach(function(e){var t=o._map[e];t&&(t.$select=!1)}),n.length&&n[0]){var s=o._map[n[0]];n[0]=null,s&&o.pushSelected(s,!0)}}t&&o._items.forEach(function(i){var o=l.getValue(i,t);o&&o._updateSelecting(e,t,n,!1)},null)},t.prototype.clearSelection=function(e,t){var n=this;n.enumSelectedItems(e,function(t){n.selectItem(!1,t,!1,e,!1)}),t&&(n._selectedPks=[])},t.prototype.getSelectedItems=function(e){var t=[];if(this._schemaItems.primaryKey){var n=s.pkFields(this._schemaItems.primaryKey);this.enumSelectedItems(e,function(e){var i=s.pk2Id(s.extractPkValue(e,n),n);t.push(i)})}return t},t.prototype.setSelectedItems=function(e){var t=this;if(t._schemaItems.primaryKey){var n=s.pkFields(t._schemaItems.primaryKey);t.enumSelectedItems("",function(i){var o=s.pk2Id(s.extractPkValue(i,n),n),r=e.indexOf(o);r<0?t.selectItem(!1,i,!1,"",!1):e.splice(r,1)}),e.forEach(function(e){var i=s.findByPk(e,n,t._items);i&&t.selectItem(!0,i,!0,"",!1)})}},t.prototype.updateSelecting=function(e,t){this._updateSelecting(e,t,[],!0)},t.prototype.enumSelectedItems=function(e,t){this._enumSelected(e,function(e,n){n&&t(n)})},t.prototype._enumChildren=function(e,t){e&&this._items.forEach(function(n){t(n);var i=n[e];i&&i._enumChildren(e,t)})},t.prototype.enumChildren=function(e,t){this._enumChildren(e,t)},t.prototype._enumSelected=function(e,t){var n=this;if(e)n._enumSelected(null,t),n._items.forEach(function(n){var i=l.getValue(n,e);i&&i.length&&i._enumSelected(e,t)});else{var i=n._selectedUids.slice(0);if(t(n,null),!i.length)return;i.forEach(function(e){var i=n._map[e];i&&t(n,i)})}},t.prototype.selectItem=function(e,t,n,i,o){var r=this;if(t)if(e){if(!t.$select)if(n){if(t.$select=!0,i&&o)(a=l.getValue(t,i))&&a._enumChildren(i,function(e){e.$select=!0})}else{var s=[];r._enumSelected(i,function(e,t){e&&!t?(e._selectedUids=[],e._selectedPks=[]):t.internalSetSelected(!1)&&s.push({item:t,value:!1})}),t.internalSetSelected(!0)&&s.push({item:t,value:!0}),(u=t._arrayParent)&&u.pushSelected(t,!0),s.forEach(function(e){r.simulateSelecting||e.item.notifyChanged("$select",!e.value,e.value,"propchange",{instance:e.item},!0)})}}else if(t.$select)if(n){var a;if(t.$select=!1,i&&o)(a=l.getValue(t,i))&&a._enumChildren(i,function(e){e.$select=!1})}else{var u,d=t.internalSetSelected(!1,!0);(u=t._arrayParent)&&r.removeSelected(t,!0),d&&(r.simulateSelecting||t.notifyChanged("$select",!0,!1,"propchange",{instance:t},!0))}},t.prototype.canDoNext=function(){if(this.noPagesCount())return this.hasNext();var e=this.totalPages();return this.currentPage()<e},t.prototype.canDoPrev=function(){return this.noPagesCount()?this.hasPrev():this.currentPage()>1},t.prototype.moveSelected=function(e,t){var n=this,i=null;if(n.enumSelectedItems("",function(e){i||(i=e)}),i){var o=n._items.indexOf(i),r=Math.max(0,Math.min(o+e,n._items.length-1));if(t&&r!==o+e){if(e>0&&n.canDoNext())return void n.currentPage(n.currentPage()+1);if(e<0&&n.canDoPrev())return void n.currentPage(n.currentPage()-1)}var s=n._items[r];s!==i&&n.selectItem(!0,s,!1,"",!1)}},t.prototype.sortByKey=function(e,t){var n=this;if(e&&e.length&&n._model&&n._model.length){var i={},o={},r=[];n._model.forEach(function(e,s){i[e[t]]=e,o[e[t]]=n._items[s],r.push(e[t])}),n._model.splice(0,n._model.length),n._items.splice(0,n._items.length),e.forEach(function(e,t){n._model.push(i[e]),n._items.push(o[e])}),r.join("$$")!==e.join("$$")&&n._parent.notifyChanged(n._path,void 0,void 0,"propchange",{instance:n._parent,checkChildren:!0,sorting:!0},!1)}},t.prototype.findById=function(e){return this._map[e]},t.prototype.findByPk=function(e){if(this._schemaItems.primaryKey){var t=s.pkFields(this._schemaItems.primaryKey);return s.findByPk(e,t,this._items)}return null},t.prototype.indexOf=function(e){return"object"!=typeof e&&(e=this.findById(e)),e?this._items.indexOf(e):null},t.prototype.$orderby=function(e){var t=this.parent.$states[this.path];return void 0===e?t.orderBy:(t.orderBy=e,t.orderBy)},t.prototype.$filter=function(e){var t=this.parent.$states[this.path];return void 0===e?t.filter:(t.filter=e,t.filter)},t}(m);t.DataListBase=v;var g=function(e){function n(n,i,o,r,s,l,u,d,c,p,h,f,m,v){var g=e.call(this,i,o,r,s,m,v,!0,null)||this,y=g,_=y._parent.getRootModel(),$=a.dsConfig(_.datasets,i,!0);if(_.design&&($={$type:"odata",$params:{$entity:"EntityIsMissing"},$autoOpen:!1}),!$)throw'Invalid config! You must define a dataset in form for the property: "'+r+'".';return y.allData=f,y._main=$.$main,y._queryable=!0,void 0===l&&(l=$.$params.$top||20),y._query=new t.QueryableDataSource($,y),y._query.initPagination(l,u,d,c,p,h),y._main&&_&&(_.onRefresh=function(e){var t=e&&e.resetPagination;return y.$refresh(t)}),g}return __extends(n,e),Object.defineProperty(n.prototype,"filter",{get:function(){return this._query.filter},set:function(e){this._query.filter=e,this.notifyChangedProperty("filter")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"searchFields",{get:function(){return this._query.searchFields},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"searchField",{set:function(e){this._query.searchFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"search",{get:function(){return this._query.search},set:function(e){this._query.search=e},enumerable:!0,configurable:!0}),n.prototype.totalPages=function(){return this._query.totalPages()},n.prototype.totalCount=function(){return this._query.totalCount()},n.prototype.hasNext=function(){return this._query.hasNext()},n.prototype.hasPrev=function(){return this._query.hasPrev()},n.prototype.noPagesCount=function(){return this._query.noPagesCount()},n.prototype.$refresh=function(e){return this._query.refresh(e,!0)},n.prototype.$orderby=function(e){return this._query.orderBy(e)},n.prototype.notifyPaginationChanged=function(){this.notifyChangedProperty("pagination")},n.prototype.notifyFilterChanged=function(){this.notifyChangedProperty("filter")},n.prototype.notifySortingChanged=function(){this.notifyChangedProperty("sorting")},n.prototype.currentPage=function(e){return void 0!=e?this._query.currentPage(e):this._query.currentPage()},n.prototype._removeItem=function(e,t){var n=this;if(n._query){var i=n._query.remove(e,t);i.then&&i.then(function(){n.$refresh(!(n._items.length>1)).then(function(){})})}},n.prototype.remove=function(e){var t=this,n=e.model(!0),i=(e.$select,n?n["@odata.etag"]:null);if(t._schemaItems&&t._schemaItems.primaryKey){var o=s.odataId(s.pkFields(t._schemaItems.primaryKey),e);if(t._schemaItems.links&&t._schemaItems.links.$remove&&t._schemaItems.links.$remove.confirm){var r=t._schemaItems.links.$remove.confirm;t._locale&&(r=p.tt(r||"",t._locale)),l.confirm(null,r,function(){t._removeItem(o,i)})}else t._removeItem(o,i)}},n.prototype.destroy=function(){if(this.allData=null,this._query&&(this._query.destroy(),this._query=null),this._main){var t=this._parent.getRootModel();t&&(t.onRefresh=null)}e.prototype.destroy.call(this)},n}(v);t.QueryList=g;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this);this._selectedPks=[]},t.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=e.split(","),o=i.length,r=0,s=this._items.length;r<s;r++){for(var a=!0,l=this._items[r],u=0;u<o;u++)if(t[u]!==l[i[u]]){a=!1;break}if(a)return l}return null},t}(v);t.CompositionList=y;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this);this._selectedPks=[]},t}(m);t.SimpleCompositionList=_;var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.push=function(e){this._initModelInParent(),this._model.push(e),this._items.push(e),this._parent.notifyChanged(this._path,void 0,e,"add",{$index:this._items.length-1,$value:e,$id:e,instance:this._parent},!1),this.notifyCountChanged()},t.prototype.splice=function(e,t,n){if(t>0)throw"Delete count is not supported.";this._model&&(n.$create=!0,this._model.splice(e,t,n),this._items.splice(e,t,n),this._parent.notifyChanged(this._path,void 0,n,"add",{method:!0,change:!0,$index:e,$value:n,$id:n,instance:this._parent},!1),this.notifyCountChanged())},t.prototype.remove=function(e){var t=this._items.indexOf(e);t>=0&&(this._items.splice(t,1),this._model.splice(t,1),this._parent.notifyChanged(this._path,void 0,e,"remove",{method:!0,change:!0,$index:t,$value:e,$id:e,instance:this._parent},!1),this.notifyCountChanged())},t}(_);t.SimpleTypeList=b;var x=function(e){function t(t,n,i,o,r,s,a){var l=e.call(this,t,n,i,o,r,s,!1,a)||this;return l._createNewItem(!1,!0),l}return __extends(t,e),t.prototype._initNew=function(){var e={$create:!0};this._new=new C(this._schemaItems,this._parent,this._path+".$new",e,null,!0,this._locale,null),this._new.notifyChanged("",void 0,e,"propchange",{instance:this._new,checkChildren:!0},!1),this._new.notifyStateChanged("",{instance:this._new,checkChildren:!0})},Object.defineProperty(t.prototype,"filter",{get:function(){var e=this.$filter();return e?JSON.parse(e):null},set:function(e){var t=e?JSON.stringify(e):"";t!==(this.$filter()||"")&&(this.parent.execSyncAction(this.getJSONPatchPath()+".$filter",t,t)||this.$filter(t))},enumerable:!0,configurable:!0}),t.prototype._createNewItem=function(e,t){t&&Object.defineProperty(this,"$new",{get:function(){return this._new||this._initNew(),this._new},set:function(e){this._new||this._initNew(),this._new._setModel(e,!0),this._new.notifyChanged("",void 0,e,"propchange",{instance:this._new}),this._new.notifyStateChanged("",{instance:this._new,checkChildren:!0})},enumerable:!0}),e&&!this._new&&this._initNew()},t.prototype.updateItem=function(e,t){if(!t.validate())return!1;t.$errors.$.addErrors([],!1);var n=t._getModel(!0);if(this._schemaItems.primaryKey){var i=s.pkFields(this._schemaItems.primaryKey),o=s.extractPkValue(n,i),r=(s.extractPkValue(e._getModel(!0),i),s.findByPk(o,i,this._items));if(r&&r!==e){var a=i.length>1?h.uniqueColumns:h.uniqueColumn;return t.$errors.$.addErrors([{code:"duplicate_value",message:l.format(a,i.join(", "))}],!1),!1}}return!0},t.prototype.addNew=function(){var e=this;if(e._new&&e._new.validate()){var t=e._new._getModel(!1,!0);if(e._schemaItems.primaryKey){var n=s.pkFields(e._schemaItems.primaryKey),i=s.extractPkValue(t,n),o=s.findByPk(i,n,e._items);if(e._parent.$errors[e._path].addErrors([],!1),o){var r=n.length>1?h.uniqueColumns:h.uniqueColumn;return void e._parent.$errors[e._path].addErrors([{code:"duplicate_value",message:l.format(r,n.join(", "))}],!1)}}else e._parent.$errors[e._path].addErrors([],!1);e._destroyNew(),e.push(t),e._createNewItem(!0,!1)}},t.prototype._destroyNew=function(){this._new&&(this._new.destroy(),this._new=null)},t.prototype.destroy=function(){this._destroyNew(),e.prototype.destroy.call(this)},t.prototype.push=function(e){e.$create=!0,e.$select&&e.$create&&this.clearSelection(),this._initModelInParent(),this.splice(-1,0,e)},t.prototype.splice=function(e,t,n){if(t>0)throw"Delete count is not supported.";var i=this;i._initModelInParent(),i.manageSelecting&&(i.clearSelection(i.expandingProperty),n.$select=!0);var o=i.frozen;i.frozen=!0;var r=e<0;r?i._model.push(n):i._model.splice(e,t,n);var s=new C(i._schemaItems,i._parent,i._path,n,i,!1,i._locale,null);r?i._items.push(s):i._items.splice(e,t,s),i.frozen=o,i._map[s.$id]=s,s.$select&&i.pushSelected(s,!0),i._parent.notifyChanged(i._path,void 0,n,"add",{method:!0,change:!0,$index:r?i._items.length-1:e,$id:s.$id,$value:s,source:i._parent.getPropertyPath(i._path),instance:i._parent},!1),s.notifyStateChanged("",{checkChildren:!0})},t.prototype.remove=function(e){var t,n=this,i=n.frozen;if(n._model){n.frozen=!0;var o=n._items.indexOf(e),r=e.$id,s=null,a=!1;if(o>=0&&(e.model(),t=!0,e.$select&&n.manageSelecting&&(o+1<n._items.length?s=n._items[o+1]:o>0&&(s=n._items[o-1])),n._items.splice(o,1),n._model.splice(o,1),i||(n.frozen=i),n.removeSelected(e,!1),n.frozen=!0,a=!0),n.frozen=i,delete n._map[r],t){n._parent.notifyChanged(n._path,void 0,e,"remove",{mmethod:!0,change:!0,$index:o,$value:e,$id:r,instance:n._parent},!1),a&&(e.destroy(),a=!1);var l=(n._path?n._path+".":"")+"$item";n._parent.notifyStateChanged(l,{}),s&&(n.pushSelected(s,!0),s.internalSetSelected(!0),s.notifyChanged("$select",!1,!0,"propchange",{instance:s},!0))}a&&e.destroy()}},t}(y);t.DataList=x;var C=function(){function n(e,t,n,i,o,a,u,d,c,p){var h=this;h._rootParent=t?t._rootParent:h;var f=[];if(t){var m=t.getPropertyPath();m&&f.push(m)}n&&f.push(n),o&&f.push("$item"),h._fullPath=f.join("."),h.design=p,h.$id=l.allocID(),h.$create=!1,h._initialized={},h._selected=!(!i||!i.$select),h._model={},h.datasets=d,h.transform=c,h.$states={},h.$errors={},h.$links={},h._path=n,h._locale=u,h._parent=t,h._schema=s.expand$Ref(e,h._rootParent._schema),h.className=h._schema.name,h._parent||(h._validators=[{name:"schema",active:!0}]),h._arrayParent=o,h._children={},h._initFromSchema(e),h._parent&&!a||(h.frozen=!0),h===h._rootParent&&(h._rootParent.$create=i&&i.$create||!1),h._setModel(i,!0),h.frozen=!1,h._parent||(h.notifyChanged("*",void 0,i,"propchange",{source:""},!1),h.notifyStateChanged("*",{checkChildren:!0})),r.execInitRules(h)}return Object.defineProperty(n.prototype,"fullPath",{get:function(){return this._fullPath},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"owner",{get:function(){return this._arrayParent?this._arrayParent:this._parent},enumerable:!0,configurable:!0}),n.prototype.pkId=function(){if(this._schema.primaryKey){var e=s.pkFields(this._schema.primaryKey);return s.pk2Id(s.extractPkValue(this,e),e)}},n.prototype.getJSONPatchPath=function(e){return this.parent?this._arrayParent?this._arrayParent.getJSONPatchPath(this._model.id+(e?"."+e:"")):this.parent.getJSONPatchPath(e?this._path+"."+e:this._path):e},n.prototype.getPropertyPath=function(e,t){if(void 0===e)return this._fullPath;var n=this._fullPath;if(t&&this._fullPath){for(var i=this._fullPath.split("."),o=i.length-1;o>0&&i[o-1]===t&&"$selected"===i[o];)i.pop(),i.pop(),o-=2;n=i.join(".")}return n?n+"."+e:e},n.prototype.saveModel=function(){this._origModel=s.copyModel(this._schema,this._model)},Object.defineProperty(n.prototype,"$schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._rootParent},enumerable:!0,configurable:!0}),n.prototype.setModel=function(e){this._destroyObject(this,"_children"),this._children={},this.frozen=!0,this._setModel(e,!1),this.frozen=!1,this._parent||(this.notifyChanged("*",void 0,e,"propchange",{sourve:""},!1),this.notifyStateChanged("*",{checkChildren:!0}))},n.prototype.update=function(e){var t=this;if(e){var n=Object.keys(t._schema.properties),i=t._rootParent._schema;n.forEach(function(n){var o=t._schema.properties[n];if(s.inModel(o,i))if(s.isCompositionRef(o,i))t[n];else s.isCompositionList(o,i,!1)?t[n]=e[n]:s.isSimpleList(o,i)?t[n]=e[n]:(s.isList(o,i),t[n]=e[n])})}},n.prototype.$refresh=function(e){var t=this;return t._parent?l.Promise.resolve():t.onRefresh?t.onRefresh(e):new l.Promise(function(e,n){a.loadMainData({datasets:t.datasets,transform:t.transform,context:t.model(!0)},!1).then(function(n){t.update(n),e()}).catch(function(e){t.addAjaxException(e),n()})})},n.prototype.clearErrors=function(e){var t=this;if(t.$errors&&Object.keys(t.$errors).forEach(function(e){t.$errors[e].clear(!0)}),e){var n=t._rootParent.$schema;Object.keys(t._schema.properties).forEach(function(i){var o=t._schema.properties[i];if(s.inModel(o,n))if(s.isCompositionRef(o,n)){var r=t[i];r&&r.clearErrors(e)}else if(s.isCompositionList(o,n,!1)){var a=t[i];a&&a.forEach(function(t){t.clearErrors(e)})}})}},n.prototype._validate=function(t,n,i){var o=this;if(o.clearErrors(!1),!t||!t.length)return!0;var a=Object.keys(o._schema.properties),u=!1,d=o._rootParent._schema;return n&&r.execBeforeSaveRules(o),a.forEach(function(r){var a=o._schema.properties[r],c=!1;if(s.inModel(a,d)){var p=o.$states[a.$stateProperty||r];if(!p.isHidden&&!p.isDisabled){if(i&&i.indexOf(r)<0)return!1;if(s.isCompositionRef(a,d)){var f=o[r];f?f._validate(t,n)||(u=!0):p.isMandatory&&(o.$errors[r].addErrors([{message:l.format(h.required,s._title(a.title,e.locale))}],!1),u=!0)}else if(s.isCompositionList(a,d,!1)){var m=o[r];m&&(m.forEach(function(e){e._validate(t,n)||(u=!0)}),c=!0)}else c=!0;c&&(o._execValidators(t,r,"validate",{},{base:o,state:p,schema:a,value:o[r]})||(u=!0))}}}),r.execValidationRules(o,i)&&(u=!0),o._parent||o._execValidators(t,"","validate",{},{base:o,state:null,schema:o._schema,value:null})||(u=!0),!u},n.prototype.isRecursiveRule=function(e){var t=this.getRootModel();if(t.callStack){var n=this.getPropertyPath(e);return t.callStack.indexOf(n)>=0&&(l.logRule(t.callStack.length,"Recursive rule detected: property: "+n+" - last rule canceled.",n,""),!0)}},n.prototype.validate=function(e){var t=this.getRootModel();return this._validate(t._validators,e)},n.prototype.partialValidate=function(e){var t=this.getRootModel();return this._validate(t._validators,!1,e)},Object.defineProperty(n.prototype,"$select",{get:function(){return this._selected},set:function(e){var t=this;t.internalSetSelected(e)&&t._arrayParent&&(t._selected?t._arrayParent.pushSelected(t,!0):t._arrayParent.removeSelected(t,!0),t._arrayParent.simulateSelecting||t.notifyChanged("$select",!e,e,"propchange",{source:t.getPropertyPath("$select"),instance:t},!0))},enumerable:!0,configurable:!0}),n.prototype.select=function(e,t,n,i,o){t?this._arrayParent&&this._arrayParent.selectItem(e,this,t,i,o):i?n.selectItem(e,this,!1,i,o,!0):this._arrayParent&&this._arrayParent.selectItem(e,this,!1,null,!1)},n.prototype.toggleExpand=function(e){var t=!1;if(!e)return t;var n=l.getValue(this,e);return n&&(n.$expand=!n.$expand,t=n.$expand),t},n.prototype.enumVisibleChildren=function(e,t,n,i){var o=l.getValue(this,e);o&&(o.$expand||n)&&o._items.forEach(function(n){i(n,t+1),n.enumVisibleChildren(e,t+1,!1,i)})},n.prototype.internalSetSelected=function(e){return this._selected!==e&&(this._selected=e,!0)},Object.defineProperty(n.prototype,"$index",{get:function(){return this._arrayParent?Math.max(this._arrayParent.indexOf(this),0)+1:0},enumerable:!0,configurable:!0}),n.prototype.getJsonPachDelta=function(e){var t=this.model(!1),n=u.compare(this._origModel,t,e);return n&&n.length?(this._origModel=t,n):null},n.prototype.applyJsonPachDelta=function(e){var t=this;if(e&&e.length){t._updating=!0;try{e.forEach(function(e){var n=f.getJSONPatchParent(e.path,t);if(1!==n.type){var i=n.value;if(i.isArray&&0===n.type)if("add"===e.op)i.push(e.value);else if("remove"===e.op){var o=i.find("id",f._segment2Id(n.lastSegment));o&&i.remove(o)}else"sort"===e.op&&i.sortByKey(e.value,"id");else if(3===n.type)if("$errors"===n.lastSegment)e.value?Object.keys(e.value).forEach(function(t){var n=i.$errors[t];n&&(n.clear("remove"===e.op),"remove"!==e.op&&n.addErrors(e.value[t]))}):i.clearErrors(!0);else if(i.isArray&&!n.lastSegment)"add"===e.op&&i.addErrors([e.value]);else{var r=i[n.lastSegment];r&&("remove"===e.op?r.clear(!0):r.addErrors(e.value))}else if(2===n.type){if(i&&!i.isState)return i=i[n.lastSegment],void("object"==typeof e.value&&Object.keys(e.value).forEach(function(t){if(i[t]&&i[t].isState){var n=e.value[t];"object"==typeof n&&Object.keys(n).forEach(function(e){i[t][e]=n[e]})}else i[t]=e.value[t]}));"remove"===e.op?i[n.lastSegment]=void 0:i[n.lastSegment]=e.value}else"remove"===e.op?i[n.lastSegment]=void 0:i[n.lastSegment]=e.value}else n.value&&(n.value[n.lastSegment]=e.value)})}finally{var n=t.model(!1);t._origModel=n,t._updating=!1}}},n.prototype.$save=function(){var e=this;if(e.getRootModel()!==e)return l.Promise.reject(null);if(!e.validate(!0))return l.Promise.reject(null);var t=a.extractMainDataSource(e);if(t&&a.isCreateOrUpdate(t)){var n=e.model(!1);if(e.$create)t.$method="POST",delete t.$params.$entityId;else{if(t.$method="PATCH",!e._schema.primaryKey)return e.addError("Primary key is missing. Check schema."),l.Promise.reject(null);var o=void 0;if(i.useJSONPatch){var r=s.pkFields(e._schema.primaryKey),d=s.extractPkValue(n,r);if(t.$params.$entityId=s.entityId(d),!(o=u.compare(e._origModel,n,{useId:!0}))||!o.length)return l.Promise.resolve(n)}else if(!(o=l.deltaPatch(e._origModel,n)))return l.Promise.resolve(n);n=o}return new l.Promise(function(i,o){a.datasetAsPromise(t,n).then(function(t){e.$create=!1,i()}).catch(function(t){e.addAjaxException(t),o(null)})})}return l.Promise.reject(null)},n.prototype.getRootModel=function(){return this._rootParent},n.prototype.addValidator=function(e,t){this.getRootModel()._validators.push({name:e,active:t})},n.prototype.activateValidator=function(e,t){for(var n=this.getRootModel(),i=0,o=n._validators.length;i<o;i++){var r=n._validators[i];if(r.name===e){r.active=t;break}}},n.prototype.hasValidators=function(){var e=this.getRootModel();if(e._validators.length){if(1==e._validators.length)return e._validators[0].active;for(var t=0,n=e._validators.length;t<n;t++)if(e._validators[t].active)return!0}return!1},n.prototype.getParentOf=function(e,n){return this.getValue(t.SchemaUtils.parentPath(e),n)},n.prototype.setValue=function(e,t,n){var i=this,o=e.split("."),r=n?o.lastIndexOf("$item"):-1,s=n?o.lastIndexOf("$selected"):-1;r>0?i=s>0&&s>r?n[o.slice(0,s+1).join(".")]:n[o.slice(0,r+1).join(".")]:s>0&&(i=n[o.slice(0,s+1).join(".")]);for(var a=Math.max(Math.max(r+1,s+1),0),l=o.length;a<l&&i;a++)a===l-1?i[o[a]]=t:i=i[o[a]]},n.prototype._getModel=function(e,t){if(e)return this._model;var n=this.getRootModel(),i=n?n._schema:this._schema;return s.copyModel(this._schema,this._model,i,t)},n.prototype.schemaModel=function(e){var t=this.getRootModel(),n=t?t._schema:this._schema;return s.copyModel(this._schema,this._model,n,!0,e)},n.prototype.model=function(e){return this._getModel(e)},n.prototype.getRelativeValue=function(e){return this.getValue(e,{})},n.prototype.getRelativeState=function(e){return this.getState(e,{})},n.prototype.getValueInfo=function(e,t){if(!e)return{value:this,parentIsNull:!1};var n=this,i=e.split("."),o=t?i.lastIndexOf("$item"):-1,r=t?i.lastIndexOf("$selected"):-1;o>0?n=r>0&&r>o?t[i.slice(0,r+1).join(".")]:t[i.slice(0,o+1).join(".")]:r>0&&(n=t[i.slice(0,r+1).join(".")]);for(var s=Math.max(Math.max(o+1,r+1),0),a=i.length;s<a&&n;s++)n=n[i[s]];return{value:n,parentIsNull:!1}},n.prototype.getValue=function(e,t){return this.getValueInfo(e,t).value},n.prototype.getSchema=function(e){return s.getSchema(e,this._schema,this._rootParent._schema,!1)},n.prototype.getState=function(e,n){if(!e)return{value:this,parentIsNull:!1};var i,o=this,r=e.split("."),a=r.pop(),l=a,u={},d=!1,c=r.length-1;if(s.isMetaProp(a)){var p=s.getSchema(e,this._schema,this._rootParent._schema,!1);p&&p.$stateProperty&&(a=p.$stateProperty)}var h=n?r.lastIndexOf("$item"):-1,f=n?r.lastIndexOf("$selected"):-1;h>0?o=f>0&&f>h?n[r.slice(0,f+1).join(".")]:n[r.slice(0,h+1).join(".")]:f>0&&(o=n[r.slice(0,f+1).join(".")]);for(var m=Math.max(Math.max(h+1,f+1),0),v=r.length;m<v;m++){var g=r[m];if(m===c&&"$links"===g){d=!0;break}if(i=(o=o[g])&&o.$states&&o.$states[g]?o.$states[g].state():null,(!o||o.isNull||o.isUndefined)&&(u.isDisabled=!0),i&&i.isHidden&&(u.isHidden=!0),i&&i.isDisabled&&(u.isDisabled=!0),i&&i.isReadOnly&&(u.isReadOnly=!0),!o)break}var y={};if(!d){if(a===t.SELECTED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!1,isHidden:!1};if(a===t.INDEX_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1};if(a===t.EXPANDED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1}}if(o){var _="$states";d&&(_="$links");var b=o[_]?o[_][a]:null;b&&(y=b.state(),!d&&o.$errors&&o.$errors[l]&&(y.errors=o.$errors[l].errors()))}return $.extend({},y,u)},n.prototype._setPropErrors=function(e,t){if(t.$errors&&t.$errors[e]&&this.$errors[e]){var n=[];t.$errors[e].forEach(function(e){n.push(e)}),this.$errors[e].addErrors(n)}this.$errors[e]&&(t.$errors[e]=this.$errors[e].errors())},n.prototype._setModel=function(e,t){var n=this,i=n.frozen;t&&(n.frozen=!0),n.isNull=null===e,n.isUndefined=void 0===e;var o=void 0!==(e=e||{}).$create?e.$create:!!n._parent&&n._parent.$create;e&&(e=s.init(n._schema,n._rootParent._schema,null,e,o,{select:n._schema===n._rootParent._schema}))&&(n.$create=e.$create,e.$create),e.$states=e.$states||{},e.$links=e.$links||{},e.$errors=e.$errors||{};var r=Object.keys(n._schema.properties),a=n._rootParent._schema;n._model.$links=e.$links,r.forEach(function(t){var i=n._schema.properties[t];if(s.inModel(i,a)){var o=s.isMetaProp(t),r=e[t];if(r||!s.isCompositionList(i,a,!1)&&!s.isList(i,a)||(e[t]=r),s.isList(i,a)?n._setQueryListChild(t,r,e.pageSize,e.pageSize?Math.round(e.skip/e.pageSize)+1:0,e.count,e._hasNext,e._hasPrev,e._noPagesCount,e._origData):n[t]=r,!o){if(e.$states&&e.$states[t]){var l=e.$states[t];Object.keys(l).forEach(function(e){n.$states[t][e]=l[e]})}e.$states[t]=n.$states[t].state()}n._setPropErrors(t,e)}}),n._setPropErrors("$",e),e.$links&&(r=Object.keys(n._schema.links||{})).forEach(function(t){var i=e.$links[t],o=n.$links[t];i&&Object.keys(i).forEach(function(e){o[e]=i[e]}),e.$links[t]=n.$links[t].state()}),n._model=e,n.frozen=i},n.prototype._setRefChild=function(e,t,i){var o=this.frozen;this.frozen=!0,this._children[e]?this._children[e]._setModel(i,!0):this._children[e]=new n(this._schema.properties[e],this,e,i,null,!0,this._locale,null),this.frozen=o},n.prototype._setListChild=function(e,t,n){var i=this,o=i.frozen;if(i.frozen=!0,i._children[e])i._children[e]._setModel(n,!0);else{var r=null;i._arrayParent&&i._arrayParent.schema.children===e&&(r=i._arrayParent),i._children[e]=new x(i._schema.properties[e],i,e,n,null,i._locale,r)}i.frozen=o},n.prototype._setSimpleListChild=function(e,t,n){var i=this.frozen;this.frozen=!0,this._children[e]?this._children[e]._setModel(n,!0):this._children[e]=new b(this._schema.properties[e],this,e,n,null,this._locale,!1,null),this.frozen=i},n.prototype._setQueryListChild=function(e,t,n,i,o,r,s,a,l){var u=this,d=u.frozen;u.frozen=!0,u._children[e]&&u._children[e].destroy(),u._children[e]=new g(u._schema,u._schema.properties[e],u,e,t,n,i,o,r,s,a,l,null,u._locale),u.frozen=d,u.notifyChanged(e,null,t,"propchange",{instance:u},!0),u.notifyStateChanged(e,{instance:u,checkChildren:!0})},n.prototype._initFromSchema=function(n){var i=this;if(i._model){var r=n.states?$.extend(!0,{},n.states):null,a=n.links?$.extend(!0,{},n.links):null,l=n.errors?$.extend(!0,{},n.errors):null,u=!1,d=Object.keys(n.properties);d.forEach(function(t){if(!s.isMetaProp(t)){var i=n.properties[t];if("password"===i.format){if(!i.capabilities||!i.capabilities.noConfirming){var o="$$"+t;i.$meta=o;var r=n.properties[o];r||((r=$.extend(!0,{},i)).title=e.locale.ui.Confirm,r.$stateProperty=t,n.properties[o]=r,u=!0)}}else"rate"===i.format&&(i.exclusiveMinimum=!0,i.exclusiveMaximum=!0,void 0===i.decimals&&(i.decimals=s.RATE_DECIMALS),void 0===i.maximum&&(i.maximum=s.RATE_MAXIMUM),void 0===i.minimum&&(i.minimum=-s.RATE_MAXIMUM),void 0===i.symbol&&(i.symbol=s.RATE_SYMBOL))}}),u&&(d=Object.keys(n.properties)),d.forEach(function(e){var n,a,u,d,p,h,f,m,v,g,y,_,$,b;a=e,u=(n=i)._rootParent._schema,d=n._schema.properties[a],s.inModel(d,u)&&(Object.defineProperty(n,a,{get:function(){var e=this._children[a];return e||this._model[a]},set:function(e){var t=this,i=t._model[a];if(i!==e||!t._initialized[a]){var o=t._schema.properties[a],r=t._beforeChange(t,a,o,i,e,!t._initialized[a]);if(e=r.value,t._initialized[a]=!0,r.continue){if(t.isRecursiveRule(a))return;t._model[a]=e;var l=n._rootParent._schema,u=t.$errors[a];u&&u.clear(!0),s.isCompositionRef(o,l)?(t._setRefChild(a,i,e,{}),t.notifyChanged(a,i,e,"propchange",{instance:t,checkChildren:!0},!0),t.notifyStateChanged(a,{instance:t,checkChildren:!0})):s.isCompositionList(o,l,!1)?(t._setListChild(a,i,e,"propchange",{checkChildren:!0}),t.notifyChanged(a,i,e,"propchange",{instance:t},!0),t.notifyStateChanged(a,{instance:t,checkChildren:!0})):s.isSimpleList(o,l)?(t._setSimpleListChild(a,i,e,"propchange",{}),t.notifyChanged(a,i,e,"propchange",{instance:t},!0),t.notifyStateChanged(a,{instance:t,checkChildren:!0})):s.isList(o,l)?t[a].setModel(e):t.notifyChanged(a,i,e,"propchange",{instance:t},!0)}}},enumerable:!0}),s.isCompositionList(d,u,!1)&&Object.defineProperty(n,a+t.EXPANDED_FIELD_NAME,{get:function(){var e=this[a];return e&&e.length?e.$expand?2:1:0},set:function(e){var t=this[a];t&&(1===e?t.$expand=!1:2===e&&(t.$expand=!0))},enumerable:!0})),s.isMetaProp(e)||(p=i,h=e,f=r?r[e]:null,m=p._schema.properties[h],v=p._rootParent._schema,s.inModel(m,v)&&(s.isNumber(m)&&(s.isMoney(m)?((f=f||{}).symbol||(f.symbol=m.symbol||c.number.symbol),f.decimals||(f.decimals=void 0!==m.decimals?m.decimals:c.number.places)):(f=f||{},void 0!==m.symbol&&((f=f||{}).symbol=m.symbol),void 0!==m.decimals?f.decimals=m.decimals:f.decimals=0)),"array"!==m.type||m.items&&m.items.type&&"object"!==m.items.type?p.$states[h]=new o.DataStates(p,h,f):p.$states[h]=new o.ListStates(p,h,f))),g=i,y=e,_=l?l[e]:null,$=g.$schema.properties[y],b=g.root.$schema,s.inModel($,b)&&!s.isCompositionRef($,b)&&(g.$errors[y]=new o.Errors(g,y,_))}),n.links&&Object.keys(n.links).forEach(function(e){var t,n,r;t=i,n=e,r=a?a[e]:null,t.$links[n]=new o.LinkStates(t,n,r)}),i._parent&&!i._arrayParent||(i.$errors.$=new o.Errors(i,"$",[]))}},n.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),f.getValue(t.join("."),this)},n.prototype.addAjaxException=function(e){var t=this;if(t._parent)return t._parent.addAjaxException(e);var n=d.extractAjaxErrors(e),i=[],o=null;n.message&&(o={message:n.message,details:[]},i.push(o)),n.list&&n.list.length&&n.list.forEach(function(e){var n=!0;if(e.target){var r=t.getParentModel(e.target);if(r){var a=s.lastSegment(e.target,null);r.hasOwnProperty(a)&&(n=!1,r.$errors[a].addError(e.message))}}n&&(o?o.details.push({message:e.message}):i.push({message:e.message}))}),t.$errors.$.addErrors(i)},n.prototype.addError=function(e){var t=[{severity:"error",message:e,id:l.allocUuid()}];this.addErrors(t)},n.prototype.rmvError=function(e){this.$errors.$?this.$errors.$.rmvError(e):this._parent&&this._parent.rmvError(e)},n.prototype.addErrors=function(e){this.$errors.$?this.$errors.$.addErrors(e):this._parent&&this._parent.addErrors(e)},n.prototype._beforeChange=function(e,t,n,i,o,r){var a={continue:!0,value:o};return s.isNumber(n)&&!isNaN(o)&&null!==o&&void 0!==o&&this.$states[t]&&void 0!==this.$states[t].decimals&&(a.value=parseFloat(o.toFixed(this.$states[t].decimals)),r||i!==a.value||(a.continue=!1)),a.continue&&n.ux&&n.emitChanging&&(a.continue=e.notifyBeforeChanged(t,i,o,{})),a},n.prototype.notifyStateChanged=function(e,t){var n=this;n.frozen||n._arrayParent&&n._arrayParent.frozen||(n!==n._rootParent?(t.fromChildren=!0,n._getPaths(t).forEach(function(i,o){var r=i;e&&(r=r?r+"."+e:e),t.change=0===o,n._rootParent.notifyStateChanged(r,t)})):(t.fromChildren||(t.change=!0),l.logModule("proxydata")&&l.log("State changed: "+n._extractPropName(e||"",t),"proxydata"),n.onstatechanged&&n.onstatechanged(e,t)))},n.prototype._extractPropName=function(e,t){return Object.keys(t).sort().reverse().forEach(function(n){var i=t[n];i&&void 0!==i.$index&&(e=e.replace(n,n+"["+i.$index+"]"))}),e},n.prototype._execValidators=function(e,t,n,i,o){var r=this,a=!1;if(t){if(!o){var l=r.getValueInfo(t,i);if(void 0===l.value&&l.parentIsNull)return!a}}else if("validate"!==n)return!a;return e.forEach(function(e){e.active&&(e.hnd||(e.hnd=s.getValidator(e.name)),e.hnd&&(e.hnd(n,r,{name:t,params:i,locale:r._locale},o)||(a=!0)))}),!a},n.prototype.notifyBeforeChanged=function(e,t,n,i){var o=this;if(!(o.frozen||o._arrayParent&&o._arrayParent.frozen)){if(o===o._rootParent)return i.fromChildren||(i.change=!0),i.continue=!0,o.onchange&&i.change&&o.onchange(e,t,n,"beforeChange",i),i.continue;i.fromChildren=!0;var r=!0;o._getPaths(i).forEach(function(s,a){var l=s;e&&(l=l?l+"."+e:e),i.change=0===a,r=r&&o._rootParent.notifyBeforeChanged(l,t,n,i)})}},n.prototype._getSelectedParentArray=function(e){for(var t=this._arrayParent,n=this._arrayParent.path+".$item";t.schema.children&&t.schema.children===t.path&&t.parent._arrayParent;)n=(t=t.parent._arrayParent).path+".$item."+n;return e?{path:n,value:t}:t},n.prototype._getPaths=function(e){var t=this;if(t._arrayParent){var n=t._getSelectedParentArray(!0),i=n.value,o=i.parent._getPaths(e),r=null;return i.$selected===t&&(r=[],o.forEach(function(n,o){if(n.indexOf(".$selected.")>0||n.indexOf(".$item.")<0){var s=(n?n+".":"")+i.path+".$selected";r.push(s),e[s]=t}})),o.forEach(function(i,r){o[r]=(i?i+".":"")+n.path,e[o[r]]=t}),r?o.concat(r):o}if(!t.parent)return[""];var s=t.parent._getPaths(e);return s.forEach(function(e,n){s[n]=e?e+"."+t._path:t._path}),s},n.prototype.notifyChanged=function(e,t,n,i,o,s){var a=this;a.frozen||a._arrayParent&&a._arrayParent.frozen||(a!==a._rootParent?(o.fromChildren=!1,a._getPaths(o).forEach(function(r,l){var u=r;e&&(u=u?u+"."+e:e),o.change=0===l,a._rootParent.notifyChanged(u,t,n,i,o,s)})):(o.fromChildren||(o.change=!0),l.logModule("proxydata")&&l.log("Changed: "+a._extractPropName(e||"",o)+", operation = "+i,"proxydata"),a.onchange&&a.onchange(e,t,n,i,o),!a._updating&&s&&a._validators&&o.change&&a.hasValidators()&&a._execValidators(a._validators,e,"propchanged",o),!a._updating&&o.change&&(r.execPropChangeRules(a,e,o,{validations:!0,propagations:!0}),a.onsync&&a.onsync(null))))},n.prototype.execSyncAction=function(e,t,n){var i=this._rootParent;if(i.onsync&&(!n||!n.$nosync)){var o=i.syncAction(e,t);if(o)return i.onsync(o),!0}return!1},n.prototype.syncAction=function(e,t){var n=e.split(".");if("$sort"===n[n.length-1])return{op:"replace",path:"/"+n.join("/"),params:t};if("$filter"===n[n.length-1])return{op:t?"replace":"remove",path:"/"+n.join("/"),params:t};if("$selected"===n[n.length-1])return{op:"replace",path:"/"+n.join("/"),params:t,delayed:!0};var i=e.indexOf("$links.");if(i<0)return null;var o="";i>0&&(o=e.substr(0,i-1));var r=e.substr(i+"$links.".length),s=this.getSchema(o);if(s.links&&s.links[r]&&s.links[r].ux)return null;if(!o&&"save"===r&&!this.validate(!0))return null;var a=null;return s.links&&s.links[r]&&(s.links[r].data&&(t=s.links[r].data),a=s.links[r].after),{path:"/"+n.join("/"),params:t,after:a}},n.prototype._destroyObject=function(e,t){var n=e[t];n&&Object.keys(n).forEach(function(e){n[e].destroy(),delete n[e]})},n.prototype.hasErrors=function(){var e=!1;if(e)return e;for(var t=Object.keys(this.$errors),n=0,i=t;n<i.length;n++){var o=i[n];if(this.$errors[o].hasErrors()){e=!0;break}}t=Object.keys(this._schema.properties||{});for(var r=this._rootParent._schema,a=0,l=t;a<l.length;a++){o=l[a];var u=this._schema.properties[o];if(s.inModel(u,r)){if(s.isCompositionRef(u,r))e=this[o].hasErrors();else if(s.isCompositionList(u,r,!1)){this[o].forEach(function(t){e||(e=t.hasErrors())})}if(e)break}}return e},n.prototype.destroy=function(){var e=this;e._parent=null,e._destroyObject(e,"_children"),e._destroyObject(e,"$states"),e._destroyObject(e,"$links"),e._destroyObject(e,"$errors"),e._arrayParent=null,e._model=null,e._schema=null,e.onRefresh=null,e.onchange=null,e.onsync=null,e.onstatechanged=null,e._rootParent=null},n}();t.Data=C,t.ObservableUtils=f}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e,i=e.Observable,o=(i.SchemaUtils,i.DataUtils,n.DatasetPlugin);e.locale,e.ulocale,e.utils;t.update=function(e,t,n,i,r){try{var s=e.getJsonPachDelta({useId:!0});if(t&&t.length&&(s=s||[],t.forEach(function(e){s.push({op:e.op||"add",path:e.path,value:e.params})})),!s){try{i(null)}finally{r()}return}var a=n.syncDataSet();a.name="patch",a.$params.$method="PATCH";var l={};o.executeDatasets([a],s,l,[],function(t,n){try{n?e.addAjaxException(n):i(l.patch)}finally{r()}})}catch(e){r()}}}(e.serversync||(e.serversync={}))}(Phoenix||(Phoenix={})),function(e){!function(t){e.data,e.utils;var n=t.SchemaUtils;n.registerValidator("schema",function(e,t,i,o){var r=!0,s="validate"===e;if("propchanged"===e||s){if(!i.name)return r;if(i.method)return!0;var a=n.lastSegment(i.name,null);if(n.arrayProps.indexOf(a)>=0)return r;var l=o?o.value:t.getValue(i.name,i.params),u=o?o.state:t.getState(i.name,i.params),d=o?o.schema:t.getSchema(i.name);if(u&&(u.isHidden||u.isDisabled))return r;var c=i.locale,p=[],h=o?o.base:t.getParentOf(i.name,i.params);if(n.validateSchema(l,d,u,c,p,[])||(r=!1),s&&n.isMetaProp(a)&&d&&"password"===d.format){var f=t.getValue(n.extractBase(i.name)+d.$stateProperty,i.params);d=t.getValue(n.extractBase(i.name)+d.$stateProperty,i.params),n.validatePassword(f,l,d,u,c,p)||(r=!1)}h.$errors&&h.$errors[a]&&h.$errors[a].addErrors(p)}return r})}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e.utils,i=function(){function e(){this._forms={},this._inAction=!1}return e.prototype.setInAction=function(e){this._inAction=e},e.prototype.isInAction=function(){return this._inAction},e.prototype.broadcast=function(e,t){var i=this;n.nextTick(function(){Object.keys(i._forms).forEach(function(n){var o=i._forms[n];o&&o.execAction(e,t)})})},e.prototype.add=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=e)},e.prototype.remove=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=null)},e.prototype.formByName=function(e){return this._forms[e]},e}();t.FormManager=i;var o;t.formManager=function(){return o||(o=new i),o}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e,i=n.ui,o=n.utils,r=n.build,s=n.link,a=n.dom,l=n.layoutUtils,u=n.customData,d=n.preferences,c=n.Observable.SchemaUtils,p=n.Observable.ObservableUtils,h=(n.ulocale,function(n){function h(t,a,u,d,p,h){var f=n.call(this,t,a,u,d,p,h)||this;f._event2Layout=function(e){if(!this.$element)return null;for(var t=this.$element.get(0),n=e.target;n;){var i=n.getAttribute("data-render");if(i){var o=this.getLayoutById(i);if(o)return o}n=n===t?null:n.parentNode}return null};var m=f;u&&u.$transactionId&&(m._transactionId=u.$transactionId,m._viewId=u.id,delete u.$transactionId),m._resizeHnd=function(e){return m._resizeControls(!1),!0},s.context().$url.$showRules&&o.showRules(!0),a.module&&(m.module=a.module,delete a.module),t.data&&(m.formData=$.extend(!0,{},t.data)),m.formManager=i.formManager(),m.formManager.add(m),m.$schema=d||{},m.$rootSchema=m.$schema,a.path&&(m.$rootPath=a.path,m.$schema=c.getSchema(a.path,m.$schema,m.$rootSchema,!0)),a.checkFormLayout&&a.checkFormLayout(m),m.$locale=p,a&&a.preferenceName&&(m._settingsName=a.preferenceName,m._settings=h),a&&a.storageName&&(m._settingsName=a.storageName,m._localSettings=!0);var v=a&&a.jsonSync||null!==m.syncDataSet();return v&&(m.onsync=e.serversync.update),c.fillEnumsFromData(m.$schema,u),m.setData(u),m.$model.onchange=m._modelChanged.bind(m),v&&(m.$model.onsync=m._synModel.bind(m)),m.$model.onstatechanged=m._stateChanged.bind(m),m._bindStates={},m._bindTitles={},m._bindAccordion={},Object.keys(m.map).forEach(function(e){var t=m.map[e];if(t.$bindState&&(m._bindStates[t.$bindState]=m._bindStates[t.$bindState]||[],m._bindStates[t.$bindState].push(e)),t.$title&&t.$title.value&&!t.$title.isHidden){var n=[];o.extractAngularVars(t.$title.value,n)&&(n&&n.forEach(function(t){m._bindTitles[t.name]||(m._bindTitles[t.name]=[],m.registerListenerFor(t.name,m,"layout-titles")),m._bindTitles[t.name].push(e)}),t.$fields=!0)}t.$bindPages&&t.$type===l.LAYOUT_ACCORDION&&"none"===t.$widget&&(m._bindAccordion[t.$bindPages]||(m._bindAccordion[t.$bindPages]=[],m.registerListenerFor(t.$bindPages,m,"layout-accordion")),m._bindAccordion[t.$bindPages].push(e),m._activateTab(t))}),Object.keys(m._bindStates).forEach(function(e){var t=m.$model.getState(e,{});t&&t.isHidden&&m._bindStates[e].forEach(function(e){m.map[e].$isHidden=!0});m.registerListenerFor(e,m,"layout-state")}),m.registerListenerFor("$",m),m.loadPrefs(),a&&a.validators&&a.validators.forEach(function(e){m.$model.addValidator(e,!0)}),m.options.design||!m.options.externalSchema||!m.options.externalLayout||r.release||a.autoClose||(m.options.authoringIndicator=!0,m.options.verticalSpacing=!0),m._afterCreate(),f}return __extends(h,n),h.prototype.addChildForm=function(e,t){this._childrenForms=this._childrenForms||[],this._childrenForms.push({form:e,parentId:t}),e._parentForm=this},h.prototype.removeChildForm=function(e){if(this._childrenForms)for(var t=this._childrenForms.length;t--;){if(this._childrenForms[t].form===e){this._childrenForms.splice(t,1);break}}},h.prototype.closeInlineForms=function(e){var t=this.getLayoutByName(e);if(t&&this._childrenForms)for(var n=this._childrenForms.length;n--;){var i=this._childrenForms[n];i.parentId===t.$id&&(this._childrenForms.splice(n,1),i.form._parentForm=null,i.form.close())}},h.prototype.hasInlineForms=function(e){var t=this.getLayoutByName(e);if(t&&this._childrenForms)for(var n=this._childrenForms.length;n--;){var i=this._childrenForms[n];if(i.parentId===t.$id)return i.form}return null},h.prototype._isInDelayedAction=function(){return this.formManager?this.formManager.isInAction():this._internalDelayedAction},h.prototype._setInDelayedAction=function(e){this.formManager?this.formManager.setInAction(e):this._internalDelayedAction=e},h.prototype.initOptions=function(e){return(e=e||{}).parentContext&&(this._parentModel=e.parentContext,e.parentContext=null),e.form=!0,e},h.prototype.syncTransactionId=function(){return this._transactionId},h.prototype.syncViewId=function(){return this._viewId},h.prototype.execLater=function(e){this._afterProcessing?this._afterProcessing[e.id]=e.hnd:e.hnd()},h.prototype._processing=function(e,t){var n=this;t&&(n._afterProcessing={});try{e()}finally{n._afterProcessing&&Object.keys(n._afterProcessing).forEach(function(e){n._afterProcessing[e]()}),n._afterProcessing=null}},h.prototype.syncDataSet=function(){var e=this.data.datasets?Object.keys(this.data.datasets):[];return 1===e.length&&"sync"===this.data.datasets[e[0]].$type?o.copy(this.data.datasets[e[0]]):null},h.prototype._getFormLData=function(){return this.$model},h.prototype._activateTab=function(e){var t=this.$model.getValue(e.$bindPages,{}),n=this.$model.getState(e.$bindPages,{});if(e.showTabs=!0===n.isHidden,t){var i=null,o=null;e.$items.forEach(function(e){e.opened&&(i=e),e.$name===t&&(o=e)}),o?(o.opened=!0,i&&i!==o&&(i.opened=!1)):!i&&e.$items.length&&(e.$items[0].opened=!0)}},h.prototype.setData=function(t){var n=this;t=t||{},n.$data=t,n.options.beforeSetModel&&n.options.beforeSetModel(n.$data,n),n.$model?n.$model.setModel(n.$data):n.$model=new e.Observable.Data(n.$schema,null,"",n.$data,null,!1,n.$locale,n.data.datasets,n.data.transform,n.options.design),n.$model.saveModel(),n.options.afterModelCreated&&n.options.afterModelCreated(n.$model,n)},h.prototype.processing=function(e){this._inProcessing=e,a.processing(e,100)},h.prototype.controlByField=function(e){return this._findControlByField(e)},h.prototype.controlByName=function(e,t){return this._findControlByName(e,t)},h.prototype._findControlByField=function(e){var t=this,n=[];return Object.keys(t.controls).forEach(function(i){var o=t.controls[i];o&&o.$bind===e&&n.push(o)}),n.length?n:null},h.prototype._findControlByName=function(e,t){var n=this,i=[];return Object.keys(n.controls).forEach(function(t){var o=n.controls[t];o&&o.name===e&&i.push(o)}),t&&!i.length&&n.namedMapFields[e]&&i.push(n.namedMapFields[e]),i.length?i:null},h.prototype.loadPrefs=function(){this._localSettings&&this._settingsName&&(this._settings=d(this._settingsName))},h.prototype.supportSettings=function(){return!!this._settingsName},h.prototype.getFieldSettings=function(e){return this._settings?this._settings[e]:null},h.prototype.setFieldSettings=function(e,t){this._settings=this._settings||{},this._settings[e]=t},h.prototype.savePrefs=function(t){this._settingsName&&(this._localSettings?(this._settings=this._settings||{},d(this._settingsName,this._settings),t()):e.external.preferenceSaveHandler(this._settingsName,this._settings).then(function(){t()}))},h.prototype.sendMessage=function(e,t,n){var i,o=this._findControlByField(t);return o&&o.length&&o.forEach(function(t){t.sendMessage&&(i=t.sendMessage(e,n))}),i},h.prototype.afterSettings=function(e,t,n){return this.options.settingsHandler?this.options.settingsHandler("after",e,t,n):n},h.prototype.beforeSettings=function(e,t){return this.options.settingsHandler?this.options.settingsHandler("before",e,t):null},h.prototype._createError=function(){var e=["bs-form-error"];return this.options.verticalSpacing?e.push("bs-form-vertical-space"):(this.options.closeButtonHandler||this.options.authoringIndicator)&&e.push("bs-form-settings-space"),$('<div id="'+this.data.$id+'_error" class="'+e.join(" ")+'"><div>').get(0)},h.prototype._createErrorItem=function(e,t){var n="success"==e.severity?"success":"warning"==e.severity?"info":"danger",i=t?"":"bs-none ",r=[o.format('<div id="{0}_error" data-error="true" class="'+i+" alert alert-"+n+' alert-dismissible fade show">',e.id)];r.push('<button type="button" data-error-close="true" class="close" aria-label="Close">'),r.push('<span data-error-close="true" aria-hidden="true">&times;</span>'),r.push("</button>");var s=e.message.split("\n");s.length;return s.forEach(function(e,t){t>0&&r.push("<br/>"),r.push(o.escapeHtml(e))}),e.details&&e.details.length&&e.details.forEach(function(e){e.message&&r.push('<p class="bs-error-detail-item">'+o.escapeHtml(e.message)+"</p>")}),r.push("</div>"),$(r.join("")).get(0)},h.prototype.clearErrors=function(){if(this.$element){var e=a.find(this.$element.get(0),this.data.$id+"_error");e&&a.empty(e)}},h.prototype.showErrorItem=function(e,t){if(this.$element){var n=a.find(this.$element.get(0),this.data.$id+"_error");n&&(t&&a.empty(n),a.append(n,this._createErrorItem(e,t)))}},h.prototype.afterRenderChildren=function(e){var t=e.find("[data-phoenix-tooltip]");t.tooltip&&t.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},h.prototype._loadNestedControllers=function(){var e=this;e._nestedControllers=[],Object.keys(e.map).forEach(function(t){var n=e.map[t];if(n.$refController){var i={$refProperty:n.$refProperty,handler:null,beforeSetModel:null},r=u.get(n.$refController);if(!r)throw o.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',n.$refController);r.onModelChanged&&(i.handler=r.onModelChanged.bind(r)),r.beforeSetModel&&(i.beforeSetModel=r.beforeSetModel.bind(r)),e._nestedControllers.push(i)}})},h.prototype.hasNestedControllers=function(){return this._nestedControllers||this._loadNestedControllers(),this._nestedControllers.length>0},h.prototype.modelCreated=function(e){this._nestedControllers.forEach(function(t){if(t.beforeSetModel){var n=e,i=!1;t.$refProperty?(i=!0,n=o.getValue(e,t.$refProperty)):t.$refProperty||(i=!0),i&&n&&t.beforeSetModel(n)}})},h.prototype.modelChanged=function(e,t,n,i){this._nestedControllers.forEach(function(r){if(r.handler){var s=e,a=t,l=!1;r.$refProperty&&s.property&&0===s.property.indexOf(r.$refProperty+".")?(l=!0,(s=o.copy(e)).property=s.property.substring(r.$refProperty.length+1),a=t.getValue(r.$refProperty,e.params)):r.$refProperty||(l=!0),l&&r.handler(s,a,n,i)}})},h.prototype.afterRender=function(e){var t=this,n=e.get(0);t.autoClose&&(n.tabIndex=0);var i=n.firstChild?n.firstChild:n;t.options.form&&!t.options.design&&a.before(i,t._createError());var o=function(e,n,i,o){var r=["<div "+n+'="true" class="bs-cursor-p bs-form-settings'+(i?" "+i:"")+(o?"  space-"+o:"")+'" id="'+t.data.$id+'_settings">'];return r.push("<span "+n+'="true" class="'+a.iconClass(e)+'"></span>'),r.push("</div>"),r.join("")},r=0;if(t.options.closeButtonHandler){var s="times-circle-o",l="red";t.options.autoClose&&(s="remove",l="normal"),a.append(n,$(o(s,"data-form-detail-close",l,r)).get(0)),r++}t.options.authoringIndicator&&(a.append(n,$(o("cog","data-form-settings",null,r)).get(0)),r++),t._showErrors()},h.prototype._afterLayoutAdded=function(t){var n=this;l.enumSubLayouts(t,function(t){if(t.$fields&&t.$title&&t.$title.value){var i=n.$element.get(0),o=a.find(i,t.$id+"_title");o&&e.layoutUtils.updateLayoutTitle(o,t,n.$model,n.$locale)}})},h.prototype.changed=function(e,t,n,i,o){var r=this;if("layout-titles"===o.targetId){if(r._bindTitles[o.propName]&&r.$element){var s=r.$element.get(0);r._bindTitles[o.propName].forEach(function(e){var t=a.find(s,e+"_title");if(t){var n=r.getLayoutById(e);n&&n.$title&&n.$title.value&&l.updateLayoutTitle(t,n,r.$model,r.$locale)}})}}else"layout-accordion"===o.targetId&&r._bindAccordion[o.propName]&&r._bindAccordion[o.propName].forEach(function(e){r.getLayoutById(e).$items.forEach(function(e){e.$name!==n||e.opened||r._activatePageLayout(e)})})},h.prototype._showErrors=function(){var e=this.$model.$errors.$;if(e.hasErrors())for(var t=e.errors(),n=0,i=t.length;n<i;n++){var o=t[n];this.showErrorItem(o,0==n)}else this.clearErrors()},h.prototype.stateChanged=function(e,t){var n=this;if("layout-accordion"===t.targetId){if("isHidden"===e&&t.property){var i=n.$model.getState(t.property,{});(o=n._bindAccordion[t.property])&&o.forEach(function(e){var t=n.map[e],o=a.find(n.$element.get(0),t.$id+"_tab");o&&(i.isHidden?a.removeClass(o,"bs-none"):a.addClass(o,"bs-none"))})}}else if("layout-state"===t.targetId){if("isHidden"===e&&t.property){var o,r=n.$model.getState(t.property,{});(o=n._bindStates[t.property])&&o.forEach(function(e){var t=n.map[e];t&&n.updateIsHidden(t,r.isHidden)})}}else"$"===t.property&&"errors"===e&&n._showErrors()},h.prototype.getSchema=function(e){return c.getSchema(e,this.$schema,this.$rootSchema,!1)},h.prototype.getLookupForSchema=function(e,t){return c.getLookup(e,t,this.$schema,this.$rootSchema)},h.prototype.registerListenerFor=function(e,t,n){var i=e;this._listenerChanged=!0,this._listeners=this._listeners||{},this._listeners[i]=this._listeners[i]||[],this._listeners[i].push({target:t,id:n||""})},h.prototype.unRegisterListenerFor=function(e,t){var n=e;if(this._listeners&&this._listeners[n]){var i=this._listeners[n].findIndex(function(e){return e.target===t});i>=0&&(this._listeners[n].splice(i,1),this._listenerChanged=!0)}},h.prototype.setValue=function(e,t){p.setValue(e,t,this.$model)},h.prototype.getValue=function(e){return p.getValue(e,this.$model)},h.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),p.getValue(t.join("."),this.$model)},h.prototype.getState=function(e){var t=p.getState(e,this.$model);return this.options.design&&(t.isHidden=!1,t.isDisabled=!1),t},h.prototype._enumListener=function(e,t){this._listeners[e].forEach(function(e){t(e)})},h.prototype._rebuildListeners=function(){this._listenerChanged&&(this._listenersByName=Object.keys(this._listeners),this._listenerChanged=!1)},h.prototype._match=function(e,t,n){var i=e.join("."),o=i+".";this._listenersByName&&this._listenersByName.forEach(function(e){e===i?t(e,!0,!1,!1):"*"===i||0===i.indexOf(e+".")?t(e,!1,!0,!1):n.checkChildren&&0===e.indexOf(o)&&t(e,!1,!1,!0)})},h.prototype.openInlineForm=function(e){var n=this,i=n.getLayoutByName(e.where);i&&t.OpenInlineForm&&t.OpenInlineForm(i.$id,e.name,e.meta,e.controller,e.data,e.locale,function(e){n.addChildForm(e,i.$id)})},h.prototype.execAction=function(e,t,n){if(!this.$model.execSyncAction(e,t,n)){if(0===e.indexOf("$action.")){var i=e.split(".");i.shift();var o={};return o[i.join(".")]=!0,s.execLink(o,t,null)}this._modelChanged(e,null,null,"execute",n,t)}},h.prototype.close=function(){this.$content&&(this.$content.empty(),a.remove(this.$content.get(0))),this.destroy()},h.prototype.broadcast=function(e,t){this.formManager.broadcast(e,t)},h.prototype.patch=function(e){var t=this;t._inSync=!0,t.processing(!0);try{t._processing(function(){t.$model.applyJsonPachDelta(e)},e.length>10)}finally{t.processing(!1),t._inSync=!1}},h.prototype._sendData=function(){var e=this;e._inSync=!0,e.processing(!0);var t=null;e._actions&&e._actions.length&&(t=e._actions),e._actions=null,e.onsync(e.$model,t,e,function(t){t&&t.length&&e._processing(function(){e.$model.applyJsonPachDelta(t)},t.length>10)},function(){e.processing(!1),e._inSync=!1,t&&t.forEach(function(t){t&&t.after&&e.execAction(t.after,{},{$nosync:!0})})})},h.prototype._synModel=function(e){var t=this;if(!t._inSync&&t.onsync)if(t._syncTimeOut&&clearTimeout(t._syncTimeOut),e){var n=e.delayed;delete e.delayed,t._actions=t._actions||[];var i=t._actions.findIndex(function(t){return t.path===e.path&&t.op===e.op});i>=0&&t._actions.splice(i,1),t._actions.push(e),n?setTimeout(function(){t._sendData()},80):t._sendData()}else setTimeout(function(){t._sendData()},80)},h.prototype._modelChanged=function(e,t,n,i,o,r){var s=this,a=e.split(".");s._rebuildListeners(),(o=o||{}).oldValue=t,o.newValue=n,"execute"!==i&&"beforeChange"!==i&&s._match(a,function(r,a,l,u){("propchange"===i||a)&&(o.propName=r,a?s._enumListener(r,function(r){r.target.changed&&(o.targetId=r.id,r.target.changed(e,t,n,i,o))}):l?s._enumListener(r,function(r){r.target.changed&&(o.targetId=r.id,r.target.changed(e,t,n,i,o))}):u&&s._enumListener(r,function(e){e.target.changed&&(o.targetId=e.id,e.target.changed(r,t,s.getValue(r),i,o))}))},o),s.afterchanged(e,i,o,r)},h.prototype.afterchanged=function(e,t,n,i){if(this.onaction){if(this.inAction)return;this.inAction=!0;try{this.onaction({property:e,operation:t,params:n,actionParams:i},this.$model,this)}finally{this.inAction=!1}}},h.prototype.on=function(e){this.onaction=e,this.onaction&&this.onaction({operation:"init"},this.$model,this)},h.prototype._stateChanged=function(e,t){var n,i,o=this,r=e.split("."),s=!1;c.statesAndErrors.indexOf(r[r.length-1])>=0&&(n=r.pop(),i=r.join("."),s=!0),o._rebuildListeners(),o._match(r,function(r,a,l,u){a?o._enumListener(r,function(o){o.target.stateChanged&&o.target.stateChanged(n,{targetId:o.id,property:i,origProperty:e,isState:s},t)}):l?o._enumListener(r,function(n){n.target.stateChanged&&n.target.stateChanged(null,{targetId:n.id,property:i,origProperty:e,isState:s},t)}):u&&o._enumListener(r,function(n){n.target.stateChanged&&(t.targetId=n.id,n.target.stateChanged(null,{targetId:n.id,property:i,origProperty:e,isState:s},t))})},t)},h.prototype.destroy=function(){var e=this;(e.$data=null,e.$schema=null,e._bindStates=null,e._bindTitles=null,e._bindAccordion=null,e.module=null,e.onsync=null,e.onaction=null,e._listeners={},e._parentModel=null,e._listenersByName=[],e._loadNestedControllers=null,e._parentForm&&e._parentForm.removeChildForm(e),e._childrenForms)&&(e._childrenForms.slice().forEach(function(e){return e.form.destroy()}),e._childrenForms=null);e.$model&&(e.$model.onchange=null,e.$model.onstatechanged=null,e.$model.destroy(),e.$model=null),e.formManager&&(e.formManager.remove(e),e.formManager=null),n.prototype.destroy.call(this)},h.prototype._idComponent=function(e){if(!this.$element)return null;for(var t,n=e,i=this.$element.get(0);n;){if(!n.getAttribute)return null;if(t=n.getAttribute("data-render")){if(this.controls[t])break;t=null}n=n===i?null:n.parentNode}return t||null},h.prototype._event2FieldByElement=function(e){var t=this._idComponent(e);return t?this.controls[t]:null},h.prototype.postMessageToParent=function(e,t){var n=this;n._parentForm&&o.nextTick(function(){n._parentForm.execAction(e,t)})},h.prototype._event2Field=function(e){return this._event2FieldByElement(e.target)},h.prototype._removeBaseEvents=function(){var e=this.$element;e.off("focusin"),e.off("focusout"),e.off("click"),e.off("dblclick"),e.off("keydown"),e.off("keyup"),e.off("keypress"),e.off("mousedown"),e.off("paste"),$(window).off("global-phoenix-resize",this._resizeHnd),n.prototype._removeBaseEvents.call(this)},h.prototype._freeze=function(e){return e.preventDefault(),e.stopPropagation(),!1},h.prototype._doKeyDown=function(e){return!0},h.prototype._doKeyPress=function(t){if(this.autoClose){if(t.keyCode===a.keys.VK_ESCAPE||t.keyCode===a.keys.VK_F4)return this.autoClose.explicitClose=!0,e.pagecontrol.Page().setPopup(null),!1;t.keyCode===a.keys.VK_ENTER&&this.execAction("form-validate")}return!0},h.prototype._addBaseEvents=function(){var e=this;e.$element.on("focusin",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);if(n&&n.focusIn){if(n.focused)return;n.focused=!0,n.focusIn(t)}}),e.$element.on("focusout",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);if(n&&n.focusOut){var i={target:t.target};n.focusTimer&&(window.clearTimeout(n.focusTimer),n.focusTimer=0),e._setInDelayedAction(!0),n.focusTimer=o.focusDelay(function(){if(e._setInDelayedAction(!1),!n.destroyed){n.focusTimer=0;var t=window.document.activeElement;if(t){var o=e._event2FieldByElement(t);o!==n?n.focusInControl(t)&&(o=n):o===n&&(n.focusInControl(t)||(o=null)),o!==n&&(n.focusOut(i),n.focused=!1)}else n.focusOut(i),n.focused=!1}})}}),e.$element.on("dblclick",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);n&&n.dblclick&&n.dblclick(t)}),e.$element.on("click",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t),i=t.target;if(n&&i.id===n.id+"_rules")return n.showRules(),void t.preventDefault();if(n&&n.click){if(n.stopProppagation&&n.stopProppagation(t),n.focusClick)return;if(!e._isInDelayedAction()||n.focused&&n.targetInControl(t.target))return n.click(t);e._setInDelayedAction(!0),n.focusClick=o.focusDelay(function(){e._setInDelayedAction(!1),n.destroyed||(n.focusClick=0,n.click(t))})}else if(!n){var r=t.target;if(r){if(r.getAttribute("data-error-close")){var l=a.findByAttribute(r,e.$element.get(0),"data-error");if(l)if(l.id){var u=l.id.substr(0,l.id.length-6);e.$model.$errors.$.rmvErrorById(u)}else a.remove(l),e.openErrors();return e._freeze(t)}if(r.getAttribute("data-form-detail-close"))return e.options.closeButtonHandler&&e.options.closeButtonHandler(),e._freeze(t);if(r.getAttribute("data-form-settings"))return e.options.authoringIndicator&&s.execLink({$formAuthoring:!0,path:e.options.path,name:e.options.externalLayout,schema:e.options.externalSchema,locale:e.options.externalLocale},{},null),e._freeze(t)}}var d=e._event2Layout(t);d&&d.$actionName&&e.execAction(d.$actionName)}),e.$element.on("keypress",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyDown(t)){var n=e._event2Field(t);n&&n.keypress&&n.keypress(t)}}),e.$element.on("keydown",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyPress(t)){var n=e._event2Field(t);n&&n.keydown&&n.keydown(t)}}),e.$element.on("keyup",function(t){if(e._inProcessing)return e._freeze(t);if(e._doKeyDown(t)){var n=e._event2Field(t);n&&n.keyup&&n.keyup(t)}}),e.$element.on("paste",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);n&&n.paste&&n.paste(t)}),e.$element.on("keyup",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);n&&n.keyup&&n.keyup(t)}),e.$element.on("mousedown",function(t){if(e._inProcessing)return e._freeze(t);var n=e._event2Field(t);return!n||!n.mousedown||n.mousedown(t)}),$(window).on("global-phoenix-resize",e._resizeHnd),n.prototype._addBaseEvents.call(this)},h.prototype._resizeControls=function(e){this.currentResizeList&&this.currentResizeList.forEach(function(t){t.resize(e)})},h.prototype._resizeAndAfterRender=function(e){this.afterRenderList&&(this.afterRenderList.forEach(function(e){e.afterAddedInDom()}),this.afterRenderList=[]),this._resizeControls(e)},h.prototype.afterAddedInDom=function(){n.prototype.afterAddedInDom.call(this);var e=this;e._resizeAndAfterRender(!1),e._autofocus&&e._autofocus.setFocus&&window.setTimeout(function(){e._autofocus&&(e._autofocus.setFocus(),e._autofocus=null)},200)},h.prototype._afterVisibilityChanged=function(e){n.prototype._afterVisibilityChanged.call(this,e);e.inDom&&e.resize&&this._resizeAndAfterRender(!0)},h}(t.BaseLayout));t.Form=h,t.FormClass=h,t.removeForm=function(e){if(e){var t=null;e.$element&&(t=e.$element.get(0)),e.destroy(),t&&a.remove(t)}},t.OpenForm=null,t.OpenInlineForm=null}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){var t=e,n=t.ajax,i=t.dom,o=t.utils,r=t.autoclose,s=(t.modal,t.pagecontrol),a=t.application,l=t.Observable.SchemaUtils,u=t.external,d=t.customData;!function(t){var c=function(e){function n(n,i,o,r,s,a){var l=e.call(this,n,s)||this,u=l,d=n.opts?n.opts:{};return n.validators&&(d.validators=n.validators,delete n.validators),u.render=new t.Form(i,d,r,o,s,a),u.render.$locale=s,l}return __extends(n,e),n.prototype.on=function(e){var t=this;t._clickHnd=function(e){t.render.afterchanged(e,"modal-action",{})},t.render.on(function(n,i,o){return e(t,n,i,o)})},n.prototype.onNatural=function(e){var t=this;t._clickHnd=function(e){t.render.afterchanged(e,"modal-action",{})},t.render.on(function(n,i,o){return e(n,i,o,t)})},n}(e.modal.Modal);function p(e){return"string"==typeof e?{message:e}:e}t.ModalForm=c;var h=function(e,t,i,r,s,l){var d,c=0,p=-1,h=-1,f=[],m={locale:r},v=-1,g=-1,y=a.config(a.name);s=s||{},r&&r.$name&&(s.externalLocale=r.$name),i&&i.then?(f.push(i),v=0,c++):m.data=$.extend(!0,{},i),"object"==typeof e?(m.layout=$.extend(!0,{},e),d=m.layout.name):(p=c,c++,s.externalLayout=e,d=e,f.push(n.get(y.current.forms+"/"+e+".json"))),"object"==typeof t?m.schema=$.extend(!0,{},t):(h=c,c++,s.externalSchema=t,f.push(n.get(y.current.prototypes+"/"+t+".json")));var _=function(e,t){var n="";if(e&&a.name&&(n=a.name+"_form_"+e),n&&t&&t.current&&t.current.preferences){var i=t.current.preferences;i.excludedForms&&i.excludedForms.indexOf(n)>=0&&(n="")}return n}(d,y);_&&u.preferenceLoadHandler&&(g=c,c++,s.preferenceName=_,f.push(u.preferenceLoadHandler(_))),f.length?o.Promise.all(f).then(function(e){p>=0&&(m.layout=e[p]),h>=0&&(m.schema=e[h]),v>=0&&(m.data=e[v]),g>=0&&(m.preferences=e[g]),l(null,s,m)}).catch(function(e){l(e,null,null)}):l(null,s,m)},f=function(e,t,i,r,s,a){h(t,i,r,s,null,function(t,i,r){if(t)return console.log(t),t=(t=p(t))._ajax?n.extractAjaxErrors(t):t,e&&e.module&&e.module.error?e.module.error(t):void o.alert("",t.message,function(){});var s,u,d;(e=e||{}).opts=i,s=e,u=r,d=a,l.loadSchemaRefs(u.schema,u.data,u.layout,null,function(e,t){if(e)return console.log(e),e=(e=p(e))._ajax?n.extractAjaxErrors(e):e,s&&s.module&&s.module.error?s.module.error(e):void o.alert("",e.message,function(){});var i=new c(s,u.layout,u.schema,t,u.locale,u.preferences);i.open(),d&&(s.natural?i.onNatural(d):i.on(d))})})},m=function(e,t){t.isFormController?e.beforeSetModel=t.beforeSetModel?t.beforeSetModel.bind(t):null:e.beforeSetModel=t.initObjectState?t.initObjectState.bind(t):null,e.beforeModelCreated=t.initModel?t.initModel.bind(t):null,e.onSettings=t.onSettings?t.onSettings.bind(t):null,e.storageName=t.storageName,e.validators=t.validators,e.checkFormLayout=t.checkFormLayout},v=function(e,t){if(!e.controller)throw"Controller name is empty.";var n="string"==typeof e.controller?d.get(e.controller):e.controller;if(!n)throw o.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var i={};m(i,n);var r=e.options;r.opts=i,r.parentContext=e.parentContext,r.natural=!0;var s=null;n.isFormController?s=n.modelChanged.bind(n):n.onModelChanged&&(s=n.onModelChanged.bind(n)),f(r,e.name,e.meta,t,e.locale,s)},g=function(e,t,n){if(!e.controller)throw"Controller name is empty.";var i="string"==typeof e.controller?d.get(e.controller):e.controller;if(!i)throw o.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var r={};m(r,i);var s=e.options;(s=r).natural=!0,s.parentContext=e.parentContext;var a=null;i.isFormController?a=i.modelChanged.bind(i):i.onModelChanged&&(a=i.onModelChanged.bind(i)),s.autoClose=e.autoClose,_(null,e.name,e.meta,t,null,a,s,n)},y=function(e,a,u,d,c){l.loadSchemaRefs(a.schema,a.data,a.layout,d?d.parentContext:null,function(l,h){if(l)return console.log(l),l=(l=p(l))._ajax?n.extractAjaxErrors(l):l,d&&d.module&&d.module.error?d.module.error(l):void o.alert("",l.message,function(){});a.data=h,function(e,n,o,a,l){if((a=a||{design:!1})&&a.autoClose){var u=a.autoClose,d={parent:u.parentId?i.find(null,u.parentId):null,alignElement:u.alignElementId?i.find(null,u.alignElementId):null,style:u.style,parents:u.parents,opener:u.opener,width:u.width,height:u.height,minWidth:u.minWidth,minHeight:u.minHeight,stayOnTop:u.stayOnTop,beforeClose:u.beforeClose,contentRender:function(e,i,r){try{var d=a;a.opts&&(a=a.opts||{}),d!==a&&d.parentContext&&(a.parentContext=d.parentContext,d.parentContext=null),u.showCloseButton&&(a.closeButtonHandler=function(){s.Page().setPopup(null)});var c=new t.Form(n.layout,a,n.data,n.schema,n.locale,n.preferences);c.$locale=n.locale,c.autoClose=i,c.render(e),o&&c.on(o),i.renderControl=c,r(),l&&l(c)}catch(e){r(e)}}};r.open(u.align,d)}else{var c=a;a.opts&&(a=a.opts||{}),c!==a&&c.parentContext&&(a.parentContext=c.parentContext,c.parentContext=null);var p=new t.Form(n.layout,a||{design:!1},n.data,n.schema,n.locale,n.preferences);p.$locale=n.locale,p.render(e),o&&p.on(o),l&&l(p)}}(e,a,u,d,c)})},_=function(e,t,i,r,s,a,l,u){h(t,i,r,s,l,function(t,i,r){if(t)return console.log(t),t=(t=p(t))._ajax?n.extractAjaxErrors(t):t,l&&l.module&&l.module.error?l.module.error(t):void o.alert("",t.message,function(){});i&&l&&l.parentContext&&(i.parentContext=l.parentContext),y(e,r,a,i,u)})};var b=function(){function e(){}return e.prototype.isFormController=function(){return!0},e.prototype.data=function(){return null},e.prototype.beforeSetModel=function(e,t){t&&t.hasNestedControllers()&&t.modelCreated(e),this.initObjectState(e,t)},e.prototype.initObjectState=function(e,t){},e.prototype.modelChanged=function(e,t,n,i){n.hasNestedControllers()&&n.modelChanged(e,t,n,i),this.onModelChanged(e,t,n,i)},e.prototype.onModelChanged=function(e,t,n,i){var o=e.property,r=e;if(o){this.bindProperty&&0===o.indexOf(this.bindProperty)&&(o=o.substr(this.bindProperty.length),r.property=o),o.indexOf("$links.")>=0&&(o=o.replace(/\$links\./g,""));var s="on"+o.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("").split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");if(this[s])return this[s](r,t,n,i)}},e}();t.FormController=b,d.register("phoenix.empty.controller",{onModelChanged:function(e,t,n,i){}}),t.loadSchema=function(e){if("object"==typeof e)return o.Promise.resolve($.extend(!0,{},e));var t=a.config(a.name);return n.get(t.current.prototypes+"/"+e+".json")},t.formController2Options=m,t.OpenModalForm=f,t.showModalForm=v,t.showAutoCloseForm=g,t.OpenForm=_,t.OpenInlineForm=function(e,t,n,r,s,a,l,u){var c={name:t,meta:n,controller:r,options:{},formParent:e,locale:a};u&&o.merge(u,c.options),function(e,t,n){if(!e.controller)throw"Controller name is empty.";var r="string"==typeof e.controller?d.get(e.controller):e.controller;if(!r)throw o.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var s={};m(s,r);var a=e.options;a.opts=s,a.parentContext=e.parentContext,a.natural=!0;var l=null;if(r.isFormController?l=r.modelChanged.bind(r):r.onModelChanged&&(l=r.onModelChanged.bind(r)),!e.formParent)throw"No form parent.";var u=i.find(null,e.formParent);if(!u)throw"No form parent.";_($(u),e.name,e.meta,n,e.locale,l,a,t)}(c,l,s)},u.formOpenHandler=function(e){var t={name:e.name,meta:e.meta,controller:e.controller||"phoenix.empty.controller",options:e.options||{}};e.modal?v(t):(t.autoClose={align:r.BOTTOM_LEFT,opener:e.opener,alignElementId:e.alignElementId,style:e.style,parents:e.parents,width:e.width,height:e.height,minWidth:e.minWidth,minHeight:e.minHeight,showCloseButton:e.showCloseButton},g(t))}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){e.render,e.ui;var t=e.dom,n=e.utils,i=(e.device,e.Observable),o=e.ulocale,r=e.locale,s=e.customData,a=i.SchemaUtils;!function(i){var l="datepicker",u="datetimepicker",d=function(e){return"center"===e?"align-center":"right"===e?"align-end":""},c=function(e,t,n,i){var o=s.get("ui.html."+n);return o?{value:o(e,t,i),html:!0}:{value:t,html:!1}},p=function(e,n,i){var o=e.avanced.icons[n]||"none",r=e.avanced.iconClass||null,s=d(e.avanced.alignIcon||"center"),a=[];o&&a.push(r?t.customIconClass(o,r):t.iconClass(o));var l=e.tableOptions&&e.tableOptions.small?"small-table":"",u=["bs-image-cell",s];e.avanced._expandItem&&(u.push("bs-expand-parent"),a.push("bs-expand-child")),l&&u.push(l);var c=['<div class="'+u.join(" ")+'"'];return e.avanced._clickable&&c.push(' data-clickable="true"'),e.avanced._expandItem&&(e.level&&c.push(' style="margin-left:'+.5*e.level+'em;"'),a.push("bs-expand-space"),e.avanced._expandItemClass&&a.push(e.avanced._expandItemClass)),e.display||a.push("bs-image-size"),c.push('><span class="'+a.join(" ")+'"></span>'),e.avanced._expandItem&&e.display&&e.display.value&&(c.push('<span class="bs-expand-child">'),c.push(" "),c.push(e.display.value),c.push("</span>")),c.push("</div>"),{value:c.join(""),html:!0}},h={useDatePicker:function(){return null!=$.fn[l]},useDateTimePicker:function(){return null!=$.fn[u]},addErrorDiv:function(t,n){e.bootstrap4?t.push('<div class="invalid-feedback bs-none'+(n?" no-y-margin":"")+'" id="{0}_errors"></div>'):t.push('<div class="small text-danger bs-none" id="{0}_errors"></div>')},keyPressPassword:function(e,n,i){return e.which!==t.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressDate:function(e,t,n){return!0},keyPressCode:function(e,n,i){return e.keyCode!==t.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressNumber:function(e,n,i){var o="-0123456789,."+i.decimalSep,r=e.keyCode;if(!e.metaKey&&t.ignoreKeys.indexOf(r)<0){var s=String.fromCharCode(r);if(o.indexOf(s)<0)return e.preventDefault(),!1}return!0},doPasteDate:function(e,t,n){return!0},doPasteCode:function(e,t,n){return!0},doPasteNumber:function(e,t,n){return!0},doPastePassword:function(e,t,n){return!0},keyDownDate:function(e,t,n){return!0},keyDownCode:function(e,t,n){return!0},keyDownNumber:function(e,t,n){return!0},keyDownPassword:function(e,t,n){return!0},addContainerId:function(e,t){t&&e.push(' draggable="true"'),e.push(' data-render="{0}"'),e.push(' id="{0}"')},containerBaseClass:function(e,t,n){var i=[e,n.groupFieldClass||"bs-field-group","bs-island"];return n.noVerticalMargins&&!t&&i.pop(),n.inline&&i.push(n.inlineFieldClass||"bs-field-inline"),t&&i.push(" design"),i.join(" ")},align2Css:d,fieldWrapper:function(t,n,i,o,r){var s=e.bootstrap4;n.inline&&(n.columns=!1);var a=r&&r.formGroup?r.formGroup:"form-group",l=[h.containerBaseClass(a,i,n)],u=r&&r.tag?r.tag:"div";t.push("<"+u+' class="'),n.size&&l.push((s?"form-control":"form-group-")+n.size),n.columns&&(s||l.push("form-horizontal"),l.push("row")),n.styles&&l.push(n.styles),n.right&&l.push(" float-right"),t.push(l.join(" ")),t.push('"'),h.addContainerId(t,i),t.push(">"),o(),t.push("</"+u+">")},fillSelect:function(e,n,i){if(n){var o=i.enumNames||i.enum,r=i.enum;t.empty(n);var s=document.createDocumentFragment();e.forEach(function(e){var n=r.indexOf(e),i=o[n]||e+"",a=document.createElement("option");t.attr(a,"value",e),a.textContent=i,t.append(s,a)}),t.append(n,s)}},datePickerSetValue:function(e,t){e[l]("update",o.parseISODate(t||"")||"")},datePickerInitialize:function(e,n,i){t.addClass(e.get(0),"date");var r=$.extend({zIndexOffset:1e3,language:o.currentLang,autoclose:!0},n||{});e[l](r),i&&e[l]().on("hide",i)},datePickerDestroy:function(e){e.data[l]&&(t.removeClass(e.get(0),"date"),e[l]("destroy"))},dateTimePickerSetValue:function(e,t){e[u]("date",o.parseISODate(t||"")||"")},dateTimePickerInitialize:function(e,n,i){t.addClass(e.get(0),"date");var r={icons:{time:t.iconClass("clock-o"),date:t.iconClass("calendar"),up:t.iconClass("arrow-up"),down:t.iconClass("arrow-down"),previous:t.iconClass("arrow-left"),next:t.iconClass("arrow-right"),today:t.iconClass("exclamation-circle"),clear:t.iconClass("trash"),close:t.iconClass("times")},locale:o.currentLang,showClose:!0},s=$.extend(r,n||{});e[u](s),i&&e[u]().on("hide",i)},dateTimePickerDestroy:function(e){e.data[u]&&(t.removeClass(e.get(0),"date"),e[u]("destroy"))},text2value:function(e,t,n){if(a.isDate(t)){var i=o.tryParseDate(e);return o.localeDate2ISO(i)}if(a.isDateTime(t)){i=o.tryParseDateTime(e);return o.localeDateTime2ISO(i)}return a.isNumber(t)?a.text2Value(e+"",t,n):e},defaultOptions:{titleIsHidden:!1,placeHolder:!1,labelCol:3},displayValue:function(e,i,s,l,u,d){var h;if(l=l||{},n.isNullOrUndefined(e))return h={value:"",html:!1};if(l.isTotal&&(a.isFwField(d)||i.enum))return h={value:"",html:!1};if(i.enum){var f=i.enum.indexOf(e),m=f>=0?i.enumNames?o.tt(i.enumNames[f],s):e:"";h=l.avanced&&l.avanced.transform?c(e,m,l.avanced.transform,u):l.avanced&&l.avanced.icons?p(l,e):{value:m,html:!1}}else switch(i.type){case"string":if(i.format)switch(i.format){case"date":m=o.shortDate(e||"");h=l.avanced&&l.avanced.transform?c(e,m,l.avanced.transform,u):{value:m,html:!1};break;case"date-time":var v=o.shortDateTime(e||"");h=l.avanced&&l.avanced.transform?c(e,v,l.avanced.transform,u):{value:v,html:!1}}h||(h=l.avanced&&l.avanced.transform?c(e,e,l.avanced.transform,u):l.avanced&&l.avanced.icons?p(l,e):e&&l.avanced&&l.avanced.multiline?{value:"<span>"+e.split("\n").map(function(e){return n.escapeHtml(e)}).join("<br/>")+"</span>",html:!0}:{value:e,html:!1});break;case"number":var g=void 0;g=l.state?o.decimal(e||0,l.state.decimals||0,l.useSymbol&&l.state.symbol||""):"money"===i.format?o.money(e||0,l.useSymbol):o.decimal(e||0,i.decimals||0,l.useSymbol?i.symbol:""),h=l.avanced&&l.avanced.transform?c(e,g,l.avanced.transform,u):l.avanced&&l.avanced.icons?p(l,e):{value:g,html:!1};break;case"integer":var y=o.integer(e);h=l.avanced&&l.avanced.transform?c(e,y,l.avanced.transform,u):l.avanced&&l.avanced.icons?p(l,e):{value:y,html:!1};break;case"boolean":if(l.isTotal)return h={value:"",html:!1};if(l.avanced&&l.avanced.transform)h=c(e,e?r.ui.Yes:r.ui.No,l.avanced.transform,u);else if(l.html){var _=[];if(l.avanced&&l.avanced.editable||l.editable||l.check||l.avanced&&l.avanced.icons){var $=l.tableOptions&&l.tableOptions.small?" small-table":"",b=l.avanced?l.avanced.icons:null;b||(b={true:"check-square-o",false:"square-o"});var x=b[!!e+""],C=["bs-bool-edit","bs-image-size"];x&&C.push(t.iconClass(x)),_.push('<center class="bs-image-cell'+$+'"><span data-clickable="true" class="'+C.join(" ")+'"></span>&nbsp;</center>'),h={value:_.join(""),html:!0}}else h={value:e?r.ui.Yes:r.ui.No,html:!1}}else h={value:e?r.ui.Yes:r.ui.No,html:!1}}if(h||(h={value:e,html:!1}),l.html&&l.avanced&&l.avanced.$link){var k=['<a href="#" class="bs-cursor-p" data-phoenix-href="link://$link">'];k.push(h.value),k.push("</a>"),h.value=k.join(""),h.html=!0}return h},addTooltipAndRule:function(e,n){n.description&&(e.push('<span id="{0}_tooltip" data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title="'+n.description+'" class="'+t.iconClass("question-circle")+" bs-tooltip-icon"),e.push('"></span>')),n.rules&&(e.push('<span id="{0}_rules"  class="'+t.iconClass("bolt")+" bs-rules"),e.push('"></span>'))}};if(h.useDatePicker()){var f=function(t){var n=$.fn[l];e.bootstrap4&&(n.DPGlobal.template=n.DPGlobal.template.replace(/\"table-condensed\"/g,'"table-sm"')),n.dates[t]={days:r.date.weekdays,daysShort:r.date.weekdaysShort,daysMin:r.date.weekdaysMin,months:r.date.months,monthsShort:r.date.monthsShort,today:r.date.today,clear:r.date.clear,format:r.date.dateShort.replace(/\//g,r.date.daySep),titleFormat:"MM yyyy",weekStart:r.date.weekStart}};t.readyHandlers.push(function(){f(o.currentLang)}),o.register(f)}if(h.useDateTimePicker()){f=function(t){var n=window.moment;n&&n.updateLocale(t,{months:r.date.months,monthsShort:r.date.monthsShort,weekdays:r.date.weekdays,weekdaysShort:r.date.weekdaysShort,weekdaysMin:r.date.weekdaysMin,longDateFormat:{LT:e.locale.date.shortTime.replace(/M/g,"m").replace(/S/g,"s"),L:r.date.dateShort.replace(/\//g,r.date.daySep).toUpperCase()},week:{dow:r.date.weekStart}})};t.readyHandlers.push(function(){f(o.currentLang)}),o.register(f)}i.utils=h}(e.uiutils||(e.uiutils={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i=e.utils,o=(e.uiutils,e.Observable),r=e.dom,s=e.external,a=e.customData,l=o.SchemaUtils;t=e.ui||(e.ui={}),n=function(){function t(e,t,n){var i=this;i._isBinded=!0,i.config=e,i.form=n,i.options=t||{},e.options=e.options||{},i.parent=i.form.getLayoutById(e.$parentId),i.$bind=e.$bind,"$none"===i.$bind&&(i._isBinded=!1,i._internalValue=e.options.value,i._internalState=e.options.state||{}),e.$name&&(i.name=e.$name),i.$display=i.config.$display||i.$bind,e.$lookup&&(i.useDisplay=i.$display!==i.$bind,i.$lookup=i.form.getLookupForSchema(i.$bind,e.$lookup)),l.isMeta(i.$bind)&&(i.$bind=i.getCustomBind()),i._isBinded&&i.$bind&&n.registerListenerFor(i.$bind,i),i._isBinded&&i.useDisplay&&n.registerListenerFor(i.$display,i),i._defineProps(),i.fieldOptions=e.options||{},i.renderOptions=i.fieldOptions,i.$schema=i._isBinded&&i.$bind?n.getSchema(i.$bind):{},i.$schema&&"array"===i.$schema.type&&(i.$schemaItems=l.expand$Ref(i.$schema.items,i.form.$rootSchema)),i.id=e.$id,i.title=i.fieldOptions.title?i.fieldOptions.title:i.$schema?i.$schema.title:i.$bind}return t.prototype.hide=function(e){this._isBinded&&(this._internalState.isHidden=!0,this.stateChanged&&this.stateChanged("isHidden",{}))},t.prototype.setInternalValue=function(e,t){if(!this._isBinded&&this._internalValue!==e){var n=this._internalValue;this._internalValue=e,this.changed&&this.changed("",n,e,"propchange"),this.fieldOptions.onChange&&this.fieldOptions.onChange()}},t.prototype.getInternalValue=function(){return this._internalValue},t.prototype.getSettingsName=function(e){var t=[this.$bind,e];return this.name&&t.push(this.name),t.join("_")},t.prototype.targetInControl=function(e){if(this.$element){var t=this.$element.get(0);return r.isChildOf(t,e)}return!1},t.prototype.focusInControl=function(e){if(this.$element){var t=this.$element.get(0);return r.isChildOf(t,e)}return!1},t.prototype.setParentId=function(e){},t.prototype.isMeta=function(){return!1},t.prototype.beforeSaveSettings=function(){return!1},t.prototype.savePreferences=function(e){if(this._isBinded)return this.form.supportSettings()?void(this.beforeSaveSettings()&&this.form.savePrefs(e)):e()},t.prototype.getCustomBind=function(){return""},t.prototype.getBind=function(){var e=[];return this.$bind&&e.push(this.$bind),e},t.prototype.setHidden=function(e){e&&(this.state.isHidden?r.addClass(e,"bs-none"):r.removeClass(e,"bs-none"))},t.prototype._state=function(){var e,t=this;t.state=t.state||{},t._isBinded?(e=t.form.getState(t.$bind),t.state.value=t.form.getValue(t.$bind)):(e=t._internalState,t.state.value=t._internalValue),Object.keys(e).forEach(function(n){t.state[n]=e[n]})},t.prototype._defineProps=function(){},t.prototype.render=function(e){},t.prototype.appendElement=function(e,t){e&&(this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},t.prototype.setEvents=function(e){},t.prototype.removeEvents=function(){},t.prototype.customOptions=function(e){if(this._isBinded&&i.showRules()){var t=this.form.$rootSchema,n=this.form.$schema;this.getBind().forEach(function(i){var o=l.getSchema(l.parentPath(i),n,t,!0),r=l.lastSegment(i,null);o&&o.name&&(n.rules&&n.rules.validation&&n.rules.validation[o.name]&&n.rules.validation[o.name][r]?e.rules=!0:n.rules&&n.rules.propagation&&n.rules.propagation[o.name]&&n.rules.propagation[o.name][r]&&(e.rules=!0))})}},t.prototype.showRules=function(){if(this._isBinded){var e=this.form.$rootSchema,t=[],n=this.form.$schema;this.getBind().forEach(function(i){var o=l.getSchema(l.parentPath(i),n,e,!0),r=l.lastSegment(i,null);o&&o.name&&(n.rules&&n.rules.validation&&n.rules.validation[o.name]&&n.rules.validation[o.name][r]&&t.push(n.rulesMap[n.rules.validation[o.name][r]]),n.rules&&n.rules.propagation&&n.rules.propagation[o.name]&&n.rules.propagation[o.name][r]&&t.push(n.rulesMap[n.rules.propagation[o.name][r]]))}),s.ruleViewer&&s.ruleViewer(t)}},t.prototype._initOptions=function(e){var t=this,n={};t.parent&&t.parent.$fieldsOptions&&(t.parent.$fieldsOptions.columns&&(void 0===n.columns&&(n.columns=t.parent.$fieldsOptions.columns),void 0===n.labelCol&&t.parent.$fieldsOptions.labelCol&&(n.labelCol=t.parent.$fieldsOptions.labelCol)),t.parent.$fieldsOptions.titleIsHidden&&void 0===n.titleIsHidden&&(n.titleIsHidden=!0));var i=$.extend({},e,n,t.fieldOptions);return t.parent&&t.parent.$inline&&(i.inline=!0),t.customOptions(i),t.renderOptions=i,i},t.prototype.destroy=function(){var e=this;e.focusTimer&&(window.clearTimeout(e.focusTimer),e.focusTimer=0),e.$element&&(e.removeEvents(),e.$element=null),e.destroyed=!0,e.$schema=null,e.parent=null,e._isBinded&&(e.$bind&&e.form.unRegisterListenerFor(e.$bind,e),e.useDisplay&&e.form.unRegisterListenerFor(e.$display,e))},t.prototype.showErrors=function(t,n){var i=n&&n.length,o=r.find(t,this.id+"_errors");if(o)if(i){var s=n[0].message;this.renderOptions.inline&&e.bootstrap4&&(s="  ("+s+")"),r.text(o,s),r.removeClass(o,"bs-none")}else r.addClass(o,"bs-none")},t}(),t.AbsField=n,t.registerControl=function(e,t,n,i,o){n=n||!1,i=i||"",n&&(t="*");var r=(o=o||{}).lookup||!1,s=o.format||"";o.readOnly?a.register("ui-controls-readonly-"+i+"-"+s,e):a.register("ui-controls-"+t+"-"+n+"-"+r+"-"+i+"-"+s,e)},t.getRegisteredControl=function(e,t,n,i,o){(t=t||!1)&&(e="*"),n=n||"",i=i||"";var r,s=!(!o||!o.lookup);return o&&o.readOnly?(!(r=a.get("ui-controls-readonly-"+n+"-"+i))&&i&&(r=a.get("ui-controls-readonly-"+n+"-")),r):(!(r=a.get("ui-controls-"+e+"-"+t+"-"+s+"-"+n+"-"+i))&&i&&(r=a.get("ui-controls-"+e+"-"+t+"-"+s+"-"+n+"-")),r)},t.registerLinkControl=function(e,t){t=t||"button",a.register("ui-control-links-"+t,e)},t.getRegisteredLinkControl=function(e){return e=e||"button",a.get("ui-control-links-"+e)},t.filterManagerFactory=null}(Phoenix||(Phoenix={})),function(e){var t,n=e,i=n.utils,o=n.dom,r=n.ui,s=n.uiutils;!function(t){var n=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(t,e),t.prototype._setDisabled=function(e,t){},t.prototype._setReadOnly=function(e,t){},t.prototype._setMandatory=function(e,t){},t.prototype._label=function(){return this.$element?o.find(this.$element.get(0),this.id+"_alert"):null},t.prototype._state2UI=function(){var e=this._label(),t=this.$element?this.$element.get(0):null;e&&(o.text(e,this.state.value||""),this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setMandatory(e,t))},t.prototype.changed=function(e,t,n,i){var r=this._label();this.state.value!=n&&(this.state.value=n,r&&o.text(r,this.state.value||""))},t.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n._label(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r))},t.prototype.render=function(e){var t=this._initOptions(s.utils.defaultOptions);return this.$element||(this.$element=$(function(e,t,n){(t=$.extend({columns:!1},t)).columns=!1;var o=[];return s.utils.fieldWrapper(o,t,n,function(){o.push('<div id="{0}_alert" class="alert alert-'+(t.type||"danger")+'" role="alert">'),o.push("</div>")}),i.format(o.join(""),e)}(this.id,t,this.options.design)),this._state2UI()),this.appendElement(e,t),this.$element},t}(e.ui.AbsField);t.Alert=n,r.registerControl(n,"string",!1,"alert",null)}(t||(t={}))}(Phoenix||(Phoenix={})),function(e){var t=e.utils,n=e.dom,i=e.ui,o=e.uiutils;!function(r){var s=function(e){function i(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(i,e),i.prototype.click=function(e){},i.prototype._setDisabled=function(e){},i.prototype._setReadOnly=function(e){},i.prototype._setMandatory=function(e){},i.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&this.renderContent(e)},i.prototype.renderContent=function(e){var t="";void 0!=this.state.value&&(t=JSON.stringify(this.state.value.model(!0),null,2)),n.append(e,$("<pre>"+t+"</pre>").get(0))},i.prototype.changed=function(e,t,n,i){this.state.value=this.form.getValue(this.$bind),this._state2UI()},i.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,n.setHidden(o)),i.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,n._setDisabled(o)),i.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,n._setReadOnly(o)),i.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,n._setMandatory(o))},i.prototype.render=function(e){var i=this._initOptions(o.utils.defaultOptions);return this.$element||(this.$element=$(function(e,i,r){i=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},i);var s=[];if(r)o.utils.fieldWrapper(s,i,r,function(){});else{var a=[];i.style&&n.parseStyle(i.style,a),s.push("<div"),a.length&&s.push(' class= "'+a.join(" ")+'"'),o.utils.addContainerId(s,r),s.push("/></div>")}return t.format(s.join(""),e)}(this.id,i,this.options.design)),this._state2UI(),this.setEvents(i)),this.appendElement(e,i),this.$element},i}(e.ui.AbsField);r.ComplexBase=s,i.registerControl(s,"object",!1,"objectjson",null),i.registerControl(s,"array",!1,"objectjson",null)}(e.formcomplex||(e.formcomplex={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a;t=e.formarray||(e.formarray={}),i=(n=e).customData,n.formcomplex,o=n.ui,r=n.utils,s=n.dom,n.link,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.customOptions=function(t){if(e.prototype.customOptions.call(this,t),!t.item||!t.item.render)throw'Item render is null. Use options: { item : {render: "my_item_render"}} ';if(this._render=i.get(t.item.render),!this._render)throw"Item render isn't registered. Use customData.register(\""+t.item.render+'", controller);'},t.prototype._renderContentElement=function(e,t,n){void 0===n&&(n=!1);var i,o=this,r=[];if("scroll"===o._layout&&r.push(o._id+"_inScroll"),"grid"===o._layout||"column"===o._layout){var a=t%o._columns;if(0===a&&"grid"===o._layout||0===t&&"column"===o._layout){o._row=$('<div class="row"></div>').get(0);for(var l=Math.floor(12/o._columns),u=0;u<o._columns;u++)s.append(o._row,$('<div class="col-sm-'+l+'"></div>').get(0));s.append(o._cp,o._row)}i=o._row.childNodes[a]}else i=o._cp,r.push("bs-inline-block bs-va-top");o.renderOptions.item.style&&s.parseStyle(o.renderOptions.item.style,r);var d=$('<div class="'+r.join(" ")+'"></div>').get(0);n?o._parentItemAddedInDom=d:!e&&o._render.lastRender?o._render.lastRender(d,e,o._id,t):o._render.render(d,e,o._map,o.state.value.get(t),t),s.append(i,d)},t.prototype.beforeRenderContent=function(){this._render&&this._render.beforeRenderContent&&this._render.beforeRenderContent(this)},t.prototype.renderContent=function(e){var t=this;s.empty(e),t._parent=e,t._id=r.allocID(),t._map={},t._layout="inline",t.renderOptions&&t.renderOptions.layout&&(t._layout=t.renderOptions.layout.type),t._cp=document.createDocumentFragment(),"grid"!==t._layout&&"column"!==t._layout||(t._columns=Math.max(Math.min(t.renderOptions.layout.columns||4,12),1));var n=t.state.value.model(!0);if(t._localModel=n,t.beforeRenderContent(),n&&n.forEach(function(e,n){t._renderContentElement(e,n)}),t._render.lastRender&&t._renderContentElement(null,n&&n.length),t._renderContentElement(null,n&&n.length+1,!0),"grid"!==t._layout&&"column"!==t._layout||s.hasClass(e,"container-fluid")||s.addClass(e,"container-fluid"),"scroll"===t._layout){var i=$(r.format('<div id="{0}_overflow" class="array-control-overflow">',t._id)).get(0);s.append(i,$(r.format('<div id="{0}_left" class="{0}_move array-control-move array-control-goLeft"><span class="{1}"></span></div>',t._id,s.iconClass("chevron-left"))).get(0)),s.append(i,$(r.format('<div id="{0}_right" class="{0}_move array-control-move array-control-goRight"><span class="{1}"></span></div>',t._id,s.iconClass("chevron-right"))).get(0));var o=$(r.format('<div id="{0}_container"></div>',t._id)).get(0);s.append(i,o),s.append(o,t._cp),s.append(e,i)}else s.append(e,t._cp)},t.prototype.destroy=function(){this._map=null,this._render=null,e.prototype.destroy.call(this)},t.prototype.setEvents=function(e){this._render.setEvents&&this._render.setEvents(e)},t.prototype.removeEvents=function(){this._render.removeEvents&&this._render.removeEvents()},t.prototype.click=function(e){this._render.click&&this._render.click(this.$element.get(0),e,this._map,this.state.value,this.form)},t.prototype.afterAddedInDom=function(){this._render.afterAddedInDomRender&&this._render.afterAddedInDomRender(this._parentItemAddedInDom,this._id)},t.prototype.resize=function(){var e=this,t=0,n=0,i=0;if("scroll"===e._layout){e._nOverflow=$(r.format("#{0}_overflow",e._id)),e._nCtrlLeft=$(r.format("#{0}_left",e._id)),e._nCtrlRight=$(r.format("#{0}_right",e._id)),e._nContainer=$(r.format("#{0}_container",e._id)),e._nInScroll=$(r.format(".{0}_inScroll",e._id)),e._nCtrls=$(r.format(".{0}_move",e._id)),e._nInScroll.each(function(){t+=$(this).outerWidth(),$(this).height()>n&&(n=$(this).height()),$(this).outerWidth()>i&&(i=$(this).outerWidth())}),t=Math.round(t),n=Math.round(n),e._nContainer.css("width",t+"px"),e._nContainer.css("height",n+10+"px");var o=e._nCtrls.height();e._nCtrls.css("padding-top",Math.round(n/2-o/2)),e._nCtrls.css("padding-bottom",Math.round(n/2-o/2));e._nCtrlLeft.css("padding-left",10),e._nCtrlLeft.css("padding-right",20),e._nCtrlRight.css("padding-left",20),e._nCtrlRight.css("padding-right",10),e._nCtrlRight.css("left",Math.round(e._nOverflow.outerWidth()-(30+e._nCtrls.width()+3))),e._setMoveCtrls(),e._moveDelta=0,e._nCtrlLeft.mouseenter(function(){e._moveDelta=-5,e._activeMove()}),e._nCtrlLeft.mouseleave(function(){e._moveDelta=0}),e._nCtrlRight.mouseenter(function(){e._moveDelta=5,e._activeMove()}),e._nCtrlRight.mouseleave(function(){e._moveDelta=0})}e._render.afterResize&&e._render.afterResize(e._id,e.state.value,e.form)},t.prototype.changed=function(t,n,i,o){e.prototype.changed.call(this,t,n,i,o);var r=this;setTimeout(function(){r.afterAddedInDom(),r.resize()},50)},t.prototype._activeMove=function(){var e=this;0==e._moveDelta?e._moving=!1:e._moving||(setTimeout(function(){e._move(e)},10),e._moving=!0)},t.prototype._setMoveCtrls=function(){var e=this._nOverflow.scrollLeft();this._nCtrlLeft.css("display","block"),this._nCtrlRight.css("display","block"),0==e&&this._nCtrlLeft.css("display","none"),e+this._nOverflow.outerWidth()+1>this._nContainer.outerWidth()&&this._nCtrlRight.css("display","none")},t.prototype._move=function(e){var t=e,n=t._nOverflow.scrollLeft();t._nOverflow.scrollLeft(n+t._moveDelta),t._moving=!1,t._activeMove(),t._setMoveCtrls()},t}(e.formcomplex.ComplexBase),t.ArrayControl=a,o.registerControl(a,"array",!1,"array-control",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c,p,h,f,m,v,g;t=e.gridrender||(e.gridrender={}),n=e.utils,i=e.dom,e.ui,o=e.uiutils,r=e.ulocale,s=e.Observable.SchemaUtils,a=function(e,t){var n=i.icon(t?"caret-up":"caret-down");i.addClass(n,"bs-basictable-sort"),i.attr(n,"sort","true"),i.append(e.firstElementChild,n)},l=function(e){var t=e.lastElementChild?e.firstElementChild.lastElementChild:null;t&&"true"===i.attr(t,"sort")&&i.remove(t)},c=function(e,t,n,r,s,a,l,u){var d=document.createElement("tr");return"middle"===a.align&&i.addClass(d,"bs-va-middle"),s.forEach(function(e,s){var l=document.createElement("td");if(0==s)i.append(l,document.createTextNode(n.schema.title||String.fromCharCode(160)));else{i.attr(l,"rowId",e.id),i.attr(l,"colId",n.name),l.rowIndex=t,l.colIndex=s-1;var c=r.get(s-1),p=o.utils.displayValue(c.getRelativeValue(n.name),n.schema,u,{html:!0,useSymbol:!0,editable:n.canEdit,check:n.check,avanced:null,tableOptions:a,state:null},c,n.name);if(p.html){var h=$(p.value);i.append(l,h.get(0))}else i.append(l,document.createTextNode(p.value))}i.append(d,l)}),d},h=function(e,t,n,i,o){var r,s,a,l,u,c=t.scrolling&&t.scrolling.vertical,p=(s=n,a=o,l=(r=t).scrolling&&r.scrolling.vertical,u=["table","bs-control"],l&&u.push("scrolling"),(s||a)&&(u.push("table-header"),a?u.push("footer"):u.push("header"),a&&r.total&&r.total.light&&u.push("light")),!s&&!a&&r._useStripedCss&&r.striped&&u.push("table-striped"),r._useColGrp&&u.push("bs-fixed"),(s||a||!r.editing&&!r.nowrap)&&(s||a||!r.allowFrozenColumns)||(u.push("nowrap"),r._nowrap=!0),r.allowFrozenColumns&&!r.headerIsHidden&&(s?u.push("headernowrap"):l||u.push("headernowrap")),u.push("bs-theme"),r.border&&u.push("table-bordered"),r.small&&u.push("bs-style-small-table"),u);e.push("<table"),p.length&&e.push(' class="'+p.join(" ")+'"'),e.push(' id="{0}_table'),i&&e.push("_frozen"),n&&e.push("_header"),o&&e.push("_footer"),e.push('"');var h,f,m=(h=t,f=[],i?f:(h.width&&"auto"!==h.width&&f.push("min-width: "+d(h.width)),f));m.length&&e.push(' style="'+m.join(";")+'"'),e.push(">"),t._useColGrp&&e.push('<colgroup id="{0}_colgrp'+(i?"_frozen":"")+(n?"_header":"")+(o?"_footer":"")+'"></colgroup>'),n?t.headerIsHidden||e.push('<thead><tr class="bs-va-middle" id="{0}'+(i?"_frozen":"")+'_cols"></tr></thead>'):c||(t.headerIsHidden||e.push('<thead><tr class="bs-va-middle" id="{0}'+(i?"_frozen":"")+'_cols"></tr></thead>'),t.total&&t.total.property&&e.push('<tfoot id="{0}'+(i?"_frozen":"")+'_totals"></tfoot>')),o&&t.total&&t.total.property&&e.push('<tfoot id="{0}'+(i?"_frozen":"")+'_totals"></tfoot>'),n||o||(e.push('<tbody id="{0}'),i&&e.push("_frozen"),e.push('_rows"></tbody>')),e.push("</table>")},f=function(e){var t=0;return e.forEach(function(e){t+=parseInt(e.options.width+"",10)}),t},v=function(e,t,n){var i=t.offsetHeight-(n?3:1);e.style.height=Math.floor(i)+"px"},g={createCols:function(e,t,n,l,c,p,h){var f=document.createDocumentFragment(),m=(p||"").split(" ");return t.forEach(function(e,t){var l,h=document.createElement("th");i.attr(h,"colId",e.$bind),i.attr(h,"data-drag","move"),n._useColGrp||(e.options.width&&(h.style.width=d(e.options.width)),e.options.minWidth&&(h.style.minWidth=d(e.options.minWidth))),l&&(h.className=l.join(" "));var v=document.createElement("div"),g=["bs-column-header"];n.header&&(n.header.align&&g.push(n.header.align),n.header.style&&g.push(n.header.style)),v.className=g.join(" ");var y=v;if(n.headerLines&&(console.log("headerLines is obsolete. use instead header.rows"),n.header=n.header={},n.header.rows=n.headerLines),n.header&&n.header.rows&&n.header.rows>1){var _=document.createElement("div");g=["bs-header-rows-parent row-"+n.header.rows],_.className=g.join(" "),g=["bs-header-rows"],(y=document.createElement("div")).className=g.join(" "),_.appendChild(y),v.appendChild(_)}if(n.selecting&&n.selecting.multiselect&&n.selecting.selectAll&&s.isSelectField(e.$bind)){var b=o.utils.displayValue(!1,e.schema,c,{html:!0,selectable:!0,editable:!0,isTotal:!1,check:!0,avanced:e.options||{},tableOptions:n,state:{}},null,e.$bind);if(b.html){var x=$(b.value);i.append(y,x.get(0))}else i.append(y,document.createTextNode(b.value))}else i.append(y,document.createTextNode(r.tt((e.isLink&&!e.options.titleIsHidden?"":e.title)||String.fromCharCode(160),c)));if(n.allowColumnResize&&u(e.options.width)){var C=document.createElement("div");C.className="bs-col-resize",i.attr(C,"data-drag","resize"),i.attr(h,"colId",e.$bind),i.append(v,C)}if(i.append(h,v),n.sorting){var k=e.options.display?e.options.displaySchema:e.schema,w=e.options.display?e.options.display:e.$bind;k&&s.canSort(k)&&((l=l||[]).push("bs-cursor-p"),m&&m.length&&m[0]===w&&a(h,1===p.length))}l&&(h.className=l.join(" ")),i.append(f,h)}),f},createColGroup:function(e,t,n){var o=document.createDocumentFragment();return e.forEach(function(e){var t=document.createElement("col");i.attr(t,"colid",e.$bind),e.options.width&&(t.style.width=d(e.options.width)),e.options.minWidth&&(t.style.minWidth=d(e.options.minWidth)),i.append(o,t)}),o},updSorting:function(e,t,n,o){if(e.sorting&&t&&t.childElementCount){var r=(o||"").split(" ");r.length||(r=[""]);for(var s=0,u=t.children.length;s<u;s++){var d=t.children[s],c=i.attr(d,"colId"),p=n(c);c=p&&p.options&&p.options.display?p.options.display:c,r[0]===c?(l(d),a(d,1==r.length)):l(d)}}},gridContainer:function(e,t,r,s,a,l,u){s=s||"",t._useColGrp=function(e,t){for(var n=!0,i=0,o=t.length;i<o;i++){var r=t[i];if(!r.options.width||r.options.minWidth){n=!1;break}}if(!(n=n&&"auto"!==e.width)){if(e.scrolling&&e.scrolling.vertical)throw"To support scrolling vertical, all columns must have explicit widths but not explicit minWidth.";if(e.editing)throw"To support inline editing, all columns must have explicit widths but not explicit minWidth."}return n}(t,l),t._useStripedCss=!(t.rows&&t.rows.detail)&&t.striped,void 0!==(t=$.extend({right:!1,icon:null,type:"default",width:"auto",height:"auto",size:null,scrolling:{horizontal:!1}},t)).title&&(s=t.title);var d,c,p=[],m=["bs-field-group bs-tab-font bs-island"];t.noVerticalMargins&&!t.design&&m.pop(),p.push('<div id="{0}" '),p.push(' class="'),r&&m.push("design"),p.push(m.join(" ")),p.push('"'),c=p,(d=r)&&c.push(' draggable="true"'),d&&c.push(' data-render="{0}"'),p.push(">"),p.push('<div id="{0}_header"></div>'),m=["bs-basictable-group"];var v=t.scrolling&&t.scrolling.horizontal,g=t.scrolling&&t.scrolling.vertical;if((g||t.allowFrozenColumns)&&m.push("border"),v&&!g&&m.push("bs-scroll-x"),p.push('<div id="{0}_focus" class="'),p.push(m.join(" ")),p.push('"'),r||p.push(' data-render="{0}"'),t.selecting&&(t.selecting.cell||t.selecting.row)&&p.push(' tabindex="0" '),p.push(">"),t.allowFrozenColumns){p.push('<div class="bs-table-cols">');var y=f(u);if(p.push('<div id="{0}_frozen_header_parent"  class="bs-table-frozen-cols" style="width:'+y+'px;">'),g&&!t.headerIsHidden&&(p.push('<div id="{0}_table_frozen_header" class="bs-table-header header">'),h(p,t,!0,!0,!1),p.push("</div>")),m=["bs-table-content-scroll frozen"],p.push('<div  class="'+m.join(" ")+'">'),m=["bs-table-content frozen"],p.push('<div id="{0}_frozen_scroll" class="'+m.join(" ")+'"'),g){var _=[];if(t.minHeight&&_.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)_.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";_.length&&p.push(' style="'+_.join(";")+'"')}p.push(">"),p.push('<div  class="'+m.join(" ")+'">'),h(p,t,!1,!0,!1),g&&p.push('<div id="{0}_frozen_scroll_delta" class="bs-relative"></div>'),p.push("</div>"),p.push("</div>"),p.push("</div>"),g&&t.total&&t.total.property&&(p.push('<div id="{0}_table_frozen_footer" class="bs-table-header footer'+(t.total.light?" light":"")+'">'),h(p,t,!1,!0,!0),p.push("</div>")),p.push("</div>"),p.push('<div id="{0}_frozen_header_sep" class="bs-table-cols-sep'+(u.length?"":" empty")+'"></div>'),p.push('<div class="bs-table-free-cols">')}if(g&&!t.headerIsHidden&&(p.push('<div id="{0}_table_header" class="bs-table-header header" style="padding-right:'),p.push(i.scrollbar()),p.push('px;">'),p.push('<div id="{0}_table_header_content" class="bs-table-header-content">'),h(p,t,!0,!1,!1),p.push("</div></div>")),g&&p.push('<div class="bs-table-content-scroll">'),m=["bs-table-content"],g&&m.push("vscroll"),p.push('<div id="{0}_master_scroll" class="'+m.join(" ")+'"'),g){if(_=[],t.minHeight&&_.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)_.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";_.length&&p.push(' style="'+_.join(";")+'"')}return p.push(">"),h(p,t,!1,!1,!1),p.push("</div>"),g&&(p.push("</div>"),t.total&&t.total.property&&(p.push('<div id="{0}_table_footer" class="bs-table-header footer'+(t.total.light?" light":"")+'" style="padding-right:'),p.push(i.scrollbar()),p.push('px;">'),p.push('<div id="{0}_table_footer_content" class="bs-table-header-content">'),h(p,t,!1,!1,!0),p.push("</div>"),p.push("</div>"))),t.allowFrozenColumns&&(p.push("</div>"),p.push("</div>")),p.push("</div>"),p.push('<center id="{0}_pagination"></center>'),p.push('<div id="{0}_bottom"></div>'),o.utils.addErrorDiv(p),p.push("</div>"),n.format(p.join(""),e)},createRows:function(e,t,n,o,r,a,l,u,d,c,h){var f=null;if(c||h){for(var m=0,v=0;v<n.length;v++){var g=n[v];if(h){if(g.$bind===h)break}else if(s.isNumber(g.schema))break;m++}m>1&&(f={colspan:m,columnField:c})}var y=document.createDocumentFragment();return t&&t.forEach(function(e,t,r){r=r||0,d&&d(e,t,r),i.append(y,p(0,t,r,e,n,o,0,a,0,l,u,f))},o.expandingProperty),y},createBulkRows:function(e,t,n,o,r,s,a,l,u){var d=document.createDocumentFragment();return t&&t.forEach(function(e,t){var r=e.level||0;u&&u(e.value,t,r),i.append(d,p(0,t,r,e.value,n,o,0,s,0,a,l,null))}),d},createRow:p=function(t,n,r,a,l,u,c,p,h,f,m,v){e.bootstrap4;var g=document.createElement("tr");g.id=a.$id+(f?"_frozen":"");var y=["bs-table-row"];if("middle"===u.align&&y.push("bs-va-middle"),u.bindStatus){var _=a[u.bindStatus];_&&y.push("table-"+_)}(!m&&a.$select&&u.selecting&&u.selecting.row&&(u.noRowSelectedIndicator||y.push("bs-row-selected")),r&&y.push("bs-row-level-"+r),g.className=y.join(" "),!u._useStripedCss&&u.striped)&&(n%2==1||i.addClass(g,"even"));return l.forEach(function(e,t){var c=document.createElement("td");if(v)if(0===t)e=v.columnField?l.find(function(e){return e.$bind===v.columnField}):null,c.colSpan=v.colspan;else if(t<v.colspan)return;var h=!1;if(e){0===n&&u.headerIsHidden&&!u._useColGrp&&(e.options.width&&(c.style.width=d(e.options.width)),e.options.minWidth&&(c.style.minWidth=d(e.options.minWidth)));var f=[];e.options._expandItem&&f.push("bs-cursor-d");var y=a.getRelativeState(e.$bind);y.style&&i.parseStyle(y.style,f);var _=e.options.align;if(e.schema){var b=s.isNumber(e.schema),x=s.isDate(e.schema)||s.isDateTime(e.schema);u._nowrap||!b&&!x||f.push("nowrap"),_||(b?_="right":x&&(_="center"))}if(_&&f.push(o.utils.align2Css(_)),e.isLink&&!m&&e.options.button&&f.push("bs-td-button"),!m&&u.editing&&(!y.isHidden&&y.isReadOnly||y.isDisabled||!1===e.options.editing||!1===e.options.selecting)&&f.push("bs-td-readonly"),f.length&&(c.className=f.join(" ")),i.attr(c,"colId",e.$bind),y.isHidden)h=!0;else if(e.isLink){if(!m){var C=void 0,k=void 0;if(e.options.button){var w="";(C=document.createElement("button")).type="button",y.isDisabled&&(C.disabled=!0);var E=e.options.size||"sm",O="normal"===E?"":" btn-"+E,S=e.options.type||"link";if(S=i.bootstrapStyles(e.options.outline)[S],C.className="bs-button btn btn-"+S+O+(y.isDisabled?" disabled":""),e.options.icon&&((k=document.createElement("span")).className=i.iconClass(e.options.icon),i.append(C,k),w=" "),e.schema.title)if(e.options.titleIsHidden)C.title=e.schema.title;else{var P=document.createTextNode(w+e.schema.title);i.append(C,P)}}else if(e.options.icon){C=document.createElement("center"),y.isDisabled&&i.addClass(C,"bs-disabled"),k=document.createElement("span");var I=["text-"+(e.options.type||"default")];I.push("bs-basictable-btn"),I.push(i.iconClass(e.options.icon)),k.className=I.join(" "),i.append(C,k)}else h=!0;C&&(C.$link=e.$bind,i.append(c,C))}}else{var D=c,M=e.options||{},T=(u.editing||s.isSelectField(e.$bind))&&!y.isDisabled&&!y.isReadOnly&&!y.isHidden;if(!y.isHidden){var F=null;M.display&&M.displaySchema&&(F=o.utils.displayValue(a.getRelativeValue(M.display),M.displaySchema,p,{tableOptions:u,avanced:M.displayOptions||{},state:a.getRelativeState(M.display)},a,M.display));var L=o.utils.displayValue(a.getRelativeValue(e.$bind),e.schema,p,{html:!0,useSymbol:!1,selectable:!y.isDisabled,editable:T,isTotal:m,check:u.editing,avanced:M,tableOptions:u,display:F,level:r,state:y},a,e.$bind);if(L.html){var N=$(L.value);i.append(D,N.get(0))}else""===L.value?h=!0:i.append(D,document.createTextNode(L.value))}}}else h=!0;h&&i.append(c,document.createTextNode(String.fromCharCode(160))),i.append(g,c)}),g},setRowsSelected:function(e,t,n,o){if(n.selecting&&n.selecting.row){var r=[],s=i.find(o,e);s&&r.push(s),n.allowFrozenColumns&&(s=i.find(o,e+"_frozen"))&&r.push(s),r.forEach(function(e){t?i.addClass(e,"bs-row-selected"):i.removeClass(e,"bs-row-selected")})}},createGridRows:function(e,t,n,o,r,s,a){var l=document.createDocumentFragment();return t&&t.forEach(function(t,u){i.append(l,c(e,u,t,n,o,r,s,a))}),l},createInplaceEdit:function(e,t,a,l,u,d,c){if(d.schema.enum)return function(e,t,r,s,a,l,u){var d=document.createElement("select");d.type="text",d.className=["bs-inplace-edit bs-edit-border bs-inplace-edit-size custom-select"].join(" ");var c=r.filter?l.schema.filters[r.filter]||[]:l.schema.enum,p=c.indexOf(t);return o.utils.fillSelect(c,d,l.schema),v(d,s,!1),i.empty(s),i.addClass(s,"focused"),i.append(s,d),p<0?(n.nextTick(function(){a.item.setValue(l.$bind,c[0])}),d.selectedIndex=0):d.selectedIndex=p,{input:d,parent:d,td:s,combo:null,isInputElement:!0,canSelect:!1,schema:l.schema}}(0,t,a,l,u,d);if(s.isBoolean(d.schema))return{input:null,parent:null,td:l,isInputElement:!1,canSelect:!1,schema:d.schema,combo:null};if(c.after||c.before)return function(e,t,n,a,l,u,d){var c=document.createElement("div");c.className="bs-inplace-parent bs-edit-border ";var p=c;d.after&&((p=document.createElement("div")).className="bs-input-group",c.appendChild(p));var h=s.isDate(u.schema)&&o.utils.useDatePicker(),f=document.createElement("input");f.type=d.type||"text";var m=["bs-inplace-edit bs-inplace-edit-size"];if(d.after&&m.push("bs-input-group-main"),f.className=m.join(" "),i.append(p,f),d.after){var g=document.createElement("span");g.tabIndex=-1,g.className="bs-input-group-addon bs-cursor-d input-group-append input-group-addon";var y=document.createElement("span");y.className=i.iconClass(d.after.icon),i.append(g,y),i.append(p,g),d.id&&(g.id=d.id+"_after")}return v(f,a,!0),i.empty(a),i.addClass(a,"focused"),i.append(a,c),s.isDate(u.schema)?h?(o.utils.datePickerInitialize($(c),{showOnFocus:!1},function(e){}),o.utils.datePickerSetValue($(c),t)):f.value=r.isoDatePart(t||""):f.value=e,{input:f,parent:c,td:a,isInputElement:!0,canSelect:!0,schema:u.schema,combo:null}}(e,t,0,l,0,d,c);var p=document.createElement("input");p.type=c.type||"text";var h=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];return d.options.align&&h.push(o.utils.align2Css(d.options.align)),"text"===p.type&&d.schema.maxLength&&(p.maxLength=d.schema.maxLength),p.className=h.join(" "),v(p,l,!1),i.empty(l),i.addClass(l,"focused"),i.append(l,p),s.isDate(d.schema)?p.value=r.shortDate(t||""):(s.isNumber(d.schema),p.value=e),{input:p,parent:p,td:l,isInputElement:!0,canSelect:!0,schema:d.schema,decimals:a.decimals,combo:null}},updateInplaceEdit:function(e,t,i,r,a,l,u,d){if(u.schema.enum)return c=e,p=i,f=l,m=u,v=(h=r).filter?m.schema.filters[h.filter]||[]:m.schema.enum,void((g=v.indexOf(p))<0?(n.nextTick(function(){f.item.setValue(m.$bind,v[0])}),c.input.selectedIndex=0):c.input.selectedIndex=g);var c,p,h,f,m,v,g;t=t||"",s.isNumber(u.schema)?e.input.value=t:s.isDate(u.schema)&&o.utils.useDatePicker()?o.utils.datePickerSetValue($(a),i):e.input.value=t},createDetail:function(e,t){var n=document.createElement("tr");n.className="bs-table-row-detail",n.id=e+"_detail";var o=document.createElement("td");return o.colSpan=t.childNodes.length,i.append(n,o),n},updateEvenOdd:function(e){if(e.childNodes.length)for(var t=!1,n=0,o=e.childNodes.length;n<o;n++){var r=e.childNodes[n];i.hasClass(r,"bs-table-row")&&(t?i.removeClass(r,"even"):i.addClass(r,"even"),t=!t)}},ensureWidth:d=function(e){return"number"==typeof e?e+"px":parseInt(e,10)+""===e.trim()?e.trim()+"px":e},updateFrozenWidth:function(e,t,n){var o=f(n),r=i.find(e,t+"_frozen_header_parent");r&&(r.style.width=o+"px"),(r=i.find(e,t+"_frozen_header_sep"))&&(o?i.removeClass(r,"empty"):i.addClass(r,"empty"))},setColumnWidth:function(e,t,n){t.forEach(function(t){for(var o=0,r=t.childNodes.length;o<r;o++){var s=t.childNodes[o];if(i.attr(s,"colid")===e){s.style.width=n+"px";break}}})},hasFrozenColumns:function(e,t){return!!(e.allowFrozenColumns&&t&&t.length)},cloneForMove:function(e){var t=e.cloneNode(!0);if("th"===t.tagName.toLowerCase()){var n=e.parentElement,o=n.parentElement.parentElement,r=["<div>"];r.push('<table class="'),r.push(o.className),r.push('">'),r.push("<thead>"),r.push('<tr class="'),r.push(n.className),r.push('">'),r.push("</tr></thead><table>"),r.push("</div>");var s=$(r.join("")).get(0),a=s.firstChild.firstChild.firstChild;a.style.height=e.offsetHeight+"px",i.append(a,t),t=s}var l=i.position(e,null);return t.style.top=l.top+"px",t.style.left=l.left+"px",t.style.width=e.offsetWidth+"px",t.style.height=e.offsetHeight+"px",t.style.zIndex="9000",t.style.position="absolute",t},isPixel:u=function(e){if("number"==typeof e)return!0;if("string"==typeof e){var t=parseInt(e,10)+"";if(t===e.trim())return!0;if(t+"px"===e.trim())return!0}return!1},widthFromSchema:function(e){return s.isBoolean(e)?50:s.isDate(e)?110:s.isNumber(e)?110:150},resizeDiv:function(e,t){var n=document.createElement("div");return n.className="bs-absolute bs-col-resize-indicator",n.style.top="0px",n.style.left=t.left+"px",i.append(e,n),n},getColumnsSizeParents:function(t,n,i,o){var r,s=[];return i._useColGrp?o?((r=e.dom.find(n,t+"_colgrp_frozen_header"))&&s.push(r),(r=e.dom.find(n,t+"_colgrp_frozen"))&&s.push(r),i.total&&i.total.property&&(r=e.dom.find(n,t+"_colgrp_frozen_footer"))&&s.push(r)):((r=e.dom.find(n,t+"_colgrp_header"))&&s.push(r),(r=e.dom.find(n,t+"_colgrp"))&&s.push(r),i.total&&i.total.property&&(r=e.dom.find(n,t+"_colgrp_footer"))&&s.push(r)):i.headerIsHidden||(r=o?e.dom.find(n,t+"_frozen_cols"):e.dom.find(n,t+"_cols"))&&s.push(r),s},multiselectContainer:function(e,t){var o=['<div class="modal-content bs-table-selected-list" id="{0}_ms">'];o.push('<div class="bs-table-selected-list-header"><span id="{0}_close_ms" class="icon-close {1}"></span></div>'),o.push('<div class="bs-table-selected-list-content">'),o.push('<ul class="list-group"  id="{0}_ms_list">'),o.push("</ul>"),o.push("</div>"),o.push("</div>");var r=$(n.format(o.join(""),e,i.iconClass("window-minimize"))).get(0);return t||m(!0,e,r),r},createMultiselectItems:function(e,t,o,r){var s=i.find(t,e+"_ms_list"),a=o.rowMove.expression||"{{$id}}",l=$('<li class="list-group-item bs-list-item-button"></li>').get(0),u=$('<div class="bs-list-button"><span class="'+i.iconClass("times")+'"></span></div>').get(0),d=document.createDocumentFragment();for(r.forEach(function(e){var t=l.cloneNode();i.attr(t,"data-ms-unselect",e.$id),i.text(t,n.execAngularExpression(a,e.model(!0))),i.append(d,t),i.append(t,u.cloneNode(!0))});s.firstChild;)i.remove(s.firstChild);i.append(s,d)},isMultiselectMinimized:function(e){return i.hasClass(e,"minimized")},setMultiselectMinimized:m=function(t,n,o){var r=i.find(o,n+"_close_ms");t?(i.addClass(o,"minimized"),r&&(i.removeClass(r,e.dom.iconClass("window-minimize",!0)),i.addClass(r,e.dom.iconClass("window-maximize",!0)))):(i.removeClass(o,"minimized"),r&&(i.removeClass(r,e.dom.iconClass("window-maximize",!0)),i.addClass(r,e.dom.iconClass("window-minimize",!0))))}},t.GridUtil=g}(Phoenix||(Phoenix={})),function(e){var t=e.utils,n=e.dom,i=e.ui,o=e.ulocale,r=e.uiutils,s=e.Observable,a=e.gridrender.GridUtil,l=s.errorsUtils,u=e.link,d=e.locale,c=e.drag,p=e.events,h=s.SchemaUtils;!function(f){f.toolBarFactory=null,f.toolBarRender=null;f.gridlookup=null,f.glbGridFilter=null,f.glbGridSettings=null,f.glbMongoFilter2Filter=null;var m=function(m){function v(e,t,n){var i=m.call(this,e,t,n)||this;i._refreshGrid=function(){var e=this,t=e.renderOptions;e.state.value&&(e.state.value.allowSelecting=e.renderOptions.selecting&&(e.renderOptions.selecting.row||e.renderOptions.selecting.cell),e.state.value.multiselect=e.renderOptions.selecting&&e.renderOptions.selecting.multiselect,e.state.value.expandingProperty=e.renderOptions.expandingProperty),e.removeEvents(),e._initCols(t),e._renderColumns(t),e._renderRows(!0,"",null),e._renderTotalRows(),e.setEvents(e.renderOptions),e.resize()};var o=i;if(void 0===o.fieldOptions.striped&&(o.fieldOptions.striped=!0),o._view=[],o._viewMap={},o._ignoreNotifications=!1,o._state(),n.supportSettings()&&(o._settingsName=o.getSettingsName("basicgrid"),o._settings=n.getFieldSettings(o._settingsName)),o._settings){var r=o.fieldOptions.columns,s=o._settings.columns||[],a={};r.forEach(function(e){a[e.$bind]=e}),s.forEach(function(e){var t=a[e.$bind];if(t){var n=e.options||{},i=t.options||{};n.width&&(i.width=n.width),n.frozen&&(i.frozen=n.frozen),n.display&&(i.display=n.display),e.options=i}}),o.fieldOptions.columns=s,o._settings.columns=null}if(o.fieldOptions&&o.fieldOptions.total&&o.fieldOptions.total.property){o._totalProperty=o.fieldOptions.total.property;var l=o.form.getSchema(o._totalProperty);o._totalIsArray=l&&"array"===l.type,o._totalField=o.fieldOptions.total.field,o._stopField=o.fieldOptions.total.firstTotal,n.registerListenerFor(o._totalProperty,o)}return o.checkOptions(o.fieldOptions),o._initOrigColumns(o.fieldOptions),o._initCols(o.fieldOptions),o._details=[],o._onselectItemHandler=o._onselectItem.bind(o),i}return __extends(v,m),v.prototype._initOrigColumns=function(e){var t=this;t._originalCols={},e.columns=e.columns||[],e.columns.forEach(function(e){e.options=e.options||{},e.$bind===s.EXPANDED_FIELD_NAME&&e.options.display&&(t._originalCols[e.options.display]=$.extend(!0,{},e),t._originalCols[e.options.display].options._expandItem=!0)})},v.prototype.checkOptions=function(e){void 0===e.allowColumnMove&&(e.allowColumnMove=!0),e.align=e.align||"middle"},v.prototype.beforeSaveSettings=function(){var e=this;return!!e._settingsName&&(e._settings={columns:[]},(e.renderOptions.columns||[]).forEach(function(t){var n={$bind:t.$bind,options:null},i={};t.canStartDragHandler&&(i.frozen=!0),t.options.width&&(i.width=t.options.width),t.options.display&&(i.display=t.options.display),t.options.frozen&&(i.frozen=t.options.frozen),t.options._expandItem&&(n.$bind=s.EXPANDED_FIELD_NAME),n.options=i,e._settings.columns.push(n)}),e.form.setFieldSettings(e._settingsName,e._settings),!0)},v.prototype._inplaceEditValue2Model=function(e,t,n){var i=t.getState(n.$bind),o=h.text2Value(e,n.schema,i);return o!==t.getValue(n.$bind)&&(t.setValue(n.$bind,o),!0)},v.prototype.setFocus=function(e){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden)if(this.inplace&&this.inplace.input&&this.inplace.isInputElement)this.inplace.input.focus();else if(this.$element){var i=n.query(this.$element.get(0),'[tabindex="0"]');i&&i.focus()}},v.prototype._inplaceEditAcceptKeys=function(e){if(this.inplace.schema.enum){if(e===n.keys.VK_UP||e===n.keys.VK_DOWN)return!1}else if(h.isDate(this.inplace.schema)&&r.utils.useDatePicker()&&(e===n.keys.VK_UP||e===n.keys.VK_DOWN||e===n.keys.VK_LEFT||e===n.keys.VK_RIGHT))return!1;return!0},v.prototype._inplaceEditAddEvents=function(){var e=this;e.inplace.schema.enum&&$(e.inplace.input).on("change",function(t){var n=e.inplace.td,i=e._td2value(n),o=e._inplaceEditGetValue(i);e._inplaceEditValue2Model(o,i.item,i.col)||e._modifyCell(i.item,i.col.$bind,null,n)})},v.prototype._inplaceEditRemoveEvents=function(){this.inplace.schema.enum?$(this.inplace.input).off("change"):h.isDate(this.inplace.schema)&&r.utils.useDatePicker()&&r.utils.datePickerDestroy($(this.inplace.parent))},v.prototype._inplaceEditGetValue=function(e){if(!e.item)return null;var t=e.item.getState(e.col.$bind);if(this.inplace.schema.enum){var n=this.inplace.input.selectedIndex;return t.filter?this.inplace.schema.filters[t.filter][n]:this.inplace.schema.enum[n]}return r.utils.text2value(this.inplace.input.value,this.inplace.schema,t)},v.prototype._inpaceEditShow=function(e,i){var o=this,s=o._td2value(e),l=s.item.getValue(s.col.$bind),u=s.item.getState(s.col.$bind),d=h.value2Text(l,s.col.schema,u);e.tabIndex=-1;var c={type:"text",after:null,id:null};s.col.$lookup?(c.after={icon:"chevron-down"},c.id=e.id||t.allocID(),e.id=c.id):h.isDate(s.col.schema)&&r.utils.useDatePicker()&&(c.after={icon:"calendar"}),o.inplace=a.createInplaceEdit(d,l,u,e,s,s.col,c),s.col.$lookup&&(o.inplace.id=c.id,o.inplace.col=s.col,o._createGridPopup()),o._inplaceEditAddEvents(),o.inplace.isInputElement?(o.inplace.input.tabIndex=0,o.inplace.input.focus(),o.inplace.canSelect&&n.select(o.inplace.input)):(e.tabIndex=0,e.focus()),o._onFrozenFocusScroll(e,s.col)},v.prototype._destroyInplaceEdit=function(){this.inplace&&(this.inplace.combo&&(this.inplace.combo.destroy(),this.inplace.combo=null),this.inplace=null)},v.prototype._inplaceEditRemove=function(e,t,i){var o=this;if(o.inplace&&!t){var r=o.inplace.td;e&&(r.tabIndex=0);var s=o._td2value(r);if(o._inplaceEditRemoveEvents(),o.inplace.parent&&n.remove(o.inplace.parent),n.removeClass(r,"focused"),!!o.inplace.input){var a=o._inplaceEditGetValue(s);if(o._destroyInplaceEdit(),!s.item)return;if(s.col.$lookup){var l=(s.item.getValue(s.col.$bind)||"")+"";if(!i&&a!==l)return o._findValue(a,s,function(e){o._setRemoteValue(s.col,s.item,e),o._modifyCell(s.item,s.col.$bind,null,r)});o._modifyCell(s.item,s.col.$bind,null,r)}else!i&&o._inplaceEditValue2Model(a+"",s.item,s.col)||o._modifyCell(s.item,s.col.$bind,null,r)}}o._destroyInplaceEdit()},v.prototype._inplaceEditModel2Control=function(e,t,n){var i=this._td2value(n),o=(this._inplaceEditGetValue(i),e.getValue(i.col.$bind)),r=e.getState(i.col.$bind),s=h.value2Text(o,i.col.schema,r);a.updateInplaceEdit(this.inplace,s,o,r,n,i,i.col,{})},v.prototype.removeEvents=function(){this._scrollableMaster&&$(this._scrollableMaster).off("scroll"),this._scrollableMaster=null,this._scrollableHeaderOfMaster=null,this._scrollableFooterOfMaster=null,this._drag&&(c.dragManager.rmvDrag(this._drag),this._drag=null)},v.prototype._onFrozenFocusScroll=function(e,t){if(t&&t.options&&t.options.frozen){var n=this.renderOptions;a.hasFrozenColumns(n,this.frozenColumns)&&n.scrolling&&n.scrolling.vertical&&(this._rsFrozenTimer&&(this._rsFrozenTimer.clearTimeout(),this._rsFrozenTimer=null),this.syncMasterScroll(null))}},v.prototype.setEvents=function(e){var t=this;if(e.scrolling&&e.scrolling.vertical){var i=t.$element.get(0);t._scrollableMaster=n.find(i,t.id+"_master_scroll"),t._scrollableHeaderOfMaster=n.find(i,t.id+"_table_header_content"),t._totalProperty&&(t._scrollableFooterOfMaster=n.find(i,t.id+"_table_footer_content"));var o=a.hasFrozenColumns(e,t.frozenColumns);t._scrollableFrozenContent=o?n.find(i,t.id+"_frozen_scroll"):null,t._deltaHScrollContent=o?n.find(i,t.id+"_frozen_scroll_delta"):null,t._scrollableMaster&&t._scrollableHeaderOfMaster&&$(t._scrollableMaster).on("scroll",t.syncHeaderAndFrozenScroll.bind(t))}if((e.allowColumnResize||e.allowColumnMove)&&!e.headerIsHidden||e.rowMove){var r=c.dragManager.addDrag([t.$element.get(0)]);t._drag=r,r.canStartDragHandler=t._canStartDrag.bind(t),r.onDragStart=t._onDragStart.bind(t),r.onDrag=t._onDrag.bind(t),r.onDragEnd=t._onDragEnd.bind(t)}},v.prototype._getColsInfo=function(e,n){var i=[];return e.forEach(function(e,o){var r=n.childNodes[o];r.id||(r.id=t.allocID()),i.push({htmlId:r.id,info:e})}),i},v.prototype._canStartDrag=function(e){var i=this,o=e.target,r=n.attr(o,"data-drag"),s=i.renderOptions,a=null;if(s.headerIsHidden||!s.allowColumnResize&&!s.allowColumnMove||(a=n.parentByTag(i.$element.get(0),o,"th")),a){var l=i.renderOptions;return!(l.headerIsHidden||!l.allowColumnResize&&!l.allowColumnMove)&&(r||(r=n.attr(a,"data-drag")),!!r&&(a.id||(a.id=t.allocID()),i._drag.data.op=r,i._drag.data.cloneId=a.id,i._drag.data.column=n.attr(a,"colId"),!!i._drag.data.column&&i["_cdd"+r](e)))}var u=s.rowMove?n.parentByTag(i.$element.get(0),e.target,"td"):null;if(u){var d=i._td2cell(u);if(d){i.renderOptions;if(i._findById(d.row))return i._drag.data.op="rowmove",i._drag.data.row=d.row,i._drag.coverDocument=!1,i._drag.cursor="default",i._drag.moveSourceName="rowmove",!0}}return!1},v.prototype._onDragStart=function(e){return!!this._drag.data.op&&this["_sdd"+this._drag.data.op](e)},v.prototype._onDrag=function(e){return!!this._drag.data.op&&this["_ddd"+this._drag.data.op](e)},v.prototype._onDragEnd=function(e,t){return!!this._drag.data.op&&this["_edd"+this._drag.data.op](e,t)},v.prototype._cddresize=function(e){if(!this.renderOptions.allowColumnResize)return!1;var t=this._drag;return t.coverDocument=!0,t.cursor="col-resize",t.moveX=!0,!0},v.prototype._sddresize=function(e){var t=this._drag;t.floatParent=this._gridParentFocus();var i=n.find(t.floatParent,this._drag.data.cloneId),o=n.position(i,t.floatParent);return t.floatElement=a.resizeDiv(t.floatParent,{left:Math.round(o.left+i.offsetWidth)}),t.minLeft=Math.round(o.left+20),t.maxLeft=Math.round(o.left+2e3),!0},v.prototype._dddresize=function(e){return!0},v.prototype._eddresize=function(e,t){var i=this._drag;if(i&&(i.floatElement&&(n.remove(i.floatElement),i.floatElement=null),!e)){var o=this._colByField(i.data.column),r=p.point(t).x-i.startPoint.x,s=n.find(i.floatParent,this._drag.data.cloneId),a=parseInt(o.options.width+"",10);if(s.offsetWidth-a>5){var l=a/s.offsetWidth;r=Math.round(l*r)}var u=Math.min(Math.max(20,a+r),2e3);this._updateColWidth(o,u),this.savePreferences(function(){})}},v.prototype._updateColWidth=function(e,t){if(Math.max(parseInt(e.options.width||"0",10),2e3)!==t){e.options.width=t;var n=e.options.frozen&&this.renderOptions.allowFrozenColumns,i=a.getColumnsSizeParents(this.id,this.$element.get(0),this.renderOptions,n);a.setColumnWidth(e.$bind,i,t),n&&a.updateFrozenWidth(this.$element.get(0),this.id,this.frozenColumns),this.resize()}},v.prototype._cddmove=function(e){var t=this.renderOptions;if(!t.allowColumnMove)return!1;var i,o,r=this.$element.get(0),s=this._drag,a=n.find(r,s.data.cloneId);s.coverDocument=!0,s.cursor="move",s.moveX=!0,s.moveY=!0,s.startOffset=n.position(a,null);var l={firstDelta:0,lastDelta:-10,delta:-4,top:s.startOffset.top,height:a.offsetHeight};if(t.allowFrozenColumns&&(i=n.find(r,this.id+"_frozen_cols"))&&(o=n.childrenPositions(i,this._getColsInfo(this.frozenColumns,i),!1,"frozen",l)),l.lastDelta=0,i=n.find(r,this.id+"_cols")){var u=n.childrenPositions(i,this._getColsInfo(this.columns,i),!1,"free",l);o=o?o.concat(u):u}return s.data.childrenPositions=o,!0},v.prototype._cddrowmove=function(e){if(!this.renderOptions.rowMove)return!1;this.$element.get(0),this._drag;return!0},v.prototype._sddrowmove=function(e){var i=this.renderOptions;if(!i.rowMove)return!1;if(i.rowMove.multiselect&&(!i.selecting||!i.selecting.row||!i.selecting.multiselect))return!1;var o=i.rowMove.expression||"{{$id}}",r=this._drag,s=this._findById(this._drag.data.row);if(i.rowMove.multiselect&&s.$select)return!1;var l=$('<div><span class="bs-row-in-drag">'+t.escapeHtml(t.execAngularExpression(o,s))+"</span></div>").get(0);return r.floatElement=a.cloneForMove(l),r.floatElement.style.left=e.pageX-5+"px",r.floatElement.style.top=e.pageY-5+"px",n.append(document.body,r.floatElement),r.moveX=!0,r.moveY=!0,r.data.item=s,i.rowMove.multiselect&&(r.data.multiSelTarget=this._openMultiselectSummary(null,!0)),!0},v.prototype._dddrowmove=function(e){return!0},v.prototype._eddrowmove=function(e,t){var i=this._drag;if(i&&(i.floatElement&&(n.remove(i.floatElement),i.floatElement=null),!e&&t&&i.data.multiSelTarget)){var o=p.point(t),r=n.position(i.data.multiSelTarget,null);if(o.x>r.left&&o.x<r.left+i.data.multiSelTarget.offsetWidth&&o.y>r.top&&o.y<r.top+i.data.multiSelTarget.offsetHeight){var s=this.renderOptions;if(this.state.value){var a=this.state.value;a.selecting(!0,s.expandingProperty);try{i.data.item.select(!0,s.selecting&&s.selecting.row&&s.selecting.multiselect,this.state.value,s.expandingProperty,s.expanding&&s.expanding.selectChildren)}finally{a.selecting(!1,s.expandingProperty)}}}}},v.prototype._sddmove=function(e){var t=this._drag,i=n.find(this.$element.get(0),t.data.cloneId);return t.floatElement=a.cloneForMove(i),n.append(document.body,t.floatElement),!0},v.prototype._eddmove=function(e,t){var i=this,o=i._drag;if(o&&(o.floatElement&&(n.remove(o.floatElement),o.floatElement=null),o.data.mdiv&&(n.remove(o.data.mdiv),o.data.mdiv=null),!e&&o.data.best&&o.data.column)){var r=o.data.best.info,s=i._mapCols[o.data.column];if("empty"===o.data.best.position)s.column.options.frozen=!s.column.options.frozen;else{if(r.$bind===s.column.$bind)return;var a=i._mapCols[r.$bind],l=s.column,u=a.column,d=s.tindex,c="after"===o.data.best.position?a.tindex+1:a.tindex,p=!1;if(!!l.options.frozen!=!!u.options.frozen&&(l.options.frozen=u.options.frozen,p=!0),d===c-1){if(!p)return}else i.renderOptions.columns.splice(d,1),d<c&&c--,i.renderOptions.columns.splice(c,0,l)}i.savePreferences(function(){i._refreshGrid()})}},v.prototype._dddmove=function(e){var t=this._drag,i=p.point(e),o=n.findNearest(i.x,i.y,t.data.childrenPositions);if(t.data.best!=o){var r={left:o.left,top:o.top,width:o.width,height:o.height};t.data.mdiv=n.showMove(t.data.mdiv,o.vertical,r,"frozen"===o.zone?"bs-drag-color-success":"bs-drag-color-info")}return t.data.best=o,!0},v.prototype.destroy=function(){var e=this;e._destroyDetails(),e.columns&&(e.columns.forEach(function(e){e.schema=null}),e.columns=null),e.frozenColumns&&(e.frozenColumns.forEach(function(e){e.schema=null}),e.frozenColumns=null),e._totalProperty&&e.form.unRegisterListenerFor(e._totalProperty,e),e._inplaceEditRemove(!1,!0,!1),e._onselectItemHandler=null,e._eventBus&&(e._eventBus.destroy(),e._eventBus=null),e._pager&&(e._pager.destroy(),e._pager=null),e.toolBar&&(e.toolBar.destroy(),e.toolBar=null),e._details=null,e._mapCols=null,e._originalCols=null,e._settings=null,e._scroller=null,e._rsTimer=null,e._rsFrozenTimer=null,e._scrollableMaster=null,e._scrollableHeaderOfMaster=null,e._scrollableFooterOfMaster=null,e._scrollableFrozenContent=null,e._deltaHScrollContent=null,m.prototype.destroy.call(this)},v.prototype._moveToPage=function(e){this.state.value&&this.state.value.currentPage(e)},v.prototype._onselectPage=function(e){var t=this;switch(e){case"next":t._moveToPage(t._pager.options.noPagesCount?t._pager.props.currentPage+1:Math.min(t._pager.props.totalPages,t._pager.props.currentPage+1));break;case"prev":t._moveToPage(Math.max(0,t._pager.props.currentPage-1));break;case"first":t._moveToPage(1);break;case"last":t._moveToPage(t._pager.props.totalPages);break;default:t._moveToPage(e)}},v.prototype.setColumns=function(e){var t=this;t.renderOptions.columns=e.map(function(e){var n=t._colByField(e.$bind);return n||(n=t._originalCols[e.$bind]),n&&(n.options._expandItem&&(e.$bind=s.EXPANDED_FIELD_NAME),e.options=n.options),e}),t.savePreferences(function(){t._refreshGrid()})},v.prototype._setVisiblesColumns=function(e){var t=this;t.renderOptions.columns.forEach(function(t){var n=t.$bind;h.isSelectField(n)||(t.options._expandItem&&(n=s.EXPANDED_FIELD_NAME),t._isHidden=!!e&&e.indexOf(n)<0)}),t.savePreferences(function(){t._refreshGrid()})},v.prototype._getMultiselectdItems=function(){var e=[],t=this.renderOptions,n=this.state.value;if(n)return n.enumSelectedItems(t.expandingProperty,function(t){e.push(t)}),e},v.prototype._updateMultiselectSummary=function(e){var t=this,n=t.renderOptions;n.rowMove&&n.rowMove.multiselect&&n.selecting&&n.selecting.row&&n.selecting.multiselect&&(t._timeOutSelected&&window.clearTimeout(t._timeOutSelected),t._timeOutSelected=window.setTimeout(function(){var e=t._getMultiselectdItems();e.length?t._openMultiselectSummary(e,!1):t._closeMultiselectSummary(!0,!1)},100))},v.prototype._openMultiselectSummary=function(e,t){var i=n.find(this.$element.get(0),this.id+"_ms");return i?(e||(e=this._getMultiselectdItems()),t&&a.isMultiselectMinimized(i)&&a.setMultiselectMinimized(!1,this.id,i),a.createMultiselectItems(this.id,i,this.renderOptions,e)):i=this._toggleMultiselectSummary(e,t),i},v.prototype._closeMultiselectSummary=function(e,t){var i=n.find(this.$element.get(0),this.id+"_ms");if(e)i&&this._toggleMultiselectSummary(null,!1);else if(t&&i){var o=!a.isMultiselectMinimized(i);a.setMultiselectMinimized(o,this.id,i)}},v.prototype._toggleMultiselectSummary=function(e,t){var i=n.find(this.$element.get(0),this.id+"_ms");if(i)return n.remove(i),null;e||(e=this._getMultiselectdItems()),i=a.multiselectContainer(this.id,t),a.createMultiselectItems(this.id,i,this.renderOptions,e);var o=n.find(this.$element.get(0),this.id+"_focus");return o&&n.append(o,i),i},v.prototype._renderToolbar=function(){if(this.toolBar&&f.toolBarRender){var e=this.fieldOptions.toolbar||{},t=e.parentName&&!this.options.design?this.form.getLayoutElementByName(e.parentName):null,i=this.$element.get(0);t?(n.addClass(t,"bs-field-group"),n.removeClass(t,"no-x-padding")):t=n.find(i,this.id+"_header");var o=n.find(i,this.id+"_bottom");f.toolBarRender($(t),this.toolBar,$(o))}},v.prototype._createToolbar=function(){f.toolBarFactory&&(this.toolBar=f.toolBarFactory(this))},v.prototype._state=function(){m.prototype._state.call(this);var e=this,t=e.fieldOptions;if(e.state.value){if(e.state.value.allowSelecting=e.renderOptions.selecting&&(e.renderOptions.selecting.row||e.renderOptions.selecting.cell),e.state.value.multiselect=e.renderOptions.selecting&&e.renderOptions.selecting.multiselect,e.state.value.expandingProperty=e.renderOptions.expandingProperty,e.state.value.isQueryable()){var n=$.extend({size:"default",selectPage:e._onselectPage.bind(e),noPagesCount:e.state.value.noPagesCount()},t.pager||{});e._pager=new i.Pager(n);var o=e._pager;o.props.hasNext=e.state.value.hasNext(),o.props.hasPrev=e.state.value.hasPrev(),o.props.totalPages=e.state.value.totalPages(),o.props.currentPage=e.state.value.currentPage()}e._createToolbar()}},v.prototype._destroyDetails=function(){if(this._details){var e=i.formManager();this._details.forEach(function(t){var n=e.formByName(t);n&&n.destroy()}),this._details=[]}},v.prototype._destroyDetailById=function(e){var t=this._details.indexOf(e);t>=0&&this._details.splice(t,1);var n=i.formManager().formByName(e);n&&n.destroy()},v.prototype._initCols=function(e){var t=this;t._mapCols={},e.columns&&e.columns.length||(e.columns=[{$bind:"$index"}]),t.columns=[],t.frozenColumns=[];var n=e.columns.findIndex(function(e){return h.isSelectField(e.$bind)}),i=null;e.selecting&&e.selecting.row&&e.selecting.multiselect?n<0?(i={$bind:s.SELECTED_FIELD_NAME,options:{width:50,frozen:!0}},e.columns.splice(0,0,i)):i=e.columns[n]:n>=0&&e.columns.splice(n,1);var r=!!e.expandingProperty,l=e.scrolling&&e.scrolling.vertical||e.editing,u=t.state.value&&t.state.value.columns?t.state.value.columns:null;e.columns.forEach(function(n,s){var d=$.extend({},n);if(d.options=d.options||{},i!==n&&u&&u.indexOf(n.$bind)<0&&(d._isHidden=!0),r&&h.isExpandField(n.$bind)&&(n,d.schema=h.getSchema(n.$bind,t.$schemaItems,t.form.$rootSchema,!1),d.$bind=e.expandingProperty+n.$bind,d.options.icons={1:e.expanding&&e.expanding.plus?e.expanding.plus:"plus",2:e.expanding&&e.expanding.minus?e.expanding.minus:"minus"},d.options.align=d.options.align||"left",d.options.alignIcon=d.options.alignIcon||"left",d.options._clickable=!0,d.options._expandItem=!0,e.expanding&&(e.expanding.style&&(d.options._expandItemClass=e.expanding.style),e.expanding.iconClass&&(d.options.iconClass=e.expanding.iconClass))),d.schema||(d.schema=h.getSchema(n.$bind,t.$schemaItems,t.form.$rootSchema,!1)),d.schema||d.schema)if(d.options.$lookup&&(d.$lookup=t.form.getLookupForSchema(t.$bind+"."+d.$bind,d.options.$lookup)),t._mapCols[d.$bind])console.log("Duplicate column name  : "+n.$bind);else{if(d.title=o.tt(d.options.title||d.schema.title,t.form.$locale),d.options.display&&(d.options.displaySchema=h.getSchema(d.options.display,t.$schemaItems,t.form.$rootSchema,!1),!d.title&&d.options.displaySchema&&(d.title=o.tt(d.options.displaySchema.title,t.form.$locale))),h.isLink(n.$bind)&&(d.isLink=!0,d._isHidden=!1),l&&!d.options.width&&(d.options.width=a.widthFromSchema(d.schema)),d.options.frozen&&e.allowFrozenColumns)return d.options.width?function(e){e=(e=(e||"")+"").trim();var t=parseInt(e,10);return t+""===e||t+"px"===e||t+" px"===e}(d.options.width)||(d.options.width=50):d.options.width=a.widthFromSchema(d.schema),void(d._isHidden||(t.frozenColumns.push(d),t._mapCols[d.$bind]={column:d,index:t.frozenColumns.length-1,tindex:s}));d._isHidden||(t.columns.push(d),t._mapCols[d.$bind]={column:d,index:t.columns.length-1,tindex:s})}else console.log("Field (bind) not found : "+n.$bind)})},v.prototype._colByField=function(e){var t=this._mapCols[e];return t?t.column:null},v.prototype._totalChanged=function(e,t,n,i,o){if(this.$element){if(this._ignoreNotifications)return!1;switch(i){case"propchange":if(e===this._totalProperty)this._renderTotalRows();else{var r=null,s="";if(this._totalIsArray){var a=h.parsePath(this._totalProperty,e,"");r=o[a],s=e.substr(a.length+1)}else r=o.instance,s=e.split(".").pop();r&&this._modifyFooterCell(r,s)}}}},v.prototype.changed=function(e,t,i,o,r){var s=this;if(s.$element){if(s._ignoreNotifications)return!1;if(!(e.substr(s.$bind.length).indexOf(".$selected")>=0)){var l=s.renderOptions.hideWhenNoRows,u=s.selectedCell,d=null;r.checkChildren&&"propchange"===o&&e===s.$bind&&(l=!0,!0,s.state.value=s.form.getValue(s.$bind),s.state.value.allowSelecting=s.renderOptions.selecting&&(s.renderOptions.selecting.row||s.renderOptions.selecting.cell),s.state.value.multiselect=s.renderOptions.selecting&&s.renderOptions.selecting.multiselect,s.state.value.expandingProperty=s.renderOptions.expandingProperty);var c=!1,p=!1,f=!1;if(s._totalProperty){if(0===e.indexOf(s._totalProperty))return void s._totalChanged(e,t,i,o,r);r.checkChildren&&"propchange"===o&&e===s._totalProperty&&s._totalChanged(s._totalProperty,t,i,o,r)}switch(s.state.value||(o="none"),o){case"count":var m=s.toolBar;m&&m.setValue&&m.setValue("count",s.state.value.totalCount());break;case"filter":var v=s.toolBar;v&&v.setValue&&v.setValue("filter",s.state.value.filter.title||"");break;case"pagination":var g=s._pager;g&&(g.props.totalPages=s.state.value.totalPages(),g.props.currentPage=s.state.value.currentPage(),g.props.hasNext=s.state.value.hasNext(),g.props.hasPrev=s.state.value.hasPrev());break;case"sorting":s._updateSorting();break;case"propchange":if(e===s.$bind)r.sorting?(s._renderRows(!0,"",null,!1),u&&s._selectCell(u,null,!1,!1)):(s._renderRows(!0,"",null,!1),f=!0),p=!0,l=!0;else{var y=e,_=h.parsePath(s.$bind,y,s.renderOptions.expandingProperty),$=r[_];if($){var b=e.substr(_.length+1);if(!b)return;s._modifyCell($,b,null,null),h.isSelectField(b)&&(s.renderOptions.noRowSelectedIndicator||a.setRowsSelected($.$id,$.$select,s.fieldOptions,s.$element.get(0)),$.$select&&s.renderOptions.selecting&&s.renderOptions.selecting.cell&&(s.selectedCell&&s.selectedCell.row===$.$id||(s._selectFirstCellEditable("model",$.$id,null),f=!1)),s._updateMultiselectSummary(!1))}}break;case"add":s._createRow(r.$value),r.$value.$select&&(d=r.$value.$id,f=!0),p=!0,c=!0,l=!0;break;case"remove":var x=s.renderOptions;if(x.expandingProperty){if(s._removeRow(r.$id),r.$value){var C=r.$value[x.expandingProperty];C&&C._enumChildren(x.expandingProperty,function(e){s._removeRow(e.$id)})}c=!0}else s._removeRow(r.$id),c=!0;l=!0}if(l)s._isHidden()!==n.hasClass(s.$element.get(0),"bs-none")&&(s.setHidden(s.$element.get(0)),p=!0);if(c&&s._updOddEvenLater(),p&&s.resize(),f){var k=null;!d&&u&&(d=u.row,k=u.col),d&&!s._findById(d)&&(d=null,k=null),s._selectFirstCellEditable("model",d,k)}}}},v.prototype._modifyStateTD=function(e,t,i,o){var r=this.renderOptions,s=this._colByField(t);if(s){var a=e.getState(t),l=s.options||{},u=(r.editing||h.isSelectField(t))&&!a.isDisabled&&!a.isReadOnly&&!a.isHidden&&!1!==l.editing&&!1!==l.selecting;a.isHidden&&n.empty(o),r.editing&&(u?n.removeClass(o,"bs-td-readonly"):n.addClass(o,"bs-td-readonly"))}},v.prototype._modifyTD=function(e,t,i){var o=this.renderOptions,s=this._colByField(t);if(s){var a=e.getState(t),l=s.options||{},u=(o.editing||h.isSelectField(t))&&!a.isDisabled&&!a.isReadOnly&&!a.isHidden;if(n.empty(i),!a.isHidden){var d=null,c=this._viewMap[e.$id],p=c&&c.level||0;l.display&&l.displaySchema&&(d=r.utils.displayValue(e.getValue(l.display),l.displaySchema,this.form.$locale,{html:!0,tableOptions:o,avanced:l.displayOptions||{},state:e.getState(l.display)},e,l.display));var f=r.utils.displayValue(e.getValue(t),s.schema,this.form.$locale,{html:!0,useSymbol:!1,editable:u,selectable:!a.isDisabled,check:o.editing,avanced:l,tableOptions:o,display:d,level:p,state:a},e,t);if(f.html){var m=$(f.value);n.append(i,m.get(0))}else{var v=f.value;""===v&&(v=String.fromCharCode(160)),n.append(i,document.createTextNode(v))}}}},v.prototype._findTR=function(e,t){var i=this.renderOptions,o=e+(t.options.frozen&&i.allowFrozenColumns?"_frozen":"");return n.find(this.$element.get(0),o)},v.prototype._id2rowId=function(e){var t=e.indexOf("_frozen");return t>0&&(e=e.substring(0,t)),e},v.prototype._findtBody=function(e){var t=this.renderOptions,i=this.id+(e.options.frozen&&t.allowFrozenColumns?"_frozen_rows":"_rows");return n.find(this.$element.get(0),i)},v.prototype._modifyFooterCell=function(e,t){if(this.$element){var n=this._colByField(t);if(n){var i=this._findTR(e.$id,n);i&&this._findCellAndModify(e,i,t,null)}}},v.prototype._findCellAndModify=function(e,t,i,o){for(var r=this,s=n.queryAll(t,'td[colid="'+i+'"]'),a=0,l=s.length;a<l;a++){var u=s.item(a);if(o){!0===e.$states[i][o]&&["isDisabled","isHidden","isReadOnly"].indexOf(o)>=0&&r.inplace&&r.inplace.input&&r.inplace.td===u&&r._inplaceEditRemove(!1,!1,!0),r._modifyStateTD(e,i,o,u)}else{if(r.inplace&&r.inplace.input&&r.inplace.td===u)return void r._inplaceEditModel2Control(e,i,u);r._modifyTD(e,i,u)}}},v.prototype._modifyCell=function(e,t,n,i){if(this.$element){var o=this._colByField(t);if(o){if(i)return this.inplace&&this.inplace.input&&this.inplace.td===i?void this._inplaceEditModel2Control(e,t,i):this._modifyTD(e,t,i);var r=this._findTR(e.$id,o);r&&this._findCellAndModify(e,r,t,n)}}},v.prototype._rootElement=function(){return this.$element?this.$element.get(0):null},v.prototype._gridParentFocus=function(){return this.$element?n.find(this.$element.get(0),this.id+"_focus"):null},v.prototype._setErrors=function(t,i){var o=this.state.errors;if(i&&e.bootstrap4){var r="is-invalid";o&&o.length?n.addClass(i,r):n.removeClass(i,r)}this.showErrors(i,o)},v.prototype._setTableFocus=function(e){var t=n.find(this.$element.get(0),this.id+"_table");t&&(e?n.addClass(t,"focused"):n.removeClass(t,"focused")),(t=n.find(this.$element.get(0),this.id+"_table_frozen"))&&(e?n.addClass(t,"focused"):n.removeClass(t,"focused"))},v.prototype.focusIn=function(e){var t=this;if(t.$element)if(t._setTableFocus(!0),t.selectedCell){var n=t._cell(t.selectedCell,!0);if(n||(t.selectedCell=null,t._selectFirstCell("focusin",null,!1,null),t.selectedCell&&(n=t._cell(t.selectedCell,!0))),!n)return;t.canEdit(t.selectedCell)&&!t.inplace&&t._inpaceEditShow(n.td,!0)}else t._inplaceEditRemove(!1,!1,!1)},v.prototype.focusOut=function(e){this.$element&&(this._setTableFocus(!1),this._inplaceEditRemove(!0,!1,!1))},v.prototype._doTab=function(e){return e?this._moveRightSelectedCell(!0):this._moveLeftSelectedCell(!0)},v.prototype.keypress=function(e){var t=this,i=this._gridParentFocus();if(n.isChildOf(i,e.target)&&t.selectedCell&&t.inplace&&n.isChildOf(t.inplace.td,e.target)){var o=t._td2value(t.inplace.td);if(h.isNumber(t.inplace.schema)&&!t.inplace.schema.enum){if(!1===r.utils.keyPressNumber(e,t.inplace.input,{decimalSep:d.number.decimal,thousandSep:d.number.thousand,places:t.inplace.decimals,schema:t.inplace.schema}))return!1}else if(h.isDate(t.inplace.schema)&&!t.inplace.schema.enum){if(!1===r.utils.keyPressDate(e,t.inplace.input,{sep:d.date.daySep,format:d.date.dateShort,schema:t.inplace.schema}))return!1}else if(h.isBoolean(t.inplace.schema)){if(" "===String.fromCharCode(e.which)&&t.fieldOptions.editing){var s=o.item.getRelativeState(o.col.$bind);if(!s.isDisabled&&!s.isReadOnly){var a=o.item.getValue(o.col.$bind);o.item.setValue(o.col.$bind,!a)}}e.preventDefault()}}},v.prototype.keydown=function(e){var t=this,i=e.which||e.keyCode,o=this._gridParentFocus();if(n.isChildOf(o,e.target)){var s=!1;if(t.inplace&&n.isChildOf(t.inplace.td,e.target)){if(!t._inplaceEditAcceptKeys(i))return;if(t.inplace.combo&&(i===n.keys.VK_F4||i===n.keys.VK_DOWN&&e.ctrlKey))t._toggleGridLookup();else if(h.isNumber(t.inplace.schema)&&!t.inplace.schema.enum){if(!1===r.utils.keyDownNumber(e,t.inplace.input,{decimalSep:d.number.decimal,thousandSep:d.number.thousand,places:t.inplace.decimals,schema:t.inplace.schema}))return}else if(h.isDate(t.inplace.schema)&&!t.inplace.schema.enum&&!1===r.utils.keyDownDate(e,t.inplace.input,{sep:d.date.daySep,format:d.date.dateShort,schema:t.inplace.schema}))return}if(a=e,i===n.keys.VK_TAB&&a.shiftKey||!(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)){var a;if(t.fieldOptions.selecting&&t.fieldOptions.selecting.cell)switch(i){case n.keys.VK_TAB:case n.keys.VK_ENTER:s=t._doTab(!e.shiftKey);break;case n.keys.VK_UP:s=t._moveUpSelectedCell(1);break;case n.keys.VK_DOWN:s=t._moveDownSelectedCell(1)}s&&e.preventDefault()&&e.stopPropagation()}}},v.prototype._toggleGridLookup=function(){this.inplace&&this.inplace.combo&&(this.inplace.combo.opened?f.gridlookup.closeGridLookup(this.inplace,this._eventBus,"combo"):this._openGridLookup())},v.prototype._createGridPopup=function(){this._eventBus||(this._eventBus=new e.serial.SingleEventBus(50));var t=this.inplace.input,n=this.$element.get(0);this.inplace.combo=f.gridlookup.checkGridPopup(this,this.inplace.col.$lookup,t,n)},v.prototype._searchText=function(){if(this.inplace&&this.inplace.combo){var e=this.inplace.col,t=this._td2cell(this.inplace.td);if(t){var n=this._findById(t.row);if(n){var i=n.getValue(e.$bind,null)||"",o=this.inplace.input.value||"";if(o!==i)return o}}}return""},v.prototype._getSource=function(e,t){return t.fieldName=e.col.$lookup.mapping[e.col.$bind],t.paginated=!0,t.containerId=this.form.syncTransactionId(),t.viewId=this.form.syncViewId(),t.selected=e.item.pkId(),h.executeLookup(e.col.$lookup,e.item,t)},v.prototype._findValue=function(e,t,n){var i=this;if(e||""!==e){var o={search:e,select:!1,findFirst:!0,find:!1,paginated:i.renderOptions.paginated};i._eventBus.push(i._getSource(t,o),function(e){(e=i._filterResult(e,o,t.col.$lookup,t.col.$bindp,t.col.$display))&&e.value&&e.value.length?n(e.value[0]):n(null)},!0)}else i._eventBus.push(null,function(e){return n(null)},!0)},v.prototype._filterResult=function(e,t,n,i,o){if(n=f.gridlookup.checkGridLookup(n,this.form.$model),e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(n.data&&n.data.$params&&n.data.$params.$allData){var r=h.findFirst(t.search,h.remoteSearch(h.lastSegment(i,i),n),e.documents);return r?{value:[r.item]}:null}e.value=e.documents,delete e.documents}return e},v.prototype._setRemoteValue=function(e,t,n){var i=Object.keys(e.$lookup.mapping),o=h.extractBase(e.$bind),r=[],s=!1;i.forEach(function(i){if(e.$lookup.mapping[i]){var a=t.getValue(o+i,null)||"",l=n&&n[e.$lookup.mapping[i]]||"";""===l&&("number"==typeof a?l=0:"boolean"==typeof a&&(l=!1)),l!==a&&(t.setValue(o+i,l,null),s=!0)}else r.push(i)}),s&&r.forEach(function(n){t.setValue(o+n,e.$lookup.mapping[n])})},v.prototype._onselectItem=function(e){var t=this;if(t.inplace&&t.inplace.combo){var n=t.inplace.col,i=t._td2cell(t.inplace.td);if(i){var o=t._findById(i.row);o&&t._eventBus.push(e,function(e){t._setRemoteValue(n,o,e)},!0)}}},v.prototype._openGridLookup=function(){var e=this;if(!e.inplace.combo.opened){var t=e._td2cell(e.inplace.td),n=void 0;if(t){var i=e._findById(t.row);i&&(n=i.pkId())}var o=f.gridlookup.checkGridLookup(e.inplace.col.$lookup,e.form.$model);f.gridlookup.openGridLookup(e.inplace,{lookup:o,parentControl:e,formControl:e.form,display:e.inplace.col.$bind,bind:e.inplace.col.$bind,containerId:e.form.syncTransactionId(),viewId:e.form.syncViewId(),selected:n,align:e.inplace.id,openerId:e.inplace.id+"_after",searchText:e._searchText(),onselect:e._onselectItemHandler,lookupColumns:e.inplace.col.options.lookupColumns?e.inplace.col.options.lookupColumns:void 0,propertyName:"combo",minWidth:e.inplace.col.options.lookupMinWidth||0})}},v.prototype.checkFocus=function(e){var n=this;t.nextTick(function(){var e=window.document.activeElement;e&&n.targetInControl(e)||(n.focusOut(null),n.focused=!1)})},v.prototype.focusInControl=function(e){var t=this._gridParentFocus(),i=n.isChildOf(t,e);if(!i&&this.inplace){if(this.inplace.combo&&this.inplace.combo.opened)return this.inplace.combo.focusInCombo(e);if(this.inplace&&h.isDate(this.inplace.schema)&&r.utils.useDatePicker()){var o=n.query(document.body,".datepicker");if(o&&(n.isChildOf(o,e)||e===document.body))return!0}}return i},v.prototype._tr2rowId=function(e,t){var n=e.id;if(t&&t.options.frozen){var i=n.indexOf("_frozen");i>0&&(n=n.substring(0,i))}return n},v.prototype._td2cell=function(e){var t=e.parentNode,i=(t.parentNode,this._colByField(n.attr(e,"colid")));if(!i)return null;var o=this._tr2rowId(t,i);return this._findById(o)&&i?{row:o,col:n.attr(e,"colid")}:null},v.prototype._td2value=function(e){var t=e.parentNode,i=(t.parentNode,this._colByField(n.attr(e,"colid"))),o=this._tr2rowId(t,i);return{item:this._findById(o),col:i}},v.prototype.mousedown=function(e){var t=this._gridParentFocus();if(!n.isChildOf(t,e.target))return!0;var i=n.parentByTag(this.$element.get(0),e.target,"td");if(i){var o=this.renderOptions,r=this._td2cell(i);r&&(this._selectCell(r,e,!0,!1)?e.preventDefault():o.selecting&&!o.selecting.multiselect&&this._selectRow(r.row))}return!0},v.prototype._addRows=function(e,t){this._renderRows(!1,e.$id,t,!1),this._updOddEvenLater()},v.prototype._removeRows=function(e,t){var n=this;t.forEach(function(e){n._removeRow(e.value.$id)}),n._updOddEvenLater()},v.prototype.dblclick=function(e){var t=this.renderOptions;if(t.doubleClick){var i=n.parentByTag(this.$element.get(0),e.target,"td");if(i){var o=this._td2cell(i);if(o){var r=this._findById(o.row);this.form.execAction(this.$bind+".$links."+t.doubleClick,r)}}}},v.prototype.click=function(e){var t=this;if(t.state.value){var i=t.renderOptions,o=n.parentByTag(t.$element.get(0),e.target,"td");if(o){var r=t._td2cell(o);if(r){var s=t._findById(r.row),a=t._colByField(r.col);if(s){var l=e&&e.target&&e.target.$link||e.target.parentNode.$link;if(l){var d=s.getRelativeState(a.$bind);if(d.isDisabled||d.isHidden)return;a.schema.$widgetAction?t[a.schema.$widgetAction]&&t[a.schema.$widgetAction](s):t.form.execAction(t.$bind+".$item."+l,s)}else if(a){if(t.inplace&&t.inplace.input&&t.inplace.td===o)return void(t.inplace.combo&&(e.target.id!==t.inplace.id+"_after"&&e.target.parentNode.id!==t.inplace.id+"_after"||t._toggleGridLookup()));if(a.options._expandItem){if(n.attr(e.target,"data-clickable")||n.attr(e.target.parentNode,"data-clickable"))if(!(v=s.getRelativeState(a.$bind)).isDisabled&&!v.isReadOnly){var c=s.toggleExpand(i.expandingProperty);t._ignoreNotifications=!0;try{var p=[],f=t._viewMap[s.$id];if(s.enumVisibleChildren(i.expandingProperty,f.level,!0,function(e,t){var n={level:t,value:e};p.push(n)}),!p.length)return;c?t._addRows(s,p):t._removeRows(s,p)}finally{t._ignoreNotifications=!1}}}else if(a.options.$link){if(n.findByAttribute(e.target,o,"data-phoenix-href"))(v=s.getRelativeState(a.$bind)).isDisabled||(a.options.$link.action?t.form.execAction(t.$bind+".$links."+a.options.$link.action,s):u.execLink(a.options.$link,{$item:s},null))}else if(a.options.actionName){(v=s.getRelativeState("$links."+a.options.actionName))&&!v.isDisabled&&t.form.execAction(t.$bind+".$item.$links."+a.options.actionName,s)}else if(h.isSelectField(a.$bind)||i.editing&&h.isBoolean(a.schema)){if(n.attr(e.target,"data-clickable"))if(!(v=s.getRelativeState(a.$bind)).isDisabled&&!v.isReadOnly&&!v.isHidden){var m=s.getValue(a.$bind);if(h.isSelectField(a.$bind)){(E=t.state.value).selecting(!0,i.expandingProperty);try{s.select(!m,i.selecting&&i.selecting.row&&i.selecting.multiselect,t.state.value,i.expandingProperty,i.expanding&&i.expanding.selectChildren)}finally{E.selecting(!1,i.expandingProperty)}}else s.setValue(a.$bind,!m)}}else if(i.selecting&&i.selecting.row&&!i.selecting.multiselect&&i.selecting.action){var v;(v=s.getRelativeState("$links."+i.selecting.action))&&!v.isDisabled&&t.form.execAction(t.$bind+".$item.$links."+i.selecting.action,s)}}}}}else{var g=n.parentByTag(t.$element.get(0),e.target,"th");if(g){var y=n.attr(g,"colid");if(y){var _=t._colByField(y),$=_.options.display?_.options.displaySchema:_.schema;if(!$||!_)return;if(h.isSelectField(_.$bind)&&i.selecting&&i.selecting.row&&i.selecting.multiselect&&i.selecting.selectAll){var b=n.parentByTag(t.$element.get(0),e.target,"center");if(b){var x=n.query(b,".bs-bool-edit");if(x){var C=n.iconClass("check-square-o",!0),k=n.iconClass("square-o",!0),w=n.hasClass(x,C);w?(n.removeClass(x,C),n.addClass(x,k)):(n.removeClass(x,k),n.addClass(x,C));var E=t.state.value;if(w){E.selecting(!0,i.expandingProperty);try{t._getMultiselectdItems().forEach(function(e){e.select(!1,i.selecting&&i.selecting.row&&i.selecting.multiselect,t.state.value,i.expandingProperty,!1)})}finally{E.selecting(!1,i.expandingProperty)}}else{E.selecting(!0,i.expandingProperty);try{E.forEach(function(e,n,o){e.select(!0,i.selecting&&i.selecting.row&&i.selecting.multiselect,t.state.value,i.expandingProperty,!1)},i.expandingProperty,!0)}finally{E.selecting(!1,i.expandingProperty)}}}}}else if(i.sorting&&h.canSort($)){var O=$.orderBy?$.orderBy:_.options.display?_.options.display:_.$bind,S=O;if(t.state.value.$orderby()===O)S=O.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 1===t.length?t.push("desc"):t[1]="desc"===t[1]?"asc":"desc",t.join(" ")}).join(",");t.state.value.isQueryable()?t.state.value.$orderby(S):t.state.value&&t.form.execAction(t.state.value.getJSONPatchPath()+".$sort",S)}}}else if(e.target.id===t.id+"_close_ms")t._closeMultiselectSummary(!1,!0);else{var P=n.parentByAttr(t.$element.get(0),e.target,"data-ms-unselect");if(P){var I=n.attr(P,"data-ms-unselect");if(s=t._findById(I)){(E=t.state.value).selecting(!0,i.expandingProperty);try{s.select(!1,i.selecting&&i.selecting.row&&i.selecting.multiselect,t.state.value,i.expandingProperty,i.expanding&&i.expanding.selectChildren)}finally{E.selecting(!1,i.expandingProperty)}}}else if(t.toolBar){var D=t.toolBar.htmlRoots();for(f=0;f<D.length;f++){var M=D[f];if(n.isChildOf(M.element,e.target)){t.toolBar.execClick(e);break}}}}}}},v.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled},v.prototype._showSelected=function(e,t,i,o){if(!e)return null;var r=this._cell(e,!1);r&&r.td&&(t?(n.addClass(r.td,"bs-cell-selected"),this._inplaceEditRemove(!1,!1,!1),i&&(this.focused||o)?this._inpaceEditShow(r.td,!1):(r.td.tabIndex=0,(this.focused||o)&&r.td.focus()),this._onFrozenFocusScroll(r.td,this._colByField(e.col))):(n.removeClass(r.td,"bs-cell-selected"),r.td.tabIndex=-1))},v.prototype.canSelect=function(e,t){var n=this.selectedCell;if(n&&n.col===e.col&&n.row===e.row)return!1;if(!this.fieldOptions.selecting||!this.fieldOptions.selecting.cell)return!1;var i=this._colByField(e.col);if(i){if(!t)return!0;if(i.options&&!1===i.options.selecting)return!1;var o=this._findById(e.row);if(o){var r=o.getState(i.$bind);return!r.isDisabled&&!r.isHidden}}return!1},v.prototype.canEdit=function(e){if(!this.fieldOptions.editing||!this.fieldOptions.selecting||!this.fieldOptions.selecting.cell)return!1;var t=this._colByField(e.col);if(t.options&&!1===t.options.editing)return!1;if(t.isLink)return!1;if(t.options._expandItem)return!1;var n=this._findById(e.row).getState(t.$bind);return!n.isReadOnly&&!n.isDisabled&&!n.isHidden},v.prototype._selectRow=function(e){var t=this.renderOptions;if(this.state.value){var n=t.selecting&&t.selecting.row&&t.selecting.multiselect,i=this._findById(e);if(i){var o=this.state.value;o.selecting(!0,t.expandingProperty);try{i.select(!0,n,this.state.value,t.expandingProperty)}finally{o.selecting(!1,t.expandingProperty)}}}},v.prototype._selectCell=function(e,t,n,i){var o=this;if(!o.canSelect(e,i)){if(n){var r=o.selectedCell;return(!r||r.row!==e.row)&&o._selectFirstCell("mouseDown",e.row,i,null)}return!1}var s=o.selectedCell,a=o.canEdit(e);o.selectedCell=e,o._showSelected(e,!0,a,n),s?o._showSelected(s,!1,!0,n):o._gridParentFocus().tabIndex=-1;var l=o.renderOptions;return l.selecting&&!l.selecting.multiselect&&o._selectRow(e.row),!0},v.prototype._selectFirstCellEditable=function(e,t,n){this._selectFirstCell(e,t,!0,n)||this._selectFirstCell(e,t,!1,n)},v.prototype._selectFirstCell=function(e,t,i,o){var r=this,s=r.fieldOptions;if(!s.selecting||!s.selecting.cell)return!1;var a=n.find(r.$element.get(0),r.id+"_rows");if(!a.childNodes.length)return!1;var l=null,u=r.frozenColumns.concat(r.columns),d=0;o&&((d=u.indexOf(o))>=0?i&&(i=!1):d=0);for(var c=u.length;d<c;d++){var p=u[d],h=void 0;if(t)h=t;else{if(s.selecting&&s.selecting.row&&!s.selecting.multiselect){var f=r._getMultiselectdItems();f&&f.length&&(h=f[0].$id)}if(!h){s.allowFrozenColumns&&p.options.frozen&&(a=n.find(r.$element.get(0),r.id+"_frozen_rows"));var m=a.firstChild;h=r._tr2rowId(m,p)}}if(l={col:p.$bind,row:h},r.canSelect(l,i))break;l=null}return!!l&&r._selectCell(l,null,!1,i)},v.prototype._cell=function(e,t){var i=this._mapCols[e.col],o=i.index,r=this._findTR(e.row,i.column);if(!r)return null;var s={td:r.childNodes[o],tr:r,rIndex:-1,cIndex:-1};return t&&(s.rIndex=n.indexOf(r.parentNode,r),s.cIndex=o),s},v.prototype._moveUpSelectedCell=function(e){var t=this;if(!t.selectedCell)return t._selectFirstCell("keydown",null,!1,null);var n=t._colByField(t.selectedCell.col),i=t._cell(t.selectedCell,!0);if(!i)return t.selectedCell=null,t._selectFirstCell("keydown",null,!1,null);var o=Math.max(i.rIndex-e,0);if(o!=i.rIndex){var r=t._findtBody(n).childNodes[o];return t._selectCell({row:t._id2rowId(r.id),col:t.selectedCell.col},null,!1,!1)}return!1},v.prototype.resize=function(){var e=this;e.form.execLater({id:e.id+"_resize",hnd:function(){e._resize()}})},v.prototype._updateFrozenColumnsHeight=function(){var e=this.renderOptions;if(this._scrollableFrozenContent){if(!(e.height&&"auto"!==e.height||e.minHeight))return;var t=void 0;t=this._scrollableMaster.scrollWidth>this._scrollableMaster.clientWidth?n.scrollbar()+"px":"0px",this._deltaHScrollContent.style.height!==t&&(this._deltaHScrollContent.style.height=t,this._vscroll())}},v.prototype._resize=function(){var e=this,t=e.renderOptions;if(t.scrolling&&t.scrolling.vertical&&(e.$element||console.log("Invalid resize call"),e._scrollableMaster)){n.position(e._scrollableMaster,null);if(t.bottom){var i=n.documentViewSize();if(e._scrollableMaster){var o=n.position(e._scrollableMaster,null),r=(e.$element.get(0),Math.max(0,i.height-o.top-t.bottom));e._scrollableMaster.style.height=r+"px",e._scrollableFrozenContent&&(e._scrollableFrozenContent.style.height=r+"px")}}if(a.hasFrozenColumns(t,e.frozenColumns))n.scrollbar()&&e._updateFrozenColumnsHeight(),e._vscroll()}},v.prototype.syncHeaderAndFrozenScroll=function(e){this._scroller&&"master"!==this._scroller||(this._scroller="master",this._hscroll(),this._vscroll(),this._removeScroller())},v.prototype.syncMasterScroll=function(e){this._scroller&&"frozen"!==this._scroller||(this._scroller="frozen",this._vsmcroll(),this._removeScroller())},v.prototype._removeScroller=function(){var e=this;e.fieldOptions.editing?(e._rsTimer&&window.clearTimeout(e._rsTimer),e._rsTimer=window.setTimeout(function(){e._scroller=null,e._rsTimer=null},50)):e._scroller=null},v.prototype._vscroll=function(){if(this._scrollableFrozenContent){var e=this._scrollableMaster.scrollTop;e!==this._scrollableFrozenContent.scrollTop&&(this._scrollableFrozenContent.scrollTop=e)}},v.prototype._vsmcroll=function(){var e=this._scrollableMaster.scrollTop,t=this._scrollableFrozenContent.scrollTop;e!==t&&(this._scrollableMaster.scrollTop=t)},v.prototype._hscroll=function(){var e=this._scrollableMaster.scrollLeft;(e!==this._scrollableHeaderOfMaster.scrollLeft&&(this._scrollableHeaderOfMaster.scrollLeft=e),this._scrollableFooterOfMaster)&&(e!==this._scrollableFooterOfMaster.scrollLeft&&(this._scrollableFooterOfMaster.scrollLeft=e))},v.prototype._moveDownSelectedCell=function(e){var t=this;if(!t.selectedCell)return t._selectFirstCell("keydown",null,!1,null);var n=t._cell(t.selectedCell,!0);if(!n)return t.selectedCell=null,t._selectFirstCell("keydown",null,!1,null);var i=t._colByField(t.selectedCell.col),o=t._findtBody(i),r=Math.min(n.rIndex+e,o.childNodes.length-1);if(r!=n.rIndex){var s=o.childNodes[r];return t._selectCell({row:t._id2rowId(s.id),col:t.selectedCell.col},null,!1,!1)}return!1},v.prototype._moveRightSelectedCell=function(e){var t=this;if(!t.fieldOptions.selecting||!t.fieldOptions.selecting.cell)return!1;if(!t.selectedCell)return t._selectFirstCell("keydown",null,e,null);var n=t.frozenColumns.concat(t.columns).map(function(e){return e.$bind}),i=n.indexOf(t.selectedCell.col),o=t._findById(t.selectedCell.row);if(!o||i<0)return!1;for(var r=i+1,s=n.length;r<s;r++){var a={col:n[r],row:o.$id};if(t.canSelect(a,e))return t._selectCell(a,null,!1,e)}if(o=t._findNext(o.$id))for(r=0,s=i;r<=s;r++){a={col:n[r],row:o.$id};if(!e||t.canSelect(a,e))return t._selectCell(a,null,!1,e)}return!1},v.prototype._moveLeftSelectedCell=function(e){var t=this;if(!t.fieldOptions.selecting||!t.fieldOptions.selecting.cell)return!1;if(!t.selectedCell)return t._selectFirstCell("keydown",null,e,null);var n=t.frozenColumns.concat(t.columns).map(function(e){return e.$bind}),i=n.indexOf(t.selectedCell.col),o=t._findById(t.selectedCell.row);if(!o||i<0)return!1;for(var r=i-1;r>=0;r--){var s={col:n[r],row:o.$id};if(t.canSelect(s,e))return t._selectCell(s,null,!1,e)}if(o=t._findPrev(o.$id))for(r=n.length-1;r>=i;r--){s={col:n[r],row:o.$id};if(t.canSelect(s,e))return t._selectCell(s,null,!1,e)}return!1},v.prototype.getSubControls=function(){return this.toolBar&&this.toolBar.getSubControls?this.toolBar.getSubControls():null},v.prototype.addSubControls=function(e){this.toolBar.addSubControls(e)},v.prototype.getChildren=function(){return this.toolBar?this.toolBar.getChildren():null},v.prototype._state2UI=function(e){var t=this,i=t._rootElement(),o=t.$element?t.$element.get(0):null;if(i&&(t._setDisabled(i,o),t.setHidden(o),t._setErrors(i,o),e||t._selectFirstCell("model",null,!1,null),t._renderToolbar(),t._pager)){var r=$(n.find(o,t.id+"_pagination"));t._pager.render(r)}},v.prototype.afterAddedInDom=function(){this._selectFirstCell("model",null,!0,null)},v.prototype._isHidden=function(){return this.state.isHidden||!this.state.value||this.renderOptions.hideWhenNoRows&&!this.state.value.length},v.prototype.setHidden=function(e){if(e){this._isHidden()?n.addClass(e,"bs-none"):n.removeClass(e,"bs-none")}},v.prototype.stateChanged=function(e,t,n){var i=this;if(i.$element){if(i._ignoreNotifications)return!1;var o=t.origProperty.substr(i.$bind.length);if(!(o.indexOf(".$selected")>=0)&&0!==o.indexOf(".$links")){var r=i.form.getState(i.$bind),s=i._rootElement(),a=i.$element?i.$element.get(0):null;if("columns"===e&&i.state.value&&i._setVisiblesColumns(i.state.value.columns),e||!t.isState)e&&"isHidden"!==e||r.isHidden!==i.state.isHidden&&(i.state.isHidden=r.isHidden,s&&i.setHidden(a)),e&&"isDisabled"!==e||r.isDisabled!=i.state.isDisabled&&(i.state.isDisabled=r.isDisabled,s&&i._setDisabled(s,a)),e&&"errors"!==e||l.errorChanged(i.state.errors,r.errors)&&(i.state.errors=r.errors,i._setErrors(s,a)),e&&"orderBy"!==e||i._updateSorting();else{var u=h.parsePath(i.$bind,t.property,i.renderOptions.expandingProperty),d=n[u];if(d){var c=t.property.substr(u.length+1),p=t.origProperty.substr(t.property.length+1);i._modifyCell(d,c,p,null)}}}}},v.prototype.stopProppagation=function(e){var t=e.target,i=this.$element.get(0),o=this._gridParentFocus();if(n.isChildOf(o,e.target))for(;t;){if(t===i)return;t.href&&(e.preventDefault(),e.stopPropagation()),t=t.parentNode}},v.prototype._buildView=function(e,t,n,i,o){var r={level:n,value:e};i=i||this._view,o=o||this._viewMap,i.push(r),o[e.$id]=r},v.prototype._findById=function(e){if(!this.state.value)return null;if(this._useView){var t=this._viewMap[e];return t?t.value:null}return this.state.value.findById(e)},v.prototype._findByIdEx=function(e){if(!this.state.value)return null;var t={index:-1,level:0,value:null};if(this._useView){var n=this._viewMap[e];n&&(t.index=this._view.indexOf(n),t.level=n.level,t.value=n.value)}else t.value=this.state.value.findById(e),t.value&&(t.index=this.state.value.indexOf(t.value));return t},v.prototype._findNext=function(e){var t,n=this;if(!n.state.value)return null;if(n._useView){if(t=n._viewMap[e]){var i=n._view.indexOf(t);if(n._view.length>i+1)return n._view[i+1].value}}else if(t=n.state.value.findById(e)){i=n.state.value.indexOf(t);if(n.state.value.length>i+1)return n.state.value.get(i+1)}return null},v.prototype._findPrev=function(e){var t,n;if(!this.state.value)return null;if(this._useView){if((t=this._viewMap[e])&&(n=this._view.indexOf(t))>0)return this._view[n-1].value}else if((t=this.state.value.findById(e))&&(n=this.state.value.indexOf(t))>0)return this.state.value.get(n-1);return null},v.prototype._renderTotalRows=function(){var e=this;if(e.$element){var t=e.renderOptions;if(e._totalProperty){var i=e.form.getValue(e._totalProperty);e._totalIsArray||(i=[i||{}]);var o=!!e._totalField||!!e._stopField,r=void 0,s=void 0;a.hasFrozenColumns(e.renderOptions,e.frozenColumns)&&(o=!1,(r=n.find(e.$element.get(0),e.id+"_frozen_totals"))&&(s=a.createRows(e.id,i,e.frozenColumns,t,e.options.design,e.form.$locale,!0,!0,null,null,null),n.empty(r),n.append(r,s))),r=n.find(e.$element.get(0),e.id+"_totals"),s=a.createRows(e.id,i,e.columns,t,e.options.design,e.form.$locale,!1,!0,null,o?e._totalField:null,o?e._stopField:null),n.empty(r),n.append(r,s)}}},v.prototype._renderRows=function(e,t,i,o){var r=this;if(r.$element){var s=r.renderOptions,l=null;e&&(r._view=[],r._viewMap={},r._useView=!0,l=r._buildView.bind(r));var u=void 0,d=void 0;if(r._inplaceEditRemove(!1,!1,!0),r._destroyDetails(),a.hasFrozenColumns(r.renderOptions,r.frozenColumns)&&(u=n.find(r.$element.get(0),r.id+"_frozen_rows")))if(e)d=r.state.value?a.createRows(r.id,r.state.value,r.frozenColumns,s,r.options.design,r.form.$locale,!0,!1,l,null,null):null,l=null,n.empty(u),d&&n.append(u,d);else{d=a.createBulkRows(r.id,i,r.frozenColumns,s,r.options.design,r.form.$locale,!0,!1,l);var c=n.find(u,t+"_frozen");n.after(c,d)}if(u=n.find(r.$element.get(0),r.id+"_rows"),e)d=r.state.value?a.createRows(r.id,r.state.value,r.columns,s,r.options.design,r.form.$locale,!1,!1,l,null,null):null,n.empty(u),d&&n.append(u,d);else{d=a.createBulkRows(r.id,i,r.columns,s,r.options.design,r.form.$locale,!1,!1,l);c=n.find(u,t);n.after(c,d)}}if(!e){var p=r._viewMap[t],h=r._view.indexOf(p);r._view.splice(h,0,i),i.forEach(function(e){r._viewMap[e.value.$id]=e})}r._updateMultiselectSummary(o)},v.prototype.editDetail=function(e){var t=this,o=e.$id;if(t.$element){var r=t.renderOptions;if(a.hasFrozenColumns(r,t.frozenColumns))return;var s=n.find(t.$element.get(0),t.id+"_rows"),l=n.find(s,o+"_detail");if(l)return;var u=n.find(s,o);if(u){l=a.createDetail(o,u);var c=t.renderOptions.rows;if(!c||!c.detail||!c.detail.layout)throw new Error('Grid options missing: "options.rows.detail.layout".');var p=c.detail.layout;"string"==typeof p&&t.renderOptions.layouts&&t.renderOptions.layouts[p]&&(p=t.renderOptions.layouts[p]),"object"==typeof p&&((p=$.extend(!0,{},p)).name&&(p._name=p.name),p.name=o);var h=e.getSchema();"object"==typeof h&&(h.links=h.links||{},h.links.$updateChanges=h.links.$updateChanges||{title:d.ui.ApplyDetailChanges});var f={};c.detail.spacing&&(f.verticalSpacing=!0),f.closeButtonHandler=function(){t.closeDetail(o)},p._name&&(f.externalLayout=p._name,f.externalSchema=t.form.options.externalSchema,f.externalLocale=t.form.options.externalLocale),f.path=t.$bind,t._details.push(o),i.OpenForm($(l.firstChild),p,t.form.$schema,e.schemaModel(!0),t.form.$locale,function(n,i,r){if("init"===n.operation)t.form.execAction("$links.$beforeEdit",i,i);else switch(n.property){case"$links.$updateChanges":if(!t.state.value.updateItem(e,i))return;e.update(i.schemaModel(!1)),t.form.execAction("$links.$afterUpdateChanges",e,e),t.closeDetail(o)}},f),n.after(u,l)}}},v.prototype.closeDetail=function(e){if(this._destroyDetailById(e),this.$element){var t=n.find(this.$element.get(0),e+"_detail");t&&n.remove(t)}},v.prototype._removeRow=function(e){var t=this;if(t._destroyDetailById(e),t._viewMap){var i=t._viewMap[e];if(i){delete t._viewMap[e];var o=t._view.indexOf(i);o>=0&&t._view.splice(o,1)}}if(t.$element){var r=[],s=n.find(t.$element.get(0),e);s&&r.push({element:s,columns:t.columns}),a.hasFrozenColumns(t.renderOptions,t.frozenColumns)&&(s=n.find(t.$element.get(0),e+"_frozen"))&&r.push({element:s,columns:t.frozenColumns}),r.forEach(function(i){var o=i.element.parentNode,r=n.find(o,e+"_detail");if(r&&n.remove(r),o.firstChild===i.element&&t.renderOptions.headerIsHidden&&!t.renderOptions._useColGrp&&o.childNodes.length>1){var s=o.childNodes[1];i.columns.forEach(function(e,t){var n=s.childNodes[t];e.options.width&&(n.style.width=a.ensureWidth(e.options.width)),e.options.minWidth&&(n.style.minWidth=a.ensureWidth(e.options.minWidth))})}n.remove(i.element)})}},v.prototype._updOddEven=function(){if(!this.renderOptions._useStripedCss&&this.renderOptions.striped&&this.$element){var e=n.find(this.$element.get(0),this.id+"_rows");a.updateEvenOdd(e),(e=n.find(this.$element.get(0),this.id+"_frozen_rows"))&&a.updateEvenOdd(e)}},v.prototype._updOddEvenLater=function(){var e=this;e.form.execLater({id:e.id+"_odd_even",hnd:function(){e._updOddEven()}})},v.prototype._createRow=function(e){var t=this;if(t.$element){var i=0,o=t._viewMap[e.$id];o?o=t._viewMap[e.$id]:(o={level:0,value:e},t._view.push(o),t._view.push(e.$id),i=t._view.length-1,t._viewMap[e.$id]=o);var r=void 0,s=void 0;a.hasFrozenColumns(t.renderOptions,t.frozenColumns)&&(r=n.find(t.$element.get(0),t.id+"_frozen_rows"),s=a.createRow(t.id,i,o.level,o.value,t.frozenColumns,t.renderOptions,t.options.design,t.form.$locale,r.childNodes.length%2==1,!0,!1),n.append(r,s)),r=n.find(t.$element.get(0),t.id+"_rows"),s=a.createRow(t.id,i,o.level,o.value,t.columns,t.renderOptions,t.options.design,t.form.$locale,r.childNodes.length%2==1,!1,!1),n.append(r,s)}},v.prototype.filtrableColumns=function(){var e=this.$schema,t=this.$schemaItems;return e&&"array"===e.type&&t&&"object"===t.type?h.filtrableFields(t,this.form.$rootSchema,this.form.$locale):[]},v.prototype._getColumnsFromSchema=function(){var e=this.$schema,t=this.$schemaItems;return e&&"array"===e.type&&t&&"object"===t.type?h.columns(t,this.form.$rootSchema,this.form.$locale):[]},v.prototype._getSelectedColumns=function(){var e=this,t={};return Object.keys(e._mapCols).forEach(function(n){var i=e._mapCols[n].column;i.options._expandItem&&i.options.display&&(n=i.options.display),t[n]=!0}),t},v.prototype._getGroupsFromSchema=function(){var e=this.$schema,t=this.$schemaItems;return e&&"array"===e.type&&t&&"object"===t.type&&t.groups?t.groups:{}},v.prototype.getColumnsForSettings=function(){return{schemaGroups:this._getGroupsFromSchema(),schemaColumns:this._getColumnsFromSchema(),selectedColumns:this._getSelectedColumns(),locale:this.form.$locale}},v.prototype.getColumnsForFilter=function(e){var t={schemaGroups:this._getGroupsFromSchema(),schemaColumns:this.filtrableColumns(),locale:this.form.$locale,mongoFilter:e,filters:void 0};return e&&f.glbMongoFilter2Filter&&(t.filters=f.glbMongoFilter2Filter(this.state.value.filter,this.filtrableColumns())),t},v.prototype.getColumnsForFilterExpress=function(e){var t;if(e&&Array.isArray(e)){var n=this._getColumnsFromSchema();t=[],e.forEach(function(e){n.every(function(n){return e!==n.name||(t.push(n),!1)})})}else t=this._getColumnsFromSchema();var i=[];return t.forEach(function(e){var t=e.schema,n={code:e.name,lib:t.title||t.name,type:t.type,selected:!0};t.enum&&(n.enum=t.enum),t.enumNames&&(n.enumNames=t.enumNames),i.push(n)}),i},v.prototype._updateSorting=function(){var e=this,t=e.renderOptions;if(e.$element&&t&&t.sorting&&!t.headerIsHidden){if(!e.state.value)return;var i=n.find(e.$element.get(0),e.id+"_cols");i&&a.updSorting(t,i,e._colByField.bind(e),e.state.value.$orderby()),(i=n.find(e.$element.get(0),e.id+"_frozen_cols"))&&a.updSorting(t,i,e._colByField.bind(e),e.state.value.$orderby())}},v.prototype._renderColumns=function(e){var t=this;if(t._inplaceEditRemove(!1,!1,!0),e._useColGrp){var i=e.scrolling&&e.scrolling.vertical,o=i&&!e.headerIsHidden?n.find(t.$element.get(0),t.id+"_colgrp_header"):null;if(o&&(n.empty(o),n.append(o,a.createColGroup(t.columns,e,!1))),o=n.find(t.$element.get(0),t.id+"_colgrp"),n.empty(o),n.append(o,a.createColGroup(t.columns,e,!1)),e.total&&e.total.property&&(o=n.find(t.$element.get(0),t.id+"_colgrp_footer"))&&(n.empty(o),n.append(o,a.createColGroup(t.columns,e,!0))),a.hasFrozenColumns(e,t.frozenColumns)){var r=i&&!e.headerIsHidden?n.find(t.$element.get(0),t.id+"_colgrp_frozen_header"):null;r&&(n.empty(r),n.append(r,a.createColGroup(t.frozenColumns,e,!0))),(r=n.find(t.$element.get(0),t.id+"_colgrp_frozen"))&&(n.empty(r),n.append(r,a.createColGroup(t.frozenColumns,e,!0))),e.total&&e.total.property&&(r=n.find(t.$element.get(0),t.id+"_colgrp_frozen_footer"))&&(n.empty(r),n.append(r,a.createColGroup(t.frozenColumns,e,!0)))}}if(!e.headerIsHidden){var s=n.find(t.$element.get(0),t.id+"_cols");n.empty(s),n.append(s,a.createCols(t.id,t.columns,e,t.options.design,t.form.$locale,t.state.value?t.state.value.$orderby():null,!1)),a.hasFrozenColumns(e,t.frozenColumns)&&(s=n.find(t.$element.get(0),t.id+"_frozen_cols"))&&(n.empty(s),n.append(s,a.createCols(t.id,t.frozenColumns,e,t.options.design,t.form.$locale,t.state.value?t.state.value.$orderby():null,!0)))}e.allowFrozenColumns&&a.updateFrozenWidth(t.$element.get(0),t.id,t.frozenColumns)},v.prototype.toggleMultiselect=function(){var e=this;if(e.$element){var t=e.renderOptions;if(t.selecting&&t.selecting.row){if(t.selecting.multiselect=!t.selecting.multiselect,e.state.value){var n=e.state.value;n.selecting(!0,t.expandingProperty);try{e.state.value.updateSelecting(t.selecting.multiselect,t.expandingProperty)}finally{n.selecting(!1,t.expandingProperty)}}e.savePreferences(function(){e._refreshGrid()})}}},v.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.$schema.description&&(n.description=o.tt(t.$schema.description,t.form.$locale)),t.$element=$(a.gridContainer(t.id,n,t.options.design,t.$schema.title,t.form.$locale,t.columns,t.frozenColumns)),t._renderColumns(n),t._renderRows(!0,"",null,!0),t._renderTotalRows(),t._state2UI(!0),t.setEvents(n)),t.appendElement(e,n),t.$element},v}(e.ui.AbsField);f.BasicGrid=m,i.registerControl(m,"array",!1,"",null),i.registerControl(m,"array",!1,"basicgrid",null)}(e.formgrid||(e.formgrid={}))}(Phoenix||(Phoenix={})),function(e){var t,n=e.utils,i=e.ui,o=e.dom,r=e.ulocale,s=e.Observable.errorsUtils,a=e.uiutils;!function(t){var l=function(t){function i(e,n,i){var o=t.call(this,e,n,i)||this;return o._state(),o}return __extends(i,t),i.prototype._input=function(){if(!this.$element)return null;var e=this.$element.get(0);return o.find(e,this.id+"_input")},i.prototype._check=function(){if(!this.$element)return null;var e=this.$element.get(0);return o.find(e,this.id+"_check")},i.prototype.click=function(e){var t=this._input(),n=t.checked||!1;e.target==t&&this.state.value!=n&&(this._isBinded?(this.state.value=n,this.form.setValue(this.$bind,n)):this.setInternalValue(n,!0))},i.prototype._setDisabled=function(e,t){var n=this._check();this.state.isDisabled||this.state.isReadOnly?o.addClass(n,"disabled"):o.removeClass(n,"disabled"),e.disabled=this.state.isDisabled},i.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},i.prototype._setMandatory=function(e,t){},i.prototype._setErrors=function(t){var n=this.state.errors;if(t&&e.bootstrap4){var i="is-invalid";n&&n.length?o.addClass(t,i):o.removeClass(t,i)}this.showErrors(t,n)},i.prototype._state2UI=function(){var e=this._input(),t=this.$element?this.$element.get(0):null;e&&(e.checked=this.state.value||!1,this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setErrors(t))},i.prototype.changed=function(e,t,n,i){var o=this._input();this.state.value!=n&&(this.state.value=n,o&&(o.checked=this.state.value||!1))},i.prototype.stateChanged=function(e,t){var n=this,i=n._isBinded?n.form.getState(n.$bind):n._internalState,o=n._input(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r)),e&&"errors"!==e||s.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(r))},i.prototype.render=function(t){var i=this,o=i._initOptions(a.utils.defaultOptions);return i.$element||(i.$element=$(function(t,i,o,r){e.bootstrap4,r=r||"",i=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},i);var s=[];return a.utils.fieldWrapper(s,i,o,function(){i.columns&&s.push('<div class="no-x-padding ml-sm-auto col-sm-'+(12-i.labelCol)+'">'),s.push('<div id="{0}_check" class="custom-control custom-checkbox">'),s.push('<input type="checkbox" id="{0}_input" class="custom-control-input">'),s.push('<label class="custom-control-label" for="{0}_input"> '),s.push(n.escapeHtml(r||"")),s.push("&nbsp;"),s.push("</label>"),s.push("</div>"),a.utils.addErrorDiv(s,!1),i.columns&&s.push("</div>")}),n.format(s.join(""),t)}(i.id,o,i.options.design,r.tt(i.$schema.title,i.form.$locale))),i._state2UI()),i.appendElement(t,o),i.$element},i}(e.ui.AbsField);t.Check=l,i.registerControl(l,"boolean",!1,"",null)}(t||(t={}))}(Phoenix||(Phoenix={})),function(e){var t;!function(t){e.utils;var n=e.ui,i=e.dom,o=e.uiutils,r=e.Observable.errorsUtils,s=e.gridrender.GridUtil,a=e.Observable.SchemaUtils,l=function(t){function l(e,n,i){var o=t.call(this,e,n,i)||this,r=o,s=r.fieldOptions;r._initAllColumns(),r._state();var a=s.columns.header.fields||[];s.columns.header.fields=r.form.afterSettings(r.$bind,"columngrid",{columns:a}).columns;var l=r.form.getFieldSettings(r.$bind);return l&&(r._settings=r.form.afterSettings(r.$bind,"columngrid",l)),r._initRows(),o}return __extends(l,t),l.prototype._initSchemaRows=function(e){var t=this;t.rows=[],e.forEach(function(e,n){t.rows[n]={name:e.name,canEdit:e.canEdit,check:e.check,schema:a.getSchema(e.name,t.$schemaItems,t.form.$rootSchema,!1)||{}}})},l.prototype._colByName=function(e){for(var t=0,n=this.rows.length;t<n;t++){var i=this.rows[t];if(i.name===e)return i}return null},l.prototype.setSettings=function(e){this._rrender()},l.prototype._initRows=function(){if(!this.rows){var e=this.fieldOptions;e.columns||(e.columns={}),e.columns.header||(e.columns.header={}),e.columns.row||(e.columns.row={});var t=e.columns.header.fields||[];this._settings&&this._settings.columns&&this._settings.columns.length&&(t=this._settings.columns),this._initSchemaRows(t)}},l.prototype._initCols=function(e){var t=this;e.columns||(e.columns={}),e.columns.header||(e.columns.header={}),e.columns.row||(e.columns.row={});var n=$.extend({},e.columns.header),i=e.columns.row;n.options=n.options||{},i.options=i.options||{};var r,s=i.$bind;i.$bind?r=a.getSchema(i.$bind,t.$schemaItems,t.form.$rootSchema,!1):(s="$index",r={type:"integer"});var l=[];return l.push(n),t.state.value&&t.state.value.forEach(function(e){var n=o.utils.displayValue(e.getRelativeValue(s),r,t.form.$locale,{html:!1},e,s).value,a=$.extend({},i);a.title=n||"",a.id=e.$id,l.push(a)}),l},l.prototype._modifyRow=function(e,t,n,r,s,a,l){var u=i.find(this.$element.get(0),this.id+"_rows").childNodes[n].childNodes[r],d=o.utils.displayValue(e,t,this.form.$locale,{html:!0,useSymbol:!1,editable:s.editable,check:s.check,tableOptions:this.config.options},a,l);if(i.empty(u),d.html){var c=$(d.value);i.append(u,c.get(0))}else i.append(u,document.createTextNode(d.value))},l.prototype.changed=function(e,t,n,i,o){var r=this;if("upd"===i){var s=o&&o.$id?r.state.value.findById(o.$id):null;s&&r.rows.forEach(function(e,t){e.name===o.property&&r._modifyRow(s.getValue(e.name),e.schema,t,r.state.value.indexOf(s)+1,{editable:e.canEdit,check:e.check},s,e.name)})}},l.prototype._grid=function(){return this.$element.get(0)},l.prototype._setErrors=function(t,n){var o=this.state.errors;if(n&&e.bootstrap4){var r="is-invalid";o&&o.length?i.addClass(n,r):i.removeClass(n,r)}this.showErrors(n,o)},l.prototype.click=function(e){var t=i.parentByTag(this.$element.get(0),e.target,"td");if(t){var n=i.attr(t,"colId");if(n){var o=this._colByName(n);if(o&&o.canEdit&&a.isBoolean(o.schema)&&i.attr(e.target,"data-clickable")){var r=i.attr(t,"rowId"),s=r?this.state.value.findById(r):null;if(s){var l=s.getValue(o.name);s.setValue(o.name,!l)}}}}},l.prototype._setDisabled=function(e,t){},l.prototype._state2UI=function(){var e=this._grid(),t=this.$element?this.$element.get(0):null;e&&(this._setDisabled(e,t),this.setHidden(t),this._setErrors(e,t))},l.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n._grid(),s=n.$element?n.$element.get(0):null;e&&"isHidden"!==e||i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(s)),e&&"isDisabled"!==e||i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,s)),e&&"errors"!==e||r.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(o,s))},l.prototype._renderRows=function(){var e=this;if(e.$element){var t=i.find(e.$element.get(0),e.id+"_rows");i.empty(t),i.append(t,s.createGridRows(e.id,e.rows,e.state.value,e.columns,e.renderOptions,e.options.design,e.form.$locale))}},l.prototype._draw=function(e){var t=this;if(t.columns=t._initCols(t.fieldOptions),e._useColGrp){var n=i.find(t.$element.get(0),t.id+"_colgrp");i.empty(n),i.append(n,s.createColGroup(t.columns,e,!1))}if(!e.headerIsHidden){var o=i.find(t.$element.get(0),t.id+"_cols");i.empty(o),i.append(o,s.createCols(t.id,t.columns,e,t.options.design,t.form.$locale,"",!1))}t._renderRows(),t._state2UI()},l.prototype._rrender=function(){this.$element&&this._draw(this.renderOptions)},l.prototype.render=function(e){var t=this,n=t._initOptions(o.utils.defaultOptions);if(!t.$element)return t.columns=t._initCols(t.fieldOptions),t.$element=$(s.gridContainer(t.id,n,t.options.design,t.$schema.title,t.form.$locale,t.columns,null)),t._draw(n),t.appendElement(e,n),t.$element},l.prototype._createRow=function(e){if(this.$element){var t=i.find(this.$element.get(0),this.id+"_rows"),n=s.createRow(this.id,e,0,this.state.value.get(e),this.columns,this.renderOptions,this.options.design,this.form.$locale,e%2==1,!1,!1);t.childNodes.length>=e?i.append(t,n):i.before(t.childNodes[e],n)}},l.prototype._initAllColumns=function(){var e=this,t=e.fieldOptions;e._allColumns=[],e._allColumnsNames=[],t.columns||(t.columns={}),t.columns.header||(t.columns.header={});t.columns.header.allFields.forEach(function(t){e._allColumns.push($.extend({},t)),e._allColumnsNames.push(t.name)})},l.prototype._selectedColumns=function(){var e=this,t=[],n=[];return e.rows.forEach(function(e){t.push(e.name)}),e._allColumns.forEach(function(i){var o=a.getSchema(i.name,e.$schemaItems,e.form.$rootSchema,!1);t.indexOf(i.name)>=0&&n.push({name:i.name,title:o.title})}),n},l.prototype._initDataSettings=function(){var e=this,t={columns:[]},n=[];return e.rows.forEach(function(e){n.push(e.name)}),e._allColumns.forEach(function(i){var o=a.getSchema(i.name,e.$schemaItems,e.form.$rootSchema,!1);t.columns.push({name:i.name,caption:o.title,$select:n.indexOf(i.name)>=0})}),{schema:{properties:{columns:{type:"array",items:{type:"object",properties:{name:{type:"string"},caption:{type:"string"}}}}}},data:t,layout:{$type:"block",$items:[{$type:"block",$items:[]},{$type:"block",$items:[{$bind:"columns",$widget:"basicgrid",options:{border:!0,align:"middle",small:!0,noRowSelectedIndicator:!0,headerIsHidden:!0,selecting:{row:!0,multiselect:!0},columns:[{$bind:"caption",options:{width:"100%"}}]}}]},{$type:"block",$items:[]}]}}},l.prototype.sendMessage=function(e,t){switch(e){case"column-list":this.openColumns(t);break;case"selected-cols":return this._selectedColumns()}},l.prototype.stopProppagation=function(e){e.preventDefault(),e.stopPropagation()},l.prototype.openColumns=function(e){var t=this,i=t._initDataSettings(),o={title:e.title||"Columns ...",buttons:[{type:"success",title:e.okTitle||"OK",name:"ok"}]};n.OpenModalForm(o,i.layout,i.schema,i.data,{},function(e,n,i,o){if("modal-action"===n.operation)switch(n.property){case"ok":var r={columns:[]};i.columns.forEach(function(e){if(e.$select){var n=t._allColumnsNames.indexOf(e.name);n>=0&&r.columns.push($.extend({},t._allColumns[n]))}}),t._settings=r,t.form.setFieldSettings(t.$bind,t._settings),t.form.savePrefs(function(){t._settings=t.form.afterSettings(t.$bind,"columngrid",r),t.rows=null,t._initRows(),e.close(),t._rrender()})}})},l}(e.ui.AbsField);n.registerControl(l,"array",!1,"columngrid",null)}(t||(t={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e,i=(n.serial,n.utils),o=n.dom,r=n.locale,s=n.Observable.SchemaUtils,a=n.ulocale,l=n.ui,u=n.uiutils,d=n.Observable.errorsUtils,c=function(e,t,r,s,a){s=s||"";var l=[];return(t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t)).titleIsHidden&&(t.columns=!1),t.readOnly&&(delete t.after,delete t.before),u.utils.fieldWrapper(l,t,r,function(){var e=n.bootstrap4;if(!t.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var r=["bs-label"];t.columns&&(e?r.push("col-form-label"):r.push("checkbox-inline bs-cursor-d"),r.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&r.push("text-left")),t.inline&&(e?r.push("form-check-inline bs-cursor-d no-x-padding"):r.push("checkbox-inline bs-cursor-d no-x-padding")),r.length&&l.push(' class="'+r.join(" ")+'"'),l.push(">"),l.push(i.escapeHtml(s||"")+(t.inline?"&nbsp;":"")),u.utils.addTooltipAndRule(l,t),l.push("</label>")}t.columns&&l.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'" id="{0}_colparent">'),function(e,t,i,r){var s=n.bootstrap4,a="textarea"===(r=r||"input");t.readOnly&&(r="div"),a&&(t.before||t.after)&&(delete t.before,delete t.after);var l="date-time"===t.$format,d="date"===t.$format;if(("money"===t.$format||d||l)&&void 0===t.maxWidth&&(t.maxWidth="16em"),t.before||t.after){e.push('<div class="input-group" id="{0}_group"');var c=[];t.minWidth&&c.push("min-width: "+t.minWidth+";"),t.maxWidth&&c.push("max-width: "+t.maxWidth+";"),c.length&&e.push('  style="'+c.join("")+'"'),e.push(">")}t.before&&(e.push('<span class="bs-grp-btn input-group-prepend">'),e.push('<span class="input-group-text">'),t.before.icon?e.push('<span class="'+o.iconClass(t.before.icon)+'"></span>'):e.push(t.before.value),e.push("</span>"),e.push("</span>"));var p=["form-control"];t.size&&s&&p.push("form-control-"+t.size),t.inputClass&&p.push(t.inputClass),t.readOnly&&p.push("bs-read-only"),e.push("<"+r+' autocomplete="off"'+(t.readOnly?"":' type="'+(t.type||"text")+'"')+' class="'+p.join(" ")),e.push('" id="{0}_input"'),a&&e.push(' rows="'+(t.rows||3)+'"'),t.before||t.after||(c=[],t.maxWidth&&c.push("max-width: "+t.maxWidth+";"),t.minWidth&&c.push("min-width: "+t.minWidth+";"),a&&t.noResize&&c.push("resize: none;"),c.length&&e.push('  style="'+c.join("")+'"'));if(t.maxLength&&e.push('  maxLength="'+t.maxLength+'"'),t.placeHolder){var h=!0===t.placeHolder?i:t.placeHolder;e.push('  placeholder="'+h+'"')}e.push(">"),t.after&&(e.push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-append input-group-addon'),t.after.icon&&e.push(" bs-icon-input"),e.push('">'),e.push('<span class="input-group-text">'),t.after.icon?e.push('<span class="'+o.iconClass(t.after.icon)+'"></span>'):e.push(t.after.value),e.push("</span>"),e.push("</span>")),(t.before||t.after)&&e.push("</div>"),(a||t.readOnly)&&e.push("</"+r+">"),u.utils.addErrorDiv(e)}(l,t,s,a),t.columns&&l.push("</div>"),t.titleIsHidden&&t.inline&&u.utils.addTooltipAndRule(l,t)}),i.format(l.join(""),e)},p=function(t){function n(n,i,o){var r=t.call(this,n,i,o)||this,s=r;return s._search=n&&n.options&&n.options.search,s._search&&(s._searchEventBus=new e.serial.SingleEventBus(500)),s._state(),r}return __extends(n,t),n.prototype._input=function(){var e=this.$element?this.$element.get(0):null;return e?o.find(e,this.id+"_input"):null},n.prototype._after=function(){var e=this.$element?this.$element.get(0):null;if(!e)return null;var t=o.find(e,this.id+"_after");return t?t.firstChild:null},n.prototype._colParent=function(){var e=this.$element.get(0);return this.renderOptions.columns?o.find(e,this.id+"_colparent"):null},n.prototype._value2Text=function(){this._input();return this._isDate()?u.utils.useDatePicker()?a.parseISODate(this.state.value||"")||"":a.shortDate(this.state.value||""):this._isDateTime()?u.utils.useDateTimePicker()?a.parseISODateTime(this.state.value||"")||"":a.shortDateTime(this.state.value||""):this.state.value||""},n.prototype._schemaInput=function(){return this.$schema},n.prototype._isPassword=function(){return s.isPassword(this._schemaInput())},n.prototype._isDate=function(){return s.isDate(this._schemaInput())},n.prototype._isDateTime=function(){return s.isDateTime(this._schemaInput())},n.prototype._isMemo=function(){return s.isText(this._schemaInput())},n.prototype._isNumber=function(){var e=this._schemaInput();return!e.enum&&s.isNumber(e)},n.prototype.setFocus=function(e){if(!this.renderOptions.readOnly){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden){var n=this._input();n&&n.focus()}}},n.prototype._isMoney=function(){return s.isMoney(this._schemaInput())},n.prototype._setDisabled=function(e,t){this.renderOptions.readOnly||(e.disabled=this.state.isDisabled)},n.prototype._setReadOnly=function(e,t){this.renderOptions.readOnly||(e.readOnly=this.state.isReadOnly)},n.prototype._setErrors=function(t,n){if(!this.renderOptions.readOnly){var i=this.state.errors,r=e.bootstrap4?"is-invalid":"has-error";i&&i.length?(o.addClass(n,r),e.bootstrap4&&o.addClass(t,r)):(o.removeClass(n,r),e.bootstrap4&&o.removeClass(t,r)),this.showErrors(n,i)}},n.prototype._setMandatory=function(e,t){if(!this.renderOptions.readOnly){var n=this.state.isMandatory;if(e.required=n,n?o.addClass(e,"bs-mandatory"):o.removeClass(e,"bs-mandatory"),this.renderOptions.placeHolder&&(e.placeholder=this.renderOptions.title+(n?" *":"")),!this.renderOptions.titleIsHidden){var i=o.find(t,this.id+"_label");i&&o.text(i,(this.renderOptions.title||"")+(n?" *":"")+(this.renderOptions.inline?String.fromCharCode(160):""))}}},n.prototype._state2UI=function(){var e=this,t=e._input(),n=e.$element?e.$element.get(0):null;t&&(e._value2Input(t),e._setDisabled(t,n),e._setReadOnly(t,n),e.setHidden(n),e._setMandatory(t,n),e._setErrors(t,n),e._setSymbol(n))},n.prototype._setSymbol=function(e){if(!this.renderOptions.readOnly&&this._hasSymbol&&e){var t=this._after();t&&(this.state.symbol?o.text(t,this.state.symbol):o.text(t,String.fromCharCode(160)))}},n.prototype._value2Input=function(e){var t=this;t.renderOptions.readOnly?t._isDate()?o.text(e,a.shortDate(t.state.value||"")||String.fromCharCode(160)):t._isDateTime()?o.text(e,a.shortDateTime(t.state.value||"")||String.fromCharCode(160)):(t._isNumber(),o.text(e,t._value2Text()||String.fromCharCode(160))):t._isDate()?u.utils.useDatePicker()?u.utils.datePickerSetValue(t.$element,t.state.value):e.value=a.shortDate(t.state.value||""):t._isDateTime()?u.utils.useDateTimePicker()?u.utils.dateTimePickerSetValue($(o.find(t.$element.get(0),t.id+"_group")),t.state.value):e.value=a.shortDateTime(t.state.value||""):(t._isNumber(),e.value=t._value2Text())},n.prototype.changed=function(e,t,n,i,o){var r=this;if(!r.useDisplay||e!==r.$bind)if(r.$element){var s=r._input();if(n=r.form.getValue(r.$display),r.state.value!=n)r.state.value=n,r._value2Input(s);else s.value!=r._value2Text()&&r._value2Input(s)}else r.state.value=n},n.prototype.stateChanged=function(e,t){var n=this;if(!n.useDisplay||e!==n.$display){var i=n.form.getState(n.$bind),o=n._input(),r=n.$element?n.$element.get(0):null;e&&"symbol"!==e||i.symbol!==n.state.symbol&&(n.state.symbol=i.symbol,o&&n._setSymbol(r)),e&&"decimals"!==e||i.decimals!==n.state.decimals&&(n.state.decimals=i.decimals),e&&"isHidden"!==e||i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),e&&"isDisabled"!==e||i.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),e&&"isReadOnly"!==e||i.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),e&&"isMandatory"!==e||i.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r)),e&&"errors"!==e||d.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(o,r))}},n.prototype.destroy=function(){this._searchEventBus&&(this._searchEventBus.destroy(),this._searchEventBus=null),t.prototype.destroy.call(this)},n}(e.ui.AbsField);t.BaseEdit=p;var h=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}return __extends(t,e),t.prototype.beforeAppend=function(){},t.prototype.mousedown=function(e){if(!this.renderOptions.readOnly&&(this._doSelect=!1,this.$element&&!this.state.isDisabled)){if(window.document.activeElement!==e.target)this._input()===e.target&&(this._doSelect=!0);return!0}},t.prototype.stopProppagation=function(e){if(!this.renderOptions.readOnly&&this._doSelect){var t=this._input();o.select(t)}},t.prototype.click=function(e){if(!this.state.isDisabled&&!this.state.isReadOnly){var t=e.target;if(this.renderOptions.after&&this.renderOptions.after.$bind){var n=this._after();if(o.isChildOf(n,t)){this._afterEnter();var i=this._input();i&&i.focus()}}}},t.prototype.internalRender=function(e){var t=this,n=t._initOptions(u.utils.defaultOptions);t.$element||(n.title=a.tt(t.$schema.title,t.form.$locale),n.placeHolder&&1!=n.placeHolder&&(n.title=a.tt(n.placeHolder,t.form.$locale)),n.maxLength=t.$schema.maxLength,t.$schema.description&&(n.description=a.tt(t.$schema.description,t.form.$locale)),t.$element=$(c(t.id,n,t.options.design,n.title,n.tagName)),t.beforeAppend(),t.setEvents(n),t._state2UI()),t.appendElement(e,n)},t.prototype.render=function(e){this.internalRender(e)},t.prototype._text2value=function(e){return u.utils.text2value(e,this.$schema,this.state)},t.prototype._value2Text=function(){return this._isNumber()?s.value2Text(this.state.value,this.$schema,this.state):e.prototype._value2Text.call(this)},t.prototype.customOptions=function(t){var n=this;e.prototype.customOptions.call(this,t),n._isDate()?n.customOptionsDate(t):n._isDateTime()?n.customOptionsDateTime(t):n._isNumber()?n.customOptionsNumber(t,n.state.symbol):n._isPassword()?n.customOptionsPassword(t):n._isMemo()&&n.customOptionsMemo(t)},t.prototype.customOptionsMemo=function(e){e.tagName="textarea"},t.prototype.customOptionsPassword=function(e){e.type="password"},t.prototype.customOptionsDate=function(e){e.$format="date",u.utils.useDatePicker()?(e.after={icon:"calendar"},e.date=!0):e.type="date"},t.prototype.customOptionsDateTime=function(e){e.$format="date-time",u.utils.useDateTimePicker()&&(e.after={icon:"calendar"},e.date=!0)},t.prototype.customOptionsNumber=function(e,t){e.inputClass="bs-edit-number";var n=this._schemaInput();(t||s.hasSymbol(n))&&(e.after={value:t},this._hasSymbol=!0),e.$format=n.format},t.prototype._removeEventsDate=function(){u.utils.useDatePicker()&&u.utils.datePickerDestroy(this.$element)},t.prototype._setEventsDate=function(){var e=this;e.renderOptions.readOnly||u.utils.useDatePicker()&&u.utils.datePickerInitialize(e.$element,{showOnFocus:!0},function(t){e.focusOut(null)})},t.prototype._removeEventsDateTime=function(){this.renderOptions.readOnly||u.utils.useDateTimePicker()&&u.utils.dateTimePickerDestroy($(o.find(this.$element.get(0),this.id+"_group")))},t.prototype._setEventsDateTime=function(){var e=this;e.renderOptions.readOnly||u.utils.useDateTimePicker()&&u.utils.dateTimePickerInitialize($(o.find(e.$element.get(0),e.id+"_group")),{},function(t){e.focusOut(null)})},t.prototype.setEvents=function(e){this._isDate()?this._setEventsDate():this._isDateTime()&&this._setEventsDateTime()},t.prototype.removeEvents=function(){this._isDate()?this._removeEventsDate():this._isDateTime()&&this._removeEventsDateTime()},t.prototype.checkValue=function(e,t){t(e)},t.prototype.paste=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t._input();if(t.state.isReadOnly||t.state.isDisabled)return!0;var i=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===u.utils.doPasteNumber(e,n,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:i}))return!1}else if(t._isDate()){if(!1===u.utils.doPasteDate(e,n,{sep:r.date.daySep,format:r.date.dateShort,schema:i}))return!1}else if(t._isPassword()&&!1===u.utils.doPastePassword(e,n,{schema:i}))return!1;return!0}},t.prototype._ignoreKeys=function(e,t){return e.which===o.keys.VK_TAB||e.which!==o.keys.VK_DELETE&&(!(!t&&e.which===o.keys.VK_BACKSPACE)&&(t?0===e.which||o.arrowKeys.indexOf(e.which)>=0:o.ignoreKeys.indexOf(e.which)>=0||o.arrowKeys.indexOf(e.which)>=0))},t.prototype.keypress=function(e){var t=this;if(t.renderOptions.readOnly)return!0;if(t.state.isReadOnly||t.state.isDisabled)return!0;var n=t._input();if(t._ignoreKeys(e,!0))return!0;var i=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===u.utils.keyPressNumber(e,n,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:i}))return!1}else if(t._isDate()){if(!1===u.utils.keyPressDate(e,n,{sep:r.date.daySep,format:r.date.dateShort,schema:i}))return!1}else if(t._isPassword()&&!1===u.utils.keyPressPassword(e,n,{schema:i}))return!1;return!0},t.prototype._afterEnter=function(){this._input2Model(!0),this.renderOptions&&this.renderOptions.after&&this.renderOptions.after.$bind&&this.form.execAction(this.renderOptions.after.$bind,this.state.value)},t.prototype.keydown=function(e){var t=this;if(t.renderOptions.readOnly)return!0;if(t.state.isReadOnly||t.state.isDisabled)return!0;var n=t._input();if(t._ignoreKeys(e,!1))return e.which===o.keys.VK_ENTER&&t._afterEnter(),!0;var i=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===u.utils.keyDownNumber(e,n,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:i}))return!1}else if(t._isDate()){if(!1===u.utils.keyDownDate(e,n,{sep:r.date.daySep,format:r.date.dateShort,schema:i}))return!1}else if(t._isPassword()&&!1===u.utils.keyDownPassword(e,n,{schema:i}))return!1;return!0},t.prototype.equals=function(e){var t=this.state.value===e;return!t&&void 0===this.state.value&&"string"===this.$schema.type&&""===e||t},t.prototype.updateModel=function(){this.form.setValue(this.$display,this.state.value)},t.prototype._internalSetValue=function(e,t){var n=this;n._searchEventBus?n._searchEventBus.push(null,function(t){n.state.value=e,n.updateModel()},t):(n.state.value=e,n.updateModel())},t.prototype._input2Model=function(e){var t=this,n=t._input(),i=t._text2value(n.value);t.equals(i)?(t._isNumber()||t._isDate()||t._isDateTime())&&t._value2Input(n):t.checkValue(i,function(i){t.state.value!==i?(""===i&&"string"===t.$schema.type&&(i=void 0),t._internalSetValue(i,e)):t._value2Input(n)})},t.prototype.focusOut=function(e){this.renderOptions.readOnly||this._input2Model(!0)},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(p);t.Edit=h,l.registerControl(h,"string",!1,"",null),l.registerControl(h,"number",!1,"",null),l.registerControl(h,"integer",!1,"",null)}(e.formedit||(e.formedit={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o=e.utils,r=e.dom,s=e.ui,a=(e.locale,e.uiutils),l=(e.Observable.SchemaUtils,e.ulocale),u=e.Observable.errorsUtils;t||(t={}),n=function(e,t,n,i){i=i||n;var o=document.createDocumentFragment(),s=$('<div tabindex="0" class="bs-enum-list-row"><div class="bs-enum-list-check"><a><center><span class="'+r.iconClass("square-o")+'"></span></center></a></div><div class="bs-enum-list-title"></div></div>').get(0);return n.forEach(function(n,a){var l=s.cloneNode(!0);t?(r.attr(l,"tabindex","-1"),r.removeClass(l,"bs-pointer"),r.addClass(l,"bs-cursor-disabled")):(r.attr(l,"tabindex","0"),r.addClass(l,"bs-pointer"),r.removeClass(l,"bs-cursor-disabled")),l.firstChild.firstChild.firstChild.firstChild.className=e&&e.indexOf(n)>=0?r.iconClass("check-square-o"):r.iconClass("square-o");var u=l.lastChild;r.append(u,document.createTextNode(i[a])),r.append(o,l)}),o},i=function(t){function i(e,n,i){var o=t.call(this,e,n,i)||this;return o._state(),o}return __extends(i,t),i.prototype._setDisabled=function(e,t){for(var n=0,i=e.childNodes.length;n<i;n++){var o=e.childNodes[n];this.state.isDisabled?(r.attr(o,"tabindex","-1"),r.removeClass(o,"bs-pointer"),r.addClass(o,"bs-cursor-disabled")):(r.attr(o,"tabindex","0"),r.addClass(o,"bs-pointer"),r.removeClass(o,"bs-cursor-disabled"))}},i.prototype._setReadOnly=function(e,t){},i.prototype._setErrors=function(t,n){var i=this.state.errors;if(n&&e.bootstrap4){var o="is-invalid";i&&i.length?r.addClass(n,o):r.removeClass(n,o)}this.showErrors(n,i)},i.prototype._setMandatory=function(e,t){},i.prototype._input=function(){var e=this.$element.get(0);return r.find(e,this.id+"_input")},i.prototype._state2UI=function(e){var t=this._input(),n=this.$element?this.$element.get(0):null;t&&(e||this._setDisabled(t,n),e||this._setFilter(),this._setReadOnly(t,n),this.setHidden(n),this._setMandatory(t,n),this._setErrors(t,n))},i.prototype.mousedown=function(e){if(this.$element&&!this.state.isDisabled&&!this.state.isReadOnly){var t=window.document.activeElement,n=r.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");if(n)return t!==n&&n.focus(),!0}},i.prototype._getEnumsNames=function(){var e=this;if(!e.$schemaItems.enumNames)return null;if(e.state.filter){var t=[];return e.$schemaItems.filters[e.state.filter].forEach(function(n){t.push(e.$schemaItems.enumNames[e.$schemaItems.enum.indexOf(n)])}),t}return e.$schemaItems.enumNames},i.prototype._getEnums=function(){return this.state.filter?this.$schemaItems.filters[this.state.filter]:this.$schemaItems.enum},i.prototype._toggleEnumByIndex=function(e){var t=this._getEnums();if(e>=0&&e<t.length){var n=t[e];this.state.value.indexOf(n)>=0?this.state.value.remove(n):this.state.value.push(n)}},i.prototype.keypress=function(e){if(32==e.which){var t=r.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");if(!t)return;this._toggleEnumByIndex(r.indexOf(t.parentNode,t))}},i.prototype.click=function(e){if(this.$element&&!this.state.isDisabled&&!this.state.isReadOnly){var t=r.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");t&&this._toggleEnumByIndex(r.indexOf(t.parentNode,t))}},i.prototype.changed=function(e,t,i,o,s){var a=this;if(a.$element){var l=a._input(),u=-1,d=a._getEnums(),c=a._getEnumsNames();switch(o){case"add":(u=d.indexOf(s.$id))>=0&&a._setItemValue(l.childNodes[u],!0);break;case"remove":(u=d.indexOf(s.$id))>=0&&a._setItemValue(l.childNodes[u],!1);break;case"propchange":r.empty(l),e===a.$bind&&(a.state.value=a.form.getValue(a.$bind));var p=n(a.state.value,a.state.isDisabled,d,c);r.empty(l),r.append(l,p)}}},i.prototype._setFilter=function(){this.state.filter;var e=this._getEnums(),t=[];this.state.value.forEach(function(n){e.indexOf(n)>=0&&t.push(n)}),this.form.setValue(this.$bind,t)},i.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null,r=o?n._input():null;e&&"isHidden"!==e||i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),e&&"isDisabled"!==e||i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(r,o)),e&&"isReadOnly"!==e||i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly),e&&"filter"!==e||i.filter!=n.state.filter&&(n.state.filter=i.filter,o&&n._setFilter()),e&&"isMandatory"!==e||i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory),e&&"errors"!==e||u.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(null,o))},i.prototype.render=function(t){var i=this,s=i._initOptions(a.utils.defaultOptions);if(!i.$element){i.$schema.description&&(s.description=l.tt(i.$schema.description,i.form.$locale)),i.$element=$(function(t,n,i,r){var s=e.bootstrap4;r=r||"";var l=[];return(n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},n)).titleIsHidden&&(n.columns=!1),n.placeHolder=!1,a.utils.fieldWrapper(l,n,i,function(){if(!n.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];n.columns&&(s?e.push("col-form-label"):e.push("checkbox-inline bs-cursor-d"),e.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&e.push("text-left")),n.inline&&(s?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("no-x-padding bs-cursor-d")),e.length&&l.push(' class="'+e.join(" ")+'"'),l.push(">"),l.push(o.escapeHtml(r||"")+(n.inline?"&nbsp;":"")),a.utils.addTooltipAndRule(l,n),l.push("</label>")}n.columns&&l.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),l.push('<div class="bs-enum-list-wrap" id="{0}_input">'),l.push("</div>"),a.utils.addErrorDiv(l),n.columns&&l.push("</div>")}),o.format(l.join(""),t)}(i.id,s,i.options.design,l.tt(i.$schema.title,i.form.$locale)));var u=n(i.state.value,i.state.isDisabled,i._getEnums(),i._getEnumsNames()),d=i._input();r.append(d,u),i._state2UI(!0)}return i.appendElement(t,s),i.$element},i.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.firstChild.className=t?r.iconClass("check-square-o"):r.iconClass("square-o")},i.prototype.destroy=function(){t.prototype.destroy.call(this)},i}(e.ui.AbsField),s.registerControl(i,"array",!1,"enums-list",null)}(Phoenix||(Phoenix={})),function(e){e.ui;var t=e.uiutils,n=e.dom;e.ulocale;function i(e,t,n){return e=e.substr(0,t)+e.substr(n,e.length-n)}function o(e,t,n){var i=l(e,n,""),o="."==t?i:i.replace(t,".");l(o,"-","");return o}function r(e,t,n,i){e||(e="0"),-1==e.indexOf(".")&&(e+="."+s("",t));var o=function(e){var t=e.split(".");""==t[0]&&(t[0]="0");return t}(e),r=function(e,t){var n="";0==e.indexOf("-")&&(n="-",e=e.substr(1,e.length-1));for(var i=0;i<e.length-1;i++){e[i];if("0"!=e[i])break}if(""==(e=e.substr(i,e.length-i)))return"0";if(e.length<=3)return n+e;for(var o=a(e),r="",i=0;i<o.length;i++)i%3==0&&i>0&&(r+=t),r+=o[i];return a(r+n)}(o[0],i),l=o[1];return l.length>t&&(l=l.substr(0,t)),l.length<t&&(l=s(l,t)),0===t?r:r+n+l}function s(e,t){for(var n=e.length,i=0;i<t-n;i++)e+="0";return e}function a(e){return e.split("").reverse().join("")}function l(e,t,n){for(var i="",o=0;o<e.length;o++)e[o]==t?i+=n:i+=e[o];return i}function u(e,t,n,i,o){var r=parseFloat(e);if(n){if(r<=t)return!1}else if(r<t)return!1;if(o){if(r>=i)return!1}else if(r>i)return!1;return!0}function d(e,t,i){var o=e.value,r=0;if(0!=t){for(var s=0;s<o.length&&(o[s]!=i&&t--,0!=t);s++);r=s+1}n.selectRange(e,r)}t.utils.doPasteNumber=function(e,t,n){var s=parseFloat(o(e.originalEvent.clipboardData.getData("Text"),n.decimalSep,n.thousandSep)),a="";if(s<0&&(a="-",s=-s),isNaN(s))return e.preventDefault(),!0;var l=s.toString(),c=e.target.selectionStart,p=e.target.selectionEnd,h=p-c>0?i(t.value,c,p):t.value,f=h.substr(0,c),m=o(f+s+h.substr(c,h.length),n.decimalSep,n.thousandSep);if(!u(a+m,n.schema.minimum,n.schema.exclusiveMinimum,n.schema.maximum,n.schema.exclusiveMaximum))return e.preventDefault(),!1;t.value=r(a+m,n.places,n.decimalSep,n.thousandSep),d(t,o(f,n.decimalSep,n.thousandSep).length+l.length,n.thousandSep),e.preventDefault()},t.utils.keyPressNumber=function(e,t,s){var a=e.target.selectionStart,l=e.target.selectionEnd,c=l-a>0,p=c?i(t.value,a,l):t.value,h="";-1!=p.indexOf("-")&&(p=p.substr(1,p.length-1),h="-",-0!=a&&(a--,l--));var f,m=p.substr(0,a),v=p.substr(a,p.length);if(e.key===s.decimalSep||"."===e.key)return n.selectRange(t,p.indexOf(s.decimalSep)+1+h.length),e.preventDefault(),!0;if("-"===e.key){if(0!=p.indexOf("-")){var g=o(p,s.decimalSep,s.thousandSep);if(g==function(e){for(var t="0.",n=0;n<e;n++)t+="0";return t}(s.places)||""==g){var y=r(g,s.places,s.decimalSep,s.thousandSep);t.value=y}else{if(!u("-"+g,s.schema.minimum,s.schema.exclusiveMinimum,s.schema.maximum,s.schema.exclusiveMaximum))return e.preventDefault(),!1;t.value=r("-"+g,s.places,s.decimalSep,s.thousandSep)}}return n.selectRange(t,1),e.preventDefault(),!0}if((f=e).which<48||f.which>57)return e.preventDefault(),!1;if("0"===e.key&&0==a&&!c)return e.preventDefault(),!0;var _=o(m+e.key+v,s.decimalSep,s.thousandSep);if(!u(h+_,s.schema.minimum,s.schema.exclusiveMinimum,s.schema.maximum,s.schema.exclusiveMaximum))return e.preventDefault(),!1;t.value=r(h+_,s.places,s.decimalSep,s.thousandSep);var $="0"==m?0:1;return d(t,o(m,s.decimalSep,s.thousandSep).length+$,s.thousandSep),e.preventDefault(),!0},t.utils.keyDownNumber=function(e,t,s){if(e.which!=n.keys.VK_BACKSPACE&&e.which!=n.keys.VK_DELETE)return!0;var a=0;e.which==n.keys.VK_BACKSPACE&&(a=-1);var l,u,c,p,h,f,m,v=e.target.selectionStart,g=e.target.selectionEnd,y=g-v>0,_=y?i(t.value,v,g):t.value,$=_.substr(0,v),b=_.substr(v,_.length);if(y)return l=t,u=_,c=$,p=s.thousandSep,h=s.decimalSep,f=s.places,m=r(o(u,h,p),f,h,p),l.value=m,d(l,o(c,h,p).length,p),e.preventDefault(),!0;if(e.which==n.keys.VK_BACKSPACE&&0==v)return e.preventDefault(),!0;if(e.which==n.keys.VK_BACKSPACE){if(_[v+a]==s.decimalSep)return n.selectRange(t,v+a),e.preventDefault(),!0}else if(_[v+a]==s.decimalSep)return n.selectRange(t,v+a+1),e.preventDefault(),!0;if(_[v+a]==s.thousandSep)return n.selectRange(t,v+1+2*a),e.preventDefault(),!0;var x="";e.which==n.keys.VK_DELETE?x=o($+b.substr(1,b.length-1),s.decimalSep,s.thousandSep):e.which==n.keys.VK_BACKSPACE&&(x=o($.substr(0,$.length-1)+b,s.decimalSep,s.thousandSep));var C=function(e,t,n,i,o,s,a,l){""===e&&(e="0");var u=parseFloat(e);if(n){if(u<=t)return r(t.toString(),s,a,l)}else if(u<t)return r(t.toString(),s,a,l);if(o){if(u>=i)return r(i.toString(),s,a,l)}else if(u>i)return r(i.toString(),s,a,l);return r(u.toString(),s,a,l)}(x,s.schema.minimum,s.schema.exclusiveMinimum,s.schema.maximum,s.schema.exclusiveMaximum,s.places,s.decimalSep,s.thousandSep);t.value=C;var k=o($,s.decimalSep,s.thousandSep).length+a;return e.which==n.keys.VK_BACKSPACE&&0==x.indexOf(".")&&1==v&&(k=1),e.which==n.keys.VK_DELETE&&0==x.indexOf(".")&&0==v&&(k=1),d(t,k,s.thousandSep),e.preventDefault(),!0}}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,o=i.utils,r=i.ui,s=i.dom,a=i.uiutils;e.frame||(e.frame={}),t=function(e,t){if(":"===e.charAt(0)&&(e=location.protocol+"//"+location.hostname+e),t.noCache){o.allocUuid();e.indexOf("?")>=0&&"&"}return e},n=function(e){function n(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o._msghandler=o._onmessage.bind(o),o}return __extends(n,e),n.prototype._setDisabled=function(e){},n.prototype._setReadOnly=function(e){this._setDisabled(e)},n.prototype._setMandatory=function(e){},n.prototype._onmessage=function(e){var t=this._iframe();t&&t.contentWindow&&e.source===t.contentWindow&&e.data&&("string"==typeof e.data&&e.data.indexOf("[iFrameSizer]")>=0||this.fieldOptions&&this.fieldOptions.messages&&e.data.action&&this.fieldOptions.messages[e.data.action]&&this.form.execAction(this.fieldOptions.messages[e.data.action],e.data.action,e.data))},n.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;if(e){var n=this._iframe();n&&this.state.value&&(n.src=t(this.state.value,this.renderOptions)),this._setDisabled(e),this._setReadOnly(e),this.setHidden(e)}},n.prototype.changed=function(e,n,i,o){var r=this,a=r._iframe();if(r.state.value!==i){r.state.value=i;var l=r.$element?r.$element.get(0):null;if(a)a&&(r.state.value?a.src=t(r.state.value,r.renderOptions):a.iFrameResizer&&a.iFrameResizer.close());else if(r.state.value&&l){var u=s.find(l,r.id+"_parent"),d=$('<iframe src="'+t(r.state.value,r.renderOptions)+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>');s.append(u,d.get(0)),r._applyIResize()}}},n.prototype._applyIResize=function(){if(this.$element){if(!this._iframe())return;var e=$(this._iframe());this.state.value&&e.iFrameResize&&e.iFrameResize({})}},n.prototype.afterAddedInDom=function(){this._applyIResize()},n.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o))},n.prototype._iframe=function(){var e=this.$element.get(0);return e?e.firstChild.firstChild:null},n.prototype.setEvents=function(e){window.addEventListener("message",this._msghandler)},n.prototype.resize=function(e){if(e&&this.fieldOptions.refreshOnVisibilityChanged){var t=this._iframe();if(t){t.iFrameResizer&&t.iFrameResizer.close();var n=this.state.value;this.state.value="",this.changed(this.$bind,"",n,null)}}},n.prototype.removeEvents=function(){var e=this._iframe();e&&e.iFrameResizer&&e.iFrameResizer.close(),window.removeEventListener("message",this._msghandler)},n.prototype.destroy=function(){e.prototype.destroy.call(this),this._msghandler=null},n.prototype.render=function(e){var t,n,i,r,s=this,l=s._initOptions(a.utils.defaultOptions);return s.$element||(l.src=s.state.value,s.$element=$((t=s.id,n=l,i=s.options.design,r=[],a.utils.fieldWrapper(r,n,i,function(){r.push('<div id="{0}_parent">'),n.src&&r.push('<iframe scrolling="no" width="100%" frameBorder="0" border="0"></iframe>'),r.push("</div>")},null),o.format(r.join(""),t))),s._state2UI(),s.setEvents(l)),s.appendElement(e,l),s.$element},n}(e.ui.AbsField),r.registerControl(n,"string",!1,"iframe",{})}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,o=i.utils,r=i.ui,s=i.dom,a=i.uiutils;e.gmapsviewer||(e.gmapsviewer={}),t=function(e){return"https://www.google.com/maps/embed/v1/place?key="+encodeURIComponent(o.gmapsKey)+"&q="+encodeURIComponent(e)},n=function(e){function n(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(n,e),n.prototype._setDisabled=function(e){},n.prototype._setReadOnly=function(e){this._setDisabled(e)},n.prototype._setMandatory=function(e){},n.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this._showaddress(),this._setDisabled(e),this._setReadOnly(e),this.setHidden(e))},n.prototype._showaddress=function(){var e=this,n=e._iframe(),i=e.$element?e.$element.get(0):null;if(n)n&&(e.state.value?n.src=t(e.state.value):s.remove(n));else if(e.state.value&&i){var o=s.find(i,e.id+"_parent"),r=$('<iframe id="'+e.id+'_frame" src="'+t(e.state.value)+'" scrolling="no" width="100%" height="'+e.renderOptions.height+'"  frameBorder="0" border="0"></iframe>');s.append(o,r.get(0))}},n.prototype.changed=function(e,t,n,i){this._iframe();this.state.value!==n&&(this.state.value=n,this._showaddress())},n.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o))},n.prototype._iframe=function(){var e=this.$element.get(0);return e?s.find(e,this.id+"_frame"):null},n.prototype.render=function(e){var t,n,i,r,s=this,l=s._initOptions(a.utils.defaultOptions);return s.$element||(l.src=s.state.value,s.$element=$((t=s.id,n=l,i=s.options.design,r=[],a.utils.fieldWrapper(r,n,i,function(){n.height=n.height||450,r.push('<div id="{0}_parent"></div>')},null),o.format(r.join(""),t))),s._state2UI(),s.setEvents(l)),s.appendElement(e,l),s.$element},n}(e.ui.AbsField),r.registerControl(n,"string",!1,"gmapsview",{})}(Phoenix||(Phoenix={})),function(e){var t=e,n=t.utils,i=t.dom,o=t.ui,r=t.autoclose,s=t.pagecontrol,a=t.Observable,l=t.data,u=t.formgrid,d=a.SchemaUtils,c=t.locale;!function(e){var t={name:"$lookup",form:!0,datasets:{list:{$main:!0,$type:"odata",$method:"GET",$params:{$entity:"Country",$module:"",$top:5,$orderby:"",$searchByFields:void 0,$allData:!1}}},$type:"block",$items:[{$type:"block",$items:[{$bind:"search",$widget:"search",options:{autofocus:!0,search:"documents"}}]},{$type:"block",$items:[{$bind:"documents",options:{border:!0,scrolling:{horizontal:!0},sorting:!0,selecting:{row:!0,action:"selectAndClose"},columns:[]}}]}]},a=function(){function e(e,t,n){}return e.prototype._modelChanged=function(e,t,n,i){if("init"===e.operation)(r=t.documents).length&&r.selectItem(!0,t.documents.get(0),!1,"",!1);else if("form-validate"===e.property){if(this._onselect){var o=null;(r=t.documents).enumSelectedItems("",function(e){o||(o=e)}),this._onselect(o?o.model():null)}n.autoClose.explicitClose=!0,this.hide()}else if("documents"===e.property){var r;if("propchange"===e.operation)(r=t.documents).length&&r.selectItem(!0,t.documents.get(0),!1,"",!1)}else"documents.$item.$links.selectAndClose"===e.property&&(this._onselect&&this._onselect(e.actionParams.model()),n.autoClose.explicitClose=!0,this.hide())},e.prototype._checkFormLayout=function(e){var t=this;e.$schema.properties.search={title:c.ui.Search,type:"string"},e.$schema.properties.documents.$reference="list",t._lookupColumns||(t._lookupColumns=[],Object.keys(e.$schema.properties.documents.items.properties).forEach(function(n){var i=e.$schema.properties.documents.items.properties[n];i.title&&"object"!==i.type&&"array"!==i.type&&t._lookupColumns.push(n)})),e.$schema.properties.documents.items.links={selectAndClose:{}};var n=e.data.$items[1].$items[0].options.columns;t._lookupColumns.forEach(function(e){var i=e;"string"==typeof e&&(i={$bind:e}),i.$bind===t._searchField?n.splice(0,0,i):n.push(i)})},e.prototype._beforeClose=function(){if(this._form){var e=this._form,t=this._parentControl,n=this._focusParams;this._form=null,t&&t.focused&&(e.autoClose&&e.autoClose.explicitClose?t.setFocus&&t.setFocus(n):t.checkFocus&&t.checkFocus(n))}},e.prototype._checkPopup=function(){},Object.defineProperty(e.prototype,"opened",{get:function(){return!!this._form},enumerable:!0,configurable:!0}),e.prototype.focusInCombo=function(e){return!(!this._form||!this._form.autoClose)&&this._form.autoClose.inPopup(e)},e.prototype.show=function(e,n,s){var a=this;if(a._parentControl=n,a._focusParams=s.focusParams,a._lookup=s.lookup,a._lookupColumns=s.lookupColumns,a._onselect=s.onselect,!a._lookup.schema)throw"Invalid lookup definition. Foreign schema is missing.";var l=$.extend(!0,{},t);a._lookup.data&&a._lookup.data.$params&&a._lookup.data.$params.$allData&&(l.datasets.list.$params.$allData=!0);var u="string"==typeof a._lookup.schema?a._lookup.schema:$.extend(!0,{},a._lookup.schema),c=l.datasets.list,p=s.minWidth||0;if(s.alignElementId){var h=i.find(null,s.alignElementId);h&&(p=Math.max(h.offsetWidth,p)),p=Math.max(p,300)}$.extend(c.$params,e.$params),e.$transform&&(c.$transform=e.$transform),e.$type&&(c.$type=e.$type),c.$params.$orderby=c.$params.$orderby||(s.display?a._lookup.mapping[s.display]:"");var f=s.display?a._lookup.mapping[s.display]:"";a._searchField=f,o.loadSchema(u).then(function(e){d.expandSchema$Ref(e);var t=d.searchableFields(e.properties.documents.items,e,null),n=[];c.$params.$searchByFields&&c.$params.$searchByFields.fields&&c.$params.$searchByFields.fields.length?n=c.$params.$searchByFields.fields:f&&n.push(f),t.forEach(function(e){n.indexOf(e.name)<0&&n.push(e.name)}),c.$params.$searchByFields={fields:n,value:s.search?s.search:""},o.showAutoCloseForm({name:l,meta:e,controller:{onModelChanged:a._modelChanged.bind(a),checkFormLayout:a._checkFormLayout.bind(a)},autoClose:{align:r.BOTTOM_LEFT,opener:s.openerId,parents:s.openerId?[s.openerId]:void 0,alignElementId:s.alignElementId,beforeClose:a._beforeClose.bind(a),minWidth:p,showCloseButton:!1},parentContext:a._parentControl.form.$model,options:{}},null,function(e){a._form=e})})},e.prototype.hide=function(){this._form&&s.Page().setPopup(null);this._parentControl=null,this._focusParams=null,this._lookup=null,this._onselect=null,this._lookupColumns=null},e.prototype.destroy=function(){this.hide()},e}();e.GridItems=a;var p={checkGridPopup:function(e,t,n,i){return new a($(i),n,{primaryKey:t.primaryKey})},closeGridLookup:function(e,t,n){e[n]&&e[n].opened&&t.push(null,function(t){e[n]&&e[n].opened&&e[n].hide()},!0)},checkGridLookup:function(e,t){if("relation"===e.data.$type){var i=n.copy(e),o=t.getSchema(null),r=d.expand$Ref(t.getSchema(e.data.$params.relation),o);return r.items=d.expand$Ref(r.items,o),i.schema={type:"object",properties:{documents:r}},i.primaryKey=i.schema.properties.documents.items.primaryKey,i}return e},openGridLookup:function(e,t){var n=$.extend(!0,{},t.lookup.data),i={alignElementId:t.align,openerId:t.openerId,lookup:t.lookup,lookupColumns:t.lookupColumns,display:t.display,onselect:t.onselect,search:t.searchText,minWidth:t.minWidth};n&&n.$params&&n.$params.$filter&&(n.$params.$filter=l.replaceFilterVars(n.$params.$filter,t.formControl.getParentModel(t.bind).model(!0))),t.containerId&&(n.$params.containerId=t.containerId),t.viewId&&(n.$params.viewId=t.viewId),t.selected&&(n.$params.selected=t.selected),e[t.propertyName].show(n,t.parentControl,i)}};e.utils={checkGridPopup:p.checkGridPopup,closeGridLookup:p.closeGridLookup,openGridLookup:p.openGridLookup,checkGridLookup:p.checkGridLookup},u.gridlookup=e.utils}(e.gridlookup||(e.gridlookup={}))}(Phoenix||(Phoenix={})),function(e){!function(t){e.utils,e.ui;var n=e.Observable.errorsUtils,i=e.dom,o=(e.ulocale,function(t){function o(e,n,i){var o=t.call(this,e,n,i)||this;return o._state(),o}return __extends(o,t),o.prototype._item=function(e){if(!this.$element)return null;var t=this.$element.get(0);return i.find(t,this.id+"_item_"+e)},o.prototype.click=function(e){var t=e.target;if(!this.state.isReadOnly){var n=t.id?t.id:t.parentNode.id;if(n){"#"===(i.attr(t,"data-phoenix-href")||i.attr(t,"href"))&&e.preventDefault();var o=this.id+"_item_";if(0===n.indexOf(o)){var r=parseInt(n.substring(o.length),10),s=this.$schema.enum[r],a=this.$schema.enum.indexOf(this.state.value);if(this.renderOptions.wizard&&a>=0&&r>=0&&r-a>0)return;s!==this.state.value&&this.form.setValue(this.$bind,s)}}}},o.prototype._setDisabled=function(e){if(e){var t=this;t._enumItems(function(e,n){e.disabled=t.state.isDisabled||t.state.isReadOnly})}},o.prototype._enumItems=function(e){var t=this;t.$schema.enum.forEach(function(n,i){var o=t._item(i);e(o,n)})},o.prototype._setMandatory=function(e){},o.prototype._state2UI=function(e){var t=this.$element?this.$element.get(0):null;if(t){var n=this.$schema.enum.indexOf(this.state.value);if(n>=0){var i=this._item(n);i&&e(i)}this._setDisabled(t),this.setHidden(t),this._setErrors(t)}},o.prototype._setErrors=function(t){var n=this.state.errors;if(t&&e.bootstrap4){var o="is-invalid";n&&n.length?i.addClass(t,o):i.removeClass(t,o)}this.showErrors(t,n)},o.prototype._getDefaultItem=function(){if(this.$element?this.$element.get(0):null){var e=this.$schema.enum.indexOf(this.state.value);return e>=0?this._item(e):void 0}},o.prototype.stateChanged=function(e,t){var i=this,o=i.form.getState(i.$bind),r=i.$element?i.$element.get(0):null;o.isHidden!==i.state.isHidden&&(i.state.isHidden=o.isHidden,i.setHidden(r)),o.isDisabled!=i.state.isDisabled&&(i.state.isDisabled=o.isDisabled,i._setDisabled(r)),o.isReadOnly!=i.state.isReadOnly&&(i.state.isReadOnly=o.isReadOnly,i._setDisabled(r)),o.isMandatory!=i.state.isMandatory&&(i.state.isMandatory=o.isMandatory,i._setMandatory(r)),e&&"errors"!==e||n.errorChanged(i.state.errors,o.errors)&&(i.state.errors=o.errors,i._setErrors(r))},o}(e.ui.AbsField));t.Group=o}(e.groupctrl||(e.groupctrl={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l;n=t||(t={}),i=e.utils,o=e.ui,r=e.dom,e.groupctrl,s=e.ulocale,a=e.uiutils,l=function(t){function n(e,n,i){var o=t.call(this,e,n,i)||this;return o._state(),o}return __extends(n,t),n.prototype._state2UI=function(){var e=this.renderOptions.binary?"bactive":"active";t.prototype._state2UI.call(this,function(t){r.addClass(t,e)})},n.prototype.changed=function(e,n,i,o){var s=this,a=s.renderOptions.binary?"bactive":"active";if(s.state.value!=i){if(s.state.value=i,!s.$element)return;t.prototype._enumItems.call(this,function(e,t){s.state.value===t?r.addClass(e,a):r.removeClass(e,a)})}},n.prototype.mousedown=function(e){this.options.design||e.preventDefault(),this.setFocus()},n.prototype.focusIn=function(e){},n.prototype.focusOut=function(e){},n.prototype.setFocus=function(e){if(!this.renderOptions.readOnly){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden)if(this.$element)r.find(this.$element.get(0),this.id+"_grp").focus()}},n.prototype.keydown=function(e){var t=this;if(!t.state.isReadOnly&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.which||e.keyCode){case r.keys.VK_LEFT:var n=t.$schema.enum.indexOf(t.state.value);if(n>0){var i=t.$schema.enum[n-1];t.form.setValue(t.$bind,i)}break;case r.keys.VK_RIGHT:var o=t.$schema.enum.indexOf(t.state.value);if(o>=0&&o<t.$schema.enum.length-1){i=t.$schema.enum[o+1];t.form.setValue(t.$bind,i)}}},n.prototype.render=function(t){var n=this,o=n._initOptions(a.utils.defaultOptions);if(!n.$element){var r=n.$schema.enumNames||n.$schema.enum;r=r.map(function(e){return s.tt(e,n.form.$locale)}),n.$element=$(function(t,n,o,r,s,l){r=r||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var u=[];return a.utils.fieldWrapper(u,n,o,function(){var t=e.bootstrap4,o=!n.columns&&!n.inline;if(!n.titleIsHidden){u.push('<label id="{0}_label" for="{0}_grp" ');var d=["bs-label"];n.columns?(t?d.push("col-form-label"):d.push("checkbox-inline bs-cursor-d"),d.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&d.push("text-left")):n.inline&&(t?d.push("form-check-inline"):d.push("checkbox-inline"),d.push("bs-cursor-d no-x-padding")),d.length&&u.push(' class="'+d.join(" ")+'"'),u.push(">"),u.push(i.escapeHtml(r||"")+(n.inline?"&nbsp;":"")),u.push("</label>")}a.utils.addErrorDiv(u),n.columns&&u.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),o&&u.push("<div>"),u.push('<ul id="{0}_grp" tabindex="0" class="'+["no-y-margin d-inline-flex pagination"].join(" ")+'">'),s.forEach(function(e,t){u.push('<li id="{0}_item_'+t+'" class="page-item">'),u.push('<a tabindex="-1" href="#" class="page-link bs-nowrap"'),n.width&&u.push(' style="width:'+n.width+'"'),u.push(">"),u.push(i.escapeHtml(l[t]||"")),u.push("</a>"),u.push("</li>")}),u.push("</div>"),o&&u.push("</div>")}),n.columns&&u.push("</div>"),i.format(u.join(""),t)}(n.id,o,n.options.design,s.tt(n.$schema.title,n.form.$locale),n.$schema.enum,r)),n._state2UI()}return n.appendElement(t,o),n.$element},n}(e.groupctrl.Group),n.BtnGroup=l,o.registerControl(l,"*",!0,"grpbtn",null)}(Phoenix||(Phoenix={})),function(e){var t=e.utils,n=e.ui,i=e.dom,o=e.ulocale,r=e.uiutils;!function(s){var a=function(n){function s(e,t,i){var o=n.call(this,e,t,i)||this;return o._state(),o}return __extends(s,n),s.prototype.isMeta=function(){return!0},s.prototype.setParentId=function(e){this._parentId=e},s.prototype.getCustomBind=function(){return this.config&&this.config.options&&this.config.options.$bind?this.config.options.$bind:n.prototype.getCustomBind.call(this)},s.prototype._setDisabled=function(e,t){},s.prototype._setReadOnly=function(e,t){},s.prototype._setMandatory=function(e,t){var n=this.state.isMandatory,o=this._label();o&&i.text(o,this.renderOptions.title+(n?" *":"")+(this.renderOptions.inline?String.fromCharCode(160):""))},s.prototype._label=function(){return this.$element?i.find(this.$element.get(0),this.id+"_label"):null},s.prototype._state2UI=function(){var e=this._label(),t=this.$element?this.$element.get(0):null;e&&(this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setMandatory(e,t))},s.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n._label(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r))},s.prototype._title=function(){return this.$schema&&this.$schema.title?this.$schema.title:this.config&&this.config.options&&this.config.options.title?this.config.options.title:""},s.prototype.render=function(n){var i=this,s=i._initOptions(r.utils.defaultOptions);return i.$element||(s.title=o.tt(i._title(),i.form.$locale),i.$schema.description&&(s.description=o.tt(i.$schema.description,i.form.$locale)),i._parentId&&(s.parentId=i._parentId),i.$element=$(function(n,i,o,s){var a=e.bootstrap4;s=s||"";var l=(i=$.extend({columns:!1},i)).columns;i.columns=!1,l&&(i.styles="bs-field-group-labels");var u=[],d={formGroup:"form-group"};return l&&!a&&(d.formGroup+=" form-horizontal"),r.utils.fieldWrapper(u,i,o,function(){u.push('<label id="{0}_label"');var e=["bs-label"];l&&(a?e.push("col-form-label"):e.push("checkbox-inline bs-cursor-d"),e.push("col-sm-12 bs-lib-col"),i.labelLeft&&e.push("text-left")),i.inline&&(a?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&u.push(' class="'+e.join(" ")+'"'),i.parentId&&u.push(' for="'+i.parentId+'_input"'),u.push(">"),u.push(t.escapeHtml(s||"")+(i.inline?"&nbsp;":"")),r.utils.addTooltipAndRule(u,i),u.push("</label>")},d),t.format(u.join(""),n)}(i.id,s,i.options.design,s.title)),i._state2UI()),i.appendElement(n,s),i.$element},s}(e.ui.AbsField);s.Label=a,n.registerControl(a,"meta",!1,"label",null)}(e.formlabel||(e.formlabel={}))}(Phoenix||(Phoenix={})),function(e){e.utils,e.ui;var t,n,i=e.dom,o=e.uiutils;e.ulocale;t=e.formlinkbase||(e.formlinkbase={}),n=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(t,e),t.prototype._button=function(){},t.prototype.click=function(e){this.state.isDisabled||(this._isBinded?this.form.execAction(this.$bind):this.fieldOptions.onChange&&this.fieldOptions.onChange())},t.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled,this.state.isDisabled?i.addClass(e,"disabled"):i.removeClass(e,"disabled")},t.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null,t=this._button();t&&(this._setDisabled(t,e),this.setHidden(e))},t.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n._button(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r))},t.prototype._renderButton=function(){return null},t.prototype.render=function(e){var t=this._initOptions(o.utils.defaultOptions);return this.$element||(this.$element=this._renderButton(),this._state2UI()),this.appendElement(e,t),this.$element},t}(e.ui.AbsField),t.LinkBase=n}(Phoenix||(Phoenix={})),function(e){var t=e.utils,n=e.ui,i=e.dom,o=e.uiutils,r=e.ulocale;!function(s){var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype._button=function(){return this.$element?this.renderOptions.inline?this.$element.get(0):this.$element.get(0).firstChild:null},n.prototype._renderButton=function(){return $(function(e,n,r,s){s=s||"",void 0!==(n=$.extend({right:!1,icon:null,type:"default",size:null},n)).title&&(s=n.title);var a=[];if(!n.inline){var l=["bs-island","bs-field-group"];r&&l.push("design"),a.push('<div class="'+l.join(" ")+'"'),o.utils.addContainerId(a,r),a.push(">")}return a.push('<button type="button"'),a.push(' class="bs-button btn btn-'+i.bootstrapStyles(n.outline||"secondary"===n.type||"default"===n.type)[n.type]),n.classButton&&a.push(" "+n.classButton.join("")),n.size&&a.push(" btn-"+n.size),n.inline?(a.push(" bs-btn-inline"),a.push(" bs-island"),n.right&&a.push(" float-right"),r&&a.push(" design")):a.push(" btn-block"),n.style&&a.push(" "+n.style),a.push('"'),n.inline&&o.utils.addContainerId(a,r),a.push(">"),n.icon&&!n.iconRight&&a.push('<span class="'+i.iconClass(n.icon)+'"></span>'),n.titleIsHidden||(n.icon&&!n.iconRight&&a.push("&nbsp;"),a.push(s||""),n.icon&&n.iconRight&&a.push("&nbsp;")),n.icon&&n.iconRight&&a.push('<span class="'+i.iconClass(n.icon)+'"></span>'),a.push("</button>"),n.inline||a.push("</div>"),t.format(a.join(""),e)}(this.id,this.renderOptions,this.options.design,r.tt(this.title,this.form.$locale)))},n}(e.formlinkbase.LinkBase);s.Link=a,n.registerLinkControl(a,"button")}(e.formlink||(e.formlink={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u,d,c;t=e.formlookup||(e.formlookup={}),(n=e).serial,i=n.ui,o=n.Observable.SchemaUtils,r=n.data,s=n.utils,a=e.gridlookup,l=n.dom,n.formedit,n.locale,u=function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey},d={autoComplete:!1,maxItems:-1},c=function(t){function n(n,i,o){var r=t.call(this,n,i,o)||this,s=r;return s.lookupOptions=d,s.eventBus=new e.serial.SingleEventBus(50),s.onselectItemHandler=s._onselectItem.bind(s),s.isEnum=s.$lookup&&s.$lookup.data&&"enum"===s.$lookup.data.$type,r}return __extends(n,t),n.prototype.customOptions=function(e){t.prototype.customOptions.call(this,e),e.after={icon:"chevron-down"},e.paginated=void 0!==e.paginated?e.paginated:o.supportPagination(this.$lookup)},n.prototype._value2Text=function(){return this.isEnum?function(e,t){if(""===e||null===e||void 0===e)return"";if(t&&t.data&&t.data.$value){for(var n=t.data.$value,i=0,o=n.length;i<o;i++){var r=n[i];if(r.code===e)return r.title}return e||""}return e||""}(this.state.value,this.$lookup):this.state.value||""},n.prototype._getSource=function(e){var t=this,n=t.form.getParentModel(t.$bind);if(!t.$lookup.data||!t.$lookup.data.$type)return s.dataAsPromise(null);if("inline"===t.$lookup.data.$type||"enum"===t.$lookup.data.$type){var i=(t.form,t.$lookup.data.$value);return s.dataAsPromise(function(e,t,n){if(e.value&&(e=e.value),t){var i=[],o=r.compileFilterTree(t,null,n,null);return e.forEach(function(e){r.acceptFilter(o,e)&&i.push(e)}),i}return e}(i,t.$lookup.data&&t.$lookup.data.$params?t.$lookup.data.$params.$filter:null,n.model(!0)))}return o.allData(t.$lookup)?t.$lookup.cache&&t.hasCachedData?s.dataAsPromise(t.cachedData):(e.containerId=t.form.syncTransactionId(),e.viewId=t.form.syncViewId(),o.executeLookup(t.$lookup,t.form.getParentModel(t.$bind),e)):(e.fieldName=t.$lookup.mapping[t.$display],e.paginated=!0,e.containerId=t.form.syncTransactionId(),e.viewId=t.form.syncViewId(),o.executeLookup(t.$lookup,t.form.getParentModel(t.$bind),e))},n.prototype._filterResult=function(e,t){var n=this;if(e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(t.findFirst&&n.$lookup.data&&n.$lookup.data.$params&&(n.$lookup.data.$params.$allData||"relation"===n.$lookup.data.$type)){var i=a.utils.checkGridLookup(n.$lookup,n.form.$model);return(r=o.findFirst(t.search,o.remoteSearch(o.lastSegment(n.$bind,n.$display),i),e.documents))?{value:[r.item]}:null}e.value=e.documents,delete e.documents}if(o.allData(n.$lookup)){if(n.$lookup.cache&&!n.hasCachedData&&(n.hasCachedData=!0,n.cachedData=e),t.findFirst&&!t.search)return null;if(t.search&&e&&e.value&&t.findFirst){var r;i=a.utils.checkGridLookup(n.$lookup,n.form.$model);return(r=o.findFirst(t.search,n.isEnum?"title":o.remoteSearch(o.lastSegment(n.$bind,n.$display),i),e.value))?{value:[r.item]}:null}}return e},n.prototype._findselected=function(e,t){if(t.search&&t.select&&e&&e.value){var n=a.utils.checkGridLookup(this.$lookup,this.form.$model),i=o.findFirst(t.search,this.isEnum?"title":o.remoteSearch(o.lastSegment(this.$bind,this.$display),n),e.value);if(i)return i.index}return-1},n.prototype._findValue=function(e,t){var n=this;if(e||""!==e){var i={search:e,select:!1,findFirst:!0,find:!1,paginated:n.renderOptions.paginated};n.eventBus.push(n._getSource(i),function(e){(e=n._filterResult(e,i))&&e.value&&e.value.length?t(e.value[0]):t(null)},!0)}else n.eventBus.push(null,function(e){t(null)},!0)},n.prototype._onselectItem=function(e){var t=this;t.eventBus.push(e,function(e){var n=Object.keys(t.$lookup.mapping),i=o.extractBase(t.$bind),r=[],s=!1;n.forEach(function(n){if(t.$lookup.mapping[n]){var o=t.form.getValue(i+n)||"",a=e&&e[t.$lookup.mapping[n]]||"";a!==o&&(t.form.setValue(i+n,a),s=!0)}else r.push(n)}),s&&r.forEach(function(e){t.form.setValue(i+e,t.$lookup.mapping[e])});var a=t._input();a.value!=t._value2Text()&&t._value2Input(a)},!0)},n.prototype._checkPopupMenu=function(){var t=this;if(!t.menu){var n=t._input(),i=t.$element;t.renderOptions.columns&&(i=$(t._colParent()));var r=a.utils.checkGridLookup(t.$lookup,t.form.$model);t.menu=new e.formdropitems.DropItems(i,n,{primaryKey:r.primaryKey,search:t.isEnum?"title":o.remoteSearch(o.lastSegment(t.$bind,t.$display),r),onselect:t.onselectItemHandler})}},n.prototype.mousedown=function(e){return this.menu&&this.menu.opened&&this.menu.inMenu(e.target)?(e.stopPropagation(),!1):t.prototype.mousedown.call(this,e)},n.prototype.stopProppagation=function(e){t.prototype.stopProppagation.call(this,e),this.menu&&this.menu.opened&&this.menu.inMenu(e.target)&&(e.preventDefault(),e.stopPropagation())},n.prototype.click=function(e){var t=this._input();l.isChildOf(t.parentNode.lastChild,e.target)?this.renderOptions.paginated?this._toggleGridLookup():this._toggleMenuLookup():this.menu&&this.menu.opened&&this.menu.inMenu(e.target)&&this.menu.click(e)},n.prototype.beforeAppend=function(){},n.prototype._searchText=function(){var e=this._input(),t=this._text2value(e.value);return this.equals(t)?"":t},n.prototype._managePreventDefault=function(e,t){var n;switch(e){case l.keys.VK_UP:case l.keys.VK_PGDOWN:case l.keys.VK_PGUP:case l.keys.VK_HOME:case l.keys.VK_END:n=!u(t);break;case l.keys.VK_DOWN:t.ctrlKey?(n=!0,e=l.keys.VK_F4):n=!u(t);break;default:n=!1}return n&&t.preventDefault()&&t.stopPropagation(),e},n.prototype._shouldTrigger=function(e,t){var n=!1;switch(e){case l.keys.VK_TAB:n=!u(t);break;default:n=!0}return n},n.prototype.setEvents=function(e){var t=this;$(t._input()).on("input",function(){t.inputChanged()})},n.prototype.removeEvents=function(){$(this._input()).off("input")},n.prototype.inputChanged=function(){var e=this._input();this.modified=e.value!=this._value2Text(),this._triggerEvent("inputChanged",null)},n.prototype.checkValue=function(e,t){var n=this,i=n._input();i.value!=n._value2Text()?n._findValue(i.value,function(e){n._onselectItem(e)}):t(n.state.value)},n.prototype.keydown=function(e){var t=e.which||e.keyCode;return(t=this._managePreventDefault(t,e))&&this._shouldTrigger(t,e)&&this._triggerKey(t,e),!0},n.prototype.focusIn=function(e){},n.prototype.focusOut=function(e){a.utils.closeGridLookup(this,this.eventBus,"gc"),this._closeMenuLookup(),t.prototype.focusOut.call(this,e)},n.prototype._triggerEvent=function(e,t){var n=this,i=n._input();if(n.menu&&n.menu.opened)switch(e){case"inputChanged":var o={search:i.value,select:!0,find:!1,findFirst:!1};this.eventBus.push(n._getSource(o),function(e){if(n.menu&&n.menu.opened){o.search=i.value,e=n._filterResult(e,o);var t=-1;o.select&&(t=n._findselected(e,o)),n.menu.show(e,t,!0)}},!1)}},n.prototype._checkGridPopup=function(){var e=this._input(),t=this.$element.get(0);this.renderOptions.columns&&(t=this._colParent()),this.gc=a.utils.checkGridPopup(this,this.$lookup,e,t)},n.prototype.focusInControl=function(e){var n=t.prototype.focusInControl.call(this,e);return!n&&this.gc&&this.gc.opened?this.gc.focusInCombo(e):n},n.prototype._openGridLookup=function(){var e=this;if(!e.gc||!e.gc.opened){e._checkGridPopup();var t=a.utils.checkGridLookup(e.$lookup,e.form.$model);a.utils.openGridLookup(e,{lookup:t,parentControl:e,formControl:e.form,display:e.$display,bind:e.$bind,containerId:e.form.syncTransactionId(),viewId:e.form.syncViewId(),align:e.id+"_group",openerId:e.id+"_after",searchText:e._searchText(),onselect:e.onselectItemHandler,lookupColumns:e.fieldOptions?e.fieldOptions.lookupColumns:void 0,propertyName:"gc",minWidth:e.fieldOptions?e.fieldOptions.lookupMinWidth:0})}},n.prototype._toggleGridLookup=function(){this.gc&&this.gc.opened?a.utils.closeGridLookup(this,this.eventBus,"gc"):this.gc&&this.gc.opened||this._openGridLookup()},n.prototype._closeMenuLookup=function(){var e=this;e.menu&&e.menu.opened&&e.eventBus.push(null,function(t){e.menu&&e.menu.opened&&e.menu.hide(null)},!0)},n.prototype._toggleMenuLookup=function(){var e=this,t=e._input();if(e.menu&&e.menu.opened)e.menu&&e.menu.opened&&e._closeMenuLookup();else{e._checkPopupMenu();var n={search:t.value,select:!0,find:!1,findFirst:!1};e.eventBus.push(e._getSource(n),function(t){t=e._filterResult(t,n);var i=-1;n.select&&(i=e._findselected(t,n)),e.menu.show(t,i,!1)},!0)}},n.prototype._triggerKey=function(e,t){var n=this;if(n.menu&&n.menu.opened)switch(e){case l.keys.VK_ESCAPE:n.eventBus.push(null,function(e){n._closeMenuLookup()},!0);break;case l.keys.VK_ENTER:n.eventBus.push(null,function(e){n.menu.select()},!0);break;case l.keys.VK_UP:n.eventBus.push(null,function(e){n.menu.move(-1)},!0);break;case l.keys.VK_DOWN:n.eventBus.push(null,function(e){n.menu.move(1)},!0);break;case l.keys.VK_HOME:n.eventBus.push(null,function(e){n.menu.move(-1e3)},!0);break;case l.keys.VK_END:n.eventBus.push(null,function(e){n.menu.move(1e3)},!0);break;case l.keys.VK_PGDOWN:n.eventBus.push(null,function(e){n.menu.move(7)},!0);break;case l.keys.VK_PGUP:n.eventBus.push(null,function(e){n.menu.move(-7)},!0)}e===l.keys.VK_F4&&(n.renderOptions.paginated?n._toggleGridLookup():n._toggleMenuLookup())},n.prototype.destroy=function(){var e=this;e.onselectItemHandler=null,e.cachedData=null,e.eventBus&&(e.eventBus.destroy(),e.eventBus=null),e.menu&&(e.menu.destroy(),e.menu=null),e.gc&&(e.gc.destroy(),e.gc=null),t.prototype.destroy.call(this)},n.prototype.checkFocus=function(e){var t=this;s.nextTick(function(){var e=window.document.activeElement;e&&t.targetInControl(e)||(t.focusOut(null),t.focused=!1)})},n}(e.formedit.Edit),t.Lookup=c,i.registerControl(c,"string",!1,"",{lookup:!0}),i.registerControl(c,"number",!1,"",{lookup:!0}),i.registerControl(c,"integer",!1,"",{lookup:!0})}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l,u;e.multifield||(e.multifield={}),t=e.ui,n=e.utils,i=e.uiutils,o=e.dom,r=e.locale,s=e.Observable.SchemaUtils,a=e.ulocale,t=e.ui,l=function(e,t,r,s,a,l){l=l||"";var u=[];return(t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t)).titleIsHidden&&(t.columns=!1),t.placeHolder=!1,i.utils.fieldWrapper(u,t,a,function(){if(!t.titleIsHidden){u.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&u.push(' class="'+e.join(" ")+'"'),u.push(">"),u.push(n.escapeHtml(l||"")+(t.inline?"&nbsp;":"")),i.utils.addTooltipAndRule(u,t),u.push("</label>")}t.columns&&u.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'" id="{0}_colparent">'),u.push('<div class="input-group" id="{0}_group"');var a,d,c,p=[];t.minWidth&&p.push("min-width: "+t.minWidth+";"),t.maxWidth&&p.push("max-width: "+t.maxWidth+";"),p.length&&u.push('  style="'+p.join("")+'"'),u.push(">"),d=r,c=s,(a=u).push('<div class="input-group-prepend" tabindex="-1">'),a.push('<button id="{0}_select" class="btn btn-'+o.bootstrapStyles(!1).info+' dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>'),a.push('<div class="dropdown-menu">'),d.forEach(function(e,t){a.push('<a class="dropdown-item" data-select="'+d[t]+'" href="#">'),a.push(n.escapeHtml(c[t])),a.push("</a>")}),a.push("</div>"),a.push("</div>"),t.readOnly?u.push('<div id="{0}_input" class="form-control"></div>'):u.push('<input type="text" id="{0}_input" class="form-control">'),u.push("</div>"),i.utils.addErrorDiv(u),t.columns&&u.push("</div>"),t.titleIsHidden&&i.utils.addTooltipAndRule(u,t)}),n.format(u.join(""),e)},u=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this,r=o;return r._state(),r._stateOfField(),r.renderOptions.useBind&&(r.renderOptions.field=r.form.getValue(r.$bind)),r.renderOptions.field?(r.form.registerListenerFor(r.renderOptions.field,r),r._schemaField=r.form.getSchema(r.renderOptions.field)):r._schemaField=null,o}return __extends(t,e),t.prototype.destroy=function(){this._removePlugins(),this.renderOptions.field&&this.form.unRegisterListenerFor(this.renderOptions.field,this),e.prototype.destroy.call(this)},t.prototype._changeField=function(e){var t=this;t.renderOptions.field&&t.form.unRegisterListenerFor(t.renderOptions.field,t),t.renderOptions.field=e,t.renderOptions.field?(t.form.registerListenerFor(t.renderOptions.field,t),t._schemaField=t.form.getSchema(t.renderOptions.field)):t._schemaField=null,t._stateOfField(),t._afterFieldChanged()},t.prototype._isDate=function(){return this._schemaField&&s.isDate(this._schemaField)},t.prototype._isDateTime=function(){return this._schemaField&&s.isDateTime(this._schemaField)},t.prototype._isMemo=function(){return this._schemaField&&s.isText(this._schemaField)},t.prototype._isNumber=function(){return this._schemaField&&s.isNumber(this._schemaField)},t.prototype._schemaInput=function(){return this._schemaField},t.prototype._afterIcon=function(){if(this._isDate()){if(this.renderOptions.readOnly)return null;if(i.utils.useDatePicker())return{icon:"calendar"}}else if(this._isDateTime()){if(this.renderOptions.readOnly)return!0;if(i.utils.useDateTimePicker())return{icon:"calendar"}}else if(this._isNumber()&&this._stateField.symobol)return{value:this._stateField.symobol};return null},t.prototype._removePlugins=function(){!this.renderOptions.readOnly&&this.$element&&(i.utils.useDateTimePicker()&&i.utils.dateTimePickerDestroy($(o.find(this.$element.get(0),this.id+"_group"))),i.utils.useDatePicker()&&i.utils.datePickerDestroy(this.$element))},t.prototype._removeAfter=function(){var e=this.$element?this.$element.get(0):null;if(e){var t=o.find(e,this.id+"_after");t&&o.remove(t)}},t.prototype._updateType=function(){this._removeAfter();var e,t,i,r=this._afterIcon(),s=this._input();this.$element.get(0);if(this._isNumber()?o.addClass(s,"bs-edit-number"):o.removeClass(s,"bs-edit-number"),r){var a=(e=this.id,t=r,(i=[]).push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-append input-group-addon'),t.icon&&i.push(" bs-icon-input"),i.push('">'),i.push('<span class="input-group-text">'),t.icon?i.push('<span class="'+o.iconClass(t.icon)+'"></span>'):i.push(t.value),i.push("</span>"),i.push("</span>"),$(n.format(i.join(""),e)).get(0));o.after(s,a)}},t.prototype._setPlugins=function(){var e=this;if(!e.renderOptions.readOnly&&e.$element){var t=o.find(e.$element.get(0),e.id+"_select");e._isDate()&&i.utils.useDatePicker()?(t&&o.removeClass(t,"btn"),i.utils.datePickerInitialize(e.$element,{showOnFocus:!1},function(t){e.focusOut(null)}),t&&o.addClass(t,"btn")):e._isDateTime()&&i.utils.useDateTimePicker()&&(t&&o.removeClass(t,"btn"),i.utils.dateTimePickerInitialize($(o.find(e.$element.get(0),e.id+"_group")),{},function(t){e.focusOut(null)}),t&&o.addClass(t,"btn"))}},t.prototype.focusOut=function(e){this._schemaField&&!this.renderOptions.readOnly&&this._input2Model(!0)},t.prototype._text2value=function(e){return i.utils.text2value(e,this._schemaInput(),this._stateField)},t.prototype.checkValue=function(e,t){t(e)},t.prototype._input=function(){var e=this.$element?this.$element.get(0):null;return e?o.find(e,this.id+"_input"):null},t.prototype._input2Model=function(e){var t=this,n=t._input(),i=t._text2value(n.value),o=t._schemaInput();t._equals(i)?(t._isNumber()||t._isDate()||t._isDateTime())&&t._value2Input(n):t.checkValue(i,function(i){t.state.value!==i?(""===i&&"string"===o.type&&(i=void 0),t._internalSetValue(i,e)):t._value2Input(n)})},t.prototype.updateModel=function(){this.form.setValue(this.renderOptions.field,this._stateField.value)},t.prototype._internalSetValue=function(e,t){var n=this;n._searchEventBus?n._searchEventBus.push(null,function(t){n._stateField.value=e,n.updateModel()},t):(n._stateField.value=e,n.updateModel())},t.prototype._afterFieldChanged=function(){this._removePlugins(),this._updateType(),this._setPlugins();this.$element&&this.$element.get(0);var e=this._input();e&&this._value2Input(e)},t.prototype._stateOfField=function(){var e=this;if(e._stateField=e._stateField||{},e.renderOptions.field){var t=e.form.getState(e.renderOptions.field);e._stateField.value=e.form.getValue(e.renderOptions.field),Object.keys(t).forEach(function(n){e._stateField[n]=t[n]})}else e._stateField.value=void 0},t.prototype.changed=function(e,t,n,i,o){var r=this;if(e===r.$bind)r.state.value!==n&&(r._changedBind(t,n,i,o),r.state.value=n);else if(r.renderOptions.field&&e===r.renderOptions.field)if(r._stateField.value!==n)r._stateField.value=n,r._value2Input(r._input());else if(!r.renderOptions.readOnly&&r._schemaField&&!r._schemaField.enum){var s=r._input();s.value!==r._value2Text()&&r._value2Input(s)}},t.prototype.stateChanged=function(e,t){},t.prototype._changedBind=function(e,t,n,i){this._setSelectValue(t)},t.prototype._changedField=function(e,t,n,i){},t.prototype._select=function(){return this.$element?o.find(this.$element.get(0),this.id+"_select"):null},t.prototype.canEdit=function(){var e=this._stateField;return!(e.isHidden||e.isDisabled||e.isHidden||this.renderOptions.readOnly)},t.prototype._setSelectValue=function(e){var t=this._select();if(t){if(void 0===e||null===e)e="";else{var n=this.$schema.enum.indexOf(e);e=n>=0?this.$schema.enumNames[n]:""}""===e&&(e=String.fromCharCode(160)),o.text(t,e)}},t.prototype._ignoreKeys=function(e,t){return e.which===o.keys.VK_TAB||e.which!==o.keys.VK_DELETE&&(!(!t&&e.which===o.keys.VK_BACKSPACE)&&(t?0===e.which||o.arrowKeys.indexOf(e.which)>=0:o.ignoreKeys.indexOf(e.which)>=0||o.arrowKeys.indexOf(e.which)>=0))},t.prototype.keypress=function(e){var t=this;if(!t._schemaField||t.renderOptions.readOnly)return!0;var n=t._stateField;if(n.isReadOnly||n.isDisabled)return!0;var o=t._input();if(t._ignoreKeys(e,!0))return!0;var s=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===i.utils.keyPressNumber(e,o,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:s}))return!1}else if(t._isDate()&&!1===i.utils.keyPressDate(e,o,{sep:r.date.daySep,format:r.date.dateShort,schema:s}))return!1;return!0},t.prototype._afterEnter=function(){this._input2Model(!0),this.renderOptions&&this.renderOptions.after&&this.renderOptions.after.$bind&&this.form.execAction(this.renderOptions.after.$bind,this.state.value)},t.prototype.keydown=function(e){var t=this;if(!t._schemaField||t.renderOptions.readOnly)return!0;var n=t._stateField;if(n.isReadOnly||n.isDisabled)return!0;var s=t._input();if(t._ignoreKeys(e,!1))return e.which===o.keys.VK_ENTER&&t._afterEnter(),!0;var a=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===i.utils.keyDownNumber(e,s,{decimalSep:r.number.decimal,thousandSep:r.number.thousand,places:t.state.decimals,schema:a}))return!1}else if(t._isDate()&&!1===i.utils.keyDownDate(e,s,{sep:r.date.daySep,format:r.date.dateShort,schema:a}))return!1;return!0},t.prototype._equals=function(e){var t=this._schemaInput(),n=this._stateField.value===e;return!n&&void 0===this._stateField.value&&"string"===t.type&&""===e||n},t.prototype._state2UI=function(){this.$element&&(this._setSelectValue(this.state.value),this._afterFieldChanged())},t.prototype.setFocus=function(e){if(this.canEdit()){var t=this._input();t&&t.focus()}},t.prototype.click=function(e){var t=e.target;"#"===(o.attr(t,"data-phoenix-href")||o.attr(t,"href"))&&e.preventDefault();var n=o.attr(e.target,"data-select");n&&(this.form.setValue(this.$bind,n),this.canEdit()&&this.setFocus()),this.canEdit()},t.prototype.render=function(e){var t=this,n=t._initOptions(i.utils.defaultOptions);if(!t.$element){n.title=a.tt(t.$schema.title,t.form.$locale),t.$schema.description&&(n.description=a.tt(t.$schema.description,t.form.$locale));var o=t.$schema.enumNames||t.$schema.enum;o=o.map(function(e){return a.tt(e+"",t.form.$locale)}),t.$element=$(l(t.id,n,t.$schema.enum,o,t.options.design,n.title)),t._state2UI(),t.setEvents(n)}return t.appendElement(e,n),t.$element},t.prototype._value2Text=function(){var e=this._stateField.value;this._input();return this._isNumber()?s.value2Text(e,this._schemaField,this._stateField):this._isDate()?i.utils.useDatePicker()?a.parseISODate(e||"")||"":a.shortDate(e||""):this._isDateTime()?i.utils.useDateTimePicker()?a.parseISODateTime(e||"")||"":a.shortDateTime(e||""):e||""},t.prototype._value2Input=function(e){var t=this,n=t._stateField.value;t.renderOptions.readOnly?t._isDate()?o.text(e,a.shortDate(n||"")||String.fromCharCode(160)):t._isDateTime()?o.text(e,a.shortDateTime(n||"")||String.fromCharCode(160)):(t._isNumber(),o.text(e,t._value2Text()||String.fromCharCode(160))):t._isDate()?i.utils.useDatePicker()?i.utils.datePickerSetValue(t.$element,n):e.value=a.shortDate(n||""):t._isDateTime()?i.utils.useDateTimePicker()?i.utils.dateTimePickerSetValue($(o.find(t.$element.get(0),t.id+"_group")),n):e.value=a.shortDateTime(n||""):(t._isNumber(),e.value=t._value2Text())},t}(e.ui.AbsField),t.registerControl(u,"*",!0,"multifield",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a;e.multivalue||(e.multivalue={}),t=e.ui,n=e.utils,e.formedit,i=e.uiutils,o=e.dom,e.locale,e.Observable.SchemaUtils,r=e.ulocale,t=e.ui,s=function(e,t,i){return $(n.format(' <span id="{0}" class="bs-tag badge badge-info">{1}<span data-close-id="{0}" class="bs-tag-close" aria-hidden="true">&times;</span></span>',e.$id,t)).get(0)},a=function(e){function t(t,n,i){var o;t.options&&!t.options.field||console.log("Invalid multivalue Field options.field is missing");var r=o=e.call(this,t,n,i)||this;return r._schemaInputField=i.getSchema(r.$bind+"."+t.options.field),o}return __extends(t,e),t.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype._setReadOnly=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype.changed=function(e,t,n,i,o){var r=this,s=!1;if(r.$element&&!(e.substr(r.$bind.length).indexOf(".$selected")>=0)){switch(o.checkChildren&&"propchange"===i&&e===r.$bind&&(s=!0,r.state.value=r.form.getValue(r.$bind)),r.state.value||(i="none"),i){case"propchange":e===r.$bind&&(s=!0);break;case"add":r._addTag(o.$value);break;case"remove":r._removeTag(o.$id)}s&&r._renderAllItems()}},t.prototype._removeTag=function(e){var t=o.find(this.$element.get(0),e);t&&o.remove(t)},t.prototype._addTag=function(e){var t=this._input(),n=s(e,e[this.renderOptions.field]);o.before(t,n)},t.prototype._renderAllItems=function(){for(var e=this,t=e._input(),n=this.state.value,i=t.parentNode;i.firstChild!==t;)i.removeChild(i.firstChild);n.forEach(function(n,i,r){var a=s(n,n[e.renderOptions.field]);o.before(t,a)})},t.prototype._state2UI=function(){e.prototype._state2UI.call(this),this._renderAllItems()},t.prototype.stateChanged=function(t,n){this.form.getState(this.$bind);e.prototype.stateChanged.call(this,t,n)},t.prototype.canEdit=function(){var e=this.state;return!(e.isHidden||e.isDisabled||e.isHidden||this.renderOptions.readOnly)},t.prototype.mousedown=function(e){return this.setFocus(),!0},t.prototype.setFocus=function(e){if(this.canEdit()){var t=this._input();t&&n.nextTick(function(){t.focus()})}},t.prototype._input2Model=function(e){var t=this,n=t._input(),i=t._text2value(n.value).trim()||"";""!==i&&t.checkValue(i,function(e){if(i){var o={$create:!0};o[t.renderOptions.field]=i,t.state.value.push(o)}n.value=""})},t.prototype.click=function(e){if(this.canEdit()){var t=o.attr(e.target,"data-close-id");if(t){var n=this.state.value,i=n.findById(t);return i&&n.remove(i),void this.setFocus()}}},t.prototype.render=function(e){var t=this,s=t._initOptions(i.utils.defaultOptions);return t.$element||(s.title=r.tt(t.$schema.title,t.form.$locale),t.$schema.description&&(s.description=r.tt(t.$schema.description,t.form.$locale)),t.$element=$(function(e,t,r,s){s=s||"";var a=[];return(t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t)).titleIsHidden&&(t.columns=!1),t.placeHolder=!1,i.utils.fieldWrapper(a,t,r,function(){if(!t.titleIsHidden){a.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&a.push(' class="'+e.join(" ")+'"'),a.push(">"),a.push(n.escapeHtml(s||"")+(t.inline?"&nbsp;":"")),i.utils.addTooltipAndRule(a,t),a.push("</label>")}if(t.columns&&a.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'">'),t.readOnly){a.push('<div class="bs-mv-container form-control bs-read-only'),t.size&&a.push(" form-control-"+t.size),a.push('" id="{0}_array"');var r=[];t.maxWidth&&r.push("max-width: "+t.maxWidth+";"),t.minWidth&&r.push("min-width: "+t.minWidth+";"),r.length&&a.push(' style="'+r.join("")+'"'),a.push(">"),a.push('<input type="text" id="{0}_input" class="bs-tag-input">'),a.push("</div>")}else{if(t.after){a.push('<div class="input-group" id="{0}_group"');var l=[];t.minWidth&&l.push("min-width: "+t.minWidth+";"),t.maxWidth&&l.push("max-width: "+t.maxWidth+";"),l.length&&a.push('  style="'+l.join("")+'"'),a.push(">")}if(a.push('<div class="bs-mv-container form-control'),!t.after){var u=[];t.minWidth&&u.push("min-width: "+t.minWidth+";"),t.maxWidth&&u.push("max-width: "+t.maxWidth+";"),u.length&&a.push('  style="'+u.join("")+'"')}t.size&&a.push(" form-control-"+t.size),a.push('" id="{0}_array"'),r=[],t.maxWidth&&r.push("max-width: "+t.maxWidth+";"),t.minWidth&&r.push("min-width: "+t.minWidth+";"),r.length&&a.push(' style="'+r.join("")+'"'),a.push(">"),a.push('<input type="text" id="{0}_input" class="bs-tag-input">'),a.push("</div>"),t.after&&(a.push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-append input-group-addon'),t.after.icon&&a.push(" bs-icon-input"),a.push('">'),a.push('<span class="input-group-text">'),t.after.icon?a.push('<span class="'+o.iconClass(t.after.icon)+'"></span>'):a.push(t.after.value),a.push("</span>"),a.push("</span>"))}i.utils.addErrorDiv(a),t.columns&&a.push("</div>"),t.titleIsHidden&&i.utils.addTooltipAndRule(a,t)}),n.format(a.join(""),e)}(t.id,s,t.options.design,s.title)),t._state2UI(),t.setEvents(s)),t.appendElement(e,s),t.$element},t.prototype._value2Input=function(e){},t}(e.formedit.Edit),t.registerControl(a,"array",!1,"multivalue",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,o=e.utils,r=e.ui,s=e.dom,a=(e.device,e.uiutils),l=e.Observable,u=e.data.odata,d=l.DataUtils,c=e.ulocale;e.formpicture||(e.formpicture={}),t=function(t){function n(e,n,i){var o=t.call(this,e,n,i)||this;return o._state(),o}return __extends(n,t),n.prototype._setDisabled=function(e){},n.prototype._setReadOnly=function(e){this._setDisabled(e)},n.prototype._setMandatory=function(e){},n.prototype._state2UI=function(){var e=this._img(),t=this.$element?this.$element.get(0):null;e&&(this._showValue(this.state.value),this._setDisabled(t),this._setReadOnly(t),this.setHidden(t))},n.prototype._showValue=function(e){},n.prototype.changed=function(e,t,n,i){this._img();this.state.value!==n&&(this.state.value=n,this._showValue(this.state.value))},n.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o))},n.prototype._img=function(){var e=this.$element.get(0);return e?s.find(e,this.id+"_img"):null},n.prototype._altimg=function(){var e=this.$element.get(0);return e?s.find(e,this.id+"_alt"):null},n.prototype.render=function(t){var n,i,r,l,u,d,p=this,h=p._initOptions(a.utils.defaultOptions);return p.$element||(h.title=c.tt(p.$schema.title,p.form.$locale),p.$element=$((n=p.id,i=h,r=p.options.design,l=h.title,u=p.editable,d=[],l=l||"",a.utils.fieldWrapper(d,i,r,function(){var t=e.bootstrap4;if(!i.titleIsHidden){d.push('<label id="{0}_label"');var n=["bs-label"];i.columns&&(t?n.push("col-form-label"):n.push("checkbox-inline bs-cursor-d"),n.push("bs-lib-col col-sm-"+i.labelCol),i.labelLeft&&n.push("text-left")),i.inline&&(t?n.push("form-check-inline"):n.push("checkbox-inline"),n.push("bs-cursor-d no-x-padding")),n.length&&d.push(' class="'+n.join(" ")+'"'),d.push(">"),d.push(o.escapeHtml(l||"")+(i.inline?"&nbsp;":"")),a.utils.addTooltipAndRule(d,i),d.push("</label>")}i.columns&&d.push('<div class="no-x-padding col-sm-'+(12-i.labelCol)+'">'),i.inline?d.push('<span id="{0}_alt" class="bs-no-image">'):d.push('<div id="{0}_alt" class="bs-no-image">'),u&&d.push('<input id="{0}_upload" class="bs-hidden-file" accept="image/*" type="file" />');var r=["bs-none bs-relative"];i.inline||r.push(t?"img-fluid":"img-responsive"),d.push('<img id="{0}_img" class="'),d.push(r.join(" ")),d.push('"/>'),u&&d.push('<div id="{0}_remove" class="bs-rt-button bs-image-remove bs-none"><span class="'+s.iconClass("times-circle")+'"></span></div>'),i.inline?d.push("</span>"):d.push("</div>"),i.columns&&d.push("</div>")},null),o.format(d.join(""),n))),p._state2UI(),p.setEvents(h)),p.appendElement(t,h),p.$element},n}(e.ui.AbsField),n=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o.editable=!0,o}return __extends(t,e),t.prototype._createImage=function(e){var t=this,n=e.target.files;if(n&&n.length){var i=n[0];if(!i.type.match("image.*"))return;var o=window.URL||window.webkitURL;if(o){var r={id:t.state.value?t.state.value.id:void 0,fileName:i.name,value:"",url:t.state.value?t.state.value.url:void 0,contentType:i.type};if("image/svg+xml"===i.type){var a=new FileReader;a.onload=function(e){r.value=a.result,t.form.setValue(t.$bind,r),s.processing(!1)},s.processing(!0),a.readAsDataURL(i)}else{var l=document.createElement("img"),u=document.createElement("canvas");s.processing(!0),l.src=o.createObjectURL(i),l.onload=function(){var e=1,n=l.width*l.height;n>12e5?e=2:n>24e5?e=4:n>4e6&&(e=8),u.width=l.width/e,u.height=l.height/e,u.getContext("2d").drawImage(l,0,0,u.width,u.height),r.value=u.toDataURL(),t.form.setValue(t.$bind,r),s.processing(!1)}}}}},t.prototype._removeImage=function(){var e={id:this.state.value?this.state.value.id:void 0,value:""};this.form.setValue(this.$bind,e)},t.prototype.click=function(e){if(!this.state.isDisabled&&!this.state.isReadOnly){var t=this.id+"_remove";if(e.target.id===t||e.target.parentNode.id===t)this._removeImage();else this._upload().click()}},t.prototype._upload=function(){var e=this.$element.get(0);return e?s.find(e,this.id+"_upload"):null},t.prototype.setEvents=function(e){var t=this,n=t._upload();n&&$(n).on("change",function(e){t._createImage(e)})},t.prototype.removeEvents=function(){var e=this._upload();e&&$(e).off("change")},t.prototype._setDisabled=function(e){this._upload().disabled=this.state.isDisabled||this.state.isReadOnly,this._showRemoveImage(this.state.value)},t.prototype._showRemoveImage=function(e){var t=!this.state.isHidden&&!this.state.isDisabled&&!this.state.isReadOnlyd;t&&(t=e&&(e.url||e.value));var n=this._rmv();n&&(t?s.removeClass(n,"bs-none"):s.addClass(n,"bs-none"))},t.prototype._rmv=function(){var e=this.$element.get(0);return e?s.find(e,this.id+"_remove"):null},t.prototype._showValue=function(e){var t=this._img(),n=this._altimg();if(t){var i=!1;if(e)if(void 0!==e.value)e.value?(t.src=e.value,i=!0):t.src="";else if(e.url){if(e.url.indexOf("{{baseUrl}}")>=0){var r=d.extractMainDataSource(this.form.$model);r||(r={$module:this.renderOptions.$module,$context:this.renderOptions.$context});u.baseUrl(r);var a=o.execAngularExpression(e.url,{baseUrl:u.baseUrl(r)||""});t.src=u.addImageUrlToken(a)}else t.src="";i=!0}else t.src="";else t.src="";i?(s.removeClass(t,"bs-none"),s.removeClass(n,"bs-no-image")):(s.addClass(t,"bs-none"),s.addClass(n,"bs-no-image")),this._showRemoveImage(e)}},t}(t),i=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o.editable=!1,o}return __extends(t,e),t.prototype._showValue=function(e){var t=this._img(),n=this._altimg();if(t){var i=!1;e&&(t.src=e,i=!0),i?(s.removeClass(t,"bs-none"),s.removeClass(n,"bs-no-image")):(s.addClass(t,"bs-none"),s.addClass(n,"bs-no-image"))}},t}(t),r.registerControl(n,"string",!1,"",{format:"stream"}),r.registerControl(i,"string",!1,"imageurl",{})}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r;e.radiogroup||(e.radiogroup={}),t=e.utils,n=e.ui,e.dom,e.groupctrl,i=e.ulocale,o=e.uiutils,r=function(e){function n(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(n,e),n.prototype._state2UI=function(){e.prototype._state2UI.call(this,function(e){e.checked=!0})},n.prototype.changed=function(t,n,i,o){if(this.state.value!=i){this.state.value=i;var r=this.$schema.enum.indexOf(this.state.value),s=e.prototype._item.call(this,r);s&&(s.checked=!0)}},n.prototype.render=function(e){var n=this,r=n._initOptions(o.utils.defaultOptions);if(!n.$element){var s=n.$schema.enumNames||n.$schema.enum;s=s.map(function(e){return i.tt(e,n.form.$locale)}),n.$schema.description&&(r.description=i.tt(n.$schema.description,n.form.$locale)),n.$element=$(function(e,n,i,r,s,a){r=r||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,horizontal:!1},n);var l=[];return o.utils.fieldWrapper(l,n,i,function(){if(!n.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];n.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&e.push("text-left")),n.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&l.push(' class="'+e.join(" ")+'"'),l.push(">"),l.push(t.escapeHtml(r||"")+(n.inline?"&nbsp;":"")),o.utils.addTooltipAndRule(l,n),l.push("</label>"),!n.inline&&n.horizontal&&l.push("<div></div>")}n.columns&&l.push('<div class="no-x-padding  col-sm-'+(12-n.labelCol)+'">');var i=n.inline||n.horizontal;s.forEach(function(e,n){l.push('<div class="custom-control custom-radio'+(i?" custom-control-inline":"")+'">'),l.push('<input class="custom-control-input" type="radio" name="{0}_input" id="{0}_item_'+n+'" value="'+e+'">'),l.push('<label class="custom-control-label" for="{0}_item_'+n+'">'),l.push(t.escapeHtml(a[n]||"")),l.push("</label>"),l.push("</div>")}),o.utils.addErrorDiv(l),n.columns&&l.push("</div>")},null),t.format(l.join(""),e)}(n.id,r,n.options.design,i.tt(n.$schema.title,n.form.$locale),n.$schema.enum,s)),n.setEvents(r),n._state2UI()}return n.appendElement(e,r),n.$element},n}(e.groupctrl.Group),n.registerControl(r,"*",!0,"radio",null)}(Phoenix||(Phoenix={})),function(e){var t;!function(t){var n=e.utils,i=e.ui,o=e.dom,r=e.ulocale,s=e.uiutils;var a=function(t){function i(e,i,o){var s=t.call(this,e,i,o)||this,a=s;return a._map=[],e.options&&e.options.$expression?(a.$expression=e.options.$expression,n.extractAngularVars(a.$expression,a._map)):(a.$expression=n.format("{0}: {{{1}}}",n.escapeHtml(r.tt(a.$schema.title,a.form.$locale)),a.$bind),a._map.push({name:a.$bind})),a._map.forEach(function(e){e.name!=a.$bind?(e.schema=o.getSchema(e.name),a.form.registerListenerFor(e.name,a)):e.schema=a.$schema}),s._state(),s}return __extends(i,t),i.prototype._state=function(){var e=this;e.state=e.state||{},e.state.values=e.state.values||{},e.state.fvalues=e.state.fvalues||{};var t=e.form.getState(e.$bind);e.state.isHidden=t.isHidden,e._refreshValues()},i.prototype._refreshValues=function(){var e=this;e._map.forEach(function(t){e.state.values[t.name]=e.form.getValue(t.name);var n=e.form.getState(t.name);e.state.fvalues[t.name]=s.utils.displayValue(e.state.values[t.name],t.schema,e.form.$locale,{html:!1,useSymbol:!0,state:n},e.state.values,t.name).value})},i.prototype._value2UI=function(){var e=this.$element?this.$element.get(0):null,t=n.execAngularExpression(this.$expression,this.state.fvalues,!0),i=$("<div>"+n.escapeHtml(t)+"</div>").get(0);for(o.empty(e);i.childNodes.length>0;)e.appendChild(i.childNodes[0])},i.prototype._findMap=function(e){for(var t=0,n=this._map.length;t<n;t++){var i=this._map[t];if(i.name===e)return i}return null},i.prototype.changed=function(e,t,n,i){this._refreshValues(),this._value2UI()},i.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.symbol!==n.state.symbol&&(i.symbol=n.state.symbol),i.decimals!==n.state.decimals&&(i.decimals=n.state.decimals)},i.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this.setHidden(e),this._value2UI())},i.prototype.render=function(t){var i=this,o=i._initOptions(s.utils.defaultOptions);return i.$element||(i.$element=$(function(t,i,o,r,a){r=r||"",i.styles=i.styles?i.styles:e.bootstrap4?"form-control-plaintext":"form-control-static",i=$.extend({titleIsHidden:!1},i);var l=[];return s.utils.fieldWrapper(l,i,o,function(){l.push('<div style="background-color: red;">'+r+"</div>")}),n.format(l.join(""),t)}(i.id,o,i.options.design,r.tt(i.$schema.title,i.form.$locale))),i._state2UI()),i.appendElement(t,o),i.$element},i.prototype.destroy=function(){var e=this;e._map.forEach(function(t){t.name!=e.$bind&&e.form.unRegisterListenerFor(t.name,e)}),t.prototype.destroy.call(this)},i}(e.ui.AbsField);t.ReadOnlyField=a,i.registerControl(a,"*",!1,"",{readOnly:!0})}(t||(t={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r;t=e.search||(e.search={}),(n=e).formedit,i=n.dom,n.locale,o=n.ui,r=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this,r=o;return r._searchField=t.options.search,r._query=r.form.getValue(r._searchField),o}return __extends(t,e),t.prototype.updateModel=function(){this._query.search=this.state.value},t.prototype.destroy=function(){this._query=null,e.prototype.destroy.call(this)},t.prototype.keyup=function(e){this._input();return!!this._ignoreKeys(e,!0)||(this.state.isReadOnly||this.state.isDisabled,this.customKeyUp(e),!0)},t.prototype.customKeyUp=function(e){var t=this;t._incremental&&(window.clearTimeout(t._incremental),delete t._incremental),t._incremental=window.setTimeout(function(){delete t._incremental,t._input2Model(!1)},0)},t.prototype.changed=function(e,t,n,i){},t.prototype._ignoreKeys=function(t,n){if(!n){if(t.which===i.keys.VK_UP)return this._query.moveSelected(-1,!0),!0;if(t.which===i.keys.VK_DOWN)return this._query.moveSelected(1,!0),!0}return e.prototype._ignoreKeys.call(this,t,n)},t}(e.formedit.Edit),t.Search=r,o.registerControl(r,"string",!1,"search",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s;e.select||(e.select={}),t=e.ui,n=e.utils,e.formedit,i=e.uiutils,o=e.dom,e.locale,e.Observable.SchemaUtils,r=e.ulocale,t=e.ui,s=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}return __extends(t,e),t.prototype.fillSelect=function(e){this.renderOptions.readOnly||i.utils.fillSelect(e,this._input(),this.$schema)},t.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype._setReadOnly=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},t.prototype._state2UI=function(){this._input()&&this._setFilter(!0),e.prototype._state2UI.call(this)},t.prototype._setFilter=function(e){var t=this.state.filter;if(!e||t){var n=t?this.$schema.filters[t]||[]:this.$schema.enum;if(this.fillSelect(n),!e)if(n.indexOf(this.state.value)<0)this.form.setValue(this.$display,n.length?n[0]:null);else{var i=this._input();i&&this._value2Input(i)}}},t.prototype.stateChanged=function(t,n){var i=this.form.getState(this.$bind);e.prototype.stateChanged.call(this,t,n),t&&"filter"!==t||this.state.filter!==i.filter&&(this.state.filter=i.filter,this._setFilter(!1))},t.prototype.render=function(e){var t=this,o=t._initOptions(i.utils.defaultOptions);if(!t.$element){var s=t.$schema.enumNames||t.$schema.enum;s=s.map(function(e){return r.tt(e+"",t.form.$locale)}),o.title=r.tt(t.$schema.title,t.form.$locale),t.$schema.description&&(o.description=r.tt(t.$schema.description,t.form.$locale));var a=t.state.filter,l=a?t.$schema.filters[a]||[]:t.$schema.enum;t.$element=$(function(e,t,o,r,s,a){r=r||"";var l=[];return(t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t)).titleIsHidden&&(t.columns=!1),t.placeHolder=!1,i.utils.fieldWrapper(l,t,o,function(){if(!t.titleIsHidden){l.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&l.push(' class="'+e.join(" ")+'"'),l.push(">"),l.push(n.escapeHtml(r||"")+(t.inline?"&nbsp;":"")),i.utils.addTooltipAndRule(l,t),l.push("</label>")}if(t.columns&&l.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'">'),t.readOnly){l.push('<div class="form-control bs-read-only'),l.push('" id="{0}_input"');var o=[];t.maxWidth&&o.push("max-width: "+t.maxWidth+";"),t.minWidth&&o.push("min-width: "+t.minWidth+";"),o.length&&l.push(' style="'+o.join("")+'"'),l.push(">"),l.push("</div>")}else l.push('<select class="form-control custom-select'),l.push('" id="{0}_input"'),o=[],t.maxWidth&&o.push("max-width: "+t.maxWidth+";"),t.minWidth&&o.push("min-width: "+t.minWidth+";"),o.length&&l.push(' style="'+o.join("")+'"'),l.push(">"),s.forEach(function(e,t){l.push('<option value="'+e+'">'+a[t]+"</option>")}),l.push("</select>");i.utils.addErrorDiv(l),t.columns&&l.push("</div>"),t.titleIsHidden&&i.utils.addTooltipAndRule(l,t)}),n.format(l.join(""),e)}(t.id,o,t.options.design,o.title,l,s)),t._state2UI(),t.setEvents(o)}return t.appendElement(e,o),t.$element},t.prototype.removeEvents=function(){if(!this.renderOptions.readOnly){var e=this._input();$(e).off("change")}},t.prototype._value2Input=function(e){var t=this;if(t.renderOptions.readOnly){var n=t.$schema.enumNames||t.$schema.enum;n=n.map(function(e){return r.tt(e+"",t.form.$locale)});var i=t.$schema.enum.indexOf(t.state.value);o.text(e,n[i]||String.fromCharCode(160))}else e.selectedIndex=t.state.filter?t.$schema.filters[t.state.filter].indexOf(t.state.value):t.$schema.enum.indexOf(t.state.value)},t.prototype.setEvents=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t._input();$(n).on("change",function(e){var n=t._input(),i=t.state.filter?t.$schema.filters[t.state.filter][n.selectedIndex]:t.$schema.enum[n.selectedIndex];t.state.value!==i&&(t.state.value=i,t.form.setValue(t.$display,t.state.value))})}},t}(e.formedit.BaseEdit),t.registerControl(s,"*",!0,"",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a;t=e.wizardctrl||(e.wizardctrl={}),n=e.utils,i=e.ui,o=e.dom,e.groupctrl,r=e.ulocale,s=e.uiutils,a=function(t){function i(e,n,i){var o=t.call(this,e,n,i)||this;return o._state(),o}return __extends(i,t),i.prototype._state2UI=function(){t.prototype._state2UI.call(this,function(e){o.addClass(e,"btn-primary"),o.removeClass(e,"btn-"+o.bootstrapStyles(!0).secondary),e.tabIndex=0})},i.prototype.changed=function(e,n,i,r){var s=this;if(s.state.value!=i){if(s.state.value=i,!s.$element)return;t.prototype._enumItems.call(this,function(e,t){s.state.value===t?(e.tabIndex=0,s.focused&&e.focus(),o.addClass(e,"btn-"+o.bootstrapStyles(!1).primary),o.removeClass(e,"btn-"+o.bootstrapStyles(!0).secondary)):(o.addClass(e,"btn-"+o.bootstrapStyles(!0).secondary),o.removeClass(e,"btn-"+o.bootstrapStyles(!1).primary),e.tabIndex=-1)})}},i.prototype.render=function(t){var i=this,a=i._initOptions(s.utils.defaultOptions);if(!i.$element){var l=i.$schema.enumNames||i.$schema.enum;l=l.map(function(e){return r.tt(e,i.form.$locale)}),i.$element=$(function(t,i,r,a,l,u){a=a||"",i=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},i);var d=[];return s.utils.fieldWrapper(d,i,r,function(){e.bootstrap4,d.push('<div class="'+["btn-group"].join(" ")+'">'),l.forEach(function(e,t){d.push('<button tabindex="-1" type="button" id="{0}_item_'+t+'" class="btn btn-'+o.bootstrapStyles(!0).secondary+'"'),i.width&&d.push(' style="width:'+i.width+'"'),d.push(">"),d.push(n.escapeHtml(u[t]||"")),d.push("</button>")}),d.push("</div>")}),n.format(d.join(""),t)}(i.id,a,i.options.design,r.tt(i.$schema.title,i.form.$locale),i.$schema.enum,l)),i._state2UI()}return i.appendElement(t,a),i.$element},i}(e.groupctrl.Group),t.WizardSteps=a,i.registerControl(a,"*",!0,"wizardctrl",null)}(Phoenix||(Phoenix={})),function(e){var t=e.utils,n=e.ui,i=e.dom,o=e.uiutils,r=e.ulocale;!function(s){var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype._button=function(){return this.$element?this.renderOptions.inline?this.$element.get(0):this.$element.get(0).firstChild:null},n.prototype._renderButton=function(){return $(function(e,n,r,s){s=s||"",n=$.extend({icon:null,type:"default",size:null},n);var a=[];return o.utils.fieldWrapper(a,n,r,function(){a.push('<button type="button"'),a.push(' class="bs-button btn btn-link'),n.size&&a.push(" btn-"+n.size),a.push('"'),a.push(">"),a.push('<span class="'+i.iconClass(n.icon)+'"></span>'),a.push("</button>"),a.push("<span>"+s+"</span>")}),t.format(a.join(""),e)}(this.id,this.renderOptions,this.options.design,r.tt(this.title,this.form.$locale)))},n}(e.formlinkbase.LinkBase);n.registerLinkControl(a,"title-button")}(e.formlink||(e.formlink={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e.ui,i=e.utils,o=e.dom,r=e.ulocale,s=e.uiutils;function a(t,n,o,r){r=r||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var a=[];return s.utils.fieldWrapper(a,n,o,function(){var t,o,l=e.bootstrap4;if(!n.titleIsHidden){var u=["bs-label"];a.push('<label for="{0}_input" id="{0}_label"'),n.columns&&(l?u.push("col-form-label"):u.push("checkbox-inline"),u.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&u.push("text-left")),n.inline&&(l?u.push("form-check-inline"):u.push("checkbox-inline"),u.push("bs-cursor-d no-x-padding")),u.length&&a.push(' class="'+u.join(" ")+'"'),a.push(">"),a.push(i.escapeHtml(r||"")+(n.inline?"&nbsp;":"")),s.utils.addTooltipAndRule(a,n),a.push("</label>")}n.columns&&a.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'" id="{0}_colparent">'),t=a,o=n.inline?"tgl-btn-inline":"",t.push('<input class="tgl tgl-light" id="{0}_input" type="checkbox">'),t.push(i.format('<label class="tgl-btn {0}" for="{1}_input"></label>',o,"{0}")),n.columns&&a.push("</div>"),n.titleIsHidden&&s.utils.addTooltipAndRule(a,n)}),i.format(a.join(""),t)}var l=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(t,e),t.prototype._check=function(){if(!this.$element)return null;var e=this.$element.get(0);return o.find(e,this.id+"_input")},t.prototype.click=function(e){var t=this._check(),n=t.checked||!1;e.target==t&&this.state.value!=n&&(this._isBinded?(this.state.value=n,this.form.setValue(this.$bind,n)):this.setInternalValue(n,!0))},t.prototype._setDisabled=function(e,t){var n=this._check();this.state.isDisabled||this.state.isReadOnly?o.addClass(n,"disabled"):o.removeClass(n,"disabled"),e.disabled=this.state.isDisabled},t.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},t.prototype._setMandatory=function(e,t){},t.prototype._state2UI=function(){var e=this._check(),t=this.$element?this.$element.get(0):null;e&&(e.checked=this.state.value||!1,this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t))},t.prototype.changed=function(e,t,n,i){var o=this._check();this.state.value!=n&&(this.state.value=n,o.checked=this.state.value||!1)},t.prototype.stateChanged=function(e,t){var n=this,i=n._isBinded?n.form.getState(n.$bind):n._internalState,o=n._check(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r))},t.prototype.render=function(e){var t=this,n=t._initOptions(s.utils.defaultOptions);return t.$element||(t.$schema.description&&(n.description=r.tt(t.$schema.description,t.form.$locale)),t.$element=$(a(t.id,n,t.options.design,r.tt(t.title,t.form.$locale))),t._state2UI()),t.appendElement(e,n),t.$element},t}(e.ui.AbsField);t.Toggle=l,n.registerControl(l,"boolean",!1,"toggle",null)}(e.togglectrl||(e.togglectrl={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,o=i.utils,r=i.ui,s=i.dom,a=i.uiutils;e.wizard||(e.wizard={}),t="invisible",n=function(e){function n(t,n,i){var o=e.call(this,t,n,i)||this,r=o;return r._step=1e3,r.fieldOptions.bindStep?(r._step=r.form.getValue(r.fieldOptions.bindStep),i.registerListenerFor(r.fieldOptions.bindStep,r)):r.fieldOptions.step&&(r._step=r.fieldOptions.step),r._state(),r._init(),o}return __extends(n,e),n.prototype.destroy=function(){this.form.unRegisterListenerFor(this.fieldOptions.bindStep,this),e.prototype.destroy.call(this)},n.prototype._createSteps=function(){var e=this,t=e.$element.get(0),n=s.find(t,e.id+"_parent"),i=e._steps.length-1;e._steps.forEach(function(t,r){var a,l,u,d,c,p,h;n.appendChild((a=e.id,l=r+1,u=t.code,d=t.libelle,c=t.status,p=r&&r===i,h=['<div id="{0}_{1}" class="d-inline-block">','<div class="bs-step bs-cursor-p d-table align-middle bs-cursor-pointer">','<span data-step-code="{2}" class="bs-step-icon d-table-cell align-middle">','<span data-step-code="{2}" id="{0}_{1}_icon" class="bs-step-circle text-center d-inline-block'+("A"===c?" active "+s.iconClass("edit"):"V"===c?" validated "+s.iconClass("check"):"")+'">'+("N"===c?l:"")+"</span>","</span>",'<span data-step-code="{2}" id="{0}_{1}_title" class="bs-pointer-p bs-step-title d-table-cell align-middle text-nowrap">'+o.escapeHtml(d)+"</span>",'<span id="{0}_{1}_line" class="bs-step-line bs-cursor-d d-table-cell align-middle'+(p?" bs-none":"")+'"><span class="bs-step-line-content"></span></span>',"</div>","</div>"],$(o.format(h.join(""),a,l,u)).get(0)))})},n.prototype._measure=function(e){var t=this;t._measured=!0;var n=t.$element.get(0),i=s.find(n,t.id+"_parent");t._steps.length;t._hlineWidth=0,t._steps.forEach(function(e,n){var o=i.childNodes[n],r=s.position(o,i);e.width=r.width;var a=s.find(o,t.id+"_"+(n+1)+"_title");if(s.addClass(a,"bs-none"),r=s.position(o,i),e.widthNoCaption=r.width,s.removeClass(a,"bs-none"),0===n){var l=s.find(o,t.id+"_"+(n+1)+"_line");r=s.position(l,i),t._hlineWidth=r.width}}),t._resizeTo(e),s.removeClass(i,"invisible")},n.prototype._init=function(){this._steps=[];for(var e=!1,t=0;t<this.$schema.enum.length;t++){var n="V";e?n="N":this.state.value===this.$schema.enum[t]&&(e=!0,n="A"),this._steps.push({code:this.$schema.enum[t],libelle:this.$schema.enumNames[t],status:n,width:0,widthNoCaption:0})}},n.prototype.stateChanged=function(e,t){this._state(),this.$element&&"isHidden"===e&&(this.setHidden(this.$element.get(0)),this.state.isHidden||this.resize())},n.prototype.click=function(e){var t,n=this;if(0!==n._step&&!n.state.isDisabled){var i=s.attr(e.target,"data-action");if("next"===i)(o=n.$schema.enum.indexOf(n.state.value))>=0&&o+1<n.$schema.enum.length&&(t=n.$schema.enum[o+1]);else if("prev"===i){(o=n.$schema.enum.indexOf(n.state.value))>0&&(t=n.$schema.enum[o-1])}else t=s.attr(e.target,"data-step-code");if(t){if(1===n._step){var o;n.state.value;if((o=n.$schema.enum.indexOf(n.state.value))>=0){var r=n.$schema.enum.indexOf(t);r&&r>o&&(t=n.$schema.enum[o+1])}else t=n.state.value}n.form.setValue(n.$bind,t)}}},n.prototype.changed=function(e,t,n,i){var o=this;if(e===o.$bind){o.state.value=n;var r=!1;if(o._steps&&o._steps.length)for(var a=0;a<o._steps.length;a++){var l=o._steps[a],u="V";if(r?u="N":o.state.value===l.code&&(r=!0,u="A"),l.status!==u){l.status=u;var d=s.find(o.$element.get(0),o.id+"_"+(a+1)+"_icon"),c=["bs-step-circle text-center d-inline-block"],p=!0;"A"===u?(p=!0,c.push(s.iconClass("edit")),c.push("active")):"V"===u?(p=!0,c.push(s.iconClass("check")),c.push("validated")):p=!1,d.className=c.join(" "),s.text(d,p?"":a+1+"")}}o.resize()}else if(e&&e===o.fieldOptions.bindStep){var h=o.form.getValue(o.fieldOptions.bindStep);if(h!==o._step){var f=0===h||0===o._step;o._step=h,f&&o.resize()}}},n.prototype._resizeTo=function(e){var t=this,n=t.$element.get(0),i=s.find(n,t.id+"_parent"),o=0,r=0,a=0,l=t._steps.length;t._steps.forEach(function(e,n){switch(o+=e.width,e.status){case"A":r+=e.width,a+=e.width;break;case"V":var i=t._steps[n+1];i&&"A"===i.status?r+=e.width:r+=e.widthNoCaption,a+=e.widthNoCaption;break;case"N":var s=t._steps[n-1];s&&"A"===s.status?r+=e.width:r+=e.widthNoCaption,a+=e.widthNoCaption}});var u=0,d=!1,c=!1,p=!1;if(o<=e?(d=!0,u=e-o):r<=e?(d=!0,c=!0,u=e-r):a<=e&&(d=!0,p=!0,u=e-a),d){for(var h=t._steps.length>1?t._steps.length-1:1,f=Math.floor(u/h)+t._hlineWidth,m=s.queryAll(i,".bs-step-line"),v=0,g=m.length;v<g;v++){var y=m[v];s.hasClass(y,"bs-none")||(y.style.width=f+"px")}t._steps.forEach(function(e,n){var o=i.childNodes[n],r=s.find(o,t.id+"_"+(n+1)+"_title");if(n&&n===l-1){var a=s.find(o,t.id+"_"+(n+1)+"_line");s.hasClass(a,"bs-none")||s.addClass(a,"bs-none")}if(c)switch(e.status){case"A":s.removeClass(r,"bs-none");break;case"V":var u=t._steps[n+1];u&&"A"===u.status?s.removeClass(r,"bs-none"):s.hasClass(r,"bs-none")||s.addClass(r,"bs-none");break;case"N":var d=t._steps[n-1];d&&"A"===d.status?s.removeClass(r,"bs-none"):s.hasClass(r,"bs-none")||s.addClass(r,"bs-none")}else p?"A"===e.status?s.removeClass(r,"bs-none"):s.hasClass(r,"bs-none")||s.addClass(r,"bs-none"):s.removeClass(r,"bs-none");s.removeClass(o,"bs-none")})}else t._steps.forEach(function(n,o){var r=i.childNodes[o],a=s.find(r,t.id+"_"+(o+1)+"_title");if("A"===n.status){var u=s.find(r,t.id+"_"+(o+1)+"_line");o===l-1&&s.removeClass(u,"bs-none"),u.style.width=Math.max(0,e-n.width+t._hlineWidth)+"px",s.removeClass(a,"bs-none"),s.removeClass(r,"bs-none")}else s.hasClass(r,"bs-none")||s.addClass(r,"bs-none")})},n.prototype.resize=function(){var e=this,n=e.$element.get(0),i=s.find(n,e.id+"_root"),o=(s.find(n,e.id+"_parent"),e.$schema.enum.indexOf(e.state.value)),r=0!==e._step&&o+1<e.$schema.enum.length,a=0!==e._step&&o>0,l=s.find(n,e.id+"_next"),u=s.find(n,e.id+"_prev");r?s.removeClass(l,t):s.hasClass(l,t)||s.addClass(l,t),a?s.removeClass(u,t):s.hasClass(u,t)||s.addClass(u,t);var d=s.position(i,null).width;d&&(e._measured?e._resizeTo(d):window.setTimeout(function(){e._measure(d)},10))},n.prototype.render=function(e){var n,i,r,l=this,u=l._initOptions(a.utils.defaultOptions);return l.$element||(l.$element=$((n=l.id,i=l.options.design,r=[],a.utils.fieldWrapper(r,{},i,function(){r.push('<div class="bs-step-root">'),r.push('<span data-action="prev" id="{0}_prev" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle '+t+'">'),r.push('<span data-action="prev" class="bs-step-arrow text-center d-inline-block '+s.iconClass("arrow-left")+'"></span>'),r.push("</span>"),r.push('<div class="bs-step-parent-parent" id="{0}_root"><div class="bs-step-parent invisible" id="{0}_parent"></div></div>'),r.push('<span data-action="next" id="{0}_next" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle '+t+'">'),r.push('<span data-action="next" class="bs-step-arrow text-center d-inline-block '+s.iconClass("arrow-right")+'"></span>'),r.push("</span>"),r.push("</div>")}),$(o.format(r.join(""),n)).get(0))),l._createSteps()),l.setHidden(l.$element.get(0)),l.appendElement(e,u),l.$element},n}(e.ui.AbsField),r.registerControl(n,"*",!0,"steppers")}(Phoenix||(Phoenix={})),function(e){var t,n,i=e.render,o=e.ui,r=(e.Observable,e.Observable.SchemaUtils);t||(t={}),n=function(e,t,n){if(r.isLink(e.$bind))return o.getRegisteredLinkControl(e.$widget);var i,s=r.isMeta(e.$bind);return s?o.getRegisteredControl("meta",!1,s.widget,"",{}):t?(e.$readOnly&&((i=i||{}).readOnly=!0),n&&((i=i||{}).lookup=!0),o.getRegisteredControl(t.type,!!t.enum,e.$widget,t.format,i)):null},i.register("javascript","field.control",n),i.register("angular","field.control",n)}(Phoenix||(Phoenix={})),function(e){var t=Phoenix||(Phoenix={}),n=t.locale,i=t.ui,o={type:"object",properties:{message:{type:"string"}}},r={name:"alert",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]};t.utils.alert=function(e,t,s){var a,l,u,d;a=t,l=s,u={title:e||n.ui.Info,noClose:!0,buttons:[{type:"primary",title:n.ui.Ok,name:"ok"}]},d={message:a},i.OpenModalForm(u,r,o,d,null,function(e,t,n,i){if("modal-action"===t.operation)switch(t.property){case"ok":e.close(),l&&l()}})}}(),function(e){var t=Phoenix||(Phoenix={}),n=t.locale,i=(t.utils,t.external),o=t.application,r=t.DatasetPlugin,s=t.dom,a=t.ui,l={name:"form",$type:"block",$items:[{$bind:"oldPwd"},{$bind:"newPwd"},{$bind:"$$newPwd"}]};i.changePasswordHandler=function(e){var t={type:"object",properties:{oldPwd:{title:n.ui.password.oldPassword,type:"string",format:"password",capabilities:{noConfirming:!0}},newPwd:{title:n.ui.password.newPassword,type:"string",format:"password",minLength:8}},states:{oldPwd:{isMandatory:!0},newPwd:{isMandatory:!0}}},i={title:n.ui.password.change,buttons:[{pattern:"validate"}]};a.OpenModalForm(i,l,t,{},{},function(t,n,i,a){switch(n.property){case"validate":if(!i.validate())return;var l=o.configuration&&o.configuration.application&&o.configuration.application.authentication?o.configuration.application.authentication.changePasswordDs:null;if(!l)return void t.close();s.processing(!0);var u={oldPwd:i.oldPwd,newPwd:i.newPwd};l.name="data",r.executeDatasets([l],u,{},[],function(n,o){o?(i.addAjaxException(o),s.processing(!1)):(s.processing(!1),t.close(),e&&e())})}})}}(),function(e){var t=e,n=t.locale,i=t.ui,o=t.utils,r={type:"object",properties:{message:{type:"string"}}},s={name:"confirm",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},a=function(e,t,o,a){var l={title:e=e||n.ui.Warning,noClose:!0,buttons:[{type:"default",title:n.ui.No,name:"no"},{type:"primary",title:n.ui.Yes,name:"yes"}]},u={message:t};i.OpenModalForm(l,s,r,u,null,function(e,t,n,i){if("modal-action"===t.operation)switch(t.property){case"yes":e.close(),o&&o();break;case"no":e.close(),a&&a()}})};e.confirmDlg=a,o.confirm=function(e,t,n,i){a(e,t,n,i)}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r;t=e.ui||(e.ui={}),(n=e).dom,i=n.link,o=n.utils,n.application,n.ulocale,n.locale,r=function(){function e(e,t){this.$id=o.allocID(),t.maxWidth=t.maxWidth||128,this._options=t}return e.prototype._setEvents=function(){var e=this;if(e.$element){if(e._options.authoring)return;var t=e.$element.get(0);e.$element.on("click",function(n){var o=i.isCustomLink(t,n);if(o&&"click"===o.protocol){var r=e._options.link,s=i.context();"string"==typeof r?e.module&&e.module.links&&e.module.links[r]?i.execLink(e.module.links[r],s,null):i.execLink({$page:r},s,null):r.$page&&i.execLink(r,s,null)}})}},e.prototype._removeEvents=function(){this._options.authoring||this.$element&&this.$element.off("click")},e.prototype.render=function(e){this.$element||(this.$element=$(o.format(function(e){var t=n.bootstrap4,i=[],o=["bs-relative bs-image-mi-image"];o.push(t?"img-fluid":"img-responsive"),i.push('<div id="{0}" class="bs-image-mi bs-cursor-d">'),i.push('<div class="bs-image-mi-border"'),e.link&&i.push('href="click://navigate"'),i.push(">");var r=["max-width:"+e.maxWidth+"px;"];return i.push('<img id="{0}_img" class="'),i.push(o.join(" ")),i.push('" src="'+e.imageSrc+'"'),r.length&&i.push(' style="'+r.join("")+'"'),i.push(" />"),i.push('<span class="bs-image-mi-title">'+e.title+"</span>"),i.push("</div>"),i.push("</div>"),i.join("")}(this._options),this.$id)),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.destroy=function(){this.module=null,this._removeEvents(),this.$element=null,this._options=null},e}(),t.ImageMenuItem=r}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r;t=e.data||(e.data={}),i=(n=e).data,o=n.utils,r=function(){function e(e,t,n,i,o,r,s){this._enums={},this._entity=t,this._module=e,this._typeField=n,this._codeField=i,this._titleField=o,this._orderByField=r,this._fields=s}return e.prototype.promise=function(e,t){var n={},r=[],s=this,a=[];if(Object.keys(e).forEach(function(t){var i=e[t];if(s._enums[t])n[t]=s._enums[t];else{r.push({name:t,config:i});var o=s._typeField+" eq '"+t+"'";i.filter&&(o="("+o+" and "+i.filter+")"),a.push(o)}}),!r.length)return new o.Promise(function(e,i){e({type:t,enums:n})});var l={$top:1e3,nocount:!0,$entity:s._entity,$module:s._module,$filter:a.join(" or "),$orderby:s._typeField+","+s._orderByField};return i.odata.getRessources(l,function(e){return e.documents&&e.documents.forEach(function(e){var t=e[s._codeField],i=e[s._titleField],o=e[s._typeField];if(n[o]||(n[o]={enum:[],enumNames:[]},s._enums[o]=n[o]),s._fields){n[o].fields=n[o].fields||[];var r=[],a={};if(s._fields.forEach(function(t){e[t]&&r.push(e[t]),a[t]=e[t]}),n[o].fields.push(a),r.length){var l=r.join("$");n[o].filters=n[o].filters||{},n[o].filters[l]=n[o].filters[l]||[],n[o].filters[l].push(t)}}n[o].enum.push(t),n[o].enumNames.push(i)}),{type:t,enums:n}})},e}(),t.OdataEnumManager=r}(Phoenix||(Phoenix={})),function(e){var t=Phoenix||(Phoenix={}),n=t.locale,i=t.utils,o=t.ui,r={type:"object",properties:{value:{type:"string"}}},s={name:"prompt",$type:"block",$items:[{$bind:"value",options:{titleIsHidden:!0}}]};i.prompt=function(e,t,i){var a,l,u,d;a=t,l=i,u={title:e||n.ui.Warning,buttons:[{type:"primary",title:n.ui.Ok,name:"ok"}]},d={value:a||""},o.OpenModalForm(u,s,r,d,null,function(e,t,n,i){if("modal-action"===t.operation)switch(t.property){case"ok":var o=n.value;e.close(),l&&l(o)}})}}(),function(e){var t=e.application,n=e.external,i=e.ajax,o=e.utils;n.ruleLoaderHandler=function(e){var n=t.configuration;if(n&&n.rules&&n.rules.odataEntity){var r=n.rules.odataEntity+"?$filter="+encodeURIComponent("clientSide eq 'true'")+"&$expand="+encodeURIComponent("entities($filter=entity in ("+e.map(function(e){return"'"+e+"'"}).join(",")+"))"),s=i.getDefaultAjaxOptions(null);return i.get(r,s,function(e){return e.value})}return o.Promise.resolve([])}}(Phoenix||(Phoenix={})),function(e){var t=e.autoclose,n=e.external,i=e.ui;n.ruleViewer=function(e){var n={name:{name:"rule-list-viewer",form:!0,$type:"block",$items:[{$type:"block",$title:{value:"Rules",size:4},$items:[{$bind:"rules",$widget:"basicgrid",options:{border:!0,height:400,scrolling:{horizontal:!0,vertical:!0},columns:[{$bind:"ruleType",options:{width:70}},{$bind:"name",options:{width:100}},{$bind:"description",options:{width:150}},{$bind:"expression",options:{width:200}}]}}]}]},meta:{type:"object",properties:{rules:{type:"array",items:{type:"object",properties:{name:{type:"string",title:"Name"},description:{type:"string",title:"Description"},ruleType:{type:"string",title:"Type"},expression:{type:"string",title:"Expression"}}}}}},controller:{onModelChanged:function(){}},autoClose:{align:t.SCREEN_CENTER,minWidth:300,showCloseButton:!0},options:{}};i.showAutoCloseForm(n,{rules:e},null)}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s,a,l;e.Data||(e.Data={}),(t=e).ulocale,n=t.application,i=t.ajax,o=t.data,r=t.utils,s=t.Observable.SchemaUtils,a=t.dom,l=function(e,t){var o=n.config(n.name);if(!o)throw"Application configuration not found.";var l=o.current.prototypes+"/"+e,u=i.get(l,{},function(e){return e});return new r.Promise(function(e,n){u.then(function(i){a.processing(!0),s.loadEnumsPromise(i).then(function(n){var i;a.processing(!1),e((i=n,t&&(i=t(i)),i))}).catch(function(e){a.processing(!1),n(e)})}).catch(function(e){n(e)})})},o.registerDataProvider("form-meta",function(e,t,n,i){return l(e.$params.$url,function(e){return e})})}(Phoenix||(Phoenix={})),function(e){var t,n,i;t=e.iframe||(e.iframe={}),(n=e).dom,n.utils,n.locale,i=function(){function e(e){this._options=$.extend({src:"https://www.google.com"},e||{})}return e.prototype._setEvents=function(){if(this.$element){var e=this.$element;e.iFrameResize&&e.iFrameResize(this._options)}},e.prototype._removeEvents=function(){},e.prototype.render=function(e){this.$element||(this.$element=$('<iframe src="'+this._options.src+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>'),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null},e}(),t.IFrame=i}(Phoenix||(Phoenix={})),function(e){!function(t){e.ulocale;var n=e.utils,i=(e.ajax,e.dom),o=(e.link,function(){function e(e,t,n){this._fieldList=e||[],this._oldFilter=[],this._cb=t||null,this._options=n||{},this._nodeMain=$("<div class='form-inline bs-filterexpress' id='"+this._options.id+"'></div>")}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._fieldList},set:function(e){this._fieldList=e&&Array.isArray(e)&&e.length?e:this._fieldList,this.renderFieldsList(),this.renderSelectedFields()},enumerable:!0,configurable:!0}),e.prototype._getFieldByCode=function(e){var t=null;return this._fieldList.forEach(function(n){n.code===e&&(t=n)}),t},e.prototype._getEditField=function(e){var t;switch(e.format){case a.FORMAT_INTEGER:t="<input type='number' class='form-control' aria-label='...'>";break;case a.FORMAT_STRING:t="<input type='text' class='form-control' aria-label='...'>";break;case a.FORMAT_ENUM:t="<select class='form-control'>",e.enum&&e.enum.forEach(function(n,i){var o=e.enumNames&&e.enumNames[i]?e.enumNames[i]:n;t+="<option value='"+n+"'>"+o+"</option>"}),t+="</select>"}return $(t)},e.prototype._getOpField=function(e){var t;switch(e.format){case a.FORMAT_INTEGER:t=a.OP_INTEGER;break;case a.FORMAT_STRING:t=a.OP_STRING;break;case a.FORMAT_ENUM:t=a.OP_ENUM;break;default:t=""}return t},e.prototype._checkFilter=function(e){return!e||""!=e.code&&""!=e.op},e.prototype.destroy=function(){this._nodeValidate.off("click"),this._nodeMain.off("blur"),this._fieldList=null,this._cb=null,this._nodeMain=null,this._nodeValidate=null,this._options=null},e.prototype.renderFieldsList=function(){},e.prototype.renderSelectedFields=function(){},e.prototype.validerFilter=function(){},e.prototype.setEvents=function(){var e=this;e._nodeValidate.click(function(){e.validerFilter()})},e}()),r=function(t){function n(n,o,r){var s=t.call(this,n,o,r)||this,l=s,u=e.bootstrap4,d=$('<div class="input-group"></div>'),c=$('<div class="input-group-prepend"></div>'),p='<button type="button" ';p+='class="bs-button btn btn-'+i.bootstrapStyles(!0).secondary+' dropdown-toggle" data-toggle="dropdown" ',p+='aria-haspopup="true" aria-expanded="false"></button>';var h=$(p);l._nodeSelectButtonTxt=$("<span>"+a.FIELD_SELECT_TEXT_DEFAULT+"</span>");var f=$('<span class="caret"></span>');l._nodeSelectList=u?$('<div class="dropdown-menu"></div>'):$('<ul class="dropdown-menu"></ul>'),l._nodeEdit=$('<input type="text" class="form-control" aria-label="...">');var m=$("<div class='input-group-apppend'></div>");return l._nodeValidate=$('<button class="bs-button btn btn-'+i.bootstrapStyles(!0).secondary+'" type="button"><span class="'+i.iconClass(a.VALIDATE_ICON_DEFAULT)+'"></span> '+a.VALIDATE_TEXT_DEFAULT+"</button>"),l._nodeMain.append(d),d.append(c),d.append(l._nodeEdit),d.append(m),c.append(h),c.append(l._nodeSelectList),h.append(l._nodeSelectButtonTxt),h.append(f),m.append(l._nodeValidate),l.renderFieldsList(),l.renderSelectedFields(),l.setEvents(),s}return __extends(n,t),n.prototype.renderSelectedFields=function(){var t=this,n=null,o=e.bootstrap4;if(t._fieldList.every(function(e){return!e.selected||(n=e,!1)}),!n&&t._fieldList&&t._fieldList.length&&(t._fieldList[0].selected=!0,n=t._fieldList[0]),n&&(t._nodeSelectButtonTxt.text(n.lib+" "),t._changeEditField(n)),t._nodeSelectedLi&&t._nodeSelectedLi.removeClass("active"),n){var r=i.query(t._nodeSelectList.get(0),(o?"a[data-value='":"li[data-value='")+n.code+"']");r&&(t._nodeSelectedLi=$(r),t._nodeSelectedLi.addClass("active"))}},n.prototype._changeEditField=function(e){var t,n,o=this;o._removeEvents(),n=o._getEditField(e).get(0),(t=o._nodeEdit.get(0)).parentNode.replaceChild(n,t),o._nodeEdit=$(n),n.focus(),e.enum?(i.addClass(o._nodeValidate.get(0),"bs-none"),o._nodeEdit.change(function(e){e.target===o._nodeEdit.get(0)&&o.validerFilter()}),o._nodeEdit.get(0).style.borderTopRightRadius="4px",o._nodeEdit.get(0).style.borderBottomRightRadius="4px"):(i.removeClass(o._nodeValidate.get(0),"bs-none"),o._nodeEdit.keyup(function(e){13==e.keyCode&&o.validerFilter()}),o._nodeEdit.focus(function(e){o._nodeEdit.get(0).select()}))},n.prototype._removeEvents=function(){this._nodeEdit.off("focus"),this._nodeEdit.off("keyup"),this._nodeEdit.off("change")},n.prototype.renderFieldsList=function(){var t=this,n=e.bootstrap4;i.empty(t._nodeSelectList.get(0)),t._fieldList.forEach(function(e){n?t._nodeSelectList.append('<a class="bs-cursor-p dropdown-item" data-value="'+e.code+'">'+e.lib+"</a>"):t._nodeSelectList.append("<li class='bs-cursor-p' data-value='"+e.code+"'><a>"+e.lib+"</a></li>")})},n.prototype.setEvents=function(){var e=this;t.prototype.setEvents.call(this),e._nodeSelectList.click(function(t){var n=i.findByAttribute(t.target,e._nodeSelectList.get(0),"data-value");if(n){var o=n.attributes["data-value"].value;if(o){var r=e._getFieldByCode(o);e._fieldList=e._fieldList.map(function(e){return e.selected=e.code==o,e}),r&&e.renderSelectedFields()}}});var n=!1;e._nodeMain.get(0).addEventListener("focusout",function(t){n=!0;var o=!1,r=t.relatedTarget;if(r){var s=r;do{if(!s)break;if(i.hasClass(s,"bs-filterexpress")){o=!0;break}s=s.parentNode}while(s&&!o)}if(!o&&t.target==e._nodeEdit.get(0)&&e._oldFilter&&e._oldFilter.length&&e._oldFilter[0].code){var a=e._getSelected();a&&a.code!==e._oldFilter[0].code&&(e._fieldList=e._fieldList.map(function(t){return t.selected=t.code==e._oldFilter[0].code,t}),e.renderSelectedFields()),e._nodeEdit.val(e._oldFilter[0].values[0])}},!0),e._nodeMain.get(0).addEventListener("blur",function(t){if(!n){var o=!1,r=t.relatedTarget||t.explicitOriginalTarget;if(r){var s=r;do{if(!s)break;if(i.hasClass(s,"bs-filterexpress")){o=!0;break}s=s.parentNode}while(s&&!o)}if(!o&&t.target==e._nodeEdit.get(0)&&e._oldFilter&&e._oldFilter.length&&e._oldFilter[0].code){var a=e._getSelected();a&&a.code!==e._oldFilter[0].code&&(e._fieldList=e._fieldList.map(function(t){return t.selected=t.code==e._oldFilter[0].code,t}),e.renderSelectedFields()),e._nodeEdit.val(e._oldFilter[0].values[0])}}},!0)},n.prototype.validerFilter=function(){if(this._cb){var e=this._getSelected(),t=this._nodeEdit.val()?{code:e.code,op:this._getOpField(e),values:[this._nodeEdit.val()]}:null;t&&!this._checkFilter(t)&&(t=null),this._oldFilter.splice(0),t&&this._oldFilter.push(t),this._cb(t)}},n.prototype._getSelected=function(){var e=null;return this._fieldList.every(function(t){return!t.selected||(e=t,!1)}),e},n}(o),s=function(t){function n(n,o,r){var s=t.call(this,n,o,r)||this,l=s,u=e.bootstrap4;l.leftTools=$('<div class="input-group-prepend"></div>'),l.rightTools=$('<div class="input-group-append"></div>'),l._nodeValidate=$("<button class='btn btn-default' type='button'><span class='"+i.iconClass(a.VALIDATE_ICON_DEFAULT)+"'></span> "+a.VALIDATE_TEXT_DEFAULT+"</button>");var d=$('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span>&nbsp;<span class="sr-only">Toggle Dropdown</span></button>');return l._nodeSelectList=u?$('<div class="dropdown-menu dropdown-menu-left"></div>'):$('<ul class="dropdown-menu dropdown-menu-left"></ul>'),l.rightTools.append(l._nodeValidate),l.leftTools.append(d),l.leftTools.append(l._nodeSelectList),l.renderFieldsList(),l.renderSelectedFields(),l.setEvents(),s}return __extends(n,t),n.prototype.renderSelectedFields=function(){var e,t,n=this;i.empty(n._nodeMain.get(0)),n._fieldList.forEach(function(e){e.selected&&n.addField(e)}),n._nodeMain.get(0).childNodes.length?(e=$(n._nodeMain.get(0).firstChild),t=$(n._nodeMain.get(0).lastChild)):(t=e=$('<div class="input-group"></div>'),n._nodeMain.append(e)),t.append(n.rightTools),$(e.get(0).firstChild).before(n.leftTools)},n.prototype.addField=function(e){e.composant={label:$('<span class="input-group-prepend" id="sizing-addon2"><span class="input-group-text">'+(e.lib||e.libelle||e.code)+"</span></span>"),value:this._getEditField(e)};var t=$('<div class="input-group"></div>');t.append(e.composant.label),t.append(e.composant.value),this._nodeMain.append(t),e.selected=!0},n.prototype.renderFieldsList=function(){var t=this,n=e.bootstrap4;i.empty(t._nodeSelectList.get(0)),t._fieldList.forEach(function(e){n?t._nodeSelectList.append('<a href="#" tabIndex="-1" class="bs-cursor-p dropdown-item" data-value="'+e.code+'"><input type="checkbox" '+(e.selected?"checked":"")+" />&nbsp;"+(e.lib||e.libelle||e.code)+"</a></li>"):t._nodeSelectList.append('<li class="bs-cursor-p" data-value="'+e.code+'"><a href="#" tabIndex="-1"><input type="checkbox" '+(e.selected?"checked":"")+" />&nbsp;"+(e.lib||e.libelle||e.code)+"</a></li>")})},n.prototype.setEvents=function(){var e=this;t.prototype.setEvents.call(this),e._nodeSelectList.on("click",function(t){var n=i.findByAttribute(t.target,e._nodeSelectList.get(0),"data-value");if(n){var o=$(n);if(o.attr("data-value")){var r=o.find("input"),s=e._getFieldByCode(o.attr("data-value"));return s&&(s.selected?(setTimeout(function(){r.prop("checked",!1)},0),s.selected=!1):(setTimeout(function(){r.prop("checked",!0)},0),s.selected=!0),e.renderSelectedFields()),$(t.target).blur(),!1}}})},n.prototype.validerFilter=function(){var e=this;if(e._cb){var t=[];e._fieldList.forEach(function(n){if(n.selected){var i=n.composant.value.val();if(i){var o={code:n.code,op:e._getOpField(n),values:[i]};e._checkFilter(o)&&t.push(o)}}}),e._oldFilter.splice(0),e._oldFilter=t,e._cb(t.length?t:null)}},n}(o),a=function(){function e(e,t,i){var o=this;e=o._completeFieldList($.extend(!0,[],e)),o._cb=t;var a={id:n.allocID(),multiple:!1};o._options=$.extend(!0,a,i),o._options.multiple?o._render=new s(e,o._cb,o._options):o._render=new r(e,o._cb,o._options)}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._render.fields},set:function(e){this._render.fields=e&&Array.isArray(e)?this._completeFieldList($.extend(!0,[],e)):[]},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._render.destroy(),i.find(this._nodeParent[0],this._options.id).remove(),this._render=null,this._cb=null,this._options=null},e.prototype.render=function(e){this._nodeParent=e,e.append(this._render._nodeMain)},e.prototype._completeFieldList=function(e){return e.forEach(function(e){e.enum&&Array.isArray(e.enum)?(e.format="enum",e.enum.splice(0,0,""),e.enumNames&&e.enumNames.splice(0,0,"")):e.format="number"===e.type?"integer":e.type}),e},e.FIELD_SELECT_TEXT_DEFAULT="Choix du champ",e.VALIDATE_TEXT_DEFAULT="",e.VALIDATE_ICON_DEFAULT="search",e.FORMAT_STRING="string",e.FORMAT_INTEGER="integer",e.FORMAT_ENUM="enum",e.OP_STRING="like",e.OP_INTEGER="in",e.OP_ENUM="in",e}();t.FilterExpress=a}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o;t=e.ui||(e.ui={}),n=e.DatasetPlugin,i=e.dom,o=function(){function e(e,t){var n=this;n._init=!1,n._options=t||{},n._notify=t.notify,n._ds=e||{},n._ds.mapping=n._ds.mapping||{},n._ds.mapping.code=n._ds.mapping.code||"code",n._ds.mapping.libelle=n._ds.mapping.libelle||n._ds.mapping.lib||"lib";var i=e.data.$params||{};n._pageSize=i.$top||null,n.searchText=null,n._count=0,n._page=0,n._items=[],n._initData()}return e.prototype._initData=function(){var e=this,t={},o=e._ds.data||{},r={name:"dataset",$type:o.$type||"odata",$params:{$entity:o.$params.$entity,$module:o.$params.$module,$top:1}};i.processing(!0),n.executeDatasets([r],{},t,null,function(n,o){if(i.processing(!1),!o){e._init=!0;var r=t.dataset;e._count=r.count,e._notify(null,{inited:!0,updated:!0})}},!1)},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){e&&(this._items=e,this._notifyChange("items"))},enumerable:!0,configurable:!0}),e.prototype._notifyChange=function(e){switch(e){case"items":this._notify(this.items,{})}},e.prototype.getNbPages=function(){return Math.ceil(this._count/this._pageSize)},e.prototype._getSkip=function(e){return this._pageSize?e*this._pageSize:0},e.prototype._getPage=function(e,t){var o=this;if(o._init){var r=$.extend(!0,{},o._ds.data),s={};r.name="dataset",r.$params=r.$params||{},r.$params.$skip=o._getSkip(e),t=t||{},o.searchText&&(t.$searchText=o.searchText),i.processing(!0),n.executeDatasets([r],t,s,null,function(e,t){if(i.processing(!1),!t){var n=s.dataset;n&&o._count!=n.count&&(o._count=n.count,o._page=0,o._notify(null,{updated:!0})),n.documents&&(n.documents=n.documents.map(function(e){return{code:e[o._ds.mapping.code],libelle:e[o._ds.mapping.libelle]||e[o._ds.mapping.code]}}),o.items=n.documents)}},!1)}},e.prototype.currentPage=function(){return this._page},e.prototype.toPage=function(e){e>=0&&e<this.getNbPages()&&(this._page=e,this._getPage(e))},e.prototype.nextPage=function(){var e=this._page+1;e<this.getNbPages()&&(this._page=e,this._getPage(e))},e.prototype.prevPage=function(){var e=this._page-1;e>=0&&(this._page=e,this._getPage(e))},e.prototype.firthPage=function(){this._page=0,this._getPage(0)},e.prototype.lastPage=function(){var e=this.getNbPages()-1;this._page=e,this._getPage(e)},e.prototype.search=function(e){this.searchText=e||null,this._ds.data.$params.$search&&this._getPage(0)},e.prototype.remove=function(){},e}(),t.DsLookup=o}(Phoenix||(Phoenix={})),function(e){!function(t){var n=t,i=e.utils,o=e.filters,r=e.uiutils,s=e.locale,a=e.ulocale,l=e.dom,u=e.Observable.SchemaUtils,d=o.OPERATORS,c=o.TYPES,p=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,n,i){var o={code:e,libelle:t||e,isBinary:n,options:i||{}};o.options.symbol=i.symbol||t||e,n&&(o.options.liaison=o.options.liaison||"et"),this.liste.push(o)},e.prototype.gets=function(){return this.liste},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.code==e});t>=0&&this.liste.splice(t,1)},e}();t.ListeOperateurs=p;var h=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,n,i){this.liste.push({code:e,libelle:t||e,type:n||"string",options:i||{}})},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.gets=function(){return this.liste},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.code==e});t>=0&&this.liste.splice(t,1)},e}();t.ListeChamps=h;var f=function(){function e(e,t,n,i){this.id=e,this.code=t,this.op=n,this.values=i||[]}return e.prototype.getValues=function(){return this.values.map(function(e){return e&&e.code?e.code:e})},e.prototype.getValueNames=function(){return this.values.map(function(e){return e&&e.lib?e.lib:e})},e}();t.Filter=f;var m=function(){function e(e){this.liste=[],this.filters=e,this.compteur=0}return e.prototype.add=function(e,t,n){var i=new f(this.compteur++,e,t,n);return this.liste.push(i),this.filters.push(i),i},e.prototype.add2=function(e,t,n){var i=new f(this.compteur++,e,t,n);return this.liste.push(i),i},e.prototype.set=function(e,t){var n,i=-1;if(this.liste.forEach(function(t,o){t.id==e&&(n=t,i=o)}),n&&(n.op=t.op,n.values=t.values||[]),i>=0&&i<this.filters.length){var o=this.filters.get(i);o&&(o.code=n.code,o.op=n.op,o.values=n.values)}return n},e.prototype.get=function(e){return this.liste.find(function(t){return t.id==e})},e.prototype.getByIndex=function(e){return this.liste[e]},e.prototype.gets=function(){return this.liste},e.prototype.getsByChamp=function(e){var t=[];return this.liste.forEach(function(n){n.code==e&&t.push(n)}),t},e.prototype.remove=function(e){var t=this.liste.findIndex(function(t){return t.id==e});t>=0&&(this.liste.splice(t,1),this.filters.remove(this.filters.get(t)))},e.prototype.removeAll=function(){var e=this;e.liste.splice(0),e.filters.forEach(function(t,n){e.filters.remove(e.filters.get(n))})},e.prototype.removeAllByChamp=function(e){var t=this;t.liste.forEach(function(n,i){n.code==e&&(t.liste.splice(i,1),t.filters.remove(t.filters.get(i)))})},e}();t.ListeFilters=m;var v=function(){function e(){this.liste=[]}return e.prototype.addType=function(e,t,n){this.liste.push({code:e,libelle:t||e,operateurs:n||[]})},e.prototype.get=function(e){return this.liste.find(function(t){return t.code==e})},e.prototype.addOperateur=function(e,t){this.liste.find(function(t){return t.code==e}).operateurs.push(t)},e.prototype.getOperateurs=function(e){return this.liste.find(function(t){return t.code==e}).operateurs},e}();t.ListeTypes=v;var g=function(){function e(e,t,n,i,o,r){this.listeChamps=e,this.listeFilters=t,this.listeOperateurs=n,this.filter=r,this.callBack=i,this.options=o||{},this.data={},this.init()}return e.prototype.init=function(){var e=this;e.model={type:"object",properties:{filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},selected:{type:"string"}}}}},links:{validate:{title:s.ui.Validate,isHidden:1!=e.options.btnValidate}}},e.layout={name:"form",$type:"block",$items:[{$type:"block",$items:[{$type:"block",$items:[{$bind:"filters",$widget:"tagview"}]},{$type:"block",$inline:!0,$items:[{$bind:"$links.validate",options:{type:"success",right:!0}}]}],$title:{value:s.ui.selectedFilters,size:5,style:""}}]},e.data.filters=e.listeFilters.gets().map(function(t){var n=e.listeOperateurs.get(t.op),i=e.listeChamps.get(t.code).libelle+" "+n.options.symbol+" ";return n.isBinary?i+=t.values[0]+" "+n.options.liaison+" "+t.values[1]:i+=t.getValueNames().join(", "),{code:t.id,libelle:i,selected:!(!e.filter||e.filter.id!=t.id)}})},e.prototype.render=function(e){var t=this;e&&n.OpenForm($(e),t.layout,t.model,t.data,{},function(e,n,i){switch(e.property){case"upd":t.callBack("EDIT",{id:e.actionParams.code});break;case"remove":t.callBack("REMOVE",{id:e.actionParams.code});break;case"$links.validate":t.callBack("VALIDE",{})}})},e}(),y=function(){function e(e,t,n){this.valueModel=null;this.type=e,this.op=t,this.options=$.extend(!0,{},n),this.valueModel=this.getInstance()}return e.prototype.getInstance=function(){var e=this,t=e.addDefaultOptions(e.options);return e.op.isBinary?new C(t):e.op.code===d.empty||e.op.code===d.nempty?new b(t):"enum"===e.type?new w(t):"lookup"===e.type?new E(t):e.op.code!==d.in&&e.op.code!==d.nin||"decimal"==e.type||"money"==e.type||"date"==e.type||"date-time"==e.type?new x(t):new k(t)},e.prototype.init=function(e){this.valueModel.init(e)},e.prototype.addDefaultOptions=function(e){switch(this.type){case"integer":e.type="number";break;case"decimal":e.type="number",e.decimals=e.decimals||5;break;case"money":e.type="number",e.format="money";break;case"date":e.type="string",e.format="date",e.title="Date";break;case"time":e.type="string",e.format="time",e.title="Time";break;case"date-time":e.type="string",e.format="date-time",e.title="Date";break;default:e.type=this.type||"string"}return e},e.prototype.getModel=function(){return this.valueModel?this.valueModel.getModel():null},e.prototype.getLayout=function(){return this.valueModel?this.valueModel.getLayout():null},e.prototype.getData=function(){return this.valueModel?this.valueModel.getData():null},e.prototype.getValues=function(){return this.valueModel?this.valueModel.getValues():null},e.prototype.setValues=function(e,t){return this.valueModel?this.valueModel.setValues(e,t):null},e.prototype.setValuesByFilter=function(e){this.valueModel&&this.valueModel.setValuesByFilter(e)},e}(),_=function(){function e(e){}return e.prototype.init=function(e){e&&e()},e.prototype.getModel=function(){return this.model},e.prototype.getLayout=function(){return this.layout},e.prototype.getData=function(){return this.data},e.prototype.getValues=function(){},e.prototype.setValues=function(e,t){},e.prototype.setValuesByFilter=function(e){},e}(),b=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.getValues=function(){return[""]},t}(_),x=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.options=t||{},i.model={type:"object",properties:{value:{title:i.options.title||"Valeur",type:i.options.type||"string"}},states:{value:{isMandatory:!0}}},i.options.format&&(i.model.properties.value.format=i.options.format),i.options.decimals&&(i.model.properties.value.decimals=i.options.decimals),i.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:12}]},i.data={value:null},n}return __extends(t,e),t.prototype.getValues=function(){return null!=this.data.value?[this.data.value]:null},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e[0]},t}(_),C=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.options=t||{},i.model={type:"object",properties:{value1:{title:(t.title||"Valeur")+" 1",type:t.type||"string"},value2:{title:(t.title||"Valeur")+" 2",type:t.type||"string"}},states:{value1:{isMandatory:!0},value2:{isMandatory:!0}}},i.options.format&&(i.model.properties.value1.format=i.options.format,i.model.properties.value2.format=i.options.format),i.options.decimals&&(i.model.properties.value1.decimals=i.options.decimals,i.model.properties.value2.decimals=i.options.decimals),i.layout={name:"filter-value",$type:"block",$items:[{$type:"row",$items:[{$items:[{$bind:"value1",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6},{$items:[{$bind:"value2",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6}]}]},i.data={value1:null,value2:null},n}return __extends(t,e),t.prototype.getValues=function(){return null!=this.data.value1&&null!=this.data.value2?[this.data.value1,this.data.value2]:null},t.prototype.setValues=function(e){this.data.value1=e.value1,this.data.value2=e.value2},t.prototype.setValuesByFilter=function(e){this.data.value1=e[0],this.data.value2=e[1]},t}(_),k=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.options=t||{},i.model={type:"object",properties:{value:{title:"Valeur",type:"string"}},states:{value:{isMandatory:!0}}},i.options.format&&(i.model.properties.value.format=i.options.format),i.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:'Une ou plusieurs valeurs (séparées par un ";" : val1;val2;...)'}}],$colSize:12}]},i.data={value:null},n}return __extends(t,e),t.prototype.getValues=function(){if(null==this.data.value)return null;var e=this.data.value.split(";"),t=[];return"number"==this.options.type?e.forEach(function(e){var n=parseInt(e,10);isNaN(n)||t.push(n)}):t=e,t},t.prototype.setValues=function(e){var t=this;if(e.value){var n=e.value.split(";"),i=[];(n=n.map(function(e){return e.replace(/\"/g,"")})).forEach(function(e){"number"==t.options.type?new RegExp("^[0-9]+$").test(e)&&i.push(e):i.push(e)}),t.data.value=i.join(";")}},t.prototype.setValuesByFilter=function(e){this.data.value=e.join(";")},t}(_),w=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.options=t||{},i.options.enumName=i.options.enumName||i.options.champName,i.model={type:"object",properties:{value:{title:"List",type:"array",items:{type:"string",enums:{},$enumref:"list"}}},states:{value:{isMandatory:!0}}},i.model.properties.value.items.enums[i.options.enumName]={type:"default",enum:[],enumNames:[]},i.model.properties.value.items.$enumref=i.options.enumName,i.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"enums-list",options:{titleIsHidden:!0}}],$colSize:12}]},i.options.enum&&i.options.enum.forEach(function(e){i.model.properties.value.items.enums[i.options.enumName].enum.push(e.code),i.model.properties.value.items.enums[i.options.enumName].enumNames.push(e.libelle||e.code)}),i.data={value:[]},n}return __extends(t,e),t.prototype.getValues=function(){var e=this;return e.data.value&&e.data.value.length?e.data.value.map(function(t){var n=null;return e.options.enum.forEach(function(e,i){if(t==e.code)return n=e,!1}),{code:t,lib:n.libelle||n.lib||t}}):[]},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e.map(function(e){return e.code})},t}(_),E=function(e){function t(t){var n=e.call(this,t)||this,i=n;return i.options=t||{},i.model={type:"object",properties:{value:{title:"List",type:"array",ds:i.options.lookupSchema||null,items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}},states:{value:{isMandatory:!0}}},i.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"lookup-list",options:{titleIsHidden:!0}}],$colSize:12}]},i.data={value:[]},n}return __extends(t,e),t.prototype.getValues=function(){return this.data.value&&this.data.value.length?this.data.value:[]},t.prototype.setValues=function(e){this.data.value=e.value},t.prototype.setValuesByFilter=function(e){this.data.value=e},t}(_),O=function(){function e(e,t,n,i,o,r,s){this.champ=e,this.filter=r,this.listeFilters=t,this.listeOperateurs=n,this.listeTypes=i,this.callBack=o,this.options=s||{},this.data={operateur:null,values:[]}}return e.prototype.renderOperateur=function(){var e=this,t={type:"object",properties:{champ:{title:"Filtre",type:"string"},operateur:{title:"Opérateur",type:"string",enum:[],enumNames:[]}},states:{champ:{isReadOnly:!0,isHidden:0==e.options.showLabel},operateur:{isHidden:0==e.options.showOperateur}}},i=t.properties;e.data.champ=e.champ.libelle;var o=e.champ.options.format||e.champ.type;if(i.operateur.enum=e.listeTypes.getOperateurs(o),i.operateur.enum.forEach(function(t){i.operateur.enumNames.push(e.listeOperateurs.get(t).libelle)}),e.filter?e.data.operateur=e.filter.op:e.data.operateur=i.operateur.enum[0],0!=e.options.showLabel||0!=e.options.showOperateur){var r=l.query(e.container,".operateur");if(r){var s=n.formManager().formByName("filter-operateur");n.removeForm(s),n.OpenForm($(r),{name:"filter-operateur",$type:"block",$items:[{$type:"block",$items:[{$bind:"champ",$readOnly:!0,options:{$expression:"{{champ}}"}},{$bind:"operateur",options:{titleIsHidden:!0}}]}]},t,e.data,{},function(t,n,i){switch(t.property){case"operateur":if("propchange"==t.operation){var o=e.listeOperateurs.get(n.model().operateur);e.data.operateur=n.model().operateur,e.renderValue(o)}}})}}},e.prototype.renderValue=function(e){var t=this,i=l.query(t.container,".value");if(i){var o=n.formManager().formByName("filter-value");n.removeForm(o);var r=t.champ.options||{};r.champName=t.champ.code,t.modelType=new y(t.champ.options.format||t.champ.type,e,r),t.modelType&&t.modelType.init(function(){var e=t.modelType.getModel(),o=t.modelType.getLayout();if(e&&o){t.filter&&t.modelType.setValuesByFilter(t.filter.values);var r=t.modelType.getData();n.OpenForm($(i),o,e,r,{},function(e,n,i){switch(e.operation){case"propchange":default:t.modelType.setValues(n.model()),t.data.values=t.modelType.getValues()}})}else t.data.values=t.modelType.getValues()})}},e.prototype.renderButton=function(){var e=this,t={type:"object",properties:{},links:{add:{title:s.ui.Add}}},i=l.query(e.container,".link");if(i){var o=n.formManager().formByName("filter-link");n.removeForm(o),n.OpenForm($(i),{name:"filter-link",$type:"block",$items:[{$inline:!0,$items:[{$bind:"$links.add",options:{type:"primary",icon:"plus",right:!0}}],$colSize:12}]},t,e.data,{},function(t,i,o){switch(t.property){case"$links.add":var r=n.formManager().formByName("filter-value");if(!i.validate()||r&&!r.$model.validate())return;i.model();e.data.values&&e.data.values.length&&e.callBack({code:e.champ.code,op:e.data.operateur,values:e.data.values})}})}},e.prototype.render=function(e){e&&(this.container=e,l.empty(e),l.append(e,$(["<div>",'<div class="operateur">',"</div>",'<div class="value">',"</div>",'<div class="link">',"</div>","</div>"].join("")).get(0)),this.renderOperateur(),this.renderValue(this.listeOperateurs.get(this.data.operateur)),this.renderButton())},e}(),S=function(){function e(e,t,n,i,o,r){this.listeChamps=e,this.listeChampsArbre=t,this.listeFilters=n,this.listeOperateurs=i,this.listeTypes=o,this.options=r||{}}return e.prototype.createContainer=function(){this.container=document.createElement("div"),l.addClass(this.container,"bs-filter-view"),this.container.innerHTML=['<div class="row">','<div class="col-sm-5 bs-champ-list">',"</div>",'<div class="col-sm-7 filter-edit">',"</div>","</div>",'<div class="row">','<div class="col-sm-12 bs-filter-list">',"</div>","</div>"].join(""),this.champListView=l.query(this.container,".bs-champ-list"),this.filterListView=l.query(this.container,".bs-filter-list"),this.filterEditView=l.query(this.container,".filter-edit")},e.prototype.render=function(){return this.createContainer(),this.listeChamps.gets().length&&(this.showChampList(),this.selecteChamp(this,this.listeChamps.gets()[0].code)),this.container},e.prototype.showChampList=function(){var e=this;e._multiSelectList=new t.MultiSelectList(this.listeChampsArbre,{maxHeight:"auto"},function(t){t&&t.data.name&&e.selecteChamp(e,t.data.name)});var n=70*(e.options.listSize||7),i=$('<div class="bs-field-list-border" style="max-height:'+n+'px;"></div>').get(0);e._multiSelectList.render(i),l.append(e.champListView,i)},e.prototype.selecteChamp=function(e,t){e._multiSelectList.addItem(t),e.updateFilter(e,t);var n=e.listeFilters.getsByChamp(t),i=null;n&&n.length&&(i=n[0]),e.showFilterList(e,i)},e.prototype.showFilterList=function(e,t){var n=new g(e.listeChamps,e.listeFilters,e.listeOperateurs,function(t,n){if("EDIT"==t){var i=e.listeFilters.get(n.id);i&&e.selecteChamp(e,i.code)}else"REMOVE"==t?e.removeFilter(e,n.id):"VALIDE"==t&&e.valideFilters()},e.options,t);l.empty(e.filterListView),n.render(e.filterListView)},e.prototype.updateFilter=function(e,t){var n=e.listeChamps.get(t),i=e.listeFilters.getsByChamp(t),o=null;i&&i.length&&(o=i[0]);var r=new O(n,e.listeFilters,e.listeOperateurs,e.listeTypes,function(t){e.addFilter(e,t)},o,e.options);l.empty(e.filterEditView),r.render(e.filterEditView)},e.prototype.addFilter=function(e,t){var n,i=e.listeFilters.getsByChamp(t.code);n=!e.options.multiple&&i&&i.length?e.listeFilters.set(i[0].id,t):e.listeFilters.add(t.code,t.op,t.values),e.showFilterList(e,n)},e.prototype.removeFilter=function(e,t){var n=e.listeFilters.get(t).code;e.listeFilters.remove(t),e.selecteChamp(e,n)},e.prototype.valideFilters=function(){},e}(),P=function(t){function n(e,n,i,o,r,s,a){var l=this;return(l=t.call(this,e,n,i,o,r,$.extend(!0,{btnValidate:!0},s))||this)._callback=a,l}return __extends(n,t),n.prototype.createContainer=function(){var t=this,n=e.bootstrap4,i=['<div class="row">','<div class="col'+(n?"":"-xs")+'-12 bs-filter-list">',"</div>","</div>",'<div class="row">','<div class="col'+(n?"":"-xs")+'-12">','<h5 class="bs-block-title" data-ignore="true">'+(t.options.title||"Filtre")+"</h5>","</div>","</div>",'<div class="row">','<div class="col-sm-4 bs-champ-list">',"</div>",'<div class="col-sm-8 filter-edit">',"</div>","</div>"];t.container=document.createElement("div"),l.addClass(t.container,"bs-filter-view"),t.container.innerHTML=i.join(""),t.champListView=l.query(t.container,".bs-champ-list"),t.filterListView=l.query(t.container,".bs-filter-list"),t.filterEditView=l.query(t.container,".filter-edit")},n.prototype.valideFilters=function(){this._callback("VALIDE")},n}(S),I=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this,r=o;return i.registerListenerFor(r.$bind+".$item",r),o._state(),o}return __extends(t,e),t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.click=function(e){var t=e.target;if("LI"==t.nodeName.toUpperCase()||"SPAN"==t.nodeName.toUpperCase()){var n=t;"SPAN"==t.nodeName.toUpperCase()&&(n=l.parentByTag(this.$element.get(0),t,"LI"));var i=-1;if(n&&(i=parseInt(l.attr(n,"data-id"),10)),i<0)return;n=null;var o=null;if(this.state.value.forEach(function(e,t){if(e.code==i)return o=e.model(),!1}),!o)return;"REMOVE"==l.attr(t,"data-id")?this.form.execAction("remove",o):this.form.execAction("upd",o)}},t.prototype._state2UI=function(){var e=this;e.createContainer(e.id),e.state.value&&e.state.value.forEach(function(t){e.addTag(t)})},t.prototype.destroy=function(){this.form.unRegisterListenerFor(this.$bind+".$item",this),e.prototype.destroy.call(this)},t.prototype.changed=function(e,t,n,i,o){"add"==i?this.addTag(n):"remove"==i&&this.removeTag(o.$value.code)},t.prototype.stateChanged=function(e,t){var n=this.form.getState(this.$bind),i=this.$element?this.$element.get(0):null;i&&n.isHidden!==this.state.isHidden&&(this.state.isHidden=n.isHidden,this.setHidden(i))},t.prototype.addTag=function(e){var t=document.createElement("li");l.addClass(t,"item"),l.addClass(t,"bs-boxed-tags-item"),l.addClass(t,"bs-cursor-p"),l.addClass(t,"btn-primary"),e.selected&&l.addClass(t,"focus"),l.attr(t,"data-id",e.code),t.innerHTML=e.libelle+' <span data-id="REMOVE" class="'+l.iconClass("remove")+'" ></span>',l.append(this.$element.get(0),t)},t.prototype.removeTag=function(e){var t=l.query(this.$element.get(0),'li[data-id="'+e+'"]');l.remove(t)},t.prototype.createContainer=function(e){this.$element=$(i.format('<ul id="{0}" data-render="{0}" class="bs-boxed-tags" draggable="true"></ul>',e))},t.prototype.render=function(e){var t=this._initOptions(r.utils.defaultOptions);return this.$element||(this.setEvents(null),this._state2UI()),this.appendElement(e,t),this.$element},t}(t.AbsField);n.registerControl(I,"array",!1,"tagview");var D=function(){function t(e){this.options=e||{},this._elements=[],this._values=[]}return Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},set:function(e){e&&(this._elements=e,this._notifyChange("elements"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this._values},set:function(e){e&&(this._values=e,this._notifyChange("values"))},enumerable:!0,configurable:!0}),t.prototype._notifyChange=function(e){switch(e){case"elements":l.empty(this.$element.get(0)),this.renderElements(this.elements||[],this.values||[],this.options||{})}},t.prototype.findVal=function(e){var t=-1;return this.values.forEach(function(n,i){if(n==e)return t=i,!1}),t},t.prototype.render=function(e){var t=this;return t.$element||(t.$element=$('<div class="row bs-checkboxlist"></div>'),t.renderElements(t.elements,t.values,t.options),t.setEvents(null)),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},t.prototype.destroy=function(){this._removeEvents(),this.$element=null,this.options=null},t.prototype.removeVal=function(e){var t=this.findVal(e);t>=0&&this.values.splice(t,1)},t.prototype.addVal=function(e){this.values.push(e)},t.prototype.setEvents=function(e){var t=this;t.$element&&t.$element.on("click",function(e){if(!t.options.isDisabled&&!t.options.isReadOnly){var n=l.parentByClass(t.$element.get(0),e.target,"bs-checkboxlist-list");n&&t._toggleEnumByIndex(l.indexOf(n.parentNode,n))}})},t.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},t.prototype.renderElements=function(t,n,i){var o=e.bootstrap4,r=document.createDocumentFragment();if(t.length){i=i||{};var s=$('<div tabindex="0" class="bs-checkboxlist-list col-lg-6 col'+(o?"":"-xs")+'-12 checkbox-inline"><div class="bs-checkboxlist-list-check"><a><span class="'+l.iconClass("square-o")+'"></span></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);t.forEach(function(e,t){var o=s.cloneNode(!0);i.disabled?(l.attr(o,"tabindex","-1"),l.removeClass(o,"bs-pointer"),l.addClass(o,"bs-cursor-disabled")):(l.attr(o,"tabindex","0"),l.addClass(o,"bs-pointer"),l.removeClass(o,"bs-cursor-disabled")),o.firstChild.firstChild.firstChild.className=n&&n.indexOf(e.code)>=0?l.iconClass("check-square-o"):l.iconClass("square-o");var a=o.lastChild;l.append(a,document.createTextNode(e.libelle)),l.append(r,o)})}else{var a=$('<center><div class="bs-lv-nodata">Aucun résultat trouvé ...</div></center>').get(0);l.append(r,a)}l.append(this.$element.get(0),r)},t.prototype._inputs=function(){return this.$element.get(0)},t.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.className=t?l.iconClass("check-square-o"):l.iconClass("square-o")},t.prototype._toggleEnumByIndex=function(e){var t=this;if(e>=0&&e<t.elements.length){var n=t.elements[e],i=t.findVal(n.code),o=t._inputs();i>=0?(t._setItemValue(o.childNodes[e],!1),t.removeVal(n.code),t.options.onSelectItem&&t.options.onSelectItem("remove",{id:e,value:n,data:n})):(t._setItemValue(o.childNodes[e],!0),t.addVal(n.code),t.options.onSelectItem&&t.options.onSelectItem("add",{id:e,value:n,data:n}))}},t}();t.CheckBoxList=D;var M=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(t,e),t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.click=function(e){},t.prototype._state2UI=function(){},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.changed=function(e,t,n,i,o){},t.prototype.stateChanged=function(e,t){},t.prototype._createContainer=function(e,t,n,o){var r=['<div id="{0}" data-render="{0}">','<label for="{0}_input" id="{0}_label" class="'+(n?"":"bs-none")+'">'+(n||"")+"</label>",'<div id="{0}_toolbar"></div>',"<br />",'<div id="{0}_list"></div>','<center id="{0}_paginer"></center>',"</div>"];return i.format(r.join(""),e)},t.prototype._onSelectToolElement=function(e){"search"===e.name&&this._lookup.search(e.value)},t.prototype.createToolBar=function(e,t){if(this.$element&&!this._toolbar){t=$.extend(!0,{},{selectToolElement:this._onSelectToolElement.bind(this)}),this._toolbar=new n.ToolBar([{name:"search",type:"search",right:!1}],t);var i=l.query(this.$element.get(0),"#"+e+"_toolbar");if(!i)return;this._toolbar.render($(i))}},t.prototype._onSelectPaginer=function(e){switch(e){case"next":this._lookup.nextPage();break;case"prev":this._lookup.prevPage();break;case"first":this._lookup.firthPage();break;case"last":this._lookup.lastPage();break;default:this._lookup.toPage(e-1)}},t.prototype.createPaginer=function(e,t){var i=this;if(i.$element){if(!i._pager){t=$.extend({size:"default",boundaryLinks:!0,selectPage:i._onSelectPaginer.bind(i)},t),i._pager=new n.Pager(t);var o=l.query(i.$element.get(0),"#"+e+"_paginer");if(!o)return;i._pager.render($(o))}var r=i._pager;r.props.totalPages=i._lookup.getNbPages(),r.props.currentPage=i._lookup.currentPage()+1}},t.prototype._onSelectCheckBoxList=function(e,t){"add"===e?this.state.value.push({code:t.value.code,lib:t.value.libelle}):"remove"===e&&this.state.value.remove(this.state.value.find("code",t.value.code))},t.prototype._getValues=function(){var e=$.extend(!0,{},this.state.value);return e._items=e._items.map(function(e){return e.code}),e._items},t.prototype.createList=function(e,t){if(this.$element&&!this._list){this._list=new n.CheckBoxList({onSelectItem:this._onSelectCheckBoxList.bind(this)}),this._list.values=this._getValues();var i=l.query(this.$element.get(0),"#"+e+"_list");if(!i)return;this._list.render($(i))}},t.prototype.createLookup=function(e){var t=this;if(t.$schema.ds){t._lookup=new n.DsLookup(t.$schema.ds,{notify:function(e,n){(n=n||{}).inited&&n.updated?t._lookup.firthPage():e&&(t.$schema.ds.data.$params.$search&&t.createToolBar(t.id,{}),t.createList(t.id,{}),t._list.elements=e,t.createPaginer(t.id,t.renderOptions.pager))}})}},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.setEvents(null),t.$element=$(t._createContainer(t.id,a.tt(t.$schema.title,t.form.$locale),t.options.design,n)),t.createLookup({}),t._state2UI()),t.appendElement(e,n),t.$element},t}(t.AbsField);n.registerControl(M,"array",!1,"lookup-list",null);var T=function(e){function t(t,n,o){var r=e.call(this,t,n,o)||this;return r.renderInternal=function(e,t){var n=this;if(n.$element){var i;switch(t.renderModel){case"model2":i=new P(n.listeChamps,n.listeChampsArbre,n.listeFilters,n.listeOperateurs,n.listeTypes,t,function(e,t){"VALIDE"==e&&n.form.execAction("validate",{})});break;default:i=new S(n.listeChamps,n.listeChampsArbre,n.listeFilters,n.listeOperateurs,n.listeTypes,t)}l.append(n.$element.get(0),i.render())}},r.createContainer=function(e){return i.format('<div id="{0}" data-render="{0}" class="bs-filter"></div>',e)},r._state(),r._options=n||{},r.initData(),r}return __extends(t,e),t.prototype.initData=function(){var e=this;e.listeOperateurs=new p,Object.keys(d).forEach(function(t){var n=s.operators[t];e.listeOperateurs.add(t,n.title,n.binary,{symbol:n.symbol})}),e.listeTypes=new v,Object.keys(c).forEach(function(t){var n=s.types[t];e.listeTypes.addType(t,n.title,n.operators)}),e._updateData()},t.prototype._updateData=function(){var e=this;e.listeChamps=new h;var t=e.state.value&&e.state.value.lookups?e.state.value.lookups._model:{};(e.state.value&&e.state.value.champs?e.state.value.champs:[]).forEach(function(n){var i={};n.lookup?(i.lookupSchema=t[n.lookup]||u.getLookup(e.$bind,n.lookup,e.$schema,e.form.$rootSchema),i.lookup=n.lookup,i.format="lookup"):n.enum&&n.enum.length?(i.enum=n.enum,i.enumName=n.enumName,i.format="enum"):"boolean"===n.type?(i.enum=[{code:!0,libelle:s.ui.true},{code:!1,libelle:s.ui.false}],i.format="enum"):(i.decimals=n.decimals,i.format=n.format&&e.listeTypes.get(n.format)?n.format:null),n.type&&e.listeTypes.get(n.type)&&e.listeChamps.add(n.code,n.libelle,n.type,i)});var n=e.state.value&&e.state.value.filters?e.state.value.filters:[];e.listeFilters=new m(n),n.forEach(function(t){var n=[];t.values.forEach(function(e){n.push(e)});var i=[];t.values2&&t.values2.forEach(function(e){i.push(e)}),e.listeFilters.add2(t.code,t.op,i.length?i:n)}),e.listeChampsArbre=e.state.value&&e.state.value.entree&&e.state.value.entree.length?e.state.value.model().entree:null,e.listeChampsArbre?e.listeChampsArbre.forEach(function(e){e.items&&!e.items.length&&delete e.items}):e.listeChampsArbre=e.listeChamps.gets().map(function(e){return{name:e.code,title:e.libelle}})},t.prototype.refresh=function(){this._updateData(),l.empty(this.$element.get(0)),this.renderInternal({data:this.state.value},this._options)},t.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},t.prototype.render=function(e){var t=this,n=t._initOptions(r.utils.defaultOptions);return t.$element||(t.$element=$(t.createContainer(t.id)),l.empty(t.$element.get(0)),n.id=t.id,n.title=t.$schema.title||"",n=$.extend(!0,n,t.renderOptions),t._options=n,t.renderInternal({data:t.state.value},n)),t.appendElement(e,n),t.$element},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(t.AbsField);t.ComposantFilter=T,n.registerControl(T,"object",!1,"filter")}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=t,i=e.filters,o=e.locale,r=i.OPERATORS,s=function(e,t,n,i,o){var r={code:t,libelle:n,type:i,format:(o=o||{}).format||null,decimals:o.decimals,enum:o.enum,enumName:o.enumName,lookup:o.lookup};e.push(r)},a=function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")},l=function(e,t){var n=[];return e.forEach(function(e){t.forEach(function(t){if(e.code===t.code)return e.lib=t.libelle,!1});var i,s=(e.lib||e.code)+" "+(i=e.op,o.operators[i].symbol||"");e.op===r.empty||e.op===r.nempty?s+=" vide":e.op===r.between||e.op===r.nbetween?s+=" "+e.values[0]+" et "+e.values[1]:e.getValueNames?s+=" "+e.getValueNames().join(","):s+=" "+e.values.join(","),n.length&&n.push(" et "),n.push(s)}),n.join("")};t.filter={format:{toPhenix:function(e,t){if(!e||!t)return null;var n=function(e,t){for(var i=[],o=e.length%2!=0,r=o?e.length-1:e.length,s=0;s<r;s+=2)i.push({$left:e[s],$op:t,$right:e[s+1]});return o&&i.push(e[e.length-1]),i.length>=2&&(i=n(i,t)),i},i=[];return t.forEach(function(t){i.push(function(t){var i=e.find(function(e){return e.code==t.code}),o=t.op==r.in?"eq":t.op;o=o==r.nin?"ne":o;var s=t.values.map(function(e){return void 0!==e.code?e.code:e});return o==r.between||o==r.nbetween?o==r.between?a(t.code,i.type,s[0],s[1]):{$op:"not",$right:a(t.code,i.type,s[0],s[1])}:(s=s.map(function(e){var n=null;switch(o){case r.like:n=l(t.code,i.type,e);break;case r.nlike:n={$op:"not",$right:l(t.code,i.type,e)};break;case r.empty:n={$left:t.code,$op:"eq",$right:{type:"string",value:""}};break;case r.nempty:n={$left:t.code,$op:"ne",$right:{type:"string",value:""}};break;default:n={$left:t.code,$op:o,$right:{type:i.type,value:e}}}return n}),n(s,"or")[0]);function a(e,t,n,i){return{$left:{$left:e,$op:r.ge,$right:{type:t,value:n}},$op:"and",$right:{$left:e,$op:r.le,$right:{type:t,value:i}}}}function l(e,t,n){return{$left:"contains("+e+",'"+n+"')",$op:null,$right:null}}}(t))}),n(i,"and")[0]},toMongoDbFilter:function(e,t){if(!e||!t)return null;var n=[];return t.forEach(function(t){e.find(function(e){return e.code==t.code});var i={},o=null,s=t.values.map(function(e){return void 0!==e.code?e.code:e});switch(t.op){case r.between:o={$gte:s[0],$lte:s[1]};break;case r.nbetween:o={$not:{$gte:s[0],$lte:s[1]}};break;case r.in:o=s.length>1?{$in:s}:s[0];break;case r.nin:o=s.length>1?{$nin:s}:{$ne:s[0]};break;case r.gt:o={$gt:s[0]};break;case r.ge:o={$gte:s[0]};break;case r.lt:o={$lt:s[0]};break;case r.le:o={$lte:s[0]};break;case r.like:o={$regex:a(s[0]),$options:"i"};break;case r.nlike:o={$not:{$regex:a(s[0]),$options:"i"}};break;case r.empty:o={$exists:!1};break;case r.nempty:o={$exists:!0}}null!==o&&void 0!==o&&(i[t.code]=o,n.push(i))}),n.length?{$and:n.map(function(e){return e})}:null},toTitle:l},removeMdbFilterExpress:function(e,t,n){return e},addMdbFilterExpress:function(e,t,n){return t},addField:function(e,t,n,i,o,r,a){var l={};l.decimals=o,l.enum=r,l.enumName=a,s(e,t,n,i,l)},addField2:s,transformPropsToFilterFormat:function(e,t){t.forEach(function(t){var i=$.extend(!0,{},t.schema);switch(i.type){case"number":i.decimals>0?i.type="decimal":i.type="integer"}t.schema.enum&&(i.enum=t.schema.enum.map(function(e,n){return{code:e,libelle:t.schema.enumNames?t.schema.enumNames[n]:e}})),n.filter.addField2(e,t.name,i.title,i.type,{decimals:i.decimals,enum:i.enum,format:i.format})})},toTitle:l,mongoDbFilter2Filter:function(e,t){if(!e)return null;if(e&&e.$and){var n=[];if(e.$and.forEach(function(e){var i=Object.keys(e)[0],o=(t.find(function(t){return e.code==t}),{op:"",values:[],code:i});if("object"==typeof(e=e[i])){var s=!1;e.$not&&(s=!0,e=e.$not),void 0!=e.$gte&&void 0!=e.$lte?(o.op=s?r.nbetween:r.between,o.values.push(e.$gte),o.values.push(e.$lte)):e.$in?(o.op=r.in,o.values=e.$in):e.$nin?(o.op=r.nin,o.values=e.$nin):e.$ne?(o.op=r.nin,o.values.push(e.$ne)):e.$gt?(o.op=r.gt,o.values.push(e.$gt)):e.$gte?(o.op=r.ge,o.values.push(e.$gte)):e.$lt?(o.op=r.lt,o.values.push(e.$lt)):e.$lte?(o.op=r.le,o.values.push(e.$lte)):void 0!=e.$exists?o.op=e.$exists?r.nempty:r.empty:e.$regex?(o.op=s?r.nlike:r.like,o.values.push(e.$regex.replace(/\\\$/g,"$").replace(/\\\?/g,"?").replace(/\\\*/g,"*").replace(/\\\+/g,"+").replace(/\\\./g,".").replace(/\\\^/g,"^").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\{/g,"{").replace(/\\\}/g,"}").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\|/g,"|"))):o=null}else o.op=r.in,o.values.push(e);o&&n.push(o)}),n&&n.length)return n}return null}};var u=function(){function e(){this.filterComplex=null,this.filterExpress=null}return e.prototype.constructeFilter=function(){var e=this;return e.filterComplex&&e.filterComplex.value&&e.filterExpress&&e.filterExpress.value?{title:e.filterComplex.title+" et "+e.filterExpress.title,value:{$left:e.filterComplex.value,$op:"AND",$right:e.filterExpress.value}}:e.filterComplex&&e.filterComplex.value?e.filterComplex:e.filterExpress&&e.filterExpress.value?e.filterExpress:{title:"",value:null}},e}();t.FilterManager=u,t.filterManagerFactory=function(){return new u}}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){(e.ui||(e.ui={})).multiSelectUtils={transformPropsToMultiselectFormat:function(e,t,n){var i,o=t&&t.items?t.items:[],r=t&&t.fields?t.fields:[],s=t&&t.items?$.extend(!0,[],o):[];return n?function e(t,n,i){t.forEach(function(t){t.items=t.items||[],e(t.items,t.fields||[],i)}),n.forEach(function(e){i.every(function(t){return e.name!==t.name||(e.title=t.schema.title||t.name,!1)}),t.push(e)})}(s,r,e):(i=s,e.forEach(function(e){var t={name:e.name,title:e.schema.title||e.name},n=function e(t,n){var i=null;return t.every(function(t){return t.name===n?(i=t,!1):!t.items||!(i=e(t.items,n))}),i}(i,e.schema.group);n?(n.items=n.items||[],n.items.push(t)):i.push(t)})),s},transformMultiSelectColumnsToGridColumnsFormat:function(e){var t=[];return e.forEach(function(e){t.push({$bind:e.name,options:{}})}),t},transformSelectedColumnsToMultiSelectFormat:function(e,t,n,i){n=n&&n.items?n.items:[];var o=[];return Object.keys(t).forEach(function(r){(!i||function e(t,n){var i=null;return t.every(function(t){return t.name===n&&(i=t),!t.items&&!t.fields||i||(i=e(t.fields||t.items,n)),!i}),i}(n||[],r))&&e.every(function(e){return e.name!==r||(t[r]&&o.push({name:r,title:e.schema.title||e.name}),!1)})}),o}}}(Phoenix||(Phoenix={})),function(e){!function(t){e.utils,e.ulocale;var n=e.dom,i=(e.Observable.SchemaUtils,function(){function e(e,t,n){var i=this;i._options=$.extend(!0,{mapping:{id:"name",lib:"title"},expandIcon:"plus-circle",collapseIcon:"minus-circle",checkedIcon:"check-square-o",uncheckedIcon:"square-o",itemIcon:"",groupIcon:"",multiSelect:!1,showTags:!1,groupLink:!1,itemLink:!0,border:!1,maxHeight:"300px"},t),i._name=i._options.mapping.id,i._title=i._options.mapping.libelle||i._options.mapping.lib,i._data=e||[],i._callback=n||null,i._nodes=$.extend(!0,[],e),i._selectedItems=[],i._init()}return Object.defineProperty(e.prototype,"items",{get:function(){return this._data},set:function(e){this._data=e||[],this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._constructeNodes(this._nodes,this._options),this._container&&this._renderItems(this._nodes)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){var t=this;t._selectedItems=$.extend(!0,[],e),t._container&&t._selectedItems.forEach(function(e){t.addItem(e[t._name])})},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._constructeNodes(this._nodes,this._options)},e.prototype._getGroupNode=function(e,t){var n=this,i=null;return e.every(function(e){return e.items&&((i=e[n._name]===t?e:null)||(i=n._getGroupNode(e.items,t))),!i}),i},e.prototype._getItemNode=function(e,t){var n=this,i=null;return e.every(function(e){return!(i=e.items||e[n._name]!==t?null:e)&&e.items&&(i=n._getItemNode(e.items,t)),!i}),i},e.prototype._getItem=function(e,t){var n=this,i=null;return e.every(function(e){return e[n._name]===t?(i=e,!1):!e.items||!(i=n._getItem(e.items,t))}),i},e.prototype._getSelectedItemIndex=function(e){var t=this,n=-1;return t._selectedItems.every(function(i,o){return i[t._name]!==e||(n=o,!1)}),n},e.prototype._itemsIsSelected=function(e){var t=this,n=!0;return e.every(function(e){var i=!1;return t._selectedItems.every(function(n){return n[t._name]!=e[t._name]||(i=!0,!1)}),!!i||(n=!1,!1)}),n},e.prototype._itemsIsUnselected=function(e){var t=this,n=!0;return e.every(function(e){return t._selectedItems.every(function(i){return i[t._name]!=e[t._name]||(n=!1,!1)}),!!n}),n},e.prototype._constructeNodes=function(e,t){var i=this;Array.isArray(e)&&e.length&&(!function e(t,o,r,s,a){var l=$(i._template().item).get(0);i._options.border||n.addClass(l,"border-0");t.forEach(function(t){if(t[i._name]){t.level=r||0,t.show=1==s,t.parent=o||null,t.component=l.cloneNode(),t.items&&(t.tagsSize=0,e(t.items,t,t.level+1,!1,a));for(var u=t.parent;u;)u.tagsSize++,u=u.parent;for(var d=1;d<=t.level;d++)n.append(t.component,$(i._template().indent).get(0));if(t.items){var c=i._createIcon(t.component,a.expandIcon,"icon-group bs-cursor-p");if(n.attr(c,"data-event","click"),n.attr(c,"data-action","expand"),a.multiSelect){var p=i._createIcon(t.component,a.uncheckedIcon,"icon-check bs-cursor-p");n.attr(p,"data-event","click"),n.attr(p,"data-action","uncheckG")}else a.groupLink&&(n.attr(t.component,"data-event","click"),n.attr(t.component,"data-action","selectitem"),n.addClass(t.component,"bs-cursor-p"));i._createIcon(t.component,a.groupIcon)}else{var c=i._createIcon(t.component);if(n.addClass(c,"icon-exist"),a.multiSelect&&a.itemLink){var p=i._createIcon(t.component,a.uncheckedIcon,"icon-check bs-cursor-p");n.attr(p,"data-event","click"),n.attr(p,"data-action","uncheck")}else a.itemLink&&(n.attr(t.component,"data-event","click"),n.attr(t.component,"data-action","selectitem"),n.addClass(t.component,"bs-cursor-p"));i._createIcon(t.component,a.itemIcon)}n.append(t.component,$("<span>"+(t[i._title]||t[i._name])+"</span>").get(0)),n.attr(t.component,"data-id",t[i._name])}})}(e,null,0,!0,t),t.showTags&&i._addTags(i._nodes))},e.prototype._addTags=function(e){var t=this;e.forEach(function(e){if(e.items){var i=$(t._template().badge).get(0);n.append(i,document.createTextNode(""+e.tagsSize)),n.append(e.component,i),t._addTags(e.items)}})},e.prototype._template=function(){return{list:'<ul class="list-group bs-treeview"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge badge-pill badge-secondary float-right"></span>'}},e.prototype._createIcon=function(e,t,i){var o=$(this._template().icon).get(0);return t&&this._addIcon(o,t,i),n.append(e,o),o},e.prototype._addIcon=function(e,t,i){n.attr(e,"class","icon icon-exist "+n.iconClass(t)+(i?" "+i:""))},e.prototype._setEvents=function(){var e=this;e._container&&e._container.addEventListener("click",function(t){var i=t.target,o=null;if((o="click"===n.attr(i,"data-event")?i:n.parentByTag(e._container,i,"LI"))&&"click"===n.attr(o,"data-event")){var r=n.parentByTag(e._container,o,"LI"),s=n.attr(r,"data-id"),a=n.attr(o,"data-action");"expand"===a?e._display(s,!0):"collapse"===a?e._display(s,!1):"selectitem"===a?e._select(s,e._callback):"check"===a&&e._options.multiSelect?e._checkF(s,!1,e._callback):"uncheck"===a&&e._options.multiSelect?e._checkF(s,!0,e._callback):"checkG"===a&&e._options.multiSelect?e._checkG(s,!1,e._callback,!0):"uncheckG"===a&&e._options.multiSelect&&e._checkG(s,!0,e._callback,!0)}})},e.prototype._display=function(e,t){var i=this,o=i._getGroupNode(i._nodes,e);if(o){var r=function(e,t){e.forEach(function(e){if(e.show=t,e.items){r(e.items,!1);var o=n.query(e.component,".icon-group");o&&(i._addIcon(o,i._options.expandIcon,"icon-group bs-cursor-p"),n.attr(o,"data-action","expand"))}})};r(o.items,t);var s=n.query(o.component,".icon-group");i._addIcon(s,t?i._options.collapseIcon:i._options.expandIcon,"icon-group bs-cursor-p"),n.attr(s,"data-action",t?"collapse":"expand"),i._renderItems(i._nodes)}},e.prototype._select=function(e,t){var i=n.query(this._container,".active");i&&n.removeClass(i,"active"),this._selectedItems.splice(0);var o=this._getItem(this._nodes,e);o&&(this._showItem(e),n.addClass(o.component,"active"),(o=this._getItem(this._data,e))&&(this._selectedItems.push(o),t&&t({action:"add",data:o})))},e.prototype._unSelect=function(e,t){var i=n.query(this._container,".active");i&&n.removeClass(i,"active");var o=this._getItem(this._selectedItems,e);o&&(this._selectedItems.splice(0),t&&t({action:"remove",data:o}))},e.prototype._checkF=function(e,t,n){var i=this;i._check(e,t,n);var o=i._getItem(i._nodes,e);if(o&&o.parent){var r=i._getItem(i._data,o.parent[i._name]);if(!r)return;t&&i._itemsIsSelected(r.items)?i._checkG(r[i._name],t,n,!1):!t&&i._itemsIsUnselected(r.items)&&i._checkG(r[i._name],t,n,!1)}},e.prototype._check=function(e,t,i){var o=this,r=o._getItem(o._data,e);if(r){var s=o._getItem(o._nodes,e).component,a=n.query(s,".icon-check");o._addIcon(a,t?o._options.checkedIcon:o._options.uncheckedIcon,"icon-check bs-cursor-p"),n.attr(a,"data-action",t?"check":"uncheck");var l=void 0,u=o._getSelectedItemIndex(e);t?u<0&&(o._selectedItems.push(r),l="add"):u>=0&&(o._selectedItems.splice(u,1),l="remove"),i&&l&&i({action:l,data:r})}},e.prototype._checkG=function(e,t,i,o){var r=this,s=r._getItem(r._data,e);if(s){var a=r._getItem(r._nodes,e).component,l=n.query(a,".icon-check");r._addIcon(l,t?r._options.checkedIcon:r._options.uncheckedIcon,"icon-check bs-cursor-p"),n.attr(l,"data-action",t?"checkG":"uncheckG"),o&&s.items.forEach(function(e){e.items?r._checkG(e.name,t,i,o):r._check(e.name,t,i)})}},e.prototype._showItem=function(e){var t=this,i=t._getItem(t._nodes,e);if(i){for(var o=i.parent;o;){s(o.items,!0);var r=n.query(o.component,".icon-group");t._addIcon(r,t._options.collapseIcon,"icon-group bs-cursor-p"),n.attr(r,"data-action","collapse"),o=o.parent}t._renderItems(t._nodes)}function s(e,i){e.forEach(function(e){if(e.show=i,e.items){s(e.items,!1);var o=n.query(e.component,".icon-group");o&&(t._addIcon(o,t._options.expandIcon,"icon-group bs-cursor-p"),n.attr(o,"data-action","expand"))}})}},e.prototype.addItem=function(e){this._options.multiSelect?this._checkF(e,!0):this._select(e)},e.prototype.removeItem=function(e){this._options.multiSelect?this._checkF(e,!1):this._unSelect(e)},e.prototype._renderItems=function(e){n.empty(this._container);var t=document.createDocumentFragment();!function e(t,i){t.forEach(function(t){t.show&&n.append(i,t.component),t.items&&e(t.items,i)})}(e,t),n.append(this._container,t)},e.prototype.render=function(e){var t=this;return t._container||(t._container=$(t._template().list).get(0),t._container.style.maxHeight=t._options.maxHeight,t._options.border||n.addClass(t._container,"noborder"),t._renderItems(t._nodes),t.selectedItems=t._selectedItems,t._setEvents()),e&&n.append(e,t._container),t._container},e}());t.MultiSelectList=i}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e.utils,i=(e.ulocale,e.dom),o=e.drag,r=(e.uiutils,e.events);e.Observable.SchemaUtils;var s=function(){function t(e,t,n){var i=this;i._options=$.extend(!0,{mapping:{id:"name",lib:"title"},removeIcon:"remove",border:!1},t),i._name=i._options.mapping.id,i._title=i._options.mapping.libelle||i._options.mapping.lib,i._data=e||[],i._callback=n||null,i._nodes=$.extend(!0,[],e),i._selectedItems=[],i._init()}return Object.defineProperty(t.prototype,"items",{get:function(){return this._data},set:function(e){this._data=e||[],this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._constructeNodes(this._nodes,this._options),this._container&&this._renderItems()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=$.extend(!0,[],e),this._container&&this._renderItems()},enumerable:!0,configurable:!0}),t.prototype._init=function(){this._constructeNodes(this._nodes,this._options)},t.prototype._constructeNodes=function(e,t){var n=this,o=$(n._template().itemTag).get(0),r=$(n._template().icon).get(0);e.forEach(function(e){e[n._name]&&(e.component=o.cloneNode(),i.append(e.component,document.createTextNode(e[n._title]||e[n._name])),i.attr(e.component,"data-id",e[n._name]),i.append(e.component,r.cloneNode()),e.filter=!0)}),n._input=n._input||$(n._template().itemInput).get(0)},t.prototype._getItem=function(e,t){var n=this,i=null;return e.every(function(e){return e[n._name]!==t||(i=e,!1)}),i},t.prototype._getItemIndex=function(e,t){var n=this,i=-1;return e.every(function(e,o){return e[n._name]!==t||(i=o,!1)}),i},t.prototype._addTag=function(e,t){var n=this._getItem(this._selectedItems,e);n||(n=this._getItem(this._data,e))&&(this._selectedItems.push(n),this._getItem(this._nodes,e).filter=!1,this._renderItems(),t&&t({action:"add",data:n}))},t.prototype._removeTag=function(e,t){var n=this._getItemIndex(this._selectedItems,e);n>=0&&(this._selectedItems.splice(n,1),this._getItem(this._nodes,e).filter=!0,this._renderItems(),t&&t({action:"remove",data:this._getItem(this._data,e)}))},t.prototype._filterList=function(e){var t=this;e.toLowerCase(),t._nodes.forEach(function(n){n.filter=n[t._title].toLowerCase().indexOf(e)>=0&&null==t._getItem(t._selectedItems,n[t._name])});var n=[];t._nodes.forEach(function(e){e.filter&&n.push(e)}),t._menu.show({value:n},0,!0)},t.prototype._setEvents=function(e){var t=this;if(t._container&&(t._container.addEventListener("click",function(e){var n=e.target;n.href&&("#"===i.attr(n,"href")&&(e.preventDefault(),e.stopPropagation()));if(n&&"click"===i.attr(n,"data-event")){if("remove"===i.attr(n,"data-action")){var o=i.parentByTag(t._container,n,"LI"),r=i.attr(o,"data-id");t._removeTag(r,t._callback)}}else t._menu&&t._menu.opened&&t._menu.inMenu(e.target)&&t._menu.click(e);var s=i.query(t._input,"input");s&&s.focus()}),t._container.addEventListener("keyup",function(e){13===e.keyCode&&t._menu&&t._menu.opened&&t._menu.select();var n=i.query(t._input,"input");n&&n.focus()})),t._input){var n=!0;t._input.addEventListener("keyup",function(e){var o=e.target;if(38===e.keyCode||40===e.keyCode);else if(8===e.keyCode){n?t._filterList(o.value):t._menu&&t._menu.opened&&t._menu.hide(o)}else if(13===e.keyCode&&o&&"keyup"===i.attr(o,"data-event")){var r=o;t._addTag(r.value,t._callback),r.value=""}else{t._filterList(o.value);var s=i.query(t._container,".bs-pillbox-item-tag.focus");s&&i.removeClass(s,"focus")}var a=i.query(t._input,"input");a&&a.focus()}),t._input.addEventListener("keydown",function(e){var o=e.target;if(40==e.keyCode&&t._menu&&t._menu.opened)t._menu.move(1);else if(38===e.keyCode&&t._menu&&t._menu.opened)t._menu.move(-1);else if(8===e.keyCode){if(o.value.length<=0&&t._selectedItems.length&&"keyup"===i.attr(o,"data-event")){var r=t._selectedItems[t._selectedItems.length-1],s=t._getItem(t._nodes,r[t._name]);i.hasClass(s.component,"focus")?(i.removeClass(s.component,"focus"),t._removeTag(r[t._name],t._callback)):i.addClass(s.component,"focus"),n=!1}else n=!0}else 9!=e.keyCode&&27!=e.keyCode||t._menu&&t._menu.opened&&t._menu.hide(o);var a=i.query(t._input,"input");a&&a.focus()})}t._drag=o.dragManager.addDrag([t._container]),t._drag.canStartDragHandler=t._canStartDrag.bind(t),t._drag.onDragStart=t._onDragStart.bind(t),t._drag.onDrag=t._onDrag.bind(t),t._drag.onDragEnd=t._onDragEnd.bind(t)},t.prototype._template=function(){return{list:'<ul class="bs-pillbox noborder"></ul>',itemTag:'<li class="bs-pillbox-item bs-pillbox-item-tag" data-drag="move"></li>',icon:'<span class="icon float-right '+i.iconClass(this._options.removeIcon)+' icon-remove bs-cursor-p" data-event="click" data-action="remove"></span>',itemInput:'<li class="bs-pillbox-item bs-pillbox-item-edit"><input autocomplete="off" autofocus="true" placeholder="..." data-event="keyup" data-action="add,remove" /></li>'}},t.prototype.addItem=function(e){this._addTag(e)},t.prototype.removeItem=function(e){this._removeTag(e)},t.prototype._canStartDrag=function(e){var t=this,o=e.target,r=i.parentByTag(t._container,o,"LI");if(r){var s=i.attr(r,"data-drag");if(!s)return!1;r.id||(r.id=n.allocID());var a=t._drag;if(a.coverDocument=!0,a.data.op=s,a.data.cloneId=r.id,a.data.column=i.attr(r,"data-id"),!a.data.column)return!1;var l=i.find(t._container,a.data.cloneId);a.cursor="move",a.moveX=!0,a.moveY=!0,a.startOffset=i.position(l,null);var u={top:0,height:l.offsetHeight},d=[];return t.selectedItems.forEach(function(e){var o=i.query(t._container,"li[data-id='"+e[t._name]+"']");o&&(o.id||(o.id=n.allocID()),d.push({htmlId:o.id,info:e}))}),a.data.childrenPositions=i.childrenPositions(t._container,d,!1,"free",u),!0}},t.prototype._onDragStart=function(e){var t=this._drag;if(!t.data.op)return!1;var n=i.find(this._container,t.data.cloneId),o=n.cloneNode(!0),r=i.position(n,null);return o.style.top=r.top+"px",o.style.left=r.left+"px",o.style.width=n.offsetWidth+"px",o.style.height=n.offsetHeight+"px",o.style.zIndex="5000",o.style.position="absolute",o.style.cursor="move",t.floatElement=o,i.append(document.body,t.floatElement),!0},t.prototype._onDrag=function(e){var t=this._drag;if(!t.data.op)return!1;var n=r.point(e),o=i.findNearest(n.x,n.y,t.data.childrenPositions);if(t.data.best!=o){var s={left:o.left,top:o.top,width:o.width,height:o.height};t.data.mdiv=i.showMove(t.data.mdiv,o.vertical,s,"bs-drag-color-info")}return t.data.best=o,!0},t.prototype._onDragEnd=function(e,t){var n=this,o=n._drag;if(!o.data.op)return!1;if(o.floatElement&&(i.remove(o.floatElement),o.floatElement=null),o.data.mdiv&&(i.remove(o.data.mdiv),o.data.mdiv=null),!e){if(o.data.best&&o.data.column){var r=o.data.best.info;if("empty"===o.data.best.position||r[n._name]===o.data.column)return;var s=n._getItem(n._selectedItems,o.data.column),a=n._getItemIndex(n._selectedItems,o.data.column);n.selectedItems.splice(a,1);var l=n._getItemIndex(n._selectedItems,r[n._name]);l="after"===o.data.best.position?l+1:l,n.selectedItems.splice(l,0,s),n._callback&&n._callback({action:"drag",srcIndex:a,destIndex:l,data:s})}n._renderItems();var u=i.query(n._input,"input");u&&u.focus()}},t.prototype._onMenuSelectItemHandler=function(e){if(e){this._addTag(e[this._name],this._callback);var t=i.query(this._input,"input");t&&(t.value="")}},t.prototype._includeDropDownMenu=function(){if(this._input){var t=i.query(this._input,"input");$(this._input).get(0).style.zIndex="3000",this._menu=new e.formdropitems.DropItems($(this._input),t,{primaryKey:this._name,search:this._title,onselect:this._onMenuSelectItemHandler.bind(this)})}},t.prototype._renderItems=function(){var e=this;i.empty(e._container);var t,n,o=document.createDocumentFragment();t=e._selectedItems,n=o,t.forEach(function(t){var o=e._getItem(e._nodes,t[e._name]);o&&(o.filter=!1,i.append(n,o.component))}),e._input&&i.append(o,e._input),i.append(e._container,o)},t.prototype.render=function(e){return this._container||(this._container=$(this._template().list).get(0),this._renderItems(),this._includeDropDownMenu(),this._setEvents(e)),e&&i.append(e,this._container),this._container},t.prototype.remove=function(){this._menu=null,this._drag&&(o.dragManager.rmvDrag(this._drag),this._drag=null)},t}();t.PillBox=s}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r,s;t=e.ui||(e.ui={}),n=t,i=e.utils,e.uiutils,e.ulocale,r=e.dom,o=e.uiutils,e.Observable.SchemaUtils,s=function(e){function n(t,n,i){var o=e.call(this,t,n,i)||this,r=o;r._state();var s=r.state.value.model().entree||[];return s=s.map(function(e){return e.items&&!e.items.length&&delete e.items,e}),r._sortie=r.state.value.sortie||[],r._options=$.extend(!0,{mapping:{id:"name",lib:"title"},multiSelect:!0,pillBox:!0,renderModel:"top",maxHeight:"300px"},r.renderOptions),r._name=r._options.mapping.id,r._title=r._options.mapping.libelle||r._options.mapping.lib,Array.isArray(s)&&(r._initMultiSelectList(s,r.state.value.model().sortie),r._options.pillBox&&r._initPillBox(r._extractItems(s,!1),r.state.value.model().sortie)),o}return __extends(n,e),n.prototype._initMultiSelectList=function(e,n){var i=this;i.multiSelectList||(i.multiSelectList=new t.MultiSelectList(e,i._options,function(e){if("add"===e.action)i.pillBox&&i.pillBox.addItem(e.data[i._name]),i._sortie.push(e.data);else if("remove"===e.action){i.pillBox&&i.pillBox.removeItem(e.data[i._name]);var t=i._getSortieItem(i._sortie,e.data[i._name]);t&&i._sortie.remove(t.data)}})),i.multiSelectList.selectedItems=n||[]},n.prototype._initPillBox=function(e,n){var i=this;i.pillBox=new t.PillBox(e,i._options,function(e){if("add"===e.action)i.multiSelectList.addItem(e.data[i._name]),i._sortie.push(e.data);else if("remove"===e.action){i.multiSelectList.removeItem(e.data[i._name]);var t=i._getSortieItem(i._sortie,e.data[i._name]);t&&i._sortie.remove(t.data)}else if("drag"===e.action){var n=i._getSortieItem(i._sortie,e.data[i._name]);i._sortie.remove(n.data),i._sortie.splice(e.destIndex,0,e.data)}}),i.pillBox.selectedItems=n||[]},n.prototype._getSortieItem=function(e,t){var n=this,i=null;return e.forEach(function(e,o){return e[n._name]!==t||(i={id:o,data:e},!1)}),i},n.prototype._extractItems=function(e,t){var n=[];return function e(t,n,i){t.forEach(function(t){t.items?(i&&n.push(t),e(t.items,n,i)):n.push(t)})}(e,n,t),n},n.prototype._state=function(){var e=this;e.state=e.state||{};var t=e.form.getState(e.$bind);Object.keys(t).forEach(function(n){e.state[n]=t[n]}),e.state.value=e.form.getValue(e.$bind)},n.prototype._state2UI=function(){},n.prototype.changed=function(e,t,n,i,o){var r=this;r._sortie=r.state.value.sortie||[];var s=r.state.value.model().entree||[];s=s.map(function(e){return e.items&&!e.items.length&&delete e.items,e});var a=r.state.value.model().sortie||[];r.multiSelectList&&(r.multiSelectList.items=s,r.multiSelectList.selectedItems=a),r.pillBox&&(r.pillBox.items=r._extractItems(s,!1),r.pillBox.selectedItems=a)},n.prototype._template=function(e){var t;switch(this._options.renderModel){case"left":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>","</div>"];break;case"right":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>","</div>"];break;case"bottom":t=['<div id="{0}" data-render="{0}">','<div id="{0}_multiselect">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_pillbox">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>"];break;default:t=['<div id="{0}" data-render="{0}">','<div id="{0}_pillbox">','<h5 class="bs-block-title">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_multiselect">','<h5 class="bs-block-title">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>"]}return i.format(t.join(""),e)},n.prototype.render=function(e){var t=this,n=t._initOptions(o.utils.defaultOptions);if(!t.$element){t.$element=$(t._template(t.id));var i=t.$element.get(0);if(!t._options.pillBox){var s=r.find(i,t.id+"_pillbox");s&&r.addClass(s,"bs-none")}if(t.pillBox){var a=r.query(i,'div[data-id="pillbox"]');t.pillBox.render(a)}if(t.multiSelectList){var l=r.query(i,'div[data-id="multiselect"]');t.multiSelectList.render(l)}}return t.appendElement(e,n),t.$element},n}(t.AbsField),t.ComposantMultiSelect=s,n.registerControl(s,"object",!1,"multiselectlist",null)}(Phoenix||(Phoenix={})),function(e){var t=e.formgrid,n=e.ui;!function(i){var o={filter:{champs:[],filters:[],entree:[]}};t.toolBarFactory=function(t){var i=null,o=t.fieldOptions,r=[];if(o.toolbar&&o.toolbar.items&&$.extend(!0,{},o.toolbar).items.forEach(function(e){if(e.name=e.name||e.type,e.lookup){var i=null;i=new n.DsLookup(t.$schemaItems.lookups[e.lookup],{notify:function(n,o){if((o=o||{}).inited&&o.updated)i.firthPage();else if(n){e.value=e.value||{};var r={default:e.value.default,items:[],upd:!0};r.items=n||[],t.toolBar.setValue(e.name,r)}}})}if("count"===e.type)e=$.extend({right:!0,value:t.state.value.totalCount()},e);else if("filter"===e.type)e=$.extend({value:"",icon:"filter"},e),t.state.value.filterManager=t.state.value.filterManager||(n.filterManagerFactory?n.filterManagerFactory():null);else if("multiselect"===e.type){var s=!!(o.selecting&&o.selecting.row&&o.selecting.multiselect);e=$.extend(e,{style:"default",icon:"check",value:s})}else"filterexpress"===e.type&&(e=$.extend(e,{fields:t.getColumnsForFilterExpress(e.fields)}),t.state.value.filterManager=t.state.value.filterManager||(n.filterManagerFactory?n.filterManagerFactory():null));r.push(e)}),r.length){var s={selectToolElement:function(t){var i=this,o=t.name||t.id;if("filter"===t.type&&e.formgrid.glbGridFilter){var r=!i.state.value.isQuery;return e.formgrid.glbGridFilter(i.getColumnsForFilter(r),function(e){r?i.state.value&&(i.state.value.filterManager.filterExpress=null,i.state.value.filter=e.value):(i.state.value.filterManager.filterComplex=e,i.state.value.filter=i.state.value.filterManager.constructeFilter())})}if("filterexpress"===t.type){var s=!i.state.value.isQuery;if(s){var a=i.getColumnsForFilter(s),l=i.state.value.filterManager.filterExpress?i.state.value.filterManager.filterExpress.value:null,u=t.value.value,d=i.state.value.filter;d&&(d=n.filter.removeMdbFilterExpress(d,l,a.schemaColumns)),i.state.value.filterManager.filterExpress=t.value,d=n.filter.addMdbFilterExpress(d,u,a.schemaColumns),i.state.value.filter=d}else i.state.value.filterManager.filterExpress=t.value,i.state.value.filter=i.state.value.filterManager.constructeFilter()}else{if("settings"===t.type&&e.formgrid.glbGridSettings){var c=i.getColumnsForSettings();return c.options=t.toolData,e.formgrid.glbGridSettings(c,function(e){i.setColumns(e)})}"multiselect"===t.type?i.toggleMultiselect():i.form.execAction(i.$bind+".$toolbar."+o,{toolElement:t,control:i})}}.bind(t),gridControl:t,composition:!t.state.value.isQuery,schema:t.$schema,form:t.form,bind:t.$bind,schemaItems:t.$schemaItems};i=new n.ToolBar(r,s)}return i},t.toolBarRender=function(e,t,n){t.render(e,n)},t.glbGridFilter=function(t,i,r){t.schemaColumns.length&&(void 0!==t.filters&&(o.filter.filters=t.filters),o.filter.champs.length&&o.filter.champs.splice(0),n.filter.transformPropsToFilterFormat(o.filter.champs,t.schemaColumns),o.filter.entree&&(o.filter.entree=n.multiSelectUtils.transformPropsToMultiselectFormat(t.schemaColumns,t.schemaGroups)),n.OpenModalForm({title:"Filtre",buttons:[{pattern:"validate"}]},{name:"filtre",$type:"block",$items:[{$type:"block",$items:[{$bind:"filter",$widget:"filter",options:{renderModel:"model1"}}]}],form:!0},{type:"object",properties:{filter:{type:"object",title:"Filtre",properties:{champs:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},type:{type:"string"},format:{type:"string"},decimals:{type:"number"},enumName:{type:"string"},enum:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"}}}},lookup:{type:"string"}}}},filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},op:{type:"string"},values:{type:"array",items:{type:"string"}},values2:{type:"array",items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}}}},entree:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}}}},definitions:{}},o,r,function(r,s,a,l){switch(s.property){case"validate":if(!a.validate())return;var u=null;(o=a.model()).filter.filters.length&&(u=t.mongoFilter?n.filter.format.toMongoDbFilter(o.filter.champs,o.filter.filters):n.filter.format.toPhenix(o.filter.champs,o.filter.filters)),i&&i({value:u,title:e.ui.filter.toTitle(o.filter.filters,o.filter.champs)}),r.close()}}))},t.glbGridSettings=function(e,t,i){e.options=e.options||{};var o={mselect:{entree:n.multiSelectUtils.transformPropsToMultiselectFormat(e.schemaColumns,e.schemaGroups,e.options.columnsLimited),sortie:n.multiSelectUtils.transformSelectedColumnsToMultiSelectFormat(e.schemaColumns,e.selectedColumns,e.schemaGroups,e.options.columnsLimited)}},r={title:e.locale&&e.locale.settingsTitle?e.locale.settingsTitle:"Options",buttons:[{pattern:"validate"}]};n.OpenModalForm(r,{name:"settings",$type:"block",$items:[{$type:"block",$items:[{$bind:"mselect",$widget:"multiselectlist",options:{multiSelect:!0}}]}],form:!0},{type:"object",properties:{mselect:{type:"object",properties:{entree:{type:"array",items:{$ref:"#/definitions/elt"}},sortie:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"}}}}}}},definitions:{elt:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}},o,i,function(e,i,o,r){switch(i.property){case"validate":if(!o.validate())return;var s=o.model().mselect.sortie;if(s<=0)return;var a=n.multiSelectUtils.transformMultiSelectColumnsToGridColumnsFormat(s);t&&t(a),e.close()}})},t.glbMongoFilter2Filter=n.filter.mongoDbFilter2Filter}(e.gridHandlers||(e.gridHandlers={}))}(Phoenix||(Phoenix={})),function(e){!function(t){var n=e.dom,i=t,o=e.utils,r=e.locale,s=e.uiutils,a=e.Observable.SchemaUtils,l=e.link,u=function(){function e(e,t){this.id=o.allocID(),this.config=e||{},this.options=t||{}}return e.prototype.getValue=function(){return this.config.value},e.prototype.setValue=function(e){this.config.value=e,this.update()},e.prototype.setOptions=function(e){this.options=$.extend(!0,this.options,e),this.updateRender()},e.prototype.createElement=function(e,t,n){return o.format('<div data-tool-id="{0}" class="bs-toolbar-item">A</div>',this.id)},e.prototype.refresh=function(){this.update(),this.updateRender()},e.prototype.beforeAppend=function(){},e.prototype.after=function(){},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=$(t.createElement(t.config.id,t.config,t.config.value)),t._setEvents(),t.beforeAppend()),e&&n.append(e.get(0),t.$element.get(0)),t.$element},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this.options=null,this.config=null},e.prototype._setEvents=function(){},e.prototype._removeEvents=function(){},e.prototype.update=function(){},e.prototype.updateRender=function(){},e}();t.ToolElement=u;var d=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,n){var i=[];t.style&&i.push(t.style);var r=t.widget=t.widget||"h4",s=['<div data-tool-id="{0}" class="bs-toolbar-item">',"<"+r+' class="'+i.join(" ")+'" style="display:inline-block" data-id="title">',t.value||"","</"+r+">","</div>"];return o.format(s.join(""),this.id)},t.prototype.update=function(){if(this.$element){var e=n.query(this.$element.get(0),this.config.widget+'[data-id="title"]');n.text(e,this.config.value)}},t}(u);t.ToolElementTitle=d;var c=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,n){var i=[];t.style&&i.push(t.style);t.widget=t.widget||"h4";var r=['<div data-tool-id="{0}" class="bs-toolbar-item">','<span class="'+i.join(" ")+" "+(t.value||"")+'"></span>',"</div>"];return o.format(r.join(""),this.id)},t}(u);t.ToolElementIcon=c;var p=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,i){var r=["bs-button btn"],s=n.bootstrapStyles().secondary;t.style=t.style.trim(),t.style&&(s=t.style,"default"===(s=n.bootstrapStyles(!0).secondary)&&(s=n.bootstrapStyles(!0).secondary)),r.push("btn-"+s);var a=['<div data-tool-id="{0}" class="bs-toolbar-item">','<button id="toolbar-item'+(t.name?"-"+t.name:"")+'" toolClick="'+e+'" type="button" class="'+r.join(" ")+'">',t.icon?'<span class="'+n.iconClass(t.icon)+'" toolClick="'+e+'" ></span>':"",t.title?"&nbsp;"+t.title:"","</button>","</div>"];return o.format(a.join(""),this.id)},t}(u);t.ToolElementButton=p;var h=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.createElement=function(e,t,n){var i=['<span data-tool-id="{0}" tool="'+e+'" class="'+["badge-secondary","form-control-plaintext","bs-toolbar-item","bs-toolbar-item-count"].join(" ")+'">'+n+"</span>"];return o.format(i.join(""),this.id)},t.prototype.update=function(){this.$element&&n.text(this.$element.get(0),this.config.value)},t}(u);t.ToolElementCount=h;var f=function(t){function i(e,n){return t.call(this,e,n)||this}return __extends(i,t),i.prototype.createElement=function(t,i,r){var s=[];i.actions&&i.actions.forEach(function(t){e.bootstrap4?s.push('<a href="#" class="dropdown-item" data-id="'+t.code+'">'+(t.lib||t.code)+"</a>"):s.push('<li data-id="'+t.code+'"><a href="#" data-id="'+t.code+'">'+(t.lib||t.code)+"</a></li>")});var a=[];i.title||i.icon||a.push('<span class="'+n.iconClass("bars")+'"></span> '),i.icon&&a.push('<span class="'+n.iconClass(i.icon)+'"></span> '),i.title&&a.push(" "+i.title+" ");var l=['<div  data-tool-id="{0}" tabindex="'+t+'" class="'+["bs-toolbar-item dropdown"].join(" ")+'">','<button class="bs-button btn btn-'+n.bootstrapStyles(!0).secondary+' dropdown-toggle" id="tooltip-dropdown-'+t+'" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',a.join(""),"</button>",e.bootstrap4?'<div class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-'+t+'" data-id="toolCommands">':'<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-'+t+'" data-id="toolCommands">',s.join(""),e.bootstrap4?"</div>":"</ul>","</div>"];return o.format(l.join(""),this.id)},i.prototype.click=function(e){var t=e.target,i=n.attr(t,"data-id");i&&this.options.callback&&this.options.callback({id:this.config.id,name:this.config.name,type:this.config.type,value:i,toolData:this.config})},i}(u);t.ToolElementDropdownAction=f;var m=function(e){function t(t,n){var i=e.call(this,t,n)||this,s=i;s._form=s.options.form,s._schema=s.options.schema,s._schemaItems=s.options.schemaItems,s._bind=s.options.bind,s._grid=s.options.gridControl,s._selected=[],t.links=t.links||[],t.title=t.title||r.ui.Actions,t.options=t.options||{},void 0===t.options.caret&&(t.options.caret=!0),t.options.type=t.options.type||"secondary",t.options.titleIsHidden&&(t.options.icon=t.options.icon||t.right?"ellipsis-v":"bars");var a=s._schema.links||{};return t.links.forEach(function(e){e.id=o.allocID(),a[e.name]?(e.options=e.options||{},e.options.type=e.options.type||"secondary",e.schema=a[e.name],e.bind=s._bind+".$links."+e.name,e.isHidden=!1,s._form.registerListenerFor(e.bind,s)):console.log("Invalid link name: "+e.name)}),s._form.registerListenerFor(s._bind,s),s._updateselected(),s._state(),i}return __extends(t,e),t.prototype.beforeAppend=function(){this._state2Ui()},t.prototype._state2Ui=function(){var e=this,t=0;if(e.config.links.forEach(function(i){var o=!i.state.isHidden;if(o&&i.schema.select&&(e._selected.length?i.schema.select.multiselect||(o=1===e._selected.length):o=!1),o&&!i.important&&t++,e.$element){var r=n.find(e.$element.get(0),i.id);o?n.removeClass(r,"bs-none"):n.hasClass(r,"bs-none")||n.addClass(r,"bs-none"),o&&(i.state.isDisabled?n.hasClass(r,"disabled")||n.addClass(r,"disabled"):n.removeClass(r,"disabled"))}}),e.$element){var i=n.find(e.$element.get(0),"actions_"+e.id);t?n.removeClass(i,"bs-none"):n.hasClass(i,"bs-none")||n.addClass(i,"bs-none")}},t.prototype._updateselected=function(){var e=this._form.getValue(this._bind);e&&(this._selected=e.getSelectedItems(this._grid.renderOptions.expandingProperty))},t.prototype._stateOfLink=function(e){var t=this._form.getState(e.bind);e.state=e.state||{},Object.keys(t).forEach(function(n){e.state[n]=t[n]})},t.prototype._state=function(){var e=this;e.config.links.forEach(function(t){e._stateOfLink(t)})},t.prototype.findLinkByBind=function(e){for(var t=0;t<this.config.links.length;t++)if(this.config.links[t].bind===e)return this.config.links[t];return null},t.prototype.findLinkById=function(e){for(var t=0;t<this.config.links.length;t++)if(this.config.links[t].id===e)return this.config.links[t];return null},t.prototype.stateChanged=function(e,t){if(e&&t&&t.property&&t.property.indexOf(".$links")>=0){var n=this.findLinkByBind(t.property);n&&(this._stateOfLink(n),this._state2Ui())}},t.prototype.changed=function(e,t,n,i,o){if(this.$element){var r=e.substr(this._bind.length);if(!(r.indexOf(".$selected")>=0||r.indexOf(".$links")>=0||"propchange"!==i&&"add"!==i&&"remove"!==i))if(e===this._bind)this._updateselected(),this._state2Ui();else{var s=e,l=a.parsePath(this._bind,s,this._grid.renderOptions.expandingProperty);if(o[l]){var u=e.substr(l.length+1);if(!u)return;a.isSelectField(u)&&(this._updateselected(),this._state2Ui())}}}},t.prototype._createImportantActions=function(e){var t=this;t.config.links.forEach(function(i){if(i.important){e.push('<div id="'+i.id+'" class="bs-toolbar-item'+(t.config.right?" right":"")+' " title="'+o.escapeHtml(i.schema.title)+'">');var r=!1;void 0!==i.options.outline?r=i.options.outline:["default","info","secondary","danger"].indexOf(i.options.type)>=0&&(r=!0),e.push('<button data-action-id="'+i.id+'" class="bs-button btn btn-'+n.bootstrapStyles(r)[i.options.type]+'" type="button">');var s=!1;i.options.icon&&(s=!0,e.push('<span data-action-id="'+i.id+'" class="'+n.iconClass(i.options.icon)+'"></span>')),!i.options.titleIsHidden&&i.schema.title&&e.push('<span data-action-id="'+i.id+'" '+(s?'class="d-none d-md-inline-block">&nbsp;':">")+o.escapeHtml(i.schema.title)+"</span>"),e.push("</button>"),e.push("</div>")}})},t.prototype._createMenuActions=function(e){this.config.links.forEach(function(t){t.important||e.push('<a id="'+t.id+'" data-action-id="'+t.id+'" href="#" class="dropdown-item">'+o.escapeHtml(t.schema.title)+"</a>")})},t.prototype.createElement=function(e,t,i){var r=[];return r.push('<div  data-tool-id="{0}" tabindex="{1}" class="bs-toolbar-item '+(this.config.right?" right":"")+(this.config.bottom?" bottom":"")+'">'),this._createImportantActions(r),r.push('<div class="dropdown">'),r.push('<button id="actions_{0}" title="'+o.escapeHtml(t.title)+'" class="bs-button btn btn-'+n.bootstrapStyles(!0)[t.options.type]+(t.options.caret?" dropdown-toggle":"")+'" id="tooltip-dropdown-{1}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),t.options.icon&&r.push('<span class="'+n.iconClass(t.options.icon)+'"></span>'),t.options.titleIsHidden||r.push('<span class="d-none d-md-inline-block">&nbsp;'+o.escapeHtml(t.title)+" </span>"),r.push("</button>"),r.push('<div class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-{1}" data-id="toolCommands">'),this._createMenuActions(r),r.push("</div>"),r.push("</div>"),r.push("</div>"),o.format(r.join(""),this.id,e)},t.prototype.destroy=function(){var t=this;t._bind&&(t._form.unRegisterListenerFor(t._bind,t),t._bind=null),t.config&&t.config.links.forEach(function(e){t._form.unRegisterListenerFor(e.bind,t)}),t._grid=null,t._form=null,t._schema=null,t._schemaItems=null,e.prototype.destroy.call(this)},t.prototype.click=function(e){var t=e.target;t.href&&e.preventDefault();var i=n.attr(t,"data-action-id");if(i){var o=this.findLinkById(i);o&&(o.isHidden||o.state.isDisabled||o.state.isHidden||this._form.execAction(o.bind,o.schema.select?this._selected:null),this._grid&&this._grid.setFocus())}},t}(u);t.ToolElementArrayAction=m;var v=function(e){function t(t,n){var i=e.call(this,t,n)||this;return t.value=t.value||{},t.value.default=l.context().$url.idTra,t.value.items=t.value.items||[],i}return __extends(t,e),t.prototype.createElement=function(e,t,n){var i=[];t.value.items&&t.value.items.forEach(function(e){i.push('<option value="'+e.code+'" '+(t.value.default==e.code?"selected":"")+">"+(e.lib||e.code)+"</option>")});var r=['<div data-tool-id="{0}" tabindex="'+e+'" class="'+["bs-toolbar-item"].join(" ")+'">','<div class="input-group">','<span class="input-group-prepend">','<span class="input-group-text">',t.title||"","</span>","</span>",'<select class="form-control" data-id="toolSelect">',i.join(""),"</select>","</div>","</div>"];return o.format(r.join(""),this.id)},t.prototype._select=function(){if(this.$element&&this.$element.get(0))return n.query(this.$element.get(0),"select[data-id='toolSelect']")},t.prototype.update=function(){var e=this;if(e.$element){var t=document.createDocumentFragment();e.config.value.items&&e.config.value.items.forEach(function(i){n.append(t,$('<option value="'+i.code+'" '+(e.config.value.default==i.code?"selected":"")+">"+(i.lib||i.libelle||i.code)+"</option>").get(0))});var i=e._select();i&&(n.empty(i),n.append(i,t))}},t.prototype._setEvents=function(){var e=this,t=e._select();t&&$(t).change(function(t){var n=t.target,i=n.options[n.selectedIndex];e.options.callback&&e.options.callback({id:e.config.id,name:e.config.name,type:e.config.type,value:i.value,toolData:e.config})})},t.prototype._removeEvents=function(){var e=this._select();e&&$(e).off("change")},t}(u);t.ToolElementSelect=v;var g=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.config.value="",i.oldValue="",i}return __extends(t,e),t.prototype.createElement=function(e,t,i){var r=['<div data-tool-id="{0}" tabindex="'+e+'" class="bs-toolbar-item input-group'+[].join(" ")+'">','<input toolKeyup="'+e+'" type="text" class="form-control" placeholder="'+(t.title||"Recherche")+'" />','<span class="input-group-append">','<button toolClick="'+e+'" class="bs-button btn btn-'+n.bootstrapStyles(!0).secondary+'" type="button">','<span toolClick="'+e+'" class="'+n.iconClass(t.icon||"search")+'"> </span>',"</button>","</span>","</div>"];return o.format(r.join(""),this.id)},t.prototype.update=function(){if(this.$element){var e=n.query(this.$element.get(0),"input");e&&(e.value=this.config.value)}},t.prototype.getValue=function(){return this.oldValue=this._getInputValue(),this.oldValue},t.prototype._getInputValue=function(){if(this.$element){var e=n.query(this.$element.get(0),"input");return e?e.value:null}},t.prototype._setEvents=function(){var e=this;if(e.$element){var t=e.$element.get(0);if(t){var i=n.query(t,"input"),o=n.query(t,"button");i.addEventListener("focus",function(e){i.select()}),t.addEventListener("blur",function(t){var n=t.explicitOriginalTarget&&t.explicitOriginalTarget!=o&&null==t.relatedTarget;n=n||(null==t.relatedTarget||t.relatedTarget&&t.relatedTarget!=o)&&void 0==t.explicitOriginalTarget,t.target==i&&n&&(e.config.value=" ",e.setValue(e.oldValue))},!0)}}},t}(u);t.ToolElementSearch=g;var y=function(o){function r(e,t){var n=o.call(this,e,t)||this,i=n;return i.config.value=e.fields||i.config.value,i._init(),n}return __extends(r,o),r.prototype._init=function(){var e=this,n=e.options||{};e.filterExpress=new i.FilterExpress(e.config.fields||[],function(n){if(e.options.callback){var o=null;(n=n?Array.isArray(n)?n:[n]:null)&&n.length&&(o=e.options.mongoDbFilter?t.filter.format.toMongoDbFilter(e.config.fields,n):i.filter.format.toPhenix(e.config.fields,n));var r="";o&&(r=e._formatTitle(e.config.fields,n)),e.options.callback({id:e.config.id,name:e.config.name,type:e.config.type,value:{title:r,value:o},toolData:e.config})}},n)},r.prototype.createElement=function(t,n,i){return e.utils.format('<div data-tool-id="{0}" class="bs-toolbar-item '+[].join(" ")+'"></div>',this.id)},r.prototype.render=function(e){var t=this;return t.$element||(t.$element=$(t.createElement(t.config.id,t.config,t.config.value)),t.filterExpress&&t.filterExpress.render(t.$element)),e&&n.append(e.get(0),t.$element.get(0)),t.$element},r.prototype.updateRender=function(){n.empty(this.$element.get(0)),this._init(),this.filterExpress&&this.filterExpress.render(this.$element)},r.prototype._formatTitle=function(e,n){return t.filter.format.toTitle(n,e)},r.prototype.update=function(){this.$element&&(this.config.value=this.config.fields||this.config.value||[],this.filterExpress.fields=this.config.value)},r}(u);t.ToolElementFilterExpress=y;var _=function(t){function i(e,n){return t.call(this,e,n)||this}return __extends(i,t),i.prototype.createElement=function(t,i,r){var s=['<div data-tool-id="{0}" class="bs-toolbar-item">','<button toolClick="'+t+'" type="button" class="'+["bs-button btn btn-"+n.bootstrapStyles(!0).secondary].join(" ")+'">',i.icon?'<span toolClick="'+t+'" class="'+n.iconClass(i.icon)+'"></span>':"",i.title?"&nbsp;"+i.title:"","</button>",'<span class="bs-toolbar-item-filter '+(e.bootstrap4?"form-control-plaintext":"form-control-static")+' bs-cursor-h"></span>',"</div>"];return o.format(s.join(""),this.id)},i.prototype.addTooltip=function(e){var t=$('<span data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title= "'+e+'"> '+e+" </span>"),i=n.query(this.$element.get(0),".bs-toolbar-item-filter");n.empty(i),n.append(i,t.get(0)),t.tooltip&&t.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="text-align:left"></div></div>'})},i.prototype.update=function(){this.$element&&this.addTooltip(this.config.value)},i.prototype.render=function(e){t.prototype.render.call(this,e);this.addTooltip(this.config.value)},i}(u);t.ToolElementFilter=_;var b=function(){function t(e,t){this.id=o.allocID(),this.options=t||{},this._map={},this.toolElements=e||[],this._schema=t.schema,this._form=t.form,this._schemaItems=t.schemaItems,this._bind=t.bind}return t.prototype.getSubControls=function(){var e=null;return this.toolElements.forEach(function(t){"control"===t.type&&(e=e||[],t.options=t.options||{},t.options.inline=!0,t.options._parentId=o.allocID(),e.push(t))}),e},t.prototype.addSubControls=function(e){this._subcontrols=this._subcontrols||[],this._subcontrols.push(e)},t.prototype.getChildren=function(){if(!this._subcontrols)return null;var e=[];return this._subcontrols.forEach(function(t){e.push({control:t,parent:t.fieldOptions._parentId})}),this._subcontrols=null,e},Object.defineProperty(t.prototype,"form",{get:function(){return this._form},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"schemaItems",{get:function(){return this._schemaItems},enumerable:!0,configurable:!0}),t.prototype.htmlRoots=function(){var e=[];return this.$elementTop&&e.push({position:"top",element:this.$elementTop.get(0)}),this.$elementBottom&&e.push({position:"bottom",element:this.$elementBottom.get(0)}),e},t.prototype.execClick=function(e){var t=n.attr(e.target,"toolClick");if(null!==t)this._onToolElement("click",t);else{var i=this._idComponent(e.target);i&&i.click&&i.click(e)}},t.prototype._idComponent=function(e){if(!this.$elementTop)return null;for(var t,n=e,i=this.$elementTop.get(0);n;){if(!n.getAttribute)return null;if(t=n.getAttribute("data-tool-id"))return this._map[t];n=n===i||n===document.body?null:n.parentNode}return this.$elementTop?null:void 0},t.prototype.getToolElement=function(e){var t=null;return this.toolElements.forEach(function(n,i){if(i==e||n.name===e)return t=n.$component,!1}),t},t.prototype.setValue=function(e,t){var n=this.getToolElement(e);n&&n.setValue(t)},t.prototype.getValue=function(e){var t=this.getToolElement(e);if(t)return t.getValue()},t.prototype.refresh=function(){this.toolElements.forEach(function(e){var t=e.$component;t&&t.refresh()})},t.prototype.setOptions=function(e,t){var n=this.getToolElement(e);n&&n.setOptions(t)},t.prototype.getOptions=function(e){var t=this.getToolElement(e);if(t)return t.getOptions()},t.prototype._onToolElement=function(e,t){if(t>=0){var n=this.getToolElement(t);if(n&&this.options.selectToolElement){var i=n.getValue();n.after(),this.options.selectToolElement({id:n.config.id,type:n.config.type,name:n.config.name,value:i,toolData:n.config},e)}}},t.prototype._setEvents=function(){var e=this;e.$elementTop&&!e.options.gridControl&&e.$elementTop.on("click",function(t){e.execClick(t)}),e.$elementTop&&e.$elementTop.on("keyup",function(t){if(13==t.keyCode){var i=n.attr(t.target,"toolKeyup");e._onToolElement("keyup",i)}}),e.$elementBottom&&!e.options.gridControl&&e.$elementBottom.on("click",function(t){e.execClick(t)})},t.prototype._controlById=function(e){return this._map[e]},t.prototype._removeEvents=function(){this.$elementTop&&this.$elementTop.off("click"),this.$elementBottom&&this.$elementBottom.off("click")},t.prototype._renderToolElements=function(e){var t=this;if(e.length&&t.$elementTop){var i=t.$elementTop.get(0),r=n.find(i,t.id+"_top_left"),s=n.find(i,t.id+"_top_right"),a=t.$elementBottom?t.$elementBottom.get(0):null,l=a?n.find(a,t.id+"_bottom_left"):null,u=a?n.find(a,t.id+"_bottom_right"):null;t._map={},e.forEach(function(e,n){e.id=n;var i=e.type,b=$.extend(!0,{callback:t.options.selectToolElement},e.options||{});switch(b.form=t._form,b.schema=t._schema,b.schemaItems=t._schemaItems,b.bind=t._bind,b.gridControl=t.options.gridControl,i.toLowerCase()){case"control":break;case"count":e.$component=new h(e,b);break;case"filter":e.$component=new _(e,b);break;case"search":e.$component=new g(e,b);break;case"filterexpress":b.mongoDbFilter=t.options.composition,e.$component=new y(e,b);break;case"dropdownaction":e.$component=new f(e,b);break;case"links":e.$component=new m(e,b);break;case"select":e.$component=new v(e,b);break;case"title":e.$component=new d(e,b);break;case"icon":e.$component=new c(e,b);break;default:e.style=e.style||e.type,e.$component=new p(e,b)}if(e.$component)t._map[e.$component.id]=e.$component,(x=e.bottom?a?e.right?$(u):$(l):null:e.right?$(s):$(r))&&e.$component.render(x);else if("control"===i.toLowerCase()){var x;(x=e.bottom?a?e.right?$(u):$(l):null:e.right?$(s):$(r))&&x.append($(o.format('<div id="{0}" class="bs-toolbar-item"></div>',e.options._parentId)))}})}},t.prototype.render=function(t,n){var i=this,r=!1,s=(e.bootstrap4,['<div class="container-fluid no-x-padding no-x-margin">','<div class="bs-island bs-toolbar" data-render="{2}">','<div class="bs-toolbar-left mr-auto form-inline" id="{0}_{1}_left"></div>','<div class="bs-toolbar-right form-inline" id="{0}_{1}_right"></div>',"</div>","</div>"]);if(t&&!i.$elementTop&&(i.$elementTop=$(o.format(s.join(""),i.id,"top",i.options.gridControl?i.options.gridControl.id:i.id)),r=!0),n&&!i.$elementBottom&&(i.$elementBottom=$(o.format(s.join(""),i.id,"bottom",i.options.gridControl?i.options.gridControl.id:i.id)),r=!0),r){if(i._renderToolElements(i.toolElements),t){var a=t;i.options.replaceParent?((a=$("<div></div>")).append(i.$elementTop),t.replaceWith(a)):a.append(i.$elementTop)}n&&n.append(i.$elementBottom),i._setEvents()}},t.prototype.destroy=function(){var e=this;e._removeEvents(),e.$elementTop=null,e.options=null,e.toolElements=null,e._map=null,e.toolElements&&(e.toolElements.forEach(function(e){e.$component&&(e.$component.destroy(),e.$component=null)}),e.toolElements=null),e._form=null,e._schema=null,e._schemaItems=null,e._subcontrols=null},t}();t.ToolBar=b;var x=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o._state(),o}return __extends(t,e),t.prototype.getValue=function(e){return this._toolbar.getValue(e)},t.prototype.setValue=function(e,t){this._toolbar.setValue(e,t)},t.prototype.refresh=function(){this._toolbar.refresh()},t.prototype.getOptions=function(e){return this._toolbar.getOptions(e)},t.prototype.setOptions=function(e,t){this._toolbar.setOptions(e,t)},t.prototype.changed=function(e,t,n,i){this.refresh()},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.click=function(e){},t.prototype._createContainer=function(e){var t=this.renderOptions.style||"";return o.format('<div id="{0}" data-render="{0}" class="bs-tile '+t+'"></div>',e)},t.prototype._onSelectToolElement=function(e){var t=e.name||e.id;this.form.execAction(this.$bind+".$toolbar."+t,{toolElement:e,control:this})},t.prototype.render=function(e){var t=this,n=t._initOptions(s.utils.defaultOptions);if(!t.$element){t.$element=$(t._createContainer(t.id));var o=t.state.value||[];o.forEach(function(e){return delete(e=$.extend(!0,e,e.data,{options:e.options})).data,delete e.options,e});var r={selectToolElement:t._onSelectToolElement.bind(t)};t._toolbar=new i.ToolBar(o,r),t._toolbar.render(t.$element)}return t.appendElement(e,n),t.$element},t}(t.AbsField);t.ToolbarForm=x,i.registerControl(x,"array",!1,"toolbar")}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.min.js.map