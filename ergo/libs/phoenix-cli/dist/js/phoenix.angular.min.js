angular&&angular.module("phoenix.ui",[]);!function(e){if(angular){var o=e,n=o.utils,t=o.data,r=o.application,i=o.build,l=o.ui,a=o.ajax,u=o.link,c=o.locale,s=o.serial,p=angular.module("phoenix.ui");function f(e){if("string"==typeof e)return e;var o=e.message;return"error"===o&&e.detail&&e.detail.responseText&&(o=e.detail.responseText),o}function m(e){function o(e){var o=window.location.hash,n=o.indexOf("?");n>=0&&(o=o.substr(0,n));o.split("/");var t=e?"/authoring/forms/":"/authoring/";return(n=o.indexOf(t))>=0&&(o=o.substr(n+t.length)),o}e.component.saveHandler=function(n){var i=r.config(r.name),l=r.isCustomizable(e.isform?"forms":"pages",n.name);if(i){var a=l?i.dev:i.current;if(!a)return;var u=e.isform?a.forms:a.pages;if(!u)return;t.rest.put(u+"/"+o(e.isform),n).then(function(e){},function(e){alert(f(e))})}},e.component.loadNestedHandler=function(o,n){var t=r.config(r.name);t&&t.current&&t.current.pages&&t.current.forms&&a.post((e.isform?t.current.forms:t.current.pages)+"/load/nested",o).then(function(e){n&&n(e)},function(e){alert(f(e))})},e.component.createHandler=function(o,t){var i=r.config(r.name),l=o;if(i&&i.current&&i.current.pages&&i.current.forms){t.name=o.split("/").pop();var s=function(e){var o=u.context(),n={$page:l,$authoring:!0};u.execLink(n,o,null)},p=function(r){"Conflict"==r?n.prompt(c.layouts.design.ConflictedPageName,o,function(o){o&&(o=o.trim())&&(o.indexOf(" ")>=0?alert(c.layouts.design.InvalidPageName):(t.name=o.split("/").pop(),l=o,a.post((e.isform?i.current.forms:i.current.pages)+"/"+l,t).then(s,p)))}):alert(f(r))};l=o,a.post((e.isform?i.current.forms:i.current.pages)+"/"+l,t).then(s,p)}},e.component.openHandler=function(e){var o=u.context(),n={$page:e,$authoring:!0};u.execLink(n,o,null)},e.component.removeHandler=function(){var n=o(e.isform),l=r.config(r.name),a=r.isCustomizable(e.isform?"forms":"pages",n);if(l){var c=a?l.dev:l.current;if(!c)return;var s=e.isform?c.forms:c.pages;if(!s)return;t.rest.remove(s+"/"+n).then(function(e){if(i.release)window.location.reload(!0);else{var o=u.context(),n={$page:r.homeName};u.execLink(n,o,null)}},function(e){alert(f(e))})}},e.component.listHandler=function(o){var n=r.config(r.name);n&&n.current&&n.current.pages&&n.current.forms&&a.get(e.isform?n.current.forms:n.current.pages).then(function(e){o(e)},function(e){alert(f(e))})}}p.controller("uiLayoutController",["$scope",function(e){}]),p.directive("layout",["$compile",function(e){return{scope:{model:"=",isform:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiLayoutController",controllerAs:"layout",link:function(o,t,r){var i=o.$new();o.$on("$destroy",function(){n.log("destroy layout","scope"),o.component.destroy(),o.component=null}),o.isform=!!o.layout.isform;var a={design:i.layout.authoring,path:i.layout.path,replaceParent:!0,context:"angular",beforeAdd:function(t,r){n.log("compile layout","scope"),e(t)(i),r&&s.GlbSerial.execute(function(){o.$digest()})},beforeRemove:function(e){n.log("remove layout","scope"),i.component=null,i.layout=null,i.$destroy(),i=o.$new()}};o.isform?l.OpenForm(t,o.layout.model,o.layout.prototype,{},o.layout.locale&&o.layout.locale.$view?o.layout.locale.$view:o.layout.locale,null,a,function(e){o.component=e,m(o)}):(o.component=new l.LayoutClass(o.layout.model||{},a,{},o.layout.prototype,o.layout.locale&&o.layout.locale.$view?o.layout.locale.$view:o.layout.locale,null),m(o),o.component.render(t))}}}])}}(Phoenix||(Phoenix={}));!function(e){if(angular){var o=e.utils,n=e.render,t=e.device,r=e.serial,i=e.ui,l=angular.module("phoenix.ui");l.controller("uiWidgetController",["$scope",function(e){}]),l.directive("widget",["$compile",function(e){return{scope:{data:"=",layout:"=",authoring:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiWidgetController",controllerAs:"item",compile:function(n,t){return{pre:function(n,t,l){var a=n.item.data||{};n.component=new i.Widget(a,{design:n.item.authoring,replaceParent:!0,context:"angular",beforeAdd:function(t,i){o.log("compile module","scope"),e(t)(n),i&&r.GlbSerial.execute(function(){n.$digest()})},onDataChanged:function(){r.GlbSerial.execute(function(){n.$digest()})}},n.item.layout),n.component.render(t),n.$on("$destroy",function(){o.log("destroy module","scope"),n.component&&n.component.destroy()})},post:function(e,o,n){}}}}}]);n.register("angular","widget.content",function(e,o,n){e.push("<widget-"+o.$type),e.push(' authoring="'+(n.design?"true":"false")+'"'),e.push(' phone="'+(t.phone?"true":"false")+'"'),e.push(' tablet="'+(t.tablet?"true":"false")+'"'),e.push(" module=component props=component.props links=component.links data=component.props.data.ds></widget-"+o.$type+">")}),n.register("angular","widget",function(e,o,n,t,r){e.push('<widget authoring="'+(r.design?"true":"false")+'" layout=component data=layout.model.fields.'+o.$id+"></widget>")})}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){if(angular){var o=e,n=o.utils,t=angular.module("phoenix.ui");t.controller("uiAuthoringController",["$scope",function(e){}]),t.directive("authoring",[function(){return{scope:{toolbox:"=",isform:"=",model:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiAuthoringController",controllerAs:"item",link:function(e,t,r){var i=o.authoring;i&&(e.isform=!!e.item.isform,e.component=new i.AuthoringEditor({form:!!e.isform,design:!0,replaceParent:!0,context:"angular"},e.item.toolbox),e.component.render(t),e.$on("$destroy",function(){e.component&&(n.log("destroy authoring","scope"),e.component.destroy(),e.component=null)}))}}}])}}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.angular.min.js.map