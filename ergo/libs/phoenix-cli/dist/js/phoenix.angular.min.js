var Phoenix;angular&&angular.module("phoenix.ui",[]),function(e){if(angular){var o=e,u=o.utils,l=o.data,c=o.application,s=o.build,a=o.ui,p=o.ajax,f=o.link,m=o.locale,d=o.serial,n=angular.module("phoenix.ui");function g(e){if("string"==typeof e)return e;var o=e.message;return"error"===o&&e.detail&&e.detail.responseText&&(o=e.detail.responseText),o}function h(a){function i(e){var o=window.location.hash,n=o.indexOf("?");0<=n&&(o=o.substr(0,n));o.split("/");var t=e?"/authoring/forms/":"/authoring/";return 0<=(n=o.indexOf(t))&&(o=o.substr(n+t.length)),o}a.component.saveHandler=function(e){var o=c.config(c.name),n=c.isCustomizable(a.isform?"forms":"pages",e.name);if(o){var t=n?o.dev:o.current;if(!t)return;var r=a.isform?t.forms:t.pages;if(!r)return;l.rest.put(r+"/"+i(a.isform),e).then(function(e){},function(e){alert(g(e))})}},a.component.loadNestedHandler=function(e,o){var n=c.config(c.name);n&&n.current&&n.current.pages&&n.current.forms&&p.post((a.isform?n.current.forms:n.current.pages)+"/load/nested",e).then(function(e){o&&o(e)},function(e){alert(g(e))})},a.component.createHandler=function(o,n){var t=c.config(c.name),r=o;if(t&&t.current&&t.current.pages&&t.current.forms){n.name=o.split("/").pop();var i=function(e){var o=f.context(),n={$page:r,$authoring:!0};f.execLink(n,o,null)},l=function(e){"Conflict"==e?u.prompt(m.layouts.design.ConflictedPageName,o,function(e){e&&(e=e.trim())&&(0<=e.indexOf(" ")?alert(m.layouts.design.InvalidPageName):(n.name=e.split("/").pop(),r=e,p.post((a.isform?t.current.forms:t.current.pages)+"/"+r,n).then(i,l)))}):alert(g(e))};r=o,p.post((a.isform?t.current.forms:t.current.pages)+"/"+r,n).then(i,l)}},a.component.openHandler=function(e){var o=f.context(),n={$page:e,$authoring:!0};f.execLink(n,o,null)},a.component.removeHandler=function(){var e=i(a.isform),o=c.config(c.name),n=c.isCustomizable(a.isform?"forms":"pages",e);if(o){var t=n?o.dev:o.current;if(!t)return;var r=a.isform?t.forms:t.pages;if(!r)return;l.rest.remove(r+"/"+e).then(function(e){if(s.release)window.location.reload(!0);else{var o=f.context(),n={$page:c.homeName};f.execLink(n,o,null)}},function(e){alert(g(e))})}},a.component.listHandler=function(o){var e=c.config(c.name);e&&e.current&&e.current.pages&&e.current.forms&&p.get(a.isform?e.current.forms:e.current.pages).then(function(e){o(e)},function(e){alert(g(e))})}}n.controller("uiLayoutController",["$scope",function(e){}]),n.directive("layout",["$compile",function(i){return{scope:{model:"=",isform:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiLayoutController",controllerAs:"layout",link:function(n,e,o){var t=n.$new();n.$on("$destroy",function(){u.log("destroy layout","scope"),n.component.destroy(),n.component=null}),n.isform=!!n.layout.isform;var r={design:t.layout.authoring,path:t.layout.path,replaceParent:!0,context:"angular",beforeAdd:function(e,o){u.log("compile layout","scope"),i(e)(t),o&&d.GlbSerial.execute(function(){n.$digest()})},beforeRemove:function(e){u.log("remove layout","scope"),t.component=null,t.layout=null,t.$destroy(),t=n.$new()}};n.isform?a.OpenForm(e,n.layout.model,n.layout.prototype,{},n.layout.locale&&n.layout.locale.$view?n.layout.locale.$view:n.layout.locale,null,null,r,function(e){n.component=e,h(n)}):(n.component=new a.LayoutClass(n.layout.model||{},r,{},n.layout.prototype,n.layout.locale&&n.layout.locale.$view?n.layout.locale.$view:n.layout.locale,null),h(n),n.component.render(e))}}}])}}(Phoenix||(Phoenix={})),function(e){if(angular){var i=e.utils,o=e.render,t=e.device,l=e.serial,a=e.ui,n=angular.module("phoenix.ui");n.controller("uiWidgetController",["$scope",function(e){}]),n.directive("widget",["$compile",function(r){return{scope:{data:"=",layout:"=",authoring:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiWidgetController",controllerAs:"item",compile:function(e,o){return{pre:function(n,e,o){var t=n.item.data||{};n.component=new a.Widget(t,{design:n.item.authoring,replaceParent:!0,context:"angular",beforeAdd:function(e,o){i.log("compile module","scope"),r(e)(n),o&&l.GlbSerial.execute(function(){n.$digest()})},onDataChanged:function(){l.GlbSerial.execute(function(){n.$digest()})}},n.item.layout),n.component.render(e),n.$on("$destroy",function(){i.log("destroy module","scope"),n.component&&n.component.destroy()})},post:function(e,o,n){}}}}}]);o.register("angular","widget.content",function(e,o,n){e.push("<widget-"+o.$type),e.push(' authoring="'+(n.design?"true":"false")+'"'),e.push(' phone="'+(t.phone?"true":"false")+'"'),e.push(' tablet="'+(t.tablet?"true":"false")+'"'),e.push(" module=component props=component.props links=component.links data=component.props.data.ds></widget-"+o.$type+">")}),o.register("angular","widget",function(e,o,n,t,r){e.push('<widget authoring="'+(r.design?"true":"false")+'" layout=component data=layout.model.fields.'+o.$id+"></widget>")})}}(Phoenix||(Phoenix={})),function(e){if(angular){var r=e,i=r.utils,o=angular.module("phoenix.ui");o.controller("uiAuthoringController",["$scope",function(e){}]),o.directive("authoring",[function(){return{scope:{toolbox:"=",isform:"=",model:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiAuthoringController",controllerAs:"item",link:function(e,o,n){var t=r.authoring;t&&(e.isform=!!e.item.isform,e.component=new t.AuthoringEditor({form:!!e.isform,design:!0,replaceParent:!0,context:"angular"},e.item.toolbox),e.component.render(o),e.$on("$destroy",function(){e.component&&(i.log("destroy authoring","scope"),e.component.destroy(),e.component=null)}))}}}])}}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.angular.min.js.map