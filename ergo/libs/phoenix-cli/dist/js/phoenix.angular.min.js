angular&&angular.module("phoenix.ui",[]);!function(e){function o(e){if("string"==typeof e)return e;var o=e.message;return"error"===o&&e.detail&&e.detail.responseText&&(o=e.detail.responseText),o}function n(e){function n(e){var o=window.location.hash,n=o.indexOf("?");n>=0&&(o=o.substr(0,n));o.split("/");var t=e?"/authoring/forms/":"/authoring/";return(n=o.indexOf(t))>=0&&(o=o.substr(n+t.length)),o}e.component.saveHandler=function(t){var l=i.config(i.name),a=i.isCustomizable(e.isform?"forms":"pages",t.name);if(l){var u=a?l.dev:l.current;if(!u)return;var c=e.isform?u.forms:u.pages;if(!c)return;r.rest.put(c+"/"+n(e.isform),t).then(function(e){},function(e){alert(o(e))})}},e.component.loadNestedHandler=function(n,t){var r=i.config(i.name);r&&r.current&&r.current.pages&&r.current.forms&&u.post((e.isform?r.current.forms:r.current.pages)+"/load/nested",n).then(function(e){t&&t(e)},function(e){alert(o(e))})},e.component.createHandler=function(n,r){var l=i.config(i.name),a=n;if(l&&l.current&&l.current.pages&&l.current.forms){r.name=n.split("/").pop();var p=function(e){var o=c.context(),n={$page:a,$authoring:!0};c.execLink(n,o,null)},f=function(i){"Conflict"==i?t.prompt(s.layouts.design.ConflictedPageName,n,function(o){o&&(o=o.trim())&&(o.indexOf(" ")>=0?alert(s.layouts.design.InvalidPageName):(r.name=o.split("/").pop(),a=o,u.post((e.isform?l.current.forms:l.current.pages)+"/"+a,r).then(p,f)))}):alert(o(i))};a=n,u.post((e.isform?l.current.forms:l.current.pages)+"/"+a,r).then(p,f)}},e.component.openHandler=function(e){var o=c.context(),n={$page:e,$authoring:!0};c.execLink(n,o,null)},e.component.removeHandler=function(){var t=n(e.isform),a=i.config(i.name),u=i.isCustomizable(e.isform?"forms":"pages",t);if(a){var s=u?a.dev:a.current;if(!s)return;var p=e.isform?s.forms:s.pages;if(!p)return;r.rest.remove(p+"/"+t).then(function(e){if(l.release)window.location.reload(!0);else{var o=c.context(),n={$page:i.homeName};c.execLink(n,o,null)}},function(e){alert(o(e))})}},e.component.listHandler=function(n){var t=i.config(i.name);t&&t.current&&t.current.pages&&t.current.forms&&u.get(e.isform?t.current.forms:t.current.pages).then(function(e){n(e)},function(e){alert(o(e))})}}if(angular){var t=e.utils,r=e.data,i=e.application,l=e.build,a=e.ui,u=e.ajax,c=e.link,s=e.locale,p=e.serial,f=angular.module("phoenix.ui");f.controller("uiLayoutController",["$scope",function(e){}]),f.directive("layout",["$compile",function(e){return{scope:{model:"=",isform:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiLayoutController",controllerAs:"layout",link:function(o,r,i){var l=o.$new();o.$on("$destroy",function(){t.log("destroy layout","scope"),o.component.destroy(),o.component=null}),o.isform=!!o.layout.isform;var u={design:l.layout.authoring,path:l.layout.path,replaceParent:!0,context:"angular",beforeAdd:function(n,r){t.log("compile layout","scope"),e(n)(l),r&&p.GlbSerial.execute(function(){o.$digest()})},beforeRemove:function(e){t.log("remove layout","scope"),l.component=null,l.layout=null,l.$destroy(),l=o.$new()}};o.isform?a.OpenForm(r,o.layout.model,o.layout.prototype,{},o.layout.locale&&o.layout.locale.$view?o.layout.locale.$view:o.layout.locale,null,u,function(e){o.component=e,n(o)}):(o.component=new a.LayoutClass(o.layout.model||{},u,{},o.layout.prototype,o.layout.locale&&o.layout.locale.$view?o.layout.locale.$view:o.layout.locale,null),n(o),o.component.render(r))}}}])}}(Phoenix||(Phoenix={}));!function(e){if(angular){var o=e.utils,n=e.render,t=e.device,r=e.serial,i=e.ui,l=angular.module("phoenix.ui");l.controller("uiWidgetController",["$scope",function(e){}]),l.directive("widget",["$compile",function(e){return{scope:{data:"=",layout:"=",authoring:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiWidgetController",controllerAs:"item",compile:function(n,t){return{pre:function(n,t,l){var a=n.item.data||{};n.component=new i.Widget(a,{design:n.item.authoring,replaceParent:!0,context:"angular",beforeAdd:function(t,i){o.log("compile module","scope"),e(t)(n),i&&r.GlbSerial.execute(function(){n.$digest()})},onDataChanged:function(){r.GlbSerial.execute(function(){n.$digest()})}},n.item.layout),n.component.render(t),n.$on("$destroy",function(){o.log("destroy module","scope"),n.component&&n.component.destroy()})},post:function(e,o,n){}}}}}]);n.register("angular","widget.content",function(e,o,n){e.push("<widget-"+o.$type),e.push(' authoring="'+(n.design?"true":"false")+'"'),e.push(' phone="'+(t.phone?"true":"false")+'"'),e.push(' tablet="'+(t.tablet?"true":"false")+'"'),e.push(" module=component props=component.props links=component.links data=component.props.data.ds></widget-"+o.$type+">")}),n.register("angular","widget",function(e,o,n,t,r){e.push('<widget authoring="'+(r.design?"true":"false")+'" layout=component data=layout.model.fields.'+o.$id+"></widget>")})}}(Phoenix||(Phoenix={}));var Phoenix;!function(e){if(angular){var o=e,n=o.utils,t=angular.module("phoenix.ui");t.controller("uiAuthoringController",["$scope",function(e){}]),t.directive("authoring",[function(){return{scope:{toolbox:"=",isform:"=",model:"=",authoring:"=",locale:"=",prototype:"=",path:"="},bindToController:!0,restrict:"E",replace:!0,controller:"uiAuthoringController",controllerAs:"item",link:function(e,t,r){var i=o.authoring;i&&(e.isform=!!e.item.isform,e.component=new i.AuthoringEditor({form:!!e.isform,design:!0,replaceParent:!0,context:"angular"},e.item.toolbox),e.component.render(t),e.$on("$destroy",function(){e.component&&(n.log("destroy authoring","scope"),e.component.destroy(),e.component=null)}))}}}])}}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.angular.min.js.map