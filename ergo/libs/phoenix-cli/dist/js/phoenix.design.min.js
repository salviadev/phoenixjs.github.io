var Phoenix;!function(e){var t,i,n,o,a,s,l,r,d,u,p,c,f,h,m,y,g,b,v,O,C;t=e.ui||(e.ui={}),i=e.dom,n=t,o=e.ipc,a=e.link,s=e.drag,l=e.utils,r=e.layoutUtils,d=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},u=function(e){return e.originalEvent?e.originalEvent:e},p=function(e,t){if(!e)return null;var i,n,o,a,s,l;e.map&&(i=!0,n=e.map,e.map=null,o=e.fields,e.fields=null),t&&((a=e.$items)&&(e.$items=[]),s=e.$render,e.$render=null),e.$config&&e.$config.datasets&&(l=e.$config.data?e.$config.data.ds:null)&&delete e.$config.data.ds;var d=$.extend(!0,{},e);return i&&(e.map=n,e.fields=o,delete d.fields,delete d.map),t&&(e.$items=a,e.$render=s),l&&(e.$config.data.ds=l),r.clearMeta(d,!t),t&&delete d.$items,d},c=function(e,t,n,o){for(var a=[],s=e.childNodes,l=0,r=s.length;l<r;l++){var d=s[l],u=i.offset(d),p={position:o?u.left+(u.width>>1):u.top+(u.height>>1),ignore:d===t&&!o||3===d.nodeType||d.hasAttribute("data-remove")||d.hasAttribute("data-ignore"),placeHolder:d===n};a.push(p)}return a},f=function(e,t){var i=0;if(e.length){for(var n=0,o=e.length;n<o;n++){var a=e[n];if(!a.ignore&&t<a.position)return n;i=n+1}return i}return i},h=function(e){var t=e.nextSibling,i=e.previousSibling,n=0;i&&(n=t?t.offsetLeft-5:i.offsetLeft+i.offsetWidth-10),e.style.left=parseInt(n+"",10)+"px"},m=function(e,t,n,o,a,s,l,r){r&&(l.horizontal?i.addClass(o,"drop-target-col"):(o.style.removeProperty&&(o.style.removeProperty("height"),o.style.removeProperty("left")),i.removeClass(o,"drop-target-col")));var d=function(e){o.parentNode&&v(o),a.$type&&!e&&("column"===a.$type&&1===s?i.addClass(o,"col"):i.removeClass(o,"col"))},u=!0;if(t.length||(d(!1),i.append(e,o),u=!1),u){for(var p=-1,c=0,f=t.length;c<f;c++){var $=t[c];if($.placeHolder){if(p=c,c===n||c===n-1)return!1}else if($.ignore){if(c===n&&c+1<f&&t[c+1].placeHolder)return!1;if(c===n-1&&c>0&&t[c-1].placeHolder)return!1}}if(p<0||n>=t.length)d(p>=0),i.append(e,o);else{var m=e.childNodes[n];d(p>=0),i.before(m,o)}}return l.horizontal&&h(o),!0},y=function(e,t,n){if(n){for(var o=0,a=e.childNodes.length;o<a;o++)t?i.addClass(e.childNodes[o],"bs-none-drag"):i.removeClass(e.childNodes[o],"bs-none-drag");t?(i.addClass(e,"drag-source"),2===n&&i.removeClass(e,"auto")):(i.removeClass(e,"drag-source"),2===n&&i.addClass(e,"auto"))}},g=function(e,t,i,n,o){return e&&v(e),(e=document.createElement("div")).className="container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"+(i?" bs-island bs-field":"")+(n?" bs-island bs-widget":"")+(o?" drop-target-col":""),e},b=function(e,t,i){i&&(e.off("click"),e.find('*[draggable="true"]').off("dragstart").add(e).off("dragend"),e.find('*[draggable="true"]').off("dragstart"),e.find(".drop-layouts-zone, .drop-fields-zone").add(e).off("dragover dragenter drop"))},v=function(e){i.remove(e)},O=function(e,t,n){if(n){var o,a,l,p,$,C,_=function(){C=!1,o&&(i.removeClass(o,"bs-none"),o.isColumn&&y(o.firstChild,!1,o.isColumn),o.isColumn=!1,o=null),p&&(v(p),p=null),a&&(i.remove(a),a=null),$=null,l=!1,s.setData(null)},L=function(o){var a,s,l=e.get(0);if(o){if(o.data===o.dst)return;var u,p,c,f,$=o.dst,h=o.data,m=i.find(l,h.$id),y=i.find(l,$.$idDesign),g=!1;if(h.$parentId===$.$id){if(p=(c=o.dst).$items.indexOf(h),g=!0,(u=o.indexInParent)===p)return}else p=(c=o.isNew?null:t.getLayoutById(h.$parentId))?c.$items.indexOf(h):-1,u=o.indexInParent;if(p>=0&&(a=c,s=p,o.isLayout?(a.$items.splice(s,1),a.$type===r.LAYOUT_ROW?a.$items.length?delete a.$items[0].$colSize:(a.$type=r.LAYOUT_BLOCK,a.$origin=r.LAYOUT_ROW,d(a)):a.$type===r.LAYOUT_ACCORDION&&(a.$items.length||(a.$type=r.LAYOUT_BLOCK,delete a.$origin,d(a)))):a.$items.splice(s,1)),function(e,t,i,n,o,a){if(!a)return i.$parentId=t.$id,void t.$items.splice(n,0,i);if(t.$origin===r.LAYOUT_ROW&&t.$type!==r.LAYOUT_ROW&&(delete t.$origin,t.$type=r.LAYOUT_ROW,d(t)),i.$parentId=t.$id,t.$type===r.LAYOUT_ROW)switch(i.$type===r.LAYOUT_BLOCK&&i.$origin===r.LAYOUT_ROW&&(i.$type=r.LAYOUT_ROW,delete i.$origin),i.$type){case r.LAYOUT_BLOCK:case r.LAYOUT_ACCORDION_GROUP:delete i.$origin,delete i.$type,d(i);break;case r.LAYOUT_COLUMN:o||(delete i.$colSize,delete i.$customColSize);break;default:(s={$items:[],$auto:!0}).$items.push(i),i=s}else if(t.$type===r.LAYOUT_ACCORDION)switch(i.$type){case r.LAYOUT_ACCORDION_GROUP:break;case r.LAYOUT_BLOCK:i.$type=r.LAYOUT_ACCORDION_GROUP,d(i);break;case r.LAYOUT_COLUMN:delete i.$colSize,delete i.$customColSize,i.$type=r.LAYOUT_ACCORDION_GROUP,d(i);break;default:var s;(s={$type:r.LAYOUT_ACCORDION_GROUP,$items:[],$auto:!0}).$items.push(i),i=s}else switch(i.$type){case r.LAYOUT_COLUMN:case r.LAYOUT_ACCORDION_GROUP:delete i.$colSize,delete i.$customColSize,i.$type=r.LAYOUT_BLOCK,d(i),i.$auto&&(i=i.$items[0])}t.$items.splice(n,0,i)}(0,$,h,u,g,o.isLayout),o.isNew||o.isLayout)t.check(null);else{if(p>=0&&i.detach(m),u===$.$items.length-1?i.append(y,m):(f=i.find(l,$.$items[u+1].$id),i.before(f,m)),!$.$items[u].$bind){var v=[c];return $!==c&&v.push($),b(e,0,n),O(e,t,n),void v.forEach(function(e){t._afterPropsChanged(e)})}t.check(null)}t.render()}};e.on("click",function(i){var n=function(e,t,i){for(var n,o,a=e.target,s=null;a;){if(s=a.getAttribute("data-layout")){if(n=parseInt(a.getAttribute("data-level")||"1",10),(o=i.getLayoutById(s))&&r.canSelect(o,n)||(s=null),s)break}else if(s=a.getAttribute("data-render"))break;a=a===t?null:a.parentNode}return s}(i,e.get(0),t);!function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-remove"))return!0;i=i===t?null:i.parentNode}return!1}(i,e.get(0))?!function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-layout-detail"))return!0;i=i===t?null:i.parentNode}return!1}(i,e.get(0))?t.select(n):t.authoringChild(n):t.removeChild(n)}),e.find('*[draggable="true"]').on("dragstart",function(n){n.stopPropagation();var r=!1,d=!0,p=!1,c=t.getLayoutById(this.getAttribute("data-layout"));if(c||(r=!(p=null!=(c=t.getFieldById(this.getAttribute("data-render"))).$config),d=!1),!c)return n.preventDefault(),!1;c.selected&&t.select(null);var f=u(n).dataTransfer;f.effectAllowed="move",f.setData("Text","data"),d&&f.setDragImage&&(($=document.createElement("div")).className="bs-drag-image",document.body.appendChild($),a=$,f.setDragImage(a,0,0));var $,h=t.getLayoutById(c.$parentId);h&&h.$auto&&(c=h),s.setData({data:c,isLayout:d,isField:r,isWidget:p,isNew:!1}),o=i.find(e.get(0),c.$idDrag),l=!0}).add(e).on("dragend",function(e){return e.preventDefault(),e.stopPropagation(),_(),!1}),e.find(".drop-layouts-zone, .drop-fields-zone").add(e).on("dragover dragenter drop",function(e){var n=this,a=s.getData(),d=u(e),b=d.dataTransfer;if(e.stopPropagation(),C)return!0;if(!a||!a.isLayout&&!i.hasClass(n,"drop-fields-zone")||a.isLayout&&!i.hasClass(n,"drop-layouts-zone"))return b.effectAllowed="none",!0;if("drop"===e.type){e.preventDefault();var O=t.getLayoutById(n.getAttribute("data-layout")),A=n.getAttribute("data-level");return O?((a=s.getData()).dst=O,a.dstLevel=A,a.indexInParent=function(e,t,i,n){for(var o=0,a=0,s=e.childNodes.length;a<s;a++){var l=e.childNodes[a];if(3!==l.nodeType){if(l===t)return o;l!==i&&(n&&!l.hasAttribute("data-layout")||(n||l.hasAttribute("data-render"))&&o++)}}return 0}(n,p,o,a.isLayout),s.setData(a),_(),L(a),!1):(_(),!1)}if(b.getData("Text"),l){if(!o)return;if(l=!1,!a.isNew)return C=!0,p=function(e,t,n,o,a,s,l){if(n){var d=l.$type===r.LAYOUT_COLUMN;t&&v(t),t=g(null,n,o,a,d),i.addClass(t,"drop-target"),d?(e.isColumn=1,l.$auto&&(e.isColumn=2),y(e.firstChild,!0,e.isColumn),i.before(e,t),h(t)):(i.addClass(e,"bs-none"),i.before(e,t))}else t=g(t,!1,o,a,!1),i.before(e,t),i.addClass(e,"bs-none");return t}(o,p,a.isLayout,a.isField,a.isWidget,0,a.data),setTimeout(function(){C=!1},0),e.preventDefault(),!1}var T=t.getLayoutById(n.getAttribute("data-layout")),S=n.getAttribute("data-level");if(!p){if(!a.isNew)return!0;var D=t._canDropChild(a.data,T,S);if(!D)return b.effectAllowed="none",!0;$=c(n,o,p,D.horizontal);var U=f($,D.horizontal?d.pageX:d.pageY);return p=g(p,a.isLayout,a.isField,a.isWidget,D.horizontal),m(n,$,U,p,T,S,D,a.isLayout),$=null,e.preventDefault(),!1}if("dragenter"===e.type&&($=null),o===n)return b.effectAllowed="none",!0;var w=t._canDropChild(a.data,T,S);if(!w)return b.effectAllowed="none",!0;$||($=c(n,o,p,w.horizontal));var z=f($,w.horizontal?d.pageX:d.pageY);return m(n,$,z,p,T,S,w,a.isLayout)&&($=null),e.preventDefault(),!1})}},C={_setDesignListeners:function(e){o.listen("onToolBoxDragend",function(){this.$element&&this.$element.trigger("dragend")},this),o.listen("onUpdateSelected",function(e){"layout"===e.type?this.updateLayout(e.id,e.data):this.updateField(e.id,e.data)},this),o.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this),o.listen("onSaveLayout",function(){if(this.saveHandler){var e=p(this.data,!1);this.saveHandler(e)}},this),o.listen("onNewLayout",function(e){if(this.createHandler){var t=p(this.data,!1);this.createHandler(e.name,t)}},this),o.listen("onLoadNestedLayouts",function(e){this.loadNestedHandler&&this.loadNestedHandler(e.data,e.after)},this),o.listen("onOpenLayout",function(e){this.openHandler&&this.openHandler(e.name)},this),o.listen("onRemoveLayout",function(){this.removeHandler&&this.removeHandler()},this),o.listen("onListLayout",function(e){this.listHandler&&this.listHandler(e)},this)},_afterCreate:function(){var e=this;e.options.form&&e.options.design&&l.nextTick(function(){o.emit("FormData",{schema:e.$schema,locale:e.$locale})})},authoringChild:function(e){var t=this.getLayoutById(e);if(t&&t.$ref)if(this.options.form){var i={name:t.$ref};t.$refProperty&&(i.path=t.$refProperty);var n=a.context();i.schema=n.$url.prototype?n.$url.prototype:this.data.name,i.locale=n.$url.locale?n.$url.locale:this.data.name,a.doFormAuthoring(i)}else a.doAuthoring(t.$ref,!0)},_removeEvents:function(){b(this.$element,0,!0),this._removeBaseEvents()},_addEvents:function(){O(this.$element,this,this.options.design),this._addBaseEvents()},_onSelectedChanged:function(e,t,n){!function(e,t,n,a){if(t){var s=i.find(e,t.$idSelect||t.$idDrag);if(e!==s&&s)if(t.selected){if(!s.querySelector('div[data-remove="true"]')){var l=$('<div class="bs-rt-button" data-remove="true"><span class="'+i.iconClass("times-circle")+'"></span></div>').get(0),r=s.childNodes;r.length?i.before(r[0],l):i.append(s,l)}}else{var d=s.querySelector('div[data-remove="true"]');d&&i.remove(d)}}if(n){var u=p(t,!0);if(u&&delete u.$id,t&&t.$type){u.$type=t.$type,t.$items&&t.$items.length&&!t.$items[0].$bind||(u.onlyFields=!0);var c=a.getLayoutById(t.$parentId);c&&(u.parent=p(c,!0),u.parent.$type=c.$type)}o.emit("SelectedChanged",{type:t?t.$type?"layout":t.$config?"widget":"field":null,id:t?t.$id:null,data:u,control:a})}}(e,t,n,this)},_showSelected:function(e,t){!function(e,t){if(e){var n=i.find(e.get(0),t.$idSelect||t.$idDrag);t.selected?i.addClass(n,"selected"):i.removeClass(n,"selected")}}(e,t)},_canDropChild:function(e,t,i){if(t&&t.$type&&t.$ref)return null;if(e.$type)return i=parseInt(i||"1",10),t&&e?t===e?null:this.isChildOf(e,t)?null:"row"===t.$type?{horizontal:!0}:{horizontal:!1}:null;if(e.$bind||e.$config){var n=t.$items.length;if(!n)return{horizontal:!1};for(var o=e.$bind?"$bind":"$config";n--;)if(!t.$items[n][o])return null;return{horizontal:!1}}return null},toString:function(e){var t=p(e||this.data,!1);return JSON.stringify(t)}},$.extend(n.Layout.prototype,C),$.extend(n.Form.prototype,C)}(Phoenix||(Phoenix={})),function(e){var t,i,n,o,a,s,l,r,d;t=e.authpropedit||(e.authpropedit={}),n=(i=e).utils,o=i.ipc,a=i.locale,s=i.ui,l=i.layoutUtils,r=i.dom,d=function(){function e(e){this.$element=null,this.form=null,this.$id=n.allocID(),this.options=e||{},this.selected=null,this._setListeners()}return e.prototype._sendLayout=function(e){var t=this;t.selected&&t.selected.id&&n.nextTick(function(){var i=t._model2layout(e);i&&o.emit("UpdateSelected",{type:"layout",id:t.selected.id,data:i})})},e.prototype._updateFields=function(e){var t=this;t.selected&&t.selected.id&&(t.selected.data&&t.selected.data.$config?t.selected.data.$config=JSON.parse(e.options):t.selected.data=JSON.parse(e.options),n.nextTick(function(){o.emit("UpdateSelected",t.selected)}))},e.prototype._hasData=function(){return this.selected&&this.selected.type},e.prototype._setListeners=function(){o.listen("onSelectedChanged",function(e){var t=this;t.selected=e;var i=t.$element.get(0);if(t._hasData()){r.removeClass(i,"bs-none");var n="layout"===t.selected.type;if(t.$element){var o=e.data;o&&o.$config&&(o=o.$config),t._setJson(o,n)}}else r.addClass(i,"bs-none")},this),o.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this)},e.prototype._model2layout=function(e){var t=!1,i=this.selected.data,n={},o=e.childrenFlow;o===l.LAYOUT_BLOCK&&("column"===i.$type?o="column":i.$type===l.LAYOUT_ACCORDION_GROUP&&(o=l.LAYOUT_ACCORDION_GROUP));var a=o===l.LAYOUT_ACCORDION,s=o===l.LAYOUT_ACCORDION_GROUP;o!==(r=i.$origin||i.$type)&&(n.$type=o,t=!0);var r=i.$ref||i.$type;n.$ref=e.subLayoutName,t||(i.$ref||"")===(e.subLayoutName||"")||(t=!0),n.$refProperty=e.subPathSchema,t||(i.$refProperty||"")===(e.subPathSchema||"")||(t=!0),n.$forceTable=e.forceTable,t||(i.$forceTable||!1)===(e.forceTable||!1)||(t=!0),n.$name=e.name,t||(i.$name||"")===(e.name||"")||(t=!0),o===l.LAYOUT_BLOCK&&(n.$sticky=e.sticky,t||(i.$sticky||"")===(e.sticky||"")||(t=!0)),n.$refController=e.subController,t||(i.$refController||"")===(e.subController||"")||(t=!0),n.$style=e.style,t||(i.$style||"")===(e.style||"")||(t=!0);var d=o===l.LAYOUT_ACCORDION&&"none"===e.format?e.bindPages:void 0;if(n.$bindPages=d,i.$bindPages!==d&&(t=!0),e.$states.colSize.isHidden||("column"===o?(e.colSize!==i.$colSize&&(n.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.$customColSize||"")&&(n.$customColSize=e.customColSize,t=!0)):i.parent&&i.parent.$auto&&(e.colSize!==i.parent.$colSize&&(n.parent=n.parent||{},n.parent.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.parent.$customColSize||"")&&(n.parent=n.parent||{},n.parent.$customColSize=e.customColSize,t=!0))),e.$states.showTitle.isHidden?i.$title&&(t=!0):e.showTitle?i.$title?(!i.$title.value!==e.title&&(t=!0,n.$title=n.$title||{},n.$title.value=e.title),s||(!i.$title.size!==e.titleSize&&(t=!0,n.$title=n.$title||{},n.$title.size=e.titleSize),!i.$title.$style!==e.titleStyle&&(t=!0,n.$title=n.$title||{},n.$title.$style=e.titleStyle))):(t=!0,n.$title={},n.$title.value=e.title,s||(n.$title.size=e.titleSize,n.$title.$style=e.titleStyle)):i.$title&&(t=!0),a){var u=i.$widget,p=e.format===l.LAYOUT_ACCORDION?void 0:e.format;u!==p&&(t=!0),n.$widget=p}if(!e.$states.formType.isHidden){var c=e.formType;u=i.$inline?"inline":i.$fieldsOptions&&i.$fieldsOptions.columns?"horizontal":"block";if(n.$fieldsOptions={},c!==r)switch(t=!0,c){case l.LAYOUT_BLOCK:n.$inline=!1,n.$fieldsOptions.columns=!1;break;case"horizontal":n.$inline=!1,n.$fieldsOptions.columns=!0,n.$fieldsOptions.labelCol=e.labelCol;break;case"inline":n.$inline=!0,n.$fieldsOptions.columns=!1}else"horizontal"===c&&n.$fieldsOptions.labelCol!==e.labelCol&&(n.$fieldsOptions.labelCol=e.labelCol,t=!0);n.$fieldsOptions.labelCol&&3==n.$fieldsOptions.labelCol&&delete n.$fieldsOptions.labelCol,!(!i.$fieldsOptions||!i.$fieldsOptions.titleIsHidden)!==e.titleIsHidden&&(n.$fieldsOptions.titleIsHidden=e.titleIsHidden,t=!0)}return t?n:null},e.prototype._schemaFields=function(){return{links:{apply:{title:a.layouts.design.actionApply}},properties:{options:{type:"string",format:"json"}}}},e.prototype._field2FormData=function(e){return{options:JSON.stringify(e,null,2)}},e.prototype._layoutFields=function(){return{name:n.allocID(),$type:l.LAYOUT_BLOCK,$items:[{$type:l.LAYOUT_BLOCK,$title:{value:a.layouts.design.properties},$items:[{$bind:"options",options:{rows:5}}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._schemaLayout=function(){return{links:{apply:{title:a.layouts.design.actionApply}},properties:{typeLayout:{type:"string"},forceTable:{title:a.layouts.design.forceDisplayTable,type:"boolean"},name:{title:a.layouts.design.name,type:"string"},showTitle:{title:a.layouts.design.showTitle,type:"boolean"},title:{type:"string",title:a.layouts.design.Title},bindPages:{type:"string",title:a.layouts.design.bindPagesTitle},titleSize:{type:"number",title:"Size",enum:[1,2,3,4,5,6],enumNames:["H1","H2","H3","H4","H5","H6"]},titleStyle:{type:"string",title:"Style"},childrenFlow:{type:"string",title:a.layouts.design.childrenFlow,enum:[l.LAYOUT_BLOCK,l.LAYOUT_ROW,l.LAYOUT_ACCORDION],enumNames:[a.layouts.design.childrenFlowVertical,a.layouts.design.childrenTableCell,a.layouts.design.childrenAccordionGroup],filters:{blockrow:[l.LAYOUT_BLOCK,l.LAYOUT_ROW],onlyblock:[l.LAYOUT_BLOCK],accordion:[l.LAYOUT_ACCORDION]}},format:{type:"string",title:a.layouts.design.appearance,enum:[l.LAYOUT_ACCORDION,"tabs","none"],enumNames:[a.layouts.design.appearanceAccordion,a.layouts.design.appearanceTabs,a.layouts.design.appearanceWizard]},subLayoutName:{type:"string",title:a.layouts.design.nestedLayoutName},subPathSchema:{type:"string",title:a.layouts.design.nestedLayoutBind},subController:{type:"string",title:a.layouts.design.nestedFormController},style:{type:"string",title:a.layouts.design.customStyle},colSize:{type:"number",title:a.layouts.design.columnSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["08.33%","16.67%","25.00%","33.33%","41.37%","50.00%","58.33%","66.67%","75.00%","83.33%","91.33%","100.00%"]},customSize:{type:"string",title:a.layouts.design.customColumnSize},formType:{title:a.layouts.design.formType,enum:[l.LAYOUT_BLOCK,"horizontal","inline"],enumNames:[a.layouts.design.ftVertical,a.layouts.design.ftHorizontal,a.layouts.design.ftInline],type:"string"},labelCol:{title:a.layouts.design.labelSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],type:"number"},sticky:{title:a.layouts.design.blockPosition,type:"string",enum:["","top","bottom"],enumNames:[a.layouts.design.bpStatic,a.layouts.design.bpStickyTop,a.layouts.design.bpStickyBottom]},titleIsHidden:{title:a.layouts.design.noTitlesForFields,type:"boolean"}}}},e.prototype._layout2FormData=function(e){var t=e.$origin||e.$type,i=l.LAYOUT_BLOCK,n="onlyblock",o=t===l.LAYOUT_ACCORDION_GROUP,a=t===l.LAYOUT_ACCORDION,s=a&&e.$widget||l.LAYOUT_ACCORDION,r=this.options.form&&(t===l.LAYOUT_BLOCK||"column"===t)||o,d=o||t===l.LAYOUT_BLOCK||"column"===t,u=r&&!!e.$title||o;o&&e.$title&&e.$title.size&&(e.$title.size=4),["column",l.LAYOUT_BLOCK,"row"].indexOf(t)>=0?("row"===t&&(i="row"),e.parent&&(n="blockrow")):t===l.LAYOUT_ACCORDION&&(n=l.LAYOUT_ACCORDION,i=l.LAYOUT_ACCORDION);var p=!1;("column"===t||e.parent&&e.parent.$auto&&"column"===e.parent.$type)&&(p=!0,"column"===t||e.parent);var c=this.options.form&&e.onlyFields&&!e.$ref,f=e.$inline?"inline":e.$fieldsOptions&&e.$fieldsOptions.columns?"horizontal":l.LAYOUT_BLOCK;return{typeLayout:t,showTitle:u,name:e.$name,title:e.$title&&e.$title.value?e.$title.value:"",titleSize:e.$title&&e.$title.size?e.$title.size:4,titleStyle:e.$title&&e.$title.$style?e.$title.$style:"",childrenFlow:i,bindPages:e.$bindPages,colSize:e.$colSize||0,customSize:e.$customColSize,formType:f,format:s,subLayoutName:e.$ref,subPathSchema:e.$refProperty,forceTable:e.$forceTable,subController:e.$refController,style:e.$style,labelCol:e.$fieldsOptions&&e.$fieldsOptions.labelCol?e.$fieldsOptions.labelCol:3,titleIsHidden:!(!e.$fieldsOptions||!e.$fieldsOptions.titleIsHidden),sticky:t===l.LAYOUT_BLOCK&&e.$sticky||"",$states:{showTitle:{isHidden:!r,isDisabled:o},title:{isHidden:!r||!u},bindPages:{isHidden:!(t===l.LAYOUT_ACCORDION&&"none"===e.$widget)},titleSize:{isHidden:!r||!u||o},titleStyle:{isHidden:!r||!u||o},colSize:{isHidden:!p},customSize:{isHidden:!p},childrenFlow:{filter:n},format:{isHidden:!a},formType:{isHidden:!c},labelCol:{isHidden:!c||"horizontal"!==f},titleIsHidden:{isHidden:!c},subLayoutName:{isHidden:!d},forceTable:{isHidden:t!==l.LAYOUT_ROW},subPathSchema:{isHidden:!d||!this.options.form},subController:{isHidden:!d||!this.options.form},sticky:{isHidden:t!==l.LAYOUT_BLOCK}},$links:{apply:{isDisabled:!0}}}},e.prototype._emptyContent=function(){this.form&&(s.removeForm(this.form),this.form=null),r.empty(this.$element.get(0))},e.prototype._layoutEdit=function(){return{name:n.allocID(),$type:l.LAYOUT_BLOCK,$items:[{$title:{value:"Title"},$bindState:"showTitle",$type:l.LAYOUT_BLOCK,$items:[{$bind:"showTitle"},{$bind:"title"},{$bind:"titleSize"},{$bind:"titleStyle"}]},{$type:l.LAYOUT_BLOCK,$title:{value:a.layouts.design.properties},$items:[{$bind:"name"},{$bind:"childrenFlow"},{$bind:"forceTable"},{$bind:"format"},{$bind:"sticky"},{$bind:"bindPages"},{$bind:"subLayoutName"},{$bind:"subPathSchema"},{$bind:"subController"},{$bind:"style"},{$bind:"colSize"},{$bind:"customSize"}]},{$type:l.LAYOUT_BLOCK,$bindState:"formType",$title:{value:a.layouts.design.fieldsTitle},$items:[{$bind:"formType"},{$bind:"labelCol"},{$bind:"titleIsHidden"}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._setJson=function(e,t){var i=this;i._emptyContent(),t?s.OpenForm(i.$element,i._layoutEdit(),i._schemaLayout(),i._layout2FormData(e),{},function(e,t,n){var o=!1;if("propchange"===e.operation){var a=t.typeLayout===l.LAYOUT_ACCORDION_GROUP;switch(e.property){case"showTitle":a||(t.$states.title.isHidden=!t.showTitle,t.$states.titleSize.isHidden=!t.showTitle,t.$states.titleStyle.isHidden=!t.showTitle,o=!0);break;case"formType":t.$states.labelCol.isHidden=t.$states.showTitle.isHidden||"horizontal"!==t.formType,o=!0;break;case"childrenFlow":case"colSize":case"subLayoutName":if(!t.validate())return;i._sendLayout(t);break;case"subPathSchema":if(!t.validate())return;t.subLayoutName?i._sendLayout(t):o=!0;break;case"forceTable":if(!t.validate())return;i._sendLayout(t);break;case"format":t.$states.bindPages.isHidden=!(t.typeLayout===l.LAYOUT_ACCORDION&&"none"===t.format);default:o=!0}o&&(t.$links.apply.isDisabled=!1)}if("execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;i._sendLayout(t)}},{},function(e){i.form=e}):s.OpenForm(i.$element,i._layoutFields(),i._schemaFields(),i._field2FormData(e),{},function(e,t,n){if("propchange"===e.operation&&(e.property,!0&&(t.$links.apply.isDisabled=!1)),"execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;i._updateFields(t)}},{},function(e){i.form=e})},e.prototype.setDesignMode=function(e){this.options.design=e,this.$element&&(this.options.design&&this.selected?r.removeClass(this.$element.get(0),"bs-none"):r.addClass(this.$element.get(0),"bs-none"))},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=$('<div id= "'+t.$id+'"></div>'),t.options.beforeAdd&&t.options.beforeAdd(t.$element)),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},e.prototype.destroy=function(){var e=this;e.form&&(e.form.destroy(),e.form=null),e.$element&&(e.$element=null),o.unlisten(e)},e}(),t.PropertyEditor=d}(Phoenix||(Phoenix={})),function(e){var t,i,n=e,o=n.utils,a=n.ipc,s=n.build,l=(n.drag,n.dom),r=n.ui,d=n.locale,u=n.pagecontrol;n.ulocale;t=e.authtoolbar||(e.authtoolbar={}),i=function(){function t(e){this.$element=null,this.$id=o.allocID(),this.options=e||{}}return t.prototype._removeEvents=function(){this.$element.off("click")},t.prototype._setEvents=function(){var e=this;e.$element.get(0);e.$element.on("click",function(t){var i=!1;switch(t.target.id){case e.$id+"_save":a.emit("SaveLayout",null),i=!0;break;case e.$id+"_open":e._openExisting(),i=!0;break;case e.$id+"_remove":i=!0,o.confirm("",s.release?d.layouts.design.ConfirmDeletePrefs:d.layouts.design.ConfirmDelete,function(){a.emit("RemoveLayout",null)});break;case e.$id+"_preview":var n=l.query(e.$element.get(0),"#"+e.$id+"_preview");a.emit("AuthoringModeChanged",!n.checked);break;case e.$id+"_new":i=!0,o.prompt(d.layouts.design.PageName,"",function(e){(e=e.trim())&&(e.indexOf(" ")>=0?alert(d.layouts.design.InvalidPageName):a.emit("NewLayout",{name:e}))});break;default:i=!1}return!i||(t.stopPropagation(),t.preventDefault(),!1)})},t.prototype._clearChildren=function(){},t.prototype._openExisting=function(){var e=this;a.emit("ListLayout",function(t){if(t&&t.files){for(var i=[],n=0;n<t.files.length;n++){var o=t.files[n];o!=u.Page().currentPage()&&i.push(o)}i.length&&e._openModal(i,function(e){a.emit("OpenLayout",{name:e})})}})},t.prototype._openModal=function(t,i){t.sort();var n={type:"object",properties:{page:{title:"Name",type:"string",enum:t}}},o={page:t[0]},a={title:d.layouts.design.Open.title,buttons:[{type:"default",title:d.layouts.design.Open.close,name:"cancel"},{type:"primary",title:d.layouts.design.Open.open,name:"ok"}]};r.OpenModalForm(a,{name:"open",$type:"block",$items:[{$bind:"page"}]},n,o,e.locale,function(e,t,n,o){if("modal-action"===t.operation)switch(t.property){case"ok":var a=n.page;e.close(),i&&i(a);break;case"cancel":e.close()}})},t.prototype.render=function(e){var t,i,o,a,r=this;return r.$element||(r.$element=$((t=r.$id,i=r.options,o=n.bootstrap4,a=[],o?(a.push('<div class="bs-island" id="'+t+'">'),a.push('<form class="form-inline">')):(a.push('<nav class="navbar navbar-default" id="'+t+'">'),a.push('<div class="container-fluid">'),a.push('<div class="navbar-header">'),a.push('<a class="navbar-brand" href="#">'),a.push(d.layouts.design.AuthoringMode),a.push("</a>"),a.push("</div>"),a.push('<div class="collapse navbar-collapse">'),a.push('<form class="navbar-form navbar-left" role="search">')),a.push('<button type="button" class="mr-2 bs-button btn btn-'+l.bootstrapStyles(!0).secondary+(s.release||i.form?" bs-none":"")+'" id="'+t+'_new">'),a.push('<span class="'+l.iconClass("plus")+'" aria-hidden="false"></span> '),a.push(d.layouts.design.New),a.push("</button>&nbsp;"),a.push('<button type="button" class="mr-2 bs-button  btn btn-'+l.bootstrapStyles(!0).secondary+(s.release||i.form?" bs-none":"")+'" id="'+t+'_open">'),a.push('<span class="'+l.iconClass("file-o")+'" aria-hidden="false"></span> '),a.push(d.layouts.design.Open.title),a.push("</button>&nbsp;"),a.push('<button type="button" class="mr-2 bs-button btn btn-'+l.bootstrapStyles(!0).secondary+(i.form?" bs-none":"")+'" id="'+t+'_remove">'),a.push('<span class="'+l.iconClass("times")+'" aria-hidden="false"></span> '),s.release?a.push(d.layouts.design.DeletePreferences):a.push(d.layouts.design.Delete),a.push("</button>&nbsp;"),a.push('<button type="button" class="mr-2 bs-button btn btn-'+l.bootstrapStyles(!0).secondary+'" id="'+t+'_save">'),a.push('<span class="'+l.iconClass("floppy")+'" aria-hidden="false"></span> '),a.push(d.layouts.design.Save),a.push("</button>&nbsp;"),o?(a.push('<label class="form-check-inline">'),a.push('<input class="form-check-input" type="checkbox" id="'+t+'_preview"'+(i.design?"":' checked="true"')+">&nbsp;&nbsp;"),a.push(d.layouts.design.Preview),a.push("</label>")):(a.push('<div class="checkbox">'),a.push("<label>"),a.push('<input type="checkbox" id="'+t+'_preview"'+(i.design?"":' checked="true"')+"> "),a.push(d.layouts.design.Preview),a.push("</label>"),a.push("</div>")),a.push("</form>"),o||a.push("</div>"),o?a.push("<div>"):a.push("</nav>"),a.join(""))),r._setEvents(),r.options.beforeAdd&&r.options.beforeAdd(r.$element)),e&&(r.options.replaceParent?e.replaceWith(r.$element):e.append(r.$element)),r.$element},t.prototype.destroy=function(){var e=this;e._clearChildren(),e.$element&&(e._removeEvents(),e.$element=null),a.unlisten(e)},t}(),t.AuthoringToolBar=i}(Phoenix||(Phoenix={})),function(e){!function(t){var i=e,n=i.utils,o=i.dom,a=i.build,s=i.locale,l=function(e,t,i){e.$id=e.$id||n.allocID(),t&&(e.$parentId=t.$id),e.$items&&(e.$contentId=e.$contentId||n.allocUuid()),i&&(i[e.$id]=e)},r=function(e,t,i,n){e.push('<div class="panel-group" id="accordion_expo" role="tablist" aria-multiselectable="true">')},d=function(e,t){e.push("</div>")},u=function(e,t,i,n){var s=["list-group-item bs-cursor-p"];if(t.data&&"widget"===t.data.$type&&"dev"!==a.authMode){var l=!0;"admin"===a.authMode?l=["admin","user"].indexOf(t.mode)<0:"user"===a.authMode&&(l="user"!==t.mode),l&&s.push("bs-none")}e.push('<li draggable="true" class="'+s.join(" ")+'" data-toolbox="'+t.$id+'" id="'+t.$id+'">'),e.push('<span class="'+o.iconClass("file-o")+'"></span>&nbsp;'),e.push(t.$title),e.push("</li>")},p=function(e,t){},c=function(e,t,i){e&&(i(e,t,!0),e.$items&&e.$items.forEach(function(t){c(t,e,i)}),i(e,t,!1))},f=function(t,i,n){var a=!0;c(t,i,function(t,i,l){var c=u,f=p;switch(t.$type){case"groups":c=r,f=d;break;case"group":l?function(t,i,n,a){var l,r=e.bootstrap4;switch(i.$typeItems=i.$typeItems||"layouts",i.$typeItems){case"layouts":l=i.$title||s.layouts.design.layouts;break;case"widgets":l=i.$title||s.layouts.design.widgets;break;case"actions":l=i.$title||s.layouts.design.actions;break;default:l=i.$title||s.layouts.design.fields}t.push('<div class="'+(r?"card":"panel panel-default")+'" id="'+i.$id+'">'),t.push('<div class="'+(r?"card-header":"panel-heading")+'"  role="tab" id="'+i.$id+'_tab">'),r||t.push('<h3 class="panel-title">'),t.push('<a data-toggle="collapse" aria-expanded="'+(a?"true":"false")+'" draggable="false" data-parent="#accordion_expo" aria-controls="'+i.$id+'_tab" href="#'+i.$id+'_content"><span class="'+o.iconClass("bars")+'">'),t.push("</span>&nbsp;"),t.push(l),t.push("</a>"),r||t.push("</h3>"),t.push("</div>"),t.push('<div id="'+i.$id+'_content" class="panel-collapse collapse'+(a?r?" show":" in":"")+'" role="tabpanel" aria-labelledby="'+i.$id+'_title">'),t.push('<ul class="list-group">')}(n,t,0,a):n.push("</ul></div></div>"),f=null,c=null,a=!1;break;default:c=u,f=p}c&&f&&(l?c(n,t,i,!1):f(n,t))})};t.check=function(e,t){c(e,null,function(e,i,n){n&&l(e,i,t)})},t.toHtml=function(e,t){var i=[];return f(e,t,i),i.join("")}}(e.authtoolboxutils||(e.authtoolboxutils={}))}(Phoenix||(Phoenix={})),function(e){var t,i,n,o,a,s,l,r,d,u;t=e.authtoolbox||(e.authtoolbox={}),(i=e).utils,n=i.dom,o=i.ipc,a=i.drag,i.ulocale,s=i.Observable.SchemaUtils,l=i.authtoolboxutils,r=function(e,t){e.find('li[draggable="true"]').on("dragstart",function(e){e.stopPropagation();var i=t.getItemById($(this).attr("data-toolbox"));if(!i||!i.data)return e.preventDefault(),!1;var n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer;n.effectAllowed="move",n.setData("Text","Data");var o={isNew:!0,data:$.extend(!0,{},i.data.data),isLayout:!1,isField:!1,isWidget:!1};switch(i.data.$type){case"layout":o.isLayout=!0;break;case"field":o.isField=!0;break;case"widget":o.isWidget=!0}a.setData(o)}).on("dragend",function(e){return o.emit("ToolBoxDragend",null),a.setData(null),e.preventDefault(),e.stopPropagation(),!1})},d=function(e,t){e.find('li[draggable="true"]').off("dragstart dragend")},u=function(){function e(e,t){var i=this;i.$element=null,i.map={},i.options=t||{},(e=e||{}).$type=e.$type||"groups",l.check(e,i.map),i.data=e,i._setListeners()}return e.prototype.updateFieldItems=function(e){var t=this,i=t.data.$items.find(function(e){return"fields"===e.$typeItems}),o=t.data.$items.find(function(e){return"actions"===e.$typeItems});if(i||(i={$type:"group",$typeItems:"fields",$items:[]},t.data.$items.push(i)),o||(o={$type:"group",$typeItems:"actions",$items:[]},t.data.$items.push(o)),i.$items=[],o.$items=[],e.forEach(function(e){var t={$type:"item",$title:e.$title,data:{$type:"field",data:{$bind:e.$bind,$widget:e.$widget,options:e.options}}};"field"===e.$type?i.$items.push(t):o.$items.push(t)}),t.map={},l.check(t.data,t.map),t.$element){var a=t.$element.get(0);d(t.$element);var s=n.find(a,i.$id);if(s&&n.remove(s),(s=n.find(a,o.$id))&&n.remove(s),i.$items.length){var u=$(l.toHtml(i,t.data)).get(0);n.append(a,u)}if(o.$items.length){var p=$(l.toHtml(o,t.data)).get(0);n.append(a,p)}r(t.$element,t)}},e.prototype.renderToolBox=function(e,t){return $(l.toHtml(e,t))},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=t.renderToolBox(t.data,null),r(t.$element,t)),e&&(t.options.beforeAdd&&t.options.beforeAdd(t.$element),t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},e.prototype._clearChildren=function(){},e.prototype._removeEvents=function(){this.$element&&d(this.$element)},e.prototype.destroy=function(){var e=this;e._clearChildren(),e.$element&&(e._removeEvents(),e.$element=null),o.unlisten(e)},e.prototype.getItemById=function(e){if(!e)return null;return this.map[e]},e.prototype._setListeners=function(){o.listen("onFormData",function(e){if(e.schema){var t=s.schema2Authoring(e.schema,e.schema,e.locale);this.updateFieldItems(t)}},this)},e}(),t.ToolBox=u}(Phoenix||(Phoenix={})),function(e){var t,i,n=e,o=n.utils,a=n.ipc,s=n.dom;n.authtoolbar,n.authtoolbox,n.authpropedit;t=e.authoring||(e.authoring={}),i=function(){function t(t,i){var n=this;n.options=t,n.id=o.allocID(),n._pe=new e.authpropedit.PropertyEditor(t),n._toolBar=new e.authtoolbar.AuthoringToolBar(t),n._toolBox=new e.authtoolbox.ToolBox(i,t),n._setListeners()}return t.prototype.render=function(e){var t,i,n=this,a=!1;if(!n.$element){var l=e.get(0).parentNode,r=s.find(l,"toolbox_parent");if(r){a=!0,n.$element=$(l),r.id="toolbox_parent_"+n.id;var d=s.find(l,"editor");d&&(d.id="editor_"+n.id),(d=s.find(l,"nav"))&&(d.id="nav_"+n.id),(d=s.find(l,"toolbox"))&&(d.id="toolbox_"+n.id)}else n.$element=$((t=n.id,n.options,(i=['<div class="container-fluid">']).push('<div id="nav_{0}"></div>'),i.push('<div class="row design-table">'),i.push('<div style="width:100%">'),i.push('<div id="content"></div>'),i.push("</div>"),i.push('<div id="toolbox_parent_{0}" style="width:300px">'),i.push('<div id="toolbox_{0}" class="bs-scroll-container"></div>'),i.push("</div>"),i.push("</div>"),i.push('<div id="editor_{0}"></div>'),i.push("</div>"),o.format(i.join(""),t)));var u=n.$element.get(0);n.options.beforeAdd&&n.options.beforeAdd(n.$element);var p=s.find(u,"editor_"+n.id);p&&n._pe.render($(p)),(p=s.find(u,"nav_"+n.id))&&n._toolBar.render($(p)),(p=s.find(u,"toolbox_"+n.id))&&n._toolBox.render($(p)),n.setDesignMode(n.options.design)}return e&&!a&&(n.options.replaceParent?e.replaceWith(n.$element):e.append(n.$element)),n.$element},t.prototype._setListeners=function(){var e=this;a.listen("onAuthoringModeChanged",function(t){e.setDesignMode(t)},this)},t.prototype.setDesignMode=function(e){var t=this;if(t.options.design=e,t.$element){var i=s.find(t.$element.get(0),"toolbox_parent_"+t.id);i&&(t.options.design?s.removeClass(i,"bs-none"):s.addClass(i,"bs-none"))}},t.prototype.destroy=function(){var e=this;e.$element&&(e.$element=null),e._pe&&(e._pe.destroy(),e._pe=null),e._pe&&(e._pe.destroy(),e._pe=null),a.unlisten(e)},t}(),t.AuthoringEditor=i}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.design.min.js.map