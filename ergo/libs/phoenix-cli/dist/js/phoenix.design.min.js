!function(e){!function(t){var i=e.dom,n=t,s=e.ipc,o=e.link,a=e.drag,l=e.utils,r=e.layoutUtils,d=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},u=function(e,t,i,n,s,o){if(!o)return i.$parentId=t.$id,void t.$items.splice(n,0,i);if(t.$origin===r.LAYOUT_ROW&&t.$type!==r.LAYOUT_ROW&&(delete t.$origin,t.$type=r.LAYOUT_ROW,d(t)),i.$parentId=t.$id,t.$type===r.LAYOUT_ROW)switch(i.$type===r.LAYOUT_BLOCK&&i.$origin===r.LAYOUT_ROW&&(i.$type=r.LAYOUT_ROW,delete i.$origin),i.$type){case r.LAYOUT_BLOCK:case r.LAYOUT_ACCORDION_GROUP:delete i.$origin,delete i.$type,d(i);break;case r.LAYOUT_COLUMN:s||(delete i.$colSize,delete i.$customColSize);break;default:(a={$items:[],$auto:!0}).$items.push(i),i=a}else if(t.$type===r.LAYOUT_ACCORDION)switch(i.$type){case r.LAYOUT_ACCORDION_GROUP:break;case r.LAYOUT_BLOCK:i.$type=r.LAYOUT_ACCORDION_GROUP,d(i);break;case r.LAYOUT_COLUMN:delete i.$colSize,delete i.$customColSize,i.$type=r.LAYOUT_ACCORDION_GROUP,d(i);break;default:var a={$type:r.LAYOUT_ACCORDION_GROUP,$items:[],$auto:!0};a.$items.push(i),i=a}else switch(i.$type){case r.LAYOUT_COLUMN:case r.LAYOUT_ACCORDION_GROUP:delete i.$colSize,delete i.$customColSize,i.$type=r.LAYOUT_BLOCK,d(i),i.$auto&&(i=i.$items[0])}t.$items.splice(n,0,i)},p=function(e){return e.originalEvent?e.originalEvent:e},c=function(e,t){if(!e)return null;var i,n,s,o,a,l;e.map&&(i=!0,n=e.map,e.map=null,s=e.fields,e.fields=null),t&&((o=e.$items)&&(e.$items=[]),a=e.$render,e.$render=null),e.$config&&e.$config.datasets&&(l=e.$config.data?e.$config.data.ds:null)&&delete e.$config.data.ds;var d=$.extend(!0,{},e);return i&&(e.map=n,e.fields=s,delete d.fields,delete d.map),t&&(e.$items=o,e.$render=a),l&&(e.$config.data.ds=l),r.clearMeta(d,!t),t&&delete d.$items,d},h=function(e,t,n,s){for(var o=[],a=e.childNodes,l=0,r=a.length;l<r;l++){var d=a[l],u=i.offset(d),p={position:s?u.left+(u.width>>1):u.top+(u.height>>1),ignore:d===t&&!s||3===d.nodeType||d.hasAttribute("data-remove")||d.hasAttribute("data-ignore"),placeHolder:d===n};o.push(p)}return o},f=function(e,t){var i=0;if(e.length){for(var n=0,s=e.length;n<s;n++){var o=e[n];if(!o.ignore&&t<o.position)return n;i=n+1}return i}return i},m=function(e){var t=e.nextSibling,i=e.previousSibling,n=0;i&&(n=t?t.offsetLeft-5:i.offsetLeft+i.offsetWidth-10),e.style.left=parseInt(n+"",10)+"px"},y=function(e,t,n,s,o,a,l,r){r&&(l.horizontal?i.addClass(s,"drop-target-col"):(s.style.removeProperty&&(s.style.removeProperty("height"),s.style.removeProperty("left")),i.removeClass(s,"drop-target-col")));var d=function(e){s.parentNode&&O(s),o.$type&&!e&&("column"===o.$type&&1===a?i.addClass(s,"col"):i.removeClass(s,"col"))},u=!0;if(t.length||(d(!1),i.append(e,s),u=!1),u){for(var p=-1,c=0,h=t.length;c<h;c++){var f=t[c];if(f.placeHolder){if(p=c,c===n||c===n-1)return!1}else if(f.ignore){if(c===n&&c+1<h&&t[c+1].placeHolder)return!1;if(c===n-1&&c>0&&t[c-1].placeHolder)return!1}}if(p<0||n>=t.length)d(p>=0),i.append(e,s);else{var $=e.childNodes[n];d(p>=0),i.before($,s)}}return l.horizontal&&m(s),!0},g=function(e,t,n){if(n){for(var s=0,o=e.childNodes.length;s<o;s++)t?i.addClass(e.childNodes[s],"bs-none-drag"):i.removeClass(e.childNodes[s],"bs-none-drag");t?(i.addClass(e,"drag-source"),2===n&&i.removeClass(e,"auto")):(i.removeClass(e,"drag-source"),2===n&&i.addClass(e,"auto"))}},b=function(e,t,i,n,s){return e&&O(e),e=document.createElement("div"),e.className="container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"+(i?" bs-island bs-field":"")+(n?" bs-island bs-widget":"")+(s?" drop-target-col":""),e},v=function(e,t,i){i&&(e.off("click"),e.find('*[draggable="true"]').off("dragstart").add(e).off("dragend"),e.find('*[draggable="true"]').off("dragstart"),e.find(".drop-layouts-zone, .drop-fields-zone").add(e).off("dragover dragenter drop"))},O=function(e){i.remove(e)},C=function(e,t,n){if(n){var s,o,l,c,$,_,L=function(){_=!1,s&&(i.removeClass(s,"bs-none"),s.isColumn&&g(s.firstChild,!1,s.isColumn),s.isColumn=!1,s=null),c&&(O(c),c=null),o&&(i.remove(o),o=null),$=null,l=!1,a.setData(null)},A=function(s){var o=e.get(0);if(s){if(s.data===s.dst)return;var a,l,p,c,h=s.dst,f=s.data,$=i.find(o,f.$id),m=i.find(o,h.$idDesign),y=!1;if(f.$parentId===h.$id){if(p=s.dst,l=p.$items.indexOf(f),a=s.indexInParent,y=!0,a===l)return}else l=(p=s.isNew?null:t.getLayoutById(f.$parentId))?p.$items.indexOf(f):-1,a=s.indexInParent;if(l>=0&&function(e,t,i,n,s){s?(t.$items.splice(i,1),t.$type===r.LAYOUT_ROW?t.$items.length?delete t.$items[0].$colSize:(t.$type=r.LAYOUT_BLOCK,t.$origin=r.LAYOUT_ROW,d(t)):t.$type===r.LAYOUT_ACCORDION&&(t.$items.length||(t.$type=r.LAYOUT_BLOCK,delete t.$origin,d(t)))):t.$items.splice(i,1)}(0,p,l,0,s.isLayout),u(0,h,f,a,y,s.isLayout),s.isNew||s.isLayout)t.check(null);else{if(l>=0&&i.detach($),a===h.$items.length-1?i.append(m,$):(c=i.find(o,h.$items[a+1].$id),i.before(c,$)),!h.$items[a].$bind){var g=[p];return h!==p&&g.push(h),v(e,0,n),C(e,t,n),void g.forEach(function(e){t._afterPropsChanged(e)})}t.check(null)}t.render()}};e.on("click",function(i){var n=function(e,t,i){for(var n,s,o=e.target,a=null;o;){if(a=o.getAttribute("data-layout")){if(n=parseInt(o.getAttribute("data-level")||"1",10),(s=i.getLayoutById(a))&&r.canSelect(s,n)||(a=null),a)break}else if(a=o.getAttribute("data-render"))break;o=o===t?null:o.parentNode}return a}(i,e.get(0),t);!function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-remove"))return!0;i=i===t?null:i.parentNode}return!1}(i,e.get(0))?!function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-layout-detail"))return!0;i=i===t?null:i.parentNode}return!1}(i,e.get(0))?t.select(n):t.authoringChild(n):t.removeChild(n)}),e.find('*[draggable="true"]').on("dragstart",function(n){n.stopPropagation();var r=!1,d=!0,u=!1,c=t.getLayoutById(this.getAttribute("data-layout"));if(c||(r=!(u=null!=(c=t.getFieldById(this.getAttribute("data-render"))).$config),d=!1),!c)return n.preventDefault(),!1;c.selected&&t.select(null);var h=p(n).dataTransfer;h.effectAllowed="move",h.setData("Text","data"),d&&h.setDragImage&&(o=function(e){var t=document.createElement("div");return t.className="bs-drag-image",document.body.appendChild(t),t}(),h.setDragImage(o,0,0));var f=t.getLayoutById(c.$parentId);f&&f.$auto&&(c=f),a.setData({data:c,isLayout:d,isField:r,isWidget:u,isNew:!1}),s=i.find(e.get(0),c.$idDrag),l=!0}).add(e).on("dragend",function(e){return e.preventDefault(),e.stopPropagation(),L(),!1}),e.find(".drop-layouts-zone, .drop-fields-zone").add(e).on("dragover dragenter drop",function(e){var n=a.getData(),o=p(e),d=o.dataTransfer;if(e.stopPropagation(),_)return!0;if(!n||!n.isLayout&&!i.hasClass(this,"drop-fields-zone")||n.isLayout&&!i.hasClass(this,"drop-layouts-zone"))return d.effectAllowed="none",!0;if("drop"===e.type){e.preventDefault();var u=t.getLayoutById(this.getAttribute("data-layout")),v=this.getAttribute("data-level");return u?(n=a.getData(),n.dst=u,n.dstLevel=v,n.indexInParent=function(e,t,i,n){for(var s=0,o=0,a=e.childNodes.length;o<a;o++){var l=e.childNodes[o];if(3!==l.nodeType){if(l===t)return s;l!==i&&(n&&!l.hasAttribute("data-layout")||(n||l.hasAttribute("data-render"))&&s++)}}return 0}(this,c,s,n.isLayout),a.setData(n),L(),A(n),!1):(L(),!1)}if(d.getData("Text"),l){if(!s)return;if(l=!1,!n.isNew)return _=!0,c=function(e,t,n,s,o,a,l){if(n){var d=l.$type===r.LAYOUT_COLUMN;t&&O(t),t=b(null,n,s,o,d),i.addClass(t,"drop-target"),d?(e.isColumn=1,l.$auto&&(e.isColumn=2),g(e.firstChild,!0,e.isColumn),i.before(e,t),m(t)):(i.addClass(e,"bs-none"),i.before(e,t))}else t=b(t,!1,s,o,!1),i.before(e,t),i.addClass(e,"bs-none");return t}(s,c,n.isLayout,n.isField,n.isWidget,0,n.data),setTimeout(function(){_=!1},0),e.preventDefault(),!1}var C=t.getLayoutById(this.getAttribute("data-layout")),T=this.getAttribute("data-level");if(!c){if(!n.isNew)return!0;var S=t._canDropChild(n.data,C,T);if(!S)return d.effectAllowed="none",!0;$=h(this,s,c,S.horizontal);var D=f($,S.horizontal?o.pageX:o.pageY);return c=b(c,n.isLayout,n.isField,n.isWidget,S.horizontal),y(this,$,D,c,C,T,S,n.isLayout),$=null,e.preventDefault(),!1}if("dragenter"===e.type&&($=null),s===this)return d.effectAllowed="none",!0;var U=t._canDropChild(n.data,C,T);if(!U)return d.effectAllowed="none",!0;$||($=h(this,s,c,U.horizontal));var w=f($,U.horizontal?o.pageX:o.pageY);return y(this,$,w,c,C,T,U,n.isLayout)&&($=null),e.preventDefault(),!1})}},_={_setDesignListeners:function(e){s.listen("onToolBoxDragend",function(){this.$element&&this.$element.trigger("dragend")},this),s.listen("onUpdateSelected",function(e){"layout"===e.type?this.updateLayout(e.id,e.data):this.updateField(e.id,e.data)},this),s.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this),s.listen("onSaveLayout",function(){if(this.saveHandler){var e=c(this.data,!1);this.saveHandler(e)}},this),s.listen("onNewLayout",function(e){if(this.createHandler){var t=c(this.data,!1);this.createHandler(e.name,t)}},this),s.listen("onLoadNestedLayouts",function(e){this.loadNestedHandler&&this.loadNestedHandler(e.data,e.after)},this),s.listen("onOpenLayout",function(e){this.openHandler&&this.openHandler(e.name)},this),s.listen("onRemoveLayout",function(){this.removeHandler&&this.removeHandler()},this),s.listen("onListLayout",function(e){this.listHandler&&this.listHandler(e)},this)},_afterCreate:function(){var e=this;e.options.form&&e.options.design&&l.nextTick(function(){s.emit("FormData",{schema:e.$schema,locale:e.$locale})})},authoringChild:function(e){var t=this.getLayoutById(e);if(t&&t.$ref)if(this.options.form){var i={name:t.$ref};t.$refProperty&&(i.path=t.$refProperty);var n=o.context();i.schema=n.$url.prototype?n.$url.prototype:this.data.name,i.locale=n.$url.locale?n.$url.locale:this.data.name,o.doFormAuthoring(i)}else o.doAuthoring(t.$ref,!0)},_removeEvents:function(){v(this.$element,0,!0),this._removeBaseEvents()},_addEvents:function(){C(this.$element,this,this.options.design),this._addBaseEvents()},_onSelectedChanged:function(e,t,n){!function(e,t,n,o){if(t){var a=i.find(e,t.$idSelect||t.$idDrag);if(e!==a&&a)if(t.selected){if(!a.querySelector('div[data-remove="true"]')){var l=$('<div class="bs-rt-button" data-remove="true"><span class="'+i.iconClass("times-circle")+'"></span></div>').get(0),r=a.childNodes;r.length?i.before(r[0],l):i.append(a,l)}}else{var d=a.querySelector('div[data-remove="true"]');d&&i.remove(d)}}if(n){var u=c(t,!0);if(u&&delete u.$id,t&&t.$type){u.$type=t.$type,t.$items&&t.$items.length&&!t.$items[0].$bind||(u.onlyFields=!0);var p=o.getLayoutById(t.$parentId);p&&(u.parent=c(p,!0),u.parent.$type=p.$type)}s.emit("SelectedChanged",{type:t?t.$type?"layout":t.$config?"widget":"field":null,id:t?t.$id:null,data:u,control:o})}}(e,t,n,this)},_showSelected:function(e,t){!function(e,t){if(e){var n=i.find(e.get(0),t.$idSelect||t.$idDrag);t.selected?i.addClass(n,"selected"):i.removeClass(n,"selected")}}(e,t)},_canDropChild:function(e,t,i){if(t&&t.$type&&t.$ref)return null;if(e.$type)return i=parseInt(i||"1",10),t&&e?t===e?null:this.isChildOf(e,t)?null:"row"===t.$type?{horizontal:!0}:{horizontal:!1}:null;if(e.$bind||e.$config){var n=t.$items.length;if(!n)return{horizontal:!1};for(var s=e.$bind?"$bind":"$config";n--;)if(!t.$items[n][s])return null;return{horizontal:!1}}return null},toString:function(e){var t=c(e||this.data,!1);return JSON.stringify(t)}};$.extend(n.Layout.prototype,_),$.extend(n.Form.prototype,_)}(e.ui||(e.ui={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.utils,s=i.ipc,o=i.locale,a=i.ui,l=i.layoutUtils,r=i.dom,d=function(){function e(e){this.$element=null,this.form=null,this.$id=n.allocID(),this.options=e||{},this.selected=null,this._setListeners()}return e.prototype._sendLayout=function(e){var t=this;t.selected&&t.selected.id&&n.nextTick(function(){var i=t._model2layout(e);i&&s.emit("UpdateSelected",{type:"layout",id:t.selected.id,data:i})})},e.prototype._updateFields=function(e){var t=this;t.selected&&t.selected.id&&(t.selected.data&&t.selected.data.$config?t.selected.data.$config=JSON.parse(e.options):t.selected.data=JSON.parse(e.options),n.nextTick(function(){s.emit("UpdateSelected",t.selected)}))},e.prototype._hasData=function(){return this.selected&&this.selected.type},e.prototype._setListeners=function(){s.listen("onSelectedChanged",function(e){this.selected=e;var t=this.$element.get(0);if(this._hasData()){r.removeClass(t,"bs-none");var i="layout"===this.selected.type;if(this.$element){var n=e.data;n&&n.$config&&(n=n.$config),this._setJson(n,i)}}else r.addClass(t,"bs-none")},this),s.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this)},e.prototype._model2layout=function(e){var t=!1,i=this.selected.data,n={},s=e.childrenFlow;s===l.LAYOUT_BLOCK&&("column"===i.$type?s="column":i.$type===l.LAYOUT_ACCORDION_GROUP&&(s=l.LAYOUT_ACCORDION_GROUP));var o=s===l.LAYOUT_ACCORDION,a=s===l.LAYOUT_ACCORDION_GROUP;s!==(r=i.$origin||i.$type)&&(n.$type=s,t=!0);var r=i.$ref||i.$type;n.$ref=e.subLayoutName,t||(i.$ref||"")===(e.subLayoutName||"")||(t=!0),n.$refProperty=e.subPathSchema,t||(i.$refProperty||"")===(e.subPathSchema||"")||(t=!0),n.$forceTable=e.forceTable,t||(i.$forceTable||!1)===(e.forceTable||!1)||(t=!0),n.$name=e.name,t||(i.$name||"")===(e.name||"")||(t=!0),s===l.LAYOUT_BLOCK&&(n.$sticky=e.sticky,t||(i.$sticky||"")===(e.sticky||"")||(t=!0)),n.$refController=e.subController,t||(i.$refController||"")===(e.subController||"")||(t=!0),n.$style=e.style,t||(i.$style||"")===(e.style||"")||(t=!0);var d=s===l.LAYOUT_ACCORDION&&"none"===e.format?e.bindPages:void 0;if(n.$bindPages=d,i.$bindPages!==d&&(t=!0),e.$states.colSize.isHidden||("column"===s?(e.colSize!==i.$colSize&&(n.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.$customColSize||"")&&(n.$customColSize=e.customColSize,t=!0)):i.parent&&i.parent.$auto&&(e.colSize!==i.parent.$colSize&&(n.parent=n.parent||{},n.parent.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.parent.$customColSize||"")&&(n.parent=n.parent||{},n.parent.$customColSize=e.customColSize,t=!0))),e.$states.showTitle.isHidden?i.$title&&(t=!0):e.showTitle?i.$title?(!i.$title.value!==e.title&&(t=!0,n.$title=n.$title||{},n.$title.value=e.title),a||(!i.$title.size!==e.titleSize&&(t=!0,n.$title=n.$title||{},n.$title.size=e.titleSize),!i.$title.$style!==e.titleStyle&&(t=!0,n.$title=n.$title||{},n.$title.$style=e.titleStyle))):(t=!0,n.$title={},n.$title.value=e.title,a||(n.$title.size=e.titleSize,n.$title.$style=e.titleStyle)):i.$title&&(t=!0),o){var u=i.$widget,p=e.format===l.LAYOUT_ACCORDION?void 0:e.format;u!==p&&(t=!0),n.$widget=p}if(!e.$states.formType.isHidden){var c=e.formType,u=i.$inline?"inline":i.$fieldsOptions&&i.$fieldsOptions.columns?"horizontal":"block";if(n.$fieldsOptions={},c!==r)switch(t=!0,c){case l.LAYOUT_BLOCK:n.$inline=!1,n.$fieldsOptions.columns=!1;break;case"horizontal":n.$inline=!1,n.$fieldsOptions.columns=!0,n.$fieldsOptions.labelCol=e.labelCol;break;case"inline":n.$inline=!0,n.$fieldsOptions.columns=!1}else"horizontal"===c&&n.$fieldsOptions.labelCol!==e.labelCol&&(n.$fieldsOptions.labelCol=e.labelCol,t=!0);n.$fieldsOptions.labelCol&&3==n.$fieldsOptions.labelCol&&delete n.$fieldsOptions.labelCol;!(!i.$fieldsOptions||!i.$fieldsOptions.titleIsHidden)!==e.titleIsHidden&&(n.$fieldsOptions.titleIsHidden=e.titleIsHidden,t=!0)}return t?n:null},e.prototype._schemaFields=function(){return{links:{apply:{title:o.layouts.design.actionApply}},properties:{options:{type:"string",format:"json"}}}},e.prototype._field2FormData=function(e){return{options:JSON.stringify(e,null,2)}},e.prototype._layoutFields=function(){return{name:n.allocID(),$type:l.LAYOUT_BLOCK,$items:[{$type:l.LAYOUT_BLOCK,$title:{value:o.layouts.design.properties},$items:[{$bind:"options",options:{rows:5}}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._schemaLayout=function(){return{links:{apply:{title:o.layouts.design.actionApply}},properties:{typeLayout:{type:"string"},forceTable:{title:o.layouts.design.forceDisplayTable,type:"boolean"},name:{title:o.layouts.design.name,type:"string"},showTitle:{title:o.layouts.design.showTitle,type:"boolean"},title:{type:"string",title:o.layouts.design.Title},bindPages:{type:"string",title:o.layouts.design.bindPagesTitle},titleSize:{type:"number",title:"Size",enum:[1,2,3,4,5,6],enumNames:["H1","H2","H3","H4","H5","H6"]},titleStyle:{type:"string",title:"Style"},childrenFlow:{type:"string",title:o.layouts.design.childrenFlow,enum:[l.LAYOUT_BLOCK,l.LAYOUT_ROW,l.LAYOUT_ACCORDION],enumNames:[o.layouts.design.childrenFlowVertical,o.layouts.design.childrenTableCell,o.layouts.design.childrenAccordionGroup],filters:{blockrow:[l.LAYOUT_BLOCK,l.LAYOUT_ROW],onlyblock:[l.LAYOUT_BLOCK],accordion:[l.LAYOUT_ACCORDION]}},format:{type:"string",title:o.layouts.design.appearance,enum:[l.LAYOUT_ACCORDION,"tabs","none"],enumNames:[o.layouts.design.appearanceAccordion,o.layouts.design.appearanceTabs,o.layouts.design.appearanceWizard]},subLayoutName:{type:"string",title:o.layouts.design.nestedLayoutName},subPathSchema:{type:"string",title:o.layouts.design.nestedLayoutBind},subController:{type:"string",title:o.layouts.design.nestedFormController},style:{type:"string",title:o.layouts.design.customStyle},colSize:{type:"number",title:o.layouts.design.columnSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["08.33%","16.67%","25.00%","33.33%","41.37%","50.00%","58.33%","66.67%","75.00%","83.33%","91.33%","100.00%"]},customSize:{type:"string",title:o.layouts.design.customColumnSize},formType:{title:o.layouts.design.formType,enum:[l.LAYOUT_BLOCK,"horizontal","inline"],enumNames:[o.layouts.design.ftVertical,o.layouts.design.ftHorizontal,o.layouts.design.ftInline],type:"string"},labelCol:{title:o.layouts.design.labelSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],type:"number"},sticky:{title:o.layouts.design.blockPosition,type:"string",enum:["","top","bottom"],enumNames:[o.layouts.design.bpStatic,o.layouts.design.bpStickyTop,o.layouts.design.bpStickyBottom]},titleIsHidden:{title:o.layouts.design.noTitlesForFields,type:"boolean"}}}},e.prototype._layout2FormData=function(e){var t=e.$origin||e.$type,i=l.LAYOUT_BLOCK,n="onlyblock",s=t===l.LAYOUT_ACCORDION_GROUP,o=t===l.LAYOUT_ACCORDION,a=o?e.$widget||l.LAYOUT_ACCORDION:l.LAYOUT_ACCORDION,r=this.options.form&&(t===l.LAYOUT_BLOCK||"column"===t)||s,d=s||t===l.LAYOUT_BLOCK||"column"===t,u=r&&!!e.$title||s;s&&e.$title&&e.$title.size&&(e.$title.size=4),["column",l.LAYOUT_BLOCK,"row"].indexOf(t)>=0?("row"===t&&(i="row"),e.parent&&(n="blockrow")):t===l.LAYOUT_ACCORDION&&(n=l.LAYOUT_ACCORDION,i=l.LAYOUT_ACCORDION);var p=!1;("column"===t||e.parent&&e.parent.$auto&&"column"===e.parent.$type)&&(p=!0,"column"===t||e.parent);var c=this.options.form&&e.onlyFields&&!e.$ref,h=e.$inline?"inline":e.$fieldsOptions&&e.$fieldsOptions.columns?"horizontal":l.LAYOUT_BLOCK;return{typeLayout:t,showTitle:u,name:e.$name,title:e.$title&&e.$title.value?e.$title.value:"",titleSize:e.$title&&e.$title.size?e.$title.size:4,titleStyle:e.$title&&e.$title.$style?e.$title.$style:"",childrenFlow:i,bindPages:e.$bindPages,colSize:e.$colSize||0,customSize:e.$customColSize,formType:h,format:a,subLayoutName:e.$ref,subPathSchema:e.$refProperty,forceTable:e.$forceTable,subController:e.$refController,style:e.$style,labelCol:e.$fieldsOptions&&e.$fieldsOptions.labelCol?e.$fieldsOptions.labelCol:3,titleIsHidden:!(!e.$fieldsOptions||!e.$fieldsOptions.titleIsHidden),sticky:t===l.LAYOUT_BLOCK?e.$sticky||"":"",$states:{showTitle:{isHidden:!r,isDisabled:s},title:{isHidden:!r||!u},bindPages:{isHidden:!(t===l.LAYOUT_ACCORDION&&"none"===e.$widget)},titleSize:{isHidden:!r||!u||s},titleStyle:{isHidden:!r||!u||s},colSize:{isHidden:!p},customSize:{isHidden:!p},childrenFlow:{filter:n},format:{isHidden:!o},formType:{isHidden:!c},labelCol:{isHidden:!c||"horizontal"!==h},titleIsHidden:{isHidden:!c},subLayoutName:{isHidden:!d},forceTable:{isHidden:t!==l.LAYOUT_ROW},subPathSchema:{isHidden:!d||!this.options.form},subController:{isHidden:!d||!this.options.form},sticky:{isHidden:t!==l.LAYOUT_BLOCK}},$links:{apply:{isDisabled:!0}}}},e.prototype._emptyContent=function(){this.form&&(a.removeForm(this.form),this.form=null),r.empty(this.$element.get(0))},e.prototype._layoutEdit=function(){return{name:n.allocID(),$type:l.LAYOUT_BLOCK,$items:[{$title:{value:"Title"},$bindState:"showTitle",$type:l.LAYOUT_BLOCK,$items:[{$bind:"showTitle"},{$bind:"title"},{$bind:"titleSize"},{$bind:"titleStyle"}]},{$type:l.LAYOUT_BLOCK,$title:{value:o.layouts.design.properties},$items:[{$bind:"name"},{$bind:"childrenFlow"},{$bind:"forceTable"},{$bind:"format"},{$bind:"sticky"},{$bind:"bindPages"},{$bind:"subLayoutName"},{$bind:"subPathSchema"},{$bind:"subController"},{$bind:"style"},{$bind:"colSize"},{$bind:"customSize"}]},{$type:l.LAYOUT_BLOCK,$bindState:"formType",$title:{value:o.layouts.design.fieldsTitle},$items:[{$bind:"formType"},{$bind:"labelCol"},{$bind:"titleIsHidden"}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._setJson=function(e,t){var i=this;i._emptyContent(),t?a.OpenForm(i.$element,i._layoutEdit(),i._schemaLayout(),i._layout2FormData(e),{},function(e,t,n){var s=!1;if("propchange"===e.operation){var o=t.typeLayout===l.LAYOUT_ACCORDION_GROUP;switch(e.property){case"showTitle":o||(t.$states.title.isHidden=!t.showTitle,t.$states.titleSize.isHidden=!t.showTitle,t.$states.titleStyle.isHidden=!t.showTitle,s=!0);break;case"formType":t.$states.labelCol.isHidden=t.$states.showTitle.isHidden||"horizontal"!==t.formType,s=!0;break;case"childrenFlow":case"colSize":case"subLayoutName":if(!t.validate())return;i._sendLayout(t);break;case"subPathSchema":if(!t.validate())return;t.subLayoutName?i._sendLayout(t):s=!0;break;case"forceTable":if(!t.validate())return;i._sendLayout(t);break;case"format":t.$states.bindPages.isHidden=!(t.typeLayout===l.LAYOUT_ACCORDION&&"none"===t.format);default:s=!0}s&&(t.$links.apply.isDisabled=!1)}if("execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;i._sendLayout(t)}},{},function(e){i.form=e}):a.OpenForm(i.$element,i._layoutFields(),i._schemaFields(),i._field2FormData(e),{},function(e,t,n){if("propchange"===e.operation&&(e.property,!0&&(t.$links.apply.isDisabled=!1)),"execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;i._updateFields(t)}},{},function(e){i.form=e})},e.prototype.setDesignMode=function(e){this.options.design=e,this.$element&&(this.options.design&&this.selected?r.removeClass(this.$element.get(0),"bs-none"):r.addClass(this.$element.get(0),"bs-none"))},e.prototype.render=function(e){return this.$element||(this.$element=$('<div id= "'+this.$id+'"></div>'),this.options.beforeAdd&&this.options.beforeAdd(this.$element)),e&&(this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element)),this.$element},e.prototype.destroy=function(){this.form&&(this.form.destroy(),this.form=null),this.$element&&(this.$element=null),s.unlisten(this)},e}();t.PropertyEditor=d}(e.authpropedit||(e.authpropedit={}))}(Phoenix||(Phoenix={}));!function(e){var t=e,i=t.utils,n=t.ipc,s=t.build,o=(t.drag,t.dom),a=t.ui,l=t.locale,r=t.pagecontrol;t.ulocale;!function(d){var u=function(){function d(e){this.$element=null,this.$id=i.allocID(),this.options=e||{}}return d.prototype._removeEvents=function(){this.$element.off("click")},d.prototype._setEvents=function(){var e=this;e.$element.get(0);e.$element.on("click",function(t){var a=!1;switch(t.target.id){case e.$id+"_save":n.emit("SaveLayout",null),a=!0;break;case e.$id+"_open":e._openExisting(),a=!0;break;case e.$id+"_remove":a=!0,i.confirm("",s.release?l.layouts.design.ConfirmDeletePrefs:l.layouts.design.ConfirmDelete,function(){n.emit("RemoveLayout",null)});break;case e.$id+"_preview":var r=o.query(e.$element.get(0),"#"+e.$id+"_preview");n.emit("AuthoringModeChanged",!r.checked);break;case e.$id+"_new":a=!0,i.prompt(l.layouts.design.PageName,"",function(e){(e=e.trim())&&(e.indexOf(" ")>=0?alert(l.layouts.design.InvalidPageName):n.emit("NewLayout",{name:e}))});break;default:a=!1}return!a||(t.stopPropagation(),t.preventDefault(),!1)})},d.prototype._clearChildren=function(){},d.prototype._openExisting=function(){var e=this;n.emit("ListLayout",function(t){if(t&&t.files){for(var i=[],s=0;s<t.files.length;s++){var o=t.files[s];o!=r.Page().currentPage()&&i.push(o)}i.length&&e._openModal(i,function(e){n.emit("OpenLayout",{name:e})})}})},d.prototype._openModal=function(t,i){t.sort();var n={type:"object",properties:{page:{title:"Name",type:"string",enum:t}}},s={page:t[0]},o={title:l.layouts.design.Open.title,buttons:[{type:"default",title:l.layouts.design.Open.close,name:"cancel"},{type:"primary",title:l.layouts.design.Open.open,name:"ok"}]};a.OpenModalForm(o,{name:"open",$type:"block",$items:[{$bind:"page"}]},n,s,e.locale,function(e,t,n,s){if("modal-action"===t.operation)switch(t.property){case"ok":var o=n.page;e.close(),i&&i(o);break;case"cancel":e.close()}})},d.prototype.render=function(e){return this.$element||(this.$element=$(function(e,i){var n=t.bootstrap4,a=[];return n?(a.push('<div class="bs-island" id="'+e+'">'),a.push('<form class="form-inline">')):(a.push('<nav class="navbar navbar-default" id="'+e+'">'),a.push('<div class="container-fluid">'),a.push('<div class="navbar-header">'),a.push('<a class="navbar-brand" href="#">'),a.push(l.layouts.design.AuthoringMode),a.push("</a>"),a.push("</div>"),a.push('<div class="collapse navbar-collapse">'),a.push('<form class="navbar-form navbar-left" role="search">')),a.push('<button type="button" class="mr-2 bs-button btn btn-'+o.bootstrapStyles(!0).secondary+(s.release||i.form?" bs-none":"")+'" id="'+e+'_new">'),a.push('<span class="'+o.iconClass("plus")+'" aria-hidden="false"></span> '),a.push(l.layouts.design.New),a.push("</button>&nbsp;"),a.push('<button type="button" class="mr-2 bs-button  btn btn-'+o.bootstrapStyles(!0).secondary+(s.release||i.form?" bs-none":"")+'" id="'+e+'_open">'),a.push('<span class="'+o.iconClass("file-o")+'" aria-hidden="false"></span> '),a.push(l.layouts.design.Open.title),a.push("</button>&nbsp;"),a.push('<button type="button" class="mr-2 bs-button btn btn-'+o.bootstrapStyles(!0).secondary+(i.form?" bs-none":"")+'" id="'+e+'_remove">'),a.push('<span class="'+o.iconClass("times")+'" aria-hidden="false"></span> '),s.release?a.push(l.layouts.design.DeletePreferences):a.push(l.layouts.design.Delete),a.push("</button>&nbsp;"),a.push('<button type="button" class="mr-2 bs-button btn btn-'+o.bootstrapStyles(!0).secondary+'" id="'+e+'_save">'),a.push('<span class="'+o.iconClass("floppy")+'" aria-hidden="false"></span> '),a.push(l.layouts.design.Save),a.push("</button>&nbsp;"),n?(a.push('<label class="form-check-inline">'),a.push('<input class="form-check-input" type="checkbox" id="'+e+'_preview"'+(i.design?"":' checked="true"')+">&nbsp;&nbsp;"),a.push(l.layouts.design.Preview),a.push("</label>")):(a.push('<div class="checkbox">'),a.push("<label>"),a.push('<input type="checkbox" id="'+e+'_preview"'+(i.design?"":' checked="true"')+"> "),a.push(l.layouts.design.Preview),a.push("</label>"),a.push("</div>")),a.push("</form>"),n||a.push("</div>"),n?a.push("<div>"):a.push("</nav>"),a.join("")}(this.$id,this.options)),this._setEvents(),this.options.beforeAdd&&this.options.beforeAdd(this.$element)),e&&(this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element)),this.$element},d.prototype.destroy=function(){this._clearChildren(),this.$element&&(this._removeEvents(),this.$element=null),n.unlisten(this)},d}();d.AuthoringToolBar=u}(e.authtoolbar||(e.authtoolbar={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=i.utils,s=i.dom,o=i.build,a=i.locale,l=function(e,t,i){e.$id=e.$id||n.allocID(),t&&(e.$parentId=t.$id),e.$items&&(e.$contentId=e.$contentId||n.allocUuid()),i&&(i[e.$id]=e)},r=function(e,t,i,n){e.push('<div class="panel-group" id="accordion_expo" role="tablist" aria-multiselectable="true">')},d=function(e,t){e.push("</div>")},u=function(e,t,i,n){var a=["list-group-item bs-cursor-p"];if(t.data&&"widget"===t.data.$type&&"dev"!==o.authMode){var l=!0;"admin"===o.authMode?l=["admin","user"].indexOf(t.mode)<0:"user"===o.authMode&&(l="user"!==t.mode),l&&a.push("bs-none")}e.push('<li draggable="true" class="'+a.join(" ")+'" data-toolbox="'+t.$id+'" id="'+t.$id+'">'),e.push('<span class="'+s.iconClass("file-o")+'"></span>&nbsp;'),e.push(t.$title),e.push("</li>")},p=function(e,t){},c=function(e,t,i){e&&(i(e,t,!0),e.$items&&e.$items.forEach(function(t){c(t,e,i)}),i(e,t,!1))},h=function(t,i,n){var o=!0;c(t,i,function(t,i,l){var c=u,h=p;switch(t.$type){case"groups":c=r,h=d;break;case"group":l?function(t,i,n,o){var l=e.bootstrap4;i.$typeItems=i.$typeItems||"layouts";var r;switch(i.$typeItems){case"layouts":r=i.$title||a.layouts.design.layouts;break;case"widgets":r=i.$title||a.layouts.design.widgets;break;case"actions":r=i.$title||a.layouts.design.actions;break;default:r=i.$title||a.layouts.design.fields}t.push('<div class="'+(l?"card":"panel panel-default")+'" id="'+i.$id+'">'),t.push('<div class="'+(l?"card-header":"panel-heading")+'"  role="tab" id="'+i.$id+'_tab">'),l||t.push('<h3 class="panel-title">'),t.push('<a data-toggle="collapse" aria-expanded="'+(o?"true":"false")+'" draggable="false" data-parent="#accordion_expo" aria-controls="'+i.$id+'_tab" href="#'+i.$id+'_content"><span class="'+s.iconClass("bars")+'">'),t.push("</span>&nbsp;"),t.push(r),t.push("</a>"),l||t.push("</h3>"),t.push("</div>"),t.push('<div id="'+i.$id+'_content" class="panel-collapse collapse'+(o?l?" show":" in":"")+'" role="tabpanel" aria-labelledby="'+i.$id+'_title">'),t.push('<ul class="list-group">')}(n,t,0,o):function(e,t){e.push("</ul></div></div>")}(n),h=null,c=null,o=!1;break;default:c=u,h=p}c&&h&&(l?c(n,t,i,!1):h(n,t))})};t.check=function(e,t){c(e,null,function(e,i,n){n&&l(e,i,t)})},t.toHtml=function(e,t){var i=[];return h(e,t,i),i.join("")}}(e.authtoolboxutils||(e.authtoolboxutils={}))}(Phoenix||(Phoenix={}));!function(e){!function(t){var i=e,n=(i.utils,i.dom),s=i.ipc,o=i.drag,a=(i.ulocale,i.Observable.SchemaUtils),l=i.authtoolboxutils,r=function(e,t){e.find('li[draggable="true"]').on("dragstart",function(e){e.stopPropagation();var i=t.getItemById($(this).attr("data-toolbox"));if(!i||!i.data)return e.preventDefault(),!1;var n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer;n.effectAllowed="move",n.setData("Text","Data");var s={isNew:!0,data:$.extend(!0,{},i.data.data),isLayout:!1,isField:!1,isWidget:!1};switch(i.data.$type){case"layout":s.isLayout=!0;break;case"field":s.isField=!0;break;case"widget":s.isWidget=!0}o.setData(s)}).on("dragend",function(e){return s.emit("ToolBoxDragend",null),o.setData(null),e.preventDefault(),e.stopPropagation(),!1})},d=function(e,t){e.find('li[draggable="true"]').off("dragstart dragend")},u=function(){function e(e,t){this.$element=null,this.map={},this.options=t||{},(e=e||{}).$type=e.$type||"groups",l.check(e,this.map),this.data=e,this._setListeners()}return e.prototype.updateFieldItems=function(e){var t=this.data.$items.find(function(e){return"fields"===e.$typeItems}),i=this.data.$items.find(function(e){return"actions"===e.$typeItems});if(t||(t={$type:"group",$typeItems:"fields",$items:[]},this.data.$items.push(t)),i||(i={$type:"group",$typeItems:"actions",$items:[]},this.data.$items.push(i)),t.$items=[],i.$items=[],e.forEach(function(e){var n={$type:"item",$title:e.$title,data:{$type:"field",data:{$bind:e.$bind,$widget:e.$widget,options:e.options}}};"field"===e.$type?t.$items.push(n):i.$items.push(n)}),this.map={},l.check(this.data,this.map),this.$element){var s=this.$element.get(0);d(this.$element);var o=n.find(s,t.$id);if(o&&n.remove(o),(o=n.find(s,i.$id))&&n.remove(o),t.$items.length){var a=$(l.toHtml(t,this.data)).get(0);n.append(s,a)}if(i.$items.length){var u=$(l.toHtml(i,this.data)).get(0);n.append(s,u)}r(this.$element,this)}},e.prototype.renderToolBox=function(e,t){return $(l.toHtml(e,t))},e.prototype.render=function(e){return this.$element||(this.$element=this.renderToolBox(this.data,null),r(this.$element,this)),e&&(this.options.beforeAdd&&this.options.beforeAdd(this.$element),this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element)),this.$element},e.prototype._clearChildren=function(){},e.prototype._removeEvents=function(){this.$element&&d(this.$element)},e.prototype.destroy=function(){this._clearChildren(),this.$element&&(this._removeEvents(),this.$element=null),s.unlisten(this)},e.prototype.getItemById=function(e){if(!e)return null;return this.map[e]},e.prototype._setListeners=function(){s.listen("onFormData",function(e){if(e.schema){var t=a.schema2Authoring(e.schema,e.schema,e.locale);this.updateFieldItems(t)}},this)},e}();t.ToolBox=u}(e.authtoolbox||(e.authtoolbox={}))}(Phoenix||(Phoenix={}));var Phoenix;!function(e){var t=e,i=t.utils,n=t.ipc,s=t.dom;t.authtoolbar,t.authtoolbox,t.authpropedit;!function(t){var o=function(){function t(t,n){this.options=t,this.id=i.allocID(),this._pe=new e.authpropedit.PropertyEditor(t),this._toolBar=new e.authtoolbar.AuthoringToolBar(t),this._toolBox=new e.authtoolbox.ToolBox(n,t),this._setListeners()}return t.prototype.render=function(e){var t=!1;if(!this.$element){var n=e.get(0).parentNode,o=s.find(n,"toolbox_parent");if(o){t=!0,this.$element=$(n),o.id="toolbox_parent_"+this.id;var a=s.find(n,"editor");a&&(a.id="editor_"+this.id),(a=s.find(n,"nav"))&&(a.id="nav_"+this.id),(a=s.find(n,"toolbox"))&&(a.id="toolbox_"+this.id)}else this.$element=$(function(e,t){var n=['<div class="container-fluid">'];return n.push('<div id="nav_{0}"></div>'),n.push('<div class="row design-table">'),n.push('<div style="width:100%">'),n.push('<div id="content"></div>'),n.push("</div>"),n.push('<div id="toolbox_parent_{0}" style="width:300px">'),n.push('<div id="toolbox_{0}" class="bs-scroll-container"></div>'),n.push("</div>"),n.push("</div>"),n.push('<div id="editor_{0}"></div>'),n.push("</div>"),i.format(n.join(""),e)}(this.id,this.options));var l=this.$element.get(0);this.options.beforeAdd&&this.options.beforeAdd(this.$element);var r=s.find(l,"editor_"+this.id);r&&this._pe.render($(r)),(r=s.find(l,"nav_"+this.id))&&this._toolBar.render($(r)),(r=s.find(l,"toolbox_"+this.id))&&this._toolBox.render($(r)),this.setDesignMode(this.options.design)}return e&&!t&&(this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element)),this.$element},t.prototype._setListeners=function(){var e=this;n.listen("onAuthoringModeChanged",function(t){e.setDesignMode(t)},this)},t.prototype.setDesignMode=function(e){if(this.options.design=e,this.$element){var t=s.find(this.$element.get(0),"toolbox_parent_"+this.id);t&&(this.options.design?s.removeClass(t,"bs-none"):s.addClass(t,"bs-none"))}},t.prototype.destroy=function(){this.$element&&(this.$element=null),this._pe&&(this._pe.destroy(),this._pe=null),this._pe&&(this._pe.destroy(),this._pe=null),n.unlisten(this)},t}();t.AuthoringEditor=o}(e.authoring||(e.authoring={}))}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.design.min.js.map