var Phoenix;!function(e){var t,_,i,u,o,L,n,A,T,S,p,U,D,w,z,I,N,k,P,Y,a;t=e.ui||(e.ui={}),_=e.dom,i=t,u=e.ipc,o=e.link,L=e.drag,n=e.utils,A=e.layoutUtils,T=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},S=function(e){return e.originalEvent?e.originalEvent:e},p=function(e,t){if(!e)return null;var i,n,o,a,s,l;e.map&&(i=!0,n=e.map,e.map=null,o=e.fields,e.fields=null),t&&((a=e.$items)&&(e.$items=[]),s=e.$render,e.$render=null),e.$config&&e.$config.datasets&&(l=e.$config.data?e.$config.data.ds:null)&&delete e.$config.data.ds;var r=$.extend(!0,{},e);return i&&(e.map=n,e.fields=o,delete r.fields,delete r.map),t&&(e.$items=a,e.$render=s),l&&(e.$config.data.ds=l),A.clearMeta(r,!t),t&&delete r.$items,r},U=function(e,t,i,n){for(var o=[],a=e.childNodes,s=0,l=a.length;s<l;s++){var r=a[s],d=_.offset(r),u={position:n?d.left+(d.width>>1):d.top+(d.height>>1),ignore:r===t&&!n||3===r.nodeType||r.hasAttribute("data-remove")||r.hasAttribute("data-ignore"),placeHolder:r===i};o.push(u)}return o},D=function(e,t){var i=0;if(e.length){for(var n=0,o=e.length;n<o;n++){var a=e[n];if(!a.ignore&&t<a.position)return n;i=n+1}return i}return i},w=function(e){var t=e.nextSibling,i=e.previousSibling,n=0;i&&(n=t?t.offsetLeft-5:i.offsetLeft+i.offsetWidth-10),e.style.left=parseInt(n+"",10)+"px"},z=function(e,t,i,n,o,a,s,l){l&&(s.horizontal?_.addClass(n,"drop-target-col"):(n.style.removeProperty&&(n.style.removeProperty("height"),n.style.removeProperty("left")),_.removeClass(n,"drop-target-col")));var r=function(e){n.parentNode&&P(n),o.$type&&!e&&("column"===o.$type&&1===a?_.addClass(n,"col"):_.removeClass(n,"col"))},d=!0;if(t.length||(r(!1),_.append(e,n),d=!1),d){for(var u=-1,p=0,c=t.length;p<c;p++){var f=t[p];if(f.placeHolder){if((u=p)===i||p===i-1)return!1}else if(f.ignore){if(p===i&&p+1<c&&t[p+1].placeHolder)return!1;if(p===i-1&&0<p&&t[p-1].placeHolder)return!1}}if(u<0||i>=t.length)r(0<=u),_.append(e,n);else{var $=e.childNodes[i];r(0<=u),_.before($,n)}}return s.horizontal&&w(n),!0},I=function(e,t,i){if(i){for(var n=0,o=e.childNodes.length;n<o;n++)t?_.addClass(e.childNodes[n],"bs-none-drag"):_.removeClass(e.childNodes[n],"bs-none-drag");t?(_.addClass(e,"drag-source"),2===i&&_.removeClass(e,"auto")):(_.removeClass(e,"drag-source"),2===i&&_.addClass(e,"auto"))}},N=function(e,t,i,n,o){return e&&P(e),(e=document.createElement("div")).className="container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"+(i?" bs-island bs-field":"")+(n?" bs-island bs-widget":"")+(o?" drop-target-col":""),e},k=function(e,t,i){i&&(e.off("click"),e.find('*[draggable="true"]').off("dragstart").add(e).off("dragend"),e.find('*[draggable="true"]').off("dragstart"),e.find(".drop-layouts-zone, .drop-fields-zone").add(e).off("dragover dragenter drop"))},P=function(e){_.remove(e)},Y=function($,h,m){if(m){var f,r,y,g,b,v,O=function(){v=!1,f&&(_.removeClass(f,"bs-none"),f.isColumn&&I(f.firstChild,!1,f.isColumn),f.isColumn=!1,f=null),g&&(P(g),g=null),r&&(_.remove(r),r=null),b=null,y=!1,L.setData(null)},C=function(e){var t,i,n=$.get(0);if(e){if(e.data===e.dst)return;var o,a,s,l,r=e.dst,d=e.data,u=_.find(n,d.$id),p=_.find(n,r.$idDesign),c=!1;if(d.$parentId===r.$id){if(a=(s=e.dst).$items.indexOf(d),c=!0,(o=e.indexInParent)===a)return}else a=(s=e.isNew?null:h.getLayoutById(d.$parentId))?s.$items.indexOf(d):-1,o=e.indexInParent;if(0<=a&&(t=s,i=a,e.isLayout?(t.$items.splice(i,1),t.$type===A.LAYOUT_ROW?t.$items.length?delete t.$items[0].$colSize:(t.$type=A.LAYOUT_BLOCK,t.$origin=A.LAYOUT_ROW,T(t)):t.$type===A.LAYOUT_ACCORDION&&(t.$items.length||(t.$type=A.LAYOUT_BLOCK,delete t.$origin,T(t)))):t.$items.splice(i,1)),function(e,t,i,n,o,a){if(!a)return i.$parentId=t.$id,t.$items.splice(n,0,i);if(t.$origin===A.LAYOUT_ROW&&t.$type!==A.LAYOUT_ROW&&(delete t.$origin,t.$type=A.LAYOUT_ROW,T(t)),i.$parentId=t.$id,t.$type===A.LAYOUT_ROW)switch(i.$type===A.LAYOUT_BLOCK&&i.$origin===A.LAYOUT_ROW&&(i.$type=A.LAYOUT_ROW,delete i.$origin),i.$type){case A.LAYOUT_BLOCK:case A.LAYOUT_ACCORDION_GROUP:delete i.$origin,delete i.$type,T(i);break;case A.LAYOUT_COLUMN:o||(delete i.$colSize,delete i.$customColSize);break;default:(s={$items:[],$auto:!0}).$items.push(i),i=s}else if(t.$type===A.LAYOUT_ACCORDION)switch(i.$type){case A.LAYOUT_ACCORDION_GROUP:break;case A.LAYOUT_BLOCK:i.$type=A.LAYOUT_ACCORDION_GROUP,T(i);break;case A.LAYOUT_COLUMN:delete i.$colSize,delete i.$customColSize,i.$type=A.LAYOUT_ACCORDION_GROUP,T(i);break;default:var s;(s={$type:A.LAYOUT_ACCORDION_GROUP,$items:[],$auto:!0}).$items.push(i),i=s}else switch(i.$type){case A.LAYOUT_COLUMN:case A.LAYOUT_ACCORDION_GROUP:delete i.$colSize,delete i.$customColSize,i.$type=A.LAYOUT_BLOCK,T(i),i.$auto&&(i=i.$items[0])}t.$items.splice(n,0,i)}(0,r,d,o,c,e.isLayout),e.isNew||e.isLayout)h.check(null);else{if(0<=a&&_.detach(u),o===r.$items.length-1?_.append(p,u):(l=_.find(n,r.$items[o+1].$id),_.before(l,u)),!r.$items[o].$bind){var f=[s];return r!==s&&f.push(r),k($,0,m),Y($,h,m),void f.forEach(function(e){h._afterPropsChanged(e)})}h.check(null)}h.render()}};$.on("click",function(e){var t=function(e,t,i){for(var n,o,a=e.target,s=null;a;){if(s=a.getAttribute("data-layout")){if(n=parseInt(a.getAttribute("data-level")||"1",10),(o=i.getLayoutById(s))&&A.canSelect(o,n)||(s=null),s)break}else if(s=a.getAttribute("data-render"))break;a=a===t?null:a.parentNode}return s}(e,$.get(0),h);!function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-remove"))return!0;i=i===t?null:i.parentNode}return!1}(e,$.get(0))?!function(e,t){for(var i=e.target;i;){if(i.hasAttribute("data-layout-detail"))return!0;i=i===t?null:i.parentNode}return!1}(e,$.get(0))?h.select(t):h.authoringChild(t):h.removeChild(t)}),$.find('*[draggable="true"]').on("dragstart",function(e){e.stopPropagation();var t=!1,i=!0,n=!1,o=h.getLayoutById(this.getAttribute("data-layout"));if(o||(t=!(n=null!=(o=h.getFieldById(this.getAttribute("data-render"))).$config),i=!1),!o)return e.preventDefault(),!1;o.selected&&h.select(null);var a=S(e).dataTransfer;a.effectAllowed="move",a.setData("Text","data"),i&&a.setDragImage&&((s=document.createElement("div")).className="bs-drag-image",document.body.appendChild(s),r=s,a.setDragImage(r,0,0));var s,l=h.getLayoutById(o.$parentId);l&&l.$auto&&(o=l),L.setData({data:o,isLayout:i,isField:t,isWidget:n,isNew:!1}),f=_.find($.get(0),o.$idDrag),y=!0}).add($).on("dragend",function(e){return e.preventDefault(),e.stopPropagation(),O(),!1}),$.find(".drop-layouts-zone, .drop-fields-zone").add($).on("dragover dragenter drop",function(e){var t=this,i=L.getData(),n=S(e),o=n.dataTransfer;if(e.stopPropagation(),v)return!0;if(!i||!i.isLayout&&!_.hasClass(t,"drop-fields-zone")||i.isLayout&&!_.hasClass(t,"drop-layouts-zone"))return o.effectAllowed="none",!0;if("drop"===e.type){e.preventDefault();var a=h.getLayoutById(t.getAttribute("data-layout")),s=t.getAttribute("data-level");return a?((i=L.getData()).dst=a,i.dstLevel=s,i.indexInParent=function(e,t,i,n){for(var o=0,a=0,s=e.childNodes.length;a<s;a++){var l=e.childNodes[a];if(3!==l.nodeType){if(l===t)return o;l!==i&&(n&&!l.hasAttribute("data-layout")||(n||l.hasAttribute("data-render"))&&o++)}}return 0}(t,g,f,i.isLayout),L.setData(i),O(),C(i)):O(),!1}if(o.getData("Text"),y){if(!f)return;if(y=!1,!i.isNew)return v=!0,g=function(e,t,i,n,o,a,s){if(i){var l=s.$type===A.LAYOUT_COLUMN;t&&P(t),t=N(null,i,n,o,l),_.addClass(t,"drop-target"),l?(e.isColumn=1,s.$auto&&(e.isColumn=2),I(e.firstChild,!0,e.isColumn),_.before(e,t),w(t)):(_.addClass(e,"bs-none"),_.before(e,t))}else t=N(t,!1,n,o,!1),_.before(e,t),_.addClass(e,"bs-none");return t}(f,g,i.isLayout,i.isField,i.isWidget,0,i.data),setTimeout(function(){v=!1},0),e.preventDefault(),!1}var l=h.getLayoutById(t.getAttribute("data-layout")),r=t.getAttribute("data-level");if(!g){if(!i.isNew)return!0;var d=h._canDropChild(i.data,l,r);if(!d)return o.effectAllowed="none",!0;b=U(t,f,g,d.horizontal);var u=D(b,d.horizontal?n.pageX:n.pageY);return g=N(g,i.isLayout,i.isField,i.isWidget,d.horizontal),z(t,b,u,g,l,r,d,i.isLayout),b=null,e.preventDefault(),!1}if("dragenter"===e.type&&(b=null),f===t)return o.effectAllowed="none",!0;var p=h._canDropChild(i.data,l,r);if(!p)return o.effectAllowed="none",!0;b||(b=U(t,f,g,p.horizontal));var c=D(b,p.horizontal?n.pageX:n.pageY);return z(t,b,c,g,l,r,p,i.isLayout)&&(b=null),e.preventDefault(),!1})}},a={_setDesignListeners:function(e){u.listen("onToolBoxDragend",function(){this.$element&&this.$element.trigger("dragend")},this),u.listen("onUpdateSelected",function(e){"layout"===e.type?this.updateLayout(e.id,e.data):this.updateField(e.id,e.data)},this),u.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this),u.listen("onSaveLayout",function(){if(this.saveHandler){var e=p(this.data,!1);this.saveHandler(e)}},this),u.listen("onNewLayout",function(e){if(this.createHandler){var t=p(this.data,!1);this.createHandler(e.name,t)}},this),u.listen("onLoadNestedLayouts",function(e){this.loadNestedHandler&&this.loadNestedHandler(e.data,e.after)},this),u.listen("onOpenLayout",function(e){this.openHandler&&this.openHandler(e.name)},this),u.listen("onRemoveLayout",function(){this.removeHandler&&this.removeHandler()},this),u.listen("onListLayout",function(e){this.listHandler&&this.listHandler(e)},this)},_afterCreate:function(){var e=this;e.options.form&&e.options.design&&n.nextTick(function(){u.emit("FormData",{schema:e.$schema,locale:e.$locale})})},authoringChild:function(e){var t=this.getLayoutById(e);if(t&&t.$ref)if(this.options.form){var i={name:t.$ref};t.$refProperty&&(i.path=t.$refProperty);var n=o.context();i.schema=n.$url.prototype?n.$url.prototype:this.data.name,i.locale=n.$url.locale?n.$url.locale:this.data.name,o.doFormAuthoring(i)}else o.doAuthoring(t.$ref,!0)},_removeEvents:function(){k(this.$element,0,!0),this._removeBaseEvents()},_addEvents:function(){Y(this.$element,this,this.options.design),this._addBaseEvents()},_onSelectedChanged:function(e,t,i){!function(e,t,i,n){if(t){var o=_.find(e,t.$idSelect||t.$idDrag);if(e!==o&&o)if(t.selected){if(!o.querySelector('div[data-remove="true"]')){var a=$('<div class="bs-rt-button" data-remove="true"><span class="'+_.iconClass("times-circle")+'"></span></div>').get(0),s=o.childNodes;s.length?_.before(s[0],a):_.append(o,a)}}else{var l=o.querySelector('div[data-remove="true"]');l&&_.remove(l)}}if(i){var r=p(t,!0);if(r&&delete r.$id,t&&t.$type){r.$type=t.$type,t.$items&&t.$items.length&&!t.$items[0].$bind||(r.onlyFields=!0);var d=n.getLayoutById(t.$parentId);d&&(r.parent=p(d,!0),r.parent.$type=d.$type)}u.emit("SelectedChanged",{type:t?t.$type?"layout":t.$config?"widget":"field":null,id:t?t.$id:null,data:r,control:n})}}(e,t,i,this)},_showSelected:function(e,t){!function(e,t){if(e){var i=_.find(e.get(0),t.$idSelect||t.$idDrag);t.selected?_.addClass(i,"selected"):_.removeClass(i,"selected")}}(e,t)},_canDropChild:function(e,t,i){if(t&&t.$type&&t.$ref)return null;if(e.$type)return i=parseInt(i||"1",10),t&&e?t===e?null:this.isChildOf(e,t)?null:"row"===t.$type?{horizontal:!0}:{horizontal:!1}:null;if(e.$bind||e.$config){var n=t.$items.length;if(!n)return{horizontal:!1};for(var o=e.$bind?"$bind":"$config";n--;)if(!t.$items[n][o])return null;return{horizontal:!1}}return null},toString:function(e){var t=p(e||this.data,!1);return JSON.stringify(t)}},$.extend(i.Layout.prototype,a),$.extend(i.Form.prototype,a)}(Phoenix||(Phoenix={})),function(e){var t,i,n,o,a,s,f,l,r;t=e.authpropedit||(e.authpropedit={}),n=(i=e).utils,o=i.ipc,a=i.locale,s=i.ui,f=i.layoutUtils,l=i.dom,r=function(){function e(e){this.$element=null,this.form=null,this.$id=n.allocID(),this.options=e||{},this.selected=null,this._setListeners()}return e.prototype._sendLayout=function(t){var i=this;i.selected&&i.selected.id&&n.nextTick(function(){var e=i._model2layout(t);e&&o.emit("UpdateSelected",{type:"layout",id:i.selected.id,data:e})})},e.prototype._updateFields=function(e){var t=this;t.selected&&t.selected.id&&(t.selected.data&&t.selected.data.$config?t.selected.data.$config=JSON.parse(e.options):t.selected.data=JSON.parse(e.options),n.nextTick(function(){o.emit("UpdateSelected",t.selected)}))},e.prototype._hasData=function(){return this.selected&&this.selected.type},e.prototype._setListeners=function(){o.listen("onSelectedChanged",function(e){var t=this;t.selected=e;var i=t.$element.get(0);if(t._hasData()){l.removeClass(i,"bs-none");var n="layout"===t.selected.type;if(t.$element){var o=e.data;o&&o.$config&&(o=o.$config),t._setJson(o,n)}}else l.addClass(i,"bs-none")},this),o.listen("onAuthoringModeChanged",function(e){this.setDesignMode(e)},this)},e.prototype._model2layout=function(e){var t=!1,i=this.selected.data,n={},o=e.childrenFlow;o===f.LAYOUT_BLOCK&&("column"===i.$type?o="column":i.$type===f.LAYOUT_ACCORDION_GROUP&&(o=f.LAYOUT_ACCORDION_GROUP));var a=o===f.LAYOUT_ACCORDION,s=o===f.LAYOUT_ACCORDION_GROUP;o!==(l=i.$origin||i.$type)&&(n.$type=o,t=!0);var l=i.$ref||i.$type;n.$ref=e.subLayoutName,t||(i.$ref||"")===(e.subLayoutName||"")||(t=!0),n.$refProperty=e.subPathSchema,t||(i.$refProperty||"")===(e.subPathSchema||"")||(t=!0),n.$forceTable=e.forceTable,t||(i.$forceTable||!1)===(e.forceTable||!1)||(t=!0),n.$name=e.name,t||(i.$name||"")===(e.name||"")||(t=!0),o!==f.LAYOUT_BLOCK&&o!==f.LAYOUT_COLUMN||(n.$sticky=e.sticky,t||(i.$sticky||"")===(e.sticky||"")||(t=!0)),n.$refController=e.subController,t||(i.$refController||"")===(e.subController||"")||(t=!0),n.$style=e.style,t||(i.$style||"")===(e.style||"")||(t=!0);var r=o===f.LAYOUT_ACCORDION&&"none"===e.format?e.bindPages:void 0;if(n.$bindPages=r,i.$bindPages!==r&&(t=!0),e.$states.colSize.isHidden||("column"===o?(e.colSize!==i.$colSize&&(n.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.$customColSize||"")&&(n.$customColSize=e.customColSize,t=!0)):i.parent&&i.parent.$auto&&(e.colSize!==i.parent.$colSize&&(n.parent=n.parent||{},n.parent.$colSize=e.colSize,t=!0),(e.customColSize||"")!==(i.parent.$customColSize||"")&&(n.parent=n.parent||{},n.parent.$customColSize=e.customColSize,t=!0))),e.$states.showTitle.isHidden?i.$title&&(t=!0):e.showTitle?i.$title?(!i.$title.value!==e.title&&(t=!0,n.$title=n.$title||{},n.$title.value=e.title),s||(!i.$title.size!==e.titleSize&&(t=!0,n.$title=n.$title||{},n.$title.size=e.titleSize),!i.$title.$style!==e.titleStyle&&(t=!0,n.$title=n.$title||{},n.$title.$style=e.titleStyle))):(t=!0,n.$title={},n.$title.value=e.title,s||(n.$title.size=e.titleSize,n.$title.$style=e.titleStyle)):i.$title&&(t=!0),a){var d=i.$widget,u=e.format===f.LAYOUT_ACCORDION?void 0:e.format;d!==u&&(t=!0),n.$widget=u}if(!e.$states.formType.isHidden){var p=e.formType;d=i.$inline?"inline":i.$fieldsOptions&&i.$fieldsOptions.columns?"horizontal":"block";if(n.$fieldsOptions={},p!==l)switch(t=!0,p){case f.LAYOUT_BLOCK:n.$inline=!1,n.$fieldsOptions.columns=!1;break;case"horizontal":n.$inline=!1,n.$fieldsOptions.columns=!0,n.$fieldsOptions.labelCol=e.labelCol;break;case"inline":n.$inline=!0,n.$fieldsOptions.columns=!1}else"horizontal"===p&&n.$fieldsOptions.labelCol!==e.labelCol&&(n.$fieldsOptions.labelCol=e.labelCol,t=!0);n.$fieldsOptions.labelCol&&3==n.$fieldsOptions.labelCol&&delete n.$fieldsOptions.labelCol,!(!i.$fieldsOptions||!i.$fieldsOptions.titleIsHidden)!==e.titleIsHidden&&(n.$fieldsOptions.titleIsHidden=e.titleIsHidden,t=!0)}return t?n:null},e.prototype._schemaFields=function(){return{links:{apply:{title:a.layouts.design.actionApply}},properties:{options:{type:"string",format:"json"}}}},e.prototype._field2FormData=function(e){return{options:JSON.stringify(e,null,2)}},e.prototype._layoutFields=function(){return{name:n.allocID(),$type:f.LAYOUT_BLOCK,$items:[{$type:f.LAYOUT_BLOCK,$title:{value:a.layouts.design.properties},$items:[{$bind:"options",options:{rows:5}}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._schemaLayout=function(){return{links:{apply:{title:a.layouts.design.actionApply}},properties:{typeLayout:{type:"string"},forceTable:{title:a.layouts.design.forceDisplayTable,type:"boolean"},name:{title:a.layouts.design.name,type:"string"},showTitle:{title:a.layouts.design.showTitle,type:"boolean"},title:{type:"string",title:a.layouts.design.Title},bindPages:{type:"string",title:a.layouts.design.bindPagesTitle},titleSize:{type:"number",title:"Size",enum:[1,2,3,4,5,6],enumNames:["H1","H2","H3","H4","H5","H6"]},titleStyle:{type:"string",title:"Style"},childrenFlow:{type:"string",title:a.layouts.design.childrenFlow,enum:[f.LAYOUT_BLOCK,f.LAYOUT_ROW,f.LAYOUT_ACCORDION],enumNames:[a.layouts.design.childrenFlowVertical,a.layouts.design.childrenTableCell,a.layouts.design.childrenAccordionGroup],filters:{blockrow:[f.LAYOUT_BLOCK,f.LAYOUT_ROW],onlyblock:[f.LAYOUT_BLOCK],accordion:[f.LAYOUT_ACCORDION]}},format:{type:"string",title:a.layouts.design.appearance,enum:[f.LAYOUT_ACCORDION,"tabs","none"],enumNames:[a.layouts.design.appearanceAccordion,a.layouts.design.appearanceTabs,a.layouts.design.appearanceWizard]},subLayoutName:{type:"string",title:a.layouts.design.nestedLayoutName},subPathSchema:{type:"string",title:a.layouts.design.nestedLayoutBind},subController:{type:"string",title:a.layouts.design.nestedFormController},style:{type:"string",title:a.layouts.design.customStyle},colSize:{type:"number",title:a.layouts.design.columnSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["08.33%","16.67%","25.00%","33.33%","41.37%","50.00%","58.33%","66.67%","75.00%","83.33%","91.33%","100.00%"]},customSize:{type:"string",title:a.layouts.design.customColumnSize},formType:{title:a.layouts.design.formType,enum:[f.LAYOUT_BLOCK,"horizontal","inline"],enumNames:[a.layouts.design.ftVertical,a.layouts.design.ftHorizontal,a.layouts.design.ftInline],type:"string"},labelCol:{title:a.layouts.design.labelSize,enum:[1,2,3,4,5,6,7,8,9,10,11,12],type:"number"},sticky:{title:a.layouts.design.blockPosition,type:"string",enum:["","top","bottom"],enumNames:[a.layouts.design.bpStatic,a.layouts.design.bpStickyTop,a.layouts.design.bpStickyBottom]},titleIsHidden:{title:a.layouts.design.noTitlesForFields,type:"boolean"}}}},e.prototype._layout2FormData=function(e){var t=e.$origin||e.$type,i=f.LAYOUT_BLOCK,n="onlyblock",o=t===f.LAYOUT_ACCORDION_GROUP,a=t===f.LAYOUT_ACCORDION,s=a&&e.$widget||f.LAYOUT_ACCORDION,l=this.options.form&&(t===f.LAYOUT_BLOCK||"column"===t)||o,r=o||t===f.LAYOUT_BLOCK||"column"===t,d=l&&!!e.$title||o;o&&e.$title&&e.$title.size&&(e.$title.size=4),0<=["column",f.LAYOUT_BLOCK,"row"].indexOf(t)?("row"===t&&(i="row"),e.parent&&(n="blockrow")):t===f.LAYOUT_ACCORDION&&(n=f.LAYOUT_ACCORDION,i=f.LAYOUT_ACCORDION);var u=!1;("column"===t||e.parent&&e.parent.$auto&&"column"===e.parent.$type)&&(u=!0,"column"===t||e.parent);var p=this.options.form&&e.onlyFields&&!e.$ref,c=e.$inline?"inline":e.$fieldsOptions&&e.$fieldsOptions.columns?"horizontal":f.LAYOUT_BLOCK;return{typeLayout:t,showTitle:d,name:e.$name,title:e.$title&&e.$title.value?e.$title.value:"",titleSize:e.$title&&e.$title.size?e.$title.size:4,titleStyle:e.$title&&e.$title.$style?e.$title.$style:"",childrenFlow:i,bindPages:e.$bindPages,colSize:e.$colSize||0,customSize:e.$customColSize,formType:c,format:s,subLayoutName:e.$ref,subPathSchema:e.$refProperty,forceTable:e.$forceTable,subController:e.$refController,style:e.$style,labelCol:e.$fieldsOptions&&e.$fieldsOptions.labelCol?e.$fieldsOptions.labelCol:3,titleIsHidden:!(!e.$fieldsOptions||!e.$fieldsOptions.titleIsHidden),sticky:(t===f.LAYOUT_BLOCK||f.LAYOUT_COLUMN)&&e.$sticky||"",$states:{showTitle:{isHidden:!l,isDisabled:o},title:{isHidden:!l||!d},bindPages:{isHidden:!(t===f.LAYOUT_ACCORDION&&"none"===e.$widget)},titleSize:{isHidden:!l||!d||o},titleStyle:{isHidden:!l||!d||o},colSize:{isHidden:!u},customSize:{isHidden:!u},childrenFlow:{filter:n},format:{isHidden:!a},formType:{isHidden:!p},labelCol:{isHidden:!p||"horizontal"!==c},titleIsHidden:{isHidden:!p},subLayoutName:{isHidden:!r},forceTable:{isHidden:t!==f.LAYOUT_ROW},subPathSchema:{isHidden:!r||!this.options.form},subController:{isHidden:!r||!this.options.form},sticky:{isHidden:t!==f.LAYOUT_BLOCK&&t!==f.LAYOUT_COLUMN}},$links:{apply:{isDisabled:!0}}}},e.prototype._emptyContent=function(){this.form&&(s.removeForm(this.form),this.form=null),l.empty(this.$element.get(0))},e.prototype._layoutEdit=function(){return{name:n.allocID(),$type:f.LAYOUT_BLOCK,$items:[{$title:{value:"Title"},$bindState:"showTitle",$type:f.LAYOUT_BLOCK,$items:[{$bind:"showTitle"},{$bind:"title"},{$bind:"titleSize"},{$bind:"titleStyle"}]},{$type:f.LAYOUT_BLOCK,$title:{value:a.layouts.design.properties},$items:[{$bind:"name"},{$bind:"childrenFlow"},{$bind:"forceTable"},{$bind:"format"},{$bind:"sticky"},{$bind:"bindPages"},{$bind:"subLayoutName"},{$bind:"subPathSchema"},{$bind:"subController"},{$bind:"style"},{$bind:"colSize"},{$bind:"customSize"}]},{$type:f.LAYOUT_BLOCK,$bindState:"formType",$title:{value:a.layouts.design.fieldsTitle},$items:[{$bind:"formType"},{$bind:"labelCol"},{$bind:"titleIsHidden"}]},{$type:"row",$items:[{$bind:"title",$inline:!0,$items:[{$bind:"$links.apply",options:{type:"primary",right:!0}}]}]}]}},e.prototype._setJson=function(e,t){var a=this;a._emptyContent(),t?s.OpenForm(a.$element,a._layoutEdit(),a._schemaLayout(),a._layout2FormData(e),{},function(e,t,i){var n=!1;if("propchange"===e.operation){var o=t.typeLayout===f.LAYOUT_ACCORDION_GROUP;switch(e.property){case"showTitle":o||(t.$states.title.isHidden=!t.showTitle,t.$states.titleSize.isHidden=!t.showTitle,t.$states.titleStyle.isHidden=!t.showTitle,n=!0);break;case"formType":t.$states.labelCol.isHidden=t.$states.showTitle.isHidden||"horizontal"!==t.formType,n=!0;break;case"childrenFlow":case"colSize":case"subLayoutName":if(!t.validate())return;a._sendLayout(t);break;case"subPathSchema":if(!t.validate())return;t.subLayoutName?a._sendLayout(t):n=!0;break;case"forceTable":if(!t.validate())return;a._sendLayout(t);break;case"format":t.$states.bindPages.isHidden=!(t.typeLayout===f.LAYOUT_ACCORDION&&"none"===t.format);default:n=!0}n&&(t.$links.apply.isDisabled=!1)}if("execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;a._sendLayout(t)}},null,{},function(e){a.form=e}):s.OpenForm(a.$element,a._layoutFields(),a._schemaFields(),a._field2FormData(e),{},function(e,t,i){if("propchange"===e.operation&&(e.property,!0&&(t.$links.apply.isDisabled=!1)),"execute"===e.operation&&"$links.apply"===e.property){if(!t.validate())return;a._updateFields(t)}},null,{},function(e){a.form=e})},e.prototype.setDesignMode=function(e){this.options.design=e,this.$element&&(this.options.design&&this.selected?l.removeClass(this.$element.get(0),"bs-none"):l.addClass(this.$element.get(0),"bs-none"))},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=$('<div id= "'+t.$id+'"></div>'),t.options.beforeAdd&&t.options.beforeAdd(t.$element)),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},e.prototype.destroy=function(){var e=this;e.form&&(e.form.destroy(),e.form=null),e.$element&&(e.$element=null),o.unlisten(e)},e}(),t.PropertyEditor=r}(Phoenix||(Phoenix={})),function(o){var e,t,s=o,a=s.utils,l=s.ipc,r=s.build,d=(s.drag,s.dom),u=s.ui,p=s.locale,c=s.pagecontrol;s.ulocale;e=o.authtoolbar||(o.authtoolbar={}),t=function(){function e(e){this.$element=null,this.$id=a.allocID(),this.options=e||{}}return e.prototype._removeEvents=function(){this.$element.off("click")},e.prototype._setEvents=function(){var n=this;n.$element.get(0);n.$element.on("click",function(e){var t=!1;switch(e.target.id){case n.$id+"_save":l.emit("SaveLayout",null),t=!0;break;case n.$id+"_open":n._openExisting(),t=!0;break;case n.$id+"_remove":t=!0,a.confirm("",r.release?p.layouts.design.ConfirmDeletePrefs:p.layouts.design.ConfirmDelete,function(){l.emit("RemoveLayout",null)});break;case n.$id+"_preview":var i=d.query(n.$element.get(0),"#"+n.$id+"_preview");l.emit("AuthoringModeChanged",!i.checked);break;case n.$id+"_new":t=!0,a.prompt(p.layouts.design.PageName,"",function(e){(e=e.trim())&&(0<=e.indexOf(" ")?alert(p.layouts.design.InvalidPageName):l.emit("NewLayout",{name:e}))});break;default:t=!1}return!t||(e.stopPropagation(),e.preventDefault(),!1)})},e.prototype._clearChildren=function(){},e.prototype._openExisting=function(){var o=this;l.emit("ListLayout",function(e){if(e&&e.files){for(var t=[],i=0;i<e.files.length;i++){var n=e.files[i];n!=c.Page().currentPage()&&t.push(n)}t.length&&o._openModal(t,function(e){l.emit("OpenLayout",{name:e})})}})},e.prototype._openModal=function(e,a){e.sort();var t={type:"object",properties:{page:{title:"Name",type:"string",enum:e}}},i={page:e[0]},n={title:p.layouts.design.Open.title,buttons:[{type:"default",title:p.layouts.design.Open.close,name:"cancel"},{type:"primary",title:p.layouts.design.Open.open,name:"ok"}]};u.OpenModalForm(n,{name:"open",$type:"block",$items:[{$bind:"page"}]},t,i,o.locale,function(e,t,i,n){if("modal-action"===t.operation)switch(t.property){case"ok":var o=i.page;e.close(),a&&a(o);break;case"cancel":e.close()}})},e.prototype.render=function(e){var t,i,n,o,a=this;return a.$element||(a.$element=$((t=a.$id,i=a.options,n=s.bootstrap4,o=[],n?(o.push('<div class="bs-island" id="'+t+'">'),o.push('<form class="form-inline">')):(o.push('<nav class="navbar navbar-default" id="'+t+'">'),o.push('<div class="container-fluid">'),o.push('<div class="navbar-header">'),o.push('<a class="navbar-brand" href="#">'),o.push(p.layouts.design.AuthoringMode),o.push("</a>"),o.push("</div>"),o.push('<div class="collapse navbar-collapse">'),o.push('<form class="navbar-form navbar-left" role="search">')),o.push('<button type="button" class="mr-2 bs-button btn btn-'+d.bootstrapStyles(!0).secondary+(r.release||i.form?" bs-none":"")+'" id="'+t+'_new">'),o.push('<span class="'+d.iconClass("plus")+'" aria-hidden="false"></span> '),o.push(p.layouts.design.New),o.push("</button>&nbsp;"),o.push('<button type="button" class="mr-2 bs-button  btn btn-'+d.bootstrapStyles(!0).secondary+(r.release||i.form?" bs-none":"")+'" id="'+t+'_open">'),o.push('<span class="'+d.iconClass("file-o")+'" aria-hidden="false"></span> '),o.push(p.layouts.design.Open.title),o.push("</button>&nbsp;"),o.push('<button type="button" class="mr-2 bs-button btn btn-'+d.bootstrapStyles(!0).secondary+(i.form?" bs-none":"")+'" id="'+t+'_remove">'),o.push('<span class="'+d.iconClass("times")+'" aria-hidden="false"></span> '),r.release?o.push(p.layouts.design.DeletePreferences):o.push(p.layouts.design.Delete),o.push("</button>&nbsp;"),o.push('<button type="button" class="mr-2 bs-button btn btn-'+d.bootstrapStyles(!0).secondary+'" id="'+t+'_save">'),o.push('<span class="'+d.iconClass("floppy")+'" aria-hidden="false"></span> '),o.push(p.layouts.design.Save),o.push("</button>&nbsp;"),n?(o.push('<label class="form-check-inline">'),o.push('<input class="form-check-input" type="checkbox" id="'+t+'_preview"'+(i.design?"":' checked="true"')+">&nbsp;&nbsp;"),o.push(p.layouts.design.Preview),o.push("</label>")):(o.push('<div class="checkbox">'),o.push("<label>"),o.push('<input type="checkbox" id="'+t+'_preview"'+(i.design?"":' checked="true"')+"> "),o.push(p.layouts.design.Preview),o.push("</label>"),o.push("</div>")),o.push("</form>"),n||o.push("</div>"),n?o.push("<div>"):o.push("</nav>"),o.join(""))),a._setEvents(),a.options.beforeAdd&&a.options.beforeAdd(a.$element)),e&&(a.options.replaceParent?e.replaceWith(a.$element):e.append(a.$element)),a.$element},e.prototype.destroy=function(){var e=this;e._clearChildren(),e.$element&&(e._removeEvents(),e.$element=null),l.unlisten(e)},e}(),e.AuthoringToolBar=t}(Phoenix||(Phoenix={})),function(l){var e,t,r,d,s,u,p,c,f,$,n,o;e=l.authtoolboxutils||(l.authtoolboxutils={}),r=(t=l).utils,d=t.dom,s=t.build,u=t.locale,p=function(e,t,i,n){e.push('<div class="panel-group" id="accordion_expo" role="tablist" aria-multiselectable="true">')},c=function(e,t){e.push("</div>")},f=function(e,t,i,n){var o=["list-group-item bs-cursor-p"];if(t.data&&"widget"===t.data.$type&&"dev"!==s.authMode){var a=!0;"admin"===s.authMode?a=["admin","user"].indexOf(t.mode)<0:"user"===s.authMode&&(a="user"!==t.mode),a&&o.push("bs-none")}e.push('<li draggable="true" class="'+o.join(" ")+'" data-toolbox="'+t.$id+'" id="'+t.$id+'">'),e.push('<span class="'+d.iconClass("file-o")+'"></span>&nbsp;'),e.push(t.$title),e.push("</li>")},$=function(e,t){},n=function(t,e,i){t&&(i(t,e,!0),t.$items&&t.$items.forEach(function(e){n(e,t,i)}),i(t,e,!1))},o=function(e,t,a){var s=!0;n(e,t,function(e,t,i){var n=f,o=$;switch(e.$type){case"groups":n=p,o=c;break;case"group":i?function(e,t,i,n){var o,a=l.bootstrap4;switch(t.$typeItems=t.$typeItems||"layouts",t.$typeItems){case"layouts":o=t.$title||u.layouts.design.layouts;break;case"widgets":o=t.$title||u.layouts.design.widgets;break;case"actions":o=t.$title||u.layouts.design.actions;break;default:o=t.$title||u.layouts.design.fields}e.push('<div class="'+(a?"card":"panel panel-default")+'" id="'+t.$id+'">'),e.push('<div class="'+(a?"card-header":"panel-heading")+'"  role="tab" id="'+t.$id+'_tab">'),a||e.push('<h3 class="panel-title">'),e.push('<a data-toggle="collapse" aria-expanded="'+(n?"true":"false")+'" draggable="false" data-parent="#accordion_expo" aria-controls="'+t.$id+'_tab" href="#'+t.$id+'_content"><span class="'+d.iconClass("bars")+'">'),e.push("</span>&nbsp;"),e.push(o),e.push("</a>"),a||e.push("</h3>"),e.push("</div>"),e.push('<div id="'+t.$id+'_content" class="panel-collapse collapse'+(n?a?" show":" in":"")+'" role="tabpanel" aria-labelledby="'+t.$id+'_title">'),e.push('<ul class="list-group">')}(a,e,0,s):a.push("</ul></div></div>"),n=o=null,s=!1;break;default:n=f,o=$}n&&o&&(i?n(a,e,t,!1):o(a,e))})},e.check=function(e,s){n(e,null,function(e,t,i){var n,o,a;i&&(o=t,a=s,(n=e).$id=n.$id||r.allocID(),o&&(n.$parentId=o.$id),n.$items&&(n.$contentId=n.$contentId||r.allocUuid()),a&&(a[n.$id]=n))})},e.toHtml=function(e,t){var i=[];return o(e,t,i),i.join("")}}(Phoenix||(Phoenix={})),function(e){var t,i,r,n,a,o,d,u,p,s;t=e.authtoolbox||(e.authtoolbox={}),(i=e).utils,r=i.dom,n=i.ipc,a=i.drag,i.ulocale,o=i.Observable.SchemaUtils,d=i.authtoolboxutils,u=function(e,o){e.find('li[draggable="true"]').on("dragstart",function(e){e.stopPropagation();var t=o.getItemById($(this).attr("data-toolbox"));if(!t||!t.data)return e.preventDefault(),!1;var i=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer;i.effectAllowed="move",i.setData("Text","Data");var n={isNew:!0,data:$.extend(!0,{},t.data.data),isLayout:!1,isField:!1,isWidget:!1};switch(t.data.$type){case"layout":n.isLayout=!0;break;case"field":n.isField=!0;break;case"widget":n.isWidget=!0}a.setData(n)}).on("dragend",function(e){return n.emit("ToolBoxDragend",null),a.setData(null),e.preventDefault(),e.stopPropagation(),!1})},p=function(e,t){e.find('li[draggable="true"]').off("dragstart dragend")},s=function(){function e(e,t){var i=this;i.$element=null,i.map={},i.options=t||{},(e=e||{}).$type=e.$type||"groups",d.check(e,i.map),i.data=e,i._setListeners()}return e.prototype.updateFieldItems=function(e){var t=this,i=t.data.$items.find(function(e){return"fields"===e.$typeItems}),n=t.data.$items.find(function(e){return"actions"===e.$typeItems});if(i||(i={$type:"group",$typeItems:"fields",$items:[]},t.data.$items.push(i)),n||(n={$type:"group",$typeItems:"actions",$items:[]},t.data.$items.push(n)),i.$items=[],n.$items=[],e.forEach(function(e){var t={$type:"item",$title:e.$title,data:{$type:"field",data:{$bind:e.$bind,$widget:e.$widget,options:e.options}}};"field"===e.$type?i.$items.push(t):n.$items.push(t)}),t.map={},d.check(t.data,t.map),t.$element){var o=t.$element.get(0);p(t.$element);var a=r.find(o,i.$id);if(a&&r.remove(a),(a=r.find(o,n.$id))&&r.remove(a),i.$items.length){var s=$(d.toHtml(i,t.data)).get(0);r.append(o,s)}if(n.$items.length){var l=$(d.toHtml(n,t.data)).get(0);r.append(o,l)}u(t.$element,t)}},e.prototype.renderToolBox=function(e,t){return $(d.toHtml(e,t))},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=t.renderToolBox(t.data,null),u(t.$element,t)),e&&(t.options.beforeAdd&&t.options.beforeAdd(t.$element),t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},e.prototype._clearChildren=function(){},e.prototype._removeEvents=function(){this.$element&&p(this.$element)},e.prototype.destroy=function(){var e=this;e._clearChildren(),e.$element&&(e._removeEvents(),e.$element=null),n.unlisten(e)},e.prototype.getItemById=function(e){if(!e)return null;return this.map[e]},e.prototype._setListeners=function(){n.listen("onFormData",function(e){if(e.schema){var t=o.schema2Authoring(e.schema,e.schema,e.locale);this.updateFieldItems(t)}},this)},e}(),t.ToolBox=s}(Phoenix||(Phoenix={})),function(n){var e,t,i=n,u=i.utils,o=i.ipc,p=i.dom;i.authtoolbar,i.authtoolbox,i.authpropedit;e=n.authoring||(n.authoring={}),t=function(){function e(e,t){var i=this;i.options=e,i.id=u.allocID(),i._pe=new n.authpropedit.PropertyEditor(e),i._toolBar=new n.authtoolbar.AuthoringToolBar(e),i._toolBox=new n.authtoolbox.ToolBox(t,e),i._setListeners()}return e.prototype.render=function(e){var t,i,n=this,o=!1;if(!n.$element){var a=e.get(0).parentNode,s=p.find(a,"toolbox_parent");if(s){o=!0,n.$element=$(a),s.id="toolbox_parent_"+n.id;var l=p.find(a,"editor");l&&(l.id="editor_"+n.id),(l=p.find(a,"nav"))&&(l.id="nav_"+n.id),(l=p.find(a,"toolbox"))&&(l.id="toolbox_"+n.id)}else n.$element=$((t=n.id,n.options,(i=['<div class="container-fluid">']).push('<div id="nav_{0}"></div>'),i.push('<div class="row design-table">'),i.push('<div style="width:100%">'),i.push('<div id="content"></div>'),i.push("</div>"),i.push('<div id="toolbox_parent_{0}" style="width:300px">'),i.push('<div id="toolbox_{0}" class="bs-scroll-container"></div>'),i.push("</div>"),i.push("</div>"),i.push('<div id="editor_{0}"></div>'),i.push("</div>"),u.format(i.join(""),t)));var r=n.$element.get(0);n.options.beforeAdd&&n.options.beforeAdd(n.$element);var d=p.find(r,"editor_"+n.id);d&&n._pe.render($(d)),(d=p.find(r,"nav_"+n.id))&&n._toolBar.render($(d)),(d=p.find(r,"toolbox_"+n.id))&&n._toolBox.render($(d)),n.setDesignMode(n.options.design)}return e&&!o&&(n.options.replaceParent?e.replaceWith(n.$element):e.append(n.$element)),n.$element},e.prototype._setListeners=function(){var t=this;o.listen("onAuthoringModeChanged",function(e){t.setDesignMode(e)},this)},e.prototype.setDesignMode=function(e){var t=this;if(t.options.design=e,t.$element){var i=p.find(t.$element.get(0),"toolbox_parent_"+t.id);i&&(t.options.design?p.removeClass(i,"bs-none"):p.addClass(i,"bs-none"))}},e.prototype.destroy=function(){var e=this;e.$element&&(e.$element=null),e._pe&&(e._pe.destroy(),e._pe=null),e._pe&&(e._pe.destroy(),e._pe=null),o.unlisten(e)},e}(),e.AuthoringEditor=t}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.design.min.js.map