var Phoenix,__extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){!function(e){var t=function(){function e(){this._eventList=[]}return e.prototype.execute=function(e){this._eventList.push(e),this._execute()},e.prototype._execute=function(){var e=this;if(!e._inExec){e._inExec=!0;try{for(;e._eventList.length;){var t=e._eventList.shift();try{t()}catch(e){}}}finally{e._inExec=!1}}},e}();e.Serial=t;var r=function(){function e(e,t,n,i,o){var r=this;r.ondispose=o,r.promise=t,r.resolve=n,r.errorhandler=i,r.dataHandler=r.ondata.bind(r),e?r.timer=window.setTimeout(r._execute.bind(r),e):r._execute()}return e.prototype.ondata=function(e){var t=this.resolve;this.destroy(),t&&t(e)},e.prototype.onerror=function(e){var t=this.errorhandler;this.destroy(),t&&t(e)},e.prototype._execute=function(){var e=this;e.promise&&e.promise.then?e.promise.then(e.dataHandler,e.onerror.bind(e)):e.promise&&"function"==typeof e.promise?e.dataHandler(e.promise()):e.dataHandler(e.promise)},e.prototype._cleaTimeout=function(){var e=this;e.timer&&(window.clearTimeout(e.timer),e.timer=0)},e.prototype.destroy=function(){var e=this;e.resolve=null,e.errorhandler=null,e._cleaTimeout(),e.promise=null;var t=e.ondispose;e.ondispose=null,t&&t(e)},e}(),n=function(){function e(e){this.defaultDelay=0;var t=this;t.defaultDelay=e,t._error=t._errorHandler.bind(t),t._dispose=t._onEventDisposed.bind(t)}return e.prototype._errorHandler=function(e){this.onError&&this.onError(e)},e.prototype.clear=function(){var e=this;e.currentEvent&&(e.currentEvent.destroy(),e.currentEvent=null)},e.prototype._onEventDisposed=function(e){this.currentEvent=null},e.prototype.push=function(e,t,n){var i=this;i.clear();var o=n?0:i.defaultDelay;i.currentEvent=new r(o,e,t,i._error,i._dispose)},e.prototype.destroy=function(){this.clear()},e}();e.SingleEventBus=n,e.GlbSerial=new t}(e.serial||(e.serial={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i,r,o,s,l,a,u,d,c,p,h,f,m;t=e.utils||(e.utils={}),n=function(){return window.Promise||(window.ES6Promise?window.ES6Promise.Promise:null)},i=function(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t},a={scope:!(l=function(e,t){if(e){var n=t.indexOf("[");return 0<n?function(e,i){var o=Object.keys(i),r=null;if(e)return e.forEach(function(t){if(!r){var n=!0;o.forEach(function(e){n&&t[e]!==i[e]&&(n=!1)}),n&&(r=t)}}),r||void 0}(e[t.substring(0,n)],s(t.substring(n+1,t.length-1))):e[t]}}),destroy:!(s=function(e){var i={};return e.split(",").forEach(function(e){var t=e.split("=").map(function(e){return e.trim()}),n=t[1];n="'"===n.charAt(0)?n.substring(1,n.length-1).replace(/\'\'/g,"'"):parseFloat(n),i[t[0]]=n}),i}),menu:!(o=function(e,t){if(e)for(var n in e){var i=e[n];t[n];null===i||"object"!=typeof i||Array.isArray(i)?t[n]=i:(t[n]=t[n]||{},o(i,t[n]))}}),proxydata:!(r=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n[0].replace(/{(\d+)}/g,function(e,t){return t=parseInt(t,10),n[t+1]})})},u=function(e,t){if(!e&&t||!t&&e)return!1;if(e===t)return!0;if(!e&&!t)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(!u(e[n],t[n]))return!1;return!0}if("object"!=typeof e)return!1;if(typeof e!=typeof t)return!1;var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(var s=0,a=o.length;s<a;s++)if(!u(e[o[s]],t[o[s]]))return!1;return!0},d=function(o,r,s){var e=Object.keys(o),a=Object.keys(r);e.forEach(function(e){var t=o[e],n=a.indexOf(e);if(0<=n){a.splice(n,1);var i=r[e];if(i===t)return;null===i?s[e]=null:null===t?s[e]=i:Array.isArray(t)?u(t,i)||(s[e]=i):"object"==typeof t?u(t,i)||(s[e]={},d(t,i,s[e])):s[e]=i}else s[e]=null}),a.forEach(function(e){s[e]=r[e]})},c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},h=!(p=function(e){return(e||"").replace(/[&<>"'\/]/g,function(e){return c[e]})}),f=function(e,t,n){if(0<=e.indexOf(".")){var i=t;return e.split(".").forEach(function(e){i&&(i=i[e])}),(i||"")+""}return void 0===t[e]?n?e:"":t[e]},m=function(e,t){switch(e){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"firstChar":return t&&t.length?t[0]:""}return t},t.Promise=n(),t.allocUuid=function(){return i(!1)+i(!0)+i(!0)+i(!1)},t.allocID=function(){return"I"+i(!1)+i(!1)+i(!1)+i(!1)},t.format=r,t.merge=o,t.formatNames=function(e,o){return e.replace(/{([^{]*)}/g,function(e,t){for(var n=t.split("."),i=o;n.length&&(i=i[n.shift()]););return i||""})},t.extend=function(t,n){return t=t||{},Object&&Object.assign?Object.assign(t,n):(Object.keys(n).forEach(function(e){t[e]=n[e]}),t)},t.logModule=function(e,t){return void 0!==t&&(a[e]=t),a[e]},t.log=function(e,t){a&&a[t]&&console.log(e)},t.equals=u,t.copy=function(e){var t={};for(var n in e)t[n]=e[n];return t},t.deltaPatch=function(e,t){var n={};return d(e,t,n),Object.keys(n).length?n:null},t.isNull=function(e){return null===e},t.isUndefined=function(e){return void 0===e},t.isNullOrUndefined=function(e){return null==e},t.logRule=function(e,t,n,i){if(h){e=(e||1)-1;var o=new Array(e).join("  ");"string"==typeof t?console.log(r('{0}{1}".',o,t)):console.log(r('{0} {4} Rule: "{1} - {2}", triggered by "{3}".',o,t.name,t.description,n,i))}},t.showRules=function(e){return void 0!==e&&(h=e),h},t.escapeHtml=p,t.phoenixPath=function(){for(var e=document.getElementsByTagName("script"),t=e.length-1;0<=t;--t){var n=e[t].src.split("?")[0].split("/"),i=n.length,o=n[i-1].toLowerCase();if("phoenix.js"==o||"phoenix.min.js"==o||"core.js"==o&&"core"==n[i-2]){var r=i-1;return"core.js"==o&&r--,n.slice(0,r).join("/")}}throw"Invalid script Name"},t.parseExpression=function(e,n){return e.replace(/{{([^{]*)}}/g,function(e,t){return f(t,n,!1)})},t.hasExpression=function(e){return 0<=(e||"").indexOf("{{")},t.parseVariable=function(e,t){return f(e,t,!0)},t.defineProperty=function(t,e){var n=e||this;Object.defineProperty(n.props,t,{get:function(){return n.data[t]},set:function(e){e!=n.data[t]&&(n.data[t]=e,n._notifyChange(t))},enumerable:!0})},t.applyMixins=function(n,e){e.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(e){n.prototype[e]=t.prototype[e]})})},t.nextTick=window.setImmediate?function(e){window.setImmediate(function(){e()})}:function(e){setTimeout(function(){e()},0)},t.focusDelay=function(e){setTimeout(function(){e()},30)},t.dataAsPromise=function(e){return n().resolve(e)},t.extractAngularVars=function(e,n){return e.replace(/\{\{([^{]*)\}\}/g,function(e,t){return n.push({name:t.split("|")[0].trim()}),""}),0<n.length},t.execAngularExpression=function(e,a,l,u){return e.replace(/\{\{([^{]*)\}\}/g,function(e,t){for(var n=t.split("|"),i=(n[0]||"").trim(),o=l?a[i]:f(i,a,!1),r=1,s=n.length;r<s;r++)o=m((n[r]||"").trim(),o);return u?p(o):o})},t.gmapsKey="AIzaSyDiKrbrYbAywKceJxGkXMp-g2n0nHKCCQo",t.gGeodecodeKey="AIzaSyCkxZGMS_NOflTRHnj6qgmOmT6CENu-3lM",t.confirm=function(e,t,n,i){window.confirm(t)?n():i&&i()},t.info=function(e,t,n,i){},t.message=function(e,t,n,i){},t.upload=function(e,t){},t.alert=function(e,t,n){window.alert(t)},t.prompt=function(e,t,n){n(window.prompt(e,t))},t.cleanUpObject=function(t){Object.keys(t).forEach(function(e){t[e]=null})},t.getValue=function(e,t){var n=t.split(".");if(1===n.length)return l(e,t);for(var i=e,o=null,r=0,s=n.length;r<s;r++){var a=n[r];if(!(o=l(i,a)))return o;i=o}return o},t.getPathValue=l,t.supportCondition=function(t,n){var e=Object.keys(n),i=!0;return e.forEach(function(e){i&&t[e]!==n[e]&&(i=!1)}),i},t.parseStringCondition=s,t.glbDisclaimerMessage="",function(){Math.trunc||(Math.trunc=function(e){return(e=+e)-e%1||(isFinite(e)&&0!==e?e<0?-0:0:e)});var e=Array.prototype;e.find||(e.find=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,i=Object(this),o=i.length>>>0,r=(t=t,0);r<o;r++)if(n=i[r],e.call(t,n,r,i))return n}),e.findIndex||(e.findIndex=function(e,t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,i=Object(this),o=i.length>>>0,r=(t=t,0);r<o;r++)if(n=i[r],e.call(t,n,r,i))return r;return-1})}()}(Phoenix||(Phoenix={})),(Phoenix||(Phoenix={})).locale={},function(e){var t,a;t=e.customData||(e.customData={}),a={},t.register=function(e,t){for(var n=e.split("."),i=a,o=0,r=n.length-1;o<r;o++){var s=n[o];i[s]=i[s]||{},i=i[s]}i[n[n.length-1]]=t},t.unregister=function(e,t){for(var n=e.split("."),i=a,o=0,r=n.length-1;o<r;o++){var s=n[o];if(!i[s])return;i[s]=i[s]||{},i=i[s]}i[n[n.length-1]]=null},t.get=function(e){for(var t=e.split("."),n=a,i=null,o=0,r=t.length;o<r;o++){if(!(i=n[t[o]]))return i;n=i}return i}}(Phoenix||(Phoenix={})),function(e){e.device={phone:!1,tablet:!1,deviceType:""};e.$mem=function(){try{if(window.sessionStorage)return JSON.parse(window.sessionStorage.getItem("$mem"))||{}}catch(e){return{}}}(),e.save$mem=function(){!function(e){e=e||{};try{window.sessionStorage&&window.sessionStorage.setItem("$mem",JSON.stringify(e))}catch(e){}}(e.$mem)},e.sessionPreferences=function(e,t){var n=null;try{n=JSON.parse(window.sessionStorage.getItem("preferences"))}catch(e){}if(void 0===t)return n?n[e]:void 0;(n=n||{})[e]=t;try{window.sessionStorage.setItem("preferences",JSON.stringify(n))}catch(e){}},e.preferences=function(e,t){var n=null;try{n=JSON.parse(window.localStorage.getItem("preferences"))}catch(e){}if(void 0===t)return n?n[e]:void 0;(n=n||{})[e]=t;try{window.localStorage.setItem("preferences",JSON.stringify(n))}catch(e){}},e.build={version:"0.1.0.0",release:!1,authMode:"dev",releaseVersion:""}}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r;e.build;t=e.authentication||(e.authentication={}),n={},i={setItem:function(e,t){n[e]=t},getItem:function(e){return n[e]}},o=[],r=function(){var t=null;try{t=window.localStorage}catch(e){t=null}return t||(t=i),t},t.db=r,t.save=function(e,t){t||(e.basic="Basic "+window.btoa((e.login||"")+":"+(e.password||""))),r().setItem("authentication",JSON.stringify(e))},t.load=function(){try{return JSON.parse(r().getItem("authentication"))}catch(e){return null}},t.clear=function(){r().setItem("authentication","null"),o.forEach(function(e){e()})},t.registerAfterLogout=function(e){o.push(e)}}(Phoenix||(Phoenix={})),function(e){!function(o){var n={},i=function(e,t){return n[e]=t},r=function(e){return n[e]};function s(e,t){return e=e||o.name,null==t?r("application_"+e):i("application_"+e,t)}function e(){return o.configuration&&o.configuration.portailName?o.configuration.portailName:"portail"}o.core="phoenix",o.name="",o.support="",o.homeName="home",o.title="",o.licences={},o.configuration=null,o.useJSONPatch=!1,o.config=s,o.init=function(e,t,n){if(o.name=e,o.title=t,n&&n.homes&&n.homes[e]&&(o.homeName=n.homes[e]),o.configuration=n,angular){var i=n&&n.angularModules||[];Array.isArray(i)||"object"!=typeof i||(i=i[e]||[]),o.angularApplication=angular.module(e,i)}},o.portailName=e,o.isPortail=function(){return o.name===e()},o.isCustomizable=function(e,t){var n=s(o.name);return!(!n||!n.customizable)&&(t.indexOf(".json")<0&&(t+=".json"),0<=n.customizable.indexOf([e,o.name,t].join("/")))}}(e.application||(e.application={}))}(Phoenix||(Phoenix={})),function(e){!function(h){h.onAjax=null;var s=e.utils,a=e.application,f=e.customData,o=e.authentication,m=e.locale,l={},v=function(e){var t=l["s"+e];return t&&!t.disabled?(t.handlers.forEach(function(e){e()}),{error:!0}):null},g=function(e){return e.responseJSON&&e.responseJSON.error&&e.responseJSON.error.message?e.responseJSON.error.message:e.responseJSON?m.errors.error500:e.responseText},y=function(e){var t=null;if(e.responseText&&(t={responseText:e.responseText}),e.responseJSON)if(t=t||{},"object"==typeof e.responseJSON)t.json=e.responseJSON;else try{t.json=JSON.parse(e.responseJSON)}catch(e){}return t},i=function(e,t,n,l){var i=s.Promise;t&&":"===t.charAt(0)&&(t=location.protocol+"//"+location.hostname+t);var o={type:e,contentType:"application/json",accept:"application/json",url:t,data:null};return l&&l.headers&&(o.headers=l.headers,void 0!==l.processData&&(o.processData=l.processData),void 0!==o.headers.contentType&&(o.contentType=o.headers.contentType)),n&&o.contentType&&0<=o.contentType.indexOf("application/json")?o.data=JSON.stringify(n):o.data=n,new i(function(s,a){h.onAjax&&h.onAjax(),$.ajax(o).done(function(e,t,n){s(e)}).fail(function(e,t,n){var i=e.status||500;if(l&&l.ignore&&l.ignore[""+i])return s({});if(v(i))return s({});500<=i&&m&&m.errors&&(t=g(e),n=null);var o=y(e);o&&(n=null);var r=null;n&&(r="string"==typeof n?{message:n}:n),(r=r||{message:t,detail:o}).status=e.status,a(r)})})},u={},d=function(e){if(!e){var t=a.config(a.name);e=t?t.odata:null}var n={headers:null};if(e&&e.headers&&(n.headers=e.headers),n.headers=n.headers||{},n.headers.Accept="application/json",e&&e.authentication){var i=o.load();if(i)switch(e.authentication){case"basic":n.headers.Authorization=i.basic;break;case"header-session":n.headers.Authorization="Bearer "+i.token}else delete n.headers.Authorization}return n},c=function(o,e,r,t){var n=u[o];if(n){if(n.loaded)return r(null);if(n.error)return r(n.error,null);window.setTimeout(function(){c(o,e,r,t)},20)}else u[o]={loading:!0},t?t.execute(function(e){u[o]=e?{error:e}:{loaded:!0},r(e)}):(h.onAjax&&h.onAjax(),$.ajax({url:e,dataType:"script",cache:!0}).done(function(e,t,n){u[o]={loaded:!0},r(null)}).fail(function(e,t,n){var i=n||{message:t};u[o]={error:i},r(i)}))};h.extractAjaxErrors=function(e){var t,n={message:"",list:[]};if(e&&"object"!=typeof e&&(e={message:e}),e=e||{},n.status=e.status,e.message=e.message||m.errors.unknownError,e.detail)if(e.detail.json&&e.detail.json.error){var i=e.detail.json.error,o=void 0;if(void 0!==i.details&&(o=i),t=i.message,i.innererror&&i.innererror.message&&"Json"===i.innererror.type&&(o=JSON.parse(i.innererror.message)),o)return n.message=o.message,o.details&&o.details.forEach(function(e){n.list.push({message:e.message,target:e.target})}),n}else t=e.detail.json&&e.detail.json.exceptionMessage?e.detail.json.exceptionMessage:e.detail.responseText;return n.message=t||e.message,n},h.get=function(e,c,i){var t;e&&":"===e.charAt(0)&&(e=location.protocol+"//"+location.hostname+e),!i&&(t=c)&&"function"==typeof t&&(i=c,c=null);var n={type:"GET",url:e,dataType:"json",accept:"application/json"},p=null;return c&&(p=c.$errors,delete c.$errors,Object.keys(n).forEach(function(e){c[e]=n[e]}),n=c),new s.Promise(function(u,d){h.onAjax&&h.onAjax(),$.ajax(n).done(function(e,t,n){i&&(e=i(e)),u(e)}).fail(function(e,t,n){if(c&&c.ignore&&c.ignore[""+e.status])return u({});var i=e.status||500;if(p&&p[i+""]){var o=i+"";if("string"!=typeof p[o])return u(p[o]);var r=f.get(p[o]);r&&u(r())}var s=v(i);if(s)return s.error?d({}):u({});500<=i&&m&&m.errors&&(t=g(e),n=null);var a=y(e);a&&(n=null);var l=null;n&&(l="string"==typeof n?{message:n}:n),(l=l||{message:t,detail:a}).status=e.status,l._ajax=!0,"error"===l.message&&l.detail&&l.detail.responseText&&(l.message=l.detail.responseText),d(l)})})},h.getScript=function(e){return new s.Promise(function(i,o){h.onAjax&&h.onAjax(),$.ajax({url:e,dataType:"script",cache:!0}).done(function(e,t,n){i(!0)}).fail(function(e,t,n){o(n||{message:t})})})},h.getDefaultAjaxOptions=d,h.put=function(e,t,n){return i("PUT",e,t,n)},h.patch=function(e,t,n){return i("PATCH",e,t,n)},h.post=function(e,t,n){return i("POST",e,t,n)},h.logData=function(e,t){if(t=t||{},navigator.sendBeacon)navigator.sendBeacon(e,JSON.stringify(t));else{var n=new XMLHttpRequest;n.open("POST",e,!1),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(JSON.stringify(t))}return s.Promise.resolve()},h.remove=function(e,t){return i("DELETE",e,null,t)},h.postAndDownload=function(e,t){var n=s.Promise,i=d(null),o=a.config(a.name)||{},r=o.rest&&o.rest.base||"";return e&&"/"===e.charAt(0)&&(r=""),r&&(e=r+"/"+e),new n(function(l,u){var d=function(e){var t=e.statusText;if(v(e.status))return l({});500<=e.status&&m&&m.errors&&(t=m.errors.error500),u({message:t,detail:null})},c=new XMLHttpRequest;c.open("POST",e,!0),c.responseType="arraybuffer",c.onload=function(){if(200===this.status||201===this.status){var e="",t=c.getResponseHeader("Content-Disposition");if(t&&-1!==t.indexOf("attachment")){var n=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);null!=n&&n[1]&&(e=n[1].replace(/['"]/g,""))}var i=c.getResponseHeader("Content-Type"),o=null;try{o=new Blob([this.response],{type:i})}catch(e){return u(e)}if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,e),l({});else{var r=window.URL||window.webkitURL,s=r.createObjectURL(o);if(e){var a=document.createElement("a");void 0===a.download?window.location.href=s:(a.href=s,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a))}else window.location.href=s;setTimeout(function(){r.revokeObjectURL(s),l({})},300)}}else d(this)},c.onerror=function(){d(c)},c.setRequestHeader("Content-type","application/json"),i&&i.headers&&Object.keys(i.headers).forEach(function(e){c.setRequestHeader(e,i.headers[e])}),c.send(JSON.stringify(t))})},h.addAuthToUrl=function(e){var t=a.config(a.name);if(t&&t.odata&&t.odata.authentication){var n=o.load();if(n)switch(t.odata.authentication){case"basic":break;case"header-session":var i="token="+encodeURIComponent(n.token);i=0<e.indexOf("?")?"&"+i:"?"+i,e+=i}}return e},h.loadScript=c,h.interceptError=function(e,t,n){var i="s"+e;if(!("s401"===i&&(o=a.configuration)&&o.authentication&&o.authentication.autoLogon&&o.authentication.autoLogon.force)){var o,r=l[i]||{disabled:!1,handlers:[],error:n};r.handlers.push(t),l[i]=r}},h.activateInterceptError=function(e,t){var n=l["s"+e];n&&(n.disabled=!t)}}(e.ajax||(e.ajax={}))}(Phoenix||(Phoenix={})),function(y){var o,e=y,_=e.locale,b=e.utils,x=e.ajax;!function(n){var i=[],l=function(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e},u=function(e,t){t=l(t,2);var n=Math.pow(10,t);return(Math.round(e*n)/n).toFixed(t)},s=function(e,t,n,i){if(null===e)return"";var o=l(t,0),r=e<0?"-":"",s=parseInt(u(Math.abs(e||0),o),10)+"",a=3<s.length?s.length%3:0;return r+(a?s.substr(0,a)+n:"")+s.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+n)+(o?i+u(Math.abs(e),o).split(".")[1]:"")},o=function(e,t,n,i,o,r){return null===e?"":(r=r||"%v %s").replace("%s",o).replace("%v",s(e,t,n,i))},r=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},d=function(e,t){for(var n=e+"";n.length<t;)n="0"+e;return n},a=function(e,t){var n=e.getDate(),i=e.getDay(),o=e.getMonth(),r=e.getFullYear(),s=e.getHours(),a=e.getMinutes(),l={d:n,dd:d(n,2),ddd:_.date.weekdaysShort[i],dddd:_.date.weekdays[i],m:o+1,mm:d(o+1,2),mmm:_.date.monthsShort[o],mmmm:_.date.months[o],yy:(r+"").slice(2),yyyy:r,H:s+"",HH:d(s,2),h:(12<s?s-12:s)+"",hh:d(12<s?s-12:s,2),M:a+"",MM:d(a,2),A:12<s?"PM":"AM"};return t.replace(/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTtA])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,function(e){return e in l?l[e]:e.slice(1,e.length-1)})},c=function(e){var t=_.date.dateShort.split("/");if(3!==t.length)return"";var r=(e||"").split(_.date.daySep),s=[0,0,0],a="";t.forEach(function(e,t){var n=0;"m"===e.charAt(0)?n=1:"y"===e.charAt(0)&&(n=2);var i=r[t]||"";if(2===t){var o=i.indexOf(" ");0<o&&(a=i.substr(o+1).trim(),i=i.substr(0,o))}s[n]=parseInt(i,10),2==n&&s[n]<100&&i.length<3&&(s[n]+=100*Math.round((new Date).getFullYear()/100))});var n={d:s[0],m:s[1],y:s[2],H:0,M:0,S:0};if(a){var i=_.date.shortTime.split(" "),o=a.split(" "),l=!1;i.length<=2&&o.length===i.length&&(2===i.length&&(l="PM"===o[1]),2<=(o=o[0].split(":")).length&&(n.H=parseInt(o[0],10),n.M=parseInt(o[1],10),2<o.length&&(n.S=parseInt(o[2],10)),l&&n.H<12&&(n.H=n.H+12)))}return n},p=function(e){var t=c(e),n=d(t.y,4)+"-"+d(t.m,2)+"-"+d(t.d,2),i=Date.parse(n);if(isNaN(i))return"";var o=new Date(n);return o.setHours(t.H),o.setMinutes(t.M),o.setSeconds(t.S),o.setMilliseconds(0),o.toISOString()},h=function(e){if(!e)return"";var t=r(e);if(!t)return"";var n=_.date.dateShort;return"/"!==_.date.daySep&&(n=n.replace(/\//g,_.date.daySep)),a(t,n+" "+_.date.shortTime)},f=function(e){if(!e)return"";var t=r(e);if(!t)return"";var n=_.date.dateShort;return"/"!=_.date.daySep&&(n=n.replace(/\//g,_.date.daySep)),a(t,n)},m=function(e,t){return e=e||0,t?o(e,_.number.places,_.number.thousand,_.number.decimal,_.number.symbol,_.number.format):s(e,_.number.places,_.number.thousand,_.number.decimal)},v=function(e,t,n){if(null===e)return"";var i=n?"%v %s":"%v";return o(e=e||0,t,_.number.thousand,_.number.decimal,n,i)},g=function(e,t,n,i){var o=e[t],r=e[n],s=e[i],a=new Date(s,r-1,o);return a.getFullYear()==s&&a.getMonth()+1==r&&a.getDate()==o};function e(e){var t=b.phoenixPath();e!=n.currentLang&&x.getScript(t+"/locale/phoenix_"+n.lang+".min.js").then(function(){n.currentLang=e}).catch(function(e){})}n.register=function(e){i.push(e)},n.translate=function(e,t){$.extend(!0,_,e),i.forEach(function(e){e(t)})},n.tt=function(e,s){return s=s||{},e&&"{{"==e.substring(0,2)?e.replace(/{{(.*)}}/g,function(e,t){for(var n=t.split("."),i=s,o=0,r=n.length;o<r&&i;o++)i=i[n[o]];return void 0===i?"["+t+"]":i}):e},n.currentLang="en",n.defCountry="US",n.lang="fr",n.country="FR",n.money=m,n.truncMoney=function(e){return parseFloat(e.toFixed(_.number.decimal))},n.decimal=v,n.integer=function(e){return(e||0)+""},n.format=function(n,e){if(!n||!e)return e;var i=[];return Object.keys(n).forEach(function(e){var t=n[e];"date"!==t.type&&"money"!==t.type&&"decimal"!==t.type&&"number"!==t.type||i.push({name:e,type:t.type,symbol:t.symbol,longdate:t.longdate,decimals:t.decimals,useSymbol:void 0===t.useSymbol||t.useSymbol})}),i.length&&(Array.isArray(e)?e:[e]).forEach(function(t){i.forEach(function(e){switch(e.type){case"date":t[e.name]=f(t[e.name]);break;case"money":t[e.name]=m(t[e.name],e.useSymbol);break;case"integer":t[e.name]=v(t[e.name],0,e.symbol);break;case"decimal":case"number":t[e.name]=v(t[e.name],e.decimals,e.symbol)}})}),e},n.parseISODate=r,n.parseISODateAsUTC=function(e){return e?Date.UTC(parseInt(e.substr(0,4),10),parseInt(e.substr(5,2),10)-1,parseInt(e.substr(8,2),10),0,0,0):0},n.parseISODateTime=function(e){if(e instanceof Date)return e;if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:new Date(t)},n.isoDatePart=function(e){var t=e||"",n=t.indexOf("T");return 0<n&&(t=t.substr(0,n)),t},n.shortDateTime=h,n.shortDate=f,n.longDate=function(e){if(!e)return"";var t=r(e);if(!t)return"";var n=_.date.dateLong;return"/"!=_.date.daySep&&(n=n.replace(/\//g,_.date.daySep)),a(t,n)},n.monthYear=function(e){if(!e)return"";var t=r(e);if(!t)return"";var n=_.date.monthYear;return"/"!=_.date.daySep&&(n=n.replace(/\//g,_.date.daySep)),a(t,n)},n.localeDate2ISO=function(e){var t=c(e),n=d(t.y,4)+"-"+d(t.m,2)+"-"+d(t.d,2),i=Date.parse(n);return isNaN(i)?"":n},n.localeDateTime2ISO=p,n.date2ISO=function(e){var t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate();return d(t,4)+"-"+d(n,2)+"-"+d(i,2)},n.string2Float=function(e){var t=e.replace(new RegExp(_.number.thousand,"g"),"");"."!=_.number.decimal&&(t=t.replace(new RegExp(_.number.decimal,"g"),"."));var n=parseFloat(t);return isNaN(n)&&(n=0),n},n.tryParseDate=function(e){var t=y.locale.date.daySep,n=e.split(t);if(3!==n.length)return"";for(var i=0;i<3;i++)n[i]=parseInt(n[i],10);var o=0,r=0,s=0;switch(_.date.dateShort){case"dd/mm/yyyy":o=0,r=1,s=2;break;case"mm/dd/yyyy":o=1,r=0,s=2;break;case"yyyy/mm/dd":o=2,r=1,s=0}return n[s]<100&&(n[s]+=2e3),g(n,o,r,s)?(n[o]=d(n[o],2),n[r]=d(n[r],2),n[s]=d(n[s],4),n.join(_.date.daySep)):""},n.tryParseDateTime=function(e){var t=p(e);return t?h(t):""},n.localeTitle=function(e){return"object"==typeof e?e[n.currentLang]:e},n.loadLocale=e,["en","fr"].indexOf(n.lang)<0&&(n.lang=n.currentLang),e(n.lang)}(o=y.ulocale||(y.ulocale={})),(y.angularjs||(y.angularjs={})).registerFilters=function(e){e&&e.filter&&(e.filter("money",[function(){return function(e,t){var n=null===e?null:e?parseFloat(e):0;return o.money(n,t)}}]),e.filter("decimal",[function(){return function(e,t,n){var i=null===e?null:e?parseFloat(e):0;return o.decimal(i,t||0,n)}}]),e.filter("shortdate",[function(){return function(e){return o.shortDate(e)}}]),e.filter("longdate",[function(){return function(e){return o.longDate(e)}}]),e.filter("monthyear",[function(){return function(e){return o.monthYear(e)}}]))}}(Phoenix||(Phoenix={})),(Phoenix||(Phoenix={})).ulocale.translate({layouts:{design:{Save:"Save",New:"New page",Open:{title:"Open page",open:"Open",close:"Close"},PageName:"Page Name",InvalidPageName:"Invalid page name",ConflictedPageName:"A page of that name exists, do you want to give another name ?",Delete:"Delete page",DeletePreferences:"Delete preferences",ConfirmDelete:"Are you sure you want to delete this page ?",ConfirmDeletePrefs:"Are you sure you want to delete preferences for this page ?",Preview:"Preview",AuthoringMode:"Authoring",layouts:"Blocks",widgets:"Widgets",fields:"Fields",actions:"Actions",properties:"Properties",childrenFlow:"Children disposition",childrenFlowVertical:"Vertical Flow",childrenTableCell:"Table cell",childrenAccordionGroup:"Accordion Group",customStyle:"Custom style",nestedLayoutName:"Nested Layout Name",nestedLayoutBind:"Bind for nested layout",nestedFormController:"Controller for nested form",columnSize:"Size",customColumnSize:"Custom Size",appearance:"Appearance",appearanceAccordion:"Accordion",appearanceTabs:"Tabs",appearanceWizard:"None",showTitle:"Show title",bindPagesTitle:"Bind",name:"Name",forceDisplayTable:"Force display(Css) table",title:"Title",actionApply:"Apply",formType:"Form Type",ftVertical:"Vertical Form",ftHorizontal:"Horizontal Form",ftInline:"Inline form",labelSize:"Label width (Bootstrap cols)",blockPosition:"Position",bpStatic:"Static",bpStickyTop:"Sticky Top",bpStickyBottom:"Sticky Bottom",noTitlesForFields:"Don't show field's titles",fieldsTitle:"Children (Fields)"},defaultTitle:"No title",NoData:"No data"},schema:{required:"{0} is required.",minNumber:"{0} must be at least {1}",maxNumber:"{0} cannot exceed {1}",minNumberExclusive:"{0} must be greater than {1}",maxNumberExclusive:"{0} must be less than {1}",uniqueColumn:"The column '{0}' must be unique.",uniqueColumns:"Duplicate value for columns '{0}' found.",passwordMismatch:"Password mismatch.",invalidEmail:"Invalid Email Address.",invalidChars:"Some characters are invalid.",invalidPhone:"Invalid Url Address.",invalidUrl:"Invalid Phone Number.",minLength:"{0} must be at least {1} characters"},ui:{Close:"Close",Abandon:"Abandon",Ok:"Ok",Yes:"Yes",No:"No",false:"False",true:"True",Warning:"Warning",Info:"Information",Disconnect:"Disconnect",Confirm:"Confirm",Validate:"Validate",Create:"Create",password:{oldPassword:"Old Password",newPassword:"New Password",change:"Change password"},ApplyDetailChanges:"Apply",Selected:"Sel.",Add:"Add",title:"Title",selectedFilters:"Selected filters",OpenNewTab:"Open link in new tab",Search:"Search",Actions:"Actions",FileUpload:"Choose File",Apply:"Apply",Remove:"Remove",ExportCsv:"Export as CSV",SaveSuccessful:"Changes saved successfully.",cancelWarning:"All changes will be lost if you leave this page without saving. Are you sure to continue ?",removeWarning:"Are you sure you want to delete this item?"},errors:{Title:"Oops! An unknown error has occurred.",SendMail:"Send",MailSubject:"Error in JS client",ErrorTitle:"Error:",ErrorUser:"User:",ErrorDate:"Date and time:",Browser:"Browser:",ErrorURI:"Address:",Stack:"Call stack:",Context:"Context:",error500:"Internal server error",unknownError:"An unknown error has occurred.",notAuthorized:"Forbidden",invalidUploadFileName:"Blocked for security reasons!",invalidUploadFileSize:"File too large!"},listView:{search:{Search:"Search",Nodata:"Aucun résultat trouvé ..."}},pagination:{Next:"»",Previous:"«",First:"First",Last:"Last"},number:{decimal:".",thousand:" ",places:2,symbol:"$",coef:["U","K"],format:"%s %v"},charts:{numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",rangeSelectorZoom:"Zoom",rangeSelectorFrom:"From",rangeSelectorTo:"To"},date:{weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateShort:"mm/dd/yyyy",dateLong:"d mmm, yyyy",monthYear:"mmmm yyyy",shortTime:"hh:MM A",daySep:"-",weekStart:0,today:"Today",clear:"Clear"},operators:{in:{symbol:"=",title:"equal",binary:!1},nin:{symbol:"!=",title:"not equal",binary:!1},gt:{symbol:">",title:"is greater than",binary:!1},ge:{symbol:">=",title:"is greater or equal than",binary:!1},lt:{symbol:"<",title:"is less than",binary:!1},le:{symbol:">",title:"is less or equal than",binary:!1},between:{symbol:"between",title:"between",binary:!0},nbetween:{symbol:"not between",title:"not between",binary:!0},like:{symbol:"contains",title:"contains",binary:!1},nlike:{symbol:"not contains",title:"not contains",binary:!1},empty:{symbol:"is null",title:"is null",binary:!1},nempty:{symbol:"is not null",title:"is not null",binary:!1}},types:{number:{title:"Number",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},decimal:{title:"Decimal",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},money:{title:"Money",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},integer:{title:"Integer",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},date:{title:"Date",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},time:{title:"Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},"date-time":{title:"Date Time",operators:["in","nin","gt","ge","lt","le","between","nbetween","empty","nempty"]},string:{title:"String",operators:["in","nin","like","nlike","empty","nempty"]},enum:{title:"Enum",operators:["in","nin","empty","nempty"]},lookup:{title:"Lookup",operators:["in","nin","empty","nempty"]},boolean:{title:"Boolean",operators:["in","nin","empty","nempty"]}}},"en"),function(e){var d,t,n,i,o,r,s=e.utils;(t=d=e.external||(e.external={})).hashHandler=null,t.logoutHandler=null,t.forbiddenHandler=null,t.changePasswordHandler=null,t.checkLoggedInHandler=null,t.historyChangedHandler=null,t.formOpenHandler=null,t.preferenceLoadHandler=function(i){var e=s.Promise;return window.localStorage?new e(function(e,t){var n=window.localStorage.getItem("preferences."+i);e(n?JSON.parse(n):null)}):new e(function(e,t){e(null)})},t.preferenceSaveHandler=function(n,i){var e=s.Promise;return window.localStorage?new e(function(e,t){i?window.localStorage.setItem("preferences."+n,JSON.stringify(i)):window.localStorage.setItem("preferences."+n,""),e()}):new e(function(e,t){e()})},t.ruleLoaderHandler=null,t.ruleViewer=null,function(s){s.useServerState=!1,s.setState=function(e,t){var n=JSON.parse(sessionStorage.getItem("phoenix_history_state")||"{}");n[e]=t,sessionStorage.setItem("phoenix_history_state",JSON.stringify(n))},s.getState=function(e){return JSON.parse(sessionStorage.getItem("phoenix_history_state")||"{}")[e]},s.supportRefresh=!0,s.destroyViewHandler=function(e){console.log(e)};var a=[],l=function(){var e=sessionStorage.getItem("phoenix_history");a=e?JSON.parse(e).history:[]},u=function(){sessionStorage.setItem("phoenix_history",JSON.stringify({history:a}))},r=function(e,t){l();var n=[];e&&a.forEach(function(e){e.data.forEach(function(e){e.deferClose=t,n.push(e)}),e.data=[]}),a=[],u(),n.length&&s.destroyViewHandler(n)};s.removeLast=function(){l();var t=[],e=a.pop();e.data.forEach(function(e){return t.push(e)}),e.data=[],u(),t.length&&s.destroyViewHandler(t),d.historyChangedHandler&&d.historyChangedHandler()},s.add=function(e,t){if(t&&r(!0,!1),l(),t)return a=[{pageName:e,data:[],persistent:!1}],u(),void(d.historyChangedHandler&&d.historyChangedHandler());var n=a.length;if((n?a[n-1].pageName:"")!==e){var i=[];if(e===(2<=n?a[n-2].pageName:"")){var o=a.pop();o.data.forEach(function(e){return i.push(e)}),o.data=[]}else a.push({pageName:e,data:[],persistent:!1});u(),i.length&&s.destroyViewHandler(i),d.historyChangedHandler&&d.historyChangedHandler()}},s.hasBack=function(){return l(),1<a.length},s.value=a,s.lastPage=function(){if(l(),a&&1<a.length){var e=a[a.length-2].pageName,t=e.indexOf("?");return 0<t&&(e=e.substr(0,t)),t=1,t+=1,"/"===(e=e.substr(t)).charAt(0)&&(e=e.substr(1)),e}return""},s.locationPrefix="!",s.clear=r,s.updateLast=function(e,t,n){l();var i=a.length;(i?a[i-1].pageName:"")===e&&(a[i-1].pageName=t,void 0!==n&&(a[i-1].persistent=!!n),u())},s.addData=function(e){if(l(),a.length){var t=a[a.length-1],n=!0,i=JSON.stringify(e);if(t.data.forEach(function(e){n&&JSON.stringify(e)===i&&(n=!1)}),n&&(t.data.push(e),u()),!s.useServerState&&1<a.length){var o=a[a.length-2];if(!o.persistent){var r=[];o.data.forEach(function(e){return r.push(e)}),o.data=[],u(),r.length&&s.destroyViewHandler(r)}}}},s.clearLastData=function(t){l();var n=[];if(a.length){var e=a[a.length-1];e.data.forEach(function(e){e.deferClose=t,n.push(e)}),e.data=[],u()}n.length&&s.destroyViewHandler(n)}}(e.history||(e.history={})),n=e.render||(e.render={}),i={},n.register=function(e,t,n){i[e]=i[e]||{},i[e][t]=n},n.get=function(e,t){return i[e]?i[e][t]:null},o=e.ipc||(e.ipc={}),r={},o.emit=function(e,t){var n=r["on"+e];n&&n.forEach(function(e){(e.listener?e.handler.bind(e.listener):e.handler)(t)})},o.listen=function(e,t,n){r[e]=r[e]||[],r[e].push({listener:n,handler:t})},o.unlisten=function(n,e){function t(e){if(e)for(var t=e.length;t--;)e[t].listener==n&&e.splice(t,1)}e?t(r[e]):Object.keys(r).forEach(function(e){t(r[e])})}}(Phoenix||(Phoenix={})),function(l){var t,e,n,i,o,r,s,a,u,d,c,p,h,f,m,v,g,y,_,b,x,C,k,w,O,S,E;l.bootstrap4=!0,l.fontawesome=!1,l.modalPlugin="modal",e=t=l.dom||(l.dom={}),s={"arrow-left":"arrow-back","arrow-right":"arrow-forward","arrow-down":"arrow-downward","arrow-up":"arrow-upward",backward:"fast-rewind",bars:"menu",bolt:"toys",filter:"filter-list",wrench:"build",building:"add-to-queue",calendar:"date-range","caret-up":"arrow-drop-up","caret-down":"arrow-drop-down","check-square-o":"check-box","chevron-down":"expand-more","chevron-left":"chevron-left","chevron-right":"chevron-right","clock-o":"schedule",cloud:"cloud",cog:"settings","ellipsis-v":"more-vert","exclamation-circle":"error",eye:"visibility",forward:"fast-forward","file-o":"folder",floppy:"done","info-circle":"info",lock:"lock",unlock:"lock-open",minus:"remove",remove:"clear","minus-circle":"remove-circle",pencil:"edit","power-off":"power-settings-new",plus:"add","plus-circle":"add-circle","question-circle":"info","help-circle":"help",search:"search","square-o":"check-box-outline-blank",th:"apps",print:"print","thumb-tack":"turned-in",times:"close","times-circle":"cancel","times-circle-o":"highlight-off",trash:"delete",user:"account-box","window-minimize":"fullscreen-exit","window-maximize":"fullscreen",heart:"favorite","map-marker":"location-on",paperclip:"attach-file","file-export":"import-export",comment:"comment","euro-sign":"euro-symbol",history:"history","address-card":"contacts","calendar-alt":"event",archive:"archive","credit-card":"payment","file-invoice":"description","cloud-download":"cloud-download"},d=function(e,t,n){var i=(e||"").split(" "),o=i.indexOf(n);return t?o<0&&i.push(n):0<=o&&i.splice(o,1),i.join(" ")},p=function(e,t){void 0===t&&(t=!1);var n=l.fontawesome?e:s[e]?s[e]:e;return t?(l.fontawesome?"fa-":"mdi-")+n:(l.fontawesome?"fa fa-":"mdi mdi-")+n},h=function(e,t){return e?e.querySelectorAll(t):document.querySelectorAll(t)},f=function(e,t){return e?e.id==t?e:e.querySelector("#"+t):document.getElementById(t)},m=function(e,t){e.classList?e.classList.remove(t):e.className=d(e.className,!1,t)},v=function(e,t){return e.classList?e.classList.contains(t):0<=((e.className||"")+"").split(" ").indexOf(t)},g=function(e){e.parentNode&&e.parentNode.removeChild(e)},y=function(e,t){e.appendChild(t)},_=function(e,t){if(t){var n=t.getBoundingClientRect(),i=e.getBoundingClientRect();return{left:Math.round(i.left-n.left),top:Math.round(i.top-n.top),width:Math.round(i.width),height:Math.round(i.height)}}var o,r,s,a,l;i=e.getBoundingClientRect();return o={left:i.left,top:i.top,width:i.width,height:i.height},r=document.documentElement.clientTop||document.body.clientTop||0,s=document.documentElement.clientLeft||document.body.clientLeft||0,a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,o.top=Math.round(o.top+a-r),o.left=Math.round(o.left+l-s),o},b=function(e,t){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},x=function(e,t,n){if(void 0===n&&(n=void 0),void 0===n)return e.getAttribute(t);e.setAttribute(t,n)},k=c=0,w=function(e,t){e?(k++,C||(k=1,(C=$('<div class="bs-cover'+(t?" bs-none":"")+'"></div>').get(0)).style.height=$(document).height()-1+"px",y(document.body,C),t&&setTimeout(function(){C&&m(C,"bs-none")},t))):(--k<=0&&(k=0),C&&0===k&&(g(C),C=null))},O=function(){$(window).trigger("global-phoenix-resize")},S=C=u=a=null,E=function(e){for(var t=(document.cookie||"").split("; "),n=0,i=t.length;n<i;n++){var o=t[n].split("=");if(e==o[0]){var r=o[1]||"";return""===r?null:r}}return null},e.readyHandlers=[function(){$(window).on("resize.phoenix",function(){S&&clearTimeout(S),S=setTimeout(O,50)})}],e.finalizeHandlers=[],e.keys={VK_TAB:9,VK_UP:38,VK_DOWN:40,VK_INSERT:45,VK_DELETE:46,VK_LEFT:37,VK_RIGHT:39,VK_ENTER:13,VK_ESCAPE:27,VK_F1:112,VK_HOME:36,VK_END:35,VK_PGUP:33,VK_PGDOWN:34,VK_SPACE:32,VK_F2:113,VK_F3:114,VK_F4:115,VK_BACKSPACE:8,VK_F10:121},e.queryAll=h,e.find=f,e.query=function(e,t){return e?e.querySelector(t):window.document.querySelector(t)},e.addClass=function(e,t){e.classList?e.classList.add(t):e.className=d(e.className,!0,t)},e.removeClass=m,e.hasClass=v,e.icon=function(e){var t=document.createElement("span");return t.className=p(e,!1),t},e.iconClass=p,e.customIconClass=function(e,t){return t?t+" "+t+"-"+e:p(e)},e.iconPrefix=function(){return l.fontawesome?"fa":"mdi"},e.bodyTheme=function(e){var t=document.body.firstElementChild;t&&v(t,"bs-content")||(t=document.body);for(var n=e?"bs-body-theme-"+e:"",i=(t.className||"").split(" "),o=!1,r=i.length;r--;){var s=i[r];if(0==s.indexOf("bs-body-theme-")){if(s==n)return!1;o=!0,i.splice(r,1)}}n&&(o=!0,i.push(n)),o&&(t.className=i.join(" "))},e.offset=function(e){var t,n;if(3===e.nodeType||!(t=e.getBoundingClientRect()).width&&!t.height)return t||{top:0,left:0,width:0,height:0,bottom:0,right:0};var i=e.ownerDocument,o=null!=(n=i)&&n===n.window?n:9===n.nodeType&&n.defaultView,r=i.documentElement;return{top:t.top+o.pageYOffset-r.clientTop,left:t.left+o.pageXOffset-r.clientLeft,width:t.width,height:t.height,bottom:0,right:0}},e.before=function(e,t){e.parentNode.insertBefore(t,e)},e.after=function(e,t){var n=e.parentNode;(e=e.nextSibling)?n.insertBefore(t,e):n.appendChild(t)},e.parentByTag=function(e,t,n){for(n=n.toUpperCase();t;){if(t.tagName===n)return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},e.parentById=function(e,t,n){for(;t;){if(t.id===n)return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},e.parentByAttr=function(e,t,n){for(;t;){if(x(t,n))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},e.parentByClass=function(e,t,n){for(;t;){if(v(t,n))return t;if((t=t.parentNode)===e)break;if(t===document.body)break}return null},e.indexOf=function(e,t){for(var n=0,i=e.childNodes.length;n<i;n++)if(e.childNodes[n]==t)return n;return-1},e.append=y,e.prepend=function(e,t){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},e.select=function(e){e&&e.select()},e.empty=function(e){for(var t=e.childNodes.length-1;0<=t;t--)e.removeChild(e.childNodes[t])},e.remove=g,e.detach=function(e){return e.parentNode.removeChild(e),e},e.attr=x,e.text=function(e,t){if(void 0===t)return e.textContent;if(e.childNodes.length){for(var n=!1,i=0,o=e.childNodes.length;i<o;i++){var r=e.childNodes[i];if(3==r.nodeType){r.nodeValue=t,n=!0;break}}n||y(e,document.createTextNode(t))}else e.textContent=t},e.findByAttribute=function(e,t,n){for(var i=e;i;){if(!i.getAttribute)return null;if(i.getAttribute(n))return i;i=i==t?null:i.parentNode}return null},e.isChildOf=b,e.parseStyle=function(e,n){e&&e.split(" ").forEach(function(e,t){(e=e.trim())&&"$"===e.charAt(0)&&(e="bs-style-"+e.substring(1)),n.push(e)})},e.ignoreKeys=[0,e.keys.VK_UP,e.keys.VK_DOWN,e.keys.VK_HOME,e.keys.VK_END,e.keys.VK_PGUP,e.keys.VK_PGDOWN,e.keys.VK_ENTER,e.keys.VK_ESCAPE,e.keys.VK_DELETE,e.keys.VK_BACKSPACE,e.keys.VK_INSERT],e.arrowKeys=[e.keys.VK_LEFT,e.keys.VK_RIGHT,e.keys.VK_UP,e.keys.VK_DOWN],e.processing=w,e.inProcessing=function(){return null!=C},e.inCover=function(e){return C&&b(C,e)},e.scrollbar=(n=!1,i=0,function(){if(n)return i;var e,t=document.createElement("div");return t.style.cssText="overflow:scroll; overflow-x:hidden; zoom:1; clear:both",t.innerHTML="&nbsp;",document.body.appendChild(t),e=t.offsetWidth-t.scrollWidth,document.body.removeChild(t),n=!0,i=e}),e.supportCssCalc=function(){var e=document.createElement("a");return e.style.cssText="width: calc(10px);",!!e.style.length},e.documentScroll=function(){return{left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop}},e.documentClientDim=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},e.documentViewSize=function(){return{height:Math.max(document.documentElement.clientHeight||document.body.clientHeight,window.innerHeight||0),width:Math.max(document.documentElement.clientWidth||document.body.clientWidth,window.innerWidth||0)}},e.touch=(r=o=!1,function(){return o||(r="ontouchend"in document,o=!0),r}),e.position=_,e.childrenPositions=function(o,e,r,s,t){var a=new Array(e.length+1),l=t.firstDelta||0,n=t.lastDelta||0,u=t.delta||0,i=t.height||0,d=t.top||0;e.forEach(function(e,t){var n=f(o,e.htmlId),i=_(n,null);a[t]={info:e.info,zone:s,position:"before",vertical:r,point:{x:0,y:0},left:i.left+(r?0:0===t?l:u),top:d||i.top,width:Math.round(n.offsetWidth),height:Math.round(n.offsetHeight),htmlId:e.htmlId}});var c=null;if(a.forEach(function(e){var t=e.point;t.y=e.top+(e.height>>1),t.x=e.left+(e.width>>1),c=e}),c){var p=n-(0===a.length?l:u);c={position:"after",zone:s,info:c.info,vertical:c.vertical,point:{x:0,y:0},left:c.left+(r?0:p)+(r?0:c.width),top:c.top+(r?c.height:0),width:c.vertical?c.width:0,height:i||(c.vertical?0:c.height),htmlId:c.htmlId}}else{var h=_(o,null);c={info:{},position:"empty",zone:s,vertical:r,point:{x:0,y:0},left:h.left+(r?0:n),top:d||h.top,width:Math.round(o.offsetWidth),height:i||Math.round(o.offsetHeight),html:o.id}}return c.point.y=c.top+(c.height>>1),c.point.x=c.left+(c.width>>1),a[e.length]=c,a},e.findNearest=function(i,o,e){var r,s,a=1e6;return e.forEach(function(e){var t,n=Math.abs(e.point.y-o);n<a?(a=n,s=Math.abs(e.point.x-i),r=e):n==a&&(t=Math.abs(e.point.x-i))<s&&(s=t,r=e)}),r},e.showMove=function(e,t,n,i){if(i=i||"bs-drag-color-info",e)if(e.vertical!==t)g(e),e=null;else{var o=e.firstChild.firstChild;v(o,i)||(g(e),e=null)}if(!e){var r=['<div class="bs-absolute">'];r.push('<div class="bs-absolute" style="left: 0px; top: 0px"><span class="'),t?r.push(p("arrow-left")):r.push(p("arrow-down")),i&&r.push(" "+i),r.push('"></span></div>');var s=[];r.push('<div class="bs-absolute" style="'),t?(s.push("right: 0px;"),s.push("bottom: 0px;"),r.push(s.join("")),r.push('"><span class="'),r.push(p("arrow-right"))):(s.push("left: 0px;"),s.push("bottom: 0px;"),r.push(s.join("")),r.push('"><span class="'),r.push(p("arrow-up"))),i&&r.push(" "+i),r.push('"></span></div>'),r.push("</div>"),(e=$(r.join("")).get(0)).vertical=t,y(document.body,e)}var a=e.style,l=e.firstElementChild,u=e.lastElementChild,d=Math.round(l.offsetWidth),c=Math.round(u.offsetHeight);return t?(a.height=c+"px",a.width=n.width+2*d+"px",a.left=n.left-d+"px",a.top=n.top-(c>>2)-4+"px"):(a.height=n.height+2*c+"px",a.top=n.top-c+"px",a.left=n.left-(d>>2)+"px"),a.zIndex="9002",e},e.featureTest=function(e,t,n){var i=e+":",o=document.createElement("test").style;return o.cssText=n?i+t:i+["-webkit-","-moz-","-ms-","-o-",""].join(t+";"+i)+t+";",-1!==o[e].indexOf(t)},e.getPx=function(e){return parseInt(e,10)||0},e.removeStype=function(e,t){e.style.removeProperty?e.style.removeProperty(t):e.style[t]="border"===t?"none":""},e.rem2px=function(e){return Math.round(e*(c||(c=parseFloat(getComputedStyle(document.documentElement).fontSize)),c))},e.checkSize=function(e){return"number"==typeof e?e+"px":e},e.bootstrapStyles=function(e){return e?u||(u={primary:"outline-primary",secondary:"outline-secondary",default:"outline-secondary",important:"outline-important",success:"outline-success",info:"outline-info",danger:"outline-danger",warning:"outline-warning",link:"outline-link",dark:"outline-dark"}):a||(a={primary:"primary",secondary:"secondary",default:"secondary",important:"important",success:"success",info:"info",danger:"danger",warning:"warning",link:"link",dark:"default"})},e.selectRange=function(e,t,n){void 0===n&&(n=t),e.setSelectionRange(t,n)},e.childrenRectsbyAttribute=function(e,t){for(var n=h(e,"[data-"+t.attributeName+"]"),i=[],o=0,r=n.length;o<r;o++){var s=n[o],a=_(s,e);a.value=x(s,"data-"+t.attributeName),i.push(a)}return i},e.findAttrByPosition=function(e,t,n){for(var i=0;i<n.length;i++){var o=n[i];if(e>=o.left&&t>=o.top&&e<=o.left+o.width&&t<=o.top+t)return o}return null},e.setCookie=function(e,t,n,i){try{t||(i=new Date),document.cookie=e+"="+t+(null!=i?"; expires="+i.toUTCString():"")+(n?"; path="+n:"/")}catch(e){return!1}return E(e)==t},e.getCookie=E,e.iframeAsPromise=function(o,r,s,a){return new l.utils.Promise(function(n,t){w(!0);try{var i=function(e){var t=f(null,o);t&&t.contentWindow&&e.source===t.contentWindow&&"object"==typeof e.data&&e.data.action===s&&(window.removeEventListener("message",i),document.body.removeChild(t),a&&a(e.data.params),w(!1),n())};window.setTimeout(function(){var e=f(null,o);e&&(window.removeEventListener("message",i),document.body.removeChild(e),w(!1),t({message:"Timeout"}))},15e3);var e=document.createElement("iframe");e.style.cssText="position: absolute; top: -1000px; left -1000px; width: 0px; height: 0px;",e.frameBorder="0",e.scrolling="yes",e.id=o,e.src=r,y(document.body,e),window.addEventListener("message",i,!1)}catch(e){w(!1),t(e)}})},e.loadPlan=function(i){return new l.utils.Promise(function(e,t){var n=new Image;n.onload=function(){e({width:n.width,height:n.height,src:i})},n.onerror=function(){e({width:500,height:500,src:l.utils.phoenixPath+"../empty-plan.png"})},n.src=i})},e.downloadContentHandler=function(e,t){var n=document.createElement("a");n.style.display="none";var i=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8"});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(i,t);else{var o=window.URL.createObjectURL(i);n.href=o,n.href=o,n.download=t,n.click(),window.URL.revokeObjectURL(o)}},e.downloadUriHandler=function(e){var t;((t=f(document.body,"glb_down_frame"))||((t=document.createElement("iframe")).style.cssText="position: absolute; top: -1000px; left -1000px; width: 0px; height: 0px;",t.frameBorder="0",t.scrolling="yes",t.id="glb_down_frame",t.src="about:blank",y(document.body,t)),t).src=e},$(document).ready(function(){t.readyHandlers.length&&t.readyHandlers.forEach(function(e){e()})}),window.addEventListener("beforeunload",function(e){t.finalizeHandlers.length&&t.finalizeHandlers.forEach(function(e){try{e()}catch(e){console.log(e)}})})}(Phoenix||(Phoenix={})),function(e){var t,n,o=e.dom;e.utils;t=e.events||(e.events={}),n=function(){function e(){}return e.prototype.disable=function(){this._isDisabled=!0},e.prototype.enable=function(){this._isDisabled=!1},e}(),t.EventManager=n,t.mouseEvents=function(e){if(o.touch())switch(e){case"mousedown":return"touchstart";case"mouseup":return"touchend";case"mousemove":return"touchmove"}return e},t.isLeftButton=function(e){return!!o.touch()||e.which<2},t.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},t.point=function(e){var t,n=document.documentElement;if(o.touch()){var i=e.targetTouches||e.touches;i&&(t={x:i[0].pageX||i[0].clientX+(n.scrollLeft||document.body.scrollLeft),y:i[0].pageY||i[0].clientY+(n.scrollTop||document.body.scrollTop)})}return t||(t={x:e.pageX||e.clientX+(n.scrollLeft||document.body.scrollLeft),y:e.pageY||e.clientY+(n.scrollTop||document.body.scrollTop)}),t.x=Math.round(t.x),t.y=Math.round(t.y),t},t.eventManager=new n}(Phoenix||(Phoenix={})),function(e){var l=e.dom,u=e.utils,a=e.events,s=e.customData;!function(r){var e=function(){function e(){}return e.prototype.initialize=function(){var e=this,t=$(document);e._mu=e.mouseUp.bind(e),e._md=e.mouseDownEmpty.bind(e),t.on(a.mouseEvents("mouseup"),e._mu),t.on(a.mouseEvents("mousedown"),e._md)},e.prototype.finalize=function(){var e=this,t=$(document);e._mu&&(t.off(a.mouseEvents("mouseup"),e._mu),e._mu=null),e._md&&(t.off(a.mouseEvents("mousedown"),e._mu),e._md=null),e._listeners=null,e._current=null},e.prototype.startMouseMove=function(){var e=this;e._mm||(e._mm=e.mouseMove.bind(e),$(document).on(a.mouseEvents("mousemove"),e._mm))},e.prototype.stopMouseMove=function(){this._mm&&($(document).off(a.mouseEvents("mousemove"),this._mm),this._mm=null)},e.prototype._canExecuteEvent=function(e){return!!this._current},e.prototype.mouseUp=function(e){var t=this._current;return!t||(t.inDragging?t.notifyDragEnd(!1,e):t.notifyDragEnd(!0,e),this.setCurrent(null),t.clear(),!1)},e.prototype.mouseDownEmpty=function(e){return!0},e.prototype.mouseMove=function(e){var t=this;if(t._canExecuteEvent(e)){var n=t._current;if(!n)return!0;if(!n.ready(e))return a.isLeftButton(e)||(t.setCurrent(null),n.clear()),!0;if(!a.isLeftButton(e))return t.cancelDrag(),!0;try{n.notifyDrag(e)}catch(e){t.cancelDrag()}return a.stopEvent(e),!0}},e.prototype.addDrag=function(e){var t=new n(e);return this._listeners=this._listeners||[],this._listeners.push(t),t},e.prototype.rmvDrag=function(e){if(this._listeners){var t=this._listeners.indexOf(e);0<=t&&(this._listeners.splice(t,1),e.finalize())}},e.prototype.setCurrent=function(e){return(!e||!this._current)&&(this._current=e,this._current||this.stopMouseMove(),!0)},e.prototype.cancelDrag=function(){var e=this._current;e&&(e.inDragging&&e.notifyDragEnd(!0,null),this.setCurrent(null),e.clear())},e.prototype.cover=function(e,t,n){var i=this;if(e)if(i._coverId){if(void 0!==t)(a=l.find(document.body,i._coverId)).style.cursor=t}else{i._coverId=u.allocID();var o=l.documentScroll(),r=l.documentClientDim();r.width+=o.left,r.height+=o.top,r.width=Math.round(Math.max(r.width,document.body.offsetWidth)),r.height=Math.round(Math.max(r.height,Math.round(document.body.offsetHeight)));var s=document.createElement("div");s.id=i._coverId,s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.style.backgroundColor="white",s.style.opacity="0.01",s.style.width=r.width+"px",s.style.height=r.height+"px",s.style.zIndex=(n||1e4)+"",s.style.cursor=t,l.append(document.body,s)}else if(i._coverId){var a=l.find(document.body,i._coverId);i._coverId=null,a&&l.remove(a)}},e}();r.DragAndDropManager=e;var n=function(){function e(e){var t=this;t._elements=e,t._mdEvent=t.mousedown.bind(t),t.clear(),t._setEvents()}return e.prototype.clear=function(){var e=this;e._startTimer&&clearTimeout(e._startTimer),e._startTimer=null;var t=e.stopEvent;e.mouseMoveCount=0,e._lastDropTarget=null,e.minLeft=null,e.maxLeft=null,e.minTop=null,e.maxTop=null,e.currentLeft=0,e.currentTop=0,e.moveX=!1,e.moveY=!1,e.moveSourceName=null,e._targets=null,e.inDragging=!1,e.coverDocument=!0,e.cursor="default",e.startPoint=null,e.currentPoint=null,e.startOffset=null,e.stopEvent=!1,e.data={},e.floatElement=null,e.floatParent=null,e.stopEvent=t},e.prototype._removeEvents=function(){var t=this;t._elements&&(t._elements.forEach(function(e){$(e).off(a.mouseEvents("mousedown"),t._mdEvent)}),t._elements=null)},e.prototype._setEvents=function(){var t=this;t._elements&&t._elements.forEach(function(e){$(e).on(a.mouseEvents("mousedown"),t._mdEvent)})},e.prototype.mousedown=function(e){var t=this;return t._startTimer&&clearTimeout(t._startTimer),t._startTimer=null,a.isLeftButton(e)?(t.mouseMoveCount=0,t.inDragging=!1,t.canStartDrag(e)&&r.dragManager.setCurrent(t)&&(t.startPoint=a.point(e),t._startTimer=setTimeout(function(){t._startTimer=null,t.mouseMoveCount=5e3,t.notifyDragStart(e)},300),r.dragManager.startMouseMove(),t.stopEvent&&a.stopEvent(e)),!0):(r.dragManager.mouseUp(e),!1)},e.prototype.finalize=function(){var e=this;e._startTimer&&clearTimeout(e._startTimer),e._startTimer=null,e._removeEvents(),u.cleanUpObject(e)},e.prototype.ready=function(e){return this.inDragging},e.prototype.notifyDrag=function(e){var t=this;if(t.inDragging){t.currentPoint=a.point(e);var n=t.floatElement;if(n&&t.moveX){var i=t.startOffset.left+t.currentPoint.x-t.startPoint.x;null!==t.minLeft&&i<t.minLeft&&(i=t.minLeft),null!==t.maxLeft&&i>t.maxLeft&&(i=t.maxLeft),t.currentLeft=i,n.style.left=i+"px"}if(n&&t.moveY){var o=t.startOffset.top+t.currentPoint.y-t.startPoint.y;null!==t.minTop&&o<t.minTop&&(o=t.minTop),null!==t.maxTop&&o>t.maxTop&&(o=t.maxTop),t.currentTop=o,n.style.top=o+"px"}if(t.onDrag&&t.onDrag(e),n&&t._targets){var r=l.position(n,null),s=l.findAttrByPosition(r.left,r.top,t._targets);t.canDrop(!!s),t._lastDropTarget=s?{value:s.value,x:r.left-s.left,y:r.top-s.top}:null}}},e.prototype.notifyDragStart=function(e){var t=this;t.inDragging=!0,a.eventManager.disable(),t.coverDocument&&r.dragManager.cover(!0,t.cursor);try{var n=!0;t.onDragStart&&(t.onDragStart(e)||(t.notifyDragEnd(!0,e),n=!1),t.floatElement&&(t.startOffset=l.position(t.floatElement,t.floatParent))),n&&(t.moveX||t.moveY)&&t.moveSourceName&&(t._targets=l.childrenRectsbyAttribute(null,{attributeName:"drag-"+t.moveSourceName}))}catch(e){}},e.prototype.canStartDrag=function(e){return!this.canStartDragHandler||this.canStartDragHandler(e)},e.prototype.canDrop=function(e){this.coverDocument&&r.dragManager.cover(!0,e?this.cursor:"no-drop")},e.prototype.notifyDragEnd=function(e,t){var n=this;n.inDragging=!1;var i=n.coverDocument;if(n.onDragEnd&&n.onDragEnd(e,t),n._lastDropTarget&&!e){var o=s.get(n._lastDropTarget.value);o&&"object"==typeof o&&o.dragEnd&&o.dragEnd(t)}u.nextTick(function(){a.eventManager.enable(),i&&r.dragManager.cover(!1)})},e}();r.DragElement=n,r.dragManager=new e,l.readyHandlers.push(function(){r.dragManager.initialize()}),l.finalizeHandlers.push(function(){r.dragManager.finalize()});var t;r.setData=function(e){t=e},r.getData=function(){return t}}(e.drag||(e.drag={}))}(Phoenix||(Phoenix={})),function(t){var e,i,d,s,c,n,p,h,o,f,m,r,a,l,v,u,g,y,_,$,b,x,C,k,w;e=t.link||(t.link={}),d=(i=t).utils,s=i.dom,c=i.customData,n=i.device,p=i.application,h=i.external,o=i.authentication,f=i.locale,m=i.history,r=[],a=function(n){if(!n)return"";var i=[];return Object.keys(n).forEach(function(e){var t=n[e];null!==t&&("object"==typeof t&&(t=JSON.stringify(t)),i.push(e+"="+encodeURIComponent(t||"")))}),0<i.length?"?"+i.join("&"):""},l=function(e,i){var t="",o={},n=e;if(0===e.indexOf("http")){var r=e.indexOf("//");t=e.substr(0,r+2),0<(r=(n=e.substr(r+2)).indexOf("/"))&&(t+=n.substr(0,r),n=n.substr(r))}"#"===n.charAt(0)&&(n=n.substr(1)),m.locationPrefix&&n.charAt(0)===m.locationPrefix&&(n=n.substr(1));var s=n.indexOf("?");if(0<=s){var a=n.substring(s+1);if(n=n.substring(0,s),a)a.split("&").forEach(function(e){if(e){var t=e.split("="),n=decodeURIComponent(t[1]);if(i&&n)if("["===n.charAt(0)&&"]"===n.charAt(n.length-1))try{n=JSON.parse(n)}catch(e){}else if("{"===n.charAt(0)&&"}"===n.charAt(n.length-1))try{n=JSON.parse(n)}catch(e){}o[decodeURIComponent(t[0])]=n}})}return{path:n,search:o,host:t}},v=function(e){for(var t=0,n=r.length;t<n;t++){var i=r[t];if(i.test(e))return i}return null},u=function(e){return l(window.location.href,e).search},g=function(e){var t=e.$page;return n.phone&&e.$pageMobile?t=e.$pageMobile:n.tablet&&e.$pageTablet&&(t=e.$pageTablet),t},y=function(e){var t=null;try{t=JSON.parse(o.db().getItem("authentication"))}catch(e){}var n={$url:u(!0),$mem:i.$mem,$user:{name:t?t.name||t.nom||t.login:"",firstName:t?t.firstName||t.prenom||t.login:"",lastName:t&&(t.lastName||t.nom)||""},$item:null,$cookie:null,$target:null};e&&e.cookie&&(n.$cookie={},(document.cookie||"").split(";").forEach(function(e){var t=e.split("=");t[0]=t[0].replace(/^ /,""),n.$cookie[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}));return n},_=function(e,t,n){if(e.$page){var i=g(e),o="#"+m.locationPrefix+"/"+i,r=[];if(t&&e.$search&&e.$search.length){var s=y();Object.keys(t).forEach(function(e){s[e]=t[e]}),e.$search.forEach(function(e){e&&e.left&&r.push(e.left+"="+encodeURIComponent(d.parseVariable(e.right,s)))})}return n&&Object.keys(n).forEach(function(e){r.push(e+"="+encodeURIComponent(n[e]))}),r.length&&(o=o+"?"+r.join("&")),o}return"#"},$={},b=function(e){var t=e.indexOf("://");if(0<t){var n=$[e.substring(0,t)];if(n)return n.protocol}return null},x=function(e){return"#"+(t.history.locationPrefix?t.history.locationPrefix:"")+e.path+a(e.search)},C=function(e,t,n,i,o){if(e&&"#"===(""+e).charAt(0)||(e="#"+e),m.locationPrefix&&e.charAt(1)!==m.locationPrefix&&(e=e="#"+m.locationPrefix+e.substring(1)),n){var r=document.createElement("a");return r.href=e,r.target="_blank",document.body.appendChild(r),r.click(),void document.body.removeChild(r)}o&&m.clear(!0,!1),window.location.hash!==e&&(h.hashHandler?h.hashHandler(e,t,i):(m.removeLast(),t&&"replaceState"in window.history?window.history.replaceState(void 0,void 0,e):location.hash=e))},k=function(e){if(e.name&&e.schema){var t="/authoring/forms/"+e.name,n=[];e.schema!==e.name&&n.push("prototype="+encodeURIComponent(e.schema)),e.locale&&n.push("locale="+encodeURIComponent(e.locale)),e.path&&n.push("path="+encodeURIComponent(e.path));var i=window.location.href.lastIndexOf("?");if(0<i){var o=window.location.href.substr(i+1).split("&"),r=[];o.forEach(function(e){var t=e.split("=");["prototype","path","locale"].indexOf(t[0])<0&&r.push(e)}),n.push(r.join("&"))}n.length&&(t=t+"?"+n.join("&")),window.location.hash="#"+m.locationPrefix+t}},w=function(e,t){var n="/authoring",i=window.location.hash;"#"===i.charAt(0)&&(i=i.substring(1)),m.locationPrefix&&i.charAt(0)===m.locationPrefix&&(i=i.substring(1)),t||0!==i.indexOf(n)?window.location.hash="#"+m.locationPrefix+n+(e?"/"+e:i):0===i.indexOf("/authoring/forms/")?window.history.back():window.location.hash="#"+m.locationPrefix+i.substring(n.length)},e.search=u,e.object2search=a,e.parseUrl=l,e.hashLink=_,e.pageName=g,e.isCustomLink=function(e,t,n){for(var i=t.target;i&&i!=e;){var o=s.attr(i,"data-phoenix-href")||s.attr(i,"href");if(o){if("#"===o){n||t.preventDefault();break}var r=b(o);if(r)return n||t.preventDefault(),{protocol:r,value:o}}i=i.parentNode}return null},e.registerLinkExecutor=function(e){r.push(e)},e.getLinkExecutor=v,e.registerCustomProtocol=function(e,t){$[e]={protocol:e,handler:t}},e.execCustomProtocol=function(e,t,n,i){var o=$[e.protocol];o&&o.handler&&o.handler(e.value,t,n,i)},e.isCustomProtocol=b,e.doAuthoring=w,e.doFormAuthoring=k,e.execLink=function(i,o,r){var e,s=p.configuration&&p.configuration.application?p.configuration.application.modules:null;if(i.$page){var t=function(){if(s&&s[a]&&p.licences){var e=p.licences[s[a]];if(e&&!e.hasLicence&&h.forbiddenHandler)return h.forbiddenHandler()}var t=_(i,o,r),n=o&&"blank"===o.$target;if(i.$module&&i.$module!==p.name)return function(e,t,n,i,o){var r,s=location.pathname.split("/"),a="";0<s[s.length-1].indexOf(".html")&&(a=s.pop());var l=s.pop();if(a||""!=l||s.pop(),s.push(t),a&&s.push(a),r=s.join("/"),e&&"#"===(""+e).charAt(0)||(e="#"+e),m.locationPrefix&&e.charAt(1)!==m.locationPrefix&&(e="#"+m.locationPrefix+e.substr(1)),r+=e,o){var u=document.createElement("a");return u.href=r,u.target="_blank",document.body.appendChild(u),u.click(),void document.body.removeChild(u)}i?location.replace(r):location.href=r}(t,i.$module,p.name,i.$replace,n);C(t,i.$replace,n,!1,!i.$isDetail),i.$authoring&&w()},a=i.$module?i.$module:p.name;i.$checkForChanges&&i.$form&&i.$form.$model.containerHasChanges?d.confirm(i.$form.title||f.ui.Warning,f.ui.cancelWarning,function(){t()}):t()}else if(i.$logout)h.logoutHandler&&h.logoutHandler();else if(i.$back)i.$checkForChanges&&i.$form&&i.$form.$model.containerHasChanges?d.confirm(i.$form.title||f.ui.Warning,f.ui.cancelWarning,function(){m.removeLast(),window.history.back()}):(m.removeLast(),window.history.back());else if(i.$form)e=i.$form,h.formOpenHandler&&h.formOpenHandler(e);else if(i.$action&&i.$action.name){var n=c.get(i.$action.name);n&&n(i.$action.params)}else if(i.$formAuthoring)k(i);else if(i.$authoring)w();else if(i.href){var l=document.createElement("a");l.href=i.href,i.target&&(l.target=i.target),document.body.appendChild(l),l.click(),document.body.removeChild(l)}else{var u=v(i);u&&u.hnd(i)}},e.context=y,e.changeSearch=function(e,t,n,i){var o=l(window.location.hash,!1),r=x(o);t?o.search=e||{}:d.merge(e,o.search);var s=x(o);n&&m.updateLast(r,s,i),C(s,!0,!1,!0,!1)},e.removeFromSearch=function(e){var t=u(!0);e.forEach(function(e){return delete t[e]});var n=l(window.location.hash,!1),i=x(n);n.search=t||{};var o=x(n);m.updateLast(i,o),m.clearLastData(!1),C(o,!0,!1,!1,!1)},e.updateSearchEntry=function(e,t){var n=l(window.location.hash,!1),i=x(n);n.search=n.search||{},n.search[e]=t;var o=x(n);m.updateLast(i,o),C(o,!0,!1,!0,!1)}}(Phoenix||(Phoenix={})),function(e){var x=e.dom;!function(g){g.topOffset=0,g.bottomOffset=0;var t=x.featureTest("position","sticky",!1),n=x.featureTest("position","fixed",!0),y="bs-sticky-on",i="bs-sticky-off",_="bs-sticky-dummy",b=function(e,t,n){t?(x.addClass(e,y),"top"===n?e.style.top=g.topOffset+"px":"bottom"===n&&(e.style.bottom=g.bottomOffset+"px"),x.removeClass(e,i)):(x.addClass(e,i),x.removeClass(e,y),x.removeStype(e,"width"),x.removeStype(e,"top"),x.removeStype(e,"bottom"))},e=function(){function e(){this._map={},this._list=[],this._scroll=null,this._resize=null,this._refreshTimer=null,this._scrollTimer=null}return e.prototype.add=function(e){!t&&n&&(this._map[e.id]=e,this._list.push(e))},e.prototype.remove=function(e){var t,n,i,o,r=this._map[e];if(void 0!==r){r.element&&(n=(t=r).position,i=t.element,$(i),o=x.find(i.parentNode,t.id+"_sticky_clone"),b(i,!1,n),o&&x.remove(o)),r.element=null,delete this._map[e];var s=this._list.indexOf(r);0<=s&&this._list.splice(s,1)}},e.prototype.initialize=function(){var e=this;!t&&n&&(e._scroll=e._onscroll.bind(e),e._resize=e._onresize.bind(e),$(window).on("scroll.sticky",e._scroll),$(window).on("global-phoenix-resize",e._resize))},e.prototype._updateElements=function(n){this._list.forEach(function(e){var t=e.element;n&&!x.hasClass(t,y)||t.offsetWidth&&function(e){var t=e.element,n=$(t),i=x.offset(t),o=n.outerHeight(),r=0,s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,a=x.hasClass(t,y),l=$(window).height(),u=n.parent(),d=u.offset().top,c=u.outerHeight(),p=x.find(u.get(0),e.id+"_sticky_clone");if(p){var h=x.offset(p);p.style.height=o+"px",r=h.width?h.top:i.top}else r=i.top,(p=document.createElement("div")).id=e.id+"_sticky_clone",p.className=_,p.style.height=o+"px",x.after(t,p);var f,m="top"===e.position,v="bottom"===e.position;m&&(f=s+0+g.topOffset,r<f&&f+o<=d+c)||v&&s+l-0<r+(o||0)&&d+(o||0)<=s+l-0?t.style.width=a?(h=x.offset(p),h.width+"px"):(b(t,!0,e.position),i.width+"px"):a&&b(t,!1,e.position)}(e)})},e.prototype._onscroll=function(){var e=this;e._scrollTimer&&(window.clearTimeout(e._scrollTimer),e._scrollTimer=null),e._scrollTimer=window.setTimeout(function(){e._updateElements(!1)},20),e._updateElements(!1)},e.prototype._onresize=function(){this._updateElements(!0)},e.prototype._refresh=function(e){e&&this._updateElements(!1)},e.prototype.refresh=function(e){var t=this;t._refreshTimer&&(window.clearTimeout(t._refreshTimer),t._refreshTimer=null),t._refreshTimer=window.setTimeout(function(){t._refresh(e)},200)},e.prototype.finalize=function(){if(!t&&n){var e=this;e._refreshTimer&&(window.clearTimeout(e._refreshTimer),e._refreshTimer=null),e._scrollTimer&&(window.clearTimeout(e._scrollTimer),e._scrollTimer=null),$(window).off("scroll.sticky",e._scroll),$(window).off("global-phoenix-resize",e._resize),e._scroll=null,e._resize=null}},e}();g.StickyManager=e,x.readyHandlers.push(function(){g.stickyManager.initialize()}),x.finalizeHandlers.push(function(){g.stickyManager.finalize()}),g.stickyManager=new g.StickyManager,g.native=t||!n}(e.sticky||(e.sticky={}))}(Phoenix||(Phoenix={})),function(t){!function(e){(t.jsonpatch||(t.jsonpatch={})).compare=function(e,t,n){var i=[];return y(e,t,i,"",n=n||{}),i};var m=function(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}return Object.keys(e)},v=function(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")},g=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},y=function(e,t,n,i,o){for(var r=o.useId,s=Array.isArray(t),a=m(t),l=m(e),u=!1,d=l.length-1;0<=d;d--){var c=e[f=l[d]],p=s&&r&&c.id?c.id+"":f;if(!t.hasOwnProperty(f)||void 0===t[f]&&void 0!==c&&!1===Array.isArray(t))n.push({op:"remove",path:i+"/"+v(p)}),u=!0;else{var h=t[f];"object"==typeof c&&null!=c&&"object"==typeof h&&null!=h?y(c,h,n,i+"/"+v(p),o):c!==h&&n.push({op:"replace",path:i+"/"+v(p),value:g(h)})}}if(u||a.length!=l.length)for(d=0;d<a.length;d++){var f=a[d];e.hasOwnProperty(f)||void 0===t[f]||n.push({op:"add",path:i+"/"+(s&&r?"-":v(f)),value:g(t[f])})}}}()}(Phoenix||(Phoenix={})),function(e){var t;(t=e.filters||(e.filters={})).OPERATORS={in:"in",nin:"nin",gt:"gt",ge:"ge",lt:"lt",le:"le",between:"between",nbetween:"nbetween",like:"like",nlike:"nlike",empty:"empty",nempty:"nempty"},t.TYPES={number:"number",decimal:"decimal",money:"money",integer:"integer",date:"date",time:"time","date-time":'"date-time',string:"string",enum:"enum",lookup:"lookup",boolean:"boolean"}}(Phoenix||(Phoenix={})),function(e){var d=Phoenix||(Phoenix={}),c=d.link,a=d.utils;c.registerCustomProtocol("page",function(e,t,n,i){t.$url||(t.$url=c.search(!0)),t.$mem||(t.$mem=d.$mem);var o=e.indexOf("://");if(!(o<=0)){var r,s=e.substring(o+3),a=c.parseUrl(s),l=a.path.split("/");a.search.$replace&&(r=!0,delete a.search.$replace);var u={$page:l[0],$search:[],$replace:r,$menu:null};1<l.length&&(u.$menu=l[1]),Object.keys(a.search).forEach(function(e){u.$search.push({left:e,right:a.search[e]})}),c.execLink(u,t,null)}}),c.registerCustomProtocol("link",function(e,t,n,i){var o=e.substring("link://".length),r=o.indexOf("/");if(r<=0&&(r=o.indexOf("?")),0<r){var s=c.parseUrl(o.substring(r));o=o.substring(0,r),s.search&&(i?a.extend(i,s.search):i=s.search)}n.links&&n.links[o]&&c.execLink(n.links[o],t,i)}),c.registerCustomProtocol("click",null)}(),function(e){var t,n=e,o=n.application,r=n.ajax,s=n.ulocale;t={get:function(e,t,n){t&&s.lang&&(e=e+"_"+s.lang);var i=o.config(n);if(!i)throw"Application configuration not found.";return r.get(i.current.menus+"/"+e+".json",{cache:!0},null)}},(e.data||(e.data={})).menu=t}(Phoenix||(Phoenix={})),function(e){var t,n=e,o=n.ulocale,r=(n.utils,n.ajax),s=n.application;t={get:function(t,e,n){e&&o.lang&&(t=t+"_"+o.lang);var i=s.config(n);if(!i)throw"Application configuration not found.";return r.get(i.current.locales+"/"+t+".json",{cache:!0},function(e){return e&&(e.$name=t),e.$view&&(e.$view.$name=t),e})}},(e.data||(e.data={})).schema=t}(Phoenix||(Phoenix={})),function(f){var e,m,r,t=f,v=t.ajax,g=t.utils,y=f.dom,_=t.link,b=t.application;e=f.data||(f.data={}),m=function(e,t){if(y.getCookie(e))return t();window.setTimeout(m.bind(window,e,t),500)},r={get:function(i){return new g.Promise(function(t,e){var n={$url:i,$method:"GET"};r.getRessources(n,!1,function(e){t(e)})})},put:function(i,o){return new g.Promise(function(t,e){var n={$url:i,$method:"PUT",$data:o};r.getRessources(n,!1,function(e){t(e)})})},post:function(i,o){return new g.Promise(function(t,e){var n={$url:i,$data:o,$method:"POST"};r.getRessources(n,!1,function(e){t(e)})})},remove:function(e){var t={$url:e,$method:"DELETE"};return r.getRessources(t,!1,null)},getRessources:function(e,t,n){var i=n?function(e){return e=n(e)}:null,o=e.$url,r=!1,s=e.$download,a="";s&&(delete e.$download,e.$cookie&&(a=e.$cookie,delete e.$cookie,y.setCookie(a,"","/",null)));var l=$.extend(!0,{},b.config(b.name)||{});l.rest=(e.$type?l[e.$type]:null)||l.rest||{},l.sync=(e.$type?l[e.$type]:null)||l.sync||{},delete e.$type;var u=t?l.sync:l.rest,d=u.base||"";!o||"/"!==o.charAt(0)&&"."!==o.charAt(0)||(d=""),d?o=d+"/"+o:r=!0;var c=_.context({cookie:!0});void 0===e.$module&&u.$module&&(e.$module=u.$module),e.$module?c.$module=e.$module:o=o.replace("{$module}/",""),u.$context?c.$context=u.$context:o=o.replace("{$context}/",""),o=g.formatNames(o,c),u.headers&&u.headers.Authorization&&(u.headers.Authorization=g.formatNames(u.headers.Authorization,c));var p=v.getDefaultAjaxOptions(u),h=e.$query;e.$list;switch(o+=_.object2search(h),o=o,e.$method){case"POST":return i?e.$noWait?(i(null),f.ajax.logData(o,e.$data)):new g.Promise(function(t,n){v.post(o,e.$data,p).then(function(e){e=i(e),t(e)}).catch(function(e){n(e)})}):e.$noWait?f.ajax.logData(o,e.$data):v.post(o,e.$data,p);case"PUT":return e.$noWait?f.ajax.logData(o,e.$data):v.put(o,e.$data,p);case"PATCH":return e.$noWait?f.ajax.logData(o,e.$data):v.patch(o,e.$data,p);case"DELETE":return e.$noWait?f.ajax.logData(o,null):v.remove(o,p);default:return s?(r&&(o=v.addAuthToUrl(o)),y.downloadUriHandler(o),a?new g.Promise(function(e,t){m(a,e)}):g.Promise.resolve()):e.$noWait?(i&&i(null),f.ajax.logData(o,null)):v.get(o,p,function(e){return i?i(e):e})}}},e.rest=r}(Phoenix||(Phoenix={})),function(e){var t,n=e,r=n.application,s=n.ajax,a=n.link;t={getRessources:function(e,n){var t=r.config(r.name);if(!t)throw"Application configuration not found.";var i=t.localData+"/"+e.$url,o=e.$query;return i+=a.object2search(o),s.get(i,{},function(e){return t=e,n&&(t=n(t)),t;var t})}},(e.data||(e.data={})).local=t}(Phoenix||(Phoenix={})),function(s){var S,E,P,I,e=s,D=e.application,M=e.link,i=e.authentication,F=e.utils,L=e.ajax;S=s.data||(s.data={}),E={},P=function(e){return e},I={v4:!0,transport:{doPost:L.post,doPut:L.put,doDelete:L.remove,doGet:function(e,t,n,i){return L.get(e,t,n)},doPatch:L.patch},afterLogout:function(){E={}},addImageUrlToken:function(e){var t=D.config(D.name)||{};if(t.odata=t.odata||{},t&&t.odata&&t.odata.authentication){var n=i.load();if(n)switch(t.odata.authentication){case"header-session":e=e+"?token="+n.token}}return e},baseUrl:function(e){var t=D.config(D.name)||{};t.odata=t.odata||{};var n=t.odata.base||"/data",i=M.context({cookie:!0});return void 0===(e=e||{}).$module&&t.odata.$module&&(e.$module=t.odata.$module),e.$module?i.$module=e.$module:n=n.replace("{$module}/",""),t.odata.$context?i.$context=t.odata.$context:n=n.replace("{$context}/",""),F.formatNames(n,i)},configOdata:function(e){var t=$.extend(!0,{},D.config(D.name)||{});t.odata=(e.$type?t[e.$type]:null)||t.odata||{};var n=t.odata.base||"/data",i=M.context({cookie:!0});return void 0===(e=e||{}).$module&&t.odata.$module&&(e.$module=t.odata.$module),e.$module?i.$module=e.$module:n=n.replace("{$module}/",""),t.odata.$context?i.$context=t.odata.$context:n=n.replace("{$context}/",""),t.odata.base=F.formatNames(n,i),t.odata.headers&&t.odata.headers.Authorization&&(t.odata.base=F.formatNames(t.odata.headers.Authorization,i)),t.odata},urlResEntity:function(e,t){var n=I.baseUrl(e);if(!e.$entity)throw"Invalid odata entity.";if(t&&!e.$entityId)throw"Invalid odata entity id.";var i=n+"/"+e.$entity;return e.$entityId&&(i=i+"("+e.$entityId+")"),e.$propertyName&&(i=i+"/"+e.$propertyName),i},doDelete:function(e,t){var n=I.urlResEntity(e,!0),i=L.getDefaultAjaxOptions(I.configOdata(e));return t&&(i.headers["If-Match"]=t),i.ignore={410:!0},n=P(n),I.transport.doDelete(n,i)},doPost:function(e,t){var n=L.getDefaultAjaxOptions(I.configOdata(e)),i=I.urlResEntity(e,!1);return i=P(i),I.transport.doPost(i,t,n)},doPut:function(e,t,n,i){var o=I.urlResEntity(e,!0),r=L.getDefaultAjaxOptions(I.configOdata(e));return r.headers=r.headers||{},n&&(r.headers["If-Match"]=n),i&&(r.headers.Prefer="return=representation"),o=P(o),I.transport.doPut(o,t,r)},doPatch:function(e,t,n,i){var o=I.urlResEntity(e,!0),r=L.getDefaultAjaxOptions(I.configOdata(e));return r.headers=r.headers||{},s.application.useJSONPatch&&(r.headers["Content-Type"]="application/json-patch+json"),n&&(r.headers["If-Match"]=n),i&&(r.headers.Prefer="return=representation"),o=P(o),I.transport.doPatch(o,t,r)},applyFilters:function(e,t,o,n,i,r,s){var a=[],l=e.length;if((t=(t||"")+"")&&o&&o.length){var u=o.length,d=t.toLowerCase();e.forEach(function(e){for(var t=!1,n=0;n<u;n++){var i=o[n].replace(/\//g,".");if(0<=((F.getValue(e,i)||"")+"").toLowerCase().indexOf(d)){t=!0;break}}t&&a.push(e)}),l=a.length}else a=e;n=n||0;var c=i||a.length;if(r){var p=r.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 2===t.length?{field:t[0],asc:"asc"===t[1]}:{field:e,asc:!0}});a.sort(function(e,t){for(var n=0;n<p.length;n++){var i=p[n],o=e[i.field],r=t[i.field];if(o!==r){var s=r<o?1:-1;return i.asc||(s*=-1),s}}return 0})}var h=a.slice(n,n+c);return{documents:h,count:l,dataCount:h.length,skip:n,pageSize:i,nodata:0===h.length,search:t,orderBy:r}},getRessources:function(e,t,n,s){var o=function(e){return t&&(e=t(e)),e},i=e.$relation,r=e.$value;i&&delete e.$relation,r&&delete e.$value;var a=!1,l=e.$cache;delete e.$cache;var u=$.extend(!0,{},D.config(D.name)||{});u.odata=(e.$type?u[e.$type]:null)||u.odata||{};var d="find"===e.$type;delete e.$type;var c=null==u.odata.v4||u.odata.v4,p=u.odata&&u.odata.base||"/data",h=M.context({cookie:!0});void 0===e.$module&&u.odata.$module&&(e.$module=u.odata.$module),e.$module?h.$module=e.$module:p=p.replace("{$module}/",""),u.odata.$context?h.$context=u.odata.$context:p=p.replace("{$context}/",""),p=F.formatNames(p,h),u.odata.headers&&u.odata.headers.Authorization&&(u.odata.headers.Authorization=F.formatNames(u.odata.headers.Authorization,h)),delete e.$module;var f=e.$entity;e.$entityId&&(f=f+"("+e.$entityId+")",delete e.$entityId,a=!0),e.$propertyName&&(f=f+"/"+e.$propertyName,delete e.$propertyName,a=!0);var m=f;delete e.$entity;var v,g="",y=!1,_=[],b=e.$skip||0,x=!1,C=e.$orderby;e.$searchByFieldsValue&&(g=e.$searchByFieldsValue,_=e.$searchByFieldsFields,y=e.$searchByFieldsFieldsFull,delete e.$searchByFieldsValue,delete e.$searchByFieldsFields,delete e.$searchByFieldsFieldsFull),a||(e.$top&&(v=parseInt(e.$top+"",10)),c?e.$top&&!e.nocount&&(d||(e.$count=!0)):e.$top&&!e.nocount&&(e.$inlinecount="allpages"),delete e.nocount,(u.odata.array||u.odata.nocount)&&(e.$count||e.$inlinecount)&&e.$top&&!e.$allData&&(x=!0,v++,e.$top=v,delete e.$count,delete e.$inlinecount));var k=e.$allData||i||r;k&&(delete e.$skip,delete e.$top,delete e.$allData,delete e.$orderby,e.$top=1e3),d&&e.$filter&&"object"==typeof e.$filter&&(e.$filter=JSON.stringify(e.$filter));var w=L.getDefaultAjaxOptions(u.odata);if(w.$errors=n,m=p+"/"+m+M.object2search(e),l&&E[f]&&E[f].uri===m)return new F.Promise(function(e,t){e(o(a?E[f].data:$.extend(!0,{},E[f].data)))});m=P(m);var O=S.odata.transport.doGet;return i?O=function(e,t,n,i){var o={value:[]};if(s&&s._$model){var r=i.params.relation;"."===r.charAt(0)?r=r.substring(2):"/"===r.charAt(0)&&(r=r.substring(1)),o.value=s._$model.getValue(r).model(!1)||[]}return n&&(o=n(o)),F.Promise.resolve(o)}:r&&(O=function(e,t,n,i){var o={value:r};return n&&(o=n(o)),F.Promise.resolve(o)}),O(m,w,function(e){var t,n={};if(c&&e&&delete e["@odata.context"],a)n=e;else{if(n.documents=u.odata.array?e:c?e.value:e.d.results,k&&(n._origData=[]),n.documents.forEach(function(e){delete e.__metadata,k&&n._origData.push($.extend(!0,{},e))}),(u.odata.array||u.odata.nocount)&&(n._noPagesCount=!0,n._hasNext=!1,n._hasPrev=!!b),k){var i=I.applyFilters(n.documents,g,_,b,v,C,y);n.documents=i.documents,n.count=i.count}else u.odata.array||u.odata.nocount?x&&(n.documents.length===v&&(n._hasNext=!0,n.documents.pop()),v--):n.count=d?e.count:c?e["@odata.count"]:e.d.__count;n.dataCount=n.documents.length,n.pageSize=v,n.skip=b,n.nodata=0==n.dataCount,n.uri=(0!==(t=m).indexOf("http")&&(t=window.location.origin+t),t),n.search=g,n.orderBy=C}return l&&(E[f]={uri:m,data:$.extend(!0,{},n)}),o(n)},{entity:f,params:e})}},S.odata=I,i.registerAfterLogout(I.afterLogout)}(Phoenix||(Phoenix={})),function(c){var D=c,M=D.link,F=D.utils,L=D.data,T=D.history,p=D.customData,N=D.application;!function(e){var n,v=function(e,t){if(e.$transform){var n=p.get("datasets.transform."+e.$transform);n&&(t=n(t))}return t},g=function(e,t,n){if(!e)return t;var i=p.get("datasets.transform."+e);return i?i($.extend(!0,{},t),n):t},y=(n={},{register:function(e,t){n[e]=t},get:function(e){return n[e]}}),C=function(e,t,n,i){if(null==e&&t)switch(t){case"number":case"integer":case"boolean":e=void 0;break;case"string":e="";break;default:e=null}if(Array.isArray(e))return i?e:JSON.stringify(e);if(n&&t){if("string"===t||"date"===t||"date-time"===t){if(null==e)return null;"date"===t||"date-time"===t||(e="'"+e.replace(/'/g,"''")+"'")}}else t&&!n&&null!=e&&"number"===t&&"string"==typeof e&&(e=parseFloat(e));return e},_=function(e,t){var n=t.indexOf("[");if(n<0)return null;if(!(e=0===n?e:e[t.substr(0,n)]))return null;var i=t.substr(n+1,t.length-n-2);if("*"==i||""==i)return e;var o=parseInt(i,10);return o<e.length?e[o]:null},k=function(e,t,n,i,o){var r,s=e,a=["$url","$context","$data","$item","$mem","$local"],l=typeof s;if("object"===l&&s){if(r=e.type,s=e.value,"literal"===r)return o?e:s;l=typeof s}var u=!1;if("string"===l&&s&&"["===s.charAt(0)&&"]"===s.charAt(s.length-1)&&(u=!0,s=s.substr(1,s.length-2)),"string"===l&&s&&"$"===s.charAt(0)){for(var d=s.split("."),c=0,p=null;c<d.length;){var h=d[c];if(0==c){var f,m=h,v=h.indexOf("[");0<v&&(f=h.substr(v),m=h.substr(0,v));var g=a.indexOf(m);if(!(0<=g))return r||(r=typeof s),C(s,r,n,i);p=t[a[g]],f&&d.splice(c+1,0,f)}else{if(!p)break;p="]"==h.charAt(h.length-1)?_(p,h):Array.isArray(p)?p.map(function(e){return e[h]}):p[h]}c++}return u?(r||(r=typeof p),[C(p,r,n,i)]):(r||(r=typeof p),C(p,r,n,i))}return r||(r=typeof s),C(s,r,n,i)},u=function(e,t,n){for(var i=n.length;i--;)if(e[n[i]]!=t[n[i]])return!1;return!0},b=function(t,n){if(!t)return null;if("string"==typeof t)return k(t,n,!1,!0,!1);var i={};return Object.keys(t).forEach(function(e){"$data.documents"===t[e]?n.$data&&n.$data.documents&&(i[e]=n.$data.documents,void 0===i.pageSize&&(i.pageSize=n.$data.pageSize),void 0===i.skip&&(i.skip=n.$data.skip),void 0===i.count&&(i.count=n.$data.count),void 0===i.uri&&(i.uri=n.$data.uri)):i[e]=k(t[e],n,!1,!0,!1)}),i},h=function(e){return"and"!==e&&"or"!==e&&"$func"!==e&&("("!==e&&")"!==e&&"not"!==e)},f=function(o,r,s,a,e,l){if(o&&"object"==typeof o&&o.$op){var t={$op:o.$op,$nulls:o.$nulls,$left:null,$right:null};if("$func"===o.$op&&o.$arguments){var u=!1;if(o.$arguments.forEach(function(e,t){var n=!0;"object"==typeof e&&(n="literal"!==e.type);var i=k(e,{$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},!0,!1,l);o.$arguments[t]=i,!n||"''"!==i&&null!=i||(u=!0)}),u)return t.$right=null,t.$left=null,t;o.$right=o.$arguments.join(", ")}else if("in"===o.$op&&o.$children){var n=e&&h(o.$op);if(Array.isArray(o.$children)||(o.$children=(c=o.$children,p={$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},k(c,p,n,!0,!1))),o.$children.length){var i=o.$children.map(function(e){return k(e,{$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},n,!1,l)});t.$right="("+i.join(",")+")",t.$left=o.$left,t.nativeIn=!0}return t}if(null!=o.$left&&("object"!=typeof o.$left||!o.$left.$op&&null!==o.$left.$op?t.$left=k(o.$left,{$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},!1,!1,l):t.$left=f(o.$left,r,s,a,e,l)),null!=o.$right)if("object"!=typeof o.$right||!o.$right.$op&&null!==o.$right.$op){var d=e&&h(o.$op);t.$right=k(o.$right,{$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},d,!1,l)}else t.$right=f(o.$right,r,s,a,e,l);return t}if(o&&"object"==typeof o&&null===o.$op&&null===o.$right&&o.$left){t={$left:null,$op:null,$right:null};return null!=o.$left&&("object"==typeof o.$left&&o.$left.$op?t.$left=f(o.$left,r,s,a,e,l):t.$left=k(o.$left,{$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},!1,!1,l)),t}var c,p;d=e&&h(o.$op);return k(o,{$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},d,!1,l)},d=function(e){if(e&&"object"==typeof e&&e.$op){var t=d(e.$left),n=d(e.$right);if("ignore"===e.$nulls&&null==n.value)return"not"===e.op?{value:null,op:null}:{value:t.value,op:t.op};if("not"===e.$op)return{value:"not ("+n.value+")",op:e.$op};if("in"!==e.$op||e.nativeIn){if("$func"===e.$op)return{value:t.value+"("+n.value+")",op:e.$op};if("ignore"!==e.$nulls||null!=t.value&&null!=n.value){var i=t.value,o=n.value;if("and"===e.$op||"or"===e.$op){if(!i&&!o)return{value:null,op:null};if(!i)return{value:o,op:e.$op};if(!o)return{value:i,op:e.$op}}if("and"===e.$op)"or"===t.op&&(i="("+i+")"),"or"===n.op&&(o="("+o+")");else if(o&&"ignore"===e.$nulls&&"''"===o)return{value:null,op:null};return{value:i+" "+e.$op+" "+o,op:e.$op}}return"and"===e.$op||"or"===e.$op?null==n.value?{value:t.value,op:t.op}:{value:n.value,op:n.op}:{value:null,op:null}}var r=(n.value||"").split(";"),s=[];return r.forEach(function(e){s.push(t.value+" eq "+e)}),{value:"("+s.join(" or ")+")",op:"in"}}return e&&"object"==typeof e&&null===e.$op&&null===e.$right&&e.$left?{value:d(e.$left).value,op:null}:{value:e,op:null}},w=function(e,t,n,i){var o,r,s,a,l=(r=t,s=n,a=i,(o=e)&&"string"==typeof o?o=k(o,{$url:r,$context:s,$data:null,$mem:D.$mem,$local:a},!1,!1,!1):f(o,r,s,a,!0,!1));return d(l).value},x=function(e,t,n,i,o){var r,s,a={$url:null,$list:null,$query:null,$method:"GET"};if(a.$method=(e.$method||"GET").toUpperCase(),a.$data=e.$data?$.extend(!0,{},e.$data):null,e.$type&&(a.$type=e.$type),o){if(!e.$entity)throw"Invalid sync dataset - $params.$entity";if(a.$transactionId=e.$transactionId||"id",!a.$transactionId)throw"Invalid sync dataset -$params.$transactionId";if(a.$viewId=e.$viewId||"viewId",!a.$viewId)throw"Invalid sync dataset -$params.$viewId";a.$replaceSearch=e.$replaceSearch,o&&(a.$persistent=e.$persistent),"PATCH"===e.$method?(r=T.useServerState?t[a.$transactionId]:T.getState(a.$transactionId),s=e.viewId,delete e.viewId):(r=n.$transactionId?n.$transactionId:t[a.$transactionId],n&&n.parentModel?(s=n.parentModel.id)||(a.$data={type:"literal",value:n.parentModel.pageParams||{}}):e.$modal?e.$viewIdName&&(s=c.$mem[e.$viewIdName]):s=t[a.$viewId]),r&&s||s&&"PATCH"===e.$method&&e.$noWait?a.$method="PATCH"===e.$method?"PATCH":"GET":a.$method="POST","POST"!==a.$method&&(a.$data=null)}e.$noWait&&(a.$noWait=!0),a.$url=e.$url||"",a.$url=F.execAngularExpression(a.$url,{$url:t,$context:n,$data:null,$mem:D.$mem,$local:i});var l=e.$query?$.extend(!0,{},e.$query):null;if(o){var u=a.$url?a.$url.split("/"):[];u.push(e.$entity),s&&(u.push(s),s&&r&&!e.$noWait&&((l=l||{}).id=r)),a.$url=u.join("/")}return e.$download&&(a.$download=e.$download),e.$cookie&&(a.$cookie=e.$cookie),a.$list=e.$list,l&&(a.$query={},Object.keys(l).forEach(function(e){"$filter"===e&&l.$filter?(a.$query.$filter=w(l.$filter,t,n,i),a.$query.$filter||delete a.$query.$filter):a.$query[e]=k(l[e],{$url:t,$context:n,$data:null,$mem:D.$mem,$local:i},!1,!1,!1)})),"GET"!==e.$method&&"DELETE"!==e.$method&&(a.$data?a.$data=o?function(t,n,i,o){if("object"!=typeof t)return null;if(Array.isArray(t))return t;var r={};return"literal"===t.type?t.value:(Object.keys(t).forEach(function(e){r[e]=k(t[e],n,i,o,!1)}),r)}(a.$data,{$url:t,$context:n,$data:null,$mem:D.$mem,$local:i},!1,!0):k(a.$data,{$url:t,$context:n,$data:null,$mem:D.$mem,$local:i},!1,!1,!1):a.$data=n||{}),a},O=function(e){return null==e||""===e||"''"===e},S=function(e,t,n,i){var o,r=i&&i.getLocalContext?i.getLocalContext():null,s=e.$data;if(e.$params&&e.$params.dataProvider){var a=p.get(e.$params.dataProvider);a&&(n=a(n,i))}if(s&&s.$factory){var l=p.get(s.$factory);return l?l(n,i):F.Promise.resolve(null)}return o=!e.$main&&e.$output?(s=e.$data,b(e.$output,{$url:t,$context:n,$data:s,$mem:D.$mem,$local:r})):s,o=v(e,o),F.Promise.resolve(o)},E=function(n,i,o,e){var r=n.$method||"GET",s=e&&e.getLocalContext?e.getLocalContext():null,t=function(r,e,t,n,i){if(!r)return null;var s={},a={$url:e,$context:t,$data:null,$mem:D.$mem,$local:n},o=r.$filter?$.extend(!0,{},r.$filter):null;if(r.$searchByFields&&r.$searchByFields.value&&r.$searchByFields.fields&&r.$searchByFields.fields.length){var l=null,u=N.config(N.name)||{},d=(r.$type?u[r.$type]:null)||u.odata||{},c=d.caseSensitive||!1,p=r.$searchByFields.value,h=r.$searchByFields.fullSearch&&p?p.split(" "):[p];h=h.filter(function(e){return e.trim()});var f=[];i?(h.forEach(function(n,e){r.$searchByFields.fields.forEach(function(e){var t={};t[e]={$regex:n},f.push(t)})}),f&&f.length&&(l={$or:f})):(h.forEach(function(o,e){r.$searchByFields.fields.forEach(function(e){var t=e.replace(/\./g,"/"),n="'"+o.replace(/'/g,"''")+"'";c&&(t="tolower("+t+")",n="tolower("+n+")");var i={$left:d.contains||"contains",$op:"$func",$right:t+", "+n};l=l?{$left:l,$op:"or",$right:i}:i}),f.push(l),l=null}),f.length&&f.forEach(function(e){l=l?{$left:l,$op:"and",$right:e}:e})),r.$searchByFieldsValue=r.$searchByFields.value,r.$searchByFieldsFields=r.$searchByFields.fields,r.$searchByFieldsFull=r.$searchByFields.fullSearch,!r.$allData&&l&&(o=i?(o&&(l={$and:[l,o]}),l):o?{$left:o,$op:"and",$right:l}:l)}if(Object.keys(r).forEach(function(e){if("$search"!==e&&"$searchByFields"!==e)if("$entity"===e)s.$entity=k(r.$entity,a,!1,!1,!1);else if("$entityId"===e){var n=!1;if("object"==typeof r.$entityId)if(r.$entityId.value&&r.$entityId.type){var t=k(r.$entityId,a,!0,!1,!1);n=O(t),s[e]=t}else{var i=[];Object.keys(r.$entityId).forEach(function(e){var t=k(r.$entityId[e],a,!0,!1,!1);n||(n=O(t)),i.push(e+"="+t)}),s[e]=i.join(", ")}else{var o=k(r[e],a,!0,!1,!1);n=O(o),s[e]=o}n&&(s.$entityIdNull=!0)}else if("aggregate"==e&&r.aggregate)s.aggregate=r.aggregate;else if("groupby"==e&&r.groupby)s.groupby=r.groupby;else if("having"==e&&r.having)s.having=r.having;else{if("$filter"==e&&r.$filter)return;"$searchByFieldsFields"==e?s[e]=r[e]:r[e]&&(s[e]=k(r[e],a,!1,!1,!1))}}),o&&(s.$filter=i?o:w(o,e,t,n),s.$filter||delete s.$filter),r.$search&&t&&t.$searchText){var m=void 0,v=Array.isArray(r.$search)?r.$search:[r.$search];if(i){if(m={},1===v.length)m[r.$search.field]={$regex:t.$searchText};else{var g=v.length;m.$or=[];for(var y=0;y<g;y++){var _={};_[v[y].field]={$regex:t.$searchText},m.$or.push(_)}}s.$filter?s.$filter.$and?s.$filter.$and.push(m):s.$filter={$and:[s.$filter,m]}:s.$filter=m}else{var b=C(t.$searchText,"string",!0,!1);if(1===v.length)m=F.format("contains({0},{1})",r.$search.field,b);else{var x=["("];for(g=v.length,y=0;y<g;y++)x.push(F.format("contains({0},{1})",v[y].field,b)),y<g-1&&x.push(" or ");x.push(")"),m=x.join("")}s.$filter?s.$filter=s.$filter+" and "+m:s.$filter=m}}return s}(g(n.$beforeExecute,n.$params,o),i,o,s,"find"===n.$type);if(r&&(r=(r=k(r,o,!1,!1,!1)).toUpperCase()),t.$entityIdNull&&(delete t.$entityIdNull,"GET"===r&&n.$create)){var a=$.extend(!0,{},n.$create);return a.$create=!0,F.Promise.resolve(a)}if(r)switch(r){case"DELETE":return L.odata.doDelete(t,o.etag?o.etag:null);case"POST":return L.odata.doPost(t,o);case"PUT":var l=o["@odata.etag"];delete o["@odata.etag"];var u=null!=o["@odata.return"];return delete o["@odata.return"],L.odata.doPut(t,o,l,u);case"PATCH":var d=o["@odata.etag"];delete o["@odata.etag"];var c=null!=o["@odata.return"];return delete o["@odata.return"],L.odata.doPatch(t,o,d,c)}var p,h,f=(p=n.$data,h=s,b(p,{$url:i,$context:o,$data:null,$mem:D.$mem,$local:h})),m=N.config(N.name)||{};return void 0===n.$cache&&(m.odata&&void 0!==m.odata.cache?m.odata.cache=m.odata.cache:(m.odata=m.odata||{},m.odata.cache=!0)),o&&(o.hasOwnProperty("$skip")&&o.$skip&&(t.$skip=o.$skip),o.hasOwnProperty("$top")&&o.$top&&(t.$top=o.$top)),"relation"===n.$type&&(t.$relation=!0),n.$value&&(t.$value=n.$value),L.odata.getRessources(t,function(e){"POST"!==r&&e&&(e.$create=!1),e&&e.documents&&e.documents.length||!f||(e.documents=e.documents||[],e.documents.push(f)),o&&o.hasOwnProperty("$searchText")&&(e.searchText=o.$searchText);var t=e;return!n.$main&&n.$output&&(t=b(n.$output,{$url:i,$context:o,$data:e,$mem:D.$mem,$local:s})),t=v(n,t)},n.$errors,o)},P=function(n,i,o,e){var r=e&&e.getLocalContext?e.getLocalContext():null,t=x(n.$params,i,o,r,!1);return L.local.getRessources(t,function(e){var t=e;return!n.$main&&n.$output&&(t=b(n.$output,{$url:i,$context:o,$data:e,$mem:D.$mem,$local:r})),v(n,t)})},I=function(n,i,o,e){var r=e&&e.getLocalContext?e.getLocalContext():null,t=(g(n.$beforeExecute,n.$params,o),x(n.$params,i,o,r,!1));return n.$method&&(t.$method=n.$method),L.rest.getRessources(t,!1,function(e){var t=e;return n.$output&&(t=b(n.$output,{$url:i,$context:o,$data:e,$mem:D.$mem,$local:r})),v(n,t)})};e.execData=function(e,t,n){var o,r,s,i,a,l,u,d,c,p=M.search(!0);if(!e)return null;if(e.$condition){var h=M.context();h.$context=t;var f=k(e.$condition,h,!1,!0,!1);if(!f||"false"===f)return F.Promise.resolve(null)}switch(e.$type){case"basic":return S(e,p,t,n);case"odata":case"find":return"find"===e.$type&&(e.$params=e.$params||{},e.$params.$type=e.$params.$type||"find"),E(e,p,t,n);case"relation":return t._$model?E(e,p,t,n):null;case"enum":return e.$value?E(e,p,t,n):null;case"sync":return o=e,r=p,s=t,a=(i=n)&&i.getLocalContext?i.getLocalContext():null,l=g(o.$beforeExecute,o.$params,s),u=x(l,r,s,a,!0),d=u.$method,c=function(e){var t=e;if(t){if("GET"===d&&(t.$transactionId=s.$transactionId?s.$transactionId:u.$query[u.$transactionId],s.parentModel||(t.$viewName=o.$params.$entity),t.$create=!1),"POST"===d)if((t=t.data).$create=!1,t.$transactionId=e.id,s.parentModel)e.patches&&e.patches.length&&s.parentModel.model.applyJsonPachDelta(e.patches);else if(t.$viewName=o.$params.$entity,l.$modal);else{var n={};if(T.useServerState||u.$persistent){if(T.setState(u.$transactionId,e.id),T.setState(u.$viewId,t.id),n[u.$transactionId]=e.id,n[u.$viewId]=t.id,u.$replaceSearch&&(Array.isArray(u.$replaceSearch)||(u.$replaceSearch=["$inline"]),Array.isArray(u.$replaceSearch))){var i=M.context().$url;u.$replaceSearch.forEach(function(e){void 0!==i[e]&&(n[e]=i[e])})}u.$replaceSearch=u.$replaceSearch||{},u.$persistent=1,M.changeSearch(n,u.$replaceSearch,!0,u.$persistent)}else T.setState(u.$transactionId,e.id),T.setState(u.$viewId,t.id),M.changeSearch(n,null,!0)}return o.$output&&(t=b(o.$output,{$url:r,$context:s,$data:e,$mem:D.$mem,$local:a})),v(o,t)}},"DELETE"!==d&&"PUT"!==d||(c=null),L.rest.getRessources(u,!0,c);case"rest":return I(e,p,t,n);case"local":return P(e,p,t,n);default:var m=y.get(e.$type);if(m)return m(e,p,t,n)}return null};var t=function(){function e(e){var t,n,i,o=this;o.config=((t=(t=e)||{}).$type=t.$type||"basic",t.$triggers=t.$triggers||["$load"],t),e.$default&&(o.defaultDataset=!0),o.config.$autoselect&&(o.autoselect=!0),o._emitters=(n=o.config,i=[],n.$emit&&(n.$emit.$loaded||n.$emit.$changed?(n.$emit.$loaded&&i.push(n.$emit.$loaded.$name),n.$emit.$changed&&i.push(n.$emit.$changed.$name)):i.push(n.$emit)),i),o.selectedIndex=-1}return e.prototype.execute=function(e,t){var n,i,o,r,s=this,a=M.search(!0);switch(s.config.$type){case"basic":return S(s.config,a,e,t);case"odata":case"find":return"find"===s.config.$type&&(s.config.$params=s.config.$params||{},s.config.$params.$type=s.config.$params.$type||"find"),E(s.config,a,e,t);case"rest":return I(s.config,a,e,t);case"local":return P(s.config,a,e,t);case"menu":return o=s.config,r=o.$params.name,L.menu.get(r,o.$params.localization,void 0);case"widget-schema":return n=s.config,i=n.$params.name,L.schema.get(i,n.$params.localization,void 0);default:var l=y.get(s.config.$type);if(l)return l(s.config,a,e,t)}throw"Invalid dataset type"},e.prototype.enumTriggers=function(t,n){this.config.$triggers&&this.config.$triggers.forEach(function(e){(t||"$load"!=e)&&n(e)})},e.prototype.enumEmitters=function(e){this._emitters.forEach(e)},e.prototype.hasCustomEvents=function(){if(this.config.$triggers){var e=this.config.$triggers;return 1<e.length||"$load"!=e[0]}return!1},e.prototype.canExecute=function(e,t){if(this.config.$condition){var n=k(this.config.$condition,t,!1,!0,!1);if(!n||"false"===n)return!1}return 0<=this.config.$triggers.indexOf(e)},e.prototype.data2Output=function(e,t){return b(e,t)},e.prototype.destroy=function(){F.log("Destroy Dataset","destroy")},e.prototype._findSelectedOData=function(e){if(e.documents){var t=-1,n=null;if(this.config.$autoselect&&"object"==typeof this.config.$autoselect)for(var i={$url:M.search(!0),$mem:D.$mem},o=b(this.config.$autoselect,i),r=Object.keys(o),s=0,a=e.documents.length;s<a;s++){var l=e.documents[s];if(u(l,o,r)){n=l,t=s;break}}return n?{item:n,index:t}:e.documents.length?{item:e.documents[0],index:0}:{item:null,index:-1}}return{item:null,index:-1}},e.prototype._findSelected=function(e){switch(this.config.$type){case"odata":case"find":case"rest":return this._findSelectedOData(e);default:return{item:e,index:0}}},e.prototype.doAutoSelect=function(e,t){if(this.selectedIndex=-1,this.config.$autoselect){if(!e||e.nodata)return t(null);var n=this._findSelected(e);this.selectedIndex=n.index,t(n.item)}},e}();e.DataSet=t,e.getUrlBaseByType=function(e,t,n){var i=N.config(N.name)||{},o=i?i[e]:null,r="";if(o&&o.base&&(r=o.base),r&&0<=r.indexOf("{")){var s=M.context({cookie:!0});o.$module&&(s.$module=o.$module),r=F.formatNames(r,s)}if((t=t&&0!==r.toLowerCase().indexOf("http"))&&(r=r&&":"===r.charAt(0)?location.protocol+"//"+location.hostname+r:location.protocol+"//"+location.host+r),n=n&&0===r.toLowerCase().indexOf("http")){var a="http://";0===r.toLowerCase().indexOf("https")&&(a="https://");var l=(r=r.substr(a.length)).split("/");l[0]="",r=l.join("/")}return r},e.replaceFilterVars=function(e,t){var n=M.context();return e&&"string"==typeof e?k(e,{$url:n.$url,$context:t,$data:null,$mem:D.$mem,$local:null},!1,!1,!0):f(e,n.$url,t,null,!1,!0)},e.registerDataProvider=y.register,e.compileFilterTree=function(e,t,n,i){return f(e,t,n,i,!1,!1)},e.acceptFilter=function(e,t){return"eq"===e.$op&&t[e.$left]==e.$right},e.extractValue=function(e){e=e||"";var t=M.context();return k(e,t,!1,!1,!1)},e.execOutputData=function(e,t){if(e.$output){var n=M.context();n.$data=t[e.name],(n.$context=t)[e.name]=b(e.$output,n)}},e.test={output:b,parseTree:w}}(c.data||(c.data={}))}(Phoenix||(Phoenix={})),function(n){var e,t,s,i,f,o;e=n.ui||(n.ui={}),s=(t=n).dom,i=t.utils,t.locale,f=function(e,t,n,i,o){return{number:e,text:t,icon:n,active:i,disabled:o}},o=function(){function e(e){var t=this;t._options=$.extend({boundaryLinks:!1,directionLinks:!0,rotate:!0,maxSize:4,size:"lg"},e||{}),t.pages=[],t._updating=!1,t.visible=!1,t.props={},t.data={currentPage:-1,totalPages:0,hasNext:!1,hasPrev:!1},t._defineProps()}return Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),e.prototype._defineProps=function(){var e=i.defineProperty;e("currentPage",this),e("totalPages",this),e("hasPrev",this),e("hasNext",this)},e.prototype._notifyChange=function(e){var t=this;switch(e){case"currentPage":if(t._options.noPagesCount)return;t._changed=!0,t._updatePages();break;case"totalPages":if(t._options.noPagesCount)return;t._changed=!0,0<=t.data.currentPage&&t._updatePages();break;case"hasNext":case"hasPrev":if(!t._options.noPagesCount)return;t._changed=!0,t._updatePages()}},e.prototype._renderPager=function(){var e=this.$element.get(0);if(n.bootstrap4&&(e=e.lastChild),this.visible){var i=document.createDocumentFragment(),o=$(n.bootstrap4?'<li class="page-item"><a class="page-link bs-button" href></a><li>':"<li><a href></a><li>").get(0),r=document.createElement("span");this.pages.forEach(function(e){var t=o.cloneNode(!0);if(e.icon){var n=r.cloneNode(!0);s.attr(n,"class",s.iconClass(e.icon)),s.attr(n,"page",e.number),s.append(t.firstChild,n)}e.text&&s.text(t.firstChild,e.text),s.attr(t,"page",e.number),s.attr(t.firstChild,"page",e.number),e.disabled&&s.addClass(t,"disabled"),e.active&&s.addClass(t,"active"),i.appendChild(t)}),$(e).empty(),e.appendChild(i),s.removeClass(e,"bs-none")}else s.addClass(e,"bs-none")},e.prototype._updatePages=function(){var e=this;if(!e._updating){if(e.pages=function(e,t,n,i,o){var r=[];if(n.noPagesCount)return s=f("prev",null,"chevron-left",!1,!o),r.unshift(s),s=f("next",null,"chevron-right",!1,!i),r.push(s),r;var s,a=1,l=t,u=n.maxSize&&n.maxSize<t;u&&(n.rotate?t<(l=(a=Math.max(e-Math.floor(n.maxSize/2),1))+n.maxSize-1)&&(a=(l=t)-n.maxSize+1):(a=(Math.ceil(e/n.maxSize)-1)*n.maxSize+1,l=Math.min(a+n.maxSize-1,t)));for(var d=a;d<=l;d++){var c=f(d,d,null,d===e,!1);r.push(c)}if(u&&!n.rotate){if(1<a){var p=f(a-1,"...",null,!1,!1);r.unshift(p)}if(l<t){var h=f(l+1,"...",null,!1,!1);r.push(h)}}return n.directionLinks&&(s=f("prev",null,"chevron-left",!1,1==e),r.unshift(s)),n.boundaryLinks&&(s=f("first",null,"backward",!1,1==e),r.unshift(s)),n.directionLinks&&(s=f("next",null,"chevron-right",!1,e==t),r.push(s)),n.boundaryLinks&&(s=f("last",null,"forward",!1,e==t),r.push(s)),r}(e.data.currentPage,e.data.totalPages,e._options,e.data.hasNext,e.data.hasPrev),e._options.noPagesCount)e.visible=e.data.hasNext||e.data.hasPrev;else{e.visible=0<e.data.currentPage&&1<e.data.totalPages;var t=5;e._options.boundaryLinks||(t-=2),e._options.directionLinks||(t-=2),e.visible=e.pages.length>t}e.$element&&e._renderPager()}},e.prototype._setEvents=function(){var o=this;o.$element&&o.$element.on("click",function(e){var t=e.target,n=s.attr(t,"page");if(n){if(e.preventDefault(),e.stopPropagation(),s.hasClass(t,"disabled")||s.hasClass(t.parentNode,"disabled"))return;if(o._options.selectPage){var i=parseInt(n,10);o._options.selectPage(isNaN(i)?n:i)}}})},e.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},e.prototype.updating=function(e){var t=this;(t._updating=e)?t._changed=!1:t._changed&&(t._changed=!1,t._updatePages())},e.prototype.render=function(e){var t=this;t.$element||(t.$element=$((n.bootstrap4?'<nav><div class="bs-island"></div>':"")+'<ul class="no-y-margin d-inline-flex pagination'+("default"!=t._options.size?" pagination-"+t._options.size:"")+'"></ul>'+(n.bootstrap4?"</nav>":"")),t._renderPager(),t._setEvents()),e&&(t._options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null},e}(),e.Pager=o}(Phoenix||(Phoenix={})),function(e){var t,n,i,r,o,s,a,l,u,d,c,p,h;t=e.pagecontrol||(e.pagecontrol={}),i=(n=e).history,r=n.utils,o=n.external,s=n.dom,a=n.link,l=n.locale,u=n.application,d=['<div role="alert" class="bs-error alert alert-danger alert-dismissible fade show">','<button aria-label="{0}" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>',"<h4 >{1}</h4>","<p>{2}</p>","<p>",'<a class="bs-button btn btn-'+s.bootstrapStyles(!1).secondary+'" href="{4}" role="button">{3}</a>',"</p>","</div>"],c=['<div class="bs-loader"></div>'],p=null,h=function(){function e(){var e=this;e.children=[],e.data={$title:"",$menuleft:!1,$menutop:!1,$menuright:!1,$menubottom:!1,$hasBack:i.hasBack(),$user:{}},e.errors=[],e.props={},e.popup=null,e.contextMenu=null,e._defineProps(),e._setEvents(),o.historyChangedHandler=e._historyChanged.bind(e)}return e.prototype._defineProps=function(){var e=this,t=r.defineProperty;t("$title",e),t("$menuleft",e),t("$menutop",e),t("$menuright",e),t("$menubottom",e),t("$hasBack",e),t("$user",e)},e.prototype.currentPage=function(){var e=a.parseUrl(window.location.hash).path;return e&&"/"===e.charAt(0)&&(e=e.substr(1)),e},e.prototype.emittersFor=function(i){var o=[],r=i.length;return this.dataListeners&&this.dataListeners.forEach(function(e){if(!e.listener.disabled&&e.emit){for(var t=!1,n=0;n<r;n++)0<=e.emitters.indexOf(i[n])&&(t=!0);t&&o.push(e.listener)}}),o},e.prototype._historyChanged=function(){this.props.$hasBack=i.hasBack()},e.prototype._notifyChange=function(e){this._notifyChildren(e,this.data[e])},e.prototype._notifyChildOnAdd=function(t,e){var n=this;if(t){if("layout"===e){var i=n.childByType("header");if(i&&i.setPage){var o=t.data.name||"";i.setPage(o,t)}}t.onPageChange&&Object.keys(n.props).forEach(function(e){t.onPageChange(e,n.props[e])})}},e.prototype._notifyChildren=function(n,i){this.children.forEach(function(e){var t=e.child;t&&t.onPageChange&&t.onPageChange(n,i)})},e.prototype.registerDataListener=function(e,t){if(this.dataListeners=this.dataListeners||[],e.datasets){var n,i,o=(n=e.datasets,i={emit:!1,listen:!0,triggers:[],emitters:[]},Object.keys(n).forEach(function(e){if("view"!=e){var t=n[e];t.config.$emit&&t.enumEmitters(function(e){i.emit=!0,i.emitters.push(e)}),t.enumTriggers(!1,function(e){i.listen=!0,i.triggers.indexOf(e)<0&&i.triggers.push(e)})}}),i);(o.emit||o.listen)&&this.dataListeners.push({listener:e,parent:t,triggers:o.triggers,listen:o.listen,emitters:o.emitters,emit:o.emit})}},e.prototype.removeDataListener=function(e){if(this.dataListeners)for(var t=this.dataListeners.length;t--;){this.dataListeners[t].listener==e&&this.dataListeners.splice(t,1)}},e.prototype.removeParentDataListener=function(e){if(this.dataListeners)for(var t=this.dataListeners.length;t--;){this.dataListeners[t].parent==e&&this.dataListeners.splice(t,1)}},e.prototype.emitDataEvent=function(t,n,i){this.dataListeners&&this.dataListeners.forEach(function(e){i&&i.indexOf(e.listen)<0||e.listen&&0<=e.triggers.indexOf(t)&&e.listener&&e.listener.dataEvent&&(e.listener.ds_storeLastEvent&&e.listener.ds_storeLastEvent(t,n),e.listener.disabled||e.listener.dataEvent(t,n))})},e.prototype.childByType=function(e){for(var t=0,n=this.children.length;t<n;t++){var i=this.children[t];if(i.type===e)return i.child}return null},e.prototype.addChild=function(e,t){this.children.push({child:t,type:e}),this._notifyChildOnAdd(t,e)},e.prototype.removeChild=function(e){for(var t=this.children.length;t--;){if(this.children[t].child==e){this.children.splice(t,1);break}}},e.prototype.destroy=function(){var e=this;if(o.historyChangedHandler=null,e._hideErrors(!0),e._hideLoading(),e.children){for(var t=e.children.length;t--;){var n=e.children[t];e.removeDataListener(n.child)}e.children=null}e.dataListeners=null,e._removeEvents()},e.prototype._setEvents=function(){var r=this;$(document).on("mousedown touchstart",function(e){var t=e.target;s.inCover(t)||(r._inContextMenu(e)||r._closePopup(e),r._closeContextMenu(e))}),window.onerror=function(e,t,n,i,o){!o&&t&&(o={filename:t,lineno:n||0,colno:i||0}),r.$error||(r.lastError={message:e,stack:o?o.stack:null,stackError:o&&o.stack?null:o},r._showErrors())}},e.prototype._hideErrors=function(e){this.$error&&(this.$error.off("closed.bs.alert"),e&&this.$error.remove(),this.$error=null)},e.prototype._showErrors=function(){var e=this,t=s.find(null,"error_box");if(t&&!e.$error){var n=["mailto:"];n.push(u.support),n.push("?subject="+encodeURIComponent(u.title)),n.push("&body=");var i=a.context(),o=new Date;n.push(encodeURIComponent(l.errors.ErrorTitle+" ")),n.push(encodeURIComponent(e.lastError.message)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorUser+" ")),n.push(encodeURIComponent(i.$user.name)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorDate+" ")),n.push(encodeURIComponent(o.toLocaleString())),n.push(encodeURIComponent("\n\n"+l.errors.Browser+" ")),n.push(encodeURIComponent(navigator.userAgent)),n.push(encodeURIComponent("\n\n"+l.errors.ErrorURI+" ")),n.push(encodeURIComponent(window.location.href)),(e.lastError.stack||e.lastError.stackError)&&(n.push(encodeURIComponent("\n\n"+l.errors.Stack+"\n")),e.lastError.stack?n.push(encodeURIComponent(e.lastError.stack)):n.push(encodeURIComponent(JSON.stringify(e.lastError.stackError)))),n.push(encodeURIComponent("\n\n"+l.errors.Context+" ")),n.push(encodeURIComponent(JSON.stringify(i))),e.$error=$(r.format(d.join(""),l.ui.Close,l.errors.Title,e.lastError.message,l.errors.SendMail,n.join(""))),e.$error.on("closed.bs.alert",function(){e._hideErrors(!1)}),t.appendChild(e.$error.get(0))}},e.prototype._hideLoading=function(){this.$loading&&(this.$loading.remove(),this.$loading=null)},e.prototype._showLoading=function(){var e=document.body;e&&(this.$loading||(this.$loading=$(c.join("")),e.appendChild(this.$loading.get(0))))},e.prototype.loading=function(e){e?this._showLoading():this._hideLoading()},e.prototype._removeEvents=function(){$(document).off("mousedown touchstart")},e.prototype._closePopup=function(e){var t=this;!t.popup||t.popup.stayOnTop&&null!==e||(!e||t.popup.inPopup&&!t.popup.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(t.popup.hide&&t.popup.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),t.popup=null)},e.prototype._inContextMenu=function(e){return!!(this.contextMenu&&e&&this.contextMenu.inPopup&&this.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))},e.prototype._closeContextMenu=function(e){var t=this;t.contextMenu&&(!e||t.contextMenu.inPopup&&!t.contextMenu.inPopup(e.originalEvent?e.originalEvent.target:e.target))&&(t.contextMenu.hide&&t.contextMenu.hide(e?e.originalEvent?e.originalEvent.target:e.target:null),t.contextMenu=null)},e.prototype.setPopup=function(e){this._closePopup(null),this.popup=e},e.prototype.setContextMenu=function(e){this._closeContextMenu(null),this.contextMenu=e},e.prototype.activePage=function(){return{$module:u.name,$page:this.currentPage()}},e}(),t.PageControl=h,t.Page=function(){return p||(p=new h),p}}(Phoenix||(Phoenix={})),function(e){var t,o,a=e,l=a.utils,u=(a.ulocale,a.locale,a.ui,a.link),d=a.pagecontrol,c=a.dom;t=e.contextmenu||(e.contextmenu={}),o=function(){function e(e,t){this._data=e,this._parent=t}return e.prototype.destroy=function(){var e=this;if(e.$element){e.$element.off("click");var t=e.$element.get(0);c.remove(t),e.$element=null}e._parent=null,e._data=null},e.prototype.open=function(e){var t,n,i,o=this,r=[];t=r,n=o._data,(i=a.bootstrap4)?t.push('<div class="dropdown-menu bs-block bs-conntext-menu">'):t.push('<ul class="dropdown-menu bs-block bs-conntext-menu">'),n.forEach(function(e){e.id=e.id||l.allocID(),i?e.separator?t.push('<div class="dropdown-divider bs-cursor-d"></div>'):(t.push('<a class="dropdown-item'+(e.disabled?" disabled":" bs-cursor-p")+'" data-phoenix-href="click://'+e.id+'">'),t.push(l.escapeHtml(e.title)),t.push("</a>")):e.separator?t.push('<li role="separator" class="divider bs-cursor-d"></li>'):(t.push("<li"+(e.disabled?' class="disabled"':' class="bs-cursor-p"')+'><a data-phoenix-href="click://'+e.id+'">'),t.push(l.escapeHtml(e.title)),t.push("</a></li>"))}),i?t.push("</div>"):t.push("</ul>"),o.$element=$(r.join("")),o.$element.on("click",function(e){var t=u.isCustomLink(o.$element.get(0),e,!0);if(t&&"click"===t.protocol){var n=t.value.substring("click://".length),i=o._data.find(function(e){return e.id===n});i&&o._parent&&o._parent.contextMenu&&o._parent.contextMenu(i)}d.Page().setContextMenu(null)});var s=o.$element.get(0);s.style.left=e.pageX+"px",s.style.top=e.pageY+"px",c.append(document.body,o.$element.get(0))},e.prototype.hide=function(e){this.destroy()},e.prototype.inPopup=function(e){return this.$element&&c.isChildOf(this.$element.get(0),e)},e}(),t.openContextMenu=function(e,t,n){var i=new o(n,t);i.open(e),d.Page().setContextMenu(i)}}(Phoenix||(Phoenix={})),function(a){var e,l,t,n=a,u=n.utils,d=n.ulocale,o=n.locale,c=(n.ui,n.dom);e=a.modal||(a.modal={}),l=function(e,t,n){e=function(e){if("close"===e.pattern){var t={close:!0,type:"default",name:"close",title:o.ui.Close};return $.extend({},t,e)}if("validate"===e.pattern){var n={close:!1,type:"success",name:"validate",title:o.ui.Validate};return $.extend({},n,e)}if("create"===e.pattern){var i={close:!1,type:"success",name:"create",title:o.ui.Create};return $.extend({},i,e)}if("abandon"!==e.pattern)return e;t={close:!0,type:"default",name:"abandon",title:o.ui.Abandon};return $.extend({},t,e)}(e),t.push('<button data-action="'+e.name+'" type="button"'),t.push(' class="bs-btn-inline float-right bs-button btn btn-'+c.bootstrapStyles(!1)[e.type||"default"]),t.push('"'),e.close&&t.push(' data-dismiss="modal"'),t.push(">"),e.icon&&(t.push('<span class="'+c.iconClass(e.icon)+'"></span>'),e.title&&t.push("&nbsp;")),t.push(d.tt(e.title||"",n)),t.push("</button>")},t=function(){function e(e,t){this.options=e||{},this.$id=u.allocID(),this.$locale=t}return e.prototype._removeEvents=function(){this.$element.off("click"),this.$element.off("hidden.bs.modal")},e.prototype._execAction=function(e){this._clickHnd&&this._clickHnd(e)},e.prototype._addEvents=function(){var o=this;o.$element.on("hide.bs.modal",function(e){o._inProcessing&&(e.preventDefault(),e.stopPropagation())}),o.$element.on("hidden.bs.modal",function(e){o._clear()}),o.$element.on("click",function(e){if(o.$element)for(var t=e.target,n=o.$element.get(0);t;){var i=t.getAttribute("data-action");if(i)return u.focusDelay(function(){return o._execAction(i)});t=t==n?null:t.parentNode}})},e.prototype._clear=function(){var e=this;e.$element&&(e._removeEvents(),e.render&&e.render.destroy(),e.$element.remove(),e.$element=null),e.render=null},e.prototype.processing=function(e){this._inProcessing=e,c.processing(e),this.render&&this.render.processing&&this.render.processing(e)},e.prototype.on=function(e){this._clickHnd=e},e.prototype.close=function(){var e=a.modalPlugin;this.$element&&this.$element[e]("hide")},e.prototype.open=function(){var e,t,n,i,o=this,r={id:o.$id,title:o.options.title||"",buttons:o.options.buttons||[],size:0,noClose:!1};if(o.options.size&&(r.size=o.options.size),o.options.noClose&&(r.noClose=o.options.noClose),!o.$element){o.$element=$((e=r,t=o.$locale,n=a.bootstrap4,i=['<div class="modal fade" data-backdrop="static"  id="{0}" role="dialog" aria-labelledby="{0}_label">','\t<div class="modal-dialog'+(e.size?" modal-"+e.size:"")+'" role="document">','\t\t<div class="modal-content">','\t\t<div class="modal-header">',n?'\t\t\t<h5 class="modal-title" id="{0}_label">{1}</h5>':"",e.noClose?"":'\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',n?"":'\t\t\t<h4 class="modal-title" id="{0}_label">{1}</h4>',"\t\t</div>",'\t\t<div class="modal-body" id="{0}_body">',"\t\t</div>",'\t\t<div class="modal-footer"  id="{0}_footer">'],e.buttons&&e.buttons.forEach(function(e){l(e,i,t)}),i.push("\t\t</div>"),i.push("\t\t</div>"),i.push("\t</div>"),i.push("</div>"),u.format(i.join(""),e.id,d.tt(e.title,t)))),o.render&&o.render.render($(c.find(o.$element.get(0),o.$id+"_body"))),c.append(document.body,o.$element.get(0));var s=a.modalPlugin;o.$element[s]&&(o.$element[s]({keyboard:!1,focus:!1}),o._addEvents())}},e.prototype.destroy=function(){this._clear()},e}(),e.Modal=t}(Phoenix||(Phoenix={})),function(e){var t,n,v,g,a,y,o,l,i;t=e.DatasetPlugin||(e.DatasetPlugin={}),v=(n=e).data,g=n.link,a=n.$mem,y=n.utils,o=function(e,t,n,i){if(t.config.$emit[i].$updateMem){var o=t.data2Output(t.config.$emit[i].$updateMem,{$item:n});a=$.extend(a,o)}if(t.config.$emit[i].$updateLocal){var r=e.getLocalContextHandler?e.getLocalContextHandler():null;if(r){var s=t.data2Output(t.config.$emit[i].$updateLocal,{$item:n});r=$.extend(r,s)}}},l=function(e,i,t,n,o,r,a,s){var l=function(e){return s?t?t[e]:null:t},u=e,d=[],c=[],p=n||{},h="$load"==i,f=-1,m=function(e,t,n){if(u&&u.datasets){var i=u.datasets[e];i&&(d.push(i.execute(n,u)),c.push(e),i.defaultDataset&&(f=t.length-1))}};r?r&&Array.isArray(r)?r.forEach(function(e){"object"==typeof e?e.name&&(d.push(v.execData(e,l(e.name),u)),c.push(e.name)):m(e,c,l(e))}):m(r,c,l(r)):u&&u.datasets&&Object.keys(u.datasets).forEach(function(e){var t=u.datasets[e],n=(g.search(!0),u.ds_context());t&&t.canExecute(i,n)&&m(e,c,l(e))}),d.length?(u&&u.loadingHandler&&u.loadingHandler(!0),y.Promise.all(d).then(function(r){var s=[];c.forEach(function(t,e){var n=r[e];if(e==f&&u&&u.noDataHandler&&u.noDataHandler(!n||n.nodata,null,!0),p[t]=n,u){var i=u.datasets&&u.datasets[t];if(h&&i&&i.$menu&&u.updateMenuHandler){var o=t.split("_");s.push({name:o[o.length-1],data:n})}if(i&&(u.ds_loaded(t,n),i.autoselect))return i.doAutoSelect(n,function(e){u.ds_select(t,e)})}}),u&&u.loadingHandler&&u.loadingHandler(!1),s.forEach(function(e){u.updateMenuHandler(e.name,e.data)}),o(!0),u&&u.watchersHandler&&u.watchersHandler(c),!h&&a&&u&&u.dataChangedHandler&&u.dataChangedHandler(c)}).catch(function(e){e&&console.log(e),u&&u.loadingHandler&&u.loadingHandler(!1),u&&u.errorHandler&&u.errorHandler(e),o(!1,e),!h&&a&&u&&u.dataChangedHandler&&u.dataChangedHandler(c)})):o(!0)},i=function(){function e(){}return e.prototype.ds_init=function(n){var i=this,o=!1;if(i.props=i.props||{},i.props.data=i.props.data||{},i.props.data.ds={},n.datasets||n.$resources||n.$schema||n.$menus){i.datasets&&i.ds_destroy();var e=n.$resources||n.$schema;e&&(i.props.data.ds.view=null,i.datasets=i.datasets||{},i.datasets.view=new v.DataSet({$type:"widget-schema",$params:{name:e,localization:n.$localization}}),i.datasets.view.$schema=!0),n.$menus&&Object.keys(n.$menus).forEach(function(e){var t="$menu_"+e;i.props.data.ds[t]=null,i.datasets=i.datasets||{},i.datasets[t]=new v.DataSet({$type:"menu",$params:{name:n.$menus[e]+"-"+e}}),i.datasets[t].$menu=!0}),n.datasets&&Object.keys(n.datasets).forEach(function(e){i.props.data.ds[e]=null,i.datasets=i.datasets||{};var t=new v.DataSet(n.datasets[e]);i.datasets[e]=t,o||(o=t.hasCustomEvents()||t.config.$emit)})}return o},e.prototype.ds_storeLastEvent=function(e,t){this._lastEvent={event:e,value:t}},e.prototype.ds_LastEvent=function(){if(this._lastEvent){var e=this._lastEvent;return this._lastEvent=null,e}return null},e.prototype.ds_destroy=function(){y.log("Destroy Dataset Part","destroy");var t=this;t._lastEvent=null,t.datasets&&(Object.keys(t.datasets).forEach(function(e){t.datasets[e].destroy()}),t.datasets=null)},e.prototype.ds_context=function(){var t={$url:g.search(!0),$mem:a,$local:this.getLocalContextHandler?this.getLocalContextHandler():null},n=this.props.data.ds;return n&&Object.keys(n).forEach(function(e){t[e]=n[e]}),t},e.prototype.ds_reemit=function(e,t){var i=this;i.datasets&&Object.keys(i.datasets).forEach(function(t){var e=i.props.data.ds[t],n=i.datasets[t];n.defaultDataset&&i.noDataHandler&&i.noDataHandler(!e||e.nodata,null,!0),i.ds_loaded(t,e),n.autoselect&&n.doAutoSelect(e,function(e){i.ds_select(t,e)})});return t()},e.prototype.ds_select=function(e,t){var n=this;if(n.datasets&&n.datasets[e]){var i=n.datasets[e];i.config.$emit&&n.emitHandler&&(i.config.$emit.$changed&&o(n,i,t,"$changed"),n.emitHandler(i.config.$emit.$changed?i.config.$emit.$changed.$name:i.config.$emit,t))}},e.prototype.ds_loaded=function(e,t){var n=this;if(n.datasets&&n.datasets[e]){var i=n.datasets[e];i.config.$emit&&i.config.$emit.$loaded&&(o(n,i,t,"$loaded"),n.emitHandler(i.config.$emit.$loaded.$name,t))}},e.prototype.ds_exec=function(e,t,n,i,o,r){l(this,e,t,n,i,o,r)},e}(),t.DatasetMethods=i,t.executeDatasets=function(e,t,n,i,o,r){var s={loadingHandler:i&&i.loading?i.loading:null,errorHandler:i&&i.error?i.error:null};l(s,"",t,n,o,e,!1,r)}}(Phoenix||(Phoenix={})),function(e){var t,n,s,a,o,l,u,d,c,p;t=e.WidgetUtils||(e.WidgetUtils={}),s=(n=e).dom,a=n.utils,o=n.locale,l=n.ulocale,u=function(e,t,n){var i=["bs-island bs-widget"];return s.parseStyle(e.$style,i),e.$border&&i.push("border"),t.design&&i.push("design"),n&&i.push("selected"),i.join(" ")},d=function(e){return e?"height:"+(0<(e+"").indexOf("%")?e:parseInt(e,10)+"px")+";":""},c=function(n,e,i,t,o){n.push('<div class="bs-widget-title'+(o?" bs-widget-content-inv-x":"")+(i.$titleIsHidden&&!o?" bs-none":"")+'" id="'+e+'_title">');var r=l.localeTitle(i.$title)||"";t&&(r=l.tt(i.$title||"",t)),n.push(a.escapeHtml(r+" ")),i.icons&&i.icons.length&&i.links&&i.icons.forEach(function(e){var t=i.links[e.link];t&&t.$icon&&(n.push('<a class="bs-widget-title-icon" data-phoenix-href="link://'+e.link+'">'),n.push('<span class="'+s.iconClass(t.$icon)+'"></span>'),n.push("</a>"))}),n.push("</div>")},p=function(e,t,n,i,o,r){!function(e,t,n,i){e.push('<div class="'),e.push(u(t.$config,n,t.$selected)),e.push('"'),n.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push(">"),c(e,t.$id,t.$config,i,!1),e.push('<div class="bs-widget-content bs-widget-content-id"');var o=d(t.$config.$height);o&&e.push(' style="'+o+'"'),e.push(">")}(e,t,o,r),e.push("</div></div>")},t.toHtml=function(e,t,n,i,o){var r=[];return p(r,e,0,0,t,o),r.join("")},t.cssClass=u,t.heightText=d,t.loader=function(){return $('<div class="bs-loader"></div>')},t.error=function(){return $('<div class="alert alert-danger" role="alert"><span class="'+s.iconClass("exclamation-circle")+'" aria-hidden="true"></span><span></span></div>')},t.widgetTitle=c,t.settings=function(){return $('<span class="bs-module-settings '+s.iconClass("cog")+'" ></span>')},t.warning=function(){return $('<div class="alert alert-warning" role="alert"></div>')},t.noData=function(e,t){var n=[],i=!1!==t;return t=t&&!0!==t||"cloud",n.push('<div class="bs-widget-content nodata">'),n.push('<div class="bs-no-data-inside">'),i&&n.push('<center class="nodata-image"><i class="'+s.iconClass(t)+' nodata-icon"></i></center>'),n.push('<center><h4 class="nodata-text">'),n.push(e||o.layouts.NoData),n.push("</h4></center>"),n.push("</div>"),n.push("</div>"),$(n.join(""))}}(Phoenix||(Phoenix={})),function(e){var t,n,l,o,u,i,r,a,s;t=e.ui||(e.ui={}),l=(n=e).dom,o=n.utils,n.locale,u=n.WidgetUtils,i=n.DatasetPlugin,r=n.link,a=n.render,s=function(){function e(e,t,n){var i=this;i.item=e||{},i.item.$id||(i.item.$id=o.allocID()),e.$config=e.$config||{},e.$config.data=e.$config.data||{},i.data=e.$config,i.props={},i.item.$render=i.props,i.props.data=e.$config.data,i.options=t||{},i.contentRender=null,i.links=e.$config.links,i._defineProps(),i.layout=n,i.$local={},i.loadingHandler=i.loading.bind(i),i.noDataHandler=i.noData.bind(i),i.errorHandler=i.error.bind(i),i.emitHandler=i.emit.bind(i),i.getLocalContextHandler=i.getLocalContext.bind(i),i.dataChangedHandler=i.dataChanged.bind(i),i.updateMenuHandler=null,i._watchers={},i.props.data.localContext&&$.extend(i.$local,i.props.data.localContext),i.ds_init(i.data)&&i._listen()}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,n,i,o,r){},e.prototype._defineProps=function(){var e=this,t=o.defineProperty;t("$title",e),t("$border",e),t("$height",e),t("$titleIsHidden",e),t("$settings",e)},e.prototype._notifyChange=function(e){switch(e){case"$title":this._updateTitle();break;case"$border":case"$titleIsHidden":this._updateCssClass();break;case"$height":this._updateHeight()}},e.prototype._listen=function(){this.layout&&this.layout.registerDataListener(this)},e.prototype._unlisten=function(){this.layout&&this.layout.removeDataListener(this)},e.prototype.on=function(e,t){this.handlers=this.handlers||{},this.handlers[e]=t},e.prototype._exec=function(e){this.handlers&&this.handlers[e]&&this.handlers[e]()},e.prototype._setEvents=function(){var i=this,o=i.$element.get(0);i.$element.on("click",function(e){var t=e.target;i.$settings&&t===i.$settings.get(0)&&i._exec("settings");var n=r.isCustomLink(o,e);n&&r.execCustomProtocol(n,i.ds_context(),{links:i.links},null)})},e.prototype.executeLink=function(e,t){var n=r.isCustomProtocol(e);n&&r.execCustomProtocol({protocol:n,value:e},this.ds_context(),{links:this.links},t)},e.prototype._removeEvents=function(){this.$element.off("click")},e.prototype.dataChanged=function(e){var t=this;t.onDSChanged&&t.onDSChanged(e),t.contentRender&&t.contentRender.dataChanged?t.contentRender.dataChanged():t.options.onDataChanged&&t.options.onDataChanged()},e.prototype.execDataSet=function(e,t,n,i,o){i=i||this.props.data.ds,this.ds_exec(null,t,i,n||function(){},e,o)},e.prototype._loadData=function(e){if(!this.datasets)return e(!1);this.ds_exec("$load",null,this.props.data.ds,e,null,!0)},e.prototype._updateTitle=function(){if(this.$element){var e=l.find(this.$element.get(0),this.item.$id+"_title");e&&l.text(e,this.data.$title||"")}},e.prototype._cleanErrors=function(e){var t=this;t.$loader&&(t.$loader.remove(),t.$loader=null),e||(t.$settings&&l.addClass(t.$settings.get(0),"bs-none"),t.$noData&&(t.$noData.remove(),t.$noData=null),t.$error&&(t.$error.remove(),t.$error=null),t.$warning&&(t.$warning.remove(),t.$warning=null))},e.prototype.loading=function(e){var t=this;t._cleanErrors(!e);var n=t.$element?t.$element.get(0):null;n&&(e?(l.addClass(n,"loading"),t.$loader||(t.$loader=u.loader(),t.$element.append(t.$loader))):l.removeClass(n,"loading")),e||t.settings()},e.prototype._linksState=function(t){if(this.$element){var e=this.$element.get(0),n=l.find(e,this.item.$id+"_title");if(n){var i=l.queryAll(n,".bs-widget-title-icon");[].forEach.call(i,function(e){t?l.removeClass(e,"bs-none"):l.addClass(e,"bs-none")})}}},e.prototype.noData=function(e,t,n){var i=this;if(!t&&i.props.data.$noDataMessage&&(t=i.props.data.$noDataMessage),this._cleanErrors(!1),i.$element){var o=i.$element.get(0),r=l.query(o,".bs-widget-content-id");if(r&&(e?l.addClass(r,"bs-none"):l.removeClass(r,"bs-none"),i._linksState(!e)),e){if(i.$noData=u.noData(t,n),i._updateHeight(i.$noData)){var s=l.query(i.$noData.get(0),".bs-no-data-inside");l.addClass(s,"centred")}var a=l.find(o,i.item.$id+"_title");a&&l.after(a,i.$noData.get(0))}}},e.prototype.getLocalContext=function(){return this.$local},e.prototype.settings=function(){var e=this,t=e.data.$settings&&!e.$error&&!e.$warning&&!e.$noData;if(e.$settings)t?l.removeClass(e.$settings.get(0),"bs-none"):l.addClass(e.$settings.get(0),"bs-none");else if(t){e.$settings=u.settings();var n=l.find(e.$element.get(0),e.item.$id+"_title");n&&l.after(n,e.$settings.get(0))}},e.prototype.error=function(e){var t=e;e&&e.message&&(t=e.message);var n=this;this._cleanErrors(!1);var i=n.$element?n.$element.get(0):null;if(i){n.$error=u.error();var o=n.$error.get(0);l.text(o.lastChild," "+t);var r=l.find(i,n.item.$id+"_title");r&&l.after(r,o)}},e.prototype.warning=function(e){var t=this;this._cleanErrors(!1);var n=t.$element?t.$element.get(0):null;if(n){t.$warning=u.warning();var i=t.$warning.get(0);l.text(i,e);var o=l.find(n,t.item.$id+"_title");o&&l.after(o,i)}},e.prototype._updateHeight=function(e){var t=(e=e||this.$element)?e.get(0):null;return t&&(t.style.cssText=u.heightText(this.props.$height)),!!this.props.$height},e.prototype._updateCssClass=function(){var e=this.$element?this.$element.get(0):null;e&&(e.className=u.cssClass(this.data,this.options))},e.prototype._internalRenderContent=function(e,t,n){var i=this,o=a.get(i.options.context,"widget.content.control."+i.data.$type);if(i.$element){if(o)i.contentRender=new o(i.props,{context:i.options.context,replaceParent:!1},this);else{var r=a.get(i.options.context,"widget.content");if(r){var s=[];r(s,i.data,i.options),e.append($(s.join("")))}}i.options.beforeAdd&&i.options.beforeAdd(e,n),i.contentRender&&i.contentRender.render(e),t&&i.$element.append(e)}},e.prototype.watchersHandler=function(e){var n=this;e&&e.forEach(function(t){var e=n._watchers[t];e&&e.forEach(function(e){e(n.props.data.ds[n.props.data.ds[t]])})})},e.prototype.render=function(e){var t=this;if(t.$loader=null,t.$error=null,!t.$element){t.layout.controls[t.item.$id]=this,t.$element=$(u.toHtml(t.item,t.options,null,null,null)),t._setEvents();var n=t.$element.get(0),i=l.query(n,".bs-widget-content-id");t._loadData(function(e){t._internalRenderContent($(i),!1,e),t.settings()}),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element))}},e.prototype.emit=function(e,t,n){this.layout&&this.layout.emitDataEvent(e,t,n)},e.prototype.dataEvent=function(e,t){this.ds_exec(e,t,this.props.data.ds,function(){},null,!0)},e.prototype.destroy=function(){o.log("Destroy Module","destroy");var e=this;e.contentRender&&(e.contentRender.destroy(),e.contentRender=null),e._unlisten(),e.ds_destroy(),e._cleanErrors(!1),e.item.$render=null,e.$settings&&(e.$settings=null),e.$element&&(e._removeEvents(),e.$element=null),e.layout=null,e.ondatasets=null},e.prototype.watch=function(e,t){var n=this;n._watchers&&((n._watchers[e]=n._watchers[e]||[]).push(t),n.props&&n.props.data.ds&&o.nextTick(function(){t(n.props.data.ds[e])}))},e.prototype.unwatch=function(e,t){if(this._watchers){var n=this._watchers[e];if(n){var i=n.indexOf(t);0<=i&&n.splice(i,1)}}},e}(),t.Widget=s,o.applyMixins(s,[i.DatasetMethods])}(Phoenix||(Phoenix={})),function(e){var t,n,i,l,u,d,o,r,c,s;t=e.menubase||(e.menubase={}),i=(n=e).pagecontrol,l=n.utils,n.ulocale,u=n.link,d=n.$mem,o=n.DatasetPlugin,r=n.dom,c=function(t,e,n,i,o){e&&e.forEach(function(e){void 0===e.$level&&(e.$level=o),e.$id=l.allocID(),i&&(e.$parentId=i.$id),n.push(e),e.$items&&e.$items.length?(void 0===e.collapsed&&(e.collapsed=!!t.canExpandItems),c(t,e.$items,n,e,o+1)):e.collapsed=!1})},s=function(){function e(e,t){this._initOptions(t),this.init(e,t)}return e.prototype.ds_init=function(e){return!1},e.prototype.ds_storeLastEvent=function(e,t){},e.prototype.ds_LastEvent=function(){return null},e.prototype.ds_destroy=function(){},e.prototype.ds_context=function(){return null},e.prototype.ds_reemit=function(e,t){return null},e.prototype.ds_select=function(e,t){},e.prototype.ds_loaded=function(e,t){},e.prototype.ds_exec=function(e,t,n,i,o,r){},e.prototype._initOptions=function(e){},e.prototype.emit=function(e,t,n){this.emitDataEvent(e,t,n)},e.prototype.init=function(e,t){l.log("Create Menu","menu");var n=this;n.loadingHandler=this.loading.bind(n),n.noDataHandler=null,n.errorHandler=null,n.emitHandler=this.emit.bind(n),n.getLocalContextHandler=null,n.dataChangedHandler=null,n.updateMenuHandler=null,n.$element=null,n.$items=null,n.options=t||{},n.options.typeMenu=n.options.type||"left",n.data={name:"none"},n.page=i.Page(),n.page.addChild("menu-"+n.options.typeMenu,n),n.setMenu(e)},e.prototype.loading=function(e){this.page.loading(e)},e.prototype.registerDataListener=function(e){this.page&&this.page.registerDataListener(e,this)},e.prototype.removeDataListener=function(e){this.page&&this.page.removeDataListener(e)},e.prototype.emitDataEvent=function(e,t,n){this.page&&this.page.emitDataEvent(e,t,n)},e.prototype.onPageChange=function(e,t){var n=this;if("$user"===e&&n.items&&n.options.auth&&!n.options.autoClose){var i=n.page.props.$user&&n.page.props.$user.connected;if(i){var o=r.find(null,n.options.parentId);o?n.show($(o)):n._showContent()}else n.$content&&!i&&n._hideContent()}"$title"===e&&n._onPageChanged()},e.prototype.setMenu=function(e){l.log("Set Menu","menu");var i=this,o=null!=e;(e=e||{name:"none"}).$groups||(e.$groups=[{$items:e.$items}]),i.data.name!==e.name||void 0===e.name?(l.log("Menu create && execute datasets","menu"),i.data=e,i.items=null,i._map={},i._recreateDatasets(),i.ds_exec("$load",null,i.props.data.ds,function(){var e=!i.options.autoClose&&i.options.parentId&&o;if(e&&i.options.auth&&(e=i.page.props.$user&&i.page.props.$user.connected),i._prepareItems(),i.$content)if(i._removeContent(),o)if(e){var t=r.find(null,i.options.parentId);t&&(i.render(),i.show($(t)))}else i.render();else i._hideContent();else if(e){var n=r.find(null,i.options.parentId);n&&i.show($(n))}i.page.props["$menu"+i.options.typeMenu]=o&&i.options.autoClose},null,!0),i._onPageChanged()):(l.log("Menu reexecute datasets","menu"),i.ds_reemit(null,function(){i._onPageChanged(),i.page.props["$menu"+i.options.typeMenu]=o&&i.options.autoClose}))},e.prototype._onPageChanged=function(){},e.prototype._doCloseClick=function(){},e.prototype._menuShowed=function(){},e.prototype._executeLink=function(e,t){},e.prototype._executeContextMenu=function(e,t,n){return!1},e.prototype._setEvents=function(){var s=this,a=s.$content.get(0);s.$content.on("click",function(e){var t=u.isCustomLink(a,e,!0);if(t&&"click"===t.protocol){var n=t.value.substring("click://".length);if("close"===n){if(s._doCloseClick)return s._doCloseClick()}else{if(0===n.indexOf("collapse/")){var i=(n=n.substring("collapse/".length)).split("/"),o=s.items[parseInt(i[0],10)];return void(o&&(s.colapse(o,!o.collapsed,!1),s.updateItemsAfterCollapse()))}var r=n.split("/");s._executeLink(s.items[parseInt(r[0],10)],1<r.length?r[1]:null)}}s.options.autoClose&&s.hide()}),s.$content.contextmenu(function(e){if(s.options.noContextMenu)return e.preventDefault(),!1;var t=u.isCustomLink(a,e,!0);if(t&&"click"===t.protocol){var n=t.value.substring("click://".length);if("close"===n);else if(0===n.indexOf("collapse/"));else{var i=n.split("/");if(s._executeContextMenu(e,s.items[parseInt(i[0],10)],1<i.length?i[1]:null))return e.preventDefault(),!1}}})},e.prototype.updateItemsAfterCollapse=function(){},e.prototype.renderItems=function(e){return null},e.prototype._removeEvents=function(){this.$content.off("click"),this.$content.off("contextmenu")},e.prototype._loadData=function(e){if(!this.datasets)return e(!1);this.ds_exec("$load",null,this.props.data.ds,e,null,!0)},e.prototype._expandItem=function(e,t,n,i,o,r){var s={$title:"",$item:e,$index:r,$link:o};return s.$title=l.parseVariable(i,{$item:e,$url:t,$mem:n}),s},e.prototype._expandDatasetItems=function(e,n,i){var o=this,t=o.props.data.ds[e];if(t){var r=[],s=u.search(!0),a=d;if(t.documents){if(!t.documents.length)return null;t.documents.forEach(function(e,t){r.push(o._expandItem(e,s,a,n,i,t))})}else r.push(o._expandItem(t,s,a,n,i,-1));return r}return null},e.prototype.copyMenuItemData=function(e,t){},e.prototype.isVisible=function(e){if(e.$parentId&&this.options.canExpandItems){for(var t=!0,n=e;n&&n.$parentId;)if((n=this._map[n.$parentId])&&n.collapsed){t=!1;break}return t}return!0},e.prototype.colapseAll=function(t){this.items.forEach(function(e){e.collapsed=t})},e.prototype.colapse=function(e,t,n){var i=this;e.collapsed=t,e.$items&&e.$items.forEach(function(e){e.collapsed=t,n&&e.$items&&i.colapse(e,t,!0)})},Object.defineProperty(e.prototype,"search",{get:function(){return this._search},set:function(e){this._search!==e&&(this._search=e,this._updateSearch()),this._search=e},enumerable:!0,configurable:!0}),e.prototype._updateSearch=function(){},e.prototype._prepareItems=function(){var s=this;if(s._searchList=[],s.items=[],s.data.$groups){var a=!0;s.data.$groups.forEach(function(i,e){var t=null;if(0===e&&(i.$title=i.$title||String.fromCharCode(160)),i.$dataset){if(!i.$link)throw"Invalid link definition. (no link)";if(!i.$itemtitle)throw"Invalid link definition. (no itemtitle)";t=s._expandDatasetItems(i.$dataset,i.$itemtitle,i.$link)}else t=i.$items;if(t&&t.length){var n=[];if(c(s.options,t,n,null,0),t=n,!a||i.$title||0===e||i.$dataset){var o={$id:l.allocID(),divider:!0,$title:null,$firstGroup:0===e,dataset:"",isHidden:!1,collapsed:!1};o.$title=i.$title,i.dataset&&(o.dataset=i.$dataset,a&&(o.isHidden=!0)),s._map[o.$id]=o,s.items.push(o),a=!1}}if(t){var r=i.$dataset?s.datasets[i.$dataset]:null;t.forEach(function(e,t){var n={$id:e.$id,$parentId:e.$parentId,$title:e.$title?l.parseExpression(e.$title,u.context()):null,$dataset:null,dataset:null,$index:0,$item:null,$link:null,$level:e.$level,selected:!1,collapsed:e.collapsed,$items:e.$items};i.dataset&&(n.dataset=i.$dataset),e.$link&&(n.$link=e.$link),r&&r.autoselect&&(n.selected=r.selectedIndex==t),s.copyMenuItemData(n,e),r&&(n.$dataset=i.$dataset,n.$index=e.$index,n.$item=e.$item),s._map[n.$id]=n,s.items.push(n),n.$title&&s._searchList.push({id:n.$id,title:n.$title}),a=!1})}})}},e.prototype._removeContent=function(){this.$element&&(this.$element.remove(),this.$element=null)},e.prototype.renderContent=function(){return $("<aside></aside>")},e.prototype.show=function(e){var t=this;if(!e&&t.options.parentId){var n=r.find(null,t.options.parentId);n&&(e=$(n))}t.$content?t._showContent():(t.render(e),t.options.autoClose?l.nextTick(function(){t._showContent()}):t._showContent()),t.options.autoClose&&t.page.setPopup(t)},e.prototype.hide=function(e){this.$content&&this._hideContent(e)},e.prototype._hideContent=function(e){var t=this.$content.get(0);r.addClass(t,"bs-none")},e.prototype._showContent=function(){var e=this.$content.get(0);r.removeClass(e,"bs-none"),this._menuShowed()},e.prototype.render=function(e){var t=this,n=t.$content;if(n||(n=t.renderContent()),t.$element||(t.$element=t.renderItems(n),n.append(this.$element)),e&&!t.$content){if(t.$content=n,t.options.replaceParent){var i=e.get(0);if(i&&i.id){var o=t.$content.get(0);o&&(o.id=i.id)}e.replaceWith(t.$content)}else e.append(t.$content);t._setEvents()}},e.prototype._recreateDatasets=function(){var e=this;e.ds_destroy(),e.removeDataListener(e),e.ds_init(e.data)&&e.registerDataListener(e)},e.prototype.destroy=function(){var e=this;l.log("Destroy Menu","destroy"),e.ds_destroy(),e.removeDataListener(e),e.$content&&(e._removeEvents(),this.$content=null),this.$element=null,e.page&&(e.page.removeChild(e),e.page=null)},e.prototype.inPopup=function(e){if(!this.options.autoClose)return!0;if(!e)return!0;if(this.$content)for(var t=this.$content.get(0),n=e;n;){if(n==t)return!0;n=n.parentNode}return!1},e}(),t.MenuBase=s,l.applyMixins(s,[o.DatasetMethods])}(Phoenix||(Phoenix={})),function(k){!function(c){var r="#/definitions/",s=r.length;c.INDEX_FIELD_NAME="$index",c.SELECTED_FIELD_NAME="$select",c.EXPANDED_FIELD_NAME="$expand";var n,i,u=k.ulocale,g=k.external,w=k.application,y=k.dom,O=k.data,S=k.utils,p=k.locale,E=k.customData,d=k.locale.schema,h=k.DatasetPlugin,t=[c.INDEX_FIELD_NAME,c.SELECTED_FIELD_NAME,c.EXPANDED_FIELD_NAME],o=function(t){if(!t.features){t.features={};var e=void 0===t.capabilities?"filtrable,sortable":t.capabilities;e&&e.split(",").forEach(function(e){t.features[e]=!0})}},_=function(e,t){if(e.$ref){var n=e.$ref.substr(s),i=t.definitions?t.definitions[n]:null;if(!i)throw"Schema $ref not found : "+e.$ref;return i}return e},e=(i={},{register:function(e,t){i[e]=t},get:function(e){return i[e]}}),a=(n={},{register:function(e,t){n[e]=t},get:function(e){return n[e]}});function f(o,r,s,e,a,l,u){l(s,o,r,a,e,u=u||{})&&Object.keys(o.properties).forEach(function(e){var t=o.properties[e];if(!t.$reference||u&&u.$references)if(!t.type&&t.$ref&&(t=_(t,r)),"object"===t.type)f(t,r,i=s?s+"."+e:e,!1,a?a[e]:null,l,u);else if("array"===t.type){var n=_(t.items,r);if("object"===n.type){var i=s?s+"."+e:e;u.currentRef=t.items.$ref,f(n,r,i,!0,a?a[e]:null,l,u)}}})}function l(e,t){if(!t.definitions)throw new Error("schema.definitions is null");var n=e,i=n.indexOf(r);if(i<0)throw new Error(S.format("Invalid $ref. ({0})",n));var o=n.substring(i+s);return t.definitions[o]}function m(i,o,r){var e=null;return i.allOf?(e=i.allOf,delete i.allOf):i.$ref&&o.indexOf(i.$ref)<0&&(e=[{$ref:i.$ref}],i.ux&&(e[0].ux=!0),delete i.$ref),e&&e.forEach(function(e){var t=o.slice(0);if(e.$ref){var n=l(e.$ref,r);e.ux&&(n.properties&&Object.keys(n.properties).forEach(function(e){var t=n.properties[e];void 0===t.ux&&(t.ux=!0)}),n.links&&Object.keys(n.links).forEach(function(e){var t=n.links[e];void 0===t.ux&&(t.ux=!0)})),"array"!==e.type&&"array"!==n.type&&t.push(e.$ref),delete e.$ref,S.merge(n,e)}v(e,t,r),S.merge(e,i)}),e}function v(e,n,i){m(e,n.slice(0),i);var o=null;e.properties?o=e:"array"===e.type&&e.items&&(o=e.items),o&&o.properties&&Object.keys(o.properties).forEach(function(e){var t=o.properties[e];(t.allOf||t.$ref)&&m(t,n,i),"array"===t.type&&t.items&&(t.items.allOf||t.items.$ref)&&m(t.items,n,i)})}var b={RATE_DECIMALS:2,RATE_MAXIMUM:1e3,RATE_SYMBOL:"%",moneyUnitSymbol:function(e){return 1e3===e?"K":""},expandSchema$Ref:function(i){return i.definitions&&Object.keys(i.definitions).forEach(function(e){var t=i.definitions[e];if(t.allOf){var n=t.allOf;delete t.allOf,n.forEach(function(e){if(e.$ref){var n=$.extend(!0,{},l(e.$ref,i));delete e.$ref,e.ux&&(n.properties&&Object.keys(n.properties).forEach(function(e){var t=n.properties[e];void 0===t.ux&&(t.ux=!0)}),n.links&&Object.keys(n.links).forEach(function(e){var t=n.links[e];void 0===t.ux&&(t.ux=!0)})),S.merge(n,e)}k.utils.merge(e,t)})}}),v(i,[],i)},path2RulePath:function(e){var t=e.split("."),n=[];return t.forEach(function(e){"$"!==e.charAt(0)&&n.push(e)}),n.join(".")},_getDefault:function(e){return"@date"===e?u.date2ISO(new Date):e},checkLookup:function(e){return e?((!(e=$.extend({},e)).data||"odata"!==e.data.$type&&"find"!==e.data.$type)&&(e.pagination=!1,e.cache=!0),!1!==e.pagination&&(e.pagination=!0),e.pagination&&(e.cache=!1),e):null},schema2Authoring:function(e,t,a){var l=[];return f(e,t,"",!1,null,function(o,r,s,e,t){return!t&&(Object.keys(r.properties).forEach(function(e){var t=r.properties[e];if(b.inModel(t,s)&&!b.isCompositionRef(t,s)){var n=o?o+"."+e:e,i={$type:"field",$bind:n,$title:u.tt(t.title,a)||n,$widget:t.$widget,options:t.$widgetOptions};l.push(i)}}),r.links&&Object.keys(r.links).forEach(function(e){var t=r.links[e],n="$links."+e,i={$type:"action",$bind:n=o?o+"."+n:n,$title:u.tt(t.title,a)||n,$widget:t.widget,options:t.$widgetOptions};l.push(i)}),!0)}),l},extractClassNames:function(e,t){var s={},a={};return f(e,t,"",!1,null,function(e,t,n,i,o,r){if(r.currentRef){if(a[r.currentRef])return!1;a[r.currentRef]=!0}if(t.name){if(s[t.name])return!1;s[t.name]=!0}return!0},{$references:!0}),Object.keys(s).length?s:null},expandRules:function(e,t){var r={rulesbyClass:{},rulesById:{}};return e.forEach(function(o){o.ruleType&&(o.triggers=o.triggers.split(",").map(function(e){return e.trim()}),o.id=S.allocID(),(r.rulesById[o.id]=o).entities&&o.entities.forEach(function(i){t[i.entity]&&o.triggers.forEach(function(e){var t=o.ruleType;if("$events.created"===e?t="created":"$events.loaded"===e?t="loaded":"$events.saving"===e&&(t="saving"),r.rulesbyClass[t]=r.rulesbyClass[t]||{},"created"===t||"loaded"===t||"saving"===t)r.rulesbyClass[t][i.entity]=r.rulesbyClass[t][i.entity]||[],r.rulesbyClass[t][i.entity].push(o.id);else{var n=r.rulesbyClass[t][i.entity]=r.rulesbyClass[t][i.entity]||{};n[e]=n[e]||[],n[e].push(o.id)}})}))}),r},getMaxLength:function(e){if("string"===e.type)return void 0!==e.maxLength?e.maxLength:"code"===e.format?32:"json"===e.format||"memo"===e.format?4e3:256},filtrableFields:function(e,t,a){var l=[];return f(e,t,"",!1,null,function(o,r,s,e,t){return!t&&(Object.keys(r.properties).forEach(function(e){var t=r.properties[e];if(b.inModel(t,s)&&!b.isCompositionRef(t,s)&&!b.isCompositionList(t,s,!0)){var n=o?o+"."+e:e;if(b.canFilter(t)){var i={name:n,schema:S.copy(t)};i.schema.title=u.tt(i.schema.title||"",a),l.push(i)}}}),!0)}),l},searchableFields:function(e,t,a){var l=[];return f(e,t,"",!1,null,function(o,r,s,e,t){return!t&&(Object.keys(r.properties).forEach(function(e){var t=r.properties[e];if(b.inModel(t,s)&&!b.isCompositionList(t,s,!0)){var n=o?o+"."+e:e;if(b.canSearch(t)){var i={name:n,schema:S.copy(t)};i.schema.title=u.tt(i.schema.title||"",a),l.push(i)}}}),!0)}),l},isFwField:function(e){return 0<=e.indexOf(c.EXPANDED_FIELD_NAME)||0<=t.indexOf(e)},copyModel:function(e,t,n,i,o){var r={};n=n||e;var s=t&&t.parentModel?t.parentModel:null;return s&&delete t.parentModel,function r(n,s,a,l,u,d){Object.keys(a).forEach(function(i){var e=a[i];if(void 0!==e){var t=null;if(!n||u||!(t=n.properties[i])||!(t.$reference||t.$ux||t.ux))if(!t&&"$"===i.charAt(0)||"_"===i.charAt(0))d&&"$states"===i&&(l[i]=$.extend(!0,{},e));else if(t)if(!t.type&&t.$ref&&(t=_(t,s)),"object"===t.type)null===e?l[i]=null:(l[i]={},r(t,s,e,l[i],u));else{if("array"===t.type){var o=_(t.items,s);return null===e?void(l[i]=null):void("object"===o.type?void 0===e||(null===e?l[i]=null:(l[i]=new Array(e.length),e.forEach(function(e,t){var n={};l[i][t]=n,r(o,s,e,n,u)}))):l[i]=e.slice(0))}l[i]=e}else null===e?l[i]=null:Array.isArray(e)?(l[i]=new Array(e.length),e.forEach(function(e,t){if(null==e||"object"!=typeof e)l[i][t]=e;else{var n={};l[i][t]=n,r(null,s,e,n,u)}})):"object"==typeof e?(l[i]={},r(null,s,e,l[i],u)):l[i]=e}})}(e,n,t,r,i,o),s&&(t.parentModel=s),r},columns:function(e,t,a){var l=[];return f(e,t,"",!1,null,function(o,r,s,e,t){return!t&&(Object.keys(r.properties).forEach(function(e){var t=r.properties[e];if(b.inModel(t,s)&&!b.isCompositionRef(t,s)&&!b.isCompositionList(t,s,!0)){var n=o?o+"."+e:e;if(b.canShowField(t)){var i={name:n,schema:S.copy(t)};i.schema.title=u.tt(i.schema.title||"",a)||e,l.push(i)}}}),!0)}),l},allData:function(e){return(!e.pagination||"relation"===e.data.$type||"enum"===e.data.$type)&&"custom"!==e.data.$type},pkFields:function(e){return Array.isArray(e)?e:e.split(",").map(function(e){return e.trim()})},entityId:function(n){if("object"!=typeof n)return"string"==typeof n?"'"+n+"'":n;return Object.keys(n).map(function(e){var t=n[e];return"string"==typeof t?e+"='"+t+"'":e+"="+t}).join(",")},extractPkValue:function(t,e){if(1==e.length)return t[e[0]];var n={};return e.forEach(function(e){n[e]=t[e]}),n},odataId:function(e,t){if(1==e.length)return t[e[0]];var n=[];return e.forEach(function(e){n.push(e+"="+encodeURIComponent(t[e]+""))}),n.join(",")},pk2Id:function(e,t){return 1===t.length?e:JSON.stringify(e)},id2Pk:function(e,t){return 1===t.length?e:JSON.parse(e)},equals:function(e,t,n){if(1===n.length)return e===t[n[0]];for(var i=0,o=n.length;i<o;i++){var r=n[i];if(e[r]!==t[r])return!1}return!0},extractBase:function(e){var t=e.split(".");return t.pop(),t.length?t.join(".")+".":""},parentPath:function(e){var t=e.split(".");return t.pop(),t.length?t.join("."):""},findByPk:function(e,t,n){if(n&&e)for(var i=0,o=n.length;i<o;i++){var r=n[i];if(b.equals(e,r,t))return r}return null},supportPagination:function(e){return!(!e.data||"odata"!==e.data.$type&&"find"!==e.data.$type&&"relation"!==e.data.$type&&"enum"!==e.data.$type)},executeLookup:function(e,t,i,n){var o=e.data;if(o.$params&&i.containerId&&(o.$params.containerId=i.containerId),o.$params&&i.viewId&&(o.$params.viewId=i.viewId),o.$params&&i.selected&&(o.$params.selected=i.selected),i.paginated&&(i.findFirst||i.find)){(o=$.extend(!0,{},e.data)).$params=o.$params||{},i.search=(i.search||"")+"";var r=o.$params.$allData||"relation"==o.$type||"enum"==o.$type,s=null,a=w.config(w.name)||{},l=(o.$params.$type?a[o.$params.$type]:null)||a.odata||{},u=l.startswith||"startswith",d=l.caseSensitive||!1,c="find"===o.$type,p="custom"===o.$type;if(!r)if(c)o.$params.$searchByFields&&o.$params.$searchByFields.fields&&o.$params.$searchByFields.fields.length?(s={$or:[]},o.$params.$searchByFields.fields.forEach(function(e){var t={};t[e]={$regex:"^"+i.search},s.$or.push(t)})):(s={})[i.fieldName]={$regex:"^"+i.search};else if(o.$params.$searchByFields&&o.$params.$searchByFields.fields&&o.$params.$searchByFields.fields.length){var h=[];for(o.$params.$searchByFields.fields.forEach(function(e){var t=e.replace(/\./g,"/"),n="'"+i.search.replace(/'/g,"''")+"'";d&&(t="tolower("+t+")",n="tolower("+n+")"),h.push({$left:u,$op:"$func",$right:t+", "+n})});h.length;){var f=h.shift();s=s?{$op:"or",$left:f,$right:s}:f}}else if(p)o.$params.$search=i.search,o.$params.$searchField=i.fieldName;else{var m=i.fieldName.replace(/\./g,"/"),v="'"+i.search.replace(/'/g,"''")+"'";d&&(m="tolower("+m+")",v="tolower("+v+")"),s={$left:u,$op:"$func",$right:m+", "+v}}if(s)if(o.$params.$filter)if(c)o.$params.$filter.$and?o.$params.$filter.push(s):o.$params.$filter={$and:[o.$params.$filter,s]};else{var g=o.$params.$filter;o.$params.$filter={$left:s,$op:"and",$right:g}}else o.$params.$filter=s;i.findFirst&&(r||(o.$params.$top=1),o.$params.nocount=!0)}var y=null,_=!1;if("relation"===o.$type){var b=o.$params.relation;if("."===b.charAt(0)?b=b.substring(2):"/"===b.charAt(0)&&(b=b.substring(1),_=!0),i.$bind){var x=i.$bind.split(".");x.pop();var C=x.join(".");x.length&&t.fullPath===C&&(_=!0),!_&&x.length&&b.indexOf(C)<0&&(b=C+"."+b)}t={documents:t.getValue(b).model(!1)||[]},y=S.Promise.resolve(t)}else if("enum"===o.$type)t={documents:e.data.$value||[]},y=S.Promise.resolve(t);else if("custom"===o.$type&&o.$custom){var k=E.get(o.$custom);y=k?k(o):S.Promise.resolve({documents:[]})}else y=O.execData(o,t,null);if(!n)return y;y?y.then(n):n(null)},remoteSearch:function(e,t){return t.mapping?t.mapping[e]:e},lastSegment:function(e,t){var n=e.split("."),i=n.pop();return t&&t!==e&&(i=t.substring(n.join(".").length)),i},hasProperty:function(e,t,n){for(var i=t,o=0,r=e.split(".");o<r.length;o++){var s=r[o];if("$"!==s.charAt(0)){if(!i.properties)return!1;if(!(i=i.properties[s]))return!1;!i.type&&i.$ref&&(i=_(i,n)),"array"===i.type&&(i=_(i.items,n))}}return!0},findFirst:function(e,t,n){if(!e||!n)return null;for(var i=e.toLocaleLowerCase(),o=i.length,r=null,s=0,a=n.length;s<a;s++){var l=(n[s][t]||"").toLowerCase();if(l.substr(0,o)===i)return{item:n[s],index:s};!r&&0<=l.indexOf(i)&&(r={item:n[s],index:s})}return r},_states:["$states","$links"],isMetaProp:function(e){return"$$"===e.substr(0,2)},isMeta:function(e){var t="$$meta-".length;return"$$meta-"===e.substr(0,"$$meta-".length)?{widget:e.substr(t)}:null},getLookup:function(e,t,n,i){var o=e.split(".");o.pop();for(var r=n,s=0,a=o.length;s<a&&r;s++){var l=o[s];0<=b.arrayProps.indexOf(l)||((r=r.properties?r.properties[l]:null)&&!r.type&&r.$ref&&(r=_(r,i)),r&&"array"===r.type&&(r=_(r.items,i)))}return r&&r.lookups?b.checkLookup(r.lookups[t]):null},getSchema:function(e,t,n,i){if(!e)return t;for(var o=e.split("."),r=t,s=!1,a=0,l=o.length;a<l&&r;a++){var u=o[a],d=u.indexOf("[");if(0<d&&(u=u.substr(0,d)),!r.type&&r.$ref&&(r=_(r,n)),"array"===r.type){if("$links"===u){r=r.links,s=!0;continue}0<=b.arrayProps.indexOf(u)?r=_(r.items,n):a<o.length-1&&b.arrayProps.indexOf(o[a+1])<0&&(r=_(r.items,n))}else if("$links"===u)r=r.links,s=!0;else{if(s){s=!1,(r=r[u]).isLink=!0;break}if((r=r.properties?r.properties[u]:null)&&"array"===r.type&&0<d&&(r=_(r.items,n)),!r&&a===l-1){if(u===c.INDEX_FIELD_NAME)return{type:"integer",title:"#",capabilities:null};if(u===c.SELECTED_FIELD_NAME)return{type:"boolean",title:p.ui.Selected,capabilities:null};if(u===c.EXPANDED_FIELD_NAME)return{type:"integer",title:"",capabilities:null}}}}return i&&r&&"array"===r.type&&r.items&&(r=_(r.items,n)),r},states:["isHidden","isDisabled","isReadOnly","isMandatory","style","maxLength"],statesAndErrors:["isHidden","isDisabled","isReadOnly","isMandatory","errors","filter","symbol","decimals","maxLength","style","search","selected","columns","orderBy","filter","pageSize","totalCount","pageNumber"],linksStates:["isHidden","isDisabled"],isLink:function(e){return 0<=e.split(".").indexOf("$links")},_isMoney:function(e){return b.isNumber(e)&&"money"==e.format},_internalExtractEnums:function(o,i,r,s){if(o.name){if(0<=s.indexOf(o.name))return;s.push(o.name)}var a=function(e,t){if((t=t||o).enums&&t.enums[e]){var n=t.enums[e].type||"default";r[n]=r[n]||{},r[n][e]=t.enums[e]}else{var i=e.split(".");2===i.length&&(r[i[1]]=r[i[1]]||{},r[i[1]][i[0]]={type:i[1]})}};o.lookups&&Object.keys(o.lookups).forEach(function(e){var t=o.lookups[e];"enum"===t.data.$type&&t.data.$enumref&&a(t.data.$enumref)}),Object.keys(o.properties).forEach(function(e){var t=o.properties[e];if(!t.type&&t.$ref&&(t=_(t,i)),b.inModel(t,i))if(b.isCompositionRef(t,i))b._internalExtractEnums(t,i,r,s);else if(b.isCompositionList(t,i,!0)){if(t.items.$ref){if(0<=s.indexOf(t.items.$ref))return;s.push(t.items.$ref)}b._internalExtractEnums(_(t.items,i),i,r,s)}else{var n=o;b.isSimpleList(t,i)&&(n=t=_(t.items,i)),t.$enumref&&a(t.$enumref,n)}})},_extractEnums:function(e,t){return b._internalExtractEnums(e,e,t,[])},_fillEnumsFromData:function(r,s,a,l){r._id=r._id||S.allocID(),0<=l.indexOf(r._id)||(l.push(r._id),Object.keys(r.properties||{}).forEach(function(e){var t=r.properties[e];if(t.$ref&&!t.type&&(t=_(t,s)),b.inModel(t,s))if(b.isCompositionRef(t,s))b._fillEnumsFromData(t,s,a,l);else if(b.isCompositionList(t,s,!0))b._fillEnumsFromData(_(t.items,s),s,a,l);else{if(b.isSimpleList(t,s)&&(t=_(t.items,s)),t.enum&&!Array.isArray(t.enum)&&t.enum.arrayProperty&&t.enum.code&&t.enum.title){var n=S.getValue(a,t.enum.arrayProperty),i=[],o=[];Array.isArray(n)&&n.forEach(function(e){i.push(e[t.enum.code]),o.push(e[t.enum.title])}),t.enum=i,t.enumNames=o}}}))},fillEnumsFromData:function(e,t){b._fillEnumsFromData(e,e,t,[])},_fillEnums:function(e,t){b._internalFillEnums(e,e,t,[])},_internalFillEnums:function(a,l,u,d){if(a.name){if(0<=d.indexOf(a.name))return;d.push(a.name)}a.lookups&&Object.keys(a.lookups).forEach(function(e){var i=a.lookups[e];if("enum"==i.data.$type&&i.data.$enumref){var t=i.data.$enumref.split("."),n=2===t.length?u[t[1]]:u[a.enums[i.data.$enumref].type||"default"],o=2===t.length?t[0]:i.data.$enumref;if(n){i.data.$value=[];var r=n[o];r.enum.forEach(function(e,t){var n={code:e,title:r.enumNames[t]};r.fields&&S.extend(n,r.fields[t]),i.data.$value.push(n)})}}}),Object.keys(a.properties).forEach(function(e){var t=a.properties[e];if(t.$ref&&!t.type&&(t=_(t.items,l)),b.inModel(t,l))if(b.isCompositionRef(t,l))b._internalFillEnums(t,l,u,d);else if(b.isCompositionList(t,l,!0))b._internalFillEnums(_(t.items,l),l,u,d);else{var n=a;if(b.isSimpleList(t,l)&&(n=t=_(t.items,l)),t.$enumref){var i=t.$enumref.split(".");if(n.enums&&n.enums[t.$enumref]||2===i.length){var o=2===i.length?u[i[1]]:u[n.enums[t.$enumref].type||"default"],r=2===i.length?i[0]:t.$enumref;if(o){var s=o[r];s&&(t.enum=s.enum,t.enumNames=s.enumNames,t.filters=s.filters)}}}}})},loadEnums:function(e){var n={};b._extractEnums(e,n);var t=Object.keys(n).map(function(e){var t=a.get(e);if(!t)throw"Invalid enum type: "+e;return t.promise(n[e],e)});return t.length?t:null},arrayProps:["$item","$new","$selected"],init:function(c,p,h,e,f,m){if(null===e)return e;void 0===e&&(e={$undefined:!0});var v=e||{};return v._schema_initialized||(v._schema_initialized=!0,v.$create=f,v.$states=v.$states||{},Object.keys(c.properties).forEach(function(e){var t=c.properties[e];if(!t.type&&t.$ref&&(t=_(t,p)),b.inModel(t,p)){var n=b.isMetaProp(e),i=c.states?c.states[e]:null,o=v.$states[e]=v.$states[e]||{};if(n||i&&Object.keys(i).forEach(function(e){void 0===o[e]&&(o[e]=i[e])}),b.isCompositionRef(t,p))v[e]=b.init(t,p,h,v[e],f,{children:m.children,select:m.select});else if(b.isCompositionList(t,p,!1)){v[e]=v[e]||[];var r=m.select&&(!t.children||t.children!==m.children),s={children:t.children,select:m.select},a=_(t.items,p),l=null,u=v.$states?v.$states[e]:null,d=null;u&&u.selected&&(d=JSON.parse("["+u.selected+"]")),v[e].forEach(function(e,t){e.id&&d&&0<=d.indexOf(e.id)&&(e.$select=!0),r&&0===t&&void 0===e.$select&&(l=e),e.$select&&(l=null),b.init(a,p,h,e,f,s)}),l&&!t.syncSelected&&!1!==t.autoSelect&&(l.$select=!0)}else if(b.isSimpleList(t,p));else if(b.isList(t,p));else if(f&&void 0===v[e])if(void 0!==t.default&&null!==t.default)v[e]=b._getDefault(t.default);else if(t.enum)v[e]=t.enum[0];else switch(t.type){case"number":case"integer":void 0!==t.default&&(v[e]=t.default)}}})),v},isCompositionRef:function(e,t){return!e.type&&e.$ref&&(e=_(e,t)),"object"===e.type&&!e.$reference},isRef:function(e,t){return"object"===e.type&&e.$reference},isList:function(e,t){return!e.type&&e.$ref&&(e=_(e,t)),"array"===e.type&&e.$reference},isCompositionList:function(e,t,n){if(!e.type&&e.$ref&&(e=_(e,t)),"array"===e.type&&e.items){var i=_(e.items,t);return("object"===i.type||"array"===i.type)&&(!e.$reference||n&&e.$reference)}return!1},isSimpleList:function(e,t){if(!e.type&&e.$ref&&(e=_(e,t)),"array"===e.type&&e.items){var n=_(e.items,t);return("object"!==n.type||"array"===n.type)&&!e.$reference}return!1},inModel:function(e,t){return!b.isRef(e,t)},formatNumber:function(e,t){return"money"==e.format?u.money(t,!1):u.decimal(t,e.decimals||0,null)},_title:function(e,t){return t?u.tt(e,t):e},canSort:function(e){return!!e&&(!e.isLink&&(!e.hidden&&(o(e),e.features.sortable)))},canShowField:function(e){return!e.hidden},canFilter:function(e){return!!e&&(!e.hidden&&(o(e),e.features.filtrable))},canSearch:function(e){return!!e&&(!e.hidden&&(o(e),e.features.searchable))},checkNumber:function(e,t,n,i,o,r){var s=!0;return!(!n.nullable||null!=e)||(e=e||0,n.exclusiveMinimum?null!=n.minimum&&e<=n.minimum&&(o.push({message:S.format(d.minNumberExclusive,b._title(n.title,i),b.formatNumber(n,n.minimum))}),r&&r.addChildError(o[o.length-1].message),s=!1):null!=n.minimum&&e<n.minimum&&(o.push({message:S.format(d.minNumber,b._title(n.title,i),b.formatNumber(n,n.minimum))}),r&&r.addChildError(o[o.length-1].message),s=!1),n.exclusiveMaximum?null!=n.maximum&&e>=n.maximum&&(o.push({message:S.format(d.maxNumberExclusive,b._title(n.title,i),b.formatNumber(n,n.maximum))}),r&&r.addChildError(o[o.length-1].message),s=!1):null!=n.maximum&&e>n.maximum&&(o.push({message:S.format(d.maxNumber,b._title(n.title,i),b.formatNumber(n,n.maximum))}),r&&r.addChildError(o[o.length-1].message),s=!1),s)},validateEmail:function(e,t){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)},validatePattern:function(e,t,n){return new RegExp(t).test(e)},validatePhone:function(e,t){for(var n=e||"",i=0;i<n.length;i++){var o=n.charAt(i);if("+-() 0123456789.".indexOf(o)<0)return!1}return!0},validateUrl:function(e,t){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i.test(e)},_validateJson:function(e,t){try{JSON.parse(e)}catch(e){return t.ex=e,!1}return!0},checkString:function(e,t,n,i,o,r){var s=!0,a=e||"";if(!t.isMandatory&&""===a)return s;if(n.minLength&&a.length<n.minLength&&(o.push({message:S.format(d.minLength,b._title(n.title,i),n.minLength)}),r&&r.addChildError(o[o.length-1].message),s=!1),t.isMandatory&&""===a&&(o.push({message:S.format(d.required,b._title(n.title,i))}),r&&r.addChildError(o[o.length-1].message),s=!1),n.format)if("email"===n.format)e&&!b.validateEmail(e,{})&&(o.push({message:d.invalidEmail}),r&&r.addChildError(o[o.length-1].message),s=!1);else if("phone"===n.format){var l={};e&&!b.validatePhone(e,l)&&(o.push({message:d.invalidPhone}),r&&r.addChildError(o[o.length-1].message),s=!1)}else if("url"===n.format){l={};e&&!b.validateUrl(e,l)&&(o.push({message:d.invalidUrl}),r&&r.addChildError(o[o.length-1].message),s=!1)}else if("json"===n.format){l={};e&&!b._validateJson(e,l)&&(o.push({message:l.ex.message}),r&&r.addChildError(o[o.length-1].message),s=!1)}if(n.pattern){l={};e&&!b.validatePattern(e,n.pattern,l)&&(o.push({message:d.invalidChars}),r&&r.addChildError(o[o.length-1].message),s=!1)}return s},validatePassword:function(e,t,n,i,o,r){var s=!0;return i.isHidden||i.isDisabled||e!==t&&(r.push({message:d.passwordMismatch}),s=!1),s},validateSchema:function(e,t,n,i,o,r,s){var a=!0;if(t){if(n&&(n.isHidden||n.isDisabled))return a;switch(t.type){case"number":case"integer":a=b.checkNumber(e,n,t,i,o,s);break;case"string":a=b.checkString(e,n,t,i,o,s)}return a}},loadEnumsPromise:function(n){var e=b.loadEnums(n);return e?S.Promise.all(e).then(function(e){var t={};return e.forEach(function(e){t[e.type]=e.enums}),b._fillEnums(n,t),n}):new S.Promise(function(e,t){e(n)})},loadSchemaRefs:function(d,c,p,h,f,m,v){if(!d)return v(null,null);var e=function(){try{b.expandSchema$Ref(d);var r=-1,e=b.loadEnums(d),t=e||[],s=e?e.length:0,n=c;if(h&&((n=n||{})._$model=h),f){n=n||{};var i=f.form.$model.model(!0);if(n.$transactionId=f.form.syncTransactionId(),i&&i.pages){var o=JSON.parse(i.pages);n.parentModel=o[f.name],n.parentModel&&(n.parentModel.model=f.form.$model)}}var a=m&&m.design?S.Promise.resolve({}):x.loadMainData({modal:m._modalForm,datasets:p.datasets,transform:p.transform,context:n},!0);a&&t.push(a);var l=a?s+1:0,u=b.extractClassNames(d,d);if(u&&d.loadRules&&k.external.ruleLoaderHandler&&(t.push(g.ruleLoaderHandler(Object.keys(u))),r=t.length-1),!t.length)return v(null,c);y.processing(!0),S.Promise.all(t).then(function(n){y.processing(!1);var i={},o=null;if(n.forEach(function(e,t){t<s?i[e.type]=e.enums:t<l&&$.extend(c,e),t===r&&(o=n[r])}),d.rules&&(o=o?o.concat(d.rules):d.rules),o&&o.length){var e=b.expandRules(o,u);d.rules=e.rulesbyClass,d.rulesMap=e.rulesById}else delete d.rules;s&&b._fillEnums(d,i),v(null,c)}).catch(function(e){y.processing(!1),v(e,null)})}catch(e){v(e,null)}},t=p.before?E.get(p.before):null;t?t().then(function(){e()}).catch(function(e){v(e,null)}):e()},stateProps:function(e){return e.enum&&e.filters?["filter"]:e.items&&e.items.enum&&e.items.filters?["filter"]:b.isNumber(e)?["symbol","decimals"]:"array"===e.type&&e.items&&"object"===e.items.type&&!e.items.$reference?["orderBy","selected","filter","search","columns"]:void 0},isPassword:function(e){return"string"===e.type&&"password"===e.format},isDate:function(e){return"string"===e.type&&"date"===e.format},isDateTime:function(e){return"string"===e.type&&"date-time"===e.format},isBoolean:function(e){return"boolean"===e.type},isSelectField:function(e){return e===c.SELECTED_FIELD_NAME},isExpandField:function(e){return e===c.EXPANDED_FIELD_NAME},isNumber:function(e){return"number"===e.type||"integer"===e.type},isText:function(e){return"string"===e.type&&("json"===e.format||"memo"===e.format)},isMoney:function(e){return b.isNumber(e)&&"money"===e.format},hasSymbol:function(e){return b.isNumber(e)&&("money"===e.format||"rate"===e.format||e.symbol)},places:function(e){var t=e.decimals||0;return 1e3===e.moneyUnitCoef?0:t},text2Value:function(e,t,n){if(b.isNumber(t)){if(t.nullable&&(""===e||null==e))return;var i=n.decimals,o="number"==typeof e?e:u.string2Float(e||"");return n.moneyUnitCoef&&1!==n.moneyUnitCoef&&(o*=n.moneyUnitCoef,i=0),o=parseFloat(o.toFixed(i))}if("string"!==t.type||""!==e&&null!==e)return e},value2Text:function(e,t,n){if(b.isMoney(t)){var i=n.decimals||0;return t.nullable&&null==e?"":(n.moneyUnitCoef&&1!==n.moneyUnitCoef&&(i=0,"number"!=typeof e&&(e=parseFloat(e||"0")),e/=n.moneyUnitCoef),u.decimal(e,i,null))}return b.isNumber(t)?u.decimal(e,n.decimals,null):e||""},expand$Ref:function(e,t){return _(e,t)},parsePath:function(e,t,n){var i=t.substr(e.length+1),o=i.split("."),r=o.shift();if(!n)return e+"."+r;i=o.join(".");for(var s=[e,r],a=n+".$item.",l=a.length,u=n+".$selected.",d=a.length;;)if(i.substr(0,l)===a)s.push(n+".$item"),i=i.substr(l);else{if(i.substr(0,d)!==u)break;s.push(n+".$selected"),i=i.substr(d)}return i===n&&s.push(i),s.join(".")},registerValidator:e.register,getValidator:e.get,registerEnumManager:a.register,getEnumManager:a.get},x={extractDatasets:function(i,o){if(i.datasets){var e=Object.keys(i.datasets);if(e.length){var r=[];return e.forEach(function(e){var t=i.datasets[e];if(!o||!1!==t.$autoOpen){var n=$.extend({},t,!0);n.name=e,r.push(n)}}),r}}return null},isQuery:function(e){return!("odata"!==e.$type&&"find"!==e.$type&&"relation"!==e.$type&&"enum"!==e.$type||e.$method&&"GET"!==e.$method.toUpperCase()||e.$params.hasOwnProperty("$entityId"))},isCreateOrUpdate:function(e){return"odata"===e.$type&&e.$params.hasOwnProperty("$entityId")},extractMainDataSource:function(t){var n=null;if(t.datasets){var e=Object.keys(t.datasets);e.length&&(e.forEach(function(e){t.datasets[e].$main&&((n=$.extend({},t.datasets[e],!0)).name=e)}),n||((n=$.extend({},t.datasets[e[0]],!0)).name=e[0]))}return n},datasetsAsPromise:function(e,d,t){return new S.Promise(function(r,s){var a={};y.processing(!0);var l=null,u=[];e.forEach(function(e){e.$main&&(l=e)}),l||((l=e[0]).$main=!0),l.children&&Object.keys(l.children).forEach(function(e){l.children[e].name=e,u.push(l.children[e])}),x.isCreateOrUpdate(l)&&(l.$create=l.$create||{}),h.executeDatasets(e,t||{},a,{},function(e,t){if(y.processing(!1),t)s(t);else{var i=$.extend({},a[l.name]||{});if(i.$datasets=a,u&&u.length){y.processing(!0);var o={};return h.executeDatasets(u,i,o,{},function(e,t){if(delete i.$datasets,i=void 0,y.processing(!1),Object.keys(o).forEach(function(e){a[e]=o[e]}),O.execOutputData(l,a),d){var n=E.get("datasets.transform."+d);n&&n(a)}r(a[l.name])},!1)}if(O.execOutputData(l,a),d){var n=E.get("datasets.transform."+d);n&&n(a)}r(a[l.name])}})})},datasetAsPromise:function(r,e){return new S.Promise(function(n,i){var o={};r.name=r.name||"data",y.processing(!0),h.executeDatasets([r],e||{},o,{},function(e,t){y.processing(!1),t?i(t):n(o[r.name])})})},loadMainData:function(e,t){var n=x.extractDatasets(e,t);if(n&&n.length){var i=n[0];return e.modal&&"sync"===i.$type&&(i.$params=i.$params||{},i.$params.$modal=!0),x.datasetsAsPromise(n,e.transform,e.context)}return S.Promise.resolve(null)},dsConfig:function(e,t,n){var i=t.$reference;if(e&&i){var o=Object.keys(e);if(1===o.length){var r=e[o[0]];return r.$main=!0,r.name=o[0],r}if("string"==typeof i){var s=e[i];return s.name=i,s}}return null}},C={_enums:{},promise:function(n,i){var o={};return Object.keys(n).forEach(function(e){var t=n[e];C._enums[e]||(C._enums[e]={enum:t.enum,enumNames:t.enumNames,filters:t.filters}),o[e]=C._enums[e]}),new S.Promise(function(e,t){e({type:i,enums:o})})}};b.registerEnumManager("default",C),c.SchemaUtils=b,c.DataUtils=x}(k.Observable||(k.Observable={}))}(Phoenix||(Phoenix={})),function(e){var t,n,s=e,o=s.pagecontrol,a=s.Observable.SchemaUtils,l=s.utils,d=s.dom;t=e.formdropitems||(e.formdropitems={}),n=function(){function u(e,t,n){this.opened=!1;var i=this;i.page=o.Page(),i.opened=!1,i.currentList=null,i.$parent=e,i._checkOptions(n),i.options=n,i.$input=t,i.keys=a.pkFields(i.options.primaryKey)}return u.prototype.click=function(e){var t=s.bootstrap4,n=d.parentByTag(this.$element.get(0),e.target,t?"a":"li");if(n){var i=n.pk;if(i){var o=this._map(),r=this._selectByPk(i,o);r&&this._doSelect(r,!0)}}},u.prototype.inMenu=function(e){return!(!e||!this.$element)&&d.isChildOf(this.$element.get(0),e)},u._itemHeight=function(){if(!this.itemHeight){var e=void 0;e=s.bootstrap4?$('<div class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><a tabindex="-1" class="dropdown-item" href="#">A</a></div>').get(0):$('<ul class="dropdown-menu bs-block" tabindex="0" style="visibility:hidden;"><li tabindex="-1"><a tabindex="-1" href="#">A</a></li></ul>').get(0),document.body.appendChild(e);var t=e.firstChild;this.itemHeight=t.offsetHeight,this.deltaHeight=e.offsetHeight-this.itemHeight,document.body.removeChild(e)}return this.itemHeight},u.prototype._checkOptions=function(e){if(!e.primaryKey)throw new Error("Invalid options no primaryKey.");if(!e.search)throw new Error("Invalid options search field.");e.display=e.display||e.search,e.maxItems=e.maxItems||8},u.prototype._renderContent=function(){var e=s.bootstrap4;this.$element||(this.$element=e?$('<div class="dropdown-menu"></div>'):$('<ul class="dropdown-menu"></ul>'),this.$parent.get(0).appendChild(this.$element.get(0)))},u.prototype._renderElements=function(){var i=this,o=s.bootstrap4;if(i.$element||i._renderContent(),i.currentList){var r=document.createDocumentFragment(),e=i.$element.get(0);i.currentList.forEach(function(e){var t,n=a.pk2Id(a.extractPkValue(e,i.keys),i.keys);(t=o?$('<a tabindex="-1" class="dropdown-item" href="#">'+l.escapeHtml(e[i.options.display])+"</a>").get(0):$('<li class="dropdown-item" tabindex="-1"><a tabindex="-1" href="#">'+l.escapeHtml(e[i.options.display])+"</a></li>").get(0)).pk=n,d.append(r,t)}),d.empty(e),d.append(e,r)}},u.prototype._afterHide=function(e){var t=this;t.opened=!1,t.page&&t.page.setPopup(null),t.$input&&t.$input.get(0).focus()},u.prototype.hide=function(e){var t=this;if(t.opened&&t.$element){var n=t.$element.get(0);d.removeClass(n,"bs-block"),t.opened=!1,t.page&&t.page.setPopup(null)}},u.prototype._selectByListIndex=function(e,t){for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o.listIndex===t)return o}return null},u.prototype._emptyHtmlList=function(){this.$element&&d.empty(this.$element.get(0))},u.prototype._show=function(e){var t=this;if(t.$element){var n=t.$element.get(0);if(n.childNodes.length){var i=-1,o=t._map(),r=t._findSeleted(o);r&&(i=r.listIndex);var s=t.$parent.get(0).offsetWidth;if(n.style.minWidth=s+"px",n.style.maxHeight=t.options.maxItems*u._itemHeight()+u.deltaHeight+"px",n.style.overflowY="auto",d.addClass(n,"bs-block"),i!=e){if(r){var a=n.childNodes[r.index];d.removeClass(a,"active"),r.selected=!1}if(0<=e){r=t._selectByListIndex(o,e);var l=n.childNodes[r.index];d.addClass(l,"active"),r.selected=!0,t._isInView(l,n)||l.scrollIntoView(!0)}else n.scrollTop=0}t.page&&t.page.popup!=t&&t.page.setPopup(t),d.addClass(n,"bs-block"),t.opened=!0}else d.removeClass(n,"bs-block"),t._afterHide(!0)}},u.prototype.triggerBlurred=function(e){this.hide(null)},u.prototype.show=function(e,t,n){var i=this;if(!(e&&e.value&&e.value.length))return i.currentList=null,i.hide(null),void i._emptyHtmlList();i.currentList==e.value||(i.currentList=e.value,i._renderElements()),i._show(t)},u.prototype._map=function(){for(var e=[],t=!1,n=this.$element.get(0),i=0,o=0,r=n.childNodes.length;o<r;o++){var s=n.childNodes[o];if(s.pk){var a=!t&&d.hasClass(s,"active");a&&(t=!0),e.push({id:s.pk,index:o,selected:a,listIndex:i}),i++}}return e},u.prototype._selectByPk=function(e,t){for(var n=null,i=this.$element.get(0),o=0,r=(t=t||this._map()).length;o<r;o++){var s=t[o];if(s.id===e){if((n=s).selected)break;d.addClass(i.childNodes[s.index],"active"),s.selected=!0}else if(s.selected&&(d.removeClass(i.childNodes[s.index],"active"),s.selected=!1,n))break}return n},u.prototype._findSeleted=function(e){for(var t=0,n=(e=e||this._map()).length;t<n;t++){var i=e[t];if(i.selected)return i}return null},u.prototype._isInView=function(e,t){var n=e.offsetTop,i=e.offsetHeight,o=t.scrollTop,r=this.options.maxItems*u._itemHeight();return o<=n&&n+i<=o+r},u.prototype.move=function(e){var t=this;if(t.$element&&t.opened){var n=t._map(),i=t.$element.get(0),o=t._findSeleted(n),r=void 0;if(0<e){if(o){if((r=1e3===e?n.length-1:n.indexOf(o)+e)>=n.length&&n[r=n.length-1].selected)return}else r=0;if(r<n.length){o&&(d.removeClass(i.childNodes[o.index],"active"),o.selected=!1);var s=i.childNodes[n[r].index];d.addClass(s,"active"),n[r].selected=!0,r==n.length-1?i.scrollTop=s.offsetTop+u._itemHeight()+1:t._isInView(s,i)||s.scrollIntoView(!1),t._doSelect(n[r],!1)}}else{if(o){if((r=-1e3===e?0:n.indexOf(o)+e)<0&&n[r=0].selected)return}else r=n.length-1;if(0<=r){o&&(d.removeClass(i.childNodes[o.index],"active"),o.selected=!1);s=i.childNodes[n[r].index];d.addClass(s,"active"),n[r].selected=!0,0==r?i.scrollTop=0:t._isInView(s,i)||s.scrollIntoView(!0),t._doSelect(n[r],!1)}}}},u.prototype.select=function(){if(this.$element&&this.opened){var e=this._findSeleted();e&&this._doSelect(e,!0)}},u.prototype._doSelect=function(e,t){t&&(this.options.onselect&&this.options.onselect(a.findByPk(a.id2Pk(e.id,this.keys),this.keys,this.currentList)),this.hide(null))},u.prototype.inPopup=function(e){if(this.$element){var t=this.$element.get(0).parentNode;return d.isChildOf(t,e)}return!1},u.prototype.destroy=function(){this.options=null,this.currentList=null,this.$input=null,this.$parent=null,this.$element=null},u.itemHeight=0,u.deltaHeight=0,u}(),t.DropItems=n}(Phoenix||(Phoenix={})),function(n){var e,C,t,i=n,l=i.link,o=(i.menubase,i.preferences),r=i.application,s=i.device,a=i.utils,u=i.locale,d=n.contextmenu,k=i.dom;e=n.menu||(n.menu={}),C=function(e){var t=["bs-menu-right-icon normal"];return e.collapsed?t.push(k.iconClass("plus")):t.push(k.iconClass("minus")),t.join(" ")},t=function(i){function e(e,t){var n=i.call(this,e,t)||this;return n.id=a.allocID(),n}return __extends(e,i),e.prototype._checkSearchPopupMenu=function(){if(!this._menu){var e=this._searchInput();if(!e)return;var t=$(e.parentNode);this._menu=new n.formdropitems.DropItems(t,e,{primaryKey:"id",search:"title"})}},e.prototype._searchInput=function(){return this.$element?k.find(this.$element.get(0),this.id+"_search"):null},e.prototype._initOptions=function(e){r.configuration=r.configuration||{};var t=r.configuration.header||{};(e=e||{}).typeMenu=e.typeMenu||"left",e.replaceParent=!0,e.canStayInPage=!!e.inline||!s.phone&&!s.tablet,e.autoClose=!e.inline&&(!e.canStayInPage||o("menu_"+e.type+"_autoClose")),void 0===e.autoClose&&(e.autoClose=!0),e.auth=void 0===t.authLeftMenu||t.authLeftMenu,t["menu"+e.typeMenu]&&a.merge(t["menu"+e.typeMenu],e),e.styles=e.styles||{root:"$upper",parent:"",leaf:""},e.canExpandItems=!0},e.prototype._updateSearch=function(){},e.prototype._hideContent=function(e){var t=this.$content.get(0);if(this.options.bodyId){var n=k.find(null,this.options.bodyId);n&&k.removeClass(n,"bs-pc-body-"+this.options.typeMenu)}k.removeClass(t,"bs-menu-opened"),k.addClass(t,"bs-menu-closed"),this.options.bodyId&&(!this.options.autoClose||e&&this.options.autoClose)&&a.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},e.prototype._showContent=function(){var e=this.$content.get(0),t=!1;if(this.options.bodyId&&!this.options.autoClose){t=!0;var n=k.find(null,this.options.bodyId);n&&k.addClass(n,"bs-pc-body-"+this.options.typeMenu)}k.removeClass(e,"bs-menu-closed"),k.addClass(e,"bs-menu-opened"),this.options.canStayInPage?k.addClass(e,"large"):k.addClass(e,"phone"),t&&a.nextTick(function(){$(window).trigger("phoenix-resize"),$(window).trigger("gobal-phoenix-resize")})},e.prototype._switchAutoClose=function(){var e=!o("menu_"+this.options.type+"_autoClose");return o("menu_"+this.options.type+"_autoClose",e),this.options.autoClose=e,this.options.autoClose?this.page.setPopup(this):this.page.popup=null,this._updateCloseButton(this.$content)},e.prototype._doCloseClick=function(){this.options.canStayInPage?(this._switchAutoClose()?this.hide(!0):this._showContent(),this.page.props["$menu"+this.options.typeMenu]=this.options.autoClose):this.hide()},e.prototype.copyMenuItemData=function(e,t){e.$icon=t.$icon},e.prototype._updateCloseButton=function(e){var t=!1,n=e.get(0),i=k.query(n,".bs-menu-button");if(i)return this.options.canStayInPage?(k.removeClass(i,k.iconClass("times",!0)),this.options.autoClose?(k.removeClass(i,k.iconClass("times-circle-o",!0)),k.addClass(i,"small"),k.addClass(i,k.iconClass("thumb-tack",!0)),t=!0):(k.removeClass(i,k.iconClass("thumb-tack",!0)),k.removeClass(i,"small"),k.addClass(i,k.iconClass("times-circle-o",!0)))):(k.removeClass(i,k.iconClass("thumb-tack",!0)),k.removeClass(i,k.iconClass("times-circle-o",!0)),k.addClass(i,k.iconClass("times",!0))),k.removeClass(i,"bs-none"),t},e.prototype.renderContent=function(){var e=this.options,t=$('<div class="bs-menu-wrap bs-scrollbar bs-menu-closed bs-menu-'+e.typeMenu+'-wrap"></div>'),n=t.get(0);e.inline&&k.addClass(n,"parent");var i=this.page.childByType("header");if(i&&i.$element){var o=k.offset(i.$element.get(0));s.phone||s.tablet||(k.supportCssCalc()?(n.style.top=o.height+"px",n.style.height="calc(100% -  "+o.height+"px)"):n.style.paddingTop=o.height+"px",n.style.zIndex="1000")}return t},e.prototype._changeSelected=function(e){if(this.$element)for(var t=e;t;){var n=k.find(this.$element.get(0),t.$id);n&&(e.selected?k.addClass(n,"active"):k.removeClass(n,"active")),t=this._map[t.$parentId]}},e.prototype._selectDatasetItem=function(t,n){var i=this,o=null;i.items.forEach(function(e){e.$dataset===t&&(e===n?e.selected||(e.selected=!0,i._changeSelected(e)):e.selected&&(e.selected=!1,i._changeSelected(e),o=e))}),i._expandSelected(o)},e.prototype._expandSelected=function(e){for(var t=[],n={},i=e;i;)t.push(i),n[i.$id]=!0,i.collapsed=!1,i=this._map[i.$parentId];this.items.forEach(function(e){e.collapsed||n[e.$id]||(e.collapsed=!0)}),this.updateItemsAfterCollapse();var o=t.reverse().map(function(e){return e.$title});this.data&&this.data.$moduleTitle&&o.unshift(this.data.$moduleTitle);var r=this.page.childByType("header");r&&r.setLocation(o.join(" - "),!1)},e.prototype._canClick=function(e){return e.$link},e.prototype.render=function(e){i.prototype.render.call(this,e),this._onPageChanged()},e.prototype.renderItems=function(){var v=this,e=$('<ul class="bs-item-list"></ul>'),g=e.get(0),y=$('<li class="link"><a><span class="title"></span></a></li>').get(0),_=$('<li class="parent"><span class="title"></span></li>').get(0),b=($('<li class="parent"><span class="title"></span></li>').get(0),$('<li class="divider"><span class="title"></span></li>').get(0));if(v.items){var x=v.items.length;v.items.forEach(function(e,t){if(!e.isHidden){var n;if(e.divider)n=b.cloneNode(!0),k.text(n.firstChild,e.$title||String.fromCharCode(160));else{var i=v.options.canExpandItems&&e.$items&&e.$items.length,o=!1,r="";if(t<x-1){var s=v.items[t+1];o=(s.$level||0)>(e.$level||0)&&!s.$parentId}var a=!!e.$link;if(n=a||i?y.cloneNode(!0):_.cloneNode(!0),e.$items?(r=e.$parentId?"parent":"root",k.addClass(n,"bs-menu-item-parent")):e.$parentId&&(r="leaf"),e.$level?(e.$parentId||k.addClass(n,"level"),k.addClass(n,"level-"+e.$level)):o&&k.addClass(n,"level"),r){var l=null;if(v.options.styles&&v.options.styles[r]&&(l=v.options.styles[r]),l){var u=[];k.parseStyle(l,u),u.length&&(n.className=n.className+" "+u.join(" "))}}var d=n.firstChild,c=a||i?d.firstChild:d;if(e.$title){var p=e.$icon?" "+e.$title:e.$title;k.text(c,p)}if(e.selected&&k.addClass(n,"active"),a&&(k.attr(d,"data-phoenix-href","click://"+t),v._canClick(e)||k.removeClass(d,"link")),v.options.canExpandItems){if(i){k.attr(n,"data-phoenix-href","click://collapse/"+t);var h=document.createElement("span");h.id=e.$id+"_collapse",h.className=C(e),k.append(n,h)}v.isVisible(e)||(k.addClass(n,"closed"),n.style.height="0px")}if(e.$icon){var f=k.icon(e.$icon);k.addClass(f,"bs-icon-menu"),d.insertBefore(f,d.firstChild)}}if(e.$firstGroup&&!v.options.inline){var m=document.createElement("span");m.className="bs-menu-button bs-menu-right-icon bs-none "+k.iconPrefix(),k.attr(m,"data-phoenix-href","click://close"),k.append(n,m)}n.id=e.$id,g.appendChild(n)}})}return v._updateCloseButton(e),e},e.prototype.updateItemsAfterCollapse=function(){var l=this;l.$element&&l.items&&l.options.canExpandItems&&l.items.forEach(function(e,t){if(!e.isHidden){var n=e.$items&&e.$items.length,i=l.isVisible(e),o=k.find(l.$element.get(0),e.$id);if(o){if(i!==!k.hasClass(o,"closed"))if(i){var r=window.getComputedStyle(o,null).getPropertyValue("line-height");k.removeClass(o,"closed"),o.style.height=r}else k.addClass(o,"closed"),o.style.height="0px";if(n){var s=k.find(l.$element.get(0),e.$id+"_collapse");if(s){var a=C(e);s.className!==a&&(s.className=a)}}}}})},e.prototype._executeLink=function(e,t){var n,i=l.context();if(e.$dataset&&(n=this.datasets[e.$dataset],i.$item=e.$item),n&&e.$link&&e.$link.$datasetSelect)n.selectedIndex!=e.$index&&(n.selectedIndex=e.$index,this.ds_select(e.$dataset,e.$item),this._selectDatasetItem(e.$dataset,e));else if(e.$link)return l.execLink(e.$link,i,null)},e.prototype._executeContextMenu=function(e,t,n){if(t.$link&&t.$link.$page){var i=[{link:$.extend(!0,{},t.$link),title:u.ui.OpenNewTab}];return d.openContextMenu(e,this,i),!0}return!1},e.prototype.contextMenu=function(e){if(e.link){var t=l.context();t.$target="blank",l.execLink(e.link,t,null)}},e.prototype._onPageChanged=function(){var e={page:this.page.currentPage(),module:r.name};this.search="",this.selectItem(e)},e.prototype.selectItem=function(o){var r=this,s=o&&"object"==typeof o&&o.page;if(r.items){var a=null;r.items.forEach(function(e,t){if(e.$link){var n=!1;if(s&&e.$link.$page){(n=l.pageName(e.$link)===o.page)&&e.$link.$module&&(n=e.$link.$module===o.module)}else{var i=l.getLinkExecutor(e.$link);i&&(n=i.equal(o,e.$link))}e.selected!==n&&(e.selected=n,e.selected||r._changeSelected(e)),n&&(a=e)}}),a&&(r._changeSelected(a),r._expandSelected(a))}},e}(n.menubase.MenuBase),e.Menu=t,e.Menuleft=t,e.Menuright=t}(Phoenix||(Phoenix={})),function(e){var t,n,a,d,c,p,h,f,l,m,u,r,i;t=e.ui||(e.ui={}),a=(n=e).pagecontrol,d=n.ulocale,c=n.utils,p=n.locale,h=n.dom,f=n.sticky,l=n.build,m=n.application,u=n.link,r=function(a,e){var l=document.createDocumentFragment(),u=$('<a class="dropdown-item" href="#"></a>').get(0);a.menu.items.forEach(function(e,t){var n;e.$pattern&&(a.menu.items[t]=("logout"===(n=e).$pattern&&(n.icon="lock",n.title=p.ui.Disconnect,n.link={$logout:!0},delete n.$pattern),n),e=a.menu.items[t]);var i=u.cloneNode(!0),o=i;if(h.attr(o,"data-phoenix-href","click://"+a.$index+"/"+t),e.icon){var r=document.createElement("span");r.className=h.iconClass(e.icon),h.append(o,r)}var s=e.title;"object"==typeof e.title&&(s=e.title[d.currentLang]),h.text(o," "+(s||"Error: title not defined")),h.append(l,i)}),h.append(e,l)},i=function(){function e(e,t){this._init(e,t)}return e.prototype.setLocation=function(e,t){var n=this;n.options.showLocation&&(n._locationTimeOut&&window.clearTimeout(n._locationTimeOut),n._locationTimeOut=window.setTimeout(function(){n._locationTimeOut=0,n._location!==e&&(n._location=e||"",n.$location&&h.text(n.$location.get(0).lastChild,n._location))},100))},e.prototype._init=function(e,t){var n=this;n.title="",n._ctx=u.context(),n._ignoreClick=!1,n.leftButtonsSpace=0,n.rightButtonsSpace=0,n.$location=null,n.$element=null,n.$buttons=[],n.options=t||{},n.page=a.Page(),n.title=m.title||"";var i=m.configuration,o=i&&i.header?i.header:{};if(void 0!==n.options.showOnDisconnected?n.options.showOnDisconnected=n.options.showOnDisconnected:n.options.showOnDisconnected=o.alwaysShow,void 0!==o.showLocation&&(n.options.showLocation=o.showLocation),void 0!==o.leftMenuButtonInLocation&&(n.options.leftMenuButtonInLocation=o.leftMenuButtonInLocation),void 0===n.options.backButton&&(n.options.backButton=!0),void 0===n.options.leftMenuButton&&(n.options.leftMenuButton=!0),void 0===n.options.topMenuButton&&(n.options.topMenuButton=!0),void 0===n.options.disconnectButton&&(n.options.disconnectButton=!0),o.logo){var r={$isHidden:!1,$type:"logo"},s="";"string"==typeof o.logo?s=o.logo:(s=o.logo.style,r.link=o.logo.link),r.$className=s,n.$buttons.push(r)}o.buttons&&o.buttons.before&&o.buttons.before.forEach(function(e){n.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),n.options.backButton&&n.$buttons.push({$icon:"chevron-left",$isHidden:!n.page.props.$hasBack&&!n.options._alwaysShowBack,$type:"back",link:{$back:!0}}),n.options.leftMenuButton&&n.$buttons.push({auth:o.authLeftMenu,$isHidden:!0,$icon:"bars",$type:"menuleft",$parent:n.options.leftMenuPlace,$location:n.options.showLocation&&n.options.leftMenuButtonInLocation}),n.options.disconnectButton&&(o.userMenu?n.$buttons.push({$icon:"user",iconStyle:"$icon-normal",right:!0,auth:!0,menu:$.extend(!0,{},o.userMenu),expression:o.userMenu.expression||"John Doe",$type:"user"}):n.$buttons.push({$icon:"power-off",right:!0,auth:!0,$type:"disconnect",link:{$logout:!0}})),n.$buttons.push({$icon:"pencil",right:!0,auth:!0,$isHidden:l.release,$type:"authoring",link:{$authoring:!0}}),l.release||n.$buttons.push({$icon:"cog",title:"Utils",right:!0,auth:!0,menu:{items:[{title:"Create a new form",icon:"building",link:{$action:{name:"phoenix.action.createform"}}},{title:"Modify form schema",icon:"pencil",link:{$action:{name:"phoenix.action.updschema"}}}]}}),n.options.rightMenuButton&&n.$buttons.push({auth:!0,$isHidden:!0,$icon:"ellipsis-v",$type:"menuright",$parent:n.options.rightMenuPlace}),n.options.topMenuButton&&n.$buttons.push({auth:!0,$isHidden:!0,$icon:"chevron-down",$type:"menutop",right:!0,$parent:n.options.topMenuPlace}),o.buttons&&o.buttons.after&&o.buttons.after.forEach(function(e){n.$buttons.push({$icon:e.icon,right:e.right,auth:e.auth,link:e.link,title:e.title})}),n.page.addChild("header",n),n.setData(e)},e.prototype._show=function(){var e=n.sessionPreferences("headerisHidden");return!this._ctx.$url.$inline&&!e||(e||n.sessionPreferences("headerisHidden",!0),!1)},e.prototype.setData=function(e){e=e||{}},e.prototype.buttonByType=function(e){for(var t=0,n=this.$buttons.length;t<n;t++){var i=this.$buttons[t];if(i.$type==e)return i}return null},e.prototype._createButtons=function(){if(this.$element){var e=this.$element.get(0),s=h.query(e,".header_left_buttons"),a=h.query(e,".header_right_buttons"),t=this.$location?this.$location.get(0):null,l=this.$location?h.query(t,".bs-location-buttons"):null;this.$buttons.forEach(function(e,t){e.$index=t;for(var n=function(e,t){var n=[],i="d-none d-sm-inline-block";e.id=c.allocID();var o=e.title;if(o&&"object"==typeof o&&(o=o[d.currentLang]),e.$location)n.push('<span id="{1}" class="bs-loc-link bs-style-icon-lg {2}" href="#" data-phoenix-href="click://{0}"><span>');else{if(n.push('<li id="{1}">'),"logo"===e.$type)e.$location||n.push('<a tabindex="-1" class="'+i+" bs-nav-logo "+e.$className+'" href="#" data-phoenix-href="click://{0}"></a>');else{var r=[];e.iconStyle?h.parseStyle(e.iconStyle,r):r.push("bs-style-icon-lg"),e.title||e.expression?(n.push('<a class="bs-nav-link"'),n.push('  href="#" data-phoenix-href="click://{0}"'),n.push(">"),r.push("{2}"),n.push('<span class="'+r.join(" ")+'"></span>'),(r=["bs-icon-header-title"]).push("dropdown-toggle"),n.push('<span class="'+r.join(" ")+'"><span class="'+i+'">{3}</span>'),r.push("dropdown-toggle"),e.menu&&n.push(' <span class="caret"></span>'),n.push("</span>"),n.push("</a>"),e.menu&&e.menu.items&&(n.push('<div class="dropdown-menu bs-right-menu">'),n.push("</div>"))):(n.push('<a class="bs-nav-link" href="#" data-phoenix-href="click://{0}">'),r.push("{2}"),n.push('<span class="'+r.join(" ")+'"></span>'),n.push("</a>"))}n.push("</li>")}return e.link&&e.link.$form&&(e.link.$form.alignElementId=e.id),$(c.format(n.join(""),t,e.id,h.customIconClass(e.$icon,e.$iconClass),o||e.expression||""))}(e,t),i=e.$location?l:e.right?a:s,o=0,r=n.length;o<r;o++)h.append(i,n.get(o))})}},e.prototype._updateButtons=function(){var o=this,e=h.rem2px(.8571);if(o.$element){var r=o.page.props.$user&&o.page.props.$user.connected,s=e,a=e,l=o.$element.get(0);o.$buttons.forEach(function(e){var t=h.find(l,e.id);if(e.$isHidden||!r&&e.auth)h.addClass(t,"bs-none");else{if("user"===e.$type){var n=c.execAngularExpression(e.expression,o.page.props.$user.credentials);if(n!==e.title){e.title=n;var i=h.query(t,".bs-icon-header-title");i&&h.text(i.firstChild,n)}}h.removeClass(t,"bs-none"),e.$location||(e.right?a+=h.offset(t).width:s+=h.offset(t).width)}}),o.leftButtonsSpace===s&&o.rightButtonsSpace===a||(o.leftButtonsSpace=s,o.rightButtonsSpace=a,o._updateTitleSpaceMargins())}},e.prototype._updateTitleSpaceMargins=function(){if(this.$element){var e=this.$element.get(0),t=h.query(e,".header_title");t.style.marginLeft=this.leftButtonsSpace+"px",t.style.marginRight=this.rightButtonsSpace+"px"}},e.prototype.inPopup=function(e){if(this._ob){var t=h.find(this.$element.get(0),this._ob.id);return h.isChildOf(t,e)}return!1},e.prototype.hide=function(e){if(this._ob){var t=h.find(this.$element.get(0),this._ob.id);h.removeClass(t.lastChild,"bs-block"),this._ob=null}},e.prototype._openPopup=function(e){this.page.setPopup(this),this._ob=e;var t=h.find(this.$element.get(0),e.id);h.addClass(t.lastChild,"bs-block")},e.prototype._executeLink=function(e,t){if(e.menu){var n=h.find(this.$element.get(0),e.id);if(n&&n.lastChild&&(n.lastChild.childNodes.length||r(e,n.lastChild)),!(0<=t)){if(this._ob){if(this._ob===e)return void this.page.setPopup(null);this.page.setPopup(null)}if(n&&n.lastChild)n.lastChild.style.minWidth=Math.max(h.offset(n).width,160)+"px";return this._openPopup(e)}var i=e.menu.items[t];i.link&&u.execLink(i.link,u.context(),null),this.page.setPopup(null)}else if(e.link)return e.link.$form&&(e.link.$form.opener=e.id),u.execLink(e.link,u.context(),null);if(0<=["menuleft","menuright","menutop","menubottom"].indexOf(e.$type)&&e.$parent&&this.page){var o=this.page.childByType("menu-"+e.$type.substring(4));o&&o.show($(h.find(null,e.$parent)))}},e.prototype._onresize=function(){this.$element&&this._updateButtons()},e.prototype._setEvents=function(){var s=this,a=s.$element.get(0);s.$element.on("mousedown",function(e){var t=u.isCustomLink(a,e,!0);if(t&&"click"===t.protocol){var n=t.value.substring("click://".length).split("/"),i=(1<n.length&&parseInt(n[1],10),s.$buttons[parseInt(n[0],10)]);if(i)if(0<=["menuleft","menuright","menutop","menubottom"].indexOf(i.$type)){if(i.$parent&&s.page){var o=s.page.childByType("menu-"+i.$type.substring(4));s.page.popup===o&&(s._ignoreClick=!0)}}else i.link&&i.link.$form&&!i.link.$form.modal&&s.page.popup&&s.page.popup.opener&&s.page.popup.opener===i.id&&(s._ignoreClick=!0)}}),s.$element.on("click",function(e){var t=u.isCustomLink(a,e);if(s._ignoreClick)s._ignoreClick=!1;else if(t&&"click"===t.protocol){var n=t.value.substring("click://".length).split("/"),i=1<n.length?parseInt(n[1],10):-1,o=s.$buttons[parseInt(n[0],10)];if(s._executeLink(o,i),o&&"logo"===o.$type){var r=document.activeElement;r&&r.blur()}}}),$(window).on("resize.header",function(){clearTimeout(s._doResize),s._doResize=setTimeout(s._onresize.bind(s),100)})},e.prototype.setPage=function(e,t){if(l.release){var n=m.isCustomizable("pages",e),i=this.buttonByType("authoring");i&&i.$isHidden!=!n&&(i.$isHidden=!n,this._updateButtons())}},e.prototype.onPageChange=function(e,t){var n,i=this;switch(e){case"$title":i.title=t||m.title||"",i._renderTitle();break;case"$hasBack":i.options._alwaysShowBack&&(t=!0),i.options.backButton&&(n=i.buttonByType("back"))&&n.$isHidden!==!t&&(n.$isHidden=!t,i._updateButtons());break;case"$user":i._auth(!1),i._updateButtons();break;case"$menuleft":i.options.leftMenuButton&&(n=i.buttonByType("menuleft"))&&n.$isHidden==t&&(n.$isHidden=!t,i._updateButtons());break;case"$menutop":i.options.topMenuButton&&(n=i.buttonByType("menutop"))&&n.$isHidden==t&&(n.$isHidden=!t,i._updateButtons())}},e.prototype._removeEvents=function(){this.$element.off("mousedown"),this.$element.off("click"),$(window).off("resize.header")},e.prototype.renderButtons=function(){this._createButtons(),this._updateButtons(),c.nextTick(function(){})},e.prototype._renderTitle=function(){if(this.$element){var e=this.$element.get(0),t=h.query(e,".header_title");h.text(t,this.title||"")}},e.prototype._auth=function(e){if(this.$parent&&this._show()){var t=this.$parent.get(0),n=this.$element.get(0),i=!1;if(this.page.props.$user&&this.page.props.$user.connected?(i=!0,h.removeClass(n,"bs-none")):this.options.showOnDisconnected?(i=!0,h.removeClass(n,"bs-none")):h.addClass(n,"bs-none"),!e){var o=h.offset(this.$element.get(0));f.topOffset=i?o.height:0,t.style.paddingTop=i?o.height+"px":"0px"}}},e.prototype.render=function(e){var t,n,i,o=this;if(o._show()&&e&&!this.$element){o.$element=(t=o.options,n=[],(i=["no-y-margin no-x-margin"]).push("fixed-top"),n.push('<div class="'+i.join(" ")+'">'),i=["bs-header-bar no-y-margin no-x-margin no-x-padding no-y-padding bg-dark"],n.push('<nav class="'+i.join(" ")+'">'),n.push('    <div class="container-fluid no-x-padding">'),n.push('        <div class="bs-title bs-title-nav-pos header_title"></div>'),n.push('        <ul class="no-x-margin no-y-margin bs-nav-button bs-left-nav header_left_buttons">'),n.push("        </ul>"),n.push('        <ul class="no-x-margin no-y-margin bs-nav-button bs-right-nav header_right_buttons">'),n.push("        </ul>"),n.push("    </div>"),n.push("</nav>"),t.showLocation&&n.push('<div class="bs-header-location"><span class="bs-location-buttons"></span><span class="bs-header-location-title">&nbsp;</span></div>'),n.push("</div>"),$(n.join("")));var r=o.$element.get(0);o.options.showLocation&&(o.$location=$(r.lastChild));var s=m.configuration,a=s&&s.header?s.header:{},l=h.query(r,".header_title");a.uppercase&&h.addClass(l,"bs-transform-uppercase"),a.align&&h.addClass(l,"align-"+a.align),o._renderTitle(),o.renderButtons();var u=e.get(0);o.options.replaceParent&&(u=u.parentNode),o.$parent=$(u),o._auth(!0),o.options.replaceParent?e.replaceWith(o.$element):e.append(o.$element),o._setEvents();var d=h.offset(o.$element.get(0));f.topOffset=d.height,u.style.paddingTop=d.height+"px",c.nextTick(function(){o._onresize()})}},e.prototype.destroy=function(){c.log("Header Destroy","destroy"),this.$parent=null,this.$element&&(this._removeEvents(),this.$element=null),this.page&&(this.page.removeChild(this),this.page=null)},e}(),t.Header=i}(Phoenix||(Phoenix={})),function(d){var e,t,n,c,p,h,f,m,i;e=d.tabs||(d.tabs={}),n=(t=d).pagecontrol,c=t.dom,p=t.link,h=t.utils,f=t.application,m=t.ulocale,t.locale,i=function(){function e(e,t){this._page=n.Page(),this._options=$.extend({justified:!1,pills:!1},e||{}),this._tabs=t||[]}return e.prototype._renderTabs=function(){var e=this.$element.get(0).firstChild,a=document.createDocumentFragment(),l=$('<li><a href="#"></a><li>').get(0),u=this._page.currentPage();this._tabs.forEach(function(e,t){var n=l.cloneNode(!0),i=n.firstChild;c.text(i,m.localeTitle(e.$title));var o=!1;if(void 0!==e.enabled)if("string"==typeof e.enabled){var r=h.execAngularExpression(e.enabled,p.context());r&&"undefined"!==r&&"false"!==r||(o=!0)}else o=!e.enabled;if(o?c.addClass(n,"disabled"):c.attr(i,"data-phoenix-href","click://"+t),e.$page){var s=p.pageName(e)==u;s&&e.$module&&(s=e.$module===f.name),e.active=!!s}e.active&&c.addClass(n,d.bootstrap4?"show active":"active"),a.appendChild(n)}),c.empty(e),c.append(e,a)},e.prototype._setEvents=function(){var r=this;if(r.$element){var s=r.$element.get(0);r.$element.on("click",function(e){var t=p.isCustomLink(s,e);if(t&&"click"===t.protocol){var n=t.value.substring("click://".length).split("/"),i=p.context(),o=r._tabs[parseInt(n[0],0)];o&&o.$page&&!o.disabled&&p.execLink(o,i,null)}})}},e.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},e.prototype.render=function(e){this.$element||(this.$element=$('<div class="bs-widget-content-inv bs-tabs"><ul class="nav nav-tabs"><ul></div>'),this._renderTabs(),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null,this._page=null},e}(),e.Tabs=i}(Phoenix||(Phoenix={})),function(U){!function(v){v.LAYOUT_BLOCK="block",v.LAYOUT_ROW="row",v.LAYOUT_COLUMN="column",v.LAYOUT_HTML="html",v.LAYOUT_ACCORDION="accordion",v.LAYOUT_ACCORDION_GROUP="accordion-group";var c=U,g=c.dom,y=c.utils,p=c.locale.layouts,h=c.ulocale,n=c.render,l=c.customData,u=c.sticky,i="page",f=function(e){e.$items.length||(e.$type=v.LAYOUT_BLOCK,e.$origin=v.LAYOUT_ROW)},d=function(e){f(e);var t=!1;if(e.$items.forEach(function(e){e.$type=v.LAYOUT_COLUMN,e.$colSize||(t=!0)}),t){var n=Math.max(1,Math.floor(12/e.$items.length)),i=e.$items.length-1,o=0;e.$items.forEach(function(e,t){t===i&&(n=12-o),e.$colSize=n,o+=n})}},m=function(e){e.$items.length||e.$items.push({$type:v.LAYOUT_ACCORDION_GROUP}),e.$items.forEach(function(e,t){e.$type=v.LAYOUT_ACCORDION_GROUP,e.$title=e.$title||{},e.$name=function(e,t){if(!(e=e||""))return i+t;if(0===e.indexOf(i)){var n=e.substring(i.length);if(parseInt(n,10)+""===n)return i+t}return e}(e.$name,t),e.$title.value=e.$title.value||p.defaultTitle})},_=function(e){if(e.$type===v.LAYOUT_HTML)return!1;if(0<e.$items.length&&!e.$items[0].$items)return!1;return!0},$=function(e,t){var n=!0,i=c.bootstrap4;return e.$items.length?!(e.$type===v.LAYOUT_ACCORDION_GROUP&&!e.$widget&&!i)&&(e.$items.forEach(function(e){var t;n&&(n=!((t=e).$type===v.LAYOUT_ACCORDION&&!t.$widget))}),n):n},b=function(e){if(e.$type&&!e.$items&&(e.$items=[]),e.$type===v.LAYOUT_ROW||e.$type===v.LAYOUT_ACCORDION||e.$type===v.LAYOUT_HTML)return!1;if(0<e.$items.length){var t=e.$items[0];if(t.$type||t.$items)return!1}return!0},x=function(e){if(e.$items&&e.$items.length){var t=!0;return e.$items.forEach(function(e){t=t&&e&&e.options&&e.options.right}),t}return!1},C=function(e,t,n){var i=e.$style;!i&&e.$sticky&&(i="$white"),g.parseStyle(i,t),!n.design&&e.$isHidden&&t.push("bs-none"),!n.design&&e.$isDisabled&&t.push("bs-style-disabled")},k=function(e){return!e.$items||!e.$items.length||e.$items[0].$bind},a=function(e,t,n,i,o){var r,s,a=c.bootstrap4;switch(e.$type){case v.LAYOUT_BLOCK:s=!0,n.design&&e.selected&&i.push("selected"),(r=_(e))&&((n.design||$(e))&&(s=!1,t&&i.push("no-x-padding")),n.design&&(i.push("drop-layouts-zone"),e.$origin===v.LAYOUT_ROW&&i.push("row-color"))),b(e)&&(!e.$inline||!n.design&&e.$html||(U.bootstrap4&&x(e)?i.push("form-inline d-flex flex-row-reverse bs-inline-container"):i.push("form-inline bs-inline-container")),n.design&&(i.push("drop-fields-zone"),r||(s=!1,t&&i.push("no-x-padding")))),s&&i.push("field-container"),t||(i.push("bs-root-container"),n.design&&i.push("bs-scroll-container"),e.form||i.push("page")),n.design&&(i.push("design"),e.selected&&i.push("selected")),C(e,i,n),!n.design&&e.$sticky&&u&&u.native&&(i.push("bs-sticky"),"top"===e.$sticky?o.push("top:"+u.topOffset+"px;"):"bottom"===e.$sticky&&o.push("bottom:"+u.bottomOffset+"px;"));break;case v.LAYOUT_ACCORDION:1===n.step&&(i.push("panel-group bs-island"),n.design&&(i.push("design"),i.push("drop-layouts-zone"),e.selected&&i.push("selected")),C(e,i,n));break;case v.LAYOUT_ROW:1===n.step?(i.push("container-fluid"),!n.design&&e.$forceTable&&i.push("no-x-padding"),n.design&&(i.push("design"),i.push("no-x-padding"),e.selected&&i.push("selected")),C(e,i,n)):2===n.step&&(i.push("row"),e.$forceTable&&i.push("bs-row-table"),n.design&&(i.push("design-table"),i.push("row-color"),(r=_(e))&&i.push("drop-layouts-zone")));break;case v.LAYOUT_ACCORDION_GROUP:1===n.step?(a?i.push("card"):i.push("panel panel-default"),n.design&&(i.push("design"),e.selected&&i.push("selected"))):2===n.step?a?(i.push("collapse"),e.opened&&i.push("show")):(i.push("panel-collapse collapse"),e.opened&&i.push("in")):3===n.step&&(a&&i.push("card-body"),(r=_(e))&&((n.design||$(e))&&(i.push("no-x-padding"),i.push("no-y-padding")),n.design&&i.push("drop-layouts-zone")),b(e)&&(!e.$inline||!n.design&&e.$html||(U.bootstrap4&&x(e)?i.push("form-inline d-flex flex-row-reverse bs-inline-container"):i.push("form-inline bs-inline-container")),n.design&&(i.push("drop-fields-zone"),r||i.push("no-x-padding"))),C(e,i,n));break;case v.LAYOUT_COLUMN:1===n.step?(n.design?i.push("col-design col-sm-"+e.$colSize):e.$customColSize?i.push(e.$customColSize):i.push("col-"+(e.$colType||"sm")+"-"+e.$colSize),i.push("no-x-padding")):2===n.step&&(s=!0,i.push("container-fluid"),(r=_(e))&&((n.design||$(e))&&(s=!1,i.push("no-x-padding")),n.design&&!e.$auto&&i.push("drop-layouts-zone")),b(e)&&(!e.$inline||!n.design&&e.$html||(U.bootstrap4&&x(e)?i.push("form-inline d-flex flex-row-reverse bs-inline-container"):i.push("form-inline bs-inline-container")),n.design&&(i.push("drop-fields-zone"),r||(i.push("no-x-padding"),s=!1))),s&&i.push("field-container"),n.design&&(i.push("design col"),e.$auto&&i.push("auto"),e.selected&&i.push("selected")),C(e,i,n),!n.design&&e.$sticky&&u&&u.native&&(i.push("bs-sticky"),"top"===e.$sticky?o.push("top:"+u.topOffset+"px;"):"bottom"===e.$sticky&&o.push("bottom:"+u.bottomOffset+"px;")));break;case v.LAYOUT_HTML:n.design&&(i.push("design"),e.selected&&i.push("selected")),C(e,i,n)}},w=function(e,t,n,i){var o=[],r=[];a(t,n,i,o,r),o.length&&(e.push(' class="'),e.push(o.join(" ")),e.push('"')),r.length&&(e.push(' style="'),e.push(r.join(" ")),e.push('"'))},O=function(e,t,n){e.push(' id="'),e.push(n?n+"_"+t.$id:t.$id),e.push('"')},S=function(e,t,n){n&&(e.push(' data-level="'),e.push(t),e.push('"'))},E=function(e,t,n,i,o){((o||i)&&(e.push(' data-layout="'),e.push(n.$id),e.push('"'),n.$idSelect=null),o||i&&1<t)&&((r=n["$idStep"+t])&&(e.push(' id="'),e.push(r),e.push('"')));if(n.$type===v.LAYOUT_COLUMN&&2===t&&!i){var r=n.$id+"_column";e.push(' id="'),e.push(r),e.push('"')}},P=function(e,t,n,i,o){if(t.$title&&t.$title.value===p.defaultTitle)delete t.$title;else if(i&&t.$title&&!t.$title.isHidden){var r=t.$title.size||(c.bootstrap4?5:4);e.push("<h"+r);var s=["bs-block-title"];if(t.$title.$style&&g.parseStyle(t.$title.$style,s),e.push(' data-ignore="true" class="'+s.join(" ")+'" id="'+t.$id+'_title">'),t.$title.value){var a=h.tt(t.$title.value,n);t.$fields&&(a=y.execAngularExpression(a,o||{})),e.push(y.escapeHtml(a))}e.push("</h"+r+">")}},I=function(e,t,n,i,o,r,s,a){e.push("<div"),r&&e.push(' draggable="true"'),w(e,t,n,{design:r,step:1}),E(e,1,t,r),O(e,t),S(e,1,r),e.push(">"),P(e,t,o,s,i)},D=function(e,t,n,i,o,r){e.push("</div>")},M=function(e,t,n,i,o,r,s){if(e.push("<div"),r&&e.push(' draggable="true"'),w(e,t,n,{design:r,step:1}),E(e,1,t,r),O(e,t),S(e,1,r),e.push(">"),t.$html)if(t.$factory){var a=l.get(t.$factory);a&&e.push(a())}else e.push(t.$html)},F=function(e,t,n,i,o){e.push("</div>")},L=function(t,e,n,i,o,r,s,a){if(m(e),r||!e.$widget)t.push('<div role="tablist"'),U.bootstrap4||t.push(' aria-multiselectable="true"'),r&&t.push(' draggable="true"'),w(t,e,n,{design:r,step:1}),E(t,1,e,r),O(t,e),S(t,1,r),t.push(' id="'+e.$id+'_parent"'),t.push(">");else{if("tabs"!==e.$widget&&"none"!==e.$widget)throw"Invalid accordion $widget.";var l="none"===e.$widget;t.push("<div"),w(t,e,n,{design:r,step:1}),E(t,1,e,r),O(t,e),S(t,1,r),t.push(">"),t.push('<ul  id="'+e.$id+'_tab" class="nav nav-tabs bs-tabs'+(l&&!e.showTabs?" bs-none":"")+'" role="tablist">'),e.$items.forEach(function(e){return function(e,t,n,i,o,r,s,a,l){if(c.bootstrap4){e.push('<li class="nav-item">');var u=["nav-link"];t.opened&&u.push("active"),e.push(y.format('<a class="'+u.join(" ")+'" id="{0}_title" href="#{0}" data-layout="{0}" aria-expanded="'+(t.opened?"true":"false")+'" role="tab" data-toggle="tab">',t.$id));var d=h.tt(t.$title.value,o);t.$fields&&(d=y.execAngularExpression(d,a||{})),e.push(y.escapeHtml(d)),e.push("</a></li>")}else e.push('<li role="presentation"'),t.opened&&e.push(' class="active"'),e.push(">"),e.push(y.format('<a href="#{0}" id="{0}_title" aria-controls="{0}"  data-layout="{0}" role="tab" data-toggle="tab">',t.$id)),d=h.tt(t.$title.value,o),t.$fields&&(d=y.execAngularExpression(d,a||{})),e.push(y.escapeHtml(d)),e.push("</a></li>")}(t,e,0,0,o,0,0,i)}),t.push("</ul>"),t.push('<div class="tab-content">')}},T=function(e,t,n,i,o,r){r||!t.$widget?e.push("</div>"):"tabs"!==t.$widget&&"none"!==t.$widget||(e.push("</div>"),e.push("</div>"))},N=function(e,t,n,i,o,r,s,a){var l=c.bootstrap4;if(r||!n.$widget)e.push("<div"),w(e,t,n,{design:r,step:1}),E(e,1,t,r),O(e,t),S(e,1,r),t.$idStep2=t.$id+"_s2",t.$idStep3=t.$id+"_s3",t.$idDesign=t.$idStep3,r&&e.push(' draggable="true"'),e.push(">"),l?e.push('<div class="card-header" role="tab"'):e.push('<div class="panel-heading" role="tab"'),O(e,t,"heading"),e.push(">"),l?e.push('<h5 class="mb-0">'):(e.push('<h4 class="panel-title bs-pointer collapsed" data-toggle="collapse" data-parent="#'+n.$id+'"'),t.opened?e.push(' aria-expanded="true"'):e.push(' aria-expanded="false"'),e.push(' data-target="#'+t.$idStep2+'" aria-controls="'+t.$idStep2+'"'),e.push(' id="'+t.$id+'_title">')),l&&(e.push("<a"),e.push(' data-toggle="collapse"'),e.push(' href="#'+t.$idStep2+'"'),e.push(' aria-controls="'+t.$idStep2+'"'),t.opened?e.push(' aria-expanded="true"'):(e.push(' aria-expanded="false"'),e.push(' class="collapsed"')),e.push(">")),e.push(y.escapeHtml(t.$title?t.$title.value:"")),l?e.push("</a></h5>"):e.push("</h4>"),e.push("</div>"),e.push('<div role="tabpanel" aria-labelledby="heading_'+t.$id+'"'),l&&e.push(' data-parent="#'+n.$id+'"'),w(e,t,n,{design:r,step:2}),E(e,2,t,r,!0),S(e,2,r),e.push(">"),e.push("<div"),w(e,t,n,{design:r,step:3}),E(e,3,t,r,!0),e.push(">");else if("tabs"===n.$widget||"none"===n.$widget){var u=["tab-pane fade"];t.opened&&u.push("in "+(l?"show active":"active")),e.push('<div role="tabpanel"'),e.push(' class="'+u.join(" ")+'"'),t.$idDesign=t.$id,O(e,t),e.push(">")}},A=function(e,t,n,i,o,r){r||!n.$widget?e.push("</div></div></div>"):"tabs"!==n.$widget&&"none"!==n.$widget||e.push("</div>")},H=function(e,t,n,i,o,r,s,a){e.push("<div"),r&&e.push(' draggable="true"'),w(e,t,n,{design:r,step:1}),O(e,t),E(e,1,t,r),S(e,1,r),e.push(">"),t.$idStep2=t.$id+"_s2",t.$idDesign=t.$idStep2,e.push("<div"),w(e,t,n,{design:r,step:2}),E(e,2,t,r),S(e,2,r),e.push(">"),d(t)},j=function(e,t,n,i,o,r){e.push("</div></div>")},R=function(e,t,n,i,o,r,s,a){e.push("<div"),w(e,t,n,{design:r,step:1}),E(e,1,t,r),O(e,t),S(e,1,r),e.push(">"),e.push("<div"),w(e,t,n,{design:r,step:2}),r&&e.push(' draggable="true"'),t.$idDesign=t.$id+"_design",t.$idDrag=t.$id,t.$idStep2=t.$idDesign,E(e,2,t,r),S(e,2,r),t.$idSelect=t.$idDesign,e.push(">"),P(e,t,o,s,i)},B=function(e,t,n,i,o,r){e.push("</div></div>")},V=function(t,e,n,i,o){if(t){if(i&&!t.$type&&!t.$items)return void n(t,e,!1,!0,o);n(t,e,!0,!0,o),o&&o.stop||(b(t)?t.$items&&t.$items.forEach(function(e){n(e,t,!1,!0,o)}):t.$items&&t.$items.forEach(function(e){V(e,t,n,!1,o)})),n(t,e,!0,!1,o)}},o=function(e,t,n,i,o){e.push('<div class="bs-island'+(o.design?" design":"")+(t.$config?" bs-widget":" bs-field")+(t.selected?' selected"':'"')),o.design&&e.push(' draggable="true"'),e.push(' data-render="'+t.$id+'"'),e.push(' id="'+t.$id+'"'),e.push("></div>")},r=function(e,t,n,i,o){e.push('<div id="'+t.$id+'"></div>')},s=function(e,u,t,d,c,p){var h=n.get(c.context,"widget")||r,f=n.get(c.context,"field")||o,m=e.form;V(e,null,function(e,t,n,i,o){if(n){var r=I,s=D;switch(e.$type){case v.LAYOUT_ROW:r=H,s=j;break;case v.LAYOUT_COLUMN:r=R,s=B;break;case v.LAYOUT_ACCORDION:r=L,s=T;break;case v.LAYOUT_ACCORDION_GROUP:r=N,s=A;break;case v.LAYOUT_HTML:r=M,s=F}i?(e.$ref&&c.design&&(o.stop=!0),r(o.html,e,t,u,d,c.design,m,o.stop),o.stop&&(a=o.html,l=e,c.design,a.push(y.format('<div id="{0}_settings" class="bs-cursor-p bs-layout-detail" data-layout-detail="true"><span class="'+g.iconClass("cog")+'"></span></div>',l.$id))),p&&p(e)):(!c.design&&e.$html&&e.$items&&e.$items.length&&b(e)&&o.html.push(y.format(e.$html.replace(/id="/g,'id="{0}_'),e.$id)),s(o.html,e,t,u,d,c.design),e.$ref&&c.design&&(o.stop=!1))}else e.$config?h(o.html,e,t,u,c):f(o.html,e,t,u,c);var a,l},!0,{html:t})},z=function(e,t,l,u,d,c){V(e,t,function(e,t,n,i){var o,r,s,a;i&&(n?function(e,t,n,i){if(e.$id||(e.$id=y.allocID()),t&&(e.$parentId=t.$id),e.$idDesign=e.$id,e.$idDrag=e.$id,e.$type=e.$type||v.LAYOUT_BLOCK,e.$items=e.$items||[],e.$title&&(e.$title.style||null==e.$title.style||delete e.$title.style),k(e)?e.$fieldsOptions&&!Object.keys(e.$fieldsOptions)&&delete e.$fieldsOptions:(delete e.$inline,delete e.$fieldsOptions),n&&(n[e.$id]=e),i&&e.$name){var o=i[e.$name];o?Array.isArray(o)?o.push(e):i[e.$name]=[i[e.$name],e]:i[e.$name]=e}switch(e.$type!==v.LAYOUT_HTML||e.$html||(e.$html=p.Html),e.$type){case v.LAYOUT_ROW:f(e);break;default:delete e.$forceTable}e.$origin&&e.$origin===e.$type&&delete e.$origin,e.$type!==v.LAYOUT_ACCORDION_GROUP&&e.$title&&e.$title.value===p.defaultTitle&&delete e.$title}(e,t,l,d):(r=t,s=u,a=c,(o=e).$id||(o.$id=y.allocID()),r&&(o.$parentId=r.$id),o.$idDrag=o.$id,s&&(s[o.$id]=o),a&&o.$name&&(a[o.$name]=o)))},!0)};v.check=z,v.layoutVisible=function(e,t){return e.$type!==v.LAYOUT_ACCORDION_GROUP||(t&&void 0!==e._opening?e._opening:e.opened)},v.clearMeta=function(o,r){V(o,null,function(e,t,n,i){i&&(n?(r&&delete e.$id,delete e.$fields,delete e.$isDisabled,delete e.$render,delete e.$idDesign,delete e.$idDrag,delete e.$idSelect,delete e.$parentId,delete e.$idStep2,delete e.$idStep3,delete e.$content,delete e.selected,delete e.showTabs,e.$type!==v.LAYOUT_BLOCK&&(e.$type!==v.LAYOUT_COLUMN&&delete e.$sticky,e.$type===v.LAYOUT_COLUMN?delete e.$type:o.$type===v.LAYOUT_HTML&&o.$html===p.Html&&delete o.$html),delete e._opening,e.$type===v.LAYOUT_ROW&&!1!==o.$forceTable||delete o.$forceTable,e.$name||void 0===e.$name||delete e.$name,!1===e.$inline&&delete e.$inline,e.$fieldsOptions&&(!1===e.$fieldsOptions.columns&&delete e.$fieldsOptions.columns,!1===e.$fieldsOptions.titleIsHidden&&delete e.$fieldsOptions.titleIsHidden,0===Object.keys(e.$fieldsOptions).length&&delete e.$fieldsOptions),e.datasets&&0===Object.keys(e.datasets).length&&delete e.datasets):(delete e.$render,r&&delete e.$id,delete e.$parentId,delete e.$idDrag,delete e.selected,e.$config?(e.$config.data&&(delete e.$config.data.ds,Object.keys(e.$config.data).length||delete e.$config.data),(e.$config.$titleIsHidden||e.$config.$dontSaveTitle)&&delete e.$config.$title):e.options&&0===Object.keys(e.options).length&&delete e.options))},!0)},v.namesOfLayout=function(e){var r=[];return V(e,null,function(e,t,n,i,o){n&&i&&e.$name&&r.push({name:e.$name,title:e.$title&&e.$title.value?e.$title.value:e.$name})},!0),r},v.clearMaps=function(e,s,a,l,u){V(e,null,function(e,t,n,i){if(i)if(n){if(delete s[e.$id],e.$name){var o=l[e.$name];if(Array.isArray(o)){var r=o.indexOf(e);0<=r&&o.splice(r,1),o.length||delete l[e.$name]}else delete l[e.$name]}}else delete a[e.$id],e.$name&&delete u[e.$name]},!0)},v.afterRemoveChild=function(t,n,i,o,r){t.$type===v.LAYOUT_ROW?(t.$items.forEach(function(e){e.$type=v.LAYOUT_COLUMN,delete e.$colSize}),d(t),t.$items.forEach(function(e){z(e,t,n,i,o,r)})):t.$type===v.LAYOUT_ACCORDION&&(m(t),t.$items.forEach(function(e){z(e,t,n,i,o,r)}))},v.canSelect=function(e,t){return!e.$auto&&(e.$type!==v.LAYOUT_COLUMN||1!==t)},v.updateCssClass=function(e,t,n,i){var o,r=[],s=[];a(t,n,i,r,s),e.className=r.join(" "),s.length&&(e.style=s.join(" ")),t.$type===v.LAYOUT_ACCORDION_GROUP&&1===i.step?(o=g.find(e,t.$id+"_title"))&&g.text(o,t.$title&&t.$title.value?t.$title.value:""):t.$type===v.LAYOUT_HTML&&1===i.step&&(e.innerHTML=t.$html||"")},v.toHtml=function(e,t,n,i,o){var r=[];return s(e,t,r,n,i,o),r.join("")},v.updateLayoutTitle=function(e,t,n,i){if(t.$title.value){var o=h.tt(t.$title.value,i);t.$fields&&(o=y.execAngularExpression(o,n||{})),g.text(e,o)}},v.enumSubLayouts=function(e,o){V(e,null,function(e,t,n,i){i&&n&&o(e)},!1)}}(U.layoutUtils||(U.layoutUtils={}))}(Phoenix||(Phoenix={})),function(o){var e=o,s=e.pagecontrol,a=e.menu,x=e.dom,C=e.utils,l=(e.locale,e.WidgetUtils,e.link),u=e.render,d=e.ipc,c=e.sticky,p=e.layoutUtils;!function(e){var r=function(e){for(var t=e.length;t--;)for(var n=e[t],i=Object.keys(n),o=i.length;o--;){var r=n[i[o]];if(r.selected)return r}return null},t=function(){function e(e,t,n,i,o,r){t=this.initOptions(t),this.$locale=null,this._init(e,t)}return e.prototype._afterCreate=function(){},e.prototype.initOptions=function(e){return e},e.prototype._init=function(e,t){var n=this;n.$element=null,n.$content=null,n.options=t||{},n.options.context=n.options.context||"javascript",n.map={},n.mapFields={},n.namedMap={},n.namedMapFields={},e=e||{},p.check(e,null,n.map,n.mapFields,n.namedMap,n.namedMapFields),n.data=e,n.data.form=n.options.form,e.map=n.map,e.fields=n.mapFields,n.children={},n.controls={},n.expressionTitle=!1,n.options.form||(n.page=s.Page(),n.page.setPopup(null),n.page.addChild("layout",n),n.options.design||(n.expressionTitle=C.hasExpression(e.$title),n.page.props.$title=e.$title?C.parseExpression(e.$title,l.context()):null)),n._setDesignListeners(),n.pageLayoutInit()},e.prototype.pageLayoutInit=function(){},e.prototype.getSchema=function(e){return null},e.prototype.getLookupForSchema=function(e,t){return null},e.prototype._setDesignListeners=function(){},e.prototype._removeEvents=function(){this._removeBaseEvents()},e.prototype._addEvents=function(){this._addBaseEvents()},e.prototype._removeBaseEvents=function(){this._removeAccordionEvents()},e.prototype._addBaseEvents=function(){this._setAccordionEvents()},e.prototype._onSelectedChanged=function(e,t,n){},e.prototype._showSelected=function(e,t){},e.prototype._setAccordionEvents=function(){var r=this;r.$element.on("shown.bs.collapse hide.bs.collapse shown.bs.tab hide.bs.tab",function(e){var t=e.target;if(t&&t.hasAttribute("data-layout")){var n=t.getAttribute("data-layout"),i=r.getLayoutById(n);if(i){var o="shown"===e.type;if(i.opened===o)return;o?r._openTab(n):r._activateLayout(i,!1)}}})},e.prototype._activatePageLayout=function(e){var t=this.$element?x.find(this.$element.get(0),e.$id+"_title"):null;if(t){var n=$(t);if(e._opening=!0,e.$type===o.layoutUtils.LAYOUT_ACCORDION_GROUP){var i=this.getLayoutById(e.$parentId);i&&i.$items.forEach(function(e){e.opened&&(e._opening=!1)})}n.tab("show")}},e.prototype.activatePage=function(e){var t=this,n=t.getLayoutsByName(e);n&&n.forEach(function(e){return t._activatePageLayout(e)})},e.prototype._openTab=function(e){var t=this.getLayoutById(e);if(!t.opened){var n=this.getLayoutById(t.$parentId);if(n)for(var i=0,o=n.$items.length;i<o;i++){var r=n.$items[i];if(r.opened){r.opened=!1,delete r._opening,this._activateLayout(r,!1);break}}t.opened=!0,delete t._opening,this._updateLayoutContent(t),this._activateLayout(t,!0)}},e.prototype._doDatasetEventAfterEnabled=function(e){},e.prototype._activateLayout=function(e,t){var n=this;t?n._getVisibleChildren(e).forEach(function(e){e.disabled=!1,n._doDatasetEventAfterEnabled(e)}):n._getChildrenOf(e).forEach(function(e){e.disabled=!0}),n._afterVisibilityChanged({inDom:!0,resize:t})},e.prototype._removeAccordionEvents=function(){this.$element.off("show.bs.collapse hide.bs.collapse")},e.prototype.toString=function(e){return null},e.prototype.emit=function(e,t,n){this.emitDataEvent(e,t,n)},e.prototype.openErrors=function(){if(this.$element){var e=x.find(this.$element.get(0),this.data.$id+"_error");e&&e.firstChild&&x.removeClass(e.firstChild,"bs-none")}},e.prototype._getFormLData=function(){return null},e.prototype._renderLayout=function(e){var t=this;t.stickies=null;var n=$(p.toHtml(e,t._getFormLData(),t.$locale,{design:t.options.design,context:t.options.context},function(e){t.options.design||c.native||!e.$sticky||(t.stickies=t.stickies||{},t.stickies[e.$id]=e)}));return t.$element=n,t.afterRender(n),t._renderChildren(n),t.afterRenderChildren(n),n},e.prototype.afterRenderChildren=function(e){},e.prototype.isChildOf=function(e,t){for(var n=this.map[e];n;){if(n==t)return!0;n=this.map[n.$parentId]}return!1},e.prototype._isChildVisibleOf=function(e,t,n){for(var i=this.map[e];i;){if(!p.layoutVisible(i,n))return!1;if(i==t)return!0;i=this.map[i.$parentId]}return!1},e.prototype._getVisibleControls=function(n,i){var o=this,r=[];return Object.keys(o.controls).forEach(function(e){var t=o.controls[e];if(t.config){if(i&&t.config.$widget!==i)return;o._isChildVisibleOf(t.config.$parentId,n,!0)&&r.push(t)}}),r},e.prototype._getVisibleChildren=function(n){var i=this,o=[];return Object.keys(i.controls).forEach(function(e){var t=i.controls[e];t.item&&i._isChildVisibleOf(t.item.$parentId,n,!1)&&o.push(t)}),o},e.prototype._getChildrenOf=function(n){var i=this,o=[];return Object.keys(i.controls).forEach(function(e){var t=i.controls[e];i.controls[e].item&&i.isChildOf(i.controls[e].item.$parentId,n)&&o.push(t)}),o},e.prototype._getEventListFor=function(e){var i=[];return e.forEach(function(n){n.datasets&&Object.keys(n.datasets).forEach(function(e){var t=n.datasets[e];t.enumTriggers&&t.enumTriggers(!1,function(e){i.indexOf(e)<0&&i.push(e)})})}),i},e.prototype._refreshDataSets=function(e){},e.prototype._afterLayoutAdded=function(e){},e.prototype._updateLayoutContent=function(e){var t=x.find(this.$element.get(0),e.$idDesign),n=$(t);this._renderChildren(n),this.afterAddedInDom()},e.prototype._renderLayoutContent=function(e){var t=this,n=x.find(t.$element.get(0),e.$idDesign);if(n){var i=$(n),o=$(e.$content.join("")),r=n.parentNode,s=n.nextSibling;i.detach(),i.append(o),delete e.$content,t.options.beforeAdd&&t.options.beforeAdd(i,!0),r.insertBefore(n,s),t._afterLayoutAdded(e),t._renderChildren(i);var a=t._getVisibleChildren(e);t._refreshDataSets(a),t.afterAddedInDom(),t.options.design&&(t._removeEvents(),t._addEvents())}},e.prototype._isVisible=function(e){for(;;){if(!e)return!0;var t=this.map[e];if(!t)return!0;if(!p.layoutVisible(t,!1))return!1;e=t.$parentId}},e.prototype._renderChildren=function(e){var h=this,f=[],m=e.get(0),v=u.get(h.options.context,"widget.control"),g=u.get(h.options.context,"field.control"),y=[],_={},b=[];return h._autofocus=null,(v||g)&&(Object.keys(h.mapFields).forEach(function(e){if(!h.children[e]){var t=h.mapFields[e];if(h._isVisible(t.$parentId)){var n=t.$config?v:g,i=n===g;if(i){var o=0===(t.$bind||"").indexOf("$$")||"$none"===t.$bind,r=h.getSchema(t.$bind),s=void 0;r||o||console.log('Schema not found for field "'+t.$bind+'".'),t&&t.$lookup&&(s=h.getLookupForSchema(t.$bind,t.$lookup)),n=n?n(t,r,s):null}if(n){var a,l={context:h.options.context,design:h.options.design,replaceParent:!0,readOnly:t.$readOnly};if(i){if((a=new n(t,l,h)).isMeta()?y.push(a):t.$bind&&(_[t.$bind]=a),t.options&&t.options.autofocus&&(h._autofocus=a),a.getSubControls&&a.addSubControls){var u=a.getSubControls();u&&u.forEach(function(e){var t,n=0===(e.$bind||"").indexOf("$$")||"$none"===e.$bind,i=h.getSchema(e.$bind);i||n||console.log('Schema not found for field "'+e.$bind+'".'),e&&e.$lookup&&(t=h.getLookupForSchema(e.$bind,e.$lookup));var o=new(g?g(e,i,t):null)(e,{context:h.options.context,design:h.options.design,replaceParent:!1,readOnly:e.$readOnly},h);o.isMeta()?y.push(o):e.$bind&&(_[e.$bind]=o),a.addSubControls(o)})}}else a=new n(t,l,h);var d=void 0;if(h.options.design||!t.$htmlParent)d=x.find(m,t.$id);else if(d=x.find(m,t.$parentId+"_"+t.$htmlParent)){l.replaceParent=!1;var c=x.find(m,t.$id);c&&x.remove(c)}else d=x.find(m,t.$id);if(b.push({parent:d,control:a}),h.children[e]=a,(h.controls[e]=a).resize&&(h.resizeList=h.resizeList||[],h.resizeList.push(a)),f.push(a),i&&a.getChildren){var p=a.getChildren();p&&p.forEach(function(e){b.push({parent:e.parent,control:e.control}),e.control.id=e.control.id||C.allocID(),h.children[e.control.id]=e.control,h.controls[e.control.id]=e.control,e.control.resize&&(h.resizeList=h.resizeList||[],h.resizeList.push(e.control))})}}}}}),y.forEach(function(e){var t=e.getCustomBind();if(t){var n=_[t];n&&e.setParentId(n.id)}}),b.forEach(function(e){"string"==typeof e.parent&&(e.parent=x.find(m,e.parent)),e.control.render($(e.parent)),e.control.afterAddedInDom&&(h.afterRenderList=h.afterRenderList||[],h.afterRenderList.push(e.control))})),f},e.prototype.addControl=function(e,t,n){},e.prototype._afterVisibilityChanged=function(e){this._refreshCurrentResizeList(),this._refreshStickies(e.resize)},e.prototype._refreshStickies=function(e){var i=this;if(i.stickies&&i.$element){var o={};Object.keys(i.stickies).forEach(function(e){var t=i.stickies[e];i._isVisible(t.$parentId)&&(o[t.$id]=t,!0)});var t=[];i.activeStickies&&Object.keys(i.activeStickies).forEach(function(e){o[e]?delete o[e]:t.push(i.activeStickies[e])}),i.activeStickies=i.activeStickies||{},t.forEach(function(e){delete i.activeStickies[e.id],c.stickyManager.remove(e.id)}),Object.keys(o).forEach(function(e){var t=o[e];if(t.$type===p.LAYOUT_BLOCK||t.$type===p.LAYOUT_COLUMN){var n=x.find(i.$element.get(0),t.$id+(t.$type===p.LAYOUT_COLUMN?"_column":""));n&&(i.activeStickies[t.$id]={id:t.$id,element:n,position:t.$sticky},c.stickyManager.add(i.activeStickies[t.$id]))}}),e&&c.stickyManager.refresh(!0)}},e.prototype._refreshCurrentResizeList=function(){var t=this;t.resizeList?t.currentResizeList?(t.currentResizeList=[],t.resizeList.forEach(function(e){t._isVisible(e.config.$parentId)&&t.currentResizeList.push(e)})):t.currentResizeList=t.resizeList.map(function(e){return e}):t.currentResizeList=null},e.prototype.getVisibleControlsByWiget=function(e){return this._getVisibleControls(this.data,e)},e.prototype._clearSticks=function(){this.stickies=null,this.activeStickies&&(Object.keys(this.activeStickies).forEach(function(e){c.stickyManager.remove(e)}),this.activeStickies=null)},e.prototype._clearChildren=function(){var t=this.children;this.children={},this.controls={},this._clearSticks(),this.resizeList=null,this.currentResizeList=null,this.afterRenderList=null,Object.keys(t).forEach(function(e){t[e].destroy()})},e.prototype._refreshSelected=function(){if(this.options.design){var e=r([this.map,this.mapFields]);this._onSelectedChanged(this.$element.get(0),e,!0)}},e.prototype.registerDataListener=function(e){this.page&&this.page.registerDataListener(e,this)},e.prototype.removeDataListener=function(e){this.page&&(e==this?this.page.removeParentDataListener(this):this.page.removeDataListener(e))},e.prototype.emitDataEvent=function(e,t,n){this.page&&this.page.emitDataEvent(e,t,n)},e.prototype.afterRender=function(e){},e.prototype._internalRender=function(e,t){var n=this;return n.$element||(n.$element=n._renderLayout(n.data),n.options.beforeAdd&&n.options.beforeAdd(n.$element,t),n.$content.append(n.$element),n._addEvents(),n._refreshSelected(),e&&(n.options.form||x.bodyTheme(n.data.$theme),n.options.replaceParent?e.replaceWith(n.$content):e.append(n.$content),n._afterVisibilityChanged({inDom:!1,resize:!0}),n.afterAddedInDom())),n.$content},e.prototype.afterAddedInDom=function(){var e=l.context();e.$url.$scroll&&this.scrollTo(e.$url.$scroll)},e.prototype._callInternalRender=function(e,t){this._internalRender(e,t)},e.prototype.render=function(e){var t,n=this;return n.$content?n.$element&&(t=!0,n._clearChildren(),n._removeEvents(),n.options.beforeRemove&&n.options.beforeRemove(n.$element),n.$element.remove(),n.$element=null):n.$content=$("<div></div>"),n._callInternalRender(e,t),n.$content},e.prototype._destroyDataSets=function(){},e.prototype.destroy=function(){var e=this;C.log("Destroy Layout","destroy"),e._destroyDataSets(),d.unlisten(e),e.removeDataListener(e),e._clearChildren(),e.page&&(e.page.removeChild(e),e.page=null),e.$element&&(e._removeEvents(),e.$element=null),e._autofocus=null,e.map=null,e.mapFields=null,e.namedMap=null,e.namedMapFields=null,e.autoClose=null,p.clearMeta(e.data,!1)},e.prototype.check=function(e,t){var n=this,i=!1;e||(n.map={},n.mapFields={},n.namedMap={},n.namedMapFields={},t=null,e=n.data,i=!0),p.check(e,t,n.map,n.mapFields,n.namedMap,n.namedMapFields),i&&(e.fields=n.mapFields,e.map=n.map)},e.prototype._afterStructureChanged=function(e){this.render()},e.prototype._afterPropsChanged=function(e){if(this.$element){var t=this.$element.get(0);if(t){var n=x.find(t,e.$id),i=e.$id!=e.$idStep2?x.find(t,e.$idStep2):null,o=e.$idStep3?x.find(t,e.idStep3):null;n&&p.updateCssClass(n,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:1}),i&&p.updateCssClass(i,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:2}),o&&p.updateCssClass(o,e,this.getLayoutById(e.$parentId),{design:this.options.design,step:3}),e.selected&&this._refreshSelected()}}},e.prototype.removeChild=function(e){var t=this;if(e&&t.options.design){var n=t.map[e]||t.mapFields[e];if(n){var i=t.map[n.$parentId];if(i&&(!i.$auto||(n=i,i=t.map[n.$parentId]))){var o=i.$items.indexOf(n);i.$items.splice(o,1),p.clearMaps(n,this.map,this.mapFields,t.namedMap,t.namedMapFields),p.afterRemoveChild(i,t.map,t.mapFields,t.namedMap,t.namedMapFields),t._afterStructureChanged(i)}}}},e.prototype.setDesignMode=function(e){this.options.design!=e&&(this.options.design=e,this.render())},e.prototype.getLayoutById=function(e){if(!e)return null;return this.map[e]},e.prototype.getLayoutElementByName=function(e){if(!e)return null;var t=this.namedMap[e];return t&&this.$element?x.find(this.$element.get(0),t.$id):null},e.prototype.getLayoutByName=function(e){if(!e)return null;var t=this.namedMap[e];return t&&Array.isArray(t)?t[0]:t},e.prototype.getLayoutsByName=function(e){if(!e)return null;var t=this.namedMap[e];return t?Array.isArray(t)?t:[t]:null},e.prototype.scrollTo=function(e){var t=this.getLayoutByName(e);if(t&&this.$element){var n=x.find(this.$element.get(0),t.$id);n&&n.scrollIntoView({behavior:"smooth",block:"start"})}},e.prototype.getNamedLayouts=function(){return p.namesOfLayout(this.data)},e.prototype.getFieldById=function(e){if(!e)return null;return this.mapFields[e]},e.prototype.select=function(e){var t=this,n=t.$element;if(t.options.design){var i=r([t.map,t.mapFields]);if(i&&(i.selected=!1,t._showSelected(n,i),t._onSelectedChanged(n.get(0),i,!1),i.$id===e))t._onSelectedChanged(n.get(0),null,!0);else if(e){var o=t.map[e]?t.map[e]:t.mapFields[e];o&&(o.selected=!0,t._showSelected(n,o),t._onSelectedChanged(n.get(0),o,!0))}}},e.prototype.updateField=function(e,t){var n=this.mapFields[e];if(n)if(n.$render&&n.$config)Object.keys(t.$config).forEach(function(e){"form"!==e&&"data"!==e&&"datasets"!==e&&n.$render[e]!=t.$config[e]&&(n.$render[e]=t.$config[e])}),(n.$config.hasOwnProperty("form")||t.$config.hasOwnProperty("form"))&&(n.$config.form=t.$config.form),n.$config.datasets=t.$config.datasets,n.$config.data=t.$config.data,this._afterStructureChanged(null);else{if(C.equals(n,t))return;var i=Object.keys(t),o=Object.keys(n);i.forEach(function(e){n[e]=t[e]}),i.push("$id"),i.push("$parentId"),i.push("$idDrag"),o.forEach(function(e){i.indexOf(e)<0&&delete n[e]});var r=this.children[e];r&&(delete this.controls[e],delete this.children[e],r.destroy()),this._afterStructureChanged(null)}},e.prototype._cleanIds=function(e){e.$idDesign=null,e.$idDrag=null,e.$idSelect=null,e.$idStep2=null,e.$idStep3=null},e.prototype._blockToCols=function(i){var o=this;i.$items&&i.$items.forEach(function(e,t){var n=e.$origin||e.$type;if(n===p.LAYOUT_BLOCK||n===p.LAYOUT_COLUMN)e.$type=p.LAYOUT_COLUMN,o._cleanIds(i);else p.LAYOUT_COLUMN,e.$colSize,e.$customColSize})},e.prototype._changeType=function(i,e){var o=this,t=o.map[i.$parentId],n=t&&t.$auto?o.map[t.$parentId]:null;switch(i.$origin||i.$type){case p.LAYOUT_BLOCK:e===p.LAYOUT_ROW&&(i.$type=e,o._blockToCols(i),o._cleanIds(i),o.check(i,t));break;case p.LAYOUT_COLUMN:if(e===p.LAYOUT_ROW){var r={$items:i.$items,$type:e,selected:!1};i.$auto=!0,i.$type=p.LAYOUT_COLUMN,i.$items=[r],i.selected&&(i.selected=!1,r.selected=!0),o._blockToCols(r),o._cleanIds(i),o.check(i,t)}break;case p.LAYOUT_ROW:if(e===p.LAYOUT_BLOCK){if(n){var s=n.$items.indexOf(t);(n.$items[s]=i).$type=t.$type,i.$parentId=n.$id,t.$type==p.LAYOUT_COLUMN&&(i.$colSize=t.$colSize,i.$customColSize=t.$customColSize),t=n}else i.$type=e;i.$origin&&delete i.$origin,i.$items&&i.$items.forEach(function(e,t){if(e.$type)if(e.$auto){var n=e.$items[0];n.$colSize=e.$colSize,n.$customColSize=e.$customColSize,(n.$parentId=i).$items[t]=n,o._cleanIds(e)}else e.$type=p.LAYOUT_BLOCK,o._cleanIds(e)}),o._cleanIds(i),o.check(i,t)}break;case p.LAYOUT_ACCORDION:}},e.prototype.updateIsHidden=function(e,t){e.$isHidden!==t&&(e.$isHidden=t,this._afterPropsChanged(e),t||this._activateLayout(e,!0))},e.prototype.updateIsDisabled=function(e,t){e.$isDisabled!==t&&(e.$isDisabled=t,this._afterPropsChanged(e))},e.prototype.updateLayout=function(e,t){var n=this,i=n.map[e],o=!1,r=!1,s=!1;if(i){if(delete t.onlyFields,t.$type){var a=i.$origin||i.$type;t.$type!==a&&(n._changeType(i,t.$type),delete t.$type,o=!0)}if(t.parent){var l=n.map[i.$parentId];n._disableRules=!0,Object.keys(t.parent).forEach(function(e){t.parent[e]!==l[e]&&(l[e]=t.parent[e],o=!0)}),n._disableRules=!1,delete t.parent}if(delete t.selected,n._disableRules=!0,i.$title&&!t.$title?(delete i.$title,o=!0):!i.$title&&t.$title?(delete i.$title,i.$title=t.$title,delete t.$title,o=!0):i.$title&&t.$title&&(Object.keys(t.$title).forEach(function(e){t.$title[e]!=i.$title[e]&&(i.$title[e]=t.$title[e],o=!0)}),delete t.$title),(i.$inline||!1)!==(t.$inline||!1)&&(i.$inline=t.$inline,r=!0,i.$items.length&&(o=!0),delete t.$inline),C.equals(i.$fieldsOptions,t.$fieldsOptions)||(i.$fieldsOptions=t.$fieldsOptions,r=!0,i.$items.length&&(o=!0)),delete t.$fieldsOptions,(i.$refProperty||"")!==(t.$refProperty||"")&&(i.$refProperty=t.$refProperty,o=!0),(i.$refController||"")!==(t.$refController||"")&&(i.$refController=t.$refController,o=!0),(i.$sticky||"")!==(t.$sticky||"")&&(i.$sticky=t.$sticky,o=!0),(i.$forceTable||!1)!==(t.$forceTable||!1)&&(i.$forceTable=t.$forceTable,i.$type===p.LAYOUT_ROW&&i.$forceTable||delete i.$forceTable,o=!0),(i.$ref||"")!==(t.$ref||"")&&(i.$ref=t.$ref,i.$ref?(delete i.name,delete i.form,delete i.$fieldsOptions,s=!0):(delete i.$refProperty,delete i.$refController,delete i.name,delete i.form),i.$items=[],o=!0),delete t.$ref,delete t.$refProperty,delete t.$refController,delete t.$sticky,delete t.$forceTable,(i.$widget||"")!==(t.$widget||"")&&(i.$widget=t.$widget,o=!0),delete t.$widget,(i.$bindPages||"")!==(t.$bindPages||"")&&(i.$bindPages=t.$bindPages,o=!0),delete t.$bindPages,Object.keys(t).forEach(function(e){t[e]!==i[e]&&(i[e]=t[e],r=!0)}),n._disableRules=!1,o){if(s)return d.emit("LoadNestedLayouts",{data:i,after:function(e){C.merge(e,i);var t=n.map[i.$parentId];n._cleanIds(i),n.check(i,t),n._afterStructureChanged(i)}});n._afterStructureChanged(i)}else r?n._afterPropsChanged(i):n._refreshSelected()}},e}(),n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ds_init=function(e){return!1},t.prototype.ds_storeLastEvent=function(e,t){},t.prototype.ds_LastEvent=function(){return null},t.prototype.ds_destroy=function(){},t.prototype.ds_context=function(){return null},t.prototype.ds_reemit=function(e,t){return null},t.prototype.ds_select=function(e,t){},t.prototype.ds_loaded=function(e,t){},t.prototype.ds_exec=function(e,t,n,i,o,r){},t.prototype.pageLayoutInit=function(){var e=this;e.loadingHandler=null,e.noDataHandler=null,e.errorHandler=null,e.emitHandler=null,e.getLocalContextHandler=null,e.dataChangedHandler=null,e.updateMenuHandler=this.updateMenu.bind(e),e._removeMenus(),e.ds_init&&e.ds_init(e.data)&&e.registerDataListener(e)},t.prototype._doDatasetEventAfterEnabled=function(e){if(e.ds_LastEvent&&e.dataEvent){var t=e.ds_LastEvent();t&&e.dataEvent(t.event,t.value)}},t.prototype._refreshDataSets=function(t){if(this.page){var e=this._getEventListFor(t);if(e.length)this.page.emittersFor(e).forEach(function(e){e.ds_reemit&&e.ds_reemit(t,function(){})})}},t.prototype._callInternalRender=function(n,i){var o=this;o.datasets&&o.ds_exec?o.ds_exec("$load",null,o.props.data.ds,function(e,t){if(t)throw t.message;o._internalRender(n,i)},null,!0):o._internalRender(n,i)},t.prototype._destroyDataSets=function(){this.ds_destroy&&this.ds_destroy()},t.prototype._removeMenus=function(){var n=this;["left","right","top","bottom"].forEach(function(e){if(!n.data.$menus||!n.data.$menus[e]){var t=n.page.childByType("menu-"+e);t&&t.setMenu(null)}})},t.prototype.updateMenu=function(e,t){C.log("From Layout Update Menu : "+(t?t.name:"null"),"menu");var n=this.page.childByType("menu-"+e);if(n)n.setMenu(t);else{var i=null;if("right"==e?i=a.Menuright:"left"==e&&(i=a.Menuleft),i){var o={type:e,bodyId:null,parentId:null},r=this.page.childByType("header");r&&(r.options.bodyId&&(o.bodyId=r.options.bodyId),r.options[o.type+"MenuPlace"]&&(o.parentId=r.options[o.type+"MenuPlace"])),n=new i(t,o)}}},t}(e.BaseLayout=t);e.PageLayout=n,C.applyMixins(n,[o.DatasetPlugin.DatasetMethods]);var i=function(s){function e(e,t,n,i,o,r){return s.call(this,e,t,n,i,o,r)||this}return __extends(e,s),e}(n);e.Layout=i,e.LayoutClass=i}(o.ui||(o.ui={}))}(Phoenix||(Phoenix={})),function(e){var t=e,i=(t.ulocale,t.utils),o=(t.locale,t.pagecontrol),p=t.dom;t.ui;!function(t){t.SCREEN_CENTER="screencenter",t.SCREEN_TOP_CENTER="screentopcenter",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right";var n=function(){function e(e,t){var n=this;n._align=e,n.id=i.allocID(),t=t||t,n._checkOptions(t),n._width=t.width,n._height=t.height,n._minWidth=t.minWidth,n._minHeight=t.minHeight,n._style=t.style,n._beforeClose=t.beforeClose,n._contentRender=t.contentRender,n._autocloseParents=t.parents||[],n.opener=t.opener,n.stayOnTop=t.stayOnTop,t.alignElement&&(n.$alignElement=$(t.alignElement)),n.$parent=$(t.parent),n._page=o.Page(),n._resize=n.resize.bind(n)}return e.prototype.resize=function(){this._setMinWidthAndMinHeight(),this._alignElement()},e.prototype.destroy=function(){var e=this;$(window).off("global-phoenix-resize",e._resize),e._autocloseParents=null,e.$element=null,e.$parent=null,e.$alignElement=null,e._beforeClose=null,e._contentRender=null,e._page=null,e.renderControl&&(e.renderControl.destroy&&e.renderControl.destroy(),e.renderControl=null)},e.prototype.inPopup=function(e){for(var t=0,n=this._autocloseParents.length;t<n;t++){var i=this._autocloseParents[t],o=p.find(null,i);if(o&&p.isChildOf(o,e))return!0}return!1},e.prototype._checkOptions=function(e){if(e.parent=e.parent||document.body,e.alignElement||(e.parent=document.body,e.alignElement=null,this._align!==t.SCREEN_TOP_CENTER&&(this._align=t.SCREEN_CENTER)),this._align!==t.SCREEN_TOP_CENTER&&this._align!==t.SCREEN_CENTER&&!e.alignElement)throw"Align element is null";if(!e.contentRender)throw"Invalid content render"},e.prototype._alignXScreenCenter=function(){var e=this.$element.get(0),t=p.offset(e),n=p.offset(e.parentNode);e.style.left=Math.floor(Math.max((n.width-t.width)/2,0))+"px"},e.prototype._alignYScreenCenter=function(){var e=this.$element.get(0),t=p.offset(e),n=p.offset(e.parentNode);e.style.top=Math.floor(Math.max((n.height-t.height)/2,0))+"px"},e.prototype._alignTopScreen=function(){this.$element.get(0).style.top="0px"},e.prototype._alignScreenTopCenter=function(){this._alignXScreenCenter(),this._alignTopScreen()},e.prototype._alignScreenCenter=function(){this._alignXScreenCenter(),this._alignYScreenCenter()},e.prototype._alignBottomLeft=function(){var e=this.$element.get(0),t=this.$alignElement.get(0),n=p.documentClientDim(),i=this.$parent.get(0),o=i===document.body,r=p.offset(i),s=p.offset(e),a=p.offset(t),l=p.documentScroll(),u=p.documentViewSize(),d=Math.round(a.top+a.height)-1;d+s.height>l.top+u.height&&(d=l.top+u.height-s.height),d=Math.max(0,Math.round(Math.max(l.top,d))),o||(d=Math.max(0,Math.round(d-r.top))),e.style.top=d+"px";var c=a.left;c+s.width>n.width&&(c=Math.max(0,n.width-s.width)),o||(c=Math.max(0,Math.round(c-r.left))),e.style.left=c+"px"},e.prototype._alignBottomRight=function(){var e=this.$element.get(0),t=this.$alignElement.get(0),n=p.documentClientDim(),i=p.offset(e),o=p.offset(t);e.style.top=Math.max(0,Math.round(o.top+o.height)-1)+"px";var r=Math.max(0,Math.round(n.width-o.left-o.width));r+i.width>n.width&&(r=Math.max(0,n.width-i.width)),e.style.right=r+"px"},e.prototype._alignElement=function(){this._align===t.SCREEN_CENTER?this._alignScreenCenter():this._align===t.SCREEN_TOP_CENTER?this._alignScreenTopCenter():this._align===t.BOTTOM_LEFT?this._alignBottomLeft():this._align===t.BOTTOM_RIGHT&&this._alignBottomRight()},e.prototype._setMinWidthAndMinHeight=function(){var e=this.$element.get(0);this._minWidth&&"auto"!==this._minWidth&&(e.style.minWidth=p.checkSize(this._minWidth)),this._minHeight&&"auto"!==this._minHeight&&(e.style.minHeight=p.checkSize(this._minHeight))},e.prototype._setHeightAndWidth=function(){var e=this.$element.get(0);this._setMinWidthAndMinHeight(),this._width&&"auto"!==this._width&&(e.style.width=p.checkSize(this._width)),this._height&&"auto"!==this._height&&(e.style.height=p.checkSize(this._height))},e.prototype.open=function(){var t=this,e=["bs-autoclose","bs-autoclose-hidden"];t._style=t._style||"modal-content",t._style&&p.parseStyle(t._style,e),t.$element=$('<div id="'+t.id+'" class="'+e.join(" ")+'"><div></div></div>'),t._autocloseParents.push(t.id);var n=t.$element.get(0),i=t.$parent.get(0);t._setHeightAndWidth(),p.append(i,n),t._contentRender($(n.firstChild),t,function(e){if(e)return console.log(e),void t.destroy();t._alignElement(),p.removeClass(n,"bs-autoclose-hidden"),t._page.setPopup(t),$(window).on("global-phoenix-resize",t._resize)})},e.prototype.hide=function(e){this._beforeClose&&this._beforeClose();var t=this.$element.get(0);p.remove(t),this.$element=null,this.destroy()},e}();t.open=function(e,t){new n(e,t).open()}}(e.autoclose||(e.autoclose={}))}(Phoenix||(Phoenix={})),function(e){!function(e){var l=e.SchemaUtils,t=function(){function e(e,t,n){this.isState=!0}return e.prototype.destroy=function(){this._state&&(this._state=null),this.parent=null},e.prototype.state=function(){return this._state},e.prototype._init=function(e,t,n,i){var r=this;i=i||[],r._state=n||{},r.name=t,r.parent=e,i.forEach(function(o){void 0===r._state[o]&&(r._state[o]=!1),Object.defineProperty(r,o,{get:function(){return this._state[o]||!1},set:function(e){if((this._state[o]||!1)!==e){if(this._state[o]=e,"filter"===o&&this.parent){var t=this.parent.getValue(r.name),n=this.parent.getSchema(r.name);if(n&&n.enum&&n.filters){var i=e?n.filters[e]:n.enum;if(i)i.indexOf(t)<0&&this.parent.setValue(r.name,i.length?i[0]:null)}}this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(r.name+"."+o,{})}},enumerable:!0})})},e}(),n=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._selected=[],i._init(e,t,n,null),i}return __extends(e,o),e.prototype.list=function(){return this.parent[this.name]},e.prototype._init=function(e,t,n,i){this._state=n||{},this.name=t,this.parent=e},Object.defineProperty(e.prototype,"columns",{get:function(){var e=this.parent[this.name];return JSON.stringify(e.columns||[])},set:function(e){var t=this.parent[this.name];JSON.stringify(t.columns||[])!==(e=e||"")&&(t.columns=e?JSON.parse(e):void 0,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".columns",{}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this.parent[this.name].getSelectedItems().join(",")},set:function(e){var t=this.parent[this.name],n=(this._selected||[]).slice(0).sort(),i=(e||"").split(",").sort().join(",");this._selected=JSON.parse("["+i+"]"),n.join(",")!==i&&t.setSelectedItems(JSON.parse("["+i+"]"))},enumerable:!0,configurable:!0}),e.prototype.selectedPks=function(){return this._selected},Object.defineProperty(e.prototype,"pageSize",{get:function(){return this._pageSize||0},set:function(e){this._pageSize!==e&&(this._pageSize=e,this.list().notifyChangedProperty("pagination"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageNumber",{get:function(){return this._pageNumber||1},set:function(e){this._pageNumber!==e&&(this._pageNumber=e,this.list().notifyChangedProperty("pagination"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalCount",{get:function(){return this._totalCount||0},set:function(e){this._totalCount!==e&&(this._totalCount=e,this.list().notifyChangedProperty("pagination"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orderBy",{get:function(){return this._orderBy},set:function(e){this._orderBy!==e&&(this._orderBy=e,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".orderBy",{}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(e){this._filter!==e&&(this._filter=e,this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".filter",{}))},enumerable:!0,configurable:!0}),e}(e.BaseState=t);e.ListStates=n;var i=function(a){function e(e,t,n){var i=a.call(this,e,t,n)||this,o=e.getSchema("").properties[t],r=l.states;if(o){var s=l.stateProps(o);s&&s.length&&(r=s.concat(r))}return i._init(e,t,n,r),i}return __extends(e,a),e}(t);e.DataStates=i;var o=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=t;return o.indexOf(".$links")<0&&(o="$links."+t),i._init(e,o,n,l.linksStates),i}return __extends(e,r),e}(t);e.LinkStates=o}(e.Observable||(e.Observable={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i=e.utils;t=e.Observable||(e.Observable={}),n=function(){function e(e,t,n){this._init(e,t,n),this.isArray=!0}return e.prototype.destroy=function(){this._errors&&(this._errors=null),this.parent=null},e.prototype.errors=function(){return this._errors?this._errors.slice():[]},Object.defineProperty(e.prototype,"length",{get:function(){return this._errors?this._errors.length:0},enumerable:!0,configurable:!0}),e.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!this._errors)return null;for(var i=e.split(","),o=i.length,r=0,s=this._errors.length;r<s;r++){for(var a=!0,l=this._errors[r],u=0;u<o;u++)if(t[u]!==l[i[u]]){a=!1;break}if(a)return l}return null},e.prototype.clear=function(e){return!!this._errors.length&&(this._errors.length=0,e&&this.notify(),!0)},e.prototype.hasErrors=function(){if(!this._errors||!this._errors.length)return!1;var t=!1;return this._errors.forEach(function(e){t||"error"!==e.severity&&void 0!==e.severity||(t=!0)}),t},e.prototype.rmvError=function(t){if(this._errors&&this._errors.length){var e=this._errors.findIndex(function(e){return"error"===e.severity&&e.message===t});0<=e&&(this._errors.splice(e,1),this.notify())}},e.prototype.rmvErrorById=function(t){if(this._errors&&this._errors.length){var e=this._errors.findIndex(function(e){return e.id===t});0<=e&&(this._errors.splice(e,1),this.notify())}},e.prototype.addChildError=function(e){if(this._errors=this._errors||[],e){for(var t=0;t<this._errors.length;t++)if(this._errors[t].isChild)return!1;this._errors.push({severity:"error",message:e,id:i.allocUuid(),isChild:!0}),this.notify()}},e.prototype.addErrors=function(e){this._errors=this._errors||[],e&&e.length&&(e.forEach(function(e){e.id=e.id||i.allocUuid()}),this._errors=this._errors.concat(e),this.notify())},e.prototype.push=function(e){this.addErrors([e])},e.prototype.remove=function(e){if(this._errors){var t=this._errors.indexOf(e);0<=t&&(this._errors.splice(t,1),this.notify())}},e.prototype.addError=function(e,t){this.addErrors([{severity:"error",message:e,id:t||i.allocUuid()}])},e.prototype.addSuccess=function(e,t){this.addErrors([{severity:"success",message:e,timeout:2,id:t||i.allocUuid()}])},e.prototype.addWarning=function(e,t){this.addErrors([{severity:"warning",message:e,timeout:2,id:t||i.allocUuid()}])},e.prototype.notify=function(){this.parent&&this.parent.notifyStateChanged&&this.parent.notifyStateChanged(this.name+".errors",{})},e.prototype._init=function(e,t,n){this._errors=n||[],this.name=t,this.parent=e},e}(),t.Errors=n,t.errorsUtils={errorChanged:function(e,t){if(e=e||[],t&&t.length){if(e.length!=t.length)return!0;for(var n=!1,i=0,o=e.length;i<o;i++){var r=e[i],s=t[i];if(r.code&&s.code){if(r.code!==s.code){n=!0;break}}else{if(!r.code||!s.code){n=!0;break}if(r.message!==s.message){n=!0;break}}}return n}if(e.length)return!0}}}(Phoenix||(Phoenix={})),function(n){var e,s,u,o,t,i,d,r;e=n.Observable||(n.Observable={}),s=n.utils,u=n.dom,o=n.application,t=n.data.odata,e.SchemaUtils,i=e.DataUtils,d=n.DatasetPlugin,r=function(){function e(e,t){if("find"!==e.$type&&"odata"!==e.$type&&"relation"!==e.$type&&"enum"!==e.$type)throw new Error("Only odata sources are supported.");var n=this,i=e.$params&&e.$params.$type?e.$params.$type:"odata";if(((o.config(o.name)||{})[i]||{}).array&&(n._noPageCount=!0),n._config=e,n._origFilter=n._config.$params.$filter,n._config.$params.$searchByFields&&(n._search=n._config.$params.$searchByFields.value,n._searchFields=n._config.$params.$searchByFields.fields,n._fullSearch=n._config.$params.$searchByFields.fullSearch),n._pageSize=0,n._model=t,n._currentPage=1,n._hasPrev=!1,n._hasNext=!1,!n.isQuery())throw"Invalid Queryable DataSource";n._pageSize=n._config.$params.$top||0,n._orderby=n._config.$params.$orderby||""}return e.prototype.initPagination=function(e,t,n,i,o,r){this._pageSize=e,this._noPageCount=r,this._noPageCount?(this._hasNext=i,this._hasPrev=o):this._totalCount=n,this._currentPage=t},e.prototype.initFromData=function(e){var t=this;if(t.isQuery()&&(t._pageSize=e.pageSize,t._noPageCount=e._noPagesCount,t._currentPage=t._pageSize?Math.ceil(e.skip/t._pageSize)+1:0,t._noPageCount?(t._hasPrev=e._hasPrev,t._hasNext=e._hasNext):t._totalCount=e.count,t._skip=e.skip,e.uri)){var n=t._model.parent;n.hasOwnProperty("uri")&&(n.uri=e.uri),n.hasOwnProperty("search")&&(n.search=e.search)}},Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(e){var t=this;t._filter=e,t._filter&&t._filter.value?t._origFilter?t._config.$params.$filter={$left:t._origFilter,$op:"AND",$right:t._filter.value}:t._config.$params.$filter=t._filter.value:t._origFilter?t._config.$params.$filter=t._origFilter:t._config.$params.$filter=null,t.refresh(!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return this._search},set:function(e){e!==this._search&&(this._search=e,this._config.$params.$searchByFields={fields:this._searchFields,value:e,fullSearch:this._fullSearch},this._searchFields&&this.refresh(!0,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchFields",{get:function(){return this._searchFields},set:function(e){if(e.join("$$$")!==this._searchFields.join("$$$")){var t=!!this._search;this._search="",this._searchFields=e,this._config.$params.$searchByFields={fields:this._searchFields,value:e,fullSearch:this._fullSearch},t&&this.refresh(!0,!1)}},enumerable:!0,configurable:!0}),e.prototype.pageSize=function(){return this.isQuery()?this._pageSize:0},e.prototype.orderBy=function(e){return void 0===e||e!==this._orderby&&(this._orderby=e,this.refresh(!0,!1)),this._orderby},e.prototype.refresh=function(n,i){var o=this;return new s.Promise(function(e,t){o.isQuery()?(n&&(o._currentPage=0),o._open(i).then(function(){o._model.notifyPaginationChanged(),o._model.notifySortingChanged(),e()})):e()})},e.prototype.currentPage=function(e){var t=this;if(void 0===e)return t.isQuery()?t._currentPage:0;if(t.isQuery()){var n=t.noPagesCount()?e:Math.min(e,t.totalPages());t._currentPage!==n&&(t._currentPage=n,t._open(!1).then(function(){t._model.notifyPaginationChanged()}))}return e},e.prototype.totalPages=function(){return this.isQuery()&&!this._noPageCount?this._pageSize?Math.ceil(this._totalCount/this._pageSize):1:0},e.prototype.totalCount=function(){return this.isQuery()&&!this._noPageCount?this._totalCount:0},e.prototype.noPagesCount=function(){return this._noPageCount},e.prototype.hasNext=function(){return this._hasNext},e.prototype.hasPrev=function(){return this._hasPrev},e.prototype.destroy=function(){this._config=null,this._model=null},e.prototype.isQuery=function(){return i.isQuery(this._config)},e.prototype.open=function(){return this._open(!0)},e.prototype.remove=function(t,o){var r=this;return r.isQuery()?new s.Promise(function(n,i){var e={name:"data",$type:r._config.$type,$method:"DELETE",$params:{$module:r._config.$params.$module,$entity:r._config.$params.$entity,$entityId:t}};u.processing(!0),d.executeDatasets([e],{etag:o},{},{},function(e,t){u.processing(!1),t?r._model?(r._model.addAjaxException(t),i(null)):i(t):n(null)})}):null},e.prototype._applyFilters=function(){var e=this._model.allData;return t.applyFilters(e,this._search,this._searchFields,this._skip,this._pageSize,this._orderby,this._fullSearch)},e.prototype._open=function(a){var l=this;return l._config.name="data",new s.Promise(function(i,o){u.processing(!0);var r=l.isQuery(),s={};r&&(l._orderby&&l._config.$params.$orderby!==l._orderby&&(l._config.$params.$orderby=l._orderby),0<l._pageSize?(l._config.$params.$top=l._pageSize,l._config.$params.$skip=Math.max(0,l._currentPage-1)*l._pageSize,0==l._config.$params.$skip&&delete l._config.$params.$skip,l._skip=l._config.$params.$skip):(delete l._config.$params.$top,delete l._config.$params.$skip));var e=l._config;if(!a&&r&&l._config.$params.$allData&&l._model.allData){var t=l._applyFilters();return n.dom.processing(!1),l.initFromData(t),l._model.setModel(t.documents),void i(t)}d.executeDatasets([e],l._model.parent.model(!0)||{},s,{},function(e,t){if(u.processing(!1),t)l._model?(l._model.addAjaxException(t),o(null)):o(t);else{var n=s.data;if(l.initFromData(n),r&&l._skip&&!l._noPageCount&&l._skip>=l._totalCount)return l._currentPage=0,l._open(a).then(function(e){i(e)});r&&l._config.$params.$allData&&(l._model.allData=n._allData),l._model&&(r?l._model.setModel(n.documents):l._model.setModel(n)),i(n)}})})},e.prototype.save=function(){this.isQuery()||this._model.validate()},e}(),e.QueryableDataSource=r}(Phoenix||(Phoenix={})),function(e){var t,n,c,i,p,o,h,f,m,v,g;t=e.rules||(e.rules={}),n=e.Observable,c=n.SchemaUtils,n.DataUtils,e.locale,i=e.ulocale,p=e.utils,o={},h=function(e,t){return(t=t||{}).isPropagation&&(e=e.replace(/sum\(\s*([^)]+?)\s*\)/g,function(e,t){var n=t.split(/\s*,\s*/);if(n&&1===n.length){var i=n[0].split("."),o=i.pop();return"sum("+i.join(".")+", '"+o+"')"}return e})),e},f=function(t,n,e,i){try{t.code||(t.code=new Function("o","ctx","window",h(t.expression,{isPropagation:!0})),t.conditionCode=t.condition?new Function("o","ctx","window","return "+h(t.condition,{isPropagation:!1})):null);var o=!0;if(t.conditionCode&&(o=t.conditionCode(n,e,null)),o){var r=n.getRootModel();p.logRule(r._callStack?r._callStack.length:0,t,i,n.className||""),t.code(n,e,null)}}catch(e){m(e,t,n.getRootModel())}},m=function(e,t,n){"string"==typeof e&&(e={message:e});var i=p.format("Rule '{0}'  {1}:",t.name,t.description||"");n.addError([i,e.message||""].join("\n"))},v=function(e){var t={today:i.date2ISO(new Date),now:function(){return(new Date).toISOString()},addHours:function(e,t){var n=i.parseISODateTime(e);if(null!==n)return n.setTime(n.getTime()+60*t*60*1e3),n.toISOString()},isTriggeredBy:function(e){return!1},sum:function(e,i){var o=0;return e&&e.forEach(function(e,t,n){o+=e[i]||0},""),o},safeDivide:function(e,t,n){return t=t||0,e=e||0,0===parseFloat(t.toFixed(8))?n||0:e/t},partition:function(o,e,r,s){var a=-1,l=-1,u=o=o||0,d=0;if(e.forEach(function(e,t,n){var i=e[s]||0;Math.abs(i)>a&&(a=Math.abs(i),l=t),d+=i}),0!==(d=parseFloat(d.toFixed(8)))&&0<=l&&(e.forEach(function(e,t,n){var i=e[s]||0;e[r]=o*i/d,u-=e[r]}),0!==(u=parseFloat(u.toFixed(8))))){var t=e.get(l);t[r]=(t[r]||0)+u}},utc:function(e){if(!e)return 0;var t=i.parseISODateTime(e);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},milliseconds2Hours:function(e){return e/36e5},date:function(e){return i.parseISODateTime(e)}};return Object.keys(o).forEach(function(e){t[e]||(t[e]=o[e])}),t},g=function(e,t,n){return p.execAngularExpression(e,{o:n||{},ctx:t})},t.execInitRules=function(t){var e,n,i=t.getRootModel().getSchema("");if(n=t.$create?(e=i.rules&&i.rules.created?i.rules.created[t.className]:null,"$events.created"):(e=i.rules&&i.rules.loaded?i.rules.loaded[t.className]:null,"$events.loaded"),e){var o=v(t.getRootModel());e.forEach(function(e){return f(i.rulesMap[e],t,o,n)})}},t.execBeforeSaveRules=function(t){var n=t.getRootModel().getSchema(""),e=n.rules&&n.rules.saving?n.rules.saving[t.className]:null;if(e){var i=v(t.getRootModel());e.forEach(function(e){return f(n.rulesMap[e],t,i,"$events.saving")})}},t.execPropChangeRules=function(s,e,t,i){s.callStack=s.callStack||[];var n=e;s.callStack.push(n);try{if(s.$schema.rules&&(s.$schema.rules.validation&&i.validations||s.$schema.rules.propagation&&i.propagations)){var o=e.split("."),a=o.pop();if("$"===a.charAt(0))return;for(var l=[a],u=t.instance,d=u,c=v(),r=function(){var e=i.propagations&&s.$schema.rules.propagation?s.$schema.rules.propagation[u.className]:null,r=l.join("."),t=e?e[r]:null;t&&t.forEach(function(e){return f(s.$schema.rulesMap[e],u,c,r)}),(t=(e=i.validations&&s.$schema.rules.validation?s.$schema.rules.validation[u.className]:null)?e[r]:null)&&t.forEach(function(e){var t=s.$schema.rulesMap[e];try{if(!t.code){var n="return ";0<=t.expression.indexOf(n)&&(n=""),t.code=new Function("o","ctx","window",n+h(t.expression,{isPropagation:!1})),t.conditionCode=t.condition?new Function("o","ctx","window","return "+h(t.condition,{isPropagation:!1})):null}var i=1<t.triggers.length,o=!0;t.conditionCode&&(o=t.conditionCode(u,c,null)),o&&p.logRule(s.callStack?s.callStack.length:0,t,r,u.className||""),!o||t.code(u,c,null)?i?s.rmvError(g(t.errorMsg,c,u)):d.$errors[a].rmvError(g(t.errorMsg,c,u)):i?s.addError(g(t.errorMsg,c,u)):d.$errors[a].addError(g(t.errorMsg,c,u))}catch(e){m(e,t,s)}});var n=o.pop();n&&"$"===n.charAt(0)&&(n=o.pop()),n&&l.unshift(n),u=u.parent};u;)r()}}finally{s.callStack.pop(),s.callStack.length||(s.callStack=null)}},t.execValidationRules=function(a,t){if(!a.className)return!1;var l=a.getRootModel();if(!l.$schema.rules||!l.$schema.rules.validation||!l.$schema.rules.validation[a.className])return!1;var e=Object.keys(l.$schema.rules.validation[a.className]),u=v(),d=!1;return e.forEach(function(s){if(t&&t.indexOf(s)<0)return!1;var e=l.$schema.rules.validation[a.className][s];e&&e.forEach(function(e){var t=l.$schema.rulesMap[e];try{if(!t.code){var n="return ";0<=t.expression.indexOf(n)&&(n=""),t.code=new Function("o","ctx","window",n+h(t.expression,{isPropagation:!1})),t.conditionCode=t.condition?new Function("o","ctx","window","return "+h(t.condition,{isPropagation:!1})):null}var i=!0;if(t.triggers.length&&t.triggers.forEach(function(e){0!==e.indexOf("$events.")&&i&&(i=c.hasProperty(e,a.$schema,l.$schema))}),!i)return;var o=1<t.triggers.length,r=!0;t.conditionCode&&(r=t.conditionCode(a,u,null)),r&&p.logRule(l.callStack?l.callStack.length:0,t,s,a.className||""),!r||t.code(a,u,null)?o?l.rmvError(g(t.errorMsg,u,a)):a.$errors[s].rmvError(g(t.errorMsg,u,a)):(d=!0,o?l.addError(g(t.errorMsg,u,a)):a.$errors[s].addError(g(t.errorMsg,u,a)))}catch(e){m(e,t,l)}})}),d},t.injectInContext=function(e,t){o[e]=t}}(Phoenix||(Phoenix={})),function(w){!function(_){var u,e;(e=u=_.Duplicates||(_.Duplicates={}))[e.dupIgnore=0]="dupIgnore",e[e.dupSilent=1]="dupSilent",e[e.dupError=2]="dupError";var t=w,s=t.application,y=_,h=t.rules,b=y.SchemaUtils,x=y.DataUtils,C=w.utils,a=t.jsonpatch,n=w.ajax,k=w.locale,l=w.ulocale,f=w.locale.schema,p={setValue:function(e,t,n,i){n.setValue(e,t,i)},getValue:function(e,t,n){return t.getValue(e,n)},getState:function(e,t,n){return t.getState(e,n)},_segment2Id:function(e){var t=parseInt(e,10);return t+""!==e&&(t=e),t},_resolveJSONPatchSegment:function(e,t,n){if(t.isArray){if("$links"===e)return{value:t.$links,useId:n};var i=p._segment2Id(e);return{value:t.find("id",i),useId:n}}return{value:t[e],useId:n}},getJSONPatchParent:function(e,t){var n=e.split("/");n.shift();var i={lastSegment:n.pop(),value:null,type:0};if(0<=e.indexOf("$states"))i.type=2;else if(0<=e.indexOf("$errors"))i.type=3;else if(0<=e.indexOf("$links")){i.type=1;var o=n.pop();"$links"===o&&0<i.lastSegment.indexOf(".")&&(o=i.lastSegment,n.push("$links"),i.lastSegment="");var r=o.split(".");if(1<r.length){var s=r.shift();o=r.join(".");var a=n.pop();n.push(s),n.push(a)}n.push(o)}for(var l=t,u=!0;n.length;){var d=p._resolveJSONPatchSegment(n.shift(),l,u);if(u=d.useId,!(l=d.value))break}if(l){var c=l[i.lastSegment];c&&c.isArray&&(i.lastSegment="",l=c)}return i.value=l,i},_resolveSegment:function(e,t,n,i,o,r){return"$item"!==e?"$selected"===e?(r&&(n[e]=o),n[e]):"$new"===e?(r&&(n[e]=o),n[e]):n&&n[e]&&"function"==typeof n[e]?r?n[e](o):n[e]():(r&&(n[e]=o),n[e]):i?i[t]:void 0}},i=function(){function e(e,t,i,n,o,r,s,a){var l=this;if(l.isArray=!0,l._map={},l.isQuery=s,l._selectedUids=[],l._selectedPks=[],l.isNull=!1,l.isUndefined=!0,l._model=void 0,l._items=[],l._path=i,l._parent=t,l._parentSelected=a,l._locale=r,l._arrayParent=o,l._rootSchema=l._parent.getRootModel().getSchema(""),l._schema=b.expand$Ref(e,l._rootSchema),l._schemaItems=b.expand$Ref(l._schema.items,l._rootSchema),l._expanded=!!l._schema.expanded,l.frozen=!1,l.$links={},l._schema.links){var u=l._parent.model(!0);Object.keys(l._schema.links).forEach(function(e){var t=$.extend({},l._schema.links[e]),n=i+"."+e;u.$links=u.$links||{},u.$links[n]=$.extend(t,u.$links[n]||{}),l.$links[e]=new y.LinkStates(l.parent,i+".$links."+e,u.$links[n])})}l._setModel(n,!0)}return e.prototype.isEmpty=function(){return this.isNull||this.isUndefined||!this._items||!this._items.length},e.prototype.selecting=function(e,t){var n=this;if(n._schema.syncSelected)if(e)n._simulateSelecting=!0,n._savedSelectedUids=n._selectedUids.slice();else{var i=n._selectedPks.slice();n._selectedUids=[],n._selectedPks=[];var o={};n._savedSelectedUids.forEach(function(e){o[e]=!0});var r=null;if(n._schemaItems.primaryKey){var s=!1;r=b.pkFields(n._schemaItems.primaryKey),n.forEach(function(e){o[e.$id]?(e.internalSetSelected(!0)&&(s=!0),n._selectedUids.push(e.$id),r&&n._selectedPks.push(b.pk2Id(b.extractPkValue(e,r),r))):e.internalSetSelected(!1)&&(s=!0)}),n._savedSelectedUids=null,n._simulateSelecting=!1,s&&n._parent.execSyncAction(n.getJSONPatchPath()+".$selected",i.join(","))}}},Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},set:function(e){this._columns=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$states",{get:function(){return this.parent.$states[this._path]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manageSelecting",{get:function(){return this._selecting&&!this._multiselect&&!1!==this.schema.autoSelect&&!this.schema.syncSelected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowSelecting",{get:function(){return this._selecting},set:function(e){this._selecting=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiselect",{get:function(){return this._multiselect},set:function(e){this._multiselect=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expandingProperty",{get:function(){return this._expandingProperty},set:function(e){this._expandingProperty=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simulateSelecting",{get:function(){return this._simulateSelecting},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$selected",{get:function(){return this._parentSelected?this._parentSelected.$selected:this._selected},set:function(e){this._setSelected(e,this._arrayParent&&this._arrayParent._simulateSelecting)},enumerable:!0,configurable:!0}),e.prototype._setSelected=function(e,t){var n=this;if(n._parentSelected)n._parentSelected._setSelected(e,t);else if(n._selected!==e&&!n.simulateSelecting){var i=n._selected;n._selected=e,t&&n._parent&&!n.simulateSelecting&&(n._parent.notifyChanged(n._path+".$selected",i,n._selected,"propchange",{framework:"$selected",checkChildren:!0,instance:n._parent},!1),n._parent.notifyStateChanged(n._path+".$selected",{instance:n,checkChildren:!0}))}},e.prototype.enumSelectedItems=function(e,t){},e.prototype.getJSONPatchPath=function(e){return e=e?this.path+"."+e:this.path,this.parent.getJSONPatchPath(e)},e.prototype.getFullPath=function(){return this.parent.getPropertyPath(this.path)},e.prototype._rmvSelected=function(e,t){var n=this;if(n._parentSelected)n._parentSelected._rmvSelected(e,t);else if(n._selected===e){var i=null,o=n._selected;n._schema&&n._schema.children&&n.enumSelectedItems(n._schema.children,function(e){i||(i=e)}),n._selected=i,t&&n._parent&&!n.simulateSelecting&&(n._parent.notifyChanged(n._path+".$selected",o,n._selected,"propchange",{framework:"$selected",checkChildren:!0,instance:n._parent},!1),n._parent.notifyStateChanged(n._path+".$selected",{instance:n,checkChildren:!0}))}},e.prototype.pushSelected=function(e,t){var n=e.$id,i=this._selectedUids.indexOf(n);if(i<0&&this._selectedUids.push(n),this._schemaItems.primaryKey){var o=b.pkFields(this._schemaItems.primaryKey);n=b.pk2Id(b.extractPkValue(e,o),o),(i=this._selectedPks.indexOf(n))<0&&this._selectedPks.push(n)}this._setSelected(e,t)},e.prototype.model=function(e){return this._getModel(e)},e.prototype.schemaModel=function(){return this._model},e.prototype._getModel=function(e){return this._model},e.prototype._initModelInParent=function(){this._model||(this._model=[],this.isNull=!1,this.isUndefined=!1,this._parent&&(this._parent.model(!0)[this._path]=this._model))},e.prototype.removeSelected=function(e,t){var n=this._selectedUids.indexOf(e.$id);if(0<=n&&this._selectedUids.splice(n,1),this._schemaItems.primaryKey){var i=b.pkFields(this._schemaItems.primaryKey),o=b.pk2Id(b.extractPkValue(e,i),i);0<=(n=this._selectedPks.indexOf(o))&&this._selectedPks.splice(n,1)}this._rmvSelected(e,t)},e.prototype.notifyChangedProperty=function(e){this._parent.notifyChanged(this._path,void 0,void 0,e,{instance:this._parent},!1)},e.prototype.addAjaxException=function(e){return this._parent.addAjaxException(e)},e.prototype.notifyPaginationChanged=function(){},e.prototype.notifyCountChanged=function(){this.notifyChangedProperty("count")},e.prototype.notifySortingChanged=function(){},e.prototype.isQueryable=function(){return this._queryable||!1},e.prototype.addChildError=function(e){var t=this._parent.$errors[this._path];t&&t.addChildError(e)},e.prototype.addErrors=function(e){var t=this._parent.$errors[this._path];t?t.addErrors(e):this._parent.addErrors(e)},e.prototype.addError=function(e){var t=[{severity:"error",message:e,id:C.allocUuid()}];this.addErrors(t)},e.prototype.rmvError=function(e){var t=this._parent.$errors[this._path];t?t.rmvError(e):this._parent.rmvError(e)},Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),e.prototype._destroyItems=function(){this._selectedUids=[],this._items&&(this._model=void 0,this._items=[])},e.prototype.$orderby=function(e){return""},e.prototype.hasNext=function(){return!1},e.prototype.hasPrev=function(){return!1},e.prototype.noPagesCount=function(){return!1},e.prototype.totalPages=function(){return 1},e.prototype.currentPage=function(e){return 0},e.prototype.totalCount=function(){return this._items.length},e.prototype.destroy=function(){var e=this;e.filterManager=null,e._parent=null,e._arrayParent=null,e._parentSelected=null,e._destroyItems(),e.$links=null,e._selectedPks=null,e._model=null,e._schema=null,e._schemaItems=null,e._rootSchema=null},e.prototype._fillItems=function(){var n=this;n._model&&n._model.forEach(function(e,t){n._items.push(e)})},e.prototype._setModel=function(e,t){this.isNull=null===e,this.isUndefined=void 0===e;var n=this.frozen;t&&(this.frozen=!0),this._destroyItems(),this._model=e,this._fillItems(),this.frozen=n},e.prototype.setModel=function(e){this._setModel(e,!0),this._parent.notifyChanged(this._path,void 0,void 0,"propchange",{instance:this._parent,checkChildren:!0},!1),this.notifyCountChanged(),this._parent.notifyStateChanged(this._path,{instance:this._parent,checkChildren:!0}),this.afterSetModel()},e.prototype.afterSetModel=function(){this.$selected=null},e.prototype.indexOf=function(e){return this._items.indexOf(e)},e.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=e.split(","),o=i.length,r=0,s=this._items.length;r<s;r++){for(var a=!0,l=this._items[r],u=0;u<o;u++)if(t[u]!==l[i[u]]){a=!1;break}if(a)return l}return null},e.prototype._expandForEach=function(n,i,o,r,s){return this._items.forEach(function(e){n(e,r,o),r++;var t=C.getValue(e,i);t&&(t.$expand||s)&&(r=t._expandForEach(n,i,o+1,r,s))}),r},e.prototype.forEach=function(n,e,t){if(!e)return this._items.forEach(function(e,t){return n(e,t,0)});this._expandForEach(n,e,0,0,t)},e.prototype.get=function(e){return this._items[e]},e.prototype.set=function(e,t){var n=this._items[e];n.setModel(t),this._model[e]=t,n.notifyChanged("*",void 0,n,"propchange",{instance:n},!0),n.notifyStateChanged("",{checkChildren:!0})},Object.defineProperty(e.prototype,"$expand",{get:function(){return this._expanded},set:function(e){if(this._expanded!==e){var t=this._parent[this._path+_.EXPANDED_FIELD_NAME];this._expanded=e;var n=this._parent[this._path+_.EXPANDED_FIELD_NAME];n!==t&&this._parent.notifyChanged(this._path+_.EXPANDED_FIELD_NAME,t,n,"propchange",{instance:this._parent},!0)}},enumerable:!0,configurable:!0}),e}(),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._fillItems=function(){var r=this,s=null;r._map={},r._selectedUids=[],r._selected&&(r.$selected=null),r._selectedPks.length&&(s=b.pkFields(r._schemaItems.primaryKey)),r._model&&r._model.forEach(function(e,t){r.isQuery&&e&&(e.$create=!1);var n=new g(r._schemaItems,r._parent,r._path,e,r,!1,r._locale,null),i=!1;if(r._items.push(n),r._map[n.$id]=n,s){var o=b.pk2Id(b.extractPkValue(e,s),s);0<=r._selectedPks.lastIndexOf(o)?(n.internalSetSelected(!0)&&(r.simulateSelecting||n.notifyChanged("$select",!1,!0,"propchange",{framework:"$select",instance:n},!0)),i=!0):n.$select&&(i=!0)}else n.$select&&(i=!0);i&&r.pushSelected(n,!1)})},t.prototype._updateSelecting=function(n,i,o,e){var r=this;if(n)r._selectedUids.forEach(function(e){var t=r._map[e];t&&r.pushSelected(t,!0)});else if(r._selectedPks=[],r._selected=null,r._selectedUids.length){var t=r._selectedUids.slice(0);if(o.length||o.push(t.pop()),t.forEach(function(e){var t=r._map[e];t&&(t.$select=!1)}),o.length&&o[0]){var s=r._map[o[0]];o[0]=null,s&&r.pushSelected(s,!0)}}i&&r._items.forEach(function(e){var t=C.getValue(e,i);t&&t._updateSelecting(n,i,o,!1)},null)},t.prototype.clearSelection=function(t,e){var n=this;n.enumSelectedItems(t,function(e){n.selectItem(!1,e,!1,t,!1)}),e&&(n._selectedPks=[])},t.prototype.getSelectedItems=function(e){var n=[];if(this._schemaItems.primaryKey){var i=b.pkFields(this._schemaItems.primaryKey);this.enumSelectedItems(e,function(e){var t=b.pk2Id(b.extractPkValue(e,i),i);n.push(t)})}return n},t.prototype.setSelectedItems=function(i){var o=this;if(o._schemaItems.primaryKey){var r=b.pkFields(o._schemaItems.primaryKey);o.enumSelectedItems("",function(e){var t=b.pk2Id(b.extractPkValue(e,r),r),n=i.indexOf(t);n<0?o.selectItem(!1,e,!1,"",!1):i.splice(n,1)}),i.forEach(function(e){var t=b.findByPk(e,r,o._items);t&&o.selectItem(!0,t,!0,"",!1)})}},t.prototype.updateSelecting=function(e,t){this._updateSelecting(e,t,[],!0)},t.prototype.enumSelectedItems=function(e,i){this._enumSelected(e,function(e,t,n){t&&i(t,n)},0)},t.prototype._enumChildren=function(n,i,e){n&&(e&&e(!0,this),this._items.forEach(function(e){i(e);var t=e[n];t&&t._enumChildren(n,i)}),e&&e(!1,this))},t.prototype.enumChildren=function(e,t,n){this._enumChildren(e,t,n)},t.prototype._enumSelected=function(n,i,o){var r=this;if(o=o||0,n)r._enumSelected(null,i,o),r._items.forEach(function(e){var t=C.getValue(e,n);t&&t.length&&t._enumSelected(n,i,o+1)});else{var e=r._selectedUids.slice(0);if(i(r,null),!e.length)return;e.forEach(function(e){var t=r._map[e];t&&i(r,t,o)})}},t.prototype.selectItem=function(e,n,t,i,o){var r=this;if(n)if(e){if(!n.$select)if(t){if(n.$select=!0,i&&o)(l=C.getValue(n,i))&&l._enumChildren(i,function(e){e.$select=!0},function(e,t){r._simulateSelecting&&(e?t.selecting(!0,i):t.selecting(!1,i))})}else{var s=n.parentArray.simulateSelecting,a=[];if(r._enumSelected(i,function(e,t){if(s){if(e&&!t)return;t.parentArray!==n.parentArray?t.execSyncAction(t.parentArray.getJSONPatchPath()+".$selected",""):t.$select=!1}else e&&!t?(e._selectedUids=[],e._selectedPks=[]):t.internalSetSelected(!1)&&a.push({item:t,value:!1})}),s)n.$select=!0;else n.internalSetSelected(!0)&&a.push({item:n,value:!0}),(u=n._arrayParent)&&u.pushSelected(n,!0);a.forEach(function(e){s||e.item.notifyChanged("$select",!e.value,e.value,"propchange",{framework:"$select",instance:e.item},!0)})}}else if(n.$select)if(t){var l;if(n.$select=!1,i&&o)(l=C.getValue(n,i))&&l._enumChildren(i,function(e){e.$select=!1},function(e,t){r._simulateSelecting&&(e?t.selecting(!0,i):t.selecting(!1,i))})}else{var u,d=n.internalSetSelected(!1);(u=n._arrayParent)&&r.removeSelected(n,!0),d&&(r.simulateSelecting||n.notifyChanged("$select",!0,!1,"propchange",{framework:"$select",instance:n},!0))}},t.prototype.canDoNext=function(){if(this.noPagesCount())return this.hasNext();var e=this.totalPages();return this.currentPage()<e},t.prototype.canDoPrev=function(){return this.noPagesCount()?this.hasPrev():1<this.currentPage()},t.prototype.moveSelected=function(e,t){var n=this,i=null;if(n.enumSelectedItems("",function(e){i||(i=e)}),i){var o=n._items.indexOf(i),r=Math.max(0,Math.min(o+e,n._items.length-1));if(t&&r!==o+e){if(0<e&&n.canDoNext())return void n.currentPage(n.currentPage()+1);if(e<0&&n.canDoPrev())return void n.currentPage(n.currentPage()-1)}var s=n._items[r];s!==i&&n.selectItem(!0,s,!1,"",!1)}},t.prototype.sortByKey=function(e,n){var i=this;if(e&&e.length&&i._model&&i._model.length){var o={},r={},s=[];i._model.forEach(function(e,t){o[e[n]]=e,r[e[n]]=i._items[t],s.push(e[n])}),i._model.splice(0,i._model.length),i._items.splice(0,i._items.length),e.forEach(function(e,t){i._model.push(o[e]),i._items.push(r[e])}),s.join("$$")!==e.join("$$")&&i._parent.notifyChanged(i._path,void 0,void 0,"propchange",{instance:i._parent,checkChildren:!0,sorting:!0},!1)}},t.prototype.findById=function(e){return this._map[e]},t.prototype.findByCondition=function(e){for(var t=Object.keys(e),n=0;n<this._items.length;n++){for(var i=this._items[n],o=!0,r=0;r<t.length;r++)if(i[t[r]]!==e[t[r]]){o=!1;break}if(o)return i}return null},t.prototype.findByIdEx=function(e,t){var n=this._map[e];if(n)return n;for(var i=Object.keys(this._map),o=0;o<i.length;o++){var r=this._map[i[o]][t];if(r&&(n=r.findByIdEx(e,t)))break}return n},t.prototype.findByPk=function(e){if(this._schemaItems.primaryKey){var t=b.pkFields(this._schemaItems.primaryKey);return b.findByPk(e,t,this._items)}return null},t.prototype.indexOf=function(e){return"object"!=typeof e&&(e=this.findById(e)),e?this._items.indexOf(e):null},t.prototype.$orderby=function(e){var t=this.parent.$states[this.path];return void 0===e||(t.orderBy=e),t.orderBy},t.prototype.$filter=function(e){var t=this.parent.$states[this.path];return void 0===e||(t.filter=e),t.filter},t}(_.DataListCore=i),c=function(y){function e(e,t,n,i,o,r,s,a,l,u,d,c,p,h){var f=y.call(this,t,n,i,o,p,h,!0,null)||this,m=f,v=m._parent.getRootModel(),g=x.dsConfig(v.datasets,t,!0);if(v.design&&(g={$type:"odata",$params:{$entity:"EntityIsMissing"},$autoOpen:!1}),!g)throw'Invalid config! You must define a dataset in form for the property: "'+i+'".';return m.allData=c,m._main=g.$main,m._queryable=!0,void 0===r&&(r=g.$params.$top||20),m._query=new _.QueryableDataSource(g,m),m._query.initPagination(r,s,a,l,u,d),m._main&&v&&(v.onRefresh=function(e){var t=e&&e.resetPagination;return m.$refresh(t)}),f}return __extends(e,y),Object.defineProperty(e.prototype,"filter",{get:function(){return this._query.filter},set:function(e){this._query.filter=e,this.notifyChangedProperty("filter")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchFields",{get:function(){return this._query.searchFields},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchField",{set:function(e){this._query.searchFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return this._query.search},set:function(e){this._query.search=e},enumerable:!0,configurable:!0}),e.prototype.totalPages=function(){return this._query.totalPages()},e.prototype.totalCount=function(){return this._query.totalCount()},e.prototype.hasNext=function(){return this._query.hasNext()},e.prototype.hasPrev=function(){return this._query.hasPrev()},e.prototype.noPagesCount=function(){return this._query.noPagesCount()},e.prototype.$refresh=function(e){return this._query.refresh(e,!0)},e.prototype.$orderby=function(e){return this._query.orderBy(e)},e.prototype.notifyPaginationChanged=function(){this.notifyChangedProperty("pagination")},e.prototype.notifyFilterChanged=function(){this.notifyChangedProperty("filter")},e.prototype.notifySortingChanged=function(){this.notifyChangedProperty("sorting")},e.prototype.currentPage=function(e){return null!=e?this._query.currentPage(e):this._query.currentPage()},e.prototype._removeItem=function(e,t){var n=this;if(n._query){var i=n._query.remove(e,t);i.then&&i.then(function(){n.$refresh(!(1<n._items.length)).then(function(){})})}},e.prototype.remove=function(e){var t=this,n=e.model(!0),i=(e.$select,n?n["@odata.etag"]:null);if(t._schemaItems&&t._schemaItems.primaryKey){var o=b.odataId(b.pkFields(t._schemaItems.primaryKey),e);if(t._schemaItems.links&&t._schemaItems.links.$remove&&t._schemaItems.links.$remove.confirm){var r=t._schemaItems.links.$remove.confirm;t._locale&&(r=l.tt(r||"",t._locale)),C.confirm(null,r,function(){t._removeItem(o,i)})}else t._removeItem(o,i)}},e.prototype.destroy=function(){if(this.allData=null,this._query&&(this._query.destroy(),this._query=null),this._main){var e=this._parent.getRootModel();e&&(e.onRefresh=null)}y.prototype.destroy.call(this)},e}(_.DataListBase=o);_.QueryList=c;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this);this._selectedPks=[]},t.prototype.find=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=e.split(","),o=i.length,r=0,s=this._items.length;r<s;r++){for(var a=!0,l=this._items[r],u=0;u<o;u++)if(t[u]!==l[i[u]]){a=!1;break}if(a)return l}return null},t}(o);_.CompositionList=r;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._destroyItems=function(){e.prototype._destroyItems.call(this);this._selectedPks=[]},t}(i),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.push=function(e){this._initModelInParent(),this._model.push(e),this._items.push(e),this._parent.notifyChanged(this._path,void 0,e,"add",{$index:this._items.length-1,$value:e,$id:e,instance:this._parent},!1),this.notifyCountChanged()},t.prototype.splice=function(e,t,n){if(0<t)throw"Delete count is not supported.";this._model&&(void 0===n.$create&&(n.$create=!0),this._model.splice(e,t,n),this._items.splice(e,t,n),this._parent.notifyChanged(this._path,void 0,n,"add",{method:!0,change:!0,$index:e,$value:n,$id:n,instance:this._parent},!1),this.notifyCountChanged())},t.prototype.remove=function(e){var t=this._items.indexOf(e);0<=t&&(this._items.splice(t,1),this._model.splice(t,1),this._parent.notifyChanged(this._path,void 0,e,"remove",{method:!0,change:!0,$index:t,$value:e,$id:e,instance:this._parent},!1),this.notifyCountChanged())},t}(_.SimpleCompositionList=d);_.SimpleTypeList=m;var v=function(l){function e(e,t,n,i,o,r,s){var a=l.call(this,e,t,n,i,o,r,!1,s)||this;return a._createNewItem(!1,!0),a}return __extends(e,l),e.prototype._initNew=function(){var e={$create:!0};this._new=new g(this._schemaItems,this._parent,this._path+".$new",e,null,!0,this._locale,null),this._new.notifyChanged("",void 0,e,"propchange",{instance:this._new,checkChildren:!0},!1),this._new.notifyStateChanged("",{instance:this._new,checkChildren:!0})},Object.defineProperty(e.prototype,"filter",{get:function(){var e=this.$filter();return e?JSON.parse(e):null},set:function(e){var t=e?JSON.stringify(e):"";t!==(this.$filter()||"")&&(this.parent.execSyncAction(this.getJSONPatchPath()+".$filter",t,t)||this.$filter(t))},enumerable:!0,configurable:!0}),e.prototype._createNewItem=function(e,t){t&&Object.defineProperty(this,"$new",{get:function(){return this._new||this._initNew(),this._new},set:function(e){this._new||this._initNew(),this._new._setModel(e,!0),this._new.notifyChanged("",void 0,e,"propchange",{instance:this._new}),this._new.notifyStateChanged("",{instance:this._new,checkChildren:!0})},enumerable:!0}),e&&!this._new&&this._initNew()},e.prototype.updateItem=function(e,t){if(!t.validate())return!1;t.$errors.$.addErrors([],!1);var n=t._getModel(!0);if(this._schemaItems.primaryKey){var i=b.pkFields(this._schemaItems.primaryKey),o=b.extractPkValue(n,i),r=(b.extractPkValue(e._getModel(!0),i),b.findByPk(o,i,this._items));if(r&&r!==e){var s=1<i.length?f.uniqueColumns:f.uniqueColumn;return t.$errors.$.addErrors([{code:"duplicate_value",message:C.format(s,i.join(", "))}],!1),!1}}return!0},e.prototype.addNew=function(){var e=this;if(e._new&&e._new.validate()){var t=e._new._getModel(!1,!0);if(e._schemaItems.primaryKey){var n=b.pkFields(e._schemaItems.primaryKey),i=b.extractPkValue(t,n),o=b.findByPk(i,n,e._items);if(e._parent.$errors[e._path].addErrors([],!1),o){var r=1<n.length?f.uniqueColumns:f.uniqueColumn;return void e._parent.$errors[e._path].addErrors([{code:"duplicate_value",message:C.format(r,n.join(", "))}],!1)}}else e._parent.$errors[e._path].addErrors([],!1);e._destroyNew(),e.push(t,u.dupIgnore),e._createNewItem(!0,!1)}},e.prototype._destroyNew=function(){this._new&&(this._new.destroy(),this._new=null)},e.prototype.destroy=function(){this._destroyNew(),l.prototype.destroy.call(this)},e.prototype.push=function(e,t,n){var i=this;if(void 0===t&&(t=u.dupIgnore),(e.$create=void 0)&&(e.$create=!0),t!==u.dupIgnore&&i._schemaItems.primaryKey){var o=b.pkFields(i._schemaItems.primaryKey),r=b.extractPkValue(e,o),s=b.findByPk(r,o,i._items);if(i._parent.$errors[i._path].addErrors([],!1),s){var a=1<o.length?f.uniqueColumns:f.uniqueColumn;return void(t!==u.dupSilent&&i._parent.$errors[i._path].addErrors([{code:"duplicate_value",message:C.format(a,o.join(", "))}],!1))}}else i._parent.$errors[i._path].addErrors([],!1);if(n)return delete e.$create,n(e);e.$select&&e.$create&&i.clearSelection(),i._initModelInParent(),i.splice(-1,0,e,t)},e.prototype.splice=function(e,t,n,i){if(0<t)throw"Delete count is not supported.";var o=this;o._initModelInParent(),o.manageSelecting&&(o.clearSelection(o.expandingProperty),n.$select=!0);var r=o.frozen;o.frozen=!0;var s=e<0;s?o._model.push(n):o._model.splice(e,t,n);var a=new g(o._schemaItems,o._parent,o._path,n,o,!1,o._locale,null);if(s?o._items.push(a):o._items.splice(e,t,a),o.frozen=r,(o._map[a.$id]=a).$select)o.pushSelected(a,!0);else{var l=o.$states.selectedPks();if(l.length&&o._schemaItems.primaryKey){var u=b.pkFields(o._schemaItems.primaryKey),d=b.pk2Id(b.extractPkValue(n,u),u);if(0<=l.indexOf(d))a._selected=!0,o.pushSelected(a,!0)}}o._parent.notifyChanged(o._path,void 0,n,"add",{method:!0,change:!0,$index:s?o._items.length-1:e,$id:a.$id,$value:a,source:o._parent.getPropertyPath(o._path),instance:o._parent},!1),a.notifyStateChanged("",{checkChildren:!0})},e.prototype.remove=function(e){var t,n=this,i=n.frozen;if(n._model){n.frozen=!0;var o=n._items.indexOf(e),r=e.$id,s=null,a=!1;if(0<=o){e.model();var l=!(t=!0);e.$select&&n.manageSelecting&&(o+1<n._items.length?s=n._items[o+1]:0<o&&(s=n._items[o-1]),l=!s&&!n.simulateSelecting),n._items.splice(o,1),n._model.splice(o,1),i||(n.frozen=i),n.removeSelected(e,l),a=n.frozen=!0}if(n.frozen=i,delete n._map[r],t){n._parent.notifyChanged(n._path,void 0,e,"remove",{mmethod:!0,change:!0,$index:o,$value:e,$id:r,instance:n._parent},!1),a&&(e.destroy(),a=!1);var u=(n._path?n._path+".":"")+"$item";n._parent.notifyStateChanged(u,{}),s&&(n.pushSelected(s,!0),s.internalSetSelected(!0),s.notifyChanged("$select",!1,!0,"propchange",{framework:"$select",instance:s},!0))}a&&e.destroy()}},e.prototype.totalPages=function(){var e=this.parent.$states[this.path];if(e.pageSize){var t=Math.trunc((e.totalCount||0)/e.pageSize);return(0<(e.totalCount||0)%e.pageSize||0===t)&&t++,t}return 1},e.prototype.totalCount=function(){var e=this.parent.$states[this.path];return e.pageSize&&e.totalCount||0},e.prototype.currentPage=function(e){var t=this.parent.$states[this.path];if(void 0===e)return t.pageNumber||1;var n=e||1;return this.parent.execSyncAction(this.getJSONPatchPath()+".$pageNumber",n,n)||(t.pageNumber=n),t.pageNumber},e}(r);_.DataList=v;var g=function(){function o(e,t,n,i,o,r,s,a,l,u){var d=this;d._rootParent=t?t._rootParent:d;var c=[];if(t){var p=t.getPropertyPath();p&&c.push(p)}n&&c.push(n),o&&c.push("$item"),d._fullPath=c.join("."),d.design=u,d.$id=C.allocID(),d.$create=!1,d._initialized={},d._selected=!(!i||!i.$select),d._model={},d.datasets=a,d.transform=l,d.$states={},d.$errors={},d.$links={},d._path=n,d._locale=s,d._parent=t,d._schema=b.expand$Ref(e,d._rootParent._schema),d.className=d._schema.name,d._parent||(d._validators=[{name:"schema",active:!0}]),d._arrayParent=o,d._children={},d._initFromSchema(d._schema),d._parent&&!r||(d.frozen=!0),d===d._rootParent&&(d._rootParent.$create=i&&i.$create||!1),d._setModel(i,!0),d.frozen=!1,d._parent||(d.notifyChanged("*",void 0,i,"propchange",{source:""},!1),d.notifyStateChanged("*",{checkChildren:!0})),h.execInitRules(d)}return Object.defineProperty(o.prototype,"fullPath",{get:function(){return this._fullPath},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"owner",{get:function(){return this._arrayParent?this._arrayParent:this._parent},enumerable:!0,configurable:!0}),o.prototype.pkId=function(){if(this._schema.primaryKey){var e=b.pkFields(this._schema.primaryKey);return b.pk2Id(b.extractPkValue(this,e),e)}},Object.defineProperty(o.prototype,"parentArray",{get:function(){return this._arrayParent},enumerable:!0,configurable:!0}),o.prototype.getJSONPatchPath=function(e){return this.parent?this._arrayParent?this._arrayParent.getJSONPatchPath(this._model.id+(e?"."+e:"")):this.parent.getJSONPatchPath(e?this._path+"."+e:this._path):e},o.prototype.getPropertyPath=function(e,t){if(void 0===e)return this._fullPath;var n=this._fullPath;if(t&&this._fullPath){for(var i=this._fullPath.split("."),o=i.length-1;0<o&&i[o-1]===t&&"$selected"===i[o];)i.pop(),i.pop(),o-=2;n=i.join(".")}return n?n+"."+e:e},o.prototype.saveModel=function(){var e=this._model._$model;e&&delete this._model._$model,this._origModel=b.copyModel(this._schema,this._model),e&&(this._model._$model=e)},Object.defineProperty(o.prototype,"$schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._rootParent},enumerable:!0,configurable:!0}),o.prototype.setModel=function(e){this._destroyObject(this,"_children"),this._children={},this.frozen=!0,this._setModel(e,!1),this.frozen=!1,this._parent||(this.notifyChanged("*",void 0,e,"propchange",{source:"",checkChildren:!0},!1),this.notifyStateChanged("*",{checkChildren:!0}))},o.prototype.update=function(n){var i=this;if(n){var e=Object.keys(i._schema.properties),o=i._rootParent._schema;e.forEach(function(e){var t=i._schema.properties[e];if(b.inModel(t,o))if(b.isCompositionRef(t,o))i[e];else b.isCompositionList(t,o,!1)||b.isSimpleList(t,o)||b.isList(t,o),i[e]=n[e]})}},o.prototype.$refresh=function(e){var i=this;return i._parent?C.Promise.resolve():i.onRefresh?i.onRefresh(e):new C.Promise(function(t,n){x.loadMainData({datasets:i.datasets,transform:i.transform,context:i.model(!0),modal:!1},!1).then(function(e){i.update(e),t()}).catch(function(e){i.addAjaxException(e),n()})})},o.prototype.clearErrors=function(o){var r=this;if(r.$errors&&Object.keys(r.$errors).forEach(function(e){r.$errors[e].clear(!0)}),o){var s=r._rootParent.$schema;Object.keys(r._schema.properties).forEach(function(e){var t=r._schema.properties[e];if(b.inModel(t,s))if(b.isCompositionRef(t,s)){var n=r[e];n&&n.clearErrors(o)}else if(b.isCompositionList(t,s,!1)){var i=r[e];i&&i.forEach(function(e){e.clearErrors(o)})}})}},o.prototype._validate=function(s,a,l,u){var d=this;if(l?d.$errors&&l.forEach(function(e){var t=d.$errors[e];e&&t.clear(!0)}):d.clearErrors(!1),!s||!s.length)return!0;var e=Object.keys(d._schema.properties),c=!1,p=d._rootParent._schema;return a&&h.execBeforeSaveRules(d),e.forEach(function(e){var t=d._schema.properties[e],n=!1;if(b.inModel(t,p)){var i=d.$states[t.$stateProperty||e];if(!i.isHidden&&!i.isDisabled){if(l&&l.indexOf(e)<0)return!1;if(b.isCompositionRef(t,p)){var o=d[e];(o.isNull||o.isUndefined)&&(o=null),o?o._validate(s,a,null,u)||(c=!0):i.isMandatory&&(d.$errors[e].addErrors([{message:C.format(f.required,b._title(t.title,w.locale))}],!1),c=!0)}else if(b.isCompositionList(t,p,!1)){var r=d[e];r&&(r.forEach(function(e){e._validate(s,a,null,u||r)||(c=!0)}),n=!0)}else n=!0;n&&(d._execValidators(s,e,"validate",{},{base:d,state:i,schema:t,value:d[e],listParent:u})||(c=!0))}}}),h.execValidationRules(d,l)&&(c=!0),d._parent||d._execValidators(s,"","validate",{},{base:d,state:null,schema:d._schema,value:null})||(c=!0),!c},o.prototype.isRecursiveRule=function(e){var t=this.getRootModel();if(t.callStack){var n=this.getPropertyPath(e);return 0<=t.callStack.indexOf(n)&&(C.logRule(t.callStack.length,"Recursive rule detected: property: "+n+" - last rule canceled.",n,""),!0)}},o.prototype.validate=function(e){var t=this.getRootModel();return this._validate(t._validators,e)},o.prototype.partialValidate=function(e){var t=this.getRootModel();return this._validate(t._validators,!1,e)},Object.defineProperty(o.prototype,"$select",{get:function(){return this._selected},set:function(e){var t=this;t.internalSetSelected(e)&&t._arrayParent&&(t._selected?t._arrayParent.pushSelected(t,!0):t._arrayParent.removeSelected(t,!0),t._arrayParent.simulateSelecting||t.notifyChanged("$select",!e,e,"propchange",{framework:"$select",source:t.getPropertyPath("$select"),instance:t},!0))},enumerable:!0,configurable:!0}),o.prototype.select=function(e,t,n,i,o){t?this._arrayParent&&this._arrayParent.selectItem(e,this,t,i,o):i?n.selectItem(e,this,!1,i,o,!0):this._arrayParent&&this._arrayParent.selectItem(e,this,!1,null,!1)},o.prototype.toggleExpand=function(e){var t=!1;if(!e)return t;var n=C.getValue(this,e);return n&&(n.$expand=!n.$expand,t=n.$expand),t},o.prototype.enumVisibleChildren=function(t,n,e,i){var o=C.getValue(this,t);o&&(o.$expand||e)&&o._items.forEach(function(e){i(e,n+1),e.enumVisibleChildren(t,n+1,!1,i)})},o.prototype.internalSetSelected=function(e){return this._selected!==e&&(this._selected=e,!0)},Object.defineProperty(o.prototype,"$index",{get:function(){return this._arrayParent?Math.max(this._arrayParent.indexOf(this),0)+1:0},enumerable:!0,configurable:!0}),o.prototype.getJsonPachDelta=function(e){var t=this.model(!1),n=a.compare(this._origModel,t,e);return n&&n.length?(this._origModel=t,n):null},o.prototype.applyJsonPachDelta=function(e){var s=this;if(e&&e.length){s._updating=!0;try{e.forEach(function(i){var e=p.getJSONPatchParent(i.path,s);try{if(1===e.type){if(e.value)if("object"==typeof i.value){var t=e.lastSegment?e.value[e.lastSegment]:e.value;Object.keys(i.value).forEach(function(e){t[e]=i.value[e]})}else e.value[e.lastSegment]=i.value;return}var o=e.value;if(!o)return;if(o.isArray&&0===e.type)if("add"===i.op)Array.isArray(i.value)?o.parent[o.path]=i.value:(i.$create=!1,o.push(i.value));else if("remove"===i.op)if(e.lastSegment){var n=o.find("id",p._segment2Id(e.lastSegment));n&&o.remove(n)}else o.parent[o.path]=void 0;else"sort"===i.op&&o.sortByKey(i.value,"id");else if(3===e.type)if("$errors"===e.lastSegment)i.value?Object.keys(i.value).forEach(function(e){var t=o.$errors[e];t&&(t.clear("remove"===i.op),"remove"!==i.op&&t.addErrors(i.value[e]))}):o.clearErrors(!0);else if(o.isArray&&!e.lastSegment)"add"===i.op&&o.addErrors([i.value]);else{var r=o[e.lastSegment];r&&("remove"===i.op?r.clear(!0):r.addErrors(i.value))}else if(2===e.type){if(o&&!o.isState){if(!(o=o[e.lastSegment]))return;return void("object"==typeof i.value&&Object.keys(i.value).forEach(function(t){if(o[t]&&o[t].isState){var n=i.value[t];"object"==typeof n&&Object.keys(n).forEach(function(e){o[t][e]=n[e]})}else o[t]=i.value[t]}))}"remove"===i.op?o[e.lastSegment]=void 0:o[e.lastSegment]=i.value}else"remove"===i.op?o[e.lastSegment]=void 0:o[e.lastSegment]=i.value}catch(e){throw console.log("Json patch Error: "+JSON.stringify(i)),e}})}finally{var t=s.model(!1);s._origModel=t,s._updating=!1}}},o.prototype.$save=function(){var i=this;if(i.getRootModel()!==i)return C.Promise.reject(null);if(!i.validate(!0))return C.Promise.reject(null);var e=x.extractMainDataSource(i);if(e&&x.isCreateOrUpdate(e)){var o=i.model(!1);if(i.$create)e.$method="POST",delete e.$params.$entityId;else{if(e.$method="PATCH",!i._schema.primaryKey)return i.addError("Primary key is missing. Check schema."),C.Promise.reject(null);var t=void 0;if(s.useJSONPatch){var n=b.pkFields(i._schema.primaryKey),r=b.extractPkValue(o,n);if(e.$params.$entityId=b.entityId(r),!(t=a.compare(i._origModel,o,{useId:!0}))||!t.length)return C.Promise.resolve(o)}else if(!(t=C.deltaPatch(i._origModel,o)))return C.Promise.resolve(o);o=t}return new C.Promise(function(t,n){x.datasetAsPromise(e,o).then(function(e){i.$create=!1,t()}).catch(function(e){i.addAjaxException(e),n(null)})})}return C.Promise.reject(null)},o.prototype.getRootModel=function(){return this._rootParent},o.prototype.addValidator=function(e,t){this.getRootModel()._validators.push({name:e,active:t})},o.prototype.activateValidator=function(e,t){for(var n=this.getRootModel(),i=0,o=n._validators.length;i<o;i++){var r=n._validators[i];if(r.name===e){r.active=t;break}}},o.prototype.hasValidators=function(){var e=this.getRootModel();if(e._validators.length){if(1==e._validators.length)return e._validators[0].active;for(var t=0,n=e._validators.length;t<n;t++)if(e._validators[t].active)return!0}return!1},o.prototype.getParentOf=function(e,t){return this.getValue(_.SchemaUtils.parentPath(e),t)},o.prototype.setValue=function(e,t,n){var i=this,o=e.split("."),r=n?o.lastIndexOf("$item"):-1,s=n?o.lastIndexOf("$selected"):-1;0<r?i=0<s&&r<s?n[o.slice(0,s+1).join(".")]:n[o.slice(0,r+1).join(".")]:0<s&&(i=n[o.slice(0,s+1).join(".")]);for(var a=Math.max(Math.max(r+1,s+1),0),l=o.length;a<l&&i;a++)a===l-1?i[o[a]]=t:i=C.getPathValue(i,o[a])},o.prototype._getModel=function(e,t){if(e)return this._model;var n=this.getRootModel(),i=n?n._schema:this._schema;return b.copyModel(this._schema,this._model,i,t)},o.prototype.schemaModel=function(e){var t=this.getRootModel(),n=t?t._schema:this._schema;return b.copyModel(this._schema,this._model,n,!0,e)},o.prototype.model=function(e){return this._getModel(e)},o.prototype.getRelativeValue=function(e){return this.getValue(e,{})},o.prototype.getRelativeState=function(e){return this.getState(e,{})},o.prototype.getValueInfo=function(e,t){if(!e)return{value:this,parentIsNull:!1};var n=this,i=e.split("."),o=t?i.lastIndexOf("$item"):-1,r=t?i.lastIndexOf("$selected"):-1;0<o?n=0<r&&o<r?t[i.slice(0,r+1).join(".")]:t[i.slice(0,o+1).join(".")]:0<r&&(n=t[i.slice(0,r+1).join(".")]);for(var s=Math.max(Math.max(o+1,r+1),0),a=i.length;s<a&&n;s++)n=C.getPathValue(n,i[s]);return{value:n,parentIsNull:!1}},o.prototype.getValue=function(e,t){return this.getValueInfo(e,t).value},o.prototype.getSchema=function(e){return b.getSchema(e,this._schema,this._rootParent._schema,!1)},o.prototype.getState=function(e,t){if(!e)return{value:this,parentIsNull:!1};var n,i=this,o=e.split("."),r=o.pop(),s=r,a={},l=!1,u=o.length-1;if(b.isMetaProp(r)){var d=b.getSchema(e,this._schema,this._rootParent._schema,!1);d&&d.$stateProperty&&(r=d.$stateProperty)}var c=t?o.lastIndexOf("$item"):-1,p=t?o.lastIndexOf("$selected"):-1;0<c?i=0<p&&c<p?t[o.slice(0,p+1).join(".")]:t[o.slice(0,c+1).join(".")]:0<p&&(i=t[o.slice(0,p+1).join(".")]);for(var h=Math.max(Math.max(c+1,p+1),0),f=o.length;h<f;h++){var m=o[h];if(0<m.indexOf("[")){if(i=C.getPathValue(i,m))continue;a.isDisabled=!0;break}if(h===u&&"$links"===m){l=!0;break}if(n=!(i=i[m])||i.isNull||i.isUndefined?null:i.$states&&i.$states[m]?i.$states[m].state():null,(!i||i.isNull||i.isUndefined)&&(a.isDisabled=!0),n&&n.isHidden&&(a.isHidden=!0),n&&n.isDisabled&&(a.isDisabled=!0),n&&n.isReadOnly&&(a.isReadOnly=!0),!i)break}var v={};if(!l){if(r===_.SELECTED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!1,isHidden:!1};if(r===_.INDEX_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1};if(r===_.EXPANDED_FIELD_NAME)return{isDisabled:!1,isReadOnly:!0,isHidden:!1}}if(i){var g="$states";l&&(g="$links");var y=i[g]?i[g][r]:null;y&&(v=y.state(),!l&&i.$errors&&i.$errors[s]&&(v.errors=i.$errors[s].errors()))}return $.extend({},v,a)},o.prototype._setPropErrors=function(e,t){if(t.$errors&&t.$errors[e]&&this.$errors[e]){var n=t.$errors[e],i=[];n.forEach(function(e){i.push(e)}),this.$errors[e].addErrors(i)}this.$errors[e]&&(t.$errors[e]=this.$errors[e].errors())},o.prototype._setModel=function(r,e){var s=this,t=s.frozen;e&&(s.frozen=!0),s.isNull=null===r,s.isUndefined=void 0===r,(r=r||{}).$undefined&&(s.isUndefined=!0,delete r.$undefined);var n=void 0!==r.$create?r.$create:!!s._parent&&s._parent.$create;r&&(r=b.init(s._schema,s._rootParent._schema,null,r,n,{select:s._schema===s._rootParent._schema}))&&(s.$create=r.$create,r.$create),r.$states=r.$states||{},r.$links=r.$links||{},r.$errors=r.$errors||{};var i=Object.keys(s._schema.properties),a=s._rootParent._schema;s._model.$links=r.$links,i.forEach(function(t){var e=s._schema.properties[t];if(b.inModel(e,a)){var n=b.isMetaProp(t),i=r[t];if(i||!b.isCompositionList(e,a,!1)&&!b.isList(e,a)||(r[t]=i),b.isList(e,a)?s._setQueryListChild(t,i,r.pageSize,r.pageSize?Math.round(r.skip/r.pageSize)+1:0,r.count,r._hasNext,r._hasPrev,r._noPagesCount,r._origData):s[t]=i,!n){if(r.$states&&r.$states[t]){var o=r.$states[t];Object.keys(o).forEach(function(e){s.$states[t][e]=o[e]})}r.$states[t]=s.$states[t].state()}s._setPropErrors(t,r)}}),s._setPropErrors("$",r),s.$errors&&!s.$errors.$&&s._parent&&Object.defineProperty(s.$errors,"$",{get:function(){return s._parent.$errors.$},enumerable:!1}),r.$links&&(i=Object.keys(s._schema.links||{})).forEach(function(e){var t=r.$links[e],n=s.$links[e];t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),r.$links[e]=s.$links[e].state()}),s._model=r,s.frozen=t},o.prototype._setRefChild=function(e,t,n){var i=this.frozen;this.frozen=!0,this._children[e]?this._children[e]._setModel(n,!0):this._children[e]=new o(this._schema.properties[e],this,e,n,null,!0,this._locale,null),this.frozen=i},o.prototype._setListChild=function(e,t,n){var i=this,o=i.frozen;if(i.frozen=!0,i._children[e])i._children[e]._setModel(n,!0);else{var r=null;i._arrayParent&&i._arrayParent.schema.children===e&&(r=i._arrayParent),i._children[e]=new v(i._schema.properties[e],i,e,n,null,i._locale,r)}i.frozen=o},o.prototype._setSimpleListChild=function(e,t,n){var i=this.frozen;this.frozen=!0,this._children[e]?this._children[e]._setModel(n,!0):this._children[e]=new m(this._schema.properties[e],this,e,n,null,this._locale,!1,null),this.frozen=i},o.prototype._setQueryListChild=function(e,t,n,i,o,r,s,a,l){var u=this,d=u.frozen;u.frozen=!0,u._children[e]&&u._children[e].destroy(),u._children[e]=new c(u._schema,u._schema.properties[e],u,e,t,n,i,o,r,s,a,l,null,u._locale),u.frozen=d,u.notifyChanged(e,null,t,"propchange",{instance:u},!0),u.notifyStateChanged(e,{instance:u,checkChildren:!0})},o.prototype._initFromSchema=function(o){var m=this;if(m._model){var v=o.states?$.extend(!0,{},o.states):null,r=o.links?$.extend(!0,{},o.links):null,g=o.errors?$.extend(!0,{},o.errors):null,s=!1,e=Object.keys(o.properties);e.forEach(function(e){if(!b.isMetaProp(e)){var t=o.properties[e];if("password"===t.format){if(!t.capabilities||!t.capabilities.noConfirming){var n="$$"+e;t.$meta=n;var i=o.properties[n];i||((i=$.extend(!0,{},t)).title=w.locale.ui.Confirm,i.$stateProperty=e,o.properties[n]=i,s=!0)}}else"rate"===t.format&&(void 0===t.exclusiveMinimum&&(t.exclusiveMinimum=!0),void 0===t.exclusiveMaximum&&(t.exclusiveMaximum=!0),void 0===t.decimals&&(t.decimals=b.RATE_DECIMALS),void 0===t.maximum&&(t.maximum=b.RATE_MAXIMUM),void 0===t.minimum&&(t.minimum=-b.RATE_MAXIMUM),void 0===t.symbol&&(t.symbol=b.RATE_SYMBOL))}}),s&&(e=Object.keys(o.properties)),e.forEach(function(e){var a,l,t,n,i,o,r,s,u,d,c,p,h,f;l=e,t=(a=m)._rootParent._schema,n=a._schema.properties[l],b.inModel(n,t)&&(Object.defineProperty(a,l,{get:function(){var e=this._children[l];return e||this._model[l]},set:function(e){var t=this,n=t._model[l];if(n!==e||!t._initialized[l]){var i=t._schema.properties[l],o=t._beforeChange(t,l,i,n,e,!t._initialized[l]);if(e=o.value,t._initialized[l]=!0,o.continue){if(t.isRecursiveRule(l))return;t._model[l]=e;var r=a._rootParent._schema,s=t.$errors[l];s&&s.clear(!0),b.isCompositionRef(i,r)?(t._setRefChild(l,n,e,{}),t.notifyChanged(l,n,e,"propchange",{instance:t,checkChildren:!0},!0),t.notifyStateChanged(l,{instance:t,checkChildren:!0})):b.isCompositionList(i,r,!1)?(t._setListChild(l,n,e,"propchange",{checkChildren:!0}),t.notifyChanged(l,n,e,"propchange",{instance:t},!0),t.notifyStateChanged(l,{instance:t,checkChildren:!0})):b.isSimpleList(i,r)?(t._setSimpleListChild(l,n,e,"propchange",{}),t.notifyChanged(l,n,e,"propchange",{instance:t},!0),t.notifyStateChanged(l,{instance:t,checkChildren:!0})):b.isList(i,r)?t[l].setModel(e):t.notifyChanged(l,n,e,"propchange",{instance:t},!0)}}},enumerable:!0}),b.isCompositionList(n,t,!1)&&Object.defineProperty(a,l+_.EXPANDED_FIELD_NAME,{get:function(){var e=this[l];return e&&e.length?e.$expand?2:1:0},set:function(e){var t=this[l];t&&(1===e?t.$expand=!1:2===e&&(t.$expand=!0))},enumerable:!0})),b.isMetaProp(e)||(i=m,o=e,r=v?v[e]:null,s=i._schema.properties[o],u=i._rootParent._schema,b.inModel(s,u)&&(b.isNumber(s)&&(b.isMoney(s)?((r=r||{}).symbol||(r.symbol=s.symbol||k.number.symbol),r.decimals||(r.decimals=void 0!==s.decimals?s.decimals:k.number.places)):(r=r||{},void 0!==s.symbol&&((r=r||{}).symbol=s.symbol),void 0!==s.decimals?r.decimals=s.decimals:r.decimals=0)),"array"!==s.type||s.items&&s.items.type&&"object"!==s.items.type?i.$states[o]=new y.DataStates(i,o,r):i.$states[o]=new y.ListStates(i,o,r))),d=m,c=e,p=g?g[e]:null,h=d.$schema.properties[c],f=d.root.$schema,b.inModel(h,f)&&!b.isCompositionRef(h,f)&&(d.$errors[c]=new y.Errors(d,c,p))}),o.links&&Object.keys(o.links).forEach(function(e){var t,n,i;t=m,n=e,i=r?r[e]:null,t.$links[n]=new y.LinkStates(t,n,i)}),m._parent&&!m._arrayParent||(m.$errors.$=new y.Errors(m,"$",[]))}},o.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),p.getValue(t.join("."),this)},o.prototype.addAjaxException=function(e){var o=this;if(o._parent)return o._parent.addAjaxException(e);var t=n.extractAjaxErrors(e),r=[],s=null;t.message&&(s={message:t.message,details:[]},r.push(s)),t.list&&t.list.length&&t.list.forEach(function(e){var t=!0;if(e.target){var n=o.getParentModel(e.target);if(n){var i=b.lastSegment(e.target,null);n.hasOwnProperty(i)&&(t=!1,n.$errors[i].addError(e.message))}}t&&(s?s.details.push({message:e.message}):r.push({message:e.message}))}),o.$errors.$.addErrors(r)},o.prototype.addError=function(e){var t=[{severity:"error",message:e,id:C.allocUuid()}];this.addErrors(t)},o.prototype.rmvError=function(e){this.$errors.$?this.$errors.$.rmvError(e):this._parent&&this._parent.rmvError(e)},o.prototype.addErrors=function(e){this.$errors.$?this.$errors.$.addErrors(e):this._parent&&this._parent.addErrors(e)},o.prototype._beforeChange=function(e,t,n,i,o,r){var s={continue:!0,value:o};return b.isNumber(n)&&!isNaN(o)&&null!=o&&this.$states[t]&&void 0!==this.$states[t].decimals&&!1!==this.$states[t].decimals&&(s.value=parseFloat(o.toFixed(this.$states[t].decimals)),r||i!==s.value||(s.continue=!1)),s.continue&&n.ux&&n.emitChanging&&(s.continue=e.notifyBeforeChanged(t,i,o,{})),s},o.prototype.notifyStateChanged=function(i,o){var r=this;r.frozen||r._arrayParent&&r._arrayParent.frozen||(r!==r._rootParent?(o.fromChildren=!0,r._getPaths(o).forEach(function(e,t){var n=e;i&&(n=n?n+"."+i:i),o.change=0===t,r._rootParent.notifyStateChanged(n,o)})):(o.fromChildren||(o.change=!0),C.logModule("proxydata")&&C.log("State changed: "+r._extractPropName(i||"",o),"proxydata"),r.onstatechanged&&r.onstatechanged(i,o)))},o.prototype._extractPropName=function(n,i){return Object.keys(i).sort().reverse().forEach(function(e){var t=i[e];t&&void 0!==t.$index&&(n=n.replace(e,e+"["+t.$index+"]"))}),n},o.prototype._execValidators=function(e,t,n,i,o){var r=this,s=!1;if(t){if(!o){var a=r.getValueInfo(t,i);if(void 0===a.value&&a.parentIsNull)return!s}}else if("validate"!==n)return!s;return e.forEach(function(e){e.active&&(e.hnd||(e.hnd=b.getValidator(e.name)),e.hnd&&(e.hnd(n,r,{name:t,params:i,locale:r._locale},o)||(s=!0)))}),!s},o.prototype.notifyBeforeChanged=function(i,o,r,s){var a=this;if(!(a.frozen||a._arrayParent&&a._arrayParent.frozen)){if(a===a._rootParent)return s.fromChildren||(s.change=!0),s.continue=!0,a.onchange&&s.change&&a.onchange(i,o,r,"beforeChange",s),s.continue;s.fromChildren=!0;var e=a._getPaths(s),l=!0;e.forEach(function(e,t){var n=e;i&&(n=n?n+"."+i:i),s.change=0===t,l=l&&a._rootParent.notifyBeforeChanged(n,o,r,s)})}},o.prototype._getSelectedParentArray=function(e){for(var t=this._arrayParent,n=this._arrayParent.path+".$item";t.schema.children&&t.schema.children===t.path&&t.parent._arrayParent;)n=(t=t.parent._arrayParent).path+".$item."+n;return e?{path:n,value:t}:t},o.prototype._getPaths=function(i){var o=this;if(o._arrayParent){var n=o._getSelectedParentArray(!0),r=n.value,s=r.parent._getPaths(i),a=null;return r.$selected===o&&(a=[],s.forEach(function(e,t){if(0<e.indexOf(".$selected.")||e.indexOf(".$item.")<0){var n=(e?e+".":"")+r.path+".$selected";a.push(n),i[n]=o}})),s.forEach(function(e,t){s[t]=(e?e+".":"")+n.path,i[s[t]]=o}),a?s.concat(a):s}if(!o.parent)return[""];var l=o.parent._getPaths(i);return l.forEach(function(e,t){l[t]=e?e+"."+o._path:o._path}),l},o.prototype.notifyChanged=function(i,o,r,s,a,l){var u=this;u.frozen||u._arrayParent&&u._arrayParent.frozen||(u!==u._rootParent?(a.fromChildren=!1,u._getPaths(a).forEach(function(e,t){var n=e;i&&(n=n?n+"."+i:i),a.change=0===t,u._rootParent.notifyChanged(n,o,r,s,a,l)})):(a.fromChildren||(a.change=!0),C.logModule("proxydata")&&C.log("Changed: "+u._extractPropName(i||"",a)+", operation = "+s,"proxydata"),u.onchange&&u.onchange(i,o,r,s,a),!u._updating&&l&&u._validators&&a.change&&u.hasValidators()&&u._execValidators(u._validators,i,"propchanged",a),u._updating||!a.change||a.framework||(h.execPropChangeRules(u,i,a,{validations:!0,propagations:!0}),u.onsync&&u.onsync(null))))},o.prototype.execSyncAction=function(e,t,n){var i=this._rootParent;if(i.onsync&&(!n||!n.$nosync)){var o=i.syncAction(e,t);if(o)return i.onsync(o),!0}return!1},o.prototype.syncAction=function(e,t){var n=e.split(".");if("$sort"===n[n.length-1])return{op:"replace",path:"/"+n.join("/"),params:t};if("$filter"===n[n.length-1])return{op:t?"replace":"remove",path:"/"+n.join("/"),params:t};if("$pageNumber"===n[n.length-1])return{op:"replace",path:"/"+n.join("/"),params:t};if("$pageSize"===n[n.length-1])return{op:"replace",path:"/"+n.join("/"),params:t};if("$selected"===n[n.length-1])return{op:"replace",path:"/"+n.join("/"),params:t,delayed:!0};if("$after"===e)return{op:"$empty",after:t.$after};var i=e.indexOf("$links.");if(i<0)return null;var o="";0<i&&(o=e.substr(0,i-1));var r=e.substr(i+"$links.".length),s=this.getSchema(o);if(s.links&&s.links[r]&&s.links[r].ux)return null;if(!o&&"save"===r&&!this.validate(!0))return null;var a=null,l=null;return s.links&&s.links[r]&&(s.links[r].data&&(t=s.links[r].data),a=s.links[r].after,t&&t.$after&&(a=a?[a,t.$after]:t.$after),void 0===(l=s.links[r].successMessage)&&s.links[r].isSave&&(l=!0)),{path:"/"+n.join("/"),params:t,after:a,successMessage:l}},o.prototype._destroyObject=function(e,t){var n=e[t];n&&Object.keys(n).forEach(function(e){n[e].destroy(),delete n[e]})},o.prototype.hasRootErrors=function(){return!!(this.$errors&&this.$errors.$&&this.$errors.$.hasErrors())},o.prototype.hasErrors=function(){var t=!1;if(t)return t;for(var e=Object.keys(this.$errors),n=0,i=e;n<i.length;n++){var o=i[n];if(this.$errors[o].hasErrors()){t=!0;break}}if(t)return t;e=Object.keys(this._schema.properties||{});for(var r=this._rootParent._schema,s=0,a=e;s<a.length;s++){o=a[s];var l=this._schema.properties[o];if(b.inModel(l,r)){if(b.isCompositionRef(l,r))t=this[o].hasErrors();else if(b.isCompositionList(l,r,!1)){this[o].forEach(function(e){t||(t=e.hasErrors())})}if(t)break}}return t},o.prototype.destroy=function(){var e=this;e._parent=null,e._destroyObject(e,"_children"),e._destroyObject(e,"$states"),e._destroyObject(e,"$links"),e._destroyObject(e,"$errors"),e._arrayParent=null,e._model&&(e._model._$model=null,e._model.parentModel=null),e._model=null,e._schema=null,e.onRefresh=null,e.onchange=null,e.onsync=null,e.onstatechanged=null,e._rootParent=null},o}();_.Data=g,_.ObservableUtils=p}(w.Observable||(w.Observable={}))}(Phoenix||(Phoenix={})),function(e){var t,n,c;t=e.serversync||(e.serversync={}),(n=e).Observable,c=n.DatasetPlugin,t.notifyClose=function(e){var t=[];e.forEach(function(e){t.push({requestType:"patch",id:e.viewId,viewName:e.viewName,patch:[{op:"add",path:"/$links/close",value:{deferClose:e.deferClose}}]})}),c.executeDatasets([{name:"patch",$type:"sync",$params:{$noWait:!0,$transactionId:"id",$method:"PATCH",$entity:"batch",viewId:"multiple",$data:{},$query:{}}}],t,{},[],function(e,t){})},t.update=function(e,o,n,i){try{var r={};if(e&&e.length){var s=[],a=[];e.forEach(function(e){var t=o[e.formId];if(a.indexOf(t)<0&&a.push(t),"$delta"===e.op){var n=o[e.formId];if(n){var i=n.$model.getJsonPachDelta({useId:!0});i&&i.length&&(r[e.formId]=i,s.push(e.formId))}}else"$empty"===e.op?r[e.formId]=[]:(r[e.formId]=r[e.formId]||[],r[e.formId].push({op:e.op||"add",path:e.path,value:e.params})),s.push(e.formId)}),Object.keys(r).length&&a.slice().forEach(function(e){e.visibleChildForms().forEach(function(e){if(a.indexOf(e)<0){var t=e.data.$id;r[t]=r[t]||[],a.push(e),s.push(t)}})}),a.forEach(function(e){var t=e.parentForm;if(t&&t.useSync&&a.indexOf(t)<0){var n=t.data.$id;r[n]=r[n]||[],a.push(t),s.push(n)}})}var l=Object.keys(r);if(!l.length){try{n(null)}finally{i()}return}var t={name:"patch",$type:"sync",$params:{$transactionId:o[l[0]].syncDataSet().$params.$transactionId,$method:"PATCH",$entity:"batch",viewId:"multiple",$data:{},$query:{}}},u=[];l.forEach(function(e){var t=o[e],n=t.syncDataSet();u.push({requestType:"patch",id:t.$model.model(!0).id,viewName:n.$params.$entity,patch:r[e]})});var d={};c.executeDatasets([t],u,d,[],function(e,t){try{t?o[l[0]].$model.addAjaxException(t):n(d.patch)}finally{i()}})}catch(e){i()}}}(Phoenix||(Phoenix={})),function(t){!function(e){t.data,t.utils;var f=e.SchemaUtils;f.registerValidator("schema",function(e,t,n,i){var o=!0,r="validate"===e;if("propchanged"===e||r){if(!n.name)return o;if(n.method)return!0;var s=f.lastSegment(n.name,null);if(0<=f.arrayProps.indexOf(s))return o;var a=i?i.value:t.getValue(n.name,n.params),l=i?i.state:t.getState(n.name,n.params),u=i?i.schema:t.getSchema(n.name);if(l&&(l.isHidden||l.isDisabled))return o;var d=n.locale,c=[],p=i?i.base:t.getParentOf(n.name,n.params);if(f.validateSchema(a,u,l,d,c,[],i?i.listParent:null)||(o=!1),r&&f.isMetaProp(s)&&u&&"password"===u.format){var h=t.getValue(f.extractBase(n.name)+u.$stateProperty,n.params);u=t.getValue(f.extractBase(n.name)+u.$stateProperty,n.params),f.validatePassword(h,a,u,l,d,c)||(o=!1)}p.$errors&&p.$errors[s]&&p.$errors[s].addErrors(c)}return o})}(t.Observable||(t.Observable={}))}(Phoenix||(Phoenix={})),function(u){!function(t){var e=u,n=u.serversync,i=u.history,o=u.dom,a=e.locale,l=u.utils,r=function(){function e(){this._forms={},this._formsById={},this._inAction=!1,this._inSync=!1,this._inProcessing=!1,this._onsync=n.update,i.destroyViewHandler=n.notifyClose}return Object.defineProperty(e.prototype,"inSync",{get:function(){return this._inSync},set:function(e){this._inSync=e},enumerable:!0,configurable:!0}),e.prototype.setInAction=function(e){this._inAction=e},e.prototype.isInAction=function(){return this._inAction},e.prototype.hasActions=function(){return this._actions||this.inSync},Object.defineProperty(e.prototype,"isInProcessing",{get:function(){return this._inProcessing},enumerable:!0,configurable:!0}),e.prototype.processing=function(e){this._inProcessing=e,o.processing(e,100)},e.prototype.clearSyncTimeOut=function(){this._syncTimeOut&&clearTimeout(this._syncTimeOut)},e.prototype.pushSyncAction=function(e,t){t.formId=e,this._actions=this._actions||[];var n=this._actions.findIndex(function(e){return e.formId===t.formId&&e.path===t.path&&e.op===t.op});0<=n&&this._actions.splice(n,1),this._actions.push(t)},e.prototype._internalSendSyncData=function(){var s=this;s.inSync=!0,s.processing(!0);var e=null;s._actions&&s._actions.length&&(e=s._actions),s._actions=null;var i={};Object.keys(s._formsById).forEach(function(e){var t=s._formsById[e];if(t.useSync){var n=t.$model.model(!0).id+"";i[n]=i[n]||[],i[n].push(t)}}),s._onsync(e,s._formsById,function(e){e.forEach(function(t){i[t.id].forEach(function(e){return e.applyJsonPachDelta(t.patch)})})},function(){s._syncTimeOut=null,s.processing(!1),s.inSync=!1,e&&e.forEach(function(e){var t=s._formsById[e.formId],n=function(){e&&e.after&&(t.$model.hasErrors()||("string"==typeof e.after?t.execAction(e.after,{},{$nosync:!0}):Array.isArray(e.after)?e.after.forEach(function(e){"string"==typeof e?t.execAction(e,{},{$nosync:!0}):e()}):e.after()))};if(e&&e.successMessage&&!t.$model.hasErrors()){var i="object"==typeof e.successMessage?e.successMessage:{title:"",content:""},o=i.title||t.$schema.title||a.ui.Info,r=i.content||a.ui.SaveSuccessful;l.info(o,r,"success",n)}else n()})})},e.prototype.sendSyncData=function(){this.inSync||(this._syncTimeOut&&clearTimeout(this._syncTimeOut),this._syncTimeOut=setTimeout(this._internalSendSyncData.bind(this),80))},e.prototype.broadcast=function(n,i){var o=this;l.nextTick(function(){Object.keys(o._forms).forEach(function(e){var t=o._forms[e];t&&t.execAction(n,i)})})},e.prototype.add=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=e),e&&e.data&&e.data.$id&&(this._formsById[e.data.$id]=e)},e.prototype.remove=function(e){e&&e.data&&e.data.name&&(this._forms[e.data.name]=null),e&&e.data&&e.data.$id&&delete this._formsById[e.data.$id]},e.prototype.formByName=function(e){return this._forms[e]},e.prototype.formById=function(e){return this._formsById[e]},e.prototype.destroyForms=function(){var n=this;Object.keys(n._forms).forEach(function(e){var t=n._forms[e];try{t.destroy()}catch(e){}}),n._forms=[],this._formsById={}},e}();t.FormManager=r;var s;t.formManager=function(){return s||(s=new r),s},o.finalizeHandlers.push(function(){i.supportRefresh?i.clearLastData(!0):i.clear(!0,!0);var e=t.formManager();e&&e.destroyForms()})}(u.ui||(u.ui={}))}(Phoenix||(Phoenix={})),function(o){var i,e,u,c,p,h,f,m,r,v,s,t,g,n,a;i=o.ui||(o.ui={}),u=(e=o).ui,c=e.utils,p=e.build,h=e.link,f=e.dom,m=e.history,r=e.locale,v=e.layoutUtils,s=e.customData,t=e.preferences,g=e.Observable.SchemaUtils,n=e.Observable.ObservableUtils,a=function(d){function e(e,t,n,i,o,r){var s=d.call(this,e,t,n,i,o,r)||this;s._event2Layout=function(e){if(!this.$element)return null;for(var t=this.$element.get(0),n=e.target;n;){var i=n.getAttribute("data-render");if(i){var o=this.getLayoutById(i);if(o)return o}n=n===t?null:n.parentNode}return null};var a=s;a._modalForm=!!t&&t._modalForm,a._moneyUnitCoef=1,n&&n.$transactionId&&(a._transactionId=n.$transactionId,a._viewId=n.id,a._viewName=n.$viewName,delete n.$transactionId,delete n.$viewName,i&&(i.properties=i.properties||{},i.properties.containerHasChanges=i.properties.containerHasChanges||{type:"boolean"}),a._viewName&&m.addData({viewId:a._viewId,transactionId:a._transactionId,viewName:a._viewName})),a._resizeHnd=function(e){return a._resizeControls(!1),!0},h.context().$url.$showRules&&c.showRules(!0),t.module&&(a.module=t.module,delete t.module),e.data&&(a.formData=$.extend(!0,{},e.data)),a.formManager=u.formManager(),a.formManager.add(a),a.$schema=i||{},a.$rootSchema=a.$schema,t.path&&(a.$rootPath=t.path,a.$schema=g.getSchema(t.path,a.$schema,a.$rootSchema,!0)),t.checkFormLayout&&t.checkFormLayout(a),a.$locale=o,t&&t.preferenceName&&(a._settingsName=t.preferenceName,a._settings=r),t&&t.storageName&&(a._settingsName=t.storageName,a._localSettings=!0);var l=t&&t.jsonSync||null!==a.syncDataSet();return a.useSync=l,g.fillEnumsFromData(a.$schema,n),a.setData(n),a.$model.onchange=a._modelChanged.bind(a),l&&(a.$model.onsync=a._synModel.bind(a)),a.$model.onstatechanged=a._stateChanged.bind(a),a._bindValues={},a._bindStates={},a._bindTitles={},a._bindAccordion={},Object.keys(a.map).forEach(function(t){var e=a.map[t];if(e.$bindState&&(a._bindStates[e.$bindState]=a._bindStates[e.$bindState]||[],a._bindStates[e.$bindState].push(t)),e.bindVisibility&&(a._bindValues[e.bindVisibility]=a._bindValues[e.bindVisibility]||[],a._bindValues[e.bindVisibility].push(t)),e.$title&&e.$title.value&&!e.$title.isHidden){var n=[];c.extractAngularVars(e.$title.value,n)&&(n&&n.forEach(function(e){a._bindTitles[e.name]||(a._bindTitles[e.name]=[],a.registerListenerFor(e.name,a,"layout-titles")),a._bindTitles[e.name].push(t)}),e.$fields=!0)}e.$bindPages&&e.$type===v.LAYOUT_ACCORDION&&"none"===e.$widget&&(a._bindAccordion[e.$bindPages]||(a._bindAccordion[e.$bindPages]=[],a.registerListenerFor(e.$bindPages,a,"layout-accordion")),a._bindAccordion[e.$bindPages].push(t),a._activateTab(e))}),Object.keys(a._bindStates).forEach(function(e){var t=a.$model.getState(e,{});t&&t.isHidden&&a._bindStates[e].forEach(function(e){a.map[e].$isHidden=t.isHidden,a.map[e].$isDisabled=t.isDisabled});a.registerListenerFor(e,a,"layout-state")}),Object.keys(a._bindValues).forEach(function(e){var t=a._bindValues[e],n=a.$model.getValue(e,{}),i=a.getSchema(e);t.forEach(function(e){var t=a.map[e];"object"===i.type?t.$isHidden=!n||(n.isNull||n.isUndefined):void 0!==t.bindVisibilityValue?t.$isHidden=t.bindVisibilityValue!=n:"string"!==i.type?t.$isHidden=!n:t.$isHidden=n!==a.map[e].$name}),a.registerListenerFor(e,a,"layout-value")}),a.registerListenerFor("$",a),a.loadPrefs(),t&&t.validators&&t.validators.forEach(function(e){a.$model.addValidator(e,!0)}),a.options.design||!a.options.externalSchema||!a.options.externalLayout||p.release||t.autoClose||(a.options.authoringIndicator=!0,a.options.verticalSpacing=!0),a._afterCreate(),s}return __extends(e,d),e.prototype._setParentForm=function(e){e&&(this._parentForm=e,this.moneyUnitCoef=e.moneyUnitCoef)},e.prototype.addChildForm=function(e,t){this._childrenForms=this._childrenForms||[],this._childrenForms.push({form:e,parentId:t}),e._setParentForm(this)},Object.defineProperty(e.prototype,"isInProcessing",{get:function(){return this.formManager.isInProcessing},enumerable:!0,configurable:!0}),e.prototype.removeChildForm=function(e){if(this._childrenForms)for(var t=this._childrenForms.length;t--;){if(this._childrenForms[t].form===e){this._childrenForms.splice(t,1);break}}},Object.defineProperty(e.prototype,"parentForm",{get:function(){return this._parentForm},enumerable:!0,configurable:!0}),e.prototype.closeInlineForms=function(e){var t=this.getLayoutByName(e);if(t&&this._childrenForms)for(var n=this._childrenForms.length;n--;){var i=this._childrenForms[n];i.parentId===t.$id&&(this._childrenForms.splice(n,1),i.form._parentForm=null,i.form.close())}},e.prototype.hasInlineForms=function(e){var t=this.getLayoutByName(e);if(t&&this._childrenForms)for(var n=this._childrenForms.length;n--;){var i=this._childrenForms[n];if(i.parentId===t.$id)return i.form}return null},e.prototype._isInDelayedAction=function(){return u.formManager().isInAction()},e.prototype._setInDelayedAction=function(e){u.formManager().setInAction(e)},e.prototype.initOptions=function(e){return(e=e||{}).form=!0,e},e.prototype.syncTransactionId=function(){return this._transactionId},e.prototype.syncViewId=function(){return this._viewId},e.prototype.syncViewName=function(){return this._viewName},e.prototype.execLater=function(e){this._afterProcessing?this._afterProcessing[e.id]=e.hnd:e.hnd()},Object.defineProperty(e.prototype,"inSync",{get:function(){return this.formManager.inSync},set:function(e){this.formManager.inSync=e},enumerable:!0,configurable:!0}),e.prototype.forceAfterProcessing=function(){this._afterProcessing=this._afterProcessing||{}},e.prototype._processing=function(e,t){var n=this;t&&(n._afterProcessing={});try{e()}finally{n._afterProcessing&&Object.keys(n._afterProcessing).forEach(function(e){n._afterProcessing[e]()}),n._afterProcessing=null}},e.prototype.fwField=function(e,t,n){if("moneyUnitCoef"===e){if("state"===t)return{};if("set"===t)this.moneyUnitCoef=n;else{if("value"===t)return this.moneyUnitCoef;if("schema"===t)return{type:"integer",enum:[1,1e3],enumNames:r.number.coef.map(function(e,t){return 0===t?o.locale.number.symbol:e+o.locale.number.symbol})}}}},Object.defineProperty(e.prototype,"moneyUnitCoef",{get:function(){return this._moneyUnitCoef},set:function(t){this._moneyUnitCoef!==t&&(this._moneyUnitCoef=t,this.notifyGlobalChanged("money-unit"),this._childrenForms&&this._childrenForms.forEach(function(e){e.form.moneyUnitCoef=t}))},enumerable:!0,configurable:!0}),e.prototype.notifyGlobalChanged=function(e){var t=this;Object.keys(t.controls).forEach(function(e){t.controls[e].notifyGlobalChanged("money-unit")})},e.prototype.syncDataSet=function(){var e=this.data.datasets?Object.keys(this.data.datasets):[];if(1!==e.length||"sync"!==this.data.datasets[e[0]].$type)return null;var t=this.data.datasets[e[0]];return this._modalForm&&(t.$params=t.$params||{},t.$params.$modal=!0),c.copy(t)},e.prototype._getFormLData=function(){return this.$model},e.prototype.navigate=function(e,t){h.execLink({$page:e,$replace:!t.canGoBack,$isDetail:t.canGoBack,$form:this,$checkForChanges:t.checkForChanges},{},t.urlSearch)},e.prototype.back=function(e){h.execLink({$back:!0,$form:this,$checkForChanges:this.useSync&&e},{},{})},e.prototype.disclaimer=function(e,t){if(this.$element&&!this.options.design){var n=e.message||c.glbDisclaimerMessage;if(n&&e.where){var i=this.getLayoutByName(e.where);if(i){var o=f.find(this.$element.get(0),i.$id);c.message(o,n,"info",t)}}}},e.prototype._activateTab=function(e){var t=this.$model.getValue(e.$bindPages,{}),n=this.$model.getState(e.$bindPages,{});if(e.showTabs=!0===n.isHidden,t){var i=null,o=null;e.$items.forEach(function(e){e.opened&&(i=e),e.$name===t&&(o=e)}),o?(o.opened=!0,delete o._opening,i&&i!==o&&(i.opened=!1,delete i._opening)):!i&&e.$items.length&&(e.$items[0].opened=!0,delete e.$items[0]._opening)}},e.prototype.setData=function(e){var t=this;e=e||{},t.$data=e,t.options.beforeSetModel&&t.options.beforeSetModel(t.$data,t),t.$model?t.$model.setModel(t.$data):t.$model=new o.Observable.Data(t.$schema,null,"",t.$data,null,!1,t.$locale,t.data.datasets,t.data.transform,t.options.design),t.$model.saveModel(),t.options.afterModelCreated&&t.options.afterModelCreated(t.$model,t)},e.prototype.processing=function(e){this.formManager.processing(e)},e.prototype.controlByField=function(e){return this._findControlByField(e)},e.prototype.controlByName=function(e,t){return this._findControlByName(e,t)},e.prototype._findControlByField=function(n){var i=this,o=[];return Object.keys(i.controls).forEach(function(e){var t=i.controls[e];t&&t.$bind===n&&o.push(t)}),o.length?o:null},e.prototype._findControlByName=function(n,e){var i=this,o=[];return Object.keys(i.controls).forEach(function(e){var t=i.controls[e];t&&t.name===n&&o.push(t)}),e&&!o.length&&i.namedMapFields[n]&&o.push(i.namedMapFields[n]),o.length?o:null},e.prototype.loadPrefs=function(){this._localSettings&&this._settingsName&&(this._settings=t(this._settingsName))},e.prototype.supportSettings=function(){return!!this._settingsName},e.prototype.getFieldSettings=function(e){return this._settings?this._settings[e]:null},e.prototype.setFieldSettings=function(e,t){this._settings=this._settings||{},this._settings[e]=t},e.prototype.savePrefs=function(e){this._settingsName&&(this._localSettings?(this._settings=this._settings||{},t(this._settingsName,this._settings),e()):o.external.preferenceSaveHandler(this._settingsName,this._settings).then(function(){e()}))},e.prototype.sendMessage=function(t,e,n){var i,o=this._findControlByField(e);return o&&o.length&&o.forEach(function(e){e.sendMessage&&(i=e.sendMessage(t,n))}),i},e.prototype.afterSettings=function(e,t,n){return this.options.settingsHandler?this.options.settingsHandler("after",e,t,n):n},e.prototype.beforeSettings=function(e,t){return this.options.settingsHandler?this.options.settingsHandler("before",e,t):null},e.prototype._createError=function(){var e=["bs-form-error"];return this.options.verticalSpacing?e.push("bs-form-vertical-space"):(this.options.closeButtonHandler||this.options.authoringIndicator)&&e.push("bs-form-settings-space"),$('<div class="'+e.join(" ")+'"><div id="'+this.data.$id+'_error"></div><div id="'+this.data.$id+'_warning"></div><div>').get(0)},e.prototype._createErrorItem=function(e,t){var n=e.details;n&&"string"==typeof n&&(n=(n=e.details.split("\n")).map(function(e){return{message:e.trim()}}));var i=n&&n.length,o="success"==e.severity?"success":"warning"==e.severity?"info":"danger",r=t?"":"bs-none ",s="I"+(e.id||"").replace(/-/g,""),a=[c.format('<div id="{0}_error" data-error="true" class="'+r+" alert alert-"+o+' alert-dismissible fade show">',e.id),'<button type="button" data-error-close="true" class="close" aria-label="Close">','<span data-error-close="true" aria-hidden="true">&times;</span>',"</button>"],l=e.message.split("\n");return i&&a.push('<div id="{0}_error_message" class="bs-error-message">'),l.forEach(function(e,t){0<t&&a.push("<br/>"),a.push(c.escapeHtml(e))}),i&&a.push("</div>"),i&&(a.push('<div id="{0}_error_detail" class="bs-none">'),n.forEach(function(e){e.message&&a.push('<p class="bs-error-detail-item">'+c.escapeHtml(e.message)+"</p>")}),a.push("</div>")),a.push("</div>"),$(c.format(a.join(""),s)).get(0)},e.prototype._getErrorContainer=function(){if(this.data.errorContainer){var e=this.getLayoutByName(this.data.errorContainer);if(e)return f.find(this.$element.get(0),e.$id)}return f.find(this.$element.get(0),this.data.$id+"_error")},e.prototype._getWarningsContainer=function(){if(this.data.errorContainer){var e=this.getLayoutByName(this.data.warningContainer);if(e)return f.find(this.$element.get(0),e.$id)}return f.find(this.$element.get(0),this.data.$id+"_warning")},e.prototype.clearErrors=function(){if(this.$element){var e=this._getErrorContainer();e&&f.empty(e)}},e.prototype.clearWarnings=function(){if(this.$element){var e=this._getWarningsContainer();e&&f.empty(e)}},e.prototype.showErrorItem=function(e,t){if(this.$element){var n="error"!==e.severity&&e.severity?this._getWarningsContainer():this._getErrorContainer();n&&f.append(n,this._createErrorItem(e,t))}},e.prototype.afterRenderChildren=function(e){var t=e.find("[data-phoenix-tooltip]");t.tooltip&&t.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},e.prototype._loadNestedControllers=function(){var o=this;o._nestedControllers=[],Object.keys(o.map).forEach(function(e){var t=o.map[e];if(t.$refController){var n={$refProperty:t.$refProperty,handler:null,beforeSetModel:null},i=s.get(t.$refController);if(!i)throw c.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',t.$refController);i.onModelChanged&&(n.handler=i.onModelChanged.bind(i)),i.beforeSetModel&&(n.beforeSetModel=i.beforeSetModel.bind(i)),o._nestedControllers.push(n)}})},e.prototype.hasNestedControllers=function(){return this._nestedControllers||this._loadNestedControllers(),0<this._nestedControllers.length},e.prototype.modelCreated=function(i){this._nestedControllers.forEach(function(e){if(e.beforeSetModel){var t=i,n=!1;e.$refProperty?(n=!0,t=c.getValue(i,e.$refProperty)):e.$refProperty||(n=!0),n&&t&&e.beforeSetModel(t)}})},e.prototype.modelChanged=function(o,r,s,a){this._nestedControllers.forEach(function(e){if(e.handler){var t=o,n=r,i=!1;e.$refProperty&&t.property&&0===t.property.indexOf(e.$refProperty+".")?(i=!0,(t=c.copy(o)).property=t.property.substring(e.$refProperty.length+1),n=r.getValue(e.$refProperty,o.params)):e.$refProperty||(i=!0),i&&e.handler(t,n,s,a)}})},e.prototype.afterRender=function(e){var r=this,t=e.get(0);r.autoClose&&(t.tabIndex=0);var n=t.firstChild?t.firstChild:t;r.options.form&&!r.options.design&&f.before(n,r._createError());var i=function(e,t,n,i){var o=["<div "+t+'="true" class="bs-cursor-p bs-form-settings'+(n?" "+n:"")+(i?"  space-"+i:"")+'" id="'+r.data.$id+'_settings">'];return o.push("<span "+t+'="true" class="'+f.iconClass(e)+'"></span>'),o.push("</div>"),o.join("")},o=0;if(r.options.closeButtonHandler){var s="times-circle-o",a="red";r.options.autoClose&&(s="remove",a="normal"),f.append(t,$(i(s,"data-form-detail-close",a,o)).get(0)),o++}r.options.authoringIndicator&&(f.append(t,$(i("cog","data-form-settings",null,o)).get(0)),o++),r._showErrors(!0)},e.prototype._afterLayoutAdded=function(e){var i=this;v.enumSubLayouts(e,function(e){if(e.$fields&&e.$title&&e.$title.value){var t=i.$element.get(0),n=f.find(t,e.$id+"_title");n&&o.layoutUtils.updateLayoutTitle(n,e,i.$model,i.$locale)}})},e.prototype.changed=function(s,e,a,t,l){var u=this;if("layout-titles"===l.targetId){if(u._bindTitles[l.propName]&&u.$element){var i=u.$element.get(0);u._bindTitles[l.propName].forEach(function(e){var t=f.find(i,e+"_title");if(t){var n=u.getLayoutById(e);n&&n.$title&&n.$title.value&&v.updateLayoutTitle(t,n,u.$model,u.$locale)}})}}else if("layout-accordion"===l.targetId)u._bindAccordion[l.propName]&&u._bindAccordion[l.propName].forEach(function(e){u.getLayoutById(e).$items.forEach(function(e){e.$name!==a||e.opened||u._activatePageLayout(e)})});else if("layout-value"===l.targetId){if(s!==l.propName)return;u._bindValues[l.propName]&&u._bindValues[l.propName].forEach(function(e){var t=u.getLayoutById(e),n=a,i=u.getSchema(l.propName);if(t){var o=!1;if("object"===i.type){var r=u.$model.getValue(s,{});o=!r||(r.isNull||r.isUndefined)}else o=void 0!==t.bindVisibilityValue?t.bindVisibilityValue!=n:(o=!n,"string"!==i.type?!n:n!==u.map[e].$name);u.updateIsHidden(t,o)}})}},e.prototype._showErrors=function(e){var n=this,t=n.$model.$errors.$,i=!!n.$model.model(!0).parentModel,o=t.errors(),r=[],s=[];if(n.clearErrors(),n.clearWarnings(),!i){for(var a=0,l=o.length;a<l;a++){var u=o[a];"error"!==u.severity&&u.severity?s.push(u):r.push(u)}r.forEach(function(e,t){n.showErrorItem(e,0==t)}),s.forEach(function(e,t){n.showErrorItem(e,0==t)})}},e.prototype.stateChanged=function(e,t){var i=this;if("layout-accordion"===t.targetId){if("isHidden"===e&&t.property){var o=i.$model.getState(t.property,{});(n=i._bindAccordion[t.property])&&n.forEach(function(e){var t=i.map[e],n=f.find(i.$element.get(0),t.$id+"_tab");n&&(o.isHidden?f.removeClass(n,"bs-none"):f.addClass(n,"bs-none"))})}}else if("layout-state"===t.targetId){if(("isHidden"===e||"isDisabled"===e)&&t.property){var n,r=i.$model.getState(t.property,{});(n=i._bindStates[t.property])&&n.forEach(function(e){var t=i.map[e];t&&(i.updateIsHidden(t,r.isHidden),i.updateIsDisabled(t,r.isDisabled))})}}else"$"===t.property&&"errors"===e&&i._showErrors(!1)},e.prototype.getSchema=function(e){return g.getSchema(e,this.$schema,this.$rootSchema,!1)},e.prototype.getLookupForSchema=function(e,t){return g.getLookup(e,t,this.$schema,this.$rootSchema)},e.prototype.registerListenerFor=function(e,t,n){var i=e;this._listenerChanged=!0,this._listeners=this._listeners||{},this._listeners[i]=this._listeners[i]||[],this._listeners[i].push({target:t,id:n||""})},e.prototype.unRegisterListenerFor=function(e,t){var n=e;if(this._listeners&&this._listeners[n]){var i=this._listeners[n].findIndex(function(e){return e.target===t});0<=i&&(this._listeners[n].splice(i,1),this._listenerChanged=!0)}},e.prototype.setValue=function(e,t){n.setValue(e,t,this.$model)},e.prototype.getValue=function(e){return n.getValue(e,this.$model)},e.prototype.getParentModel=function(e){var t=e.split(".");return t.pop(),n.getValue(t.join("."),this.$model)},e.prototype.getState=function(e){var t=n.getState(e,this.$model);return this.options.design&&(t.isHidden=!1,t.isDisabled=!1),t},e.prototype._enumListener=function(e,t){this._listeners[e].forEach(function(e){t(e)})},e.prototype._rebuildListeners=function(){this._listenerChanged&&(this._listenersByName=Object.keys(this._listeners),this._listenerChanged=!1)},e.prototype._match=function(e,t,n){var i=e.join("."),o=i+".";this._listenersByName&&this._listenersByName.forEach(function(e){if(e===i)t(e,!0,!1,!1);else if("*"===i||0===i.indexOf(e+".")){t(e,"*"===i,!0,!1)}else n.checkChildren&&0===e.indexOf(o)&&t(e,!1,!1,!0)})},e.prototype.openInlineForm=function(e){var t=this,n=t.getLayoutByName(e.where);n&&i.OpenInlineForm&&i.OpenInlineForm(n.$id,e.name,e.meta,e.controller,e.data,e.locale,function(e){t.addChildForm(e,n.$id)},null)},e.prototype.execAction=function(e,t,n){if(!this.options.design&&!this.$model.execSyncAction(e,t,n)){if(0===e.indexOf("$action.")){var i=e.split(".");i.shift();var o={},r=i.join(".");return o[r]=!0,"$back"===r?(o.$form=this,o.$checkForChanges=!1):"$checkForChangeAndBack"===r&&(o.$form=this,o.$checkForChanges=!0),h.execLink(o,t,null)}this._modelChanged(e,null,null,"execute",n,t)}},e.prototype.close=function(){if(this.$content){if(this.$content&&this.$content.tooltip)this.$content.find("[data-phoenix-tooltip]").tooltip("dispose");this.$content.empty(),f.remove(this.$content.get(0))}this.destroy()},e.prototype.broadcast=function(e,t){this.formManager.broadcast(e,t)},e.prototype.sendEmptyAction=function(){this.useSync&&(this.formManager.pushSyncAction(this.data.$id,{op:"$empty"}),this.formManager.sendSyncData())},e.prototype.patch=function(e){var t=this;t.inSync=!0,t.processing(!0);try{t._processing(function(){t.$model.applyJsonPachDelta(e)},10<e.length)}finally{t.processing(!1),t.inSync=!1}},e.prototype.applyJsonPachDelta=function(e){var t=this;e&&e.length&&t._processing(function(){t.$model.applyJsonPachDelta(e)},10<e.length)},e.prototype._sendData=function(){this.formManager.sendSyncData()},e.prototype._synModel=function(e){if(!this.inSync)if(this.formManager.clearSyncTimeOut(),e){e.delayed;delete e.delayed,this.formManager.pushSyncAction(this.data.$id,e),this._sendData()}else this.formManager.pushSyncAction(this.data.$id,{op:"$delta"}),this._sendData()},e.prototype._modelChanged=function(r,s,a,l,u,e){var d=this,t=r.split(".");d._rebuildListeners(),(u=u||{}).oldValue=s,u.newValue=a,"execute"!==l&&"beforeChange"!==l&&d._match(t,function(t,e,n,i){if("propchange"===l||e)if(u.propName=t,e){var o=d.$model.getValue(t,u);d._enumListener(t,function(e){e.target.changed&&(u.targetId=e.id,e.target.changed(t,s,o,l,u))})}else n?d._enumListener(t,function(e){e.target.changed&&(u.targetId=e.id,e.target.changed(r,s,a,l,u))}):i&&d._enumListener(t,function(e){e.target.changed&&(u.targetId=e.id,e.target.changed(t,s,d.getValue(t),l,u))})},u),d.afterchanged(r,l,u,e)},e.prototype.afterchanged=function(e,t,n,i){if(this.onaction){if(this.inAction)return;this.inAction=!0;try{this.onaction({property:e,operation:t,params:n,actionParams:i},this.$model,this)}finally{this.inAction=!1}}},e.prototype.on=function(e){this.onaction=e,this.onaction&&this.onaction({operation:"init"},this.$model,this)},e.prototype._stateChanged=function(o,r){var s,a,l=this,e=o.split("."),u=!1;0<=g.statesAndErrors.indexOf(e[e.length-1])&&(s=e.pop(),a=e.join("."),u=!0),l._rebuildListeners(),l._match(e,function(e,t,n,i){t?l._enumListener(e,function(e){e.target.stateChanged&&e.target.stateChanged(s,{targetId:e.id,property:a,origProperty:o,isState:u},r)}):n?l._enumListener(e,function(e){e.target.stateChanged&&e.target.stateChanged(null,{targetId:e.id,property:a,origProperty:o,isState:u},r)}):i&&l._enumListener(e,function(e){e.target.stateChanged&&(r.targetId=e.id,e.target.stateChanged(null,{targetId:e.id,property:a,origProperty:o,isState:u},r))})},r)},e.prototype.destroy=function(){var e=this;(e.$data=null,e.$schema=null,e._bindStates=null,e._bindValues=null,e._bindTitles=null,e._bindAccordion=null,e.module=null,e.onaction=null,e._listeners={},e._listenersByName=[],e._loadNestedControllers=null,e._parentForm&&e._parentForm.removeChildForm(e),e._childrenForms)&&(e._childrenForms.slice().forEach(function(e){return e.form.destroy()}),e._childrenForms=null);if(e.$model&&(e.$model.onchange=null,e.$model.onstatechanged=null,e.$model.destroy(),e.$model=null),e.formManager&&(e.formManager.remove(e),e.formManager=null),e.$element){if(e.$element&&e.$element.tooltip)e.$element.find("[data-phoenix-tooltip]").tooltip("dispose");e.$content.empty(),f.remove(e.$content.get(0))}d.prototype.destroy.call(this)},e.prototype._idComponent=function(e){if(!this.$element)return null;for(var t,n=e,i=this.$element.get(0);n;){if(!n.getAttribute)return null;if(t=n.getAttribute("data-render")){if(this.controls[t])break;t=null}n=n===i?null:n.parentNode}return t||null},e.prototype._event2FieldByElement=function(e){var t=this._idComponent(e);return t?this.controls[t]:null},e.prototype.postMessageToParent=function(e,t){if(this._parentForm){var n=this._parentForm;c.nextTick(function(){n.execAction(e,t)})}},e.prototype._event2Field=function(e){return this._event2FieldByElement(e.target)},e.prototype._removeBaseEvents=function(){var e=this.$element;e.off("focusin"),e.off("focusout"),e.off("click"),e.off("dblclick"),e.off("keydown"),e.off("keyup"),e.off("keypress"),e.off("mousedown"),e.off("paste"),$(window).off("global-phoenix-resize",this._resizeHnd),d.prototype._removeBaseEvents.call(this)},e.prototype.freeze=function(e){return e.preventDefault(),e.stopPropagation(),!1},e.prototype._doKeyDown=function(e){return!0},e.prototype._doKeyPress=function(e){if(this.autoClose){if(e.keyCode===f.keys.VK_ESCAPE||e.keyCode===f.keys.VK_F4)return this.autoClose.explicitClose=!0,o.pagecontrol.Page().setPopup(null),!1;e.keyCode===f.keys.VK_ENTER&&this.execAction("form-validate")}return!0},e.prototype.delayClick=function(e,t){var n=u.formManager();return!!(e&&e.syncClick&&n.hasActions())&&(setTimeout(function(){return t.target.click()},100),!0)},e.prototype.focusedControl=function(){var t=this,n=null;return Object.keys(t.controls).forEach(function(e){t.controls[e].focused&&(n=t.controls[e])}),n},e.prototype._addBaseEvents=function(){var u=this;u.$element.on("focusin",function(e){if(u.isInProcessing)return u.freeze(e);var t=u._event2Field(e);if(t&&t.focusIn){if(t.focused)return;t.focused=!0,t.focusIn(e)}}),u.$element.on("focusout",function(e){if(u.isInProcessing)return u.freeze(e);var n=u._event2Field(e);if(n&&n.focusOut){var i={target:e.target};n.focusTimer&&(window.clearTimeout(n.focusTimer),n.focusTimer=0),u._setInDelayedAction(!0),n.focusTimer=c.focusDelay(function(){if(u._setInDelayedAction(!1),!n.destroyed){n.focusTimer=0;var e=window.document.activeElement;if(e){var t=u._event2FieldByElement(e);t!==n?n.focusInControl(e)&&(t=n):t===n&&(n.focusInControl(e)||(t=null)),t!==n&&(n.focusOut(i),n.focused=!1)}else n.focusOut(i),n.focused=!1}})}}),u.$element.on("dblclick",function(e){if(u.isInProcessing)return u.freeze(e);var t=u._event2Field(e);t&&t.dblclick&&t.dblclick(e)}),u.$element.on("click",function(e){var t=e.target;if(f.hasClass(t,"bs-error-message")){var n=t.id.replace("_error_message","_error_detail"),i=f.find(u.$element.get(0),n);i&&(f.hasClass(i,"bs-none")?f.removeClass(i,"bs-none"):f.addClass(i,"bs-none"))}else{var o=u._event2Field(e);if(!u.delayClick(o,e)){if(u.isInProcessing)return u.freeze(e);if(o&&t.id===o.id+"_rules")return o.showRules(),void e.preventDefault();if(o&&o.click){if(o.stopProppagation&&o.stopProppagation(e),o.focusClick)return;if(!u._isInDelayedAction()||o.focused&&o.targetInControl(e.target)){if(u.delayClick(o,e))return;return o.click(e)}u._setInDelayedAction(!0),o.focusClick=c.focusDelay(function(){u._setInDelayedAction(!1),o.destroyed||(o.focusClick=0,u.delayClick(o,e)||o.click(e))})}else if(!o){var r=e.target;if(r){if(r.getAttribute("data-error-close")){var s=f.findByAttribute(r,u.$element.get(0),"data-error");if(s)if(s.id){var a=s.id.substr(0,s.id.length-6);u.$model.$errors.$.rmvErrorById(a)}else f.remove(s),u.openErrors();return u.freeze(e)}if(r.getAttribute("data-form-detail-close"))return u.options.closeButtonHandler&&u.options.closeButtonHandler(),u.freeze(e);if(r.getAttribute("data-form-settings"))return u.options.authoringIndicator&&h.execLink({$formAuthoring:!0,path:u.options.path,name:u.options.externalLayout,schema:u.options.externalSchema,locale:u.options.externalLocale},{},null),u.freeze(e)}}var l=u._event2Layout(e);l&&l.$actionName&&u.execAction(l.$actionName)}}}),u.$element.on("keypress",function(e){if(u.isInProcessing)return u.freeze(e);if(u._doKeyDown(e)){var t=u._event2Field(e);t&&t.keypress&&t.keypress(e)}}),u.$element.on("keydown",function(e){if(u.isInProcessing)return u.freeze(e);if(u._doKeyPress(e)){var t=u._event2Field(e);t&&t.keydown&&t.keydown(e)}}),u.$element.on("keyup",function(e){if(u.isInProcessing)return u.freeze(e);if(u._doKeyDown(e)){var t=u._event2Field(e);t&&t.keyup&&t.keyup(e)}}),u.$element.on("paste",function(e){if(u.isInProcessing)return u.freeze(e);var t=u._event2Field(e);t&&t.paste&&t.paste(e)}),u.$element.on("keyup",function(e){if(u.isInProcessing)return u.freeze(e);var t=u._event2Field(e);t&&t.keyup&&t.keyup(e)}),u.$element.on("mousedown",function(e){if(u.isInProcessing)return u.freeze(e);var t=u._event2Field(e);return!t||!t.mousedown||t.mousedown(e)}),$(window).on("global-phoenix-resize",u._resizeHnd),d.prototype._addBaseEvents.call(this)},e.prototype.visibleChildForms=function(){if(!this.useSync)return[];var e=this.getVisibleControlsByWiget("form"),t=[];return e&&e.forEach(function(e){e&&e.inlineForm&&e.inlineForm.useSync&&t.push(e.inlineForm)}),t},e.prototype._resizeControls=function(t){this.currentResizeList&&this.currentResizeList.forEach(function(e){e.resize(t)})},e.prototype._resizeAndAfterRender=function(e){this.afterRenderList&&(this.afterRenderList.forEach(function(e){e.afterAddedInDom()}),this.afterRenderList=[]),this._resizeControls(e)},e.prototype.afterAddedInDom=function(){d.prototype.afterAddedInDom.call(this);var e=this;e._resizeAndAfterRender(!1),e._autofocus&&e._autofocus.setFocus&&window.setTimeout(function(){e._autofocus&&(e._autofocus.setFocus(),e._autofocus=null)},200)},e.prototype._afterVisibilityChanged=function(e){d.prototype._afterVisibilityChanged.call(this,e);e.inDom&&e.resize&&this._resizeAndAfterRender(!0)},e}(i.BaseLayout),i.Form=a,i.FormClass=a,i.removeForm=function(e){if(e){var t=null;e.$element&&(t=e.$element.get(0)),e.destroy(),t&&f.remove(t)}},i.OpenForm=null,i.OpenInlineForm=null}(Phoenix||(Phoenix={})),function(d){d.render,d.ui;var w=d.dom,O=d.utils,e=(d.device,d.Observable),S=d.ulocale,E=d.locale,v=d.customData,P=e.SchemaUtils;!function(e){var o="datepicker",r="datetimepicker",l={},c=function(e){return"center"===e?"align-center":"right"===e?"align-end":""},C=function(e,t,n,i){var o=v.get("ui.html."+n);return o?{value:o(e,t,i),html:!0}:{value:t,html:!1}},k=function(e,t,n){var i=e.avanced.icons[t]||"none",o=e.avanced.iconClass||null,r=c(e.avanced.alignIcon||"center"),s=[];i&&s.push(o?w.customIconClass(i,o):w.iconClass(i));var a=e.tableOptions&&e.tableOptions.small?"small-table":"",l=["bs-image-cell",r];e.avanced._expandItem&&(l.push("bs-expand-parent"),s.push("bs-expand-child")),a&&l.push(a);var u=['<div class="'+l.join(" ")+'"'];if(e.avanced._clickable&&u.push(' data-clickable="true"'),e.avanced._expandItem&&(e.level&&u.push(' style="margin-left:'+.5*e.level+'em;"'),s.push("bs-expand-space"),e.avanced._expandItemClass&&s.push(e.avanced._expandItemClass)),e.display||s.push("bs-image-size"),u.push('><span class="'+s.join(" ")+'"></span>'),e.avanced._expandItem&&e.display&&e.display.value){var d=e.html&&e.avanced&&e.avanced.$link;d&&u.push('<a href="#" class="bs-cursor-p" data-phoenix-href="link://$link">'),u.push('<span class="bs-expand-child">'),u.push(" "),u.push(e.display.value),u.push("</span>"),d&&u.push("</a>")}return u.push("</div>"),{value:u.join(""),html:!0}},u={useDatePicker:function(){return null!=$.fn[o]},useDateTimePicker:function(){return null!=$.fn[r]},addErrorDiv:function(e,t,n){var i=n?"span":"div";e.push("<"+i+' class="invalid-feedback bs-none'+(t?" no-y-margin":"")+'" id="{0}_errors"></'+i+">")},keyPressPassword:function(e,t,n){return e.which!==w.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressDate:function(e,t,n){return!0},keyPressCode:function(e,t,n){return e.keyCode!==w.keys.VK_SPACE||(e.preventDefault(),!1)},keyPressNumber:function(e,t,n){var i="-0123456789,."+n.decimalSep,o=e.keyCode;if(!e.metaKey&&w.ignoreKeys.indexOf(o)<0){var r=String.fromCharCode(o);if(i.indexOf(r)<0)return e.preventDefault(),!1}return!0},doPasteDate:function(e,t,n){return!0},doPasteCode:function(e,t,n){return!0},doPasteNumber:function(e,t,n){return!0},doPastePassword:function(e,t,n){return!0},keyDownDate:function(e,t,n){return!0},keyDownCode:function(e,t,n){return!0},keyDownNumber:function(e,t,n){return!0},keyDownPassword:function(e,t,n){return!0},registerMask:function(e,t){l[e]=t},maskKeys:function(e,t,n,i){if(!e)return t.which;if("numeric"===e)return t.which<48||57<t.which?(t.preventDefault(),t.stopPropagation(),0):t.which;var o=l[e];if(o&&o.maskKeys&&0===o.maskKeys(t,n,i))return t.preventDefault(),t.stopPropagation(),0;return t.which},maskCheckValue:function(e,t){if(!e)return t;if("uppercase"===e)return((t||"")+"").toUpperCase();if("numeric"===e){for(var n=[],i=(t||"")+"",o=0;o<i.length;o++){var r=i.charCodeAt(o),s=i.charAt(o);48<=r&&r<=57&&n.push(s)}return n.join("")}if("phone"===e){for(n=[],i=(t||"")+"",o=0;o<i.length;o++){s=i.charAt(o);0<="+-() 0123456789.".indexOf(s)&&n.push(s)}return n.join("")}var a=l[e];return a&&a.format?a.format(t):t},addContainerId:function(e,t){t&&e.push(' draggable="true"'),e.push(' data-render="{0}"'),e.push(' id="{0}"')},containerBaseClass:function(e,t,n){var i=[e,n.groupFieldClass||"bs-field-group","bs-island"];return n.noVerticalMargins&&!t&&i.pop(),n.inline&&i.push(n.inlineFieldClass||"bs-field-inline"),n.simulateColumns&&i.push("bs-field-group-columns"),t&&i.push(" design"),i.join(" ")},align2Css:c,fieldWrapper:function(e,t,n,i,o){var r=d.bootstrap4;t.inline&&(t.columns=!1);var s=o&&o.formGroup?o.formGroup:"form-group",a=[u.containerBaseClass(s,n,t)],l=o&&o.tag?o.tag:"div";e.push("<"+l+' class="'),t.size&&a.push((r?"form-control":"form-group-")+t.size),t.columns&&a.push("row"),t.styles&&a.push(t.styles),t.right&&a.push(" float-right"),e.push(a.join(" ")),e.push('"'),u.addContainerId(e,n),e.push(">"),i(),e.push("</"+l+">")},fillSelect:function(e,t,n,i){if(t){var o=n.enumNames||n.enum,r=n.enum;w.empty(t);var s=document.createDocumentFragment();if(n.nullable||i){var a=document.createElement("option");w.attr(a,"value",""),n.nullable||w.attr(a,"disabled","true"),a.textContent=String.fromCharCode(160),w.append(s,a)}e.forEach(function(e){var t=r.indexOf(e),n=o[t]||e+"",i=document.createElement("option");w.attr(i,"value",e),i.textContent=n,w.append(s,i)}),w.append(t,s)}},datePickerSetValue:function(e,t){e[o]("update",S.parseISODate(t||"")||"")},elementInDatePicker:function(e,t){var n=t.data(o);return!!(n&&n.picker&&n.picker.length)&&w.isChildOf(n.picker.get(0),e)},datePickerInitialize:function(e,t,n){w.addClass(e.get(0),"date");var i=$.extend({zIndexOffset:1e3,todayHighlight:!0,language:S.currentLang,autoclose:!0},t||{});e[o](i),n&&e[o]().on("hide",n)},datePickerDestroy:function(e){e.data(o)&&(w.removeClass(e.get(0),"date"),e[o]("destroy"))},datePickerClose:function(e){e.data(o)&&e[o]("hide")},dateTimePickerSetValue:function(e,t){e[r]("date",S.parseISODate(t||"")||"")},dateTimePickerInitialize:function(e,t,n){w.addClass(e.get(0),"date");var i={icons:{time:w.iconClass("clock-o"),date:w.iconClass("calendar"),up:w.iconClass("arrow-up"),down:w.iconClass("arrow-down"),previous:w.iconClass("arrow-left"),next:w.iconClass("arrow-right"),today:w.iconClass("exclamation-circle"),clear:w.iconClass("trash"),close:w.iconClass("times")},locale:S.currentLang,showClose:!0},o=$.extend(i,t||{});e[r](o),n&&e[r]().on("hide",n)},dateTimePickerDestroy:function(e){e.data[r]&&(w.removeClass(e.get(0),"date"),e[r]("destroy"))},text2value:function(e,t,n){if(P.isDate(t)){var i=S.tryParseDate(e);return S.localeDate2ISO(i)}if(P.isDateTime(t)){i=S.tryParseDateTime(e);return S.localeDateTime2ISO(i)}return P.isNumber(t)?P.text2Value(e+"",t,n):e},defaultOptions:{titleIsHidden:!1,placeHolder:!1,labelCol:3},display:function(e,t,n){return u.displayValue(e,t,{},{html:!1,useSymbol:!0,selectable:!1,editable:!1,isTotal:!1,check:!1,form:n},null,"").value},displayValue:function(e,t,n,i,o,r){var s;if((i=i||{}).avanced=i.avanced||{},O.isNullOrUndefined(e))if(i.avanced&&i.avanced.showEmpty);else if(!i.avanced||!i.avanced.transform||i.isTotal||"string"!==t.type)return s={value:"",html:!1};if(i.isTotal&&(P.isFwField(r)||t.enum))return s={value:"",html:!1};var a=i.html&&i.avanced&&(i.avanced.$link||i.avanced.actionName);if(i.avanced._expandItem&&i.display&&i.display.value&&(a=!1),t.enum){var l=t.enum.indexOf(e),u=0<=l?t.enumNames?S.tt(t.enumNames[l],n):e:"";s=i.avanced&&i.avanced.transform?C(e,u,i.avanced.transform,o):i.avanced&&i.avanced.icons?k(i,e):{value:u,html:!1}}else switch(t.type){case"string":if(t.format)switch(t.format){case"date":u=S.shortDate(e||"");s=i.avanced&&i.avanced.transform?C(e,u,i.avanced.transform,o):{value:u,html:!1};break;case"date-time":var d=S.shortDateTime(e||"");s=i.avanced&&i.avanced.transform?C(e,d,i.avanced.transform,o):{value:d,html:!1}}s||(s=i.avanced&&i.avanced.transform?(a=!1,C(e,e,i.avanced.transform,o)):i.avanced&&i.avanced.icons?k(i,e):e&&i.avanced&&i.avanced.multiline?{value:"<span>"+e.split("\n").map(function(e){return O.escapeHtml(e)}).join("<br/>")+"</span>",html:!0}:{value:e,html:!1});break;case"number":var c=void 0;"rate"===t.format&&(void 0===t.decimals&&(t.decimals=P.RATE_DECIMALS),void 0===t.symbol&&(t.symbol=P.RATE_SYMBOL));var p="money"===t.format;if(i.state){var h=i.state.decimals||0;e=e||0;var f=i.useSymbol&&i.state.symbol||"";p&&(i.form&&(i.state.moneyUnitCoef=i.form.moneyUnitCoef),1e3===i.state.moneyUnitCoef&&(h=0,i.useSymbol&&(f="K"+f)),i.state.moneyUnitCoef&&(t.nullable&&null==e?e=e:e/=i.state.moneyUnitCoef)),c=t.nullable&&null==e?"":S.decimal(e,h,f)}else c=p?S.money(e||0,i.useSymbol):S.decimal(e||0,t.decimals||0,i.useSymbol?t.symbol:"");s=i.avanced&&i.avanced.transform?C(e,c,i.avanced.transform,o):i.avanced&&i.avanced.icons?k(i,e):{value:c,html:!1};break;case"integer":var m=S.integer(e);s=i.avanced&&i.avanced.transform?C(e,m,i.avanced.transform,o):i.avanced&&i.avanced.icons?k(i,e):{value:m,html:!1};break;case"boolean":if(i.isTotal)return s={value:"",html:!1};if(i.avanced&&i.avanced.transform)s=C(e,e?E.ui.Yes:E.ui.No,i.avanced.transform,o);else if(i.html){var v=[];if(i.avanced&&"toggle"===i.avanced.widget){v.push("<span>");var g=O.allocID();v.push('<input class="tgl tgl-light disabled" id="'+g+'" type="checkbox" disabled="true"'+(e?" checked":"")+">"),v.push('<label class="tgl-btn " for="'+g+'"></label>'),v.push("</span>"),s={value:v.join(""),html:!0}}else if(i.avanced&&i.avanced.editable||i.editable||i.check||i.avanced&&i.avanced.icons){var y=i.tableOptions&&i.tableOptions.small?" small-table":"",_=i.avanced?i.avanced.icons:null;_||(_={true:"check-square-o",false:"square-o"});var $=_[!!e+""],b=["bs-bool-edit","bs-image-size"];$&&b.push(w.iconClass($)),v.push('<center class="bs-image-cell'+y+'"><span data-clickable="true" class="'+b.join(" ")+'"></span>&nbsp;</center>'),s={value:v.join(""),html:!0}}else s={value:e?E.ui.Yes:E.ui.No,html:!1}}else s={value:e?E.ui.Yes:E.ui.No,html:!1}}if(s||(s={value:e,html:!1}),a){var x=['<a href="#" class="bs-cursor-p" data-phoenix-href="link://$link">'];x.push(s.value),x.push("</a>"),s.value=x.join(""),s.html=!0}return s},addTooltipAndRule:function(e,t){t.description&&(e.push('<span id="{0}_tooltip" data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title="'+t.description+'" class="'+w.iconClass("question-circle")+" bs-tooltip-icon"),t.grid?e.push(" grid"):e.push(" edit"),e.push('"></span>')),t.rules&&(e.push('<span id="{0}_rules"  class="'+w.iconClass("bolt")+" bs-rules"),t.grid?e.push(" grid"):e.push(" edit"),e.push('"></span>'))},extractFields:function(e){var t=$(e).get(0);return u.extractFieldsFromDom(t)},extractFieldsFromDom:function(e){var t=[],n=w.queryAll(e,"[data-bind]");if(n)for(var i=0;i<n.length;i++)t.push(w.attr(n.item(i),"data-bind"));return t},extractFieldsTitlesFromDom:function(e){var t=[],n=w.queryAll(e,"[data-bind-title]");if(n)for(var i=0;i<n.length;i++)t.push(w.attr(n.item(i),"data-bind-title"));return t},renderButton:function(e,t,n,i,o,r){var s,a;if(t.transform){var l=v.get("ui.html."+t.transform);if(l){var u=l(n,t,r);return!!u&&(w.append(o,u),!0)}return!1}if(t.button){var d="";(s=document.createElement("button")).type="button",n.isDisabled&&(s.disabled=!0);var c=t.size||"sm",p="normal"===c?"":" btn-"+c,h=t.type||"link";if(h=w.bootstrapStyles(t.outline)[h],s.className="bs-button btn btn-"+h+p+(n.isDisabled?" disabled":""),t.icon&&((a=document.createElement("span")).className=w.iconClass(t.icon),w.append(s,a),d=" "),i.title)if(t.titleIsHidden)s.title=i.title;else{var f=document.createTextNode(d+i.title);w.append(s,f)}}else{if(!t.icon)return!1;s=document.createElement("center"),n.isDisabled&&w.addClass(s,"bs-disabled"),a=document.createElement("span");var m=["text-"+(t.type||"default")];m.push("bs-basictable-btn"),m.push(w.iconClass(t.icon)),a.className=m.join(" "),w.append(s,a)}return s&&(s.$link=e,w.append(o,s)),!0},updateTitle:function(e,t,n){var i=w.queryAll(e,'[data-bind-title="'+t+'"]');if(i)for(var o=0;o<i.length;o++){var r=i.item(o);r.firstChild&&1===r.firstChild.nodeType&&(r=r.firstChild),w.empty(r),w.append(r,document.createTextNode(n||""))}},updateValue:function(e,t,n){var i=w.queryAll(e,'[data-bind="'+t+'"]');if(i)for(var o=0;o<i.length;o++){var r=i.item(o);if(w.empty(r),n.html){var s=$(n.value);w.append(r,s.get(0))}else w.append(r,document.createTextNode(n.value||""))}}};if(u.useDatePicker()){var t=function(e){var t=$.fn[o];t.DPGlobal.template=t.DPGlobal.template.replace(/\"table-condensed\"/g,'"table-sm"').replace(/class=\"datepicker\"/g,'tabIndex="0" class="datepicker bs-focus-outline-none"'),t.dates[e]={days:E.date.weekdays,daysShort:E.date.weekdaysShort,daysMin:E.date.weekdaysMin,months:E.date.months,monthsShort:E.date.monthsShort,today:E.date.today,clear:E.date.clear,format:E.date.dateShort.replace(/\//g,E.date.daySep),titleFormat:"MM yyyy",weekStart:E.date.weekStart}};w.readyHandlers.push(function(){t(S.currentLang)}),S.register(t)}if(u.useDateTimePicker()){var n=function(e){var t=window.moment;t&&t.updateLocale(e,{months:E.date.months,monthsShort:E.date.monthsShort,weekdays:E.date.weekdays,weekdaysShort:E.date.weekdaysShort,weekdaysMin:E.date.weekdaysMin,longDateFormat:{LT:d.locale.date.shortTime.replace(/M/g,"m").replace(/S/g,"s"),L:E.date.dateShort.replace(/\//g,E.date.daySep).toUpperCase()},week:{dow:E.date.weekStart}})};w.readyHandlers.push(function(){n(S.currentLang)}),S.register(n)}e.utils=u}(d.uiutils||(d.uiutils={}))}(Phoenix||(Phoenix={})),function(e){var t,n,s=e.utils,i=e.Observable,r=e.dom,a=e.external,l=e.customData,u=i.SchemaUtils;t=e.ui||(e.ui={}),n=function(){function e(e,t,n){var i=this;i._isBinded=!0,i.config=$.extend(!0,{},e),e=i.config,i.form=n,i.options=t||{},e.options=$.extend(!0,{},e.options||{}),i.parent=i.form.getLayoutById(e.$parentId),i.$bind=e.$bind,"$none"===i.$bind&&(i._isBinded=!1,e.options.fwField?(i._internalValue=i.form.fwField(e.options.fwField,"value"),i._internalState=i.form.fwField(e.options.fwField,"state")):(i._internalValue=e.options.value,i._internalState=e.options.state||{})),e.$name&&(i.name=e.$name),i.$display=i.config.$display||i.$bind,e.$lookup&&(i.useDisplay=i.$display!==i.$bind,i.$lookup=i.form.getLookupForSchema(i.$bind,e.$lookup)),u.isMeta(i.$bind)&&(i.$bind=i.getCustomBind()),i._isBinded&&i.$bind&&n.registerListenerFor(i.$bind,i),i._isBinded&&i.useDisplay&&n.registerListenerFor(i.$display,i),i._defineProps(),i.fieldOptions=e.options||{},i.renderOptions=i.fieldOptions,i.$schema=i._isBinded&&i.$bind?n.getSchema(i.$bind):null,!i._isBinded&&e.options.fwField&&(i.$schema=i.form.fwField(e.options.fwField,"schema")),i.$schema||(i.$schema=i._customSchema()),i.$schema&&"array"===i.$schema.type&&(i.$schemaItems=u.expand$Ref(i.$schema.items,i.form.$rootSchema)),i.id=e.$id,i.title=i.fieldOptions.title?i.fieldOptions.title:i.$schema?i.$schema.title:i.$bind}return e.prototype.notifyGlobalChanged=function(e){},e.prototype._customSchema=function(){return{}},e.prototype.hide=function(e){this._isBinded&&(this._internalState.isHidden=!0,this.stateChanged&&this.stateChanged("isHidden",{}))},e.prototype.setInternalValue=function(e,t){var n=this;if(n._isBinded)t?n.form.setValue(n.$bind,e):n.state.value=e;else if(n._internalValue!==e){var i=n._internalValue;t||(n._internalValue=e),n.changed&&n.changed(n.$bind,i,e,"propchange"),n.fieldOptions.onChange&&n.fieldOptions.onChange(),n.fieldOptions.fwField&&n.form.fwField(n.fieldOptions.fwField,"set",e)}},e.prototype.getInternalValue=function(){return this._isBinded?this.state.value:this._internalValue},e.prototype.getSettingsName=function(e){var t=[this.$bind,e];return this.name&&t.push(this.name),t.join("_")},e.prototype.targetInControl=function(e){if(this.$element){var t=this.$element.get(0);return r.isChildOf(t,e)}return!1},e.prototype.focusInControl=function(e){if(this.$element){var t=this.$element.get(0);return r.isChildOf(t,e)}return!1},e.prototype.setParentId=function(e){},e.prototype.isMeta=function(){return!1},e.prototype.beforeSaveSettings=function(){return!1},e.prototype.savePreferences=function(e){if(this._isBinded)return this.form.supportSettings()?void(this.beforeSaveSettings()&&this.form.savePrefs(e)):e()},e.prototype.getCustomBind=function(){return""},e.prototype.getBind=function(){var e=[];return this.$bind&&e.push(this.$bind),e},e.prototype.fieldState=function(){return this.state},e.prototype.setHidden=function(e){e&&(this.fieldState().isHidden?r.addClass(e,"bs-none"):r.removeClass(e,"bs-none"))},e.prototype._state=function(){var t,n=this;n.state=n.state||{},n._isBinded?(t=n.form.getState(n.$bind),n.state.value=n.form.getValue(n.$bind)):(t=n._internalState,n.state.value=n._internalValue),Object.keys(t).forEach(function(e){n.state[e]=t[e]})},e.prototype._defineProps=function(){},e.prototype.render=function(e){},e.prototype.appendElement=function(e,t){e&&(this.options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.setEvents=function(e){},e.prototype.removeEvents=function(){},e.prototype.customOptions=function(i){if(this._isBinded&&s.showRules()){var o=this.form.$rootSchema,r=this.form.$schema;this.getBind().forEach(function(e){var t=u.getSchema(u.parentPath(e),r,o,!0),n=u.lastSegment(e,null);t&&t.name&&(r.rules&&r.rules.validation&&r.rules.validation[t.name]&&r.rules.validation[t.name][n]?i.rules=!0:r.rules&&r.rules.propagation&&r.rules.propagation[t.name]&&r.rules.propagation[t.name][n]&&(i.rules=!0))})}},e.prototype.showRules=function(){if(this._isBinded){var i=this.form.$rootSchema,o=[],r=this.form.$schema;this.getBind().forEach(function(e){var t=u.getSchema(u.parentPath(e),r,i,!0),n=u.lastSegment(e,null);t&&t.name&&(r.rules&&r.rules.validation&&r.rules.validation[t.name]&&r.rules.validation[t.name][n]&&o.push(r.rulesMap[r.rules.validation[t.name][n]]),r.rules&&r.rules.propagation&&r.rules.propagation[t.name]&&r.rules.propagation[t.name][n]&&o.push(r.rulesMap[r.rules.propagation[t.name][n]]))}),a.ruleViewer&&a.ruleViewer(o)}},e.prototype._initOptions=function(e){var t=this,n={};t.parent&&t.parent.$fieldsOptions&&(t.parent.$fieldsOptions.columns&&(void 0===n.columns&&(n.columns=t.parent.$fieldsOptions.columns),void 0===n.labelCol&&t.parent.$fieldsOptions.labelCol&&(n.labelCol=t.parent.$fieldsOptions.labelCol)),t.parent.$fieldsOptions.titleIsHidden&&void 0===n.titleIsHidden&&(n.titleIsHidden=!0));var i=$.extend({},e,n,t.fieldOptions);return t.parent&&t.parent.$inline&&(i.inline=!0),t.customOptions(i),t.renderOptions=i},e.prototype.destroy=function(){var e=this;e.focusTimer&&(window.clearTimeout(e.focusTimer),e.focusTimer=0),e.$element&&(e.removeEvents(),e.$element=null),e.destroyed=!0,e.$schema=null,e.parent=null,e._isBinded&&(e.$bind&&e.form.unRegisterListenerFor(e.$bind,e),e.useDisplay&&e.form.unRegisterListenerFor(e.$display,e))},e.prototype.showErrors=function(e,t){var n=t&&t.length,i=r.find(e,this.id+"_errors");if(i)if(n){var o=t[0].message;this.renderOptions.inline&&(o=String.fromCharCode(160)+"("+o+")"),r.text(i,o),r.removeClass(i,"bs-none")}else r.addClass(i,"bs-none")},e}(),t.AbsField=n,t.registerControl=function(e,t,n,i,o){i=i||"",(n=n||!1)&&(t="*");var r=(o=o||{}).lookup||!1,s=o.format||"";o.readOnly?l.register("ui-controls-readonly-"+i+"-"+s,e):l.register("ui-controls-"+t+"-"+n+"-"+r+"-"+i+"-"+s,e),i&&l.register("ui-controls-by-widget-"+i,e)},t.getRegisteredControl=function(e,t,n,i,o){(t=t||!1)&&(e="*"),n=n||"",i=i||"";var r,s=!(!o||!o.lookup);return o&&o.readOnly?!(r=l.get("ui-controls-readonly-"+n+"-"+i))&&i&&(r=l.get("ui-controls-readonly-"+n+"-")):(!(r=l.get("ui-controls-"+e+"-"+t+"-"+s+"-"+n+"-"+i))&&i&&(r=l.get("ui-controls-"+e+"-"+t+"-"+s+"-"+n+"-")),!r&&n&&(r=l.get("ui-controls-by-widget-"+n))),r},t.registerLinkControl=function(e,t){t=t||"button",l.register("ui-control-links-"+t,e)},t.getRegisteredLinkControl=function(e){return e=e||"button",l.get("ui-control-links-"+e)},t.filterManagerFactory=null}(Phoenix||(Phoenix={})),function(e){var t,n,i,o=e,r=o.utils,s=o.dom,a=o.ui,l=o.uiutils;n=t||(t={}),i=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._setDisabled=function(e,t){},e.prototype._setReadOnly=function(e,t){},e.prototype._setMandatory=function(e,t){},e.prototype._label=function(){return this.$element?s.find(this.$element.get(0),this.id+"_alert"):null},e.prototype._state2UI=function(){var e=this._label(),t=this.$element?this.$element.get(0):null;e&&(s.text(e,this.state.value||""),this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setMandatory(e,t))},e.prototype.changed=function(e,t,n,i){var o=this._label();this.state.value!=n&&(this.state.value=n,o&&s.text(o,this.state.value||""))},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n._label(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r))},e.prototype.render=function(e){var t=this._initOptions(l.utils.defaultOptions);return this.$element||(this.$element=$(function(e,t,n){(t=$.extend({columns:!1},t)).columns=!1;var i=[];return l.utils.fieldWrapper(i,t,n,function(){i.push('<div id="{0}_alert" class="alert alert-'+(t.type||"danger")+'" role="alert">'),i.push("</div>")}),r.format(i.join(""),e)}(this.id,t,this.options.design)),this._state2UI()),this.appendElement(e,t),this.$element},e}(e.ui.AbsField),n.Alert=i,a.registerControl(i,"string",!1,"alert",null)}(Phoenix||(Phoenix={})),function(l){var e,t,u,n,d,c,p,i,o;e||(e={}),u=(t=l).utils,n=t.ui,d=t.Observable.SchemaUtils,c=t.dom,p=t.locale,t.ulocale,i=t.uiutils,o=function(a){function e(e,t,n){var i=a.call(this,e,t,n)||this,o=i;o._selected=[];var r=o.renderOptions;r.links=r.links||[],r.title=r.title||p.ui.Actions,r.options=r.options||{},void 0===r.options.caret&&(r.options.caret=!0),r.options.type=r.options.type||"secondary",r.options.titleIsHidden&&(r.options.icon=r.options.icon||r.right?"ellipsis-v":"bars");var s=o.$schema.links||{};return r.links.forEach(function(e){e.id=u.allocID();var t="$exportCsv"===e.name?{title:p.ui.ExportCsv}:s[e.name];t?(e.options=e.options||{},e.schema=t,e.title=e.schema.title,e.bind=o.$bind+".$links."+e.name,e.isHidden=!1,"$exportCsv"===e.name&&void 0===e.options.icon&&(e.options.icon="file-export"),("$remove"===e.name||e.schema.isRemove)&&(void 0===e.options.icon&&(e.options.icon="trash"),void 0===e.options.type&&(e.options.type="danger"),void 0===e.title&&(e.title=p.ui.Remove)),("$new"===e.name||e.schema.isNew)&&(void 0===e.options.icon&&(e.options.icon="plus-circle"),void 0===e.options.type&&(e.options.type="info")),e.options.type=e.options.type||"secondary",o.form.registerListenerFor(e.bind,o)):console.log("Invalid link name: "+e.name)}),o._updateselected(),o._state(),i}return __extends(e,a),e.prototype._state2Ui=function(){var r=this,s=0;if(r.renderOptions.links.forEach(function(e){var t=e.options&&e.options.disableOnNoSelect,n=!e.state.isHidden,i=e.state.isDisabled;if((t?n:!i)&&n&&e.schema.select&&(r._selected.length?e.schema.select.multiselect||(t?i=1!==r._selected.length:n=1===r._selected.length):t?i=!0:n=!1),n&&!e.important&&s++,r.$element){var o=c.find(r.$element.get(0),e.id);n?c.removeClass(o,"bs-none"):c.hasClass(o,"bs-none")||c.addClass(o,"bs-none"),n&&(e.important&&(o=o.firstChild),i?c.hasClass(o,"disabled")||c.addClass(o,"disabled"):c.removeClass(o,"disabled"))}}),r.$element){var e=c.find(r.$element.get(0),"actions_"+r.id);s?c.removeClass(e,"bs-none"):c.hasClass(e,"bs-none")||c.addClass(e,"bs-none")}},e.prototype._updateselected=function(){var e=this.form.getValue(this.$bind);e&&(this._selected=e.getSelectedItems(this.renderOptions.expandingProperty))},e.prototype._stateOfLink=function(t){var n=this.form.getState(t.bind);t.state=t.state||{},Object.keys(n).forEach(function(e){t.state[e]=n[e]})},e.prototype._state=function(){var t=this;t.renderOptions.links.forEach(function(e){t._stateOfLink(e)})},e.prototype.findLinkByBind=function(e){for(var t=0;t<this.renderOptions.links.length;t++)if(this.renderOptions.links[t].bind===e)return this.renderOptions.links[t];return null},e.prototype.findLinkById=function(e){for(var t=0;t<this.renderOptions.links.length;t++)if(this.renderOptions.links[t].id===e)return this.renderOptions.links[t];return null},e.prototype.stateChanged=function(e,t){if(e&&t&&t.property&&0<=t.property.indexOf(".$links")){var n=this.findLinkByBind(t.property);n&&(this._stateOfLink(n),this._state2Ui())}},e.prototype.changed=function(e,t,n,i,o){var r=this;if(r.$element){var s=e.substr(r.$bind.length);if(!(0<=s.indexOf(".$selected")||0<=s.indexOf(".$links")||"propchange"!==i&&"add"!==i&&"remove"!==i))if(e===r.$bind)r._updateselected(),r._state(),r._state2Ui();else{var a=e,l=d.parsePath(r.$bind,a,r.renderOptions.expandingProperty);if(o[l]){var u=e.substr(l.length+1);if(!u)return;d.isSelectField(u)&&(r._updateselected(),r._state2Ui())}}}},e.prototype._createImportantActions=function(i){var o=this;o.renderOptions.links.forEach(function(e){if(e.important){i.push('<div id="'+e.id+'" class="bs-toolbar-item'+(o.renderOptions.right?" right":"")+' " title="'+u.escapeHtml(e.schema.title)+'">');var t=!1;void 0!==e.options.outline?t=e.options.outline:0<=["default","info","secondary","danger"].indexOf(e.options.type)&&(t=!0),i.push('<button data-action-id="'+e.id+'" class="bs-button btn btn-'+c.bootstrapStyles(t)[e.options.type]+'" type="button">');var n=!1;e.options.icon&&(n=!0,i.push('<span data-action-id="'+e.id+'" class="'+c.iconClass(e.options.icon)+'"></span>')),!e.options.titleIsHidden&&e.title&&i.push('<span data-action-id="'+e.id+'" '+(n?'class="d-none d-md-inline-block">&nbsp;':">")+u.escapeHtml(e.title)+"</span>"),i.push("</button>"),i.push("</div>")}})},e.prototype._createMenuActions=function(t){this.renderOptions.links.forEach(function(e){e.important||t.push('<a id="'+e.id+'" data-action-id="'+e.id+'" href="#" class="dropdown-item">'+u.escapeHtml(e.title)+"</a>")})},e.prototype.render=function(e){var t=this._initOptions(i.utils.defaultOptions);return this.$element||(this.$element=this._createElement(),this._state2Ui()),this.appendElement(e,t),this.$element},e.prototype._createElement=function(){var e=this,t=e.renderOptions,n=[];return l.uiutils.utils.fieldWrapper(n,t,e.options.design,function(){n.push('<div class="bs-focus-online-none bs-toolbar-item '+(t.right?" right":"")+(t.bottom?" bottom":"")+'">'),e._createImportantActions(n),n.push('<div class="dropdown">'),n.push('<button id="actions_{0}" title="'+u.escapeHtml(t.title)+'" class="bs-button btn btn-'+c.bootstrapStyles(!0)[t.options.type]+(t.options.caret?" dropdown-toggle":"")+'" id="tooltip-dropdown-{1}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),t.options.icon&&n.push('<span class="'+c.iconClass(t.options.icon)+'"></span>'),t.options.titleIsHidden||n.push('<span class="d-none d-md-inline-block">&nbsp;'+u.escapeHtml(t.title)+" </span>"),n.push("</button>"),n.push('<div class="dropdown-menu dropdown-menu-right" aria-labelledby="tooltip-dropdown-{1}" data-id="toolCommands">'),e._createMenuActions(n),n.push("</div>"),n.push("</div>"),n.push("</div>")}),$(u.format(n.join(""),e.id))},e.prototype.destroy=function(){var t=this;t.renderOptions&&t.renderOptions.links.forEach(function(e){t.form.unRegisterListenerFor(e.bind,t)}),a.prototype.destroy.call(this)},e.prototype.click=function(e){var t=this,n=e.target;n.href&&e.preventDefault();var i=c.attr(n,"data-action-id");if(i){var o=t.findLinkById(i);if(o){if(!o.isHidden&&!o.state.isDisabled&&!o.state.isHidden){var r=c.find(t.$element.get(0),o.id);if(o.important&&(r=r.firstChild),c.hasClass(r,"disabled"))return;if(o.schema&&(o.schema.isRemove||"$remove"===o.name)&&o.schema.confirm){var s=o.schema.confirm.message?o.schema.confirm.message:l.locale.ui.removeWarning;l.utils.confirm(this.form.$schema.title||p.ui.Warning,s,function(){t.form.execAction(o.bind,o.schema.select?t._selected:null)})}else if("$exportCsv"===o.name){if(!t.renderOptions.gridName)return void console.log("options.gridName is missing.");if(!(a=t.form.controlByName(t.renderOptions.gridName,!1))||!a.length)return void console.log("Can't find grid"+t.renderOptions.gridName);a[0].exportAsCsv()}else o.options.confirm?u.confirm(o.options.confirm.title,o.options.confirm.message,function(){t.form.execAction(o.bind,o.schema.select?t._selected:null)}):t.form.execAction(o.bind,o.schema.select?t._selected:null)}var a;if(t.renderOptions.gridName)(a=t.form.controlByName(t.renderOptions.gridName,!1))&&a.length&&a[0].setFocus()}}},e}(l.ui.AbsField),n.registerControl(o,"array",!1,"array-actions",null)}(Phoenix||(Phoenix={})),function(e){var t,n,s=e.utils,a=e.dom,i=e.ui,l=e.uiutils;t=e.formcomplex||(e.formcomplex={}),n=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype.click=function(e){},e.prototype._setDisabled=function(e){},e.prototype._setReadOnly=function(e){},e.prototype._setMandatory=function(e){},e.prototype._state2UI=function(e){var t=this.$element?this.$element.get(0):null;t&&this.renderContent(t)},e.prototype.renderContent=function(e){var t="";null!=this.state.value&&(t=JSON.stringify(this.state.value.model(!0),null,2)),a.append(e,$("<pre>"+t+"</pre>").get(0))},e.prototype.changed=function(e,t,n,i,o){this.state.value=this.form.getValue(this.$bind),this._state2UI(!1)},e.prototype.stateChanged=function(e,t,n){var i=this,o=i.form.getState(i.$bind),r=i.$element?i.$element.get(0):null;o.isHidden!==i.state.isHidden&&(i.state.isHidden=o.isHidden,i.setHidden(r)),o.isDisabled!==i.state.isDisabled&&(i.state.isDisabled=o.isDisabled,i._setDisabled(r)),o.isReadOnly!==i.state.isReadOnly&&(i.state.isReadOnly=o.isReadOnly,i._setReadOnly(r)),o.isMandatory!==i.state.isMandatory&&(i.state.isMandatory=o.isMandatory,i._setMandatory(r))},e.prototype._containerContent=function(e){},e.prototype.render=function(e){var t=this,n=t._initOptions(l.utils.defaultOptions);return t.$element||(t.$element=$(function(e,t,n,i){t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},t);var o=[];if(n)l.utils.fieldWrapper(o,t,n,function(){i&&i(o)});else{var r=[];t.style&&a.parseStyle(t.style,r),o.push("<div"),r.length&&o.push(' class= "'+r.join(" ")+'"'),l.utils.addContainerId(o,n),o.push(">"),i&&i(o),o.push("</div>")}return s.format(o.join(""),e)}(t.id,n,t.options.design,function(e){t._containerContent(e)})),t._state2UI(!0),t.setEvents(n)),t.appendElement(e,n),t.$element},e}(e.ui.AbsField),t.ComplexBase=n,i.registerControl(n,"object",!1,"objectjson",null),i.registerControl(n,"array",!1,"objectjson",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,h,r;t=e.formarray||(e.formarray={}),i=(n=e).customData,n.formcomplex,o=n.ui,n.utils,h=n.dom,n.ctrlsinterfaces,e.Observable.SchemaUtils,n.link,r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.customOptions=function(e){if(t.prototype.customOptions.call(this,e),!this._render){if(!e.item||!e.item.render)throw'Item render is null. Use options: { item : {render: "my_item_render"}} ';if(this._render=i.get(e.item.render),!this._render)throw"Item render isn't registered. Use customData.register(\""+e.item.render+'", controller);'}},e.prototype._renderContentElement=function(e,t,n){var i,o,r=this,s=t.model?t.model(!0):t,a=[];if("grid"===r._layout||"column"===r._layout){var l=n%r._columns;if(0===l&&"grid"===r._layout||0===n&&"column"===r._layout){r._row=$('<div class="row"></div>').get(0);for(var u=Math.floor(12/r._columns),d=0;d<r._columns;d++){var c=document.createElement("div");c.className=(r.renderOptions.layout.noPadding?"no-x-padding ":"")+"col-sm-"+u,h.append(r._row,c)}h.append(e,r._row)}i=r._row?r._row.childNodes[l]:null}else if("group"===r._layout){var p=document.createElement("a");p.href="#",a.push("list-group-item list-group-item-action flex-column align-items-start"),o=p,i=e}else"inline"===r._layout?(i=e,a.push("bs-inline-block bs-va-top")):i=r.renderCustomLayoutCreateParentOfItem(e,t,n);r.renderOptions.item&&r.renderOptions.item.style&&h.parseStyle(r.renderOptions.item.style,a),o||(o=document.createElement("div")),h.attr(o,"data-array-item",t.$id),a.length&&(o.className=a.join(" ")),r._render.render(o,s,r._map,t,n,r.renderOptions.item),i&&h.append(i,o)},e.prototype.beforeRenderContent=function(e){var t=this._render;t&&t.beforeRenderContent&&t.beforeRenderContent(self,e)},e.prototype.renderCustomLayout=function(e){},e.prototype.renderCustomLayoutCreateParentOfItem=function(e,t,n){},e.prototype.renderContent=function(n){var i=this;h.empty(n),i._map={};var e=i.state.value;i._layout="inline",i.renderOptions&&i.renderOptions.layout&&(i._layout=i.renderOptions.layout.type),"grid"!==i._layout&&"column"!==i._layout||h.hasClass(n,"container-fluid")||h.addClass(n,"container-fluid");var t=document.createDocumentFragment();i.beforeRenderContent(t),"grid"!==i._layout&&"column"!==i._layout||(i._columns=Math.max(Math.min(i.renderOptions.layout.columns||4,12),1));var o=null;e&&e.forEach(function(e,t){o||"group"!==i._layout||((o=document.createElement("div")).className="list-groups",h.append(n,o),n=o),i._renderContentElement(n,e,t)}),h.append(n,t),i._row=null},e.prototype.destroy=function(){this._map=null,this.pager&&(this.pager.destroy(),this.pager=null),this.toolBar&&(this.toolBar.destroy(),this.toolBar=null),t.prototype.destroy.call(this),this._render=null},e.prototype.setEvents=function(e){this._render.setEvents&&this._render.setEvents(e)},e.prototype.removeEvents=function(){this._render.removeEvents&&this._render.removeEvents()},e.prototype.click=function(e){this._render.click&&this._render.click(this.$element.get(0),e,this._map,this.state.value,this.form)},e.prototype.afterAddedInDom=function(){this._render.afterAddedInDomRender&&this._render.afterAddedInDomRender(this._parentItemAddedInDom,this._id)},e.prototype.resize=function(){this._render.afterResize&&this._render.afterResize(this.id,this.state.value,this.form)},e}(e.formcomplex.ComplexBase),t.ArrayControl=r,o.registerControl(r,"array",!1,"array-control",null)}(Phoenix||(Phoenix={})),function(s){var e,t,O,c,S,E,m,P,I,d,D,M,p,g,v,y,r,_,n;e=s.gridrender||(s.gridrender={}),O=(t=s).utils,c=t.customData,S=t.dom,t.ui,E=t.uiutils,m=t.ulocale,P=t.Observable.SchemaUtils,I=function(e,t){var n=S.icon(t?"caret-up":"caret-down");S.addClass(n,"bs-basictable-sort"),S.attr(n,"sort","true"),S.append(e.firstElementChild,n)},d=function(e){var t=e.lastElementChild?e.firstElementChild.lastElementChild:null;t&&"true"===S.attr(t,"sort")&&S.remove(t)},p=function(e,s,a,l,t,u,n,d,c){var p=document.createElement("tr");return"middle"===u.align&&S.addClass(p,"bs-va-middle"),t.forEach(function(e,t){var n=document.createElement("td");if(0==t)S.append(n,document.createTextNode(a.schema.title||String.fromCharCode(160)));else{S.attr(n,"rowId",e.id),S.attr(n,"colId",a.name),n.rowIndex=s,n.colIndex=t-1;var i=l.get(t-1),o=E.utils.displayValue(i.getRelativeValue(a.name),a.schema,d,{html:!0,useSymbol:!0,editable:a.canEdit,check:a.check,avanced:null,tableOptions:u,state:null,form:c},i,a.name);if(o.html){var r=$(o.value);S.append(n,r.get(0))}else S.append(n,document.createTextNode(o.value))}S.append(p,n)}),p},v=function(e,t,n,i,o){var r,s,a,l,u,d=t.scrolling&&t.scrolling.vertical,c=(s=n,a=o,l=(r=t).scrolling&&r.scrolling.vertical,u=["table","bs-control"],l&&u.push("scrolling"),(s||a)&&(u.push("table-header"),a?u.push("footer"):u.push("header"),a&&r.total&&r.total.light&&u.push("light")),!s&&!a&&r._useStripedCss&&r.striped&&u.push("table-striped"),r._useColGrp&&u.push("bs-fixed"),(s||a||!r.editing&&!r.nowrap)&&(s||a||!r.allowFrozenColumns)||(u.push("nowrap"),r._nowrap=!0),r.allowFrozenColumns&&!r.headerIsHidden&&(s?u.push("headernowrap"):l||u.push("headernowrap")),u.push("bs-theme"),(r.border||void 0===r.border)&&u.push("table-bordered"),r.small&&u.push("bs-style-small-table"),u);e.push("<table"),c.length&&e.push(' class="'+c.join(" ")+'"'),e.push(' id="{0}_table'),i&&e.push("_frozen"),n&&e.push("_header"),o&&e.push("_footer"),e.push('"');var p,h,f=(p=t,h=[],i||p.width&&"auto"!==p.width&&h.push("min-width: "+M(p.width)),h);f.length&&e.push(' style="'+f.join(";")+'"'),e.push(">"),t._useColGrp&&e.push('<colgroup id="{0}_colgrp'+(i?"_frozen":"")+(n?"_header":"")+(o?"_footer":"")+'"></colgroup>'),n?t.headerIsHidden||e.push('<thead id="{0}'+(i?"_frozen":"")+'_cols"> </thead>'):d||(t.headerIsHidden||e.push('<thead id="{0}'+(i?"_frozen":"")+'_cols"> </thead>'),t.total&&t.total.property&&e.push('<tfoot id="{0}'+(i?"_frozen":"")+'_totals"></tfoot>')),o&&t.total&&t.total.property&&e.push('<tfoot id="{0}'+(i?"_frozen":"")+'_totals"></tfoot>'),n||o||(e.push('<tbody id="{0}'),i&&e.push("_frozen"),e.push('_rows"></tbody>')),e.push("</table>")},y=function(e){var t=0;return e.forEach(function(e){t+=parseInt(e.options.width+"",10)}),t},_=function(e,t,n){var i=t.offsetHeight-(n?3:1);e.style.height=Math.floor(i)+"px"},n={createCols:function(v,e,t,g,n,y,_,i,b){var o=document.createDocumentFragment(),x=document.createElement("tr");x.className="bs-va-middle",x.id=v+e+"_tr";var C=(_||"").split(" "),k=!!g.groups,w=[];t.forEach(function(e,t){var n,i=document.createElement("th");if(S.attr(i,"colId",e.$bind),S.attr(i,"data-drag","move"),k&&(e.group?g.groups[e.group]||(k=!1,console.log("Grid "+e.$bind+": group nof found: "+e.group)):(k=!1,console.log("Grid "+e.$bind+": no group defined!")),k)){var o=g.groups[e.group],r=w.length?w[w.length-1]:null;r&&r.name===e.group?r.colSpan=r.colSpan+1:w.push({name:e.group,colSpan:1,title:o.title,group:o.group})}g._useColGrp||(e.options.width&&(i.style.width=M(e.options.width)),e.options.minWidth&&(i.style.minWidth=M(e.options.minWidth))),n&&(i.className=n.join(" "));var s=document.createElement("div"),a=["bs-column-header"];g.header&&(g.header.align&&a.push(g.header.align),g.header.style&&a.push(g.header.style)),s.className=a.join(" ");var l=s;if(g.headerLines&&(console.log("headerLines is obsolete. use instead header.rows"),g.header=g.header={},g.header.rows=g.headerLines),g.header&&g.header.rows&&1<g.header.rows){var u=document.createElement("div");a=["bs-header-rows-parent row-"+g.header.rows],u.className=a.join(" "),a=["bs-header-rows"],(l=document.createElement("div")).className=a.join(" "),u.appendChild(l),s.appendChild(u)}if(g.selecting&&g.selecting.multiselect&&g.selecting.selectAll&&P.isSelectField(e.$bind)){var d=E.utils.displayValue(!1,e.schema,y,{html:!0,selectable:!0,editable:!0,isTotal:!1,check:!0,avanced:e.options||{},tableOptions:g,state:{},form:b},null,e.$bind);if(d.html){var c=$(d.value);i.style.textAlign="center",S.append(l,c.get(0))}else S.append(l,document.createTextNode(d.value))}else if(e.isLink||e.options.titleIsHidden||!e.title)S.append(l,document.createTextNode(String.fromCharCode(160)));else if(S.append(l,document.createTextNode(e.title)),e.schema&&e.schema.description){var p=[];E.utils.addTooltipAndRule(p,{description:e.schema.description,grid:!0}),u=$(O.format(p.join(""),v+"_"+e.$bind)).get(0),S.append(l,u)}if(g.allowColumnResize&&D(e.options.width)){var h=document.createElement("div");h.className="bs-col-resize",S.attr(h,"data-drag","resize"),S.attr(i,"colId",e.$bind),S.append(s,h)}if(S.append(i,s),g.sorting){var f=e.options.display?e.options.displaySchema:e.schema,m=e.options.display?e.options.display:e.$bind;f&&P.canSort(f)&&((n=n||[]).push("bs-cursor-p"),C&&C.length&&C[0]===m&&I(i,1===_.length))}n&&(i.className=n.join(" ")),S.append(x,i)}),S.append(o,x);var s=x;k=k&&0<w.length;for(var r=function(){var r=document.createElement("tr");r.className="bs-va-middle";var e=w;w=[],e.forEach(function(e){if(k&&(e.group?g.groups[e.group]||(k=!1,console.log("Grid group for group not found: "+e.group)):k=!1),k){var t=g.groups[e.group],n=w.length?w[w.length-1]:null;n&&n.name===e.group?n.colSpan=n.colSpan+e.colSpan:w.push({name:e.group,colSpan:e.colSpan,title:t.title,group:t.group})}var i=document.createElement("th");1<e.colSpan&&(i.colSpan=e.colSpan);var o=document.createElement("div");o.className="bs-column-header align-center",S.append(o,document.createTextNode(e.title||String.fromCharCode(160))),S.append(i,o),S.append(r,i)}),k=k&&0<w.length,S.before(s,r),s=r};k;)r();return o},createColGroup:function(e,t,n){var i=document.createDocumentFragment();return e.forEach(function(e){var t=document.createElement("col");S.attr(t,"colid",e.$bind),e.options.width&&(t.style.width=M(e.options.width)),e.options.minWidth&&(t.style.minWidth=M(e.options.minWidth)),S.append(i,t)}),i},updSorting:function(e,t,n,i){if(e.sorting&&t&&t.childElementCount){var o=(i||"").split(" ");o.length||(o=[""]);for(var r=0,s=t.children.length;r<s;r++){var a=t.children[r],l=S.attr(a,"colId"),u=n(l);l=u&&u.options&&u.options.display?u.options.display:l,o[0]===l?(d(a),I(a,1==o.length)):d(a)}}},gridContainer:function(e,t,n,i,o,r,s){i=i||"",t._useColGrp=function(e,t){for(var n=!0,i=0,o=t.length;i<o;i++){var r=t[i];if(!r.options.width||r.options.minWidth){n=!1;break}}if(!(n=n&&"auto"!==e.width)){if(e.scrolling&&e.scrolling.vertical)throw"To support scrolling vertical, all columns must have explicit widths but not explicit minWidth.";if(e.editing)throw"To support inline editing, all columns must have explicit widths but not explicit minWidth."}return n}(t,r),t._useStripedCss=!(t.rows&&t.rows.detail)&&t.striped,void 0!==(t=$.extend({right:!1,icon:null,type:"default",width:"auto",height:"auto",size:null,scrolling:{horizontal:!1}},t)).title&&(i=t.title);var a,l,u=[],d=["bs-field-group bs-tab-font bs-island"];t.noVerticalMargins&&!t.design&&d.pop(),u.push('<div id="{0}" '),u.push(' class="'),n&&d.push("design"),u.push(d.join(" ")),u.push('"'),l=u,(a=n)&&l.push(' draggable="true"'),a&&l.push(' data-render="{0}"'),u.push(">"),u.push('<div id="{0}_header"></div>'),d=["bs-basictable-group"];var c=t.scrolling&&t.scrolling.horizontal,p=t.scrolling&&t.scrolling.vertical;if((p||t.allowFrozenColumns)&&d.push("border"),c&&!p&&d.push("bs-scroll-x"),u.push('<div id="{0}_focus" class="'),u.push(d.join(" ")),u.push('"'),n||u.push(' data-render="{0}"'),t.selecting&&(t.selecting.cell||t.selecting.row)&&u.push(' tabindex="0" '),u.push(">"),t.allowFrozenColumns){u.push('<div class="bs-table-cols">');var h=y(s);if(u.push('<div id="{0}_frozen_header_parent"  class="bs-table-frozen-cols" style="width:'+h+'px;">'),p&&!t.headerIsHidden&&(u.push('<div id="{0}_table_frozen_header" class="bs-table-header header">'),v(u,t,!0,!0,!1),u.push("</div>")),d=["bs-table-content-scroll frozen"],u.push('<div  class="'+d.join(" ")+'">'),d=["bs-table-content frozen"],u.push('<div id="{0}_frozen_scroll" class="'+d.join(" ")+'"'),p){var f=[];if(t.minHeight&&f.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)f.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";f.length&&u.push(' style="'+f.join(";")+'"')}u.push(">"),u.push('<div  class="'+d.join(" ")+'">'),v(u,t,!1,!0,!1),p&&u.push('<div id="{0}_frozen_scroll_delta" class="bs-relative"></div>'),u.push("</div>"),u.push("</div>"),u.push("</div>"),p&&t.total&&t.total.property&&(u.push('<div id="{0}_table_frozen_footer" class="bs-table-header footer'+(t.total.light?" light":"")+'">'),v(u,t,!1,!0,!0),u.push("</div>")),u.push("</div>"),u.push('<div id="{0}_frozen_header_sep" class="bs-table-cols-sep'+(s.length?"":" empty")+'"></div>'),u.push('<div class="bs-table-free-cols">')}if(p&&!t.headerIsHidden&&(u.push('<div id="{0}_table_header" class="bs-table-header header" style="padding-right:'),u.push(S.scrollbar()),u.push('px;">'),u.push('<div id="{0}_table_header_content" class="bs-table-header-content">'),v(u,t,!0,!1,!1),u.push("</div></div>")),p&&u.push('<div class="bs-table-content-scroll">'),d=["bs-table-content"],p&&d.push("vscroll"),u.push('<div id="{0}_master_scroll" class="'+d.join(" ")+'"'),p){if(f=[],t.minHeight&&f.push("min-height: "+parseInt(t.minHeight+"",10)+"px"),t.height&&"auto"!==t.height)f.push("height: "+parseInt(t.height+"",10)+"px");else if(t.minHeight&&t.bottom);else if(!t.minHeight)throw"To support scrolling vertical, the grid must have an explicit height/min-height.";f.length&&u.push(' style="'+f.join(";")+'"')}return u.push(">"),v(u,t,!1,!1,!1),u.push("</div>"),p&&(u.push("</div>"),t.total&&t.total.property&&(u.push('<div id="{0}_table_footer" class="bs-table-header footer'+(t.total.light?" light":"")+'" style="padding-right:'),u.push(S.scrollbar()),u.push('px;">'),u.push('<div id="{0}_table_footer_content" class="bs-table-header-content">'),v(u,t,!1,!1,!0),u.push("</div>"),u.push("</div>"))),t.allowFrozenColumns&&(u.push("</div>"),u.push("</div>")),u.push("</div>"),u.push('<center id="{0}_pagination"></center>'),u.push('<div id="{0}_bottom"></div>'),E.utils.addErrorDiv(u),u.push("</div>"),O.format(u.join(""),e)},createRows:function(e,t,i,o,n,r,s,a,l,u,d,c){var p=null;if(u||d){for(var h=0,f=0;f<i.length;f++){var m=i[f];if(d){if(m.$bind===d)break}else if(P.isNumber(m.schema))break;h++}1<h&&(p={colspan:h,columnField:u})}var v=document.createDocumentFragment();return t&&t.forEach(function(e,t,n){n=n||0,l&&l(e,t,n),S.append(v,g(0,t,n,e,i,o,0,r,0,s,a,p,c))},o.expandingProperty),v},createBulkRows:function(e,t,i,o,n,r,s,a,l,u){var d=document.createDocumentFragment();return t&&t.forEach(function(e,t){var n=e.level||0;l&&l(e.value,t,n),S.append(d,g(0,t,n,e.value,i,o,0,r,0,s,a,null,u))}),d},createRow:g=function(e,v,g,y,_,b,t,x,n,i,C,k,w){var O=document.createElement("tr");O.id=y.$id+(i?"_frozen":"");var o=["bs-table-row"];if("middle"===b.align&&o.push("bs-va-middle"),b.bindStatus){var r=y[b.bindStatus];r&&o.push("table-"+r)}(!C&&y.$select&&b.selecting&&b.selecting.row&&(b.noRowSelectedIndicator||o.push("bs-row-selected")),!C&&b.expanding&&b.expanding.styledLevels&&o.push("bs-level bs-row-level-"+g),O.className=o.join(" "),!b._useStripedCss&&b.striped)&&(v%2==1||S.addClass(O,"even"));return _.forEach(function(e,t){var n=document.createElement("td");if(k)if(0===t)e=k.columnField?_.find(function(e){return e.$bind===k.columnField}):null,n.colSpan=k.colspan;else if(t<k.colspan)return;var i=!1;if(e){0===v&&b.headerIsHidden&&!b._useColGrp&&(e.options.width&&(n.style.width=M(e.options.width)),e.options.minWidth&&(n.style.minWidth=M(e.options.minWidth)));var o=[];e.options._expandItem&&o.push("bs-cursor-d");var r=y.getRelativeState(e.$bind);r.style&&S.parseStyle(r.style,o);var s=e.options.align;if(e.schema){var a=P.isNumber(e.schema),l=P.isDate(e.schema)||P.isDateTime(e.schema);b._nowrap||!a&&!l||o.push("nowrap"),s||(a?s="right":l&&(s="center"))}if(s&&o.push(E.utils.align2Css(s)),e.isLink&&!C&&e.options.button&&o.push("bs-td-button"),!C&&b.editing&&(!r.isHidden&&r.isReadOnly||r.isDisabled||!1===e.options.editing||!1===e.options.selecting)){var u=!1;"object"!=typeof b.editing&&(b.editing.readOnlyRow&&y.getValue(b.editing.readOnlyRow)?u=!0:b.editing.onlyIsLeaf&&b.expandingProperty&&y[b.expandingProperty]&&!y[b.expandingProperty].isEmpty()&&(u=!0)),u||o.push("bs-td-readonly")}if(o.length&&(n.className=o.join(" ")),S.attr(n,"colId",e.$bind),r.isHidden)i=!0;else if(e.isLink)C||E.utils.renderButton(e.$bind,e.options,r,e.schema,n,y)||(i=!0);else{var d=n,c=e.options||{},p=(b.editing||P.isSelectField(e.$bind))&&!r.isDisabled&&!r.isReadOnly&&!r.isHidden;if(!r.isHidden){var h=null;c.display&&c.displaySchema&&(h=E.utils.displayValue(y.getRelativeValue(c.display),c.displaySchema,x,{tableOptions:b,avanced:c.displayOptions||{},state:y.getRelativeState(c.display),form:w},y,c.display));var f=E.utils.displayValue(y.getRelativeValue(e.$bind),e.schema,x,{html:!0,useSymbol:!1,selectable:!r.isDisabled,editable:p,isTotal:C,check:b.editing,avanced:c,tableOptions:b,display:h,level:g,state:r,form:w},y,e.$bind);if(f.html){var m=$(f.value);S.append(d,m.get(0))}else""===f.value?i=!0:S.append(d,document.createTextNode(f.value))}}}else i=!0;i&&S.append(n,document.createTextNode(String.fromCharCode(160))),S.append(O,n)}),O},setRowsSelected:function(e,t,n,i){if(n.selecting&&n.selecting.row){var o=[],r=S.find(i,e);r&&o.push(r),n.allowFrozenColumns&&(r=S.find(i,e+"_frozen"))&&o.push(r),o.forEach(function(e){t?S.addClass(e,"bs-row-selected"):S.removeClass(e,"bs-row-selected")})}},createGridRows:function(n,e,i,o,r,s,a,l){var u=document.createDocumentFragment();return e&&e.forEach(function(e,t){S.append(u,p(n,t,e,i,o,r,s,a,l))}),u},createInplaceEdit:function(e,t,n,i,o,r,s,a){if(s.schema.enum)return function(e,t,n,i,o,r,s){var a=document.createElement("select");a.type="text",a.className=["bs-inplace-edit bs-edit-border bs-inplace-edit-size custom-select"].join(" ");var l=n.filter?r.schema.filters[n.filter]||[]:r.schema.enum,u=l.indexOf(t);u<0&&(u=l.indexOf(""));var d=u<0;return r.schema.nullable&&0<=u&&u++,E.utils.fillSelect(l,a,r.schema,d),_(a,i,!1),S.empty(i),S.addClass(i,"focused"),S.append(i,a),a.selectedIndex=u,{input:a,parent:a,td:i,combo:null,isInputElement:!0,canSelect:!1,schema:r.schema,emptyValue:d||r.schema.nullable}}(0,n,i,o,0,s);if(P.isBoolean(s.schema))return{input:null,parent:null,td:o,isInputElement:!1,canSelect:!1,schema:s.schema,combo:null};if(a.after||a.before)return function(n,e,t,i,o,r,s,a){var l=document.createElement("div");l.className="bs-inplace-parent bs-edit-border ";var u=l;a.after&&((u=document.createElement("div")).className="bs-input-group",l.appendChild(u));var d=P.isDate(s.schema)&&E.utils.useDatePicker(),c=document.createElement("input");c.type=a.type||"text";var p=["bs-inplace-edit bs-inplace-edit-size"];if(a.after&&p.push("bs-input-group-main"),c.className=p.join(" "),S.append(u,c),a.after){var h=document.createElement("span");h.tabIndex=-1,h.className="bs-input-group-addon bs-cursor-d input-group-append input-group-addon";var f=document.createElement("span");f.className=S.iconClass(a.after.icon),S.append(h,f),S.append(u,h),a.id&&(h.id=a.id+"_after")}return _(c,o,!0),S.empty(o),S.addClass(o,"focused"),S.append(o,l),P.isDate(s.schema)?d?(E.utils.datePickerInitialize($(l),{showOnFcous:!0},function(e){var t=!1;document.activeElement!==document.body&&document.activeElement?t=!0:c.focus(),!t||document.activeElement&&n.focusInControl(document.activeElement)||(n.focusOut(null),n.focused=!1)}),E.utils.datePickerSetValue($(l),t)):c.value=m.isoDatePart(t||""):c.value=e,{input:c,parent:l,td:o,isInputElement:!0,canSelect:!0,schema:s.schema,combo:null}}(e,t,n,0,o,0,s,a);var l=document.createElement("input");l.type=a.type||"text";var u=["bs-inplace-edit bs-edit-border bs-inplace-edit-size"];s.options.align&&u.push(E.utils.align2Css(s.options.align));var d=P.getMaxLength(s.schema);return"text"===l.type&&d&&(l.maxLength=d),l.className=u.join(" "),_(l,o,!1),S.empty(o),S.addClass(o,"focused"),S.append(o,l),P.isDate(s.schema)?l.value=m.shortDate(n||""):(P.isNumber(s.schema),l.value=t),{input:l,parent:l,td:o,isInputElement:!0,canSelect:!0,schema:s.schema,decimals:i.decimals,combo:null}},updateInplaceEdit:function(e,t,n,i,o,r,s,a){if(s.schema.enum)return l=e,u=n,c=s,p=((d=i).filter?c.schema.filters[d.filter]||[]:c.schema.enum).indexOf(u),l.emptyValue&&p++,void(l.input.selectedIndex=p);var l,u,d,c,p;t=t||"",P.isNumber(s.schema)?e.input.value=t:P.isDate(s.schema)&&E.utils.useDatePicker()?E.utils.datePickerSetValue($(o),n):e.input.value=t},createDetail:function(e,t){var n=document.createElement("tr");n.className="bs-table-row-detail",n.id=e+"_detail";var i=document.createElement("td");return i.colSpan=t.childNodes.length,S.append(n,i),n},updateEvenOdd:function(e){if(e.childNodes.length)for(var t=!1,n=0,i=e.childNodes.length;n<i;n++){var o=e.childNodes[n];S.hasClass(o,"bs-table-row")&&(t?S.removeClass(o,"even"):S.addClass(o,"even"),t=!t)}},ensureWidth:M=function(e){return"number"==typeof e?e+"px":parseInt(e,10)+""===e.trim()?e.trim()+"px":e},updateFrozenWidth:function(e,t,n){var i=y(n),o=S.find(e,t+"_frozen_header_parent");o&&(o.style.width=i+"px"),(o=S.find(e,t+"_frozen_header_sep"))&&(i?S.removeClass(o,"empty"):S.addClass(o,"empty"))},setColumnWidth:function(o,e,r){e.forEach(function(e){for(var t=0,n=e.childNodes.length;t<n;t++){var i=e.childNodes[t];if(S.attr(i,"colid")===o){i.style.width=r+"px";break}}})},hasFrozenColumns:function(e,t){return!!(e.allowFrozenColumns&&t&&t.length)},cloneForMove:function(e){var t=e.cloneNode(!0);if("th"===t.tagName.toLowerCase()){var n=e.parentElement,i=n.parentElement.parentElement,o=["<div>"];o.push('<table class="'),o.push(i.className),o.push('">'),o.push("<thead>"),o.push('<tr class="'),o.push(n.className),o.push('">'),o.push("</tr></thead><table>"),o.push("</div>");var r=$(o.join("")).get(0),s=r.firstChild.firstChild.firstChild;s.style.height=e.offsetHeight+"px",S.append(s,t),t=r}var a=S.position(e,null);return t.style.top=a.top+"px",t.style.left=a.left+"px",t.style.width=e.offsetWidth+"px",t.style.height=e.offsetHeight+"px",t.style.zIndex="9000",t.style.position="absolute",t},isPixel:D=function(e){if("number"==typeof e)return!0;if("string"==typeof e){var t=parseInt(e,10)+"";if(t===e.trim())return!0;if(t+"px"===e.trim())return!0}return!1},widthFromSchema:function(e){return P.isBoolean(e)?50:P.isDate(e)?110:P.isNumber(e)?110:150},resizeDiv:function(e,t){var n=document.createElement("div");return n.className="bs-absolute bs-col-resize-indicator",n.style.top="0px",n.style.left=t.left+"px",S.append(e,n),n},getColumnsSizeParents:function(e,t,n,i){var o,r=[];return n._useColGrp?i?((o=s.dom.find(t,e+"_colgrp_frozen_header"))&&r.push(o),(o=s.dom.find(t,e+"_colgrp_frozen"))&&r.push(o),n.total&&n.total.property&&(o=s.dom.find(t,e+"_colgrp_frozen_footer"))&&r.push(o)):((o=s.dom.find(t,e+"_colgrp_header"))&&r.push(o),(o=s.dom.find(t,e+"_colgrp"))&&r.push(o),n.total&&n.total.property&&(o=s.dom.find(t,e+"_colgrp_footer"))&&r.push(o)):n.headerIsHidden||(o=i?s.dom.find(t,e+"_frozen_cols_tr"):s.dom.find(t,e+"_cols_tr"))&&r.push(o),r},multiselectContainer:function(e,t,n){var i=['<div class="modal-content bs-table-selected-list" id="{0}_ms">'];i.push('<div class="bs-table-selected-list-header"><span id="{0}_title_ms" class="title bs-none">{2}</span><span id="{0}_close_ms" class="icon-close {1}"></span></div>'),i.push('<div class="bs-table-selected-list-content">'),i.push('<ul class="list-group" id="{0}_ms_list">'),i.push("</ul>"),i.push("</div>"),i.push("</div>");var o=$(O.format(i.join(""),e,S.iconClass("window-minimize"),n||"")).get(0);return t||r(!0,e,o),o},createMultiselectItems:function(e,t,n,i,o){!function(e,t,o,n,r){var i=S.find(t,e+"_ms_list"),s=o.rowMove.expression||"{{$id}}",a=null;o.rowMove.lineRender&&(a=c.get(o.rowMove.lineRender));var l=$('<li class="list-group-item bs-list-item-button"></li>').get(0),u=$('<div class="bs-list-button"><span class="'+S.iconClass("times")+'"></span></div>').get(0),d=document.createDocumentFragment();for(n.forEach(function(e){var t=e.data,n=l.cloneNode();if(S.attr(n,"data-ms-unselect",t.$id),a){var i=a(o,t.model(!0),e.level,r);if(!i)return;S.append(n,i)}else S.text(n,O.execAngularExpression(s,t.model(!0)));S.append(d,n),S.append(n,u.cloneNode(!0))});i.firstChild;)S.remove(i.firstChild);S.append(i,d)}(e,t,n,i,o)},isMultiselectMinimized:function(e){return S.hasClass(e,"minimized")},setMultiselectMinimized:r=function(e,t,n){var i=S.find(n,t+"_close_ms"),o=S.find(n,t+"_title_ms");e?(S.addClass(n,"minimized"),i&&(S.removeClass(i,s.dom.iconClass("window-minimize",!0)),S.addClass(i,s.dom.iconClass("window-maximize",!0))),o&&S.addClass(o,"bs-none")):(S.removeClass(n,"minimized"),i&&(S.removeClass(i,s.dom.iconClass("window-maximize",!0)),S.addClass(i,s.dom.iconClass("window-minimize",!0))),o&&S.removeClass(o,"bs-none"))}},e.GridUtil=n}(Phoenix||(Phoenix={})),function(e){var t;(t=e.ctrlsinterfaces||(e.ctrlsinterfaces={})).glbGridFilter=null,t.glbGridSettings=null,t.glbMongoFilter2Filter=null}(Phoenix||(Phoenix={})),function(w){var M=w.utils,F=w.dom,c=w.ui,d=w.ulocale,f=w.uiutils,O=w.Observable,S=w.gridrender.GridUtil,n=w.customData,p=O.errorsUtils,L=w.link,h=w.locale,o=w.drag,m=w.events,T=O.SchemaUtils;!function(s){s.gridlookup=null;var u=function(){function e(e){this._grid=e,this._properties=[]}return e.prototype.destroy=function(){var t=this;t._properties.forEach(function(e){t._grid.form.unRegisterListenerFor(e,t)}),t._grid=null},e.prototype.changed=function(e,t,n,i,o){0<=this._properties.indexOf(e)&&("add"===i&&(o[e+".$item"]=o.$value),this._grid.changed(e+".$item",t,n,"propchange",o))},e.prototype.listen=function(e){var t=this._grid.$bind+".$item."+e;this._properties.indexOf(t)<0&&(this._properties.push(t),this._grid.form.registerListenerFor(t,this))},e}(),e=function(l){function e(e,t,n){var o=l.call(this,e,t,n)||this;o._refreshGrid=function(){var e=this,t=e.renderOptions;e.state.value&&(e.state.value.allowSelecting=e.renderOptions.selecting&&(e.renderOptions.selecting.row||e.renderOptions.selecting.cell),e.state.value.multiselect=e.renderOptions.selecting&&e.renderOptions.selecting.multiselect,e.state.value.expandingProperty=e.renderOptions.expandingProperty),e.removeEvents(),e._initCols(t),e._renderColumns(t),e._renderRows(!0,"",null),e._renderTotalRows(),e.setEvents(e.renderOptions),e.resize()};var i=o;i._columnsListener=new u(i),void 0===i.fieldOptions.striped&&(i.fieldOptions.striped=!0),i._view=[],i._viewMap={},i._ignoreNotifications=!1,i._state(),n.supportSettings()&&(i._settingsName=i.getSettingsName("basicgrid"),i._settings=n.getFieldSettings(i._settingsName));var r=i.fieldOptions.columns||[];if(i._originalColsMap={},r.forEach(function(e){i._originalColsMap[e.$bind]=e}),i._settings){var s=i._settings.columns||[];s.forEach(function(e){var t=o._originalColsMap[e.$bind];if(t){var n=e.options||{},i=t.options||{};n.width&&(i.width=n.width),n.frozen&&(i.frozen=n.frozen),n.display&&(i.display=n.display),e.options=i}}),i.fieldOptions.columns=s,i._settings.columns=null}if(i.fieldOptions&&i.fieldOptions.total&&i.fieldOptions.total.property){i._totalProperty=i.fieldOptions.total.property;var a=i.form.getSchema(i._totalProperty);i._totalIsArray=a&&"array"===a.type,i._totalField=i.fieldOptions.total.field,i._stopField=i.fieldOptions.total.firstTotal,n.registerListenerFor(i._totalProperty,i)}return i.checkOptions(i.fieldOptions),i._lines2columns(i.fieldOptions),i._initOrigColumns(i.fieldOptions),i.state.value&&i.state.value.columns&&i._setVisiblesColumns(i.fieldOptions,i.state.value.columns,!0),i._initCols(i.fieldOptions),i._details=[],i._onselectItemHandler=i._onselectItem.bind(i),o}return __extends(e,l),e.prototype._lines2columns=function(n){if(n.linesAsColumns){var e=M.getValue(this.form.$model.model(!0),n.linesAsColumns);if(e){var i={};n.columns.forEach(function(e){i[e.$bind]=e});var o=n.columns.length;n.linesAsColumnsInsertAfter&&0<=(o=n.columns.findIndex(function(e){return e.$bind===n.linesAsColumnsInsertAfter}))&&o++,o<0&&(o=n.columns.length),e.forEach(function(e){if(e.name&&!i[name]){var t=$.extend(!0,{},e);t.$bind=t.name,t.options=t.options||{},t.options.title=t.title,t.sourceBind=n.linesAsColumns,n.columns.splice(o,0,t),o++,i[t.$bind]=t}})}}},e.prototype._initOrigColumns=function(e){var t=this;t._originalCols={},e.columns=e.columns||[];var n=[];e.columns.forEach(function(e){e.options=e.options||{},e.$bind===O.EXPANDED_FIELD_NAME&&e.options.display?(t._originalCols[e.options.display]=$.extend(!0,{},e),t._originalCols[e.options.display].options._expandItem=!0):t._originalCols[e.$bind]=t._originalCols[e.$bind]||$.extend(!0,{},e),e.options.bindVisibility&&n.indexOf(e.options.bindVisibility)<0&&n.push(e.options.bindVisibility)}),n.length&&(t._bindVisibility=n,t._bindVisibility.forEach(function(e){return t.form.registerListenerFor(e,t)}))},e.prototype.checkOptions=function(e){void 0===e.allowColumnMove&&(e.allowColumnMove=!0),e.align=e.align||"middle"},e.prototype.beforeSaveSettings=function(){var i=this;return!!i._settingsName&&(i._settings={columns:[]},(i.renderOptions.columns||[]).forEach(function(e){var t={$bind:e.$bind,options:null},n={};e.canStartDragHandler&&(n.frozen=!0),e.options.width&&(n.width=e.options.width),e.options.display&&(n.display=e.options.display),e.options.frozen&&(n.frozen=e.options.frozen),e.options._expandItem&&(t.$bind=O.EXPANDED_FIELD_NAME),t.options=n,i._settings.columns.push(t)}),i.form.setFieldSettings(i._settingsName,i._settings),!0)},e.prototype._inplaceEditValue2Model=function(e,t,n){var i=t.getState(n.$bind);T._isMoney(n.schema)&&(i.moneyUnitCoef=this.form.moneyUnitCoef);var o=t.getValue(n.$bind);if(T.value2Text(o,n.schema,i)!==e){var r=T.text2Value(e,n.schema,i);return r!==o&&(t.setValue(n.$bind,r),!0)}},e.prototype.setFocus=function(e){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden)if(this.inplace&&this.inplace.input&&this.inplace.isInputElement)this.inplace.input.focus();else if(this.$element){var n=F.query(this.$element.get(0),'[tabindex="0"]');n&&n.focus()}},e.prototype._inplaceEditAcceptKeys=function(e){if(this.inplace.schema.enum){if(e===F.keys.VK_UP||e===F.keys.VK_DOWN)return!1}else if(T.isDate(this.inplace.schema)&&f.utils.useDatePicker()&&(e===F.keys.VK_UP||e===F.keys.VK_DOWN||e===F.keys.VK_LEFT||e===F.keys.VK_RIGHT))return!1;return!0},e.prototype._inplaceEditAddEvents=function(){var o=this;o.inplace.schema.enum&&$(o.inplace.input).on("change",function(e){if(o.form.isInProcessing)return o.form.freeze(e);var t=o.inplace.td,n=o._td2value(t),i=o._inplaceEditGetValue(n);o._inplaceEditValue2Model(i,n.item,n.col)||o._modifyCell(n.item,n.col.$bind,null,t,null)})},e.prototype._inplaceEditRemoveEvents=function(){this.inplace.schema.enum?$(this.inplace.input).off("change"):T.isDate(this.inplace.schema)&&f.utils.useDatePicker()&&(f.utils.datePickerClose($(this.inplace.parent)),f.utils.datePickerDestroy($(this.inplace.parent)))},e.prototype._inplaceEditGetValue=function(e){if(!e.item)return null;var t=e.item.getState(e.col.$bind);if(this.inplace.schema.enum){var n=this.inplace.input.selectedIndex;this.inplace.emptyValue&&(n-=1);var i=t.filter?this.inplace.schema.filters[t.filter][n]:this.inplace.schema.enum[n];return void 0===i&&(i=""),i}return f.utils.text2value(this.inplace.input.value,this.inplace.schema,t)},e.prototype._inpaceEditShow=function(e,t){var n=this,i=n._td2value(e),o=i.item.getValue(i.col.$bind),r=i.item.getState(i.col.$bind);T.isMoney&&(r.moneyUnitCoef=n.form.moneyUnitCoef);var s=T.value2Text(o,i.col.schema,r);e.tabIndex=-1;var a={type:"text",after:null,id:null};i.col.$lookup?(a.after={icon:"chevron-down"},a.id=e.id||M.allocID(),e.id=a.id):T.isDate(i.col.schema)&&f.utils.useDatePicker()&&(a.after={icon:"calendar"}),n.inplace=S.createInplaceEdit(n,s,o,r,e,i,i.col,a),i.col.$lookup&&(n.inplace.id=a.id,n.inplace.col=i.col,n._createGridPopup()),n._inplaceEditAddEvents(),n.inplace.isInputElement?(n.inplace.input.tabIndex=0,n.inplace.input.focus(),n.inplace.canSelect&&F.select(n.inplace.input)):(e.tabIndex=0,e.focus()),n._onFrozenFocusScroll(e,i.col)},e.prototype._destroyInplaceEdit=function(){this.inplace&&(this.inplace.combo&&(this.inplace.combo.destroy(),this.inplace.combo=null),this.inplace=null)},e.prototype._inplaceEditRemove=function(e,t,n){var i=this;if(i.inplace&&!t){var o=i.inplace.td;e&&(o.tabIndex=0);var r=i._td2value(o);if(i._inplaceEditRemoveEvents(),i.inplace.parent&&F.remove(i.inplace.parent),F.removeClass(o,"focused"),!!i.inplace.input){var s=i._inplaceEditGetValue(r);if(i._destroyInplaceEdit(),!r.item)return;if(r.col.$lookup){var a=(r.item.getValue(r.col.$bind)||"")+"";if(!n&&s!==a)return i._findValue(s,r,function(e){i._setRemoteValue(r.col,r.item,e),i._modifyCell(r.item,r.col.$bind,null,o,null)});i._modifyCell(r.item,r.col.$bind,null,o,null)}else!n&&i._inplaceEditValue2Model(void 0===s?"":s+"",r.item,r.col)||i._modifyCell(r.item,r.col.$bind,null,o,null)}}i._destroyInplaceEdit()},e.prototype._inplaceEditModel2Control=function(e,t,n,i){var o=this._td2value(n),r=e.getValue(o.col.$bind),s=e.getState(o.col.$bind);T._isMoney(o.col.schema)&&(s.moneyUnitCoef=this.form.moneyUnitCoef);var a=T.value2Text(r,o.col.schema,s);S.updateInplaceEdit(this.inplace,a,r,s,n,o,o.col,{})},e.prototype.removeEvents=function(){var e=this;e._scrollableMaster&&$(e._scrollableMaster).off("scroll"),e._scrollableFrozenContent&&$(e._scrollableFrozenContent).off("mousewheel"),e._scrollableMaster=null,e._scrollableHeaderOfMaster=null,e._scrollableFooterOfMaster=null,e._drag&&(o.dragManager.rmvDrag(e._drag),e._drag=null)},e.prototype._onFrozenFocusScroll=function(e,t){if(t&&t.options&&t.options.frozen){var n=this.renderOptions;S.hasFrozenColumns(n,this.frozenColumns)&&n.scrolling&&n.scrolling.vertical&&(this._rsFrozenTimer&&(this._rsFrozenTimer.clearTimeout(),this._rsFrozenTimer=null),this.syncMasterScroll(null))}},e.prototype.setEvents=function(e){var r=this;if(e.scrolling&&e.scrolling.vertical){var t=r.$element.get(0);r._scrollableMaster=F.find(t,r.id+"_master_scroll"),r._scrollableHeaderOfMaster=F.find(t,r.id+"_table_header_content"),r._totalProperty&&(r._scrollableFooterOfMaster=F.find(t,r.id+"_table_footer_content"));var n=S.hasFrozenColumns(e,r.frozenColumns);r._scrollableFrozenContent=n?F.find(t,r.id+"_frozen_scroll"):null,r._deltaHScrollContent=n?F.find(t,r.id+"_frozen_scroll_delta"):null,r._scrollableMaster&&r._scrollableHeaderOfMaster&&$(r._scrollableMaster).on("scroll",r.syncHeaderAndFrozenScroll.bind(r)),r._scrollableFrozenContent&&$(r._scrollableFrozenContent).on("mousewheel",function(e){if(r._scrollableMaster.scrollHeight>r._scrollableMaster.clientHeight){var t=0<r._scrollableMaster.scrollTop,n=r._scrollableMaster.scrollTop+r._scrollableMaster.clientHeight<r._scrollableMaster.scrollHeight,i=e.originalEvent,o=r._scrollableMaster.scrollTop;0<i.wheelDelta/120?t&&(o=Math.max(0,r._scrollableMaster.scrollTop-120),e.stopPropagation(),e.preventDefault()):n&&(o=Math.min(r._scrollableMaster.scrollHeight-r._scrollableMaster.clientHeight,r._scrollableMaster.scrollTop+120),e.stopPropagation(),e.preventDefault()),o!==r._scrollableMaster.scrollTop&&(r._scrollableMaster.scrollTop=o)}})}if((e.allowColumnResize||e.allowColumnMove)&&!e.headerIsHidden||e.rowMove){var i=o.dragManager.addDrag([r.$element.get(0)]);(r._drag=i).canStartDragHandler=r._canStartDrag.bind(r),i.onDragStart=r._onDragStart.bind(r),i.onDrag=r._onDrag.bind(r),i.onDragEnd=r._onDragEnd.bind(r)}},e.prototype._getColsInfo=function(e,i){var o=[];return e.forEach(function(e,t){var n=i.childNodes[t];n.id||(n.id=M.allocID()),o.push({htmlId:n.id,info:e})}),o},e.prototype._canStartDrag=function(e){var t=this,n=e.target,i=F.attr(n,"data-drag"),o=t.renderOptions,r=null;if(o.headerIsHidden||!o.allowColumnResize&&!o.allowColumnMove||(r=F.parentByTag(t.$element.get(0),n,"th")),r){var s=t.renderOptions;return!(s.headerIsHidden||!s.allowColumnResize&&!s.allowColumnMove)&&(i||(i=F.attr(r,"data-drag")),!!i&&(r.id||(r.id=M.allocID()),t._drag.data.op=i,t._drag.data.cloneId=r.id,t._drag.data.column=F.attr(r,"colId"),!!t._drag.data.column&&t["_cdd"+i](e)))}var a=o.rowMove?F.parentByTag(t.$element.get(0),e.target,"td"):null;if(a){var l=t._td2cell(a);if(l){t.renderOptions;if(t._findById(l.row))return t._drag.data.op="rowmove",t._drag.data.row=l.row,t._drag.coverDocument=!1,t._drag.cursor="default",t._drag.moveSourceName="rowmove",!0}}return!1},e.prototype._onDragStart=function(e){return!!this._drag.data.op&&this["_sdd"+this._drag.data.op](e)},e.prototype._onDrag=function(e){return!!this._drag.data.op&&this["_ddd"+this._drag.data.op](e)},e.prototype._onDragEnd=function(e,t){return!!this._drag.data.op&&this["_edd"+this._drag.data.op](e,t)},e.prototype._cddresize=function(e){if(!this.renderOptions.allowColumnResize)return!1;var t=this._drag;return t.coverDocument=!0,t.cursor="col-resize",t.moveX=!0},e.prototype._sddresize=function(e){var t=this._drag;t.floatParent=this._gridParentFocus();var n=F.find(t.floatParent,this._drag.data.cloneId),i=F.position(n,t.floatParent);return t.floatElement=S.resizeDiv(t.floatParent,{left:Math.round(i.left+n.offsetWidth)}),t.minLeft=Math.round(i.left+20),t.maxLeft=Math.round(i.left+2e3),!0},e.prototype._dddresize=function(e){return!0},e.prototype._eddresize=function(e,t){var n=this._drag;if(n&&(n.floatElement&&(F.remove(n.floatElement),n.floatElement=null),!e)){var i=this._colByField(n.data.column),o=m.point(t).x-n.startPoint.x,r=F.find(n.floatParent,this._drag.data.cloneId),s=parseInt(i.options.width+"",10);if(5<r.offsetWidth-s){var a=s/r.offsetWidth;o=Math.round(a*o)}var l=Math.min(Math.max(20,s+o),2e3);this._updateColWidth(i,l),this.savePreferences(function(){})}},e.prototype._updateColWidth=function(e,t){if(Math.max(parseInt(e.options.width||"0",10),2e3)!==t){e.options.width=t;var n=e.options.frozen&&this.renderOptions.allowFrozenColumns,i=S.getColumnsSizeParents(this.id,this.$element.get(0),this.renderOptions,n);S.setColumnWidth(e.$bind,i,t),n&&S.updateFrozenWidth(this.$element.get(0),this.id,this.frozenColumns),this.resize()}},e.prototype._cddmove=function(e){var t=this.renderOptions;if(!t.allowColumnMove)return!1;var n,i,o=this.$element.get(0),r=this._drag,s=F.find(o,r.data.cloneId);r.coverDocument=!0,r.cursor="move",r.moveX=!0,r.moveY=!0,r.startOffset=F.position(s,null);var a={firstDelta:0,lastDelta:-10,delta:-6,top:r.startOffset.top,height:s.offsetHeight};if(t.allowFrozenColumns&&(n=F.find(o,this.id+"_frozen_cols_tr"))&&(i=F.childrenPositions(n,this._getColsInfo(this.frozenColumns,n),!1,"frozen",a)),a.lastDelta=0,n=F.find(o,this.id+"_cols_tr")){var l=F.childrenPositions(n,this._getColsInfo(this.columns,n),!1,"free",a);i=i?i.concat(l):l}return r.data.childrenPositions=i,!0},e.prototype._cddrowmove=function(e){if(!this.renderOptions.rowMove)return!1;this.$element.get(0),this._drag;return!0},e.prototype._sddrowmove=function(e){var t=this.renderOptions;if(!t.rowMove)return!1;if(t.rowMove.multiselect&&(!t.selecting||!t.selecting.row||!t.selecting.multiselect))return!1;var n=t.rowMove.expression||"{{$id}}",i=this._drag,o=this._findById(this._drag.data.row);if(t.rowMove.multiselect&&o.$select)return!1;var r=$('<div><span class="bs-row-in-drag">'+M.escapeHtml(M.execAngularExpression(n,o))+"</span></div>").get(0);return i.floatElement=S.cloneForMove(r),i.floatElement.style.left=e.pageX-5+"px",i.floatElement.style.top=e.pageY-5+"px",F.append(document.body,i.floatElement),i.moveX=!0,i.moveY=!0,i.data.item=o,t.rowMove.multiselect&&(i.data.multiSelTarget=this._openMultiselectSummary(null,!0,t.rowMove.title)),!0},e.prototype._dddrowmove=function(e){return!0},e.prototype._eddrowmove=function(e,t){var n=this._drag;if(n&&(n.floatElement&&(F.remove(n.floatElement),n.floatElement=null),!e&&t&&n.data.multiSelTarget)){var i=m.point(t),o=F.position(n.data.multiSelTarget,null);if(i.x>o.left&&i.x<o.left+n.data.multiSelTarget.offsetWidth&&i.y>o.top&&i.y<o.top+n.data.multiSelTarget.offsetHeight){var r=this.renderOptions;if(this.state.value){var s=n.data.item.parentArray;s.selecting(!0,r.expandingProperty);try{n.data.item.select(!0,r.selecting&&r.selecting.row&&r.selecting.multiselect,this.state.value,r.expandingProperty,r.expanding&&r.expanding.selectChildren)}finally{s.selecting(!1,r.expandingProperty)}}}}},e.prototype._sddmove=function(e){var t=this._drag,n=F.find(this.$element.get(0),t.data.cloneId);return t.floatElement=S.cloneForMove(n),F.append(document.body,t.floatElement),!0},e.prototype._eddmove=function(e,t){var n=this,i=n._drag;if(i&&(i.floatElement&&(F.remove(i.floatElement),i.floatElement=null),i.data.mdiv&&(F.remove(i.data.mdiv),i.data.mdiv=null),!e&&i.data.best&&i.data.column)){var o=i.data.best.info,r=n._mapCols[i.data.column];if("empty"===i.data.best.position)r.column.options.frozen=!r.column.options.frozen;else{if(o.$bind===r.column.$bind)return;var s=n._mapCols[o.$bind],a=r.column,l=s.column,u=r.tindex,d="after"===i.data.best.position?s.tindex+1:s.tindex,c=!1;if(!!a.options.frozen!=!!l.options.frozen&&(a.options.frozen=l.options.frozen,c=!0),u===d-1){if(!c)return}else n.renderOptions.columns.splice(u,1),u<d&&d--,n.renderOptions.columns.splice(d,0,a)}n.savePreferences(function(){n._refreshGrid()})}},e.prototype._dddmove=function(e){var t=this._drag,n=m.point(e),i=F.findNearest(n.x,n.y,t.data.childrenPositions);if(t.data.best!=i){var o={left:i.left,top:i.top,width:i.width,height:i.height};t.data.mdiv=F.showMove(t.data.mdiv,i.vertical,o,"frozen"===i.zone?"bs-drag-color-success":"bs-drag-color-info")}return t.data.best=i,!0},e.prototype.destroy=function(){var t=this;t._destroyDetails(),t._columnsListener&&(t._columnsListener.destroy(),t._columnsListener=null),t.columns&&(t.columns.forEach(function(e){e.schema=null}),t.columns=null),t.frozenColumns&&(t.frozenColumns.forEach(function(e){e.schema=null}),t.frozenColumns=null),t._totalProperty&&t.form.unRegisterListenerFor(t._totalProperty,t),t._bindVisibility&&t._bindVisibility.forEach(function(e){return t.form.unRegisterListenerFor(e,t)}),t._inplaceEditRemove(!1,!0,!1),t._onselectItemHandler=null,t._eventBus&&(t._eventBus.destroy(),t._eventBus=null),t.pager&&(t.pager.destroy(),t.pager=null),t._details=null,t._mapCols=null,t._mapColsSupp=null,t._originalCols=null,t._originalColsMap=null,t._settings=null,t._scroller=null,t._rsTimer=null,t._rsFrozenTimer=null,t._scrollableMaster=null,t._scrollableHeaderOfMaster=null,t._scrollableFooterOfMaster=null,t._scrollableFrozenContent=null,t._deltaHScrollContent=null,l.prototype.destroy.call(this)},e.prototype._moveToPage=function(e){this.state.value&&this.state.value.currentPage(e)},e.prototype._onselectPage=function(e){var t=this;switch(e){case"next":t._moveToPage(t.pager.options.noPagesCount?t.pager.props.currentPage+1:Math.min(t.pager.props.totalPages,t.pager.props.currentPage+1));break;case"prev":t._moveToPage(Math.max(0,t.pager.props.currentPage-1));break;case"first":t._moveToPage(1);break;case"last":t._moveToPage(t.pager.props.totalPages);break;default:t._moveToPage(e)}},e.prototype.setColumns=function(e){var n=this;n.renderOptions.columns=e.map(function(e){var t=n._colByField(e.$bind);return t||(t=n._originalCols[e.$bind]),t?(t.options._expandItem&&(e.$bind=O.EXPANDED_FIELD_NAME),e.options=t.options):(t=n._originalColsMap[e.$bind])&&t.options&&(e.options=$.extend(!0,{},t.options)),e}),n.savePreferences(function(){n._refreshGrid()})},e.prototype.setProperty=function(e,t){if("bottom"===e){var n=this.renderOptions;void 0!==n.bottom&&(n.bottom=t,this._refreshGrid())}},e.prototype._setVisiblesColumns=function(e,t,n){var i=this,o=t&&t.length?{}:null;o&&t.forEach(function(e,t){(o[e.name]=e).index=t}),(e=e||i.renderOptions).columns.forEach(function(e,t){var n=e.$bind;if(e.index=t,T.isSelectField(n))return e.index=-2,void(e._isHidden=!1);e.options._expandItem&&e.options.display?n=e.options.display:e.options._expandItem&&(e.index=-1,e._isHidden=!1),o?o[n]?(e._isHidden=!1,e.index=o[n].index):e._isHidden=!0:e._isHidden=!1}),o&&e.columns.sort(function(e,t){return e.index-t.index}),!n&&i.savePreferences(function(){i._refreshGrid()})},e.prototype._getMultiselectdItems=function(e){var i=[],t=this.renderOptions,n=this.state.value;if(n){var o={};if(n.enumSelectedItems(t.expandingProperty,function(e,t){var n={data:e,level:t,hasParent:!1,children:null};i.push(n),o[e.$id]=n}),e&&t.expandingProperty){i.forEach(function(e){var t=e.data;if(t.parent&&o[t.parent.$id]){var n=o[t.parent.$id];n.children=n.children||[],n.children.push(e),e.hasParent=!0}}),i=[];var r=function(e){var t=e.children;delete e.children,i.push(e),t&&t.forEach(function(e){r(e)})};Object.keys(o).forEach(function(e){var t=o[e];if(t.hasParent)return!1;r(t)})}return i}},e.prototype._updateMultiselectSummary=function(e){var t=this,n=t.renderOptions;n.rowMove&&n.rowMove.multiselect&&n.selecting&&n.selecting.row&&n.selecting.multiselect&&(t._timeOutSelected&&window.clearTimeout(t._timeOutSelected),t._timeOutSelected=window.setTimeout(function(){var e=t._getMultiselectdItems(!0);e.length?t._openMultiselectSummary(e,!1,n.rowMove.title):t._closeMultiselectSummary(!0,!1)},100))},e.prototype._openMultiselectSummary=function(e,t,n){var i=F.find(this.$element.get(0),this.id+"_ms");return i?(e||(e=this._getMultiselectdItems(!0)),t&&S.isMultiselectMinimized(i)&&S.setMultiselectMinimized(!1,this.id,i),S.createMultiselectItems(this.id,i,this.renderOptions,e,this.form)):i=this._toggleMultiselectSummary(e,t,n),i},e.prototype._closeMultiselectSummary=function(e,t){var n=F.find(this.$element.get(0),this.id+"_ms");if(e)n&&this._toggleMultiselectSummary(null,!1,this.renderOptions.rowMove.title);else if(t&&n){var i=!S.isMultiselectMinimized(n);S.setMultiselectMinimized(i,this.id,n)}},e.prototype._toggleMultiselectSummary=function(e,t,n){var i=F.find(this.$element.get(0),this.id+"_ms");if(i)return F.remove(i),null;e||(e=this._getMultiselectdItems(!0)),i=S.multiselectContainer(this.id,t,n),S.createMultiselectItems(this.id,i,this.renderOptions,e,this.form);var o=F.find(this.$element.get(0),this.id+"_focus");return o&&F.append(o,i),i},e.prototype._state=function(){l.prototype._state.call(this);var e=this,t=e.fieldOptions;if(e.state.value&&(e.state.value.allowSelecting=e.renderOptions.selecting&&(e.renderOptions.selecting.row||e.renderOptions.selecting.cell),e.state.value.multiselect=e.renderOptions.selecting&&e.renderOptions.selecting.multiselect,e.state.value.expandingProperty=e.renderOptions.expandingProperty,e.state.value.isQueryable()||e.state.value.$states.pageSize)){var n=$.extend({size:"default",selectPage:e._onselectPage.bind(e),noPagesCount:e.state.value.noPagesCount()},t.pager||{});e.pager=new c.Pager(n);var i=e.pager;i.props.hasNext=e.state.value.hasNext(),i.props.hasPrev=e.state.value.hasPrev(),i.props.totalPages=e.state.value.totalPages(),i.props.currentPage=e.state.value.currentPage()}},e.prototype._destroyDetails=function(){if(this._details){var n=c.formManager();this._details.forEach(function(e){var t=n.formByName(e);t&&t.destroy()}),this._details=[]}},e.prototype._destroyDetailById=function(e){var t=this._details.indexOf(e);0<=t&&this._details.splice(t,1);var n=c.formManager().formByName(e);n&&n.destroy()},e.prototype._initCols=function(o){var r=this;r._mapCols={},r._mapColsSupp={},o.columns&&o.columns.length||(o.columns=[{$bind:"$index"}]),r.columns=[],r.frozenColumns=[];var e=o.columns.findIndex(function(e){return T.isSelectField(e.$bind)}),t=null,s=null;o.selecting&&o.selecting.row&&o.selecting.multiselect?e<0?(t={$bind:O.SELECTED_FIELD_NAME,options:{width:50,frozen:!0}},o.columns.splice(0,0,t)):t=o.columns[e]:0<=e&&o.columns.splice(e,1);var a=!!o.expandingProperty,l=o.scrolling&&o.scrolling.vertical||o.editing;o.columns.forEach(function(e,t){var n=$.extend({},e);if(n.options=n.options||{},n._isHiddenByBind=!1,a&&T.isExpandField(e.$bind)&&(s=e,n.schema=T.getSchema(e.$bind,r.$schemaItems,r.form.$rootSchema,!1),n.$bind=o.expandingProperty+e.$bind,n.options.icons={1:o.expanding&&o.expanding.plus?o.expanding.plus:"plus",2:o.expanding&&o.expanding.minus?o.expanding.minus:"minus"},n.options.align=n.options.align||"left",n.options.alignIcon=n.options.alignIcon||"left",r.options.design||(n.options._clickable=!0,n.options._expandItem=!0),o.expanding&&!r.options.design&&(o.expanding.style&&(n.options._expandItemClass=o.expanding.style),o.expanding.iconClass&&(n.options.iconClass=o.expanding.iconClass))),n.schema||(n.schema=T.getSchema(e.$bind,r.$schemaItems,r.form.$rootSchema,!1)),n.schema)if(n.options.$lookup&&(n.$lookup=r.form.getLookupForSchema(r.$bind+"."+n.$bind,n.options.$lookup)),r._mapCols[n.$bind])console.log("Duplicate column name  : "+e.$bind);else{if(n.title=d.tt(n.options.title||n.schema.title,r.form.$locale),n.options.display&&!r.options.design&&(n.options.displaySchema=T.getSchema(n.options.display,r.$schemaItems,r.form.$rootSchema,!1),!n.title&&n.options.displaySchema&&(n.title=d.tt(n.options.displaySchema.title,r.form.$locale))),T.isLink(e.$bind)&&(n.isLink=!0,n._isHidden=!1),n.options.bindVisibility){var i=r.form.getValue(n.options.bindVisibility);n._isHiddenByBind=i!==n.options.bindVisibilityValue}if(l&&!n.options.width&&(n.options.width=S.widthFromSchema(n.schema)),n.options.frozen&&o.allowFrozenColumns)return n.options.width?function(e){e=(e=(e||"")+"").trim();var t=parseInt(e,10);return t+""===e||t+"px"===e||t+" px"===e}(n.options.width)||(n.options.width=50):n.options.width=S.widthFromSchema(n.schema),n._isHidden||n._isHiddenByBind||r.frozenColumns.push(n),r._mapCols[n.$bind]={column:n,index:r.frozenColumns.length-1,tindex:t},r._checkBind(n.$bind),void(e===s&&n.options.display&&(r._mapCols[n.options.display]={column:n,index:r.frozenColumns.length-1,tindex:t},r._checkBind(n.options.display)));n._isHidden||n._isHiddenByBind||r.columns.push(n),r._mapCols[n.$bind]={column:n,index:r.columns.length-1,tindex:t},r._checkBind(n.$bind),e===s&&n.options.display&&(r._mapCols[n.options.display]={column:n,index:r.columns.length-1,tindex:t},r._checkBind(n.options.display))}else console.log("Field (bind) not found : "+e.$bind)})},e.prototype._checkBind=function(e){if(!(e.indexOf("[")<0)){for(var t=e.split("."),n=[],i=0;i<t.length;i++){var o=t[i],r=o.indexOf("["),s=o.substr(0,r);if(0<r){n.push(s),this._columnsListener.listen(n.join(".")),n.push("$item");var a=n.join(".");(this._mapColsSupp[a]=this._mapColsSupp[a]||{fields:[]}).fields.push({field:a,bind:e,condition:M.parseStringCondition(o.substring(r+1,o.length-1))})}else n.push(o)}var l=n.join(".");this._mapColsSupp[l]||(this._mapColsSupp[l]={fields:[]}),this._mapColsSupp[l].fields.push({field:l,bind:e})}},e.prototype._colsByField=function(e,t,o){var r=this,n=[],i=!0,s=r._colByField(e);if(s)n.push({col:s,exact:!0});else{var a=e.split("."),l=r._mapColsSupp[e];if(i=!1,!l){var u=a.lastIndexOf("$item");0<u&&(a=a.slice(0,u+1),l=r._mapColsSupp[a.join(".")])}if(l){var d=t;(o=(o=o)||{}).instancePath||(o.instancePath=t.fullPath);var c=[];l.fields.forEach(function(e){return c.push(e.bind)});for(var p=[],h=function(e){if(!d||d.isNull||d.isUndefined)return c=[],"break";var t=a[e];if(p.push(t),"$item"===t){var n=r._mapColsSupp[p.join(".")];if(!n)return c=[],"break";if(!(d=o[o.instancePath+"."+p.join(".")])||d.isNull||d.isUndefined)return e!==a.length-1&&(c=[]),"break";var i=[];if(n.fields.forEach(function(e){M.supportCondition(d,e.condition)&&i.push(e.bind)}),!(c=i).length)return"break"}else d=d[t]},f=0;f<a.length;f++){if("break"===h(f))break}c.forEach(function(e){var t=r._colByField(e);t&&n.push({col:t,exact:i})})}}return n},e.prototype._colByField=function(e){var t=this._mapCols[e],n=t?t.column:null;return n&&(n.field=e),n},e.prototype._columnsVisibilityChanged=function(e,t,n,i,o){if(this.$element)return!this._ignoreNotifications&&void this._refreshGrid()},e.prototype._totalChanged=function(e,t,n,i,o){var r=this;if(r.$element){if(r._ignoreNotifications)return!1;switch(i){case"propchange":if(e===r._totalProperty)r._renderTotalRows();else{var s=null,a="";if(r._totalIsArray){var l=T.parsePath(r._totalProperty,e,"");s=o[l],a=e.substr(l.length+1)}else s=o.instance,a=e.split(".").pop();s&&r._modifyFooterCell(s,a)}break;case"add":case"remove":e===r._totalProperty&&r._renderTotalRows()}}},e.prototype.changed=function(e,t,n,i,o){var r=this;if(r.$element){if(r._ignoreNotifications)return!1;if(!(0<=e.substr(r.$bind.length).indexOf(".$selected"))){var s=r.renderOptions,a=s.hideWhenNoRows,l=r.selectedCell,u=null;o.checkChildren&&"propchange"===i&&e===r.$bind&&(a=!0,r.state.value=r.form.getValue(r.$bind),r.state.value&&(r.state.value.allowSelecting=s.selecting&&(s.selecting.row||s.selecting.cell),r.state.value.multiselect=s.selecting&&s.selecting.multiselect,r.state.value.expandingProperty=s.expandingProperty));var d=!1,c=!1,p=!1;if(r._bindVisibility&&0<=r._bindVisibility.indexOf(e))r._columnsVisibilityChanged(e,t,n,i,o);else{if(r._totalProperty){if(0===e.indexOf(r._totalProperty))return void r._totalChanged(e,t,n,i,o);o.checkChildren&&"propchange"===i&&e===r._totalProperty&&r._totalChanged(r._totalProperty,t,n,i,o)}switch(r.state.value||(i="none"),i){case"count":break;case"pagination":var h=r.pager;h&&(h.props.totalPages=r.state.value.totalPages(),h.props.currentPage=r.state.value.currentPage(),h.props.hasNext=r.state.value.hasNext(),h.props.hasPrev=r.state.value.hasPrev());break;case"sorting":r._updateSorting();break;case"propchange":if(e===r.$bind)o.sorting?(r._renderRows(!0,"",null,!1),l&&r._selectCell(l,null,!1,!1)):(r._renderRows(!0,"",null,!1),p=!0),a=c=!0;else{var f=e,m=T.parsePath(r.$bind,f,s.expandingProperty),v=o[m];if(v){var g=e.substr(m.length+1);if(!g)return;if(r._modifyCell(v,g,null,null,o),T.isSelectField(g)){if(s.noRowSelectedIndicator||S.setRowsSelected(v.$id,v.$select,r.fieldOptions,r.$element.get(0)),v.$select&&s.selecting&&s.selecting.cell)if(!r.selectedCell||r.selectedCell.row!==v.$id)r._findById(v.$id)&&r._selectFirstCellEditable("model",v.$id,null),p=!1;r._updateMultiselectSummary(!1)}else if(0<g.indexOf(O.EXPANDED_FIELD_NAME)&&s.expandingProperty){if(!(C=M.getValue(v,s.expandingProperty)))return;var y=C.$expand,_=r._ignoreNotifications;r._ignoreNotifications=!0;try{var $=[],b=r._viewMap[v.$id];if(v.enumVisibleChildren(s.expandingProperty,b.level,!0,function(e,t){var n={level:t,value:e};$.push(n)}),!$.length)return;y?r._addRows(v,$):r._removeRows(v,$)}finally{r._ignoreNotifications=_}}}}break;case"add":if(r._createRow(o.$value),r.renderOptions.expandingProperty)if(2===(y=o.$value[r.renderOptions.expandingProperty+w.Observable.EXPANDED_FIELD_NAME])){var x=o.$value[r.renderOptions.expandingProperty];x&&x.forEach(function(e,t,n){r._createRow(e)},r.renderOptions.expandingProperty)}o.$value.$select&&(u=o.$value.$id,p=!0),a=d=c=!0;break;case"remove":if(s.expandingProperty){var C;if(r._removeRow(o.$id),o.$value)(C=o.$value[s.expandingProperty])&&C._enumChildren(s.expandingProperty,function(e){r._removeRow(e.$id)});d=!0}else r._removeRow(o.$id),d=!0;a=!0}if(a)r._isHidden()!==F.hasClass(r.$element.get(0),"bs-none")&&(r.setHidden(r.$element.get(0)),c=!0);if(d&&r._updOddEvenLater(),c&&r.resize(),p){var k=null;!u&&l&&(u=l.row,k=l.col),u&&!r._findById(u)&&(k=u=null),r._selectFirstCellEditable("model",u,k)}}}}},e.prototype._modifyStateTD=function(e,t,n,i,o){var r=this.renderOptions,s=e.getState(i.field),a=i.options||{},l=(r.editing&&!r.editingDisabled||T.isSelectField(i.field))&&!s.isDisabled&&!s.isReadOnly&&!s.isHidden&&!1!==a.editing&&!1!==a.selecting;l&&"object"==typeof r.editing&&(r.editing.readOnlyRow&&(l=!e.getValue(r.editing.readOnlyRow)),l&&r.editing.onlyIsLeaf&&(l=e[r.expandingProperty]&&!e[r.expandingProperty].isEmpty())),s.isHidden?F.empty(o):"isHidden"===n&&this._modifyTD(e,i.field,o),r.editing&&(l?F.removeClass(o,"bs-td-readonly"):F.addClass(o,"bs-td-readonly"))},e.prototype._modifyTD=function(e,t,n){var i=this.renderOptions,o=this._colByField(t);if(o){var r=e.getState(t),s=o.options||{},a=(i.editing&&!i.editingDisabled||T.isSelectField(t))&&!r.isDisabled&&!r.isReadOnly&&!r.isHidden;if(F.empty(n),!r.isHidden){var l=null,u=this._viewMap[e.$id],d=u&&u.level||0;s.display&&s.displaySchema&&(l=f.utils.displayValue(e.getValue(s.display),s.displaySchema,this.form.$locale,{html:!0,tableOptions:i,avanced:s.displayOptions||{},state:e.getState(s.display),form:this.form},e,s.display));var c=f.utils.displayValue(e.getValue(t),o.schema,this.form.$locale,{html:!0,useSymbol:!1,editable:a,selectable:!r.isDisabled,check:i.editing,avanced:s,tableOptions:i,display:l,level:d,state:r,form:this.form},e,t);if(c.html){var p=$(c.value);F.append(n,p.get(0))}else{var h=c.value;""===h&&(h=String.fromCharCode(160)),F.append(n,document.createTextNode(h))}}}},e.prototype._findTR=function(e,t){var n=this.renderOptions,i=e+(t.options.frozen&&n.allowFrozenColumns?"_frozen":"");return F.find(this.$element.get(0),i)},e.prototype._id2rowId=function(e){var t=e.indexOf("_frozen");return 0<t&&(e=e.substring(0,t)),e},e.prototype._findtBody=function(e){var t=this.renderOptions,n=this.id+(e.options.frozen&&t.allowFrozenColumns?"_frozen_rows":"_rows");return F.find(this.$element.get(0),n)},e.prototype._modifyFooterCell=function(e,t){this.$element&&this._findCellAndModify(e,t,null,{instancePath:this.$bind})},e.prototype._findCellAndModify=function(a,l,u,e){var d=this;d._colsByField(l,a,e).forEach(function(e){var t=e.col,n=d._findTR(a.$id,t);if(n)for(var i=F.queryAll(n,'td[colid="'+t.field+'"]'),o=0,r=i.length;o<r;o++){var s=i.item(o);if(u){!0===a.$states[l][u]&&0<=["isDisabled","isHidden","isReadOnly"].indexOf(u)&&d.inplace&&d.inplace.input&&d.inplace.td===s&&d._inplaceEditRemove(!1,!1,!0),d._modifyStateTD(a,l,u,t,s)}else{if(d.inplace&&d.inplace.input&&d.inplace.td===s)return void d._inplaceEditModel2Control(a,l,s,d.form);d._modifyTD(a,t.field,s),e.exact||d._modifyStateTD(a,l,"",t,s)}}})},e.prototype._showErrors=function(e,t,n,i){},e.prototype._modifyCell=function(e,t,n,i,o){if(this.$element)if(o&&!i)this._findCellAndModify(e,t,n,o);else{if(i)return this.inplace&&this.inplace.input&&this.inplace.td===i?void this._inplaceEditModel2Control(e,t,i,this.form):this._modifyTD(e,t,i);this._findCellAndModify(e,t,n,o)}},e.prototype._rootElement=function(){return this.$element?this.$element.get(0):null},e.prototype._gridParentFocus=function(){return this.$element?F.find(this.$element.get(0),this.id+"_focus"):null},e.prototype._setErrors=function(e,t){var n=this.state.errors;if(t&&w.bootstrap4){var i="is-invalid";n&&n.length?F.addClass(t,i):F.removeClass(t,i)}this.showErrors(t,n)},e.prototype._setTableFocus=function(e){var t=F.find(this.$element.get(0),this.id+"_table");t&&(e?F.addClass(t,"focused"):F.removeClass(t,"focused")),(t=F.find(this.$element.get(0),this.id+"_table_frozen"))&&(e?F.addClass(t,"focused"):F.removeClass(t,"focused"))},e.prototype.focusIn=function(e){var t=this;if(t.$element)if(t._setTableFocus(!0),t.selectedCell){var n=t._cell(t.selectedCell,!0);if(n||(t.selectedCell=null,t._selectFirstCell("focusin",null,!1,null),t.selectedCell&&(n=t._cell(t.selectedCell,!0))),!n)return;t.canEdit(t.selectedCell)&&!t.inplace&&t._inpaceEditShow(n.td,!0)}else t._inplaceEditRemove(!1,!1,!1)},e.prototype.focusOut=function(e){this.$element&&(this._setTableFocus(!1),this._inplaceEditRemove(!0,!1,!1))},e.prototype._doTab=function(e){return e?this._moveRightSelectedCell(!0):this._moveLeftSelectedCell(!0)},e.prototype.keypress=function(e){var t=this,n=this._gridParentFocus();if(F.isChildOf(n,e.target)&&t.selectedCell&&t.inplace&&F.isChildOf(t.inplace.td,e.target)){var i=t._td2value(t.inplace.td);if(T.isNumber(t.inplace.schema)&&!t.inplace.schema.enum){var o=t.inplace.decimals;if(T.isMoney(t.inplace.schema)&&1!==t.form.moneyUnitCoef&&(o=0),!1===f.utils.keyPressNumber(e,t.inplace.input,{decimalSep:h.number.decimal,thousandSep:h.number.thousand,places:o,schema:t.inplace.schema}))return!1}else if(T.isDate(t.inplace.schema)&&!t.inplace.schema.enum){if(!1===f.utils.keyPressDate(e,t.inplace.input,{sep:h.date.daySep,format:h.date.dateShort,schema:t.inplace.schema}))return!1}else if(T.isBoolean(t.inplace.schema)){if(" "===String.fromCharCode(e.which)&&t.renderOptions.editing&&!t.renderOptions.editingDisabled){var r=i.item.getRelativeState(i.col.$bind);if(!r.isDisabled&&!r.isReadOnly){var s=i.item.getValue(i.col.$bind);i.item.setValue(i.col.$bind,!s)}}e.preventDefault()}}},e.prototype.keydown=function(e){var t=this,n=e.which||e.keyCode,i=this._gridParentFocus();if(F.isChildOf(i,e.target)){var o=!1;if(t.inplace&&F.isChildOf(t.inplace.td,e.target)){if(!t._inplaceEditAcceptKeys(n))return;if(t.inplace.combo&&(n===F.keys.VK_F4||n===F.keys.VK_DOWN&&e.ctrlKey))t._toggleGridLookup();else if(T.isNumber(t.inplace.schema)&&!t.inplace.schema.enum){var r=t.inplace.decimals;if(T.isMoney(t.inplace.schema)&&1!==t.form.moneyUnitCoef&&(r=0),!1===f.utils.keyDownNumber(e,t.inplace.input,{decimalSep:h.number.decimal,thousandSep:h.number.thousand,places:r,schema:t.inplace.schema}))return}else if(T.isDate(t.inplace.schema)&&!t.inplace.schema.enum&&!1===f.utils.keyDownDate(e,t.inplace.input,{sep:h.date.daySep,format:h.date.dateShort,schema:t.inplace.schema}))return}if(s=e,n===F.keys.VK_TAB&&s.shiftKey||!(s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)){var s;if(t.fieldOptions.selecting&&t.fieldOptions.selecting.cell)switch(n){case F.keys.VK_TAB:case F.keys.VK_ENTER:o=t._doTab(!e.shiftKey);break;case F.keys.VK_UP:o=t._moveUpSelectedCell(1);break;case F.keys.VK_DOWN:o=t._moveDownSelectedCell(1)}o&&e.preventDefault()&&e.stopPropagation()}}},e.prototype._toggleGridLookup=function(){this.inplace&&this.inplace.combo&&(this.inplace.combo.opened?s.gridlookup.closeGridLookup(this.inplace,this._eventBus,"combo"):this._openGridLookup())},e.prototype._createGridPopup=function(){this._eventBus||(this._eventBus=new w.serial.SingleEventBus(50));var e=this.inplace.input,t=this.$element.get(0);this.inplace.combo=s.gridlookup.checkGridPopup(this,this.inplace.col.$lookup,e,t)},e.prototype._searchText=function(){if(this.inplace&&this.inplace.combo){var e=this.inplace.col,t=this._td2cell(this.inplace.td);if(t){var n=this._findById(t.row);if(n){var i=n.getValue(e.$bind,null)||"",o=this.inplace.input.value||"";if(o!==i)return o}}}return""},e.prototype._getSource=function(e,t){t.$bind=e.col.$bind,t.fieldName=e.col.$lookup.mapping[e.col.$bind],t.paginated=!0,t.containerId=this.form.syncTransactionId(),t.viewId=this.form.syncViewId(),t.selected=e.item.pkId();var n=this.form.$model;return e.col.$lookup.data&&"relation"===e.col.$lookup.data.$type&&"."===e.col.$lookup.data.$params.relation.charAt(0)&&(n=e.item),T.executeLookup(e.col.$lookup,n,t)},e.prototype._findValue=function(e,t,n){var i=this;if(e||""!==e){var o={search:e,select:!1,findFirst:!0,find:!1,paginated:i.renderOptions.paginated};i._eventBus.push(i._getSource(t,o),function(e){(e=i._filterResult(e,o,t.col.$lookup,t.col.$bind,t.item))&&e.value&&e.value.length?n(e.value[0]):n(null)},!0)}else i._eventBus.push(null,function(e){return n(null)},!0)},e.prototype.notifyGlobalChanged=function(e){"money-unit"===e&&this._unitChanged()},e.prototype._unitChanged=function(){var i=this;if(i.$element){var e=i.frozenColumns.concat(i.columns),o=[];if(e.forEach(function(e){T.isMoney(e.schema)&&o.push(e)}),o.length){if(i.state.value)i.state.value.forEach(function(t,e,n){o.forEach(function(e){i._modifyCell(t,e.$bind,null,null,null)})},i.renderOptions.expandingProperty);if(i._totalProperty){var t=i.form.getValue(i._totalProperty);t&&!i._totalIsArray&&(t=[t]),t&&t.forEach(function(t){o.forEach(function(e){i._modifyFooterCell(t,e.$bind)})})}}}},e.prototype._filterResult=function(e,t,n,i,o){if(n=s.gridlookup.checkGridLookup(n,this.form.$model,o,null,""),e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(n.data&&n.data.$params&&(n.data.$params.$allData||"relation"===n.data.$type)){var r=T.findFirst(t.search,T.remoteSearch(T.lastSegment(i,i),n),e.documents);return r?{value:[r.item]}:null}e.value=e.documents,delete e.documents}return e},e.prototype._setRemoteValue=function(i,o,r){var e=Object.keys(i.$lookup.mapping),s=T.extractBase(i.$bind),a=[],l=!1;if(e.forEach(function(e){if(i.$lookup.mapping[e]){var t=o.getValue(s+e,null)||"",n=r&&r[i.$lookup.mapping[e]]||"";""===n&&("number"==typeof t?n=0:"boolean"==typeof t&&(n=!1)),n!==t&&(o.setValue(s+e,n,null),l=!0)}else a.push(e)}),l&&a.forEach(function(e){o.setValue(s+e,i.$lookup.mapping[e])}),i.$lookup.customMapping){var t=n.get("lookup.mappings."+i.$lookup.customMapping);if(t)s&&(s=s.substr(0,s.length-1)),t(o.getValue(s),r)}},e.prototype._onselectItem=function(e){var t=this;if(t.inplace&&t.inplace.combo){var n=t.inplace.col,i=t._td2cell(t.inplace.td);if(i){var o=t._findById(i.row);o&&t._eventBus.push(e,function(e){t._setRemoteValue(n,o,e)},!0)}}},e.prototype._openGridLookup=function(){var e=this;if(!e.inplace.combo.opened){var t=e._td2cell(e.inplace.td),n=void 0,i=void 0;t&&(i=e._findById(t.row))&&(n=i.pkId());var o=null,r=s.gridlookup.checkGridLookup(e.inplace.col.$lookup,e.form.$model,i,null,null);"relation"===r.data.$type&&"."===r.data.$params.relation.charAt(0)&&(o=i),e.inplace.$bind=e.inplace.col.$bind,s.gridlookup.openGridLookup(e.inplace,{lookup:r,parentControl:e,formControl:e.form,display:e.inplace.col.$bind,bind:e.inplace.col.$bind,containerId:e.form.syncTransactionId(),viewId:e.form.syncViewId(),selected:n,align:e.inplace.id,openerId:e.inplace.id+"_after",searchText:e._searchText(),onselect:e._onselectItemHandler,lookupColumns:e.inplace.col.options.lookupColumns?e.inplace.col.options.lookupColumns:void 0,propertyName:"combo",minWidth:e.inplace.col.options.lookupMinWidth||0,itemModel:o})}},e.prototype.checkFocus=function(e){var t=this;M.nextTick(function(){var e=window.document.activeElement;e&&t.targetInControl(e)||(t.focusOut(null),t.focused=!1)})},e.prototype.focusInControl=function(e){var t=this._gridParentFocus(),n=F.isChildOf(t,e);if(!n&&this.inplace){if(this.inplace.combo&&this.inplace.combo.opened)return this.inplace.combo.focusInCombo(e);if(this.inplace&&T.isDate(this.inplace.schema)&&f.utils.useDatePicker())return f.utils.elementInDatePicker(e,$(this.inplace.input.parentNode.parentNode))}return n},e.prototype._tr2rowId=function(e,t){var n=e.id;if(t&&t.options.frozen){var i=n.indexOf("_frozen");0<i&&(n=n.substring(0,i))}return n},e.prototype._td2cell=function(e){var t=e.parentNode,n=(t.parentNode,this._colByField(F.attr(e,"colid")));if(!n)return null;var i=this._tr2rowId(t,n);return this._findById(i)&&n?{row:i,col:F.attr(e,"colid")}:null},e.prototype._td2value=function(e){var t=e.parentNode,n=(t.parentNode,this._colByField(F.attr(e,"colid"))),i=this._tr2rowId(t,n);return{item:this._findById(i),col:n}},e.prototype.mousedown=function(e){var t=this._gridParentFocus();if(!F.isChildOf(t,e.target))return!0;var n=F.parentByTag(this.$element.get(0),e.target,"td");if(n){var i=this.renderOptions,o=this._td2cell(n);if(o){var r=this.form.focusedControl();r&&r!==this&&r.focusOut&&(r.focusOut(null),r.focused=!1),this._selectCell(o,e,!0,!1)?e.preventDefault():i.selecting&&!i.selecting.multiselect&&this._selectRow(o.row)}}return!0},e.prototype._addRows=function(e,t){this._renderRows(!1,e.$id,t,!1),this._updOddEvenLater()},e.prototype._removeRows=function(e,t){var n=this;t.forEach(function(e){n._removeRow(e.value.$id)}),n._updOddEvenLater()},e.prototype.dblclick=function(e){var t=this.renderOptions;if(t.doubleClick){var n=F.parentByTag(this.$element.get(0),e.target,"td");if(n){var i=this._td2cell(n);if(i){var o=this._findById(i.row);this.form.execAction(this.$bind+".$links."+t.doubleClick,o)}}}},e.prototype.click=function(e){var o=this;if(o.state.value){var r=o.renderOptions,t=F.parentByTag(o.$element.get(0),e.target,"td");if(t){var n=o._td2cell(t);if(n){var i=o._findById(n.row),s=o._colByField(n.col);if(i){var a=e&&e.target&&e.target.$link||e.target.parentNode.$link;if(a){var l=i.getRelativeState(s.$bind);if(l.isDisabled||l.isHidden)return;s.schema.$widgetAction?o[s.schema.$widgetAction]&&o[s.schema.$widgetAction](i):o.form.execAction(o.$bind+".$item."+a,i)}else if(s){if(o.inplace&&o.inplace.input&&o.inplace.td===t)return void(o.inplace.combo&&(e.target.id!==o.inplace.id+"_after"&&e.target.parentNode.id!==o.inplace.id+"_after"||o._toggleGridLookup()));if(s.options._expandItem)if(F.attr(e.target,"data-clickable")||F.attr(e.target.parentNode,"data-clickable"))(c=i.getRelativeState(s.$bind)).isDisabled||c.isReadOnly||i.toggleExpand(r.expandingProperty);if(s.options.$link){if(F.findByAttribute(e.target,t,"data-phoenix-href"))if(!(c=i.getRelativeState(s.$bind)).isDisabled)if(s.options.$link.action)o.form.execAction(o.$bind+".$links."+s.options.$link.action,i);else{var u=M.copy(s.options.$link);u.$form=o.form,L.execLink(u,{$item:i},null)}}else if(s.options.actionName){(c=i.getRelativeState("$links."+s.options.actionName))&&!c.isDisabled&&o.form.execAction(o.$bind+".$item.$links."+s.options.actionName,i)}else if(T.isSelectField(s.$bind)||r.editing&&!r.editingDisabled&&T.isBoolean(s.schema)){if(F.attr(e.target,"data-clickable"))if(!(c=i.getRelativeState(s.$bind)).isDisabled&&!c.isReadOnly&&!c.isHidden){var d=i.getValue(s.$bind);if(T.isSelectField(s.$bind)){(O=i.parentArray).selecting(!0,r.expandingProperty);try{i.select(!d,r.selecting&&r.selecting.row&&r.selecting.multiselect,o.state.value,r.expandingProperty,r.expanding&&r.expanding.selectChildren)}finally{O.selecting(!1,r.expandingProperty)}}else i.setValue(s.$bind,!d)}}else if(r.selecting&&r.selecting.row&&!r.selecting.multiselect&&r.selecting.action){var c;(c=i.getRelativeState("$links."+r.selecting.action))&&!c.isDisabled&&o.form.execAction(o.$bind+".$item.$links."+r.selecting.action,i)}}}}else if(o._totalProperty&&o.fieldOptions.total.action&&t.parentElement.id){var p=F.find(o.$element.get(0),o.id+"_frozen_totals"),h=F.find(o.$element.get(0),o.id+"_totals");if(p&&F.isChildOf(p,e.target)||h&&F.isChildOf(h,e.target)){var f=t.parentElement.id,m=o.form.getValue(o._totalProperty);o._totalIsArray||(m=m?[m]:[]);var v=null;m.forEach(function(e){v||e.$id!==f||(v=e)}),v&&o.form.execAction(o.fieldOptions.total.action,{id:v.id})}}}else{var g=F.parentByTag(o.$element.get(0),e.target,"th");if(g){var y=F.attr(g,"colid");if(y){var _=o._colByField(y),$=_.options.display?_.options.displaySchema:_.schema;if(!$||!_)return;if(T.isSelectField(_.$bind)&&r.selecting&&r.selecting.row&&r.selecting.multiselect&&r.selecting.selectAll){var b=F.parentByTag(o.$element.get(0),e.target,"center");if(b){var x=F.query(b,".bs-bool-edit");if(x){var C=F.iconClass("check-square-o",!0),k=F.iconClass("square-o",!0),w=F.hasClass(x,C);w?(F.removeClass(x,C),F.addClass(x,k)):(F.removeClass(x,k),F.addClass(x,C));var O=o.state.value,S=[];try{if(w)o._getMultiselectdItems(!1).forEach(function(e){var t=e.data,n=t.parentArray;S.indexOf(n)<0&&(S.push(n),n.selecting(!0,r.expandingProperty)),t.select(!1,r.selecting&&r.selecting.row&&r.selecting.multiselect,o.state.value,r.expandingProperty,!1)});else O.forEach(function(e,t,n){var i=e.parentArray;S.indexOf(i)<0&&(S.push(i),i.selecting(!0,r.expandingProperty)),e.select(!0,r.selecting&&r.selecting.row&&r.selecting.multiselect,o.state.value,r.expandingProperty,!1)},r.expandingProperty,!0)}finally{S.forEach(function(e){e.selecting(!1,r.expandingProperty)})}}}}else if(r.sorting&&T.canSort($)){var E=$.orderBy?$.orderBy:_.options.display?_.options.display:_.$bind,P=E;if(o.state.value.$orderby()===E)P=E.split(",").map(function(e){var t=(e=e.trim()).split(" ");return 1===t.length?t.push("desc"):t[1]="desc"===t[1]?"asc":"desc",t.join(" ")}).join(",");o.state.value.isQueryable()?o.state.value.$orderby(P):o.state.value&&o.form.execAction(o.state.value.getJSONPatchPath()+".$sort",P)}}}else if(e.target.id===o.id+"_close_ms")o._closeMultiselectSummary(!1,!0);else{var I=F.parentByAttr(o.$element.get(0),e.target,"data-ms-unselect");if(I){var D=F.attr(I,"data-ms-unselect");if(i=r.expandingProperty?o.state.value.findByIdEx(D,r.expandingProperty):o._findById(D)){(O=i.parentArray).selecting(!0,r.expandingProperty);try{i.select(!1,r.selecting&&r.selecting.row&&r.selecting.multiselect,o.state.value,r.expandingProperty,r.expanding&&r.expanding.selectChildren)}finally{O.selecting(!1,r.expandingProperty)}}}}}}},e.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled},e.prototype._showSelected=function(e,t,n,i){if(!e)return null;var o=this._cell(e,!1);o&&o.td&&(t?(F.addClass(o.td,"bs-cell-selected"),this._inplaceEditRemove(!1,!1,!1),n&&(this.focused||i)?this._inpaceEditShow(o.td,!1):(o.td.tabIndex=0,(this.focused||i)&&o.td.focus()),this._onFrozenFocusScroll(o.td,this._colByField(e.col))):(F.removeClass(o.td,"bs-cell-selected"),o.td.tabIndex=-1))},e.prototype.canSelect=function(e,t){var n=null,i=this.selectedCell;if(i&&i.col===e.col&&i.row===e.row)return!1;if(!this.fieldOptions.selecting||!this.fieldOptions.selecting.cell)return!1;var o=this._colByField(e.col);if(o){if(!t)return!0;if(o.options&&!1===o.options.selecting)return!1;if(n=n||this._findById(e.row)){var r=n.getState(o.$bind);return!r.isDisabled&&!r.isHidden}}return!1},e.prototype.canEdit=function(e){var t=this,n=null;if(!t.fieldOptions.editing||!t.fieldOptions.selecting||!t.fieldOptions.selecting.cell||t.renderOptions.editingDisabled)return!1;if("object"==typeof t.fieldOptions.editing&&t.fieldOptions.editing.readOnlyRow&&(!(n=t._findById(e.row))||n.getValue(t.fieldOptions.editing.readOnlyRow)))return!1;if(t.fieldOptions.expandingProperty&&"object"==typeof t.fieldOptions.editing&&t.fieldOptions.editing.onlyIsLeaf&&(!n[t.fieldOptions.expandingProperty]||n[t.fieldOptions.expandingProperty].isEmpty()))return!1;var i=t._colByField(e.col);if(i.options&&!1===i.options.editing)return!1;if(i.isLink)return!1;if(i.options._expandItem)return!1;var o=(n=n||t._findById(e.row)).getState(i.$bind);return!o.isReadOnly&&!o.isDisabled&&!o.isHidden},e.prototype._selectRow=function(e){var t=this.renderOptions;if(this.state.value){var n=t.selecting&&t.selecting.row&&t.selecting.multiselect,i=this._findById(e);if(i){var o=i.parentArray;o.selecting(!0,t.expandingProperty);try{i.select(!0,n,this.state.value,t.expandingProperty)}finally{o.selecting(!1,t.expandingProperty)}}}},e.prototype._selectCell=function(e,t,n,i){var o=this;if(!o.canSelect(e,i)){if(n){var r=o.selectedCell;return(!r||r.row!==e.row)&&o._selectFirstCell("mouseDown",e.row,i,null)}return!1}var s=o.selectedCell,a=o.canEdit(e);o.selectedCell=e,o._showSelected(e,!0,a,n),s?o._showSelected(s,!1,!0,n):o._gridParentFocus().tabIndex=-1;var l=o.renderOptions;return l.selecting&&!l.selecting.multiselect&&o._selectRow(e.row),!0},e.prototype._selectFirstCellEditable=function(e,t,n){this._selectFirstCell(e,t,!0,n)||this._selectFirstCell(e,t,!1,n)},e.prototype._selectFirstCell=function(e,t,n,i){var o=this,r=o.fieldOptions;if(!r.selecting||!r.selecting.cell)return!1;var s=F.find(o.$element.get(0),o.id+"_rows");if(!s.childNodes.length)return!1;var a=null,l=o.frozenColumns.concat(o.columns),u=0;i&&(0<=(u=l.indexOf(i))?n&&(n=!1):u=0);for(var d=l.length;u<d;u++){var c=l[u],p=void 0;if(t)p=t;else{if(r.selecting&&r.selecting.row&&!r.selecting.multiselect){var h=o._getMultiselectdItems(!1);h&&h.length&&(p=h[0].data.$id)}if(!p){r.allowFrozenColumns&&c.options.frozen&&(s=F.find(o.$element.get(0),o.id+"_frozen_rows"));var f=s.firstChild;p=o._tr2rowId(f,c)}}if(a={col:c.$bind,row:p},o.canSelect(a,n))break;a=null}return!!a&&o._selectCell(a,null,!1,n)},e.prototype._cell=function(e,t){var n=this._mapCols[e.col],i=n.index,o=this._findTR(e.row,n.column);if(!o)return null;var r={td:o.childNodes[i],tr:o,rIndex:-1,cIndex:-1};return t&&(r.rIndex=F.indexOf(o.parentNode,o),r.cIndex=i),r},e.prototype._moveUpSelectedCell=function(e){var t=this;if(!t.selectedCell)return t._selectFirstCell("keydown",null,!1,null);var n=t._colByField(t.selectedCell.col),i=t._cell(t.selectedCell,!0);if(!i)return t.selectedCell=null,t._selectFirstCell("keydown",null,!1,null);var o=Math.max(i.rIndex-e,0);if(o==i.rIndex)return!1;var r=t._findtBody(n).childNodes[o];return t._selectCell({row:t._id2rowId(r.id),col:t.selectedCell.col},null,!1,!1)},e.prototype.resize=function(){var e=this;e.form.execLater({id:e.id+"_resize",hnd:function(){e._resize()}})},e.prototype._updateFrozenColumnsHeight=function(){var e=this.renderOptions;if(this._scrollableFrozenContent){if(!(e.height&&"auto"!==e.height||e.minHeight))return;var t=void 0;t=this._scrollableMaster.scrollWidth>this._scrollableMaster.clientWidth?F.scrollbar()+"px":"0px",this._deltaHScrollContent.style.height!==t&&(this._deltaHScrollContent.style.height=t,this._vscroll())}},e.prototype._resize=function(){var e=this,t=e.renderOptions;if(t.scrolling&&t.scrolling.vertical&&(e.$element||console.log("Invalid resize call"),e._scrollableMaster)){F.position(e._scrollableMaster,null);if(t.bottom){var n=F.documentViewSize();if(e._scrollableMaster){var i=F.position(e._scrollableMaster,null),o=(e.$element.get(0),Math.max(0,n.height-i.top-t.bottom));e._scrollableMaster.style.height=o+"px",e._scrollableFrozenContent&&(e._scrollableFrozenContent.style.height=o+"px")}}if(S.hasFrozenColumns(t,e.frozenColumns))F.scrollbar()&&e._updateFrozenColumnsHeight(),e._vscroll()}},e.prototype.syncHeaderAndFrozenScroll=function(e){this._scroller&&"master"!==this._scroller||(this._scroller="master",this._hscroll(),this._vscroll(),this._removeScroller())},e.prototype.syncMasterScroll=function(e){this._scroller&&"frozen"!==this._scroller||(this._scroller="frozen",this._vsmcroll(),this._removeScroller())},e.prototype._removeScroller=function(){var e=this;e.fieldOptions.editing?(e._rsTimer&&window.clearTimeout(e._rsTimer),e._rsTimer=window.setTimeout(function(){e._scroller=null,e._rsTimer=null},50)):e._scroller=null},e.prototype._vscroll=function(){if(this._scrollableFrozenContent){var e=this._scrollableMaster.scrollTop;e!==this._scrollableFrozenContent.scrollTop&&(this._scrollableFrozenContent.scrollTop=e)}},e.prototype._vsmcroll=function(){var e=this._scrollableMaster.scrollTop,t=this._scrollableFrozenContent.scrollTop;e!==t&&(this._scrollableMaster.scrollTop=t)},e.prototype._hscroll=function(){var e=this._scrollableMaster.scrollLeft;(e!==this._scrollableHeaderOfMaster.scrollLeft&&(this._scrollableHeaderOfMaster.scrollLeft=e),this._scrollableFooterOfMaster)&&(e!==this._scrollableFooterOfMaster.scrollLeft&&(this._scrollableFooterOfMaster.scrollLeft=e))},e.prototype._moveDownSelectedCell=function(e){var t=this;if(!t.selectedCell)return t._selectFirstCell("keydown",null,!1,null);var n=t._cell(t.selectedCell,!0);if(!n)return t.selectedCell=null,t._selectFirstCell("keydown",null,!1,null);var i=t._colByField(t.selectedCell.col),o=t._findtBody(i),r=Math.min(n.rIndex+e,o.childNodes.length-1);if(r==n.rIndex)return!1;var s=o.childNodes[r];return t._selectCell({row:t._id2rowId(s.id),col:t.selectedCell.col},null,!1,!1)},e.prototype._moveRightSelectedCell=function(e){var t=this;if(!t.fieldOptions.selecting||!t.fieldOptions.selecting.cell)return!1;if(!t.selectedCell)return t._selectFirstCell("keydown",null,e,null);var n=t.frozenColumns.concat(t.columns).map(function(e){return e.$bind}),i=n.indexOf(t.selectedCell.col),o=t._findById(t.selectedCell.row);if(!o||i<0)return!1;for(var r=i+1,s=n.length;r<s;r++){var a={col:n[r],row:o.$id};if(t.canSelect(a,e))return t._selectCell(a,null,!1,e)}if(o=t._findNext(o.$id))for(r=0,s=i;r<=s;r++){a={col:n[r],row:o.$id};if(!e||t.canSelect(a,e))return t._selectCell(a,null,!1,e)}return!1},e.prototype._moveLeftSelectedCell=function(e){var t=this;if(!t.fieldOptions.selecting||!t.fieldOptions.selecting.cell)return!1;if(!t.selectedCell)return t._selectFirstCell("keydown",null,e,null);var n=t.frozenColumns.concat(t.columns).map(function(e){return e.$bind}),i=n.indexOf(t.selectedCell.col),o=t._findById(t.selectedCell.row);if(!o||i<0)return!1;for(var r=i-1;0<=r;r--){var s={col:n[r],row:o.$id};if(t.canSelect(s,e))return t._selectCell(s,null,!1,e)}if(o=t._findPrev(o.$id))for(r=n.length-1;i<=r;r--){s={col:n[r],row:o.$id};if(t.canSelect(s,e))return t._selectCell(s,null,!1,e)}return!1},e.prototype._state2UI=function(e){var t=this,n=t._rootElement(),i=t.$element?t.$element.get(0):null;if(n&&(t._setDisabled(n,i),t.setHidden(i),t._setErrors(n,i),e||t._selectFirstCell("model",null,!1,null),t.pager)){var o=$(F.find(i,t.id+"_pagination"));t.pager.render(o)}},e.prototype.afterAddedInDom=function(){this._selectFirstCell("model",null,!0,null)},e.prototype._isHidden=function(){return this.state.isHidden||!this.state.value||this.renderOptions.hideWhenNoRows&&!this.state.value.length},e.prototype.setHidden=function(e){if(e){this._isHidden()?F.addClass(e,"bs-none"):F.removeClass(e,"bs-none")}},e.prototype.stateChanged=function(e,t,n){var i=this;if(i.$element){if(i._ignoreNotifications)return!1;var o=t.origProperty.substr(i.$bind.length);if(!(0<=o.indexOf(".$selected"))&&0!==o.indexOf(".$links")){var r=i.form.getState(i.$bind),s=i._rootElement(),a=i.$element?i.$element.get(0):null;if("columns"===e&&i.state.value&&i._setVisiblesColumns(i.renderOptions,i.state.value.columns,!1),e||!t.isState)e&&"isHidden"!==e||r.isHidden!==i.state.isHidden&&(i.state.isHidden=r.isHidden,s&&i.setHidden(a)),e&&"isDisabled"!==e||r.isDisabled!=i.state.isDisabled&&(i.state.isDisabled=r.isDisabled,s&&i._setDisabled(s,a)),e&&"errors"!==e||p.errorChanged(i.state.errors,r.errors)&&(i.state.errors=r.errors,i._setErrors(s,a)),e&&"orderBy"!==e||i._updateSorting();else{var l=T.parsePath(i.$bind,t.property,i.renderOptions.expandingProperty),u=n[l];if(u){var d=t.property.substr(l.length+1),c=t.origProperty.substr(t.property.length+1);"errors"===c?i._showErrors(u,d,c,null):i._modifyCell(u,d,c,null,null)}}}}},e.prototype.stopProppagation=function(e){var t=e.target,n=this.$element.get(0),i=this._gridParentFocus();if(F.isChildOf(i,e.target))for(;t;){if(t===n)return;t.href&&(e.preventDefault(),e.stopPropagation()),t=t.parentNode}},e.prototype._buildView=function(e,t,n,i,o){var r={level:n,value:e};i=i||this._view,o=o||this._viewMap,i.push(r),o[e.$id]=r},e.prototype._findById=function(e){if(!this.state.value)return null;if(this._useView){var t=this._viewMap[e];return t?t.value:null}return this.state.value.findById(e)},e.prototype._findByIdEx=function(e){if(!this.state.value)return null;var t={index:-1,level:0,value:null};if(this._useView){var n=this._viewMap[e];n&&(t.index=this._view.indexOf(n),t.level=n.level,t.value=n.value)}else t.value=this.state.value.findById(e),t.value&&(t.index=this.state.value.indexOf(t.value));return t},e.prototype._findNext=function(e){var t,n=this;if(!n.state.value)return null;if(n._useView){if(t=n._viewMap[e]){var i=n._view.indexOf(t);if(n._view.length>i+1)return n._view[i+1].value}}else if(t=n.state.value.findById(e)){i=n.state.value.indexOf(t);if(n.state.value.length>i+1)return n.state.value.get(i+1)}return null},e.prototype._findPrev=function(e){var t,n;if(!this.state.value)return null;if(this._useView){if((t=this._viewMap[e])&&0<(n=this._view.indexOf(t)))return this._view[n-1].value}else if((t=this.state.value.findById(e))&&0<(n=this.state.value.indexOf(t)))return this.state.value.get(n-1);return null},e.prototype._renderTotalRows=function(){var e=this;if(e.$element){var t=e.renderOptions;if(e._totalProperty){var n=e.form.getValue(e._totalProperty);e._totalIsArray||(n=[n||{}]);var i=!!e._totalField||!!e._stopField,o=void 0,r=void 0;S.hasFrozenColumns(e.renderOptions,e.frozenColumns)&&(i=!1,(o=F.find(e.$element.get(0),e.id+"_frozen_totals"))&&(r=S.createRows(e.id,n,e.frozenColumns,t,e.options.design,e.form.$locale,!0,!0,null,null,null,e.form),F.empty(o),F.append(o,r))),o=F.find(e.$element.get(0),e.id+"_totals"),r=S.createRows(e.id,n,e.columns,t,e.options.design,e.form.$locale,!1,!0,null,i?e._totalField:null,i?e._stopField:null,e.form),F.empty(o),F.append(o,r)}}},e.prototype._renderRows=function(e,t,n,i){var o=this;if(o.$element){var r=o.renderOptions,s=null;e&&(o._view=[],o._viewMap={},o._useView=!0,s=o._buildView.bind(o));var a=void 0,l=void 0;if(o._inplaceEditRemove(!1,!1,!0),o._destroyDetails(),S.hasFrozenColumns(o.renderOptions,o.frozenColumns)&&(a=F.find(o.$element.get(0),o.id+"_frozen_rows")))if(e)l=o.state.value?S.createRows(o.id,o.state.value,o.frozenColumns,r,o.options.design,o.form.$locale,!0,!1,s,null,null,o.form):null,s=null,F.empty(a),l&&F.append(a,l);else{l=S.createBulkRows(o.id,n,o.frozenColumns,r,o.options.design,o.form.$locale,!0,!1,s,o.form);var u=F.find(a,t+"_frozen");F.after(u,l)}if(a=F.find(o.$element.get(0),o.id+"_rows"),e)l=o.state.value?S.createRows(o.id,o.state.value,o.columns,r,o.options.design,o.form.$locale,!1,!1,s,null,null,o.form):null,F.empty(a),l&&F.append(a,l);else{l=S.createBulkRows(o.id,n,o.columns,r,o.options.design,o.form.$locale,!1,!1,s,o.form);u=F.find(a,t);F.after(u,l)}}if(!e){var d=o._viewMap[t],c=o._view.indexOf(d);o._view.splice(c,0,n),n.forEach(function(e){o._viewMap[e.value.$id]=e})}o._updateMultiselectSummary(i)},e.prototype.editDetail=function(i){var o=this,r=i.$id;if(o.$element){var e=o.renderOptions;if(S.hasFrozenColumns(e,o.frozenColumns))return;var t=F.find(o.$element.get(0),o.id+"_rows"),n=F.find(t,r+"_detail");if(n)return;var s=F.find(t,r);if(s){n=S.createDetail(r,s);var a=o.renderOptions.rows;if(!a||!a.detail||!a.detail.layout)throw new Error('Grid options missing: "options.rows.detail.layout".');var l=a.detail.layout;"string"==typeof l&&o.renderOptions.layouts&&o.renderOptions.layouts[l]&&(l=o.renderOptions.layouts[l]),"object"==typeof l&&((l=$.extend(!0,{},l)).name&&(l._name=l.name),l.name=r);var u=i.getSchema();"object"==typeof u&&(u.links=u.links||{},u.links.$updateChanges=u.links.$updateChanges||{title:h.ui.ApplyDetailChanges});var d={};a.detail.spacing&&(d.verticalSpacing=!0),d.closeButtonHandler=function(){o.closeDetail(r)},l._name&&(d.externalLayout=l._name,d.externalSchema=o.form.options.externalSchema,d.externalLocale=o.form.options.externalLocale),d.path=o.$bind,o._details.push(r),c.OpenForm($(n.firstChild),l,o.form.$schema,i.schemaModel(!0),o.form.$locale,function(e,t,n){if("init"===e.operation)o.form.execAction("$links.$beforeEdit",t,t);else switch(e.property){case"$links.$updateChanges":if(!o.state.value.updateItem(i,t))return;i.update(t.schemaModel(!1)),o.form.execAction("$links.$afterUpdateChanges",i,i),o.closeDetail(r)}},null,d,null),F.after(s,n)}}},e.prototype.closeDetail=function(e){if(this._destroyDetailById(e),this.$element){var t=F.find(this.$element.get(0),e+"_detail");t&&F.remove(t)}},e.prototype._removeRow=function(o){var r=this;if(r._destroyDetailById(o),r._viewMap){var e=r._viewMap[o];if(e){delete r._viewMap[o];var t=r._view.indexOf(e);0<=t&&r._view.splice(t,1)}}if(r.$element){var n=[],i=F.find(r.$element.get(0),o);i&&n.push({element:i,columns:r.columns}),S.hasFrozenColumns(r.renderOptions,r.frozenColumns)&&(i=F.find(r.$element.get(0),o+"_frozen"))&&n.push({element:i,columns:r.frozenColumns}),n.forEach(function(e){var t=e.element.parentNode,n=F.find(t,o+"_detail");if(n&&F.remove(n),t.firstChild===e.element&&r.renderOptions.headerIsHidden&&!r.renderOptions._useColGrp&&1<t.childNodes.length){var i=t.childNodes[1];e.columns.forEach(function(e,t){var n=i.childNodes[t];e.options.width&&(n.style.width=S.ensureWidth(e.options.width)),e.options.minWidth&&(n.style.minWidth=S.ensureWidth(e.options.minWidth))})}F.remove(e.element)})}},e.prototype._updOddEven=function(){if(!this.renderOptions._useStripedCss&&this.renderOptions.striped&&this.$element){var e=F.find(this.$element.get(0),this.id+"_rows");S.updateEvenOdd(e),(e=F.find(this.$element.get(0),this.id+"_frozen_rows"))&&S.updateEvenOdd(e)}},e.prototype._updOddEvenLater=function(){var e=this;e.form.execLater({id:e.id+"_odd_even",hnd:function(){e._updOddEven()}})},e.prototype._createRow=function(e){var t=this;if(t.$element){var n=0,i=t._viewMap[e.$id];i?i=t._viewMap[e.$id]:(i={level:0,value:e},t._view.push(i),n=t._view.length-1,t._viewMap[e.$id]=i);var o=void 0,r=void 0;S.hasFrozenColumns(t.renderOptions,t.frozenColumns)&&(o=F.find(t.$element.get(0),t.id+"_frozen_rows"),r=S.createRow(t.id,n,i.level,i.value,t.frozenColumns,t.renderOptions,t.options.design,t.form.$locale,o.childNodes.length%2==1,!0,!1,null,t.form),F.append(o,r)),o=F.find(t.$element.get(0),t.id+"_rows"),r=S.createRow(t.id,n,i.level,i.value,t.columns,t.renderOptions,t.options.design,t.form.$locale,o.childNodes.length%2==1,!1,!1,null,t.form),F.append(o,r)}},e.prototype.getColumnsFromSchema=function(){var n=this,e=n.$schema,t=n.$schemaItems;if(e&&"array"===e.type&&t&&"object"===t.type){var i=T.columns(t,n.form.$rootSchema,n.form.$locale);if(n.renderOptions.linesAsColumns){var o=M.getValue(n.form.$model.model(!0),n.renderOptions.linesAsColumns);o&&o.forEach(function(e){var t=M.copy(T.getSchema(e.name,n.$schemaItems,n.form.$rootSchema,!1));t.title=e.title||t.title,i.push({name:e.name,schema:t})})}return i.sort(function(e,t){return e.schema.title.localeCompare(t.schema.title)})}return[]},e.prototype.getSelectedColumns=function(){var n=this,i={};return Object.keys(n._mapCols).forEach(function(e){var t=n._mapCols[e].column;t.options._expandItem&&t.options.display&&(e=t.options.display),t._isHidden||(i[e]=!0)}),i},e.prototype._updateSorting=function(){var e=this,t=e.renderOptions;if(e.$element&&t&&t.sorting&&!t.headerIsHidden){if(!e.state.value)return;var n=F.find(e.$element.get(0),e.id+"_cols_tr");n&&S.updSorting(t,n,e._colByField.bind(e),e.state.value.$orderby()),(n=F.find(e.$element.get(0),e.id+"_frozen_cols_tr"))&&S.updSorting(t,n,e._colByField.bind(e),e.state.value.$orderby())}},e.prototype.exportAsCsv=function(){var n=this.frozenColumns.concat(this.columns),i=[],t=[];n.forEach(function(e){e.$bind;e.isLink||T.isSelectField(e.$bind)||T.isExpandField(e.$bind)&&!e.options.display||t.push(e.title)});var e,o=this.state.value,r=$.extend(!0,{},this.renderOptions);i.push(t.join(";")),o&&o.forEach(function(r,e,t){var s=[];t=t||0,n.forEach(function(e){var t=e.$bind;if(!e.isLink&&!T.isSelectField(e.$bind)&&(!T.isExpandField(e.$bind)||e.options.display)){t=e.options.display?e.options.display:t;var n=r[t];if(null==n)s.push("");else{var i=e.options.displaySchema?e.options.displaySchema:e.schema;if(i.enum&&i.enumNames){var o=i.enum.indexOf(n);0<=o&&(n=i.enumNames[o])}T.isDate(i)?n=d.shortDate(n||""):T.isDateTime(i)?n=d.shortDateTime(n||""):"string"==typeof n&&(n.replace(/\"/g,'""'),n='"'+n+'"'),s.push(n)}}}),i.push(s.join(";"))},r.expandingProperty,!0),e=this.form.$rootSchema&&this.form.$rootSchema.title?this.form.$rootSchema.title:"export",F.downloadContentHandler(i.join("\n"),e+".csv")},e.prototype._renderColumns=function(e){var t=this;if(t._inplaceEditRemove(!1,!1,!0),e._useColGrp){var n=e.scrolling&&e.scrolling.vertical,i=n&&!e.headerIsHidden?F.find(t.$element.get(0),t.id+"_colgrp_header"):null;if(i&&(F.empty(i),F.append(i,S.createColGroup(t.columns,e,!1))),i=F.find(t.$element.get(0),t.id+"_colgrp"),F.empty(i),F.append(i,S.createColGroup(t.columns,e,!1)),e.total&&e.total.property&&(i=F.find(t.$element.get(0),t.id+"_colgrp_footer"))&&(F.empty(i),F.append(i,S.createColGroup(t.columns,e,!0))),S.hasFrozenColumns(e,t.frozenColumns)){var o=n&&!e.headerIsHidden?F.find(t.$element.get(0),t.id+"_colgrp_frozen_header"):null;o&&(F.empty(o),F.append(o,S.createColGroup(t.frozenColumns,e,!0))),(o=F.find(t.$element.get(0),t.id+"_colgrp_frozen"))&&(F.empty(o),F.append(o,S.createColGroup(t.frozenColumns,e,!0))),e.total&&e.total.property&&(o=F.find(t.$element.get(0),t.id+"_colgrp_frozen_footer"))&&(F.empty(o),F.append(o,S.createColGroup(t.frozenColumns,e,!0)))}}if(!e.headerIsHidden){var r=F.find(t.$element.get(0),t.id+"_cols");F.empty(r),F.append(r,S.createCols(t.id,"_cols",t.columns,e,t.options.design,t.form.$locale,t.state.value?t.state.value.$orderby():null,!1,t.form)),S.hasFrozenColumns(e,t.frozenColumns)&&(r=F.find(t.$element.get(0),t.id+"_frozen_cols"))&&(F.empty(r),F.append(r,S.createCols(t.id,"_frozen_cols",t.frozenColumns,e,t.options.design,t.form.$locale,t.state.value?t.state.value.$orderby():null,!0,t.form)))}e.allowFrozenColumns&&S.updateFrozenWidth(t.$element.get(0),t.id,t.frozenColumns)},e.prototype.toggleEditing=function(){if(!this.$element)return!1;var e=this.renderOptions;return e.editingDisabled=!e.editingDisabled,e.editingDisabled&&this._inplaceEditRemove(!1,!1,!0),!e.editingDisabled},e.prototype.toggleMultiselect=function(){var e=this;if(e.$element){var t=e.renderOptions;if(t.selecting&&t.selecting.row){if(t.selecting.multiselect=!t.selecting.multiselect,e.state.value){var n=e.state.value;n.selecting(!0,t.expandingProperty);try{e.state.value.updateSelecting(t.selecting.multiselect,t.expandingProperty)}finally{n.selecting(!1,t.expandingProperty)}}e.savePreferences(function(){e._refreshGrid()})}}},e.prototype.render=function(e){var t=this,n=t._initOptions(f.utils.defaultOptions);return t.$element||(t.$schema.description&&(n.description=d.tt(t.$schema.description,t.form.$locale)),t.$element=$(S.gridContainer(t.id,n,t.options.design,t.$schema.title,t.form.$locale,t.columns,t.frozenColumns)),t._renderColumns(n),t._renderRows(!0,"",null,!0),t._renderTotalRows(),t._state2UI(!0),t.setEvents(n)),t.appendElement(e,n),t.$element},e}(w.ui.AbsField);s.BasicGrid=e,c.registerControl(e,"array",!1,"",null),c.registerControl(e,"array",!1,"basicgrid",null)}(w.formgrid||(w.formgrid={}))}(Phoenix||(Phoenix={})),function(r){var e,t,n,s=r.utils,i=r.ui,a=r.dom,l=r.ulocale,u=r.Observable.errorsUtils,d=r.uiutils;t=e||(e={}),n=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._input=function(){if(!this.$element)return null;var e=this.$element.get(0);return a.find(e,this.id+"_input")},e.prototype._check=function(){if(!this.$element)return null;var e=this.$element.get(0);return a.find(e,this.id+"_check")},e.prototype.click=function(e){var t=this._input(),n=t.checked||!1;e.target==t&&n!==this.getInternalValue()&&this.setInternalValue(n,!0)},e.prototype._setDisabled=function(e,t){var n=this._check();this.state.isDisabled||this.state.isReadOnly?a.addClass(n,"disabled"):a.removeClass(n,"disabled"),e.disabled=this.state.isDisabled},e.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},e.prototype._setMandatory=function(e,t){},e.prototype._setErrors=function(e){var t=this.state.errors;if(e&&r.bootstrap4){var n="is-invalid";t&&t.length?a.addClass(e,n):a.removeClass(e,n)}this.showErrors(e,t)},e.prototype._state2UI=function(){var e=this._input(),t=this.$element?this.$element.get(0):null;e&&(e.checked=this.getInternalValue()||!1,this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setErrors(t))},e.prototype.changed=function(e,t,n,i){var o=this._input();n!==this.getInternalValue()&&(this.setInternalValue(n,!1),o&&(o.checked=this.getInternalValue()||!1))},e.prototype.stateChanged=function(e,t){var n=this,i=n._isBinded?n.form.getState(n.$bind):n._internalState,o=n._input(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r)),e&&"errors"!==e||u.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(r))},e.prototype.render=function(e){var t=this,n=t._initOptions(d.utils.defaultOptions);return t.$element||(t.$element=$(function(e,t,n,i){r.bootstrap4,i=i||"",t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},t);var o=[];return d.utils.fieldWrapper(o,t,n,function(){t.columns&&o.push('<div class="no-x-padding ml-sm-auto col-sm-'+(12-t.labelCol)+'">'),o.push('<div id="{0}_check" class="custom-control custom-checkbox">'),o.push('<input type="checkbox" id="{0}_input" class="custom-control-input">'),o.push('<label class="custom-control-label" for="{0}_input"> '),o.push(s.escapeHtml(i||"")),o.push("&nbsp;"),o.push("</label>"),o.push("</div>"),d.utils.addErrorDiv(o,!1),t.columns&&o.push("</div>")}),s.format(o.join(""),e)}(t.id,n,t.options.design,l.tt(t.$schema.title,t.form.$locale))),t._state2UI()),t.appendElement(e,n),t.$element},e}(r.ui.AbsField),t.Check=n,i.registerControl(n,"boolean",!1,"",null)}(Phoenix||(Phoenix={})),function(e){var t,i=e.utils,n=e.ui,s=e.dom,a=e.data,r=e.uiutils;e.downloadctrl||(e.downloadctrl={}),t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype.changed=function(e,t,n,i,o){if(this.state.value!==n&&(this.state.value=n,this.state.value)){var r="";this.renderOptions.dataSource&&(r=a.getUrlBaseByType(this.renderOptions.dataSource,!1,!1)),s.downloadUriHandler(r+this.state.value)}},e.prototype.render=function(e){var t=this._initOptions(r.utils.defaultOptions);if(!this.$element){var n=[];this.options.design||(t.styles="bs-none"),r.utils.fieldWrapper(n,t,this.options.design,function(){}),this.$element=$(i.format(n.join(""),this.id))}return this.appendElement(e,t),this.$element},e}(e.ui.AbsField),n.registerControl(t,"string",!1,"download",{})}(Phoenix||(Phoenix={})),function(s){var e,t,a,d,o,l,u,n,c,p,h,r,i,f;e=s.formedit||(s.formedit={}),(t=s).serial,a=t.utils,d=t.dom,o=t.locale,l=t.Observable.SchemaUtils,u=t.ulocale,n=t.ui,c=t.uiutils,p=t.Observable.errorsUtils,h=function(e,t){e.push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-append input-group-addon'),t.icon&&e.push(" bs-icon-input"),e.push('">'),e.push('<span class="input-group-text">'),t.icon?e.push('<span class="'+d.iconClass(t.icon)+'"></span>'):e.push(t.value),e.push("</span>"),e.push("</span>")},r=function(e,t,n,i,o){i=i||"",t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t);var r=[];return t.readOnly&&(delete t.after,delete t.before),c.utils.fieldWrapper(r,t,n,function(){if(!t.titleIsHidden||t.columns){r.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&e.push("form-check-inline bs-cursor-d no-x-padding"),e.length&&r.push(' class="'+e.join(" ")+'"'),r.push(">"),t.titleIsHidden||(r.push(a.escapeHtml(i||"")+(t.inline?"&nbsp;":"")),c.utils.addTooltipAndRule(r,t)),r.push("</label>")}t.columns&&r.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'" id="{0}_colparent">'),function(e,t,n,i){var o="textarea"===(i=i||"input");t.readOnly&&(i="div"),o&&(t.before||t.after)&&(delete t.before,delete t.after);var r="date-time"===t.$format,s="date"===t.$format;("money"===t.$format||s||r)&&void 0===t.maxWidth&&(t.maxWidth="16em",t.inline&&void 0===t.minWidth&&(t.minWidth="16em")),e.push('<div class="input-group" id="{0}_group"');var a=[];t.readOnly||(t.minWidth&&a.push("min-width: "+t.minWidth+";"),t.maxWidth&&a.push("max-width: "+t.maxWidth+";")),a.length&&e.push('  style="'+a.join("")+'"'),e.push(">"),o&&t.noResize&&a.push("resize: none;"),t.before&&(e.push('<span class="bs-grp-btn input-group-prepend">'),e.push('<span class="input-group-text">'),t.before.icon?e.push('<span class="'+d.iconClass(t.before.icon)+'"></span>'):e.push(t.before.value),e.push("</span>"),e.push("</span>"));var l=["form-control"];if(t.size&&l.push("form-control-"+t.size),t.inputClass&&l.push(t.inputClass),t.readOnly&&l.push("bs-read-only"),"uppercase"===t.mask&&l.push("text-uppercase"),e.push("<"+i+' autocomplete="off"'+(t.readOnly?"":' type="'+(t.type||"text")+'"')+' class="'+l.join(" ")),e.push('" id="{0}_input"'),o&&e.push(' rows="'+(t.rows||3)+'"'),t.readOnly&&(a=[],t.minWidth&&a.push("min-width: "+t.minWidth+";"),t.maxWidth&&a.push("max-width: "+t.maxWidth+";"),a.length&&e.push('  style="'+a.join("")+'"')),t.maxLength&&e.push('  maxLength="'+t.maxLength+'"'),t.placeHolder){var u=!0===t.placeHolder?n:t.placeHolder;e.push('  placeholder="'+u+'"')}e.push(">"),(o||t.readOnly)&&e.push("</"+i+">"),t.after&&t.after.icon&&h(e,t.after),e.push("</div>"),c.utils.addErrorDiv(e,!1,t.inline)}(r,t,i,o),t.columns&&r.push("</div>"),t.titleIsHidden&&t.inline&&c.utils.addTooltipAndRule(r,t)}),a.format(r.join(""),e)},i=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o._search=e&&e.options&&e.options.search,o._search&&(o._searchEventBus=new s.serial.SingleEventBus(500)),o._state(),i}return __extends(e,r),e.prototype._input=function(){var e=this.$element?this.$element.get(0):null;return e?d.find(e,this.id+"_input"):null},e.prototype._after=function(){var e=this.$element?this.$element.get(0):null;if(!e)return null;var t=d.find(e,this.id+"_after");return t?t.firstChild:null},e.prototype._colParent=function(){var e=this.$element.get(0);return this.renderOptions.columns?d.find(e,this.id+"_colparent"):null},e.prototype._value2Text=function(){if(!this.options.design){this._input();return this._isDate()?c.utils.useDatePicker()?u.parseISODate(this.state.value||"")||"":u.shortDate(this.state.value||""):this._isDateTime()?c.utils.useDateTimePicker()?u.parseISODateTime(this.state.value||"")||"":u.shortDateTime(this.state.value||""):this.state.value||""}},e.prototype._schemaInput=function(){return this.$schema},e.prototype._isPassword=function(){return l.isPassword(this._schemaInput())},e.prototype._isDate=function(){return l.isDate(this._schemaInput())},e.prototype._isDateTime=function(){return l.isDateTime(this._schemaInput())},e.prototype._isMemo=function(){return l.isText(this._schemaInput())},e.prototype._isEnum=function(){return!!this._schemaInput().enum},e.prototype.focusIn=function(e){var t=this.renderOptions;t.disclaimer&&this.form.disclaimer(t.disclaimer,!0)},e.prototype.focusOut=function(e){var t=this.renderOptions;t.disclaimer&&this.form.disclaimer(t.disclaimer,!1)},e.prototype._isNumber=function(){var e=this._schemaInput();return!e.enum&&l.isNumber(e)},e.prototype.setFocus=function(e){if(!this.renderOptions.readOnly){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden){var n=this._input();n&&n.focus()}}},e.prototype._isMoney=function(){return l.isMoney(this._schemaInput())},e.prototype._setDisabled=function(e,t){this.renderOptions.readOnly||(e.disabled=this.state.isDisabled)},e.prototype._setMaxLength=function(e,t){this.renderOptions.readOnly||(this.fieldState().maxLength?e.maxLength=this.fieldState().maxLength:delete e.maxLength)},e.prototype._setReadOnly=function(e,t){this.renderOptions.readOnly||(e.readOnly=this.state.isReadOnly)},e.prototype._setErrors=function(e,t){if(!this.renderOptions.readOnly||this.renderOptions.showErrors){var n=this.state.errors,i=s.bootstrap4?"is-invalid":"has-error";n&&n.length?(d.addClass(t,i),s.bootstrap4&&d.addClass(e,i)):(d.removeClass(t,i),s.bootstrap4&&d.removeClass(e,i)),this.showErrors(t,n)}},e.prototype._setMandatory=function(e,t){if(!this.renderOptions.readOnly){var n=this.state.isMandatory;if((e.required=n)?d.addClass(e,"bs-mandatory"):d.removeClass(e,"bs-mandatory"),this.renderOptions.placeHolder&&(e.placeholder=(!0===this.renderOptions.placeHolder?this.renderOptions.title:this.renderOptions.placeHolder)+(n?" *":"")),!this.renderOptions.titleIsHidden){var i=d.find(t,this.id+"_label");i&&d.text(i,(this.renderOptions.title||"")+(n?" *":"")+(this.renderOptions.inline?String.fromCharCode(160):""))}}},e.prototype._state2UI=function(){var e=this,t=e._input(),n=e.$element?e.$element.get(0):null;e._isMoney&&(e.fieldState().moneyUnitCoef=e.form.moneyUnitCoef),t&&(e._value2Input(t),e._setDisabled(t,n),e._setReadOnly(t,n),e.setHidden(n),e._setMandatory(t,n),e._setErrors(t,n),e._setSymbol(n))},e.prototype.beforeAfter=function(){return this._input()},e.prototype._setSymbol=function(e){if(e&&this._isNumber()){var t,n,i=this._after(),o=this._isMoney()?l.moneyUnitSymbol(this.fieldState().moneyUnitCoef)+(this.fieldState().symbol||""):this.fieldState().symbol;if(i)o?d.text(i,o):d.remove(i);else if(o){t=this.id,h(n=[],{value:o}),i=$(a.format(n.join(""),t)).get(0);var r=this.beforeAfter();d.after(r,i)}}},e.prototype.focusInControl=function(e){var t=r.prototype.focusInControl.call(this,e);return!t&&this._isDate()&&c.utils.useDatePicker()&&!this.options.design?c.utils.elementInDatePicker(e,this.$element):t},e.prototype._value2Input=function(e){var t=this;t.options.design||(t.renderOptions.readOnly?t._isDate()?d.text(e,u.shortDate(t.state.value||"")||String.fromCharCode(160)):t._isDateTime()?d.text(e,u.shortDateTime(t.state.value||"")||String.fromCharCode(160)):(t._isNumber(),d.text(e,t._value2Text()||String.fromCharCode(160))):t._isDate()?c.utils.useDatePicker()?c.utils.datePickerSetValue(t.$element,t.state.value):e.value=u.shortDate(t.state.value||""):t._isDateTime()?c.utils.useDateTimePicker()?c.utils.dateTimePickerSetValue($(d.find(t.$element.get(0),t.id+"_group")),t.state.value):e.value=u.shortDateTime(t.state.value||""):(t._isNumber(),e.value=t._value2Text()))},e.prototype.changed=function(e,t,n,i,o){var r=this;if(!r.useDisplay||e!==r.$bind)if(r.$element){var s=r._input();if(n=r.form.getValue(r.$display),r.state.value!=n)r.state.value=n,r._value2Input(s);else c.utils.maskCheckValue(r.renderOptions.mask,s.value)!=r._value2Text()&&r._value2Input(s)}else r.state.value=n},e.prototype._patchState=function(e){},e.prototype.stateChanged=function(e,t){var n=this;if(!n.useDisplay||e!==n.$display){var i=n.form.getState(n.$bind);n._patchState(i);var o=n._input(),r=n.$element?n.$element.get(0):null;e&&"symbol"!==e||i.symbol!==n.fieldState().symbol&&(n.fieldState().symbol=i.symbol,o&&n._setSymbol(r)),e&&"maxLength"!==e||i.decimals!==n.fieldState().maxLength&&(n.fieldState().maxLength=i.maxLength,o&&n._setMaxLength(o,r)),e&&"decimals"!==e||i.decimals!==n.fieldState().decimals&&(n.fieldState().decimals=i.decimals),e&&"isHidden"!==e||i.isHidden!==n.fieldState().isHidden&&(n.fieldState().isHidden=i.isHidden,o&&n.setHidden(r)),e&&"isDisabled"!==e||i.isDisabled!==n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),e&&"isReadOnly"!==e||i.isReadOnly!==n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),e&&"isMandatory"!==e||i.isMandatory!==n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r)),e&&"errors"!==e||p.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(o,r))}},e.prototype.destroy=function(){this._searchEventBus&&(this._searchEventBus.destroy(),this._searchEventBus=null),r.prototype.destroy.call(this)},e}(s.ui.AbsField),f=function(i){function e(e,t,n){return i.call(this,e,t,n)||this}return __extends(e,i),e.prototype.beforeAppend=function(){},e.prototype.mousedown=function(e){if(!this.renderOptions.readOnly&&(this._doSelect=!1,this.$element&&!this.state.isDisabled)){if(window.document.activeElement!==e.target)this._input()===e.target&&(this._doSelect=!0);return!0}},e.prototype.stopProppagation=function(e){if(!this.renderOptions.readOnly&&this._doSelect){var t=this._input();d.select(t)}},e.prototype.click=function(e){var t=this;if(!(t.state.isDisabled||t.state.isReadOnly||t.options.design)){var n=e.target,i=t._after();if(t.renderOptions.after&&t.renderOptions.after.$bind){if(d.isChildOf(i,n))t._afterEnter(),(o=t._input())&&o.focus()}else if(t._isDate()&&c.utils.useDatePicker()&&d.isChildOf(i,n)){var o;(o=t._input())&&o.focus()}}},e.prototype.internalRender=function(e){var t=this,n=t._initOptions(c.utils.defaultOptions);t._schemaInput();if(!t.$element){n.title=u.tt(t.$schema.title,t.form.$locale),n.placeHolder&&!0!==n.placeHolder&&!n.title&&(n.title=u.tt(n.placeHolder,t.form.$locale));var i=t.fieldState().maxLength||l.getMaxLength(t._schemaInput());i&&(n.maxLength=i),t.$schema.description&&(n.description=u.tt(t.$schema.description,t.form.$locale)),t.$element=$(r(t.id,n,t.options.design,n.title,n.tagName)),t.beforeAppend(),t.setEvents(n),t._state2UI()}t.appendElement(e,n)},e.prototype.render=function(e){this.internalRender(e)},e.prototype._text2value=function(e){return c.utils.text2value(e,this._schemaInput(),this.fieldState())},e.prototype._value2Text=function(){return this._isNumber()?l.value2Text(this.state.value,this._schemaInput(),this.fieldState()):i.prototype._value2Text.call(this)},e.prototype.customOptions=function(e){var t=this;i.prototype.customOptions.call(this,e);var n=t._schemaInput();n&&"phone"===n.format&&(t._mask="phone"),t._isEnum()?t.customOptionsEnums(e):t._isDate()?t.customOptionsDate(e):t._isDateTime()?t.customOptionsDateTime(e):t._isNumber()?t.customOptionsNumber(e):t._isPassword()?t.customOptionsPassword(e):t._isMemo()&&t.customOptionsMemo(e)},e.prototype.customOptionsMemo=function(e){if("memo"===this._schemaInput().format){var t=l.getMaxLength(this._schemaInput());t&&(e.maxLength=t)}e.tagName="textarea"},e.prototype.customOptionsPassword=function(e){e.type="password"},e.prototype._unitChanged=function(){var e=this._input(),t=this.$element?this.$element.get(0):null;e&&(this._value2Input(e),this._setSymbol(t))},e.prototype.notifyGlobalChanged=function(e){"money-unit"===e&&(this.fieldState().moneyUnitCoef=this.form.moneyUnitCoef,this._unitChanged())},e.prototype.customOptionsEnums=function(e){e.after={icon:"chevron-down"}},e.prototype.customOptionsDate=function(e){e.$format="date",c.utils.useDatePicker()?(e.after={icon:"calendar"},e.date=!0):e.type="date"},e.prototype.customOptionsDateTime=function(e){e.$format="date-time",c.utils.useDateTimePicker()&&(e.after={icon:"calendar"},e.date=!0)},e.prototype.customOptionsNumber=function(e){e.inputClass="bs-edit-number";var t=this._schemaInput();e.$format=t.format},e.prototype._removeEventsDate=function(){!this.options.design&&c.utils.useDatePicker()&&c.utils.datePickerDestroy(this.$element)},e.prototype._setEventsDate=function(){var i=this;i.renderOptions.readOnly||!i.options.design&&c.utils.useDatePicker()&&c.utils.datePickerInitialize(i.$element,{showOnFocus:!0},function(e){var t=!1;if(document.activeElement===document.body){var n=i._input();n?n.focus():t=!0}else t=!0;!t||document.activeElement&&i.focusInControl(document.activeElement)||(i.focusOut(null),i.focused=!1)})},e.prototype._removeEventsDateTime=function(){this.renderOptions.readOnly||!this.options.design&&c.utils.useDateTimePicker()&&c.utils.dateTimePickerDestroy($(d.find(this.$element.get(0),this.id+"_group")))},e.prototype._setEventsDateTime=function(){var t=this;t.renderOptions.readOnly||!t.options.design&&c.utils.useDateTimePicker()&&c.utils.dateTimePickerInitialize($(d.find(t.$element.get(0),t.id+"_group")),{},function(e){t.focusOut(null),t.focused=!1})},e.prototype.setEvents=function(e){this._isDate()?this._setEventsDate():this._isDateTime()&&this._setEventsDateTime()},e.prototype.removeEvents=function(){this._isDate()?this._removeEventsDate():this._isDateTime()&&this._removeEventsDateTime()},e.prototype.checkValue=function(e,t){t(e)},e.prototype.paste=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t._input();if(t.state.isReadOnly||t.state.isDisabled)return!0;var i=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===c.utils.doPasteNumber(e,n,{decimalSep:o.number.decimal,thousandSep:o.number.thousand,places:l.places(t.fieldState()),schema:i}))return!1}else if(t._isDate()){if(!1===c.utils.doPasteDate(e,n,{sep:o.date.daySep,format:o.date.dateShort,schema:i}))return!1}else if(t._isPassword()&&!1===c.utils.doPastePassword(e,n,{schema:i}))return!1;return!0}},e.prototype._ignoreKeys=function(e,t,n){return e.which===d.keys.VK_TAB||e.which!==d.keys.VK_DELETE&&(!(!t&&e.which===d.keys.VK_BACKSPACE)&&(t?0===e.which||(0<=d.arrowKeys.indexOf(e.which)||!(!this.renderOptions.mask||(e.which=c.utils.maskKeys(this.renderOptions.mask||this._mask,e,n,t),0!==e.which))):0<=d.ignoreKeys.indexOf(e.which)||0<=d.arrowKeys.indexOf(e.which)))},e.prototype.keypress=function(e){var t=this;if(t.renderOptions.readOnly)return!0;if(t.state.isReadOnly||t.state.isDisabled)return!0;var n=t._input();if(t._ignoreKeys(e,!0,n))return!0;var i=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===c.utils.keyPressNumber(e,n,{decimalSep:o.number.decimal,thousandSep:o.number.thousand,places:l.places(t.fieldState()),schema:i}))return!1}else if(t._isDate()){if(!1===c.utils.keyPressDate(e,n,{sep:o.date.daySep,format:o.date.dateShort,schema:i}))return!1}else if(t._isPassword()&&!1===c.utils.keyPressPassword(e,n,{schema:i}))return!1;return!0},e.prototype._afterEnter=function(){this._input2Model(!0),this.renderOptions&&this.renderOptions.after&&this.renderOptions.after.$bind&&this.form.execAction(this.renderOptions.after.$bind,this.state.value)},e.prototype.keydown=function(e){var t=this;if(t.renderOptions.readOnly)return!0;if(t.state.isReadOnly||t.state.isDisabled)return!0;var n=t._input();if(t._ignoreKeys(e,!1,n))return e.which===d.keys.VK_ENTER&&t._afterEnter(),!0;var i=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===c.utils.keyDownNumber(e,n,{decimalSep:o.number.decimal,thousandSep:o.number.thousand,places:l.places(t.state),schema:i}))return!1}else if(t._isDate()){if(!1===c.utils.keyDownDate(e,n,{sep:o.date.daySep,format:o.date.dateShort,schema:i}))return!1}else if(t._isPassword()&&!1===c.utils.keyDownPassword(e,n,{schema:i}))return!1;return!0},e.prototype.equals=function(e){var t=this.state.value;this._isMoney()&&(t=this._value2Text(),e=l.value2Text(e,this._schemaInput(),this.state));var n=t===e;return!n&&void 0===t&&"string"===this._schemaInput().type&&""===e||n},e.prototype.updateModel=function(){this.form.setValue(this.$display,this.state.value)},e.prototype._internalSetValue=function(t,e){var n=this;n._searchEventBus?n._searchEventBus.push(null,function(e){n.state.value=t,n.updateModel()},e):(n.state.value=t,n.updateModel())},e.prototype._input2Model=function(t){var n=this,i=n._input(),e=c.utils.maskCheckValue(n.renderOptions.mask,i.value);e!=i.value&&(i.value=e);var o=n._text2value(e);n.equals(o)?(n._isNumber()||n._isDate()||n._isDateTime())&&n._value2Input(i):n.checkValue(o,function(e){n.state.value!==e?(""===e&&"string"===n._schemaInput().type&&(e=void 0),n._internalSetValue(e,t)):n._value2Input(i)})},e.prototype.focusOut=function(e){i.prototype.focusOut.call(this,e);this.renderOptions.readOnly||this._input2Model(!0)},e.prototype.destroy=function(){i.prototype.destroy.call(this)},e}(e.BaseEdit=i),e.Edit=f,n.registerControl(f,"string",!1,"",null),n.registerControl(f,"number",!1,"",null),n.registerControl(f,"integer",!1,"",null)}(Phoenix||(Phoenix={})),function(s){var e,c,t,a=s.utils,p=s.dom,n=s.ui,l=(s.locale,s.uiutils),r=(s.Observable.SchemaUtils,s.ulocale),u=s.Observable.errorsUtils;e||(e={}),c=function(o,r,e,s){s=s||e;var a=document.createDocumentFragment(),l=$('<div tabindex="0" class="bs-enum-list-row"><div class="bs-enum-list-check"><a><center><span class="'+p.iconClass("square-o")+'"></span></center></a></div><div class="bs-enum-list-title"></div></div>').get(0);return e.forEach(function(e,t){var n=l.cloneNode(!0);r?(p.attr(n,"tabindex","-1"),p.removeClass(n,"bs-pointer"),p.addClass(n,"bs-cursor-disabled")):(p.attr(n,"tabindex","0"),p.addClass(n,"bs-pointer"),p.removeClass(n,"bs-cursor-disabled")),n.firstChild.firstChild.firstChild.firstChild.className=o&&0<=o.indexOf(e)?p.iconClass("check-square-o"):p.iconClass("square-o");var i=n.lastChild;p.append(i,document.createTextNode(s[t])),p.append(a,n)}),a},t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._setDisabled=function(e,t){for(var n=0,i=e.childNodes.length;n<i;n++){var o=e.childNodes[n];this.state.isDisabled?(p.attr(o,"tabindex","-1"),p.removeClass(o,"bs-pointer"),p.addClass(o,"bs-cursor-disabled")):(p.attr(o,"tabindex","0"),p.addClass(o,"bs-pointer"),p.removeClass(o,"bs-cursor-disabled"))}},e.prototype._setReadOnly=function(e,t){},e.prototype._setErrors=function(e,t){var n=this.state.errors;if(t&&s.bootstrap4){var i="is-invalid";n&&n.length?p.addClass(t,i):p.removeClass(t,i)}this.showErrors(t,n)},e.prototype._setMandatory=function(e,t){},e.prototype._input=function(){var e=this.$element.get(0);return p.find(e,this.id+"_input")},e.prototype._state2UI=function(e){var t=this._input(),n=this.$element?this.$element.get(0):null;t&&(e||this._setDisabled(t,n),e||this._setFilter(),this._setReadOnly(t,n),this.setHidden(n),this._setMandatory(t,n),this._setErrors(t,n))},e.prototype.mousedown=function(e){if(this.$element&&!this.state.isDisabled&&!this.state.isReadOnly){var t=window.document.activeElement,n=p.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");if(n)return t!==n&&n.focus(),!0}},e.prototype._getEnumsNames=function(){var t=this;if(!t.$schemaItems.enumNames)return null;if(t.state.filter){var e=t.$schemaItems.filters[t.state.filter],n=[];return e.forEach(function(e){n.push(t.$schemaItems.enumNames[t.$schemaItems.enum.indexOf(e)])}),n}return t.$schemaItems.enumNames},e.prototype._getEnums=function(){return this.state.filter?this.$schemaItems.filters[this.state.filter]:this.$schemaItems.enum},e.prototype._toggleEnumByIndex=function(e){var t=this._getEnums();if(0<=e&&e<t.length){var n=t[e];0<=this.state.value.indexOf(n)?this.state.value.remove(n):this.state.value.push(n)}},e.prototype.keypress=function(e){if(32==e.which){var t=p.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");if(!t)return;this._toggleEnumByIndex(p.indexOf(t.parentNode,t))}},e.prototype.click=function(e){if(this.$element&&!this.state.isDisabled&&!this.state.isReadOnly){var t=p.parentByClass(this.$element.get(0),e.target,"bs-enum-list-row");t&&this._toggleEnumByIndex(p.indexOf(t.parentNode,t))}},e.prototype.changed=function(e,t,n,i,o){var r=this;if(r.$element){var s=r._input(),a=-1,l=r._getEnums(),u=r._getEnumsNames();switch(i){case"add":0<=(a=l.indexOf(o.$id))&&r._setItemValue(s.childNodes[a],!0);break;case"remove":0<=(a=l.indexOf(o.$id))&&r._setItemValue(s.childNodes[a],!1);break;case"propchange":p.empty(s),e===r.$bind&&(r.state.value=r.form.getValue(r.$bind));var d=c(r.state.value,r.state.isDisabled,l,u);p.empty(s),p.append(s,d)}}},e.prototype._setFilter=function(){this.state.filter;var t=this._getEnums(),n=[];this.state.value.forEach(function(e){0<=t.indexOf(e)&&n.push(e)}),this.form.setValue(this.$bind,n)},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null,r=o?n._input():null;e&&"isHidden"!==e||i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),e&&"isDisabled"!==e||i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(r,o)),e&&"isReadOnly"!==e||i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly),e&&"filter"!==e||i.filter!=n.state.filter&&(n.state.filter=i.filter,o&&n._setFilter()),e&&"isMandatory"!==e||i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory),e&&"errors"!==e||u.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(null,o))},e.prototype.render=function(e){var t=this,n=t._initOptions(l.utils.defaultOptions);if(!t.$element){t.$schema.description&&(n.description=r.tt(t.$schema.description,t.form.$locale)),t.$element=$(function(e,t,n,i){var o=s.bootstrap4;i=i||"",t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},t);var r=[];return t.titleIsHidden&&(t.columns=!1),t.placeHolder=!1,l.utils.fieldWrapper(r,t,n,function(){if(!t.titleIsHidden){r.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(o?e.push("col-form-label"):e.push("checkbox-inline bs-cursor-d"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&(o?e.push("form-check-inline"):e.push("checkbox-inline"),e.push("no-x-padding bs-cursor-d")),e.length&&r.push(' class="'+e.join(" ")+'"'),r.push(">"),r.push(a.escapeHtml(i||"")+(t.inline?"&nbsp;":"")),l.utils.addTooltipAndRule(r,t),r.push("</label>")}t.columns&&r.push('<div class="no-x-padding col-sm-'+(12-t.labelCol)+'">'),r.push('<div class="bs-enum-list-wrap" id="{0}_input">'),r.push("</div>"),l.utils.addErrorDiv(r),t.columns&&r.push("</div>")}),a.format(r.join(""),e)}(t.id,n,t.options.design,r.tt(t.$schema.title,t.form.$locale)));var i=c(t.state.value,t.state.isDisabled,t._getEnums(),t._getEnumsNames()),o=t._input();p.append(o,i),t._state2UI(!0)}return t.appendElement(e,n),t.$element},e.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.firstChild.className=t?p.iconClass("check-square-o"):p.iconClass("square-o")},e.prototype.destroy=function(){o.prototype.destroy.call(this)},e}(s.ui.AbsField),n.registerControl(t,"array",!1,"enums-list",null)}(Phoenix||(Phoenix={})),function(e){var t,s,n,a,i,r,o,l;e.filtersummary||(e.filtersummary={}),s=(t=e).uiutils,n=t.Observable.SchemaUtils,a=t.utils,i=e.ctrlsinterfaces,r=t.dom,o=t.ui,l=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype.destroy=function(){o.prototype.destroy.call(this)},e.prototype.stateChanged=function(e,t,n){"filter"===e&&this._state2UI()},e.prototype.changed=function(e,t,n,i,o){o.checkChildren&&"propchange"===i&&e===this.$bind&&(this.state.value=this.form.getValue(this.$bind),this._state(),this._state2UI())},e.prototype.filter2English=function(e){return i.glbMongoFilter2Filter(e,this._filtrableColumns(),!0)},e.prototype.renderFilter=function(){var n=this.$element.get(0);if(this.state.value&&this.state.value.filter){var e=this.filter2English(this.state.value.filter);r.empty(n),e.forEach(function(e){var t;r.append(n,(t=e.title,$(a.format(' <span class="bs-tag badge badge-info">{0}</span>',t)).get(0)))})}else r.empty(n)},e.prototype.setHidden=function(e){e&&(this.options.design?r.removeClass(e,"bs-none"):this.state.value&&this.state.value.filter?r.removeClass(e,"bs-none"):r.addClass(e,"bs-none"))},e.prototype._state2UI=function(){var e=this.$element.get(0);this.renderFilter(),this.setHidden(e)},e.prototype.render=function(e){var t,n,i,o,r=this._initOptions(s.utils.defaultOptions);if(!this.$element)return this.$element||(this.$element=$((t=this.id,n=r,i=this.options.design,o=[],s.utils.fieldWrapper(o,n,i,function(){}),a.format(o.join(""),t))),this._state2UI(),this.appendElement(e,r)),this.$element},e.prototype._filtrableColumns=function(){var e=this.form.getSchema(this.$bind),t=n.expand$Ref(e.items,this.form.$rootSchema);return e&&"array"===e.type&&t&&"object"===t.type?n.filtrableFields(t,this.form.$rootSchema,this.form.$locale):[]},e}(e.ui.AbsField),o.registerControl(l,"array",!1,"filter-summary",null)}(Phoenix||(Phoenix={})),function(e){e.ui;var t=e.uiutils,b=e.dom;function x(e,t,n){return e=e.substr(0,t)+e.substr(n,e.length-n)}function C(e,t,n){var i=function(e,t,n){for(var i="",o=0;o<e.length;o++)e[o]==t?i+=n:i+=e[o];return i}(e,n,"");return"."==t?i:i.replace(t,".")}function k(e,t,n,i,o){if(o&&(""===e||null==e))return"";e||(e="0"),-1==e.indexOf(".")&&(e+="."+l("",t));var r=function(e){var t=e.split(".");""==t[0]&&(t[0]="0");return t}(e),s=function(e,t){var n="";0==e.indexOf("-")&&(n="-",e=e.substr(1,e.length-1));for(var i=0;i<e.length-1;i++){e[i];if("0"!=e[i])break}if(""==(e=e.substr(i,e.length-i)))return"0";if(e.length<=3)return n+e;for(var o=u(e),r="",i=0;i<o.length;i++)i%3==0&&0<i&&(r+=t),r+=o[i];return u(r+n)}(r[0],i),a=r[1];return a.length>t&&(a=a.substr(0,t)),a.length<t&&(a=l(a,t)),0===t?s:s+n+a}function l(e,t){for(var n=e.length,i=0;i<t-n;i++)e+="0";return e}function u(e){return e.split("").reverse().join("")}function m(e,t,n,i,o,r){if(r&&(""===e||null==e))return!0;var s=parseFloat(e);if(n){if(s<=t)return!1}else if(s<t)return!1;if(o){if(i<=s)return!1}else if(i<s)return!1;return!0}function w(e,t,n){var i=e.value;if(""!==i){var o=0;if(0!=t){for(var r=0;r<i.length&&(i[r]!=n&&t--,0!=t);r++);o=r+1}b.selectRange(e,o)}else b.selectRange(e,0)}t.utils.doPasteNumber=function(e,t,n){var i="",o=window;e.originalEvent.clipboardData&&e.originalEvent.clipboardData.getData?i=e.originalEvent.clipboardData.getData("text/plain"):o.clipboardData&&o.clipboardData.getData&&(i=o.clipboardData.getData("Text"));var r=parseFloat(C(i,n.decimalSep,n.thousandSep)),s="";if(r<0&&(s="-",r=-r),isNaN(r))return e.preventDefault(),!0;var a=r.toString(),l=e.target.selectionStart,u=e.target.selectionEnd,d=0<u-l?x(t.value,l,u):t.value,c=d.substr(0,l),p=C(c+r+d.substr(l,d.length),n.decimalSep,n.thousandSep);if(!m(s+p,n.schema.minimum,n.schema.exclusiveMinimum,n.schema.maximum,n.schema.exclusiveMaximum,n.schema.nullable))return e.preventDefault(),!1;t.value=k(s+p,n.places,n.decimalSep,n.thousandSep,n.schema.nullable),w(t,C(c,n.decimalSep,n.thousandSep).length+a.length,n.thousandSep),e.preventDefault()},t.utils.keyPressNumber=function(e,t,n){var i=e.target.selectionStart,o=e.target.selectionEnd,r=0<o-i,s=r?x(t.value,i,o):t.value,a="";-1!=s.indexOf("-")&&(s=s.substr(1,s.length-1),a="-",-0!=i&&(i--,o--));var l,u=s.substr(0,i),d=s.substr(i,s.length);if(e.key===n.decimalSep||"."===e.key)return n.places&&b.selectRange(t,s.indexOf(n.decimalSep)+1+a.length),e.preventDefault(),!0;if("-"===e.key){if(0!=s.indexOf("-")){var c=C(s,n.decimalSep,n.thousandSep);if(c==function(e){for(var t="0.",n=0;n<e;n++)t+="0";return t}(n.places)||""==c){var p=k(c,n.places,n.decimalSep,n.thousandSep,n.schema.nullable);t.value=p}else{if(!m("-"+c,n.schema.minimum,n.schema.exclusiveMinimum,n.schema.maximum,n.schema.exclusiveMaximum,n.schema.nullable))return e.preventDefault(),!1;t.value=k("-"+c,n.places,n.decimalSep,n.thousandSep,n.schema.nullable)}}return b.selectRange(t,1),e.preventDefault(),!0}if((l=e).which<48||57<l.which)return e.preventDefault(),!1;if("0"===e.key&&0==i&&!r)return e.preventDefault(),!0;var h=C(u+e.key+d,n.decimalSep,n.thousandSep);if(!m(a+h,n.schema.minimum,n.schema.exclusiveMinimum,n.schema.maximum,n.schema.exclusiveMaximum,n.schema.nullable))return e.preventDefault(),!1;t.value=k(a+h,n.places,n.decimalSep,n.thousandSep,n.schema.nullable);var f="0"==u?0:1;return w(t,C(u,n.decimalSep,n.thousandSep).length+f,n.thousandSep),e.preventDefault(),!0},t.utils.keyDownNumber=function(e,t,n){if(e.which!=b.keys.VK_BACKSPACE&&e.which!=b.keys.VK_DELETE)return!0;var i=0;e.which==b.keys.VK_BACKSPACE&&(i=-1);var o,r,s,a,l,u,d,c,p=e.target.selectionStart,h=e.target.selectionEnd,f=0<h-p,m=f?x(t.value,p,h):t.value,v=m.substr(0,p),g=m.substr(p,m.length);if(f)return o=t,r=m,s=v,a=n.thousandSep,l=n.decimalSep,u=n.places,d=n.schema.nullable,c=k(C(r,l,a),u,l,a,d),o.value=c,w(o,C(s,l,a).length,a),e.preventDefault(),!0;if(e.which==b.keys.VK_BACKSPACE&&0==p)return e.preventDefault(),!0;if(e.which==b.keys.VK_BACKSPACE){if(m[p+i]==n.decimalSep)return b.selectRange(t,p+i),e.preventDefault(),!0}else if(m[p+i]==n.decimalSep)return b.selectRange(t,p+i+1),e.preventDefault(),!0;if(m[p+i]==n.thousandSep)return b.selectRange(t,p+1+2*i),e.preventDefault(),!0;var y="";e.which==b.keys.VK_DELETE?y=C(v+g.substr(1,g.length-1),n.decimalSep,n.thousandSep):e.which==b.keys.VK_BACKSPACE&&(y=C(v.substr(0,v.length-1)+g,n.decimalSep,n.thousandSep));var _=function(e,t,n,i,o,r,s,a,l){if(l&&(""===e||null==e))return"";""===e&&(e="0");var u=parseFloat(e);if(n){if(u<=t)return k(t.toString(),r,s,a,l)}else if(u<t)return k(t.toString(),r,s,a,l);if(o){if(i<=u)return k(i.toString(),r,s,a,l)}else if(i<u)return k(i.toString(),r,s,a,l);return k(u.toString(),r,s,a,l)}(y,n.schema.minimum,n.schema.exclusiveMinimum,n.schema.maximum,n.schema.exclusiveMaximum,n.places,n.decimalSep,n.thousandSep,n.schema.nullable);t.value=_;var $=C(v,n.decimalSep,n.thousandSep).length+i;return e.which==b.keys.VK_BACKSPACE&&0==y.indexOf(".")&&1==p&&($=1),e.which==b.keys.VK_DELETE&&0==y.indexOf(".")&&0==p&&($=1),w(t,$,n.thousandSep),e.preventDefault(),!0}}(Phoenix||(Phoenix={})),function(e){var u,t,n=e,a=n.utils,i=n.ui,d=n.dom,l=n.uiutils;e.frame||(e.frame={}),u=function(e,t){if(":"===e.charAt(0)&&(e=location.protocol+"//"+location.hostname+e),t.noCache){a.allocUuid();0<=e.indexOf("?")&&"&"}return e},t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i._msghandler=i._onmessage.bind(i),i}return __extends(e,o),e.prototype._setDisabled=function(e){},e.prototype._setReadOnly=function(e){this._setDisabled(e)},e.prototype._setMandatory=function(e){},e.prototype._onmessage=function(e){var t=this._iframe();t&&t.contentWindow&&e.source===t.contentWindow&&e.data&&("string"==typeof e.data&&0<=e.data.indexOf("[iFrameSizer]")||this.fieldOptions&&this.fieldOptions.messages&&e.data.action&&this.fieldOptions.messages[e.data.action]&&this.form.execAction(this.fieldOptions.messages[e.data.action],e.data.action,e.data))},e.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;if(e){var t=this._iframe();t&&this.state.value&&(t.src=u(this.state.value,this.renderOptions)),this._setDisabled(e),this._setReadOnly(e),this.setHidden(e)}},e.prototype.changed=function(e,t,n,i){var o=this,r=o._iframe();if(o.state.value!==n){o.state.value=n;var s=o.$element?o.$element.get(0):null;if(r)r&&(o.state.value?r.src=u(o.state.value,o.renderOptions):r.iFrameResizer&&r.iFrameResizer.close());else if(o.state.value&&s){var a=d.find(s,o.id+"_parent"),l=$('<iframe src="'+u(o.state.value,o.renderOptions)+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>');d.append(a,l.get(0)),o._applyIResize()}}},e.prototype._applyIResize=function(){if(this.$element){if(!this._iframe())return;var e=$(this._iframe());this.state.value&&e.iFrameResize&&e.iFrameResize({})}},e.prototype.afterAddedInDom=function(){this._applyIResize()},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o))},e.prototype._iframe=function(){var e=this.$element.get(0);return e?e.firstChild.firstChild:null},e.prototype.setEvents=function(e){window.addEventListener("message",this._msghandler)},e.prototype.resize=function(e){if(e&&this.fieldOptions.refreshOnVisibilityChanged){var t=this._iframe();if(t){t.iFrameResizer&&t.iFrameResizer.close();var n=this.state.value;this.state.value="",this.changed(this.$bind,"",n,null)}}},e.prototype.removeEvents=function(){var e=this._iframe();e&&e.iFrameResizer&&e.iFrameResizer.close(),window.removeEventListener("message",this._msghandler)},e.prototype.destroy=function(){o.prototype.destroy.call(this),this._msghandler=null},e.prototype.render=function(e){var t,n,i,o,r=this,s=r._initOptions(l.utils.defaultOptions);return r.$element||(s.src=r.state.value,r.$element=$((t=r.id,n=s,i=r.options.design,o=[],l.utils.fieldWrapper(o,n,i,function(){o.push('<div id="{0}_parent">'),n.src&&o.push('<iframe scrolling="no" width="100%" frameBorder="0" border="0"></iframe>'),o.push("</div>")},null),a.format(o.join(""),t))),r._state2UI(),r.setEvents(s)),r.appendElement(e,s),r.$element},e}(e.ui.AbsField),i.registerControl(t,"string",!1,"iframe",{})}(Phoenix||(Phoenix={})),function(e){var t=e,i=t.ajax,c=(t.link,t.menubase,t.preferences,t.application,t.device,t.utils),p=(t.locale,e.contextmenu,t.dom);(e.geodecode||(e.geodecode={})).renderLeaflet=function(s,a,l,u,d){!function(e,o,t){if(!e||!e.length)return t(null);if(!o.address)return t(null);var r=[];if(e.forEach(function(e){if(void 0===e.model(!0)[o.latitude]){var t=encodeURIComponent("location.LLL"+e[o.address]);if(window.localStorage){var n=window.localStorage.getItem(t);if(n)return n=JSON.parse(n),e[o.latitude]=n.lat,void(e[o.longitude]=n.lng)}r.push(e)}}),!r.length)return t(null);var n=r.map(function(e){return i.get("https://maps.googleapis.com/maps/api/geocode/json?key="+c.gGeodecodeKey+"&address="+encodeURIComponent(e[o.address]))});c.Promise.all(n).then(function(e){e.forEach(function(e,t){var n=r[t];if(e&&e.results&&e.results.length&&(n[o.latitude]=e.results[0].geometry.location.lat,n[o.longitude]=e.results[0].geometry.location.lng,window.localStorage)){var i=encodeURIComponent("location.LLL"+n[o.address]);window.localStorage.setItem(i,JSON.stringify(e.results[0].geometry.location))}}),t(null)}).catch(function(e){return t(e)})}(l,u,function(e){if(e)return a.addError(e.message),d(e);var t,n;t=function(e){if(e)return a.addError(e.message),d(e);if(p.empty(s),!l.length)return d(null,null);var t=null;l.enumSelectedItems("",function(e){t||(t=e)}),t||(t=l.get(0));var n=window.L;if(!n)return d(null,null);var i=13,o=[t[u.latitude],t[u.longitude]];0===o[0]&&0===o[1]&&(i=1);var r=n.map(s).setView(o,i);return n.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(r),d(null,r)},n={execute:function(t){var e=document.getElementsByTagName("head")[0],n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css",n.media="all",e.appendChild(n),i.getScript("https://unpkg.com/leaflet@1.3.1/dist/leaflet.js").then(function(){t(null)}).catch(function(e){t(e)})}},i.loadScript("leaflet",null,t,n)})}}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,l=i.utils,u=i.customData,o=i.ui,d=i.geodecode,c=i.Observable.SchemaUtils,p=i.dom,a=i.uiutils;t||(t={}),n=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._setDisabled=function(e){},e.prototype._setReadOnly=function(e){this._setDisabled(e)},e.prototype._setMandatory=function(e){},e.prototype.destroy=function(){if(this._mapItems=null,this._map){try{this._map.remove()}catch(e){}this._map=null}o.prototype.destroy.call(this)},e.prototype._renderMap=function(){var r=this;r._mapItems={},r._map&&(r._map.remove(),r._map=null);var s={address:r.renderOptions.address,latitude:r.renderOptions.latitude,longitude:r.renderOptions.longitude},a=null;r.renderOptions.popupFactory&&(a=u.get(r.renderOptions.popupFactory)),l.nextTick(function(){d.renderLeaflet(p.find(r.$element.get(0),r.id+"_parent"),r.form.$model,r.state.value,s,function(e,t){if(t){r._map=t;var o=window.L;r.state.value.forEach(function(e){if(0!==e[s.latitude]||0!==e[s.longitude]){r._mapItems[e.id]=e;var t=o.marker([e[s.latitude],e[s.longitude]]).addTo(r._map);if(a){var n='<div data-map-popup="'+e.id+'">'+a(e)+"</div>",i=t.bindPopup(n);e.$select&&i.openPopup()}}})}})})},e.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this._renderMap(),this._setDisabled(e),this._setReadOnly(e),this.setHidden(e))},e.prototype.click=function(e){if("#"===(p.attr(e.target.parentNode,"href")||p.attr(e.target,"href"))&&e.preventDefault(),!this.state.isDisabled&&!this.state.isReadOnly){var t=p.findByAttribute(e.target,this.$element.get(0),"data-map-popup");if(t){var n=this._mapItems[p.attr(t,"data-map-popup")];if(!n)return;var i=p.findByAttribute(e.target,this.$element.get(0),"data-bind");if(i){var o=p.attr(i,"data-bind");if(c.isLink(o)){var r=n.getState(o);return void(r&&!r.isDisabled&&this.form.execAction(this.$bind+".$item."+o,n))}}}}},e.prototype.changed=function(e,t,n,i,o){var r=this;if(r.$element&&!(0<=e.substr(r.$bind.length).indexOf(".$selected"))){var s=r.renderOptions,a=!1;o.checkChildren&&"propchange"===i&&e===r.$bind&&(r.state.value=r.form.getValue(r.$bind),r.state.value&&(r.state.value.allowSelecting=s.selecting&&(s.selecting.row||s.selecting.cell),r.state.value.expandingProperty=s.expandingProperty));switch(r.state.value||(i="none"),i){case"propchange":if(e===r.$bind)a=!0;else{var l=e,u=c.parsePath(r.$bind,l,s.expandingProperty);if(o[u])if(!e.substr(u.length+1))return}break;case"remove":case"add":a=!0}a&&r._state2UI()}},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o))},e.prototype.customOptions=function(e){o.prototype.customOptions.call(this,e),e.latitude||console.log("openstreet-array: options.latitude is missing"),e.longitude||console.log("openstreet-array: options.longitude is missing")},e.prototype.render=function(e){var t,n,i,o,r=this,s=r._initOptions(a.utils.defaultOptions);return r.$element||(s.src=r.state.value,r.$element=$((t=r.id,n=s,i=r.options.design,o=[],a.utils.fieldWrapper(o,n,i,function(){n.height=n.height||450,o.push('<div id="{0}_parent" style="height:'+n.height+'px; "></div>')},null),l.format(o.join(""),t))),r._state2UI(),r.setEvents(s)),r.appendElement(e,s),r.$element},e}(e.ui.AbsField),o.registerControl(n,"array",!1,"openstreet-array",{})}(Phoenix||(Phoenix={})),function(e){var r,t,n=e,a=n.utils,i=n.ui,s=n.dom,l=n.uiutils;e.gmapsviewer||(e.gmapsviewer={}),r=function(e){return"https://www.google.com/maps/embed/v1/place?key="+encodeURIComponent(a.gmapsKey)+"&q="+encodeURIComponent(e)},t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._setDisabled=function(e){},e.prototype._setReadOnly=function(e){this._setDisabled(e)},e.prototype._setMandatory=function(e){},e.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this._showaddress(),this._setDisabled(e),this._setReadOnly(e),this.setHidden(e))},e.prototype._showaddress=function(){var e=this,t=e._iframe(),n=e.$element?e.$element.get(0):null;if(t)t&&(e.state.value?t.src=r(e.state.value):s.remove(t));else if(e.state.value&&n){var i=s.find(n,e.id+"_parent"),o=$('<iframe id="'+e.id+'_frame" src="'+r(e.state.value)+'" scrolling="no" width="100%" height="'+e.renderOptions.height+'"  frameBorder="0" border="0"></iframe>');s.append(i,o.get(0))}},e.prototype.changed=function(e,t,n,i){this._iframe();this.state.value!==n&&(this.state.value=n,this._showaddress())},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o))},e.prototype._iframe=function(){var e=this.$element.get(0);return e?s.find(e,this.id+"_frame"):null},e.prototype.render=function(e){var t,n,i,o,r=this,s=r._initOptions(l.utils.defaultOptions);return r.$element||(s.src=r.state.value,r.$element=$((t=r.id,n=s,i=r.options.design,o=[],l.utils.fieldWrapper(o,n,i,function(){n.height=n.height||450,o.push('<div id="{0}_parent"></div>')},null),a.format(o.join(""),t))),r._state2UI(),r.setEvents(s)),r.appendElement(e,s),r.$element},e}(e.ui.AbsField),i.registerControl(t,"string",!1,"gmapsview",{})}(Phoenix||(Phoenix={})),function(t){var e=t,v=e.ajax,m=e.dom,g=e.utils,y=e.autoclose,_=(e.modal,e.pagecontrol),b=e.application,x=e.Observable.SchemaUtils,C=e.external,k=e.customData;!function(c){var l=function(u){function e(e,t,n,i,o,r){var s=u.call(this,e,o)||this,a=s,l=e.opts?e.opts:{};return e.validators&&(l.validators=e.validators,delete e.validators),l._modalForm=!0,a.render=new c.Form(t,l,i,n,o,r),e.parentForm&&e.parentForm.form&&e.parentForm.form.addChildForm(a.render,null),a.render.$locale=o,s}return __extends(e,u),e.prototype.on=function(i){var o=this;o._clickHnd=function(e){o.render.afterchanged(e,"modal-action",{})},o.render.on(function(e,t,n){return i(o,e,t,n)})},e.prototype.onNatural=function(i){var o=this;o._clickHnd=function(e){o.render.afterchanged(e,"modal-action",{})},o.render.on(function(e,t,n){return i(e,t,n,o)})},e}(t.modal.Modal);function u(e){return"string"==typeof e?{message:e}:e}c.ModalForm=l;var d=function(e,t,n,i,o,r){var s,a=0,l=-1,u=-1,d=[],c={locale:i},p=-1,h=-1,f=b.config(b.name);o=o||{},i&&i.$name&&(o.externalLocale=i.$name),n&&n.then?(d.push(n),p=0,a++):c.data=$.extend(!0,{},n),"object"==typeof e?(c.layout=$.extend(!0,{},e),o.preferences&&(s=c.layout.name)):(l=a,a++,o.externalLayout=e,o.preferences&&(s=e),d.push(v.get(f.current.forms+"/"+e+".json"))),"object"==typeof t?c.schema=$.extend(!0,{},t):(u=a,a++,o.externalSchema=t,d.push(v.get(f.current.prototypes+"/"+t+".json")));var m=o.design?null:function(e,t){var n="";if(e&&b.name&&(n=b.name+"_form_"+e),n&&t&&t.current&&t.current.preferences){var i=t.current.preferences;i.excludedForms&&0<=i.excludedForms.indexOf(n)&&(n="")}return n}(s,f);m&&C.preferenceLoadHandler&&(h=a,a++,o.preferenceName=m,d.push(C.preferenceLoadHandler(m))),d.length?g.Promise.all(d).then(function(e){0<=l&&(c.layout=e[l]),0<=u&&(c.schema=e[u]),0<=p&&(c.data=e[p]),0<=h&&(c.preferences=e[h]),r(null,o,c)}).catch(function(e){r(e,null,null)}):r(null,o,c)},s=function(s,e,t,n,i,a){d(e,t,n,i,null,function(e,t,n){if(e)return console.log(e),e=(e=u(e))._ajax?v.extractAjaxErrors(e):e,s&&s.module&&s.module.error?s.module.error(e):void g.alert("",e.message,function(){});var i,o,r;(s=s||{}).opts=s.opts||{},t&&g.merge(t,s.opts),i=s,o=n,r=a,x.loadSchemaRefs(o.schema,o.data,o.layout,null,i.parentForm,i,function(e,t){if(e)return console.log(e),e=(e=u(e))._ajax?v.extractAjaxErrors(e):e,i&&i.module&&i.module.error?i.module.error(e):void g.alert("",e.message,function(){});var n=new l(i,o.layout,o.schema,t,o.locale,o.preferences);n.open(),r&&(i.natural?n.onNatural(r):n.on(r))})})},p=function(e,t){t.isFormController?e.beforeSetModel=t.beforeSetModel?t.beforeSetModel.bind(t):null:e.beforeSetModel=t.initObjectState?t.initObjectState.bind(t):null,e.beforeModelCreated=t.initModel?t.initModel.bind(t):null,e.onSettings=t.onSettings?t.onSettings.bind(t):null,e.storageName=t.storageName,e.validators=t.validators,e.checkFormLayout=t.checkFormLayout},n=function(e,t){if(!e.controller)throw"Controller name is empty.";var n="string"==typeof e.controller?k.get(e.controller):e.controller;if(!n)throw g.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var i={};p(i,n);var o=e.options;o.opts=i,o.parentContext=e.parentContext,o.parentForm=e.parentForm,o.natural=!0;var r=null;n.isFormController?r=n.modelChanged.bind(n):n.onModelChanged&&(r=n.onModelChanged.bind(n)),o._modalForm=!0,s(o,e.name,e.meta,t,e.locale,r)},i=function(e,t,n){if(!e.controller)throw"Controller name is empty.";var i="string"==typeof e.controller?k.get(e.controller):e.controller;if(!i)throw g.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var o={};p(o,i);var r=e.options;(r=o).natural=!0,r.parentContext=e.parentContext;var s=null;i.isFormController?s=i.modelChanged.bind(i):i.onModelChanged&&(s=i.onModelChanged.bind(i)),r.autoClose=e.autoClose,f(null,e.name,e.meta,t,null,s,e.parentForm,r,n)},h=function(n,i,o,r,s,a){x.loadSchemaRefs(i.schema,i.data,i.layout,r?r.parentContext:null,s,r,function(e,t){if(e)return console.log(e),e=(e=u(e))._ajax?v.extractAjaxErrors(e):e,r&&r.module&&r.module.error?r.module.error(e):void g.alert("",e.message,function(){});i.data=t,function(e,r,s,a,l,u){if((a=a||{design:!1})&&a.autoClose){var d=a.autoClose,t={parent:d.parentId?m.find(null,d.parentId):null,alignElement:d.alignElementId?m.find(null,d.alignElementId):null,style:d.style,parents:d.parents,opener:d.opener,width:d.width,height:d.height,minWidth:d.minWidth,minHeight:d.minHeight,stayOnTop:d.stayOnTop,beforeClose:d.beforeClose,contentRender:function(e,t,n){try{var i=a;a.opts&&(a=a.opts||{}),i!==a&&i.parentContext&&(a.parentContext=i.parentContext,i.parentContext=null),d.showCloseButton&&(a.closeButtonHandler=function(){_.Page().setPopup(null)});var o=new c.Form(r.layout,a,r.data,r.schema,r.locale,r.preferences);l&&l.form.addChildForm(o,null),o.$locale=r.locale,o.autoClose=t,o.render(e),s&&o.on(s),t.renderControl=o,n(),u&&u(o)}catch(e){n(e)}}};y.open(d.align,t)}else{var n=a;a.opts&&(a=a.opts||{},n.externalLayout&&(a.externalLayout=n.externalLayout),n.externalSchema&&(a.externalSchema=n.externalSchema)),n!==a&&n.parentContext&&(a.parentContext=n.parentContext,n.parentContext=null);var i=new c.Form(r.layout,a||{design:!1},r.data,r.schema,r.locale,r.preferences);l&&l.form&&l.form.addChildForm(i,null),i.$locale=r.locale,i.render(e),s&&i.on(s),u&&u(i)}}(n,i,o,r,s,a)})},f=function(i,e,t,n,o,r,s,a,l){d(e,t,n,o,a,function(e,t,n){if(e)return console.log(e),e=(e=u(e))._ajax?v.extractAjaxErrors(e):e,a&&a.module&&a.module.error?a.module.error(e):void g.alert("",e.message,function(){});t&&a&&a.parentContext&&(t.parentContext=a.parentContext),h(i,n,r,t,s,l)})};var e=function(){function e(){}return e.prototype.isFormController=function(){return!0},e.prototype.data=function(){return null},e.prototype.beforeSetModel=function(e,t){this.initObjectState(e,t),t&&t.hasNestedControllers()&&t.modelCreated(e)},e.prototype.initObjectState=function(e,t){},e.prototype.modelChanged=function(e,t,n,i){n.hasNestedControllers()&&n.modelChanged(e,t,n,i),this.onModelChanged(e,t,n,i)},e.prototype.onModelChanged=function(e,t,n,i){var o=e.property,r=e;if(o){this.bindProperty&&0===o.indexOf(this.bindProperty)&&(o=o.substr(this.bindProperty.length),r.property=o),0<=o.indexOf("$links.")&&(o=o.replace(/\$links\./g,""));var s="on"+o.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("").split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");if(this[s])return this[s](r,t,n,i)}},e}();c.FormController=e,k.register("phoenix.empty.controller",{onModelChanged:function(e,t,n,i){}}),c.loadSchema=function(e){if("object"==typeof e)return g.Promise.resolve($.extend(!0,{},e));var t=b.config(b.name);return v.get(t.current.prototypes+"/"+e+".json")},c.formController2Options=p,c.OpenModalForm=s,c.showModalForm=n,c.showAutoCloseForm=i,c.OpenForm=f,c.OpenInlineForm=function(e,t,n,i,o,r,s,a){var l={name:t,meta:n,controller:i,options:{},where:e,locale:r};l.parentForm=a,function(e,t,n){if(!e.controller)throw"Controller name is empty.";var i="string"==typeof e.controller?k.get(e.controller):e.controller;if(!i)throw g.format('Controller not found "{0}". Use customData.register(controllerName, ctrlConfig).',e.controller);var o={};p(o,i);var r=e.options;r.opts=o,r.parentContext=e.parentContext,r.natural=!0;var s=null;if(i.isFormController?s=i.modelChanged.bind(i):i.onModelChanged&&(s=i.onModelChanged.bind(i)),!e.where)throw"No form parent.";var a=m.find(null,e.where);if(!a)throw"No form parent.";f($(a),e.name,e.meta,n,e.locale,s,e.parentForm,r,t)}(l,s,o)},C.formOpenHandler=function(e){var t={name:e.name,meta:e.meta,controller:e.controller||"phoenix.empty.controller",options:e.options||{}};e.modal?n(t):(t.autoClose={align:y.BOTTOM_LEFT,opener:e.opener,alignElementId:e.alignElementId,style:e.style,parents:e.parents,width:e.width,height:e.height,minWidth:e.minWidth,minHeight:e.minHeight,showCloseButton:e.showCloseButton},i(t))}}(t.ui||(t.ui={}))}(Phoenix||(Phoenix={})),function(e){var t=e,c=t.utils,p=t.dom,h=t.ui,f=t.autoclose,n=t.pagecontrol,i=t.Observable,s=t.data,r=t.formgrid,m=i.SchemaUtils,v=t.locale;!function(e){var d={name:"$lookup",form:!0,datasets:{list:{$main:!0,$type:"odata",$method:"GET",$params:{$entity:"Country",$module:"",$top:5,$orderby:"",$searchByFields:void 0,$allData:!1}}},$type:"block",$items:[{$type:"block",$items:[{$bind:"search",$widget:"search",options:{autofocus:!0,search:"documents"}}]},{$type:"block",$items:[{$bind:"documents",options:{border:!0,scrolling:{horizontal:!0},sorting:!0,selecting:{row:!0,action:"selectAndClose"},columns:[]}}]}]},o=function(){function e(e,t,n){}return e.prototype._modelChanged=function(e,t,n,i){if("init"===e.operation)(r=t.documents).length&&r.selectItem(!0,t.documents.get(0),!1,"",!1);else if("form-validate"===e.property){if(this._onselect){var o=null;(r=t.documents).enumSelectedItems("",function(e){o||(o=e)}),this._onselect(o?o.model():null)}n.autoClose.explicitClose=!0,this.hide()}else if("documents"===e.property){var r;if("propchange"===e.operation)(r=t.documents).length&&r.selectItem(!0,t.documents.get(0),!1,"",!1)}else"documents.$item.$links.selectAndClose"===e.property&&(this._onselect&&this._onselect(e.actionParams.model()),n.autoClose.explicitClose=!0,this.hide())},e.prototype._checkFormLayout=function(n){var i=this;n.$schema.properties.search={title:v.ui.Search,type:"string"},n.$schema.properties.documents.$reference="list",i._lookupColumns||(i._lookupColumns=[],Object.keys(n.$schema.properties.documents.items.properties).forEach(function(e){var t=n.$schema.properties.documents.items.properties[e];t.title&&"object"!==t.type&&"array"!==t.type&&i._lookupColumns.push(e)})),n.$schema.properties.documents.items.links={selectAndClose:{}};var o=n.data.$items[1].$items[0].options.columns;i._lookupColumns.forEach(function(e){var t=e;"string"==typeof e&&(t={$bind:e}),t.$bind===i._searchField?o.splice(0,0,t):o.push(t)})},e.prototype._beforeClose=function(){if(this._form){var e=this._form,t=this._parentControl,n=this._focusParams;this._form=null,t&&t.focused&&(e.autoClose&&e.autoClose.explicitClose?t.setFocus&&t.setFocus(n):t.checkFocus&&t.checkFocus(n))}},e.prototype._checkPopup=function(){},Object.defineProperty(e.prototype,"opened",{get:function(){return!!this._form},enumerable:!0,configurable:!0}),e.prototype.focusInCombo=function(e){return!(!this._form||!this._form.autoClose)&&this._form.autoClose.inPopup(e)},e.prototype.show=function(e,t,i){var o=this;if(o._parentControl=t,o._focusParams=i.focusParams,o._lookup=i.lookup,o._lookupColumns=i.lookupColumns,o._onselect=i.onselect,!o._lookup.schema)throw"Invalid lookup definition. Foreign schema is missing.";var r=$.extend(!0,{},d);o._lookup.data&&o._lookup.data.$params&&o._lookup.data.$params.$allData&&(r.datasets.list.$params.$allData=!0);var n="string"==typeof o._lookup.schema?o._lookup.schema:$.extend(!0,{},o._lookup.schema),s=r.datasets.list,a=i.minWidth||0;if(i.alignElementId){var l=p.find(null,i.alignElementId);l&&(a=Math.max(l.offsetWidth,a)),a=Math.max(a,300)}$.extend(s.$params,e.$params),e.$transform&&(s.$transform=e.$transform),e.$type&&(s.$type=e.$type),s.$params.$orderby=void 0!==s.$params.$orderby?s.$params.$orderby:i.display?o._lookup.mapping[i.display]:"","enum"===s.$type&&(s.$value=o._lookup.data.$value);var u=i.display?o._lookup.mapping[i.display]:"";o._searchField=u,h.loadSchema(n).then(function(e){m.expandSchema$Ref(e);var t=m.searchableFields(e.properties.documents.items,e,null),n=[];s.$params.$searchByFields&&s.$params.$searchByFields.fields&&s.$params.$searchByFields.fields.length?n=s.$params.$searchByFields.fields:u&&n.push(u),t.forEach(function(e){n.indexOf(e.name)<0&&n.push(e.name)}),s.$params.$searchByFields={fields:n,value:i.search?i.search:""},h.showAutoCloseForm({name:r,meta:e,controller:{onModelChanged:o._modelChanged.bind(o),checkFormLayout:o._checkFormLayout.bind(o)},autoClose:{align:f.BOTTOM_LEFT,opener:i.openerId,parents:i.openerId?[i.openerId]:void 0,alignElementId:i.alignElementId,beforeClose:o._beforeClose.bind(o),minWidth:a,showCloseButton:!1},parentContext:i.itemModel?i.itemModel:o._parentControl.form.$model,options:{}},null,function(e){o._form=e})})},e.prototype.hide=function(){this._form&&n.Page().setPopup(null);this._parentControl=null,this._focusParams=null,this._lookup=null,this._onselect=null,this._lookupColumns=null},e.prototype.destroy=function(){this.hide()},e}();e.GridItems=o;var t={checkGridPopup:function(e,t,n,i){return new o($(i),n,{primaryKey:t.primaryKey})},closeGridLookup:function(t,e,n){t[n]&&t[n].opened&&e.push(null,function(e){t[n]&&t[n].opened&&t[n].hide()},!0)},checkGridLookup:function(e,t,n,i,o){var r=c.copy(e);if("enum"===e.data.$type)return r.schema={type:"object",primaryKey:"code",properties:{documents:{type:"array",items:{type:"object",primaryKey:"code",properties:{code:{type:"string",capabilities:""},title:{title:v.ui.title,type:i?i.type:"string"}}}}}},r.primaryKey="code",r;if("relation"!==e.data.$type)return e;var s=t.getSchema(null),a=e.data.$params.relation,l=t;"."===a.charAt(0)?(a=a.substring(2),l=n):"/"===a.charAt(0)&&(a=a.substring(1),o=""),o&&a.indexOf(o)<0&&(a=o+"."+a);var u=m.expand$Ref(l.getSchema(a),s);return u.items=m.expand$Ref(u.items,s),r.schema={type:"object",properties:{documents:u}},r.primaryKey=r.schema.properties.documents.items.primaryKey,r},openGridLookup:function(e,t){var n=$.extend(!0,{},t.lookup.data);if(n&&n.$params&&n.$params.relation&&t.bind&&"/"!==n.$params.relation.charAt(0)){var i=e.$bind.split(".");if(i.pop(),i.length){var o=i.join(".");n.$params.relation.indexOf(o)<0&&(n.$params.relation=o+"."+n.$params.relation)}}var r={alignElementId:t.align,openerId:t.openerId,lookup:t.lookup,lookupColumns:t.lookupColumns,display:t.display,onselect:t.onselect,search:t.searchText,minWidth:t.minWidth,itemModel:t.itemModel};n&&n.$params&&n.$params.$filter&&"find"!==n.$type&&(n.$params.$filter=s.replaceFilterVars(n.$params.$filter,t.formControl.getParentModel(t.bind).model(!0))),n.$params&&t.containerId&&(n.$params.containerId=t.containerId),n.$params&&t.viewId&&(n.$params.viewId=t.viewId),t.selected&&(n.$params.selected=t.selected),e[t.propertyName].show(n,t.parentControl,r)}};e.utils={checkGridPopup:t.checkGridPopup,closeGridLookup:t.closeGridLookup,openGridLookup:t.openGridLookup,checkGridLookup:t.checkGridLookup},r.gridlookup=e.utils}(e.gridlookup||(e.gridlookup={}))}(Phoenix||(Phoenix={})),function(i){!function(e){i.utils,i.ui;var r=i.Observable.errorsUtils,a=i.dom,t=(i.ulocale,function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._item=function(e){if(!this.$element)return null;var t=this.$element.get(0);return a.find(t,this.id+"_item_"+e)},e.prototype.click=function(e){var t=e.target;if(!this.state.isReadOnly){var n=t.id?t.id:t.parentNode.id;if(n){"#"===(a.attr(t,"data-phoenix-href")||a.attr(t,"href"))&&e.preventDefault();var i=this.id+"_item_";if(0===n.indexOf(i)){var o=parseInt(n.substring(i.length),10),r=this.$schema.enum[o],s=this.$schema.enum.indexOf(this.getInternalValue());if(this.renderOptions.wizard&&0<=s&&0<=o&&0<o-s)return;r!==this.getInternalValue()&&this.setInternalValue(r,!0)}}}},e.prototype._setDisabled=function(e){if(e){var n=this;n._enumItems(function(e,t){e.disabled=n.state.isDisabled||n.state.isReadOnly})}},e.prototype._enumItems=function(i){var o=this;o.$schema.enum.forEach(function(e,t){var n=o._item(t);i(n,e)})},e.prototype._setMandatory=function(e){},e.prototype._state2UI=function(e){var t=this.$element?this.$element.get(0):null;if(t){var n=this.$schema.enum.indexOf(this.getInternalValue());if(0<=n){var i=this._item(n);i&&e(i)}this._setDisabled(t),this.setHidden(t),this._setErrors(t)}},e.prototype._setErrors=function(e){var t=this.state.errors;if(e&&i.bootstrap4){var n="is-invalid";t&&t.length?a.addClass(e,n):a.removeClass(e,n)}this.showErrors(e,t)},e.prototype._getDefaultItem=function(){if(this.$element?this.$element.get(0):null){var e=this.$schema.enum.indexOf(this.getInternalValue());return 0<=e?this._item(e):void 0}},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,n._setDisabled(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,n._setMandatory(o)),e&&"errors"!==e||r.errorChanged(n.state.errors,i.errors)&&(n.state.errors=i.errors,n._setErrors(o))},e}(i.ui.AbsField));e.Group=t}(i.groupctrl||(i.groupctrl={}))}(Phoenix||(Phoenix={})),function(e){var t,n,a,i,l,o,u,r;n=t||(t={}),a=e.utils,i=e.ui,l=e.dom,e.groupctrl,o=e.ulocale,u=e.uiutils,r=function(s){function e(e,t,n){var i=s.call(this,e,t,n)||this;return i._state(),i}return __extends(e,s),e.prototype._state2UI=function(){var t=this.renderOptions.binary?"bactive":"active";s.prototype._state2UI.call(this,function(e){l.addClass(e,t)})},e.prototype.changed=function(e,t,n,i){var o=this.renderOptions.binary?"bactive":"active";if(this.getInternalValue()!=n){if(this.setInternalValue(n,!1),!this.$element)return;var r=this.getInternalValue();s.prototype._enumItems.call(this,function(e,t){r===t?l.addClass(e,o):l.removeClass(e,o)})}},e.prototype.mousedown=function(e){this.options.design||e.preventDefault(),this.setFocus()},e.prototype.focusIn=function(e){},e.prototype.focusOut=function(e){},e.prototype.setFocus=function(e){if(!this.renderOptions.readOnly){var t=this.form.getState(this.$bind);if(!t.isDisabled&&!t.isHidden)if(this.$element)l.find(this.$element.get(0),this.id+"_grp").focus()}},e.prototype.keydown=function(e){var t=this;if(!t.state.isReadOnly&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var n=e.which||e.keyCode,i=t.getInternalValue();switch(n){case l.keys.VK_LEFT:var o=t.$schema.enum.indexOf(i);if(0<o){var r=t.$schema.enum[o-1];t.form.setValue(t.$bind,r)}break;case l.keys.VK_RIGHT:var s=t.$schema.enum.indexOf(i);if(0<=s&&s<t.$schema.enum.length-1){r=t.$schema.enum[s+1];t.form.setValue(t.$bind,r)}}}},e.prototype.render=function(e){var t=this,n=t._initOptions(u.utils.defaultOptions);if(!t.$element){var i=t.$schema.enumNames||t.$schema.enum;i=i.map(function(e){return o.tt(e,t.form.$locale)}),t.$element=$(function(e,n,t,i,o,r){i=i||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var s=[];return u.utils.fieldWrapper(s,n,t,function(){var e=!n.columns&&!n.inline;if(!n.titleIsHidden){s.push('<label id="{0}_label" for="{0}_grp" ');var t=["bs-label"];n.columns?(t.push("col-form-label"),t.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&t.push("text-left")):n.inline&&(t.push("form-check-inline"),t.push("bs-cursor-d no-x-padding")),t.length&&s.push(' class="'+t.join(" ")+'"'),s.push(">"),s.push(a.escapeHtml(i||"")+(n.inline?"&nbsp;":"")),s.push("</label>")}u.utils.addErrorDiv(s),n.columns&&s.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),e&&s.push("<div>"),s.push('<ul id="{0}_grp" tabindex="0" class="'+["no-y-margin d-inline-flex pagination"].join(" ")+'">'),o.forEach(function(e,t){s.push('<li id="{0}_item_'+t+'" class="page-item">'),s.push('<a tabindex="-1" href="#" class="page-link bs-nowrap"'),n.width&&s.push(' style="width:'+n.width+'"'),s.push(">"),s.push(a.escapeHtml(r[t]||"")),s.push("</a>"),s.push("</li>")}),s.push("</div>"),e&&s.push("</div>")}),n.columns&&s.push("</div>"),a.format(s.join(""),e)}(t.id,n,t.options.design,o.tt(t.$schema.title,t.form.$locale),t.$schema.enum,i)),t._state2UI()}return t.appendElement(e,n),t.$element},e}(e.groupctrl.Group),n.BtnGroup=r,i.registerControl(r,"*",!0,"grpbtn",null)}(Phoenix||(Phoenix={})),function(e){var t,n=e,s=n.utils,i=n.ui,a=(n.dom,n.uiutils);e.inlineform||(e.inlineform={}),t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype.destroy=function(){this.form=null,o.prototype.destroy.call(this)},e.prototype.render=function(e){var t,n,i,o,r=this._initOptions(a.utils.defaultOptions);return this.$element||(this.$element=$((t=this.id,n=r,i=this.options.design,o=[],a.utils.fieldWrapper(o,n,i,function(){o.push('<div id="{0}_parent">'),o.push("</div>")},null),s.format(o.join(""),t))),this._state2UI(),this.setEvents(r)),this.appendElement(e,r),this.$element},e.prototype.afterAddedInDom=function(){this._canRenderForm=!0,this._state2UI()},e.prototype._state2UI=function(){var t=this;if((t.$element?t.$element.get(0):null)&&t._canRenderForm&&!t._formRendered){t._formRendered=!0;var e=t.renderOptions;e.pageName&&i.OpenInlineForm(t.id+"_parent",e.layout,e.meta,e.controller||"phoenix.empty.controller",e.data||{$create:!0},e.locale,function(e){t.inlineForm=e},{form:t.form,name:e.pageName})}},e}(e.ui.AbsField),i.registerControl(t,"*",!1,"form",null)}(Phoenix||(Phoenix={})),function(l){var e,t,u=l.utils,n=l.ui,r=l.dom,i=l.ulocale,d=l.uiutils;e=l.formlabel||(l.formlabel={}),t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype.isMeta=function(){return!!(this.config&&this.config.options&&this.config.options.$bind)},e.prototype.setParentId=function(e){this._parentId=e},e.prototype.getCustomBind=function(){return this.config&&this.config.options&&this.config.options.$bind?this.config.options.$bind:o.prototype.getCustomBind.call(this)},e.prototype._setDisabled=function(e,t){},e.prototype._setReadOnly=function(e,t){},e.prototype._setMandatory=function(e,t){var n=this.state.isMandatory,i=this._label();i&&r.text(i,this.renderOptions.title+(n?" *":"")+(this.renderOptions.inline?String.fromCharCode(160):""))},e.prototype._label=function(){return this.$element?r.find(this.$element.get(0),this.id+"_label"):null},e.prototype._state2UI=function(){var e=this._label(),t=this.$element?this.$element.get(0):null;e&&(this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t),this._setMandatory(e,t))},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n._label(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r))},e.prototype._title=function(){return this.$schema&&this.$schema.title?this.$schema.title:this.config&&this.config.options&&this.config.options.title?this.config.options.title:""},e.prototype.render=function(e){var t=this,n=t._initOptions(d.utils.defaultOptions);return t.$element||(n.title=i.tt(t._title(),t.form.$locale),t.$schema.description&&(n.description=i.tt(t.$schema.description,t.form.$locale)),t._parentId&&(n.parentId=t._parentId),t.parent&&"column"===t.parent.$type&&void 0===n.columns&&(n.columns=!0),t.$element=$(function(e,t,n,i){var o=l.bootstrap4;i=i||"";var r=(t=$.extend({columns:!1},t)).columns;t.columns=!1,r?t.styles="bs-field-group-labels":t.inline||(t.styles="no-y-margin");var s=[],a={formGroup:"form-group"};return r&&!o&&(a.formGroup+=" form-horizontal"),d.utils.fieldWrapper(s,t,n,function(){s.push('<label id="{0}_label"');var e=["bs-label"];r&&(e.push("col-form-label"),e.push("col-sm-12 bs-lib-col"),t.labelLeft&&e.push("text-left")),t.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&s.push(' class="'+e.join(" ")+'"'),t.parentId&&s.push(' for="'+t.parentId+'_input"'),s.push(">"),s.push(u.escapeHtml(i||"")+(t.inline?"&nbsp;":"")),d.utils.addTooltipAndRule(s,t),s.push("</label>")},a),u.format(s.join(""),e)}(t.id,n,t.options.design,n.title)),t._state2UI()),t.appendElement(e,n),t.$element},e}(l.ui.AbsField),e.Label=t,n.registerControl(t,"meta",!1,"label",null),n.registerControl(t,"*",!1,"label",null),n.registerControl(t,"*",!0,"label",null)}(Phoenix||(Phoenix={})),function(n){var e,t,i=n.utils,o=n.dom,s=n.history,a=n.uiutils,l=n.locale;e=n.formlinkbase||(n.formlinkbase={}),t=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o.$schema&&o.$schema.isSave&&o.form.registerListenerFor("containerHasChanges",o,"check-for-changes"),o._state(),i}return __extends(e,r),e.prototype._button=function(){return null},e.prototype._execClick=function(){var e=this;if(!e.renderOptions.back||e.$schema&&e.$schema.isCancel&&e.form.useSync)if(e._isBinded){var t=function(){e.renderOptions.back?window.history.back():(e.form.execAction(e.$bind),e.$schema.ux&&e.$schema.after&&e.form.execAction(e.$schema.after))};if(e.$schema&&e.$schema.isRemove)n.utils.confirm(e.form.$schema.title||l.ui.Warning,l.ui.removeWarning,function(){t()});else if(e.$schema&&e.$schema.isCancel&&e.form.useSync){if(e.form.$model.containerHasChanges)return void i.confirm(e.form.$schema.title||l.ui.Warning,l.ui.cancelWarning,function(){t()})}t()}else e.renderOptions.onChange&&e.renderOptions.onChange();else window.history.back()},e.prototype.click=function(e){var t=this;t.state.isDisabled||(t.$element&&t.$element.tooltip&&o.attr(t.$element.get(0),"data-phoenix-tooltip")&&t.$element.tooltip("hide"),t.renderOptions.confirm?i.confirm(t.renderOptions.confirm.title,t.renderOptions.confirm.message,function(){t._execClick()}):t._execClick())},e.prototype.customOptions=function(e){r.prototype.customOptions.call(this,e),this.$schema&&(this.$schema.description&&void 0===e.description&&(e.description=this.$schema.description),this.$schema.isSave?(void 0===e.icon&&(e.icon="floppy"),void 0===e.type&&(e.type="success")):this.$schema.isRemove&&(void 0===e.icon&&(e.icon="trash"),void 0===e.type&&(e.type="danger")))},e.prototype._setDisabled=function(e,t){if(this.$schema.isSave&&!this.state.isDisabled){var n=this.form.$model;e.disabled=!n.containerHasChanges}else e.disabled=this.state.isDisabled;this.state.isDisabled?o.addClass(e,"disabled"):o.removeClass(e,"disabled")},e.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null,t=this._button();this.renderOptions.back&&!s.hasBack()&&(this.fieldState().isHidden=!0),t&&(this._setDisabled(t,e),this.setHidden(e))},e.prototype.changed=function(e,t,n,i,o){if("check-for-changes"===o.targetId){var r=this.$element?this.$element.get(0):null,s=this._button();s&&this._setDisabled(s,r)}},e.prototype.stateChanged=function(e,t){var n=this;if("check-for-changes"!==t.targetId){var i=n.form.getState(n.$bind);n.renderOptions.back&&(i.isHidden=i.isHidden||!s.hasBack());var o=n._button(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r))}},e.prototype._renderButton=function(){return null},e.prototype.render=function(e){var t=this._initOptions(a.utils.defaultOptions);return this.$element||(this.$element=this._renderButton(),this._state2UI()),this.appendElement(e,t),this.setEvents(t),this.$element},e.prototype.destroy=function(){this.$schema.isSave&&this.form.unRegisterListenerFor("containerHasChanges",this)},e}(n.ui.AbsField),e.LinkBase=t}(Phoenix||(Phoenix={})),function(o){var l=o.utils,r=o.ui,u=o.dom,d=o.locale,c=o.uiutils,s=o.ulocale;!function(e){var a=["ADE","ADP","BAT","CHM","CMD","COM","CPL","DLL","DMG","EXE","HTA","INS","ISP","JAR","JS","JSE","LIB","LNK","MDE","MSC","MSI","MSP","MST","NSH","PIF","SCR","SCT","SHB","SYS","VB","VBE","VBS","VXD","WSC","WSF","WSH","CAB"];function n(e,t,n,i,o){i=i||"",void 0!==(t=$.extend({right:!1,icon:null,type:"default",size:null},t)).title&&(i=t.title);var r=[];if(!t.inline){var s=["bs-island","bs-field-group"];n&&s.push("design"),r.push('<div class="'+s.join(" ")+'"'),c.utils.addContainerId(r,n),r.push(">")}return t.buttonTag=t.buttonTag||"button",r.push("<"+t.buttonTag+' type="button"'),r.push(' class="bs-button btn btn-'+u.bootstrapStyles(t.outline||"secondary"===t.type||"default"===t.type)[t.type]),t.color&&r.push(" text-"+u.bootstrapStyles()[t.color]),t.buttonStyles&&r.push(" "+t.buttonStyles),o&&r.push(" bs-upload-button"),t.size&&r.push(" btn-"+t.size),t.inline?(r.push(" bs-btn-inline"),r.push(" bs-island"),t.right&&r.push(" float-right"),n&&r.push(" design")):r.push(" btn-block"),t.style&&r.push(" "+t.style),r.push('"'),t.inline&&c.utils.addContainerId(r,n),t.description&&r.push(' data-toggle="tooltip" data-phoenix-tooltip="true" data-placement="auto" title="'+t.description+'"'),r.push(">"),t.icon&&!t.iconRight&&r.push('<span class="'+u.iconClass(t.icon)+'"></span>'),t.titleIsHidden||(t.icon&&!t.iconRight&&r.push("&nbsp;"),r.push(i||""),t.icon&&t.iconRight&&r.push("&nbsp;")),t.icon&&t.iconRight&&r.push('<span class="'+u.iconClass(t.icon)+'"></span>'),o&&r.push('<input class="bs-hidden-upload" type="file" id="{0}_upload" name="{0}_upload" />'),r.push("</"+t.buttonTag+">"),t.inline||r.push("</div>"),l.format(r.join(""),e)}var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._button=function(){return this.$element?this.renderOptions.inline?this.$element.get(0):this.$element.get(0).firstChild:null},t.prototype._renderButton=function(){var e=this;return!e.title&&e.$schema&&e.$schema.isRemove&&(e.title=d.ui.Apply),!e.title&&e.$schema&&e.$schema.isSave&&(e.title=d.ui.Apply),!e.title&&e.$schema&&e.$schema.isCancel&&(e.title=d.ui.Abandon),$(n(e.id,e.renderOptions,e.options.design,s.tt(e.title,e.form.$locale),!1))},t}(o.formlinkbase.LinkBase);e.Link=t;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._button=function(){return this.$element?this.renderOptions.inline?this.$element.get(0):this.$element.get(0).firstChild:null},t.prototype.uploadInput=function(){var e=this.$element?this.$element.get(0):null;return e?u.find(e,this.id+"_upload"):null},t.prototype._renderButton=function(){return this.renderOptions.buttonTag="div",$(n(this.id,this.renderOptions,this.options.design,s.tt(this.title,this.form.$locale),!0))},t.prototype.setEvents=function(e){var s=this,t=s.uploadInput();t&&$(t).on("change",function(e){if(s.form.isInProcessing)return s.form.freeze(e);var t=e.target.files,n=s.form.$model.getParentOf(s.$bind,null).$errors[s.$bind];if(n&&n.clear(!0),t&&t.length){var i=t[0].name,o=i.split("/");o=(i=(o=(i=o[o.length-1]).split("\\"))[o.length-1]).split("."),s.form.setValue(s.$bind,i);var r=1<o.length?o[o.length-1].toUpperCase():"";if(0<=a.indexOf(r))return void(n&&n.addError(d.errors.invalidUploadFileName));if(t[0].size&&25<t[0].size/1e6)return void(n&&n.addError(d.errors.invalidUploadFileSize))}})},t.prototype.removeEvents=function(){var e=this.uploadInput();e&&$(e).off("change")},t}(o.formlinkbase.LinkBase);e.UploadLink=i,r.registerLinkControl(t,"button"),r.registerControl(i,"string",!1,"upload",null)}(o.formlink||(o.formlink={}))}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,o=(e.utils,e.ui),r=(e.dom,i.Observable.SchemaUtils),l=(e.uiutils,e.ctrlsinterfaces);e.ulocale;t||(t={}),n=function(s){function a(e,t,n){var i;e=a.beforeCreateControl(e);var o=i=s.call(this,e,t,n)||this,r=o.form.getSchema(o.fieldOptions.bind);return r&&"array"===r.type||console.log("Invalid columns-array element, $bind is invalid."),o.fieldOptions.gridName||console.log("Invalid columns-array element, options.gridName must be  a valid grid name."),i}return __extends(a,s),a.beforeCreateControl=function(e){var t=$.extend(!0,{},e);return t.options=t.options||{},t.options.bind=t.$bind,t.$bind="$none",t},a.prototype.customOptions=function(e){var t=this;s.prototype.customOptions.call(this,e),e.icon="wrench",e.titleIsHidden=!0,e.onChange=function(){t.options.design||t._openColumns()}},a.prototype._getGroupsFromSchema=function(){var e=this.form.getSchema(this.fieldOptions.bind),t=r.expand$Ref(e.items,this.form.$rootSchema);return e&&"array"===e.type&&t&&"object"===t.type&&t.groups?t.groups:{}},a.prototype._filtrableColumns=function(){var e=this.form.getSchema(this.fieldOptions.bind),t=r.expand$Ref(e.items,this.form.$rootSchema);return e&&"array"===e.type&&t&&"object"===t.type?r.filtrableFields(t,this.form.$rootSchema,this.form.$locale):[]},a.prototype._getColumnsForSettings=function(e){return{schemaGroups:this._getGroupsFromSchema(),schemaColumns:e.getColumnsFromSchema(),selectedColumns:e.getSelectedColumns(),locale:this.form.$locale}},a.prototype._openColumns=function(){this.form.getValue(this.renderOptions.bind);var t=this.form.controlByName(this.renderOptions.gridName,!1);if(t=t&&t.length?t[0]:null){var e=this._getColumnsForSettings(t);return l.glbGridSettings(e,function(e){t.setColumns(e)})}},a}(e.formlink.Link),o.registerControl(n,"*",!0,"columns-array",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i=e,o=e.ui,r=i.Observable.SchemaUtils,l=e.ctrlsinterfaces;t||(t={}),n=function(s){function a(e,t,n){var i;e=a.beforeCreateControl(e);var o=i=s.call(this,e,t,n)||this,r=o.form.getSchema(o.fieldOptions.bind);return r&&"array"===r.type||console.log("Invalid filter-array element $bind is invalid."),i}return __extends(a,s),a.beforeCreateControl=function(e){var t=$.extend(!0,{},e);return t.options=t.options||{},t.options.bind=t.$bind,t.$bind="$none",t},a.prototype.customOptions=function(e){var t=this;s.prototype.customOptions.call(this,e),e.icon="filter",e.titleIsHidden=!0,e.onChange=function(){t.options.design||t._openFilter()}},a.prototype._getGroupsFromSchema=function(){var e=this.form.getSchema(this.fieldOptions.bind),t=r.expand$Ref(e.items,this.form.$rootSchema);return e&&"array"===e.type&&t&&"object"===t.type&&t.groups?t.groups:{}},a.prototype._filtrableColumns=function(){var e=this.form.getSchema(this.fieldOptions.bind),t=r.expand$Ref(e.items,this.form.$rootSchema);return e&&"array"===e.type&&t&&"object"===t.type?r.filtrableFields(t,this.form.$rootSchema,this.form.$locale):[]},a.prototype._getColumnsForFilter=function(e){var t=this.form.getValue(this.renderOptions.bind),n={schemaGroups:this._getGroupsFromSchema(),schemaColumns:this._filtrableColumns(),locale:this.form.$locale,mongoFilter:e,filters:void 0};return e&&l.glbMongoFilter2Filter&&(n.filters=l.glbMongoFilter2Filter(t.filter,this._filtrableColumns())),n},a.prototype._openFilter=function(){var t=this.form.getValue(this.renderOptions.bind),n=!t.isQuery;return l.glbGridFilter(this._getColumnsForFilter(n),function(e){t.filterManager=t.filterManager||(o.filterManagerFactory?o.filterManagerFactory():null),n?t&&(t.filterManager.filterExpress=null,t.filter=e.value):(t.filterManager.filterComplex=e,t.filter=t.filterManager.constructeFilter())},null,{large:!0})},a}(e.formlink.Link),o.registerControl(n,"*",!0,"filter-array",null)}(Phoenix||(Phoenix={})),function(s){var e,t,n,l,a,o,u,d,i,c,p,r;e=s.formlookup||(s.formlookup={}),n=(t=s).ui,l=t.Observable.SchemaUtils,a=t.data,o=t.utils,u=t.customData,d=s.gridlookup,i=t.dom,p={autoComplete:!(c=function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey}),maxItems:-1},r=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o.lookupOptions=p,o.eventBus=new s.serial.SingleEventBus(50),o.onselectItemHandler=o._onselectItem.bind(o),o.isEnum=o.$lookup&&o.$lookup.data&&"enum"===o.$lookup.data.$type,i}return __extends(e,r),e.prototype.customOptions=function(e){r.prototype.customOptions.call(this,e),e.after={icon:"chevron-down"},e.paginated=void 0!==e.paginated?e.paginated:l.supportPagination(this.$lookup)},e.prototype._value2Text=function(){return this.isEnum?function(e,t){if(""===e||null==e)return"";if(t&&t.data&&t.data.$value){for(var n=t.data.$value,i=0,o=n.length;i<o;i++){var r=n[i];if(r.code===e)return r.title}return e||""}return e||""}(this.state.value,this.$lookup):this.state.value||""},e.prototype._getSource=function(e){var t=this;e.$bind=t.$bind;var n=t.form.getParentModel(t.$bind);if(!t.$lookup.data||!t.$lookup.data.$type)return o.dataAsPromise(null);if("inline"!==t.$lookup.data.$type&&"enum"!==t.$lookup.data.$type)return l.allData(t.$lookup)?t.$lookup.cache&&t.hasCachedData?o.dataAsPromise(t.cachedData):(e.containerId=t.form.syncTransactionId(),e.viewId=t.form.syncViewId(),l.executeLookup(t.$lookup,t.form.getParentModel(t.$bind),e)):(e.fieldName=t.$lookup.mapping[t.$display],e.paginated=!0,e.containerId=t.form.syncTransactionId(),e.viewId=t.form.syncViewId(),l.executeLookup(t.$lookup,t.form.getParentModel(t.$bind),e));var i=(t.form,t.$lookup.data.$value);return o.dataAsPromise(function(e,t,n){if(e.value&&(e=e.value),t){var i=[],o=a.compileFilterTree(t,null,n,null);return e.forEach(function(e){a.acceptFilter(o,e)&&i.push(e)}),i}return e}(i,t.$lookup.data&&t.$lookup.data.$params?t.$lookup.data.$params.$filter:null,n.model(!0)))},e.prototype._filterResult=function(e,t){var n=this;if(e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(t.findFirst&&n.$lookup.data&&n.$lookup.data.$params&&(n.$lookup.data.$params.$allData||"relation"===n.$lookup.data.$type)){(o=n.$bind.split(".")).pop();var i=d.utils.checkGridLookup(n.$lookup,n.form.$model,null,n._schemaInput(),o.join("."));return(r=l.findFirst(t.search,l.remoteSearch(l.lastSegment(n.$bind,n.$display),i),e.documents))?{value:[r.item]}:null}e.value=e.documents,delete e.documents}if(l.allData(n.$lookup)){if(n.$lookup.cache&&!n.hasCachedData&&(n.hasCachedData=!0,n.cachedData=e),t.findFirst&&!t.search)return null;if(t.search&&e&&e.value&&t.findFirst){var o;(o=n.$bind.split(".")).pop();var r;i=d.utils.checkGridLookup(n.$lookup,n.form.$model,null,n._schemaInput(),o.join("."));return(r=l.findFirst(t.search,n.isEnum?"title":l.remoteSearch(l.lastSegment(n.$bind,n.$display),i),e.value))?{value:[r.item]}:null}}return e},e.prototype._findselected=function(e,t){if(t.search&&t.select&&e&&e.value){var n=this.$bind.split(".");n.pop();var i=d.utils.checkGridLookup(this.$lookup,this.form.$model,null,this._schemaInput(),n.join(".")),o=l.findFirst(t.search,this.isEnum?"title":l.remoteSearch(l.lastSegment(this.$bind,this.$display),i),e.value);if(o)return o.index}return-1},e.prototype._findValue=function(e,t){var n=this;if(e||""!==e){var i={search:e,select:!1,findFirst:!0,find:!1,paginated:n.renderOptions.paginated};n.eventBus.push(n._getSource(i),function(e){(e=n._filterResult(e,i))&&e.value&&e.value.length?t(e.value[0]):t(null)},!0)}else n.eventBus.push(null,function(e){t(null)},!0)},e.prototype._onselectItem=function(e){var a=this;a.eventBus.push(e,function(i){var e=Object.keys(a.$lookup.mapping),o=l.extractBase(a.$bind),r=[],s=!1;if(e.forEach(function(e){if(a.$lookup.mapping[e]){var t=a.form.getValue(o+e)||"",n=i&&i[a.$lookup.mapping[e]]||"";n!==t&&(a.form.setValue(o+e,n),s=!0)}else r.push(e)}),s&&r.forEach(function(e){a.form.setValue(o+e,a.$lookup.mapping[e])}),a.$lookup.customMapping){var t=u.get("lookup.mappings."+a.$lookup.customMapping);if(t)o&&(o=o.substr(0,o.length-1)),t(a.form.$model.getValue(o,null),i)}var n=a._input();n.value!=a._value2Text()&&a._value2Input(n)},!0)},e.prototype._checkPopupMenu=function(){var e=this;if(!e.menu){var t=e._input(),n=e.$element;e.renderOptions.columns&&(n=$(e._colParent()));var i=e.$bind.split(".");i.pop();var o=d.utils.checkGridLookup(e.$lookup,e.form.$model,null,e._schemaInput(),i.join("."));e.menu=new s.formdropitems.DropItems(n,t,{primaryKey:o.primaryKey,search:e.isEnum?"title":l.remoteSearch(l.lastSegment(e.$bind,e.$display),o),onselect:e.onselectItemHandler})}},e.prototype.mousedown=function(e){return this.menu&&this.menu.opened&&this.menu.inMenu(e.target)?(e.stopPropagation(),!1):r.prototype.mousedown.call(this,e)},e.prototype.stopProppagation=function(e){r.prototype.stopProppagation.call(this,e),this.menu&&this.menu.opened&&this.menu.inMenu(e.target)&&(e.preventDefault(),e.stopPropagation())},e.prototype._afterElement=function(){var e=this.$element?this.$element.get(0):null;return e?i.find(e,this.id+"_after"):null},e.prototype.click=function(e){this._input();i.isChildOf(this._afterElement(),e.target)?this.renderOptions.paginated?this._toggleGridLookup():this._toggleMenuLookup():this.menu&&this.menu.opened&&this.menu.inMenu(e.target)&&this.menu.click(e)},e.prototype.beforeAppend=function(){},e.prototype._searchText=function(){var e=this._input(),t=this._text2value(e.value);return this.equals(t)?"":t},e.prototype._managePreventDefault=function(e,t){var n;switch(e){case i.keys.VK_UP:case i.keys.VK_PGDOWN:case i.keys.VK_PGUP:case i.keys.VK_HOME:case i.keys.VK_END:n=!c(t);break;case i.keys.VK_DOWN:t.ctrlKey?(n=!0,e=i.keys.VK_F4):n=!c(t);break;default:n=!1}return n&&t.preventDefault()&&t.stopPropagation(),e},e.prototype._shouldTrigger=function(e,t){var n=!1;switch(e){case i.keys.VK_TAB:n=!c(t);break;default:n=!0}return n},e.prototype.setEvents=function(e){var t=this;$(t._input()).on("input",function(){t.inputChanged()})},e.prototype.removeEvents=function(){$(this._input()).off("input")},e.prototype.inputChanged=function(){var e=this._input();this.modified=e.value!=this._value2Text(),this._triggerEvent("inputChanged",null)},e.prototype.checkValue=function(e,t){var n=this,i=n._input();i.value!=n._value2Text()?n._findValue(i.value,function(e){n._onselectItem(e)}):t(n.state.value)},e.prototype.keydown=function(e){var t=e.which||e.keyCode;return(t=this._managePreventDefault(t,e))&&this._shouldTrigger(t,e)&&this._triggerKey(t,e),!0},e.prototype.focusIn=function(e){},e.prototype.focusOut=function(e){d.utils.closeGridLookup(this,this.eventBus,"gc"),this._closeMenuLookup(),r.prototype.focusOut.call(this,e)},e.prototype._triggerEvent=function(e,t){var n=this,i=n._input();if(n.menu&&n.menu.opened)switch(e){case"inputChanged":var o={search:i.value,select:!0,find:!1,findFirst:!1};n.eventBus.push(n._getSource(o),function(e){if(n.menu&&n.menu.opened){o.search=i.value,e=n._filterResult(e,o);var t=-1;o.select&&(t=n._findselected(e,o)),n.menu.show(e,t,!0)}},!1)}},e.prototype._checkGridPopup=function(){var e=this._input(),t=this.$element.get(0);this.renderOptions.columns&&(t=this._colParent()),this.gc=d.utils.checkGridPopup(this,this.$lookup,e,t)},e.prototype.focusInControl=function(e){var t=r.prototype.focusInControl.call(this,e);return!t&&this.gc&&this.gc.opened?this.gc.focusInCombo(e):t},e.prototype._openGridLookup=function(){var e=this;if(!e.gc||!e.gc.opened){e._checkGridPopup();var t=e.$bind.split(".");t.pop();var n=d.utils.checkGridLookup(e.$lookup,e.form.$model,null,e._schemaInput(),t.join("."));d.utils.openGridLookup(e,{lookup:n,parentControl:e,formControl:e.form,display:e.$display,bind:e.$bind,containerId:e.form.syncTransactionId(),viewId:e.form.syncViewId(),align:e.id+"_group",openerId:e.id+"_after",searchText:e._searchText(),onselect:e.onselectItemHandler,lookupColumns:e.fieldOptions?e.fieldOptions.lookupColumns:void 0,propertyName:"gc",minWidth:e.fieldOptions?e.fieldOptions.lookupMinWidth:0})}},e.prototype._toggleGridLookup=function(){this.gc&&this.gc.opened?d.utils.closeGridLookup(this,this.eventBus,"gc"):this.gc&&this.gc.opened||this._openGridLookup()},e.prototype._closeMenuLookup=function(){var t=this;t.menu&&t.menu.opened&&t.eventBus.push(null,function(e){t.menu&&t.menu.opened&&t.menu.hide(null)},!0)},e.prototype._toggleMenuLookup=function(){var n=this,e=n._input();if(n.menu&&n.menu.opened)n.menu&&n.menu.opened&&n._closeMenuLookup();else{n._checkPopupMenu();var i={search:e.value,select:!0,find:!1,findFirst:!1};n.eventBus.push(n._getSource(i),function(e){e=n._filterResult(e,i);var t=-1;i.select&&(t=n._findselected(e,i)),n.menu.show(e,t,!1)},!0)}},e.prototype._triggerKey=function(e,t){var n=this;if(n.menu&&n.menu.opened)switch(e){case i.keys.VK_ESCAPE:n.eventBus.push(null,function(e){n._closeMenuLookup()},!0);break;case i.keys.VK_ENTER:n.eventBus.push(null,function(e){n.menu.select()},!0);break;case i.keys.VK_UP:n.eventBus.push(null,function(e){n.menu.move(-1)},!0);break;case i.keys.VK_DOWN:n.eventBus.push(null,function(e){n.menu.move(1)},!0);break;case i.keys.VK_HOME:n.eventBus.push(null,function(e){n.menu.move(-1e3)},!0);break;case i.keys.VK_END:n.eventBus.push(null,function(e){n.menu.move(1e3)},!0);break;case i.keys.VK_PGDOWN:n.eventBus.push(null,function(e){n.menu.move(7)},!0);break;case i.keys.VK_PGUP:n.eventBus.push(null,function(e){n.menu.move(-7)},!0)}e===i.keys.VK_F4&&(n.renderOptions.paginated?n._toggleGridLookup():n._toggleMenuLookup())},e.prototype.destroy=function(){var e=this;e.onselectItemHandler=null,e.cachedData=null,e.eventBus&&(e.eventBus.destroy(),e.eventBus=null),e.menu&&(e.menu.destroy(),e.menu=null),e.gc&&(e.gc.destroy(),e.gc=null),r.prototype.destroy.call(this)},e.prototype.checkFocus=function(e){var t=this;o.nextTick(function(){var e=window.document.activeElement;e&&t.targetInControl(e)||(t.focusOut(null),t.focused=!1)})},e}(s.formedit.Edit),e.Lookup=r,n.registerControl(r,"string",!1,"",{lookup:!0}),n.registerControl(r,"number",!1,"",{lookup:!0}),n.registerControl(r,"integer",!1,"",{lookup:!0})}(Phoenix||(Phoenix={})),function(e){var t,n=e,a=n.utils,i=n.ui,r=n.dom,l=n.uiutils;e.msgcontrol||(e.msgcontrol={}),t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this._showMessage(),this.setHidden(e))},e.prototype._showMessage=function(){var e=this._input();e&&(r.empty(e),this.state.value&&(e.innerHTML=this.state.value))},e.prototype._input=function(){var e=this.$element?this.$element.get(0):null;return e?r.find(e,this.id+"_message"):null},e.prototype.changed=function(e,t,n,i){this.state.value!==n&&(this.state.value=n,this._showMessage())},e.prototype.stateChanged=function(e,t){var n=this.form.getState(this.$bind),i=this.$element?this.$element.get(0):null;n.isHidden!==this.state.isHidden&&(this.state.isHidden=n.isHidden,i&&this.setHidden(i))},e.prototype.render=function(e){var t,n,i,o,r=this,s=r._initOptions(l.utils.defaultOptions);return r.$element||(s.src=r.state.value,r.$element=$((t=r.id,n=s,i=r.options.design,o=[],l.utils.fieldWrapper(o,n,i,function(){n.type=n.type||"info",o.push('<div class="no-y-margin alert alert-'+n.type+'" role="alert">'),o.push('<p id="{0}_message"></p>'),o.push("</div>")},null),a.format(o.join(""),t))),r._state2UI(),r.setEvents(s)),r.appendElement(e,s),r.$element},e}(e.ui.AbsField),i.registerControl(t,"string",!1,"message",{})}(Phoenix||(Phoenix={})),function(d){var e,t,n,c,p,h,s,a,o,l,u,f,m,i;e=d.multifield||(d.multifield={}),n=(t=d).ui,c=d.utils,p=d.uiutils,h=d.dom,s=d.locale,a=d.Observable.SchemaUtils,o=d.ulocale,l=t.Observable.errorsUtils,u=function(e,t,n){var i=[],o=n?"search":"after";return i.push('<span  id="{0}_'+o+'" tabindex="-1" class="bs-grp-btn input-group-append'+(t.button?"":" input-group-addon")),t.icon&&i.push(" bs-icon-input"),i.push('">'),t.button?i.push('<button tabindex="-1" id="{0}_'+o+'text" class="bs-button btn btn-'+h.bootstrapStyles(!0).secondary+'">'):i.push('<span id="{0}_'+o+'text" class="input-group-text">'),t.icon?i.push('<span class="'+h.iconClass(t.icon)+'"></span>'):i.push(t.value),t.button?i.push("</button>"):i.push("</span>"),i.push("</span>"),$(c.format(i.join(""),e)).get(0)},f=function(e,t,n){var i=[];if(t.readOnly)i.push('<div id="{0}_input" class="form-control"></div>');else{var o=["form-control"];"uppercase"===t.mask&&o.push("text-uppercase"),n.enum?(i.push('<select class="form-control custom-select'),i.push('" id="{0}_input"'),i.push(">"),i.push("</select>")):(i.push('<input type="text" id="{0}_input" class="'+o.join(" ")+'"'),t.maxLength&&i.push('  maxLength="'+t.maxLength+'"'),i.push(">"))}var r,s,a,l,u=$(d.utils.format(i.join(""),e)).get(0);return n.enum&&(r=n,s=u,a=document.createDocumentFragment(),l=document.createElement("option"),h.append(a,l),r.enum.forEach(function(e,t){var n=document.createElement("option");h.attr(n,"value",e),n.textContent=r.enumNames[t],h.append(a,n)}),h.append(s,a)),u},m=function(e,s,a,l,t,u){u=u||"",s=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},s);var d=[];return s.placeHolder=!1,p.utils.fieldWrapper(d,s,t,function(){if(!s.titleIsHidden||s.columns){d.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];s.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+s.labelCol),s.labelLeft&&e.push("text-left")),s.inline&&e.push("form-check-inline bs-cursor-d no-x-padding"),e.length&&d.push(' class="'+e.join(" ")+'"'),d.push(">"),d.push(c.escapeHtml(u||"")+(s.inline?"&nbsp;":"")),p.utils.addTooltipAndRule(d,s),d.push("</label>")}s.columns&&d.push('<div class="no-x-padding col-sm-'+(12-s.labelCol)+'" id="{0}_colparent">'),d.push('<div class="input-group" id="{0}_group"');var n,i,o,t=[];if(s.minWidth&&t.push("min-width: "+s.minWidth+";"),s.maxWidth&&t.push("max-width: "+s.maxWidth+";"),t.length&&d.push('  style="'+t.join("")+'"'),d.push(">"),i=a,o=l,(n=d).push('<div class="input-group-prepend" tabindex="-1">'),n.push('<button id="{0}_select" class="btn btn-'+h.bootstrapStyles(!1).info+' dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>'),n.push('<div class="dropdown-menu">'),i.forEach(function(e,t){n.push('<a class="dropdown-item" data-select="'+i[t]+'" href="#">'),n.push(c.escapeHtml(o[t])),n.push("</a>")}),n.push("</div>"),n.push("</div>"),s.readOnly)d.push('<div id="{0}_input" class="form-control"></div>');else{var r=["form-control"];"uppercase"===s.mask&&r.push("text-uppercase"),d.push('<input type="text" id="{0}_input" class="'+r.join(" ")+'"'),s.maxLength&&d.push('  maxLength="'+s.maxLength+'"'),d.push(">")}d.push("</div>"),p.utils.addErrorDiv(d),s.columns&&d.push("</div>"),s.titleIsHidden&&p.utils.addTooltipAndRule(d,s)}),c.format(d.join(""),e)},i=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o._state(),o.renderOptions.useBind&&(o.renderOptions.field=o.form.getValue(o.$bind)),o.renderOptions.field?(o.form.registerListenerFor(o.renderOptions.field,o),o._schemaField=o.form.getSchema(o.renderOptions.field)):(o._schemaField=o._customSchemaField(),o._customStateOfField()),o._stateOfField(),i}return __extends(e,r),e.prototype.destroy=function(){this._removePlugins(),this.renderOptions.field&&this.form.unRegisterListenerFor(this.renderOptions.field,this),r.prototype.destroy.call(this)},e.prototype._customSchemaField=function(){return null},e.prototype._customStateOfField=function(){},e.prototype._changeField=function(e){var t=this;t.renderOptions.field?(t.renderOptions.field&&t.form.unRegisterListenerFor(t.renderOptions.field,t),t.renderOptions.field=e,t.form.registerListenerFor(t.renderOptions.field,t),t._schemaField=t.form.getSchema(t.renderOptions.field)):(t._schemaField=t._customSchemaField(),t._customStateOfField()),t._stateOfField(),t._afterFieldChanged()},e.prototype._isDate=function(){return this._schemaField&&a.isDate(this._schemaField)},e.prototype._isDateTime=function(){return this._schemaField&&a.isDateTime(this._schemaField)},e.prototype._isMemo=function(){return this._schemaField&&a.isText(this._schemaField)},e.prototype._isNumber=function(){return this._schemaField&&a.isNumber(this._schemaField)},e.prototype._isPassword=function(){return a.isPassword(this._schemaInput())},e.prototype._isMoney=function(){return this._schemaField&&a._isMoney(this._schemaField)},e.prototype._schemaInput=function(){return this._schemaField},e.prototype._places=function(){this._stateField.decimals;if(1e3===this.form.moneyUnitCoef)return 0},e.prototype._afterSearch=function(){return null},e.prototype._afterIcon=function(){if(this._isDate()){if(this.renderOptions.readOnly)return null;if(p.utils.useDatePicker())return{icon:"calendar"}}else if(this._isDateTime()){if(this.renderOptions.readOnly)return!0;if(p.utils.useDateTimePicker())return{icon:"calendar"}}else if(this._isNumber()&&this._stateField.symbol)return{value:this._stateField.symbol};return null},e.prototype._removePlugins=function(){!this.renderOptions.readOnly&&this.$element&&(p.utils.useDateTimePicker()&&p.utils.dateTimePickerDestroy($(h.find(this.$element.get(0),this.id+"_group"))),p.utils.useDatePicker()&&p.utils.datePickerDestroy(this.$element))},e.prototype._removeAfter=function(){var e=this.$element?this.$element.get(0):null;if(e){var t=h.find(e,this.id+"_after");t&&h.remove(t)}},e.prototype._removeSearch=function(){var e=this.$element?this.$element.get(0):null;if(e){var t=h.find(e,this.id+"_search");t&&h.remove(t)}},e.prototype._updateType=function(){var e=this;e._removeAfter(),e._removeSearch();var t=e._afterIcon(),n=(e.form.getSchema(e.renderOptions.bind),f(e.id,e.renderOptions,e._schemaField)),i=e._input();n.tagName!==i.tagName&&(i.parentElement.replaceChild(n,i),i=n);e.$element.get(0);e._isNumber()?h.addClass(i,"bs-edit-number"):h.removeClass(i,"bs-edit-number");var o=i;if(t){var r=u(e.id,t,!1);h.after(i,r),o=r}var s=e._afterSearch();if(s){r=u(e.id,s,!0);h.after(o,r)}},e.prototype.notifyGlobalChanged=function(e){"money-unit"===e&&(this._stateField.moneyUnitCoef=this.form.moneyUnitCoef,this._unitChanged())},e.prototype._unitChanged=function(){var e=this._input();this.$element&&this.$element.get(0);e&&(this._value2Input(e),this._setSymbol())},e.prototype._setErrors=function(e,t){if(!this.renderOptions.readOnly){var n=this.fieldState().errors,i="is-invalid";n&&n.length?(h.addClass(t,i),h.addClass(e,i)):(h.removeClass(t,i),h.removeClass(e,i)),this.showErrors(t,n)}},e.prototype._setSymbol=function(){var e=this,t=e._input();if(t&&e._isNumber()){var n=e._isMoney()?a.moneyUnitSymbol(e._stateField.moneyUnitCoef)+(e._stateField.symbol||""):e._stateField.symbol,i=h.find(e.$element.get(0),e.id+"_after");if(i)n?(i=h.find(e.$element.get(0),e.id+"_aftertext"),h.text(i,n)):h.remove(i);else if(n){u(e.id,{value:n},!1);i=u(e.id,{value:n},!1),h.after(t,i)}}},e.prototype._setPlugins=function(){var i=this;if(!i.renderOptions.readOnly&&i.$element){var e=h.find(i.$element.get(0),i.id+"_select");i._isDate()&&p.utils.useDatePicker()?(e&&h.removeClass(e,"btn"),p.utils.datePickerInitialize(i.$element,{showOnFocus:!1},function(e){var t=!1;if(document.activeElement===document.body){var n=i._input();n?n.focus():t=!0}else t=!0;!t||document.activeElement&&i.focusInControl(document.activeElement)||(i.focusOut(null),i.focused=!1)}),e&&h.addClass(e,"btn")):i._isDateTime()&&p.utils.useDateTimePicker()&&(e&&h.removeClass(e,"btn"),p.utils.dateTimePickerInitialize($(h.find(i.$element.get(0),i.id+"_group")),{},function(e){i.focusOut(null),i.focused=!1}),e&&h.addClass(e,"btn"))}},e.prototype.focusOut=function(e){this._schemaField&&!this.renderOptions.readOnly&&this._input2Model(!0)},e.prototype._text2value=function(e){return p.utils.text2value(e,this._schemaInput(),this._stateField)},e.prototype.checkValue=function(e,t){t(e)},e.prototype._input=function(){var e=this.$element?this.$element.get(0):null;return e?h.find(e,this.id+"_input"):null},e.prototype._input2Model=function(t){var n=this,i=n._input(),e=p.utils.maskCheckValue(n.renderOptions.mask||n._mask,i.value);e!=i.value&&(i.value=e);var o=n._text2value(e),r=n._schemaInput();n._equals(o)?(n._isNumber()||n._isDate()||n._isDateTime())&&n._value2Input(i):n.checkValue(o,function(e){n.state.value!==e?(""===e&&"string"===r.type&&(e=void 0),n._internalSetValue(e,t)):n._value2Input(i)})},e.prototype.updateModel=function(){this.form.setValue(this.renderOptions.field,this._stateField.value)},e.prototype._internalSetValue=function(t,e){var n=this;n._searchEventBus?n._searchEventBus.push(null,function(e){n._stateField.value=t,n.updateModel()},e):(n._stateField.value=t,n.updateModel())},e.prototype._afterFieldChanged=function(){var e=this;e._removePlugins(),e._updateType(),e._setPlugins();var t=e.$element?e.$element.get(0):null,n=e._input();e._isMoney()&&(e.fieldState().moneyUnitCoef=e.form.moneyUnitCoef),n&&(e._value2Input(n),e._setDisabled(n,t),e._setReadOnly(n,t),e.setHidden(t),e._setMandatory(n,t),e._setErrors(n,t),e._setSymbol()),e._mask="",e._schemaField&&"phone"===e._schemaField.format&&(e._mask="phone")},e.prototype._stateOfField=function(){var t=this;if(t._stateField=t._stateField||{},t.renderOptions.field){var n=t.form.getState(t.renderOptions.field);t._stateField.value=t.form.getValue(t.renderOptions.field),Object.keys(n).forEach(function(e){t._stateField[e]=n[e]})}else t._stateField.value=void 0},e.prototype.changed=function(e,t,n,i,o){var r=this;if(e===r.$bind)r._isBinded?r.state.value!==n&&(r._changedBind(t,n,i,o),r.state.value=n):r._internalValue!==n&&(r._changedBind(t,n,i,o),r._internalValue=n);else if(r.renderOptions.field&&e===r.renderOptions.field)if(r._stateField.value!==n)r._stateField.value=n,r._value2Input(r._input());else if(!r.renderOptions.readOnly&&r._schemaField&&!r._schemaField.enum){var s=r._input();p.utils.maskCheckValue(r.renderOptions.mask,s.value)!==r._value2Text()&&r._value2Input(s)}},e.prototype._patchState=function(e){},e.prototype.fieldState=function(){return this._stateField},e.prototype._setReadOnly=function(e,t){this.renderOptions.readOnly||(e.readOnly=this.fieldState().isReadOnly)},e.prototype._setDisabled=function(e,t){this.renderOptions.readOnly||(e.disabled=this.fieldState().isDisabled)},e.prototype._setMandatory=function(e,t){var n=this;if(!n.renderOptions.readOnly){var i=n.fieldState().isMandatory;if((e.required=i)?h.addClass(e,"bs-mandatory"):h.removeClass(e,"bs-mandatory"),n.renderOptions.placeHolder&&(e.placeholder=(!0===n.renderOptions.placeHolder?n.renderOptions.title:n.renderOptions.placeHolder)+(i?" *":"")),!n.renderOptions.titleIsHidden){var o=h.find(t,n.id+"_label");o&&h.text(o,(n.renderOptions.title||"")+(i?" *":"")+(n.renderOptions.inline?String.fromCharCode(160):""))}}},e.prototype.stateChanged=function(e,t){var n=this;if(t&&t.property===n.renderOptions.field){var i=n.form.getState(n.renderOptions.field);n._patchState(i);var o=n.$element?n.$element.get(0):null,r=n._input();e&&"decimals"!==e||i.decimals!==n.fieldState().decimals&&(n.fieldState().decimals=i.decimals),e&&"isHidden"!==e||i.isHidden!==n.fieldState().isHidden&&(n.fieldState().isHidden=i.isHidden,r&&n.setHidden(o)),e&&"isDisabled"!==e||i.isDisabled!==n.fieldState().isDisabled&&(n.fieldState().isDisabled=i.isDisabled,r&&n._setDisabled(r,o)),e&&"isReadOnly"!==e||i.isReadOnly!==n.fieldState().isReadOnly&&(n.fieldState().isReadOnly=i.isReadOnly,r&&n._setReadOnly(r,o)),e&&"isMandatory"!==e||i.isMandatory!==n.fieldState().isMandatory&&(n.fieldState().isMandatory=i.isMandatory,r&&n._setMandatory(r,o)),e&&"errors"!==e||l.errorChanged(n.fieldState().errors,i.errors)&&(n.fieldState().errors=i.errors,n._setErrors(r,o))}},e.prototype._changedBind=function(e,t,n,i){this._setSelectValue(t)},e.prototype._changedField=function(e,t,n,i){},e.prototype._select=function(){return this.$element?h.find(this.$element.get(0),this.id+"_select"):null},e.prototype.canEdit=function(){var e=this._stateField;return!(e.isHidden||e.isDisabled||e.isHidden||this.renderOptions.readOnly)},e.prototype._setSelectValue=function(e){var t=this._select();if(t){if(null==e)e="";else{var n=this.$schema.enum.indexOf(e);e=0<=n?this.$schema.enumNames[n]:""}""===e&&(e=String.fromCharCode(160)),h.text(t,e)}},e.prototype.paste=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t._input();if(t._stateField.isReadOnly||t._stateField.isDisabled)return!0;var i=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===p.utils.doPasteNumber(e,n,{decimalSep:s.number.decimal,thousandSep:s.number.thousand,places:a.places(t._stateField),schema:i}))return!1}else if(t._isDate()){if(!1===p.utils.doPasteDate(e,n,{sep:s.date.daySep,format:s.date.dateShort,schema:i}))return!1}else if(t._isPassword()&&!1===p.utils.doPastePassword(e,n,{schema:i}))return!1;return!0}},e.prototype._ignoreKeys=function(e,t,n){return e.which===h.keys.VK_TAB||e.which!==h.keys.VK_DELETE&&(!(!t&&e.which===h.keys.VK_BACKSPACE)&&(t?0===e.which||(0<=h.arrowKeys.indexOf(e.which)||!(!this.renderOptions.mask||(e.which=p.utils.maskKeys(this.renderOptions.mask,e,n,t),0!==e.which))):0<=h.ignoreKeys.indexOf(e.which)||0<=h.arrowKeys.indexOf(e.which)))},e.prototype.keypress=function(e){var t=this;if(!t._schemaField||t.renderOptions.readOnly)return!0;var n=t._stateField;if(n.isReadOnly||n.isDisabled)return!0;var i=t._input();if(t._ignoreKeys(e,!0,i))return!0;var o=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===p.utils.keyPressNumber(e,i,{decimalSep:s.number.decimal,thousandSep:s.number.thousand,places:a.places(t._stateField),schema:o}))return!1}else if(t._isDate()){if(!1===p.utils.keyPressDate(e,i,{sep:s.date.daySep,format:s.date.dateShort,schema:o}))return!1}else if(t._isPassword()&&!1===p.utils.keyPressPassword(e,i,{schema:o}))return!1;return!0},e.prototype._afterEnter=function(){this._input2Model(!0),this.renderOptions&&this.renderOptions.after&&this.renderOptions.after.$bind&&this.form.execAction(this.renderOptions.after.$bind,this.state.value)},e.prototype.focusInControl=function(e){var t=r.prototype.focusInControl.call(this,e);return!t&&this._isDate()&&p.utils.useDatePicker()?p.utils.elementInDatePicker(e,this.$element):t},e.prototype.keydown=function(e){var t=this;if(!t._schemaField||t.renderOptions.readOnly)return!0;var n=t._stateField;if(n.isReadOnly||n.isDisabled)return!0;var i=t._input();if(t._ignoreKeys(e,!1,i))return e.which===h.keys.VK_ENTER&&t._afterEnter(),!0;var o=t._schemaInput();if(t._isNumber()&&!t.$lookup){if(!1===p.utils.keyDownNumber(e,i,{decimalSep:s.number.decimal,thousandSep:s.number.thousand,places:a.places(t._stateField),schema:o}))return!1}else if(t._isDate()){if(!1===p.utils.keyDownDate(e,i,{sep:s.date.daySep,format:s.date.dateShort,schema:o}))return!1}else if(t._isPassword()&&!1===p.utils.keyDownPassword(e,i,{schema:o}))return!1;return!0},e.prototype._equals=function(e){var t=this._stateField.value,n=this._schemaInput();this._isMoney()&&(t=this._value2Text(),e=a.value2Text(e,n,this._stateField));var i=t===e;return!i&&void 0===t&&"string"===n.type&&""===e||i},e.prototype._state2UI=function(){this.$element&&(this._setSelectValue(this.state.value),this._afterFieldChanged())},e.prototype.setFocus=function(e){if(this.canEdit()){var t=this._input();t&&t.focus()}},e.prototype._clickAfter=function(){},e.prototype._clickSearch=function(){},e.prototype.click=function(e){var t=this,n=e.target;"#"===(h.attr(n,"data-phoenix-href")||h.attr(n,"href"))&&e.preventDefault();var i=h.attr(e.target,"data-select");if(i){if(t._isBinded)t.form.setValue(t.$bind,i);else{if(t.getInternalValue()===i)return;t.setInternalValue(i,!0),t._notifyChanged("select",i),t._changeField(t._internalValue)}t.canEdit()&&t.setFocus()}else{if(h.parentById(t.$element.get(0),e.target,t.id+"_aftertext"))t._clickAfter(),t.canEdit()&&t.setFocus();else h.parentById(t.$element.get(0),e.target,t.id+"_searchtext")&&(t._clickSearch(),t.canEdit()&&t.setFocus())}t.canEdit()},e.prototype._notifyChanged=function(e,t){},e.prototype.render=function(e){var t=this,n=t._initOptions(p.utils.defaultOptions);if(!t.$element){n.title=o.tt(t._schemaInput().title,t.form.$locale),t._schemaInput().description&&(n.description=o.tt(t._schemaInput().description,t.form.$locale));var i=t.$schema.enumNames||t.$schema.enum;i=i.map(function(e){return o.tt(e+"",t.form.$locale)}),n.maxLength=a.getMaxLength(t._schemaInput()),t.$element=$(m(t.id,n,t.$schema.enum,i,t.options.design,n.title)),t._state2UI(),t.setEvents(n)}return t.appendElement(e,n),t.$element},e.prototype._value2Text=function(){var e=this._stateField.value;this._input();return this._isNumber()?a.value2Text(e,this._schemaField,this._stateField):this._isDate()?p.utils.useDatePicker()?o.parseISODate(e||"")||"":o.shortDate(e||""):this._isDateTime()?p.utils.useDateTimePicker()?o.parseISODateTime(e||"")||"":o.shortDateTime(e||""):e||""},e.prototype._value2Input=function(e){var t=this,n=t._stateField.value;t.renderOptions.readOnly?t._isDate()?h.text(e,o.shortDate(n||"")||String.fromCharCode(160)):t._isDateTime()?h.text(e,o.shortDateTime(n||"")||String.fromCharCode(160)):(t._isNumber(),h.text(e,t._value2Text()||String.fromCharCode(160))):t._isDate()?p.utils.useDatePicker()?p.utils.datePickerSetValue(t.$element,n):e.value=o.shortDate(n||""):t._isDateTime()?p.utils.useDateTimePicker()?p.utils.dateTimePickerSetValue($(h.find(t.$element.get(0),t.id+"_group")),n):e.value=o.shortDateTime(n||""):(t._isNumber(),e.value=t._value2Text())},e}(d.ui.AbsField),e.BaseMultiField=i,n.registerControl(i,"*",!0,"multifield",null)}(Phoenix||(Phoenix={})),function(s){var e,t,a,l,u,d,c,n,p,i,h,f,o;s.multivalue||(s.multivalue={}),t=(e=s).ui,a=s.utils,l=s.uiutils,u=e.dom,d=e.customData,c=e.Observable.SchemaUtils,n=s.locale,p=s.gridlookup,i=s.ulocale,t=s.ui,h=function(e,t,n){return $(a.format(' <span id="{0}" class="bs-tag badge badge-info">{1}<span data-close-id="{0}" class="bs-tag-close" aria-hidden="true">&times;</span></span>',e.$id,t)).get(0)},f=function(e,t){e.push('<span  id="{0}_after" tabindex="-1" class="bs-grp-btn input-group-append input-group-addon'),t.icon&&e.push(" bs-icon-input"),e.push('">'),e.push('<span class="input-group-text">'),t.icon?e.push('<span class="'+u.iconClass(t.icon)+'"></span>'):e.push(t.value),e.push("</span>"),e.push("</span>")},o=function(r){function e(e,t,n){var i;e.options&&e.options.field||console.log("Invalid multivalue Field options.field is missing");var o=i=r.call(this,e,t,n)||this;return o._schemaInputField=n.getSchema(o.$bind+"."+("array"===o.$schema.type?"$item.":"")+e.options.field),o._isEnum()&&(o.$lookup={data:{$type:"enum",$value:[]},mapping:o.fieldOptions.mapping||{value:"code",title:"title"},isEnum:!0},o.fieldOptions.lookupColumns=["title"],o._schemaInputField.enum.forEach(function(e,t){o.$lookup.data.$value.push({code:e,title:o._schemaInputField.enumNames[t]})})),o.$lookup&&(o.lookupOptions={autoComplete:!1,maxItems:-1},o.eventBus=new s.serial.SingleEventBus(50),o.onselectItemHandler=o._onselectItem.bind(o)),o.form.syncViewId()&&o.fieldOptions.addMethod&&(o._syncCallBack=function(e){o.form.execAction(o.$bind+".$links."+o.fieldOptions.addMethod,e)}),i}return __extends(e,r),e.prototype.beforeAfter=function(){return u.find(this.$element.get(0),this.id+"_array")},e.prototype._onselectItem=function(e){var r=this;r.eventBus.push(e,function(t){if(r._input().value="",t){var e=Object.keys(r.$lookup.mapping);if(r._isEnum()){var n=e.indexOf("title");0<=n&&e.splice(n,1)}var i={$create:!0};if(e.forEach(function(e){i[e]=t[r.$lookup.mapping[e]]}),r.$lookup.customMapping){var o=d.get("lookup.mappings."+r.$lookup.customMapping);o&&o(i,t)}r.state.value.push(i,s.Observable.Duplicates.dupSilent,r._syncCallBack)}},!0)},e.prototype._patchState=function(e){this._isNumber()&&(void 0===e.decimals&&void 0!==this._schemaInputField.decimals&&(e.decimals=this._schemaInputField.decimals),void 0===this._schemaInputField.symbol&&void 0!==this._schemaInputField.symbol&&(e.symbol=this._schemaInputField.symbol),this._isMoney()&&(void 0===e.decimals&&(e.decimals=n.number.places),void 0===e.symbol&&(e.symbol=n.number.symbol)))},e.prototype.focusOut=function(e){p.utils.closeGridLookup(this,this.eventBus,"gc"),r.prototype.focusOut.call(this,e)},e.prototype._toggleGridLookup=function(){this.gc&&this.gc.opened?p.utils.closeGridLookup(this,this.eventBus,"gc"):this.gc&&this.gc.opened||this._openGridLookup()},e.prototype._checkGridPopup=function(){var e=this._input(),t=this.$element.get(0);this.renderOptions.columns&&(t=this._colParent()),this.gc=p.utils.checkGridPopup(this,this.$lookup,e,t)},e.prototype.focusInControl=function(e){var t=r.prototype.focusInControl.call(this,e);return!t&&this.gc&&this.gc.opened?this.gc.focusInCombo(e):t},e.prototype._searchText=function(){var e=this._input(),t=this._text2value(e.value);return this.equals(t)?"":t},e.prototype.checkFocus=function(e){var t=this;a.nextTick(function(){var e=window.document.activeElement;e&&t.targetInControl(e)||(t.focusOut(null),t.focused=!1)})},e.prototype.focusIn=function(e){},e.prototype._openGridLookup=function(){var e=this;if(!e.gc||!e.gc.opened){e._checkGridPopup();var t=e.$bind.split(".");t.pop();var n=p.utils.checkGridLookup(e.$lookup,e.form.$model,null,e._schemaInput(),t.join("."));p.utils.openGridLookup(e,{lookup:n,parentControl:e,formControl:e.form,display:e._isEnum()?"title":e.renderOptions.display||e.renderOptions.field,bind:e.renderOptions.field,containerId:e.form.syncTransactionId(),viewId:e.form.syncViewId(),align:e.id+"_group",openerId:e.id+"_after",searchText:e._searchText(),onselect:e.onselectItemHandler,lookupColumns:e.fieldOptions?e.fieldOptions.lookupColumns:void 0,propertyName:"gc",minWidth:e.fieldOptions?e.fieldOptions.lookupMinWidth:0})}},e.prototype._state=function(){this._schemaInputField||(this._schemaInputField=this.form.getSchema(this.$bind+"."+("array"===this.$schema.type?"$item.":"")+this.fieldOptions.field)),r.prototype._state.call(this),this._patchState(this.state)},e.prototype._schemaInput=function(){return this._schemaInputField},e.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},e.prototype._setReadOnly=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},e.prototype.validateList=function(){var e=this.state.value;e.parent.partialValidate([e.path])},e.prototype.changed=function(e,t,n,i,o){var r=this,s=!1;if(r.$element&&!(0<=e.substr(r.$bind.length).indexOf(".$selected"))){switch(o.checkChildren&&"propchange"===i&&e===r.$bind&&(s=!0,r.state.value=r.form.getValue(r.$bind)),r.state.value||(i="none"),i){case"propchange":e!==r.$bind&&0!==e.indexOf(r.$bind+".$item")||(s=!0,r.validateList());break;case"add":r._addTag(o.$value),r.validateList();break;case"remove":r._removeTag(o.$id),r.validateList()}s&&r._renderAllItems()}},e.prototype._removeTag=function(e){var t=u.find(this.$element.get(0),e);t&&u.remove(t)},e.prototype._addTag=function(e){var t=this._input(),n=l.utils.displayValue(e[this.renderOptions.field],this._schemaInput(),null,{false:!0,useSymbol:!1,state:this.fieldState(),form:this.form},null,this.renderOptions.field),i=h(e,n.value);u.before(t,i)},e.prototype._renderAllItems=function(){for(var r=this,s=r._input(),e=r.state.value,t=s.parentNode;t.firstChild!==s;)t.removeChild(t.firstChild);e.forEach(function(e,t,n){var i=l.utils.displayValue(e[r.renderOptions.field],r._schemaInput(),null,{false:!0,useSymbol:!1,state:r.fieldState(),form:r.form},null,r.renderOptions.field),o=h(e,i.value);u.before(s,o)})},e.prototype._unitChanged=function(){r.prototype._unitChanged.call(this),this._isMoney()&&this.$element&&this._renderAllItems()},e.prototype._state2UI=function(){r.prototype._state2UI.call(this),this._renderAllItems()},e.prototype.stateChanged=function(e,t){this.form.getState(this.$bind);r.prototype.stateChanged.call(this,e,t)},e.prototype.canEdit=function(){var e=this.state;return!(e.isHidden||e.isDisabled||e.isHidden||this.renderOptions.readOnly)},e.prototype.mousedown=function(e){return this.setFocus(),!0},e.prototype.setFocus=function(e){if(this.canEdit()){var t=this._input();t&&a.nextTick(function(){t.focus()})}},e.prototype._group=function(){var e=this.$element?this.$element.get(0):null;return e?u.find(e,this.id+"_group"):null},e.prototype.checkValue=function(e,t){var n=this;if(n.$lookup){var i=n._input();if(""===(e=e||"").trim())return void t(i.value="");n._findValue(i.value,function(e){n._onselectItem(e)})}else r.prototype.checkValue.call(this,e,t)},e.prototype._findValue=function(e,t){var n=this;if(e||""!==e){var i={search:e,select:!1,findFirst:!0,find:!1,paginated:!0};n.eventBus.push(n._getSource(i),function(e){(e=n._filterResult(e,i))&&e.value&&e.value.length?t(e.value[0]):t(null)},!0)}else n.eventBus.push(null,function(e){t(null)},!0)},e.prototype._getSource=function(e){var t=this;e.$bind=t.$bind;t.form.getParentModel(t.$bind);return c.allData(t.$lookup)||(e.fieldName=t.$lookup.mapping[t.$display],e.paginated=!0),e.containerId=t.form.syncTransactionId(),e.viewId=t.form.syncViewId(),c.executeLookup(t.$lookup,t.form.getParentModel(t.$bind+".$item"),e)},e.prototype.keydown=function(e){if(this.$lookup){var t=e.which||e.keyCode;if(t===u.keys.VK_DOWN&&e.ctrlKey||t===u.keys.VK_F4)return e.preventDefault()&&e.stopPropagation(),this._toggleGridLookup(),!0}return r.prototype.keydown.call(this,e)},e.prototype._filterResult=function(e,t){var n=this,i=n.renderOptions.field,o=n.renderOptions.display||i;if(e&&Array.isArray(e))e={value:e};else if(e&&e.documents){if(t.findFirst&&n.$lookup.data&&n.$lookup.data.$params&&(n.$lookup.data.$params.$allData||"relation"===n.$lookup.data.$type)){(s=n.$bind.split(".")).pop();var r=p.utils.checkGridLookup(n.$lookup,n.form.$model,null,n._schemaInput(),s.join("."));return(a=c.findFirst(t.search,c.remoteSearch(c.lastSegment(i,o),r),e.documents))?{value:[a.item]}:null}e.value=e.documents,delete e.documents}if(c.allData(n.$lookup)){if(t.findFirst&&!t.search)return null;if(t.search&&e&&e.value&&t.findFirst){var s;(s=n.$bind.split(".")).pop();var a;r=p.utils.checkGridLookup(n.$lookup,n.form.$model,null,n._schemaInput(),s.join("."));return(a=c.findFirst(t.search,n._isEnum()?"title":c.remoteSearch(c.lastSegment(i,o),r),e.value))?{value:[a.item]}:null}}return e},e.prototype._input2Model=function(e){var n=this,i=n._input(),o=n._text2value(i.value);n.equals(o)||n.checkValue(o,function(e){if(o){var t={$create:!0};t[n.renderOptions.field]=o,n.state.value.push(t,s.Observable.Duplicates.dupSilent,n._syncCallBack)}i.value=""}),i.value=""},e.prototype.click=function(e){if(this.canEdit()){var t=this._group();if(this.$lookup&&u.isChildOf(t.lastChild,e.target))this._toggleGridLookup();else{var n=u.attr(e.target,"data-close-id");if(n){var i=this.state.value,o=i.findById(n);return o&&(this._syncCallBack?this.form.execAction(this.$bind+".$links.$remove",[o.id]):i.remove(o)),void this.setFocus()}}}},e.prototype.render=function(e){var t=this,n=t._initOptions(l.utils.defaultOptions);return t.$element||(n.title=i.tt(t.$schema.title,t.form.$locale),t.$schema.description&&(n.description=i.tt(t.$schema.description,t.form.$locale)),t.$element=$(function(e,n,t,i){i=i||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},n);var o=[];return n.placeHolder=!1,l.utils.fieldWrapper(o,n,t,function(){if(!n.titleIsHidden){o.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];n.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&e.push("text-left")),n.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&o.push(' class="'+e.join(" ")+'"'),o.push(">"),o.push(a.escapeHtml(i||"")+(n.inline?"&nbsp;":"")),l.utils.addTooltipAndRule(o,n),o.push("</label>")}n.columns&&o.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),o.push('<div class="input-group" id="{0}_group"');var t=[];n.minWidth&&t.push("min-width: "+n.minWidth+";"),n.maxWidth&&t.push("max-width: "+n.maxWidth+";"),t.length&&o.push('  style="'+t.join("")+'"'),o.push(">"),o.push('<div class="bs-mv-container form-control" id="{0}_array">'),o.push('<input type="text" id="{0}_input" class="bs-tag-input">'),o.push("</div>"),n.after&&n.after.icon&&f(o,n.after),o.push("</div>"),l.utils.addErrorDiv(o),n.columns&&o.push("</div>"),n.titleIsHidden&&l.utils.addTooltipAndRule(o,n)}),a.format(o.join(""),e)}(t.id,n,t.options.design,n.title)),t._state2UI(),t.setEvents(n)),t.appendElement(e,n),t.$element},e.prototype._value2Input=function(e){},e.prototype.destroy=function(){this.onselectItemHandler=null,this.eventBus&&(this.eventBus.destroy(),this.eventBus=null),this.gc&&(this.gc.destroy(),this.gc=null),r.prototype.destroy.call(this)},e}(s.formedit.Edit),t.registerControl(o,"array",!1,"multivalue",null)}(Phoenix||(Phoenix={})),function(u){var e,t,n,d=u.utils,i=u.ui,c=u.dom,p=(u.device,u.uiutils),o=u.Observable,s=u.data.odata,a=o.DataUtils,h=u.ulocale;u.formpicture||(u.formpicture={}),e=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._setDisabled=function(e){},e.prototype._setReadOnly=function(e){this._setDisabled(e)},e.prototype._setMandatory=function(e){},e.prototype._state2UI=function(){var e=this._img(),t=this.$element?this.$element.get(0):null;e&&(this._showValue(this.state.value),this._setDisabled(t),this._setReadOnly(t),this.setHidden(t))},e.prototype._showValue=function(e){},e.prototype.changed=function(e,t,n,i){this._img();this.state.value!==n&&(this.state.value=n,this._showValue(this.state.value))},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o))},e.prototype._img=function(){var e=this.$element.get(0);return e?c.find(e,this.id+"_img"):null},e.prototype._altimg=function(){var e=this.$element.get(0);return e?c.find(e,this.id+"_alt"):null},e.prototype.render=function(e){var t,i,n,o,r,s,a=this,l=a._initOptions(p.utils.defaultOptions);return a.$element||(l.title=h.tt(a.$schema.title,a.form.$locale),a.$element=$((t=a.id,i=l,n=a.options.design,o=l.title,r=a.editable,s=[],o=o||"",p.utils.fieldWrapper(s,i,n,function(){var e=u.bootstrap4;if(!i.titleIsHidden){s.push('<label id="{0}_label"');var t=["bs-label"];i.columns&&(e?t.push("col-form-label"):t.push("checkbox-inline bs-cursor-d"),t.push("bs-lib-col col-sm-"+i.labelCol),i.labelLeft&&t.push("text-left")),i.inline&&(e?t.push("form-check-inline"):t.push("checkbox-inline"),t.push("bs-cursor-d no-x-padding")),t.length&&s.push(' class="'+t.join(" ")+'"'),s.push(">"),s.push(d.escapeHtml(o||"")+(i.inline?"&nbsp;":"")),p.utils.addTooltipAndRule(s,i),s.push("</label>")}i.columns&&s.push('<div class="no-x-padding col-sm-'+(12-i.labelCol)+'">'),i.inline?s.push('<span id="{0}_alt" class="bs-no-image">'):s.push('<div id="{0}_alt" class="bs-no-image">'),r&&s.push('<input id="{0}_upload" class="bs-hidden-file" accept="image/*" type="file" />');var n=["bs-none bs-relative"];i.inline||n.push(e?"img-fluid":"img-responsive"),s.push('<img id="{0}_img" class="'),s.push(n.join(" ")),s.push('"/>'),r&&s.push('<div id="{0}_remove" class="bs-rt-button bs-image-remove bs-none"><span class="'+c.iconClass("times-circle")+'"></span></div>'),i.inline?s.push("</span>"):s.push("</div>"),i.columns&&s.push("</div>")},null),d.format(s.join(""),t))),a._state2UI(),a.setEvents(l)),a.appendElement(e,l),a.$element},e}(u.ui.AbsField),t=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i.editable=!0,i}return __extends(e,o),e.prototype._createImage=function(e){var n=this,t=e.target.files;if(t&&t.length){var i=t[0];if(!i.type.match("image.*"))return;var o=window.URL||window.webkitURL;if(o){var r={id:n.state.value?n.state.value.id:void 0,fileName:i.name,value:"",url:n.state.value?n.state.value.url:void 0,contentType:i.type};if("image/svg+xml"===i.type){var s=new FileReader;s.onload=function(e){r.value=s.result,n.form.setValue(n.$bind,r),c.processing(!1)},c.processing(!0),s.readAsDataURL(i)}else{var a=document.createElement("img"),l=document.createElement("canvas");c.processing(!0),a.src=o.createObjectURL(i),a.onload=function(){var e=1,t=a.width*a.height;12e5<t?e=2:24e5<t?e=4:4e6<t&&(e=8),l.width=a.width/e,l.height=a.height/e,l.getContext("2d").drawImage(a,0,0,l.width,l.height),r.value=l.toDataURL(),n.form.setValue(n.$bind,r),c.processing(!1)}}}}},e.prototype._removeImage=function(){var e={id:this.state.value?this.state.value.id:void 0,value:""};this.form.setValue(this.$bind,e)},e.prototype.click=function(e){if(!this.state.isDisabled&&!this.state.isReadOnly){var t=this.id+"_remove";if(e.target.id===t||e.target.parentNode.id===t)this._removeImage();else this._upload().click()}},e.prototype._upload=function(){var e=this.$element.get(0);return e?c.find(e,this.id+"_upload"):null},e.prototype.setEvents=function(e){var t=this,n=t._upload();n&&$(n).on("change",function(e){if(t.form.isInProcessing)return t.form.freeze(e);t._createImage(e)})},e.prototype.removeEvents=function(){var e=this._upload();e&&$(e).off("change")},e.prototype._setDisabled=function(e){this._upload().disabled=this.state.isDisabled||this.state.isReadOnly,this._showRemoveImage(this.state.value)},e.prototype._showRemoveImage=function(e){var t=!this.state.isHidden&&!this.state.isDisabled&&!this.state.isReadOnlyd;t&&(t=e&&(e.url||e.value));var n=this._rmv();n&&(t?c.removeClass(n,"bs-none"):c.addClass(n,"bs-none"))},e.prototype._rmv=function(){var e=this.$element.get(0);return e?c.find(e,this.id+"_remove"):null},e.prototype._showValue=function(e){var t=this._img(),n=this._altimg();if(t){var i=!1;if(e)if(void 0!==e.value)e.value?(t.src=e.value,i=!0):t.src="";else if(e.url){if(0<=e.url.indexOf("{{baseUrl}}")){var o=a.extractMainDataSource(this.form.$model);o||(o={$module:this.renderOptions.$module,$context:this.renderOptions.$context});s.baseUrl(o);var r=d.execAngularExpression(e.url,{baseUrl:s.baseUrl(o)||""});t.src=s.addImageUrlToken(r)}else t.src="";i=!0}else t.src="";else t.src="";i?(c.removeClass(t,"bs-none"),c.removeClass(n,"bs-no-image")):(c.addClass(t,"bs-none"),c.addClass(n,"bs-no-image")),this._showRemoveImage(e)}},e}(e),n=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i.editable=!1,i}return __extends(e,o),e.prototype._showValue=function(e){var t=this._img(),n=this._altimg();if(t){var i=!1;e&&(t.src=e,i=!0),i?(c.removeClass(t,"bs-none"),c.removeClass(n,"bs-no-image")):(c.addClass(t,"bs-none"),c.addClass(n,"bs-no-image"))}},e}(e),i.registerControl(t,"string",!1,"",{format:"stream"}),i.registerControl(n,"string",!1,"imageurl",{})}(Phoenix||(Phoenix={})),function(e){var a,t,o,l,n;e.radiogroup||(e.radiogroup={}),a=e.utils,t=e.ui,e.dom,e.groupctrl,o=e.ulocale,l=e.uiutils,n=function(s){function e(e,t,n){var i=s.call(this,e,t,n)||this;return i._state(),i}return __extends(e,s),e.prototype._state2UI=function(){s.prototype._state2UI.call(this,function(e){e.checked=!0})},e.prototype.changed=function(e,t,n,i){if(this.state.value!=n){this.state.value=n;var o=this.$schema.enum.indexOf(this.state.value),r=s.prototype._item.call(this,o);r&&(r.checked=!0)}},e.prototype.render=function(e){var t=this,n=t._initOptions(l.utils.defaultOptions);if(!t.$element){var i=t.$schema.enumNames||t.$schema.enum;i=i.map(function(e){return o.tt(e,t.form.$locale)}),t.$schema.description&&(n.description=o.tt(t.$schema.description,t.form.$locale)),t.$element=$(function(e,t,n,i,o,r){i=i||"",t=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,horizontal:!1},t);var s=[];return l.utils.fieldWrapper(s,t,n,function(){if(!t.titleIsHidden){s.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];t.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+t.labelCol),t.labelLeft&&e.push("text-left")),t.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&s.push(' class="'+e.join(" ")+'"'),s.push(">"),s.push(a.escapeHtml(i||"")+(t.inline?"&nbsp;":"")),l.utils.addTooltipAndRule(s,t),s.push("</label>"),!t.inline&&t.horizontal&&s.push("<div></div>")}t.columns&&s.push('<div class="no-x-padding  col-sm-'+(12-t.labelCol)+'">');var n=t.inline||t.horizontal;o.forEach(function(e,t){s.push('<div class="custom-control custom-radio'+(n?" custom-control-inline":"")+'">'),s.push('<input class="custom-control-input" type="radio" name="{0}_input" id="{0}_item_'+t+'" value="'+e+'">'),s.push('<label class="custom-control-label" for="{0}_item_'+t+'">'),s.push(a.escapeHtml(r[t]||"")),s.push("</label>"),s.push("</div>")}),l.utils.addErrorDiv(s),t.columns&&s.push("</div>")},null),a.format(s.join(""),e)}(t.id,n,t.options.design,o.tt(t.$schema.title,t.form.$locale),t.$schema.enum,i)),t.setEvents(n),t._state2UI()}return t.appendElement(e,n),t.$element},e}(e.groupctrl.Group),t.registerControl(n,"*",!0,"radio",null)}(Phoenix||(Phoenix={})),function(s){var e,t,n,a,i,l,o,u,d,r;t=e||(e={}),a=(n=s).utils,i=n.ui,l=n.Observable.SchemaUtils,o=n.dom,u=n.ulocale,d=n.uiutils,r=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o._map=[],e.options&&e.options.$expression?(o.$expression=e.options.$expression,a.extractAngularVars(o.$expression,o._map)):(o.$expression=a.format("{0}: {{{1}}}",a.escapeHtml(u.tt(o.$schema.title,o.form.$locale)),o.$bind),o._map.push({name:o.$bind})),o._hasMoney=!1,o._map.forEach(function(e){e.name!==o.$bind?(e.schema=n.getSchema(e.name),o.form.registerListenerFor(e.name,o)):e.schema=o.$schema,l.isMoney(e.schema)&&(o._hasMoney=!0)}),i._state(),i}return __extends(e,r),e.prototype._state=function(){var e=this;e.state=e.state||{},e.state.values=e.state.values||{},e.state.fvalues=e.state.fvalues||{};var t=e.form.getState(e.$bind);e.state.isHidden=t.isHidden,e._refreshValues()},e.prototype.notifyGlobalChanged=function(e){"money-unit"===e&&(this._refreshValues(),this._value2UI())},e.prototype._refreshValues=function(){var n=this;n._map.forEach(function(e){n.state.values[e.name]=n.form.getValue(e.name);var t=n.form.getState(e.name);l.isMoney(e.schema)&&(t.moneyUnitCoef=n.form.moneyUnitCoef),n.state.fvalues[e.name]=d.utils.displayValue(n.state.values[e.name],e.schema,n.form.$locale,{html:!1,useSymbol:!0,state:t},n.state.values,e.name).value})},e.prototype._value2UI=function(){var e=this.$element?this.$element.get(0):null,t=a.execAngularExpression(this.$expression,this.state.fvalues,!0,!0),n=$("<div>"+t+"</div>").get(0);this.renderOptions.insideStyles&&(n.className=this.renderOptions.insideStyles),this._renderIcons(n),o.empty(e),e.appendChild(n)},e.prototype._renderIcons=function(e){var i=o.queryAll(e,"[data-icon]");if(i)for(var t=function(e){var t=i.item(e),n=o.attr(t,"data-icon").split(" ");(1<n.length?o.customIconClass(n[0],n[1]):o.iconClass(n[0])).split(" ").forEach(function(e){return o.addClass(t,e)})},n=0;n<i.length;n++)t(n)},e.prototype._findMap=function(e){for(var t=0,n=this._map.length;t<n;t++){var i=this._map[t];if(i.name===e)return i}return null},e.prototype.changed=function(e,t,n,i){this._refreshValues(),this._value2UI()},e.prototype.stateChanged=function(e,t){var n=this,i=n.form.getState(n.$bind),o=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(o)),i.symbol!==n.state.symbol&&(i.symbol=n.state.symbol),i.decimals!==n.state.decimals&&(i.decimals=n.state.decimals)},e.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this.setHidden(e),this._value2UI())},e.prototype.render=function(e){var t=this,n=t._initOptions(d.utils.defaultOptions);return t.$element||(t.$element=$(function(e,t,n,i,o){i=i||"",t.styles=t.styles?t.styles:s.bootstrap4?"form-control-plaintext":"form-control-static",t=$.extend({titleIsHidden:!1},t);var r=[];return d.utils.fieldWrapper(r,t,n,function(){r.push('<div style="background-color: red;">'+i+"</div>")}),a.format(r.join(""),e)}(t.id,n,t.options.design,u.tt(t.$schema.title,t.form.$locale))),t._state2UI()),t.appendElement(e,n),t.$element},e.prototype.destroy=function(){var t=this;t._map.forEach(function(e){e.name!=t.$bind&&t.form.unRegisterListenerFor(e.name,t)}),r.prototype.destroy.call(this)},e}(s.ui.AbsField),t.ReadOnlyField=r,i.registerControl(r,"*",!1,"",{readOnly:!0})}(Phoenix||(Phoenix={})),function(e){var t,n,i,r,f,o;t=e.multifieldSearch||(e.multifieldSearch={}),(n=e).utils,i=n.locale,r=n.Observable.SchemaUtils,n.uiutils,n.formedit,n.filters,n.customData,n.dom,n.locale,f=n.ui,o=function(s){function a(e,t,n){var i;e=a.beforeCreateControl(e);var o=i=s.call(this,e,t,n)||this;void 0===o.renderOptions.titleIsHidden&&(o.renderOptions.titleIsHidden=!0);var r=o.form.getSchema(o.renderOptions.bind);return r&&"array"===r.type||console.log("Invalid search element, $bind is invalid."),i}return __extends(a,s),a.prototype._notifyChanged=function(e,t){if("search"===e){var n=this._schemaField,i="in";n.enum||"string"!==n.type||(i="like");var o=this.form.getValue(this.renderOptions.bind),r=!o.isQuery,s=t?{code:this._internalValue,op:i,values:[t]}:null,a=s?[s]:null,l=r?f.filter.format.toMongoDbFilter(a):f.filter.format.toPhenix(this._fields,a),u=l?f.filter.format.toTitle(a,this._fields):"";o.filterManager=o.filterManager||(f.filterManagerFactory?f.filterManagerFactory():null);var d={value:l,title:u};if(r){var c=o.filterManager.filterExpress?o.filterManager.filterExpress.value:null,p=d.value,h=o.filter;h&&(h=f.filter.removeMdbFilterExpress(h,c)),o.filterManager.filterExpress=d,h=f.filter.addMdbFilterExpress(h,p),o.filter=h}else o.filterManager.filterExpress=d.value,o.filter=o.filterManager.constructeFilter()}},a.prototype._afterSearch=function(){return{icon:"search",button:!0}},a.prototype._afterEnter=function(){s.prototype._afterEnter.call(this),this._doSearch()},a.prototype._doSearch=function(){var e=this;if(e._lastSearch!==e._stateField.value||e._lastSearchField!==e._internalValue){if(e._lastSearch===e._stateField.value&&void 0===e._lastSearch)return void(e._lastSearchField=e._internalValue);e._notifyChanged("search",e._stateField.value),e._lastSearch=e._stateField.value,e._lastSearchField=e._internalValue}},a.prototype._clickSearch=function(){this.focusOut(null),this.focused=!1,this._doSearch()},a.prototype._customSchemaField=function(){var e=this._internalValue;return this._internalValue?r.getSchema(e,this._baseSchema,this.form.$rootSchema,!0):null},a.prototype.updateModel=function(){this._notifyChanged("input",this._stateField.value)},a.prototype._customStateOfField=function(){this._stateField=this._stateField||{},this._isMoney()?(this._stateField.decimals=i.number.places,this._stateField.symbol=i.number.symbol):(this._stateField.symbol="",this._stateField.decimals=0)},a.prototype._customSchema=function(){var n=this;n._baseSchema=n.fieldOptions.bind?n.form.getSchema(n.fieldOptions.bind):n.form.$schema,"array"===n._baseSchema.type&&(n._baseSchema=r.expand$Ref(n._baseSchema.items,n.form.$rootSchema));var i=[],o=[];return n._fields=[],n.fieldOptions.fields=n.fieldOptions.fields||[],n.fieldOptions.fields.forEach(function(e){var t=r.getSchema(e,n._baseSchema,n.form.$rootSchema,!0);t?(i.push(e),o.push(t.title||e),n._fields.push({code:e,lib:t.title||e,type:t.type})):console.log("Schema not found for "+e)}),i.length&&n.setInternalValue(i[0],!1),{type:"string",enum:i,enumNames:o}},a.beforeCreateControl=function(e){var t=$.extend(!0,{},e);return t.options=t.options||{},t.options.bind=t.$bind,t.$bind="$none",t},a}(e.multifield.BaseMultiField),t.MultiFieldSearch=o,f.registerControl(o,"array",!1,"multi-search",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,o,r;t=e.search||(e.search={}),(n=e).formedit,i=n.dom,n.locale,o=n.ui,r=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o._searchField=e.options.search,o._query=o.form.getValue(o._searchField),i}return __extends(e,r),e.prototype.updateModel=function(){this._query.search=this.state.value},e.prototype.destroy=function(){this._query=null,r.prototype.destroy.call(this)},e.prototype.keyup=function(e){this._input();return this._ignoreKeys(e,!0)||(this.state.isReadOnly||this.state.isDisabled,this.customKeyUp(e)),!0},e.prototype.customKeyUp=function(e){var t=this;t._incremental&&(window.clearTimeout(t._incremental),delete t._incremental),t._incremental=window.setTimeout(function(){delete t._incremental,t._input2Model(!1)},0)},e.prototype.changed=function(e,t,n,i){},e.prototype._ignoreKeys=function(e,t){if(!t){if(e.which===i.keys.VK_UP)return this._query.moveSelected(-1,!0),!0;if(e.which===i.keys.VK_DOWN)return this._query.moveSelected(1,!0),!0;if(e.which===i.keys.VK_PGDOWN)return this._query.moveSelected(20,!0),!0;if(e.which===i.keys.VK_PGUP)return this._query.moveSelected(-20,!0),!0}var n=this._input();return r.prototype._ignoreKeys.call(this,e,t,n)},e}(e.formedit.Edit),t.Search=r,o.registerControl(r,"string",!1,"search",null)}(Phoenix||(Phoenix={})),function(e){var t,n,i,r,s,a,l,o,u;e.select||(e.select={}),n=(t=e).ui,i=t.Observable.SchemaUtils,r=e.utils,s=e.uiutils,a=e.dom,l=e.ulocale,o=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._isEmpty=!1,i}return __extends(e,o),e.prototype._fillSelect=function(e){this.renderOptions.readOnly||(this._isEmpty=e.indexOf(this.state.value)<0,s.utils.fillSelect(e,this._input(),this.$schema,this._isEmpty))},e.prototype._setDisabled=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},e.prototype._setReadOnly=function(e,t){e.disabled=this.state.isDisabled||this.state.isReadOnly},e.prototype._state2UI=function(){this._input()&&this._setFilter(!0),o.prototype._state2UI.call(this)},e.prototype._setFilter=function(e){var t=this.state.filter;if(!e||t){var n=t?this.$schema.filters[t]||[]:this.$schema.enum;if(this._fillSelect(n),!e)if(n.indexOf(this.state.value)<0)this.form.setValue(this.$display,n.length?n[0]:null);else{var i=this._input();i&&this._value2Input(i)}}},e.prototype.stateChanged=function(e,t){var n=this.form.getState(this.$bind);o.prototype.stateChanged.call(this,e,t),e&&"filter"!==e||this.state.filter!==n.filter&&(this.state.filter=n.filter,this._setFilter(!1))},e.prototype._renderSelect=function(){var e=this.state.filter,t=e?this.$schema.filters[e]||[]:this.$schema.enum;this._fillSelect(t)},e.prototype.render=function(e){var t=this,n=t._initOptions(s.utils.defaultOptions);return t.$element||(n.title=l.tt(t.$schema.title,t.form.$locale),t.$schema.description&&(n.description=l.tt(t.$schema.description,t.form.$locale)),t.$element=$(function(e,n,t,i){i=i||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1,labelCol:3},n);var o=[];return n.titleIsHidden&&(n.columns=!1),n.placeHolder=!1,s.utils.fieldWrapper(o,n,t,function(){if(!n.titleIsHidden){o.push('<label for="{0}_input" id="{0}_label"');var e=["bs-label"];n.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+n.labelCol),n.labelLeft&&e.push("text-left")),n.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&o.push(' class="'+e.join(" ")+'"'),o.push(">"),o.push(r.escapeHtml(i||"")+(n.inline?"&nbsp;":"")),s.utils.addTooltipAndRule(o,n),o.push("</label>")}if(n.columns&&o.push('<div class="no-x-padding col-sm-'+(12-n.labelCol)+'">'),n.readOnly){o.push('<div class="form-control bs-read-only'),o.push('" id="{0}_input"');var t=[];n.maxWidth&&t.push("max-width: "+n.maxWidth+";"),n.minWidth&&t.push("min-width: "+n.minWidth+";"),t.length&&o.push(' style="'+t.join("")+'"'),o.push(">"),o.push("</div>")}else o.push('<select class="form-control custom-select'),o.push('" id="{0}_input"'),t=[],n.maxWidth&&t.push("max-width: "+n.maxWidth+";"),n.minWidth&&t.push("min-width: "+n.minWidth+";"),t.length&&o.push(' style="'+t.join("")+'"'),o.push(">"),o.push("</select>");s.utils.addErrorDiv(o),n.columns&&o.push("</div>"),n.titleIsHidden&&s.utils.addTooltipAndRule(o,n)}),r.format(o.join(""),e)}(t.id,n,t.options.design,n.title)),t._renderSelect(),t._state2UI(),t.setEvents(n)),t.appendElement(e,n),t.$element},e.prototype.removeEvents=function(){if(!this.renderOptions.readOnly){var e=this._input();$(e).off("change")}},e.prototype._value2Input=function(e){var t=this;if(t.renderOptions.readOnly){var n=t.$schema.enumNames||t.$schema.enum,i=t.$schema.enum.indexOf(t.state.value);a.text(e,n[i]||String.fromCharCode(160))}else{var o=t.state.filter?t.$schema.filters[t.state.filter].indexOf(t.state.value):t.$schema.enum.indexOf(t.state.value);(t.$schema.nullable||o<0)&&o++,e.selectedIndex=o}},e.prototype._input2Value=function(){var e,t=this,n=t.state.filter?t.$schema.filters[t.state.filter]:t.$schema.enum,i=t._input();if((t.$schema.nullable||this._isEmpty)&&0===i.selectedIndex)e=void 0;else{var o=i.selectedIndex;(t.$schema.nullable||this._isEmpty)&&o--,e=n[o]}t.state.value!==e&&(t.state.value=e,t.form.setValue(t.$display,t.state.value))},e.prototype.setEvents=function(e){var t=this;if(!t.renderOptions.readOnly){var n=t._input();$(n).on("change",function(e){if(t.form.isInProcessing)return t.form.freeze(e);t._input2Value()})}},e}(e.formedit.BaseEdit),u=function(s){function e(e,t,n){var i=s.call(this,e,t,n)||this,o=i;o._values=[],o.$lookup&&o.$lookup.data&&o.$lookup.data.$params&&o.$lookup.data.$params.relation||console.log("Invalid select-relation widget config."),o._relationName=o.$lookup.data.$params.relation;var r=o.$bind.split(".");return 1<r.length&&(r.pop(),r.push(o._relationName),o._relationName=r.join(".")),o._codeProperty=o.renderOptions.code,o._titleProperty=o.renderOptions.title,!o._titleProperty&&o._codeProperty&&(o._titleProperty=o._codeProperty),!o._codeProperty&&o._titleProperty&&(o._codeProperty=o._titleProperty),o._codeProperty||console.log("Invalid select-relation widget config: options.code or options.title is missing"),o.form.registerListenerFor(o._relationName,o),i}return __extends(e,s),e.prototype.destroy=function(){this.form.unRegisterListenerFor(this._relationName,this),s.prototype.destroy.call(this)},e.prototype._renderSelect=function(){this.renderOptions.readOnly||this._createSelectItems()},e.prototype._state2UI=function(){s.prototype._state2UI.call(this)},e.prototype.stateChanged=function(e,t){t&&t.property===this.$bind&&s.prototype.stateChanged.call(this,e,t)},e.prototype.changed=function(e,t,n,i,o){if(e===this.$bind)s.prototype.changed.call(this,e,t,n,i,o);else{var r=!1;if(!this.$element)return;if(0<=e.substr(this._relationName).indexOf(".$selected"))return;switch(o.checkChildren&&"propchange"===i&&e===this._relationName&&(r=!0),i){case"propchange":e!==this.$bind&&0!==e.indexOf(this.$bind+".$item")||(r=!0);break;case"add":case"remove":r=!0}r&&this._renderSelect()}},e.prototype._getSource=function(){var e={};return e.containerId=this.form.syncTransactionId(),e.viewId=this.form.syncViewId(),i.executeLookup(this.$lookup,this.form.getParentModel(this.$bind),e)},e.prototype._createSelectItems=function(){var i=this,o=i._input();o&&i._getSource().then(function(e){i._values=[],i._names=[],e.documents.forEach(function(e){i._values.push(e[i.$lookup.mapping[i._codeProperty]]),i._names.push(e[i.$lookup.mapping[i._titleProperty]])}),i._isEmpty=i._values.indexOf(i.state.value)<0;var n=document.createDocumentFragment();if(i.$schema.nullable||i._isEmpty){var t=document.createElement("option");a.attr(t,"value",""),i.$schema.nullable||a.attr(t,"disabled","true"),t.textContent=String.fromCharCode(160),a.append(n,t)}e.documents.forEach(function(e){var t=document.createElement("option");a.attr(t,"value",e[i.$lookup.mapping[i._codeProperty]]),t.textContent=e[i.$lookup.mapping[i._titleProperty]],a.append(n,t)}),a.empty(o),a.append(o,n),o.selectedIndex=i._values.indexOf(i.state.value),i.$schema.nullable&&o.selectedIndex++})},e.prototype._value2Input=function(e){var t=this._values.indexOf(this.state.value);this.renderOptions.readOnly?a.text(e,(0<=t?this._names[t]:"")||String.fromCharCode(160)):((this.$schema.nullable||this._isEmpty)&&t++,t<0&&(t=0),e.selectedIndex=t)},e.prototype._input2Value=function(){var e=this._input().selectedIndex;(this.$schema.nullable||this._isEmpty)&&0<=e&&e--;var t=0<=e?this._values[e]:void 0;this.state.value!==t&&(this.state.value=t,this.form.setValue(this.$display,this.state.value))},e}(o),n.registerControl(o,"*",!0,"",null),n.registerControl(u,"*",!1,"select-relation",null)}(Phoenix||(Phoenix={})),function(e){var t,a,n,l,o,u,i;t=e.wizardctrl||(e.wizardctrl={}),a=e.utils,n=e.ui,l=e.dom,e.groupctrl,o=e.ulocale,u=e.uiutils,i=function(s){function e(e,t,n){var i=s.call(this,e,t,n)||this;return i._state(),i}return __extends(e,s),e.prototype._state2UI=function(){s.prototype._state2UI.call(this,function(e){l.addClass(e,"btn-primary"),l.removeClass(e,"btn-"+l.bootstrapStyles(!0).secondary),e.tabIndex=0})},e.prototype.changed=function(e,t,n,i,o){var r=this;if(r.state.value!=n){if(r.state.value=n,!r.$element)return;s.prototype._enumItems.call(this,function(e,t){r.state.value===t?(e.tabIndex=0,r.focused&&e.focus(),l.addClass(e,"btn-"+l.bootstrapStyles(!1).primary),l.removeClass(e,"btn-"+l.bootstrapStyles(!0).secondary)):(l.addClass(e,"btn-"+l.bootstrapStyles(!0).secondary),l.removeClass(e,"btn-"+l.bootstrapStyles(!1).primary),e.tabIndex=-1)})}},e.prototype.render=function(e){var t=this,n=t._initOptions(u.utils.defaultOptions);if(!t.$element){var i=t.$schema.enumNames||t.$schema.enum;i=i.map(function(e){return o.tt(e,t.form.$locale)}),t.$element=$(function(e,n,t,i,o,r){i=i||"",n=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},n);var s=[];return u.utils.fieldWrapper(s,n,t,function(){s.push('<div class="btn-group">'),o.forEach(function(e,t){s.push('<button tabindex="-1" type="button" id="{0}_item_'+t+'" class="btn btn-'+l.bootstrapStyles(!0).secondary+'"'),n.width&&s.push(' style="width:'+n.width+'"'),s.push(">"),s.push(a.escapeHtml(r[t]||"")),s.push("</button>")}),s.push("</div>")}),a.format(s.join(""),e)}(t.id,n,t.options.design,o.tt(t.$schema.title,t.form.$locale),t.$schema.enum,i)),t._state2UI()}return t.appendElement(e,n),t.$element},e}(e.groupctrl.Group),t.WizardSteps=i,n.registerControl(i,"*",!0,"wizardctrl",null)}(Phoenix||(Phoenix={})),function(s){var e,t,n=s,a=n.utils,l=n.customData,i=n.ui,u=n.dom,d=n.uiutils;e||(e={}),t=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o.syncClick=o.fieldOptions.syncClick,o.fieldOptions.validate&&(o._validateHandler=l.get(o.fieldOptions.validate)),o._state(),i}return __extends(e,r),e.prototype._tabsParent=function(){var e=this.$element.get(0);return u.find(e,this.id+"_parent")},e.prototype._createTabs=function(){var i=this,o=i._tabsParent(),r=$('<li class="nav-item"><a class="nav-link" href="#"></a></li>').get(0);i.$schema.enum.forEach(function(e,t){var n=r.cloneNode(!0);u.attr(n,"data-name",e),u.text(n.firstChild,i.$schema.enumNames[t]),o.appendChild(n)})},e.prototype.stateChanged=function(e,t){var n=this.form.getState(this.$bind);this.$element&&"isHidden"===e&&n.isHidden!==this.state.isHidden&&(this.state.isHidden=n.isHidden,this.setHidden(this.$element.get(0)))},e.prototype.click=function(e){var t=this,n=t.$element.get(0),i=u.parentByAttr(n,e.target,"data-name");if(i){var o=t.form.getValue(t.$bind),r=u.attr(i,"data-name");if(o===r)return;if(t._validateHandler)t._validateHandler(t.form.$model,o,r);else if(t.syncClick){if(t._sendValidateChildForms(function(){t._checkHasErrors()&&t.form.setValue(t.$bind,r)}))return;if(!t._checkHasErrors())return;t.form.setValue(t.$bind,r)}else t.form.setValue(t.$bind,r)}},e.prototype._sendValidateChildForms=function(e){var t=!1,n=this.form.visibleChildForms();if(n)for(var i=0;i<n.length;i++){var o=n[i];o.data.$validate&&(t=!0,o.execAction(o.data.$validate,null))}return t&&this.form.execAction("$after",{$after:e}),t},e.prototype._checkHasErrors=function(){var e=this.form.visibleChildForms();if(e)for(var t=0;t<e.length;t++)if(e[t].$model.hasErrors())return!1;return!0},e.prototype.changed=function(e,t,n,i){var o=this;e===o.$bind&&(o.syncClick&&o.state.value!=n&&s.utils.nextTick(function(){o.form.visibleChildForms().forEach(function(e){e.formManager.pushSyncAction(e.data.$id,{op:"$empty"}),e.formManager.sendSyncData()})}),o.state.value=n,o._value2UI())},e.prototype._value2UI=function(){for(var e=this._tabsParent(),t=0;t<e.childNodes.length;t++){var n=e.childNodes[t],i=n.firstChild,o=u.attr(n,"data-name");this.state.value===o?(u.addClass(i,"show"),u.addClass(i,"active")):(u.removeClass(i,"show"),u.removeClass(i,"active"))}},e.prototype._state2UI=function(){var e=this.$element?this.$element.get(0):null;e&&(this._value2UI(),this.setHidden(e))},e.prototype.render=function(e){var t,n,i,o=this,r=o._initOptions(d.utils.defaultOptions);return o.$element||(o.$element=$((t=o.id,n=o.options.design,i=[],d.utils.fieldWrapper(i,{},n,function(){i.push('<ul class="nav nav-tabs bs-tabs"  id="{0}_parent"></ul>')}),$(a.format(i.join(""),t)).get(0))),o._createTabs(),o._state2UI()),o.setHidden(o.$element.get(0)),o.appendElement(e,r),o.$element},e}(s.ui.AbsField),i.registerControl(t,"*",!0,"tabs")}(Phoenix||(Phoenix={})),function(e){var t,f,r,m,v,i,n;e.formarraytemplate||(e.formarraytemplate={}),f=(t=e).uiutils,t.customData,t.formcomplex,r=t.ui,t.utils,m=t.dom,t.ctrlsinterfaces,v=e.Observable.SchemaUtils,e.formarray,t.link,i=function(){function e(){}return e.prototype.renderField=function(e,t,n){var i=this.parent.fields[t];if(i){var o=i.schema,r=this.renderOptions.fields&&this.renderOptions.fields[t]||{},s=m.queryAll(e,'[data-bind="'+t+'"]'),a=[];if(s)for(var l=0;l<s.length;l++)a.push({element:s.item(l),bind:!0});if(s=m.queryAll(e,'[data-visibility="'+t+'"]'))for(l=0;l<s.length;l++)a.push({element:s.item(l),bind:!1});if(s=m.queryAll(e,'[data-bind-title="'+t+'"]'))for(l=0;l<s.length;l++)a.push({element:s.item(l),bind:!1});var u=n.getState(t,null);if(i.isLink)for(l=0;l<a.length;l++){var d=a[l].element;u.isHidden?m.addClass(d,"bs-none"):m.removeClass(d,"bs-none"),a[l].bind&&(m.empty(d),f.utils.renderButton(t,r,u,o,d,n),o.description&&o.description&&(d.title=o.description,m.attr(d,"data-toggle","tooltip"),m.attr(d,"data-placement","auto"),m.attr(d,"data-phoenix-tooltip","true")))}else{var c=null;r.display&&r.displaySchema&&(c=f.utils.displayValue(n.getRelativeValue(r.display),r.displaySchema,null,{html:!0,avanced:r.displayOptions||{},state:n.getState(r.display,null),form:this.parent.form},n,r.display));var p=f.utils.displayValue(n.getRelativeValue(t),o,null,{html:!0,avanced:r,display:c,state:u,form:this.parent.form},n,t);for(l=0;l<a.length;l++){d=a[l].element;if(u.isHidden?m.addClass(d,"bs-none"):m.removeClass(d,"bs-none"),a[l].bind)if(m.empty(d),p.html){var h=$(p.value);m.append(d,h.get(0))}else m.append(d,document.createTextNode(p.value||""))}}}},e.prototype._renderIcons=function(e){var i=m.queryAll(e,"[data-icon]");if(i)for(var t=function(e){var t=i.item(e),n=m.attr(t,"data-icon").split(" ");(1<n.length?m.customIconClass(n[0],n[1]):m.iconClass(n[0])).split(" ").forEach(function(e){return m.addClass(t,e)})},n=0;n<i.length;n++)t(n)},e.prototype.render=function(e,t,n,i,o){var r=this;n[i.$id]=i;var s=r.parent.templateElement.cloneNode(!0);s.id=i.$id,m.attr(s,"data-row-id",i.$id),Object.keys(r.parent.fields).forEach(function(e){r.renderField(s,e,i)}),r._renderIcons(s),r.parent.fieldsTitles.forEach(function(e){var t=r.parent.fields[e].schema;f.utils.updateTitle(s,e,t.title||"")});var a=r.parent.renderOptions,l=a.item&&a.item.selectedClass?a.item.selectedClass:"bs-field-selected",u=a.item&&a.item.selectedTarget?a.item.selectedTarget:"self";if(i.$select&&a.selecting&&a.selecting.row){var d=s;"parent"===u&&(d=e),m.addClass(d,l)}m.append(e,s)},e.prototype.replace=function(e,t){var n=this,i=n.parent.templateElement.cloneNode(!0);i.id=t.$id,m.attr(i,"data-row-id",t.$id),Object.keys(n.parent.fields).forEach(function(e){n.renderField(i,e,t)}),n._renderIcons(i),n.parent.fieldsTitles.forEach(function(e){var t=n.parent.fields[e].schema;f.utils.updateTitle(i,e,t.title||"")});var o=n.parent.renderOptions,r=o.item&&o.item.selectedClass?o.item.selectedClass:"bs-field-selected",s=o.item&&o.item.selectedTarget?o.item.selectedTarget:"self";if(t.$select&&o.selecting&&o.selecting.row){var a=i;"parent"===s&&(a=null),a&&m.addClass(a,r)}e.parentNode.replaceChild(i,e)},e.prototype.selectRow=function(e,t,n){var i=this.parent.renderOptions,o=i.item&&i.item.selectedClass?i.item.selectedClass:"bs-field-selected",r=e;"parent"===(i.item&&i.item.selectedTarget?i.item.selectedTarget:"self")&&(r=e.parentNode),t?m.addClass(r,o):m.removeClass(r,o)},e}(),n=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i}return __extends(e,o),e.prototype.destroy=function(){this.templateElement=null,this.pager&&(this.pager.destroy(),this.pager=null),o.prototype.destroy.call(this)},e.prototype._state=function(){o.prototype._state.call(this);var e=this,t=e.fieldOptions;if(e.state.value&&(e.state.value.allowSelecting=e.renderOptions.selecting&&e.renderOptions.selecting.row,e.state.value.expandingProperty=e.renderOptions.expandingProperty,e.state.value.isQueryable()||e.state.value.$states.pageSize)){var n=$.extend({size:"default",selectPage:e._onselectPage.bind(e),noPagesCount:e.state.value.noPagesCount()},t.pager||{});e.pager=new r.Pager(n);var i=e.pager;i.props.hasNext=e.state.value.hasNext(),i.props.hasPrev=e.state.value.hasPrev(),i.props.totalPages=e.state.value.totalPages(),i.props.currentPage=e.state.value.currentPage()}},e.prototype._selectRow=function(e,t){var n=this.renderOptions;if(this.state.value){var i=this._map[e];if(i){var o=i.parentArray;o.selecting(!0,n.expandingProperty);try{var r=!t||!i.$select;i.select(r,t,this.state.value,n.expandingProperty)}finally{o.selecting(!1,n.expandingProperty)}}}},e.prototype.click=function(e){var t=this;if(t.state.value){var n=t.renderOptions,i=m.parentByAttr(t.$element.get(0),e.target,"data-row-id");if(i){var o=t._map[i.id];if(!o)return;var r=m.parentByAttr(t.$element.get(0),e.target,"data-bind");if(r){var s=m.attr(r,"data-bind");if(v.isLink(s)){var a=o.getState(s);return void(a&&!a.isDisabled&&t.form.execAction(t.$bind+".$item."+s,o))}if(t.renderOptions.fields&&t.renderOptions.fields[s]&&t.renderOptions.fields[s].link)return void t.form.execAction(t.$bind+".$item.$links."+t.renderOptions.fields[s].link,o)}n.selecting&&t._selectRow(o.$id,n.selecting.multiselect&&e.ctrlKey)}}},e.prototype.customOptions=function(e){var n=this;if(n._render=new i,(n._render.parent=n)._render.renderOptions=e,o.prototype.customOptions.call(this,e),!e.template)throw'Template is null. Use options: { template: "<div></div>" }';n.templateElement=$(e.template).get(0),e.templateFields=f.utils.extractFieldsFromDom(n.templateElement),n.fields={},n.fieldsTitles=f.utils.extractFieldsTitlesFromDom(n.templateElement),e.templateFields.forEach(function(e){var t={schema:null,isLink:!1};t.schema=v.getSchema(e,n.$schemaItems,n.form.$rootSchema,!1),t.schema?(v.isLink(e)&&(t.isLink=!0),n.fields[e]=t):console.log("Field (bind) not found : "+e)})},e.prototype._onselectPage=function(e){var t=this;switch(e){case"next":t._moveToPage(t.pager.options.noPagesCount?t.pager.props.currentPage+1:Math.min(t.pager.props.totalPages,t.pager.props.currentPage+1));break;case"prev":t._moveToPage(Math.max(0,t.pager.props.currentPage-1));break;case"first":t._moveToPage(1);break;case"last":t._moveToPage(t.pager.props.totalPages);break;default:t._moveToPage(e)}},e.prototype._moveToPage=function(e){this.state.value&&this.state.value.currentPage(e)},e.prototype._containerContent=function(e){e.push('<div><div id="{0}_header"></div><div id="{0}_items"></div><center id="{0}_pagination"></center></div>')},e.prototype._state2UI=function(e){var t=this.$element?this.$element.get(0):null;if(t){this.renderContent(m.find(t,this.id+"_items"));var n=this.$element.find("[data-phoenix-tooltip]");if(n.tooltip&&n.tooltip({html:!0,container:"body",template:'<div class="tooltip bs-tooltip-help" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}),this.pager){var i=$(m.find(t,this.id+"_pagination"));this.pager.render(i)}}},e.prototype.stateChanged=function(e,t,n){var i=this;if(i.$element){var o=t.origProperty.substr(i.$bind.length);if(!(0<=o.indexOf(".$selected"))&&0!==o.indexOf(".$links")){var r=i.form.getState(i.$bind),s=i.$element?i.$element.get(0):null;if(e||!t.isState)e&&"isHidden"!==e||r.isHidden!==i.state.isHidden&&(i.state.isHidden=r.isHidden,i.setHidden(s)),e&&"isDisabled"!==e||r.isDisabled!=i.state.isDisabled&&(i.state.isDisabled=r.isDisabled);else{var a=v.parsePath(i.$bind,t.property,i.renderOptions.expandingProperty);if(n[a])t.property.substr(a.length+1),t.origProperty.substr(t.property.length+1)}}}},e.prototype.changed=function(e,t,n,i,o){var r=this;if(r.$element&&!(0<=e.substr(r.$bind.length).indexOf(".$selected"))){var s=r.renderOptions,a=!1;o.checkChildren&&"propchange"===i&&e===r.$bind&&(r.state.value=r.form.getValue(r.$bind),r.state.value.allowSelecting=s.selecting&&(s.selecting.row||s.selecting.cell),r.state.value.expandingProperty=s.expandingProperty);var l=!1;switch(r.state.value||(i="none"),i){case"count":break;case"pagination":var u=r.pager;u&&(u.props.totalPages=r.state.value.totalPages(),u.props.currentPage=r.state.value.currentPage(),u.props.hasNext=r.state.value.hasNext(),u.props.hasPrev=r.state.value.hasPrev());break;case"sorting":break;case"propchange":if(e===r.$bind)l=a=!0;else{var d=e,c=v.parsePath(r.$bind,d,s.expandingProperty),p=o[c];if(p){var h=e.substr(c.length+1);if(!h)return;var f=m.find(r.$element.get(0),p.$id);f&&("*"===h?r._render.replace(f,p):v.isSelectField(h)?r._render.selectRow(f,p.$select,p):r._render.renderField(f,h,p)),l=!0}}break;case"remove":case"add":l=a=!0}a&&r._state2UI(!1),l&&r.resize()}},e}(e.formarray.ArrayControl),r.registerControl(n,"array",!1,"template-array-control",null)}(Phoenix||(Phoenix={})),function(e){var t,r=e.utils,n=e.ui,s=e.dom,a=e.uiutils,i=e.ulocale;e.formlink||(e.formlink={}),t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._button=function(){return this.$element?this.renderOptions.inline?this.$element.get(0):this.$element.get(0).firstChild:null},t.prototype._renderButton=function(){return $(function(e,t,n,i){i=i||"",t=$.extend({icon:null,type:"default",size:null},t);var o=[];return a.utils.fieldWrapper(o,t,n,function(){o.push('<button type="button"'),o.push(' class="bs-button btn btn-link'),t.size&&o.push(" btn-"+t.size),o.push('"'),o.push(">"),o.push('<span class="'+s.iconClass(t.icon)+'"></span>'),o.push("</button>"),o.push("<span>"+i+"</span>")}),r.format(o.join(""),e)}(this.id,this.renderOptions,this.options.design,i.tt(this.title,this.form.$locale)))},t}(e.formlinkbase.LinkBase),n.registerLinkControl(t,"title-button")}(Phoenix||(Phoenix={})),function(o){!function(e){var t=o.ui,s=o.utils,i=o.dom,r=o.ulocale,a=o.uiutils;function l(e,i,t,o){o=o||"",i=$.extend({titleIsHidden:!1,placeHolder:!1,columns:!1},i);var r=[];return a.utils.fieldWrapper(r,i,t,function(){if(!i.titleIsHidden){var e=["bs-label"];r.push('<label for="{0}_input" id="{0}_label"'),i.columns&&(e.push("col-form-label"),e.push("bs-lib-col col-sm-"+i.labelCol),i.labelLeft&&e.push("text-left")),i.inline&&(e.push("form-check-inline"),e.push("bs-cursor-d no-x-padding")),e.length&&r.push(' class="'+e.join(" ")+'"'),r.push(">"),r.push(s.escapeHtml(o||"")+(i.inline?"&nbsp;":"")),a.utils.addTooltipAndRule(r,i),r.push("</label>")}var t,n;i.columns&&r.push('<div class="no-x-padding col-sm-'+(12-i.labelCol)+'" id="{0}_colparent">'),t=r,n=i.inline?"tgl-btn-inline":"",t.push('<input class="tgl tgl-light" id="{0}_input" type="checkbox">'),t.push(s.format('<label class="tgl-btn {0}" for="{1}_input"></label>',n,"{0}")),i.columns&&r.push("</div>"),i.titleIsHidden&&a.utils.addTooltipAndRule(r,i)}),s.format(r.join(""),e)}var n=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i._state(),i}return __extends(e,o),e.prototype._check=function(){if(!this.$element)return null;var e=this.$element.get(0);return i.find(e,this.id+"_input")},e.prototype.click=function(e){var t=this,n=t._check(),i=n.checked||!1;t.renderOptions.readOnly||t.state.isDisabled||t.state.isReadOnly?e.preventDefault():e.target==n&&t.state.value!=i&&(t._isBinded?(t.state.value=i,t.form.setValue(t.$bind,i)):t.setInternalValue(i,!0))},e.prototype._setDisabled=function(e,t){var n=this._check();this.state.isDisabled||this.state.isReadOnly||this.renderOptions.readOnly?i.removeClass(n,"active"):i.addClass(n,"active"),e.disabled=this.state.isDisabled},e.prototype._setReadOnly=function(e,t){this._setDisabled(e,t)},e.prototype._setMandatory=function(e,t){},e.prototype._state2UI=function(){var e=this._check(),t=this.$element?this.$element.get(0):null;e&&(e.checked=this.state.value||!1,this._setDisabled(e,t),this._setReadOnly(e,t),this.setHidden(t))},e.prototype.changed=function(e,t,n,i){var o=this._check();this.state.value!=n&&(this.state.value=n,o.checked=this.state.value||!1)},e.prototype.stateChanged=function(e,t){var n=this,i=n._isBinded?n.form.getState(n.$bind):n._internalState,o=n._check(),r=n.$element?n.$element.get(0):null;i.isHidden!==n.state.isHidden&&(n.state.isHidden=i.isHidden,o&&n.setHidden(r)),i.isDisabled!=n.state.isDisabled&&(n.state.isDisabled=i.isDisabled,o&&n._setDisabled(o,r)),i.isReadOnly!=n.state.isReadOnly&&(n.state.isReadOnly=i.isReadOnly,o&&n._setReadOnly(o,r)),i.isMandatory!=n.state.isMandatory&&(n.state.isMandatory=i.isMandatory,o&&n._setMandatory(o,r))},e.prototype.render=function(e){var t=this,n=t._initOptions(a.utils.defaultOptions);return t.$element||(t.$schema.description&&(n.description=r.tt(t.$schema.description,t.form.$locale)),t.$element=$(l(t.id,n,t.options.design,r.tt(t.title,t.form.$locale))),t._state2UI()),t.appendElement(e,n),t.$element},e}(o.ui.AbsField);e.Toggle=n,t.registerControl(n,"boolean",!1,"toggle",null)}(o.togglectrl||(o.togglectrl={}))}(Phoenix||(Phoenix={})),function(f){var u,e,t=f,p=t.utils,n=t.ui,m=t.link,y=t.dom,s=t.uiutils;f.wizard||(f.wizard={}),u="invisible",e=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return o._step=1e3,o.fieldOptions.bindStep?(o._step=o.form.getValue(o.fieldOptions.bindStep),n.registerListenerFor(o.fieldOptions.bindStep,o)):o.fieldOptions.step&&(o._step=o.fieldOptions.step),o.syncClick=o.fieldOptions.syncClick,o._state(),o._init(),i}return __extends(e,r),e.prototype.destroy=function(){this.form.unRegisterListenerFor(this.fieldOptions.bindStep,this),r.prototype.destroy.call(this)},e.prototype._createSteps=function(){var u=this,e=u.$element.get(0),d=y.find(e,u.id+"_parent"),c=u._steps.length-1;u._steps.forEach(function(e,t){var n,i,o,r,s,a,l;d.appendChild((n=u.id,i=t+1,o=e.code,r=e.libelle,s=e.status,a=t&&t===c,l=['<div id="{0}_{1}" class="d-inline-block">','<div class="bs-step bs-cursor-p d-table align-middle bs-cursor-pointer">','<span data-step-code="{2}" class="bs-step-icon d-table-cell align-middle">','<span data-step-code="{2}" id="{0}_{1}_icon" class="bs-step-circle text-center d-inline-block'+("A"===s?" active "+y.iconClass("edit"):"V"===s?" validated "+y.iconClass("check"):"")+'">'+("N"===s?i:"")+"</span>","</span>",'<span data-step-code="{2}" id="{0}_{1}_title" class="bs-pointer-p bs-step-title d-table-cell align-middle text-nowrap">'+p.escapeHtml(r)+"</span>",'<span id="{0}_{1}_line" class="bs-step-line bs-cursor-d d-table-cell align-middle'+(a?" bs-none":"")+'"><span class="bs-step-line-content"></span></span>',"</div>","</div>"],$(p.format(l.join(""),n,i,o)).get(0)))})},e.prototype._measure=function(e){var s=this;s._measured=!0;var t=s.$element.get(0),a=y.find(t,s.id+"_parent");s._steps.length;s._hlineWidth=0,s._steps.forEach(function(e,t){var n=a.childNodes[t],i=y.position(n,a);e.width=i.width;var o=y.find(n,s.id+"_"+(t+1)+"_title");if(y.addClass(o,"bs-none"),i=y.position(n,a),e.widthNoCaption=i.width,y.removeClass(o,"bs-none"),0===t){var r=y.find(n,s.id+"_"+(t+1)+"_line");i=y.position(r,a),s._hlineWidth=i.width}}),s._resizeTo(e),y.removeClass(a,"invisible")},e.prototype._init=function(){for(var e=!(this._steps=[]),t=0;t<this.$schema.enum.length;t++){var n="V";e?n="N":this.state.value===this.$schema.enum[t]&&(e=!0,n="A"),this._steps.push({code:this.$schema.enum[t],libelle:this.$schema.enumNames[t],status:n,width:0,widthNoCaption:0})}},e.prototype.stateChanged=function(e,t){this._state(),this.$element&&"isHidden"===e&&(this.setHidden(this.$element.get(0)),this.state.isHidden||this.resize())},e.prototype.click=function(e){var t,n=this;if(0!==n._step&&!n.state.isDisabled){var i=y.attr(e.target,"data-action");if("next"===i)0<=(o=n.$schema.enum.indexOf(n.state.value))&&o+1<n.$schema.enum.length&&(t=n.$schema.enum[o+1]);else if("prev"===i){0<(o=n.$schema.enum.indexOf(n.state.value))&&(t=n.$schema.enum[o-1])}else t=y.attr(e.target,"data-step-code");if(t){n.state.value;var o=n.$schema.enum.indexOf(n.state.value),r=n.$schema.enum.indexOf(t);if(1===n._step)if(0<=o){var s=n.$schema.enum.indexOf(t);s&&o<s&&(t=n.$schema.enum[o+1])}else t=n.state.value;if(o<r&&t!==n.state.value){if(n._sendValidateChildForms(n.state.value+"",function(){n._checkHasErrors()&&n.form.setValue(n.$bind,t)}))return;if(!n._checkHasErrors())return;n.form.setValue(n.$bind,t)}else n.form.setValue(n.$bind,t)}}},e.prototype._checkHasErrors=function(){if(this._checkSelf&&(this._checkSelf=!1,this.form.$model.hasRootErrors()))return!1;var e=this.form.visibleChildForms();if(e)for(var t=0;t<e.length;t++)if(e[t].$model.hasErrors())return!1;return!0},e.prototype._sendValidateChildForms=function(e,t){var n=!1,i=this.form.visibleChildForms();if(i)for(var o=0;o<i.length;o++){var r=i[o];r.data.$validate&&(n=!0,r.execAction(r.data.$validate,null))}return this.renderOptions.validation&&this.renderOptions.validation[e]?(this._checkSelf=!0,this.form.execAction(this.renderOptions.validation[e],{$after:t}),!0):(n&&this.form.execAction("$after",{$after:t}),n)},e.prototype.changed=function(e,t,n,i){var o=this;if(e===o.$bind){o.syncClick&&o.state.value!=n&&f.utils.nextTick(function(){o.form.visibleChildForms().forEach(function(e){e.formManager.pushSyncAction(e.data.$id,{op:"$empty"}),e.formManager.sendSyncData()})}),o.state.value=n,o.renderOptions.searchKey&&m.updateSearchEntry(o.renderOptions.searchKey,o.state.value);var r=!1;if(o._steps&&o._steps.length)for(var s=0;s<o._steps.length;s++){var a=o._steps[s],l="V";if(r?l="N":o.state.value===a.code&&(r=!0,l="A"),a.status!==l){a.status=l;var u=y.find(o.$element.get(0),o.id+"_"+(s+1)+"_icon"),d=["bs-step-circle text-center d-inline-block"],c=!0;"A"===l?(c=!0,d.push(y.iconClass("edit")),d.push("active")):"V"===l?(c=!0,d.push(y.iconClass("check")),d.push("validated")):c=!1,u.className=d.join(" "),y.text(u,c?"":s+1+"")}}o.resize()}else if(e&&e===o.fieldOptions.bindStep){var p=o.form.getValue(o.fieldOptions.bindStep);if(p!==o._step){var h=0===p||0===o._step;o._step=p,h&&o.resize()}}},e.prototype._resizeTo=function(r){var a=this,e=a.$element.get(0),l=y.find(e,a.id+"_parent"),o=0,s=0,u=0,d=a._steps.length;a._steps.forEach(function(e,t){switch(o+=e.width,e.status){case"A":s+=e.width,u+=e.width;break;case"V":var n=a._steps[t+1];n&&"A"===n.status?s+=e.width:s+=e.widthNoCaption,u+=e.widthNoCaption;break;case"N":var i=a._steps[t-1];i&&"A"===i.status?s+=e.width:s+=e.widthNoCaption,u+=e.widthNoCaption}});var t=0,n=!1,c=!1,p=!1;if(o<=r?(n=!0,t=r-o):s<=r?(c=n=!0,t=r-s):u<=r&&(p=n=!0,t=r-u),n){for(var i=1<a._steps.length?a._steps.length-1:1,h=Math.floor(t/i)+a._hlineWidth,f=y.queryAll(l,".bs-step-line"),m=0,v=f.length;m<v;m++){var g=f[m];y.hasClass(g,"bs-none")||(g.style.width=h+"px")}a._steps.forEach(function(e,t){var n=l.childNodes[t],i=y.find(n,a.id+"_"+(t+1)+"_title");if(t&&t===d-1){var o=y.find(n,a.id+"_"+(t+1)+"_line");y.hasClass(o,"bs-none")||y.addClass(o,"bs-none")}if(c)switch(e.status){case"A":y.removeClass(i,"bs-none");break;case"V":var r=a._steps[t+1];r&&"A"===r.status?y.removeClass(i,"bs-none"):y.hasClass(i,"bs-none")||y.addClass(i,"bs-none");break;case"N":var s=a._steps[t-1];s&&"A"===s.status?y.removeClass(i,"bs-none"):y.hasClass(i,"bs-none")||y.addClass(i,"bs-none")}else p?"A"===e.status?y.removeClass(i,"bs-none"):y.hasClass(i,"bs-none")||y.addClass(i,"bs-none"):y.removeClass(i,"bs-none");y.removeClass(n,"bs-none")})}else a._steps.forEach(function(e,t){var n=l.childNodes[t],i=y.find(n,a.id+"_"+(t+1)+"_title");if("A"===e.status){var o=y.find(n,a.id+"_"+(t+1)+"_line");t===d-1&&y.removeClass(o,"bs-none"),o.style.width=Math.max(0,r-e.width+a._hlineWidth)+"px",y.removeClass(i,"bs-none"),y.removeClass(n,"bs-none")}else y.hasClass(n,"bs-none")||y.addClass(n,"bs-none")})},e.prototype.resize=function(){var e=this,t=e.$element.get(0),n=y.find(t,e.id+"_root"),i=(y.find(t,e.id+"_parent"),e.$schema.enum.indexOf(e.state.value)),o=0!==e._step&&i+1<e.$schema.enum.length,r=0!==e._step&&0<i,s=y.find(t,e.id+"_next"),a=y.find(t,e.id+"_prev");o?y.removeClass(s,u):y.hasClass(s,u)||y.addClass(s,u),r?y.removeClass(a,u):y.hasClass(a,u)||y.addClass(a,u);var l=y.position(n,null).width;l&&(e._measured?e._resizeTo(l):window.setTimeout(function(){e._measure(l)},10))},e.prototype.render=function(e){var t,n,i,o=this,r=o._initOptions(s.utils.defaultOptions);return o.$element||(o.$element=$((t=o.id,n=o.options.design,i=[],s.utils.fieldWrapper(i,{},n,function(){i.push('<div class="bs-step-root">'),i.push('<span data-action="prev" id="{0}_prev" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle '+u+'">'),i.push('<span data-action="prev" class="bs-step-arrow text-center d-inline-block '+y.iconClass("arrow-left")+'"></span>'),i.push("</span>"),i.push('<div class="bs-step-parent-parent" id="{0}_root"><div class="bs-step-parent invisible" id="{0}_parent"></div></div>'),i.push('<span data-action="next" id="{0}_next" class="bs-cursor-p bs-arrow-parent d-inline-block align-middle '+u+'">'),i.push('<span data-action="next" class="bs-step-arrow text-center d-inline-block '+y.iconClass("arrow-right")+'"></span>'),i.push("</span>"),i.push("</div>")}),$(p.format(i.join(""),t)).get(0))),o._createSteps()),o.setHidden(o.$element.get(0)),o.appendElement(e,r),o.$element},e}(f.ui.AbsField),n.registerControl(e,"*",!0,"steppers")}(Phoenix||(Phoenix={})),function(e){var t,n,i=e.render,r=e.ui,s=(e.Observable,e.Observable.SchemaUtils);t||(t={}),n=function(e,t,n){if(s.isLink(e.$bind))return r.getRegisteredLinkControl(e.$widget);var i=s.isMeta(e.$bind);if(i)return r.getRegisteredControl("meta",!1,i.widget,"",{});if(!t){if("$none"!==e.$bind)return;t={}}var o={};return e.$readOnly&&(o.readOnly=!0),n&&(o.lookup=!0),r.getRegisteredControl(t.type,!!t.enum,e.$widget,t.format,o)},i.register("javascript","field.control",n),i.register("angular","field.control",n)}(Phoenix||(Phoenix={})),function(e){var t=Phoenix||(Phoenix={}),a=t.locale,l=t.ui,n=t.utils,u={type:"object",properties:{message:{type:"string"}}},d={name:"alert",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]};n.alert=function(e,t,n){var i,o,r,s;i=t,o=n,r={title:e||a.ui.Info,noClose:!0,buttons:[{type:"primary",title:a.ui.Ok,name:"ok"}]},s={message:i},l.OpenModalForm(r,d,u,s,null,function(e,t,n,i){if("modal-action"===t.operation)switch(t.property){case"ok":e.close(),o&&o()}})}}(),function(e){var t=Phoenix||(Phoenix={}),n=t.locale,i=(t.utils,t.external),a=t.application,l=t.DatasetPlugin,u=t.dom,o=t.ui,r={name:"form",$type:"block",$items:[{$bind:"oldPwd"},{$bind:"newPwd"},{$bind:"$$newPwd"}]};i.changePasswordHandler=function(s){var e={type:"object",properties:{oldPwd:{title:n.ui.password.oldPassword,type:"string",format:"password",capabilities:{noConfirming:!0}},newPwd:{title:n.ui.password.newPassword,type:"string",format:"password",minLength:8}},states:{oldPwd:{isMandatory:!0},newPwd:{isMandatory:!0}}},t={title:n.ui.password.change,buttons:[{pattern:"validate"}]};o.OpenModalForm(t,r,e,{},{},function(n,e,i,t){switch(e.property){case"validate":if(!i.validate())return;var o=a.configuration&&a.configuration.application&&a.configuration.application.authentication?a.configuration.application.authentication.changePasswordDs:null;if(!o)return void n.close();u.processing(!0);var r={oldPwd:i.oldPwd,newPwd:i.newPwd};o.name="data",l.executeDatasets([o],r,{},[],function(e,t){t?(i.addAjaxException(t),u.processing(!1)):(u.processing(!1),n.close(),s&&s())})}})}}(),function(e){var t=e,s=t.locale,a=t.ui,n=t.utils,l={type:"object",properties:{message:{type:"string"}}},u={name:"confirm",$type:"block",$items:[{$bind:"message",$readOnly:!0,options:{$expression:"{{message}}"}}]},o=function(e,t,o,r){var n={title:e=e||s.ui.Warning,noClose:!0,buttons:[{type:"default",title:s.ui.No,name:"no"},{type:"primary",title:s.ui.Yes,name:"yes"}]},i={message:t};a.OpenModalForm(n,u,l,i,null,function(e,t,n,i){if("modal-action"===t.operation)switch(t.property){case"yes":e.close(),o&&o();break;case"no":e.close(),r&&r()}})};e.confirmDlg=o,n.confirm=function(e,t,n,i){o(e,t,n,i)}}(Phoenix||(Phoenix={})),function(e){var t,r,s,n,i;t=e.ui||(e.ui={}),(r=e).dom,s=r.link,n=r.utils,r.application,r.ulocale,r.locale,i=function(){function e(e,t){this.$id=n.allocID(),t.maxWidth=t.maxWidth||128,this._options=t}return e.prototype._setEvents=function(){var o=this;if(o.$element){if(o._options.authoring)return;var r=o.$element.get(0);o.$element.on("click",function(e){var t=s.isCustomLink(r,e);if(t&&"click"===t.protocol){var n=o._options.link,i=s.context();"string"==typeof n?o.module&&o.module.links&&o.module.links[n]?s.execLink(o.module.links[n],i,null):s.execLink({$page:n},i,null):n.$page&&s.execLink(n,i,null)}})}},e.prototype._removeEvents=function(){this._options.authoring||this.$element&&this.$element.off("click")},e.prototype.render=function(e){this.$element||(this.$element=$(n.format(function(e){var t=r.bootstrap4,n=[],i=["bs-relative bs-image-mi-image"];i.push(t?"img-fluid":"img-responsive"),n.push('<div id="{0}" class="bs-image-mi bs-cursor-d">'),n.push('<div class="bs-image-mi-border"'),e.link&&n.push('href="click://navigate"'),n.push(">");var o=["max-width:"+e.maxWidth+"px;"];return n.push('<img id="{0}_img" class="'),n.push(i.join(" ")),n.push('" src="'+e.imageSrc+'"'),o.length&&n.push(' style="'+o.join("")+'"'),n.push(" />"),n.push('<span class="bs-image-mi-title">'+e.title+"</span>"),n.push("</div>"),n.push("</div>"),n.join("")}(this._options),this.$id)),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.destroy=function(){this.module=null,this._removeEvents(),this.$element=null,this._options=null},e}(),t.ImageMenuItem=i}(Phoenix||(Phoenix={})),function(e){var t=Phoenix||(Phoenix={}),u=(t.locale,t.dom),n=t.utils,d=t.pagecontrol,i=t.autoclose;n.info=function(r,s,a,l){i.open(i.SCREEN_CENTER,{width:"400px",style:"$white",contentRender:function(e,t,n){var i=[];i.push('<div class="no-y-margin alert alert-'+a+'" role="alert">'),i.push('<h4 class="alert-heading">'+r+"</h4>"),i.push("<p>"+s+"</p>"),i.push("</div>");var o=$(i.join("")).get(0);u.append(e.get(0),o),window.setTimeout(function(){d.Page().setPopup(null),l&&l()},2e3),n()},parent:null,alignElement:null,beforeClose:null})},n.message=function(e,t,n,i){if(e&&t)if(i){var o=[];o.push('<div class="no-y-margin alert alert-'+n+'" role="alert">'),o.push("<p>"+t+"</p>"),o.push("</div>");var r=$(o.join("")).get(0);u.append(e,r)}else u.empty(e)}}(),function(e){var t,n,s,u,i;t=e.data||(e.data={}),s=(n=e).data,u=n.utils,i=function(){function e(e,t,n,i,o,r,s){this._enums={},this._entity=t,this._module=e,this._typeField=n,this._codeField=i,this._titleField=o,this._orderByField=r,this._fields=s}return e.prototype.promise=function(i,n){var a={},o=[],l=this,r=[];if(Object.keys(i).forEach(function(e){var t=i[e];if(l._enums[e])a[e]=l._enums[e];else{o.push({name:e,config:t});var n=l._typeField+" eq '"+e+"'";t.filter&&(n="("+n+" and "+t.filter+")"),r.push(n)}}),!o.length)return new u.Promise(function(e,t){e({type:n,enums:a})});var e={$top:1e3,nocount:!0,$entity:l._entity,$module:l._module,$filter:r.join(" or "),$orderby:l._typeField+","+l._orderByField};return s.odata.getRessources(e,function(e){return e.documents&&e.documents.forEach(function(t){var e=t[l._codeField],n=t[l._titleField],i=t[l._typeField];if(a[i]||(a[i]={enum:[],enumNames:[]},l._enums[i]=a[i]),l._fields){a[i].fields=a[i].fields||[];var o=[],r={};if(l._fields.forEach(function(e){t[e]&&o.push(t[e]),r[e]=t[e]}),a[i].fields.push(r),o.length){var s=o.join("$");a[i].filters=a[i].filters||{},a[i].filters[s]=a[i].filters[s]||[],a[i].filters[s].push(e)}}a[i].enum.push(e),a[i].enumNames.push(n)}),{type:n,enums:a}})},e}(),t.OdataEnumManager=i}(Phoenix||(Phoenix={})),function(e){var t=Phoenix||(Phoenix={}),a=t.locale,n=t.utils,l=t.ui,u={type:"object",properties:{value:{type:"string"}}},d={name:"prompt",$type:"block",$items:[{$bind:"value",options:{titleIsHidden:!0}}]};n.prompt=function(e,t,n){var i,r,o,s;i=t,r=n,o={title:e||a.ui.Warning,buttons:[{type:"primary",title:a.ui.Ok,name:"ok"}]},s={value:i||""},l.OpenModalForm(o,d,u,s,null,function(e,t,n,i){if("modal-action"===t.operation)switch(t.property){case"ok":var o=n.value;e.close(),r&&r(o)}})}}(),function(e){var o=e.application,t=e.external,r=e.ajax,s=e.utils;t.ruleLoaderHandler=function(e){var t=o.configuration;if(t&&t.rules&&t.rules.odataEntity){var n=t.rules.odataEntity+"?$filter="+encodeURIComponent("clientSide eq 'true'")+"&$expand="+encodeURIComponent("entities($filter=entity in ("+e.map(function(e){return"'"+e+"'"}).join(",")+"))"),i=r.getDefaultAjaxOptions(null);return r.get(n,i,function(e){return e.value})}return s.Promise.resolve([])}}(Phoenix||(Phoenix={})),function(e){var n=e.autoclose,t=e.external,i=e.ui;t.ruleViewer=function(e){var t={name:{name:"rule-list-viewer",form:!0,$type:"block",$items:[{$type:"block",$title:{value:"Rules",size:4},$items:[{$bind:"rules",$widget:"basicgrid",options:{border:!0,height:400,scrolling:{horizontal:!0,vertical:!0},columns:[{$bind:"ruleType",options:{width:70}},{$bind:"name",options:{width:100}},{$bind:"description",options:{width:150}},{$bind:"expression",options:{width:200}}]}}]}]},meta:{type:"object",properties:{rules:{type:"array",items:{type:"object",properties:{name:{type:"string",title:"Name"},description:{type:"string",title:"Description"},ruleType:{type:"string",title:"Type"},expression:{type:"string",title:"Expression"}}}}}},controller:{onModelChanged:function(){}},autoClose:{align:n.SCREEN_CENTER,minWidth:300,showCloseButton:!0},options:{}};i.showAutoCloseForm(t,{rules:e},null)}}(Phoenix||(Phoenix={})),function(e){var t,r,s,n,a,l,u,o;e.Data||(e.Data={}),(t=e).ulocale,r=t.application,s=t.ajax,n=t.data,a=t.utils,l=t.Observable.SchemaUtils,u=t.dom,o=function(e,i){var t=r.config(r.name);if(!t)throw"Application configuration not found.";var n=t.current.prototypes+"/"+e,o=s.get(n,{},function(e){return e});return new a.Promise(function(n,t){o.then(function(e){u.processing(!0),l.loadEnumsPromise(e).then(function(e){var t;u.processing(!1),n((t=e,i&&(t=i(t)),t))}).catch(function(e){u.processing(!1),t(e)})}).catch(function(e){t(e)})})},n.registerDataProvider("form-meta",function(e,t,n,i){return o(e.$params.$url,function(e){return e})})}(Phoenix||(Phoenix={})),function(e){var t=Phoenix||(Phoenix={}),i=t.locale,n=t.utils,u=t.dom,d=t.ajax,o=t.ui,r={name:"confirm",$type:"block",$items:[{$type:"block",$items:[{$bind:"title"}]},{$type:"block",$items:[{$bind:"fileName",options:{titleIsHidden:!0,readOnly:!0,showErrors:!0,minWidth:"25em"}},{$bind:"fileName",$name:"upload",$widget:"upload",options:{type:"primary"}}],$inline:!0}]};n.upload=function(a,l){var e={title:a.formTitle,noClose:!0,buttons:[{pattern:"validate"},{pattern:"abandon"}]},t={$errors:{$:[]},$states:{title:{isHidden:!a.showUploadTitle}}},n={type:"object",properties:{title:{title:a.title,type:"string"},fileName:{title:i.ui.FileUpload,type:"string"}}};a.infoMessage&&t.$errors.$.push({message:a.infoMessage,severity:"warning"}),o.OpenModalForm(e,r,n,t,null,function(t,e,n,i){if("modal-action"===e.operation)switch(e.property){case"fileName":var o=n.$errors.$;o&&o.clear(!0);break;case"validate":if(n.hasErrors()||!n.fileName)return;var r=i.controlByName("upload",!1)[0],s=new FormData;s.append("title",n.title),s.append("file",r.uploadInput().files[0]),u.processing(!0),d.post(a.url,s,{processData:!1,headers:{contentType:!1}}).then(function(e){u.processing(!1),l&&l(e,i),t.close()}).catch(function(e){u.processing(!1),n.addAjaxException(e)})}})}}(),function(e){var t,n,i;t=e.iframe||(e.iframe={}),(n=e).dom,n.utils,n.locale,i=function(){function e(e){this._options=$.extend({src:"https://www.google.com"},e||{})}return e.prototype._setEvents=function(){if(this.$element){var e=this.$element;e.iFrameResize&&e.iFrameResize(this._options)}},e.prototype._removeEvents=function(){},e.prototype.render=function(e){this.$element||(this.$element=$('<iframe src="'+this._options.src+'" scrolling="no" width="100%" frameBorder="0" border="0"></iframe>'),this._setEvents()),e&&(this._options.replaceParent?e.replaceWith(this.$element):e.append(this.$element))},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this._options=null},e}(),t.IFrame=i}(Phoenix||(Phoenix={})),function(e){var t,r,s,n;t=e.ui||(e.ui={}),r=e.DatasetPlugin,s=e.dom,n=function(){function e(e,t){var n=this;n._init=!1,n._options=t||{},n._notify=t.notify,n._ds=e||{},n._ds.mapping=n._ds.mapping||{},n._ds.mapping.code=n._ds.mapping.code||"code",n._ds.mapping.libelle=n._ds.mapping.libelle||n._ds.mapping.lib||"lib";var i=e.data.$params||{};n._pageSize=i.$top||null,n.searchText=null,n._count=0,n._page=0,n._items=[],n._initData()}return e.prototype._initData=function(){var i=this,o={},e=i._ds.data||{},t={name:"dataset",$type:e.$type||"odata",$params:{$entity:e.$params.$entity,$module:e.$params.$module,$top:1}};s.processing(!0),r.executeDatasets([t],{},o,null,function(e,t){if(s.processing(!1),!t){i._init=!0;var n=o.dataset;i._count=n.count,i._notify(null,{inited:!0,updated:!0})}},!1)},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){e&&(this._items=e,this._notifyChange("items"))},enumerable:!0,configurable:!0}),e.prototype._notifyChange=function(e){switch(e){case"items":this._notify(this.items,{})}},e.prototype.getNbPages=function(){return Math.ceil(this._count/this._pageSize)},e.prototype._getSkip=function(e){return this._pageSize?e*this._pageSize:0},e.prototype._getPage=function(e,t){var i=this;if(i._init){var n=$.extend(!0,{},i._ds.data),o={};n.name="dataset",n.$params=n.$params||{},n.$params.$skip=i._getSkip(e),t=t||{},i.searchText&&(t.$searchText=i.searchText),s.processing(!0),r.executeDatasets([n],t,o,null,function(e,t){if(s.processing(!1),!t){var n=o.dataset;n&&i._count!=n.count&&(i._count=n.count,i._page=0,i._notify(null,{updated:!0})),n.documents&&(n.documents=n.documents.map(function(e){return{code:e[i._ds.mapping.code],libelle:e[i._ds.mapping.libelle]||e[i._ds.mapping.code]}}),i.items=n.documents)}},!1)}},e.prototype.currentPage=function(){return this._page},e.prototype.toPage=function(e){0<=e&&e<this.getNbPages()&&(this._page=e,this._getPage(e))},e.prototype.nextPage=function(){var e=this._page+1;e<this.getNbPages()&&(this._page=e,this._getPage(e))},e.prototype.prevPage=function(){var e=this._page-1;0<=e&&(this._page=e,this._getPage(e))},e.prototype.firthPage=function(){this._page=0,this._getPage(0)},e.prototype.lastPage=function(){var e=this.getNbPages()-1;this._page=e,this._getPage(e)},e.prototype.search=function(e){this.searchText=e||null,this._ds.data.$params.$search&&this._getPage(0)},e.prototype.remove=function(){},e}(),t.DsLookup=n}(Phoenix||(Phoenix={})),function(D){!function(i){var s=i,a=D.utils,e=D.filters,l=D.uiutils,r=D.locale,u=(D.ulocale,D.dom),d=D.Observable.SchemaUtils,c=e.OPERATORS,t=e.TYPES,p=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,n,i){var o={code:e,libelle:t||e,isBinary:n,options:i||{}};o.options.symbol=i.symbol||t||e,n&&(o.options.liaison=o.options.liaison||"et"),this.liste.push(o)},e.prototype.gets=function(){return this.liste},e.prototype.get=function(t){return this.liste.find(function(e){return e.code==t})},e.prototype.remove=function(t){var e=this.liste.findIndex(function(e){return e.code==t});0<=e&&this.liste.splice(e,1)},e}();i.ListeOperateurs=p;var h=function(){function e(){this.liste=[]}return e.prototype.add=function(e,t,n,i){this.liste.push({code:e,libelle:t||e,type:n||"string",options:i||{}})},e.prototype.get=function(t){return this.liste.find(function(e){return e.code==t})},e.prototype.gets=function(){return this.liste},e.prototype.remove=function(t){var e=this.liste.findIndex(function(e){return e.code==t});0<=e&&this.liste.splice(e,1)},e}();i.ListeChamps=h;var o=function(){function e(e,t,n,i){this.id=e,this.code=t,this.op=n,this.values=i||[]}return e.prototype.getValues=function(){return this.values.map(function(e){return e&&e.code?e.code:e})},e.prototype.getValueNames=function(){return this.values.map(function(e){return e&&e.lib?e.lib:e})},e}();i.Filter=o;var f=function(){function e(e){this.liste=[],this.filters=e,this.compteur=0}return e.prototype.add=function(e,t,n){var i=new o(this.compteur++,e,t,n);return this.liste.push(i),this.filters.push(i),i},e.prototype.add2=function(e,t,n){var i=new o(this.compteur++,e,t,n);return this.liste.push(i),i},e.prototype.set=function(n,e){var i,o=-1;if(this.liste.forEach(function(e,t){e.id==n&&(i=e,o=t)}),i&&(i.op=e.op,i.values=e.values||[]),0<=o&&o<this.filters.length){var t=this.filters.get(o);t&&(t.code=i.code,t.op=i.op,t.values=i.values)}return i},e.prototype.get=function(t){return this.liste.find(function(e){return e.id==t})},e.prototype.getByIndex=function(e){return this.liste[e]},e.prototype.gets=function(){return this.liste},e.prototype.getsByChamp=function(t){var n=[];return this.liste.forEach(function(e){e.code==t&&n.push(e)}),n},e.prototype.remove=function(t){var e=this.liste.findIndex(function(e){return e.id==t});0<=e&&(this.liste.splice(e,1),this.filters.remove(this.filters.get(e)))},e.prototype.removeAll=function(){var n=this;n.liste.splice(0),n.filters.forEach(function(e,t){n.filters.remove(n.filters.get(t))})},e.prototype.removeAllByChamp=function(n){var i=this;i.liste.forEach(function(e,t){e.code==n&&(i.liste.splice(t,1),i.filters.remove(i.filters.get(t)))})},e}();i.ListeFilters=f;var m=function(){function e(){this.liste=[]}return e.prototype.addType=function(e,t,n){this.liste.push({code:e,libelle:t||e,operateurs:n||[]})},e.prototype.get=function(t){return this.liste.find(function(e){return e.code==t})},e.prototype.addOperateur=function(t,e){this.liste.find(function(e){return e.code==t}).operateurs.push(e)},e.prototype.getOperateurs=function(t){return this.liste.find(function(e){return e.code==t}).operateurs},e}();i.ListeTypes=m;var n=function(){function e(e,t,n,i,o,r){this.listeChamps=e,this.listeFilters=t,this.listeOperateurs=n,this.filter=r,this.callBack=i,this.options=o||{},this.data={},this.init()}return e.prototype.init=function(){var i=this;i.model={type:"object",properties:{filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},selected:{type:"string"}}}}},links:{validate:{title:r.ui.Validate,isHidden:1!=i.options.btnValidate}}},i.layout={name:"form",$type:"block",$items:[{$type:"block",$items:[{$type:"block",$items:[{$bind:"filters",$widget:"tagview"}]},{$type:"block",$inline:!0,$items:[{$bind:"$links.validate",options:{type:"success",right:!0}}]}],$title:{value:r.ui.selectedFilters,size:5,style:""}}]},i.data.filters=i.listeFilters.gets().map(function(e){var t=i.listeOperateurs.get(e.op),n=i.listeChamps.get(e.code).libelle+" "+t.options.symbol+" ";return t.isBinary?n+=e.values[0]+" "+t.options.liaison+" "+e.values[1]:n+=e.getValueNames().join(", "),{code:e.id,libelle:n,selected:!(!i.filter||i.filter.id!=e.id)}})},e.prototype.render=function(e){var i=this;e&&s.OpenForm($(e),i.layout,i.model,i.data,{},function(e,t,n){switch(e.property){case"upd":i.callBack("EDIT",{id:e.actionParams.code});break;case"remove":i.callBack("REMOVE",{id:e.actionParams.code});break;case"$links.validate":i.callBack("VALIDE",{})}},null,null,null)},e}(),v=function(){function e(e,t,n){this.valueModel=null;this.type=e,this.op=t,this.options=$.extend(!0,{},n),this.valueModel=this.getInstance()}return e.prototype.getInstance=function(){var e=this,t=e.addDefaultOptions(e.options);return e.op.isBinary?new b(t):e.op.code===c.empty||e.op.code===c.nempty?new y(t):"enum"===e.type?new C(t):"lookup"===e.type?new k(t):e.op.code!==c.in&&e.op.code!==c.nin||"decimal"==e.type||"money"==e.type||"date"==e.type||"date-time"==e.type?new _(t):new x(t)},e.prototype.init=function(e){this.valueModel.init(e)},e.prototype.addDefaultOptions=function(e){switch(this.type){case"integer":e.type="number";break;case"decimal":e.type="number",e.decimals=e.decimals||5;break;case"money":e.type="number",e.format="money";break;case"date":e.type="string",e.format="date",e.title="Date";break;case"time":e.type="string",e.format="time",e.title="Time";break;case"date-time":e.type="string",e.format="date-time",e.title="Date";break;default:e.type=this.type||"string"}return e},e.prototype.getModel=function(){return this.valueModel?this.valueModel.getModel():null},e.prototype.getLayout=function(){return this.valueModel?this.valueModel.getLayout():null},e.prototype.getData=function(){return this.valueModel?this.valueModel.getData():null},e.prototype.getValues=function(){return this.valueModel?this.valueModel.getValues():null},e.prototype.setValues=function(e,t){return this.valueModel?this.valueModel.setValues(e,t):null},e.prototype.setValuesByFilter=function(e){this.valueModel&&this.valueModel.setValuesByFilter(e)},e}(),g=function(){function e(e){}return e.prototype.init=function(e){e&&e()},e.prototype.getModel=function(){return this.model},e.prototype.getLayout=function(){return this.layout},e.prototype.getData=function(){return this.data},e.prototype.getValues=function(){},e.prototype.setValues=function(e,t){},e.prototype.setValuesByFilter=function(e){},e}(),y=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getValues=function(){return[""]},e}(g),_=function(i){function e(e){var t=i.call(this,e)||this,n=t;return n.options=e||{},n.model={type:"object",properties:{value:{title:n.options.title||"Valeur",type:n.options.type||"string"}},states:{value:{isMandatory:!0}}},n.options.format&&(n.model.properties.value.format=n.options.format),n.options.decimals&&(n.model.properties.value.decimals=n.options.decimals),n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:12}]},n.data={value:null},t}return __extends(e,i),e.prototype.getValues=function(){return null!=this.data.value?[this.data.value]:null},e.prototype.setValues=function(e){this.data.value=e.value},e.prototype.setValuesByFilter=function(e){this.data.value=e[0]},e}(g),b=function(i){function e(e){var t=i.call(this,e)||this,n=t;return n.options=e||{},n.model={type:"object",properties:{value1:{title:(e.title||"Valeur")+" 1",type:e.type||"string"},value2:{title:(e.title||"Valeur")+" 2",type:e.type||"string"}},states:{value1:{isMandatory:!0},value2:{isMandatory:!0}}},n.options.format&&(n.model.properties.value1.format=n.options.format,n.model.properties.value2.format=n.options.format),n.options.decimals&&(n.model.properties.value1.decimals=n.options.decimals,n.model.properties.value2.decimals=n.options.decimals),n.layout={name:"filter-value",$type:"block",$items:[{$type:"row",$items:[{$items:[{$bind:"value1",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6},{$items:[{$bind:"value2",options:{titleIsHidden:!0,placeHolder:!0}}],$colSize:6}]}]},n.data={value1:null,value2:null},t}return __extends(e,i),e.prototype.getValues=function(){return null!=this.data.value1&&null!=this.data.value2?[this.data.value1,this.data.value2]:null},e.prototype.setValues=function(e){this.data.value1=e.value1,this.data.value2=e.value2},e.prototype.setValuesByFilter=function(e){this.data.value1=e[0],this.data.value2=e[1]},e}(g),x=function(i){function e(e){var t=i.call(this,e)||this,n=t;return n.options=e||{},n.model={type:"object",properties:{value:{title:"Valeur",type:"string"}},states:{value:{isMandatory:!0}}},n.options.format&&(n.model.properties.value.format=n.options.format),n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",options:{titleIsHidden:!0,placeHolder:'Une ou plusieurs valeurs (séparées par un ";" : val1;val2;...)'}}],$colSize:12}]},n.data={value:null},t}return __extends(e,i),e.prototype.getValues=function(){if(null==this.data.value)return null;var e=this.data.value.split(";"),n=[];return"number"==this.options.type?e.forEach(function(e){var t=parseInt(e,10);isNaN(t)||n.push(t)}):n=e,n},e.prototype.setValues=function(e){var t=this;if(e.value){var n=e.value.split(";");n=n.map(function(e){return e.replace(/\"/g,"")});var i=[];n.forEach(function(e){"number"==t.options.type?new RegExp("^[0-9]+$").test(e)&&i.push(e):i.push(e)}),t.data.value=i.join(";")}},e.prototype.setValuesByFilter=function(e){this.data.value=e.join(";")},e}(g),C=function(i){function e(e){var t=i.call(this,e)||this,n=t;return n.options=e||{},n.options.enumName=n.options.enumName||n.options.champName,n.model={type:"object",properties:{value:{title:"List",type:"array",items:{type:"string",enums:{},$enumref:"list"}}},states:{value:{isMandatory:!0}}},n.model.properties.value.items.enums[n.options.enumName]={type:"default",enum:[],enumNames:[]},n.model.properties.value.items.$enumref=n.options.enumName,n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"enums-list",options:{titleIsHidden:!0}}],$colSize:12}]},n.options.enum&&n.options.enum.forEach(function(e){n.model.properties.value.items.enums[n.options.enumName].enum.push(e.code),n.model.properties.value.items.enums[n.options.enumName].enumNames.push(e.libelle||e.code)}),n.data={value:[]},t}return __extends(e,i),e.prototype.getValues=function(){var e=this;return e.data.value&&e.data.value.length?e.data.value.map(function(n){var i=null;return e.options.enum.forEach(function(e,t){if(n==e.code)return i=e,!1}),{code:n,lib:i.libelle||i.lib||n}}):[]},e.prototype.setValues=function(e){this.data.value=e.value},e.prototype.setValuesByFilter=function(e){this.data.value=e.map(function(e){return e.code})},e}(g),k=function(i){function e(e){var t=i.call(this,e)||this,n=t;return n.options=e||{},n.model={type:"object",properties:{value:{title:"List",type:"array",ds:n.options.lookupSchema||null,items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}},states:{value:{isMandatory:!0}}},n.layout={name:"filter-value",$type:"block",$items:[{$items:[{$bind:"value",$widget:"lookup-list",options:{titleIsHidden:!0}}],$colSize:12}]},n.data={value:[]},t}return __extends(e,i),e.prototype.getValues=function(){return this.data.value&&this.data.value.length?this.data.value:[]},e.prototype.setValues=function(e){this.data.value=e.value},e.prototype.setValuesByFilter=function(e){this.data.value=e},e}(g),w=function(){function e(e,t,n,i,o,r,s){this.champ=e,this.filter=r,this.listeFilters=t,this.listeOperateurs=n,this.listeTypes=i,this.callBack=o,this.options=s||{},this.data={operateur:null,values:[]}}return e.prototype.renderOperateur=function(){var o=this,e={type:"object",properties:{champ:{title:"Filtre",type:"string"},operateur:{title:"Opérateur",type:"string",enum:[],enumNames:[]}},states:{champ:{isReadOnly:!0,isHidden:0==o.options.showLabel},operateur:{isHidden:0==o.options.showOperateur}}},t=e.properties;o.data.champ=o.champ.libelle;var n=o.champ.options.format||o.champ.type;if(t.operateur.enum=o.listeTypes.getOperateurs(n),t.operateur.enum.forEach(function(e){t.operateur.enumNames.push(o.listeOperateurs.get(e).libelle)}),o.filter?o.data.operateur=o.filter.op:o.data.operateur=t.operateur.enum[0],0!=o.options.showLabel||0!=o.options.showOperateur){var i=u.query(o.container,".operateur");if(i){var r=s.formManager().formByName("filter-operateur");s.removeForm(r),s.OpenForm($(i),{name:"filter-operateur",$type:"block",$items:[{$type:"block",$items:[{$bind:"champ",$readOnly:!0,options:{$expression:"{{champ}}"}},{$bind:"operateur",options:{titleIsHidden:!0}}]}]},e,o.data,{},function(e,t,n){switch(e.property){case"operateur":if("propchange"==e.operation){var i=o.listeOperateurs.get(t.model().operateur);o.data.operateur=t.model().operateur,o.renderValue(i)}}},null,null,null)}}},e.prototype.renderValue=function(e){var i=this,o=u.query(i.container,".value");if(o){var t=s.formManager().formByName("filter-value");s.removeForm(t);var n=i.champ.options||{};n.champName=i.champ.code,i.modelType=new v(i.champ.options.format||i.champ.type,e,n),i.modelType&&i.modelType.init(function(){var e=i.modelType.getModel(),t=i.modelType.getLayout();if(e&&t){i.filter&&i.modelType.setValuesByFilter(i.filter.values);var n=i.modelType.getData();s.OpenForm($(o),t,e,n,{},function(e,t,n){switch(e.operation){case"propchange":default:i.modelType.setValues(t.model()),i.data.values=i.modelType.getValues()}},null,null,null)}else i.data.values=i.modelType.getValues()})}},e.prototype.renderButton=function(){var o=this,e={type:"object",properties:{},links:{add:{title:r.ui.Add}}},t=u.query(o.container,".link");if(t){var n=s.formManager().formByName("filter-link");s.removeForm(n),s.OpenForm($(t),{name:"filter-link",$type:"block",$items:[{$inline:!0,$items:[{$bind:"$links.add",options:{type:"primary",icon:"plus",right:!0}}],$colSize:12}]},e,o.data,{},function(e,t,n){switch(e.property){case"$links.add":var i=s.formManager().formByName("filter-value");if(!t.validate()||i&&!i.$model.validate())return;t.model();o.data.values&&o.data.values.length&&o.callBack({code:o.champ.code,op:o.data.operateur,values:o.data.values})}},null,null,null)}},e.prototype.render=function(e){e&&(this.container=e,u.empty(e),u.append(e,$(["<div>",'<div class="operateur">',"</div>",'<div class="value">',"</div>",'<div class="link">',"</div>","</div>"].join("")).get(0)),this.renderOperateur(),this.renderValue(this.listeOperateurs.get(this.data.operateur)),this.renderButton())},e}(),O=function(){function e(e,t,n,i,o,r){this.listeChamps=e,this.listeChampsArbre=t,this.listeFilters=n,this.listeOperateurs=i,this.listeTypes=o,this.options=r||{}}return e.prototype.createContainer=function(){this.container=document.createElement("div"),u.addClass(this.container,"bs-filter-view"),this.container.innerHTML=['<div class="row">','<div class="col-sm-5 bs-champ-list">',"</div>",'<div class="col-sm-7 filter-edit">',"</div>","</div>",'<div class="row">','<div class="col-sm-12 bs-filter-list">',"</div>","</div>"].join(""),this.champListView=u.query(this.container,".bs-champ-list"),this.filterListView=u.query(this.container,".bs-filter-list"),this.filterEditView=u.query(this.container,".filter-edit")},e.prototype.render=function(){return this.createContainer(),this.listeChamps.gets().length&&(this.showChampList(),this.selecteChamp(this,this.listeChamps.gets()[0].code)),this.container},e.prototype.showChampList=function(){var t=this;t._multiSelectList=new i.MultiSelectList(this.listeChampsArbre,{maxHeight:"auto"},function(e){e&&e.data.name&&t.selecteChamp(t,e.data.name)});var e=70*(t.options.listSize||7),n=$('<div class="bs-field-list-border" style="max-height:'+e+'px;"></div>').get(0);t._multiSelectList.render(n),u.append(t.champListView,n)},e.prototype.selecteChamp=function(e,t){e._multiSelectList.addItem(t),e.updateFilter(e,t);var n=e.listeFilters.getsByChamp(t),i=null;n&&n.length&&(i=n[0]),e.showFilterList(e,i)},e.prototype.showFilterList=function(i,e){var t=new n(i.listeChamps,i.listeFilters,i.listeOperateurs,function(e,t){if("EDIT"==e){var n=i.listeFilters.get(t.id);n&&i.selecteChamp(i,n.code)}else"REMOVE"==e?i.removeFilter(i,t.id):"VALIDE"==e&&i.valideFilters()},i.options,e);u.empty(i.filterListView),t.render(i.filterListView)},e.prototype.updateFilter=function(t,e){var n=t.listeChamps.get(e),i=t.listeFilters.getsByChamp(e),o=null;i&&i.length&&(o=i[0]);var r=new w(n,t.listeFilters,t.listeOperateurs,t.listeTypes,function(e){t.addFilter(t,e)},o,t.options);u.empty(t.filterEditView),r.render(t.filterEditView)},e.prototype.addFilter=function(e,t){var n,i=e.listeFilters.getsByChamp(t.code);n=!e.options.multiple&&i&&i.length?e.listeFilters.set(i[0].id,t):e.listeFilters.add(t.code,t.op,t.values),e.showFilterList(e,n)},e.prototype.removeFilter=function(e,t){var n=e.listeFilters.get(t).code;e.listeFilters.remove(t),e.selecteChamp(e,n)},e.prototype.valideFilters=function(){},e}(),S=function(l){function e(e,t,n,i,o,r,s){var a=this;return(a=l.call(this,e,t,n,i,o,$.extend(!0,{btnValidate:!0},r))||this)._callback=s,a}return __extends(e,l),e.prototype.createContainer=function(){var e=this,t=D.bootstrap4,n=['<div class="row">','<div class="col'+(t?"":"-xs")+'-12 bs-filter-list">',"</div>","</div>",'<div class="row">','<div class="col'+(t?"":"-xs")+'-12">','<h5 class="bs-block-title" data-ignore="true">'+(e.options.title||"Filtre")+"</h5>","</div>","</div>",'<div class="row">','<div class="col-sm-4 bs-champ-list">',"</div>",'<div class="col-sm-8 filter-edit">',"</div>","</div>"];e.container=document.createElement("div"),u.addClass(e.container,"bs-filter-view"),e.container.innerHTML=n.join(""),e.champListView=u.query(e.container,".bs-champ-list"),e.filterListView=u.query(e.container,".bs-filter-list"),e.filterEditView=u.query(e.container,".filter-edit")},e.prototype.valideFilters=function(){this._callback("VALIDE")},e}(O),E=function(r){function e(e,t,n){var i=r.call(this,e,t,n)||this,o=i;return n.registerListenerFor(o.$bind+".$item",o),i._state(),i}return __extends(e,r),e.prototype._state=function(){var t=this;t.state=t.state||{};var n=t.form.getState(t.$bind);Object.keys(n).forEach(function(e){t.state[e]=n[e]}),t.state.value=t.form.getValue(t.$bind)},e.prototype.click=function(e){var t=e.target;if("LI"==t.nodeName.toUpperCase()||"SPAN"==t.nodeName.toUpperCase()){var n=t;"SPAN"==t.nodeName.toUpperCase()&&(n=u.parentByTag(this.$element.get(0),t,"LI"));var i=-1;if(n&&(i=parseInt(u.attr(n,"data-id"),10)),i<0)return;var o=n=null;if(this.state.value.forEach(function(e,t){if(e.code==i)return o=e.model(),!1}),!o)return;"REMOVE"==u.attr(t,"data-id")?this.form.execAction("remove",o):this.form.execAction("upd",o)}},e.prototype._state2UI=function(){var t=this;t.createContainer(t.id),t.state.value&&t.state.value.forEach(function(e){t.addTag(e)})},e.prototype.destroy=function(){this.form.unRegisterListenerFor(this.$bind+".$item",this),r.prototype.destroy.call(this)},e.prototype.changed=function(e,t,n,i,o){"add"==i?this.addTag(n):"remove"==i&&this.removeTag(o.$value.code)},e.prototype.stateChanged=function(e,t){var n=this.form.getState(this.$bind),i=this.$element?this.$element.get(0):null;i&&n.isHidden!==this.state.isHidden&&(this.state.isHidden=n.isHidden,this.setHidden(i))},e.prototype.addTag=function(e){var t=document.createElement("li");u.addClass(t,"item"),u.addClass(t,"bs-boxed-tags-item"),u.addClass(t,"bs-cursor-p"),u.addClass(t,"btn-primary"),e.selected&&u.addClass(t,"focus"),u.attr(t,"data-id",e.code),t.innerHTML=e.libelle+' <span data-id="REMOVE" class="'+u.iconClass("remove")+'" ></span>',u.append(this.$element.get(0),t)},e.prototype.removeTag=function(e){var t=u.query(this.$element.get(0),'li[data-id="'+e+'"]');u.remove(t)},e.prototype.createContainer=function(e){this.$element=$(a.format('<ul id="{0}" data-render="{0}" class="bs-boxed-tags" draggable="true"></ul>',e))},e.prototype.render=function(e){var t=this._initOptions(l.utils.defaultOptions);return this.$element||(this.setEvents(null),this._state2UI()),this.appendElement(e,t),this.$element},e}(i.AbsField);s.registerControl(E,"array",!1,"tagview");var P=function(){function e(e){this.options=e||{},this._elements=[],this._values=[]}return Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},set:function(e){e&&(this._elements=e,this._notifyChange("elements"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){return this._values},set:function(e){e&&(this._values=e,this._notifyChange("values"))},enumerable:!0,configurable:!0}),e.prototype._notifyChange=function(e){switch(e){case"elements":u.empty(this.$element.get(0)),this.renderElements(this.elements||[],this.values||[],this.options||{})}},e.prototype.findVal=function(n){var i=-1;return this.values.forEach(function(e,t){if(e==n)return i=t,!1}),i},e.prototype.render=function(e){var t=this;return t.$element||(t.$element=$('<div class="row bs-checkboxlist"></div>'),t.renderElements(t.elements,t.values,t.options),t.setEvents(null)),e&&(t.options.replaceParent?e.replaceWith(t.$element):e.append(t.$element)),t.$element},e.prototype.destroy=function(){this._removeEvents(),this.$element=null,this.options=null},e.prototype.removeVal=function(e){var t=this.findVal(e);0<=t&&this.values.splice(t,1)},e.prototype.addVal=function(e){this.values.push(e)},e.prototype.setEvents=function(e){var n=this;n.$element&&n.$element.on("click",function(e){if(!n.options.isDisabled&&!n.options.isReadOnly){var t=u.parentByClass(n.$element.get(0),e.target,"bs-checkboxlist-list");t&&n._toggleEnumByIndex(u.indexOf(t.parentNode,t))}})},e.prototype._removeEvents=function(){this.$element&&this.$element.off("click")},e.prototype.renderElements=function(e,o,r){var t=D.bootstrap4,s=document.createDocumentFragment();if(e.length){r=r||{};var a=$('<div tabindex="0" class="bs-checkboxlist-list col-lg-6 col'+(t?"":"-xs")+'-12 checkbox-inline"><div class="bs-checkboxlist-list-check"><a><span class="'+u.iconClass("square-o")+'"></span></a></div><div class="bs-checkboxlist-list-title"></div></div>').get(0);e.forEach(function(e,t){var n=a.cloneNode(!0);r.disabled?(u.attr(n,"tabindex","-1"),u.removeClass(n,"bs-pointer"),u.addClass(n,"bs-cursor-disabled")):(u.attr(n,"tabindex","0"),u.addClass(n,"bs-pointer"),u.removeClass(n,"bs-cursor-disabled")),n.firstChild.firstChild.firstChild.className=o&&0<=o.indexOf(e.code)?u.iconClass("check-square-o"):u.iconClass("square-o");var i=n.lastChild;u.append(i,document.createTextNode(e.libelle)),u.append(s,n)})}else{var n=$('<center><div class="bs-lv-nodata">Aucun résultat trouvé ...</div></center>').get(0);u.append(s,n)}u.append(this.$element.get(0),s)},e.prototype._inputs=function(){return this.$element.get(0)},e.prototype._setItemValue=function(e,t){e.firstChild.firstChild.firstChild.className=t?u.iconClass("check-square-o"):u.iconClass("square-o")},e.prototype._toggleEnumByIndex=function(e){var t=this;if(0<=e&&e<t.elements.length){var n=t.elements[e],i=t.findVal(n.code),o=t._inputs();0<=i?(t._setItemValue(o.childNodes[e],!1),t.removeVal(n.code),t.options.onSelectItem&&t.options.onSelectItem("remove",{id:e,value:n,data:n})):(t._setItemValue(o.childNodes[e],!0),t.addVal(n.code),t.options.onSelectItem&&t.options.onSelectItem("add",{id:e,value:n,data:n}))}},e}();i.CheckBoxList=P;var I=function(o){function e(e,t,n){var i=o.call(this,e,t,n)||this;return i.renderInternal=function(e,t){var n=this;if(n.$element){var i;switch(t.renderModel){case"model2":i=new S(n.listeChamps,n.listeChampsArbre,n.listeFilters,n.listeOperateurs,n.listeTypes,t,function(e,t){"VALIDE"==e&&n.form.execAction("validate",{})});break;default:i=new O(n.listeChamps,n.listeChampsArbre,n.listeFilters,n.listeOperateurs,n.listeTypes,t)}u.append(n.$element.get(0),i.render())}},i.createContainer=function(e){return a.format('<div id="{0}" data-render="{0}" class="bs-filter"></div>',e)},i._state(),i._options=t||{},i.initData(),i}return __extends(e,o),e.prototype.initData=function(){var n=this;n.listeOperateurs=new p,Object.keys(c).forEach(function(e){var t=r.operators[e];n.listeOperateurs.add(e,t.title,t.binary,{symbol:t.symbol})}),n.listeTypes=new m,Object.keys(t).forEach(function(e){var t=r.types[e];n.listeTypes.addType(e,t.title,t.operators)}),n._updateData()},e.prototype._updateData=function(){var i=this;i.listeChamps=new h;var n=i.state.value&&i.state.value.lookups?i.state.value.lookups._model:{};(i.state.value&&i.state.value.champs?i.state.value.champs:[]).forEach(function(e){var t={};e.lookup?(t.lookupSchema=n[e.lookup]||d.getLookup(i.$bind,e.lookup,i.$schema,i.form.$rootSchema),t.lookup=e.lookup,t.format="lookup"):e.enum&&e.enum.length?(t.enum=e.enum,t.enumName=e.enumName,t.format="enum"):"boolean"===e.type?(t.enum=[{code:!0,libelle:r.ui.true},{code:!1,libelle:r.ui.false}],t.format="enum"):(t.decimals=e.decimals,t.format=e.format&&i.listeTypes.get(e.format)?e.format:null),e.type&&i.listeTypes.get(e.type)&&i.listeChamps.add(e.code,e.libelle,e.type,t)});var e=i.state.value&&i.state.value.filters?i.state.value.filters:[];i.listeFilters=new f(e),e.forEach(function(e){var t=[];e.values.forEach(function(e){t.push(e)});var n=[];e.values2&&e.values2.forEach(function(e){n.push(e)}),i.listeFilters.add2(e.code,e.op,n.length?n:t)}),i.listeChampsArbre=i.state.value&&i.state.value.entree&&i.state.value.entree.length?i.state.value.model().entree:null,i.listeChampsArbre?i.listeChampsArbre.forEach(function(e){e.items&&!e.items.length&&delete e.items}):i.listeChampsArbre=i.listeChamps.gets().map(function(e){return{name:e.code,title:e.libelle}})},e.prototype.refresh=function(){this._updateData(),u.empty(this.$element.get(0)),this.renderInternal({data:this.state.value},this._options)},e.prototype._state=function(){var t=this;t.state=t.state||{};var n=t.form.getState(t.$bind);Object.keys(n).forEach(function(e){t.state[e]=n[e]}),t.state.value=t.form.getValue(t.$bind)},e.prototype.render=function(e){var t=this,n=t._initOptions(l.utils.defaultOptions);return t.$element||(t.$element=$(t.createContainer(t.id)),u.empty(t.$element.get(0)),n.id=t.id,n.title=t.$schema.title||"",n=$.extend(!0,n,t.renderOptions),t._options=n,t.renderInternal({data:t.state.value},n)),t.appendElement(e,n),t.$element},e.prototype.destroy=function(){o.prototype.destroy.call(this)},e}(i.AbsField);i.ComposantFilter=I,s.registerControl(I,"object",!1,"filter")}(D.ui||(D.ui={}))}(Phoenix||(Phoenix={})),function(a){!function(e){var i=e,t=a.filters,s=a.locale,l=t.OPERATORS,u=function(e,t,n,i,o){var r={code:t,libelle:n,type:i,format:(o=o||{}).format||null,decimals:o.decimals,enum:o.enum,enumName:o.enumName,lookup:o.lookup};e.push(r)},r=function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")},n=function(e,i){var o=[];return e.forEach(function(t){i.forEach(function(e){if(t.code===e.code)return t.lib=e.libelle,!1});var e,n=(t.lib||t.code)+" "+(e=t.op,s.operators[e].symbol||"");t.op===l.empty||t.op===l.nempty?n+=" vide":t.op===l.between||t.op===l.nbetween?n+=" "+t.values[0]+" et "+t.values[1]:t.getValueNames?n+=" "+t.getValueNames().join(","):n+=" "+t.values.join(","),o.length&&o.push(" et "),o.push(n)}),o.join("")};e.filter={format:{toPhenix:function(s,e){if(!s||!e)return null;var a=function(e,t){for(var n=[],i=e.length%2!=0,o=i?e.length-1:e.length,r=0;r<o;r+=2)n.push({$left:e[r],$op:t,$right:e[r+1]});return i&&n.push(e[e.length-1]),2<=n.length&&(n=a(n,t)),n},t=[];return e.forEach(function(e){t.push(function(n){var i=s.find(function(e){return e.code==n.code}),o=n.op==l.in?"eq":n.op;o=o==l.nin?"ne":o;var e=n.values.map(function(e){return void 0!==e.code?e.code:e});return o==l.between||o==l.nbetween?o==l.between?t(n.code,i.type,e[0],e[1]):{$op:"not",$right:t(n.code,i.type,e[0],e[1])}:(e=e.map(function(e){var t=null;switch(o){case l.like:t=r(n.code,i.type,e);break;case l.nlike:t={$op:"not",$right:r(n.code,i.type,e)};break;case l.empty:t={$left:n.code,$op:"eq",$right:{type:"string",value:""}};break;case l.nempty:t={$left:n.code,$op:"ne",$right:{type:"string",value:""}};break;default:t={$left:n.code,$op:o,$right:{type:i.type,value:e}}}return t}),a(e,"or")[0]);function t(e,t,n,i){return{$left:{$left:e,$op:l.ge,$right:{type:t,value:n}},$op:"and",$right:{$left:e,$op:l.le,$right:{type:t,value:i}}}}function r(e,t,n){return{$left:"contains("+e+",'"+n+"')",$op:null,$right:null}}}(e))}),a(t,"and")[0]},toMongoDbFilter:function(e){if(!e)return null;var o=[];return e.forEach(function(e){var t={},n=null,i=e.values.map(function(e){return void 0!==e.code?e.code:e});switch(e.op){case l.between:n={$gte:i[0],$lte:i[1]};break;case l.nbetween:n={$not:{$gte:i[0],$lte:i[1]}};break;case l.in:n=1<i.length?{$in:i}:i[0];break;case l.nin:n=1<i.length?{$nin:i}:{$ne:i[0]};break;case l.gt:n={$gt:i[0]};break;case l.ge:n={$gte:i[0]};break;case l.lt:n={$lt:i[0]};break;case l.le:n={$lte:i[0]};break;case l.like:n={$regex:r(i[0])};break;case l.nlike:n={$not:{$regex:r(i[0])}};break;case l.empty:n={$exists:!1};break;case l.nempty:n={$exists:!0}}null!=n&&(t[e.code]=n,o.push(t))}),o.length?{$and:o.map(function(e){return e})}:null},toTitle:n},removeMdbFilterExpress:function(e,t){return e},addMdbFilterExpress:function(e,t){return t},addField:function(e,t,n,i,o,r,s){var a={};a.decimals=o,a.enum=r,a.enumName=s,u(e,t,n,i,a)},addField2:u,transformPropsToFilterFormat:function(t,e){e.forEach(function(n){var e=$.extend(!0,{},n.schema);switch(e.type){case"number":0<e.decimals?e.type="decimal":e.type="integer"}n.schema.enum&&(e.enum=n.schema.enum.map(function(e,t){return{code:e,libelle:n.schema.enumNames?n.schema.enumNames[t]:e}})),i.filter.addField2(t,n.name,e.title,e.type,{decimals:e.decimals,enum:e.enum,format:e.format})})},toTitle:n,mongoDbFilter2Filter:function(e,t,n){if(!e)return null;if(e&&e.$and){var o={},r=[];if(t.forEach(function(e){o[e.name]=e}),e.$and.forEach(function(e){var t=Object.keys(e)[0],n={op:"",values:[],code:t};if("object"==typeof(e=e[t])){var i=!1;e.$not&&(i=!0,e=e.$not),null!=e.$gte&&null!=e.$lte?(n.op=i?l.nbetween:l.between,n.values.push(e.$gte),n.values.push(e.$lte)):e.$in?(n.op=l.in,n.values=e.$in):e.$nin?(n.op=l.nin,n.values=e.$nin):e.$ne?(n.op=l.nin,n.values.push(e.$ne)):e.$gt?(n.op=l.gt,n.values.push(e.$gt)):e.$gte?(n.op=l.ge,n.values.push(e.$gte)):e.$lt?(n.op=l.lt,n.values.push(e.$lt)):e.$lte?(n.op=l.le,n.values.push(e.$lte)):null!=e.$exists?n.op=e.$exists?l.nempty:l.empty:e.$regex?(n.op=i?l.nlike:l.like,n.values.push(e.$regex.replace(/\\\$/g,"$").replace(/\\\?/g,"?").replace(/\\\*/g,"*").replace(/\\\+/g,"+").replace(/\\\./g,".").replace(/\\\^/g,"^").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\{/g,"{").replace(/\\\}/g,"}").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\|/g,"|"))):n=null}else n.op=l.in,n.values.push(e);n&&r.push(n)}),r&&r.length)return n&&r.forEach(function(e){var n=o[e.code].schema,t=e.values?e.values.map(function(e){if(n.enum&&n.enumNames){var t=n.enum.indexOf(e);if(0<=t)return n.enumNames[t]}return e}):[],i=(o[e.code].schema.title||e.code)+" "+(s.operators[e.op].symbol||"");e.op===l.empty||e.op===l.nempty?i+=" vide":e.op===l.between||e.op===l.nbetween?i+=" "+t[0]+" et "+t[1]:i+=" "+t.join(","),e.title=i}),r}return null}};var o=function(){function e(){this.filterComplex=null,this.filterExpress=null}return e.prototype.constructeFilter=function(){var e=this;return e.filterComplex&&e.filterComplex.value&&e.filterExpress&&e.filterExpress.value?{title:e.filterComplex.title+" et "+e.filterExpress.title,value:{$left:e.filterComplex.value,$op:"AND",$right:e.filterExpress.value}}:e.filterComplex&&e.filterComplex.value?e.filterComplex:e.filterExpress&&e.filterExpress.value?e.filterExpress:{title:"",value:null}},e}();e.FilterManager=o,e.filterManagerFactory=function(){return new o}}(a.ui||(a.ui={}))}(Phoenix||(Phoenix={})),function(e){(e.ui||(e.ui={})).multiSelectUtils={transformPropsToMultiselectFormat:function(e,t,n){var i,o=t&&t.items?t.items:[],r=t&&t.fields?t.fields:[],s=t&&t.items?$.extend(!0,[],o):[];return n?function t(e,n,i){e.forEach(function(e){e.items=e.items||[],t(e.items,e.fields||[],i)}),n.forEach(function(t){i.every(function(e){return t.name!==e.name||(t.title=e.schema.title||e.name,!1)}),e.push(t)})}(s,r,e):(i=s,e.forEach(function(e){var t={name:e.name,title:e.schema.title||e.name},n=function t(e,n){var i=null;return e.every(function(e){return e.name===n?(i=e,!1):!e.items||!(i=t(e.items,n))}),i}(i,e.schema.group);n?(n.items=n.items||[],n.items.push(t)):i.push(t)})),s},transformMultiSelectColumnsToGridColumnsFormat:function(e){var t=[];return e.forEach(function(e){t.push({$bind:e.name,options:{}})}),t},transformSelectedColumnsToMultiSelectFormat:function(e,n,i,o){i=i&&i.items?i.items:[];var r=[];return Object.keys(n).forEach(function(t){(!o||function t(e,n){var i=null;return e.every(function(e){return e.name===n&&(i=e),!e.items&&!e.fields||i||(i=t(e.fields||e.items,n)),!i}),i}(i||[],t))&&e.every(function(e){return e.name!==t||(n[t]&&r.push({name:t,title:e.schema.title||e.name}),!1)})}),r}}}(Phoenix||(Phoenix={})),function(n){!function(e){n.utils,n.ulocale;var p=n.dom,t=(n.Observable.SchemaUtils,function(){function e(e,t,n){var i=this;i._options=$.extend(!0,{mapping:{id:"name",lib:"title"},expandIcon:"plus-circle",collapseIcon:"minus-circle",checkedIcon:"check-square-o",uncheckedIcon:"square-o",itemIcon:"",groupIcon:"",multiSelect:!1,showTags:!1,groupLink:!1,itemLink:!0,border:!1,maxHeight:"300px"},t),i._name=i._options.mapping.id,i._title=i._options.mapping.libelle||i._options.mapping.lib,i._data=e||[],i._callback=n||null,i._nodes=$.extend(!0,[],e),i._selectedItems=[],i._init()}return Object.defineProperty(e.prototype,"items",{get:function(){return this._data},set:function(e){this._data=e||[],this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._constructeNodes(this._nodes,this._options),this._container&&this._renderItems(this._nodes)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){var t=this;t._selectedItems=$.extend(!0,[],e),t._container&&t._selectedItems.forEach(function(e){t.addItem(e[t._name])})},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._constructeNodes(this._nodes,this._options)},e.prototype._getGroupNode=function(e,t){var n=this,i=null;return e.every(function(e){return e.items&&((i=e[n._name]===t?e:null)||(i=n._getGroupNode(e.items,t))),!i}),i},e.prototype._getItemNode=function(e,t){var n=this,i=null;return e.every(function(e){return!(i=e.items||e[n._name]!==t?null:e)&&e.items&&(i=n._getItemNode(e.items,t)),!i}),i},e.prototype._getItem=function(e,t){var n=this,i=null;return e.every(function(e){return e[n._name]===t?(i=e,!1):!e.items||!(i=n._getItem(e.items,t))}),i},e.prototype._getSelectedItemIndex=function(n){var i=this,o=-1;return i._selectedItems.every(function(e,t){return e[i._name]!==n||(o=t,!1)}),o},e.prototype._itemsIsSelected=function(e){var i=this,o=!0;return e.every(function(t){var n=!1;return i._selectedItems.every(function(e){return e[i._name]!=t[i._name]||!(n=!0)}),!!n||(o=!1)}),o},e.prototype._itemsIsUnselected=function(e){var n=this,i=!0;return e.every(function(t){return n._selectedItems.every(function(e){return e[n._name]!=t[n._name]||(i=!1)}),!!i}),i},e.prototype._constructeNodes=function(e,t){var c=this;Array.isArray(e)&&e.length&&(!function r(e,s,a,l,u){var d=$(c._template().item).get(0);c._options.border||p.addClass(d,"border-0");e.forEach(function(e){if(e[c._name]){e.level=a||0,e.show=1==l,e.parent=s||null,e.component=d.cloneNode(),e.items&&(e.tagsSize=0,r(e.items,e,e.level+1,!1,u));for(var t=e.parent;t;)t.tagsSize++,t=t.parent;for(var n=1;n<=e.level;n++)p.append(e.component,$(c._template().indent).get(0));if(e.items){var i=c._createIcon(e.component,u.expandIcon,"icon-group bs-cursor-p");if(p.attr(i,"data-event","click"),p.attr(i,"data-action","expand"),u.multiSelect){var o=c._createIcon(e.component,u.uncheckedIcon,"icon-check bs-cursor-p");p.attr(o,"data-event","click"),p.attr(o,"data-action","uncheckG")}else u.groupLink&&(p.attr(e.component,"data-event","click"),p.attr(e.component,"data-action","selectitem"),p.addClass(e.component,"bs-cursor-p"));c._createIcon(e.component,u.groupIcon)}else{var i=c._createIcon(e.component);if(p.addClass(i,"icon-exist"),u.multiSelect&&u.itemLink){var o=c._createIcon(e.component,u.uncheckedIcon,"icon-check bs-cursor-p");p.attr(o,"data-event","click"),p.attr(o,"data-action","uncheck")}else u.itemLink&&(p.attr(e.component,"data-event","click"),p.attr(e.component,"data-action","selectitem"),p.addClass(e.component,"bs-cursor-p"));c._createIcon(e.component,u.itemIcon)}p.append(e.component,$("<span>"+(e[c._title]||e[c._name])+"</span>").get(0)),p.attr(e.component,"data-id",e[c._name])}})}(e,null,0,!0,t),t.showTags&&c._addTags(c._nodes))},e.prototype._addTags=function(e){var n=this;e.forEach(function(e){if(e.items){var t=$(n._template().badge).get(0);p.append(t,document.createTextNode(""+e.tagsSize)),p.append(e.component,t),n._addTags(e.items)}})},e.prototype._template=function(){return{list:'<ul class="list-group bs-treeview"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge badge-pill badge-secondary float-right"></span>'}},e.prototype._createIcon=function(e,t,n){var i=$(this._template().icon).get(0);return t&&this._addIcon(i,t,n),p.append(e,i),i},e.prototype._addIcon=function(e,t,n){p.attr(e,"class","icon icon-exist "+p.iconClass(t)+(n?" "+n:""))},e.prototype._setEvents=function(){var s=this;s._container&&s._container.addEventListener("click",function(e){var t=e.target,n=null;if((n="click"===p.attr(t,"data-event")?t:p.parentByTag(s._container,t,"LI"))&&"click"===p.attr(n,"data-event")){var i=p.parentByTag(s._container,n,"LI"),o=p.attr(i,"data-id"),r=p.attr(n,"data-action");"expand"===r?s._display(o,!0):"collapse"===r?s._display(o,!1):"selectitem"===r?s._select(o,s._callback):"check"===r&&s._options.multiSelect?s._checkF(o,!1,s._callback):"uncheck"===r&&s._options.multiSelect?s._checkF(o,!0,s._callback):"checkG"===r&&s._options.multiSelect?s._checkG(o,!1,s._callback,!0):"uncheckG"===r&&s._options.multiSelect&&s._checkG(o,!0,s._callback,!0)}})},e.prototype._display=function(e,t){var i=this,n=i._getGroupNode(i._nodes,e);if(n){var o=function(e,n){e.forEach(function(e){if(e.show=n,e.items){o(e.items,!1);var t=p.query(e.component,".icon-group");t&&(i._addIcon(t,i._options.expandIcon,"icon-group bs-cursor-p"),p.attr(t,"data-action","expand"))}})};o(n.items,t);var r=p.query(n.component,".icon-group");i._addIcon(r,t?i._options.collapseIcon:i._options.expandIcon,"icon-group bs-cursor-p"),p.attr(r,"data-action",t?"collapse":"expand"),i._renderItems(i._nodes)}},e.prototype._select=function(e,t){var n=p.query(this._container,".active");n&&p.removeClass(n,"active"),this._selectedItems.splice(0);var i=this._getItem(this._nodes,e);i&&(this._showItem(e),p.addClass(i.component,"active"),(i=this._getItem(this._data,e))&&(this._selectedItems.push(i),t&&t({action:"add",data:i})))},e.prototype._unSelect=function(e,t){var n=p.query(this._container,".active");n&&p.removeClass(n,"active");var i=this._getItem(this._selectedItems,e);i&&(this._selectedItems.splice(0),t&&t({action:"remove",data:i}))},e.prototype._checkF=function(e,t,n){var i=this;i._check(e,t,n);var o=i._getItem(i._nodes,e);if(o&&o.parent){var r=i._getItem(i._data,o.parent[i._name]);if(!r)return;t&&i._itemsIsSelected(r.items)?i._checkG(r[i._name],t,n,!1):!t&&i._itemsIsUnselected(r.items)&&i._checkG(r[i._name],t,n,!1)}},e.prototype._check=function(e,t,n){var i=this,o=i._getItem(i._data,e);if(o){var r=i._getItem(i._nodes,e).component,s=p.query(r,".icon-check");i._addIcon(s,t?i._options.checkedIcon:i._options.uncheckedIcon,"icon-check bs-cursor-p"),p.attr(s,"data-action",t?"check":"uncheck");var a=void 0,l=i._getSelectedItemIndex(e);t?l<0&&(i._selectedItems.push(o),a="add"):0<=l&&(i._selectedItems.splice(l,1),a="remove"),n&&a&&n({action:a,data:o})}},e.prototype._checkG=function(e,t,n,i){var o=this,r=o._getItem(o._data,e);if(r){var s=o._getItem(o._nodes,e).component,a=p.query(s,".icon-check");o._addIcon(a,t?o._options.checkedIcon:o._options.uncheckedIcon,"icon-check bs-cursor-p"),p.attr(a,"data-action",t?"checkG":"uncheckG"),i&&r.items.forEach(function(e){e.items?o._checkG(e.name,t,n,i):o._check(e.name,t,n)})}},e.prototype._showItem=function(e){var i=this,t=i._getItem(i._nodes,e);if(t){for(var n=t.parent;n;){r(n.items,!0);var o=p.query(n.component,".icon-group");i._addIcon(o,i._options.collapseIcon,"icon-group bs-cursor-p"),p.attr(o,"data-action","collapse"),n=n.parent}i._renderItems(i._nodes)}function r(e,n){e.forEach(function(e){if(e.show=n,e.items){r(e.items,!1);var t=p.query(e.component,".icon-group");t&&(i._addIcon(t,i._options.expandIcon,"icon-group bs-cursor-p"),p.attr(t,"data-action","expand"))}})}},e.prototype.addItem=function(e){this._options.multiSelect?this._checkF(e,!0):this._select(e)},e.prototype.removeItem=function(e){this._options.multiSelect?this._checkF(e,!1):this._unSelect(e)},e.prototype._renderItems=function(e){p.empty(this._container);var t=document.createDocumentFragment();!function t(e,n){e.forEach(function(e){e.show&&p.append(n,e.component),e.items&&t(e.items,n)})}(e,t),p.append(this._container,t)},e.prototype.render=function(e){var t=this;return t._container||(t._container=$(t._template().list).get(0),t._container.style.maxHeight=t._options.maxHeight,t._options.border||p.addClass(t._container,"noborder"),t._renderItems(t._nodes),t.selectedItems=t._selectedItems,t._setEvents()),e&&p.append(e,t._container),t._container},e}());e.MultiSelectList=t}(n.ui||(n.ui={}))}(Phoenix||(Phoenix={})),function(i){!function(e){var u=i.utils,d=(i.ulocale,i.dom),t=i.drag,r=(i.uiutils,i.events);i.Observable.SchemaUtils;var n=function(){function e(e,t,n){var i=this;i._options=$.extend(!0,{mapping:{id:"name",lib:"title"},removeIcon:"remove",border:!1},t),i._name=i._options.mapping.id,i._title=i._options.mapping.libelle||i._options.mapping.lib,i._data=e||[],i._callback=n||null,i._nodes=$.extend(!0,[],e),i._selectedItems=[],i._init()}return Object.defineProperty(e.prototype,"items",{get:function(){return this._data},set:function(e){this._data=e||[],this._nodes=$.extend(!0,[],e),this._selectedItems=[],this._constructeNodes(this._nodes,this._options),this._container&&this._renderItems()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=$.extend(!0,[],e),this._container&&this._renderItems()},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._constructeNodes(this._nodes,this._options)},e.prototype._constructeNodes=function(e,t){var n=this,i=$(n._template().itemTag).get(0),o=$(n._template().icon).get(0);e.forEach(function(e){e[n._name]&&(e.component=i.cloneNode(),d.append(e.component,document.createTextNode(e[n._title]||e[n._name])),d.attr(e.component,"data-id",e[n._name]),d.append(e.component,o.cloneNode()),e.filter=!0)}),n._input=n._input||$(n._template().itemInput).get(0)},e.prototype._getItem=function(e,t){var n=this,i=null;return e.every(function(e){return e[n._name]!==t||(i=e,!1)}),i},e.prototype._getItemIndex=function(e,n){var i=this,o=-1;return e.every(function(e,t){return e[i._name]!==n||(o=t,!1)}),o},e.prototype._addTag=function(e,t){var n=this._getItem(this._selectedItems,e);n||(n=this._getItem(this._data,e))&&(this._selectedItems.push(n),this._getItem(this._nodes,e).filter=!1,this._renderItems(),t&&t({action:"add",data:n}))},e.prototype._removeTag=function(e,t){var n=this._getItemIndex(this._selectedItems,e);0<=n&&(this._selectedItems.splice(n,1),this._getItem(this._nodes,e).filter=!0,this._renderItems(),t&&t({action:"remove",data:this._getItem(this._data,e)}))},e.prototype._filterList=function(t){var n=this;t.toLowerCase(),n._nodes.forEach(function(e){e.filter=0<=e[n._title].toLowerCase().indexOf(t)&&null==n._getItem(n._selectedItems,e[n._name])});var i=[];n._nodes.forEach(function(e){e.filter&&i.push(e)}),n._menu.show({value:i},0,!0)},e.prototype._setEvents=function(e){var s=this;if(s._container&&(s._container.addEventListener("click",function(e){var t=e.target,n=!1;t.href&&("#"===d.attr(t,"href")&&(e.preventDefault(),e.stopPropagation()));if(t&&"click"===d.attr(t,"data-event")){if("remove"===d.attr(t,"data-action")){var i=d.parentByTag(s._container,t,"LI"),o=d.attr(i,"data-id");s._removeTag(o,s._callback),n=!0}}else s._menu&&s._menu.opened&&s._menu.inMenu(e.target)&&s._menu.click(e);var r=d.query(s._input,"input");r&&!n&&r.focus()}),s._container.addEventListener("keyup",function(e){13===e.keyCode&&s._menu&&s._menu.opened&&s._menu.select();var t=d.query(s._input,"input");t&&t.focus()})),s._input){var r=!0;s._input.addEventListener("keyup",function(e){var t=e.target;if(38===e.keyCode||40===e.keyCode);else if(8===e.keyCode){r?s._filterList(t.value):s._menu&&s._menu.opened&&s._menu.hide(t)}else if(13===e.keyCode&&t&&"keyup"===d.attr(t,"data-event")){var n=t;s._addTag(n.value,s._callback),n.value=""}else{s._filterList(t.value);var i=d.query(s._container,".bs-pillbox-item-tag.focus");i&&d.removeClass(i,"focus")}var o=d.query(s._input,"input");o&&o.focus()}),s._input.addEventListener("keydown",function(e){var t=e.target;if(40==e.keyCode&&s._menu&&s._menu.opened)s._menu.move(1);else if(38===e.keyCode&&s._menu&&s._menu.opened)s._menu.move(-1);else if(8===e.keyCode){if(t.value.length<=0&&s._selectedItems.length&&"keyup"===d.attr(t,"data-event")){var n=s._selectedItems[s._selectedItems.length-1],i=s._getItem(s._nodes,n[s._name]);d.hasClass(i.component,"focus")?(d.removeClass(i.component,"focus"),s._removeTag(n[s._name],s._callback)):d.addClass(i.component,"focus"),r=!1}else r=!0}else 9!=e.keyCode&&27!=e.keyCode||s._menu&&s._menu.opened&&s._menu.hide(t);var o=d.query(s._input,"input");o&&o.focus()})}s._drag=t.dragManager.addDrag([s._container]),s._drag.canStartDragHandler=s._canStartDrag.bind(s),s._drag.onDragStart=s._onDragStart.bind(s),s._drag.onDrag=s._onDrag.bind(s),s._drag.onDragEnd=s._onDragEnd.bind(s)},e.prototype._template=function(){return{list:'<ul class="bs-pillbox noborder"></ul>',itemTag:'<li class="bs-pillbox-item bs-pillbox-item-tag" data-drag="move"></li>',icon:'<span class="icon-remove '+d.iconClass(this._options.removeIcon)+' bs-cursor-p" data-event="click" data-action="remove"></span>',itemInput:'<li class="bs-pillbox-item bs-pillbox-item-edit"><input autocomplete="off" autofocus="true" placeholder="..." data-event="keyup" data-action="add,remove" /></li>'}},e.prototype.addItem=function(e){this._addTag(e)},e.prototype.removeItem=function(e){this._removeTag(e)},e.prototype._canStartDrag=function(e){var n=this,t=e.target,i=d.parentByTag(n._container,t,"LI");if(i){var o=d.attr(i,"data-drag");if(!o)return!1;i.id||(i.id=u.allocID());var r=n._drag;if(r.coverDocument=!0,r.data.op=o,r.data.cloneId=i.id,r.data.column=d.attr(i,"data-id"),!r.data.column)return!1;var s=d.find(n._container,r.data.cloneId);r.cursor="move",r.moveX=!0,r.moveY=!0,r.startOffset=d.position(s,null);var a={top:0,height:s.offsetHeight,delta:-6},l=[];return n.selectedItems.forEach(function(e){var t=d.query(n._container,"li[data-id='"+e[n._name].replace(/\'/g,"\\'").replace(/\]/g,"\\]").replace(/\[/g,"\\[")+"']");t&&(t.id||(t.id=u.allocID()),l.push({htmlId:t.id,info:e}))}),r.data.childrenPositions=d.childrenPositions(n._container,l,!1,"free",a),!0}},e.prototype._onDragStart=function(e){var t=this._drag;if(!t.data.op)return!1;var n=d.find(this._container,t.data.cloneId),i=n.cloneNode(!0);d.addClass(i,"moving");var o=d.position(n,null);i.style.top=o.top+"px",i.style.left=o.left+"px",i.style.width=n.offsetWidth+"px",i.style.height=n.offsetHeight+"px",i.style.zIndex="5000",i.style.position="absolute",i.style.cursor="move",t.floatElement=i;var r=d.position(this._container,document.body);return t.minLeft=r.left-10,t.maxLeft=r.left+r.width+10,t.minTop=r.top-10,t.maxTop=r.top+r.height+10,d.append(document.body,t.floatElement),!0},e.prototype._onDrag=function(e){var t=this._drag;if(!t.data.op)return!1;var n=r.point(e),i=d.findNearest(n.x,n.y,t.data.childrenPositions);if(t.data.best!=i){var o={left:i.left,top:i.top,width:i.width,height:i.height};t.data.mdiv=d.showMove(t.data.mdiv,i.vertical,o,"bs-drag-color-danger")}return t.data.best=i,!0},e.prototype._onDragEnd=function(e,t){var n=this,i=n._drag;if(!i.data.op)return!1;if(i.floatElement&&(d.remove(i.floatElement),i.floatElement=null),i.data.mdiv&&(d.remove(i.data.mdiv),i.data.mdiv=null),!e){if(i.data.best&&i.data.column){var o=i.data.best.info;if("empty"===i.data.best.position||o[n._name]===i.data.column)return;var r=n._getItem(n._selectedItems,i.data.column),s=n._getItemIndex(n._selectedItems,i.data.column);n.selectedItems.splice(s,1);var a=n._getItemIndex(n._selectedItems,o[n._name]);a="after"===i.data.best.position?a+1:a,n.selectedItems.splice(a,0,r),n._callback&&n._callback({action:"drag",srcIndex:s,destIndex:a,data:r})}n._renderItems()}},e.prototype._onMenuSelectItemHandler=function(e){if(e){this._addTag(e[this._name],this._callback);var t=d.query(this._input,"input");t&&(t.value="")}},e.prototype._includeDropDownMenu=function(){if(this._input){var e=d.query(this._input,"input");$(this._input).get(0).style.zIndex="3000",this._menu=new i.formdropitems.DropItems($(this._input),e,{primaryKey:this._name,search:this._title,onselect:this._onMenuSelectItemHandler.bind(this)})}},e.prototype._renderItems=function(){var n=this;d.empty(n._container);var e,i,t=document.createDocumentFragment();e=n._selectedItems,i=t,e.forEach(function(e){var t=n._getItem(n._nodes,e[n._name]);t&&(t.filter=!1,d.append(i,t.component))}),n._input&&d.append(t,n._input),d.append(n._container,t)},e.prototype.render=function(e){return this._container||(this._container=$(this._template().list).get(0),this._renderItems(),this._includeDropDownMenu(),this._setEvents(e)),e&&d.append(e,this._container),this._container},e.prototype.remove=function(){this._menu=null,this._drag&&(t.dragManager.rmvDrag(this._drag),this._drag=null)},e}();e.PillBox=n}(i.ui||(i.ui={}))}(Phoenix||(Phoenix={})),function(e){var o,t,n,a,l,i;o=e.ui||(e.ui={}),t=o,n=e.utils,e.uiutils,e.ulocale,l=e.dom,a=e.uiutils,e.Observable.SchemaUtils,i=function(s){function e(e,t,n){var i=s.call(this,e,t,n)||this,o=i;o._state();var r=o.state.value.model().entree||[];return r=r.map(function(e){return e.items&&!e.items.length&&delete e.items,e}),o._sortie=o.state.value.sortie||[],o._options=$.extend(!0,{mapping:{id:"name",lib:"title"},multiSelect:!0,pillBox:!0,renderModel:"top",maxHeight:"250px"},o.renderOptions),o._name=o._options.mapping.id,o._title=o._options.mapping.libelle||o._options.mapping.lib,Array.isArray(r)&&(o._initMultiSelectList(r,o.state.value.model().sortie),o._options.pillBox&&o._initPillBox(o._extractItems(r,!1),o.state.value.model().sortie)),i}return __extends(e,s),e.prototype._initMultiSelectList=function(e,t){var n=this;n.multiSelectList||(n.multiSelectList=new o.MultiSelectList(e,n._options,function(e){if("add"===e.action)n.pillBox&&n.pillBox.addItem(e.data[n._name]),n._sortie.push(e.data);else if("remove"===e.action){n.pillBox&&n.pillBox.removeItem(e.data[n._name]);var t=n._getSortieItem(n._sortie,e.data[n._name]);t&&n._sortie.remove(t.data)}})),n.multiSelectList.selectedItems=t||[]},e.prototype._initPillBox=function(e,t){var i=this;i.pillBox=new o.PillBox(e,i._options,function(e){if("add"===e.action)i.multiSelectList.addItem(e.data[i._name]),i._sortie.push(e.data);else if("remove"===e.action){i.multiSelectList.removeItem(e.data[i._name]);var t=i._getSortieItem(i._sortie,e.data[i._name]);t&&i._sortie.remove(t.data)}else if("drag"===e.action){var n=i._getSortieItem(i._sortie,e.data[i._name]);i._sortie.remove(n.data),i._sortie.splice(e.destIndex,0,e.data)}}),i.pillBox.selectedItems=t||[]},e.prototype._getSortieItem=function(e,n){var i=this,o=null;return e.forEach(function(e,t){return e[i._name]!==n||!(o={id:t,data:e})}),o},e.prototype._extractItems=function(e,t){var n=[];return function t(e,n,i){e.forEach(function(e){e.items?(i&&n.push(e),t(e.items,n,i)):n.push(e)})}(e,n,t),n},e.prototype._state=function(){var t=this;t.state=t.state||{};var n=t.form.getState(t.$bind);Object.keys(n).forEach(function(e){t.state[e]=n[e]}),t.state.value=t.form.getValue(t.$bind)},e.prototype._state2UI=function(){},e.prototype.changed=function(e,t,n,i,o){var r=this;r._sortie=r.state.value.sortie||[];var s=r.state.value.model().entree||[];s=s.map(function(e){return e.items&&!e.items.length&&delete e.items,e});var a=r.state.value.model().sortie||[];r.multiSelectList&&(r.multiSelectList.items=s,r.multiSelectList.selectedItems=a),r.pillBox&&(r.pillBox.items=r._extractItems(s,!1),r.pillBox.selectedItems=a)},e.prototype._template=function(e){var t;switch(this._options.renderModel){case"left":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title bs-style-spo-h2 bs-block-title-no-space">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title bs-style-spo-h2 bs-block-title-no-space">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>","</div>"];break;case"right":t=['<div id="{0}" data-render="{0}">','<div class="row">','<div id="{0}_pillbox" class="col-sm-4">','<h5 class="bs-block-title bs-style-spo-h2 bs-block-title-no-space>Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_multiselect" class="col-sm-8">','<h5 class="bs-block-title bs-style-spo-h2 bs-style-no-margin-y">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>","</div>"];break;case"bottom":t=['<div id="{0}" data-render="{0}">','<div id="{0}_multiselect">','<h5 class="bs-block-title bs-style-spo-h2 bs-block-title-no-space">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>",'<div id="{0}_pillbox">','<h5 class="bs-block-title bs-style-spo-h2">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>","</div>"];break;default:t=['<div id="{0}" data-render="{0}">','<div id="{0}_pillbox">','<h5 class="bs-block-title bs-style-spo-h2 bs-block-title-no-space">Choix de colonnes</h5>','<div data-id="pillbox"></div>',"</div>",'<div id="{0}_multiselect">','<h5 class="bs-block-title bs-style-spo-h2 bs-block-title-no-space">Liste de champs</h5>','<div data-id="multiselect" style="overflow-y:auto;max-height:'+this._options.maxHeight+';border: 1px solid #dddddd;"></div>',"</div>","</div>"]}return n.format(t.join(""),e)},e.prototype.render=function(e){var t=this,n=t._initOptions(a.utils.defaultOptions);if(!t.$element){t.$element=$(t._template(t.id));var i=t.$element.get(0);if(!t._options.pillBox){var o=l.find(i,t.id+"_pillbox");o&&l.addClass(o,"bs-none")}if(t.pillBox){var r=l.query(i,'div[data-id="pillbox"]');t.pillBox.render(r)}if(t.multiSelectList){var s=l.query(i,'div[data-id="multiselect"]');t.multiSelectList.render(s)}}return t.appendElement(e,n),t.$element},e}(o.AbsField),o.ComposantMultiSelect=i,t.registerControl(i,"object",!1,"multiselectlist",null)}(Phoenix||(Phoenix={})),function(a){var l,e=a.ctrlsinterfaces,u=a.ui;a.gridHandlers||(a.gridHandlers={}),l={filter:{champs:[],filters:[],entree:[]}},e.glbGridFilter=function(r,s,e,t){if(t=t||{},r.schemaColumns.length){void 0!==r.filters&&(l.filter.filters=r.filters),l.filter.champs.length&&l.filter.champs.splice(0),u.filter.transformPropsToFilterFormat(l.filter.champs,r.schemaColumns),l.filter.entree&&(l.filter.entree=u.multiSelectUtils.transformPropsToMultiselectFormat(r.schemaColumns,r.schemaGroups));var n={title:"Filtre",buttons:[{pattern:"validate"}]};t.large&&(n.size="lg"),u.OpenModalForm(n,{name:"filtre",$type:"block",$items:[{$type:"block",$items:[{$bind:"filter",$widget:"filter",options:{renderModel:"model1"}}]}],form:!0},{type:"object",properties:{filter:{type:"object",title:"Filtre",properties:{champs:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"},type:{type:"string"},format:{type:"string"},decimals:{type:"number"},enumName:{type:"string"},enum:{type:"array",items:{type:"object",properties:{code:{type:"string"},libelle:{type:"string"}}}},lookup:{type:"string"}}}},filters:{type:"array",items:{type:"object",properties:{code:{type:"string"},op:{type:"string"},values:{type:"array",items:{type:"string"}},values2:{type:"array",items:{type:"object",properties:{code:{type:"string"},lib:{type:"string"}}}}}}},entree:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}}}},definitions:{}},l,e,function(e,t,n,i){switch(t.property){case"validate":if(!n.validate())return;var o=null;(l=n.model()).filter.filters.length&&(o=r.mongoFilter?u.filter.format.toMongoDbFilter(l.filter.filters):u.filter.format.toPhenix(l.filter.champs,l.filter.filters)),s&&s({value:o,title:a.ui.filter.toTitle(l.filter.filters,l.filter.champs)}),e.close()}})}},e.glbGridSettings=function(e,s,t){e.options=e.options||{};var n={mselect:{entree:u.multiSelectUtils.transformPropsToMultiselectFormat(e.schemaColumns,e.schemaGroups,e.options.columnsLimited),sortie:u.multiSelectUtils.transformSelectedColumnsToMultiSelectFormat(e.schemaColumns,e.selectedColumns,e.schemaGroups,e.options.columnsLimited)}},i={noClose:!0,size:"lg",title:e.locale&&e.locale.settingsTitle?e.locale.settingsTitle:"Options",buttons:[{pattern:"abandon"},{pattern:"validate"}]};u.OpenModalForm(i,{name:"settings",$type:"block",$items:[{$type:"block",$items:[{$bind:"mselect",$widget:"multiselectlist",options:{multiSelect:!0}}]}],form:!0},{type:"object",properties:{mselect:{type:"object",properties:{entree:{type:"array",items:{$ref:"#/definitions/elt"}},sortie:{type:"array",items:{type:"object",properties:{title:{type:"string"},name:{type:"string"}}}}}}},definitions:{elt:{type:"object",properties:{title:{type:"string"},name:{type:"string"},items:{type:"array",items:{type:"object",properties:{}}}}}}},n,t,function(e,t,n,i){switch(t.property){case"validate":if(!n.validate())return;var o=n.model().mselect.sortie;if(o<=0)return;var r=u.multiSelectUtils.transformMultiSelectColumnsToGridColumnsFormat(o);s&&s(r),e.close()}})},e.glbMongoFilter2Filter=u.filter.mongoDbFilter2Filter}(Phoenix||(Phoenix={}));
//# sourceMappingURL=phoenix.min.js.map